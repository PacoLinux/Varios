VERSION E05

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:1    
        1        1        /*M* KCO-CLCG - Close routines for COMGROUPS */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 8        ,IAD=0,PRB */
        9        9        /**/
       10       10        /*P* NAME:           KCO$CLCG
       11       11
       12       12             PURPOSE:        To provide close service for COMGROUPS.
       13       13
       14       14        */
       15       15
       16       16
       17       17        /*F* NAME:         KCO$CLCG
       18       18             PURPOSE:      Disconnect a station from a comgroup.
       19       19
       20       20        */
       21       21
       22       22
       23       23
       24       24        KCO$CLCG: PROC(FPT$);
       25       25
       26       26
       27       27
       28       28        /**/
       29       29        /* INCLUDES */
       30       30        /**/
       31       31        %INCLUDE AZ_MACRO_C;
       32     2618        %INCLUDE AZ_SUBS_C;
       33     2687        %INCLUDE B_STRINGS_C;
       34     2816        %INCLUDE B_SEGIDS_C;
       35     3355        %INCLUDE B$MAP;
       36     3454        %INCLUDE CP_6_SUBS;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:2    
       37     3994        %INCLUDE EL$TABLES;
       38     4317        %INCLUDE EL_SUBS_C;
       39     4401        %INCLUDE F$CP6P_C;
       40     4412        %INCLUDE F$CP6V_C;
       41     4638        %MACRO F$DCB#(BASED=BASED);
       42     4639        %INCLUDE F$DCB;
       43     4688        %MEND;
       44     4689        %INCLUDE F$JIT_C;
       45     5119        %INCLUDE FM$MACROS;
       46     5494        %INCLUDE F_CP6;
       47     6519        %INCLUDE HF_LOCK_C;
       48     6533        %INCLUDE KC$CGBLK;
       49     6581        %INCLUDE KC$CP6V_C;
       50     6701        %INCLUDE KC_CP6;
       51     7261        %INCLUDE KI_CP6;
       52     8357        %INCLUDE KQ_MAC_C;
       53    10907        %INCLUDE KQM_MAC_C;
       54    11280        %INCLUDE KQ_DATA_R;
       55    12112        %INCLUDE KQ_SUBS_C;
       56    12412        %INCLUDE K_DATA_R;
       57    13123        %INCLUDE M_INFO_C;
       58    13263        %INCLUDE NK$LDCT;
       59    13365        %INCLUDE NK_LDCT_R;
       60    13374        %INCLUDE N_FC_C;
       61    13411        %INCLUDE NK_SUBS;
       62    13436        %INCLUDE SS_SCHED_C;
       63    13669
       64    13670
       65    13671
       66    13672        /**/
       67    13673        /* BASED STRUCTURES */
       68    13674        /**/
       69    13675        %F$DCB# (BASED="BASED(JDCB$)");
       70    13725        %FM$CFU (BASED="BASED(CFU$)");
       71    13731        %FM$SET (BASED="BASED(F$CFU$)");
       72    13736        %FPT$CLOSE_V (BASED="BASED(FPT$.V_)");
       73    13745        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CTX$)");
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:3    
       74    14484        %KQ_CTLGRAN (FPTN=KQ$CTLGRAN,STCLASS="BASED(CTL$)");
       75    14570        %KQ_DGRAN (FPTN=KQ$DGRAN,STCLASS=BASED);
       76    14717        %KQ_DSB (FPTN=KQ$DSB,STCLASS=BASED);
       77    14760        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS=BASED);
       78    15030        %KQ_STA (FPTN=KQ$STA,STCLASS="BASED(STA$)");
       79    15369        %NK$LDCT (STCLASS="BASED(LDCT$)");
       80    15415        %VLP$SETSTA_V;
       81    15427    1   DCL UBINHALF UBIN(18) BASED ALIGNED;
       82    15428    1   DCL P$ PTR BASED ALIGNED;
       83    15429
       84    15430
       85    15431
       86    15432        /**/
       87    15433        /* PARAMETERS */
       88    15434        %FPT$CLOSE_P (FPTN=FPT$,STCLASS=,PFMT=PTR);
       89    15438
       90    15439
       91    15440
       92    15441        /**/
       93    15442        /* AUTO */
       94    15443        /**/
       95    15444    1   DCL CTX$ PTR;
       96    15445    1   DCL 1 CTX REDEF CTX$,
       97    15446    1         2 DISP UBIN(24) UNAL,
       98    15447    1         2 SID UBIN(12) UNAL;
       99    15448    1   DCL JDCB$ PTR;
      100    15449    1   DCL STA$ PTR;
      101    15450    1   DCL DLDCT$ PTR;
      102    15451    1   DCL LDCT$ PTR;
      103    15452    1   DCL CFU$ PTR;
      104    15453    1   DCL ACTCNT UBIN;
      105    15454    1   DCL AU UBIN;
      106    15455    1   DCL T$ PTR;
      107    15456    1   DCL PG$ PTR;
      108    15457    1   DCL I UBIN;
      109    15458    1   DCL DGRAN$ PTR;
      110    15459    1   DCL USR UBIN(9);
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:4    
      111    15460    1   DCL SIZ SBIN;
      112    15461    1   DCL DA UBIN;
      113    15462    1   DCL DESC# UBIN;
      114    15463    1   DCL PGINDX UBIN;
      115    15464    1   DCL PG UBIN;
      116    15465    1   DCL ENTFLG UBIN;
      117    15466    1   DCL ORG UBIN;
      118    15467    1   DCL CTL$ PTR;
      119    15468        %COMGRP (STCLASS=);
      120    15579
      121    15580
      122    15581
      123    15582        /**/
      124    15583        /* EXTERNAL DATA */
      125    15584        /**/
      126    15585    1   DCL B$CGPT$ PTR SYMREF;
      127    15586    1   DCL B$JIT$ PTR SYMREF;
      128    15587    1   DCL F$CFU$ PTR SYMREF READONLY;
      129    15588    1   DCL FM_FRZERO UBIN SYMREF;
      130    15589    1   DCL S_CUN UBIN SYMREF;
      131    15590        %EL$CGERR (NAME=KQ_ERRLOG_BFR,STCLASS=SYMREF,N=50);
      132    15594
      133    15595
      134    15596
      135    15597        /**/
      136    15598        /* EXTERNAL ROUTINES */
      137    15599        /**/
      138    15600    1   DCL ELA$SYSLOG    ENTRY(6) ALTRET;
      139    15601    1   DCL FGH$UPDBUCKET ENTRY(4);
      140    15602    1   DCL FMB$RIO       ENTRY(9) ALTRET;
      141    15603    1   DCL FMD$FLSHBUF   ENTRY(1);
      142    15604    1   DCL FMD$REDBUF    ENTRY(6) ALTRET;
      143    15605    1   DCL FMP$CLSF      ENTRY(1);
      144    15606    1   DCL KCA$TELLAUM   ENTRY(3) ALTRET;
      145    15607    1   DCL KCA$TELLAUR   ENTRY(3) ALTRET;
      146    15608    1   DCL KCD$PREL      ENTRY(1);
      147    15609    1   DCL KQC$CLOSESTA  ENTRY(1) ALTRET;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:5    
      148    15610    1   DCL KQC$DACTSTA   ENTRY(2) ALTRET;
      149    15611    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
      150    15612    1   DCL KQD$ERRLOG    ENTRY(1) ALTRET;
      151    15613    1   DCL KQD$RELP      ENTRY(3) ALTRET;
      152    15614    1   DCL KQD$REMP      ENTRY(3) ALTRET;
      153    15615    1   DCL KQL$DELMLH    ENTRY(2) ALTRET;
      154    15616    1   DCL KQM$GETBD     ENTRY(3) ALTRET;
      155    15617    1   DCL KQM$RELPF     ENTRY(2) ALTRET;
      156    15618    1   DCL KQM$SHUTDOWN  ENTRY(1) ALTRET;
      157    15619    1   DCL KQP$FDISC     ENTRY(1) ALTRET;
      158    15620    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      159    15621    1   DCL KQR$CLEANUP   ENTRY(1) ALTRET;
      160    15622    1   DCL KQR$CLEANUPB  ENTRY(1) ALTRET;
      161    15623    1   DCL KQT$DELSTA    ENTRY(2) ALTRET;
      162    15624    1   DCL KQT$VALREADS  ENTRY(1) ALTRET;
      163    15625    1   DCL KQU$DELETE    ENTRY(1) ALTRET;
      164    15626    1   DCL KQX$LDASR     ENTRY(1);
      165    15627    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      166    15628    1   DCL NKL$RELDCT    ENTRY(1) ALTRET;
      167    15629    1   DCL SC_BCGDSC     ENTRY    CONV(2,0);
      168    15630    1   DCL SC_CGFWST     ENTRY    CONV(2,0);
      169    15631    1   DCL SC_BCGRBS     ENTRY    CONV(2,0);
      170    15632    1   DCL SC_CGCACHE    ENTRY    CONV(2,0);
      171    15633    1   DCL SSR$REG       ENTRY(3) ALTRET;
      172    15634    1   DCL SSR$RUE       ENTRY(4);
      173    15635    1   DCL SSS$CURTIME   ENTRY(1);
      174    15636    1   DCL UQB$MDEQ      ENTRY(1) ALTRET;
      175    15637    1   DCL UQB$MENQX     ENTRY(1) ALTRET;
      176    15638
      177    15639
      178    15640
      179    15641        /**/
      180    15642        /* EQUS */
      181    15643        /**/
      182    15644        %EQU_CG;
      183    15692
      184    15693
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:6    
      185    15694
      186    15695        /**/
      187    15696        /* CONSTANT */
      188    15697        /**/
      189    15698        %SUB FCG#='1321'O;
      190    15699        %SUB MID#='17'O;
      191    15700        %ERRCODE (NAME=ERRDMY,COD#=0);
      192    15704        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:7    
      193    15705        /*
      194    15706                         DDDD    CCC   BBBB
      195    15707                         D   D  C   C  B   B
      196    15708                         D   D  C      B   B
      197    15709                         D   D  C      BBBB
      198    15710                         D   D  C      B   B
      199    15711                         D   D  C   C  B   B
      200    15712                         DDDD    CCC   BBBB
      201    15713
      202    15714
      203    15715                   CCC   L       OOO    SSS   EEEEE
      204    15716                  C   C  L      O O O  S   S  E
      205    15717                  C      L      O O O  S      E
      206    15718                  C      L      O  OO   SSS   EEEE
      207    15719                  C      L      O   O      S  E
      208    15720                  C   C  L      O   O  S   S  E
      209    15721                   CCC   LLLLL   OOO    SSS   EEEEE
      210    15722
      211    15723        */
      212    15724
      213    15725
      214    15726        /*D* NAME:         KCO$CLCG
      215    15727
      216    15728             CALL:         CALL KCO$CLCG(FPT$);
      217    15729
      218    15730             INPUT:        FPT$ - Pointer to the close FPT
      219    15731
      220    15732             DESCRIPTION:  The ASR is set to point to the comgroup.  An
      221    15733                           enqueue is done to lock out other openers and
      222    15734                           closers.  The station of this user is deactivated.
      223    15735                           Any uncompleted continued writes, outstanding
      224    15736                           reads, and latched reads and writes are cleaned
      225    15737                           up.  The LDCT for this station is released.
      226    15738                           If this is not the last DCB open to the comgroup,
      227    15739                           then the count of the number of DCBs open is
      228    15740                           decremented and KCA$TELLAU is called to tell the
      229    15741                           AU about this close, or, if this is the AU closing,
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:8    
      230    15742                           to change the state of other stations.
      231    15743                           If this is the last DCB, then all other stations
      232    15744                           are disconnected and the comgroup is cleaned up.
      233    15745                           Then the file is closed.
      234    15746        */
      235    15747
      236    15748
      237    15749    1         ENTFLG=0;  /* Close the file too */
      238    15750    1         GOTO COMMON;
      239    15751
      240    15752
      241    15753    1   KCO$CLCGERR: ENTRY;
      242    15754
      243    15755    1         ENTFLG=1;
      244    15756
      245    15757
      246    15758    1   COMMON: ;
      247    15759    1         JDCB$=B$JIT.DCB$;
      248    15760    1         CFU$=F$DCB.CFU$;
      249    15761    1         AU=0;
      250    15762    1         IF FM$CFU.GDA=0 THEN
      251    15763    1          RETURN;  /* Didn't really get it open */
      252    15764    1         CTX.SID=FM$CFU.GDA;
      253    15765    1         CTX.DISP=FM$CFU.LDA;
      254    15766    1         CALL KQX$LDASR(KQ$CG);  /* Map onto comgroup */
      255    15767    1         IF F$DCB.LDCTX=0 THEN
      256    15768    2           DO;
      257    15769    2           LDCT$=ADDR(NIL);
      258    15770    2           STA$=ADDR(NIL);
      259    15771    2           END;
      260    15772    1         ELSE
      261    15773    2           DO;
      262    15774    2           LDCT$=NK$LDCT$(F$DCB.LDCTX);
      263    15775    2           STA$=NK$LDCT.STA$;
      264    15776    2           IF KQ_LOG.DSIO THEN
      265    15777    3             DO;
      266    15778    3             CALL KQZ$LOG (KQ$CG,%KQLOG_DCLS,0,0,0,
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:9    
      267    15779    3             SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
      268    15780    3             SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
      269    15781    3             END;
      270    15782    2           F$DCB.LDCTX=0;  /* Don't come here again */
      271    15783    2           END;
      272    15784        /**/
      273    15785    1         ORG=F$DCB.ORG;    /* Save for later use and stuff DCB.ORG with         */
      274    15786    1         F$DCB.ORG=KQ$CG.GRAN.ORG;  /* appropriate value for file management    */
      275    15787    1         IF STA$~=ADDR(NIL) THEN
      276    15788    1          IF KQ$STA.AU THEN
      277    15789    2            DO;
      278    15790    2            CALL GLOCK;
      279    15791    2            KQ$CG.AUSTA$=ADDR(NIL); /* Synch with KCA$AU */
      280    15792    2            KQ$CG.AU=0;
      281    15793    2            CALL GUNLOCK;
      282    15794                     /*    Leave KQ$STA.AU set
      283    15795                      *    for KQR$RECOVER
      284    15796                      */
      285    15797    2            AU=1;  /* This user was the AU */
      286    15798    2            IF KQ$CG.AUSENDCNT~=0 THEN
      287    15799    2             CALL SSR$REG(%SS_SL,,1); /* Sleep for 1 second */
      288    15800    2            END;
      289    15801        /**/
      290    15802    1         CALL UQB$MENQX(CFU$);
      291    15803    1         F$DCB.ENQF='1'B;
      292    15804        /**/
      293    15805    1         IF STA$=ADDR(NIL) THEN
      294    15806    1          GOTO NOSTA;
      295    15807        /**/
      296    15808    1         IF F$DCB.ASN~=%DEVICE# THEN
      297    15809    1          CALL KQC$DACTSTA (KQ$STA);
      298    15810    1         CALL STALOCK;
      299    15811    1         KQ$STA.DCBCNT=KQ$STA.DCBCNT-1;
      300    15812    1         IF KQ$STA.DCBCNT~=0 THEN
      301    15813    2           DO;
      302    15814    2           CALL STAUNLOCK;
      303    15815    2           LDCT$=ADDR(NIL);
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:10   
      304    15816    2           GOTO NOSTA;
      305    15817    2           END;
      306    15818                     /*    If this is an SUA, we must screech if the
      307    15819                      *    user has anything locked to himself; e.g.
      308    15820                      *    he's the current reader of the queue.
      309    15821                      */
      310    15822    1         IF S_CUN = KQ$STA.MLH.RUSR# THEN CALL SC_BCGRBS;
      311    15823    1         IF S_CUN = KQ$CG.QUEUE.RUSR# THEN CALL SC_BCGRBS;
      312    15824    1         IF S_CUN = KQ$CG.FWUSR# THEN CALL SC_CGFWST;
      313    15825    1         KQ$STA.IDSC='1'B;  /* Set disconnect in progress */
      314    15826    1         CALL STAUNLOCK;
      315    15827        /**/
      316    15828    1         IF AU~=0 THEN
      317    15829    1          CALL KCA$TELLAUR(KQ$STA,%CG_AUDCON#);
      318    15830    1         ELSE
      319    15831    1          CALL KCA$TELLAUR(KQ$STA,%CG_DCLS#);
      320    15832        /**/
      321    15833    1         CALL RELCNNCTUSR;
      322    15834        /**/
      323    15835    1         CALL SLOCK;
      324    15836    1         IF STA$=KQ$CG.DCBHD$ THEN
      325    15837    1          KQ$CG.DCBHD$=KQ$STA.DCBLNK$;
      326    15838    1         ELSE
      327    15839    2           DO;
      328    15840    2           T$=KQ$CG.DCBHD$;
      329    15841    3             DO WHILE(T$->KQ$STA.DCBLNK$~=STA$);
      330    15842    3             T$=T$->KQ$STA.DCBLNK$;
      331    15843    3             END;
      332    15844    2           T$->KQ$STA.DCBLNK$=KQ$STA.DCBLNK$;
      333    15845    2           END;
      334    15846    1         CALL SUNLOCK;
      335    15847        /**/
      336    15848    1         IF ADDR(FPT$)=ADDR(NIL) THEN
      337    15849    1          GOTO CLNB;
      338    15850    1         IF FPT$.V_=ADDR(NIL) THEN GOTO CLNB;
      339    15851    1         IF FPT$CLOSE_V.DISP=%SAVE# THEN
      340    15852    1          CALL KQR$CLEANUP(KQ$STA);
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:11   
      341    15853    1         ELSE
      342    15854    1   CLNB:  CALL KQR$CLEANUPB(KQ$STA);
      343    15855        /**/
      344    15856    1         CALL SLOCK;
      345    15857    1         CALL STALOCK;
      346    15858    1         KQ$STA.LDCT$=ADDR(NIL);
      347    15859    1         KQ$STA.IDSC='0'B;
      348    15860    1         KQ$STA.TOLDAU='0'B;
      349    15861    1         KQ$STA.AU='0'B;
      350    15862    1         IF NOT KQ$CG.AUCTL.SMD THEN
      351    15863    1          IF STA$ ~= KQ$CG.JRNLSTA$ THEN
      352    15864    1           CALL KQL$DELMLH(KQ$CG,ADDR(KQ$STA.MLH));
      353    15865    1         CALL STAUNLOCK;
      354    15866    1         T$=STA$;
      355    15867    1         CALL KQT$DELSTA(KQ$CG,T$);
      356    15868    1         CALL SUNLOCK;
      357    15869    1         CALL KQT$VALREADS (KQ$CG);
      358    15870        /**/
      359    15871    1   NOSTA: ;
      360    15872    1         IF LDCT$~=ADDR(NIL) THEN
      361    15873    1          CALL NKL$RELDCT(LDCT$);
      362    15874        /**/
      363    15875    1         CALL GLOCK;
      364    15876    1         KQ$CG.STATS.NUMDCBS=KQ$CG.STATS.NUMDCBS-1;
      365    15877    1         CALL GUNLOCK;
      366    15878        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:12   
      367    15879
      368    15880    1         IF KQ$CG.STATS.NUMDCBS=0 THEN
      369    15881    2           DO; /* Last DCB is closing */
      370    15882                   /******************************************************
      371    15883                    *                                                    *
      372    15884                    *          SHUT DOWN THE COMGROUP                    *
      373    15885                    *                                                    *
      374    15886                    ******************************************************/
      375    15887
      376    15888    2           FM$CFU.FMOD='1'B;
      377    15889    2           CALL GLOCK;
      378    15890    2           IF NOT KQ$CG.CLOCK THEN
      379    15891    3             DO;
      380    15892    3             KQ$CG.OPEN='0'B;
      381    15893    3             CALL GUNLOCK;
      382    15894    3             GOTO RELPGS;
      383    15895    3             END;
      384    15896    2           KQ$CG.CLOSING='1'B; /* Prevent TERM connects */
      385    15897    2           CALL GUNLOCK;
      386    15898    2           CALL ABORTEM; /* Blow away all terminals */
      387    15899    2           CALL GLOCK;
      388    15900    2           IF KQ$CG.STATS.NUMTERMS~=0 THEN
      389    15901    3             DO;
      390    15902    3             KQ$CG.LASTUSER=S_CUN;
      391    15903    3             CALL GUNLOCK;
      392    15904    3             CALL SSR$REG(%SS_QA);
      393    15905    3             END;
      394    15906    2           ELSE CALL GUNLOCK;
      395    15907                           /* Spin with OPEN, CLOCK, and CLOSING all set
      396    15908                              until the garbage collector has finished. */
      397    15909    3             DO WHILE (KQ$CG.MMD.GIP);
      398    15910    3             CALL SSR$REG (%SS_SL,,1);
      399    15911    3             END;
      400    15912    2           CALL GLOCK;
      401    15913    2           KQ$CG.OPEN='0'B;
      402    15914    2           KQ$CG.CLOSING='0'B;
      403    15915    2           KQ$CG.CLOCK='0'B; /* Disable clock */
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:13   
      404    15916    2           CALL GUNLOCK;
      405    15917                           /* Spin till all I/O is finished */
      406    15918    3             DO WHILE (KQ$CG.IOCNT ~= 0);
      407    15919    3             CALL SSR$REG(%SS_SL,,1); /* Sleep for 1 second */
      408    15920    3             END;
      409    15921        /**/
      410    15922    2           F$DCB.LVL=%KQ_PTYP_CTL;
      411    15923    2           F$DCB.GTYP=FMGTFILE;
      412    15924    2           CALL FMD$REDBUF(CTL$,0,FM_FRZERO) ALTRET(NORCVR);
      413    15925    2           F$DCB.BFR.BUFUP(0)='1'B;
      414    15926    2           KQ$CTLGRAN.PGTBL='0'B;
      415    15927    2           T$=PINCRW(CTL$,KQ$CTLGRAN.CTXX);
      416    15928    2           T$->KQ$CG=KQ$CG;
      417    15929        /**/
      418    15930    2           DA=KQ$CG.HIGRANS+FM_FRZERO;
      419    15931    2           SIZ=KQ$CG.NGAVAL;
      420    15932    2           DESC#=0;
      421    15933    2           PGINDX=0;
      422    15934    3             DO WHILE('1'B);
      423    15935    3   FINDNXTPG:;
      424    15936    3             CALL FINDCGPAGE(KQ$CG.MMD.DSB$->KQ$DSB,DESC#,PGINDX,DGRAN$,PG) ALTRET(
             15936                      ENDRCVR);
      425    15937    3             IF SIZ=0 THEN
      426    15938    4               DO;
      427    15939    4               CALL SC_CGCACHE;
      428    15940    4               GOTO ENDRCVR;
      429    15941    4               END;
      430    15942    3             IF DGRAN$->KQ$DGRAN.HDR.PTYP=0 THEN GOTO FINDNXTPG;
      431    15943    3             IF DGRAN$->KQ$DGRAN.HDR.SELF$~=DGRAN$ THEN
      432    15944    4               DO;
      433    15945    4               CALL SC_CGCACHE;
      434    15946    4               GOTO FINDNXTPG;
      435    15947    4               END;
      436    15948    3             IF DGRAN$->KQ$DGRAN.HDR.PTYP=%KQ_PTYP_DATA
      437    15949    3             AND NOT DGRAN$->KQ$DGRAN.HDR.CHAIN THEN GOTO FINDNXTPG;
      438    15950    3             DGRAN$->KQ$DGRAN.HDR.STAMP.GMOD=DA;
      439    15951    3             DGRAN$->KQ$DGRAN.HDR.GTYP=%KQ_PTYP_RCVR;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:14   
      440    15952    3             CALL FMB$RIO(,PG,4096,DA,%N_WRBIN,1,ENTADDR(NIL),0);
      441    15953    3             KQ$CTLGRAN.PGTBL((DESC#*%CGQ_CHUNK_SIZE)+PGINDX)='1'B;
      442    15954    3             DA=DA+1;
      443    15955    3             SIZ=SIZ-1;
      444    15956    3             KQ$CTLGRAN.RCVRSIZ=KQ$CTLGRAN.RCVRSIZ+1;
      445    15957    3             END;
      446    15958    2   ENDRCVR: ;
      447    15959    2           IF KQ$CTLGRAN.RCVRSIZ~=0 THEN
      448    15960    2            KQ$CTLGRAN.RCVRDA=KQ$CG.HIGRANS+FM_FRZERO;
      449    15961        /**/
      450    15962    2           KQ$CTLGRAN.RCVRTIME=0;
      451    15963    2           COMGRP='0'B;
      452    15964    2           COMGRP.CODE=%AZ$CG;
      453    15965    2           COMGRP.ACCT=F$DCB.ACCT;
      454    15966    2           COMGRP.NAM=F$DCB.NAME;
      455    15967    2           COMGRP.SN=FM$SET.PSN(F$DCB.SETX);
      456    15968    2           COMGRP.STATS=KQ$CG.STATS;
      457    15969    2           I=KQ$CG.PGTIME;
      458    15970    2           CALL SSS$CURTIME(KQ$CG.PGTIME);
      459    15971    2           CALL FGH$UPDBUCKET(COMGRP.STATS.PGSI,KQ$CG.STATS.PGSI,KQ$CG.PGTIME-I,KQ$CG.
             15971                    MMD.CURPG);
      460    15972    2           CALL ELA$SYSLOG(EL_ACCTLG,COMGRP,SIZEW(COMGRP),0,2,I);
      461    15973        /**/
      462    15974    2   NORCVR: ;
      463    15975    2           CALL FMD$FLSHBUF(0);
      464    15976        /**/
      465    15977    2   RELPGS: ;
      466    15978    2           FM$CFU.GDA=0;
      467    15979    2           FM$CFU.LDA=0;
      468    15980        /**/
      469    15981    2           IF KQ$CG.MMD.DSB$~=ADDR(NIL) THEN
      470    15982    3             DO;
      471    15983    3             DESC#=0;
      472    15984    3             PGINDX=0;
      473    15985    4               DO WHILE('1'B);
      474    15986    4               CALL FINDCGPAGE(KQ$CG.MMD.DSB$->KQ$DSB,DESC#,PGINDX,DGRAN$,PG) ALTRET(
             15986                        ENDRELPGS);
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:15   
      475    15987    5               IF ENTFLG=1 AND DGRAN$~=DGRAN$->KQ$DGRAN.HDR.SELF$ THEN DO;
      476    15988                    /* fix SELF$ if we're closing a bad comgroup with a clobbered granule */
      477    15989                      %LOCK (G=KQ_ERRLOG_GATE);
      478    15992    5                 KQ_ERRLOG_BFR.CODE=%KQELOG_KCO_GHDRBAD;
      479    15993    5                 KQ_ERRLOG_BFR.SIZ=1+SIZEW(KQ$DGRAN);
      480    15994    5                 T$=ADDR(KQ_ERRLOG_BFR.INFO);
      481    15995    5                 KQ_ERRLOG_BFR.INFO='0'B;
      482    15996    5                 T$->P$=DGRAN$;
      483    15997    5                 T$=PINCRW(T$,1);
      484    15998    5                 T$->KQ$DGRAN=DGRAN$->KQ$DGRAN;
      485    15999    5                 CALL KQD$ERRLOG (KQ$CG);
      486    16000    5                 DGRAN$->KQ$DGRAN.HDR.SELF$=DGRAN$;
      487    16001    5                 END;
      488    16002    4               CALL KQM$RELPF (KQ$CG,DGRAN$);
      489    16003    4               END;
      490    16004    3             END;
      491    16005        /**/
      492    16006    2   ENDRELPGS: ;
      493    16007    2           CALL KQM$SHUTDOWN(KQ$CG);
      494    16008    2           END; /* Shut down the comgroup */
      495    16009        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:16   
      496    16010        /**/
      497    16011    1         IF F$DCB.ENQF THEN
      498    16012    2           DO;
      499    16013    2           F$DCB.ENQF='0'B;
      500    16014    2           CALL UQB$MDEQ(CFU$);
      501    16015    2           END;
      502    16016    1         F$DCB.ORG=ORG;    /* ...and put it back */
      503    16017        /**/
      504    16018    1         IF F$DCB.SETSTA$~=ADDR(NIL) THEN
      505    16019    1          IF SUBSTR(F$DCB.SETSTA$->VLP$SETSTA_V.MYSTATION,0,1)='&'
      506    16020    1          THEN F$DCB.SETSTA$->VLP$SETSTA_V.MYSTATION=' ';
      507    16021                             /* If we gave him this STATION name then take it away   */
      508    16022                             /* again so that a reopen will not complain about       */
      509    16023                             /* invalid characters in STATION name.                  */
      510    16024        /**/
      511    16025    1         IF ENTFLG=0 THEN
      512    16026    1          CALL FMP$CLSF(FPT$);
      513    16027        /**/
      514    16028    1         RETURN;
      515    16029        /**/
      516    16030        /**/
      517    16031        %SET LISTMAC='1'B;
      518    16032              %KQ_FCGP (MON=YES);
             16033        /**/
             16034    1   FINDCGPAGE: PROC (KQ$DSB,ASNUM,PGNUM,PTR$,PPNO) ALTRET;
             16035        /**/
             16036        %KQ_DSB (FPTN=KQ$DSB,STCLASS="");
             16037         %LSET LISTDIR='0'B;
             16049    2   DCL 1 KQ$DSB DALIGNED,
             16051    2         2 ASR,
             16055    2           3 BOUND UBIN(20) UNAL /*(0)/**/,
             16056    2           3 FLG BIT(9) UNAL /*('110100011'B)/**/,
             16057    2           3 W UBIN(3) UNAL /*(3)/**/,
             16058    2           3 T UBIN(4) UNAL /*(1)/**/,
             16059    2           3 BASE UBIN(36) UNAL /*(0)/**/,
             16060    2         2 CRYPT REDEF ASR,
             16063    2           3 LNK$ PTR,
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:17   
             16066    2           3 * UBIN,
             16067    2         2 DESC (0:25),
             16070    2           3 BOUND UBIN(20) UNAL /*(40959*0)/**/,
             16071    2           3 FLG BIT(9) UNAL /*('110000010'B*0)/**/,
             16072    2           3 FLGR REDEF FLG,
             16073    2             4 * BIT(8) UNAL,
             16074    2             4 PRESENT BIT(1) UNAL,
             16075    2           3 W UBIN(3) UNAL /*(3*0)/**/,
             16076    2           3 T UBIN(4) UNAL /*(0*0)/**/,
             16077    2           3 BASE UBIN(36) UNAL /*(0*0)/**/;
             16079    2   DCL ASNUM UBIN;
             16080    2   DCL PGNUM UBIN;
             16081    2   DCL PTR$ PTR ALIGNED;
             16082    2   DCL 1 PTR$R REDEF PTR$ ALIGNED,
             16083    2         2 PG# UBIN(8) UNAL,
             16084    2         2 GORGO UBIN(16) UNAL,
             16085    2         2 SEGID UBIN(12) UNAL;
             16086    2   DCL PPNO UBIN;
             16087        %IF MON;
             16088        /*M* HF_DATA_R */
             16089        /*M* HF_DATA_D - STATIC DATA FOR FAULT HANDLER AND MEMORY EDAC SCAN */
             16090        /*T***********************************************************/
             16091        /*T*                                                         */
             16092        /*T* Copyright (c) Bull HN Information Systems Inc., 1994    */
             16093        /*T*                                                         */
             16094        /*T***********************************************************/
             16095    2   DCL H_FLTCNT(0:22)SBIN SYMREF;DCL H_CPUGATE BIT(72)SYMREF DALIGNED;DCL 1 H_CNNCTMLBX
             16095            (0:7)SYMREF,2 * BIT(30),2 RELIEF BIT(1),2 CLEAR
             16096    2   BIT(1),2 MAKE BIT(1),2 TIME BIT(1),2 SCR BIT(1),2 PAUSE BIT(1);DCL H_TIME SYMREF
             16096            UBIN;DCL H_XDELTA UBIN SYMREF;DCL H_INTMASK BIT(72)
             16097    2   SYMREF DALIGNED;DCL H_ENMASK BIT(72)DALIGNED SYMREF;DCL H_DSMASK BIT(72)DALIGNED
             16097            SYMREF;DCL 1 H_STOREUNIT(0:15)SYMREF,2 PORT# UBIN
             16098    2   (2)UNAL,2 STORE_UNIT# UBIN(2)UNAL,2 * BIT(8),2 FIRST_ADDR UBIN(24)UNAL;DCL H_MAXSU#
             16098            UBIN WORD SYMREF;DCL H_MEMOK BIT(1)ALIGNED
             16099    2   SYMREF;DCL H_S1000_FLG BIT(1)ALIGNED SYMREF;DCL H_RPM_FLG BIT(1)ALIGNED SYMREF;DCL 1
             16099            H_S1000_CONFIG SYMREF,2 REG(0:35)BIT(1);DCL
             16100    2   H_RLF_GATE BIT(36)ALIGNED SYMREF;DCL H_FAIL_PORT UBIN ALIGNED SYMREF;DCL H_FAIL_NUM
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:18   
             16100            UBIN ALIGNED SYMREF;DCL H_FAIL_PARK BIT(1)
             16101    2   ALIGNED SYMREF;DCL H_RELIEF BIT(1)ALIGNED SYMREF;DCL H_NURSE UBIN ALIGNED SYMREF;DCL
             16101            H_NURSE_PARK BIT(1)ALIGNED SYMREF;DCL 1
             16102    2   H_CPU_CONFIG(0:3)SYMREF,2 PORT_ASSIGN UBIN(3)UNAL,2 PORT_ENABLE BIT(1),2 INITIALIZE
             16102            BIT(1),2 INTERLACE BIT(1),2 SIZE UBIN(3)UNAL;DCL
             16103    2   1 H_SCU_CONFIG(0:3)SYMREF DALIGNED,2 MASK_A BIT(9),2 SIZE UBIN(3)UNAL,2 ON_LINE BIT(
             16103            4),2 PORT# UBIN(4)UNAL,2 * BIT(1),2 MODE BIT(1),
             16104    2   2 NONEXIST_ADDR UBIN(8)UNAL,2 INTERLACE BIT(1),2 LOWER_STORE BIT(1),2
             16104            PORT_MASK_LOWER BIT(4),2 MASK_B BIT(9),2 * BIT(12),2
             16105    2   CYCLIC_PRIORITY BIT(7),2 * BIT(4),2 PORT_MASK_UPPER BIT(4);DCL H_SCU_BF(0:3)UBIN
             16105            WORD SYMREF;DCL H_CPU_BF(0:3)UBIN WORD SYMREF;DCL
             16106    2   H_PORT_FIRST_ADDR(0:3)UBIN WORD SYMREF;DCL H_MAXPORT# SBIN WORD SYMREF;DCL
             16106            H_PORTMASK BIT(72)SYMREF DALIGNED;DCL H_CODE UBIN WORD
             16107    2   SYMREF;DCL H_SYSID UBIN WORD SYMREF;DCL H_MODE UBIN WORD SYMREF;DCL H_PORT# UBIN
             16107            WORD SYMREF;DCL H_SPROC# UBIN WORD SYMREF;DCL
             16108    2   H_SNAP SBIN WORD SYMREF;DCL H_SAVE_SS UBIN WORD SYMREF;DCL H_MAKE_IN_PROGRESS BIT(1)
             16108            SYMREF;DCL H_MIXED_MP SBIN SYMREF READONLY;DCL
             16109    2   H_MIXED_INT(0:6)SBIN SYMREF;DCL H_MIXED_TRO(0:6)SBIN SYMREF;DCL H_MIXED_FLT(0:6)SBIN
             16109            SYMREF;DCL H_MIXED_SSX(0:2)SBIN SYMREF;DCL
             16110    2   H_MIXED_SSS(0:2)SBIN SYMREF;DCL H_MIXED_RMIR(0:2)SBIN SYMREF;DCL H_DUMMY UBIN SYMREF
             16110            ;DCL H_RSW1(0:7)BIT(36)SYMREF ALIGNED;DCL H_RSW2
             16111    2   (0:7)BIT(36)SYMREF ALIGNED;DCL H_HRMODE(0:6)BIT(36)SYMREF READONLY ALIGNED;DCL
             16111            H_HRMODE_MASK(0:6)BIT(36)SYMREF READONLY ALIGNED;DCL
             16112    2   H_LUFREG(0:6)BIT(36)SYMREF ALIGNED;DCL H_LUFREG_MASK(0:6)BIT(36)SYMREF READONLY
             16112            ALIGNED;DCL H_RELOAD_CACHE UBIN WORD SYMREF;DCL
             16113    2   H_RELOAD_MODE UBIN WORD SYMREF;DCL 1 H_CNCTEVX SBIN SYMREF;DCL 1 H_CNCTEVBF(0:15)BIT
             16113            (72)SYMREF DALIGNED;DCL H_CNCTEVGATE BIT(72)
             16114    2   SYMREF DALIGNED;DCL 1 H_EDACHIST(0:63)SYMREF,2 SYND BIT(18),2 CT UBIN(18)UNAL;DCL
             16114            H_EDACUTS(0:63)UBIN WORD SYMREF;DCL H_FLTREG_MASK
             16115    2   (0:6)BIT(36)SYMREF READONLY ALIGNED;DCL H_EXTFLTREG_MASK(0:6)BIT(36)SYMREF READONLY
             16115            ALIGNED;DCL H_FLTREG(0:5)UBIN SYMREF;DCL
             16116    2   H_PERF_DATA(0:63)UBIN BYTE CALIGNED SYMREF READONLY;DCL 1 H_DPS8000_CPU_CONF_REG
             16116            DALIGNED SYMREF,2 * BIT(1),2 PORT_A_ENABLED BIT(1),
             16117    2   2 PORT_B_ENABLED BIT(1),2 PORT_A_INIT BIT(1),2 PORT_B_INIT BIT(1),2 ADDRESS_SPLIT
             16117            UBIN(4)UNAL,2 * BIT(63);DCL 1
             16118    2   H_DPS8000_SCU_CONF_REG DALIGNED SYMREF,2 * BIT(28),2 PORTS(0:7)BIT(1),2 * BIT(36);
             16118            DCL 1 H_DPS8000_SCU_INFO(0:1)SYMREF ALIGNED,2
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:19   
             16119    2   LOWER_BOUND UBIN HALF UNAL,2 UPPER_BOUND UBIN HALF UNAL,2 PAGES UBIN HALF UNAL,2
             16119            SCU_STATUS,3 NOT_CONFIG BIT(1),3 REL_BIT BIT(1),3
             16120    2   REL_IN_PROGRESS BIT(1),3 RET_IN_PROGRESS BIT(1),3 LOW_MEM BIT(1),3 * BIT(13);DCL
             16120            H_DPS8000_CI_TABLE(0:3)UBIN SYMREF;DCL
             16121    2   H_DPS8000_CONFIG_NAME CHAR(12)SYMREF;DCL 1 H_RPM_CONNECT_TABLE DALIGNED SYMREF,2
             16121            ENTRI(0:23)UNAL,3 PORT# UBIN(3)UNAL,3 VALID BIT(1),
             16122    2   3 MBZ BIT(1),3 * BIT(1),3 IMXID UBIN(2)UNAL,3 SYSID UBIN(4)UNAL;DCL H_MAX_PERF UBIN
             16122            WORD SYMREF READONLY;DCL H_PERF(0:7)UBIN WORD
             16123    2   SYMREF;DCL EPU_MASK(0:3)BIT(36)ALIGNED SYMREF;DCL H_TIME_CORR BIT(72)DALIGNED SYMREF
             16123            ;DCL HW_PERF(0:6)UBIN WORD SYMREF READONLY;DCL
             16124    2   HW_PERF_SUB(0:6)UBIN WORD SYMREF READONLY;DCL HW_TYPE UBIN WORD SYMREF;DCL
             16124            HW_PTB_UNITS SBIN WORD SYMREF;DCL HW_IOPTP_UNITS SBIN
             16125    2   WORD SYMREF;DCL HW_WSQ0PT BIT(1)ALIGNED SYMREF;DCL HW_LOAD_FW BIT(1)ALIGNED SYMREF;
             16125            DCL HW_TIME_LEGAL BIT(1)ALIGNED SYMREF;DCL
             16126    2   HW_SECT_PT BIT(1)ALIGNED SYMREF;DCL HW_FRAG_PT BIT(1)ALIGNED SYMREF;DCL HW_IOP BIT(1
             16126            )ALIGNED SYMREF;DCL HW_EXT_STATUS BIT(1)ALIGNED
             16127    2   SYMREF;DCL HW_SMART_CACHE BIT(1)ALIGNED SYMREF;DCL HW_ES BIT(1)ALIGNED SYMREF;DCL
             16127            HW_EI BIT(1)ALIGNED SYMREF;DCL HW_PROG_SCU BIT(1)
             16128    2   ALIGNED SYMREF;DCL HW_EDAC BIT(1)ALIGNED SYMREF;DCL HW_FLTIC_OK BIT(1)ALIGNED SYMREF
             16128            ;DCL HW_NORM_CLOCK BIT(1)ALIGNED SYMREF;DCL
             16129    2   HW_CHANS UBIN WORD ALIGNED SYMREF;DCL HW_IMX BIT(1)ALIGNED SYMREF;
             16130        %ELSE;
             16132        %ENDIF;
             16133    2   DCL B$HALF(0:0) UBIN HALF BASED HALIGNED;
             16134    2   DCL B$IPHYMAP$ PTR SYMREF;
             16135        /**/
             16136    2   DCL K UBIN;
             16137        /**/
             16138    2   LOOP:;
             16139    2       IF PGNUM >= %CGQ_CHUNK_SIZE THEN
             16140    3         DO;
             16141    3   LOOP1:
             16142    3         ASNUM=ASNUM+1;
             16143    3         PGNUM=0;
             16144    3         END;
             16145    2       IF ASNUM > KQM_MDPC# THEN ALTRETURN;
             16146    2       IF NOT KQ$DSB.DESC.FLGR.PRESENT(ASNUM) THEN GOTO LOOP1;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:20   
             16147    2       K=KQ$DSB.DESC.BASE(ASNUM)/4096;
             16148    2       PPNO=B$CGPT$->B$MAP.RPN(K+PGNUM);
             16149    2       IF B$CGPT$->B$MAP.CTRL(K+PGNUM) & '40'O /* CPU PRESENT */ THEN
             16150    3         DO;
             16151        %IF MON;
             16152    3         IF HW_WSQ0PT THEN
             16153              %ELSE;
             16155              %ENDIF;
             16156    3         PPNO=B$IPHYMAP$->B$HALF(PPNO);
             16157    3         PTR$R.PG#=PGNUM;
             16158    3         PTR$R.SEGID=BITBIN(%AS0SID)+ASNUM;
             16159    3         PTR$R.GORGO=0;
             16160    3         PGNUM=PGNUM+1;
             16161    3         RETURN;
             16162    3         END;
             16163    2       PGNUM=PGNUM+1;
             16164    2       GOTO LOOP;
             16165    2   END FINDCGPAGE;
      519    16167        %SET LISTMAC='0'B;
      520    16168        /**/
      521    16169        /**/
      522    16170        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:21   
      523    16171        /*
      524    16172             TTTTT  EEEEE  RRRR   M   M   III   N   N   AAA   L
      525    16173               T    E      R   R  MM MM    I    N   N  A   A  L
      526    16174               T    E      R   R  M M M    I    NN  N  A   A  L
      527    16175               T    EEEE   RRRR   M   M    I    N N N  AAAAA  L
      528    16176               T    E      R R    M   M    I    N  NN  A   A  L
      529    16177               T    E      R  R   M   M    I    N   N  A   A  L
      530    16178               T    EEEEE  R   R  M   M   III   N   N  A   A  LLLLL
      531    16179
      532    16180
      533    16181         DDDD    III    SSS    CCC    OOO   N   N  N   N  EEEEE   CCC   TTTTT
      534    16182         D   D    I    S   S  C   C  O O O  N   N  N   N  E      C   C    T
      535    16183         D   D    I    S      C      O O O  NN  N  NN  N  E      C        T
      536    16184         D   D    I     SSS   C      O  OO  N N N  N N N  EEEE   C        T
      537    16185         D   D    I        S  C      O   O  N  NN  N  NN  E      C        T
      538    16186         D   D    I    S   S  C   C  O   O  N   N  N   N  E      C   C    T
      539    16187         DDDD    III    SSS    CCC    OOO   N   N  N   N  EEEEE   CCC     T
      540    16188
      541    16189        */
      542    16190        /*F* NAME:         KCO$DSCTRM
      543    16191             PURPOSE:      To complete disconnection of a terminal from
      544    16192                           a comgroup. */
      545    16193        /**/
      546    16194
      547    16195        /*D* NAME:         KCO$DSCTRM
      548    16196
      549    16197             CALL:         CALL KCO$DSCTRM(KQ$STA);
      550    16198
      551    16199             INPUT:        STA$ - Pointer to the station to disconnect.
      552    16200
      553    16201                           The current GET and PUT have been cleaned up.
      554    16202                           LOCKCNT in the station block has been set
      555    16203                           to 1 by the disconnect path, and must be
      556    16204                           counted down before we finish.  IDSC is
      557    16205                           set.
      558    16206
      559    16207                           Called from KQP$PUT.
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:22   
      560    16208
      561    16209             DESCRIPTION:  The indicated terminal is disconnected from the
      562    16210                           comgroup.  Messages written to this station are
      563    16211                           deleted and the station block is deleted.  The
      564    16212                           AU is told about the disconnect.  The total number
      565    16213                           terminals connected is decremented by one.
      566    16214        */
      567    16215
      568    16216
      569    16217    1   KCO$DSCTRM: ENTRY(FPT$);
      570    16218        /**/
      571    16219    1         STA$=ADDR(FPT$);
      572    16220    1         CTX$=KQ$STA.CG$;
      573    16221    1         LDCT$=STA$->KQ$STA.LDCT$;
      574    16222    1         GOTO DSC0;
      575    16223        /**/
      576    16224        /*F* NAME:         KCO$DSCTRMGO
      577    16225             PURPOSE:      To continue a terminal disconnect
      578    16226        */
      579    16227        /**/
      580    16228        /*D* NAME:         KCO$DSCTRMGO
      581    16229             CALL:         KCO$DSCTRMGO (KQ$STA)
      582    16230             INPUT:        KQ$STA.DSCREQW is reset, but was set before
      583    16231                           the call
      584    16232             DESCRIPTION:  If the comgroup control parameter DSCREQ is
      585    16233                           set, then terminals, instead of disconnecting
      586    16234                           when they want to, send a disconnect request
      587    16235                           to the AU (%CG_TDRQ), and then wait for him
      588    16236                           to respond with M$DEACTIVATE DSCGO.  Thus
      589    16237                           this routine is called from KCP$PMMES (the
      590    16238                           M$DEACTIVATE receiver), and from KCA$AU
      591    16239                           when the AU disconnects.  While the terminal
      592    16240                           is awaiting permission to disconnect, DSCREQW
      593    16241                           is set in its KQ$STA.
      594    16242                           DSCREQW only occurs for the RESCOD=NK_CGTRM
      595    16243                           LDCTs of regular or FPRG terminal stations
      596    16244                           therefore we must find the correct LDCT first. */
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:23   
      597    16245    1   KCO$DSCTRMGO: ENTRY (FPT$);
      598    16246        /**/
      599    16247    1         STA$=ADDR(FPT$);
      600    16248    1         CTX$=KQ$STA.CG$;
      601    16249    1         IF KQ$STA.SAVLDCT$=ADDR(NIL)
      602    16250    1         THEN LDCT$=STA$->KQ$STA.LDCT$;
      603    16251    1         ELSE LDCT$=STA$->KQ$STA.SAVLDCT$;
      604    16252    1         GOTO DSC1;
      605    16253        /**/
      606    16254    2   DSC0: IF KQ$STA.SAVLDCT$=ADDR(NIL) THEN DO;
      607    16255    2   DSC2:   IF KQ$STA.CNNCTDDA ~= 0 THEN
      608    16256    2            CALL RELCNNCT ALTRET(GETOUT);
      609    16257        /**/
      610    16258    2   DSC1:   CALL TELLAU ALTRET(GETOUT);
      611    16259    2           END;
      612    16260    1         IF KQ_LOG.TSIO THEN
      613    16261    2           DO;
      614    16262    2           I=KQ$STA.LOCKCNT;
      615    16263    2           CALL KQZ$LOG (KQ$CG,%KQLOG_TDDN,0,I,0,
      616    16264    2           SUBSTR(KQ$STA.BTN.KEY,0,4),
      617    16265    2           SUBSTR(KQ$STA.BTN.KEY,4,4));
      618    16266    2           END;
      619    16267    1         CALL SLOCK;
      620    16268    1         CALL STALOCK;
      621    16269    2         IF LDCT$=KQ$STA.LDCT$ THEN DO;
      622    16270    2           KQ$STA.LDCT$=ADDR(NIL);
      623    16271    2           LDCT$->NK$LDCT.STA$=ADDR(NIL);
      624    16272    2           KQ$STA.IDSC='0'B;
      625    16273    3           IF KQ$STA.SAVLDCT$=ADDR(NIL) THEN DO;
      626    16274    3             KQ$STA.LOCKCNT=KQ$STA.LOCKCNT-1;
      627    16275    3             IF NOT KQ$CG.AUCTL.SMD THEN
      628    16276    3              CALL KQL$DELMLH(KQ$CG,ADDR(KQ$STA.MLH));
      629    16277    3             CALL STAUNLOCK;
      630    16278    3             T$=STA$;
      631    16279    3             CALL KQT$DELSTA(KQ$CG,T$);
      632    16280    3             CALL SUNLOCK;
      633    16281    3             CALL KQT$VALREADS (KQ$CG);
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:24   
      634    16282    3             CALL KCD$PREL (LDCT$->NK$LDCT);
      635    16283    3             CALL TRMGONE;
      636    16284    3             END;
      637    16285    3           ELSE DO;
      638    16286    3             KQ$STA.LDCT$=KQ$STA.SAVLDCT$;
      639    16287    3             KQ$STA.SAVLDCT$=ADDR(NIL);
      640    16288    4             IF KQ$STA.SAVIDSC THEN DO;
      641    16289    4               KQ$STA.IDSC='1'B;
      642    16290    4               KQ$STA.SAVIDSC='0'B;
      643    16291                       /* Don't count down LOCKCNT since we will soon be back        */
      644    16292                       /* through here again as the KQ$STA.LDCT$ path and will       */
      645    16293                       /* count it down then.                                        */
      646    16294    4               END;
      647    16295    3             ELSE KQ$STA.LOCKCNT=KQ$STA.LOCKCNT-1;
      648    16296    3             CALL STAUNLOCK;
      649    16297    3             CALL SUNLOCK;
      650    16298    3             CALL KCD$PREL(LDCT$->NK$LDCT);
      651    16299    3             END;
      652    16300    2           END;
      653    16301    2         ELSE DO; /* LDCT$=KQ$STA.SAVLDCT$ */
      654    16302    2           KQ$STA.SAVLDCT$=ADDR(NIL);
      655    16303    2           LDCT$->NK$LDCT.STA$=ADDR(NIL);
      656    16304    2           KQ$STA.SAVIDSC='0'B;
      657    16305    2           CALL STAUNLOCK;
      658    16306    2           CALL SUNLOCK;
      659    16307    2           CALL KCD$PREL(LDCT$->NK$LDCT);
      660    16308    2           END;
      661    16309    1   GETOUT:;
      662    16310    1         RETURN;
      663    16311        /**/
      664    16312        /*F* NAME:         KCO$TRMGONE
      665    16313             PURPOSE:      To process a terminal station's departure from
      666    16314                           its comgroup
      667    16315             DESCRIPTION:  NUMTERMS is counted down.  If it hits zero, then
      668    16316                           if the last DCB user is waiting to close, we
      669    16317                           unblock him. */
      670    16318    1   KCO$TRMGONE: ENTRY (FPT$);
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:25   
      671    16319        /**/
      672    16320    1         CTX$=ADDR(FPT$);
      673    16321    1         CALL TRMGONE;
      674    16322    1         RETURN;
      675    16323        /**/
      676    16324    1   TRMGONE: PROC;
      677    16325        /**/
      678    16326    2         CALL GLOCK;
      679    16327    2         KQ$CG.STATS.NUMTERMS=KQ$CG.STATS.NUMTERMS-1;
      680    16328    2         IF KQ$CG.STATS.NUMTERMS=0 AND KQ$CG.LASTUSER~=0 THEN
      681    16329    3           DO;
      682    16330    3           USR=KQ$CG.LASTUSER;
      683    16331    3           KQ$CG.LASTUSER=0;
      684    16332    3           CALL GUNLOCK;
      685    16333    3           CALL SSR$RUE(%SS_UQA,USR);
      686    16334    3           END;
      687    16335    2         ELSE
      688    16336    2          CALL GUNLOCK;
      689    16337    2         RETURN;
      690    16338    2   END TRMGONE;
      691    16339        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:26   
      692    16340        /**/
      693    16341        /*F* NAME:         KCO$DDISC
      694    16342             PURPOSE:      To continue delayed terminal disconnect
      695    16343        */
      696    16344        /**/
      697    16345        /*D* NAME:         KCO$DDISC
      698    16346             CALL:         KCO$DDISC (KQ$STA);
      699    16347             DESCRIPTION:  If terminal disconnect must be delayed for
      700    16348                           any reason, KQ$STA.DDISC is set, and this
      701    16349                           routine is called later from KCC$CLOCK.
      702    16350                           Since we only ever call TELLAU and RELCNNCT
      703    16351                           for the RESCOD=NK_CGTRM LDCT, we must first
      704    16352                           find it before continuing as it may be either
      705    16353                           KQ$STA.LDCT$ or KQ$STA.SAVLDCT$.
      706    16354        */
      707    16355    1   KCO$DDISC: ENTRY (FPT$);
      708    16356        /**/
      709    16357    1         STA$=ADDR(FPT$);
      710    16358    1         CTX$=KQ$STA.CG$;
      711    16359    1         IF KQ$STA.SAVLDCT$=ADDR(NIL)
      712    16360    1         THEN LDCT$=KQ$STA.LDCT$;
      713    16361    1         ELSE LDCT$=KQ$STA.SAVLDCT$;
      714    16362    2           DO CASE (KQ$STA.DDISC);
      715    16363
      716    16364    2             CASE (1);
      717    16365    2               GOTO DSC1;
      718    16366    2             CASE (2);
      719    16367    2               GOTO DSC2;
      720    16368    2           END;
      721    16369    1         RETURN;
      722    16370        /**/
      723    16371        /*F* NAME:         KCO$RCNNCT
      724    16372             PURPOSE:      To release a station's connect info
      725    16373        */
      726    16374        /**/
      727    16375        /*D* NAME:         KCO$RCNNCT
      728    16376             CALL:         KCO$RCNNCT (KQ$STA)
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:27   
      729    16377             ENVIRONMENT:  User
      730    16378             DESCRIPTION:  The station can be either TERM or DCB, but
      731    16379                           we must be running on behalf of a user.
      732    16380                           The connect info is released from the data cache.
      733    16381        */
      734    16382    1   KCO$RCNNCT: ENTRY (FPT$);
      735    16383        /**/
      736    16384    1         STA$=ADDR(FPT$);
      737    16385    1         CTX$=KQ$STA.CG$;
      738    16386    1         CALL RELCNNCTUSR;
      739    16387    1         RETURN;
      740    16388        /**/
      741    16389        /*F* NAME:         KCO$ABORTEM
      742    16390             PURPOSE:      To blow away all stations on a comgroup
      743    16391        */
      744    16392        /**/
      745    16393        /*D* NAME:         KCO$ABORTEM
      746    16394             CALL:         KCO$ABORTEM (KQ$CG)
      747    16395             ENVIRONMENT:  Must be on master CPU (since we call KQC$CLOSESTA
      748    16396                           which calls KCD$RELTRM).
      749    16397             DESCRIPTION:  See ABORTEM
      750    16398        */
      751    16399    1   KCO$ABORTEM: ENTRY (FPT$);
      752    16400        /**/
      753    16401    1         CTX$=ADDR(FPT$);
      754    16402    1         CALL ABORTEM;
      755    16403    1         RETURN;
      756    16404        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:28   
      757    16405        /**/
      758    16406        /******************************************************************************
      759    16407        *                                                                             *
      760    16408        *  SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS  *
      761    16409        * S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S *
      762    16410        * S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S     *
      763    16411        *  SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS  *
      764    16412        *     S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S *
      765    16413        * S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S *
      766    16414        *  SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS  *
      767    16415        *                                                                             *
      768    16416        ******************************************************************************/
      769    16417
      770    16418        /****************************************************************
      771    16419        *****************************************************************/
      772    16420        /*D* NAME:         SLOCK, SUNLOCK, STALOCK, STAUNLOCK, GLOCK, GUNLOCK
      773    16421             PURPOSE:      To lock/unlock various gates. */
      774    16422    1   SLOCK: PROC;
      775    16423        /**/
      776    16424        %LOCK (G=KQ$CG.STREE.GATE);
      777    16427    2         RETURN;
      778    16428    2   SUNLOCK: ENTRY;
      779    16429        /**/
      780    16430              %UNLOCK (G=KQ$CG.STREE.GATE);
      781    16433    2         RETURN;
      782    16434    2   STALOCK: ENTRY;
      783    16435        /**/
      784    16436              %LOCK (G=KQ$STA.GATE);
      785    16439    2         RETURN;
      786    16440    2   STAUNLOCK: ENTRY;
      787    16441        /**/
      788    16442              %UNLOCK (G=KQ$STA.GATE);
      789    16445    2         RETURN;
      790    16446    2   GLOCK: ENTRY;
      791    16447        /**/
      792    16448              %LOCK (G=KQ$CG.GATE.CG);
      793    16451    2         RETURN;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:29   
      794    16452    2   GUNLOCK: ENTRY;
      795    16453        /**/
      796    16454              %UNLOCK (G=KQ$CG.GATE.CG);
      797    16457    2         RETURN;
      798    16458    2   END SLOCK;
      799    16459        /****************************************************************
      800    16460        *****************************************************************/
      801    16461        /*D* NAME:         TELLAU
      802    16462             PURPOSE:      To tell the AU about a terminal disconnect
      803    16463             DESCRIPTION:  Just returns if we never managed to tell the
      804    16464                           AU about the terminal connect yet.  Else
      805    16465                           gets an MBLK.  If this works, we're ready to
      806    16466                           tell the AU.
      807    16467
      808    16468                           What we tell him depends on the comgroup
      809    16469                           control param DSCREQ.  If it's on, then the
      810    16470                           first time thru here we report CG_TDRQ and
      811    16471                           ALTRET (which halts the disconnect until
      812    16472                           we're entered at KCO$DSCTRMGO) after setting
      813    16473                           a flag to indicate TDRQ already reported.
      814    16474                           Next time thru, or if DSCREQ is off, we
      815    16475                           report CG_TDSC (true disconnect) and RETURN
      816    16476                           to continue disconnecting.
      817    16477
      818    16478                           If no MBLK can be obtained, then we post a delayed
      819    16479                           memory request on behalf of the station, and
      820    16480                           ALTRET, setting KQ$STA.DDISC to 1 and
      821    16481                           KQ$CG.DELAY.DDISC.  This will cause KCO$DDISC
      822    16482                           to be called once per second, and when it is
      823    16483                           we'll come back here to check the status of
      824    16484                           our delayed memory request.  If it has failed
      825    16485                           then the garbage collector has already run
      826    16486                           and so there's no hope so we just return.
      827    16487        */
      828    16488    1   TELLAU: PROC ALTRET;
      829    16489        /**/
      830    16490    2   DCL CODE UBIN;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:30   
      831    16491    2   DCL J SBIN;
      832    16492        /**/
      833    16493    2         IF NOT KQ$STA.TOLDAU THEN RETURN;
      834    16494        /**/
      835    16495    2         J=KQ$STA.MREQ;
      836    16496    2         IF J > 0 THEN
      837    16497    3           DO;
      838    16498    3           IF J ~= KQMR_MBLK# THEN CALL SC_BCGDSC;
      839    16499        /*S* SCREECH_CODE: KCO-S$BCGDSC
      840    16500             TYPE:         SCREECH
      841    16501             MESSAGE:      COMGROUP terminal disconnect error
      842    16502             REMARKS:      An inconsistency has been found when attempting
      843    16503                           to disconnect a terminal. */
      844    16504    3           IF KQ$STA.DDISC ~= 1 THEN CALL SC_BCGDSC;
      845    16505    3           ALTRETURN;
      846    16506    3           END;
      847    16507    2         ELSE IF J < 0 THEN
      848    16508    3            DO;
      849    16509    3            IF KQ$STA.DDISC ~= 1
      850    16510    3            OR J ~= -KQMR_MBLK# THEN CALL SC_BCGDSC;
      851    16511    3            CALL STALOCK;
      852    16512    3            T$=KQ$STA.MREQ$;
      853    16513    3            KQ$STA.MREQ$=ADDR(NIL);
      854    16514    3            KQ$STA.DDISC=0;
      855    16515    3            CALL STAUNLOCK;
      856    16516    3            IF T$ = ADDR(NIL) THEN GOTO TELLDONE;
      857    16517    3            END;
      858    16518    2          ELSE
      859    16519    3            DO;
      860    16520    3            IF KQ$STA.DDISC = 1 THEN CALL SC_BCGDSC;
      861    16521    3            J=KQMR_MBLK#;
      862    16522    3            T$=STA$;
      863    16523    3            CALL KQM$GETBD (KQ$CG,T$,J) ALTRET(NOM);
      864    16524    3            END;
      865    16525    2         CALL STALOCK;
      866    16526    2         CALL GLOCK;
      867    16527    2         KQ$STA.MBLK$=T$;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:31   
      868    16528    2         CODE=%CG_TDSC#;
      869    16529    2         IF KQ$STA.LDCT$->NK$LDCT.DFLG.SYMBIONT THEN
      870    16530    2          CODE=%CG_STDSC#;
      871    16531    2         IF KQ$STA.DSCREQW THEN CALL SC_BCGDSC;
      872    16532    2         IF  KQ$CG.AUCTL.DSCREQ
      873    16533    2         AND KQ$CG.AUSTA$ ~= ADDR(NIL) THEN
      874    16534    2          IF NOT KQ$STA.DSCREQS THEN
      875    16535    3            DO;
      876    16536    3            KQ$STA.DSCREQS='1'B;
      877    16537    3            KQ$STA.DSCREQW='1'B;
      878    16538    3            CODE=%CG_TDRQ#;
      879    16539    3            END;
      880    16540    2         CALL GUNLOCK;
      881    16541    2         CALL STAUNLOCK;
      882    16542    2         CALL KCA$TELLAUM (KQ$STA,CODE);
      883    16543    2         IF CODE = %CG_TDRQ# THEN ALTRETURN;
      884    16544    2   TELLDONE: ;
      885    16545    2         KQ$STA.TOLDAU='0'B;
      886    16546    2         RETURN;
      887    16547    2   NOM:  CALL STALOCK;
      888    16548    2         KQ$STA.DDISC=1;   /* No MBLK available to tell AU with                 */
      889    16549    2         CALL STAUNLOCK;
      890    16550    2   DX:   CALL GLOCK;
      891    16551    2         KQ$CG.DELAY.DDISC='1'B;
      892    16552    2         CALL GUNLOCK;
      893    16553    2         ALTRETURN;
      894    16554        /**/
      895    16555        /*D* NAME:         RELCNNCT
      896    16556             PURPOSE:      To get rid of a terminal's connect info
      897    16557             DESCRIPTION:  Deletes the connect info.  If this works,
      898    16558                           RETURNs.  Else (failed due to lack of defer
      899    16559                           blocks), sets DDISC = 2 in the KQ$STA,
      900    16560                           and DDISC in KQ$CG.DELAY and ALTRETs (KCO$DDISC
      901    16561                           will be called back later from KCC$CLOCK).
      902    16562        */
      903    16563    2   RELCNNCT: ENTRY ALTRET;
      904    16564        /**/
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:32   
      905    16565    2         I=ADDR(KQ$STA.BTN.KEY)->UBINHALF;
      906    16566    2         DA=KQ$STA.CNNCTDDA;
      907    16567    2         CALL KQD$DELDDA (KQ$CG,I,DA) ALTRET(NOD);
      908    16568    2   D0:   KQ$STA.CNNCTDDA=0;
      909    16569    2         CALL STALOCK;
      910    16570    2         KQ$STA.DDISC=0;
      911    16571    2         CALL STAUNLOCK;
      912    16572    2         RETURN;
      913    16573    2   NOD:  IF DA ~= %KQDE_NDFRBLK THEN GOTO D0;
      914    16574    2         CALL STALOCK;
      915    16575    2         KQ$STA.DDISC=2;   /* No DFRBLK to RELCNNCT with                        */
      916    16576    2         CALL STAUNLOCK;
      917    16577    2         GOTO DX;
      918    16578    2   END TELLAU;
      919    16579        /****************************************************************
      920    16580        *****************************************************************/
      921    16581        /*D* NAME:         RELCNNCTUSR
      922    16582             PURPOSE:      To release a station's connect info while
      923    16583                           running on behalf of a user.
      924    16584             DESCRIPTION:  User needed 'cause we REG if no defer
      925    16585                           blocks are available.
      926    16586        */
      927    16587    1   RELCNNCTUSR: PROC;
      928    16588        /**/
      929    16589    2         IF KQ$STA.CNNCTDDA~=0 THEN
      930    16590    3           DO;
      931    16591    3   CNNCT0: DA=KQ$STA.CNNCTDDA;
      932    16592    3           I=ADDR(KQ$STA.BTN.KEY)->UBINHALF;
      933    16593    3           CALL KQD$DELDDA(KQ$CG,I,DA) ALTRET(CNNCT1);
      934    16594    3           GOTO CNNCT2;
      935    16595    3   CNNCT1: IF DA = %KQDE_NDFRBLK THEN
      936    16596    4             DO;
      937    16597    4             CALL SSR$REG (%SS_SL,,1);
      938    16598    4             GOTO CNNCT0;
      939    16599    4             END;
      940    16600    3   CNNCT2: KQ$STA.CNNCTDDA=0;
      941    16601    3           END;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:33   
      942    16602    2         RETURN;
      943    16603    2   END RELCNNCTUSR;
      944    16604        /****************************************************************
      945    16605        *****************************************************************/
      946    16606        /*D* NAME:         ABORTEM
      947    16607             PURPOSE:      To get rid of all stations on the comgroup
      948    16608             DESCRIPTION:  For all stations, call KQC$CLOSESTA. This
      949    16609                           will deactivate a DCB station, and put
      950    16610                           a terminal station in limbo. */
      951    16611    1   ABORTEM: PROC;
      952    16612        /**/
      953    16613    2         CALL SLOCK;
      954    16614    2   DSCLOOP:;
      955    16615    2         ACTCNT=KQ$CG.STREE.ACTCNT;
      956    16616    2         STA$=KQ$CG.STREE.HEAD$;
      957    16617    3           DO WHILE(STA$~=ADDR(NIL));
      958    16618    3           CALL STALOCK;
      959    16619    3           KQ$STA.LOCKCNT=KQ$STA.LOCKCNT+1;
      960    16620    3           CALL STAUNLOCK;
      961    16621    3           CALL SUNLOCK;
      962    16622    3           CALL KQC$CLOSESTA(KQ$STA);
      963    16623    3           CALL KQP$UNLOCK(KQ$STA); /* Decr lockcnt */
      964    16624    3           CALL SLOCK;
      965    16625    3           IF ACTCNT~=KQ$CG.STREE.ACTCNT THEN
      966    16626    3            GOTO DSCLOOP;
      967    16627    3           STA$=KQ$STA.BTN.FLINK$;
      968    16628    3           END;
      969    16629    2         CALL SUNLOCK;
      970    16630    2         RETURN;
      971    16631    2   END ABORTEM;
      972    16632    1   END KCO$CLCG;
      973    16633        %EOD;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:34   
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  is referenced.
   KQM_MAC_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F_CP6.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   AZ_SUBS_C.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   AZ_MACRO_C.:E05TOU  is referenced.
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:35   
      No diagnostics issued in procedure KCO$CLCG.

   Procedure KCO$CLCG requires 1326 words for executable code.
   Procedure KCO$CLCG requires 78 words of local(AUTO) storage.

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:36   

 Object Unit name= KCO$CLCG                                   File name= KCO$CLCG.:E05TOU
 UTS= JUL 30 '97 00:16:02.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  KCO$CLCG
    1   Proc  even  none  1326   2456  KCO$CLCG
    2  RoData even  none    41     51  KCO$CLCG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KCO$CLCG
     1      4                  yes      Std        0  KCO$CLCGERR
     1   1365                  yes      Std        1  KCO$DSCTRM
     1   1377                  yes      Std        1  KCO$DSCTRMGO
     1   1623                  yes      Std        1  KCO$TRMGONE
     1   1672                  yes      Std        1  KCO$DDISC
     1   1724                  yes      Std        1  KCO$RCNNCT
     1   1736                  yes      Std        1  KCO$ABORTEM
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:37   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KQX$LDASR
 yes     yes           Std       8 KQZ$LOG
 yes     yes           Std       3 SSR$REG
         yes           Std       1 FMP$CLSF
 yes     yes           Std       1 KQR$CLEANUPB
 yes     yes           Std       2 KQT$DELSTA
 yes     yes           Std       2 KQL$DELMLH
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       2 KQM$RELPF
 yes     yes           Std       1 KQD$ERRLOG
 yes     yes           Std       6 ELA$SYSLOG
 yes     yes           Std       1 UQB$MDEQ
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       3 KCA$TELLAUR
         yes           Std       4 FGH$UPDBUCKET
 yes     yes           Std       1 KQM$SHUTDOWN
 yes     yes           Std       1 KQR$CLEANUP
 yes     yes           Std       9 FMB$RIO
 yes     yes           Std       2 KQC$DACTSTA
         yes           Std       1 HFC$LOCK
 yes     yes           Std       1 KQT$VALREADS
         yes           Std       1 KCD$PREL
 yes     yes           Std       1 NKL$RELDCT
 yes     yes           Std       6 FMD$REDBUF
         yes           Std       1 SSS$CURTIME
         yes           Std       4 SSR$RUE
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 KQD$DELDDA
 yes     yes           Std       3 KQM$GETBD
 yes     yes           Std       3 KCA$TELLAUM
 yes     yes           Std       1 KQC$CLOSESTA
 yes     yes           Std       1 KQP$UNLOCK
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:38   
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_CGFWST                             SC_CGCACHE                            SC_BCGRBS
     SC_BCGDSC                             KQ_LOG                                KQ_ERRLOG_GATE
     N$DCT$$                               B$CGPT$                               B$JIT$
r    F$CFU$                                FM_FRZERO                             S_CUN
     KQ_ERRLOG_BFR                         HW_WSQ0PT                             B$IPHYMAP$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:39   


        1        1        /*M* KCO-CLCG - Close routines for COMGROUPS */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 8        ,IAD=0,PRB */
        9        9        /**/
       10       10        /*P* NAME:           KCO$CLCG
       11       11
       12       12             PURPOSE:        To provide close service for COMGROUPS.
       13       13
       14       14        */
       15       15
       16       16
       17       17        /*F* NAME:         KCO$CLCG
       18       18             PURPOSE:      Disconnect a station from a comgroup.
       19       19
       20       20        */
       21       21
       22       22
       23       23
       24       24        KCO$CLCG: PROC(FPT$);

     24  1 000000   000000 700200 xent  KCO$CLCG     TSX0  ! X66_AUTO_1
         1 000001   000116 000001                    ZERO    78,1

       25       25
       26       26
       27       27
       28       28        /**/
       29       29        /* INCLUDES */
       30       30        /**/
       31       31        %INCLUDE AZ_MACRO_C;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:40   
       32     2618        %INCLUDE AZ_SUBS_C;
       33     2687        %INCLUDE B_STRINGS_C;
       34     2816        %INCLUDE B_SEGIDS_C;
       35     3355        %INCLUDE B$MAP;
       36     3454        %INCLUDE CP_6_SUBS;
       37     3994        %INCLUDE EL$TABLES;
       38     4317        %INCLUDE EL_SUBS_C;
       39     4401        %INCLUDE F$CP6P_C;
       40     4412        %INCLUDE F$CP6V_C;
       41     4638        %MACRO F$DCB#(BASED=BASED);
       42     4639        %INCLUDE F$DCB;
       43     4688        %MEND;
       44     4689        %INCLUDE F$JIT_C;
       45     5119        %INCLUDE FM$MACROS;
       46     5494        %INCLUDE F_CP6;
       47     6519        %INCLUDE HF_LOCK_C;
       48     6533        %INCLUDE KC$CGBLK;
       49     6581        %INCLUDE KC$CP6V_C;
       50     6701        %INCLUDE KC_CP6;
       51     7261        %INCLUDE KI_CP6;
       52     8357        %INCLUDE KQ_MAC_C;
       53    10907        %INCLUDE KQM_MAC_C;
       54    11280        %INCLUDE KQ_DATA_R;
       55    12112        %INCLUDE KQ_SUBS_C;
       56    12412        %INCLUDE K_DATA_R;
       57    13123        %INCLUDE M_INFO_C;
       58    13263        %INCLUDE NK$LDCT;
       59    13365        %INCLUDE NK_LDCT_R;
       60    13374        %INCLUDE N_FC_C;
       61    13411        %INCLUDE NK_SUBS;
       62    13436        %INCLUDE SS_SCHED_C;
       63    13669
       64    13670
       65    13671
       66    13672        /**/
       67    13673        /* BASED STRUCTURES */
       68    13674        /**/
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:41   
       69    13675        %F$DCB# (BASED="BASED(JDCB$)");
       70    13725        %FM$CFU (BASED="BASED(CFU$)");
       71    13731        %FM$SET (BASED="BASED(F$CFU$)");
       72    13736        %FPT$CLOSE_V (BASED="BASED(FPT$.V_)");
       73    13745        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CTX$)");
       74    14484        %KQ_CTLGRAN (FPTN=KQ$CTLGRAN,STCLASS="BASED(CTL$)");
       75    14570        %KQ_DGRAN (FPTN=KQ$DGRAN,STCLASS=BASED);
       76    14717        %KQ_DSB (FPTN=KQ$DSB,STCLASS=BASED);
       77    14760        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS=BASED);
       78    15030        %KQ_STA (FPTN=KQ$STA,STCLASS="BASED(STA$)");
       79    15369        %NK$LDCT (STCLASS="BASED(LDCT$)");
       80    15415        %VLP$SETSTA_V;
       81    15427    1   DCL UBINHALF UBIN(18) BASED ALIGNED;
       82    15428    1   DCL P$ PTR BASED ALIGNED;
       83    15429
       84    15430
       85    15431
       86    15432        /**/
       87    15433        /* PARAMETERS */
       88    15434        %FPT$CLOSE_P (FPTN=FPT$,STCLASS=,PFMT=PTR);
       89    15438
       90    15439
       91    15440
       92    15441        /**/
       93    15442        /* AUTO */
       94    15443        /**/
       95    15444    1   DCL CTX$ PTR;
       96    15445    1   DCL 1 CTX REDEF CTX$,
       97    15446    1         2 DISP UBIN(24) UNAL,
       98    15447    1         2 SID UBIN(12) UNAL;
       99    15448    1   DCL JDCB$ PTR;
      100    15449    1   DCL STA$ PTR;
      101    15450    1   DCL DLDCT$ PTR;
      102    15451    1   DCL LDCT$ PTR;
      103    15452    1   DCL CFU$ PTR;
      104    15453    1   DCL ACTCNT UBIN;
      105    15454    1   DCL AU UBIN;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:42   
      106    15455    1   DCL T$ PTR;
      107    15456    1   DCL PG$ PTR;
      108    15457    1   DCL I UBIN;
      109    15458    1   DCL DGRAN$ PTR;
      110    15459    1   DCL USR UBIN(9);
      111    15460    1   DCL SIZ SBIN;
      112    15461    1   DCL DA UBIN;
      113    15462    1   DCL DESC# UBIN;
      114    15463    1   DCL PGINDX UBIN;
      115    15464    1   DCL PG UBIN;
      116    15465    1   DCL ENTFLG UBIN;
      117    15466    1   DCL ORG UBIN;
      118    15467    1   DCL CTL$ PTR;
      119    15468        %COMGRP (STCLASS=);
      120    15579
      121    15580
      122    15581
      123    15582        /**/
      124    15583        /* EXTERNAL DATA */
      125    15584        /**/
      126    15585    1   DCL B$CGPT$ PTR SYMREF;
      127    15586    1   DCL B$JIT$ PTR SYMREF;
      128    15587    1   DCL F$CFU$ PTR SYMREF READONLY;
      129    15588    1   DCL FM_FRZERO UBIN SYMREF;
      130    15589    1   DCL S_CUN UBIN SYMREF;
      131    15590        %EL$CGERR (NAME=KQ_ERRLOG_BFR,STCLASS=SYMREF,N=50);
      132    15594
      133    15595
      134    15596
      135    15597        /**/
      136    15598        /* EXTERNAL ROUTINES */
      137    15599        /**/
      138    15600    1   DCL ELA$SYSLOG    ENTRY(6) ALTRET;
      139    15601    1   DCL FGH$UPDBUCKET ENTRY(4);
      140    15602    1   DCL FMB$RIO       ENTRY(9) ALTRET;
      141    15603    1   DCL FMD$FLSHBUF   ENTRY(1);
      142    15604    1   DCL FMD$REDBUF    ENTRY(6) ALTRET;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:43   
      143    15605    1   DCL FMP$CLSF      ENTRY(1);
      144    15606    1   DCL KCA$TELLAUM   ENTRY(3) ALTRET;
      145    15607    1   DCL KCA$TELLAUR   ENTRY(3) ALTRET;
      146    15608    1   DCL KCD$PREL      ENTRY(1);
      147    15609    1   DCL KQC$CLOSESTA  ENTRY(1) ALTRET;
      148    15610    1   DCL KQC$DACTSTA   ENTRY(2) ALTRET;
      149    15611    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
      150    15612    1   DCL KQD$ERRLOG    ENTRY(1) ALTRET;
      151    15613    1   DCL KQD$RELP      ENTRY(3) ALTRET;
      152    15614    1   DCL KQD$REMP      ENTRY(3) ALTRET;
      153    15615    1   DCL KQL$DELMLH    ENTRY(2) ALTRET;
      154    15616    1   DCL KQM$GETBD     ENTRY(3) ALTRET;
      155    15617    1   DCL KQM$RELPF     ENTRY(2) ALTRET;
      156    15618    1   DCL KQM$SHUTDOWN  ENTRY(1) ALTRET;
      157    15619    1   DCL KQP$FDISC     ENTRY(1) ALTRET;
      158    15620    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      159    15621    1   DCL KQR$CLEANUP   ENTRY(1) ALTRET;
      160    15622    1   DCL KQR$CLEANUPB  ENTRY(1) ALTRET;
      161    15623    1   DCL KQT$DELSTA    ENTRY(2) ALTRET;
      162    15624    1   DCL KQT$VALREADS  ENTRY(1) ALTRET;
      163    15625    1   DCL KQU$DELETE    ENTRY(1) ALTRET;
      164    15626    1   DCL KQX$LDASR     ENTRY(1);
      165    15627    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      166    15628    1   DCL NKL$RELDCT    ENTRY(1) ALTRET;
      167    15629    1   DCL SC_BCGDSC     ENTRY    CONV(2,0);
      168    15630    1   DCL SC_CGFWST     ENTRY    CONV(2,0);
      169    15631    1   DCL SC_BCGRBS     ENTRY    CONV(2,0);
      170    15632    1   DCL SC_CGCACHE    ENTRY    CONV(2,0);
      171    15633    1   DCL SSR$REG       ENTRY(3) ALTRET;
      172    15634    1   DCL SSR$RUE       ENTRY(4);
      173    15635    1   DCL SSS$CURTIME   ENTRY(1);
      174    15636    1   DCL UQB$MDEQ      ENTRY(1) ALTRET;
      175    15637    1   DCL UQB$MENQX     ENTRY(1) ALTRET;
      176    15638
      177    15639
      178    15640
      179    15641        /**/
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:44   
      180    15642        /* EQUS */
      181    15643        /**/
      182    15644        %EQU_CG;
      183    15692
      184    15693
      185    15694
      186    15695        /**/
      187    15696        /* CONSTANT */
      188    15697        /**/
      189    15698        %SUB FCG#='1321'O;
      190    15699        %SUB MID#='17'O;
      191    15700        %ERRCODE (NAME=ERRDMY,COD#=0);
      192    15704        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:45   
      193    15705        /*
      194    15706                         DDDD    CCC   BBBB
      195    15707                         D   D  C   C  B   B
      196    15708                         D   D  C      B   B
      197    15709                         D   D  C      BBBB
      198    15710                         D   D  C      B   B
      199    15711                         D   D  C   C  B   B
      200    15712                         DDDD    CCC   BBBB
      201    15713
      202    15714
      203    15715                   CCC   L       OOO    SSS   EEEEE
      204    15716                  C   C  L      O O O  S   S  E
      205    15717                  C      L      O O O  S      E
      206    15718                  C      L      O  OO   SSS   EEEE
      207    15719                  C      L      O   O      S  E
      208    15720                  C   C  L      O   O  S   S  E
      209    15721                   CCC   LLLLL   OOO    SSS   EEEEE
      210    15722
      211    15723        */
      212    15724
      213    15725
      214    15726        /*D* NAME:         KCO$CLCG
      215    15727
      216    15728             CALL:         CALL KCO$CLCG(FPT$);
      217    15729
      218    15730             INPUT:        FPT$ - Pointer to the close FPT
      219    15731
      220    15732             DESCRIPTION:  The ASR is set to point to the comgroup.  An
      221    15733                           enqueue is done to lock out other openers and
      222    15734                           closers.  The station of this user is deactivated.
      223    15735                           Any uncompleted continued writes, outstanding
      224    15736                           reads, and latched reads and writes are cleaned
      225    15737                           up.  The LDCT for this station is released.
      226    15738                           If this is not the last DCB open to the comgroup,
      227    15739                           then the count of the number of DCBs open is
      228    15740                           decremented and KCA$TELLAU is called to tell the
      229    15741                           AU about this close, or, if this is the AU closing,
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:46   
      230    15742                           to change the state of other stations.
      231    15743                           If this is the last DCB, then all other stations
      232    15744                           are disconnected and the comgroup is cleaned up.
      233    15745                           Then the file is closed.
      234    15746        */
      235    15747
      236    15748
      237    15749    1         ENTFLG=0;  /* Close the file too */

  15749  1 000002   200026 450100                    STZ     ENTFLG,,AUTO

      238    15750    1         GOTO COMMON;

  15750  1 000003   000010 710000 1                  TRA     COMMON

      239    15751
      240    15752
      241    15753    1   KCO$CLCGERR: ENTRY;

  15753  1 000004   000000 700200 xent  KCO$CLCGERR  TSX0  ! X66_AUTO_1
         1 000005   000116 000001                    ZERO    78,1

      242    15754
      243    15755    1         ENTFLG=1;

  15755  1 000006   000001 235007                    LDA     1,DL
         1 000007   200026 755100                    STA     ENTFLG,,AUTO

  15755  1 000010                       COMMON       null
      244    15756
      245    15757
      246    15758    1   COMMON: ;
      247    15759    1         JDCB$=B$JIT.DCB$;

  15759  1 000010   000000 470400 xsym               LDP0    B$JIT$
         1 000011   000232 236100                    LDQ     154,,PR0
         1 000012   200005 756100                    STQ     JDCB$,,AUTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:47   

      248    15760    1         CFU$=F$DCB.CFU$;

  15760  1 000013   200005 471500                    LDP1    JDCB$,,AUTO
         1 000014   100066 236100                    LDQ     54,,PR1
         1 000015   200011 756100                    STQ     CFU$,,AUTO

      249    15761    1         AU=0;

  15761  1 000016   200013 450100                    STZ     AU,,AUTO

      250    15762    1         IF FM$CFU.GDA=0 THEN

  15762  1 000017   200011 473500                    LDP3    CFU$,,AUTO
         1 000020   300005 236100                    LDQ     5,,PR3
         1 000021   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 000022   000024 601000 1                  TNZ     s:15764

      251    15763    1          RETURN;  /* Didn't really get it open */

  15763  1 000023   000000 702200 xent               TSX2  ! X66_ARET

      252    15764    1         CTX.SID=FM$CFU.GDA;

  15764  1 000024   200004 752103                    STCQ    CTX$,'03'O,AUTO

      253    15765    1         CTX.DISP=FM$CFU.LDA;

  15765  1 000025   300006 235100                    LDA     6,,PR3
         1 000026   300007 236100                    LDQ     7,,PR3
         1 000027   000033 773000                    LRL     27
         1 000030   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000031   000014 736000                    QLS     12
         1 000032   200004 752174                    STCQ    CTX$,'74'O,AUTO

      254    15766    1         CALL KQX$LDASR(KQ$CG);  /* Map onto comgroup */

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:48   
  15766  1 000033   200004 630500                    EPPR0   CTX$,,AUTO
         1 000034   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000035   000000 701000 xent               TSX1    KQX$LDASR
         1 000036   000000 011000                    NOP     0

      255    15767    1         IF F$DCB.LDCTX=0 THEN

  15767  1 000037   200005 470500                    LDP0    JDCB$,,AUTO
         1 000040   000051 220100                    LDX0    41,,PR0
         1 000041   000046 601000 1                  TNZ     s:15774

      256    15768    2           DO;

      257    15769    2           LDCT$=ADDR(NIL);

  15769  1 000042   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000043   200010 756100                    STQ     LDCT$,,AUTO

      258    15770    2           STA$=ADDR(NIL);

  15770  1 000044   200006 756100                    STQ     STA$,,AUTO

      259    15771    2           END;

  15771  1 000045   000102 710000 1                  TRA     s:15785

      260    15772    1         ELSE
      261    15773    2           DO;

      262    15774    2           LDCT$=NK$LDCT$(F$DCB.LDCTX);

  15774  1 000046   000000 471400 xsym               LDP1    N$DCT$$
         1 000047   100000 236110                    LDQ     0,X0,PR1
         1 000050   200010 756100                    STQ     LDCT$,,AUTO

      263    15775    2           STA$=NK$LDCT.STA$;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:49   
  15775  1 000051   200010 473500                    LDP3    LDCT$,,AUTO
         1 000052   300012 236100                    LDQ     10,,PR3
         1 000053   200006 756100                    STQ     STA$,,AUTO

      264    15776    2           IF KQ_LOG.DSIO THEN

  15776  1 000054   000000 236000 xsym               LDQ     KQ_LOG
         1 000055   002000 316003                    CANQ    1024,DU
         1 000056   000077 600000 1                  TZE     s:15782

      265    15777    3             DO;

      266    15778    3             CALL KQZ$LOG (KQ$CG,%KQLOG_DCLS,0,0,0,

  15778  1 000057   200006 236100                    LDQ     STA$,,AUTO
         1 000060   000006 036003                    ADLQ    6,DU
         1 000061   200114 756100                    STQ     K+8,,AUTO
         1 000062   200006 236100                    LDQ     STA$,,AUTO
         1 000063   000005 036003                    ADLQ    5,DU
         1 000064   000001 235000 2                  LDA     1
         1 000065   200112 757100                    STAQ    K+6,,AUTO
         1 000066   000002 237000 2                  LDAQ    2
         1 000067   200110 757100                    STAQ    K+4,,AUTO
         1 000070   000004 236000 2                  LDQ     4
         1 000071   200004 235100                    LDA     CTX$,,AUTO
         1 000072   200106 757100                    STAQ    K+2,,AUTO
         1 000073   200106 630500                    EPPR0   K+2,,AUTO
         1 000074   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 000075   000000 701000 xent               TSX1    KQZ$LOG
         1 000076   000000 011000                    NOP     0

      267    15779    3             SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
      268    15780    3             SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
      269    15781    3             END;

      270    15782    2           F$DCB.LDCTX=0;  /* Don't come here again */

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:50   
  15782  1 000077   000000 220003                    LDX0    0,DU
         1 000100   200005 470500                    LDP0    JDCB$,,AUTO
         1 000101   000051 740100                    STX0    41,,PR0

      271    15783    2           END;

      272    15784        /**/
      273    15785    1         ORG=F$DCB.ORG;    /* Save for later use and stuff DCB.ORG with         */

  15785  1 000102   000032 236100                    LDQ     26,,PR0
         1 000103   000033 772000                    QRL     27
         1 000104   200027 756100                    STQ     ORG,,AUTO

      274    15786    1         F$DCB.ORG=KQ$CG.GRAN.ORG;  /* appropriate value for file management    */

  15786  1 000105   200004 471500                    LDP1    CTX$,,AUTO
         1 000106   100254 236100                    LDQ     172,,PR1
         1 000107   036000 376007                    ANQ     15360,DL
         1 000110   000021 736000                    QLS     17
         1 000111   000032 552140                    STBQ    26,'40'O,PR0

      275    15787    1         IF STA$~=ADDR(NIL) THEN

  15787  1 000112   200006 236100                    LDQ     STA$,,AUTO
         1 000113   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000114   000151 600000 1                  TZE     s:15802

      276    15788    1          IF KQ$STA.AU THEN

  15788  1 000115   200006 473500                    LDP3    STA$,,AUTO
         1 000116   300020 236100                    LDQ     16,,PR3
         1 000117   200000 316003                    CANQ    65536,DU
         1 000120   000151 600000 1                  TZE     s:15802

      277    15789    2            DO;

      278    15790    2            CALL GLOCK;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:51   

  15790  1 000121   002015 701000 1                  TSX1    GLOCK
         1 000122   000000 011000                    NOP     0

      279    15791    2            KQ$CG.AUSTA$=ADDR(NIL); /* Synch with KCA$AU */

  15791  1 000123   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000124   200004 470500                    LDP0    CTX$,,AUTO
         1 000125   000121 756100                    STQ     81,,PR0

      280    15792    2            KQ$CG.AU=0;

  15792  1 000126   000000 236003                    LDQ     0,DU
         1 000127   000122 552140                    STBQ    82,'40'O,PR0

      281    15793    2            CALL GUNLOCK;

  15793  1 000130   002027 701000 1                  TSX1    GUNLOCK
         1 000131   000000 011000                    NOP     0

      282    15794                     /*    Leave KQ$STA.AU set
      283    15795                      *    for KQR$RECOVER
      284    15796                      */
      285    15797    2            AU=1;  /* This user was the AU */

  15797  1 000132   000001 235007                    LDA     1,DL
         1 000133   200013 755100                    STA     AU,,AUTO

      286    15798    2            IF KQ$CG.AUSENDCNT~=0 THEN

  15798  1 000134   200004 470500                    LDP0    CTX$,,AUTO
         1 000135   000122 236100                    LDQ     82,,PR0
         1 000136   000777 316003                    CANQ    511,DU
         1 000137   000151 600000 1                  TZE     s:15802

      287    15799    2             CALL SSR$REG(%SS_SL,,1); /* Sleep for 1 second */

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:52   
  15799  1 000140   000006 236000 2                  LDQ     6
         1 000141   200110 756100                    STQ     K+4,,AUTO
         1 000142   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000143   000007 235000 2                  LDA     7
         1 000144   200106 757100                    STAQ    K+2,,AUTO
         1 000145   200106 630500                    EPPR0   K+2,,AUTO
         1 000146   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000147   000000 701000 xent               TSX1    SSR$REG
         1 000150   000000 011000                    NOP     0

      288    15800    2            END;

      289    15801        /**/
      290    15802    1         CALL UQB$MENQX(CFU$);

  15802  1 000151   200011 630500                    EPPR0   CFU$,,AUTO
         1 000152   200106 450500                    STP0    K+2,,AUTO
         1 000153   200106 630500                    EPPR0   K+2,,AUTO
         1 000154   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000155   000000 701000 xent               TSX1    UQB$MENQX
         1 000156   000000 011000                    NOP     0

      291    15803    1         F$DCB.ENQF='1'B;

  15803  1 000157   200005 470500                    LDP0    JDCB$,,AUTO
         1 000160   000200 236007                    LDQ     128,DL
         1 000161   000064 256100                    ORSQ    52,,PR0

      292    15804        /**/
      293    15805    1         IF STA$=ADDR(NIL) THEN

  15805  1 000162   200006 236100                    LDQ     STA$,,AUTO
         1 000163   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000164   000431 600000 1                  TZE     NOSTA

      294    15806    1          GOTO NOSTA;
      295    15807        /**/
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:53   
      296    15808    1         IF F$DCB.ASN~=%DEVICE# THEN

  15808  1 000165   000032 236100                    LDQ     26,,PR0
         1 000166   777000 376007                    ANQ     -512,DL
         1 000167   003000 116007                    CMPQ    1536,DL
         1 000170   000175 600000 1                  TZE     s:15810

      297    15809    1          CALL KQC$DACTSTA (KQ$STA);

  15809  1 000171   200006 630500                    EPPR0   STA$,,AUTO
         1 000172   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000173   000000 701000 xent               TSX1    KQC$DACTSTA
         1 000174   000000 011000                    NOP     0

      298    15810    1         CALL STALOCK;

  15810  1 000175   001771 701000 1                  TSX1    STALOCK
         1 000176   000000 011000                    NOP     0

      299    15811    1         KQ$STA.DCBCNT=KQ$STA.DCBCNT-1;

  15811  1 000177   200006 470500                    LDP0    STA$,,AUTO
         1 000200   777000 236003                    LDQ     -512,DU
         1 000201   000023 056100                    ASQ     19,,PR0

      300    15812    1         IF KQ$STA.DCBCNT~=0 THEN

  15812  1 000202   000023 236100                    LDQ     19,,PR0
         1 000203   777000 316003                    CANQ    -512,DU
         1 000204   000212 600000 1                  TZE     s:15822

      301    15813    2           DO;

      302    15814    2           CALL STAUNLOCK;

  15814  1 000205   002003 701000 1                  TSX1    STAUNLOCK
         1 000206   000000 011000                    NOP     0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:54   

      303    15815    2           LDCT$=ADDR(NIL);

  15815  1 000207   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000210   200010 756100                    STQ     LDCT$,,AUTO

      304    15816    2           GOTO NOSTA;

  15816  1 000211   000431 710000 1                  TRA     NOSTA

      305    15817    2           END;
      306    15818                     /*    If this is an SUA, we must screech if the
      307    15819                      *    user has anything locked to himself; e.g.
      308    15820                      *    he's the current reader of the queue.
      309    15821                      */
      310    15822    1         IF S_CUN = KQ$STA.MLH.RUSR# THEN CALL SC_BCGRBS;

  15822  1 000212   000037 236100                    LDQ     31,,PR0
         1 000213   000033 772000                    QRL     27
         1 000214   000000 116000 xsym               CMPQ    S_CUN
         1 000215   000220 601000 1                  TNZ     s:15823

  15822  1 000216   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 000217   000000 600000 xsid               climb   nvectors=         0

      311    15823    1         IF S_CUN = KQ$CG.QUEUE.RUSR# THEN CALL SC_BCGRBS;

  15823  1 000220   200004 470500                    LDP0    CTX$,,AUTO
         1 000221   000063 236100                    LDQ     51,,PR0
         1 000222   000033 772000                    QRL     27
         1 000223   000000 116000 xsym               CMPQ    S_CUN
         1 000224   000227 601000 1                  TNZ     s:15824

  15823  1 000225   000000 713400 xsym               CLIMB   SC_BCGRBS
         1 000226   000000 600000 xsid               climb   nvectors=         0

      312    15824    1         IF S_CUN = KQ$CG.FWUSR# THEN CALL SC_CGFWST;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:55   

  15824  1 000227   200004 470500                    LDP0    CTX$,,AUTO
         1 000230   000122 236100                    LDQ     82,,PR0
         1 000231   000011 772000                    QRL     9
         1 000232   000777 376007                    ANQ     511,DL
         1 000233   000000 116000 xsym               CMPQ    S_CUN
         1 000234   000237 601000 1                  TNZ     s:15825

  15824  1 000235   000000 713400 xsym               CLIMB   SC_CGFWST
         1 000236   000000 600000 xsid               climb   nvectors=         0

      313    15825    1         KQ$STA.IDSC='1'B;  /* Set disconnect in progress */

  15825  1 000237   200006 470500                    LDP0    STA$,,AUTO
         1 000240   400000 236003                    LDQ     -131072,DU
         1 000241   000020 256100                    ORSQ    16,,PR0

      314    15826    1         CALL STAUNLOCK;

  15826  1 000242   002003 701000 1                  TSX1    STAUNLOCK
         1 000243   000000 011000                    NOP     0

      315    15827        /**/
      316    15828    1         IF AU~=0 THEN

  15828  1 000244   200013 235100                    LDA     AU,,AUTO
         1 000245   000256 600000 1                  TZE     s:15831

      317    15829    1          CALL KCA$TELLAUR(KQ$STA,%CG_AUDCON#);

  15829  1 000246   000011 236000 2                  LDQ     9
         1 000247   200006 235100                    LDA     STA$,,AUTO
         1 000250   200106 757100                    STAQ    K+2,,AUTO
         1 000251   200106 630500                    EPPR0   K+2,,AUTO
         1 000252   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000253   000000 701000 xent               TSX1    KCA$TELLAUR
         1 000254   000000 011000                    NOP     0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:56   
         1 000255   000265 710000 1                  TRA     s:15833

      318    15830    1         ELSE
      319    15831    1          CALL KCA$TELLAUR(KQ$STA,%CG_DCLS#);

  15831  1 000256   000006 236000 2                  LDQ     6
         1 000257   200006 235100                    LDA     STA$,,AUTO
         1 000260   200106 757100                    STAQ    K+2,,AUTO
         1 000261   200106 630500                    EPPR0   K+2,,AUTO
         1 000262   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000263   000000 701000 xent               TSX1    KCA$TELLAUR
         1 000264   000000 011000                    NOP     0

      320    15832        /**/
      321    15833    1         CALL RELCNNCTUSR;

  15833  1 000265   002334 701000 1                  TSX1    RELCNNCTUSR
         1 000266   000000 011000                    NOP     0

      322    15834        /**/
      323    15835    1         CALL SLOCK;

  15835  1 000267   001745 701000 1                  TSX1    SLOCK
         1 000270   000000 011000                    NOP     0

      324    15836    1         IF STA$=KQ$CG.DCBHD$ THEN

  15836  1 000271   200004 470500                    LDP0    CTX$,,AUTO
         1 000272   200006 236100                    LDQ     STA$,,AUTO
         1 000273   000103 116100                    CMPQ    67,,PR0
         1 000274   000301 601000 1                  TNZ     s:15840

      325    15837    1          KQ$CG.DCBHD$=KQ$STA.DCBLNK$;

  15837  1 000275   200006 471500                    LDP1    STA$,,AUTO
         1 000276   100014 236100                    LDQ     12,,PR1
         1 000277   000103 756100                    STQ     67,,PR0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:57   
         1 000300   000322 710000 1                  TRA     s:15846

      326    15838    1         ELSE
      327    15839    2           DO;

      328    15840    2           T$=KQ$CG.DCBHD$;

  15840  1 000301   000103 236100                    LDQ     67,,PR0
         1 000302   200014 756100                    STQ     T$,,AUTO

      329    15841    3             DO WHILE(T$->KQ$STA.DCBLNK$~=STA$);

  15841  1 000303   200014 471500                    LDP1    T$,,AUTO
         1 000304   100014 236100                    LDQ     12,,PR1
         1 000305   200006 116100                    CMPQ    STA$,,AUTO
         1 000306   000316 600000 1                  TZE     s:15844

      330    15842    3             T$=T$->KQ$STA.DCBLNK$;

  15842  1 000307   200014 470500                    LDP0    T$,,AUTO
         1 000310   000014 236100                    LDQ     12,,PR0
         1 000311   200014 756100                    STQ     T$,,AUTO

      331    15843    3             END;

  15843  1 000312   200014 470500                    LDP0    T$,,AUTO
         1 000313   000014 236100                    LDQ     12,,PR0
         1 000314   200006 116100                    CMPQ    STA$,,AUTO
         1 000315   000307 601000 1                  TNZ     s:15842

      332    15844    2           T$->KQ$STA.DCBLNK$=KQ$STA.DCBLNK$;

  15844  1 000316   200006 470500                    LDP0    STA$,,AUTO
         1 000317   000014 236100                    LDQ     12,,PR0
         1 000320   200014 471500                    LDP1    T$,,AUTO
         1 000321   100014 756100                    STQ     12,,PR1

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:58   
      333    15845    2           END;

      334    15846    1         CALL SUNLOCK;

  15846  1 000322   001757 701000 1                  TSX1    SUNLOCK
         1 000323   000000 011000                    NOP     0

      335    15847        /**/
      336    15848    1         IF ADDR(FPT$)=ADDR(NIL) THEN

  15848  1 000324   200003 236100                    LDQ     @FPT$,,AUTO
         1 000325   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000326   000345 600000 1                  TZE     CLNB

      337    15849    1          GOTO CLNB;
      338    15850    1         IF FPT$.V_=ADDR(NIL) THEN GOTO CLNB;

  15850  1 000327   200003 470500                    LDP0    @FPT$,,AUTO
         1 000330   000000 236100                    LDQ     0,,PR0
         1 000331   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000332   000345 600000 1                  TZE     CLNB

      339    15851    1         IF FPT$CLOSE_V.DISP=%SAVE# THEN

  15851  1 000333   000000 471500                    LDP1    0,,PR0
         1 000334   100000 236100                    LDQ     0,,PR1
         1 000335   000777 376007                    ANQ     511,DL
         1 000336   000002 116007                    CMPQ    2,DL
         1 000337   000345 601000 1                  TNZ     CLNB

      340    15852    1          CALL KQR$CLEANUP(KQ$STA);

  15852  1 000340   200006 630500                    EPPR0   STA$,,AUTO
         1 000341   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000342   000000 701000 xent               TSX1    KQR$CLEANUP
         1 000343   000000 011000                    NOP     0
         1 000344   000351 710000 1                  TRA     s:15856
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:59   

      341    15853    1         ELSE
      342    15854    1   CLNB:  CALL KQR$CLEANUPB(KQ$STA);

  15854  1 000345   200006 630500       CLNB         EPPR0   STA$,,AUTO
         1 000346   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000347   000000 701000 xent               TSX1    KQR$CLEANUPB
         1 000350   000000 011000                    NOP     0

      343    15855        /**/
      344    15856    1         CALL SLOCK;

  15856  1 000351   001745 701000 1                  TSX1    SLOCK
         1 000352   000000 011000                    NOP     0

      345    15857    1         CALL STALOCK;

  15857  1 000353   001771 701000 1                  TSX1    STALOCK
         1 000354   000000 011000                    NOP     0

      346    15858    1         KQ$STA.LDCT$=ADDR(NIL);

  15858  1 000355   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000356   200006 470500                    LDP0    STA$,,AUTO
         1 000357   000010 756100                    STQ     8,,PR0

      347    15859    1         KQ$STA.IDSC='0'B;

  15859  1 000360   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000361   000020 356100                    ANSQ    16,,PR0

      348    15860    1         KQ$STA.TOLDAU='0'B;

  15860  1 000362   000012 236000 2                  LDQ     10
         1 000363   000020 356100                    ANSQ    16,,PR0

      349    15861    1         KQ$STA.AU='0'B;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:60   

  15861  1 000364   000013 236000 2                  LDQ     11
         1 000365   000020 356100                    ANSQ    16,,PR0

      350    15862    1         IF NOT KQ$CG.AUCTL.SMD THEN

  15862  1 000366   200004 471500                    LDP1    CTX$,,AUTO
         1 000367   100133 236100                    LDQ     91,,PR1
         1 000370   000002 316007                    CANQ    2,DL
         1 000371   000407 601000 1                  TNZ     s:15865

      351    15863    1          IF STA$ ~= KQ$CG.JRNLSTA$ THEN

  15863  1 000372   200006 236100                    LDQ     STA$,,AUTO
         1 000373   100210 116100                    CMPQ    136,,PR1
         1 000374   000407 600000 1                  TZE     s:15865

      352    15864    1           CALL KQL$DELMLH(KQ$CG,ADDR(KQ$STA.MLH));

  15864  1 000375   000034 036003                    ADLQ    28,DU
         1 000376   200106 756100                    STQ     K+2,,AUTO
         1 000377   200106 633500                    EPPR3   K+2,,AUTO
         1 000400   200111 453500                    STP3    K+5,,AUTO
         1 000401   200004 236100                    LDQ     CTX$,,AUTO
         1 000402   200110 756100                    STQ     K+4,,AUTO
         1 000403   200110 630500                    EPPR0   K+4,,AUTO
         1 000404   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000405   000000 701000 xent               TSX1    KQL$DELMLH
         1 000406   000000 011000                    NOP     0

      353    15865    1         CALL STAUNLOCK;

  15865  1 000407   002003 701000 1                  TSX1    STAUNLOCK
         1 000410   000000 011000                    NOP     0

      354    15866    1         T$=STA$;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:61   
  15866  1 000411   200006 236100                    LDQ     STA$,,AUTO
         1 000412   200014 756100                    STQ     T$,,AUTO

      355    15867    1         CALL KQT$DELSTA(KQ$CG,T$);

  15867  1 000413   200014 630500                    EPPR0   T$,,AUTO
         1 000414   200107 450500                    STP0    K+3,,AUTO
         1 000415   200004 236100                    LDQ     CTX$,,AUTO
         1 000416   200106 756100                    STQ     K+2,,AUTO
         1 000417   200106 630500                    EPPR0   K+2,,AUTO
         1 000420   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000421   000000 701000 xent               TSX1    KQT$DELSTA
         1 000422   000000 011000                    NOP     0

      356    15868    1         CALL SUNLOCK;

  15868  1 000423   001757 701000 1                  TSX1    SUNLOCK
         1 000424   000000 011000                    NOP     0

      357    15869    1         CALL KQT$VALREADS (KQ$CG);

  15869  1 000425   200004 630500                    EPPR0   CTX$,,AUTO
         1 000426   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000427   000000 701000 xent               TSX1    KQT$VALREADS
         1 000430   000000 011000                    NOP     0

  15866  1 000431                       NOSTA        null
      358    15870        /**/
      359    15871    1   NOSTA: ;
      360    15872    1         IF LDCT$~=ADDR(NIL) THEN

  15872  1 000431   200010 236100                    LDQ     LDCT$,,AUTO
         1 000432   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000433   000442 600000 1                  TZE     s:15875

      361    15873    1          CALL NKL$RELDCT(LDCT$);

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:62   
  15873  1 000434   200010 630500                    EPPR0   LDCT$,,AUTO
         1 000435   200106 450500                    STP0    K+2,,AUTO
         1 000436   200106 630500                    EPPR0   K+2,,AUTO
         1 000437   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000440   000000 701000 xent               TSX1    NKL$RELDCT
         1 000441   000000 011000                    NOP     0

      362    15874        /**/
      363    15875    1         CALL GLOCK;

  15875  1 000442   002015 701000 1                  TSX1    GLOCK
         1 000443   000000 011000                    NOP     0

      364    15876    1         KQ$CG.STATS.NUMDCBS=KQ$CG.STATS.NUMDCBS-1;

  15876  1 000444   200004 470500                    LDP0    CTX$,,AUTO
         1 000445   000001 336007                    LCQ     1,DL
         1 000446   000173 056100                    ASQ     123,,PR0

      365    15877    1         CALL GUNLOCK;

  15877  1 000447   002027 701000 1                  TSX1    GUNLOCK
         1 000450   000000 011000                    NOP     0

      366    15878        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:63   
      367    15879
      368    15880    1         IF KQ$CG.STATS.NUMDCBS=0 THEN

  15880  1 000451   200004 470500                    LDP0    CTX$,,AUTO
         1 000452   000173 235100                    LDA     123,,PR0
         1 000453   001213 601000 1                  TNZ     s:16011

      369    15881    2           DO; /* Last DCB is closing */

      370    15882                   /******************************************************
      371    15883                    *                                                    *
      372    15884                    *          SHUT DOWN THE COMGROUP                    *
      373    15885                    *                                                    *
      374    15886                    ******************************************************/
      375    15887
      376    15888    2           FM$CFU.FMOD='1'B;

  15888  1 000454   200011 471500                    LDP1    CFU$,,AUTO
         1 000455   004000 236003                    LDQ     2048,DU
         1 000456   100000 256100                    ORSQ    0,,PR1

      377    15889    2           CALL GLOCK;

  15889  1 000457   002015 701000 1                  TSX1    GLOCK
         1 000460   000000 011000                    NOP     0

      378    15890    2           IF NOT KQ$CG.CLOCK THEN

  15890  1 000461   200004 470500                    LDP0    CTX$,,AUTO
         1 000462   000105 236100                    LDQ     69,,PR0
         1 000463   000004 316007                    CANQ    4,DL
         1 000464   000472 601000 1                  TNZ     s:15896

      379    15891    3             DO;

      380    15892    3             KQ$CG.OPEN='0'B;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:64   
  15892  1 000465   000014 236000 2                  LDQ     12
         1 000466   000105 356100                    ANSQ    69,,PR0

      381    15893    3             CALL GUNLOCK;

  15893  1 000467   002027 701000 1                  TSX1    GUNLOCK
         1 000470   000000 011000                    NOP     0

      382    15894    3             GOTO RELPGS;

  15894  1 000471   001076 710000 1                  TRA     RELPGS

      383    15895    3             END;
      384    15896    2           KQ$CG.CLOSING='1'B; /* Prevent TERM connects */

  15896  1 000472   000040 236007                    LDQ     32,DL
         1 000473   000105 256100                    ORSQ    69,,PR0

      385    15897    2           CALL GUNLOCK;

  15897  1 000474   002027 701000 1                  TSX1    GUNLOCK
         1 000475   000000 011000                    NOP     0

      386    15898    2           CALL ABORTEM; /* Blow away all terminals */

  15898  1 000476   002402 701000 1                  TSX1    ABORTEM
         1 000477   000000 011000                    NOP     0

      387    15899    2           CALL GLOCK;

  15899  1 000500   002015 701000 1                  TSX1    GLOCK
         1 000501   000000 011000                    NOP     0

      388    15900    2           IF KQ$CG.STATS.NUMTERMS~=0 THEN

  15900  1 000502   200004 470500                    LDP0    CTX$,,AUTO
         1 000503   000174 235100                    LDA     124,,PR0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:65   
         1 000504   000517 600000 1                  TZE     s:15906

      389    15901    3             DO;

      390    15902    3             KQ$CG.LASTUSER=S_CUN;

  15902  1 000505   000000 236000 xsym               LDQ     S_CUN
         1 000506   000011 736000                    QLS     9
         1 000507   000216 552110                    STBQ    142,'10'O,PR0

      391    15903    3             CALL GUNLOCK;

  15903  1 000510   002027 701000 1                  TSX1    GUNLOCK
         1 000511   000000 011000                    NOP     0

      392    15904    3             CALL SSR$REG(%SS_QA);

  15904  1 000512   000016 630400 2                  EPPR0   14
         1 000513   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000514   000000 701000 xent               TSX1    SSR$REG
         1 000515   000000 011000                    NOP     0

      393    15905    3             END;

  15905  1 000516   000521 710000 1                  TRA     s:15909

      394    15906    2           ELSE CALL GUNLOCK;

  15906  1 000517   002027 701000 1                  TSX1    GUNLOCK
         1 000520   000000 011000                    NOP     0

      395    15907                           /* Spin with OPEN, CLOCK, and CLOSING all set
      396    15908                              until the garbage collector has finished. */
      397    15909    3             DO WHILE (KQ$CG.MMD.GIP);

  15909  1 000521   200004 470500                    LDP0    CTX$,,AUTO
         1 000522   000011 234100                    SZN     9,,PR0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:66   
         1 000523   000540 605000 1                  TPL     s:15912

      398    15910    3             CALL SSR$REG (%SS_SL,,1);

  15910  1 000524   000006 236000 2                  LDQ     6
         1 000525   200110 756100                    STQ     K+4,,AUTO
         1 000526   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000527   000007 235000 2                  LDA     7
         1 000530   200106 757100                    STAQ    K+2,,AUTO
         1 000531   200106 630500                    EPPR0   K+2,,AUTO
         1 000532   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000533   000000 701000 xent               TSX1    SSR$REG
         1 000534   000000 011000                    NOP     0

      399    15911    3             END;

  15911  1 000535   200004 470500                    LDP0    CTX$,,AUTO
         1 000536   000011 234100                    SZN     9,,PR0
         1 000537   000524 604000 1                  TMI     s:15910

      400    15912    2           CALL GLOCK;

  15912  1 000540   002015 701000 1                  TSX1    GLOCK
         1 000541   000000 011000                    NOP     0

      401    15913    2           KQ$CG.OPEN='0'B;

  15913  1 000542   200004 470500                    LDP0    CTX$,,AUTO
         1 000543   000014 236000 2                  LDQ     12
         1 000544   000105 356100                    ANSQ    69,,PR0

      402    15914    2           KQ$CG.CLOSING='0'B;

  15914  1 000545   000017 236000 2                  LDQ     15
         1 000546   000105 356100                    ANSQ    69,,PR0

      403    15915    2           KQ$CG.CLOCK='0'B; /* Disable clock */
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:67   

  15915  1 000547   000020 236000 2                  LDQ     16
         1 000550   000105 356100                    ANSQ    69,,PR0

      404    15916    2           CALL GUNLOCK;

  15916  1 000551   002027 701000 1                  TSX1    GUNLOCK
         1 000552   000000 011000                    NOP     0

      405    15917                           /* Spin till all I/O is finished */
      406    15918    3             DO WHILE (KQ$CG.IOCNT ~= 0);

  15918  1 000553   200004 470500                    LDP0    CTX$,,AUTO
         1 000554   000225 720100                    LXL0    149,,PR0
         1 000555   000572 600000 1                  TZE     s:15922

      407    15919    3             CALL SSR$REG(%SS_SL,,1); /* Sleep for 1 second */

  15919  1 000556   000006 236000 2                  LDQ     6
         1 000557   200110 756100                    STQ     K+4,,AUTO
         1 000560   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000561   000007 235000 2                  LDA     7
         1 000562   200106 757100                    STAQ    K+2,,AUTO
         1 000563   200106 630500                    EPPR0   K+2,,AUTO
         1 000564   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000565   000000 701000 xent               TSX1    SSR$REG
         1 000566   000000 011000                    NOP     0

      408    15920    3             END;

  15920  1 000567   200004 470500                    LDP0    CTX$,,AUTO
         1 000570   000225 720100                    LXL0    149,,PR0
         1 000571   000556 601000 1                  TNZ     s:15919

      409    15921        /**/
      410    15922    2           F$DCB.LVL=%KQ_PTYP_CTL;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:68   
  15922  1 000572   200005 471500                    LDP1    JDCB$,,AUTO
         1 000573   100067 236100                    LDQ     55,,PR1
         1 000574   000021 376000 2                  ANQ     17
         1 000575   030000 276003                    ORQ     12288,DU
         1 000576   100067 756100                    STQ     55,,PR1

      411    15923    2           F$DCB.GTYP=FMGTFILE;

  15923  1 000577   100064 236100                    LDQ     52,,PR1
         1 000600   000022 376000 2                  ANQ     18
         1 000601   030000 276003                    ORQ     12288,DU
         1 000602   100064 756100                    STQ     52,,PR1

      412    15924    2           CALL FMD$REDBUF(CTL$,0,FM_FRZERO) ALTRET(NORCVR);

  15924  1 000603   000023 236000 2                  LDQ     19
         1 000604   200110 756100                    STQ     K+4,,AUTO
         1 000605   000001 236000 2                  LDQ     1
         1 000606   200107 756100                    STQ     K+3,,AUTO
         1 000607   200030 633500                    EPPR3   CTL$,,AUTO
         1 000610   200106 453500                    STP3    K+2,,AUTO
         1 000611   200106 630500                    EPPR0   K+2,,AUTO
         1 000612   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000613   000000 701000 xent               TSX1    FMD$REDBUF
         1 000614   001072 702000 1                  TSX2    NORCVR

      413    15925    2           F$DCB.BFR.BUFUP(0)='1'B;

  15925  1 000615   200005 470500                    LDP0    JDCB$,,AUTO
         1 000616   400000 236003                    LDQ     -131072,DU
         1 000617   000115 256100                    ORSQ    77,,PR0

      414    15926    2           KQ$CTLGRAN.PGTBL='0'B;

  15926  1 000620   200030 471500                    LDP1    CTL$,,AUTO
         1 000621   000100 100400                    MLR     fill='000'O
         1 000622   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:69   
         1 000623   100012 000035                    ADSC9   10,,PR1                  cn=0,n=29

      415    15927    2           T$=PINCRW(CTL$,KQ$CTLGRAN.CTXX);

  15927  1 000624   200030 471500                    LDP1    CTL$,,AUTO
         1 000625   100004 720100                    LXL0    4,,PR1
         1 000626   000000 636010                    EAQ     0,X0
         1 000627   200030 036100                    ADLQ    CTL$,,AUTO
         1 000630   200014 756100                    STQ     T$,,AUTO

      416    15928    2           T$->KQ$CG=KQ$CG;

  15928  1 000631   200004 473500                    LDP3    CTX$,,AUTO
         1 000632   200014 474500                    LDP4    T$,,AUTO
         1 000633   000100 100500                    MLR     fill='000'O
         1 000634   300000 001324                    ADSC9   0,,PR3                   cn=0,n=724
         1 000635   400000 001324                    ADSC9   0,,PR4                   cn=0,n=724

      417    15929        /**/
      418    15930    2           DA=KQ$CG.HIGRANS+FM_FRZERO;

  15930  1 000636   300222 236100                    LDQ     146,,PR3
         1 000637   000000 036000 xsym               ADLQ    FM_FRZERO
         1 000640   200022 756100                    STQ     DA,,AUTO

      419    15931    2           SIZ=KQ$CG.NGAVAL;

  15931  1 000641   300217 235100                    LDA     143,,PR3
         1 000642   200021 755100                    STA     SIZ,,AUTO

      420    15932    2           DESC#=0;

  15932  1 000643   200023 450100                    STZ     DESC#,,AUTO

      421    15933    2           PGINDX=0;

  15933  1 000644   200024 450100                    STZ     PGINDX,,AUTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:70   

      422    15934    3             DO WHILE('1'B);

  15927  1 000645                       FINDNXTPG    null
      423    15935    3   FINDNXTPG:;
      424    15936    3             CALL FINDCGPAGE(KQ$CG.MMD.DSB$->KQ$DSB,DESC#,PGINDX,DGRAN$,PG) ALTRET(
             15936                      ENDRCVR);

  15936  1 000645   200004 470500                    LDP0    CTX$,,AUTO
         1 000646   000000 471500                    LDP1    0,,PR0
         1 000647   200025 633500                    EPPR3   PG,,AUTO
         1 000650   200103 453500                    STP3    @PTR$+1,,AUTO
         1 000651   200017 634500                    EPPR4   DGRAN$,,AUTO
         1 000652   200102 454500                    STP4    @PGNUM+1,,AUTO
         1 000653   200024 635500                    EPPR5   PGINDX,,AUTO
         1 000654   200101 455500                    STP5    J+1,,AUTO
         1 000655   200023 636500                    EPPR6   DESC#,,AUTO
         1 000656   200100 456500                    STP6    CODE+1,,AUTO
         1 000657   200077 451500                    STP1    COMGRP+38,,AUTO
         1 000660   001256 701000 1                  TSX1    FINDCGPAGE
         1 000661   000760 702000 1                  TSX2    ENDRCVR

      425    15937    3             IF SIZ=0 THEN

  15937  1 000662   200021 235100                    LDA     SIZ,,AUTO
         1 000663   000667 601000 1                  TNZ     s:15942

      426    15938    4               DO;

      427    15939    4               CALL SC_CGCACHE;

  15939  1 000664   000000 713400 xsym               CLIMB   SC_CGCACHE
         1 000665   000000 600000 xsid               climb   nvectors=         0

      428    15940    4               GOTO ENDRCVR;

  15940  1 000666   000760 710000 1                  TRA     ENDRCVR
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:71   

      429    15941    4               END;
      430    15942    3             IF DGRAN$->KQ$DGRAN.HDR.PTYP=0 THEN GOTO FINDNXTPG;

  15942  1 000667   200017 470500                    LDP0    DGRAN$,,AUTO
         1 000670   000001 236100                    LDQ     1,,PR0
         1 000671   000007 316003                    CANQ    7,DU
         1 000672   000645 600000 1                  TZE     FINDNXTPG

      431    15943    3             IF DGRAN$->KQ$DGRAN.HDR.SELF$~=DGRAN$ THEN

  15943  1 000673   000002 236100                    LDQ     2,,PR0
         1 000674   200017 116100                    CMPQ    DGRAN$,,AUTO
         1 000675   000701 600000 1                  TZE     s:15948

      432    15944    4               DO;

      433    15945    4               CALL SC_CGCACHE;

  15945  1 000676   000000 713400 xsym               CLIMB   SC_CGCACHE
         1 000677   000000 600000 xsid               climb   nvectors=         0

      434    15946    4               GOTO FINDNXTPG;

  15946  1 000700   000645 710000 1                  TRA     FINDNXTPG

      435    15947    4               END;
      436    15948    3             IF DGRAN$->KQ$DGRAN.HDR.PTYP=%KQ_PTYP_DATA

  15948  1 000701   000001 236100                    LDQ     1,,PR0
         1 000702   000007 376003                    ANQ     7,DU
         1 000703   000001 116003                    CMPQ    1,DU
         1 000704   000710 601000 1                  TNZ     s:15950
         1 000705   000001 236100                    LDQ     1,,PR0
         1 000706   000020 316003                    CANQ    16,DU
         1 000707   000645 600000 1                  TZE     FINDNXTPG

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:72   
      437    15949    3             AND NOT DGRAN$->KQ$DGRAN.HDR.CHAIN THEN GOTO FINDNXTPG;
      438    15950    3             DGRAN$->KQ$DGRAN.HDR.STAMP.GMOD=DA;

  15950  1 000710   200022 236100                    LDQ     DA,,AUTO
         1 000711   000000 552104                    STBQ    0,'04'O,PR0

      439    15951    3             DGRAN$->KQ$DGRAN.HDR.GTYP=%KQ_PTYP_RCVR;

  15951  1 000712   200017 470500                    LDP0    DGRAN$,,AUTO
         1 000713   000001 236100                    LDQ     1,,PR0
         1 000714   000024 376000 2                  ANQ     20
         1 000715   100000 276007                    ORQ     32768,DL
         1 000716   000001 756100                    STQ     1,,PR0

      440    15952    3             CALL FMB$RIO(,PG,4096,DA,%N_WRBIN,1,ENTADDR(NIL),0);

  15952  1 000717   000002 237000 2                  LDAQ    2
         1 000720   200114 757100                    STAQ    K+8,,AUTO
         1 000721   000026 237000 2                  LDAQ    22
         1 000722   200112 757100                    STAQ    K+6,,AUTO
         1 000723   200022 630500                    EPPR0   DA,,AUTO
         1 000724   200111 450500                    STP0    K+5,,AUTO
         1 000725   000030 236000 2                  LDQ     24
         1 000726   200110 756100                    STQ     K+4,,AUTO
         1 000727   200025 631500                    EPPR1   PG,,AUTO
         1 000730   200107 451500                    STP1    K+3,,AUTO
         1 000731   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000732   200106 756100                    STQ     K+2,,AUTO
         1 000733   200106 630500                    EPPR0   K+2,,AUTO
         1 000734   000026 631400 xsym               EPPR1   B_VECTNIL+22
         1 000735   000000 701000 xent               TSX1    FMB$RIO
         1 000736   000000 011000                    NOP     0

      441    15953    3             KQ$CTLGRAN.PGTBL((DESC#*%CGQ_CHUNK_SIZE)+PGINDX)='1'B;

  15953  1 000737   200023 236100                    LDQ     DESC#,,AUTO
         1 000740   000012 402007                    MPY     10,DL
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:73   
         1 000741   200024 036100                    ADLQ    PGINDX,,AUTO
         1 000742   200030 470500                    LDP0    CTL$,,AUTO
         1 000743   003106 060400                    CSL     bolr='003'O
         1 000744   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 000745   000012 000001                    BDSC    10,Q,PR0                 by=0,bit=0,n=1

      442    15954    3             DA=DA+1;

  15954  1 000746   200022 235100                    LDA     DA,,AUTO
         1 000747   000001 035007                    ADLA    1,DL
         1 000750   200022 755100                    STA     DA,,AUTO

      443    15955    3             SIZ=SIZ-1;

  15955  1 000751   000001 336007                    LCQ     1,DL
         1 000752   200021 056100                    ASQ     SIZ,,AUTO

      444    15956    3             KQ$CTLGRAN.RCVRSIZ=KQ$CTLGRAN.RCVRSIZ+1;

  15956  1 000753   200030 470500                    LDP0    CTL$,,AUTO
         1 000754   000007 235100                    LDA     7,,PR0
         1 000755   000001 035007                    ADLA    1,DL
         1 000756   000007 755100                    STA     7,,PR0

      445    15957    3             END;

  15957  1 000757   000645 710000 1                  TRA     FINDNXTPG

  15953  1 000760                       ENDRCVR      null
      446    15958    2   ENDRCVR: ;
      447    15959    2           IF KQ$CTLGRAN.RCVRSIZ~=0 THEN

  15959  1 000760   200030 470500                    LDP0    CTL$,,AUTO
         1 000761   000007 235100                    LDA     7,,PR0
         1 000762   000767 600000 1                  TZE     s:15962

      448    15960    2            KQ$CTLGRAN.RCVRDA=KQ$CG.HIGRANS+FM_FRZERO;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:74   

  15960  1 000763   200004 471500                    LDP1    CTX$,,AUTO
         1 000764   100222 236100                    LDQ     146,,PR1
         1 000765   000000 036000 xsym               ADLQ    FM_FRZERO
         1 000766   000006 756100                    STQ     6,,PR0

      449    15961        /**/
      450    15962    2           KQ$CTLGRAN.RCVRTIME=0;

  15962  1 000767   200030 470500                    LDP0    CTL$,,AUTO
         1 000770   000010 450100                    STZ     8,,PR0

      451    15963    2           COMGRP='0'B;

  15963  1 000771   000100 100400                    MLR     fill='000'O
         1 000772   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000773   200031 000220                    ADSC9   COMGRP,,AUTO             cn=0,n=144

      452    15964    2           COMGRP.CODE=%AZ$CG;

  15964  1 000774   005000 236003                    LDQ     2560,DU
         1 000775   200031 552140                    STBQ    COMGRP,'40'O,AUTO

      453    15965    2           COMGRP.ACCT=F$DCB.ACCT;

  15965  1 000776   200005 470500                    LDP0    JDCB$,,AUTO
         1 000777   000020 237100                    LDAQ    16,,PR0
         1 001000   200033 755100                    STA     COMGRP+2,,AUTO
         1 001001   200034 756100                    STQ     COMGRP+3,,AUTO

      454    15966    2           COMGRP.NAM=F$DCB.NAME;

  15966  1 001002   000100 100500                    MLR     fill='000'O
         1 001003   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32
         1 001004   200035 000040                    ADSC9   COMGRP+4,,AUTO           cn=0,n=32

      455    15967    2           COMGRP.SN=FM$SET.PSN(F$DCB.SETX);
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:75   

  15967  1 001005   000051 236100                    LDQ     41,,PR0
         1 001006   000003 736000                    QLS     3
         1 001007   000031 376000 2                  ANQ     25
         1 001010   000002 736000                    QLS     2
         1 001011   000000 471400 xsym               LDP1    F$CFU$
         1 001012   040100 100506                    MLR     fill='040'O
         1 001013   100000 400006                    ADSC9   0,Q,PR1                  cn=2,n=6
         1 001014   200031 400006                    ADSC9   COMGRP,,AUTO             cn=2,n=6

      456    15968    2           COMGRP.STATS=KQ$CG.STATS;

  15968  1 001015   200004 473500                    LDP3    CTX$,,AUTO
         1 001016   000100 100500                    MLR     fill='000'O
         1 001017   300165 000110                    ADSC9   117,,PR3                 cn=0,n=72
         1 001020   200045 000110                    ADSC9   COMGRP+12,,AUTO          cn=0,n=72

      457    15969    2           I=KQ$CG.PGTIME;

  15969  1 001021   300115 235100                    LDA     77,,PR3
         1 001022   200016 755100                    STA     I,,AUTO

      458    15970    2           CALL SSS$CURTIME(KQ$CG.PGTIME);

  15970  1 001023   200004 236100                    LDQ     CTX$,,AUTO
         1 001024   000115 036003                    ADLQ    77,DU
         1 001025   200106 756100                    STQ     K+2,,AUTO
         1 001026   200106 630500                    EPPR0   K+2,,AUTO
         1 001027   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001030   000000 701000 xent               TSX1    SSS$CURTIME
         1 001031   000000 011000                    NOP     0

      459    15971    2           CALL FGH$UPDBUCKET(COMGRP.STATS.PGSI,KQ$CG.STATS.PGSI,KQ$CG.PGTIME-I,KQ$CG.
             15971                    MMD.CURPG);

  15971  1 001032   200004 470500                    LDP0    CTX$,,AUTO
         1 001033   000115 236100                    LDQ     77,,PR0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:76   
         1 001034   200016 136100                    SBLQ    I,,AUTO
         1 001035   200106 756100                    STQ     K+2,,AUTO
         1 001036   200004 236100                    LDQ     CTX$,,AUTO
         1 001037   000006 036003                    ADLQ    6,DU
         1 001040   200113 756100                    STQ     K+7,,AUTO
         1 001041   200106 631500                    EPPR1   K+2,,AUTO
         1 001042   200112 451500                    STP1    K+6,,AUTO
         1 001043   200004 236100                    LDQ     CTX$,,AUTO
         1 001044   000177 036003                    ADLQ    127,DU
         1 001045   200111 756100                    STQ     K+5,,AUTO
         1 001046   200057 633500                    EPPR3   COMGRP+22,,AUTO
         1 001047   200110 453500                    STP3    K+4,,AUTO
         1 001050   200110 630500                    EPPR0   K+4,,AUTO
         1 001051   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 001052   000000 701000 xent               TSX1    FGH$UPDBUCKET
         1 001053   000000 011000                    NOP     0

      460    15972    2           CALL ELA$SYSLOG(EL_ACCTLG,COMGRP,SIZEW(COMGRP),0,2,I);

  15972  1 001054   200016 630500                    EPPR0   I,,AUTO
         1 001055   200113 450500                    STP0    K+7,,AUTO
         1 001056   000033 236000 2                  LDQ     27
         1 001057   200112 756100                    STQ     K+6,,AUTO
         1 001060   000034 237000 2                  LDAQ    28
         1 001061   200110 757100                    STAQ    K+4,,AUTO
         1 001062   200031 631500                    EPPR1   COMGRP,,AUTO
         1 001063   200107 451500                    STP1    K+3,,AUTO
         1 001064   000036 236000 2                  LDQ     30
         1 001065   200106 756100                    STQ     K+2,,AUTO
         1 001066   200106 630500                    EPPR0   K+2,,AUTO
         1 001067   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 001070   000000 701000 xent               TSX1    ELA$SYSLOG
         1 001071   000000 011000                    NOP     0

  15972  1 001072                       NORCVR       null
      461    15973        /**/
      462    15974    2   NORCVR: ;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:77   
      463    15975    2           CALL FMD$FLSHBUF(0);

  15975  1 001072   000001 630400 2                  EPPR0   1
         1 001073   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001074   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 001075   000000 011000                    NOP     0

  15972  1 001076                       RELPGS       null
      464    15976        /**/
      465    15977    2   RELPGS: ;
      466    15978    2           FM$CFU.GDA=0;

  15978  1 001076   200011 470500                    LDP0    CFU$,,AUTO
         1 001077   000000 236003                    LDQ     0,DU
         1 001100   000005 552134                    STBQ    5,'34'O,PR0

      467    15979    2           FM$CFU.LDA=0;

  15979  1 001101   200011 470500                    LDP0    CFU$,,AUTO
         1 001102   000100 101400                    MRL     fill='000'O
         1 001103   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         1 001104   000006 400003                    ADSC9   6,,PR0                   cn=2,n=3

      468    15980        /**/
      469    15981    2           IF KQ$CG.MMD.DSB$~=ADDR(NIL) THEN

  15981  1 001105   200004 470500                    LDP0    CTX$,,AUTO
         1 001106   000000 236100                    LDQ     0,,PR0
         1 001107   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001110   001207 600000 1                  TZE     ENDRELPGS

      470    15982    3             DO;

      471    15983    3             DESC#=0;

  15983  1 001111   200023 450100                    STZ     DESC#,,AUTO

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:78   
      472    15984    3             PGINDX=0;

  15984  1 001112   200024 450100                    STZ     PGINDX,,AUTO

      473    15985    4               DO WHILE('1'B);

      474    15986    4               CALL FINDCGPAGE(KQ$CG.MMD.DSB$->KQ$DSB,DESC#,PGINDX,DGRAN$,PG) ALTRET(
             15986                        ENDRELPGS);

  15986  1 001113   200004 470500                    LDP0    CTX$,,AUTO
         1 001114   000000 471500                    LDP1    0,,PR0
         1 001115   200025 633500                    EPPR3   PG,,AUTO
         1 001116   200103 453500                    STP3    @PTR$+1,,AUTO
         1 001117   200017 634500                    EPPR4   DGRAN$,,AUTO
         1 001120   200102 454500                    STP4    @PGNUM+1,,AUTO
         1 001121   200024 635500                    EPPR5   PGINDX,,AUTO
         1 001122   200101 455500                    STP5    J+1,,AUTO
         1 001123   200023 636500                    EPPR6   DESC#,,AUTO
         1 001124   200100 456500                    STP6    CODE+1,,AUTO
         1 001125   200077 451500                    STP1    COMGRP+38,,AUTO
         1 001126   001256 701000 1                  TSX1    FINDCGPAGE
         1 001127   001207 702000 1                  TSX2    ENDRELPGS

      475    15987    5               IF ENTFLG=1 AND DGRAN$~=DGRAN$->KQ$DGRAN.HDR.SELF$ THEN DO;

  15987  1 001130   200026 235100                    LDA     ENTFLG,,AUTO
         1 001131   000001 115007                    CMPA    1,DL
         1 001132   001176 601000 1                  TNZ     s:16002
         1 001133   200017 470500                    LDP0    DGRAN$,,AUTO
         1 001134   200017 236100                    LDQ     DGRAN$,,AUTO
         1 001135   000002 116100                    CMPQ    2,,PR0
         1 001136   001176 600000 1                  TZE     s:16002

      476    15988                   /* fix SELF$ if we're closing a bad comgroup with a clobbered granule */
      477    15989                      %LOCK (G=KQ_ERRLOG_GATE);

  15990  1 001137   000037 630400 2                  EPPR0   31
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:79   
         1 001140   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001141   000000 701000 xent               TSX1    HFC$LOCK
         1 001142   000000 011000                    NOP     0

      478    15992    5                 KQ_ERRLOG_BFR.CODE=%KQELOG_KCO_GHDRBAD;

  15992  1 001143   007000 236003                    LDQ     3584,DU
         1 001144   000000 552040 xsym               STBQ    KQ_ERRLOG_BFR,'40'O

      479    15993    5                 KQ_ERRLOG_BFR.SIZ=1+SIZEW(KQ$DGRAN);

  15993  1 001145   000041 235007                    LDA     33,DL
         1 001146   000015 755000 xsym               STA     KQ_ERRLOG_BFR+13

      480    15994    5                 T$=ADDR(KQ_ERRLOG_BFR.INFO);

  15994  1 001147   000040 236000 2                  LDQ     32
         1 001150   200014 756100                    STQ     T$,,AUTO

      481    15995    5                 KQ_ERRLOG_BFR.INFO='0'B;

  15995  1 001151   000000 100400                    MLR     fill='000'O
         1 001152   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 001153   000016 000310 xsym               ADSC9   KQ_ERRLOG_BFR+14         cn=0,n=200

      482    15996    5                 T$->P$=DGRAN$;

  15996  1 001154   200017 236100                    LDQ     DGRAN$,,AUTO
         1 001155   200014 470500                    LDP0    T$,,AUTO
         1 001156   000000 756100                    STQ     0,,PR0

      483    15997    5                 T$=PINCRW(T$,1);

  15997  1 001157   200014 236100                    LDQ     T$,,AUTO
         1 001160   000001 036003                    ADLQ    1,DU
         1 001161   200014 756100                    STQ     T$,,AUTO

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:80   
      484    15998    5                 T$->KQ$DGRAN=DGRAN$->KQ$DGRAN;

  15998  1 001162   200017 470500                    LDP0    DGRAN$,,AUTO
         1 001163   200014 471500                    LDP1    T$,,AUTO
         1 001164   000100 100500                    MLR     fill='000'O
         1 001165   000000 000200                    ADSC9   0,,PR0                   cn=0,n=128
         1 001166   100000 000200                    ADSC9   0,,PR1                   cn=0,n=128

      485    15999    5                 CALL KQD$ERRLOG (KQ$CG);

  15999  1 001167   200004 630500                    EPPR0   CTX$,,AUTO
         1 001170   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001171   000000 701000 xent               TSX1    KQD$ERRLOG
         1 001172   000000 011000                    NOP     0

      486    16000    5                 DGRAN$->KQ$DGRAN.HDR.SELF$=DGRAN$;

  16000  1 001173   200017 236100                    LDQ     DGRAN$,,AUTO
         1 001174   200017 470500                    LDP0    DGRAN$,,AUTO
         1 001175   000002 756100                    STQ     2,,PR0

      487    16001    5                 END;

      488    16002    4               CALL KQM$RELPF (KQ$CG,DGRAN$);

  16002  1 001176   200017 630500                    EPPR0   DGRAN$,,AUTO
         1 001177   200107 450500                    STP0    K+3,,AUTO
         1 001200   200004 236100                    LDQ     CTX$,,AUTO
         1 001201   200106 756100                    STQ     K+2,,AUTO
         1 001202   200106 630500                    EPPR0   K+2,,AUTO
         1 001203   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001204   000000 701000 xent               TSX1    KQM$RELPF
         1 001205   000000 011000                    NOP     0

      489    16003    4               END;

  16003  1 001206   001113 710000 1                  TRA     s:15986
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:81   

  16002  1 001207                       ENDRELPGS    null
      490    16004    3             END;
      491    16005        /**/
      492    16006    2   ENDRELPGS: ;
      493    16007    2           CALL KQM$SHUTDOWN(KQ$CG);

  16007  1 001207   200004 630500                    EPPR0   CTX$,,AUTO
         1 001210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001211   000000 701000 xent               TSX1    KQM$SHUTDOWN
         1 001212   000000 011000                    NOP     0

      494    16008    2           END; /* Shut down the comgroup */

      495    16009        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:82   
      496    16010        /**/
      497    16011    1         IF F$DCB.ENQF THEN

  16011  1 001213   200005 470500                    LDP0    JDCB$,,AUTO
         1 001214   000064 236100                    LDQ     52,,PR0
         1 001215   000200 316007                    CANQ    128,DL
         1 001216   001227 600000 1                  TZE     s:16016

      498    16012    2           DO;

      499    16013    2           F$DCB.ENQF='0'B;

  16013  1 001217   000041 236000 2                  LDQ     33
         1 001220   000064 356100                    ANSQ    52,,PR0

      500    16014    2           CALL UQB$MDEQ(CFU$);

  16014  1 001221   200011 631500                    EPPR1   CFU$,,AUTO
         1 001222   200106 451500                    STP1    K+2,,AUTO
         1 001223   200106 630500                    EPPR0   K+2,,AUTO
         1 001224   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001225   000000 701000 xent               TSX1    UQB$MDEQ
         1 001226   000000 011000                    NOP     0

      501    16015    2           END;

      502    16016    1         F$DCB.ORG=ORG;    /* ...and put it back */

  16016  1 001227   200005 470500                    LDP0    JDCB$,,AUTO
         1 001230   200027 236100                    LDQ     ORG,,AUTO
         1 001231   000033 736000                    QLS     27
         1 001232   000032 552140                    STBQ    26,'40'O,PR0

      503    16017        /**/
      504    16018    1         IF F$DCB.SETSTA$~=ADDR(NIL) THEN

  16018  1 001233   000006 236100                    LDQ     6,,PR0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:83   
         1 001234   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001235   001247 600000 1                  TZE     s:16025

      505    16019    1          IF SUBSTR(F$DCB.SETSTA$->VLP$SETSTA_V.MYSTATION,0,1)='&'

  16019  1 001236   000006 471500                    LDP1    6,,PR0
         1 001237   100000 236100                    LDQ     0,,PR1
         1 001240   777000 376003                    ANQ     -512,DU
         1 001241   046000 116003                    CMPQ    19456,DU
         1 001242   001247 601000 1                  TNZ     s:16025

      506    16020    1          THEN F$DCB.SETSTA$->VLP$SETSTA_V.MYSTATION=' ';

  16020  1 001243   000035 235000 xsym               LDA     B_VECTNIL+29
         1 001244   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 001245   100000 755100                    STA     0,,PR1
         1 001246   100001 756100                    STQ     1,,PR1

      507    16021                             /* If we gave him this STATION name then take it away   */
      508    16022                             /* again so that a reopen will not complain about       */
      509    16023                             /* invalid characters in STATION name.                  */
      510    16024        /**/
      511    16025    1         IF ENTFLG=0 THEN

  16025  1 001247   200026 235100                    LDA     ENTFLG,,AUTO
         1 001250   001255 601000 1                  TNZ     s:16028

      512    16026    1          CALL FMP$CLSF(FPT$);

  16026  1 001251   200003 630500                    EPPR0   @FPT$,,AUTO
         1 001252   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001253   000000 701000 xent               TSX1    FMP$CLSF
         1 001254   000000 011000                    NOP     0

      513    16027        /**/
      514    16028    1         RETURN;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:84   
  16028  1 001255   000000 702200 xent               TSX2  ! X66_ARET

      515    16029        /**/
      516    16030        /**/
      517    16031        %SET LISTMAC='1'B;
      518    16032              %KQ_FCGP (MON=YES);
             16033        /**/
             16034    1   FINDCGPAGE: PROC (KQ$DSB,ASNUM,PGNUM,PTR$,PPNO) ALTRET;

  16034  1 001256   200076 741300       FINDCGPAGE   STX1  ! COMGRP+37,,AUTO

             16035        /**/
             16036        %KQ_DSB (FPTN=KQ$DSB,STCLASS="");
             16037         %LSET LISTDIR='0'B;
             16049    2   DCL 1 KQ$DSB DALIGNED,
             16051    2         2 ASR,
             16055    2           3 BOUND UBIN(20) UNAL /*(0)/**/,
             16056    2           3 FLG BIT(9) UNAL /*('110100011'B)/**/,
             16057    2           3 W UBIN(3) UNAL /*(3)/**/,
             16058    2           3 T UBIN(4) UNAL /*(1)/**/,
             16059    2           3 BASE UBIN(36) UNAL /*(0)/**/,
             16060    2         2 CRYPT REDEF ASR,
             16063    2           3 LNK$ PTR,
             16066    2           3 * UBIN,
             16067    2         2 DESC (0:25),
             16070    2           3 BOUND UBIN(20) UNAL /*(40959*0)/**/,
             16071    2           3 FLG BIT(9) UNAL /*('110000010'B*0)/**/,
             16072    2           3 FLGR REDEF FLG,
             16073    2             4 * BIT(8) UNAL,
             16074    2             4 PRESENT BIT(1) UNAL,
             16075    2           3 W UBIN(3) UNAL /*(3*0)/**/,
             16076    2           3 T UBIN(4) UNAL /*(0*0)/**/,
             16077    2           3 BASE UBIN(36) UNAL /*(0*0)/**/;
             16079    2   DCL ASNUM UBIN;
             16080    2   DCL PGNUM UBIN;
             16081    2   DCL PTR$ PTR ALIGNED;
             16082    2   DCL 1 PTR$R REDEF PTR$ ALIGNED,
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:85   
             16083    2         2 PG# UBIN(8) UNAL,
             16084    2         2 GORGO UBIN(16) UNAL,
             16085    2         2 SEGID UBIN(12) UNAL;
             16086    2   DCL PPNO UBIN;
             16087        %IF MON;
             16088        /*M* HF_DATA_R */
             16089        /*M* HF_DATA_D - STATIC DATA FOR FAULT HANDLER AND MEMORY EDAC SCAN */
             16090        /*T***********************************************************/
             16091        /*T*                                                         */
             16092        /*T* Copyright (c) Bull HN Information Systems Inc., 1994    */
             16093        /*T*                                                         */
             16094        /*T***********************************************************/
             16095    2  DCL H_FLTCNT(0:22)SBIN SYMREF;DCL H_CPUGATE BIT(72)SYMREF DALIGNED;DCL 1 H_CNNCTMLBX
             16095            (0:7)SYMREF,2 * BIT(30),2 RELIEF BIT(1),2 CLEAR
             16096    2   BIT(1),2 MAKE BIT(1),2 TIME BIT(1),2 SCR BIT(1),2 PAUSE BIT(1);DCL H_TIME SYMREF
             16096            UBIN;DCL H_XDELTA UBIN SYMREF;DCL H_INTMASK BIT(72)
             16097    2   SYMREF DALIGNED;DCL H_ENMASK BIT(72)DALIGNED SYMREF;DCL H_DSMASK BIT(72)DALIGNED
             16097            SYMREF;DCL 1 H_STOREUNIT(0:15)SYMREF,2 PORT# UBIN
             16098    2   (2)UNAL,2 STORE_UNIT# UBIN(2)UNAL,2 * BIT(8),2 FIRST_ADDR UBIN(24)UNAL;DCL H_MAXSU#
             16098            UBIN WORD SYMREF;DCL H_MEMOK BIT(1)ALIGNED
             16099    2  SYMREF;DCL H_S1000_FLG BIT(1)ALIGNED SYMREF;DCL H_RPM_FLG BIT(1)ALIGNED SYMREF;DCL 1
             16099            H_S1000_CONFIG SYMREF,2 REG(0:35)BIT(1);DCL
             16100    2   H_RLF_GATE BIT(36)ALIGNED SYMREF;DCL H_FAIL_PORT UBIN ALIGNED SYMREF;DCL H_FAIL_NUM
             16100            UBIN ALIGNED SYMREF;DCL H_FAIL_PARK BIT(1)
             16101    2  ALIGNED SYMREF;DCL H_RELIEF BIT(1)ALIGNED SYMREF;DCL H_NURSE UBIN ALIGNED SYMREF;DCL
             16101            H_NURSE_PARK BIT(1)ALIGNED SYMREF;DCL 1
             16102    2   H_CPU_CONFIG(0:3)SYMREF,2 PORT_ASSIGN UBIN(3)UNAL,2 PORT_ENABLE BIT(1),2 INITIALIZE
             16102            BIT(1),2 INTERLACE BIT(1),2 SIZE UBIN(3)UNAL;DCL
             16103    2  1 H_SCU_CONFIG(0:3)SYMREF DALIGNED,2 MASK_A BIT(9),2 SIZE UBIN(3)UNAL,2 ON_LINE BIT(
             16103            4),2 PORT# UBIN(4)UNAL,2 * BIT(1),2 MODE BIT(1),
             16104    2   2 NONEXIST_ADDR UBIN(8)UNAL,2 INTERLACE BIT(1),2 LOWER_STORE BIT(1),2
             16104            PORT_MASK_LOWER BIT(4),2 MASK_B BIT(9),2 * BIT(12),2
             16105    2   CYCLIC_PRIORITY BIT(7),2 * BIT(4),2 PORT_MASK_UPPER BIT(4);DCL H_SCU_BF(0:3)UBIN
             16105            WORD SYMREF;DCL H_CPU_BF(0:3)UBIN WORD SYMREF;DCL
             16106    2   H_PORT_FIRST_ADDR(0:3)UBIN WORD SYMREF;DCL H_MAXPORT# SBIN WORD SYMREF;DCL
             16106            H_PORTMASK BIT(72)SYMREF DALIGNED;DCL H_CODE UBIN WORD
             16107    2   SYMREF;DCL H_SYSID UBIN WORD SYMREF;DCL H_MODE UBIN WORD SYMREF;DCL H_PORT# UBIN
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:86   
             16107            WORD SYMREF;DCL H_SPROC# UBIN WORD SYMREF;DCL
             16108    2  H_SNAP SBIN WORD SYMREF;DCL H_SAVE_SS UBIN WORD SYMREF;DCL H_MAKE_IN_PROGRESS BIT(1)
             16108            SYMREF;DCL H_MIXED_MP SBIN SYMREF READONLY;DCL
             16109    2  H_MIXED_INT(0:6)SBIN SYMREF;DCL H_MIXED_TRO(0:6)SBIN SYMREF;DCL H_MIXED_FLT(0:6)SBIN
             16109            SYMREF;DCL H_MIXED_SSX(0:2)SBIN SYMREF;DCL
             16110    2  H_MIXED_SSS(0:2)SBIN SYMREF;DCL H_MIXED_RMIR(0:2)SBIN SYMREF;DCL H_DUMMY UBIN SYMREF
             16110            ;DCL H_RSW1(0:7)BIT(36)SYMREF ALIGNED;DCL H_RSW2
             16111    2   (0:7)BIT(36)SYMREF ALIGNED;DCL H_HRMODE(0:6)BIT(36)SYMREF READONLY ALIGNED;DCL
             16111            H_HRMODE_MASK(0:6)BIT(36)SYMREF READONLY ALIGNED;DCL
             16112    2   H_LUFREG(0:6)BIT(36)SYMREF ALIGNED;DCL H_LUFREG_MASK(0:6)BIT(36)SYMREF READONLY
             16112            ALIGNED;DCL H_RELOAD_CACHE UBIN WORD SYMREF;DCL
             16113    2  H_RELOAD_MODE UBIN WORD SYMREF;DCL 1 H_CNCTEVX SBIN SYMREF;DCL 1 H_CNCTEVBF(0:15)BIT
             16113            (72)SYMREF DALIGNED;DCL H_CNCTEVGATE BIT(72)
             16114    2   SYMREF DALIGNED;DCL 1 H_EDACHIST(0:63)SYMREF,2 SYND BIT(18),2 CT UBIN(18)UNAL;DCL
             16114            H_EDACUTS(0:63)UBIN WORD SYMREF;DCL H_FLTREG_MASK
             16115    2   (0:6)BIT(36)SYMREF READONLY ALIGNED;DCL H_EXTFLTREG_MASK(0:6)BIT(36)SYMREF READONLY
             16115            ALIGNED;DCL H_FLTREG(0:5)UBIN SYMREF;DCL
             16116    2   H_PERF_DATA(0:63)UBIN BYTE CALIGNED SYMREF READONLY;DCL 1 H_DPS8000_CPU_CONF_REG
             16116            DALIGNED SYMREF,2 * BIT(1),2 PORT_A_ENABLED BIT(1),
             16117    2   2 PORT_B_ENABLED BIT(1),2 PORT_A_INIT BIT(1),2 PORT_B_INIT BIT(1),2 ADDRESS_SPLIT
             16117            UBIN(4)UNAL,2 * BIT(63);DCL 1
             16118    2   H_DPS8000_SCU_CONF_REG DALIGNED SYMREF,2 * BIT(28),2 PORTS(0:7)BIT(1),2 * BIT(36);
             16118            DCL 1 H_DPS8000_SCU_INFO(0:1)SYMREF ALIGNED,2
             16119    2   LOWER_BOUND UBIN HALF UNAL,2 UPPER_BOUND UBIN HALF UNAL,2 PAGES UBIN HALF UNAL,2
             16119            SCU_STATUS,3 NOT_CONFIG BIT(1),3 REL_BIT BIT(1),3
             16120    2   REL_IN_PROGRESS BIT(1),3 RET_IN_PROGRESS BIT(1),3 LOW_MEM BIT(1),3 * BIT(13);DCL
             16120            H_DPS8000_CI_TABLE(0:3)UBIN SYMREF;DCL
             16121    2   H_DPS8000_CONFIG_NAME CHAR(12)SYMREF;DCL 1 H_RPM_CONNECT_TABLE DALIGNED SYMREF,2
             16121            ENTRI(0:23)UNAL,3 PORT# UBIN(3)UNAL,3 VALID BIT(1),
             16122    2   3 MBZ BIT(1),3 * BIT(1),3 IMXID UBIN(2)UNAL,3 SYSID UBIN(4)UNAL;DCL H_MAX_PERF UBIN
             16122            WORD SYMREF READONLY;DCL H_PERF(0:7)UBIN WORD
             16123    2  SYMREF;DCL EPU_MASK(0:3)BIT(36)ALIGNED SYMREF;DCL H_TIME_CORR BIT(72)DALIGNED SYMREF
             16123            ;DCL HW_PERF(0:6)UBIN WORD SYMREF READONLY;DCL
             16124    2   HW_PERF_SUB(0:6)UBIN WORD SYMREF READONLY;DCL HW_TYPE UBIN WORD SYMREF;DCL
             16124            HW_PTB_UNITS SBIN WORD SYMREF;DCL HW_IOPTP_UNITS SBIN
             16125    2   WORD SYMREF;DCL HW_WSQ0PT BIT(1)ALIGNED SYMREF;DCL HW_LOAD_FW BIT(1)ALIGNED SYMREF;
             16125            DCL HW_TIME_LEGAL BIT(1)ALIGNED SYMREF;DCL
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:87   
             16126    2  HW_SECT_PT BIT(1)ALIGNED SYMREF;DCL HW_FRAG_PT BIT(1)ALIGNED SYMREF;DCL HW_IOP BIT(1
             16126            )ALIGNED SYMREF;DCL HW_EXT_STATUS BIT(1)ALIGNED
             16127    2   SYMREF;DCL HW_SMART_CACHE BIT(1)ALIGNED SYMREF;DCL HW_ES BIT(1)ALIGNED SYMREF;DCL
             16127            HW_EI BIT(1)ALIGNED SYMREF;DCL HW_PROG_SCU BIT(1)
             16128    2  ALIGNED SYMREF;DCL HW_EDAC BIT(1)ALIGNED SYMREF;DCL HW_FLTIC_OK BIT(1)ALIGNED SYMREF
             16128            ;DCL HW_NORM_CLOCK BIT(1)ALIGNED SYMREF;DCL
             16129    2   HW_CHANS UBIN WORD ALIGNED SYMREF;DCL HW_IMX BIT(1)ALIGNED SYMREF;
             16130        %ELSE;
             16132        %ENDIF;
             16133    2   DCL B$HALF(0:0) UBIN HALF BASED HALIGNED;
             16134    2   DCL B$IPHYMAP$ PTR SYMREF;
             16135        /**/
             16136    2   DCL K UBIN;

  16136  1 001257                       LOOP         null
             16137        /**/
             16138    2   LOOP:;
             16139    2       IF PGNUM >= %CGQ_CHUNK_SIZE THEN

  16139  1 001257   200101 470500                    LDP0    @PGNUM,,AUTO
         1 001260   000000 235100                    LDA     0,,PR0
         1 001261   000012 115007                    CMPA    10,DL
         1 001262   001271 602000 1                  TNC     s:16145

             16140    3         DO;

             16141    3   LOOP1:
             16142    3         ASNUM=ASNUM+1;

  16142  1 001263   200100 470500       LOOP1        LDP0    @ASNUM,,AUTO
         1 001264   000000 235100                    LDA     0,,PR0
         1 001265   000001 035007                    ADLA    1,DL
         1 001266   000000 755100                    STA     0,,PR0

             16143    3         PGNUM=0;

  16143  1 001267   200101 471500                    LDP1    @PGNUM,,AUTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:88   
         1 001270   100000 450100                    STZ     0,,PR1

             16144    3         END;

             16145    2       IF ASNUM > KQM_MDPC# THEN ALTRETURN;

  16145  1 001271   200100 470500                    LDP0    @ASNUM,,AUTO
         1 001272   000000 235100                    LDA     0,,PR0
         1 001273   000032 115007                    CMPA    26,DL
         1 001274   001277 602000 1                  TNC     s:16146

  16145  1 001275   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 001276   000000 702211                    TSX2  ! 0,X1

             16146    2       IF NOT KQ$DSB.DESC.FLGR.PRESENT(ASNUM) THEN GOTO LOOP1;

  16146  1 001277   000000 720100                    LXL0    0,,PR0
         1 001300   000000 636010                    EAQ     0,X0
         1 001301   000021 772000                    QRL     17
         1 001302   200077 471500                    LDP1    @KQ$DSB,,AUTO
         1 001303   100002 236106                    LDQ     2,QL,PR1
         1 001304   000200 316007                    CANQ    128,DL
         1 001305   001263 600000 1                  TZE     LOOP1

             16147    2       K=KQ$DSB.DESC.BASE(ASNUM)/4096;

  16147  1 001306   000000 636010                    EAQ     0,X0
         1 001307   000021 772000                    QRL     17
         1 001310   100003 236106                    LDQ     3,QL,PR1
         1 001311   000014 772000                    QRL     12
         1 001312   200104 756100                    STQ     K,,AUTO

             16148    2       PPNO=B$CGPT$->B$MAP.RPN(K+PGNUM);

  16148  1 001313   200101 473500                    LDP3    @PGNUM,,AUTO
         1 001314   300000 036100                    ADLQ    0,,PR3
         1 001315   000000 474400 xsym               LDP4    B$CGPT$
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:89   
         1 001316   400000 236106                    LDQ     0,QL,PR4
         1 001317   000022 772000                    QRL     18
         1 001320   200103 475500                    LDP5    @PPNO,,AUTO
         1 001321   500000 756100                    STQ     0,,PR5

             16149    2       IF B$CGPT$->B$MAP.CTRL(K+PGNUM) & '40'O /* CPU PRESENT */ THEN

  16149  1 001322   200104 236100                    LDQ     K,,AUTO
         1 001323   300000 036100                    ADLQ    0,,PR3
         1 001324   000000 474400 xsym               LDP4    B$CGPT$
         1 001325   400000 236106                    LDQ     0,QL,PR4
         1 001326   000036 736000                    QLS     30
         1 001327   400000 376003                    ANQ     -131072,DU
         1 001330   001361 600000 1                  TZE     s:16163

             16150    3         DO;

             16151        %IF MON;
             16152    3         IF HW_WSQ0PT THEN

  16152  1 001331   000000 234000 xsym               SZN     HW_WSQ0PT
         1 001332   001341 605000 1                  TPL     s:16157

             16153              %ELSE;
             16155              %ENDIF;
             16156    3         PPNO=B$IPHYMAP$->B$HALF(PPNO);

  16156  1 001333   500000 235100                    LDA     0,,PR5
         1 001334   000001 735000                    ALS     1
         1 001335   000000 476400 xsym               LDP6    B$IPHYMAP$
         1 001336   000100 101505                    MRL     fill='000'O
         1 001337   600000 000002                    ADSC9   0,A,PR6                  cn=0,n=2
         1 001340   500000 000004                    ADSC9   0,,PR5                   cn=0,n=4

             16157    3         PTR$R.PG#=PGNUM;

  16157  1 001341   200102 474500                    LDP4    @PTR$,,AUTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:90   
         1 001342   300000 236100                    LDQ     0,,PR3
         1 001343   000034 736000                    QLS     28
         1 001344   400000 676100                    ERQ     0,,PR4
         1 001345   776000 376003                    ANQ     -1024,DU
         1 001346   400000 656100                    ERSQ    0,,PR4

             16158    3         PTR$R.SEGID=BITBIN(%AS0SID)+ASNUM;

  16158  1 001347   000000 236100                    LDQ     0,,PR0
         1 001350   004000 036007                    ADLQ    2048,DL
         1 001351   400000 752103                    STCQ    0,'03'O,PR4

             16159    3         PTR$R.GORGO=0;

  16159  1 001352   000042 236000 2                  LDQ     34
         1 001353   400000 356100                    ANSQ    0,,PR4

             16160    3         PGNUM=PGNUM+1;

  16160  1 001354   300000 235100                    LDA     0,,PR3
         1 001355   000001 035007                    ADLA    1,DL
         1 001356   300000 755100                    STA     0,,PR3

             16161    3         RETURN;

  16161  1 001357   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 001360   000001 702211                    TSX2  ! 1,X1

             16162    3         END;
             16163    2       PGNUM=PGNUM+1;

  16163  1 001361   300000 235100                    LDA     0,,PR3
         1 001362   000001 035007                    ADLA    1,DL
         1 001363   300000 755100                    STA     0,,PR3

             16164    2       GOTO LOOP;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:91   
  16164  1 001364   001257 710000 1                  TRA     LOOP

             16165    2   END FINDCGPAGE;
      519    16167        %SET LISTMAC='0'B;
      520    16168        /**/
      521    16169        /**/
      522    16170        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:92   
      523    16171        /*
      524    16172             TTTTT  EEEEE  RRRR   M   M   III   N   N   AAA   L
      525    16173               T    E      R   R  MM MM    I    N   N  A   A  L
      526    16174               T    E      R   R  M M M    I    NN  N  A   A  L
      527    16175               T    EEEE   RRRR   M   M    I    N N N  AAAAA  L
      528    16176               T    E      R R    M   M    I    N  NN  A   A  L
      529    16177               T    E      R  R   M   M    I    N   N  A   A  L
      530    16178               T    EEEEE  R   R  M   M   III   N   N  A   A  LLLLL
      531    16179
      532    16180
      533    16181         DDDD    III    SSS    CCC    OOO   N   N  N   N  EEEEE   CCC   TTTTT
      534    16182         D   D    I    S   S  C   C  O O O  N   N  N   N  E      C   C    T
      535    16183         D   D    I    S      C      O O O  NN  N  NN  N  E      C        T
      536    16184         D   D    I     SSS   C      O  OO  N N N  N N N  EEEE   C        T
      537    16185         D   D    I        S  C      O   O  N  NN  N  NN  E      C        T
      538    16186         D   D    I    S   S  C   C  O   O  N   N  N   N  E      C   C    T
      539    16187         DDDD    III    SSS    CCC    OOO   N   N  N   N  EEEEE   CCC     T
      540    16188
      541    16189        */
      542    16190        /*F* NAME:         KCO$DSCTRM
      543    16191             PURPOSE:      To complete disconnection of a terminal from
      544    16192                           a comgroup. */
      545    16193        /**/
      546    16194
      547    16195        /*D* NAME:         KCO$DSCTRM
      548    16196
      549    16197             CALL:         CALL KCO$DSCTRM(KQ$STA);
      550    16198
      551    16199             INPUT:        STA$ - Pointer to the station to disconnect.
      552    16200
      553    16201                           The current GET and PUT have been cleaned up.
      554    16202                           LOCKCNT in the station block has been set
      555    16203                           to 1 by the disconnect path, and must be
      556    16204                           counted down before we finish.  IDSC is
      557    16205                           set.
      558    16206
      559    16207                           Called from KQP$PUT.
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:93   
      560    16208
      561    16209             DESCRIPTION:  The indicated terminal is disconnected from the
      562    16210                           comgroup.  Messages written to this station are
      563    16211                           deleted and the station block is deleted.  The
      564    16212                           AU is told about the disconnect.  The total number
      565    16213                           terminals connected is decremented by one.
      566    16214        */
      567    16215
      568    16216
      569    16217    1   KCO$DSCTRM: ENTRY(FPT$);

  16217  1 001365   000000 700200 xent  KCO$DSCTRM   TSX0  ! X66_AUTO_1
         1 001366   000116 000001                    ZERO    78,1

      570    16218        /**/
      571    16219    1         STA$=ADDR(FPT$);

  16219  1 001367   200003 236100                    LDQ     @FPT$,,AUTO
         1 001370   200006 756100                    STQ     STA$,,AUTO

      572    16220    1         CTX$=KQ$STA.CG$;

  16220  1 001371   200006 470500                    LDP0    STA$,,AUTO
         1 001372   000007 236100                    LDQ     7,,PR0
         1 001373   200004 756100                    STQ     CTX$,,AUTO

      573    16221    1         LDCT$=STA$->KQ$STA.LDCT$;

  16221  1 001374   000010 236100                    LDQ     8,,PR0
         1 001375   200010 756100                    STQ     LDCT$,,AUTO

      574    16222    1         GOTO DSC0;

  16222  1 001376   001416 710000 1                  TRA     DSC0

      575    16223        /**/
      576    16224        /*F* NAME:         KCO$DSCTRMGO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:94   
      577    16225             PURPOSE:      To continue a terminal disconnect
      578    16226        */
      579    16227        /**/
      580    16228        /*D* NAME:         KCO$DSCTRMGO
      581    16229             CALL:         KCO$DSCTRMGO (KQ$STA)
      582    16230             INPUT:        KQ$STA.DSCREQW is reset, but was set before
      583    16231                           the call
      584    16232             DESCRIPTION:  If the comgroup control parameter DSCREQ is
      585    16233                           set, then terminals, instead of disconnecting
      586    16234                           when they want to, send a disconnect request
      587    16235                           to the AU (%CG_TDRQ), and then wait for him
      588    16236                           to respond with M$DEACTIVATE DSCGO.  Thus
      589    16237                           this routine is called from KCP$PMMES (the
      590    16238                           M$DEACTIVATE receiver), and from KCA$AU
      591    16239                           when the AU disconnects.  While the terminal
      592    16240                           is awaiting permission to disconnect, DSCREQW
      593    16241                           is set in its KQ$STA.
      594    16242                           DSCREQW only occurs for the RESCOD=NK_CGTRM
      595    16243                           LDCTs of regular or FPRG terminal stations
      596    16244                           therefore we must find the correct LDCT first. */
      597    16245    1   KCO$DSCTRMGO: ENTRY (FPT$);

  16245  1 001377   000000 700200 xent  KCO$DSCTRMGO TSX0  ! X66_AUTO_1
         1 001400   000116 000001                    ZERO    78,1

      598    16246        /**/
      599    16247    1         STA$=ADDR(FPT$);

  16247  1 001401   200003 236100                    LDQ     @FPT$,,AUTO
         1 001402   200006 756100                    STQ     STA$,,AUTO

      600    16248    1         CTX$=KQ$STA.CG$;

  16248  1 001403   200006 470500                    LDP0    STA$,,AUTO
         1 001404   000007 236100                    LDQ     7,,PR0
         1 001405   200004 756100                    STQ     CTX$,,AUTO

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:95   
      601    16249    1         IF KQ$STA.SAVLDCT$=ADDR(NIL)

  16249  1 001406   000031 236100                    LDQ     25,,PR0
         1 001407   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001410   001414 601000 1                  TNZ     s:16251

      602    16250    1         THEN LDCT$=STA$->KQ$STA.LDCT$;

  16250  1 001411   000010 236100                    LDQ     8,,PR0
         1 001412   200010 756100                    STQ     LDCT$,,AUTO
         1 001413   001415 710000 1                  TRA     s:16252

      603    16251    1         ELSE LDCT$=STA$->KQ$STA.SAVLDCT$;

  16251  1 001414   200010 756100                    STQ     LDCT$,,AUTO

      604    16252    1         GOTO DSC1;

  16252  1 001415   001426 710000 1                  TRA     DSC1

      605    16253        /**/
      606    16254    2   DSC0: IF KQ$STA.SAVLDCT$=ADDR(NIL) THEN DO;

  16254  1 001416   000031 236100       DSC0         LDQ     25,,PR0
         1 001417   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001420   001430 601000 1                  TNZ     s:16260

      607    16255    2   DSC2:   IF KQ$STA.CNNCTDDA ~= 0 THEN

  16255  1 001421   200006 470500       DSC2         LDP0    STA$,,AUTO
         1 001422   000021 235100                    LDA     17,,PR0
         1 001423   001426 600000 1                  TZE     DSC1

      608    16256    2            CALL RELCNNCT ALTRET(GETOUT);

  16256  1 001424   002263 701000 1                  TSX1    RELCNNCT
         1 001425   001622 702000 1                  TSX2    GETOUT
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:96   

      609    16257        /**/
      610    16258    2   DSC1:   CALL TELLAU ALTRET(GETOUT);

  16258  1 001426   002041 701000 1     DSC1         TSX1    TELLAU
         1 001427   001622 702000 1                  TSX2    GETOUT

      611    16259    2           END;

      612    16260    1         IF KQ_LOG.TSIO THEN

  16260  1 001430   000000 236000 xsym               LDQ     KQ_LOG
         1 001431   004000 316003                    CANQ    2048,DU
         1 001432   001461 600000 1                  TZE     s:16267

      613    16261    2           DO;

      614    16262    2           I=KQ$STA.LOCKCNT;

  16262  1 001433   200006 470500                    LDP0    STA$,,AUTO
         1 001434   000020 236100                    LDQ     16,,PR0
         1 001435   000777 376007                    ANQ     511,DL
         1 001436   200016 756100                    STQ     I,,AUTO

      615    16263    2           CALL KQZ$LOG (KQ$CG,%KQLOG_TDDN,0,I,0,

  16263  1 001437   200006 236100                    LDQ     STA$,,AUTO
         1 001440   000006 036003                    ADLQ    6,DU
         1 001441   200114 756100                    STQ     K+8,,AUTO
         1 001442   200006 236100                    LDQ     STA$,,AUTO
         1 001443   000005 036003                    ADLQ    5,DU
         1 001444   000001 235000 2                  LDA     1
         1 001445   200112 757100                    STAQ    K+6,,AUTO
         1 001446   200016 631500                    EPPR1   I,,AUTO
         1 001447   200111 451500                    STP1    K+5,,AUTO
         1 001450   000001 236000 2                  LDQ     1
         1 001451   200110 756100                    STQ     K+4,,AUTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:97   
         1 001452   000044 236000 2                  LDQ     36
         1 001453   200004 235100                    LDA     CTX$,,AUTO
         1 001454   200106 757100                    STAQ    K+2,,AUTO
         1 001455   200106 630500                    EPPR0   K+2,,AUTO
         1 001456   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 001457   000000 701000 xent               TSX1    KQZ$LOG
         1 001460   000000 011000                    NOP     0

      616    16264    2           SUBSTR(KQ$STA.BTN.KEY,0,4),
      617    16265    2           SUBSTR(KQ$STA.BTN.KEY,4,4));
      618    16266    2           END;

      619    16267    1         CALL SLOCK;

  16267  1 001461   001745 701000 1                  TSX1    SLOCK
         1 001462   000000 011000                    NOP     0

      620    16268    1         CALL STALOCK;

  16268  1 001463   001771 701000 1                  TSX1    STALOCK
         1 001464   000000 011000                    NOP     0

      621    16269    2         IF LDCT$=KQ$STA.LDCT$ THEN DO;

  16269  1 001465   200006 470500                    LDP0    STA$,,AUTO
         1 001466   200010 236100                    LDQ     LDCT$,,AUTO
         1 001467   000010 116100                    CMPQ    8,,PR0
         1 001470   001604 601000 1                  TNZ     s:16302

      622    16270    2           KQ$STA.LDCT$=ADDR(NIL);

  16270  1 001471   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001472   000010 756100                    STQ     8,,PR0

      623    16271    2           LDCT$->NK$LDCT.STA$=ADDR(NIL);

  16271  1 001473   200010 471500                    LDP1    LDCT$,,AUTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:98   
         1 001474   100012 756100                    STQ     10,,PR1

      624    16272    2           KQ$STA.IDSC='0'B;

  16272  1 001475   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 001476   000020 356100                    ANSQ    16,,PR0

      625    16273    3           IF KQ$STA.SAVLDCT$=ADDR(NIL) THEN DO;

  16273  1 001477   000031 236100                    LDQ     25,,PR0
         1 001500   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001501   001555 601000 1                  TNZ     s:16286

      626    16274    3             KQ$STA.LOCKCNT=KQ$STA.LOCKCNT-1;

  16274  1 001502   000020 236100                    LDQ     16,,PR0
         1 001503   000777 036007                    ADLQ    511,DL
         1 001504   000020 552104                    STBQ    16,'04'O,PR0

      627    16275    3             IF NOT KQ$CG.AUCTL.SMD THEN

  16275  1 001505   200004 473500                    LDP3    CTX$,,AUTO
         1 001506   300133 236100                    LDQ     91,,PR3
         1 001507   000002 316007                    CANQ    2,DL
         1 001510   001524 601000 1                  TNZ     s:16277

      628    16276    3              CALL KQL$DELMLH(KQ$CG,ADDR(KQ$STA.MLH));

  16276  1 001511   200006 236100                    LDQ     STA$,,AUTO
         1 001512   000034 036003                    ADLQ    28,DU
         1 001513   200106 756100                    STQ     K+2,,AUTO
         1 001514   200106 634500                    EPPR4   K+2,,AUTO
         1 001515   200111 454500                    STP4    K+5,,AUTO
         1 001516   200004 236100                    LDQ     CTX$,,AUTO
         1 001517   200110 756100                    STQ     K+4,,AUTO
         1 001520   200110 630500                    EPPR0   K+4,,AUTO
         1 001521   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:99   
         1 001522   000000 701000 xent               TSX1    KQL$DELMLH
         1 001523   000000 011000                    NOP     0

      629    16277    3             CALL STAUNLOCK;

  16277  1 001524   002003 701000 1                  TSX1    STAUNLOCK
         1 001525   000000 011000                    NOP     0

      630    16278    3             T$=STA$;

  16278  1 001526   200006 236100                    LDQ     STA$,,AUTO
         1 001527   200014 756100                    STQ     T$,,AUTO

      631    16279    3             CALL KQT$DELSTA(KQ$CG,T$);

  16279  1 001530   200014 630500                    EPPR0   T$,,AUTO
         1 001531   200107 450500                    STP0    K+3,,AUTO
         1 001532   200004 236100                    LDQ     CTX$,,AUTO
         1 001533   200106 756100                    STQ     K+2,,AUTO
         1 001534   200106 630500                    EPPR0   K+2,,AUTO
         1 001535   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001536   000000 701000 xent               TSX1    KQT$DELSTA
         1 001537   000000 011000                    NOP     0

      632    16280    3             CALL SUNLOCK;

  16280  1 001540   001757 701000 1                  TSX1    SUNLOCK
         1 001541   000000 011000                    NOP     0

      633    16281    3             CALL KQT$VALREADS (KQ$CG);

  16281  1 001542   200004 630500                    EPPR0   CTX$,,AUTO
         1 001543   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001544   000000 701000 xent               TSX1    KQT$VALREADS
         1 001545   000000 011000                    NOP     0

      634    16282    3             CALL KCD$PREL (LDCT$->NK$LDCT);
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:100  

  16282  1 001546   200010 630500                    EPPR0   LDCT$,,AUTO
         1 001547   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001550   000000 701000 xent               TSX1    KCD$PREL
         1 001551   000000 011000                    NOP     0

      635    16283    3             CALL TRMGONE;

  16283  1 001552   001632 701000 1                  TSX1    TRMGONE
         1 001553   000000 011000                    NOP     0

      636    16284    3             END;

  16284  1 001554   001622 710000 1                  TRA     GETOUT

      637    16285    3           ELSE DO;

      638    16286    3             KQ$STA.LDCT$=KQ$STA.SAVLDCT$;

  16286  1 001555   000010 756100                    STQ     8,,PR0

      639    16287    3             KQ$STA.SAVLDCT$=ADDR(NIL);

  16287  1 001556   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001557   000031 756100                    STQ     25,,PR0

      640    16288    4             IF KQ$STA.SAVIDSC THEN DO;

  16288  1 001560   000023 236100                    LDQ     19,,PR0
         1 001561   000400 316007                    CANQ    256,DL
         1 001562   001570 600000 1                  TZE     s:16295

      641    16289    4               KQ$STA.IDSC='1'B;

  16289  1 001563   400000 236003                    LDQ     -131072,DU
         1 001564   000020 256100                    ORSQ    16,,PR0

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:101  
      642    16290    4               KQ$STA.SAVIDSC='0'B;

  16290  1 001565   000045 236000 2                  LDQ     37
         1 001566   000023 356100                    ANSQ    19,,PR0

      643    16291                       /* Don't count down LOCKCNT since we will soon be back        */
      644    16292                       /* through here again as the KQ$STA.LDCT$ path and will       */
      645    16293                       /* count it down then.                                        */
      646    16294    4               END;

  16294  1 001567   001573 710000 1                  TRA     s:16296

      647    16295    3             ELSE KQ$STA.LOCKCNT=KQ$STA.LOCKCNT-1;

  16295  1 001570   000020 236100                    LDQ     16,,PR0
         1 001571   000777 036007                    ADLQ    511,DL
         1 001572   000020 552104                    STBQ    16,'04'O,PR0

      648    16296    3             CALL STAUNLOCK;

  16296  1 001573   002003 701000 1                  TSX1    STAUNLOCK
         1 001574   000000 011000                    NOP     0

      649    16297    3             CALL SUNLOCK;

  16297  1 001575   001757 701000 1                  TSX1    SUNLOCK
         1 001576   000000 011000                    NOP     0

      650    16298    3             CALL KCD$PREL(LDCT$->NK$LDCT);

  16298  1 001577   200010 630500                    EPPR0   LDCT$,,AUTO
         1 001600   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001601   000000 701000 xent               TSX1    KCD$PREL
         1 001602   000000 011000                    NOP     0

      651    16299    3             END;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:102  
      652    16300    2           END;

  16300  1 001603   001622 710000 1                  TRA     GETOUT

      653    16301    2         ELSE DO; /* LDCT$=KQ$STA.SAVLDCT$ */

      654    16302    2           KQ$STA.SAVLDCT$=ADDR(NIL);

  16302  1 001604   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001605   000031 756100                    STQ     25,,PR0

      655    16303    2           LDCT$->NK$LDCT.STA$=ADDR(NIL);

  16303  1 001606   200010 471500                    LDP1    LDCT$,,AUTO
         1 001607   100012 756100                    STQ     10,,PR1

      656    16304    2           KQ$STA.SAVIDSC='0'B;

  16304  1 001610   000045 236000 2                  LDQ     37
         1 001611   000023 356100                    ANSQ    19,,PR0

      657    16305    2           CALL STAUNLOCK;

  16305  1 001612   002003 701000 1                  TSX1    STAUNLOCK
         1 001613   000000 011000                    NOP     0

      658    16306    2           CALL SUNLOCK;

  16306  1 001614   001757 701000 1                  TSX1    SUNLOCK
         1 001615   000000 011000                    NOP     0

      659    16307    2           CALL KCD$PREL(LDCT$->NK$LDCT);

  16307  1 001616   200010 630500                    EPPR0   LDCT$,,AUTO
         1 001617   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001620   000000 701000 xent               TSX1    KCD$PREL
         1 001621   000000 011000                    NOP     0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:103  

      660    16308    2           END;

  16303  1 001622                       GETOUT       null
      661    16309    1   GETOUT:;
      662    16310    1         RETURN;

  16310  1 001622   000000 702200 xent               TSX2  ! X66_ARET

      663    16311        /**/
      664    16312        /*F* NAME:         KCO$TRMGONE
      665    16313             PURPOSE:      To process a terminal station's departure from
      666    16314                           its comgroup
      667    16315             DESCRIPTION:  NUMTERMS is counted down.  If it hits zero, then
      668    16316                           if the last DCB user is waiting to close, we
      669    16317                           unblock him. */
      670    16318    1   KCO$TRMGONE: ENTRY (FPT$);

  16318  1 001623   000000 700200 xent  KCO$TRMGONE  TSX0  ! X66_AUTO_1
         1 001624   000116 000001                    ZERO    78,1

      671    16319        /**/
      672    16320    1         CTX$=ADDR(FPT$);

  16320  1 001625   200003 236100                    LDQ     @FPT$,,AUTO
         1 001626   200004 756100                    STQ     CTX$,,AUTO

      673    16321    1         CALL TRMGONE;

  16321  1 001627   001632 701000 1                  TSX1    TRMGONE
         1 001630   000000 011000                    NOP     0

      674    16322    1         RETURN;

  16322  1 001631   000000 702200 xent               TSX2  ! X66_ARET

      675    16323        /**/
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:104  
      676    16324    1   TRMGONE: PROC;

  16324  1 001632   200076 741300       TRMGONE      STX1  ! COMGRP+37,,AUTO

      677    16325        /**/
      678    16326    2         CALL GLOCK;

  16326  1 001633   002015 701000 1                  TSX1    GLOCK
         1 001634   000000 011000                    NOP     0

      679    16327    2         KQ$CG.STATS.NUMTERMS=KQ$CG.STATS.NUMTERMS-1;

  16327  1 001635   200004 470500                    LDP0    CTX$,,AUTO
         1 001636   000001 336007                    LCQ     1,DL
         1 001637   000174 056100                    ASQ     124,,PR0

      680    16328    2         IF KQ$CG.STATS.NUMTERMS=0 AND KQ$CG.LASTUSER~=0 THEN

  16328  1 001640   001666 601000 1                  TNZ     s:16336
         1 001641   000216 236100                    LDQ     142,,PR0
         1 001642   777000 316007                    CANQ    -512,DL
         1 001643   001666 600000 1                  TZE     s:16336

      681    16329    3           DO;

      682    16330    3           USR=KQ$CG.LASTUSER;

  16330  1 001644   000216 236100                    LDQ     142,,PR0
         1 001645   000011 772000                    QRL     9
         1 001646   000777 376007                    ANQ     511,DL
         1 001647   000033 736000                    QLS     27
         1 001650   200020 756100                    STQ     USR,,AUTO

      683    16331    3           KQ$CG.LASTUSER=0;

  16331  1 001651   000000 236003                    LDQ     0,DU
         1 001652   000216 552110                    STBQ    142,'10'O,PR0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:105  

      684    16332    3           CALL GUNLOCK;

  16332  1 001653   002027 701000 1                  TSX1    GUNLOCK
         1 001654   000000 011000                    NOP     0

      685    16333    3           CALL SSR$RUE(%SS_UQA,USR);

  16333  1 001655   200020 630500                    EPPR0   USR,,AUTO
         1 001656   200107 450500                    STP0    K+3,,AUTO
         1 001657   000047 236000 2                  LDQ     39
         1 001660   200106 756100                    STQ     K+2,,AUTO
         1 001661   200106 630500                    EPPR0   K+2,,AUTO
         1 001662   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001663   000000 701000 xent               TSX1    SSR$RUE
         1 001664   000000 011000                    NOP     0

      686    16334    3           END;

  16334  1 001665   001670 710000 1                  TRA     s:16337

      687    16335    2         ELSE
      688    16336    2          CALL GUNLOCK;

  16336  1 001666   002027 701000 1                  TSX1    GUNLOCK
         1 001667   000000 011000                    NOP     0

      689    16337    2         RETURN;

  16337  1 001670   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 001671   000001 702211                    TSX2  ! 1,X1

      690    16338    2   END TRMGONE;
      691    16339        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:106  
      692    16340        /**/
      693    16341        /*F* NAME:         KCO$DDISC
      694    16342             PURPOSE:      To continue delayed terminal disconnect
      695    16343        */
      696    16344        /**/
      697    16345        /*D* NAME:         KCO$DDISC
      698    16346             CALL:         KCO$DDISC (KQ$STA);
      699    16347             DESCRIPTION:  If terminal disconnect must be delayed for
      700    16348                           any reason, KQ$STA.DDISC is set, and this
      701    16349                           routine is called later from KCC$CLOCK.
      702    16350                           Since we only ever call TELLAU and RELCNNCT
      703    16351                           for the RESCOD=NK_CGTRM LDCT, we must first
      704    16352                           find it before continuing as it may be either
      705    16353                           KQ$STA.LDCT$ or KQ$STA.SAVLDCT$.
      706    16354        */
      707    16355    1   KCO$DDISC: ENTRY (FPT$);

  16355  1 001672   000000 700200 xent  KCO$DDISC    TSX0  ! X66_AUTO_1
         1 001673   000116 000001                    ZERO    78,1

      708    16356        /**/
      709    16357    1         STA$=ADDR(FPT$);

  16357  1 001674   200003 236100                    LDQ     @FPT$,,AUTO
         1 001675   200006 756100                    STQ     STA$,,AUTO

      710    16358    1         CTX$=KQ$STA.CG$;

  16358  1 001676   200006 470500                    LDP0    STA$,,AUTO
         1 001677   000007 236100                    LDQ     7,,PR0
         1 001700   200004 756100                    STQ     CTX$,,AUTO

      711    16359    1         IF KQ$STA.SAVLDCT$=ADDR(NIL)

  16359  1 001701   000031 236100                    LDQ     25,,PR0
         1 001702   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001703   001707 601000 1                  TNZ     s:16361
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:107  

      712    16360    1         THEN LDCT$=KQ$STA.LDCT$;

  16360  1 001704   000010 236100                    LDQ     8,,PR0
         1 001705   200010 756100                    STQ     LDCT$,,AUTO
         1 001706   001710 710000 1                  TRA     s:16362

      713    16361    1         ELSE LDCT$=KQ$STA.SAVLDCT$;

  16361  1 001707   200010 756100                    STQ     LDCT$,,AUTO

      714    16362    2           DO CASE (KQ$STA.DDISC);

  16362  1 001710   000023 236100                    LDQ     19,,PR0
         1 001711   000016 772000                    QRL     14
         1 001712   000003 376007                    ANQ     3,DL
         1 001713   000003 116007                    CMPQ    3,DL
         1 001714   001716 602006 1                  TNC     s:16362+6,QL
         1 001715   001723 710000 1                  TRA     s:16369
         1 001716   001723 710000 1                  TRA     s:16369
         1 001717   001721 710000 1                  TRA     s:16365
         1 001720   001722 710000 1                  TRA     s:16367

      715    16363
      716    16364    2             CASE (1);

      717    16365    2               GOTO DSC1;

  16365  1 001721   001426 710000 1                  TRA     DSC1

      718    16366    2             CASE (2);

      719    16367    2               GOTO DSC2;

  16367  1 001722   001421 710000 1                  TRA     DSC2

      720    16368    2           END;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:108  

      721    16369    1         RETURN;

  16369  1 001723   000000 702200 xent               TSX2  ! X66_ARET

      722    16370        /**/
      723    16371        /*F* NAME:         KCO$RCNNCT
      724    16372             PURPOSE:      To release a station's connect info
      725    16373        */
      726    16374        /**/
      727    16375        /*D* NAME:         KCO$RCNNCT
      728    16376             CALL:         KCO$RCNNCT (KQ$STA)
      729    16377             ENVIRONMENT:  User
      730    16378             DESCRIPTION:  The station can be either TERM or DCB, but
      731    16379                           we must be running on behalf of a user.
      732    16380                           The connect info is released from the data cache.
      733    16381        */
      734    16382    1   KCO$RCNNCT: ENTRY (FPT$);

  16382  1 001724   000000 700200 xent  KCO$RCNNCT   TSX0  ! X66_AUTO_1
         1 001725   000116 000001                    ZERO    78,1

      735    16383        /**/
      736    16384    1         STA$=ADDR(FPT$);

  16384  1 001726   200003 236100                    LDQ     @FPT$,,AUTO
         1 001727   200006 756100                    STQ     STA$,,AUTO

      737    16385    1         CTX$=KQ$STA.CG$;

  16385  1 001730   200006 470500                    LDP0    STA$,,AUTO
         1 001731   000007 236100                    LDQ     7,,PR0
         1 001732   200004 756100                    STQ     CTX$,,AUTO

      738    16386    1         CALL RELCNNCTUSR;

  16386  1 001733   002334 701000 1                  TSX1    RELCNNCTUSR
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:109  
         1 001734   000000 011000                    NOP     0

      739    16387    1         RETURN;

  16387  1 001735   000000 702200 xent               TSX2  ! X66_ARET

      740    16388        /**/
      741    16389        /*F* NAME:         KCO$ABORTEM
      742    16390             PURPOSE:      To blow away all stations on a comgroup
      743    16391        */
      744    16392        /**/
      745    16393        /*D* NAME:         KCO$ABORTEM
      746    16394             CALL:         KCO$ABORTEM (KQ$CG)
      747    16395             ENVIRONMENT:  Must be on master CPU (since we call KQC$CLOSESTA
      748    16396                           which calls KCD$RELTRM).
      749    16397             DESCRIPTION:  See ABORTEM
      750    16398        */
      751    16399    1   KCO$ABORTEM: ENTRY (FPT$);

  16399  1 001736   000000 700200 xent  KCO$ABORTEM  TSX0  ! X66_AUTO_1
         1 001737   000116 000001                    ZERO    78,1

      752    16400        /**/
      753    16401    1         CTX$=ADDR(FPT$);

  16401  1 001740   200003 236100                    LDQ     @FPT$,,AUTO
         1 001741   200004 756100                    STQ     CTX$,,AUTO

      754    16402    1         CALL ABORTEM;

  16402  1 001742   002402 701000 1                  TSX1    ABORTEM
         1 001743   000000 011000                    NOP     0

      755    16403    1         RETURN;

  16403  1 001744   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:110  
      756    16404        %EJECT;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:111  
      757    16405        /**/
      758    16406        /******************************************************************************
      759    16407        *                                                                             *
      760    16408        *  SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS  *
      761    16409        * S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S *
      762    16410        * S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S     *
      763    16411        *  SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS  *
      764    16412        *     S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S *
      765    16413        * S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S *
      766    16414        *  SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS  *
      767    16415        *                                                                             *
      768    16416        ******************************************************************************/
      769    16417
      770    16418        /****************************************************************
      771    16419        *****************************************************************/
      772    16420        /*D* NAME:         SLOCK, SUNLOCK, STALOCK, STAUNLOCK, GLOCK, GUNLOCK
      773    16421             PURPOSE:      To lock/unlock various gates. */
      774    16422    1   SLOCK: PROC;

  16422  1 001745   200102 741300       SLOCK        STX1  ! @PTR$,,AUTO

      775    16423        /**/
      776    16424        %LOCK (G=KQ$CG.STREE.GATE);

  16425  1 001746   200004 236100                    LDQ     CTX$,,AUTO
         1 001747   000075 036003                    ADLQ    61,DU
         1 001750   200106 756100                    STQ     K+2,,AUTO
         1 001751   200106 630500                    EPPR0   K+2,,AUTO
         1 001752   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001753   000000 701000 xent               TSX1    HFC$LOCK
         1 001754   000000 011000                    NOP     0

      777    16427    2         RETURN;

  16427  1 001755   200102 221300                    LDX1  ! @PTR$,,AUTO
         1 001756   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:112  
      778    16428    2   SUNLOCK: ENTRY;

  16428  1 001757   200102 741300       SUNLOCK      STX1  ! @PTR$,,AUTO

      779    16429        /**/
      780    16430              %UNLOCK (G=KQ$CG.STREE.GATE);

  16431  1 001760   200004 236100                    LDQ     CTX$,,AUTO
         1 001761   000075 036003                    ADLQ    61,DU
         1 001762   200106 756100                    STQ     K+2,,AUTO
         1 001763   200106 630500                    EPPR0   K+2,,AUTO
         1 001764   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001765   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001766   000000 011000                    NOP     0

      781    16433    2         RETURN;

  16433  1 001767   200102 221300                    LDX1  ! @PTR$,,AUTO
         1 001770   000001 702211                    TSX2  ! 1,X1

      782    16434    2   STALOCK: ENTRY;

  16434  1 001771   200102 741300       STALOCK      STX1  ! @PTR$,,AUTO

      783    16435        /**/
      784    16436              %LOCK (G=KQ$STA.GATE);

  16437  1 001772   200006 236100                    LDQ     STA$,,AUTO
         1 001773   000016 036003                    ADLQ    14,DU
         1 001774   200106 756100                    STQ     K+2,,AUTO
         1 001775   200106 630500                    EPPR0   K+2,,AUTO
         1 001776   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001777   000000 701000 xent               TSX1    HFC$LOCK
         1 002000   000000 011000                    NOP     0

      785    16439    2         RETURN;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:113  
  16439  1 002001   200102 221300                    LDX1  ! @PTR$,,AUTO
         1 002002   000001 702211                    TSX2  ! 1,X1

      786    16440    2   STAUNLOCK: ENTRY;

  16440  1 002003   200102 741300       STAUNLOCK    STX1  ! @PTR$,,AUTO

      787    16441        /**/
      788    16442              %UNLOCK (G=KQ$STA.GATE);

  16443  1 002004   200006 236100                    LDQ     STA$,,AUTO
         1 002005   000016 036003                    ADLQ    14,DU
         1 002006   200106 756100                    STQ     K+2,,AUTO
         1 002007   200106 630500                    EPPR0   K+2,,AUTO
         1 002010   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002011   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002012   000000 011000                    NOP     0

      789    16445    2         RETURN;

  16445  1 002013   200102 221300                    LDX1  ! @PTR$,,AUTO
         1 002014   000001 702211                    TSX2  ! 1,X1

      790    16446    2   GLOCK: ENTRY;

  16446  1 002015   200102 741300       GLOCK        STX1  ! @PTR$,,AUTO

      791    16447        /**/
      792    16448              %LOCK (G=KQ$CG.GATE.CG);

  16449  1 002016   200004 236100                    LDQ     CTX$,,AUTO
         1 002017   000107 036003                    ADLQ    71,DU
         1 002020   200106 756100                    STQ     K+2,,AUTO
         1 002021   200106 630500                    EPPR0   K+2,,AUTO
         1 002022   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002023   000000 701000 xent               TSX1    HFC$LOCK
         1 002024   000000 011000                    NOP     0
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:114  

      793    16451    2         RETURN;

  16451  1 002025   200102 221300                    LDX1  ! @PTR$,,AUTO
         1 002026   000001 702211                    TSX2  ! 1,X1

      794    16452    2   GUNLOCK: ENTRY;

  16452  1 002027   200102 741300       GUNLOCK      STX1  ! @PTR$,,AUTO

      795    16453        /**/
      796    16454              %UNLOCK (G=KQ$CG.GATE.CG);

  16455  1 002030   200004 236100                    LDQ     CTX$,,AUTO
         1 002031   000107 036003                    ADLQ    71,DU
         1 002032   200106 756100                    STQ     K+2,,AUTO
         1 002033   200106 630500                    EPPR0   K+2,,AUTO
         1 002034   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002035   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002036   000000 011000                    NOP     0

      797    16457    2         RETURN;

  16457  1 002037   200102 221300                    LDX1  ! @PTR$,,AUTO
         1 002040   000001 702211                    TSX2  ! 1,X1

      798    16458    2   END SLOCK;
      799    16459        /****************************************************************
      800    16460        *****************************************************************/
      801    16461        /*D* NAME:         TELLAU
      802    16462             PURPOSE:      To tell the AU about a terminal disconnect
      803    16463             DESCRIPTION:  Just returns if we never managed to tell the
      804    16464                           AU about the terminal connect yet.  Else
      805    16465                           gets an MBLK.  If this works, we're ready to
      806    16466                           tell the AU.
      807    16467
      808    16468                           What we tell him depends on the comgroup
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:115  
      809    16469                           control param DSCREQ.  If it's on, then the
      810    16470                           first time thru here we report CG_TDRQ and
      811    16471                           ALTRET (which halts the disconnect until
      812    16472                           we're entered at KCO$DSCTRMGO) after setting
      813    16473                           a flag to indicate TDRQ already reported.
      814    16474                           Next time thru, or if DSCREQ is off, we
      815    16475                           report CG_TDSC (true disconnect) and RETURN
      816    16476                           to continue disconnecting.
      817    16477
      818    16478                           If no MBLK can be obtained, then we post a delayed
      819    16479                           memory request on behalf of the station, and
      820    16480                           ALTRET, setting KQ$STA.DDISC to 1 and
      821    16481                           KQ$CG.DELAY.DDISC.  This will cause KCO$DDISC
      822    16482                           to be called once per second, and when it is
      823    16483                           we'll come back here to check the status of
      824    16484                           our delayed memory request.  If it has failed
      825    16485                           then the garbage collector has already run
      826    16486                           and so there's no hope so we just return.
      827    16487        */
      828    16488    1   TELLAU: PROC ALTRET;

  16488  1 002041   200076 741300       TELLAU       STX1  ! COMGRP+37,,AUTO

      829    16489        /**/
      830    16490    2   DCL CODE UBIN;
      831    16491    2   DCL J SBIN;
      832    16492        /**/
      833    16493    2         IF NOT KQ$STA.TOLDAU THEN RETURN;

  16493  1 002042   200006 470500                    LDP0    STA$,,AUTO
         1 002043   000020 236100                    LDQ     16,,PR0
         1 002044   004000 316003                    CANQ    2048,DU
         1 002045   002047 601000 1                  TNZ     s:16495

  16493  1 002046   000001 702211                    TSX2  ! 1,X1

      834    16494        /**/
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:116  
      835    16495    2         J=KQ$STA.MREQ;

  16495  1 002047   000020 236100                    LDQ     16,,PR0
         1 002050   000011 736000                    QLS     9
         1 002051   000033 732000                    QRS     27
         1 002052   200100 756100                    STQ     J,,AUTO

      836    16496    2         IF J > 0 THEN

  16496  1 002053   002071 604400 1                  TMOZ    s:16507

      837    16497    3           DO;

      838    16498    3           IF J ~= KQMR_MBLK# THEN CALL SC_BCGDSC;

  16498  1 002054   000001 116007                    CMPQ    1,DL
         1 002055   002060 600000 1                  TZE     s:16504

  16498  1 002056   000000 713400 xsym               CLIMB   SC_BCGDSC
         1 002057   000000 600000 xsid               climb   nvectors=         0

      839    16499        /*S* SCREECH_CODE: KCO-S$BCGDSC
      840    16500             TYPE:         SCREECH
      841    16501             MESSAGE:      COMGROUP terminal disconnect error
      842    16502             REMARKS:      An inconsistency has been found when attempting
      843    16503                           to disconnect a terminal. */
      844    16504    3           IF KQ$STA.DDISC ~= 1 THEN CALL SC_BCGDSC;

  16504  1 002060   200006 470500                    LDP0    STA$,,AUTO
         1 002061   000023 236100                    LDQ     19,,PR0
         1 002062   140000 376007                    ANQ     49152,DL
         1 002063   040000 116007                    CMPQ    16384,DL
         1 002064   002067 600000 1                  TZE     s:16505

  16504  1 002065   000000 713400 xsym               CLIMB   SC_BCGDSC
         1 002066   000000 600000 xsid               climb   nvectors=         0

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:117  
      845    16505    3           ALTRETURN;

  16505  1 002067   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 002070   000000 702211                    TSX2  ! 0,X1

      846    16506    3           END;
      847    16507    2         ELSE IF J < 0 THEN

  16507  1 002071   002122 605000 1                  TPL     s:16520

      848    16508    3            DO;

      849    16509    3            IF KQ$STA.DDISC ~= 1

  16509  1 002072   000023 236100                    LDQ     19,,PR0
         1 002073   140000 376007                    ANQ     49152,DL
         1 002074   040000 116007                    CMPQ    16384,DL
         1 002075   002101 601000 1                  TNZ     s:16510
         1 002076   200100 235100                    LDA     J,,AUTO
         1 002077   000027 115000 xsym               CMPA    B_VECTNIL+23
         1 002100   002103 600000 1                  TZE     s:16511

      850    16510    3            OR J ~= -KQMR_MBLK# THEN CALL SC_BCGDSC;

  16510  1 002101   000000 713400 xsym               CLIMB   SC_BCGDSC
         1 002102   000000 600000 xsid               climb   nvectors=         0

      851    16511    3            CALL STALOCK;

  16511  1 002103   001771 701000 1                  TSX1    STALOCK
         1 002104   000000 011000                    NOP     0

      852    16512    3            T$=KQ$STA.MREQ$;

  16512  1 002105   200006 470500                    LDP0    STA$,,AUTO
         1 002106   000024 236100                    LDQ     20,,PR0
         1 002107   200014 756100                    STQ     T$,,AUTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:118  

      853    16513    3            KQ$STA.MREQ$=ADDR(NIL);

  16513  1 002110   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002111   000024 756100                    STQ     20,,PR0

      854    16514    3            KQ$STA.DDISC=0;

  16514  1 002112   000050 236000 2                  LDQ     40
         1 002113   000023 356100                    ANSQ    19,,PR0

      855    16515    3            CALL STAUNLOCK;

  16515  1 002114   002003 701000 1                  TSX1    STAUNLOCK
         1 002115   000000 011000                    NOP     0

      856    16516    3            IF T$ = ADDR(NIL) THEN GOTO TELLDONE;

  16516  1 002116   200014 236100                    LDQ     T$,,AUTO
         1 002117   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002120   002234 600000 1                  TZE     TELLDONE

      857    16517    3            END;

  16517  1 002121   002146 710000 1                  TRA     s:16525

      858    16518    2          ELSE
      859    16519    3            DO;

      860    16520    3            IF KQ$STA.DDISC = 1 THEN CALL SC_BCGDSC;

  16520  1 002122   000023 236100                    LDQ     19,,PR0
         1 002123   140000 376007                    ANQ     49152,DL
         1 002124   040000 116007                    CMPQ    16384,DL
         1 002125   002130 601000 1                  TNZ     s:16521

  16520  1 002126   000000 713400 xsym               CLIMB   SC_BCGDSC
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:119  
         1 002127   000000 600000 xsid               climb   nvectors=         0

      861    16521    3            J=KQMR_MBLK#;

  16521  1 002130   000001 235007                    LDA     1,DL
         1 002131   200100 755100                    STA     J,,AUTO

      862    16522    3            T$=STA$;

  16522  1 002132   200006 236100                    LDQ     STA$,,AUTO
         1 002133   200014 756100                    STQ     T$,,AUTO

      863    16523    3            CALL KQM$GETBD (KQ$CG,T$,J) ALTRET(NOM);

  16523  1 002134   200100 630500                    EPPR0   J,,AUTO
         1 002135   200110 450500                    STP0    K+4,,AUTO
         1 002136   200014 631500                    EPPR1   T$,,AUTO
         1 002137   200107 451500                    STP1    K+3,,AUTO
         1 002140   200004 236100                    LDQ     CTX$,,AUTO
         1 002141   200106 756100                    STQ     K+2,,AUTO
         1 002142   200106 630500                    EPPR0   K+2,,AUTO
         1 002143   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002144   000000 701000 xent               TSX1    KQM$GETBD
         1 002145   002241 702000 1                  TSX2    NOM

      864    16524    3            END;

      865    16525    2         CALL STALOCK;

  16525  1 002146   001771 701000 1                  TSX1    STALOCK
         1 002147   000000 011000                    NOP     0

      866    16526    2         CALL GLOCK;

  16526  1 002150   002015 701000 1                  TSX1    GLOCK
         1 002151   000000 011000                    NOP     0

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:120  
      867    16527    2         KQ$STA.MBLK$=T$;

  16527  1 002152   200014 236100                    LDQ     T$,,AUTO
         1 002153   200006 470500                    LDP0    STA$,,AUTO
         1 002154   000012 756100                    STQ     10,,PR0

      868    16528    2         CODE=%CG_TDSC#;

  16528  1 002155   000003 235007                    LDA     3,DL
         1 002156   200077 755100                    STA     CODE,,AUTO

      869    16529    2         IF KQ$STA.LDCT$->NK$LDCT.DFLG.SYMBIONT THEN

  16529  1 002157   000010 471500                    LDP1    8,,PR0
         1 002160   100006 236100                    LDQ     6,,PR1
         1 002161   020000 316007                    CANQ    8192,DL
         1 002162   002165 600000 1                  TZE     s:16531

      870    16530    2          CODE=%CG_STDSC#;

  16530  1 002163   000012 235007                    LDA     10,DL
         1 002164   200077 755100                    STA     CODE,,AUTO

      871    16531    2         IF KQ$STA.DSCREQW THEN CALL SC_BCGDSC;

  16531  1 002165   000023 236100                    LDQ     19,,PR0
         1 002166   020000 316007                    CANQ    8192,DL
         1 002167   002172 600000 1                  TZE     s:16532

  16531  1 002170   000000 713400 xsym               CLIMB   SC_BCGDSC
         1 002171   000000 600000 xsid               climb   nvectors=         0

      872    16532    2         IF  KQ$CG.AUCTL.DSCREQ

  16532  1 002172   200004 470500                    LDP0    CTX$,,AUTO
         1 002173   000136 236100                    LDQ     94,,PR0
         1 002174   002000 316003                    CANQ    1024,DU
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:121  
         1 002175   002213 600000 1                  TZE     s:16540
         1 002176   000121 236100                    LDQ     81,,PR0
         1 002177   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002200   002213 600000 1                  TZE     s:16540

      873    16533    2         AND KQ$CG.AUSTA$ ~= ADDR(NIL) THEN
      874    16534    2          IF NOT KQ$STA.DSCREQS THEN

  16534  1 002201   200006 471500                    LDP1    STA$,,AUTO
         1 002202   100023 236100                    LDQ     19,,PR1
         1 002203   010000 316007                    CANQ    4096,DL
         1 002204   002213 601000 1                  TNZ     s:16540

      875    16535    3            DO;

      876    16536    3            KQ$STA.DSCREQS='1'B;

  16536  1 002205   010000 236007                    LDQ     4096,DL
         1 002206   100023 256100                    ORSQ    19,,PR1

      877    16537    3            KQ$STA.DSCREQW='1'B;

  16537  1 002207   020000 236007                    LDQ     8192,DL
         1 002210   100023 256100                    ORSQ    19,,PR1

      878    16538    3            CODE=%CG_TDRQ#;

  16538  1 002211   000026 235007                    LDA     22,DL
         1 002212   200077 755100                    STA     CODE,,AUTO

      879    16539    3            END;

      880    16540    2         CALL GUNLOCK;

  16540  1 002213   002027 701000 1                  TSX1    GUNLOCK
         1 002214   000000 011000                    NOP     0

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:122  
      881    16541    2         CALL STAUNLOCK;

  16541  1 002215   002003 701000 1                  TSX1    STAUNLOCK
         1 002216   000000 011000                    NOP     0

      882    16542    2         CALL KCA$TELLAUM (KQ$STA,CODE);

  16542  1 002217   200077 630500                    EPPR0   CODE,,AUTO
         1 002220   200107 450500                    STP0    K+3,,AUTO
         1 002221   200006 236100                    LDQ     STA$,,AUTO
         1 002222   200106 756100                    STQ     K+2,,AUTO
         1 002223   200106 630500                    EPPR0   K+2,,AUTO
         1 002224   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002225   000000 701000 xent               TSX1    KCA$TELLAUM
         1 002226   000000 011000                    NOP     0

      883    16543    2         IF CODE = %CG_TDRQ# THEN ALTRETURN;

  16543  1 002227   200077 235100                    LDA     CODE,,AUTO
         1 002230   000026 115007                    CMPA    22,DL
         1 002231   002234 601000 1                  TNZ     TELLDONE

  16543  1 002232   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 002233   000000 702211                    TSX2  ! 0,X1

  16543  1 002234                       TELLDONE     null
      884    16544    2   TELLDONE: ;
      885    16545    2         KQ$STA.TOLDAU='0'B;

  16545  1 002234   200006 470500                    LDP0    STA$,,AUTO
         1 002235   000012 236000 2                  LDQ     10
         1 002236   000020 356100                    ANSQ    16,,PR0

      886    16546    2         RETURN;

  16546  1 002237   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 002240   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:123  

      887    16547    2   NOM:  CALL STALOCK;

  16547  1 002241   001771 701000 1     NOM          TSX1    STALOCK
         1 002242   000000 011000                    NOP     0

      888    16548    2         KQ$STA.DDISC=1;   /* No MBLK available to tell AU with                 */

  16548  1 002243   200006 470500                    LDP0    STA$,,AUTO
         1 002244   000023 236100                    LDQ     19,,PR0
         1 002245   000050 376000 2                  ANQ     40
         1 002246   040000 276007                    ORQ     16384,DL
         1 002247   000023 756100                    STQ     19,,PR0

      889    16549    2         CALL STAUNLOCK;

  16549  1 002250   002003 701000 1                  TSX1    STAUNLOCK
         1 002251   000000 011000                    NOP     0

      890    16550    2   DX:   CALL GLOCK;

  16550  1 002252   002015 701000 1     DX           TSX1    GLOCK
         1 002253   000000 011000                    NOP     0

      891    16551    2         KQ$CG.DELAY.DDISC='1'B;

  16551  1 002254   200004 470500                    LDP0    CTX$,,AUTO
         1 002255   004000 236003                    LDQ     2048,DU
         1 002256   000020 256100                    ORSQ    16,,PR0

      892    16552    2         CALL GUNLOCK;

  16552  1 002257   002027 701000 1                  TSX1    GUNLOCK
         1 002260   000000 011000                    NOP     0

      893    16553    2         ALTRETURN;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:124  
  16553  1 002261   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 002262   000000 702211                    TSX2  ! 0,X1

      894    16554        /**/
      895    16555        /*D* NAME:         RELCNNCT
      896    16556             PURPOSE:      To get rid of a terminal's connect info
      897    16557             DESCRIPTION:  Deletes the connect info.  If this works,
      898    16558                           RETURNs.  Else (failed due to lack of defer
      899    16559                           blocks), sets DDISC = 2 in the KQ$STA,
      900    16560                           and DDISC in KQ$CG.DELAY and ALTRETs (KCO$DDISC
      901    16561                           will be called back later from KCC$CLOCK).
      902    16562        */
      903    16563    2   RELCNNCT: ENTRY ALTRET;

  16563  1 002263   200076 741300       RELCNNCT     STX1  ! COMGRP+37,,AUTO

      904    16564        /**/
      905    16565    2         I=ADDR(KQ$STA.BTN.KEY)->UBINHALF;

  16565  1 002264   200006 470500                    LDP0    STA$,,AUTO
         1 002265   000005 236100                    LDQ     5,,PR0
         1 002266   000022 772000                    QRL     18
         1 002267   200016 756100                    STQ     I,,AUTO

      906    16566    2         DA=KQ$STA.CNNCTDDA;

  16566  1 002270   000021 235100                    LDA     17,,PR0
         1 002271   200022 755100                    STA     DA,,AUTO

      907    16567    2         CALL KQD$DELDDA (KQ$CG,I,DA) ALTRET(NOD);

  16567  1 002272   200022 631500                    EPPR1   DA,,AUTO
         1 002273   200110 451500                    STP1    K+4,,AUTO
         1 002274   200016 633500                    EPPR3   I,,AUTO
         1 002275   200107 453500                    STP3    K+3,,AUTO
         1 002276   200004 236100                    LDQ     CTX$,,AUTO
         1 002277   200106 756100                    STQ     K+2,,AUTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:125  
         1 002300   200106 630500                    EPPR0   K+2,,AUTO
         1 002301   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002302   000000 701000 xent               TSX1    KQD$DELDDA
         1 002303   002317 702000 1                  TSX2    NOD

      908    16568    2   D0:   KQ$STA.CNNCTDDA=0;

  16568  1 002304   200006 470500       D0           LDP0    STA$,,AUTO
         1 002305   000021 450100                    STZ     17,,PR0

      909    16569    2         CALL STALOCK;

  16569  1 002306   001771 701000 1                  TSX1    STALOCK
         1 002307   000000 011000                    NOP     0

      910    16570    2         KQ$STA.DDISC=0;

  16570  1 002310   200006 470500                    LDP0    STA$,,AUTO
         1 002311   000050 236000 2                  LDQ     40
         1 002312   000023 356100                    ANSQ    19,,PR0

      911    16571    2         CALL STAUNLOCK;

  16571  1 002313   002003 701000 1                  TSX1    STAUNLOCK
         1 002314   000000 011000                    NOP     0

      912    16572    2         RETURN;

  16572  1 002315   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 002316   000001 702211                    TSX2  ! 1,X1

      913    16573    2   NOD:  IF DA ~= %KQDE_NDFRBLK THEN GOTO D0;

  16573  1 002317   200022 235100       NOD          LDA     DA,,AUTO
         1 002320   000012 115007                    CMPA    10,DL
         1 002321   002304 601000 1                  TNZ     D0

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:126  
      914    16574    2         CALL STALOCK;

  16574  1 002322   001771 701000 1                  TSX1    STALOCK
         1 002323   000000 011000                    NOP     0

      915    16575    2         KQ$STA.DDISC=2;   /* No DFRBLK to RELCNNCT with                        */

  16575  1 002324   200006 470500                    LDP0    STA$,,AUTO
         1 002325   000023 236100                    LDQ     19,,PR0
         1 002326   000050 376000 2                  ANQ     40
         1 002327   100000 276007                    ORQ     32768,DL
         1 002330   000023 756100                    STQ     19,,PR0

      916    16576    2         CALL STAUNLOCK;

  16576  1 002331   002003 701000 1                  TSX1    STAUNLOCK
         1 002332   000000 011000                    NOP     0

      917    16577    2         GOTO DX;

  16577  1 002333   002252 710000 1                  TRA     DX

      918    16578    2   END TELLAU;
      919    16579        /****************************************************************
      920    16580        *****************************************************************/
      921    16581        /*D* NAME:         RELCNNCTUSR
      922    16582             PURPOSE:      To release a station's connect info while
      923    16583                           running on behalf of a user.
      924    16584             DESCRIPTION:  User needed 'cause we REG if no defer
      925    16585                           blocks are available.
      926    16586        */
      927    16587    1   RELCNNCTUSR: PROC;

  16587  1 002334   200076 741300       RELCNNCTUSR  STX1  ! COMGRP+37,,AUTO

      928    16588        /**/
      929    16589    2         IF KQ$STA.CNNCTDDA~=0 THEN
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:127  

  16589  1 002335   200006 470500                    LDP0    STA$,,AUTO
         1 002336   000021 235100                    LDA     17,,PR0
         1 002337   002400 600000 1                  TZE     s:16602

      930    16590    3           DO;

      931    16591    3   CNNCT0: DA=KQ$STA.CNNCTDDA;

  16591  1 002340   200006 470500       CNNCT0       LDP0    STA$,,AUTO
         1 002341   000021 235100                    LDA     17,,PR0
         1 002342   200022 755100                    STA     DA,,AUTO

      932    16592    3           I=ADDR(KQ$STA.BTN.KEY)->UBINHALF;

  16592  1 002343   000005 236100                    LDQ     5,,PR0
         1 002344   000022 772000                    QRL     18
         1 002345   200016 756100                    STQ     I,,AUTO

      933    16593    3           CALL KQD$DELDDA(KQ$CG,I,DA) ALTRET(CNNCT1);

  16593  1 002346   200022 631500                    EPPR1   DA,,AUTO
         1 002347   200110 451500                    STP1    K+4,,AUTO
         1 002350   200016 633500                    EPPR3   I,,AUTO
         1 002351   200107 453500                    STP3    K+3,,AUTO
         1 002352   200004 236100                    LDQ     CTX$,,AUTO
         1 002353   200106 756100                    STQ     K+2,,AUTO
         1 002354   200106 630500                    EPPR0   K+2,,AUTO
         1 002355   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002356   000000 701000 xent               TSX1    KQD$DELDDA
         1 002357   002361 702000 1                  TSX2    CNNCT1

      934    16594    3           GOTO CNNCT2;

  16594  1 002360   002376 710000 1                  TRA     CNNCT2

      935    16595    3   CNNCT1: IF DA = %KQDE_NDFRBLK THEN
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:128  

  16595  1 002361   200022 235100       CNNCT1       LDA     DA,,AUTO
         1 002362   000012 115007                    CMPA    10,DL
         1 002363   002376 601000 1                  TNZ     CNNCT2

      936    16596    4             DO;

      937    16597    4             CALL SSR$REG (%SS_SL,,1);

  16597  1 002364   000006 236000 2                  LDQ     6
         1 002365   200110 756100                    STQ     K+4,,AUTO
         1 002366   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002367   000007 235000 2                  LDA     7
         1 002370   200106 757100                    STAQ    K+2,,AUTO
         1 002371   200106 630500                    EPPR0   K+2,,AUTO
         1 002372   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002373   000000 701000 xent               TSX1    SSR$REG
         1 002374   000000 011000                    NOP     0

      938    16598    4             GOTO CNNCT0;

  16598  1 002375   002340 710000 1                  TRA     CNNCT0

      939    16599    4             END;
      940    16600    3   CNNCT2: KQ$STA.CNNCTDDA=0;

  16600  1 002376   200006 470500       CNNCT2       LDP0    STA$,,AUTO
         1 002377   000021 450100                    STZ     17,,PR0

      941    16601    3           END;

      942    16602    2         RETURN;

  16602  1 002400   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 002401   000001 702211                    TSX2  ! 1,X1

      943    16603    2   END RELCNNCTUSR;
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:129  
      944    16604        /****************************************************************
      945    16605        *****************************************************************/
      946    16606        /*D* NAME:         ABORTEM
      947    16607             PURPOSE:      To get rid of all stations on the comgroup
      948    16608             DESCRIPTION:  For all stations, call KQC$CLOSESTA. This
      949    16609                           will deactivate a DCB station, and put
      950    16610                           a terminal station in limbo. */
      951    16611    1   ABORTEM: PROC;

  16611  1 002402   200076 741300       ABORTEM      STX1  ! COMGRP+37,,AUTO

      952    16612        /**/
      953    16613    2         CALL SLOCK;

  16613  1 002403   001745 701000 1                  TSX1    SLOCK
         1 002404   000000 011000                    NOP     0

  16613  1 002405                       DSCLOOP      null
      954    16614    2   DSCLOOP:;
      955    16615    2         ACTCNT=KQ$CG.STREE.ACTCNT;

  16615  1 002405   200004 470500                    LDP0    CTX$,,AUTO
         1 002406   000102 236100                    LDQ     66,,PR0
         1 002407   000022 772000                    QRL     18
         1 002410   200012 756100                    STQ     ACTCNT,,AUTO

      956    16616    2         STA$=KQ$CG.STREE.HEAD$;

  16616  1 002411   000101 236100                    LDQ     65,,PR0
         1 002412   200006 756100                    STQ     STA$,,AUTO

      957    16617    3           DO WHILE(STA$~=ADDR(NIL));

  16617  1 002413   002450 710000 1                  TRA     s:16628

      958    16618    3           CALL STALOCK;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:130  
  16618  1 002414   001771 701000 1                  TSX1    STALOCK
         1 002415   000000 011000                    NOP     0

      959    16619    3           KQ$STA.LOCKCNT=KQ$STA.LOCKCNT+1;

  16619  1 002416   200006 470500                    LDP0    STA$,,AUTO
         1 002417   000020 236100                    LDQ     16,,PR0
         1 002420   000001 036007                    ADLQ    1,DL
         1 002421   000020 552104                    STBQ    16,'04'O,PR0

      960    16620    3           CALL STAUNLOCK;

  16620  1 002422   002003 701000 1                  TSX1    STAUNLOCK
         1 002423   000000 011000                    NOP     0

      961    16621    3           CALL SUNLOCK;

  16621  1 002424   001757 701000 1                  TSX1    SUNLOCK
         1 002425   000000 011000                    NOP     0

      962    16622    3           CALL KQC$CLOSESTA(KQ$STA);

  16622  1 002426   200006 630500                    EPPR0   STA$,,AUTO
         1 002427   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002430   000000 701000 xent               TSX1    KQC$CLOSESTA
         1 002431   000000 011000                    NOP     0

      963    16623    3           CALL KQP$UNLOCK(KQ$STA); /* Decr lockcnt */

  16623  1 002432   200006 630500                    EPPR0   STA$,,AUTO
         1 002433   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002434   000000 701000 xent               TSX1    KQP$UNLOCK
         1 002435   000000 011000                    NOP     0

      964    16624    3           CALL SLOCK;

  16624  1 002436   001745 701000 1                  TSX1    SLOCK
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:131  
         1 002437   000000 011000                    NOP     0

      965    16625    3           IF ACTCNT~=KQ$CG.STREE.ACTCNT THEN

  16625  1 002440   200004 470500                    LDP0    CTX$,,AUTO
         1 002441   000102 236100                    LDQ     66,,PR0
         1 002442   000022 772000                    QRL     18
         1 002443   200012 116100                    CMPQ    ACTCNT,,AUTO
         1 002444   002405 601000 1                  TNZ     DSCLOOP

      966    16626    3            GOTO DSCLOOP;
      967    16627    3           STA$=KQ$STA.BTN.FLINK$;

  16627  1 002445   200006 471500                    LDP1    STA$,,AUTO
         1 002446   100004 236100                    LDQ     4,,PR1
         1 002447   200006 756100                    STQ     STA$,,AUTO

      968    16628    3           END;

  16628  1 002450   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002451   002414 601000 1                  TNZ     s:16618

      969    16629    2         CALL SUNLOCK;

  16629  1 002452   001757 701000 1                  TSX1    SUNLOCK
         1 002453   000000 011000                    NOP     0

      970    16630    2         RETURN;

  16630  1 002454   200076 221300                    LDX1  ! COMGRP+37,,AUTO
         1 002455   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   0     000   132117 000002                                                    ZO..

(unnamed)
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:132  
 Sect OctLoc
   2     000   000000 000041   000002 006000   000002 006000   000002 006000    ...!............
   2     004   000000 006000   000000 000031   000003 006000   000005 006000    ................
   2     010   000000 000023   000010 006000   773777 777777   577777 777777    ................
   2     014   777777 777757   000000 000033   000015 006000   777777 777737    ................
   2     020   777777 777773   707777 777777   743777 777777   000000 006000    ................
   2     024   777777 437777   000000 010000   000005 006000   000003 006000    ................
   2     030   000025 006000   000007 777770   000000 000044   000004 006000    ...........$....
   2     034   000032 006000   000002 006000   000007 006000   000000 006000    ................
   2     040   000016 006000   777777 777577   776000 007777   000000 000045    ...............%
   2     044   000043 006000   777777 777377   000000 000034   000046 006000    .#...........&..
   2     050   777777 637777                                                    ....
      971    16631    2   END ABORTEM;
      972    16632    1   END KCO$CLCG;
      973    16633        %EOD;

PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:133  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  is referenced.
   KQM_MAC_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F_CP6.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   AZ_SUBS_C.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   AZ_MACRO_C.:E05TOU  is referenced.
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:134  
      No diagnostics issued in procedure KCO$CLCG.
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:135  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   100-0-0/w PTR         r     1 @ASNUM                     3-0-0/w PTR         r     1 @FPT$
    77-0-0/w PTR         r     1 @KQ$DSB                  101-0-0/w PTR         r     1 @PGNUM
   103-0-0/w PTR         r     1 @PPNO                    102-0-0/w PTR         r     1 @PTR$
    12-0-0/w UBIN        r     1 ACTCNT                    *0-0-0/w UBIN        r     1 ASNUM
    13-0-0/w UBIN        r     1 AU                        11-0-0/w PTR         r     1 CFU$
    77-0-0/w UBIN        r     1 CODE                      31-0-0/w STRC(1296)  r     1 COMGRP
    30-0-0/w PTR         r     1 CTL$                       4-0-0/w STRC        r     1 CTX
     4-0-0/w PTR         r     1 CTX$                      22-0-0/w UBIN        r     1 DA
    23-0-0/w UBIN        r     1 DESC#                     17-0-0/w PTR         r     1 DGRAN$
    26-0-0/w UBIN        r     1 ENTFLG                    *0-0-0/w STRC(504)   r     1 FPT$
    16-0-0/w UBIN        r     1 I                        100-0-0/w SBIN        r     1 J
     5-0-0/w PTR         r     1 JDCB$                    104-0-0/w UBIN        r     1 K
    *0-0-0/d STRC(1944)  r     1 KQ$DSB                    10-0-0/w PTR         r     1 LDCT$
    27-0-0/w UBIN        r     1 ORG                       25-0-0/w UBIN        r     1 PG
    24-0-0/w UBIN        r     1 PGINDX                    *0-0-0/w UBIN        r     1 PGNUM
    *0-0-0/w UBIN        r     1 PPNO                      *0-0-0/w PTR         r     1 PTR$
    *0-0-0/w STRC        r     1 PTR$R                     21-0-0/w SBIN        r     1 SIZ
     6-0-0/w PTR         r     1 STA$                      14-0-0/w PTR         r     1 T$
    20-0-0/w UBIN(9)     r     1 USR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$CGPT$                    0-0-0/w PTR         r     1 B$IPHYMAP$
     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w UBIN        r     1 FM_FRZERO                  0-0-0/w BIT         r     1 HW_WSQ0PT
     0-0-0/w STRC(2304)  r     1 KQ_ERRLOG_BFR              0-0-0/b BIT (72)    r     1 KQ_ERRLOG_GATE
     0-0-0/b STRC        r     1 KQ_LOG                     0-0-0/w PTR         r     1 N$DCT$$
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:136  
     0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/h UBIN(18)    r     1 B$HALF(0:0)                0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC        r     1 B$MAP(0:1023)              0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$SET(0:0)
     0-0-0/d STRC(144)   r     1 FPT$CLOSE_V                0-0-0/d STRC(6516)  r     1 KQ$CG
     0-0-0/d STRC(900)   r     1 KQ$CTLGRAN                 0-0-0/d STRC(1152)  r     1 KQ$DGRAN
     0-0-0/d STRC(1944)  r     1 KQ$DSB                     0-0-0/d STRC(1296)  r     1 KQ$STA
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/w PTR         r     1 P$                         0-0-0/w UBIN(18)    r     1 UBINHALF
     0-0-0/w STRC(432)   r     1 VLP$SETSTA_V


   Procedure KCO$CLCG requires 1326 words for executable code.
   Procedure KCO$CLCG requires 78 words of local(AUTO) storage.
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:137  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:138  
          MINI XREF LISTING

ABORTEM
     16611**PROC    15898--CALL    16402--CALL
ACTCNT
     15453**DCL     16615<<ASSIGN  16625>>IF
ASNUM IN PROCEDURE FINDCGPAGE
     16079**DCL     16034--PROC    16142<<ASSIGN  16142>>ASSIGN  16145>>IF      16146>>IF      16147>>ASSIGN
     16158>>ASSIGN
AU
     15454**DCL     15761<<ASSIGN  15797<<ASSIGN  15828>>IF
B$CGPT$
     15585**DCL     16148>>ASSIGN  16149>>IF
B$HALF IN PROCEDURE FINDCGPAGE
     16133**DCL     16156>>ASSIGN
B$IPHYMAP$ IN PROCEDURE FINDCGPAGE
     16134**DCL     16156>>ASSIGN
B$JIT.DCB$
      5106**DCL     15759>>ASSIGN
B$JIT.ERR.MID
      5017**DCL      5017--REDEF
B$JIT$
     15586**DCL      5011--IMP-PTR 15759>>ASSIGN
B$MAP.CTRL
      3401**DCL     16149>>IF
B$MAP.RPN
      3397**DCL     16148>>ASSIGN
B$MAP.SCTRL
      3398**DCL      3399--REDEF
CFU$
     15452**DCL     13726--IMP-PTR 15760<<ASSIGN  15762>>IF      15764>>ASSIGN  15765>>ASSIGN  15802<>CALL
     15888>>ASSIGN  15978>>ASSIGN  15979>>ASSIGN  16014<>CALL
CLNB
     15854**LABEL   15849--GOTO    15850--GOTO
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:139  
CNNCT0 IN PROCEDURE RELCNNCTUSR
     16591**LABEL   16598--GOTO
CNNCT1 IN PROCEDURE RELCNNCTUSR
     16595**LABEL   16593--CALLALT
CNNCT2 IN PROCEDURE RELCNNCTUSR
     16600**LABEL   16594--GOTO
CODE IN PROCEDURE TELLAU
     16490**DCL     16528<<ASSIGN  16530<<ASSIGN  16538<<ASSIGN  16542<>CALL    16543>>IF
COMGRP
     15474**DCL     15963<<ASSIGN  15972<>CALL    15972--CALL
COMGRP.ACCT
     15496**DCL     15965<<ASSIGN
COMGRP.CODE
     15475**DCL     15964<<ASSIGN
COMGRP.NAM
     15500**DCL     15966<<ASSIGN
COMGRP.SN
     15492**DCL     15967<<ASSIGN
COMGRP.STATS
     15523**DCL     15968<<ASSIGN
COMGRP.STATS.PGSI
     15528**DCL     15971<>CALL
COMMON
     15755**LABEL   15750--GOTO
CTL$
     15467**DCL     14497--IMP-PTR 15924<>CALL    15926>>ASSIGN  15927>>ASSIGN  15927>>ASSIGN  15953>>ASSIGN
     15956>>ASSIGN  15956>>ASSIGN  15959>>IF      15960>>ASSIGN  15962>>ASSIGN
CTX.DISP
     15446**DCL     15765<<ASSIGN
CTX.SID
     15447**DCL     15764<<ASSIGN
CTX$
     15444**DCL     13760--IMP-PTR 15445--REDEF   15766>>CALL    15778>>CALL    15786>>ASSIGN  15791>>ASSIGN
     15792>>ASSIGN  15798>>IF      15823>>IF      15824>>IF      15836>>IF      15837>>ASSIGN  15840>>ASSIGN
     15862>>IF      15863>>IF      15864>>CALL    15867>>CALL    15869>>CALL    15876>>ASSIGN  15876>>ASSIGN
     15880>>IF      15890>>IF      15892>>ASSIGN  15896>>ASSIGN  15900>>IF      15902>>ASSIGN  15909>>DOWHILE
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:140  
     15913>>ASSIGN  15914>>ASSIGN  15915>>ASSIGN  15918>>DOWHILE 15928>>ASSIGN  15930>>ASSIGN  15931>>ASSIGN
     15936>>CALL    15960>>ASSIGN  15968>>ASSIGN  15969>>ASSIGN  15970>>CALL    15971>>CALL    15971>>CALL
     15971>>CALL    15981>>IF      15986>>CALL    15999>>CALL    16002>>CALL    16007>>CALL    16220<<ASSIGN
     16248<<ASSIGN  16263>>CALL    16275>>IF      16276>>CALL    16279>>CALL    16281>>CALL    16320<<ASSIGN
     16327>>ASSIGN  16327>>ASSIGN  16328>>IF      16328>>IF      16330>>ASSIGN  16331>>ASSIGN  16358<<ASSIGN
     16385<<ASSIGN  16401<<ASSIGN  16425>>CALL    16431>>CALL    16449>>CALL    16455>>CALL    16523>>CALL
     16532>>IF      16532>>IF      16551>>ASSIGN  16567>>CALL    16593>>CALL    16615>>ASSIGN  16616>>ASSIGN
     16625>>IF
D0 IN PROCEDURE TELLAU
     16568**LABEL   16573--GOTO
DA
     15461**DCL     15930<<ASSIGN  15950>>ASSIGN  15952<>CALL    15954<<ASSIGN  15954>>ASSIGN  16566<<ASSIGN
     16567<>CALL    16573>>IF      16591<<ASSIGN  16593<>CALL    16595>>IF
DESC#
     15462**DCL     15932<<ASSIGN  15936<>CALL    15953>>ASSIGN  15983<<ASSIGN  15986<>CALL
DGRAN$
     15458**DCL     15936<>CALL    15942>>IF      15943>>IF      15943>>IF      15948>>IF      15948>>IF
     15950>>ASSIGN  15951>>ASSIGN  15986<>CALL    15987>>IF      15987>>IF      15996>>ASSIGN  15998>>ASSIGN
     16000>>ASSIGN  16000>>ASSIGN  16002<>CALL
DSC0
     16254**LABEL   16222--GOTO
DSC1
     16258**LABEL   16252--GOTO    16365--GOTO
DSC2
     16255**LABEL   16367--GOTO
DSCLOOP IN PROCEDURE ABORTEM
     16613**LABEL   16626--GOTO
DX IN PROCEDURE TELLAU
     16550**LABEL   16577--GOTO
ELA$SYSLOG
     15600**DCL-ENT 15972--CALL
ENDRCVR
     15953**LABEL   15936--CALLALT 15940--GOTO
ENDRELPGS
     16002**LABEL   15986--CALLALT
ENTFLG
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:141  
     15465**DCL     15749<<ASSIGN  15755<<ASSIGN  15987>>IF      16025>>IF
F$CFU$
     15587**DCL     13732--IMP-PTR 15967>>ASSIGN
F$DCB.ACCT
     13686**DCL     15965>>ASSIGN
F$DCB.ACTPOS
     13701**DCL     13701--REDEF
F$DCB.ARS
     13676**DCL     13676--REDEF
F$DCB.ASN
     13691**DCL     15808>>IF
F$DCB.ATTR
     13694**DCL     13695--REDEF
F$DCB.BFR.BUFUP
     13720**DCL     15925<<ASSIGN
F$DCB.BORROW
     13709**DCL     13709--REDEF   13709--REDEF   13709--REDEF
F$DCB.CFU$
     13710**DCL     15760>>ASSIGN
F$DCB.DCBNAME.L
     13723**DCL     13723--IMP-SIZ
F$DCB.ENQF
     13708**DCL     15803<<ASSIGN  16011>>IF      16013<<ASSIGN
F$DCB.EOMCHAR
     13680**DCL     13680--REDEF
F$DCB.FLDID
     13704**DCL     13704--REDEF
F$DCB.FORM$
     13698**DCL     13698--REDEF
F$DCB.FSECT
     13714**DCL     13714--REDEF
F$DCB.FSN
     13691**DCL     13691--REDEF   13691--REDEF   13692--REDEF
F$DCB.GTYP
     13705**DCL     15923<<ASSIGN
F$DCB.HEADER$
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:142  
     13697**DCL     13697--REDEF
F$DCB.IXTNSIZE
     13695**DCL     13695--REDEF
F$DCB.LASTSTA$
     13685**DCL     13685--REDEF
F$DCB.LDCTX
     13698**DCL     15767>>IF      15774>>ASSIGN  15782<<ASSIGN
F$DCB.LVL
     13710**DCL     13710--REDEF   15922<<ASSIGN
F$DCB.NAME
     13685**DCL     15966>>ASSIGN
F$DCB.NAME.C
     13685**DCL     13685--REDEF
F$DCB.NOEOF
     13706**DCL     13706--REDEF
F$DCB.NRECS
     13696**DCL     13696--REDEF
F$DCB.NRECX
     13715**DCL     13715--REDEF
F$DCB.OHDR
     13707**DCL     13707--REDEF
F$DCB.ORG
     13690**DCL     13690--REDEF   15785>>ASSIGN  15786<<ASSIGN  16016<<ASSIGN
F$DCB.PRECNO
     13713**DCL     13713--REDEF
F$DCB.RCSZ
     13718**DCL     13718--REDEF
F$DCB.RES
     13686**DCL     13686--REDEF
F$DCB.SETSTA$
     13685**DCL     16018>>IF      16019>>IF      16020>>ASSIGN
F$DCB.SETX
     13698**DCL     13698--REDEF   15967>>ASSIGN
F$DCB.TAB$
     13697**DCL     13698--REDEF
F$DCB.TDA
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:143  
     13712**DCL     13712--REDEF
F$DCB.WSN
     13687**DCL     13687--REDEF
FGH$UPDBUCKET
     15601**DCL-ENT 15971--CALL
FINDCGPAGE
     16034**PROC    15936--CALL    15986--CALL
FINDNXTPG
     15927**LABEL   15942--GOTO    15946--GOTO    15949--GOTO
FM$CFU.ACCTX
     13727**DCL     13727--REDEF
FM$CFU.FMOD
     13726**DCL     15888<<ASSIGN
FM$CFU.GDA
     13728**DCL     15762>>IF      15764>>ASSIGN  15978<<ASSIGN
FM$CFU.LDA
     13729**DCL     15765>>ASSIGN  15979<<ASSIGN
FM$SET.PSN
     13732**DCL     15967>>ASSIGN
FM$SET.USERLIST
     13733**DCL     13733--REDEF
FMB$RIO
     15602**DCL-ENT 15952--CALL
FMD$FLSHBUF
     15603**DCL-ENT 15975--CALL
FMD$REDBUF
     15604**DCL-ENT 15924--CALL
FMP$CLSF
     15605**DCL-ENT 16026--CALL
FM_FRZERO
     15588**DCL     15924<>CALL    15930>>ASSIGN  15960>>ASSIGN
FPT$
     15435**DCL        24--PROC    15848--IF      16026<>CALL    16217--ENTRY   16219--ASSIGN  16245--ENTRY
     16247--ASSIGN  16318--ENTRY   16320--ASSIGN  16355--ENTRY   16357--ASSIGN  16382--ENTRY   16384--ASSIGN
     16399--ENTRY   16401--ASSIGN
FPT$.SN_
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:144  
     15435**DCL     15435--REDEF
FPT$.UTL_
     15435**DCL     15435--REDEF
FPT$.V_
     15435**DCL     13737--IMP-PTR 15850>>IF      15851>>IF
FPT$CLOSE_V.DISP
     13738**DCL     15851>>IF
FPT$CLOSE_V.EXPIRE
     13742**DCL     13742--REDEF
FPT$CLOSE_V.TYPE
     13741**DCL     13741--REDEF
FPT$CLOSE_V.XTNSIZE
     13738**DCL     13738--REDEF   13740--REDEF
GETOUT
     16303**LABEL   16256--CALLALT 16258--CALLALT
GLOCK IN PROCEDURE SLOCK
     16446**ENTRY   15790--CALL    15875--CALL    15889--CALL    15899--CALL    15912--CALL    16326--CALL
     16526--CALL    16550--CALL
GUNLOCK IN PROCEDURE SLOCK
     16452**ENTRY   15793--CALL    15877--CALL    15893--CALL    15897--CALL    15903--CALL    15906--CALL
     15916--CALL    16332--CALL    16336--CALL    16540--CALL    16552--CALL
HFC$LOCK
      6532**DCL-ENT 15990--CALL    16425--CALL    16437--CALL    16449--CALL
HFC$UNLOCK
      6532**DCL-ENT 16431--CALL    16443--CALL    16455--CALL
HW_WSQ0PT IN PROCEDURE FINDCGPAGE
     16125**DCL     16152>>IF
I
     15457**DCL     15969<<ASSIGN  15971>>CALL    15972<>CALL    16262<<ASSIGN  16263<>CALL    16565<<ASSIGN
     16567<>CALL    16592<<ASSIGN  16593<>CALL
J IN PROCEDURE TELLAU
     16491**DCL     16495<<ASSIGN  16496>>IF      16498>>IF      16507>>IF      16509>>IF      16521<<ASSIGN
     16523<>CALL
JDCB$
     15448**DCL     13676--IMP-PTR 15759<<ASSIGN  15760>>ASSIGN  15767>>IF      15774>>ASSIGN  15782>>ASSIGN
     15785>>ASSIGN  15786>>ASSIGN  15803>>ASSIGN  15808>>IF      15922>>ASSIGN  15923>>ASSIGN  15925>>ASSIGN
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:145  
     15965>>ASSIGN  15966>>ASSIGN  15967>>ASSIGN  16011>>IF      16013>>ASSIGN  16016>>ASSIGN  16018>>IF
     16019>>IF      16020>>ASSIGN
K IN PROCEDURE FINDCGPAGE
     16136**DCL     16147<<ASSIGN  16148>>ASSIGN  16149>>IF
KCA$TELLAUM
     15606**DCL-ENT 16542--CALL
KCA$TELLAUR
     15607**DCL-ENT 15829--CALL    15831--CALL
KCD$PREL
     15608**DCL-ENT 16282--CALL    16298--CALL    16307--CALL
KQ$CG
     13760**DCL     15766<>CALL    15778<>CALL    15864<>CALL    15867<>CALL    15869<>CALL    15928<<ASSIGN
     15928>>ASSIGN  15999<>CALL    16002<>CALL    16007<>CALL    16263<>CALL    16276<>CALL    16279<>CALL
     16281<>CALL    16523<>CALL    16567<>CALL    16593<>CALL
KQ$CG.AU
     14173**DCL     15792<<ASSIGN
KQ$CG.AUCTL.DSCREQ
     14206**DCL     16532>>IF
KQ$CG.AUCTL.DVBYTE.REREAD
     14203**DCL     14204--REDEF
KQ$CG.AUCTL.SMD
     14202**DCL     15862>>IF      16275>>IF
KQ$CG.AUSENDCNT
     14175**DCL     15798>>IF
KQ$CG.AUSTA$
     14170**DCL     15791<<ASSIGN  16532>>IF
KQ$CG.CLOCK
     14136**DCL     15890>>IF      15915<<ASSIGN
KQ$CG.CLOSING
     14127**DCL     15896<<ASSIGN  15914<<ASSIGN
KQ$CG.DCBHD$
     14115**DCL     15836>>IF      15837<<ASSIGN  15840>>ASSIGN
KQ$CG.DELAY.DDISC
     13841**DCL     16551<<ASSIGN
KQ$CG.FWUSR#
     14182**DCL     15824>>IF
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:146  
KQ$CG.GATE.CG
     14150**DCL     16449<>CALL    16455<>CALL
KQ$CG.GRAN.ORG
     14460**DCL     15786>>ASSIGN
KQ$CG.HIGRANS
     14291**DCL     15930>>ASSIGN  15960>>ASSIGN
KQ$CG.IOCNT
     14312**DCL     15918>>DOWHILE
KQ$CG.JRNLSTA$
     14263**DCL     15863>>IF
KQ$CG.LASTUSER
     14277**DCL     15902<<ASSIGN  16328>>IF      16330>>ASSIGN  16331<<ASSIGN
KQ$CG.MMD.CURPG
     13782**DCL     15971<>CALL
KQ$CG.MMD.DSB$
     13769**DCL     15936>>CALL    15981>>IF      15986>>CALL
KQ$CG.MMD.GIP
     13792**DCL     15909>>DOWHILE
KQ$CG.NGAVAL
     14285**DCL     15931>>ASSIGN
KQ$CG.OPEN
     14130**DCL     15892<<ASSIGN  15913<<ASSIGN
KQ$CG.PGTIME
     14159**DCL     15969>>ASSIGN  15970<>CALL    15971>>CALL
KQ$CG.QUEUE.RUSR#
     14002**DCL     15823>>IF
KQ$CG.STATS
     14250**DCL     15968>>ASSIGN
KQ$CG.STATS.NUMDCBS
     14253**DCL     15876<<ASSIGN  15876>>ASSIGN  15880>>IF
KQ$CG.STATS.NUMTERMS
     14253**DCL     15900>>IF      16327<<ASSIGN  16327>>ASSIGN  16328>>IF
KQ$CG.STATS.PGSI
     14253**DCL     15971<>CALL
KQ$CG.STREE.ACTCNT
     14107**DCL     16615>>ASSIGN  16625>>IF
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:147  
KQ$CG.STREE.GATE
     14094**DCL     16425<>CALL    16431<>CALL
KQ$CG.STREE.HEAD$
     14102**DCL     16616>>ASSIGN
KQ$CTLGRAN.CTXX
     14554**DCL     15927>>ASSIGN
KQ$CTLGRAN.PGTBL
     14567**DCL     15926<<ASSIGN  15953<<ASSIGN
KQ$CTLGRAN.RCVRDA
     14558**DCL     15960<<ASSIGN
KQ$CTLGRAN.RCVRSIZ
     14560**DCL     15956<<ASSIGN  15956>>ASSIGN  15959>>IF
KQ$CTLGRAN.RCVRTIME
     14562**DCL     15962<<ASSIGN
KQ$DGRAN
     14583**DCL     15993--ASSIGN  15998<<ASSIGN  15998>>ASSIGN
KQ$DGRAN.HDR.CHAIN
     14618**DCL     15948>>IF
KQ$DGRAN.HDR.GTYP
     14627**DCL     15951<<ASSIGN
KQ$DGRAN.HDR.PTYP
     14622**DCL     15942>>IF      15948>>IF
KQ$DGRAN.HDR.SELF$
     14634**DCL     15943>>IF      15987>>IF      16000<<ASSIGN
KQ$DGRAN.HDR.STAMP.GMOD
     14606**DCL     15950<<ASSIGN
KQ$DSB
     14730**DCL     15936<>CALL    15986<>CALL
KQ$DSB.ASR
     14732**DCL     14741--REDEF
KQ$DSB.DESC.FLG
     14752**DCL     14753--REDEF
KQ$DSB IN PROCEDURE FINDCGPAGE
     16049**DCL     16034--PROC
KQ$DSB.ASR IN PROCEDURE FINDCGPAGE
     16051**DCL     16060--REDEF
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:148  
KQ$DSB.DESC.BASE IN PROCEDURE FINDCGPAGE
     16077**DCL     16147>>ASSIGN
KQ$DSB.DESC.FLG IN PROCEDURE FINDCGPAGE
     16071**DCL     16072--REDEF
KQ$DSB.DESC.FLGR.PRESENT IN PROCEDURE FINDCGPAGE
     16074**DCL     16146>>IF
KQ$MBLK.DVE.EOMCHAR
     14875**DCL     14877--REDEF
KQ$MBLK.KEY1
     14801**DCL     14803--REDEF
KQ$MBLK.KEY2
     14810**DCL     14828--REDEF
KQ$MBLK.LNK$
     14775**DCL     14777--REDEF   14783--REDEF   14787--REDEF
KQ$MBLK.TYC
     14924**DCL     14926--REDEF
KQ$MBLK.XSP.MREQ$
     14830**DCL     14834--REDEF
KQ$STA
     15044**DCL     15809<>CALL    15829<>CALL    15831<>CALL    15852<>CALL    15854<>CALL    16542<>CALL
     16622<>CALL    16623<>CALL
KQ$STA.ACTTYC
     15096**DCL     15100--REDEF
KQ$STA.AU
     15126**DCL     15788>>IF      15861<<ASSIGN
KQ$STA.BTN.FLINK$
     15078**DCL     16627>>ASSIGN
KQ$STA.BTN.KEY
     15080**DCL     15778<>CALL    15778<>CALL    16263<>CALL    16263<>CALL    16565--ASSIGN  16592--ASSIGN
KQ$STA.CG$
     15083**DCL     16220>>ASSIGN  16248>>ASSIGN  16358>>ASSIGN  16385>>ASSIGN
KQ$STA.CNNCTDDA
     15181**DCL     16255>>IF      16566>>ASSIGN  16568<<ASSIGN  16589>>IF      16591>>ASSIGN  16600<<ASSIGN
KQ$STA.DCBCNT
     15192**DCL     15811<<ASSIGN  15811>>ASSIGN  15812>>IF
KQ$STA.DCBLNK$
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:149  
     15103**DCL     15106--REDEF   15110--REDEF   15837>>ASSIGN  15841>>DOWHILE 15842>>ASSIGN  15844<<ASSIGN
     15844>>ASSIGN
KQ$STA.DDISC
     15208**DCL     16362>>DOCASE  16504>>IF      16509>>IF      16514<<ASSIGN  16520>>IF      16548<<ASSIGN
     16570<<ASSIGN  16575<<ASSIGN
KQ$STA.DSCREQS
     15224**DCL     16534>>IF      16536<<ASSIGN
KQ$STA.DSCREQW
     15219**DCL     16531>>IF      16537<<ASSIGN
KQ$STA.EVCNT
     15189**DCL     15192--REDEF
KQ$STA.EVNT
     15155**DCL     15159--REDEF   15162--REDEF
KQ$STA.GATE
     15122**DCL     16437<>CALL    16443<>CALL
KQ$STA.IDSC
     15124**DCL     15825<<ASSIGN  15859<<ASSIGN  16272<<ASSIGN  16289<<ASSIGN
KQ$STA.LDCT$
     15085**DCL     15858<<ASSIGN  16221>>ASSIGN  16250>>ASSIGN  16269>>IF      16270<<ASSIGN  16286<<ASSIGN
     16360>>ASSIGN  16529>>IF
KQ$STA.LOCKCNT
     15178**DCL     16262>>ASSIGN  16274<<ASSIGN  16274>>ASSIGN  16295<<ASSIGN  16295>>ASSIGN  16619<<ASSIGN
     16619>>ASSIGN
KQ$STA.MBLK$
     15089**DCL     16527<<ASSIGN
KQ$STA.MLH
     15312**DCL     15864--CALL    16276--CALL
KQ$STA.MLH.RUSR#
     15323**DCL     15822>>IF
KQ$STA.MREQ
     15169**DCL     16495>>ASSIGN
KQ$STA.MREQ$
     15254**DCL     16512>>ASSIGN  16513<<ASSIGN
KQ$STA.OPNBLKED
     15216**DCL     15219--REDEF
KQ$STA.OPNREJ
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:150  
     15222**DCL     15224--REDEF
KQ$STA.SAVIDSC
     15243**DCL     16288>>IF      16290<<ASSIGN  16304<<ASSIGN
KQ$STA.SAVLDCT$
     15283**DCL     16249>>IF      16251>>ASSIGN  16254>>IF      16273>>IF      16286>>ASSIGN  16287<<ASSIGN
     16302<<ASSIGN  16359>>IF      16361>>ASSIGN
KQ$STA.SUCCREAD
     15145**DCL     15149--REDEF
KQ$STA.TCOUNT
     15274**DCL     15280--REDEF
KQ$STA.TOLDAU
     15152**DCL     15860<<ASSIGN  16493>>IF      16545<<ASSIGN
KQ$STA.VGOT$
     15259**DCL     15263--REDEF   15267--REDEF
KQC$CLOSESTA
     15609**DCL-ENT 16622--CALL
KQC$DACTSTA
     15610**DCL-ENT 15809--CALL
KQD$DELDDA
     15611**DCL-ENT 16567--CALL    16593--CALL
KQD$ERRLOG
     15612**DCL-ENT 15999--CALL
KQL$DELMLH
     15615**DCL-ENT 15864--CALL    16276--CALL
KQM$GETBD
     15616**DCL-ENT 16523--CALL
KQM$RELPF
     15617**DCL-ENT 16002--CALL
KQM$SHUTDOWN
     15618**DCL-ENT 16007--CALL
KQP$UNLOCK
     15620**DCL-ENT 16623--CALL
KQR$CLEANUP
     15621**DCL-ENT 15852--CALL
KQR$CLEANUPB
     15622**DCL-ENT 15854--CALL
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:151  
KQT$DELSTA
     15623**DCL-ENT 15867--CALL    16279--CALL
KQT$VALREADS
     15624**DCL-ENT 15869--CALL    16281--CALL
KQX$LDASR
     15626**DCL-ENT 15766--CALL
KQZ$LOG
     15627**DCL-ENT 15778--CALL    16263--CALL
KQ_ERRLOG_BFR.CODE
     15591**DCL     15992<<ASSIGN
KQ_ERRLOG_BFR.INFO
     15592**DCL     15994--ASSIGN  15995<<ASSIGN
KQ_ERRLOG_BFR.SIZ
     15592**DCL     15993<<ASSIGN
KQ_ERRLOG_GATE
     11322**DCL     15990<>CALL
KQ_IMBLK.DVE.EOMCHAR
     11954**DCL     11956--REDEF
KQ_IMBLK.KEY1
     11880**DCL     11882--REDEF
KQ_IMBLK.KEY2
     11889**DCL     11907--REDEF
KQ_IMBLK.LNK$
     11854**DCL     11856--REDEF   11862--REDEF   11866--REDEF
KQ_IMBLK.TYC
     12003**DCL     12005--REDEF
KQ_IMBLK.XSP.MREQ$
     11909**DCL     11913--REDEF
KQ_IRBLK.BUF$
     11458**DCL     11460--REDEF
KQ_IRBLK.CNACTD
     11372**DCL     11381--REDEF
KQ_IRBLK.DBLKX
     11478**DCL     11482--REDEF
KQ_IRBLK.EOFNONE
     11350**DCL     11353--REDEF
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:152  
KQ_IRBLK.FROMQ
     11356**DCL     11359--REDEF
KQ_IRBLK.KEY1R
     11397**DCL     11398--REDEF
KQ_IRBLK.KEY2R
     11402**DCL     11403--REDEF
KQ_IRBLK.LATCH
     11345**DCL     11347--REDEF
KQ_IRBLK.LWRITES$
     11489**DCL     11493--REDEF
KQ_IRBLKT.CNACTD
     11558**DCL     11567--REDEF
KQ_IRBLKT.DBLK$
     11621**DCL     11625--REDEF   11628--REDEF
KQ_IRBLKT.EOFNONE
     11536**DCL     11539--REDEF
KQ_IRBLKT.FROMQ
     11542**DCL     11545--REDEF
KQ_IRBLKT.KEY1R
     11583**DCL     11584--REDEF
KQ_IRBLKT.KEY2R
     11588**DCL     11589--REDEF
KQ_IRBLKT.LATCH
     11531**DCL     11533--REDEF
KQ_LOG.DSIO
     11313**DCL     15776>>IF
KQ_LOG.TSIO
     11312**DCL     16260>>IF
K_RWPARM_CON.BLKREC
     12853**DCL     12878--REDEF
K_RWPARM_CON.BLKREC.BLKU#
     12854**DCL     12856--REDEF
K_RWPARM_CON.BLKREC.RECU#
     12866**DCL     12868--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
     12893**DCL     12894--REDEF
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:153  
K_RWPARM_CON.DVE.EOMCHAR
     12901**DCL     12905--REDEF
K_RWPARM_CON.ERR
     12965**DCL     12970--REDEF
K_RWPARM_CON.FC
     12929**DCL     12930--REDEF
K_RWPARM_CON.FLDID
     13111**DCL     13112--REDEF
K_RWPARM_CON.FPT$
     12992**DCL     12999--REDEF
K_RWPARM_CON.KEYTYPE
     13118**DCL     13119--REDEF
K_RWPARM_CON.MSG$
     12828**DCL     12834--REDEF
K_RWPARM_CON.MSGID
     12940**DCL     12945--REDEF
K_RWPARM_CON.MSGIDXT
     12953**DCL     12957--REDEF
K_RWPARM_CON.ORG
     13089**DCL     13090--REDEF
K_RWPARM_CON.THDRSZ
     13033**DCL     13037--REDEF
K_RWPARM_CON.VDOFLGS
     13091**DCL     13102--REDEF
LDCT$
     15451**DCL     15382--IMP-PTR 15769<<ASSIGN  15774<<ASSIGN  15775>>ASSIGN  15815<<ASSIGN  15872>>IF
     15873<>CALL    16221<<ASSIGN  16250<<ASSIGN  16251<<ASSIGN  16269>>IF      16271>>ASSIGN  16282>>CALL
     16298>>CALL    16303>>ASSIGN  16307>>CALL    16360<<ASSIGN  16361<<ASSIGN
LOOP IN PROCEDURE FINDCGPAGE
     16136**LABEL   16164--GOTO
LOOP1 IN PROCEDURE FINDCGPAGE
     16142**LABEL   16146--GOTO
N$DCT$$
     13372**DCL     13372--IMP-PTR 15774>>ASSIGN
NK$LDCT
     15382**DCL     16282<>CALL    16298<>CALL    16307<>CALL
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:154  
NK$LDCT.DDT$
     15384**DCL     15384--REDEF
NK$LDCT.DFLG.SYMBIONT
     15387**DCL     16529>>IF
NK$LDCT.IOQ$
     15383**DCL     15384--REDEF
NK$LDCT.LDCTX
     15385**DCL     15385--REDEF
NK$LDCT.LKFLG.ABORTED
     15397**DCL     15398--REDEF
NK$LDCT.RLCID.LDCTX
     15407**DCL     15407--REDEF
NK$LDCT.STA$
     15403**DCL     15404--REDEF   15775>>ASSIGN  16271<<ASSIGN  16303<<ASSIGN
NK$LDCT.SYMB$
     15382**DCL     15382--REDEF   15382--REDEF   15383--REDEF
NK$LDCT$
     13372**DCL     15774>>ASSIGN
NKL$RELDCT
     15628**DCL-ENT 15873--CALL
NOD IN PROCEDURE TELLAU
     16573**LABEL   16567--CALLALT
NOM IN PROCEDURE TELLAU
     16547**LABEL   16523--CALLALT
NORCVR
     15972**LABEL   15924--CALLALT
NOSTA
     15866**LABEL   15806--GOTO    15816--GOTO
ORG
     15466**DCL     15785<<ASSIGN  16016>>ASSIGN
P$
     15428**DCL     15996<<ASSIGN
PG
     15464**DCL     15936<>CALL    15952<>CALL    15986<>CALL
PGINDX
     15463**DCL     15933<<ASSIGN  15936<>CALL    15953>>ASSIGN  15984<<ASSIGN  15986<>CALL
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:155  
PGNUM IN PROCEDURE FINDCGPAGE
     16080**DCL     16034--PROC    16139>>IF      16143<<ASSIGN  16148>>ASSIGN  16149>>IF      16157>>ASSIGN
     16160<<ASSIGN  16160>>ASSIGN  16163<<ASSIGN  16163>>ASSIGN
PPNO IN PROCEDURE FINDCGPAGE
     16086**DCL     16034--PROC    16148<<ASSIGN  16156<<ASSIGN  16156>>ASSIGN
PTR$ IN PROCEDURE FINDCGPAGE
     16081**DCL     16034--PROC    16082--REDEF
PTR$R.GORGO IN PROCEDURE FINDCGPAGE
     16084**DCL     16159<<ASSIGN
PTR$R.PG# IN PROCEDURE FINDCGPAGE
     16083**DCL     16157<<ASSIGN
PTR$R.SEGID IN PROCEDURE FINDCGPAGE
     16085**DCL     16158<<ASSIGN
RELCNNCT IN PROCEDURE TELLAU
     16563**ENTRY   16256--CALL
RELCNNCTUSR
     16587**PROC    15833--CALL    16386--CALL
RELPGS
     15972**LABEL   15894--GOTO
SC_BCGDSC
     15629**DCL-ENT 16498--CALL    16504--CALL    16510--CALL    16520--CALL    16531--CALL
SC_BCGRBS
     15631**DCL-ENT 15822--CALL    15823--CALL
SC_CGCACHE
     15632**DCL-ENT 15939--CALL    15945--CALL
SC_CGFWST
     15630**DCL-ENT 15824--CALL
SIZ
     15460**DCL     15931<<ASSIGN  15937>>IF      15955<<ASSIGN  15955>>ASSIGN
SLOCK
     16422**PROC    15835--CALL    15856--CALL    16267--CALL    16613--CALL    16624--CALL
SSR$REG
     15633**DCL-ENT 15799--CALL    15904--CALL    15910--CALL    15919--CALL    16597--CALL
SSR$RUE
     15634**DCL-ENT 16333--CALL
SSS$CURTIME
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:156  
     15635**DCL-ENT 15970--CALL
STA$
     15449**DCL     15044--IMP-PTR 15770<<ASSIGN  15775<<ASSIGN  15778>>CALL    15778>>CALL    15787>>IF
     15788>>IF      15805>>IF      15809>>CALL    15811>>ASSIGN  15811>>ASSIGN  15812>>IF      15822>>IF
     15825>>ASSIGN  15829>>CALL    15831>>CALL    15836>>IF      15837>>ASSIGN  15841>>DOWHILE 15844>>ASSIGN
     15852>>CALL    15854>>CALL    15858>>ASSIGN  15859>>ASSIGN  15860>>ASSIGN  15861>>ASSIGN  15863>>IF
     15864>>CALL    15866>>ASSIGN  16219<<ASSIGN  16220>>ASSIGN  16221>>ASSIGN  16247<<ASSIGN  16248>>ASSIGN
     16249>>IF      16250>>ASSIGN  16251>>ASSIGN  16254>>IF      16255>>IF      16262>>ASSIGN  16263>>CALL
     16263>>CALL    16269>>IF      16270>>ASSIGN  16272>>ASSIGN  16273>>IF      16274>>ASSIGN  16274>>ASSIGN
     16276>>CALL    16278>>ASSIGN  16286>>ASSIGN  16286>>ASSIGN  16287>>ASSIGN  16288>>IF      16289>>ASSIGN
     16290>>ASSIGN  16295>>ASSIGN  16295>>ASSIGN  16302>>ASSIGN  16304>>ASSIGN  16357<<ASSIGN  16358>>ASSIGN
     16359>>IF      16360>>ASSIGN  16361>>ASSIGN  16362>>DOCASE  16384<<ASSIGN  16385>>ASSIGN  16437>>CALL
     16443>>CALL    16493>>IF      16495>>ASSIGN  16504>>IF      16509>>IF      16512>>ASSIGN  16513>>ASSIGN
     16514>>ASSIGN  16520>>IF      16522>>ASSIGN  16527>>ASSIGN  16529>>IF      16531>>IF      16534>>IF
     16536>>ASSIGN  16537>>ASSIGN  16542>>CALL    16545>>ASSIGN  16548>>ASSIGN  16565>>ASSIGN  16566>>ASSIGN
     16568>>ASSIGN  16570>>ASSIGN  16575>>ASSIGN  16589>>IF      16591>>ASSIGN  16592>>ASSIGN  16600>>ASSIGN
     16616<<ASSIGN  16617>>DOWHILE 16619>>ASSIGN  16619>>ASSIGN  16622>>CALL    16623>>CALL    16627<<ASSIGN
     16627>>ASSIGN
STALOCK IN PROCEDURE SLOCK
     16434**ENTRY   15810--CALL    15857--CALL    16268--CALL    16511--CALL    16525--CALL    16547--CALL
     16569--CALL    16574--CALL    16618--CALL
STAUNLOCK IN PROCEDURE SLOCK
     16440**ENTRY   15814--CALL    15826--CALL    15865--CALL    16277--CALL    16296--CALL    16305--CALL
     16515--CALL    16541--CALL    16549--CALL    16571--CALL    16576--CALL    16620--CALL
SUNLOCK IN PROCEDURE SLOCK
     16428**ENTRY   15846--CALL    15868--CALL    16280--CALL    16297--CALL    16306--CALL    16621--CALL
     16629--CALL
S_CUN
     15589**DCL     15822>>IF      15823>>IF      15824>>IF      15902>>ASSIGN
T$
     15455**DCL     15840<<ASSIGN  15841>>DOWHILE 15842<<ASSIGN  15842>>ASSIGN  15844>>ASSIGN  15866<<ASSIGN
     15867<>CALL    15927<<ASSIGN  15928>>ASSIGN  15994<<ASSIGN  15996>>ASSIGN  15997<<ASSIGN  15997>>ASSIGN
     15998>>ASSIGN  16278<<ASSIGN  16279<>CALL    16512<<ASSIGN  16516>>IF      16522<<ASSIGN  16523<>CALL
     16527>>ASSIGN
TELLAU
     16488**PROC    16258--CALL
PL6.E3A0      #001=KCO$CLCG File=KCO$CLCG.:E05TSI                                WED 07/30/97 00:16 Page:157  
TELLDONE IN PROCEDURE TELLAU
     16543**LABEL   16516--GOTO
TRMGONE
     16324**PROC    16283--CALL    16321--CALL
UBINHALF
     15427**DCL     16565>>ASSIGN  16592>>ASSIGN
UQB$MDEQ
     15636**DCL-ENT 16014--CALL
UQB$MENQX
     15637**DCL-ENT 15802--CALL
USR
     15459**DCL     16330<<ASSIGN  16333<>CALL
VLP$SETSTA_V.MYSTATION
     15421**DCL     16019>>IF      16020<<ASSIGN

PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:158  
      974        1        /*T***********************************************************/
      975        2        /*T*                                                         */
      976        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      977        4        /*T*                                                         */
      978        5        /*T***********************************************************/
      979        6        /*T*/
      980        7
      981        8
      982        9        /**/
      983       10        /**/
      984       11
      985       12
      986       13        /*F* NAME:         KCO$TRMGO
      987       14
      988       15             CALL:         CALL KCO$TRMGO(LDCT$);
      989       16
      990       17             INPUT:        LDCT$ - Ptr to LDCT
      991       18
      992       19             DESCRIPTION:  KCO$TRMCON must have previously been called
      993       20                           for this LDCT.  KCA$TELLAUM is called to send connect
      994       21                           info to the AU if the AU desires it. KQC$ACTSTA is
      995       22                           then called if necessary to activate the station.
      996       23        */
      997       24
      998       25
      999       26        KCO$TRMGO: PROC(PLDCT$) ALTRET;  /* Doesn't ALTRET */
     1000       27        /**/
     1001       28
     1002       29
     1003       30        /**/
     1004       31        /* INCLUDES */
     1005       32        /**/
     1006       33        %INCLUDE CP_6;
     1007     5592        %INCLUDE CP_6_SUBS;
     1008     6132        %INCLUDE KC$CP6V_C;
     1009     6252        %INCLUDE KQ_MAC_C;
     1010     8802        %INCLUDE NK$LDCT;
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:159  
     1011     8904
     1012     8905
     1013     8906        /**/
     1014     8907        /* BASED STRUCTURES */
     1015     8908        /**/
     1016     8909        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CTX$)");
     1017     9648        %KQ_STA (FPTN=KQ$STA,STCLASS="BASED(STA$)");
     1018     9987        %NK$LDCT (STCLASS="BASED(LDCT$)");
     1019    10033
     1020    10034
     1021    10035        /**/
     1022    10036        /* PARAMETERS */
     1023    10037        /**/
     1024    10038    1   DCL PLDCT$ PTR;
     1025    10039
     1026    10040
     1027    10041        /**/
     1028    10042        /* AUTO */
     1029    10043        /**/
     1030    10044    1   DCL CTX$ PTR;
     1031    10045    1   DCL LDCT$ PTR;
     1032    10046    1   DCL STA$ PTR;
     1033    10047
     1034    10048
     1035    10049        /**/
     1036    10050        /* EXTERNAL ROUTINES */
     1037    10051        /**/
     1038    10052    1   DCL KCA$TELLAUM   ENTRY(3) ALTRET;
     1039    10053    1   DCL KQC$ACTSTA    ENTRY(2) ALTRET;
     1040    10054    1   DCL KQC$CLOSESTA  ENTRY(1) ALTRET;
     1041    10055    1   DCL KQX$LDASR     ENTRY(1);
     1042    10056
     1043    10057
     1044    10058        /**/
     1045    10059        /* EQUS */
     1046    10060        /**/
     1047    10061        %EQU_CG;
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:160  
     1048    10109        %EJECT;
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:161  
     1049    10110
     1050    10111
     1051    10112    1         LDCT$=PLDCT$;
     1052    10113    1         CTX$=NK$LDCT.CG$;
     1053    10114    1         CALL KQX$LDASR(KQ$CG);
     1054    10115    1         STA$=NK$LDCT.STA$;
     1055    10116    1         IF KQ$CG.CLOSING THEN    /* get rid of station that didn't get disconnected */
     1056    10117    2           DO;
     1057    10118    2           CALL KQC$CLOSESTA(KQ$STA);
     1058    10119    2           RETURN;
     1059    10120    2           END;
     1060    10121    1         IF (KQ$STA.TOLDAU = '0'B) THEN
     1061    10122    1          CALL KCA$TELLAUM(KQ$STA,%CG_TCON#);
     1062    10123    1         IF (KQ$CG.AUSTA$=ADDR(NIL) AND KQ$CG.AUCTL.TERMCONNAU)
     1063    10124    1         OR (KQ$CG.AUSTA$~=ADDR(NIL) AND KQ$CG.AUCTL.TERMCONAU) THEN
     1064    10125    1          CALL KQC$ACTSTA (KQ$STA);
     1065    10126    1         RETURN;
     1066    10127    1   END KCO$TRMGO;

PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:162  
--  Include file information  --

   NK$LDCT.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KCO$TRMGO.

   Procedure KCO$TRMGO requires 53 words for executable code.
   Procedure KCO$TRMGO requires 10 words of local(AUTO) storage.

    No errors detected in file KCO$CLCG.:E05TSI    .

PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:163  

 Object Unit name= KCO$TRMGO                                  File name= KCO$CLCG.:E05TOU
 UTS= JUL 30 '97 00:17:42.44 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none    53     65  KCO$TRMGO
    2  RoData even  none     1      1  KCO$TRMGO

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KCO$TRMGO

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KQX$LDASR
 yes     yes           Std       1 KQC$CLOSESTA
 yes     yes           Std       3 KCA$TELLAUM
 yes     yes           Std       2 KQC$ACTSTA
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:164  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:165  


      974        1        /*T***********************************************************/
      975        2        /*T*                                                         */
      976        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      977        4        /*T*                                                         */
      978        5        /*T***********************************************************/
      979        6        /*T*/
      980        7
      981        8
      982        9        /**/
      983       10        /**/
      984       11
      985       12
      986       13        /*F* NAME:         KCO$TRMGO
      987       14
      988       15             CALL:         CALL KCO$TRMGO(LDCT$);
      989       16
      990       17             INPUT:        LDCT$ - Ptr to LDCT
      991       18
      992       19             DESCRIPTION:  KCO$TRMCON must have previously been called
      993       20                           for this LDCT.  KCA$TELLAUM is called to send connect
      994       21                           info to the AU if the AU desires it. KQC$ACTSTA is
      995       22                           then called if necessary to activate the station.
      996       23        */
      997       24
      998       25
      999       26        KCO$TRMGO: PROC(PLDCT$) ALTRET;  /* Doesn't ALTRET */

     26  1 000000   000000 700200 xent  KCO$TRMGO    TSX0  ! X66_AUTO_1
         1 000001   000012 000001                    ZERO    10,1

     1000       27        /**/
     1001       28
     1002       29
     1003       30        /**/
     1004       31        /* INCLUDES */
     1005       32        /**/
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:166  
     1006       33        %INCLUDE CP_6;
     1007     5592        %INCLUDE CP_6_SUBS;
     1008     6132        %INCLUDE KC$CP6V_C;
     1009     6252        %INCLUDE KQ_MAC_C;
     1010     8802        %INCLUDE NK$LDCT;
     1011     8904
     1012     8905
     1013     8906        /**/
     1014     8907        /* BASED STRUCTURES */
     1015     8908        /**/
     1016     8909        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CTX$)");
     1017     9648        %KQ_STA (FPTN=KQ$STA,STCLASS="BASED(STA$)");
     1018     9987        %NK$LDCT (STCLASS="BASED(LDCT$)");
     1019    10033
     1020    10034
     1021    10035        /**/
     1022    10036        /* PARAMETERS */
     1023    10037        /**/
     1024    10038    1   DCL PLDCT$ PTR;
     1025    10039
     1026    10040
     1027    10041        /**/
     1028    10042        /* AUTO */
     1029    10043        /**/
     1030    10044    1   DCL CTX$ PTR;
     1031    10045    1   DCL LDCT$ PTR;
     1032    10046    1   DCL STA$ PTR;
     1033    10047
     1034    10048
     1035    10049        /**/
     1036    10050        /* EXTERNAL ROUTINES */
     1037    10051        /**/
     1038    10052    1   DCL KCA$TELLAUM   ENTRY(3) ALTRET;
     1039    10053    1   DCL KQC$ACTSTA    ENTRY(2) ALTRET;
     1040    10054    1   DCL KQC$CLOSESTA  ENTRY(1) ALTRET;
     1041    10055    1   DCL KQX$LDASR     ENTRY(1);
     1042    10056
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:167  
     1043    10057
     1044    10058        /**/
     1045    10059        /* EQUS */
     1046    10060        /**/
     1047    10061        %EQU_CG;
     1048    10109        %EJECT;
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:168  
     1049    10110
     1050    10111
     1051    10112    1         LDCT$=PLDCT$;

  10112  1 000002   200003 470500                    LDP0    @PLDCT$,,AUTO
         1 000003   000000 236100                    LDQ     0,,PR0
         1 000004   200005 756100                    STQ     LDCT$,,AUTO

     1052    10113    1         CTX$=NK$LDCT.CG$;

  10113  1 000005   200005 471500                    LDP1    LDCT$,,AUTO
         1 000006   100027 236100                    LDQ     23,,PR1
         1 000007   200004 756100                    STQ     CTX$,,AUTO

     1053    10114    1         CALL KQX$LDASR(KQ$CG);

  10114  1 000010   200004 630500                    EPPR0   CTX$,,AUTO
         1 000011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000012   000000 701000 xent               TSX1    KQX$LDASR
         1 000013   000000 011000                    NOP     0

     1054    10115    1         STA$=NK$LDCT.STA$;

  10115  1 000014   200005 470500                    LDP0    LDCT$,,AUTO
         1 000015   000012 236100                    LDQ     10,,PR0
         1 000016   200006 756100                    STQ     STA$,,AUTO

     1055    10116    1         IF KQ$CG.CLOSING THEN   /* get rid of station that didn't get disconnected */

  10116  1 000017   200004 471500                    LDP1    CTX$,,AUTO
         1 000020   100105 236100                    LDQ     69,,PR1
         1 000021   000040 316007                    CANQ    32,DL
         1 000022   000030 600000 1                  TZE     s:10121

     1056    10117    2           DO;

     1057    10118    2           CALL KQC$CLOSESTA(KQ$STA);
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:169  

  10118  1 000023   200006 630500                    EPPR0   STA$,,AUTO
         1 000024   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000025   000000 701000 xent               TSX1    KQC$CLOSESTA
         1 000026   000000 011000                    NOP     0

     1058    10119    2           RETURN;

  10119  1 000027   000000 702200 xent               TSX2  ! X66_ARET

     1059    10120    2           END;
     1060    10121    1         IF (KQ$STA.TOLDAU = '0'B) THEN

  10121  1 000030   200006 473500                    LDP3    STA$,,AUTO
         1 000031   300020 236100                    LDQ     16,,PR3
         1 000032   004000 316003                    CANQ    2048,DU
         1 000033   000043 601000 1                  TNZ     s:10123

     1061    10122    1          CALL KCA$TELLAUM(KQ$STA,%CG_TCON#);

  10122  1 000034   000000 236000 2                  LDQ     0
         1 000035   200006 235100                    LDA     STA$,,AUTO
         1 000036   200010 757100                    STAQ    STA$+2,,AUTO
         1 000037   200010 630500                    EPPR0   STA$+2,,AUTO
         1 000040   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000041   000000 701000 xent               TSX1    KCA$TELLAUM
         1 000042   000000 011000                    NOP     0

     1062    10123    1         IF (KQ$CG.AUSTA$=ADDR(NIL) AND KQ$CG.AUCTL.TERMCONNAU)

  10123  1 000043   200004 470500                    LDP0    CTX$,,AUTO
         1 000044   000121 236100                    LDQ     81,,PR0
         1 000045   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000046   000052 601000 1                  TNZ     s:10123+7
         1 000047   000133 236100                    LDQ     91,,PR0
         1 000050   040000 316007                    CANQ    16384,DL
         1 000051   000060 601000 1                  TNZ     s:10125
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:170  
         1 000052   000121 236100                    LDQ     81,,PR0
         1 000053   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000054   000064 600000 1                  TZE     s:10126
         1 000055   000133 236100                    LDQ     91,,PR0
         1 000056   200000 316007                    CANQ    65536,DL
         1 000057   000064 600000 1                  TZE     s:10126

     1063    10124    1         OR (KQ$CG.AUSTA$~=ADDR(NIL) AND KQ$CG.AUCTL.TERMCONAU) THEN
     1064    10125    1          CALL KQC$ACTSTA (KQ$STA);

  10125  1 000060   200006 630500                    EPPR0   STA$,,AUTO
         1 000061   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000062   000000 701000 xent               TSX1    KQC$ACTSTA
         1 000063   000000 011000                    NOP     0

     1065    10126    1         RETURN;

  10126  1 000064   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   2     000   000004 006000                                                    ....
     1066    10127    1   END KCO$TRMGO;

PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:171  
--  Include file information  --

   NK$LDCT.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KCO$TRMGO.
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:172  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @PLDCT$                    4-0-0/w PTR         r     1 CTX$
     5-0-0/w PTR         r     1 LDCT$                     *0-0-0/w PTR         r     1 PLDCT$
     6-0-0/w PTR         r     1 STA$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d STRC(1296)  r     1 KQ$STA
     0-0-0/d STRC(864)   r     1 NK$LDCT


   Procedure KCO$TRMGO requires 53 words for executable code.
   Procedure KCO$TRMGO requires 10 words of local(AUTO) storage.

    No errors detected in file KCO$CLCG.:E05TSI    .
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:173  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:174  
          MINI XREF LISTING

CTX$
     10044**DCL      8924--IMP-PTR 10113<<ASSIGN  10114>>CALL    10116>>IF      10123>>IF      10123>>IF
     10123>>IF      10123>>IF
KCA$TELLAUM
     10052**DCL-ENT 10122--CALL
KQ$CG
      8924**DCL     10114<>CALL
KQ$CG.AUCTL.DVBYTE.REREAD
      9367**DCL      9368--REDEF
KQ$CG.AUCTL.TERMCONAU
      9364**DCL     10123>>IF
KQ$CG.AUCTL.TERMCONNAU
      9365**DCL     10123>>IF
KQ$CG.AUSTA$
      9334**DCL     10123>>IF      10123>>IF
KQ$CG.CLOSING
      9291**DCL     10116>>IF
KQ$STA
      9662**DCL     10118<>CALL    10122<>CALL    10125<>CALL
KQ$STA.ACTTYC
      9714**DCL      9718--REDEF
KQ$STA.DCBLNK$
      9721**DCL      9724--REDEF    9728--REDEF
KQ$STA.EVCNT
      9807**DCL      9810--REDEF
KQ$STA.EVNT
      9773**DCL      9777--REDEF    9780--REDEF
KQ$STA.OPNBLKED
      9834**DCL      9837--REDEF
KQ$STA.OPNREJ
      9840**DCL      9842--REDEF
KQ$STA.SUCCREAD
PL6.E3A0      #002=KCO$TRMGO File=KCO$CLCG.:E05TSI                               WED 07/30/97 00:17 Page:175  
      9763**DCL      9767--REDEF
KQ$STA.TCOUNT
      9892**DCL      9898--REDEF
KQ$STA.TOLDAU
      9770**DCL     10121>>IF
KQ$STA.VGOT$
      9877**DCL      9881--REDEF    9885--REDEF
KQC$ACTSTA
     10053**DCL-ENT 10125--CALL
KQC$CLOSESTA
     10054**DCL-ENT 10118--CALL
KQX$LDASR
     10055**DCL-ENT 10114--CALL
LDCT$
     10045**DCL     10000--IMP-PTR 10112<<ASSIGN  10113>>ASSIGN  10115>>ASSIGN
NK$LDCT.CG$
     10031**DCL     10113>>ASSIGN
NK$LDCT.DDT$
     10002**DCL     10002--REDEF
NK$LDCT.IOQ$
     10001**DCL     10002--REDEF
NK$LDCT.LDCTX
     10003**DCL     10003--REDEF
NK$LDCT.LKFLG.ABORTED
     10015**DCL     10016--REDEF
NK$LDCT.RLCID.LDCTX
     10025**DCL     10025--REDEF
NK$LDCT.STA$
     10021**DCL     10022--REDEF   10115>>ASSIGN
NK$LDCT.SYMB$
     10000**DCL     10000--REDEF   10000--REDEF   10001--REDEF
PLDCT$
     10038**DCL        26--PROC    10112>>ASSIGN
STA$
     10046**DCL      9662--IMP-PTR 10115<<ASSIGN  10118>>CALL    10121>>IF      10122>>CALL    10125>>CALL
