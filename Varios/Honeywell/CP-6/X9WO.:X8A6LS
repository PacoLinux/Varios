VERSION A06

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:1    
        1        1        /*M* X9WO$OPEN --  Provides functionality to support the OPEN stmt. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*P*
        9        9
       10       10          NAME:  X9WO$OPEN
       11       11
       12       12          PURPOSE: Interfaces with the CP-6 Monitor Service routines to open
       13       13                   files for use by Cobol IO.
       14       14
       15       15        */
       16       16
       17       17        /*D*
       18       18
       19       19          NAME:  X9WO$OPEN
       20       20
       21       21          PURPOSE:  To handle all the operations  associated will the opening
       22       22                  of COBOL file for IO processing.
       23       23
       24       24          CALL:  CALL X9WO$OPEN  (FAB, OPEN_TYPE)
       25       25
       26       26          PARAMETER:
       27       27                 FAB          -- File Attribute Block.
       28       28                 OPEN_TYPE    -- Type of open to be performed.
       29       29                 COMCOM.OPTZ  -- Determines if the DCB has been initialized
       30       30                                 or will be initialized on the first OPEN.
       31       31          INTERFACE:
       32       32                 X9WO$CONVERT_LINAGE       -- Converts linage items to integer
       33       33                 X8CV$CONVERT_FROM_INTEGER -- Converts relative key from
       34       34                                              integer to the Cobol program'
       35       35                                              key description.
       36       36                 X9WE$IO_ERROR             -- Called to report IO errors.
       37       37                 X9WE$IO_ERROR_STATUS      -- Reports status code IO errors.
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:2    
       38       38                 X9MM$GET_MEM              -- Gets memory for fast sequential IO.
       39       39                 XSA$OPEN                  -- Tests file for use of Fast Seq IO.
       40       40                 XSA$PFIL                  -- Fast sequential IO file positioning.
       41       41                 M$CLOSE                   -- Monitor service call to close files.
       42       42                 M$OPEN                    -- Monitor service call to open files.
       43       43
       44       44          OUTPUT:  FAB, DCB
       45       45
       46       46          DESCRIPTION:  This procedure will open files for Cobol IO and if
       47       47            possible will use fast sequential IO.  The DCB may also be
       48       48            initialized at runtime (COMCOM.OPTZ=TRUE) with the first call to
       49       49            open this file.
       50       50
       51       51        */
       52       52        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:3    
       53       53        /*---------*/
       54       54          X9WO$OPEN: PROC (FAB, OPEN_TYPE);
       55       55        /*---------*/
       56       56
       57       57            %INCLUDE X8A_SYS_FILE;
       58     6327            %INCLUDE X8A_ERRCOM;
       59     6416            %INCLUDE X8A_LIBCOM;
       60     6636            %INCLUDE X9A_FAB;
       61     6823            %INCLUDE X9A_IO;
       62     6973            %INCLUDE X9A_LIB_IO;
       63     7357            %DCL_FAB;
       64     7479
       65     7480    1       DCL OPEN_TYPE       SBIN WORD;
       66     7481    1       DCL LINAGE_COUNTER  SBIN BASED (FAB.LINAGE_COUNTER$);
       67     7482    1       DCL IO_STATUS       CHAR(2) BASED (FAB.IO_STATUS$);
       68     7483    1       DCL LENGTH          SBIN WORD;  /* length of filename for error */
       69     7484
       70     7485    1       DCL 1 FILE_NAME     DALIGNED,
       71     7486    1             2 LENGTH      UBIN(9)  UNAL,
       72     7487    1             2 TEXT        CHAR(31) UNAL;
       73     7488
       74     7489    1       DCL FILE_ID         CHAR(FAB.FILE_ID_LEN) BASED(FAB.FILE_ID$);
       75     7490
       76     7491    1       DCL 1 FSA_          DALIGNED,
       77     7492    1           2 *             BIT(36),
       78     7493    1           2 PTR$          PTR;
       79     7494
       80     7495    1       DCL RELATIVE_KEY    UBIN WORD;
       81     7496        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:4    
       82     7497    1       DCL X9WE$IO_ERROR                ENTRY(2) ALTRET;
       83     7498    1       DCL X9WE$IO_ERROR_STATUS         ENTRY(2) ALTRET;
       84     7499    1       DCL X8CV$CONVERT_FROM_INTEGER    ENTRY(3) ALTRET;
       85     7500    1       DCL X9WO$CONVERT_LINAGE          ENTRY(1);
       86     7501    1       DCL X9MM$GET_MEM                 ENTRY(1) ALTRET;
       87     7502    1       DCL XSA$OPEN                     ENTRY(2) ALTRET;
       88     7503    1       DCL XSA$PFIL                     ENTRY(2) ALTRET;
       89     7504    1       DCL X9WU$WRITE_USER_LABEL        ENTRY(4);
       90     7505    1       DCL X9WU$READ_USER_LABEL         ENTRY(4);
       91     7506
       92     7507
       93     7508            %FPT_PFIL  (FPTN = FPT_PFIL);
       94     7523            %FPT_OPEN  (FPTN=OPEN_FILE, REASSIGN = YES);
       95     7632            %FPT_CLOSE (FPTN=CLOSE_FILE);
       96     7674            %VLP_ALTKEYS (FPTN=ALT_KEYS, STCLASS="BASED (FAB.ALT_KEY$)", N=19);
       97     7689        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:5    
       98     7690    1       FAB.LAST_IO = %OPEN;
       99     7691    2       DO CASE (FAB.FILE_STATUS);
      100     7692
      101     7693    2         CASE (%FILE_LOCKED);
      102     7694
      103     7695    2            IO_STATUS = %LOCKED;
      104     7696    2            CALL X9WE$IO_ERROR_STATUS (FAB);
      105     7697    2            RETURN;
      106     7698
      107     7699    2         CASE (%FILE_OPEN);
      108     7700
      109     7701    2            IO_STATUS = %ALREADY_OPEN;
      110     7702    2            CALL X9WE$IO_ERROR_STATUS (FAB);
      111     7703    2            RETURN;
      112     7704
      113     7705    2         CASE (ELSE);
      114     7706
      115     7707                 /* OK to Open */
      116     7708
      117     7709    2       END; /* case fab.file_status */
      118     7710        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:6    
      119     7711    1       DCB$ = DCBADDR (FAB.DCB_NUM);
      120     7712    1       IF NOT FAB.B.DCB_INIT THEN   /* If Dcb is not initialized */
      121     7713    2         DO;                        /* then open and initialize  */
      122     7714    2           CALL OPEN_INIT;
      123     7715    2           FAB.B.DCB_INIT = %YES#;
      124     7716    2         END;
      125     7717
      126     7718    1       IO_STATUS = %SUCCESSFUL;   /* Preset IO status */
      127     7719    1       FAB.B.NO_NEXT_RECORD_EXISTS = %NO#;
      128     7720    1       OPEN_FILE.V.DCB# = FAB.DCB_NUM;
      129     7721
      130     7722        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:7    
      131     7723        /*V*                   Cobol-74_Compatability
      132     7724                The VALUE OF FILE-ID is now used to specify the files actual
      133     7725            name.  Previously, it was treated as a comment entry and when the
      134     7726            COBOL-74 compatability option is on; this claus is ignored.
      135     7727        */
      136     7728    1       IF FAB.FILE_ID$ ~= ADDR(NIL) AND NOT LIBCOM.COBOL_74 THEN
      137     7729    1         CALL ADD_FILE_ID;
      138     7730    1       ELSE
      139     7731    2         DO;
      140     7732    2           OPEN_FILE.NAME_ = VECTOR(NIL);
      141     7733    2           OPEN_FILE.ACCT_ = VECTOR(NIL);
      142     7734    2         END;
      143     7735
      144     7736    1       IF FAB.LABEL_REC$ ~= ADDR(NIL) OR
      145     7737    1          FAB.LABEL_EXIT$ ~= ADDR(NIL) THEN
      146     7738    2         DO;
      147     7739    2           OPEN_FILE.V.CVOL# = '1'B;
      148     7740                %BEFORE_BEGINNING_LABEL_PROC;
      149     7762
      150     7763    2           IF FAB.B.BEGIN_FILE_LABEL THEN
      151     7764    2             CALL X9WU$WRITE_USER_LABEL (FAB, OPEN_FILE.UHL_,
      152     7765    2                                         %BEGINNING_FILE_LABEL,
      153     7766    2                                         OPEN_TYPE);
      154     7767    2         END;
      155     7768    1       ELSE
      156     7769    2         DO;
      157     7770    2           OPEN_FILE.V.CVOL# = %NO#;
      158     7771    2           OPEN_FILE.UHL_ = VECTOR(NIL);
      159     7772    2         END;
      160     7773
      161     7774
      162     7775    1       FAB.B.SHARED_INDEX_ALT = %NO#;                                /* #37711 */
      163     7776    1       OPEN_FILE.V.EXIST# = 0;                        /*#34004*/
      164     7777                                      /*  Zero is placed in the exist to
      165     7778                                          reset the field to a null stat.
      166     7779                                          Open extend will change this field */
      167     7780
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:8    
      168     7781
      169     7782    2       DO CASE (OPEN_TYPE);
      170     7783        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:9    
      171     7784    2         CASE  (%OPEN_INPUT);
      172     7785
      173     7786    2           OPEN_FILE.V.FUN# = %IN;                            /*#30707*/
      174     7787    2           CALL XSA$OPEN  (OPEN_FILE, FAB.XSA)
      175     7788    2             WHENRETURN
      176     7789    3               DO;
      177     7790    3                 CALL ATTRIBUTE_CHECK
      178     7791    3                   WHENALTRETURN
      179     7792    4                     DO;
      180     7793    4                       IF IO_STATUS ~= %SUCCESSFUL THEN
      181     7794    4                         RETURN;
      182     7795    4                     END;
      183     7796    3                 IF FAB.XSA.ORG ~= %CP6_DEFAULT THEN
      184     7797    3                   CALL GET_MEM;
      185     7798    3                 CALL NORMAL_REWIND;
      186     7799    3                 FAB.FILE_STATUS = %FILE_OPEN;
      187     7800    3               END;
      188     7801    2             WHENALTRETURN
      189     7802    3               DO;
      190     7803    3                 CALL X9WE$IO_ERROR (FAB);
      191     7804    3               END;
      192     7805        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:10   
      193     7806    2         CASE  (%OPEN_INPUT_NO_REWIND);
      194     7807
      195     7808    2           OPEN_FILE.V.FUN# = %IN;                            /*#30707*/
      196     7809    2           CALL XSA$OPEN  (OPEN_FILE, FAB.XSA)
      197     7810    2             WHENRETURN
      198     7811    3               DO;
      199     7812    3                 CALL ATTRIBUTE_CHECK
      200     7813    3                   WHENALTRETURN
      201     7814    4                     DO;
      202     7815    4                       IF IO_STATUS ~= %SUCCESSFUL THEN
      203     7816    4                         RETURN;  /* Don't open the file */
      204     7817    4                     END;
      205     7818    3                 IF FAB.XSA.ORG ~= %CP6_DEFAULT THEN
      206     7819    3                   CALL GET_MEM;
      207     7820    3                 FAB.FILE_STATUS = %FILE_OPEN;
      208     7821    3                 IF M$XX.ASN# ~= %CP6_TAPE THEN
      209     7822    3                   IO_STATUS = %NON_REEL_MEDIUM;
      210     7823    3               END;
      211     7824    2             WHENALTRETURN
      212     7825    3               DO;
      213     7826    3                 CALL X9WE$IO_ERROR (FAB);
      214     7827    3               END;
      215     7828        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:11   
      216     7829    2         CASE  (%OPEN_OUTPUT) ;
      217     7830
      218     7831    2           OPEN_FILE.V.FUN# = %CREATE;
      219     7832    2           IF FAB.ORG# = %CP6_INDEXED    AND         /*#35288*/
      220     7833    2                FAB.ALT_KEY$ ~= ADDR(NIL)   THEN
      221     7834    2             OPEN_FILE.ALTKEYS_ = VECTOR (ALT_KEYS);
      222     7835    2           ELSE
      223     7836    2             OPEN_FILE.ALTKEYS_ = VECTOR (NIL);              /*#30011*/
      224     7837    2           CALL XSA$OPEN  (OPEN_FILE, FAB.XSA)
      225     7838    2             WHENRETURN
      226     7839    3               DO;
      227     7840    3                 CALL ATTRIBUTE_CHECK
      228     7841    3                   WHENALTRETURN
      229     7842    4                     DO;
      230     7843    4                       IF IO_STATUS ~= %SUCCESSFUL THEN
      231     7844    5                         DO;
      232     7845    5                           CLOSE_FILE.V.DCB# = FAB.DCB_NUM;
      233     7846    5                           CALL M$CLOSE (CLOSE_FILE);
      234     7847    5                           RETURN;
      235     7848    5                         END;
      236     7849    4                     END;
      237     7850    3                 FAB.FILE_STATUS = %FILE_OPEN;
      238     7851    3                 IF  FAB.ACS# = %CP6_SEQUENTIAL_ACCESS THEN
      239     7852    4                   DO;
      240     7853    4                     IF FAB.XSA.ORG ~= %CP6_DEFAULT THEN
      241     7854    4                       CALL GET_MEM;
      242     7855    4                     IF   FAB.LINAGE_LINES$ ~= ADDR(NIL) THEN
      243     7856    5                       DO;
      244     7857    5                         CALL X9WO$CONVERT_LINAGE (FAB);
      245     7858    5                         LINAGE_COUNTER  = 1;
      246     7859    5                       END;
      247     7860    4                     IF FAB.RELATIVE_KEY$ ~= ADDR(NIL) THEN
      248     7861    5                       DO;
      249     7862    5                         RELATIVE_KEY = 0;
      250     7863    5                         CALL X8CV$CONVERT_FROM_INTEGER (
      251     7864    5                              FAB.RELATIVE_KEY$, FAB.RELATIVE_DESC,
      252     7865    5                              RELATIVE_KEY);
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:12   
      253     7866    5                       END;
      254     7867    4                   END;
      255     7868    3                 IF M$XX.ASN# = %CP6_TAPE THEN
      256     7869    3                   CALL NORMAL_REWIND;
      257     7870    3               END;
      258     7871    2             WHENALTRETURN
      259     7872    3               DO;
      260     7873    3                 CALL X9WE$IO_ERROR (FAB);
      261     7874    3               END;
      262     7875        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:13   
      263     7876    2         CASE  (%OPEN_OUTPUT_NO_REWIND);
      264     7877
      265     7878    2           OPEN_FILE.V.FUN# = %CREATE;
      266     7879    2           IF FAB.ORG# = %CP6_INDEXED THEN
      267     7880    2             IF FAB.ALT_KEY$ ~= ADDR(NIL) THEN
      268     7881    2               OPEN_FILE.ALTKEYS_ = VECTOR (ALT_KEYS);
      269     7882    2             ELSE
      270     7883    2               OPEN_FILE.ALTKEYS_ = VECTOR (NIL);              /*#30011*/
      271     7884    2           CALL XSA$OPEN  (OPEN_FILE, FAB.XSA)
      272     7885    2             WHENRETURN
      273     7886    3               DO;
      274     7887    3                 CALL ATTRIBUTE_CHECK
      275     7888    3                   WHENALTRETURN
      276     7889    4                     DO;
      277     7890    4                       IF IO_STATUS ~= %SUCCESSFUL THEN
      278     7891    5                         DO;
      279     7892    5                           CLOSE_FILE.V.DCB# = FAB.DCB_NUM;
      280     7893    5                           CALL M$CLOSE (CLOSE_FILE);
      281     7894    5                           RETURN;
      282     7895    5                         END;
      283     7896    4                     END;
      284     7897    3                 FAB.FILE_STATUS = %FILE_OPEN;
      285     7898    3                 IF  FAB.ACS# = %CP6_SEQUENTIAL_ACCESS THEN
      286     7899    4                   DO;
      287     7900    4                     IF FAB.XSA.ORG ~= %CP6_DEFAULT THEN
      288     7901    4                       CALL GET_MEM;
      289     7902    4                     IF   FAB.LINAGE_LINES$ ~= ADDR(NIL) THEN
      290     7903    5                       DO;
      291     7904    5                         CALL X9WO$CONVERT_LINAGE (FAB);
      292     7905    5                         LINAGE_COUNTER  = 1;
      293     7906    5                       END;
      294     7907    4                     IF FAB.RELATIVE_KEY$ ~= ADDR(NIL) THEN
      295     7908    5                       DO;
      296     7909    5                         RELATIVE_KEY = 0;
      297     7910    5                         CALL X8CV$CONVERT_FROM_INTEGER (
      298     7911    5                              FAB.RELATIVE_KEY$, FAB.RELATIVE_DESC,
      299     7912    5                              RELATIVE_KEY);
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:14   
      300     7913    5                       END;
      301     7914    4                   END;
      302     7915    3                 IF M$XX.ASN# ~= %CP6_TAPE THEN
      303     7916    3                   IO_STATUS = %NON_REEL_MEDIUM;
      304     7917    3               END;
      305     7918    2             WHENALTRETURN
      306     7919    3               DO;
      307     7920    3                 CALL X9WE$IO_ERROR (FAB);
      308     7921    3               END;
      309     7922        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:15   
      310     7923    2         CASE  (%OPEN_I_O);
      311     7924
      312     7925    2           IF FAB.B.OPTIONAL_FILE THEN
      313     7926    3             DO;
      314     7927    3               CALL OPTIONAL_CHECK;
      315     7928    3               IF FAB.FILE_STATUS = %FILE_NOT_PRESENT THEN
      316     7929    3                 CALL CREATE_OPTIONAL_FILE;
      317     7930    3             END; /* if optional file */
      318     7931    2           OPEN_FILE.V.FUN# = %UPDATE;                        /*#30707*/
      319     7932    2           FAB.B.FAST_SEQUENTIAL = NO#;
      320     7933    2           CALL M$OPEN (OPEN_FILE)
      321     7934    2             WHENRETURN
      322     7935    3               DO;
      323     7936    3                 IF M$XX.ASN# = %CP6_TAPE THEN
      324     7937    4                   DO;
      325     7938    4                     IO_STATUS = %FILE_OPEN_CONFLICT;
      326     7939    4                     CALL X9WE$IO_ERROR_STATUS (FAB);
      327     7940    4                   END;
      328     7941    3                 CALL ATTRIBUTE_CHECK
      329     7942    3                   WHENALTRETURN
      330     7943    4                     DO;
      331     7944    4                       IF IO_STATUS ~= %SUCCESSFUL THEN
      332     7945    5                         DO;
      333     7946    5                           CLOSE_FILE.V.DCB# = FAB.DCB_NUM;
      334     7947    5                           CALL M$CLOSE (CLOSE_FILE);
      335     7948    5                           RETURN;
      336     7949    5                         END;
      337     7950    4                     END;
      338     7951    3                 CALL NORMAL_REWIND;
      339     7952    3                 FAB.FILE_STATUS = %FILE_OPEN;
      340     7953    3               END;
      341     7954    2             WHENALTRETURN
      342     7955    3               DO;
      343     7956    3                 CALL X9WE$IO_ERROR  (FAB);
      344     7957    3               END;
      345     7958        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:16   
      346     7959    2         CASE  (%OPEN_EXTEND);
      347     7960
      348     7961    2           CALL OPTIONAL_CHECK;
      349     7962    2           IF  FAB.FILE_STATUS = %FILE_NOT_PRESENT
      350     7963    2           AND ~ FAB.B.OPTIONAL_FILE THEN
      351     7964    2              RETURN;
      352     7965
      353     7966    2           OPEN_FILE.V.FUN# = %CREATE;
      354     7967    2           OPEN_FILE.V.EXIST# = %OLDFILE;
      355     7968    2           FAB.B.FAST_SEQUENTIAL = NO#;
      356     7969    2           CALL M$OPEN  (OPEN_FILE)
      357     7970    2             WHENRETURN
      358     7971    3               DO;
      359     7972    3                 CALL ATTRIBUTE_CHECK
      360     7973    3                   WHENALTRETURN
      361     7974    4                     DO;
      362     7975    4                       IF IO_STATUS ~= %SUCCESSFUL THEN
      363     7976    5                         DO;
      364     7977    5                           CLOSE_FILE.V.DCB# = FAB.DCB_NUM;
      365     7978    5                           CALL M$CLOSE (CLOSE_FILE);
      366     7979    5                           RETURN;
      367     7980    5                         END;
      368     7981    4                     END;
      369     7982    3                 FAB.FILE_STATUS = %FILE_OPEN;
      370     7983    3                 IF  FAB.ACS# = %CP6_SEQUENTIAL_ACCESS THEN
      371     7984    4                   DO;
      372     7985    4                     IF   FAB.LINAGE_LINES$ ~= ADDR(NIL) THEN
      373     7986    5                       DO;
      374     7987    5                         CALL X9WO$CONVERT_LINAGE (FAB);
      375     7988    5                         LINAGE_COUNTER  = 1;
      376     7989    5                       END;
      377     7990    4                     IF FAB.ORG# = %CP6_RELATIVE THEN
      378     7991    4                       IF FAB.RELATIVE_KEY$ = ADDR(NIL) THEN
      379     7992        /*                    CALL EXTEND_START;
      380     7993                            ELSE                         */
      381     7994    5                         DO;    /* Relative Key was specified */
      382     7995    5                           CALL START;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:17   
      383     7996    5                           CALL X8CV$CONVERT_FROM_INTEGER (FAB.RELATIVE_KEY$,
      384     7997    5                                            FAB.RELATIVE_DESC, RELATIVE_KEY);
      385     7998    5                         END;
      386     7999    4                   END;
      387     8000        /*V*  When the file is assigned to magnegtic tape,  open
      388     8001          with %CREATE & %OLDFILE won't position the tape to
      389     8002          the end-of-file, so we must do this manually.       */
      390     8003
      391     8004    3                 IF FAB.ASSIGN = %CP6_MAGNETIC_TAPE THEN
      392     8005    4                   DO;
      393     8006    4                     FPT_PFIL.V.DCB# = FAB.DCB_NUM;
      394     8007    4                     CALL M$PFIL(FPT_PFIL);
      395     8008    4                   END;
      396     8009    3               END;
      397     8010    2             WHENALTRETURN
      398     8011    3               DO;
      399     8012    3                 CALL X9WE$IO_ERROR  (FAB);
      400     8013    3               END;
      401     8014    2       END;  /* case open_type */
      402     8015
      403     8016    1       IF FAB.B.BEGIN_FILE_LABEL THEN
      404     8017    1         CALL X9WU$READ_USER_LABEL (FAB, OPEN_FILE.UHL_,
      405     8018    1                                    %BEGINNING_FILE_LABEL,
      406     8019    1                                    OPEN_TYPE);
      407     8020
      408     8021            %AFTER_BEGINNING_LABEL_PROC;
      409     8043
      410     8044        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:18   
      411     8045        /*---------------*/
      412     8046    1       NORMAL_REWIND: PROC;
      413     8047        /*---------------*/
      414     8048
      415     8049        /*P*
      416     8050          NAME:    NORMAL_REWIND
      417     8051
      418     8052          PURPOSE:  To rewind files as needed.
      419     8053        */
      420     8054
      421     8055            %FPT_PFIL          (FPTN=REWIND_FILE, BOF=YES);
      422     8070
      423     8071    2       IF M$XX.ASN# = %CP6_FILE
      424     8072    2       OR M$XX.ASN# = %CP6_TAPE THEN
      425     8073    3         DO;
      426     8074    3           REWIND_FILE.V.DCB# = FAB.DCB_NUM;
      427     8075    3           IF FAB.B.FAST_SEQUENTIAL THEN
      428     8076    3             CALL XSA$PFIL (REWIND_FILE, FAB.XSA)
      429     8077    3             WHENALTRETURN
      430     8078    4               DO;
      431     8079    4                 CALL X9WE$IO_ERROR (FAB);
      432     8080    4               END;
      433     8081    3           ELSE
      434     8082    3             CALL M$PFIL  (REWIND_FILE)
      435     8083    3               WHENALTRETURN
      436     8084    4                 DO;
      437     8085    4                   CALL X9WE$IO_ERROR  (FAB);
      438     8086    4                 END;
      439     8087    3         END;
      440     8088    2     END NORMAL_REWIND; /* PROC */
      441     8089        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:19   
      442     8090        /*---------------*/
      443     8091    1     ATTRIBUTE_CHECK:     PROC ALTRET;
      444     8092        /*---------------*/
      445     8093
      446     8094        /*F*
      447     8095             NAME:  ATTRIBUTE_CHECK
      448     8096          PURPOSE:  To check for attribute conflicts between the file's program
      449     8097                    definition and the file's actual attributes.
      450     8098        */
      451     8099
      452     8100    3       DO CASE (FAB.ORG#);
      453     8101
      454     8102    3         CASE (%CP6_SEQUENTIAL);
      455     8103
      456     8104    3           IF M$XX.ORG# = %CP6_RELATIVE
      457     8105    3           OR M$XX.ORG# = %CP6_INDEXED  THEN
      458     8106    4             DO;
      459     8107    4               IO_STATUS = %ATTRIBUTE_CONFLICT;
      460     8108    4               CALL X9WE$IO_ERROR_STATUS (FAB);
      461     8109    4             END;
      462     8110
      463     8111    3         CASE (%CP6_RELATIVE);
      464     8112
      465     8113    3           IF M$XX.ORG# = %CP6_SEQUENTIAL
      466     8114    3           OR M$XX.ORG# = %CP6_UR                              /*#31542*/
      467     8115    3           OR M$XX.ORG# = %CP6_FIXED
      468     8116    3           OR M$XX.ORG# = %CP6_INDEXED    THEN
      469     8117    4             DO;
      470     8118    4               IO_STATUS = %ATTRIBUTE_CONFLICT;
      471     8119    4               CALL X9WE$IO_ERROR_STATUS (FAB);
      472     8120    4             END;
      473     8121        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:20   
      474     8122    3         CASE (%CP6_INDEXED);
      475     8123
      476     8124    3           IF M$XX.ORG# = %CP6_SEQUENTIAL
      477     8125    3           OR M$XX.ORG# = %CP6_UR                              /*#31542*/
      478     8126    3           OR M$XX.ORG# = %CP6_FIXED
      479     8127    3           OR M$XX.ORG# = %CP6_KEYED
      480     8128    3           OR M$XX.ORG# = %CP6_RELATIVE   THEN
      481     8129    4             DO;
      482     8130    4               IO_STATUS = %ATTRIBUTE_CONFLICT;
      483     8131    4               CALL X9WE$IO_ERROR_STATUS (FAB);
      484     8132    4             END;
      485     8133
      486     8134    3       END;  /* case fab.org# */
      487     8135        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:21   
      488     8136        /*V*
      489     8137             NAME:  DEVICE_CHECK
      490     8138          PURPOSE:  To check for device conflicts between the file's program
      491     8139                    open mode and the file's actual device assignment.
      492     8140        */
      493     8141
      494     8142    3       DO CASE (OPEN_TYPE);
      495     8143
      496     8144    3         CASE (%OPEN_INPUT, %OPEN_INPUT_NO_REWIND);
      497     8145
      498     8146    3           IF FAB.ASSIGN = %CP6_PRINTER OR
      499     8147    3              FAB.ASSIGN = %CP6_PRINTER_F OR
      500     8148    3              FAB.ASSIGN = %CP6_SYSOUT OR
      501     8149    3              FAB.ASSIGN = %CP6_CARD_PUNCH THEN
      502     8150    4             DO;
      503     8151    4               IO_STATUS = %FILE_OPEN_CONFLICT;
      504     8152    4               CALL X9WE$IO_ERROR_STATUS (FAB);
      505     8153    4               ALTRETURN;
      506     8154    4             END;
      507     8155        /*      IF M$XX.RECL# ~= FAB.MAX_REC_LEN THEN
      508     8156                  DO;
      509     8157                    IO_STATUS = %ATTRIBUTE_CONFLICT;
      510     8158                    CALL X9WE$IO_ERROR_STATUS (FAB);
      511     8159                  END;
      512     8160        */
      513     8161    3         CASE (%OPEN_OUTPUT, %OPEN_EXTEND, %OPEN_OUTPUT_NO_REWIND);
      514     8162    3           IF FAB.ASSIGN = %CP6_CARD_READER OR
      515     8163    3              FAB.ASSIGN = %CP6_SYSIN THEN
      516     8164    4             DO;
      517     8165    4               IO_STATUS = %FILE_OPEN_CONFLICT;
      518     8166    4               CALL X9WE$IO_ERROR_STATUS (FAB);
      519     8167    4               ALTRETURN;
      520     8168    4             END;
      521     8169        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:22   
      522     8170    3         CASE (%OPEN_I_O);
      523     8171    3           IF FAB.ASSIGN = %CP6_CARD_READER OR
      524     8172    3              FAB.ASSIGN = %CP6_CARD_PUNCH THEN
      525     8173    4             DO;
      526     8174    4               IO_STATUS = %FILE_OPEN_CONFLICT;
      527     8175    4               CALL X9WE$IO_ERROR_STATUS (FAB);
      528     8176    4               ALTRETURN;
      529     8177    4             END;
      530     8178
      531     8179    3       END; /* open_type */
      532     8180
      533     8181    2     END ATTRIBUTE_CHECK;  /* proc */
      534     8182        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:23   
      535     8183        /*----------------*/
      536     8184    1       OPTIONAL_CHECK: PROC;
      537     8185        /*----------------*/
      538     8186
      539     8187        /*P*
      540     8188             NAME:  OPTIONAL_CHECK
      541     8189          PURPOSE:  Checks for optional file which don't exist and creates
      542     8190                    them when neccessary  (EXTEND, I-O).
      543     8191        */
      544     8192
      545     8193    2       OPEN_FILE.V.FUN# = %IN;
      546     8194    2       CLOSE_FILE.V.DCB# = FAB.DCB_NUM;
      547     8195    2       CALL M$OPEN (OPEN_FILE)
      548     8196    2         WHENRETURN
      549     8197    3           DO;
      550     8198    3             CALL M$CLOSE (CLOSE_FILE);
      551     8199    3           END;
      552     8200    2         WHENALTRETURN
      553     8201    3           DO;
      554     8202    3             CALL X9WE$IO_ERROR (FAB);
      555     8203    3             CALL M$CLOSE (CLOSE_FILE);
      556     8204    3           END;
      557     8205
      558     8206    2     END OPTIONAL_CHECK;
      559     8207        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:24   
      560     8208        /*--------------------*/
      561     8209    1     CREATE_OPTIONAL_FILE: PROC;
      562     8210        /*--------------------*/
      563     8211
      564     8212        /*P*
      565     8213             NAME: CREATE_OPTIONAL_FILE
      566     8214          PURPOSE: Creates optional files (I-O)
      567     8215        */
      568     8216
      569     8217    2       OPEN_FILE.V.FUN# = %CREATE;
      570     8218    2       IF FAB.ORG# = %CP6_INDEXED
      571     8219    2       AND  FAB.ALT_KEY$ ~= ADDR(NIL) THEN
      572     8220    2           OPEN_FILE.ALTKEYS_ = VECTOR (ALT_KEYS);
      573     8221    2       ELSE
      574     8222    2         OPEN_FILE.ALTKEYS_ = VECTOR (NIL);                    /*#30011*/
      575     8223    2       CLOSE_FILE.V.DCB# = FAB.DCB_NUM;
      576     8224    2       CLOSE_FILE.V.DISP# = %SAVE;
      577     8225    2       CALL M$OPEN (OPEN_FILE)
      578     8226    2         WHENRETURN
      579     8227    3           DO;
      580     8228    3             CALL M$CLOSE (CLOSE_FILE)
      581     8229    3               WHENALTRETURN
      582     8230    4                 DO;
      583     8231    4                   CALL X9WE$IO_ERROR  (FAB);
      584     8232    4                 END;
      585     8233    3           END;
      586     8234    2         WHENALTRETURN
      587     8235    3           DO;
      588     8236    3             CALL X9WE$IO_ERROR (FAB);
      589     8237    3             CALL M$CLOSE (CLOSE_FILE);
      590     8238    3           END;
      591     8239
      592     8240    2     END CREATE_OPTIONAL_FILE;
      593     8241        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:25   
      594     8242        /*-------*/
      595     8243    1       START: PROC;
      596     8244        /*-------*/
      597     8245
      598     8246            %FPT_PRECORD     (FPTN=START);
      599     8267
      600     8268    2       START.V.DCB#  = FAB.DCB_NUM;
      601     8269    2       START.V.KEYR# = YES#;
      602     8270    2       START.V.KEYS# = NO#;
      603     8271    2       START.V.N#    = 0;
      604     8272    2       START.KEY_ = VECTOR (RELATIVE_KEY);
      605     8273    2       CALL M$PRECORD (START);
      606     8274
      607     8275    2     END START;
      608     8276        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:26   
      609     8277        /*------------*/
      610     8278    1     EXTEND_START:        PROC;
      611     8279        /*------------*/
      612     8280
      613     8281            %FPT_PRECORD     (FPTN=START);
      614     8302
      615     8303    2       START.V.DCB#  = FAB.DCB_NUM;
      616     8304    2       START.V.KEYR# = YES#;
      617     8305    2       START.V.KEYS# = NO#;
      618     8306    2       START.V.N#    = -1;
      619     8307    2       START.KEY_ = VECTOR (RELATIVE_KEY);
      620     8308    2       CALL M$PRECORD (START);
      621     8309
      622     8310    2       START.V.KEYR# = YES#;
      623     8311    2       START.V.KEYS# = YES#;
      624     8312    2       START.V.N#    = 0;
      625     8313    2       RELATIVE_KEY = RELATIVE_KEY + 1;
      626     8314    2       START.KEY_ = VECTOR (RELATIVE_KEY);
      627     8315    2       CALL M$PRECORD (START)
      628     8316    2         WHENALTRETURN
      629     8317    3           DO;
      630     8318    3           END;
      631     8319
      632     8320    2     END EXTEND_START;
      633     8321        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:27   
      634     8322        /*-------------*/
      635     8323    1       ADD_FILE_ID: PROC;
      636     8324        /*-------------*/
      637     8325
      638     8326        /*P*
      639     8327
      640     8328             NAME: ADD_FILE_ID
      641     8329
      642     8330          PURPOSE: Adds the file name specifed in the VALUE OF FILE-ID clause
      643     8331                   into the open FPT.
      644     8332
      645     8333        */
      646     8334
      647     8335    2       DCL I              SBIN   WORD;
      648     8336    2       DCL NAME_POS       SBIN   WORD;
      649     8337    2       DCL NAME_LEN       SBIN   WORD;
      650     8338    2       DCL ACCT_POS       SBIN   WORD;
      651     8339    2       DCL FILE_ACCT      CHAR(8) DALIGNED;
      652     8340        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:28   
      653     8341    3   L:  DO I = 0 TO FAB.FILE_ID_LEN - 1;
      654     8342    3         IF SUBSTR (FILE_ID,I,1) ~= ' ' THEN
      655     8343    3           EXIT L;
      656     8344    3       END L;
      657     8345    2       NAME_POS = I;
      658     8346
      659     8347    2       CALL INDEX (I,'.',FILE_ID);
      660     8348    2       IF I = FAB.FILE_ID_LEN THEN
      661     8349    3         DO;
      662     8350    3           CALL INDEX (I,' ',FILE_ID,NAME_POS);
      663     8351    3           NAME_LEN = I - NAME_POS;
      664     8352    3           FILE_NAME.LENGTH = NAME_LEN;
      665     8353    3           FILE_NAME.TEXT   = SUBSTR (FILE_ID,NAME_POS,NAME_LEN);
      666     8354    3           OPEN_FILE.ACCT_  = VECTOR (NIL) ;
      667     8355    3         END;
      668     8356    2       ELSE
      669     8357    3         DO;
      670     8358    3           FILE_NAME.LENGTH = I - NAME_POS;
      671     8359    3           FILE_NAME.TEXT   = SUBSTR (FILE_ID,NAME_POS,FILE_NAME.LENGTH);
      672     8360    3           ACCT_POS = I + 1;
      673     8361    3           CALL INDEX (I,' ',FILE_ID,ACCT_POS);
      674     8362    3           FILE_ACCT = SUBSTR (FILE_ID,ACCT_POS,I - ACCT_POS);
      675     8363    3           OPEN_FILE.ACCT_ = VECTOR (FILE_ACCT);
      676     8364    3         END;
      677     8365    2       OPEN_FILE.NAME_ = VECTOR  (FILE_NAME);
      678     8366    2     END ADD_FILE_ID;
      679     8367        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:29   
      680     8368        /*---------*/
      681     8369    1       GET_MEM: PROC;
      682     8370        /*---------*/
      683     8371
      684     8372    2           FAB.B.FAST_SEQUENTIAL = YES# ;
      685     8373
      686     8374    2           IF FAB.XSA.BBUF_ = '000000000000000000000000'O THEN /*#40646*/
      687     8375    2             CALL X9MM$GET_MEM (FAB.XSA.BBUF_)
      688     8376    2             WHENRETURN
      689     8377    3               DO;
      690     8378    3                 IF FAB.XSA.ORG = %CP6_KEYED
      691     8379    3                      OR FAB.XSA.ORG = %CP6_INDEXED THEN
      692     8380    3                   CALL X9MM$GET_MEM (FAB.XSA.KBUF_);
      693     8381    3                 ELSE
      694     8382    3                   FAB.XSA.KBUF_.BUF$ = ADDR(NIL);
      695     8383    3               END;
      696     8384    2     END GET_MEM; /* proc */
      697     8385        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:30   
      698     8386        /*-----------*/
      699     8387    1       OPEN_INIT: PROC;
      700     8388        /*-----------*/
      701     8389        /*I*
      702     8390
      703     8391          NAME:    OPEN_INIT
      704     8392
      705     8393          PURPOSE: To initialize the DCB with the information in the FAB.
      706     8394
      707     8395          DESCRIPTION:
      708     8396                 Initializes the DCB with the information found in the FAB via a call to
      709     8397                 M$OPEN with the SETDCB and SCRUB options on.
      710     8398        */
      711     8399
      712     8400            %FPT_OPEN    (FPTN=INIT_OPEN, SETDCB=YES, SCRUB=YES);
      713     8509
      714     8510    2       INIT_OPEN.V.DCB# = FAB.DCB_NUM;
      715     8511    2       IF   M$XX.ACS# = %CP6_DEFAULT                   /* #32500,#35576,#38492 */
      716     8512    2       THEN IF   FAB.ACS# = %FAB_RANDOM_ACCESS                       /* #32500 */
      717     8513    2            THEN INIT_OPEN.V.ACS# = %CP6_RANDOM_ACCESS;
      718     8514    2            ELSE INIT_OPEN.V.ACS# = FAB.ACS#;
      719     8515    2       ELSE INIT_OPEN.V.ACS# = M$XX.ACS#;
      720     8516    2       INIT_OPEN.V.ASN# = FAB.ASSIGN;
      721     8517    2       INIT_OPEN.V.ORG# = FAB.ORG# ;
      722     8518    2       INIT_OPEN.V.NRECS# = 1000 ;  /* Default size for relative files */
      723     8519        /*V*              KEYX#_and_KEYL#
      724     8520                 These fields are needed for indexed files.
      725     8521        */
      726     8522    2       IF FAB.ORG# = %CP6_INDEXED THEN
      727     8523    3         DO;
      728     8524    3           INIT_OPEN.V.KEYX# = POFFC  (FAB.RECORD_KEY$, FAB.BUFFER$);
      729     8525    3           INIT_OPEN.V.KEYL# = FAB.RECORD_KEY_LEN;
      730     8526    3         END;
      731     8527
      732     8528    2       INIT_OPEN.V.CNVRT# = FAB.B.CNVRT#;
      733     8529    2       INIT_OPEN.V.EBCDIC# = FAB.B.EBCDIC#;
      734     8530    2       INIT_OPEN.V.RECL#  = FAB.MAX_REC_LEN;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:31   
      735     8531    2       INIT_OPEN.V.BLKL#  = FAB.MAX_BLOCK_LEN;
      736     8532    2       IF M$XX.NAME#.L = 0 THEN
      737     8533    3         DO;
      738     8534    3           FILE_NAME.LENGTH = M$XX.DCBNAME.L + 1;
      739     8535    3           CALL CONCAT (FILE_NAME.TEXT,'*',M$XX.DCBNAME.N);
      740     8536    3         END;
      741     8537    2       ELSE
      742     8538    3         DO;
      743     8539    3           FILE_NAME.LENGTH = M$XX.NAME#.L;
      744     8540    3           FILE_NAME.TEXT = M$XX.NAME#.C;
      745     8541    3         END;
      746     8542
      747     8543    2       INIT_OPEN.NAME_ = VECTOR  (FILE_NAME);
      748     8544
      749     8545    3       DO CASE  (FAB.ASSIGN);
      750     8546
      751     8547    3         CASE  (%CP6_CARD_PUNCH);
      752     8548
      753     8549    3           INIT_OPEN.V.ASN# = %CP6_DEVICE;
      754     8550    3           INIT_OPEN.V.RES# = 'CP';
      755     8551
      756     8552    3         CASE  (%CP6_MAGNETIC_TAPE);
      757     8553
      758     8554    3           INIT_OPEN.V.ASN# = %CP6_TAPE;
      759     8555    3           INIT_OPEN.V.RES# = 'MT';
      760     8556
      761     8557    3         CASE  (%CP6_DISK);
      762     8558
      763     8559    3           INIT_OPEN.V.ASN# = %CP6_FILE;
      764     8560                /* no RES# */
      765     8561
      766     8562    3         CASE  (ELSE);
      767     8563
      768     8564    3           INIT_OPEN.V.ASN# = %CP6_DEVICE;
      769     8565    3           INIT_OPEN.V.RES# = 'ME';
      770     8566
      771     8567    3       END; /* case fab.assign */
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:32   
      772     8568
      773     8569
      774     8570    2       CALL M$OPEN  (INIT_OPEN);
      775     8571    2     END OPEN_INIT; /* proc */
      776     8572
      777     8573    1   END X9WO$OPEN;  /* proc */
      778     8574        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:33   
      779     8575        %EOD;

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:34   
--  Include file information  --

   X9A_LIB_IO.:X8A6TOU  cannot be made into a system file and is referenced.
   X9A_IO.:X8A6TOU  is referenced.
   XS_MACRO_C.:LIBRARY  is referenced.
   X9A_FAB.:X8A6TOU  is referenced.
   X8A_LIBCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   X8A_ERRCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   X8A_SYS_FILE.:X8A6TOU  is referenced.
      No diagnostics issued in procedure X9WO$OPEN.

   Procedure X9WO$OPEN requires 1184 words for executable code.
   Procedure X9WO$OPEN requires 90 words of local(AUTO) storage.

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:35   

 Object Unit name= X9WO$OPEN                                  File name= X9WO.:X8A6TOU
 UTS= AUG 09 '97 11:08:01.20 SAT                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  LblCom even  none    20     24  LIBCOM
    2  LblCom even  none     1      1  DEC_OR_COMMA
    3  LblCom even  none    20     24  IN_TEMP
    4  LblCom even  none     1      1  OVRCHR
    5  LblCom even  none     1      1  SELECT_TIME
    6  LblCom even  none     1      1  NO_ADVANCE_OFFSET
    7  LblCom even  none    18     22  DSPLY_SAVE
    8  LblCom even  none     3      3  D_DATE
    9  LblCom even  none     3      3  D_TIME
   10  LblCom even  none     1      1  D_DAY
   11  LblCom even  none     2      2  C_DATE
   12  LblCom even  none     2      2  C_TIME
   13  LblCom even  none     2      2  C_DAY
   14  LblCom even  none     1      1  RTHOLD2
   15  LblCom even  none     1      1  LTHOLD2
   16  LblCom even  none     1      1  NDX2
   17  LblCom even  none     1      1  IN_LEN
   18   Data  even  none   174    256  X9WO$OPEN
   19  RoData even  UTS     11     13  X9WO$OPEN
   20   Proc  even  none  1184   2240  X9WO$OPEN
   21  RoData even  none    24     30  X9WO$OPEN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    20      0   yes            yes      Std        2  X9WO$OPEN
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:36   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 X9WE$IO_ERROR_STATUS
 yes     yes           Std       2 X9WE$IO_ERROR
 yes     yes           Std       3 X8CV$CONVERT_FROM_INTEGER
         yes           Std       4 X9WU$WRITE_USER_LABEL
 yes     yes           Std       2 XSA$OPEN
         yes           Std       1 X9WO$CONVERT_LINAGE
         yes           Std       4 X9WU$READ_USER_LABEL
 yes     yes           Std       2 XSA$PFIL
 yes     yes           Std       1 X9MM$GET_MEM
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$TCB$

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:37   


        1        1        /*M* X9WO$OPEN --  Provides functionality to support the OPEN stmt. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*P*
        9        9
       10       10          NAME:  X9WO$OPEN
       11       11
       12       12          PURPOSE: Interfaces with the CP-6 Monitor Service routines to open
       13       13                   files for use by Cobol IO.
       14       14
       15       15        */
       16       16
       17       17        /*D*
       18       18
       19       19          NAME:  X9WO$OPEN
       20       20
       21       21          PURPOSE:  To handle all the operations  associated will the opening
       22       22                  of COBOL file for IO processing.
       23       23
       24       24          CALL:  CALL X9WO$OPEN  (FAB, OPEN_TYPE)
       25       25
       26       26          PARAMETER:
       27       27                 FAB          -- File Attribute Block.
       28       28                 OPEN_TYPE    -- Type of open to be performed.
       29       29                 COMCOM.OPTZ  -- Determines if the DCB has been initialized
       30       30                                 or will be initialized on the first OPEN.
       31       31          INTERFACE:
       32       32                 X9WO$CONVERT_LINAGE       -- Converts linage items to integer
       33       33                 X8CV$CONVERT_FROM_INTEGER -- Converts relative key from
       34       34                                              integer to the Cobol program'
       35       35                                              key description.
       36       36                 X9WE$IO_ERROR             -- Called to report IO errors.
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:38   
       37       37                 X9WE$IO_ERROR_STATUS      -- Reports status code IO errors.
       38       38                 X9MM$GET_MEM              -- Gets memory for fast sequential IO.
       39       39                 XSA$OPEN                  -- Tests file for use of Fast Seq IO.
       40       40                 XSA$PFIL                  -- Fast sequential IO file positioning.
       41       41                 M$CLOSE                   -- Monitor service call to close files.
       42       42                 M$OPEN                    -- Monitor service call to open files.
       43       43
       44       44          OUTPUT:  FAB, DCB
       45       45
       46       46          DESCRIPTION:  This procedure will open files for Cobol IO and if
       47       47            possible will use fast sequential IO.  The DCB may also be
       48       48            initialized at runtime (COMCOM.OPTZ=TRUE) with the first call to
       49       49            open this file.
       50       50
       51       51        */
       52       52        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:39   
       53       53        /*---------*/
       54       54          X9WO$OPEN: PROC (FAB, OPEN_TYPE);

     54 20 000000   000000 700200 xent  X9WO$OPEN    TSX0  ! X66_AUTO_2
        20 000001   000132 000002                    ZERO    90,2

       55       55        /*---------*/
       56       56
       57       57            %INCLUDE X8A_SYS_FILE;
       58     6327            %INCLUDE X8A_ERRCOM;
       59     6416            %INCLUDE X8A_LIBCOM;
       60     6636            %INCLUDE X9A_FAB;
       61     6823            %INCLUDE X9A_IO;
       62     6973            %INCLUDE X9A_LIB_IO;
       63     7357            %DCL_FAB;
       64     7479
       65     7480    1       DCL OPEN_TYPE       SBIN WORD;
       66     7481    1       DCL LINAGE_COUNTER  SBIN BASED (FAB.LINAGE_COUNTER$);
       67     7482    1       DCL IO_STATUS       CHAR(2) BASED (FAB.IO_STATUS$);
       68     7483    1       DCL LENGTH          SBIN WORD;  /* length of filename for error */
       69     7484
       70     7485    1       DCL 1 FILE_NAME     DALIGNED,
       71     7486    1             2 LENGTH      UBIN(9)  UNAL,
       72     7487    1             2 TEXT        CHAR(31) UNAL;
       73     7488
       74     7489    1       DCL FILE_ID         CHAR(FAB.FILE_ID_LEN) BASED(FAB.FILE_ID$);
       75     7490
       76     7491    1       DCL 1 FSA_          DALIGNED,
       77     7492    1           2 *             BIT(36),
       78     7493    1           2 PTR$          PTR;
       79     7494
       80     7495    1       DCL RELATIVE_KEY    UBIN WORD;
       81     7496        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:40   
       82     7497    1       DCL X9WE$IO_ERROR                ENTRY(2) ALTRET;
       83     7498    1       DCL X9WE$IO_ERROR_STATUS         ENTRY(2) ALTRET;
       84     7499    1       DCL X8CV$CONVERT_FROM_INTEGER    ENTRY(3) ALTRET;
       85     7500    1       DCL X9WO$CONVERT_LINAGE          ENTRY(1);
       86     7501    1       DCL X9MM$GET_MEM                 ENTRY(1) ALTRET;
       87     7502    1       DCL XSA$OPEN                     ENTRY(2) ALTRET;
       88     7503    1       DCL XSA$PFIL                     ENTRY(2) ALTRET;
       89     7504    1       DCL X9WU$WRITE_USER_LABEL        ENTRY(4);
       90     7505    1       DCL X9WU$READ_USER_LABEL         ENTRY(4);
       91     7506
       92     7507
       93     7508            %FPT_PFIL  (FPTN = FPT_PFIL);
       94     7523            %FPT_OPEN  (FPTN=OPEN_FILE, REASSIGN = YES);
       95     7632            %FPT_CLOSE (FPTN=CLOSE_FILE);
       96     7674            %VLP_ALTKEYS (FPTN=ALT_KEYS, STCLASS="BASED (FAB.ALT_KEY$)", N=19);
       97     7689        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:41   
       98     7690    1       FAB.LAST_IO = %OPEN;

   7690 20 000002   000003 235007                    LDA     3,DL
        20 000003   200003 470500                    LDP0    @FAB,,AUTO
        20 000004   000025 755100                    STA     21,,PR0

       99     7691    2       DO CASE (FAB.FILE_STATUS);

   7691 20 000005   000026 235100                    LDA     22,,PR0
        20 000006   000003 115007                    CMPA    3,DL
        20 000007   000011 602005 20                 TNC     s:7691+4,AL
        20 000010   000036 710000 20                 TRA     s:7711
        20 000011   000036 710000 20                 TRA     s:7711
        20 000012   000014 710000 20                 TRA     s:7695
        20 000013   000025 710000 20                 TRA     s:7701

      100     7692
      101     7693    2         CASE (%FILE_LOCKED);

      102     7694
      103     7695    2            IO_STATUS = %LOCKED;

   7695 20 000014   000036 471500                    LDP1    30,,PR0
        20 000015   040100 100400                    MLR     fill='040'O
        20 000016   000000 000002 19                 ADSC9   0                        cn=0,n=2
        20 000017   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      104     7696    2            CALL X9WE$IO_ERROR_STATUS (FAB);

   7696 20 000020   200003 630500                    EPPR0   @FAB,,AUTO
        20 000021   000000 631400 21                 EPPR1   0
        20 000022   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 000023   000000 011000                    NOP     0

      105     7697    2            RETURN;

   7697 20 000024   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:42   

      106     7698
      107     7699    2         CASE (%FILE_OPEN);

      108     7700
      109     7701    2            IO_STATUS = %ALREADY_OPEN;

   7701 20 000025   000036 471500                    LDP1    30,,PR0
        20 000026   040100 100400                    MLR     fill='040'O
        20 000027   000001 000002 19                 ADSC9   1                        cn=0,n=2
        20 000030   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      110     7702    2            CALL X9WE$IO_ERROR_STATUS (FAB);

   7702 20 000031   200003 630500                    EPPR0   @FAB,,AUTO
        20 000032   000000 631400 21                 EPPR1   0
        20 000033   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 000034   000000 011000                    NOP     0

      111     7703    2            RETURN;

   7703 20 000035   000000 702200 xent               TSX2  ! X66_ARET

      112     7704
      113     7705    2         CASE (ELSE);

      114     7706
      115     7707                 /* OK to Open */
      116     7708
      117     7709    2       END; /* case fab.file_status */

      118     7710        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:43   
      119     7711    1       DCB$ = DCBADDR (FAB.DCB_NUM);

   7711 20 000036   000001 471400 21                 LDP1    1
        20 000037   100000 473500                    LDP3    0,,PR1
        20 000040   000034 220100                    LDX0    28,,PR0
        20 000041   300000 236110                    LDQ     0,X0,PR3
        20 000042   200076 756100                    STQ     DCB$,,AUTO

      120     7712    1       IF NOT FAB.B.DCB_INIT THEN   /* If Dcb is not initialized */

   7712 20 000043   000032 236100                    LDQ     26,,PR0
        20 000044   200000 316007                    CANQ    65536,DL
        20 000045   000053 601000 20                 TNZ     s:7718

      121     7713    2         DO;                        /* then open and initialize  */

      122     7714    2           CALL OPEN_INIT;

   7714 20 000046   002044 701000 20                 TSX1    OPEN_INIT
        20 000047   000000 011000                    NOP     0

      123     7715    2           FAB.B.DCB_INIT = %YES#;

   7715 20 000050   200003 470500                    LDP0    @FAB,,AUTO
        20 000051   200000 236007                    LDQ     65536,DL
        20 000052   000032 256100                    ORSQ    26,,PR0

      124     7716    2         END;

      125     7717
      126     7718    1       IO_STATUS = %SUCCESSFUL;   /* Preset IO status */

   7718 20 000053   000036 471500                    LDP1    30,,PR0
        20 000054   040100 100400                    MLR     fill='040'O
        20 000055   000002 000002 19                 ADSC9   2                        cn=0,n=2
        20 000056   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:44   
      127     7719    1       FAB.B.NO_NEXT_RECORD_EXISTS = %NO#;

   7719 20 000057   000002 236000 21                 LDQ     2
        20 000060   000032 356100                    ANSQ    26,,PR0

      128     7720    1       OPEN_FILE.V.DCB# = FAB.DCB_NUM;

   7720 20 000061   000034 220100                    LDX0    28,,PR0
        20 000062   000050 740000 18                 STX0    OPEN_FILE+36

      129     7721
      130     7722        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:45   
      131     7723        /*V*                   Cobol-74_Compatability
      132     7724                The VALUE OF FILE-ID is now used to specify the files actual
      133     7725            name.  Previously, it was treated as a comment entry and when the
      134     7726            COBOL-74 compatability option is on; this claus is ignored.
      135     7727        */
      136     7728    1       IF FAB.FILE_ID$ ~= ADDR(NIL) AND NOT LIBCOM.COBOL_74 THEN

   7728 20 000063   000042 236100                    LDQ     34,,PR0
        20 000064   000003 116000 21                 CMPQ    3
        20 000065   000073 600000 20                 TZE     s:7732
        20 000066   000000 234000 1                  SZN     LIBCOM
        20 000067   000073 604000 20                 TMI     s:7732

      137     7729    1         CALL ADD_FILE_ID;

   7729 20 000070   001637 701000 20                 TSX1    ADD_FILE_ID
        20 000071   000000 011000                    NOP     0
        20 000072   000077 710000 20                 TRA     s:7736

      138     7730    1       ELSE
      139     7731    2         DO;

      140     7732    2           OPEN_FILE.NAME_ = VECTOR(NIL);

   7732 20 000073   000004 237000 21                 LDAQ    4
        20 000074   000012 757000 18                 STAQ    OPEN_FILE+6

      141     7733    2           OPEN_FILE.ACCT_ = VECTOR(NIL);

   7733 20 000075   000004 237000 21                 LDAQ    4
        20 000076   000030 757000 18                 STAQ    OPEN_FILE+20

      142     7734    2         END;

      143     7735
      144     7736    1       IF FAB.LABEL_REC$ ~= ADDR(NIL) OR

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:46   
   7736 20 000077   200003 470500                    LDP0    @FAB,,AUTO
        20 000100   000041 236100                    LDQ     33,,PR0
        20 000101   000003 116000 21                 CMPQ    3
        20 000102   000106 601000 20                 TNZ     s:7739
        20 000103   000040 236100                    LDQ     32,,PR0
        20 000104   000003 116000 21                 CMPQ    3
        20 000105   000205 600000 20                 TZE     s:7770

      145     7737    1          FAB.LABEL_EXIT$ ~= ADDR(NIL) THEN
      146     7738    2         DO;

      147     7739    2           OPEN_FILE.V.CVOL# = '1'B;

   7739 20 000106   000050 236000 18                 LDQ     OPEN_FILE+36
        20 000107   000006 376000 21                 ANQ     6
        20 000110   000004 276007                    ORQ     4,DL
        20 000111   000050 756000 18                 STQ     OPEN_FILE+36

      148     7740                %BEFORE_BEGINNING_LABEL_PROC;

   7742 20 000112   000040 236100                    LDQ     32,,PR0
        20 000113   000003 116000 21                 CMPQ    3
        20 000114   000166 600000 20                 TZE     s:7763

   7744 20 000115   200077 756100                    STQ     USE$$,,AUTO

   7745 20 000116   200004 471500                    LDP1    @OPEN_TYPE,,AUTO
        20 000117   100000 235100                    LDA     0,,PR1
        20 000120   000006 115007                    CMPA    6,DL
        20 000121   000123 602005 20                 TNC     s:7745+5,AL
        20 000122   000166 710000 20                 TRA     s:7763
        20 000123   000143 710000 20                 TRA     s:7751
        20 000124   000131 710000 20                 TRA     s:7747
        20 000125   000166 710000 20                 TRA     s:7763
        20 000126   000155 710000 20                 TRA     s:7755
        20 000127   000143 710000 20                 TRA     s:7751
        20 000130   000131 710000 20                 TRA     s:7747
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:47   

   7747 20 000131   200077 473500                    LDP3    USE$$,,AUTO
        20 000132   300001 236100                    LDQ     1,,PR3
        20 000133   200100 756100                    STQ     USE_ENTRY$,,AUTO

   7748 20 000134   000007 116000 21                 CMPQ    7
        20 000135   000166 600000 20                 TZE     s:7763

   7749 20 000136   200100 220100                    LDX0    USE_ENTRY$,,AUTO
        20 000137   000007 631400 21                 EPPR1   7
        20 000140   000000 701010                    TSX1    0,X0
        20 000141   000000 011000                    NOP     0
        20 000142   000166 710000 20                 TRA     s:7763

   7751 20 000143   200077 473500                    LDP3    USE$$,,AUTO
        20 000144   300000 236100                    LDQ     0,,PR3
        20 000145   200100 756100                    STQ     USE_ENTRY$,,AUTO

   7752 20 000146   000007 116000 21                 CMPQ    7
        20 000147   000166 600000 20                 TZE     s:7763

   7753 20 000150   200100 220100                    LDX0    USE_ENTRY$,,AUTO
        20 000151   000007 631400 21                 EPPR1   7
        20 000152   000000 701010                    TSX1    0,X0
        20 000153   000000 011000                    NOP     0
        20 000154   000166 710000 20                 TRA     s:7763

   7755 20 000155   200077 473500                    LDP3    USE$$,,AUTO
        20 000156   300002 236100                    LDQ     2,,PR3
        20 000157   200100 756100                    STQ     USE_ENTRY$,,AUTO

   7756 20 000160   000007 116000 21                 CMPQ    7
        20 000161   000166 600000 20                 TZE     s:7763

   7757 20 000162   200100 220100                    LDX0    USE_ENTRY$,,AUTO
        20 000163   000007 631400 21                 EPPR1   7
        20 000164   000000 701010                    TSX1    0,X0
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:48   
        20 000165   000000 011000                    NOP     0

      149     7762
      150     7763    2           IF FAB.B.BEGIN_FILE_LABEL THEN

   7763 20 000166   200003 470500                    LDP0    @FAB,,AUTO
        20 000167   000032 236100                    LDQ     26,,PR0
        20 000170   000040 316003                    CANQ    32,DU
        20 000171   000211 600000 20                 TZE     s:7775

      151     7764    2             CALL X9WU$WRITE_USER_LABEL (FAB, OPEN_FILE.UHL_,

   7764 20 000172   200004 236100                    LDQ     @OPEN_TYPE,,AUTO
        20 000173   000011 235000 21                 LDA     9
        20 000174   200130 757100                    STAQ    FILE_ACCT+4,,AUTO
        20 000175   000012 236000 21                 LDQ     10
        20 000176   200003 235100                    LDA     @FAB,,AUTO
        20 000177   200126 757100                    STAQ    FILE_ACCT+2,,AUTO
        20 000200   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 000201   000010 631400 21                 EPPR1   8
        20 000202   000000 701000 xent               TSX1    X9WU$WRITE_USER_LABEL
        20 000203   000000 011000                    NOP     0

      152     7765    2                                         %BEGINNING_FILE_LABEL,
      153     7766    2                                         OPEN_TYPE);
      154     7767    2         END;

   7767 20 000204   000211 710000 20                 TRA     s:7775

      155     7768    1       ELSE
      156     7769    2         DO;

      157     7770    2           OPEN_FILE.V.CVOL# = %NO#;

   7770 20 000205   000006 236000 21                 LDQ     6
        20 000206   000050 356000 18                 ANSQ    OPEN_FILE+36

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:49   
      158     7771    2           OPEN_FILE.UHL_ = VECTOR(NIL);

   7771 20 000207   000004 237000 21                 LDAQ    4
        20 000210   000010 757000 18                 STAQ    OPEN_FILE+4

      159     7772    2         END;

      160     7773
      161     7774
      162     7775    1       FAB.B.SHARED_INDEX_ALT = %NO#;                                /* #37711 */

   7775 20 000211   200003 470500                    LDP0    @FAB,,AUTO
        20 000212   000013 236000 21                 LDQ     11
        20 000213   000032 356100                    ANSQ    26,,PR0

      163     7776    1       OPEN_FILE.V.EXIST# = 0;                        /*#34004*/

   7776 20 000214   000014 236000 21                 LDQ     12
        20 000215   000050 356000 18                 ANSQ    OPEN_FILE+36

      164     7777                                      /*  Zero is placed in the exist to
      165     7778                                          reset the field to a null stat.
      166     7779                                          Open extend will change this field */
      167     7780
      168     7781
      169     7782    2       DO CASE (OPEN_TYPE);

   7782 20 000216   200004 471500                    LDP1    @OPEN_TYPE,,AUTO
        20 000217   100000 235100                    LDA     0,,PR1
        20 000220   000006 115007                    CMPA    6,DL
        20 000221   000223 602005 20                 TNC     s:7782+5,AL
        20 000222   001071 710000 20                 TRA     s:8016
        20 000223   000231 710000 20                 TRA     s:7786
        20 000224   000352 710000 20                 TRA     s:7831
        20 000225   000643 710000 20                 TRA     s:7925
        20 000226   000737 710000 20                 TRA     s:7961
        20 000227   000276 710000 20                 TRA     s:7808
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:50   
        20 000230   000505 710000 20                 TRA     s:7878

      170     7783        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:51   
      171     7784    2         CASE  (%OPEN_INPUT);

      172     7785
      173     7786    2           OPEN_FILE.V.FUN# = %IN;                            /*#30707*/

   7786 20 000231   002000 236007                    LDQ     1024,DL
        20 000232   000051 552010 18                 STBQ    OPEN_FILE+37,'10'O

      174     7787    2           CALL XSA$OPEN  (OPEN_FILE, FAB.XSA)

   7787 20 000233   200003 236100                    LDQ     @FAB,,AUTO
        20 000234   000060 036003                    ADLQ    48,DU
        20 000235   000016 235000 21                 LDA     14
        20 000236   200126 757100                    STAQ    FILE_ACCT+2,,AUTO
        20 000237   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 000240   000015 631400 21                 EPPR1   13
        20 000241   000000 701000 xent               TSX1    XSA$OPEN
        20 000242   000271 702000 20                 TSX2    s:7803

      175     7788    2             WHENRETURN
      176     7789    3               DO;

      177     7790    3                 CALL ATTRIBUTE_CHECK

   7790 20 000243   001234 701000 20                 TSX1    ATTRIBUTE_CHECK
        20 000244   000246 702000 20                 TSX2    s:7793
        20 000245   000255 710000 20                 TRA     s:7796

      178     7791    3                   WHENALTRETURN
      179     7792    4                     DO;

      180     7793    4                       IF IO_STATUS ~= %SUCCESSFUL THEN

   7793 20 000246   200003 470500                    LDP0    @FAB,,AUTO
        20 000247   000036 471500                    LDP1    30,,PR0
        20 000250   040000 106500                    CMPC    fill='040'O
        20 000251   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:52   
        20 000252   000002 000002 19                 ADSC9   2                        cn=0,n=2
        20 000253   000255 600000 20                 TZE     s:7796

      181     7794    4                         RETURN;

   7794 20 000254   000000 702200 xent               TSX2  ! X66_ARET

      182     7795    4                     END;
      183     7796    3                 IF FAB.XSA.ORG ~= %CP6_DEFAULT THEN

   7796 20 000255   200003 470500                    LDP0    @FAB,,AUTO
        20 000256   000074 236100                    LDQ     60,,PR0
        20 000257   000777 316003                    CANQ    511,DU
        20 000260   000263 600000 20                 TZE     s:7798

      184     7797    3                   CALL GET_MEM;

   7797 20 000261   002003 701000 20                 TSX1    GET_MEM
        20 000262   000000 011000                    NOP     0

      185     7798    3                 CALL NORMAL_REWIND;

   7798 20 000263   001165 701000 20                 TSX1    NORMAL_REWIND
        20 000264   000000 011000                    NOP     0

      186     7799    3                 FAB.FILE_STATUS = %FILE_OPEN;

   7799 20 000265   000002 235007                    LDA     2,DL
        20 000266   200003 470500                    LDP0    @FAB,,AUTO
        20 000267   000026 755100                    STA     22,,PR0

      187     7800    3               END;

   7800 20 000270   000275 710000 20                 TRA     s:7804

      188     7801    2             WHENALTRETURN
      189     7802    3               DO;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:53   

      190     7803    3                 CALL X9WE$IO_ERROR (FAB);

   7803 20 000271   200003 630500                    EPPR0   @FAB,,AUTO
        20 000272   000000 631400 21                 EPPR1   0
        20 000273   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 000274   000000 011000                    NOP     0

      191     7804    3               END;

   7804 20 000275   001071 710000 20                 TRA     s:8016

      192     7805        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:54   
      193     7806    2         CASE  (%OPEN_INPUT_NO_REWIND);

      194     7807
      195     7808    2           OPEN_FILE.V.FUN# = %IN;                            /*#30707*/

   7808 20 000276   002000 236007                    LDQ     1024,DL
        20 000277   000051 552010 18                 STBQ    OPEN_FILE+37,'10'O

      196     7809    2           CALL XSA$OPEN  (OPEN_FILE, FAB.XSA)

   7809 20 000300   200003 236100                    LDQ     @FAB,,AUTO
        20 000301   000060 036003                    ADLQ    48,DU
        20 000302   000016 235000 21                 LDA     14
        20 000303   200126 757100                    STAQ    FILE_ACCT+2,,AUTO
        20 000304   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 000305   000015 631400 21                 EPPR1   13
        20 000306   000000 701000 xent               TSX1    XSA$OPEN
        20 000307   000345 702000 20                 TSX2    s:7826

      197     7810    2             WHENRETURN
      198     7811    3               DO;

      199     7812    3                 CALL ATTRIBUTE_CHECK

   7812 20 000310   001234 701000 20                 TSX1    ATTRIBUTE_CHECK
        20 000311   000313 702000 20                 TSX2    s:7815
        20 000312   000322 710000 20                 TRA     s:7818

      200     7813    3                   WHENALTRETURN
      201     7814    4                     DO;

      202     7815    4                       IF IO_STATUS ~= %SUCCESSFUL THEN

   7815 20 000313   200003 470500                    LDP0    @FAB,,AUTO
        20 000314   000036 471500                    LDP1    30,,PR0
        20 000315   040000 106500                    CMPC    fill='040'O
        20 000316   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:55   
        20 000317   000002 000002 19                 ADSC9   2                        cn=0,n=2
        20 000320   000322 600000 20                 TZE     s:7818

      203     7816    4                         RETURN;  /* Don't open the file */

   7816 20 000321   000000 702200 xent               TSX2  ! X66_ARET

      204     7817    4                     END;
      205     7818    3                 IF FAB.XSA.ORG ~= %CP6_DEFAULT THEN

   7818 20 000322   200003 470500                    LDP0    @FAB,,AUTO
        20 000323   000074 236100                    LDQ     60,,PR0
        20 000324   000777 316003                    CANQ    511,DU
        20 000325   000330 600000 20                 TZE     s:7820

      206     7819    3                   CALL GET_MEM;

   7819 20 000326   002003 701000 20                 TSX1    GET_MEM
        20 000327   000000 011000                    NOP     0

      207     7820    3                 FAB.FILE_STATUS = %FILE_OPEN;

   7820 20 000330   000002 235007                    LDA     2,DL
        20 000331   200003 470500                    LDP0    @FAB,,AUTO
        20 000332   000026 755100                    STA     22,,PR0

      208     7821    3                 IF M$XX.ASN# ~= %CP6_TAPE THEN

   7821 20 000333   200076 471500                    LDP1    DCB$,,AUTO
        20 000334   100032 236100                    LDQ     26,,PR1
        20 000335   777000 376007                    ANQ     -512,DL
        20 000336   002000 116007                    CMPQ    1024,DL
        20 000337   000344 600000 20                 TZE     s:7823

      209     7822    3                   IO_STATUS = %NON_REEL_MEDIUM;

   7822 20 000340   000036 473500                    LDP3    30,,PR0
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:56   
        20 000341   040100 100400                    MLR     fill='040'O
        20 000342   000003 000002 19                 ADSC9   3                        cn=0,n=2
        20 000343   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      210     7823    3               END;

   7823 20 000344   000351 710000 20                 TRA     s:7827

      211     7824    2             WHENALTRETURN
      212     7825    3               DO;

      213     7826    3                 CALL X9WE$IO_ERROR (FAB);

   7826 20 000345   200003 630500                    EPPR0   @FAB,,AUTO
        20 000346   000000 631400 21                 EPPR1   0
        20 000347   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 000350   000000 011000                    NOP     0

      214     7827    3               END;

   7827 20 000351   001071 710000 20                 TRA     s:8016

      215     7828        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:57   
      216     7829    2         CASE  (%OPEN_OUTPUT) ;

      217     7830
      218     7831    2           OPEN_FILE.V.FUN# = %CREATE;

   7831 20 000352   003000 236007                    LDQ     1536,DL
        20 000353   000051 552010 18                 STBQ    OPEN_FILE+37,'10'O

      219     7832    2           IF FAB.ORG# = %CP6_INDEXED    AND         /*#35288*/

   7832 20 000354   000002 235100                    LDA     2,,PR0
        20 000355   000006 115007                    CMPA    6,DL
        20 000356   000370 601000 20                 TNZ     s:7836
        20 000357   000055 236100                    LDQ     45,,PR0
        20 000360   000003 116000 21                 CMPQ    3
        20 000361   000370 600000 20                 TZE     s:7836

      220     7833    2                FAB.ALT_KEY$ ~= ADDR(NIL)   THEN
      221     7834    2             OPEN_FILE.ALTKEYS_ = VECTOR (ALT_KEYS);

   7834 20 000362   000055 473500                    LDP3    45,,PR0
        20 000363   000017 235000 21                 LDA     15
        20 000364   200126 453500                    STP3    FILE_ACCT+2,,AUTO
        20 000365   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 000366   000046 757000 18                 STAQ    OPEN_FILE+34
        20 000367   000372 710000 20                 TRA     s:7837

      222     7835    2           ELSE
      223     7836    2             OPEN_FILE.ALTKEYS_ = VECTOR (NIL);              /*#30011*/

   7836 20 000370   000004 237000 21                 LDAQ    4
        20 000371   000046 757000 18                 STAQ    OPEN_FILE+34

      224     7837    2           CALL XSA$OPEN  (OPEN_FILE, FAB.XSA)

   7837 20 000372   200003 236100                    LDQ     @FAB,,AUTO
        20 000373   000060 036003                    ADLQ    48,DU
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:58   
        20 000374   000016 235000 21                 LDA     14
        20 000375   200126 757100                    STAQ    FILE_ACCT+2,,AUTO
        20 000376   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 000377   000015 631400 21                 EPPR1   13
        20 000400   000000 701000 xent               TSX1    XSA$OPEN
        20 000401   000500 702000 20                 TSX2    s:7873

      225     7838    2             WHENRETURN
      226     7839    3               DO;

      227     7840    3                 CALL ATTRIBUTE_CHECK

   7840 20 000402   001234 701000 20                 TSX1    ATTRIBUTE_CHECK
        20 000403   000405 702000 20                 TSX2    s:7843
        20 000404   000421 710000 20                 TRA     s:7850

      228     7841    3                   WHENALTRETURN
      229     7842    4                     DO;

      230     7843    4                       IF IO_STATUS ~= %SUCCESSFUL THEN

   7843 20 000405   200003 470500                    LDP0    @FAB,,AUTO
        20 000406   000036 471500                    LDP1    30,,PR0
        20 000407   040000 106500                    CMPC    fill='040'O
        20 000410   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
        20 000411   000002 000002 19                 ADSC9   2                        cn=0,n=2
        20 000412   000421 600000 20                 TZE     s:7850

      231     7844    5                         DO;

      232     7845    5                           CLOSE_FILE.V.DCB# = FAB.DCB_NUM;

   7845 20 000413   000034 220100                    LDX0    28,,PR0
        20 000414   000130 740000 18                 STX0    CLOSE_FILE+26

      233     7846    5                           CALL M$CLOSE (CLOSE_FILE);

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:59   
   7846 20 000415   000076 630400 18                 EPPR0   CLOSE_FILE
        20 000416   050001 713400                    CLIMB   close
        20 000417   406000 401760                    pmme    nvectors=13

      234     7847    5                           RETURN;

   7847 20 000420   000000 702200 xent               TSX2  ! X66_ARET

      235     7848    5                         END;
      236     7849    4                     END;
      237     7850    3                 FAB.FILE_STATUS = %FILE_OPEN;

   7850 20 000421   000002 235007                    LDA     2,DL
        20 000422   200003 470500                    LDP0    @FAB,,AUTO
        20 000423   000026 755100                    STA     22,,PR0

      238     7851    3                 IF  FAB.ACS# = %CP6_SEQUENTIAL_ACCESS THEN

   7851 20 000424   000004 235100                    LDA     4,,PR0
        20 000425   000001 115007                    CMPA    1,DL
        20 000426   000470 601000 20                 TNZ     s:7868

      239     7852    4                   DO;

      240     7853    4                     IF FAB.XSA.ORG ~= %CP6_DEFAULT THEN

   7853 20 000427   000074 236100                    LDQ     60,,PR0
        20 000430   000777 316003                    CANQ    511,DU
        20 000431   000434 600000 20                 TZE     s:7855

      241     7854    4                       CALL GET_MEM;

   7854 20 000432   002003 701000 20                 TSX1    GET_MEM
        20 000433   000000 011000                    NOP     0

      242     7855    4                     IF   FAB.LINAGE_LINES$ ~= ADDR(NIL) THEN

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:60   
   7855 20 000434   200003 470500                    LDP0    @FAB,,AUTO
        20 000435   000045 236100                    LDQ     37,,PR0
        20 000436   000003 116000 21                 CMPQ    3
        20 000437   000450 600000 20                 TZE     s:7860

      243     7856    5                       DO;

      244     7857    5                         CALL X9WO$CONVERT_LINAGE (FAB);

   7857 20 000440   200003 630500                    EPPR0   @FAB,,AUTO
        20 000441   000000 631400 21                 EPPR1   0
        20 000442   000000 701000 xent               TSX1    X9WO$CONVERT_LINAGE
        20 000443   000000 011000                    NOP     0

      245     7858    5                         LINAGE_COUNTER  = 1;

   7858 20 000444   200003 470500                    LDP0    @FAB,,AUTO
        20 000445   000051 471500                    LDP1    41,,PR0
        20 000446   000001 235007                    LDA     1,DL
        20 000447   100000 755100                    STA     0,,PR1

      246     7859    5                       END;

      247     7860    4                     IF FAB.RELATIVE_KEY$ ~= ADDR(NIL) THEN

   7860 20 000450   000053 236100                    LDQ     43,,PR0
        20 000451   000003 116000 21                 CMPQ    3
        20 000452   000470 600000 20                 TZE     s:7868

      248     7861    5                       DO;

      249     7862    5                         RELATIVE_KEY = 0;

   7862 20 000453   200114 450100                    STZ     RELATIVE_KEY,,AUTO

      250     7863    5                         CALL X8CV$CONVERT_FROM_INTEGER (

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:61   
   7863 20 000454   200114 631500                    EPPR1   RELATIVE_KEY,,AUTO
        20 000455   200130 451500                    STP1    FILE_ACCT+4,,AUTO
        20 000456   200003 236100                    LDQ     @FAB,,AUTO
        20 000457   000030 036003                    ADLQ    24,DU
        20 000460   200127 756100                    STQ     FILE_ACCT+3,,AUTO
        20 000461   200003 236100                    LDQ     @FAB,,AUTO
        20 000462   000053 036003                    ADLQ    43,DU
        20 000463   200126 756100                    STQ     FILE_ACCT+2,,AUTO
        20 000464   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 000465   000020 631400 21                 EPPR1   16
        20 000466   000000 701000 xent               TSX1    X8CV$CONVERT_FROM_INTEGER
        20 000467   000000 011000                    NOP     0

      251     7864    5                              FAB.RELATIVE_KEY$, FAB.RELATIVE_DESC,
      252     7865    5                              RELATIVE_KEY);
      253     7866    5                       END;

      254     7867    4                   END;

      255     7868    3                 IF M$XX.ASN# = %CP6_TAPE THEN

   7868 20 000470   200076 470500                    LDP0    DCB$,,AUTO
        20 000471   000032 236100                    LDQ     26,,PR0
        20 000472   777000 376007                    ANQ     -512,DL
        20 000473   002000 116007                    CMPQ    1024,DL
        20 000474   000477 601000 20                 TNZ     s:7870

      256     7869    3                   CALL NORMAL_REWIND;

   7869 20 000475   001165 701000 20                 TSX1    NORMAL_REWIND
        20 000476   000000 011000                    NOP     0

      257     7870    3               END;

   7870 20 000477   000504 710000 20                 TRA     s:7874

      258     7871    2             WHENALTRETURN
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:62   
      259     7872    3               DO;

      260     7873    3                 CALL X9WE$IO_ERROR (FAB);

   7873 20 000500   200003 630500                    EPPR0   @FAB,,AUTO
        20 000501   000000 631400 21                 EPPR1   0
        20 000502   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 000503   000000 011000                    NOP     0

      261     7874    3               END;

   7874 20 000504   001071 710000 20                 TRA     s:8016

      262     7875        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:63   
      263     7876    2         CASE  (%OPEN_OUTPUT_NO_REWIND);

      264     7877
      265     7878    2           OPEN_FILE.V.FUN# = %CREATE;

   7878 20 000505   003000 236007                    LDQ     1536,DL
        20 000506   000051 552010 18                 STBQ    OPEN_FILE+37,'10'O

      266     7879    2           IF FAB.ORG# = %CP6_INDEXED THEN

   7879 20 000507   000002 235100                    LDA     2,,PR0
        20 000510   000006 115007                    CMPA    6,DL
        20 000511   000525 601000 20                 TNZ     s:7884

      267     7880    2             IF FAB.ALT_KEY$ ~= ADDR(NIL) THEN

   7880 20 000512   000055 236100                    LDQ     45,,PR0
        20 000513   000003 116000 21                 CMPQ    3
        20 000514   000523 600000 20                 TZE     s:7883

      268     7881    2               OPEN_FILE.ALTKEYS_ = VECTOR (ALT_KEYS);

   7881 20 000515   000055 473500                    LDP3    45,,PR0
        20 000516   000017 235000 21                 LDA     15
        20 000517   200126 453500                    STP3    FILE_ACCT+2,,AUTO
        20 000520   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 000521   000046 757000 18                 STAQ    OPEN_FILE+34
        20 000522   000525 710000 20                 TRA     s:7884

      269     7882    2             ELSE
      270     7883    2               OPEN_FILE.ALTKEYS_ = VECTOR (NIL);              /*#30011*/

   7883 20 000523   000004 237000 21                 LDAQ    4
        20 000524   000046 757000 18                 STAQ    OPEN_FILE+34

      271     7884    2           CALL XSA$OPEN  (OPEN_FILE, FAB.XSA)

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:64   
   7884 20 000525   200003 236100                    LDQ     @FAB,,AUTO
        20 000526   000060 036003                    ADLQ    48,DU
        20 000527   000016 235000 21                 LDA     14
        20 000530   200126 757100                    STAQ    FILE_ACCT+2,,AUTO
        20 000531   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 000532   000015 631400 21                 EPPR1   13
        20 000533   000000 701000 xent               TSX1    XSA$OPEN
        20 000534   000636 702000 20                 TSX2    s:7920

      272     7885    2             WHENRETURN
      273     7886    3               DO;

      274     7887    3                 CALL ATTRIBUTE_CHECK

   7887 20 000535   001234 701000 20                 TSX1    ATTRIBUTE_CHECK
        20 000536   000540 702000 20                 TSX2    s:7890
        20 000537   000554 710000 20                 TRA     s:7897

      275     7888    3                   WHENALTRETURN
      276     7889    4                     DO;

      277     7890    4                       IF IO_STATUS ~= %SUCCESSFUL THEN

   7890 20 000540   200003 470500                    LDP0    @FAB,,AUTO
        20 000541   000036 471500                    LDP1    30,,PR0
        20 000542   040000 106500                    CMPC    fill='040'O
        20 000543   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
        20 000544   000002 000002 19                 ADSC9   2                        cn=0,n=2
        20 000545   000554 600000 20                 TZE     s:7897

      278     7891    5                         DO;

      279     7892    5                           CLOSE_FILE.V.DCB# = FAB.DCB_NUM;

   7892 20 000546   000034 220100                    LDX0    28,,PR0
        20 000547   000130 740000 18                 STX0    CLOSE_FILE+26

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:65   
      280     7893    5                           CALL M$CLOSE (CLOSE_FILE);

   7893 20 000550   000076 630400 18                 EPPR0   CLOSE_FILE
        20 000551   050001 713400                    CLIMB   close
        20 000552   406000 401760                    pmme    nvectors=13

      281     7894    5                           RETURN;

   7894 20 000553   000000 702200 xent               TSX2  ! X66_ARET

      282     7895    5                         END;
      283     7896    4                     END;
      284     7897    3                 FAB.FILE_STATUS = %FILE_OPEN;

   7897 20 000554   000002 235007                    LDA     2,DL
        20 000555   200003 470500                    LDP0    @FAB,,AUTO
        20 000556   000026 755100                    STA     22,,PR0

      285     7898    3                 IF  FAB.ACS# = %CP6_SEQUENTIAL_ACCESS THEN

   7898 20 000557   000004 235100                    LDA     4,,PR0
        20 000560   000001 115007                    CMPA    1,DL
        20 000561   000623 601000 20                 TNZ     s:7915

      286     7899    4                   DO;

      287     7900    4                     IF FAB.XSA.ORG ~= %CP6_DEFAULT THEN

   7900 20 000562   000074 236100                    LDQ     60,,PR0
        20 000563   000777 316003                    CANQ    511,DU
        20 000564   000567 600000 20                 TZE     s:7902

      288     7901    4                       CALL GET_MEM;

   7901 20 000565   002003 701000 20                 TSX1    GET_MEM
        20 000566   000000 011000                    NOP     0

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:66   
      289     7902    4                     IF   FAB.LINAGE_LINES$ ~= ADDR(NIL) THEN

   7902 20 000567   200003 470500                    LDP0    @FAB,,AUTO
        20 000570   000045 236100                    LDQ     37,,PR0
        20 000571   000003 116000 21                 CMPQ    3
        20 000572   000603 600000 20                 TZE     s:7907

      290     7903    5                       DO;

      291     7904    5                         CALL X9WO$CONVERT_LINAGE (FAB);

   7904 20 000573   200003 630500                    EPPR0   @FAB,,AUTO
        20 000574   000000 631400 21                 EPPR1   0
        20 000575   000000 701000 xent               TSX1    X9WO$CONVERT_LINAGE
        20 000576   000000 011000                    NOP     0

      292     7905    5                         LINAGE_COUNTER  = 1;

   7905 20 000577   200003 470500                    LDP0    @FAB,,AUTO
        20 000600   000051 471500                    LDP1    41,,PR0
        20 000601   000001 235007                    LDA     1,DL
        20 000602   100000 755100                    STA     0,,PR1

      293     7906    5                       END;

      294     7907    4                     IF FAB.RELATIVE_KEY$ ~= ADDR(NIL) THEN

   7907 20 000603   000053 236100                    LDQ     43,,PR0
        20 000604   000003 116000 21                 CMPQ    3
        20 000605   000623 600000 20                 TZE     s:7915

      295     7908    5                       DO;

      296     7909    5                         RELATIVE_KEY = 0;

   7909 20 000606   200114 450100                    STZ     RELATIVE_KEY,,AUTO

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:67   
      297     7910    5                         CALL X8CV$CONVERT_FROM_INTEGER (

   7910 20 000607   200114 631500                    EPPR1   RELATIVE_KEY,,AUTO
        20 000610   200130 451500                    STP1    FILE_ACCT+4,,AUTO
        20 000611   200003 236100                    LDQ     @FAB,,AUTO
        20 000612   000030 036003                    ADLQ    24,DU
        20 000613   200127 756100                    STQ     FILE_ACCT+3,,AUTO
        20 000614   200003 236100                    LDQ     @FAB,,AUTO
        20 000615   000053 036003                    ADLQ    43,DU
        20 000616   200126 756100                    STQ     FILE_ACCT+2,,AUTO
        20 000617   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 000620   000020 631400 21                 EPPR1   16
        20 000621   000000 701000 xent               TSX1    X8CV$CONVERT_FROM_INTEGER
        20 000622   000000 011000                    NOP     0

      298     7911    5                              FAB.RELATIVE_KEY$, FAB.RELATIVE_DESC,
      299     7912    5                              RELATIVE_KEY);
      300     7913    5                       END;

      301     7914    4                   END;

      302     7915    3                 IF M$XX.ASN# ~= %CP6_TAPE THEN

   7915 20 000623   200076 470500                    LDP0    DCB$,,AUTO
        20 000624   000032 236100                    LDQ     26,,PR0
        20 000625   777000 376007                    ANQ     -512,DL
        20 000626   002000 116007                    CMPQ    1024,DL
        20 000627   000635 600000 20                 TZE     s:7917

      303     7916    3                   IO_STATUS = %NON_REEL_MEDIUM;

   7916 20 000630   200003 471500                    LDP1    @FAB,,AUTO
        20 000631   100036 473500                    LDP3    30,,PR1
        20 000632   040100 100400                    MLR     fill='040'O
        20 000633   000003 000002 19                 ADSC9   3                        cn=0,n=2
        20 000634   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:68   
      304     7917    3               END;

   7917 20 000635   000642 710000 20                 TRA     s:7921

      305     7918    2             WHENALTRETURN
      306     7919    3               DO;

      307     7920    3                 CALL X9WE$IO_ERROR (FAB);

   7920 20 000636   200003 630500                    EPPR0   @FAB,,AUTO
        20 000637   000000 631400 21                 EPPR1   0
        20 000640   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 000641   000000 011000                    NOP     0

      308     7921    3               END;

   7921 20 000642   001071 710000 20                 TRA     s:8016

      309     7922        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:69   
      310     7923    2         CASE  (%OPEN_I_O);

      311     7924
      312     7925    2           IF FAB.B.OPTIONAL_FILE THEN

   7925 20 000643   000032 236100                    LDQ     26,,PR0
        20 000644   200000 316003                    CANQ    65536,DU
        20 000645   000656 600000 20                 TZE     s:7931

      313     7926    3             DO;

      314     7927    3               CALL OPTIONAL_CHECK;

   7927 20 000646   001442 701000 20                 TSX1    OPTIONAL_CHECK
        20 000647   000000 011000                    NOP     0

      315     7928    3               IF FAB.FILE_STATUS = %FILE_NOT_PRESENT THEN

   7928 20 000650   200003 470500                    LDP0    @FAB,,AUTO
        20 000651   000026 235100                    LDA     22,,PR0
        20 000652   000003 115007                    CMPA    3,DL
        20 000653   000656 601000 20                 TNZ     s:7931

      316     7929    3                 CALL CREATE_OPTIONAL_FILE;

   7929 20 000654   001471 701000 20                 TSX1    CREATE_OPTIONAL_FILE
        20 000655   000000 011000                    NOP     0

      317     7930    3             END; /* if optional file */

      318     7931    2           OPEN_FILE.V.FUN# = %UPDATE;                        /*#30707*/

   7931 20 000656   001000 236007                    LDQ     512,DL
        20 000657   000051 552010 18                 STBQ    OPEN_FILE+37,'10'O

      319     7932    2           FAB.B.FAST_SEQUENTIAL = NO#;

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:70   
   7932 20 000660   200003 470500                    LDP0    @FAB,,AUTO
        20 000661   000021 236000 21                 LDQ     17
        20 000662   000032 356100                    ANSQ    26,,PR0

      320     7933    2           CALL M$OPEN (OPEN_FILE)

   7933 20 000663   000004 630400 18                 EPPR0   OPEN_FILE
        20 000664   450000 713400                    CLIMB   alt,open
        20 000665   410400 401760                    pmme    nvectors=18
        20 000666   000732 702000 20                 TSX2    s:7956

      321     7934    2             WHENRETURN
      322     7935    3               DO;

      323     7936    3                 IF M$XX.ASN# = %CP6_TAPE THEN

   7936 20 000667   200076 470500                    LDP0    DCB$,,AUTO
        20 000670   000032 236100                    LDQ     26,,PR0
        20 000671   777000 376007                    ANQ     -512,DL
        20 000672   002000 116007                    CMPQ    1024,DL
        20 000673   000705 601000 20                 TNZ     s:7941

      324     7937    4                   DO;

      325     7938    4                     IO_STATUS = %FILE_OPEN_CONFLICT;

   7938 20 000674   200003 471500                    LDP1    @FAB,,AUTO
        20 000675   100036 473500                    LDP3    30,,PR1
        20 000676   040100 100400                    MLR     fill='040'O
        20 000677   000004 000002 19                 ADSC9   4                        cn=0,n=2
        20 000700   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      326     7939    4                     CALL X9WE$IO_ERROR_STATUS (FAB);

   7939 20 000701   200003 630500                    EPPR0   @FAB,,AUTO
        20 000702   000000 631400 21                 EPPR1   0
        20 000703   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:71   
        20 000704   000000 011000                    NOP     0

      327     7940    4                   END;

      328     7941    3                 CALL ATTRIBUTE_CHECK

   7941 20 000705   001234 701000 20                 TSX1    ATTRIBUTE_CHECK
        20 000706   000710 702000 20                 TSX2    s:7944
        20 000707   000724 710000 20                 TRA     s:7951

      329     7942    3                   WHENALTRETURN
      330     7943    4                     DO;

      331     7944    4                       IF IO_STATUS ~= %SUCCESSFUL THEN

   7944 20 000710   200003 470500                    LDP0    @FAB,,AUTO
        20 000711   000036 471500                    LDP1    30,,PR0
        20 000712   040000 106500                    CMPC    fill='040'O
        20 000713   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
        20 000714   000002 000002 19                 ADSC9   2                        cn=0,n=2
        20 000715   000724 600000 20                 TZE     s:7951

      332     7945    5                         DO;

      333     7946    5                           CLOSE_FILE.V.DCB# = FAB.DCB_NUM;

   7946 20 000716   000034 220100                    LDX0    28,,PR0
        20 000717   000130 740000 18                 STX0    CLOSE_FILE+26

      334     7947    5                           CALL M$CLOSE (CLOSE_FILE);

   7947 20 000720   000076 630400 18                 EPPR0   CLOSE_FILE
        20 000721   050001 713400                    CLIMB   close
        20 000722   406000 401760                    pmme    nvectors=13

      335     7948    5                           RETURN;

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:72   
   7948 20 000723   000000 702200 xent               TSX2  ! X66_ARET

      336     7949    5                         END;
      337     7950    4                     END;
      338     7951    3                 CALL NORMAL_REWIND;

   7951 20 000724   001165 701000 20                 TSX1    NORMAL_REWIND
        20 000725   000000 011000                    NOP     0

      339     7952    3                 FAB.FILE_STATUS = %FILE_OPEN;

   7952 20 000726   000002 235007                    LDA     2,DL
        20 000727   200003 470500                    LDP0    @FAB,,AUTO
        20 000730   000026 755100                    STA     22,,PR0

      340     7953    3               END;

   7953 20 000731   000736 710000 20                 TRA     s:7957

      341     7954    2             WHENALTRETURN
      342     7955    3               DO;

      343     7956    3                 CALL X9WE$IO_ERROR  (FAB);

   7956 20 000732   200003 630500                    EPPR0   @FAB,,AUTO
        20 000733   000000 631400 21                 EPPR1   0
        20 000734   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 000735   000000 011000                    NOP     0

      344     7957    3               END;

   7957 20 000736   001071 710000 20                 TRA     s:8016

      345     7958        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:73   
      346     7959    2         CASE  (%OPEN_EXTEND);

      347     7960
      348     7961    2           CALL OPTIONAL_CHECK;

   7961 20 000737   001442 701000 20                 TSX1    OPTIONAL_CHECK
        20 000740   000000 011000                    NOP     0

      349     7962    2           IF  FAB.FILE_STATUS = %FILE_NOT_PRESENT

   7962 20 000741   200003 470500                    LDP0    @FAB,,AUTO
        20 000742   000026 235100                    LDA     22,,PR0
        20 000743   000003 115007                    CMPA    3,DL
        20 000744   000753 601000 20                 TNZ     s:7966
        20 000745   000032 236100                    LDQ     26,,PR0
        20 000746   000001 736000                    QLS     1
        20 000747   400000 376003                    ANQ     -131072,DU
        20 000750   400000 676003                    ERQ     -131072,DU
        20 000751   000753 600000 20                 TZE     s:7966

      350     7963    2           AND ~ FAB.B.OPTIONAL_FILE THEN
      351     7964    2              RETURN;

   7964 20 000752   000000 702200 xent               TSX2  ! X66_ARET

      352     7965
      353     7966    2           OPEN_FILE.V.FUN# = %CREATE;

   7966 20 000753   003000 236007                    LDQ     1536,DL
        20 000754   000051 552010 18                 STBQ    OPEN_FILE+37,'10'O

      354     7967    2           OPEN_FILE.V.EXIST# = %OLDFILE;

   7967 20 000755   000050 236000 18                 LDQ     OPEN_FILE+36
        20 000756   000014 376000 21                 ANQ     12
        20 000757   000400 276007                    ORQ     256,DL
        20 000760   000050 756000 18                 STQ     OPEN_FILE+36
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:74   

      355     7968    2           FAB.B.FAST_SEQUENTIAL = NO#;

   7968 20 000761   000021 236000 21                 LDQ     17
        20 000762   000032 356100                    ANSQ    26,,PR0

      356     7969    2           CALL M$OPEN  (OPEN_FILE)

   7969 20 000763   000004 630400 18                 EPPR0   OPEN_FILE
        20 000764   450000 713400                    CLIMB   alt,open
        20 000765   410400 401760                    pmme    nvectors=18
        20 000766   001065 702000 20                 TSX2    s:8012

      357     7970    2             WHENRETURN
      358     7971    3               DO;

      359     7972    3                 CALL ATTRIBUTE_CHECK

   7972 20 000767   001234 701000 20                 TSX1    ATTRIBUTE_CHECK
        20 000770   000772 702000 20                 TSX2    s:7975
        20 000771   001006 710000 20                 TRA     s:7982

      360     7973    3                   WHENALTRETURN
      361     7974    4                     DO;

      362     7975    4                       IF IO_STATUS ~= %SUCCESSFUL THEN

   7975 20 000772   200003 470500                    LDP0    @FAB,,AUTO
        20 000773   000036 471500                    LDP1    30,,PR0
        20 000774   040000 106500                    CMPC    fill='040'O
        20 000775   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
        20 000776   000002 000002 19                 ADSC9   2                        cn=0,n=2
        20 000777   001006 600000 20                 TZE     s:7982

      363     7976    5                         DO;

      364     7977    5                           CLOSE_FILE.V.DCB# = FAB.DCB_NUM;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:75   

   7977 20 001000   000034 220100                    LDX0    28,,PR0
        20 001001   000130 740000 18                 STX0    CLOSE_FILE+26

      365     7978    5                           CALL M$CLOSE (CLOSE_FILE);

   7978 20 001002   000076 630400 18                 EPPR0   CLOSE_FILE
        20 001003   050001 713400                    CLIMB   close
        20 001004   406000 401760                    pmme    nvectors=13

      366     7979    5                           RETURN;

   7979 20 001005   000000 702200 xent               TSX2  ! X66_ARET

      367     7980    5                         END;
      368     7981    4                     END;
      369     7982    3                 FAB.FILE_STATUS = %FILE_OPEN;

   7982 20 001006   000002 235007                    LDA     2,DL
        20 001007   200003 470500                    LDP0    @FAB,,AUTO
        20 001010   000026 755100                    STA     22,,PR0

      370     7983    3                 IF  FAB.ACS# = %CP6_SEQUENTIAL_ACCESS THEN

   7983 20 001011   000004 235100                    LDA     4,,PR0
        20 001012   000001 115007                    CMPA    1,DL
        20 001013   001053 601000 20                 TNZ     s:8004

      371     7984    4                   DO;

      372     7985    4                     IF   FAB.LINAGE_LINES$ ~= ADDR(NIL) THEN

   7985 20 001014   000045 236100                    LDQ     37,,PR0
        20 001015   000003 116000 21                 CMPQ    3
        20 001016   001027 600000 20                 TZE     s:7990

      373     7986    5                       DO;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:76   

      374     7987    5                         CALL X9WO$CONVERT_LINAGE (FAB);

   7987 20 001017   200003 630500                    EPPR0   @FAB,,AUTO
        20 001020   000000 631400 21                 EPPR1   0
        20 001021   000000 701000 xent               TSX1    X9WO$CONVERT_LINAGE
        20 001022   000000 011000                    NOP     0

      375     7988    5                         LINAGE_COUNTER  = 1;

   7988 20 001023   200003 470500                    LDP0    @FAB,,AUTO
        20 001024   000051 471500                    LDP1    41,,PR0
        20 001025   000001 235007                    LDA     1,DL
        20 001026   100000 755100                    STA     0,,PR1

      376     7989    5                       END;

      377     7990    4                     IF FAB.ORG# = %CP6_RELATIVE THEN

   7990 20 001027   000002 235100                    LDA     2,,PR0
        20 001030   000005 115007                    CMPA    5,DL
        20 001031   001053 601000 20                 TNZ     s:8004

      378     7991    4                       IF FAB.RELATIVE_KEY$ = ADDR(NIL) THEN

   7991 20 001032   000053 236100                    LDQ     43,,PR0
        20 001033   000003 116000 21                 CMPQ    3
        20 001034   001053 601000 20                 TNZ     s:8004

      379     7992        /*                    CALL EXTEND_START;
      380     7993                            ELSE                         */
      381     7994    5                         DO;    /* Relative Key was specified */

      382     7995    5                           CALL START;

   7995 20 001035   001546 701000 20                 TSX1    START
        20 001036   000000 011000                    NOP     0
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:77   

      383     7996    5                           CALL X8CV$CONVERT_FROM_INTEGER (FAB.RELATIVE_KEY$,

   7996 20 001037   200114 630500                    EPPR0   RELATIVE_KEY,,AUTO
        20 001040   200130 450500                    STP0    FILE_ACCT+4,,AUTO
        20 001041   200003 236100                    LDQ     @FAB,,AUTO
        20 001042   000030 036003                    ADLQ    24,DU
        20 001043   200127 756100                    STQ     FILE_ACCT+3,,AUTO
        20 001044   200003 236100                    LDQ     @FAB,,AUTO
        20 001045   000053 036003                    ADLQ    43,DU
        20 001046   200126 756100                    STQ     FILE_ACCT+2,,AUTO
        20 001047   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 001050   000020 631400 21                 EPPR1   16
        20 001051   000000 701000 xent               TSX1    X8CV$CONVERT_FROM_INTEGER
        20 001052   000000 011000                    NOP     0

      384     7997    5                                            FAB.RELATIVE_DESC, RELATIVE_KEY);
      385     7998    5                         END;

      386     7999    4                   END;

      387     8000        /*V*  When the file is assigned to magnegtic tape,  open
      388     8001          with %CREATE & %OLDFILE won't position the tape to
      389     8002          the end-of-file, so we must do this manually.       */
      390     8003
      391     8004    3                 IF FAB.ASSIGN = %CP6_MAGNETIC_TAPE THEN

   8004 20 001053   200003 470500                    LDP0    @FAB,,AUTO
        20 001054   000000 235100                    LDA     0,,PR0
        20 001055   000002 115007                    CMPA    2,DL
        20 001056   001064 601000 20                 TNZ     s:8009

      392     8005    4                   DO;

      393     8006    4                     FPT_PFIL.V.DCB# = FAB.DCB_NUM;

   8006 20 001057   000034 220100                    LDX0    28,,PR0
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:78   
        20 001060   000002 740000 18                 STX0    FPT_PFIL+2

      394     8007    4                     CALL M$PFIL(FPT_PFIL);

   8007 20 001061   000000 630400 18                 EPPR0   FPT_PFIL
        20 001062   040004 713400                    CLIMB   16388
        20 001063   400000 401760                    pmme    nvectors=1

      395     8008    4                   END;

      396     8009    3               END;

   8009 20 001064   001071 710000 20                 TRA     s:8016

      397     8010    2             WHENALTRETURN
      398     8011    3               DO;

      399     8012    3                 CALL X9WE$IO_ERROR  (FAB);

   8012 20 001065   200003 630500                    EPPR0   @FAB,,AUTO
        20 001066   000000 631400 21                 EPPR1   0
        20 001067   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 001070   000000 011000                    NOP     0

      400     8013    3               END;

      401     8014    2       END;  /* case open_type */

      402     8015
      403     8016    1       IF FAB.B.BEGIN_FILE_LABEL THEN

   8016 20 001071   200003 470500                    LDP0    @FAB,,AUTO
        20 001072   000032 236100                    LDQ     26,,PR0
        20 001073   000040 316003                    CANQ    32,DU
        20 001074   001107 600000 20                 TZE     s:8023

      404     8017    1         CALL X9WU$READ_USER_LABEL (FAB, OPEN_FILE.UHL_,
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:79   

   8017 20 001075   200004 236100                    LDQ     @OPEN_TYPE,,AUTO
        20 001076   000011 235000 21                 LDA     9
        20 001077   200130 757100                    STAQ    FILE_ACCT+4,,AUTO
        20 001100   000012 236000 21                 LDQ     10
        20 001101   200003 235100                    LDA     @FAB,,AUTO
        20 001102   200126 757100                    STAQ    FILE_ACCT+2,,AUTO
        20 001103   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 001104   000010 631400 21                 EPPR1   8
        20 001105   000000 701000 xent               TSX1    X9WU$READ_USER_LABEL
        20 001106   000000 011000                    NOP     0

      405     8018    1                                    %BEGINNING_FILE_LABEL,
      406     8019    1                                    OPEN_TYPE);
      407     8020
      408     8021            %AFTER_BEGINNING_LABEL_PROC;

   8023 20 001107   200003 470500                    LDP0    @FAB,,AUTO
        20 001110   000040 236100                    LDQ     32,,PR0
        20 001111   000003 116000 21                 CMPQ    3
        20 001112   001164 600000 20                 TZE     s:8041

   8025 20 001113   200077 756100                    STQ     USE$$,,AUTO

   8026 20 001114   200004 471500                    LDP1    @OPEN_TYPE,,AUTO
        20 001115   100000 235100                    LDA     0,,PR1
        20 001116   000006 115007                    CMPA    6,DL
        20 001117   001121 602005 20                 TNC     s:8026+5,AL
        20 001120   001164 710000 20                 TRA     s:8041
        20 001121   001141 710000 20                 TRA     s:8032
        20 001122   001127 710000 20                 TRA     s:8028
        20 001123   001164 710000 20                 TRA     s:8041
        20 001124   001153 710000 20                 TRA     s:8036
        20 001125   001141 710000 20                 TRA     s:8032
        20 001126   001127 710000 20                 TRA     s:8028

   8028 20 001127   200077 473500                    LDP3    USE$$,,AUTO
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:80   
        20 001130   300007 236100                    LDQ     7,,PR3
        20 001131   200100 756100                    STQ     USE_ENTRY$,,AUTO

   8029 20 001132   000007 116000 21                 CMPQ    7
        20 001133   001164 600000 20                 TZE     s:8041

   8030 20 001134   200100 220100                    LDX0    USE_ENTRY$,,AUTO
        20 001135   000007 631400 21                 EPPR1   7
        20 001136   000000 701010                    TSX1    0,X0
        20 001137   000000 011000                    NOP     0
        20 001140   001164 710000 20                 TRA     s:8041

   8032 20 001141   200077 473500                    LDP3    USE$$,,AUTO
        20 001142   300006 236100                    LDQ     6,,PR3
        20 001143   200100 756100                    STQ     USE_ENTRY$,,AUTO

   8033 20 001144   000007 116000 21                 CMPQ    7
        20 001145   001164 600000 20                 TZE     s:8041

   8034 20 001146   200100 220100                    LDX0    USE_ENTRY$,,AUTO
        20 001147   000007 631400 21                 EPPR1   7
        20 001150   000000 701010                    TSX1    0,X0
        20 001151   000000 011000                    NOP     0
        20 001152   001164 710000 20                 TRA     s:8041

   8036 20 001153   200077 473500                    LDP3    USE$$,,AUTO
        20 001154   300010 236100                    LDQ     8,,PR3
        20 001155   200100 756100                    STQ     USE_ENTRY$,,AUTO

   8037 20 001156   000007 116000 21                 CMPQ    7
        20 001157   001164 600000 20                 TZE     s:8041

   8038 20 001160   200100 220100                    LDX0    USE_ENTRY$,,AUTO
        20 001161   000007 631400 21                 EPPR1   7
        20 001162   000000 701010                    TSX1    0,X0
        20 001163   000000 011000                    NOP     0

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:81   
   8041 20 001164   002237 710000 20                 TRA     s:8573

      409     8043
      410     8044        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:82   
      411     8045        /*---------------*/
      412     8046    1       NORMAL_REWIND: PROC;

   8046 20 001165   200116 741300       NORMAL_REWI* STX1  ! RELATIVE_KEY+2,,AUTO

      413     8047        /*---------------*/
      414     8048
      415     8049        /*P*
      416     8050          NAME:    NORMAL_REWIND
      417     8051
      418     8052          PURPOSE:  To rewind files as needed.
      419     8053        */
      420     8054
      421     8055            %FPT_PFIL          (FPTN=REWIND_FILE, BOF=YES);
      422     8070
      423     8071    2       IF M$XX.ASN# = %CP6_FILE

   8071 20 001166   200076 470500                    LDP0    DCB$,,AUTO
        20 001167   000032 236100                    LDQ     26,,PR0
        20 001170   777000 376007                    ANQ     -512,DL
        20 001171   001000 116007                    CMPQ    512,DL
        20 001172   001175 600000 20                 TZE     s:8074
        20 001173   002000 116007                    CMPQ    1024,DL
        20 001174   001232 601000 20                 TNZ     s:8088

      424     8072    2       OR M$XX.ASN# = %CP6_TAPE THEN
      425     8073    3         DO;

      426     8074    3           REWIND_FILE.V.DCB# = FAB.DCB_NUM;

   8074 20 001175   200003 471500                    LDP1    @FAB,,AUTO
        20 001176   100034 220100                    LDX0    28,,PR1
        20 001177   000136 740000 18                 STX0    REWIND_FILE+2

      427     8075    3           IF FAB.B.FAST_SEQUENTIAL THEN

   8075 20 001200   100032 236100                    LDQ     26,,PR1
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:83   
        20 001201   000004 316003                    CANQ    4,DU
        20 001202   001221 600000 20                 TZE     s:8082

      428     8076    3             CALL XSA$PFIL (REWIND_FILE, FAB.XSA)

   8076 20 001203   200003 236100                    LDQ     @FAB,,AUTO
        20 001204   000060 036003                    ADLQ    48,DU
        20 001205   000022 235000 21                 LDA     18
        20 001206   200126 757100                    STAQ    FILE_ACCT+2,,AUTO
        20 001207   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 001210   000015 631400 21                 EPPR1   13
        20 001211   000000 701000 xent               TSX1    XSA$PFIL
        20 001212   001214 702000 20                 TSX2    s:8079
        20 001213   001220 710000 20                 TRA     s:8080

      429     8077    3             WHENALTRETURN
      430     8078    4               DO;

      431     8079    4                 CALL X9WE$IO_ERROR (FAB);

   8079 20 001214   200003 630500                    EPPR0   @FAB,,AUTO
        20 001215   000000 631400 21                 EPPR1   0
        20 001216   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 001217   000000 011000                    NOP     0

      432     8080    4               END;

   8080 20 001220   001232 710000 20                 TRA     s:8088

      433     8081    3           ELSE
      434     8082    3             CALL M$PFIL  (REWIND_FILE)

   8082 20 001221   000134 630400 18                 EPPR0   REWIND_FILE
        20 001222   440004 713400                    CLIMB   alt,+16388
        20 001223   400000 401760                    pmme    nvectors=1
        20 001224   001226 702000 20                 TSX2    s:8085
        20 001225   001232 710000 20                 TRA     s:8088
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:84   

      435     8083    3               WHENALTRETURN
      436     8084    4                 DO;

      437     8085    4                   CALL X9WE$IO_ERROR  (FAB);

   8085 20 001226   200003 630500                    EPPR0   @FAB,,AUTO
        20 001227   000000 631400 21                 EPPR1   0
        20 001230   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 001231   000000 011000                    NOP     0

      438     8086    4                 END;

      439     8087    3         END;

      440     8088    2     END NORMAL_REWIND; /* PROC */

   8088 20 001232   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001233   000001 702211                    TSX2  ! 1,X1

      441     8089        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:85   
      442     8090        /*---------------*/
      443     8091    1     ATTRIBUTE_CHECK:     PROC ALTRET;

   8091 20 001234   200116 741300       ATTRIBUTE_C* STX1  ! RELATIVE_KEY+2,,AUTO

      444     8092        /*---------------*/
      445     8093
      446     8094        /*F*
      447     8095             NAME:  ATTRIBUTE_CHECK
      448     8096          PURPOSE:  To check for attribute conflicts between the file's program
      449     8097                    definition and the file's actual attributes.
      450     8098        */
      451     8099
      452     8100    3       DO CASE (FAB.ORG#);

   8100 20 001235   200003 470500                    LDP0    @FAB,,AUTO
        20 001236   000002 235100                    LDA     2,,PR0
        20 001237   000007 115007                    CMPA    7,DL
        20 001240   001242 602005 20                 TNC     s:8100+5,AL
        20 001241   001342 710000 20                 TRA     s:8142
        20 001242   001342 710000 20                 TRA     s:8142
        20 001243   001251 710000 20                 TRA     s:8104
        20 001244   001342 710000 20                 TRA     s:8142
        20 001245   001342 710000 20                 TRA     s:8142
        20 001246   001342 710000 20                 TRA     s:8142
        20 001247   001271 710000 20                 TRA     s:8113
        20 001250   001315 710000 20                 TRA     s:8124

      453     8101
      454     8102    3         CASE (%CP6_SEQUENTIAL);

      455     8103
      456     8104    3           IF M$XX.ORG# = %CP6_RELATIVE

   8104 20 001251   200076 471500                    LDP1    DCB$,,AUTO
        20 001252   100032 236100                    LDQ     26,,PR1
        20 001253   777000 376003                    ANQ     -512,DU
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:86   
        20 001254   005000 116003                    CMPQ    2560,DU
        20 001255   001260 600000 20                 TZE     s:8107
        20 001256   006000 116003                    CMPQ    3072,DU
        20 001257   001342 601000 20                 TNZ     s:8142

      457     8105    3           OR M$XX.ORG# = %CP6_INDEXED  THEN
      458     8106    4             DO;

      459     8107    4               IO_STATUS = %ATTRIBUTE_CONFLICT;

   8107 20 001260   000036 473500                    LDP3    30,,PR0
        20 001261   040100 100400                    MLR     fill='040'O
        20 001262   000005 000002 19                 ADSC9   5                        cn=0,n=2
        20 001263   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      460     8108    4               CALL X9WE$IO_ERROR_STATUS (FAB);

   8108 20 001264   200003 630500                    EPPR0   @FAB,,AUTO
        20 001265   000000 631400 21                 EPPR1   0
        20 001266   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 001267   000000 011000                    NOP     0

      461     8109    4             END;

   8109 20 001270   001342 710000 20                 TRA     s:8142

      462     8110
      463     8111    3         CASE (%CP6_RELATIVE);

      464     8112
      465     8113    3           IF M$XX.ORG# = %CP6_SEQUENTIAL

   8113 20 001271   200076 471500                    LDP1    DCB$,,AUTO
        20 001272   100032 236100                    LDQ     26,,PR1
        20 001273   777000 376003                    ANQ     -512,DU
        20 001274   001000 116003                    CMPQ    512,DU
        20 001275   001304 600000 20                 TZE     s:8118
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:87   
        20 001276   004000 116003                    CMPQ    2048,DU
        20 001277   001304 600000 20                 TZE     s:8118
        20 001300   017000 116003                    CMPQ    7680,DU
        20 001301   001304 600000 20                 TZE     s:8118
        20 001302   006000 116003                    CMPQ    3072,DU
        20 001303   001342 601000 20                 TNZ     s:8142

      466     8114    3           OR M$XX.ORG# = %CP6_UR                              /*#31542*/
      467     8115    3           OR M$XX.ORG# = %CP6_FIXED
      468     8116    3           OR M$XX.ORG# = %CP6_INDEXED    THEN
      469     8117    4             DO;

      470     8118    4               IO_STATUS = %ATTRIBUTE_CONFLICT;

   8118 20 001304   000036 473500                    LDP3    30,,PR0
        20 001305   040100 100400                    MLR     fill='040'O
        20 001306   000005 000002 19                 ADSC9   5                        cn=0,n=2
        20 001307   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      471     8119    4               CALL X9WE$IO_ERROR_STATUS (FAB);

   8119 20 001310   200003 630500                    EPPR0   @FAB,,AUTO
        20 001311   000000 631400 21                 EPPR1   0
        20 001312   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 001313   000000 011000                    NOP     0

      472     8120    4             END;

   8120 20 001314   001342 710000 20                 TRA     s:8142

      473     8121        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:88   
      474     8122    3         CASE (%CP6_INDEXED);

      475     8123
      476     8124    3           IF M$XX.ORG# = %CP6_SEQUENTIAL

   8124 20 001315   200076 471500                    LDP1    DCB$,,AUTO
        20 001316   100032 236100                    LDQ     26,,PR1
        20 001317   777000 376003                    ANQ     -512,DU
        20 001320   001000 116003                    CMPQ    512,DU
        20 001321   001332 600000 20                 TZE     s:8130
        20 001322   004000 116003                    CMPQ    2048,DU
        20 001323   001332 600000 20                 TZE     s:8130
        20 001324   017000 116003                    CMPQ    7680,DU
        20 001325   001332 600000 20                 TZE     s:8130
        20 001326   002000 116003                    CMPQ    1024,DU
        20 001327   001332 600000 20                 TZE     s:8130
        20 001330   005000 116003                    CMPQ    2560,DU
        20 001331   001342 601000 20                 TNZ     s:8142

      477     8125    3           OR M$XX.ORG# = %CP6_UR                              /*#31542*/
      478     8126    3           OR M$XX.ORG# = %CP6_FIXED
      479     8127    3           OR M$XX.ORG# = %CP6_KEYED
      480     8128    3           OR M$XX.ORG# = %CP6_RELATIVE   THEN
      481     8129    4             DO;

      482     8130    4               IO_STATUS = %ATTRIBUTE_CONFLICT;

   8130 20 001332   000036 473500                    LDP3    30,,PR0
        20 001333   040100 100400                    MLR     fill='040'O
        20 001334   000005 000002 19                 ADSC9   5                        cn=0,n=2
        20 001335   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      483     8131    4               CALL X9WE$IO_ERROR_STATUS (FAB);

   8131 20 001336   200003 630500                    EPPR0   @FAB,,AUTO
        20 001337   000000 631400 21                 EPPR1   0
        20 001340   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:89   
        20 001341   000000 011000                    NOP     0

      484     8132    4             END;

      485     8133
      486     8134    3       END;  /* case fab.org# */

      487     8135        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:90   
      488     8136        /*V*
      489     8137             NAME:  DEVICE_CHECK
      490     8138          PURPOSE:  To check for device conflicts between the file's program
      491     8139                    open mode and the file's actual device assignment.
      492     8140        */
      493     8141
      494     8142    3       DO CASE (OPEN_TYPE);

   8142 20 001342   200004 470500                    LDP0    @OPEN_TYPE,,AUTO
        20 001343   000000 235100                    LDA     0,,PR0
        20 001344   000006 115007                    CMPA    6,DL
        20 001345   001347 602005 20                 TNC     s:8142+5,AL
        20 001346   001440 710000 20                 TRA     s:8181
        20 001347   001355 710000 20                 TRA     s:8146
        20 001350   001400 710000 20                 TRA     s:8162
        20 001351   001420 710000 20                 TRA     s:8171
        20 001352   001400 710000 20                 TRA     s:8162
        20 001353   001355 710000 20                 TRA     s:8146
        20 001354   001400 710000 20                 TRA     s:8162

      495     8143
      496     8144    3         CASE (%OPEN_INPUT, %OPEN_INPUT_NO_REWIND);

      497     8145
      498     8146    3           IF FAB.ASSIGN = %CP6_PRINTER OR

   8146 20 001355   200003 471500                    LDP1    @FAB,,AUTO
        20 001356   100000 235100                    LDA     0,,PR1
        20 001357   001366 600000 20                 TZE     s:8151
        20 001360   000001 115007                    CMPA    1,DL
        20 001361   001366 600000 20                 TZE     s:8151
        20 001362   000003 115007                    CMPA    3,DL
        20 001363   001366 600000 20                 TZE     s:8151
        20 001364   000006 115007                    CMPA    6,DL
        20 001365   001440 601000 20                 TNZ     s:8181

      499     8147    3              FAB.ASSIGN = %CP6_PRINTER_F OR
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:91   
      500     8148    3              FAB.ASSIGN = %CP6_SYSOUT OR
      501     8149    3              FAB.ASSIGN = %CP6_CARD_PUNCH THEN
      502     8150    4             DO;

      503     8151    4               IO_STATUS = %FILE_OPEN_CONFLICT;

   8151 20 001366   100036 473500                    LDP3    30,,PR1
        20 001367   040100 100400                    MLR     fill='040'O
        20 001370   000004 000002 19                 ADSC9   4                        cn=0,n=2
        20 001371   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      504     8152    4               CALL X9WE$IO_ERROR_STATUS (FAB);

   8152 20 001372   200003 630500                    EPPR0   @FAB,,AUTO
        20 001373   000000 631400 21                 EPPR1   0
        20 001374   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 001375   000000 011000                    NOP     0

      505     8153    4               ALTRETURN;

   8153 20 001376   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001377   000000 702211                    TSX2  ! 0,X1

      506     8154    4             END;
      507     8155        /*      IF M$XX.RECL# ~= FAB.MAX_REC_LEN THEN
      508     8156                  DO;
      509     8157                    IO_STATUS = %ATTRIBUTE_CONFLICT;
      510     8158                    CALL X9WE$IO_ERROR_STATUS (FAB);
      511     8159                  END;
      512     8160        */
      513     8161    3         CASE (%OPEN_OUTPUT, %OPEN_EXTEND, %OPEN_OUTPUT_NO_REWIND);

      514     8162    3           IF FAB.ASSIGN = %CP6_CARD_READER OR

   8162 20 001400   200003 471500                    LDP1    @FAB,,AUTO
        20 001401   100000 235100                    LDA     0,,PR1
        20 001402   000007 115007                    CMPA    7,DL
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:92   
        20 001403   001406 600000 20                 TZE     s:8165
        20 001404   000004 115007                    CMPA    4,DL
        20 001405   001440 601000 20                 TNZ     s:8181

      515     8163    3              FAB.ASSIGN = %CP6_SYSIN THEN
      516     8164    4             DO;

      517     8165    4               IO_STATUS = %FILE_OPEN_CONFLICT;

   8165 20 001406   100036 473500                    LDP3    30,,PR1
        20 001407   040100 100400                    MLR     fill='040'O
        20 001410   000004 000002 19                 ADSC9   4                        cn=0,n=2
        20 001411   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      518     8166    4               CALL X9WE$IO_ERROR_STATUS (FAB);

   8166 20 001412   200003 630500                    EPPR0   @FAB,,AUTO
        20 001413   000000 631400 21                 EPPR1   0
        20 001414   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 001415   000000 011000                    NOP     0

      519     8167    4               ALTRETURN;

   8167 20 001416   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001417   000000 702211                    TSX2  ! 0,X1

      520     8168    4             END;
      521     8169        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:93   
      522     8170    3         CASE (%OPEN_I_O);

      523     8171    3           IF FAB.ASSIGN = %CP6_CARD_READER OR

   8171 20 001420   200003 471500                    LDP1    @FAB,,AUTO
        20 001421   100000 235100                    LDA     0,,PR1
        20 001422   000007 115007                    CMPA    7,DL
        20 001423   001426 600000 20                 TZE     s:8174
        20 001424   000006 115007                    CMPA    6,DL
        20 001425   001440 601000 20                 TNZ     s:8181

      524     8172    3              FAB.ASSIGN = %CP6_CARD_PUNCH THEN
      525     8173    4             DO;

      526     8174    4               IO_STATUS = %FILE_OPEN_CONFLICT;

   8174 20 001426   100036 473500                    LDP3    30,,PR1
        20 001427   040100 100400                    MLR     fill='040'O
        20 001430   000004 000002 19                 ADSC9   4                        cn=0,n=2
        20 001431   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      527     8175    4               CALL X9WE$IO_ERROR_STATUS (FAB);

   8175 20 001432   200003 630500                    EPPR0   @FAB,,AUTO
        20 001433   000000 631400 21                 EPPR1   0
        20 001434   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 001435   000000 011000                    NOP     0

      528     8176    4               ALTRETURN;

   8176 20 001436   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001437   000000 702211                    TSX2  ! 0,X1

      529     8177    4             END;
      530     8178
      531     8179    3       END; /* open_type */

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:94   
      532     8180
      533     8181    2     END ATTRIBUTE_CHECK;  /* proc */

   8181 20 001440   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001441   000001 702211                    TSX2  ! 1,X1

      534     8182        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:95   
      535     8183        /*----------------*/
      536     8184    1       OPTIONAL_CHECK: PROC;

   8184 20 001442   200116 741300       OPTIONAL_CH* STX1  ! RELATIVE_KEY+2,,AUTO

      537     8185        /*----------------*/
      538     8186
      539     8187        /*P*
      540     8188             NAME:  OPTIONAL_CHECK
      541     8189          PURPOSE:  Checks for optional file which don't exist and creates
      542     8190                    them when neccessary  (EXTEND, I-O).
      543     8191        */
      544     8192
      545     8193    2       OPEN_FILE.V.FUN# = %IN;

   8193 20 001443   002000 236007                    LDQ     1024,DL
        20 001444   000051 552010 18                 STBQ    OPEN_FILE+37,'10'O

      546     8194    2       CLOSE_FILE.V.DCB# = FAB.DCB_NUM;

   8194 20 001445   200003 470500                    LDP0    @FAB,,AUTO
        20 001446   000034 220100                    LDX0    28,,PR0
        20 001447   000130 740000 18                 STX0    CLOSE_FILE+26

      547     8195    2       CALL M$OPEN (OPEN_FILE)

   8195 20 001450   000004 630400 18                 EPPR0   OPEN_FILE
        20 001451   450000 713400                    CLIMB   alt,open
        20 001452   410400 401760                    pmme    nvectors=18
        20 001453   001460 702000 20                 TSX2    s:8202

      548     8196    2         WHENRETURN
      549     8197    3           DO;

      550     8198    3             CALL M$CLOSE (CLOSE_FILE);

   8198 20 001454   000076 630400 18                 EPPR0   CLOSE_FILE
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:96   
        20 001455   050001 713400                    CLIMB   close
        20 001456   406000 401760                    pmme    nvectors=13

      551     8199    3           END;

   8199 20 001457   001467 710000 20                 TRA     s:8206

      552     8200    2         WHENALTRETURN
      553     8201    3           DO;

      554     8202    3             CALL X9WE$IO_ERROR (FAB);

   8202 20 001460   200003 630500                    EPPR0   @FAB,,AUTO
        20 001461   000000 631400 21                 EPPR1   0
        20 001462   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 001463   000000 011000                    NOP     0

      555     8203    3             CALL M$CLOSE (CLOSE_FILE);

   8203 20 001464   000076 630400 18                 EPPR0   CLOSE_FILE
        20 001465   050001 713400                    CLIMB   close
        20 001466   406000 401760                    pmme    nvectors=13

      556     8204    3           END;

      557     8205
      558     8206    2     END OPTIONAL_CHECK;

   8206 20 001467   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001470   000001 702211                    TSX2  ! 1,X1

      559     8207        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:97   
      560     8208        /*--------------------*/
      561     8209    1     CREATE_OPTIONAL_FILE: PROC;

   8209 20 001471   200116 741300       CREATE_OPTI* STX1  ! RELATIVE_KEY+2,,AUTO

      562     8210        /*--------------------*/
      563     8211
      564     8212        /*P*
      565     8213             NAME: CREATE_OPTIONAL_FILE
      566     8214          PURPOSE: Creates optional files (I-O)
      567     8215        */
      568     8216
      569     8217    2       OPEN_FILE.V.FUN# = %CREATE;

   8217 20 001472   003000 236007                    LDQ     1536,DL
        20 001473   000051 552010 18                 STBQ    OPEN_FILE+37,'10'O

      570     8218    2       IF FAB.ORG# = %CP6_INDEXED

   8218 20 001474   200003 470500                    LDP0    @FAB,,AUTO
        20 001475   000002 235100                    LDA     2,,PR0
        20 001476   000006 115007                    CMPA    6,DL
        20 001477   001511 601000 20                 TNZ     s:8222
        20 001500   000055 236100                    LDQ     45,,PR0
        20 001501   000003 116000 21                 CMPQ    3
        20 001502   001511 600000 20                 TZE     s:8222

      571     8219    2       AND  FAB.ALT_KEY$ ~= ADDR(NIL) THEN
      572     8220    2           OPEN_FILE.ALTKEYS_ = VECTOR (ALT_KEYS);

   8220 20 001503   000055 471500                    LDP1    45,,PR0
        20 001504   000017 235000 21                 LDA     15
        20 001505   200126 451500                    STP1    FILE_ACCT+2,,AUTO
        20 001506   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 001507   000046 757000 18                 STAQ    OPEN_FILE+34
        20 001510   001513 710000 20                 TRA     s:8223

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:98   
      573     8221    2       ELSE
      574     8222    2         OPEN_FILE.ALTKEYS_ = VECTOR (NIL);                    /*#30011*/

   8222 20 001511   000004 237000 21                 LDAQ    4
        20 001512   000046 757000 18                 STAQ    OPEN_FILE+34

      575     8223    2       CLOSE_FILE.V.DCB# = FAB.DCB_NUM;

   8223 20 001513   000034 220100                    LDX0    28,,PR0
        20 001514   000130 740000 18                 STX0    CLOSE_FILE+26

      576     8224    2       CLOSE_FILE.V.DISP# = %SAVE;

   8224 20 001515   000002 236007                    LDQ     2,DL
        20 001516   000130 552004 18                 STBQ    CLOSE_FILE+26,'04'O

      577     8225    2       CALL M$OPEN (OPEN_FILE)

   8225 20 001517   000004 630400 18                 EPPR0   OPEN_FILE
        20 001520   450000 713400                    CLIMB   alt,open
        20 001521   410400 401760                    pmme    nvectors=18
        20 001522   001535 702000 20                 TSX2    s:8236

      578     8226    2         WHENRETURN
      579     8227    3           DO;

      580     8228    3             CALL M$CLOSE (CLOSE_FILE)

   8228 20 001523   000076 630400 18                 EPPR0   CLOSE_FILE
        20 001524   450001 713400                    CLIMB   alt,close
        20 001525   406000 401760                    pmme    nvectors=13
        20 001526   001530 702000 20                 TSX2    s:8231
        20 001527   001534 710000 20                 TRA     s:8233

      581     8229    3               WHENALTRETURN
      582     8230    4                 DO;

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:99   
      583     8231    4                   CALL X9WE$IO_ERROR  (FAB);

   8231 20 001530   200003 630500                    EPPR0   @FAB,,AUTO
        20 001531   000000 631400 21                 EPPR1   0
        20 001532   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 001533   000000 011000                    NOP     0

      584     8232    4                 END;

      585     8233    3           END;

   8233 20 001534   001544 710000 20                 TRA     s:8240

      586     8234    2         WHENALTRETURN
      587     8235    3           DO;

      588     8236    3             CALL X9WE$IO_ERROR (FAB);

   8236 20 001535   200003 630500                    EPPR0   @FAB,,AUTO
        20 001536   000000 631400 21                 EPPR1   0
        20 001537   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 001540   000000 011000                    NOP     0

      589     8237    3             CALL M$CLOSE (CLOSE_FILE);

   8237 20 001541   000076 630400 18                 EPPR0   CLOSE_FILE
        20 001542   050001 713400                    CLIMB   close
        20 001543   406000 401760                    pmme    nvectors=13

      590     8238    3           END;

      591     8239
      592     8240    2     END CREATE_OPTIONAL_FILE;

   8240 20 001544   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001545   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:100  
      593     8241        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:101  
      594     8242        /*-------*/
      595     8243    1       START: PROC;

   8243 20 001546   200116 741300       START        STX1  ! RELATIVE_KEY+2,,AUTO

      596     8244        /*-------*/
      597     8245
      598     8246            %FPT_PRECORD     (FPTN=START);
      599     8267
      600     8268    2       START.V.DCB#  = FAB.DCB_NUM;

   8268 20 001547   200003 470500                    LDP0    @FAB,,AUTO
        20 001550   000034 220100                    LDX0    28,,PR0
        20 001551   000146 740000 18                 STX0    START+6

      601     8269    2       START.V.KEYR# = YES#;

   8269 20 001552   200000 236007                    LDQ     65536,DL
        20 001553   000146 256000 18                 ORSQ    START+6

      602     8270    2       START.V.KEYS# = NO#;

   8270 20 001554   000023 236000 21                 LDQ     19
        20 001555   000146 356000 18                 ANSQ    START+6

      603     8271    2       START.V.N#    = 0;

   8271 20 001556   000147 450000 18                 STZ     START+7

      604     8272    2       START.KEY_ = VECTOR (RELATIVE_KEY);

   8272 20 001557   777640 235007                    LDA     -96,DL
        20 001560   200126 452500                    STP2    FILE_ACCT+2,,AUTO
        20 001561   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 001562   000114 036003                    ADLQ    76,DU
        20 001563   000142 757000 18                 STAQ    START+2

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:102  
      605     8273    2       CALL M$PRECORD (START);

   8273 20 001564   000140 630400 18                 EPPR0   START
        20 001565   040003 713400                    CLIMB   16387
        20 001566   401000 401760                    pmme    nvectors=3

      606     8274
      607     8275    2     END START;

   8275 20 001567   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001570   000001 702211                    TSX2  ! 1,X1

      608     8276        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:103  
      609     8277        /*------------*/
      610     8278    1     EXTEND_START:        PROC;

   8278 20 001571   200116 741300       EXTEND_START STX1  ! RELATIVE_KEY+2,,AUTO

      611     8279        /*------------*/
      612     8280
      613     8281            %FPT_PRECORD     (FPTN=START);
      614     8302
      615     8303    2       START.V.DCB#  = FAB.DCB_NUM;

   8303 20 001572   200003 470500                    LDP0    @FAB,,AUTO
        20 001573   000034 220100                    LDX0    28,,PR0
        20 001574   000160 740000 18                 STX0    START+6

      616     8304    2       START.V.KEYR# = YES#;

   8304 20 001575   200000 236007                    LDQ     65536,DL
        20 001576   000160 256000 18                 ORSQ    START+6

      617     8305    2       START.V.KEYS# = NO#;

   8305 20 001577   000023 236000 21                 LDQ     19
        20 001600   000160 356000 18                 ANSQ    START+6

      618     8306    2       START.V.N#    = -1;

   8306 20 001601   000001 335007                    LCA     1,DL
        20 001602   000161 755000 18                 STA     START+7

      619     8307    2       START.KEY_ = VECTOR (RELATIVE_KEY);

   8307 20 001603   777640 235007                    LDA     -96,DL
        20 001604   200126 452500                    STP2    FILE_ACCT+2,,AUTO
        20 001605   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 001606   000114 036003                    ADLQ    76,DU
        20 001607   000154 757000 18                 STAQ    START+2
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:104  

      620     8308    2       CALL M$PRECORD (START);

   8308 20 001610   000152 630400 18                 EPPR0   START
        20 001611   040003 713400                    CLIMB   16387
        20 001612   401000 401760                    pmme    nvectors=3

      621     8309
      622     8310    2       START.V.KEYR# = YES#;

   8310 20 001613   200000 236007                    LDQ     65536,DL
        20 001614   000160 256000 18                 ORSQ    START+6

      623     8311    2       START.V.KEYS# = YES#;

   8311 20 001615   400000 236007                    LDQ     -131072,DL
        20 001616   000160 256000 18                 ORSQ    START+6

      624     8312    2       START.V.N#    = 0;

   8312 20 001617   000161 450000 18                 STZ     START+7

      625     8313    2       RELATIVE_KEY = RELATIVE_KEY + 1;

   8313 20 001620   200114 235100                    LDA     RELATIVE_KEY,,AUTO
        20 001621   000001 035007                    ADLA    1,DL
        20 001622   200114 755100                    STA     RELATIVE_KEY,,AUTO

      626     8314    2       START.KEY_ = VECTOR (RELATIVE_KEY);

   8314 20 001623   777640 235007                    LDA     -96,DL
        20 001624   200126 452500                    STP2    FILE_ACCT+2,,AUTO
        20 001625   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 001626   000114 036003                    ADLQ    76,DU
        20 001627   000154 757000 18                 STAQ    START+2

      627     8315    2       CALL M$PRECORD (START)
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:105  

   8315 20 001630   000152 630400 18                 EPPR0   START
        20 001631   440003 713400                    CLIMB   alt,+16387
        20 001632   401000 401760                    pmme    nvectors=3
        20 001633   001635 702000 20                 TSX2    s:8320
        20 001634   001635 710000 20                 TRA     s:8320

      628     8316    2         WHENALTRETURN
      629     8317    3           DO;

      630     8318    3           END;

      631     8319
      632     8320    2     END EXTEND_START;

   8320 20 001635   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 001636   000001 702211                    TSX2  ! 1,X1

      633     8321        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:106  
      634     8322        /*-------------*/
      635     8323    1       ADD_FILE_ID: PROC;

   8323 20 001637   200116 741300       ADD_FILE_ID  STX1  ! RELATIVE_KEY+2,,AUTO

      636     8324        /*-------------*/
      637     8325
      638     8326        /*P*
      639     8327
      640     8328             NAME: ADD_FILE_ID
      641     8329
      642     8330          PURPOSE: Adds the file name specifed in the VALUE OF FILE-ID clause
      643     8331                   into the open FPT.
      644     8332
      645     8333        */
      646     8334
      647     8335    2       DCL I              SBIN   WORD;
      648     8336    2       DCL NAME_POS       SBIN   WORD;
      649     8337    2       DCL NAME_LEN       SBIN   WORD;
      650     8338    2       DCL ACCT_POS       SBIN   WORD;
      651     8339    2       DCL FILE_ACCT      CHAR(8) DALIGNED;
      652     8340        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:107  
      653     8341    3   L:  DO I = 0 TO FAB.FILE_ID_LEN - 1;

   8341 20 001640   200117 450100       L            STZ     I,,AUTO
        20 001641   001653 710000 20                 TRA     s:8344+1

      654     8342    3         IF SUBSTR (FILE_ID,I,1) ~= ' ' THEN

   8342 20 001642   200003 470500                    LDP0    @FAB,,AUTO
        20 001643   000042 471500                    LDP1    34,,PR0
        20 001644   000012 720100                    LXL0    10,,PR0
        20 001645   200117 235100                    LDA     I,,AUTO
        20 001646   040000 106505                    CMPC    fill='040'O
        20 001647   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
        20 001650   000024 000001 21                 ADSC9   20                       cn=0,n=1
        20 001651   001657 601000 20                 TNZ     s:8345

      655     8343    3           EXIT L;
      656     8344    3       END L;

   8344 20 001652   200117 054100                    AOS     I,,AUTO
        20 001653   200003 470500                    LDP0    @FAB,,AUTO
        20 001654   200117 236100                    LDQ     I,,AUTO
        20 001655   000012 116100                    CMPQ    10,,PR0
        20 001656   001642 604000 20                 TMI     s:8342

      657     8345    2       NAME_POS = I;

   8345 20 001657   200117 235100                    LDA     I,,AUTO
        20 001660   200120 755100                    STA     NAME_POS,,AUTO

      658     8346
      659     8347    2       CALL INDEX (I,'.',FILE_ID);

   8347 20 001661   000042 471500                    LDP1    34,,PR0
        20 001662   000012 720100                    LXL0    10,,PR0
        20 001663   000000 124540                    SCM     mask='000'O
        20 001664   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:108  
        20 001665   000025 000001 21                 ADSC9   21                       cn=0,n=1
        20 001666   200117 000100                    ARG     I,,AUTO

      660     8348    2       IF I = FAB.FILE_ID_LEN THEN

   8348 20 001667   200117 236100                    LDQ     I,,AUTO
        20 001670   000012 116100                    CMPQ    10,,PR0
        20 001671   001723 601000 20                 TNZ     s:8358

      661     8349    3         DO;

      662     8350    3           CALL INDEX (I,' ',FILE_ID,NAME_POS);

   8350 20 001672   000000 636010                    EAQ     0,X0
        20 001673   000022 732000                    QRS     18
        20 001674   200120 136100                    SBLQ    NAME_POS,,AUTO
        20 001675   200126 756100                    STQ     FILE_ACCT+2,,AUTO
        20 001676   200120 236100                    LDQ     NAME_POS,,AUTO
        20 001677   200126 720100                    LXL0    FILE_ACCT+2,,AUTO
        20 001700   000000 124545                    SCM     mask='000'O
        20 001701   100000 000010                    ADSC9   0,A,PR1                  cn=0,n=*X0
        20 001702   000024 000001 21                 ADSC9   20                       cn=0,n=1
        20 001703   200117 000100                    ARG     I,,AUTO
        20 001704   200117 056100                    ASQ     I,,AUTO

      663     8351    3           NAME_LEN = I - NAME_POS;

   8351 20 001705   200117 236100                    LDQ     I,,AUTO
        20 001706   200120 136100                    SBLQ    NAME_POS,,AUTO
        20 001707   200121 756100                    STQ     NAME_LEN,,AUTO

      664     8352    3           FILE_NAME.LENGTH = NAME_LEN;

   8352 20 001710   000033 736000                    QLS     27
        20 001711   200102 552140                    STBQ    FILE_NAME,'40'O,AUTO

      665     8353    3           FILE_NAME.TEXT   = SUBSTR (FILE_ID,NAME_POS,NAME_LEN);
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:109  

   8353 20 001712   000042 471500                    LDP1    34,,PR0
        20 001713   000012 720100                    LXL0    10,,PR0
        20 001714   200121 721100                    LXL1    NAME_LEN,,AUTO
        20 001715   040100 100545                    MLR     fill='040'O
        20 001716   100000 000011                    ADSC9   0,A,PR1                  cn=0,n=*X1
        20 001717   200102 200037                    ADSC9   FILE_NAME,,AUTO          cn=1,n=31

      666     8354    3           OPEN_FILE.ACCT_  = VECTOR (NIL) ;

   8354 20 001720   000004 237000 21                 LDAQ    4
        20 001721   000030 757000 18                 STAQ    OPEN_FILE+20

      667     8355    3         END;

   8355 20 001722   001774 710000 20                 TRA     s:8365

      668     8356    2       ELSE
      669     8357    3         DO;

      670     8358    3           FILE_NAME.LENGTH = I - NAME_POS;

   8358 20 001723   200120 136100                    SBLQ    NAME_POS,,AUTO
        20 001724   000033 736000                    QLS     27
        20 001725   200102 552140                    STBQ    FILE_NAME,'40'O,AUTO

      671     8359    3           FILE_NAME.TEXT   = SUBSTR (FILE_ID,NAME_POS,FILE_NAME.LENGTH);

   8359 20 001726   000042 471500                    LDP1    34,,PR0
        20 001727   000012 720100                    LXL0    10,,PR0
        20 001730   200102 236100                    LDQ     FILE_NAME,,AUTO
        20 001731   000033 772000                    QRL     27
        20 001732   000000 621006                    EAX1    0,QL
        20 001733   040100 100545                    MLR     fill='040'O
        20 001734   100000 000011                    ADSC9   0,A,PR1                  cn=0,n=*X1
        20 001735   200102 200037                    ADSC9   FILE_NAME,,AUTO          cn=1,n=31

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:110  
      672     8360    3           ACCT_POS = I + 1;

   8360 20 001736   200117 236100                    LDQ     I,,AUTO
        20 001737   000001 036007                    ADLQ    1,DL
        20 001740   200122 756100                    STQ     ACCT_POS,,AUTO

      673     8361    3           CALL INDEX (I,' ',FILE_ID,ACCT_POS);

   8361 20 001741   000042 471500                    LDP1    34,,PR0
        20 001742   000012 720100                    LXL0    10,,PR0
        20 001743   000000 636010                    EAQ     0,X0
        20 001744   000022 732000                    QRS     18
        20 001745   200122 136100                    SBLQ    ACCT_POS,,AUTO
        20 001746   200126 756100                    STQ     FILE_ACCT+2,,AUTO
        20 001747   200122 236100                    LDQ     ACCT_POS,,AUTO
        20 001750   200126 720100                    LXL0    FILE_ACCT+2,,AUTO
        20 001751   200122 235100                    LDA     ACCT_POS,,AUTO
        20 001752   000000 124545                    SCM     mask='000'O
        20 001753   100000 000010                    ADSC9   0,A,PR1                  cn=0,n=*X0
        20 001754   000024 000001 21                 ADSC9   20                       cn=0,n=1
        20 001755   200117 000100                    ARG     I,,AUTO
        20 001756   200117 056100                    ASQ     I,,AUTO

      674     8362    3           FILE_ACCT = SUBSTR (FILE_ID,ACCT_POS,I - ACCT_POS);

   8362 20 001757   000042 471500                    LDP1    34,,PR0
        20 001760   000012 720100                    LXL0    10,,PR0
        20 001761   200117 236100                    LDQ     I,,AUTO
        20 001762   200122 136100                    SBLQ    ACCT_POS,,AUTO
        20 001763   000000 621006                    EAX1    0,QL
        20 001764   040100 100545                    MLR     fill='040'O
        20 001765   100000 000011                    ADSC9   0,A,PR1                  cn=0,n=*X1
        20 001766   200124 000010                    ADSC9   FILE_ACCT,,AUTO          cn=0,n=8

      675     8363    3           OPEN_FILE.ACCT_ = VECTOR (FILE_ACCT);

   8363 20 001767   000026 235000 21                 LDA     22
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:111  
        20 001770   200126 452500                    STP2    FILE_ACCT+2,,AUTO
        20 001771   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 001772   000124 036003                    ADLQ    84,DU
        20 001773   000030 757000 18                 STAQ    OPEN_FILE+20

      676     8364    3         END;

      677     8365    2       OPEN_FILE.NAME_ = VECTOR  (FILE_NAME);

   8365 20 001774   000027 235000 21                 LDA     23
        20 001775   200126 452500                    STP2    FILE_ACCT+2,,AUTO
        20 001776   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 001777   000102 036003                    ADLQ    66,DU
        20 002000   000012 757000 18                 STAQ    OPEN_FILE+6

      678     8366    2     END ADD_FILE_ID;

   8366 20 002001   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 002002   000001 702211                    TSX2  ! 1,X1

      679     8367        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:112  
      680     8368        /*---------*/
      681     8369    1       GET_MEM: PROC;

   8369 20 002003   200116 741300       GET_MEM      STX1  ! RELATIVE_KEY+2,,AUTO

      682     8370        /*---------*/
      683     8371
      684     8372    2           FAB.B.FAST_SEQUENTIAL = YES# ;

   8372 20 002004   200003 470500                    LDP0    @FAB,,AUTO
        20 002005   000004 236003                    LDQ     4,DU
        20 002006   000032 256100                    ORSQ    26,,PR0

      685     8373
      686     8374    2           IF FAB.XSA.BBUF_ = '000000000000000000000000'O THEN /*#40646*/

   8374 20 002007   000064 237100                    LDAQ    52,,PR0
        20 002010   000006 117000 19                 CMPAQ   6
        20 002011   002042 601000 20                 TNZ     s:8384

      687     8375    2             CALL X9MM$GET_MEM (FAB.XSA.BBUF_)

   8375 20 002012   200003 236100                    LDQ     @FAB,,AUTO
        20 002013   000064 036003                    ADLQ    52,DU
        20 002014   200126 756100                    STQ     FILE_ACCT+2,,AUTO
        20 002015   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 002016   000000 631400 21                 EPPR1   0
        20 002017   000000 701000 xent               TSX1    X9MM$GET_MEM
        20 002020   002042 702000 20                 TSX2    s:8384

      688     8376    2             WHENRETURN
      689     8377    3               DO;

      690     8378    3                 IF FAB.XSA.ORG = %CP6_KEYED

   8378 20 002021   200003 470500                    LDP0    @FAB,,AUTO
        20 002022   000074 236100                    LDQ     60,,PR0
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:113  
        20 002023   000777 376003                    ANQ     511,DU
        20 002024   000002 116003                    CMPQ    2,DU
        20 002025   002030 600000 20                 TZE     s:8380
        20 002026   000006 116003                    CMPQ    6,DU
        20 002027   002040 601000 20                 TNZ     s:8382

      691     8379    3                      OR FAB.XSA.ORG = %CP6_INDEXED THEN
      692     8380    3                   CALL X9MM$GET_MEM (FAB.XSA.KBUF_);

   8380 20 002030   200003 236100                    LDQ     @FAB,,AUTO
        20 002031   000062 036003                    ADLQ    50,DU
        20 002032   200126 756100                    STQ     FILE_ACCT+2,,AUTO
        20 002033   200126 630500                    EPPR0   FILE_ACCT+2,,AUTO
        20 002034   000000 631400 21                 EPPR1   0
        20 002035   000000 701000 xent               TSX1    X9MM$GET_MEM
        20 002036   000000 011000                    NOP     0
        20 002037   002042 710000 20                 TRA     s:8384

      693     8381    3                 ELSE
      694     8382    3                   FAB.XSA.KBUF_.BUF$ = ADDR(NIL);

   8382 20 002040   000003 236000 21                 LDQ     3
        20 002041   000063 756100                    STQ     51,,PR0

      695     8383    3               END;

      696     8384    2     END GET_MEM; /* proc */

   8384 20 002042   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 002043   000001 702211                    TSX2  ! 1,X1

      697     8385        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:114  
      698     8386        /*-----------*/
      699     8387    1       OPEN_INIT: PROC;

   8387 20 002044   200116 741300       OPEN_INIT    STX1  ! RELATIVE_KEY+2,,AUTO

      700     8388        /*-----------*/
      701     8389        /*I*
      702     8390
      703     8391          NAME:    OPEN_INIT
      704     8392
      705     8393          PURPOSE: To initialize the DCB with the information in the FAB.
      706     8394
      707     8395          DESCRIPTION:
      708     8396                 Initializes the DCB with the information found in the FAB via a call to
      709     8397                 M$OPEN with the SETDCB and SCRUB options on.
      710     8398        */
      711     8399
      712     8400            %FPT_OPEN    (FPTN=INIT_OPEN, SETDCB=YES, SCRUB=YES);
      713     8509
      714     8510    2       INIT_OPEN.V.DCB# = FAB.DCB_NUM;

   8510 20 002045   200003 470500                    LDP0    @FAB,,AUTO
        20 002046   000034 220100                    LDX0    28,,PR0
        20 002047   000230 740000 18                 STX0    INIT_OPEN+36

      715     8511    2       IF   M$XX.ACS# = %CP6_DEFAULT                   /* #32500,#35576,#38492 */

   8511 20 002050   200076 471500                    LDP1    DCB$,,AUTO
        20 002051   100036 236100                    LDQ     30,,PR1
        20 002052   000777 316007                    CANQ    511,DL
        20 002053   002065 601000 20                 TNZ     s:8515

      716     8512    2       THEN IF   FAB.ACS# = %FAB_RANDOM_ACCESS                       /* #32500 */

   8512 20 002054   000004 235100                    LDA     4,,PR0
        20 002055   000003 115007                    CMPA    3,DL
        20 002056   002062 601000 20                 TNZ     s:8514
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:115  

      717     8513    2            THEN INIT_OPEN.V.ACS# = %CP6_RANDOM_ACCESS;

   8513 20 002057   000002 236007                    LDQ     2,DL
        20 002060   000232 552004 18                 STBQ    INIT_OPEN+38,'04'O
        20 002061   002066 710000 20                 TRA     s:8516

      718     8514    2            ELSE INIT_OPEN.V.ACS# = FAB.ACS#;

   8514 20 002062   000004 236100                    LDQ     4,,PR0
        20 002063   000232 552004 18                 STBQ    INIT_OPEN+38,'04'O
        20 002064   002066 710000 20                 TRA     s:8516

      719     8515    2       ELSE INIT_OPEN.V.ACS# = M$XX.ACS#;

   8515 20 002065   000232 552004 18                 STBQ    INIT_OPEN+38,'04'O

      720     8516    2       INIT_OPEN.V.ASN# = FAB.ASSIGN;

   8516 20 002066   000000 236100                    LDQ     0,,PR0
        20 002067   000231 552004 18                 STBQ    INIT_OPEN+37,'04'O

      721     8517    2       INIT_OPEN.V.ORG# = FAB.ORG# ;

   8517 20 002070   000002 236100                    LDQ     2,,PR0
        20 002071   000011 736000                    QLS     9
        20 002072   000232 552010 18                 STBQ    INIT_OPEN+38,'10'O

      722     8518    2       INIT_OPEN.V.NRECS# = 1000 ;  /* Default size for relative files */

   8518 20 002073   001750 235007                    LDA     1000,DL
        20 002074   000242 755000 18                 STA     INIT_OPEN+46

      723     8519        /*V*              KEYX#_and_KEYL#
      724     8520                 These fields are needed for indexed files.
      725     8521        */
      726     8522    2       IF FAB.ORG# = %CP6_INDEXED THEN
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:116  

   8522 20 002075   000002 235100                    LDA     2,,PR0
        20 002076   000006 115007                    CMPA    6,DL
        20 002077   002113 601000 20                 TNZ     s:8528

      727     8523    3         DO;

      728     8524    3           INIT_OPEN.V.KEYX# = POFFC  (FAB.RECORD_KEY$, FAB.BUFFER$);

   8524 20 002100   000052 236100                    LDQ     42,,PR0
        20 002101   000020 772000                    QRL     16
        20 002102   200126 756100                    STQ     FILE_ACCT+2,,AUTO
        20 002103   000054 236100                    LDQ     44,,PR0
        20 002104   000020 772000                    QRL     16
        20 002105   200126 136100                    SBLQ    FILE_ACCT+2,,AUTO
        20 002106   000000 622006                    EAX2    0,QL
        20 002107   000235 742000 18                 STX2    INIT_OPEN+41

      729     8525    3           INIT_OPEN.V.KEYL# = FAB.RECORD_KEY_LEN;

   8525 20 002110   000031 236100                    LDQ     25,,PR0
        20 002111   000011 736000                    QLS     9
        20 002112   000235 552010 18                 STBQ    INIT_OPEN+41,'10'O

      730     8526    3         END;

      731     8527
      732     8528    2       INIT_OPEN.V.CNVRT# = FAB.B.CNVRT#;

   8528 20 002113   000032 236100                    LDQ     26,,PR0
        20 002114   000001 376003                    ANQ     1,DU
        20 002115   000017 736000                    QLS     15
        20 002116   000244 676000 18                 ERQ     INIT_OPEN+48
        20 002117   140000 376003                    ANQ     49152,DU
        20 002120   000244 656000 18                 ERSQ    INIT_OPEN+48

      733     8529    2       INIT_OPEN.V.EBCDIC# = FAB.B.EBCDIC#;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:117  

   8529 20 002121   000032 236100                    LDQ     26,,PR0
        20 002122   400000 376007                    ANQ     -131072,DL
        20 002123   000022 736000                    QLS     18
        20 002124   000244 676000 18                 ERQ     INIT_OPEN+48
        20 002125   600000 376003                    ANQ     -65536,DU
        20 002126   000244 656000 18                 ERSQ    INIT_OPEN+48

      734     8530    2       INIT_OPEN.V.RECL#  = FAB.MAX_REC_LEN;

   8530 20 002127   000010 722100                    LXL2    8,,PR0
        20 002130   000236 442000 18                 SXL2    INIT_OPEN+42

      735     8531    2       INIT_OPEN.V.BLKL#  = FAB.MAX_BLOCK_LEN;

   8531 20 002131   000006 723100                    LXL3    6,,PR0
        20 002132   000236 743000 18                 STX3    INIT_OPEN+42

      736     8532    2       IF M$XX.NAME#.L = 0 THEN

   8532 20 002133   100010 236100                    LDQ     8,,PR1
        20 002134   777000 316003                    CANQ    -512,DU
        20 002135   002156 601000 20                 TNZ     s:8539

      737     8533    3         DO;

      738     8534    3           FILE_NAME.LENGTH = M$XX.DCBNAME.L + 1;

   8534 20 002136   100140 236100                    LDQ     96,,PR1
        20 002137   000033 772000                    QRL     27
        20 002140   000037 376007                    ANQ     31,DL
        20 002141   000001 036007                    ADLQ    1,DL
        20 002142   000033 736000                    QLS     27
        20 002143   200102 552140                    STBQ    FILE_NAME,'40'O,AUTO

      739     8535    3           CALL CONCAT (FILE_NAME.TEXT,'*',M$XX.DCBNAME.N);

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:118  
   8535 20 002144   100140 236100                    LDQ     96,,PR1
        20 002145   000033 772000                    QRL     27
        20 002146   000037 376007                    ANQ     31,DL
        20 002147   000000 624006                    EAX4    0,QL
        20 002150   000052 236003                    LDQ     42,DU
        20 002151   200102 552120                    STBQ    FILE_NAME,'20'O,AUTO
        20 002152   040100 100540                    MLR     fill='040'O
        20 002153   100140 200014                    ADSC9   96,,PR1                  cn=1,n=*X4
        20 002154   200102 400036                    ADSC9   FILE_NAME,,AUTO          cn=2,n=30

      740     8536    3         END;

   8536 20 002155   002162 710000 20                 TRA     s:8543

      741     8537    2       ELSE
      742     8538    3         DO;

      743     8539    3           FILE_NAME.LENGTH = M$XX.NAME#.L;

   8539 20 002156   200102 552140                    STBQ    FILE_NAME,'40'O,AUTO

      744     8540    3           FILE_NAME.TEXT = M$XX.NAME#.C;

   8540 20 002157   040100 100500                    MLR     fill='040'O
        20 002160   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31
        20 002161   200102 200037                    ADSC9   FILE_NAME,,AUTO          cn=1,n=31

      745     8541    3         END;

      746     8542
      747     8543    2       INIT_OPEN.NAME_ = VECTOR  (FILE_NAME);

   8543 20 002162   000027 235000 21                 LDA     23
        20 002163   200126 452500                    STP2    FILE_ACCT+2,,AUTO
        20 002164   200126 236100                    LDQ     FILE_ACCT+2,,AUTO
        20 002165   000102 036003                    ADLQ    66,DU
        20 002166   000172 757000 18                 STAQ    INIT_OPEN+6
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:119  

      748     8544
      749     8545    3       DO CASE  (FAB.ASSIGN);

   8545 20 002167   200003 470500                    LDP0    @FAB,,AUTO
        20 002170   000000 235100                    LDA     0,,PR0
        20 002171   000007 115007                    CMPA    7,DL
        20 002172   002174 602005 20                 TNC     s:8545+5,AL
        20 002173   002224 710000 20                 TRA     s:8564
        20 002174   002224 710000 20                 TRA     s:8564
        20 002175   002224 710000 20                 TRA     s:8564
        20 002176   002212 710000 20                 TRA     s:8554
        20 002177   002224 710000 20                 TRA     s:8564
        20 002200   002224 710000 20                 TRA     s:8564
        20 002201   002221 710000 20                 TRA     s:8559
        20 002202   002203 710000 20                 TRA     s:8549

      750     8546
      751     8547    3         CASE  (%CP6_CARD_PUNCH);

      752     8548
      753     8549    3           INIT_OPEN.V.ASN# = %CP6_DEVICE;

   8549 20 002203   000003 236007                    LDQ     3,DL
        20 002204   000231 552004 18                 STBQ    INIT_OPEN+37,'04'O

      754     8550    3           INIT_OPEN.V.RES# = 'CP';

   8550 20 002205   000010 236000 19                 LDQ     8
        20 002206   777777 376003                    ANQ     -1,DU
        20 002207   040040 276007                    ORQ     16416,DL
        20 002210   000234 756000 18                 STQ     INIT_OPEN+40
        20 002211   002232 710000 20                 TRA     s:8570

      755     8551
      756     8552    3         CASE  (%CP6_MAGNETIC_TAPE);

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:120  
      757     8553
      758     8554    3           INIT_OPEN.V.ASN# = %CP6_TAPE;

   8554 20 002212   000002 236007                    LDQ     2,DL
        20 002213   000231 552004 18                 STBQ    INIT_OPEN+37,'04'O

      759     8555    3           INIT_OPEN.V.RES# = 'MT';

   8555 20 002214   000011 236000 19                 LDQ     9
        20 002215   777777 376003                    ANQ     -1,DU
        20 002216   040040 276007                    ORQ     16416,DL
        20 002217   000234 756000 18                 STQ     INIT_OPEN+40
        20 002220   002232 710000 20                 TRA     s:8570

      760     8556
      761     8557    3         CASE  (%CP6_DISK);

      762     8558
      763     8559    3           INIT_OPEN.V.ASN# = %CP6_FILE;

   8559 20 002221   000001 236007                    LDQ     1,DL
        20 002222   000231 552004 18                 STBQ    INIT_OPEN+37,'04'O
        20 002223   002232 710000 20                 TRA     s:8570

      764     8560                /* no RES# */
      765     8561
      766     8562    3         CASE  (ELSE);

      767     8563
      768     8564    3           INIT_OPEN.V.ASN# = %CP6_DEVICE;

   8564 20 002224   000003 236007                    LDQ     3,DL
        20 002225   000231 552004 18                 STBQ    INIT_OPEN+37,'04'O

      769     8565    3           INIT_OPEN.V.RES# = 'ME';

   8565 20 002226   000012 236000 19                 LDQ     10
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:121  
        20 002227   777777 376003                    ANQ     -1,DU
        20 002230   040040 276007                    ORQ     16416,DL
        20 002231   000234 756000 18                 STQ     INIT_OPEN+40

      770     8566
      771     8567    3       END; /* case fab.assign */

      772     8568
      773     8569
      774     8570    2       CALL M$OPEN  (INIT_OPEN);

   8570 20 002232   000164 630400 18                 EPPR0   INIT_OPEN
        20 002233   050000 713400                    CLIMB   open
        20 002234   410400 401760                    pmme    nvectors=18

      775     8571    2     END OPEN_INIT; /* proc */

   8571 20 002235   200116 221300                    LDX1  ! RELATIVE_KEY+2,,AUTO
        20 002236   000001 702211                    TSX2  ! 1,X1

      776     8572
      777     8573    1   END X9WO$OPEN;  /* proc */

   8573 20 002237   000000 702200 xent               TSX2  ! X66_ARET
      778     8574        %EJECT;
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:122  
      779     8575        %EOD;

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:123  
--  Include file information  --

   X9A_LIB_IO.:X8A6TOU  cannot be made into a system file and is referenced.
   X9A_IO.:X8A6TOU  is referenced.
   XS_MACRO_C.:LIBRARY  is referenced.
   X9A_FAB.:X8A6TOU  is referenced.
   X8A_LIBCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   X8A_ERRCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   X8A_SYS_FILE.:X8A6TOU  is referenced.
      No diagnostics issued in procedure X9WO$OPEN.
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:124  

 **** Variables and constants ****

  ****  Section 001 LblCom LIBCOM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(720)   r     1 LIBCOM

  ****  Section 002 LblCom DEC_OR_COMMA

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR              1 DEC_OR_COMMA

  ****  Section 003 LblCom IN_TEMP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(80)          1 IN_TEMP

  ****  Section 004 LblCom OVRCHR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR              1 OVRCHR

  ****  Section 005 LblCom SELECT_TIME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 SELECT_TIME

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:125  
  ****  Section 006 LblCom NO_ADVANCE_OFFSET

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 NO_ADVANCE_OFFSET

  ****  Section 007 LblCom DSPLY_SAVE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(72)          1 DSPLY_SAVE

  ****  Section 008 LblCom D_DATE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(10)          1 D_DATE

  ****  Section 009 LblCom D_TIME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(11)          1 D_TIME

  ****  Section 010 LblCom D_DAY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(3)           1 D_DAY

  ****  Section 011 LblCom C_DATE

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:126  
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(6)           1 C_DATE

  ****  Section 012 LblCom C_TIME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(8)           1 C_TIME

  ****  Section 013 LblCom C_DAY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(5)           1 C_DAY

  ****  Section 014 LblCom RTHOLD2

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 RTHOLD2

  ****  Section 015 LblCom LTHOLD2

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 LTHOLD2

  ****  Section 016 LblCom NDX2

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:127  

     0-0-0/w SBIN              1 NDX2

  ****  Section 017 LblCom IN_LEN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 IN_LEN

  ****  Section 018  Data  X9WO$OPEN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    76-0-0/d STRC(1080)  r     1 CLOSE_FILE                 0-0-0/d STRC(144)   r     1 FPT_PFIL
   164-0-0/d STRC(2088)  r     1 INIT_OPEN                  4-0-0/d STRC(2088)  r     1 OPEN_FILE
   134-0-0/d STRC(144)   r     1 REWIND_FILE              140-0-0/d STRC(360)   r     1 START
   152-0-0/d STRC(360)   r     1 START

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FAB                       4-0-0/w PTR         r     1 @OPEN_TYPE
   122-0-0/w SBIN        r     1 ACCT_POS                  76-0-0/w PTR         r     1 DCB$
    *0-0-0/d STRC(2232)  r     1 FAB                      124-0-0/d CHAR(8)     r     1 FILE_ACCT
   102-0-0/d STRC(288)   r     1 FILE_NAME                112-0-0/d STRC(72)          1 FSA_
   117-0-0/w SBIN        r     1 I                        101-0-0/w SBIN              1 LENGTH
    31-0-0/w SBIN              1 LT                        32-0-0/c CHAR(65)          1 LTHOLD
   121-0-0/w SBIN        r     1 NAME_LEN                 120-0-0/w SBIN        r     1 NAME_POS
    74-0-0/w SBIN              1 NDX                       75-0-0/w SBIN              1 NDX3
    *0-0-0/w SBIN        r     1 OPEN_TYPE                114-0-0/w UBIN        r     1 RELATIVE_KEY
    53-0-0/c CHAR(65)          1 RTHOLD                     5-0-0/c CHAR(80)          1 SPECIAL_ERR_MSG
    77-0-0/w PTR         r     1 USE$$                    100-0-0/w EPTR        r     1 USE_ENTRY$

PL6.E3A0      #001=X9WO$OPEN File=X9WO.:X8A6TSI                                  SAT 08/09/97 11:08 Page:128  
  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$TCB$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(720)   r     1 ALT_KEYS                   0-0-0/w STRC(2448)        1 B$ALT
     0-0-0/w STRC(144)         1 B$TCB                      0-0-0/c ACHR        r     1 FILE_ID
     0-0-0/c CHAR(2)     r     1 IO_STATUS                  0-0-0/w SBIN        r     1 LINAGE_COUNTER
     0-0-0N  NULL        r     1 M$UC                       0-0-0/d ASTR(3528)  r     1 M$XX
     0-0-0/w STRC(864)   r     1 USE_PROC


   Procedure X9WO$OPEN requires 1184 words for executable code.
   Procedure X9WO$OPEN requires 90 words of local(AUTO) storage.

PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:129  
      780        1        /*T***********************************************************/
      781        2        /*T*                                                         */
      782        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      783        4        /*T*                                                         */
      784        5        /*T***********************************************************/
      785        6        /*-------------------*/
      786        7          X9WO$CONVERT_LINAGE: PROC  (FAB);
      787        8        /*-------------------*/
      788        9
      789       10        /*P*
      790       11
      791       12          NAME:  X9WO$CONVERT_LINAGE
      792       13
      793       14          PURPOSE:
      794       15               This routine converts linage items to integer for ease of use in IO routines.
      795       16
      796       17        */
      797       18
      798       19            %INCLUDE X8A_SYS_FILE;
      799     6289            %INCLUDE X9A_FAB;
      800     6476            %INCLUDE X9A_IO;
      801     6626            %INCLUDE X8A_ERRCOM;
      802     6715            %INCLUDE X9A_LIB_IO;
      803     7099
      804     7100            %DCL_FAB;
      805     7222    1       DCL NAME_LENGTH    SBIN WORD;
      806     7223
      807     7224    1       DCL X8CV$CONVERT_TO_INTEGER     ENTRY(3) ALTRET;
      808     7225    1       DCL X8ER$ERROR                  ENTRY(3);
      809     7226        %EJECT;
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:130  
      810     7227    1       CALL X8CV$CONVERT_TO_INTEGER (FAB.LINAGE_LINES$, FAB.LINAGE_LINES_DESC, FAB.
              7227                LINAGE);
      811     7228    1       IF FAB.LINAGE = 0 THEN
      812     7229    2         DO;
      813     7230    2           DCB$ = DCBADDR (FAB.DCB_NUM);
      814     7231    2           NAME_LENGTH = DCB$-> M$XX.DCBNAME.L;
      815     7232    2           CALL X8ER$ERROR (%IO_INVALID_LINAGE, DCB$-> M$XX.DCBNAME.N,
      816     7233    2                            NAME_LENGTH);
      817     7234    2         END;
      818     7235    1       IF FAB.FOOTING$ ~= ADDR(NIL) THEN
      819     7236    2         DO;
      820     7237    2           CALL X8CV$CONVERT_TO_INTEGER (FAB.FOOTING$, FAB.FOOTING_DESC, FAB.FOOTING);
      821     7238    2           IF FAB.FOOTING = 0
      822     7239    2           OR FAB.FOOTING > FAB.LINAGE THEN
      823     7240    3             DO;
      824     7241    3               DCB$ = DCBADDR (FAB.DCB_NUM);
      825     7242    3               NAME_LENGTH = DCB$-> M$XX.DCBNAME.L;
      826     7243    3               CALL X8ER$ERROR  (%IO_INVALID_FOOTING, DCB$-> M$XX.DCBNAME.N,
      827     7244    3                                 NAME_LENGTH);
      828     7245    3             END;
      829     7246    2         END;
      830     7247
      831     7248    1       IF FAB.TOP$ ~= ADDR(NIL) THEN
      832     7249    1         CALL X8CV$CONVERT_TO_INTEGER (FAB.TOP$, FAB.TOP_DESC, FAB.TOP);
      833     7250
      834     7251    1       IF FAB.BOTTOM$ ~= ADDR(NIL) THEN
      835     7252    1         CALL X8CV$CONVERT_TO_INTEGER (FAB.BOTTOM$, FAB.BOTTOM_DESC, FAB.BOTTOM);
      836     7253
      837     7254    1   END X9WO$CONVERT_LINAGE;  /*  proc  */
      838     7255        %EJECT;
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:131  

PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:132  
--  Include file information  --

   X9A_LIB_IO.:X8A6TOU  cannot be made into a system file and is referenced.
   X8A_ERRCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   X9A_IO.:X8A6TOU  is referenced.
   XS_MACRO_C.:LIBRARY  is referenced.
   X9A_FAB.:X8A6TOU  is referenced.
   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   X8A_SYS_FILE.:X8A6TOU  is referenced.
      No diagnostics issued in procedure X9WO$CONVERT_LINAGE.

   Procedure X9WO$CONVERT_LINAGE requires 116 words for executable code.
   Procedure X9WO$CONVERT_LINAGE requires 32 words of local(AUTO) storage.

    No errors detected in file X9WO.:X8A6TSI    .

PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:133  

 Object Unit name= X9WO$CONVERT_LINAGE                        File name= X9WO.:X8A6TOU
 UTS= AUG 09 '97 11:12:12.08 SAT                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   116    164  X9WO$CONVERT_LINAGE
    2  RoData even  none     8     10  X9WO$CONVERT_LINAGE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  X9WO$CONVERT_LINAGE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 X8CV$CONVERT_TO_INTEGER
         yes           Std       3 X8ER$ERROR
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$TCB$
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:134  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 NULLSID                               ISSID
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:135  


      780        1        /*T***********************************************************/
      781        2        /*T*                                                         */
      782        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      783        4        /*T*                                                         */
      784        5        /*T***********************************************************/
      785        6        /*-------------------*/
      786        7          X9WO$CONVERT_LINAGE: PROC  (FAB);

      7  1 000000   000000 700200 xent  X9WO$CONVER* TSX0  ! X66_AUTO_1
         1 000001   000040 000001                    ZERO    32,1

      787        8        /*-------------------*/
      788        9
      789       10        /*P*
      790       11
      791       12          NAME:  X9WO$CONVERT_LINAGE
      792       13
      793       14          PURPOSE:
      794       15              This routine converts linage items to integer for ease of use in IO routines.
      795       16
      796       17        */
      797       18
      798       19            %INCLUDE X8A_SYS_FILE;
      799     6289            %INCLUDE X9A_FAB;
      800     6476            %INCLUDE X9A_IO;
      801     6626            %INCLUDE X8A_ERRCOM;
      802     6715            %INCLUDE X9A_LIB_IO;
      803     7099
      804     7100            %DCL_FAB;
      805     7222    1       DCL NAME_LENGTH    SBIN WORD;
      806     7223
      807     7224    1       DCL X8CV$CONVERT_TO_INTEGER     ENTRY(3) ALTRET;
      808     7225    1       DCL X8ER$ERROR                  ENTRY(3);
      809     7226        %EJECT;
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:136  
      810     7227    1       CALL X8CV$CONVERT_TO_INTEGER (FAB.LINAGE_LINES$, FAB.LINAGE_LINES_DESC, FAB.
              7227                LINAGE);

   7227  1 000002   200003 236100                    LDQ     @FAB,,AUTO
         1 000003   000021 036003                    ADLQ    17,DU
         1 000004   200036 756100                    STQ     NAME_LENGTH+3,,AUTO
         1 000005   200003 236100                    LDQ     @FAB,,AUTO
         1 000006   000015 036003                    ADLQ    13,DU
         1 000007   200035 756100                    STQ     NAME_LENGTH+2,,AUTO
         1 000010   200003 236100                    LDQ     @FAB,,AUTO
         1 000011   000045 036003                    ADLQ    37,DU
         1 000012   200034 756100                    STQ     NAME_LENGTH+1,,AUTO
         1 000013   200034 630500                    EPPR0   NAME_LENGTH+1,,AUTO
         1 000014   000000 631400 2                  EPPR1   0
         1 000015   000000 701000 xent               TSX1    X8CV$CONVERT_TO_INTEGER
         1 000016   000000 011000                    NOP     0

      811     7228    1       IF FAB.LINAGE = 0 THEN

   7228  1 000017   200003 470500                    LDP0    @FAB,,AUTO
         1 000020   000021 235100                    LDA     17,,PR0
         1 000021   000046 601000 1                  TNZ     s:7235

      812     7229    2         DO;

      813     7230    2           DCB$ = DCBADDR (FAB.DCB_NUM);

   7230  1 000022   000001 471400 2                  LDP1    1
         1 000023   100000 473500                    LDP3    0,,PR1
         1 000024   000034 220100                    LDX0    28,,PR0
         1 000025   300000 236110                    LDQ     0,X0,PR3
         1 000026   200030 756100                    STQ     DCB$,,AUTO

      814     7231    2           NAME_LENGTH = DCB$-> M$XX.DCBNAME.L;

   7231  1 000027   200030 474500                    LDP4    DCB$,,AUTO
         1 000030   400140 236100                    LDQ     96,,PR4
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:137  
         1 000031   000033 772000                    QRL     27
         1 000032   000037 376007                    ANQ     31,DL
         1 000033   200033 756100                    STQ     NAME_LENGTH,,AUTO

      815     7232    2           CALL X8ER$ERROR (%IO_INVALID_LINAGE, DCB$-> M$XX.DCBNAME.N,

   7232  1 000034   200033 635500                    EPPR5   NAME_LENGTH,,AUTO
         1 000035   200036 455500                    STP5    NAME_LENGTH+3,,AUTO
         1 000036   200030 236100                    LDQ     DCB$,,AUTO
         1 000037   000003 036000 2                  ADLQ    3
         1 000040   000004 235000 2                  LDA     4
         1 000041   200034 757100                    STAQ    NAME_LENGTH+1,,AUTO
         1 000042   200034 630500                    EPPR0   NAME_LENGTH+1,,AUTO
         1 000043   000000 631400 2                  EPPR1   0
         1 000044   000000 701000 xent               TSX1    X8ER$ERROR
         1 000045   000000 011000                    NOP     0

      816     7233    2                            NAME_LENGTH);
      817     7234    2         END;

      818     7235    1       IF FAB.FOOTING$ ~= ADDR(NIL) THEN

   7235  1 000046   200003 470500                    LDP0    @FAB,,AUTO
         1 000047   000046 236100                    LDQ     38,,PR0
         1 000050   000005 116000 2                  CMPQ    5
         1 000051   000121 600000 1                  TZE     s:7248

      819     7236    2         DO;

      820     7237    2           CALL X8CV$CONVERT_TO_INTEGER (FAB.FOOTING$, FAB.FOOTING_DESC, FAB.FOOTING);

   7237  1 000052   200003 236100                    LDQ     @FAB,,AUTO
         1 000053   000022 036003                    ADLQ    18,DU
         1 000054   200036 756100                    STQ     NAME_LENGTH+3,,AUTO
         1 000055   200003 236100                    LDQ     @FAB,,AUTO
         1 000056   000016 036003                    ADLQ    14,DU
         1 000057   200035 756100                    STQ     NAME_LENGTH+2,,AUTO
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:138  
         1 000060   200003 236100                    LDQ     @FAB,,AUTO
         1 000061   000046 036003                    ADLQ    38,DU
         1 000062   200034 756100                    STQ     NAME_LENGTH+1,,AUTO
         1 000063   200034 630500                    EPPR0   NAME_LENGTH+1,,AUTO
         1 000064   000000 631400 2                  EPPR1   0
         1 000065   000000 701000 xent               TSX1    X8CV$CONVERT_TO_INTEGER
         1 000066   000000 011000                    NOP     0

      821     7238    2           IF FAB.FOOTING = 0

   7238  1 000067   200003 470500                    LDP0    @FAB,,AUTO
         1 000070   000022 235100                    LDA     18,,PR0
         1 000071   000075 600000 1                  TZE     s:7241
         1 000072   000021 236100                    LDQ     17,,PR0
         1 000073   000022 116100                    CMPQ    18,,PR0
         1 000074   000121 603000 1                  TRC     s:7248

      822     7239    2           OR FAB.FOOTING > FAB.LINAGE THEN
      823     7240    3             DO;

      824     7241    3               DCB$ = DCBADDR (FAB.DCB_NUM);

   7241  1 000075   000001 471400 2                  LDP1    1
         1 000076   100000 473500                    LDP3    0,,PR1
         1 000077   000034 220100                    LDX0    28,,PR0
         1 000100   300000 236110                    LDQ     0,X0,PR3
         1 000101   200030 756100                    STQ     DCB$,,AUTO

      825     7242    3               NAME_LENGTH = DCB$-> M$XX.DCBNAME.L;

   7242  1 000102   200030 474500                    LDP4    DCB$,,AUTO
         1 000103   400140 236100                    LDQ     96,,PR4
         1 000104   000033 772000                    QRL     27
         1 000105   000037 376007                    ANQ     31,DL
         1 000106   200033 756100                    STQ     NAME_LENGTH,,AUTO

      826     7243    3               CALL X8ER$ERROR  (%IO_INVALID_FOOTING, DCB$-> M$XX.DCBNAME.N,
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:139  

   7243  1 000107   200033 635500                    EPPR5   NAME_LENGTH,,AUTO
         1 000110   200036 455500                    STP5    NAME_LENGTH+3,,AUTO
         1 000111   200030 236100                    LDQ     DCB$,,AUTO
         1 000112   000003 036000 2                  ADLQ    3
         1 000113   000007 235000 2                  LDA     7
         1 000114   200034 757100                    STAQ    NAME_LENGTH+1,,AUTO
         1 000115   200034 630500                    EPPR0   NAME_LENGTH+1,,AUTO
         1 000116   000000 631400 2                  EPPR1   0
         1 000117   000000 701000 xent               TSX1    X8ER$ERROR
         1 000120   000000 011000                    NOP     0

      827     7244    3                                 NAME_LENGTH);
      828     7245    3             END;

      829     7246    2         END;

      830     7247
      831     7248    1       IF FAB.TOP$ ~= ADDR(NIL) THEN

   7248  1 000121   200003 470500                    LDP0    @FAB,,AUTO
         1 000122   000047 236100                    LDQ     39,,PR0
         1 000123   000005 116000 2                  CMPQ    5
         1 000124   000142 600000 1                  TZE     s:7251

      832     7249    1         CALL X8CV$CONVERT_TO_INTEGER (FAB.TOP$, FAB.TOP_DESC, FAB.TOP);

   7249  1 000125   200003 236100                    LDQ     @FAB,,AUTO
         1 000126   000023 036003                    ADLQ    19,DU
         1 000127   200036 756100                    STQ     NAME_LENGTH+3,,AUTO
         1 000130   200003 236100                    LDQ     @FAB,,AUTO
         1 000131   000017 036003                    ADLQ    15,DU
         1 000132   200035 756100                    STQ     NAME_LENGTH+2,,AUTO
         1 000133   200003 236100                    LDQ     @FAB,,AUTO
         1 000134   000047 036003                    ADLQ    39,DU
         1 000135   200034 756100                    STQ     NAME_LENGTH+1,,AUTO
         1 000136   200034 630500                    EPPR0   NAME_LENGTH+1,,AUTO
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:140  
         1 000137   000000 631400 2                  EPPR1   0
         1 000140   000000 701000 xent               TSX1    X8CV$CONVERT_TO_INTEGER
         1 000141   000000 011000                    NOP     0

      833     7250
      834     7251    1       IF FAB.BOTTOM$ ~= ADDR(NIL) THEN

   7251  1 000142   200003 470500                    LDP0    @FAB,,AUTO
         1 000143   000050 236100                    LDQ     40,,PR0
         1 000144   000005 116000 2                  CMPQ    5
         1 000145   000163 600000 1                  TZE     s:7254

      835     7252    1         CALL X8CV$CONVERT_TO_INTEGER (FAB.BOTTOM$, FAB.BOTTOM_DESC, FAB.BOTTOM);

   7252  1 000146   200003 236100                    LDQ     @FAB,,AUTO
         1 000147   000024 036003                    ADLQ    20,DU
         1 000150   200036 756100                    STQ     NAME_LENGTH+3,,AUTO
         1 000151   200003 236100                    LDQ     @FAB,,AUTO
         1 000152   000020 036003                    ADLQ    16,DU
         1 000153   200035 756100                    STQ     NAME_LENGTH+2,,AUTO
         1 000154   200003 236100                    LDQ     @FAB,,AUTO
         1 000155   000050 036003                    ADLQ    40,DU
         1 000156   200034 756100                    STQ     NAME_LENGTH+1,,AUTO
         1 000157   200034 630500                    EPPR0   NAME_LENGTH+1,,AUTO
         1 000160   000000 631400 2                  EPPR1   0
         1 000161   000000 701000 xent               TSX1    X8CV$CONVERT_TO_INTEGER
         1 000162   000000 011000                    NOP     0

      836     7253
      837     7254    1   END X9WO$CONVERT_LINAGE;  /*  proc  */

   7254  1 000163   000000 702200 xent               TSX2  ! X66_ARET
      838     7255        %EJECT;
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:141  

PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:142  
--  Include file information  --

   X9A_LIB_IO.:X8A6TOU  cannot be made into a system file and is referenced.
   X8A_ERRCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   X9A_IO.:X8A6TOU  is referenced.
   XS_MACRO_C.:LIBRARY  is referenced.
   X9A_FAB.:X8A6TOU  is referenced.
   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   X8A_SYS_FILE.:X8A6TOU  is referenced.
      No diagnostics issued in procedure X9WO$CONVERT_LINAGE.
PL6.E3A0      #002=X9WO$CONVERT_LINAGE File=X9WO.:X8A6TSI                        SAT 08/09/97 11:12 Page:143  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FAB                      30-0-0/w PTR         r     1 DCB$
    *0-0-0/d STRC(2232)  r     1 FAB                       33-0-0/w SBIN        r     1 NAME_LENGTH
     4-0-0/c CHAR(80)          1 SPECIAL_ERR_MSG           31-0-0/w PTR         r     1 USE$$
    32-0-0/w EPTR        r     1 USE_ENTRY$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$TCB$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)        1 B$ALT                      0-0-0/w STRC(144)         1 B$TCB
     0-0-0N  NULL        r     1 M$UC                       0-0-0/d ASTR(3528)  r     1 M$XX
     0-0-0/w STRC(864)         1 USE_PROC


   Procedure X9WO$CONVERT_LINAGE requires 116 words for executable code.
   Procedure X9WO$CONVERT_LINAGE requires 32 words of local(AUTO) storage.

    No errors detected in file X9WO.:X8A6TSI    .
