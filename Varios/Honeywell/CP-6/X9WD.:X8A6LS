VERSION A06

PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:1    
        1        1        /*M* X9WD$DELETE -- Runtime support for the DELETE statment.        */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*
        8        8                NAME:  X9WD$DELETE
        9        9
       10       10             PURPOSE:  Provide runtime support for the DELETE statment.
       11       11
       12       12        */
       13       13        /*D*
       14       14                NAME:  X9WD$DELETE
       15       15
       16       16             PURPOSE:  Provide runtime support for the DELETE statment.
       17       17
       18       18           PARAMETER:  FAB     -- File Attribute Block
       19       19                       ALT_RET -- Altreturn bit for invalid key conditions
       20       20
       21       21         DESCRIPTION:  The module will support the deletion of records
       22       22                       in files with sequential or random access.  For files
       23       23                       with sequential access,  the last IO statment executed
       24       24                       must have been a READ or READ NEXT with successful
       25       25                       completion.  If these conditions are met, then the
       26       26                       current record (the one just read) is deleted.  For
       27       27                       files with random or dynamic access,  the record
       28       28                       deleted will be the one pointed at by the key value
       29       29                       specified in the FAB.  In addition, files with dynamic
       30       30                       access will lose the file position after the delete,
       31       31                       therefore, the current key is saved and a reposition
       32       32                       is executed following the delete of a record.
       33       33        */
       34       34        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:2    
       35       35        /*-----------*/
       36       36          X9WD$DELETE:         PROC (FAB, ALT_RET)   ALTRET;
       37       37        /*-----------*/
       38       38
       39       39            %INCLUDE X8A_SYS_FILE;
       40     6309            %INCLUDE X8A_LIBCOM;
       41     6529            %INCLUDE X8A_ERRCOM;
       42     6618            %INCLUDE X8A_MACROS;
       43     6875            %INCLUDE X9A_FAB;
       44     7062            %INCLUDE X9A_IO;
       45     7212            %INCLUDE X9A_LIB_IO;
       46     7596            %DCL_FAB;
       47     7718            %DCL_SHARED (@STCLASS = "BASED (FAB.SHARED$)");         /*#32658*/
       48     7727
       49     7728    1       DCL KEY            UBIN WORD;
       50     7729    1       DCL ALT_RET        BIT (1) ALIGNED;
       51     7730    1       DCL IO_STATUS      CHAR (2) BASED (FAB.IO_STATUS$);
       52     7731    1       DCL RELATIVE_KEY   UBIN WORD;
       53     7732    1       DCL INDEX_KEY$     PTR;
       54     7733    1       DCL INDEX_KEY      BASED CHAR (FAB.RECORD_KEY_LEN);
       55     7734    1       DCL 1 KEYED_KEY    ALIGNED,
       56     7735    1            2 LENGTH      UBIN (9)   UNAL,
       57     7736    1            2 TEXT        CHAR (255) UNAL;
       58     7737    1       DCL KEY_TEXT       CHAR (KEYED_KEY.LENGTH) BASED (FAB.RECORD_KEY$) UNAL;
       59     7738            %VLP_ALTKEYS        (FPTN=ALT_KEYS, STCLASS="BASED (FAB.ALT_KEY$)");
       60     7753            %FPT_DELREC         (FPTN=DELETE);
       61     7772    1       DCL X9WS$REPOS               ENTRY (3);
       62     7773    1       DCL X9WE$IO_ERROR            ENTRY (2)  ALTRET;
       63     7774    1       DCL X9WE$IO_ERROR_STATUS     ENTRY (2)  ALTRET;
       64     7775    1       DCL X8ER$ERROR               ENTRY (3);
       65     7776    1       DCL X8CV$CONVERT_TO_INTEGER  ENTRY (3) ALTRET;
       66     7777
       67     7778        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:3    
       68     7779    2       DO CASE  (FAB.FILE_STATUS);
       69     7780
       70     7781    2         CASE (%FILE_LOCKED, %FILE_CLOSED, %FILE_NEVER_OPEN,
       71     7782    2               %FILE_NOT_PRESENT);
       72     7783
       73     7784    2           IO_STATUS = %NOT_OPEN_IO;
       74     7785    2           CALL X9WE$IO_ERROR_STATUS (FAB);
       75     7786
       76     7787
       77     7788    2         CASE (%FILE_OPEN);
       78     7789    2           DCB$ = DCBADDR (FAB.DCB_NUM);
       79     7790    2           IF  M$XX.FUN# = %UPDATE THEN
       80     7791    3             DO CASE (FAB.ACS#);
       81     7792
       82     7793    3               CASE (%FAB_SEQUENTIAL_ACCESS);
       83     7794
       84     7795    3                 IF  FAB.LAST_IO = %READ_RANDOM
       85     7796    3                 OR  FAB.LAST_IO = %READ_NEXT
       86     7797    3                 AND SUBSTR (IO_STATUS,0,1) = '0' THEN
       87     7798    4                   DO;
       88     7799    4                     FAB.LAST_IO = %DELETE;
       89     7800    4                     DELETE.V.DCB# = FAB.DCB_NUM;
       90     7801    4                     CALL M$DELREC  (DELETE);
       91     7802    4                     IO_STATUS = %SUCCESSFUL;
       92     7803    4                   END;
       93     7804    3                 ELSE
       94     7805    4                   DO;
       95     7806    4                     IO_STATUS = %PRIOR_NOT_READ;
       96     7807    4                     CALL X9WE$IO_ERROR_STATUS (FAB);
       97     7808    4                     RETURN;
       98     7809    4                   END;
       99     7810        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:4    
      100     7811    3               CASE (%FAB_DYNAMIC_ACCESS, %FAB_RANDOM_ACCESS);
      101     7812    3                 FAB.LAST_IO = %DELETE;
      102     7813    3                 DELETE.V.DCB# = FAB.DCB_NUM;
      103     7814
      104     7815    4                 DO CASE (FAB.ORG#);
      105     7816
      106     7817    4                   CASE (%CP6_RELATIVE);
      107     7818    4                     CALL X8CV$CONVERT_TO_INTEGER (FAB.RELATIVE_KEY$,
      108     7819    4                          FAB.RELATIVE_DESC, RELATIVE_KEY);
      109     7820    4                     DELETE.KEY_ = VECTOR  (RELATIVE_KEY);
      110     7821
      111     7822    4                   CASE (%CP6_INDEXED);
      112     7823    4                     DELETE.KEY_ = VECTOR (FAB.RECORD_KEY$-> INDEX_KEY);
      113     7824    4                     DELETE.V.INDX# = %PRIMARY_KEY;
      114     7825
      115     7826    4                   CASE (%CP6_KEYED);
      116     7827    4                     KEYED_KEY.LENGTH = FAB.RECORD_KEY_LEN;
      117     7828    4                     KEYED_KEY.TEXT   = KEY_TEXT;
      118     7829    4                     DELETE.KEY_ = VECTOR (KEYED_KEY);
      119     7830    4                 END; /* case fab.org# */
      120     7831
      121     7832    3                 IF FAB.B.SHARED_INDEX_ALT THEN                /*#32658*/
      122     7833    3                   SHARED.RECNUM = SHARED.RECNUM - 1;
      123     7834    3                 ELSE
      124     7835                        %SAVE_POSITION (@N# = 0); /* save current position */
      125     7843        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:5    
      126     7844    3                 CALL M$DELREC (DELETE)
      127     7845    3                   WHENRETURN
      128     7846    4                     DO;
      129     7847    4                       IF FAB.B.SHARED_INDEX_ALT THEN          /*#32658*/
      130     7848    4                         SHARED.RECNUM = SHARED.RECNUM - 1;
      131     7849    4                       ELSE
      132     7850                              %REPOSITION (@N# = 0);  /* to saved position */
      133     7858    4                     END;
      134     7859    3                   WHENALTRETURN
      135     7860    4                     DO;
      136     7861    4                       CALL X9WE$IO_ERROR (FAB, ALT_RET)
      137     7862    4                         WHENALTRETURN
      138     7863    5                           DO;
      139     7864    5                             ALTRETURN;          /* Invalid key condition */
      140     7865    5                           END;
      141     7866    4                     END;
      142     7867    3               CASE (ELSE);
      143     7868    3                 CALL X8ER$ERROR (%UNEXPECTED_CASE);
      144     7869
      145     7870    3             END;  /* case fab.acs# */
      146     7871    2           ELSE
      147     7872    3             DO;
      148     7873    3               IO_STATUS = %NOT_OPEN_IO;
      149     7874    3               CALL X9WE$IO_ERROR_STATUS (FAB);
      150     7875    3             END;
      151     7876    2           END; /* case fab.file_status */
      152     7877
      153     7878    1   END X9WD$DELETE;  /* proc */
      154     7879        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:6    

PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:7    
--  Include file information  --

   X9A_LIB_IO.:X8A6TOU  cannot be made into a system file and is referenced.
   X9A_IO.:X8A6TOU  is referenced.
   XS_MACRO_C.:LIBRARY  is referenced.
   X9A_FAB.:X8A6TOU  is referenced.
   X8A_COM_MACS.:X8A6TOU  is referenced.
   X8A_MACROS.:X8A6TOU  is referenced.
   X8A_ERRCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   X8A_LIBCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   X8A_SYS_FILE.:X8A6TOU  is referenced.
      No diagnostics issued in procedure X9WD$DELETE.

   Procedure X9WD$DELETE requires 229 words for executable code.
   Procedure X9WD$DELETE requires 136 words of local(AUTO) storage.

    No errors detected in file X9WD.:X8A6TSI    .

PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:8    

 Object Unit name= X9WD$DELETE                                File name= X9WD.:X8A6TOU
 UTS= AUG 09 '97 11:05:49.32 SAT                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  LblCom even  none    20     24  LIBCOM
    2  LblCom even  none     1      1  DEC_OR_COMMA
    3  LblCom even  none    20     24  IN_TEMP
    4  LblCom even  none     1      1  OVRCHR
    5  LblCom even  none     1      1  SELECT_TIME
    6  LblCom even  none     1      1  NO_ADVANCE_OFFSET
    7  LblCom even  none    18     22  DSPLY_SAVE
    8  LblCom even  none     3      3  D_DATE
    9  LblCom even  none     3      3  D_TIME
   10  LblCom even  none     1      1  D_DAY
   11  LblCom even  none     2      2  C_DATE
   12  LblCom even  none     2      2  C_TIME
   13  LblCom even  none     2      2  C_DAY
   14  LblCom even  none     1      1  RTHOLD2
   15  LblCom even  none     1      1  LTHOLD2
   16  LblCom even  none     1      1  NDX2
   17  LblCom even  none     1      1  IN_LEN
   18   Data  even  none    10     12  X9WD$DELETE
   19  RoData even  UTS      3      3  X9WD$DELETE
   20   Proc  even  none   229    345  X9WD$DELETE
   21  RoData even  none    12     14  X9WD$DELETE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    20      0   yes    yes     yes      Std        2  X9WD$DELETE
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:9    

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 X9WE$IO_ERROR_STATUS
 yes     yes           Std       3 X8CV$CONVERT_TO_INTEGER
 yes     yes           Std       2 X9WE$IO_ERROR
         yes           Std       3 X9WS$REPOS
         yes           Std       3 X8ER$ERROR
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$TCB$

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:10   


        1        1        /*M* X9WD$DELETE -- Runtime support for the DELETE statment.        */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*
        8        8                NAME:  X9WD$DELETE
        9        9
       10       10             PURPOSE:  Provide runtime support for the DELETE statment.
       11       11
       12       12        */
       13       13        /*D*
       14       14                NAME:  X9WD$DELETE
       15       15
       16       16             PURPOSE:  Provide runtime support for the DELETE statment.
       17       17
       18       18           PARAMETER:  FAB     -- File Attribute Block
       19       19                       ALT_RET -- Altreturn bit for invalid key conditions
       20       20
       21       21         DESCRIPTION:  The module will support the deletion of records
       22       22                       in files with sequential or random access.  For files
       23       23                       with sequential access,  the last IO statment executed
       24       24                       must have been a READ or READ NEXT with successful
       25       25                       completion.  If these conditions are met, then the
       26       26                       current record (the one just read) is deleted.  For
       27       27                       files with random or dynamic access,  the record
       28       28                       deleted will be the one pointed at by the key value
       29       29                       specified in the FAB.  In addition, files with dynamic
       30       30                       access will lose the file position after the delete,
       31       31                       therefore, the current key is saved and a reposition
       32       32                       is executed following the delete of a record.
       33       33        */
       34       34        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:11   
       35       35        /*-----------*/
       36       36          X9WD$DELETE:         PROC (FAB, ALT_RET)   ALTRET;

     36 20 000000   000000 700200 xent  X9WD$DELETE  TSX0  ! X66_AUTO_2
        20 000001   000210 000002                    ZERO    136,2

       37       37        /*-----------*/
       38       38
       39       39            %INCLUDE X8A_SYS_FILE;
       40     6309            %INCLUDE X8A_LIBCOM;
       41     6529            %INCLUDE X8A_ERRCOM;
       42     6618            %INCLUDE X8A_MACROS;
       43     6875            %INCLUDE X9A_FAB;
       44     7062            %INCLUDE X9A_IO;
       45     7212            %INCLUDE X9A_LIB_IO;
       46     7596            %DCL_FAB;
       47     7718            %DCL_SHARED (@STCLASS = "BASED (FAB.SHARED$)");         /*#32658*/
       48     7727
       49     7728    1       DCL KEY            UBIN WORD;
       50     7729    1       DCL ALT_RET        BIT (1) ALIGNED;
       51     7730    1       DCL IO_STATUS      CHAR (2) BASED (FAB.IO_STATUS$);
       52     7731    1       DCL RELATIVE_KEY   UBIN WORD;
       53     7732    1       DCL INDEX_KEY$     PTR;
       54     7733    1       DCL INDEX_KEY      BASED CHAR (FAB.RECORD_KEY_LEN);
       55     7734    1       DCL 1 KEYED_KEY    ALIGNED,
       56     7735    1            2 LENGTH      UBIN (9)   UNAL,
       57     7736    1            2 TEXT        CHAR (255) UNAL;
       58     7737    1       DCL KEY_TEXT       CHAR (KEYED_KEY.LENGTH) BASED (FAB.RECORD_KEY$) UNAL;
       59     7738            %VLP_ALTKEYS        (FPTN=ALT_KEYS, STCLASS="BASED (FAB.ALT_KEY$)");
       60     7753            %FPT_DELREC         (FPTN=DELETE);
       61     7772    1       DCL X9WS$REPOS               ENTRY (3);
       62     7773    1       DCL X9WE$IO_ERROR            ENTRY (2)  ALTRET;
       63     7774    1       DCL X9WE$IO_ERROR_STATUS     ENTRY (2)  ALTRET;
       64     7775    1       DCL X8ER$ERROR               ENTRY (3);
       65     7776    1       DCL X8CV$CONVERT_TO_INTEGER  ENTRY (3) ALTRET;
       66     7777
       67     7778        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:12   
       68     7779    2       DO CASE  (FAB.FILE_STATUS);

   7779 20 000002   200003 470500                    LDP0    @FAB,,AUTO
        20 000003   000026 235100                    LDA     22,,PR0
        20 000004   000006 115007                    CMPA    6,DL
        20 000005   000007 602005 20                 TNC     s:7779+5,AL
        20 000006   000344 710000 20                 TRA     s:7878
        20 000007   000015 710000 20                 TRA     s:7784
        20 000010   000015 710000 20                 TRA     s:7784
        20 000011   000026 710000 20                 TRA     s:7789
        20 000012   000015 710000 20                 TRA     s:7784
        20 000013   000344 710000 20                 TRA     s:7878
        20 000014   000015 710000 20                 TRA     s:7784

       69     7780
       70     7781    2         CASE (%FILE_LOCKED, %FILE_CLOSED, %FILE_NEVER_OPEN,

       71     7782    2               %FILE_NOT_PRESENT);
       72     7783
       73     7784    2           IO_STATUS = %NOT_OPEN_IO;

   7784 20 000015   000036 471500                    LDP1    30,,PR0
        20 000016   040100 100400                    MLR     fill='040'O
        20 000017   000000 000002 19                 ADSC9   0                        cn=0,n=2
        20 000020   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

       74     7785    2           CALL X9WE$IO_ERROR_STATUS (FAB);

   7785 20 000021   200003 630500                    EPPR0   @FAB,,AUTO
        20 000022   000000 631400 21                 EPPR1   0
        20 000023   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 000024   000000 011000                    NOP     0
        20 000025   000344 710000 20                 TRA     s:7878

       75     7786
       76     7787
       77     7788    2         CASE (%FILE_OPEN);
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:13   

       78     7789    2           DCB$ = DCBADDR (FAB.DCB_NUM);

   7789 20 000026   000001 471400 21                 LDP1    1
        20 000027   100000 473500                    LDP3    0,,PR1
        20 000030   000034 220100                    LDX0    28,,PR0
        20 000031   300000 236110                    LDQ     0,X0,PR3
        20 000032   200076 756100                    STQ     DCB$,,AUTO

       79     7790    2           IF  M$XX.FUN# = %UPDATE THEN

   7790 20 000033   200076 474500                    LDP4    DCB$,,AUTO
        20 000034   400032 236100                    LDQ     26,,PR4
        20 000035   000777 376003                    ANQ     511,DU
        20 000036   000001 116003                    CMPQ    1,DU
        20 000037   000334 601000 20                 TNZ     s:7873

       80     7791    3             DO CASE (FAB.ACS#);

   7791 20 000040   000004 235100                    LDA     4,,PR0
        20 000041   000004 115007                    CMPA    4,DL
        20 000042   000044 602005 20                 TNC     s:7791+4,AL
        20 000043   000327 710000 20                 TRA     s:7868
        20 000044   000327 710000 20                 TRA     s:7868
        20 000045   000050 710000 20                 TRA     s:7795
        20 000046   000106 710000 20                 TRA     s:7812
        20 000047   000106 710000 20                 TRA     s:7812

       81     7792
       82     7793    3               CASE (%FAB_SEQUENTIAL_ACCESS);

       83     7794
       84     7795    3                 IF  FAB.LAST_IO = %READ_RANDOM

   7795 20 000050   000025 235100                    LDA     21,,PR0
        20 000051   000061 600000 20                 TZE     s:7799
        20 000052   000007 115007                    CMPA    7,DL
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:14   
        20 000053   000075 601000 20                 TNZ     s:7806
        20 000054   000036 475500                    LDP5    30,,PR0
        20 000055   040000 106500                    CMPC    fill='040'O
        20 000056   500000 000001                    ADSC9   0,,PR5                   cn=0,n=1
        20 000057   000002 000001 21                 ADSC9   2                        cn=0,n=1
        20 000060   000075 601000 20                 TNZ     s:7806

       85     7796    3                 OR  FAB.LAST_IO = %READ_NEXT
       86     7797    3                 AND SUBSTR (IO_STATUS,0,1) = '0' THEN
       87     7798    4                   DO;

       88     7799    4                     FAB.LAST_IO = %DELETE;

   7799 20 000061   000006 235007                    LDA     6,DL
        20 000062   000025 755100                    STA     21,,PR0

       89     7800    4                     DELETE.V.DCB# = FAB.DCB_NUM;

   7800 20 000063   000010 740000 18                 STX0    DELETE+8

       90     7801    4                     CALL M$DELREC  (DELETE);

   7801 20 000064   000000 630400 18                 EPPR0   DELETE
        20 000065   040002 713400                    CLIMB   16386
        20 000066   401400 401760                    pmme    nvectors=4

       91     7802    4                     IO_STATUS = %SUCCESSFUL;

   7802 20 000067   200003 470500                    LDP0    @FAB,,AUTO
        20 000070   000036 471500                    LDP1    30,,PR0
        20 000071   040100 100400                    MLR     fill='040'O
        20 000072   000001 000002 19                 ADSC9   1                        cn=0,n=2
        20 000073   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

       92     7803    4                   END;

   7803 20 000074   000344 710000 20                 TRA     s:7878
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:15   

       93     7804    3                 ELSE
       94     7805    4                   DO;

       95     7806    4                     IO_STATUS = %PRIOR_NOT_READ;

   7806 20 000075   000036 475500                    LDP5    30,,PR0
        20 000076   040100 100400                    MLR     fill='040'O
        20 000077   000002 000002 19                 ADSC9   2                        cn=0,n=2
        20 000100   500000 000002                    ADSC9   0,,PR5                   cn=0,n=2

       96     7807    4                     CALL X9WE$IO_ERROR_STATUS (FAB);

   7807 20 000101   200003 630500                    EPPR0   @FAB,,AUTO
        20 000102   000000 631400 21                 EPPR1   0
        20 000103   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 000104   000000 011000                    NOP     0

       97     7808    4                     RETURN;

   7808 20 000105   000000 702200 xent               TSX2  ! X66_ARET

       98     7809    4                   END;
       99     7810        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:16   
      100     7811    3               CASE (%FAB_DYNAMIC_ACCESS, %FAB_RANDOM_ACCESS);

      101     7812    3                 FAB.LAST_IO = %DELETE;

   7812 20 000106   000006 235007                    LDA     6,DL
        20 000107   000025 755100                    STA     21,,PR0

      102     7813    3                 DELETE.V.DCB# = FAB.DCB_NUM;

   7813 20 000110   000010 740000 18                 STX0    DELETE+8

      103     7814
      104     7815    4                 DO CASE (FAB.ORG#);

   7815 20 000111   000002 235100                    LDA     2,,PR0
        20 000112   000007 115007                    CMPA    7,DL
        20 000113   000115 602005 20                 TNC     s:7815+4,AL
        20 000114   000201 710000 20                 TRA     s:7832
        20 000115   000201 710000 20                 TRA     s:7832
        20 000116   000201 710000 20                 TRA     s:7832
        20 000117   000162 710000 20                 TRA     s:7827
        20 000120   000201 710000 20                 TRA     s:7832
        20 000121   000201 710000 20                 TRA     s:7832
        20 000122   000124 710000 20                 TRA     s:7818
        20 000123   000146 710000 20                 TRA     s:7823

      105     7816
      106     7817    4                   CASE (%CP6_RELATIVE);

      107     7818    4                     CALL X8CV$CONVERT_TO_INTEGER (FAB.RELATIVE_KEY$,

   7818 20 000124   200102 635500                    EPPR5   RELATIVE_KEY,,AUTO
        20 000125   200206 455500                    STP5    KEYED_KEY+66,,AUTO
        20 000126   200003 236100                    LDQ     @FAB,,AUTO
        20 000127   000030 036003                    ADLQ    24,DU
        20 000130   200205 756100                    STQ     KEYED_KEY+65,,AUTO
        20 000131   200003 236100                    LDQ     @FAB,,AUTO
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:17   
        20 000132   000053 036003                    ADLQ    43,DU
        20 000133   200204 756100                    STQ     KEYED_KEY+64,,AUTO
        20 000134   200204 630500                    EPPR0   KEYED_KEY+64,,AUTO
        20 000135   000003 631400 21                 EPPR1   3
        20 000136   000000 701000 xent               TSX1    X8CV$CONVERT_TO_INTEGER
        20 000137   000000 011000                    NOP     0

      108     7819    4                          FAB.RELATIVE_DESC, RELATIVE_KEY);
      109     7820    4                     DELETE.KEY_ = VECTOR  (RELATIVE_KEY);

   7820 20 000140   777640 235007                    LDA     -96,DL
        20 000141   200204 452500                    STP2    KEYED_KEY+64,,AUTO
        20 000142   200204 236100                    LDQ     KEYED_KEY+64,,AUTO
        20 000143   000102 036003                    ADLQ    66,DU
        20 000144   000002 757000 18                 STAQ    DELETE+2
        20 000145   000201 710000 20                 TRA     s:7832

      110     7821
      111     7822    4                   CASE (%CP6_INDEXED);

      112     7823    4                     DELETE.KEY_ = VECTOR (FAB.RECORD_KEY$-> INDEX_KEY);

   7823 20 000146   000054 475500                    LDP5    44,,PR0
        20 000147   000031 721100                    LXL1    25,,PR0
        20 000150   000000 636011                    EAQ     0,X1
        20 000151   000022 732000                    QRS     18
        20 000152   000064 737000                    LLS     52
        20 000153   000140 135007                    SBLA    96,DL
        20 000154   200204 455500                    STP5    KEYED_KEY+64,,AUTO
        20 000155   200204 236100                    LDQ     KEYED_KEY+64,,AUTO
        20 000156   000002 757000 18                 STAQ    DELETE+2

      113     7824    4                     DELETE.V.INDX# = %PRIMARY_KEY;

   7824 20 000157   000001 236007                    LDQ     1,DL
        20 000160   000010 552004 18                 STBQ    DELETE+8,'04'O
        20 000161   000201 710000 20                 TRA     s:7832
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:18   

      114     7825
      115     7826    4                   CASE (%CP6_KEYED);

      116     7827    4                     KEYED_KEY.LENGTH = FAB.RECORD_KEY_LEN;

   7827 20 000162   000031 236100                    LDQ     25,,PR0
        20 000163   000033 736000                    QLS     27
        20 000164   200104 552140                    STBQ    KEYED_KEY,'40'O,AUTO

      117     7828    4                     KEYED_KEY.TEXT   = KEY_TEXT;

   7828 20 000165   000054 475500                    LDP5    44,,PR0
        20 000166   200104 236100                    LDQ     KEYED_KEY,,AUTO
        20 000167   000033 772000                    QRL     27
        20 000170   000000 621006                    EAX1    0,QL
        20 000171   040100 100540                    MLR     fill='040'O
        20 000172   500000 000011                    ADSC9   0,,PR5                   cn=0,n=*X1
        20 000173   200104 200377                    ADSC9   KEYED_KEY,,AUTO          cn=1,n=255

      118     7829    4                     DELETE.KEY_ = VECTOR (KEYED_KEY);

   7829 20 000174   000004 235000 21                 LDA     4
        20 000175   200204 452500                    STP2    KEYED_KEY+64,,AUTO
        20 000176   200204 236100                    LDQ     KEYED_KEY+64,,AUTO
        20 000177   000104 036003                    ADLQ    68,DU
        20 000200   000002 757000 18                 STAQ    DELETE+2

      119     7830    4                 END; /* case fab.org# */

      120     7831
      121     7832    3                 IF FAB.B.SHARED_INDEX_ALT THEN                /*#32658*/

   7832 20 000201   200003 470500                    LDP0    @FAB,,AUTO
        20 000202   000032 236100                    LDQ     26,,PR0
        20 000203   100000 316007                    CANQ    32768,DL
        20 000204   000212 600000 20                 TZE     s:7836
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:19   

      122     7833    3                   SHARED.RECNUM = SHARED.RECNUM - 1;

   7833 20 000205   000037 471500                    LDP1    31,,PR0
        20 000206   100002 235100                    LDA     2,,PR1
        20 000207   000001 135007                    SBLA    1,DL
        20 000210   100002 755100                    STA     2,,PR1
        20 000211   000245 710000 20                 TRA     s:7844

      123     7834    3                 ELSE
      124     7835                        %SAVE_POSITION (@N# = 0); /* save current position */

   7836 20 000212   000004 235100                    LDA     4,,PR0
        20 000213   000002 115007                    CMPA    2,DL
        20 000214   000245 601000 20                 TNZ     s:7844
        20 000215   200076 471500                    LDP1    DCB$,,AUTO
        20 000216   100032 236100                    LDQ     26,,PR1
        20 000217   000777 376003                    ANQ     511,DU
        20 000220   000001 116003                    CMPQ    1,DU
        20 000221   000245 601000 20                 TNZ     s:7844

   7838 20 000222   000000 234000 1                  SZN     LIBCOM
        20 000223   000235 605000 20                 TPL     s:7841

   7839 20 000224   000006 236000 21                 LDQ     6
        20 000225   200206 756100                    STQ     KEYED_KEY+66,,AUTO
        20 000226   200003 235100                    LDA     @FAB,,AUTO
        20 000227   200204 757100                    STAQ    KEYED_KEY+64,,AUTO
        20 000230   200204 630500                    EPPR0   KEYED_KEY+64,,AUTO
        20 000231   000003 631400 21                 EPPR1   3
        20 000232   000000 701000 xent               TSX1    X9WS$REPOS
        20 000233   000000 011000                    NOP     0
        20 000234   000245 710000 20                 TRA     s:7844

   7841 20 000235   000006 236000 21                 LDQ     6
        20 000236   200206 756100                    STQ     KEYED_KEY+66,,AUTO
        20 000237   200003 235100                    LDA     @FAB,,AUTO
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:20   
        20 000240   200204 757100                    STAQ    KEYED_KEY+64,,AUTO
        20 000241   200204 630500                    EPPR0   KEYED_KEY+64,,AUTO
        20 000242   000003 631400 21                 EPPR1   3
        20 000243   000000 701000 xent               TSX1    X9WS$REPOS
        20 000244   000000 011000                    NOP     0

      125     7843        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:21   
      126     7844    3                 CALL M$DELREC (DELETE)

   7844 20 000245   000000 630400 18                 EPPR0   DELETE
        20 000246   440002 713400                    CLIMB   alt,+16386
        20 000247   401400 401760                    pmme    nvectors=4
        20 000250   000320 702000 20                 TSX2    s:7861

      127     7845    3                   WHENRETURN
      128     7846    4                     DO;

      129     7847    4                       IF FAB.B.SHARED_INDEX_ALT THEN          /*#32658*/

   7847 20 000251   200003 470500                    LDP0    @FAB,,AUTO
        20 000252   000032 236100                    LDQ     26,,PR0
        20 000253   100000 316007                    CANQ    32768,DL
        20 000254   000262 600000 20                 TZE     s:7851

      130     7848    4                         SHARED.RECNUM = SHARED.RECNUM - 1;

   7848 20 000255   000037 471500                    LDP1    31,,PR0
        20 000256   100002 235100                    LDA     2,,PR1
        20 000257   000001 135007                    SBLA    1,DL
        20 000260   100002 755100                    STA     2,,PR1
        20 000261   000317 710000 20                 TRA     s:7858

      131     7849    4                       ELSE
      132     7850                              %REPOSITION (@N# = 0);  /* to saved position */

   7851 20 000262   000004 235100                    LDA     4,,PR0
        20 000263   000002 115007                    CMPA    2,DL
        20 000264   000317 601000 20                 TNZ     s:7858
        20 000265   200076 471500                    LDP1    DCB$,,AUTO
        20 000266   100032 236100                    LDQ     26,,PR1
        20 000267   000777 376003                    ANQ     511,DU
        20 000270   000001 116003                    CMPQ    1,DU
        20 000271   000317 601000 20                 TNZ     s:7858

PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:22   
   7853 20 000272   000000 234000 1                  SZN     LIBCOM
        20 000273   000306 605000 20                 TPL     s:7856

   7854 20 000274   000006 236000 21                 LDQ     6
        20 000275   200206 756100                    STQ     KEYED_KEY+66,,AUTO
        20 000276   000010 236000 21                 LDQ     8
        20 000277   200003 235100                    LDA     @FAB,,AUTO
        20 000300   200204 757100                    STAQ    KEYED_KEY+64,,AUTO
        20 000301   200204 630500                    EPPR0   KEYED_KEY+64,,AUTO
        20 000302   000003 631400 21                 EPPR1   3
        20 000303   000000 701000 xent               TSX1    X9WS$REPOS
        20 000304   000000 011000                    NOP     0
        20 000305   000317 710000 20                 TRA     s:7858

   7856 20 000306   000006 236000 21                 LDQ     6
        20 000307   200206 756100                    STQ     KEYED_KEY+66,,AUTO
        20 000310   000010 236000 21                 LDQ     8
        20 000311   200003 235100                    LDA     @FAB,,AUTO
        20 000312   200204 757100                    STAQ    KEYED_KEY+64,,AUTO
        20 000313   200204 630500                    EPPR0   KEYED_KEY+64,,AUTO
        20 000314   000003 631400 21                 EPPR1   3
        20 000315   000000 701000 xent               TSX1    X9WS$REPOS
        20 000316   000000 011000                    NOP     0

      133     7858    4                     END;

   7858 20 000317   000326 710000 20                 TRA     s:7866

      134     7859    3                   WHENALTRETURN
      135     7860    4                     DO;

      136     7861    4                       CALL X9WE$IO_ERROR (FAB, ALT_RET)

   7861 20 000320   200003 630500                    EPPR0   @FAB,,AUTO
        20 000321   000011 631400 21                 EPPR1   9
        20 000322   000000 701000 xent               TSX1    X9WE$IO_ERROR
        20 000323   000325 702000 20                 TSX2    s:7864
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:23   
        20 000324   000326 710000 20                 TRA     s:7866

      137     7862    4                         WHENALTRETURN
      138     7863    5                           DO;

      139     7864    5                             ALTRETURN;          /* Invalid key condition */

   7864 20 000325   000000 702200 xent               TSX2  ! X66_AALT

      140     7865    5                           END;
      141     7866    4                     END;

   7866 20 000326   000344 710000 20                 TRA     s:7878

      142     7867    3               CASE (ELSE);

      143     7868    3                 CALL X8ER$ERROR (%UNEXPECTED_CASE);

   7868 20 000327   000013 630400 21                 EPPR0   11
        20 000330   000000 631400 21                 EPPR1   0
        20 000331   000000 701000 xent               TSX1    X8ER$ERROR
        20 000332   000000 011000                    NOP     0

      144     7869
      145     7870    3             END;  /* case fab.acs# */

   7870 20 000333   000344 710000 20                 TRA     s:7878

      146     7871    2           ELSE
      147     7872    3             DO;

      148     7873    3               IO_STATUS = %NOT_OPEN_IO;

   7873 20 000334   000036 475500                    LDP5    30,,PR0
        20 000335   040100 100400                    MLR     fill='040'O
        20 000336   000000 000002 19                 ADSC9   0                        cn=0,n=2
        20 000337   500000 000002                    ADSC9   0,,PR5                   cn=0,n=2
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:24   

      149     7874    3               CALL X9WE$IO_ERROR_STATUS (FAB);

   7874 20 000340   200003 630500                    EPPR0   @FAB,,AUTO
        20 000341   000000 631400 21                 EPPR1   0
        20 000342   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
        20 000343   000000 011000                    NOP     0

      150     7875    3             END;

      151     7876    2           END; /* case fab.file_status */

      152     7877
      153     7878    1   END X9WD$DELETE;  /* proc */

   7878 20 000344   000000 702200 xent               TSX2  ! X66_ARET
      154     7879        %eject;
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:25   

PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:26   
--  Include file information  --

   X9A_LIB_IO.:X8A6TOU  cannot be made into a system file and is referenced.
   X9A_IO.:X8A6TOU  is referenced.
   XS_MACRO_C.:LIBRARY  is referenced.
   X9A_FAB.:X8A6TOU  is referenced.
   X8A_COM_MACS.:X8A6TOU  is referenced.
   X8A_MACROS.:X8A6TOU  is referenced.
   X8A_ERRCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   X8A_LIBCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   X8A_SYS_FILE.:X8A6TOU  is referenced.
      No diagnostics issued in procedure X9WD$DELETE.
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:27   

 **** Variables and constants ****

  ****  Section 001 LblCom LIBCOM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(720)   r     1 LIBCOM

  ****  Section 002 LblCom DEC_OR_COMMA

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR              1 DEC_OR_COMMA

  ****  Section 003 LblCom IN_TEMP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(80)          1 IN_TEMP

  ****  Section 004 LblCom OVRCHR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR              1 OVRCHR

  ****  Section 005 LblCom SELECT_TIME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 SELECT_TIME

PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:28   
  ****  Section 006 LblCom NO_ADVANCE_OFFSET

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 NO_ADVANCE_OFFSET

  ****  Section 007 LblCom DSPLY_SAVE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(72)          1 DSPLY_SAVE

  ****  Section 008 LblCom D_DATE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(10)          1 D_DATE

  ****  Section 009 LblCom D_TIME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(11)          1 D_TIME

  ****  Section 010 LblCom D_DAY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(3)           1 D_DAY

  ****  Section 011 LblCom C_DATE

PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:29   
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(6)           1 C_DATE

  ****  Section 012 LblCom C_TIME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(8)           1 C_TIME

  ****  Section 013 LblCom C_DAY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(5)           1 C_DAY

  ****  Section 014 LblCom RTHOLD2

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 RTHOLD2

  ****  Section 015 LblCom LTHOLD2

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 LTHOLD2

  ****  Section 016 LblCom NDX2

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:30   

     0-0-0/w SBIN              1 NDX2

  ****  Section 017 LblCom IN_LEN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN              1 IN_LEN

  ****  Section 018  Data  X9WD$DELETE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(360)   r     1 DELETE

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ALT_RET                   3-0-0/w PTR         r     1 @FAB
    *0-0-0/w BIT         r     1 ALT_RET                   76-0-0/w PTR         r     1 DCB$
    *0-0-0/d STRC(2232)  r     1 FAB                      103-0-0/w PTR               1 INDEX_KEY$
   101-0-0/w UBIN              1 KEY                      104-0-0/w STRC(2304)  r     1 KEYED_KEY
     5-0-0/w SBIN              1 LT                         6-0-0/c CHAR(65)          1 LTHOLD
    50-0-0/w SBIN              1 NDX                       51-0-0/w SBIN              1 NDX3
   102-0-0/w UBIN        r     1 RELATIVE_KEY              27-0-0/c CHAR(65)          1 RTHOLD
    52-0-0/c CHAR(80)          1 SPECIAL_ERR_MSG           77-0-0/w PTR         r     1 USE$$
   100-0-0/w EPTR        r     1 USE_ENTRY$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #001=X9WD$DELETE File=X9WD.:X8A6TSI                                SAT 08/09/97 11:05 Page:31   
     0-0-0/w PTR               1 B$TCB$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(72)          1 ALT_KEYS                   0-0-0/w STRC(2448)        1 B$ALT
     0-0-0/w STRC(144)         1 B$TCB                      0-0-0/c ACHR        r     1 INDEX_KEY
     0-0-0/c CHAR(2)     r     1 IO_STATUS                  0-0-0/c ACHR        r     1 KEY_TEXT
     0-0-0N  NULL        r     1 M$UC                       0-0-0/d ASTR(3528)  r     1 M$XX
     0-0-0/w STRC(2448)  r     1 SHARED                     0-0-0/w STRC(864)         1 USE_PROC


   Procedure X9WD$DELETE requires 229 words for executable code.
   Procedure X9WD$DELETE requires 136 words of local(AUTO) storage.

    No errors detected in file X9WD.:X8A6TSI    .
