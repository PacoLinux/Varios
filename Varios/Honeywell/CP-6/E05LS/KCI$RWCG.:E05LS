VERSION E05

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:1    
        1        1        /*M* KCI$RWCG Read and write routines for comgroups */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KCI$RWCG
       10       10             PURPOSE:      To provide user read and write interfaces
       11       11                           for comgroups
       12       12             DESCRIPTION:  KCI$RWCG is the media layer for comgroup
       13       13                           I/O.  It contains two sections.  The first,
       14       14                           represented by the entry point KCI$RWCG,
       15       15                           is for normal read/write services, and
       16       16                           interfaces to KQR/KQW through IOQ.  The
       17       17                           second, represented by KCI$TCTL, is for
       18       18                           terminal control services, and in most cases,
       19       19                           interfaces directly with KCF and KI, thus going
       20       20                           'around' the comgroup queue.  The exceptions in
       21       21                           KCI$TCTL which interface through IOQ are when
       22       22                           the MFCN are WRITE, WRBIN, or RSTAT.
       23       23        */
       24       24        /**/
       25       25        /*F* NAME:         KCI$RWCG
       26       26             PURPOSE:      To provide the media layer for comgroup read
       27       27                           and write.
       28       28             DESCRIPTION:  The user-passed parameters (VLP_STATION),
       29       29                           and the VLP_SETSTA and LASTSTA in the DCB
       30       30                           are combined to produce the parameters for
       31       31                           the current read or write operation.  These
       32       32                           are then passed to NIO$QUE. */
       33       33        /**/
       34       34        KCI$RWCG: PROC (MFCN,DVBYTE,VFC,EVENT,PSST) ALTRET;
       35       35        /**/
       36       36        /**/
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:2    
       37       37
       38       38
       39       39
       40       40        /**/
       41       41        /* INCLUDES */
       42       42        /**/
       43       43        %INCLUDE B$JIT_C;
       44      357        %INCLUDE B$SS;
       45      536        %INCLUDE B_MAGIC_C;
       46      654        %INCLUDE F$DCB;
       47      703        %INCLUDE N$REQ;
       48      777        %INCLUDE N_FC_C;
       49      814        %INCLUDE NK$LDCT;
       50      916        %INCLUDE KV$VDO;
       51     1931        %INCLUDE KC_CP6;
       52     2491        %INCLUDE KC_DATA_R;
       53     2504        %INCLUDE F_FPTCODE_C;
       54     2540        %INCLUDE F_MACROS_C;
       55     2551        %INCLUDE NK_SUBS;
       56     2576        %INCLUDE NK_VFC_C;
       57     2650        %INCLUDE KL_SUPER_C;
       58     5552        %INCLUDE KQ_SUBS_C;
       59     5852        %INCLUDE KC_ERRORS_C;
       60     5899        %INCLUDE F_ERRORS_C;
       61     6139        %INCLUDE UD_SEV_C;
       62     6153        %INCLUDE NK_LDCT_R;
       63     6162        %INCLUDE KQ_MAC_C;
       64     8712        %INCLUDE KC$CP6V_C;
       65     8832        %INCLUDE KI$CP6V_C;
       66     9271        %INCLUDE CP_6_SUBS;
       67     9811        %INCLUDE HF_LOCK_C;
       68     9825        %INCLUDE K_DATA_R;
       69    10536        %INCLUDE KV_PRMID_E;
       70    10710
       71    10711        %KV_PRMID_E;
       72    10867
       73    10868
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:3    
       74    10869
       75    10870        /**/
       76    10871        /* PARAMETERS */
       77    10872        /**/
       78    10873    1   DCL MFCN UBIN WORD;
       79    10874    1   DCL DVBYTE BIT(9) CALIGNED;
       80    10875    1   DCL TFCN REDEF DVBYTE UBIN(9) CALIGNED;
       81    10876    1   DCL VFC CHAR(1) UNAL;
       82    10877    1   DCL PCODE REDEF VFC UBIN BYTE UNAL;
       83    10878    1   DCL TPRM REDEF VFC CHAR(1);  /* REALLY TWO CHARS */
       84    10879    1   DCL EVENT UBIN WORD;
       85    10880        %VLP_SETSTA (FPTN=PSST,STCLASS="");
       86    10908
       87    10909
       88    10910
       89    10911        /**/
       90    10912        /* BASED STRUCTURES */
       91    10913        /**/
       92    10914        %B$JIT0;
       93    11003        %U$JIT1X;
       94    11006        %M$JIT2X;
       95    11009        %F$JIT3;
       96    11014        %A$JIT6X;
       97    11017        %VLP_STATION (FPTN=VLP$STATION,STCLASS=BASED);
       98    11044        %VLP_SETSTA (FPTN=VLP$SETSTA,STCLASS=BASED);
       99    11072        %N$REQ (STCLASS="BASED(IOQ$)");
      100    11130        %NK$LDCT;
      101    11176        %KQ_CG (FPTN=KQ$CG,STCLASS=BASED);
      102    11915        %KV_VDO_ALL_E;
      103    11994        %KV$VDO_RQSPRM (NAME=RQSPRM,STCLASS=BASED);
      104    12037        %K$RWPARM (NAME=B$RWPARM,STCLASS=BASED);
      105    12353        %KL_PHDR (NAME=KL$PHDR,STCLASS=BASED);
      106    12394        %VLP$TRMATTR_V;
      107    12416    1   DCL B$PTR$ PTR BASED;
      108    12417    1   DCL 1 TCTL BASED (TCTL$),
      109    12418    1         2 T UBIN(9) UNAL,
      110    12419    1         2 L UBIN(9) UNAL,
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:4    
      111    12420    1         2 M CHAR(58) UNAL;
      112    12421
      113    12422
      114    12423
      115    12424        /**/
      116    12425        /* AUTO */
      117    12426        /**/
      118    12427        %K$RWPARM (NAME=K$RWPARM);
      119    12743    1   DCL DCB$ PTR;
      120    12744    1   DCL ENT UBIN WORD;
      121    12745    1   DCL STA$ PTR;
      122    12746    1   DCL LDCT$ PTR;
      123    12747    1   DCL CG$ PTR;
      124    12748    1   DCL MSIZ UBIN WORD;
      125    12749    1   DCL 1 MZRD REDEF MSIZ,
      126    12750    1         2 T UBIN(28) UNAL,
      127    12751    1         2 B UBIN(8) UNAL;
      128    12752    1   DCL CMPCNT UBIN WORD;
      129    12753    1   DCL IOQ$ REDEF CMPCNT PTR;
      130    12754    1   DCL TFCNU REDEF CMPCNT UBIN WORD;
      131    12755    1   DCL QFCN UBIN WORD;
      132    12756    1   DCL QOP BIT(36) ALIGNED;
      133    12757        %VLP_STATION (FPTN=ASTA,STCLASS="");
      134    12784    1   DCL PRF_HDR$ PTR;
      135    12785    1   DCL TCTL$ PTR;
      136    12786    1   DCL DVE_VFC CHAR(1) CALIGNED;
      137    12787
      138    12788
      139    12789
      140    12790        /**/
      141    12791        /* SUBS */
      142    12792        /**/
      143    12793        %SUB FCG#='1303'O;
      144    12794        %SUB MID#='11'O;
      145    12795
      146    12796
      147    12797
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:5    
      148    12798        /**/
      149    12799        /* CONSTANT */
      150    12800        /**/
      151    12801    1   DCL DVBYTE_VFC BIT(9) CONSTANT INIT ('100'O);
      152    12802        %ERRCODE (NAME=TOOBIG,COD#=%E$TOOBIG,SEV#=SEV_ERROR#,MON#='1'B);
      153    12806        %ERRCODE (NAME=NOSTA,COD#=%E$NOSTA,SEV#=SEV_ERROR#,MON#='1'B);
      154    12810        %ERRCODE (NAME=LDSC,COD#=%E$LDSC,SEV#=SEV_ERROR#,MON#='1'B);
      155    12814        %ERRCODE (NAME=NFPTCTL,COD#=%E$NFPTCTL,SEV#=SEV_ERROR#,MON#='1'B);
      156    12818        %ERRCODE (NAME=BADVECTOR3,COD#= 423   ,SEV#=SEV_ERROR#,MON#='1'B);
      157    12822
      158    12823
      159    12824
      160    12825        /**/
      161    12826        /* REFS */
      162    12827        /**/
      163    12828    1   DCL HFF$NILERASE  ENTRY(1) ALTRET;
      164    12829    1   DCL HFF$DSIZ      ENTRY(2) ALTRET;
      165    12830    1   DCL NIO$QUE       ENTRY(1) ALTRET;
      166    12831    1   DCL NIQ$GET       ENTRY(1) ALTRET;
      167    12832    1   DCL KCF$CKLDTKL   ENTRY(3) ALTRET;
      168    12833    1   DCL KCI$CKSTAT    ENTRY(3) ALTRET;
      169    12834    1   DCL KCI$VALSTA    ENTRY(2) ALTRET;
      170    12835    1   DCL KIA$FCNOU ENTRY(3) ALTRET;
      171    12836    1   DCL KIA$VDO ENTRY(3);
      172    12837    1   DCL B$PS3$ PTR SYMREF READONLY;
      173    12838    1   DCL B$JIT$ PTR SYMREF;
      174    12839        %B_MPT (STCLASS=SYMREF);
      175    12932    1   DCL SC_BMDFCN ENTRY CONV(2,0);
      176    12933        %EJECT;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:6    
      177    12934    1         ENT=0;
      178    12935    1         DCB$=B$JIT$->B$JIT.DCB$;
      179    12936    1         STA$=ADDR(PSST);
      180    12937    1         GOTO RWCG;
      181    12938        /**/
      182    12939        /*F* NAME:         KCI$RWCGS
      183    12940             PURPOSE:      To provide read and write interface to
      184    12941                           comgroups from within the monitor
      185    12942             DESCRIPTION:  Basically the same as KCI$RWCG but
      186    12943                           the caller is assumed to know what he
      187    12944                           is doing, and thus bypasses certain
      188    12945                           legality checks.  STA$ is not passed. */
      189    12946    1   KCI$RWCGS: ENTRY (MFCN,DVBYTE,VFC,EVENT) ALTRET;
      190    12947        /**/
      191    12948    1         ENT=1;
      192    12949    1         DCB$=B$JIT$->B$JIT.DCB$;
      193    12950    1         STA$=DCB$->F$DCB.SETSTA$;
      194    12951    1   RWCG: ;
      195    12952    1         DVE_VFC=VFC;
      196    12953    2           DO CASE (MFCN);
      197    12954    2             CASE(ELSE);
      198    12955    2               CALL SC_BMDFCN;
      199    12956        /*S*  SCREECH_CODE: KCI-S$BMDFCN
      200    12957              TYPE:    SUA
      201    12958              MESSAGE: Illegal function code passed to comgroup
      202    12959              REMARKS: The comgroup media layer accepts only reads and writes.
      203    12960                       This screech occurs when a formatting layer passes a file
      204    12961                       type media function.  This code is also reported by
      205    12962                       NKA$DEVIO (NKA-S$BMDFCN) and KIA$UCIO (KIA-BMDFCN) in
      206    12963                       similar situations.                                           */
      207    12964    2             CASE (MFC_WRBIN);
      208    12965    2               QFCN=%N_WRBIN;
      209    12966    2               GOTO WRITES;
      210    12967    2             CASE (MFC_WRITE);
      211    12968    2               QFCN=%N_WRITE;
      212    12969    2   WRITES:     IF DCB$->F$DCB.UBYTES >
      213    12970    2               NK$LDCT$(DCB$->F$DCB.LDCTX)->NK$LDCT.CG$->KQ$CG.AUCTL.MAXMC THEN
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:7    
      214    12971    3                 DO;
      215    12972    3                 B$JIT$->B$JIT.ERR=TOOBIG;
      216    12973        /*E*  ERROR:         KCI-E$TOOBIG-E
      217    12974               MESSAGE: Too many bytes written to comgroup.
      218    12975              MESSAGE1: The administrative user sets the maximum bytes written
      219    12976                        through a comgroup.  You tried to write more than that.
      220    12977        */
      221    12978    3                 ALTRETURN;
      222    12979    3                 END;
      223    12980    2               QOP=OP_USER|OP_BPF;
      224    12981    2               ASTA=STA$->VLP$SETSTA.OSTA;
      225    12982    2               ASTA.MSGID# = 0;
      226    12983    2               IF ENT=0 THEN
      227    12984    2                CALL HFF$NILERASE (3)
      228    12985    2                WHENRETURN
      229    12986    3                  DO;
      230    12987    3                  CALL HFF$DSIZ(3,MSIZ);
      231    12988    3                  IF (MSIZ >= SIZEC(VLP$STATION)) THEN
      232    12989    3                   CALL KCI$VALSTA (B$PS3$->VLP$STATION,ASTA) ALTRET(ALTRT);
      233    12990    4                  ELSE DO ;
      234    12991    4                    B$JIT$->B$JIT.ERR=BADVECTOR3;
      235    12992    4                    ALTRETURN;
      236    12993    4                    END;
      237    12994    3                  END;
      238    12995    2               IF ASTA.MSGTYP#~=' ' THEN
      239    12996    3                 DO FOREVER;
      240    12997    3                 CALL INDEX (CMPCNT,'?',ASTA.MSGTYP#) ALTRET (MOK);
      241    12998    3                 CALL INSERT (ASTA.MSGTYP#,CMPCNT,1,' ');
      242    12999    3                 END;
      243    13000    2   MOK:        IF ASTA.STATION# = ' ' AND ASTA.CTL.ANYDCB# = '0'B THEN
      244    13001    3                 DO;
      245    13002    3                 ASTA.STATION#=DCB$->F$DCB.LASTSTA$->VLP$STATION.STATION#;
      246    13003    3                 IF ASTA.STATION#=' ' THEN
      247    13004    3                  IF DCB$->F$DCB.LASTSTA$->VLP$STATION.CTL.ANYDCB# THEN
      248    13005    3                   ASTA.CTL.ANYDCB# = '1'B;
      249    13006    3                  ELSE
      250    13007    3                   IF ASTA.STATION# = ' ' THEN
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:8    
      251    13008    4                     DO;
      252    13009    4                     B$JIT$->B$JIT.ERR=NOSTA;
      253    13010        /*E* ERROR:        KCI-E$NOSTA-E
      254    13011             MESSAGE:      Null destination specified on comgroup service.
      255    13012             MESSAGE1:     For 'output' comgroup services (e.g. M$WRITE),
      256    13013                           the destination must be specified or defaulted.
      257    13014                           You specified ANYDCB = NO, and then either
      258    13015                           specified a blank STATION, or did not specify
      259    13016                           it and the default would be blanks.  Such
      260    13017                           an operation is legal only if a previous read
      261    13018                           or write has set the "last station read or
      262    13019                           written" in your DCB.
      263    13020            DESCRIPTION:   The user did an M$WRITE such that all of the
      264    13021                           available places to get STATION (VLP_STATION,
      265    13022                           VLP_SETSTA, and LASTSTA) were blank, and ANYDCB
      266    13023                           was reset.  He probably wants to specify station,
      267    13024                           or read before he writes. */
      268    13025    4                     ALTRETURN;
      269    13026    4                     END;
      270    13027    3                 END;
      271    13028    2             CASE(MFC_READ);
      272    13029    2               QFCN=%N_READ;
      273    13030    2               QOP=OP_USER|OP_BPF|OP_ARS;
      274    13031    2               ASTA=STA$->VLP$SETSTA.ISTA;
      275    13032    2               ASTA.MSGID# = 0;
      276    13033    2               IF ENT=0 THEN
      277    13034    2                CALL HFF$NILERASE (3)
      278    13035    2                WHENRETURN
      279    13036    3                  DO;
      280    13037    3                  CALL HFF$DSIZ(3,MSIZ);
      281    13038    3                  IF (MSIZ >= SIZEC(VLP$STATION)) THEN
      282    13039    3                   CALL KCI$VALSTA (B$PS3$->VLP$STATION,ASTA) ALTRET(ALTRT);
      283    13040    4                  ELSE DO ;
      284    13041    4                    B$JIT$->B$JIT.ERR=BADVECTOR3;
      285    13042    4                    ALTRETURN;
      286    13043    4                    END;
      287    13044    3                  END;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:9    
      288    13045    2           END;
      289    13046    1         CALL CSEND;
      290    13047    1         IF B$JIT.ERR.CODE~=0 THEN ALTRETURN;
      291    13048    1         RETURN;
      292    13049        /**/
      293    13050        /*F* NAME:         KCI$TCTL
      294    13051             PURPOSE:      To provide the media layer for terminal
      295    13052                           control services to comgroups
      296    13053             DESCRIPTION:  Translates the passed media function into
      297    13054                           the appropriate calls to KCF and KI.  In some
      298    13055                           cases, we must go through the CG queue instead
      299    13056                           of around it (M$PROFILE).
      300    13057
      301    13058                           If we're doing M$PROFILE or M$STRMATTR and INPUT is
      302    13059                           changed, LDCT.LKFLG.INTOGGLE is set to signal that
      303    13060                           the LDCT.DFLG.INPUT must be changed and KCF$FERDS
      304    13061                           must be called.  This flag is checked in FEWRT
      305    13062                           when we're actually sending the message to the
      306    13063                           device.
      307    13064        */
      308    13065    1   KCI$TCTL: ENTRY (MFCN,DVBYTE,VFC,EVENT,PSST) ALTRET;
      309    13066        /**/
      310    13067    1         CALL KCI$CKSTAT (LDCT$,CG$,ASTA.STATION#) ALTRET (ALTRT);
      311    13068    2         IF LDCT$->LDCT.RESCOD=NK_CGFPRG THEN DO;
      312    13069    2           B$JIT.ERR=NFPTCTL;
      313    13070        /*E* ERROR: KCI-E$NFPTCTL-E
      314    13071           MESSAGE: You may not issue terminal control services to an FPRG terminal
      315    13072        */
      316    13073    2           ALTRETURN;
      317    13074    2           END;
      318    13075    1         DCB$=B$JIT.DCB$;
      319    13076    1         ASTA.CTL='0'B;
      320    13077    1         ASTA.MSGTYP#='*TCTL';
      321    13078    1         ASTA.MSGID# = 0;
      322    13079    1         DVE_VFC=VFC;
      323    13080    2           DO CASE (MFCN);
      324    13081    2             CASE (ELSE);
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:10   
      325    13082    2               CALL SC_BMDFCN;  /* SUA */
      326    13083    2             CASE (MFC_WRITE,MFC_WRBIN);
      327    13084    2               QFCN=%N_WRITE;
      328    13085    2               QOP=OP_USER|OP_BPF;
      329    13086    2               TCTL$=DCB$->F$DCB.UB$;
      330    13087    2               IF DVBYTE&DVBYTE_VFC AND DVE_VFC=%VFC_SPR THEN   /* M$PROFILE */
      331    13088    3                 DO;
      332    13089                      %LOCK (G=LDCT$->LDCT.LOCK);
      333    13092    3                 PRF_HDR$=ADDR(PSST)->B$PTR$;
      334    13093    3                 IF PRF_HDR$->KL$PHDR.IO.INPUT~=LDCT$->LDCT.DFLG.INPUT THEN
      335    13094    3                  LDCT$->LDCT.LKFLG.INTOGGLE='1'B;
      336    13095                      /*N* MAY BE TURNING OFF OUTPUT BEFORE THE PROFILE CAN BE DELIVERED */
      337    13096    3                 LDCT$->LDCT.DFLG.OUTPUT=PRF_HDR$->KL$PHDR.IO.OUTPUT;
      338    13097                      %UNLOCK (G=LDCT$->LDCT.LOCK);
      339    13100    3                 END;
      340    13101    2               ELSE IF TCTL.T=%KV_PRMID_TRMATTR THEN         /* M$STRMATTR */
      341    13102    3                  DO;
      342    13103                       %LOCK (G=LDCT$->LDCT.LOCK);
      343    13106    3                  IF ADDR(TCTL.M)->VLP$TRMATTR_V.INPUT~='01'B THEN
      344    13107    3                   IF ADDR(TCTL.M)->VLP$TRMATTR_V.INPUT~=LDCT$->LDCT.DFLG.INPUT THEN
      345    13108    3                    LDCT$->LDCT.LKFLG.INTOGGLE='1'B;
      346    13109                      /*N* MAY BE TURNING OFF OUTPUT BEFORE THE TRMATTR CAN BE DELIVERED */
      347    13110    3                  IF ADDR(TCTL.M)->VLP$TRMATTR_V.OUTPUT~='01'B THEN
      348    13111    3                   LDCT$->LDCT.DFLG.OUTPUT=ADDR(TCTL.M)->VLP$TRMATTR_V.OUTPUT;
      349    13112                       %UNLOCK (G=LDCT$->LDCT.LOCK);
      350    13115    3                  DVE_VFC=%VFC_SPR;     /* so we recognize INTOGGLE in KCF$FEWRT */
      351    13116    3                  END;
      352    13117    2               CALL CSEND;
      353    13118    2             CASE (MFC_RSTAT);
      354    13119    2               QFCN=%N_READ;
      355    13120    2               QOP=OP_USER|OP_BPF|OP_ARS;
      356    13121    2               MSIZ=DCB$->F$DCB.UBYTES;
      357    13122    2               K$RWPARM = K_RWPARM_CON;
      358    13123    2               K$RWPARM.STATION = DCB$->F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#;
      359    13124    2               K$RWPARM.MSGTYP = '*TCTL';
      360    13125    2               K$RWPARM.PRMID = PCODE;
      361    13126    2               K$RWPARM.MAXRCRBYTSIZ = MZRD.T * 512 + MZRD.B;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:11   
      362    13127    2               CALL KCF$CKLDTKL (LDCT$->LDCT,CG$,ASTA.STATION#) ALTRET (DISC);
      363    13128    2               CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_RQSPRM,K$RWPARM) ALTRET(UNL_DISC)
             13128                        ;
      364    13129                    %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      365    13132    2               ASTA.CTL.DIRONLY#='1'B;
      366    13133    2               CALL CSEND;
      367    13134    2             CASE (MFC_TCTL);
      368    13135    2               TFCNU=TFCN;
      369    13136    2               CALL KCF$CKLDTKL (LDCT$->LDCT,CG$,ASTA.STATION#) ALTRET (DISC);
      370    13137    2               IF TFCNU = 0 THEN
      371    13138    2                LDCT$->NK$LDCT.DFLG.NOSND = ~K$RWPARM.VDOFLGS.SEND;
      372    13139    2               ELSE
      373    13140    2                CALL KIA$FCNOU (LDCT$->LDCT,TFCNU,ADDR(PSST)->B$PTR$->B$RWPARM) ALTRET
             13140                         (UNL_DISC);
      374    13141                    %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      375    13144    2           END;
      376    13145    1         IF B$JIT.ERR.CODE ~= 0 THEN ALTRETURN;
      377    13146    1         RETURN;
      378    13147        /**/
      379    13148    1   UNL_DISC: ;
      380    13149              %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      381    13152    1   DISC: ;
      382    13153    1         B$JIT.ERR=LDSC;
      383    13154        /*E*  ERROR:    KCI-E$LDSC-E
      384    13155               MESSAGE: That station is not connected.
      385    13156              MESSAGE1: Terminal control services require that the
      386    13157                        addressed station be connected during the
      387    13158                        service.  The one you specified is not.
      388    13159              DESCRIPTION: This is independent of WAS, RAS.                          */
      389    13160    1   ALTRT:;
      390    13161    1         ALTRETURN;
      391    13162        %EJECT;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:12   
      392    13163        /**/
      393    13164        /******************************************************************************
      394    13165        *                                                                             *
      395    13166        *  SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS  *
      396    13167        * S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S *
      397    13168        * S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S     *
      398    13169        *  SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS  *
      399    13170        *     S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S *
      400    13171        * S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S *
      401    13172        *  SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS  *
      402    13173        *                                                                             *
      403    13174        ******************************************************************************/
      404    13175
      405    13176        /****************************************************************
      406    13177        *****************************************************************/
      407    13178        /*D* NAME:         CSEND
      408    13179             PURPOSE:      To perform the call to KQR/KQW via IOQ
      409    13180             DESCRIPTION:  Gets an IOQ packet, initializes it, and calls
      410    13181                           NIO$QUE to start the IO. */
      411    13182    1   CSEND: PROC;
      412    13183        /**/
      413    13184    2         CALL NIQ$GET (IOQ$);
      414    13185    2         N$REQ.FC=QFCN;
      415    13186    2         N$REQ.USER#=B$JIT.USER;
      416    13187    2         N$REQ.BUF$=DCB$->F$DCB.UB$;
      417    13188    2         N$REQ.BUFSIZE=DCB$->F$DCB.UBYTES;
      418    13189    2         N$REQ.DCB$=DCB$;
      419    13190    2         N$REQ.DLA.DCTX=DCB$->F$DCB.LDCTX;
      420    13191    2         N$REQ.DVE.DVBYTE=DVBYTE;
      421    13192    2         N$REQ.OPFLG=QOP;
      422    13193    2         IF N$REQ.DVE.DVBYTE.VFC THEN
      423    13194    2          N$REQ.DVE.VFC=DVE_VFC;
      424    13195    2         IF DCB$->F$DCB.WAIT=1 THEN N$REQ.OPFLG.WAIT='1'B;
      425    13196    2         ELSE
      426    13197    3           DO;
      427    13198    3           N$REQ.EVNTINFO=EVENT;
      428    13199    3           N$REQ.NWIO=0;               /*NO-WAIT*/
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:13   
      429    13200    3           N$REQ.WSR=B_MPT.SS$->B$SS.ISR.WSR; /* Give event to the right domain */
      430    13201    3           END;
      431    13202    2         N$REQ.STATION.LSTA$=ADDR(ASTA);
      432    13203    2         CALL NIO$QUE (N$REQ);
      433    13204    2         RETURN;
      434    13205    2   END CSEND;
      435    13206        /**/
      436    13207    1   END KCI$RWCG;
      437    13208        /**/
      438    13209        /**/
      439    13210        %EOD;

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:14   
--  Include file information  --

   KV_PRMID_E.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B$SS.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KCI$RWCG.

   Procedure KCI$RWCG requires 543 words for executable code.
   Procedure KCI$RWCG requires 74 words of local(AUTO) storage.

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:15   

 Object Unit name= KCI$RWCG                                   File name= KCI$RWCG.:E05TOU
 UTS= JUL 30 '97 00:14:26.96 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      8     10  KCI$RWCG
    1   Proc  even  none   543   1037  KCI$RWCG
    2  RoData even  none     7      7  KCI$RWCG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        5  KCI$RWCG
     1     11          yes     yes      Std        4  KCI$RWCGS
     1    274          yes     yes      Std        5  KCI$TCTL
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:16   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KCI$CKSTAT
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       2 HFF$DSIZ
 yes     yes           Std       2 KCI$VALSTA
         yes           Std       1 HFC$LOCK
 yes     yes           Std       3 KCF$CKLDTKL
 yes     yes           Std       3 KIA$FCNOU
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       1 NIO$QUE
                       nStd      0 X66_AUTO_5
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BMDFCN                             N$DCT$$                          r    K_RWPARM_CON
r    B$PS3$                                B$JIT$                                B_MPT
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:17   


        1        1        /*M* KCI$RWCG Read and write routines for comgroups */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KCI$RWCG
       10       10             PURPOSE:      To provide user read and write interfaces
       11       11                           for comgroups
       12       12             DESCRIPTION:  KCI$RWCG is the media layer for comgroup
       13       13                           I/O.  It contains two sections.  The first,
       14       14                           represented by the entry point KCI$RWCG,
       15       15                           is for normal read/write services, and
       16       16                           interfaces to KQR/KQW through IOQ.  The
       17       17                           second, represented by KCI$TCTL, is for
       18       18                           terminal control services, and in most cases,
       19       19                           interfaces directly with KCF and KI, thus going
       20       20                           'around' the comgroup queue.  The exceptions in
       21       21                           KCI$TCTL which interface through IOQ are when
       22       22                           the MFCN are WRITE, WRBIN, or RSTAT.
       23       23        */
       24       24        /**/
       25       25        /*F* NAME:         KCI$RWCG
       26       26             PURPOSE:      To provide the media layer for comgroup read
       27       27                           and write.
       28       28             DESCRIPTION:  The user-passed parameters (VLP_STATION),
       29       29                           and the VLP_SETSTA and LASTSTA in the DCB
       30       30                           are combined to produce the parameters for
       31       31                           the current read or write operation.  These
       32       32                           are then passed to NIO$QUE. */
       33       33        /**/
       34       34        KCI$RWCG: PROC (MFCN,DVBYTE,VFC,EVENT,PSST) ALTRET;

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:18   
     34  1 000000   000000 700200 xent  KCI$RWCG     TSX0  ! X66_AUTO_5
         1 000001   000112 000005                    ZERO    74,5

       35       35        /**/
       36       36        /**/
       37       37
       38       38
       39       39
       40       40        /**/
       41       41        /* INCLUDES */
       42       42        /**/
       43       43        %INCLUDE B$JIT_C;
       44      357        %INCLUDE B$SS;
       45      536        %INCLUDE B_MAGIC_C;
       46      654        %INCLUDE F$DCB;
       47      703        %INCLUDE N$REQ;
       48      777        %INCLUDE N_FC_C;
       49      814        %INCLUDE NK$LDCT;
       50      916        %INCLUDE KV$VDO;
       51     1931        %INCLUDE KC_CP6;
       52     2491        %INCLUDE KC_DATA_R;
       53     2504        %INCLUDE F_FPTCODE_C;
       54     2540        %INCLUDE F_MACROS_C;
       55     2551        %INCLUDE NK_SUBS;
       56     2576        %INCLUDE NK_VFC_C;
       57     2650        %INCLUDE KL_SUPER_C;
       58     5552        %INCLUDE KQ_SUBS_C;
       59     5852        %INCLUDE KC_ERRORS_C;
       60     5899        %INCLUDE F_ERRORS_C;
       61     6139        %INCLUDE UD_SEV_C;
       62     6153        %INCLUDE NK_LDCT_R;
       63     6162        %INCLUDE KQ_MAC_C;
       64     8712        %INCLUDE KC$CP6V_C;
       65     8832        %INCLUDE KI$CP6V_C;
       66     9271        %INCLUDE CP_6_SUBS;
       67     9811        %INCLUDE HF_LOCK_C;
       68     9825        %INCLUDE K_DATA_R;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:19   
       69    10536        %INCLUDE KV_PRMID_E;
       70    10710
       71    10711        %KV_PRMID_E;
       72    10867
       73    10868
       74    10869
       75    10870        /**/
       76    10871        /* PARAMETERS */
       77    10872        /**/
       78    10873    1   DCL MFCN UBIN WORD;
       79    10874    1   DCL DVBYTE BIT(9) CALIGNED;
       80    10875    1   DCL TFCN REDEF DVBYTE UBIN(9) CALIGNED;
       81    10876    1   DCL VFC CHAR(1) UNAL;
       82    10877    1   DCL PCODE REDEF VFC UBIN BYTE UNAL;
       83    10878    1   DCL TPRM REDEF VFC CHAR(1);  /* REALLY TWO CHARS */
       84    10879    1   DCL EVENT UBIN WORD;
       85    10880        %VLP_SETSTA (FPTN=PSST,STCLASS="");
       86    10908
       87    10909
       88    10910
       89    10911        /**/
       90    10912        /* BASED STRUCTURES */
       91    10913        /**/
       92    10914        %B$JIT0;
       93    11003        %U$JIT1X;
       94    11006        %M$JIT2X;
       95    11009        %F$JIT3;
       96    11014        %A$JIT6X;
       97    11017        %VLP_STATION (FPTN=VLP$STATION,STCLASS=BASED);
       98    11044        %VLP_SETSTA (FPTN=VLP$SETSTA,STCLASS=BASED);
       99    11072        %N$REQ (STCLASS="BASED(IOQ$)");
      100    11130        %NK$LDCT;
      101    11176        %KQ_CG (FPTN=KQ$CG,STCLASS=BASED);
      102    11915        %KV_VDO_ALL_E;
      103    11994        %KV$VDO_RQSPRM (NAME=RQSPRM,STCLASS=BASED);
      104    12037        %K$RWPARM (NAME=B$RWPARM,STCLASS=BASED);
      105    12353        %KL_PHDR (NAME=KL$PHDR,STCLASS=BASED);
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:20   
      106    12394        %VLP$TRMATTR_V;
      107    12416    1   DCL B$PTR$ PTR BASED;
      108    12417    1   DCL 1 TCTL BASED (TCTL$),
      109    12418    1         2 T UBIN(9) UNAL,
      110    12419    1         2 L UBIN(9) UNAL,
      111    12420    1         2 M CHAR(58) UNAL;
      112    12421
      113    12422
      114    12423
      115    12424        /**/
      116    12425        /* AUTO */
      117    12426        /**/
      118    12427        %K$RWPARM (NAME=K$RWPARM);
      119    12743    1   DCL DCB$ PTR;
      120    12744    1   DCL ENT UBIN WORD;
      121    12745    1   DCL STA$ PTR;
      122    12746    1   DCL LDCT$ PTR;
      123    12747    1   DCL CG$ PTR;
      124    12748    1   DCL MSIZ UBIN WORD;
      125    12749    1   DCL 1 MZRD REDEF MSIZ,
      126    12750    1         2 T UBIN(28) UNAL,
      127    12751    1         2 B UBIN(8) UNAL;
      128    12752    1   DCL CMPCNT UBIN WORD;
      129    12753    1   DCL IOQ$ REDEF CMPCNT PTR;
      130    12754    1   DCL TFCNU REDEF CMPCNT UBIN WORD;
      131    12755    1   DCL QFCN UBIN WORD;
      132    12756    1   DCL QOP BIT(36) ALIGNED;
      133    12757        %VLP_STATION (FPTN=ASTA,STCLASS="");
      134    12784    1   DCL PRF_HDR$ PTR;
      135    12785    1   DCL TCTL$ PTR;
      136    12786    1   DCL DVE_VFC CHAR(1) CALIGNED;
      137    12787
      138    12788
      139    12789
      140    12790        /**/
      141    12791        /* SUBS */
      142    12792        /**/
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:21   
      143    12793        %SUB FCG#='1303'O;
      144    12794        %SUB MID#='11'O;
      145    12795
      146    12796
      147    12797
      148    12798        /**/
      149    12799        /* CONSTANT */
      150    12800        /**/
      151    12801    1   DCL DVBYTE_VFC BIT(9) CONSTANT INIT ('100'O);
      152    12802        %ERRCODE (NAME=TOOBIG,COD#=%E$TOOBIG,SEV#=SEV_ERROR#,MON#='1'B);
      153    12806        %ERRCODE (NAME=NOSTA,COD#=%E$NOSTA,SEV#=SEV_ERROR#,MON#='1'B);
      154    12810        %ERRCODE (NAME=LDSC,COD#=%E$LDSC,SEV#=SEV_ERROR#,MON#='1'B);
      155    12814        %ERRCODE (NAME=NFPTCTL,COD#=%E$NFPTCTL,SEV#=SEV_ERROR#,MON#='1'B);
      156    12818        %ERRCODE (NAME=BADVECTOR3,COD#= 423   ,SEV#=SEV_ERROR#,MON#='1'B);
      157    12822
      158    12823
      159    12824
      160    12825        /**/
      161    12826        /* REFS */
      162    12827        /**/
      163    12828    1   DCL HFF$NILERASE  ENTRY(1) ALTRET;
      164    12829    1   DCL HFF$DSIZ      ENTRY(2) ALTRET;
      165    12830    1   DCL NIO$QUE       ENTRY(1) ALTRET;
      166    12831    1   DCL NIQ$GET       ENTRY(1) ALTRET;
      167    12832    1   DCL KCF$CKLDTKL   ENTRY(3) ALTRET;
      168    12833    1   DCL KCI$CKSTAT    ENTRY(3) ALTRET;
      169    12834    1   DCL KCI$VALSTA    ENTRY(2) ALTRET;
      170    12835    1   DCL KIA$FCNOU ENTRY(3) ALTRET;
      171    12836    1   DCL KIA$VDO ENTRY(3);
      172    12837    1   DCL B$PS3$ PTR SYMREF READONLY;
      173    12838    1   DCL B$JIT$ PTR SYMREF;
      174    12839        %B_MPT (STCLASS=SYMREF);
      175    12932    1   DCL SC_BMDFCN ENTRY CONV(2,0);
      176    12933        %EJECT;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:22   
      177    12934    1         ENT=0;

  12934  1 000002   200061 450100                    STZ     ENT,,AUTO

      178    12935    1         DCB$=B$JIT$->B$JIT.DCB$;

  12935  1 000003   000000 470400 xsym               LDP0    B$JIT$
         1 000004   000232 236100                    LDQ     154,,PR0
         1 000005   200060 756100                    STQ     DCB$,,AUTO

      179    12936    1         STA$=ADDR(PSST);

  12936  1 000006   200007 236100                    LDQ     @PSST,,AUTO
         1 000007   200062 756100                    STQ     STA$,,AUTO

      180    12937    1         GOTO RWCG;

  12937  1 000010   000023 710000 1                  TRA     RWCG

      181    12938        /**/
      182    12939        /*F* NAME:         KCI$RWCGS
      183    12940             PURPOSE:      To provide read and write interface to
      184    12941                           comgroups from within the monitor
      185    12942             DESCRIPTION:  Basically the same as KCI$RWCG but
      186    12943                           the caller is assumed to know what he
      187    12944                           is doing, and thus bypasses certain
      188    12945                           legality checks.  STA$ is not passed. */
      189    12946    1   KCI$RWCGS: ENTRY (MFCN,DVBYTE,VFC,EVENT) ALTRET;

  12946  1 000011   000000 700200 xent  KCI$RWCGS    TSX0  ! X66_AUTO_5
         1 000012   000112 000005                    ZERO    74,5

      190    12947        /**/
      191    12948    1         ENT=1;

  12948  1 000013   000001 235007                    LDA     1,DL
         1 000014   200061 755100                    STA     ENT,,AUTO
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:23   

      192    12949    1         DCB$=B$JIT$->B$JIT.DCB$;

  12949  1 000015   000000 470400 xsym               LDP0    B$JIT$
         1 000016   000232 236100                    LDQ     154,,PR0
         1 000017   200060 756100                    STQ     DCB$,,AUTO

      193    12950    1         STA$=DCB$->F$DCB.SETSTA$;

  12950  1 000020   200060 471500                    LDP1    DCB$,,AUTO
         1 000021   100006 236100                    LDQ     6,,PR1
         1 000022   200062 756100                    STQ     STA$,,AUTO

  12950  1 000023                       RWCG         null
      194    12951    1   RWCG: ;
      195    12952    1         DVE_VFC=VFC;

  12952  1 000023   200005 471500                    LDP1    @VFC,,AUTO
         1 000024   040100 100500                    MLR     fill='040'O
         1 000025   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000026   200103 000001                    ADSC9   DVE_VFC,,AUTO            cn=0,n=1

      196    12953    2           DO CASE (MFCN);

  12953  1 000027   200003 473500                    LDP3    @MFCN,,AUTO
         1 000030   300000 235100                    LDA     0,,PR3
         1 000031   000014 115007                    CMPA    12,DL
         1 000032   000034 602005 1                  TNC     s:12953+5,AL
         1 000033   000050 710000 1                  TRA     s:12955
         1 000034   000215 710000 1                  TRA     s:13029
         1 000035   000056 710000 1                  TRA     s:12968
         1 000036   000050 710000 1                  TRA     s:12955
         1 000037   000050 710000 1                  TRA     s:12955
         1 000040   000050 710000 1                  TRA     s:12955
         1 000041   000050 710000 1                  TRA     s:12955
         1 000042   000050 710000 1                  TRA     s:12955
         1 000043   000050 710000 1                  TRA     s:12955
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:24   
         1 000044   000050 710000 1                  TRA     s:12955
         1 000045   000050 710000 1                  TRA     s:12955
         1 000046   000050 710000 1                  TRA     s:12955
         1 000047   000053 710000 1                  TRA     s:12965

      197    12954    2             CASE(ELSE);

      198    12955    2               CALL SC_BMDFCN;

  12955  1 000050   000000 713400 xsym               CLIMB   SC_BMDFCN
         1 000051   000000 600000 xsid               climb   nvectors=         0
         1 000052   000264 710000 1                  TRA     s:13046

      199    12956        /*S*  SCREECH_CODE: KCI-S$BMDFCN
      200    12957              TYPE:    SUA
      201    12958              MESSAGE: Illegal function code passed to comgroup
      202    12959              REMARKS: The comgroup media layer accepts only reads and writes.
      203    12960                       This screech occurs when a formatting layer passes a file
      204    12961                       type media function.  This code is also reported by
      205    12962                       NKA$DEVIO (NKA-S$BMDFCN) and KIA$UCIO (KIA-BMDFCN) in
      206    12963                       similar situations.                                           */
      207    12964    2             CASE (MFC_WRBIN);

      208    12965    2               QFCN=%N_WRBIN;

  12965  1 000053   000003 235007                    LDA     3,DL
         1 000054   200067 755100                    STA     QFCN,,AUTO

      209    12966    2               GOTO WRITES;

  12966  1 000055   000060 710000 1                  TRA     WRITES

      210    12967    2             CASE (MFC_WRITE);

      211    12968    2               QFCN=%N_WRITE;

  12968  1 000056   000015 235007                    LDA     13,DL
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:25   
         1 000057   200067 755100                    STA     QFCN,,AUTO

      212    12969    2   WRITES:     IF DCB$->F$DCB.UBYTES >

  12969  1 000060   200060 474500       WRITES       LDP4    DCB$,,AUTO
         1 000061   400051 220100                    LDX0    41,,PR4
         1 000062   000000 475400 xsym               LDP5    N$DCT$$
         1 000063   500000 476510                    LDP6    0,X0,PR5
         1 000064   600027 477500                    LDP7    23,,PR6
         1 000065   700134 236100                    LDQ     92,,PR7
         1 000066   400076 116100                    CMPQ    62,,PR4
         1 000067   000073 603000 1                  TRC     s:12980

      213    12970    2               NK$LDCT$(DCB$->F$DCB.LDCTX)->NK$LDCT.CG$->KQ$CG.AUCTL.MAXMC THEN
      214    12971    3                 DO;

      215    12972    3                 B$JIT$->B$JIT.ERR=TOOBIG;

  12972  1 000070   000001 236000 0                  LDQ     TOOBIG
         1 000071   000012 756100                    STQ     10,,PR0

      216    12973        /*E*  ERROR:         KCI-E$TOOBIG-E
      217    12974               MESSAGE: Too many bytes written to comgroup.
      218    12975              MESSAGE1: The administrative user sets the maximum bytes written
      219    12976                        through a comgroup.  You tried to write more than that.
      220    12977        */
      221    12978    3                 ALTRETURN;

  12978  1 000072   000000 702200 xent               TSX2  ! X66_AALT

      222    12979    3                 END;
      223    12980    2               QOP=OP_USER|OP_BPF;

  12980  1 000073   410000 236003                    LDQ     -126976,DU
         1 000074   200070 756100                    STQ     QOP,,AUTO

      224    12981    2               ASTA=STA$->VLP$SETSTA.OSTA;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:26   

  12981  1 000075   200062 470500                    LDP0    STA$,,AUTO
         1 000076   000100 100500                    MLR     fill='000'O
         1 000077   000007 000024                    ADSC9   7,,PR0                   cn=0,n=20
         1 000100   200071 000040                    ADSC9   ASTA,,AUTO               cn=0,n=32

      225    12982    2               ASTA.MSGID# = 0;

  12982  1 000101   200076 450100                    STZ     ASTA+5,,AUTO

      226    12983    2               IF ENT=0 THEN

  12983  1 000102   200061 235100                    LDA     ENT,,AUTO
         1 000103   000140 601000 1                  TNZ     s:12995

      227    12984    2                CALL HFF$NILERASE (3)

  12984  1 000104   000000 630400 2                  EPPR0   0
         1 000105   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000106   000000 701000 xent               TSX1    HFF$NILERASE
         1 000107   000140 702000 1                  TSX2    s:12995

      228    12985    2                WHENRETURN
      229    12986    3                  DO;

      230    12987    3                  CALL HFF$DSIZ(3,MSIZ);

  12987  1 000110   200065 630500                    EPPR0   MSIZ,,AUTO
         1 000111   200107 450500                    STP0    DVE_VFC+4,,AUTO
         1 000112   000000 236000 2                  LDQ     0
         1 000113   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000114   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000115   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000116   000000 701000 xent               TSX1    HFF$DSIZ
         1 000117   000000 011000                    NOP     0

      231    12988    3                  IF (MSIZ >= SIZEC(VLP$STATION)) THEN
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:27   

  12988  1 000120   200065 235100                    LDA     MSIZ,,AUTO
         1 000121   000040 115007                    CMPA    32,DL
         1 000122   000134 602000 1                  TNC     s:12991

      232    12989    3                   CALL KCI$VALSTA (B$PS3$->VLP$STATION,ASTA) ALTRET(ALTRT);

  12989  1 000123   200071 630500                    EPPR0   ASTA,,AUTO
         1 000124   200107 450500                    STP0    DVE_VFC+4,,AUTO
         1 000125   000000 236000 xsym               LDQ     B$PS3$
         1 000126   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000127   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000130   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000131   000000 701000 xent               TSX1    KCI$VALSTA
         1 000132   000716 702000 1                  TSX2    ALTRT
         1 000133   000140 710000 1                  TRA     s:12995

      233    12990    4                  ELSE DO ;

      234    12991    4                    B$JIT$->B$JIT.ERR=BADVECTOR3;

  12991  1 000134   000005 236000 0                  LDQ     BADVECTOR3
         1 000135   000000 470400 xsym               LDP0    B$JIT$
         1 000136   000012 756100                    STQ     10,,PR0

      235    12992    4                    ALTRETURN;

  12992  1 000137   000000 702200 xent               TSX2  ! X66_AALT

      236    12993    4                    END;
      237    12994    3                  END;
      238    12995    2               IF ASTA.MSGTYP#~=' ' THEN

  12995  1 000140   040000 106500                    CMPC    fill='040'O
         1 000141   200073 000010                    ADSC9   ASTA+2,,AUTO             cn=0,n=8
         1 000142   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000143   000156 600000 1                  TZE     MOK
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:28   

      239    12996    3                 DO FOREVER;

      240    12997    3                 CALL INDEX (CMPCNT,'?',ASTA.MSGTYP#) ALTRET (MOK);

  12997  1 000144   000000 124500                    SCM     mask='000'O
         1 000145   200073 000010                    ADSC9   ASTA+2,,AUTO             cn=0,n=8
         1 000146   000001 000001 2                  ADSC9   1                        cn=0,n=1
         1 000147   200066 000100                    ARG     CMPCNT,,AUTO
         1 000150   000156 606400 1                  TTN     MOK

      241    12998    3                 CALL INSERT (ASTA.MSGTYP#,CMPCNT,1,' ');

  12998  1 000151   200066 235100                    LDA     CMPCNT,,AUTO
         1 000152   040105 100400                    MLR     fill='040'O
         1 000153   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000154   200073 000001                    ADSC9   ASTA+2,A,AUTO            cn=0,n=1

      242    12999    3                 END;

  12999  1 000155   000144 710000 1                  TRA     s:12997

      243    13000    2   MOK:        IF ASTA.STATION# = ' ' AND ASTA.CTL.ANYDCB# = '0'B THEN

  13000  1 000156   040000 106500       MOK          CMPC    fill='040'O
         1 000157   200071 000010                    ADSC9   ASTA,,AUTO               cn=0,n=8
         1 000160   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000161   000264 601000 1                  TNZ     s:13046
         1 000162   200075 236100                    LDQ     ASTA+4,,AUTO
         1 000163   002000 316003                    CANQ    1024,DU
         1 000164   000264 601000 1                  TNZ     s:13046

      244    13001    3                 DO;

      245    13002    3                 ASTA.STATION#=DCB$->F$DCB.LASTSTA$->VLP$STATION.STATION#;

  13002  1 000165   200060 470500                    LDP0    DCB$,,AUTO
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:29   
         1 000166   000007 471500                    LDP1    7,,PR0
         1 000167   040100 100500                    MLR     fill='040'O
         1 000170   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000171   200071 000010                    ADSC9   ASTA,,AUTO               cn=0,n=8

      246    13003    3                 IF ASTA.STATION#=' ' THEN

  13003  1 000172   040000 106500                    CMPC    fill='040'O
         1 000173   200071 000010                    ADSC9   ASTA,,AUTO               cn=0,n=8
         1 000174   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000175   000264 601000 1                  TNZ     s:13046

      247    13004    3                  IF DCB$->F$DCB.LASTSTA$->VLP$STATION.CTL.ANYDCB# THEN

  13004  1 000176   000007 471500                    LDP1    7,,PR0
         1 000177   100004 236100                    LDQ     4,,PR1
         1 000200   002000 316003                    CANQ    1024,DU
         1 000201   000205 600000 1                  TZE     s:13007

      248    13005    3                   ASTA.CTL.ANYDCB# = '1'B;

  13005  1 000202   002000 236003                    LDQ     1024,DU
         1 000203   200075 256100                    ORSQ    ASTA+4,,AUTO
         1 000204   000264 710000 1                  TRA     s:13046

      249    13006    3                  ELSE
      250    13007    3                   IF ASTA.STATION# = ' ' THEN

  13007  1 000205   040000 106500                    CMPC    fill='040'O
         1 000206   200071 000010                    ADSC9   ASTA,,AUTO               cn=0,n=8
         1 000207   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000210   000264 601000 1                  TNZ     s:13046

      251    13008    4                     DO;

      252    13009    4                     B$JIT$->B$JIT.ERR=NOSTA;

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:30   
  13009  1 000211   000002 236000 0                  LDQ     NOSTA
         1 000212   000000 473400 xsym               LDP3    B$JIT$
         1 000213   300012 756100                    STQ     10,,PR3

      253    13010        /*E* ERROR:        KCI-E$NOSTA-E
      254    13011             MESSAGE:      Null destination specified on comgroup service.
      255    13012             MESSAGE1:     For 'output' comgroup services (e.g. M$WRITE),
      256    13013                           the destination must be specified or defaulted.
      257    13014                           You specified ANYDCB = NO, and then either
      258    13015                           specified a blank STATION, or did not specify
      259    13016                           it and the default would be blanks.  Such
      260    13017                           an operation is legal only if a previous read
      261    13018                           or write has set the "last station read or
      262    13019                           written" in your DCB.
      263    13020            DESCRIPTION:   The user did an M$WRITE such that all of the
      264    13021                           available places to get STATION (VLP_STATION,
      265    13022                           VLP_SETSTA, and LASTSTA) were blank, and ANYDCB
      266    13023                           was reset.  He probably wants to specify station,
      267    13024                           or read before he writes. */
      268    13025    4                     ALTRETURN;

  13025  1 000214   000000 702200 xent               TSX2  ! X66_AALT

      269    13026    4                     END;
      270    13027    3                 END;
      271    13028    2             CASE(MFC_READ);

      272    13029    2               QFCN=%N_READ;

  13029  1 000215   000014 235007                    LDA     12,DL
         1 000216   200067 755100                    STA     QFCN,,AUTO

      273    13030    2               QOP=OP_USER|OP_BPF|OP_ARS;

  13030  1 000217   610000 236003                    LDQ     -61440,DU
         1 000220   200070 756100                    STQ     QOP,,AUTO

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:31   
      274    13031    2               ASTA=STA$->VLP$SETSTA.ISTA;

  13031  1 000221   200062 474500                    LDP4    STA$,,AUTO
         1 000222   000100 100500                    MLR     fill='000'O
         1 000223   400002 000024                    ADSC9   2,,PR4                   cn=0,n=20
         1 000224   200071 000040                    ADSC9   ASTA,,AUTO               cn=0,n=32

      275    13032    2               ASTA.MSGID# = 0;

  13032  1 000225   200076 450100                    STZ     ASTA+5,,AUTO

      276    13033    2               IF ENT=0 THEN

  13033  1 000226   200061 235100                    LDA     ENT,,AUTO
         1 000227   000264 601000 1                  TNZ     s:13046

      277    13034    2                CALL HFF$NILERASE (3)

  13034  1 000230   000000 630400 2                  EPPR0   0
         1 000231   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000232   000000 701000 xent               TSX1    HFF$NILERASE
         1 000233   000264 702000 1                  TSX2    s:13046

      278    13035    2                WHENRETURN
      279    13036    3                  DO;

      280    13037    3                  CALL HFF$DSIZ(3,MSIZ);

  13037  1 000234   200065 630500                    EPPR0   MSIZ,,AUTO
         1 000235   200107 450500                    STP0    DVE_VFC+4,,AUTO
         1 000236   000000 236000 2                  LDQ     0
         1 000237   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000240   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000241   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000242   000000 701000 xent               TSX1    HFF$DSIZ
         1 000243   000000 011000                    NOP     0

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:32   
      281    13038    3                  IF (MSIZ >= SIZEC(VLP$STATION)) THEN

  13038  1 000244   200065 235100                    LDA     MSIZ,,AUTO
         1 000245   000040 115007                    CMPA    32,DL
         1 000246   000260 602000 1                  TNC     s:13041

      282    13039    3                   CALL KCI$VALSTA (B$PS3$->VLP$STATION,ASTA) ALTRET(ALTRT);

  13039  1 000247   200071 630500                    EPPR0   ASTA,,AUTO
         1 000250   200107 450500                    STP0    DVE_VFC+4,,AUTO
         1 000251   000000 236000 xsym               LDQ     B$PS3$
         1 000252   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000253   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000254   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000255   000000 701000 xent               TSX1    KCI$VALSTA
         1 000256   000716 702000 1                  TSX2    ALTRT
         1 000257   000264 710000 1                  TRA     s:13046

      283    13040    4                  ELSE DO ;

      284    13041    4                    B$JIT$->B$JIT.ERR=BADVECTOR3;

  13041  1 000260   000005 236000 0                  LDQ     BADVECTOR3
         1 000261   000000 470400 xsym               LDP0    B$JIT$
         1 000262   000012 756100                    STQ     10,,PR0

      285    13042    4                    ALTRETURN;

  13042  1 000263   000000 702200 xent               TSX2  ! X66_AALT

      286    13043    4                    END;
      287    13044    3                  END;
      288    13045    2           END;

      289    13046    1         CALL CSEND;

  13046  1 000264   000717 701000 1                  TSX1    CSEND
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:33   
         1 000265   000000 011000                    NOP     0

      290    13047    1         IF B$JIT.ERR.CODE~=0 THEN ALTRETURN;

  13047  1 000266   000000 470400 xsym               LDP0    B$JIT$
         1 000267   000012 236100                    LDQ     10,,PR0
         1 000270   377770 316007                    CANQ    131064,DL
         1 000271   000273 600000 1                  TZE     s:13048

  13047  1 000272   000000 702200 xent               TSX2  ! X66_AALT

      291    13048    1         RETURN;

  13048  1 000273   000000 702200 xent               TSX2  ! X66_ARET

      292    13049        /**/
      293    13050        /*F* NAME:         KCI$TCTL
      294    13051             PURPOSE:      To provide the media layer for terminal
      295    13052                           control services to comgroups
      296    13053             DESCRIPTION:  Translates the passed media function into
      297    13054                           the appropriate calls to KCF and KI.  In some
      298    13055                           cases, we must go through the CG queue instead
      299    13056                           of around it (M$PROFILE).
      300    13057
      301    13058                           If we're doing M$PROFILE or M$STRMATTR and INPUT is
      302    13059                           changed, LDCT.LKFLG.INTOGGLE is set to signal that
      303    13060                           the LDCT.DFLG.INPUT must be changed and KCF$FERDS
      304    13061                           must be called.  This flag is checked in FEWRT
      305    13062                           when we're actually sending the message to the
      306    13063                           device.
      307    13064        */
      308    13065    1   KCI$TCTL: ENTRY (MFCN,DVBYTE,VFC,EVENT,PSST) ALTRET;

  13065  1 000274   000000 700200 xent  KCI$TCTL     TSX0  ! X66_AUTO_5
         1 000275   000112 000005                    ZERO    74,5

      309    13066        /**/
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:34   
      310    13067    1         CALL KCI$CKSTAT (LDCT$,CG$,ASTA.STATION#) ALTRET (ALTRT);

  13067  1 000276   200071 630500                    EPPR0   ASTA,,AUTO
         1 000277   200110 450500                    STP0    DVE_VFC+5,,AUTO
         1 000300   200064 631500                    EPPR1   CG$,,AUTO
         1 000301   200107 451500                    STP1    DVE_VFC+4,,AUTO
         1 000302   200063 633500                    EPPR3   LDCT$,,AUTO
         1 000303   200106 453500                    STP3    DVE_VFC+3,,AUTO
         1 000304   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000305   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000306   000000 701000 xent               TSX1    KCI$CKSTAT
         1 000307   000716 702000 1                  TSX2    ALTRT

      311    13068    2         IF LDCT$->LDCT.RESCOD=NK_CGFPRG THEN DO;

  13068  1 000310   200063 470500                    LDP0    LDCT$,,AUTO
         1 000311   000006 236100                    LDQ     6,,PR0
         1 000312   000017 376007                    ANQ     15,DL
         1 000313   000011 116007                    CMPQ    9,DL
         1 000314   000321 601000 1                  TNZ     s:13075

      312    13069    2           B$JIT.ERR=NFPTCTL;

  13069  1 000315   000004 236000 0                  LDQ     NFPTCTL
         1 000316   000000 471400 xsym               LDP1    B$JIT$
         1 000317   100012 756100                    STQ     10,,PR1

      313    13070        /*E* ERROR: KCI-E$NFPTCTL-E
      314    13071           MESSAGE: You may not issue terminal control services to an FPRG terminal
      315    13072        */
      316    13073    2           ALTRETURN;

  13073  1 000320   000000 702200 xent               TSX2  ! X66_AALT

      317    13074    2           END;
      318    13075    1         DCB$=B$JIT.DCB$;

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:35   
  13075  1 000321   000000 471400 xsym               LDP1    B$JIT$
         1 000322   100232 236100                    LDQ     154,,PR1
         1 000323   200060 756100                    STQ     DCB$,,AUTO

      319    13076    1         ASTA.CTL='0'B;

  13076  1 000324   000002 236000 2                  LDQ     2
         1 000325   200075 356100                    ANSQ    ASTA+4,,AUTO

      320    13077    1         ASTA.MSGTYP#='*TCTL';

  13077  1 000326   040100 100400                    MLR     fill='040'O
         1 000327   000006 000005 0                  ADSC9   BADVECTOR3+1             cn=0,n=5
         1 000330   200073 000010                    ADSC9   ASTA+2,,AUTO             cn=0,n=8

      321    13078    1         ASTA.MSGID# = 0;

  13078  1 000331   200076 450100                    STZ     ASTA+5,,AUTO

      322    13079    1         DVE_VFC=VFC;

  13079  1 000332   200005 473500                    LDP3    @VFC,,AUTO
         1 000333   040100 100500                    MLR     fill='040'O
         1 000334   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 000335   200103 000001                    ADSC9   DVE_VFC,,AUTO            cn=0,n=1

      323    13080    2           DO CASE (MFCN);

  13080  1 000336   200003 474500                    LDP4    @MFCN,,AUTO
         1 000337   400000 235100                    LDA     0,,PR4
         1 000340   000015 115007                    CMPA    13,DL
         1 000341   000343 602005 1                  TNC     s:13080+5,AL
         1 000342   000360 710000 1                  TRA     s:13082
         1 000343   000360 710000 1                  TRA     s:13082
         1 000344   000363 710000 1                  TRA     s:13084
         1 000345   000360 710000 1                  TRA     s:13082
         1 000346   000360 710000 1                  TRA     s:13082
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:36   
         1 000347   000360 710000 1                  TRA     s:13082
         1 000350   000360 710000 1                  TRA     s:13082
         1 000351   000360 710000 1                  TRA     s:13082
         1 000352   000360 710000 1                  TRA     s:13082
         1 000353   000360 710000 1                  TRA     s:13082
         1 000354   000526 710000 1                  TRA     s:13119
         1 000355   000360 710000 1                  TRA     s:13082
         1 000356   000363 710000 1                  TRA     s:13084
         1 000357   000622 710000 1                  TRA     s:13135

      324    13081    2             CASE (ELSE);

      325    13082    2               CALL SC_BMDFCN;  /* SUA */

  13082  1 000360   000000 713400 xsym               CLIMB   SC_BMDFCN
         1 000361   000000 600000 xsid               climb   nvectors=         0
         1 000362   000676 710000 1                  TRA     s:13145

      326    13083    2             CASE (MFC_WRITE,MFC_WRBIN);

      327    13084    2               QFCN=%N_WRITE;

  13084  1 000363   000015 235007                    LDA     13,DL
         1 000364   200067 755100                    STA     QFCN,,AUTO

      328    13085    2               QOP=OP_USER|OP_BPF;

  13085  1 000365   410000 236003                    LDQ     -126976,DU
         1 000366   200070 756100                    STQ     QOP,,AUTO

      329    13086    2               TCTL$=DCB$->F$DCB.UB$;

  13086  1 000367   200060 475500                    LDP5    DCB$,,AUTO
         1 000370   500075 236100                    LDQ     61,,PR5
         1 000371   200102 756100                    STQ     TCTL$,,AUTO

      330    13087    2               IF DVBYTE&DVBYTE_VFC AND DVE_VFC=%VFC_SPR THEN   /* M$PROFILE */
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:37   

  13087  1 000372   000000 236000 0                  LDQ     DVBYTE_VFC
         1 000373   777000 376003                    ANQ     -512,DU
         1 000374   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000375   200004 476500                    LDP6    @DVBYTE,,AUTO
         1 000376   000100 100500                    MLR     fill='000'O
         1 000377   600000 000001                    ADSC9   0,,PR6                   cn=0,n=1
         1 000400   200107 000004                    ADSC9   DVE_VFC+4,,AUTO          cn=0,n=4
         1 000401   200107 236100                    LDQ     DVE_VFC+4,,AUTO
         1 000402   200106 376100                    ANQ     DVE_VFC+3,,AUTO
         1 000403   000446 600000 1                  TZE     s:13101
         1 000404   200103 236100                    LDQ     DVE_VFC,,AUTO
         1 000405   777000 376003                    ANQ     -512,DU
         1 000406   025000 116003                    CMPQ    10752,DU
         1 000407   000446 601000 1                  TNZ     s:13101

      331    13088    3                 DO;

      332    13089                      %LOCK (G=LDCT$->LDCT.LOCK);

  13090  1 000410   200063 236100                    LDQ     LDCT$,,AUTO
         1 000411   000020 036003                    ADLQ    16,DU
         1 000412   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000413   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000414   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000415   000000 701000 xent               TSX1    HFC$LOCK
         1 000416   000000 011000                    NOP     0

      333    13092    3                 PRF_HDR$=ADDR(PSST)->B$PTR$;

  13092  1 000417   200007 470500                    LDP0    @PSST,,AUTO
         1 000420   000000 236100                    LDQ     0,,PR0
         1 000421   200101 756100                    STQ     PRF_HDR$,,AUTO

      334    13093    3                 IF PRF_HDR$->KL$PHDR.IO.INPUT~=LDCT$->LDCT.DFLG.INPUT THEN

  13093  1 000422   200101 471500                    LDP1    PRF_HDR$,,AUTO
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:38   
         1 000423   200063 473500                    LDP3    LDCT$,,AUTO
         1 000424   000100 066500                    CMPB    filb='0'B
         1 000425   100001 400001                    BDSC    1,,PR1                   by=2,bit=0,n=1
         1 000426   300006 400001                    BDSC    6,,PR3                   by=2,bit=0,n=1
         1 000427   000432 600000 1                  TZE     s:13096

      335    13094    3                  LDCT$->LDCT.LKFLG.INTOGGLE='1'B;

  13094  1 000430   000020 236003                    LDQ     16,DU
         1 000431   300011 256100                    ORSQ    9,,PR3

      336    13095                      /*N* MAY BE TURNING OFF OUTPUT BEFORE THE PROFILE CAN BE DELIVERED */
      337    13096    3                 LDCT$->LDCT.DFLG.OUTPUT=PRF_HDR$->KL$PHDR.IO.OUTPUT;

  13096  1 000432   200063 473500                    LDP3    LDCT$,,AUTO
         1 000433   003100 060500                    CSL     bolr='003'O
         1 000434   100001 410001                    BDSC    1,,PR1                   by=2,bit=1,n=1
         1 000435   300006 410001                    BDSC    6,,PR3                   by=2,bit=1,n=1

      338    13097                      %UNLOCK (G=LDCT$->LDCT.LOCK);

  13098  1 000436   200063 236100                    LDQ     LDCT$,,AUTO
         1 000437   000020 036003                    ADLQ    16,DU
         1 000440   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000441   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000442   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000443   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000444   000000 011000                    NOP     0

      339    13100    3                 END;

  13100  1 000445   000523 710000 1                  TRA     s:13117

      340    13101    2               ELSE IF TCTL.T=%KV_PRMID_TRMATTR THEN         /* M$STRMATTR */

  13101  1 000446   200102 477500                    LDP7    TCTL$,,AUTO
         1 000447   000100 101500                    MRL     fill='000'O
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:39   
         1 000450   700000 000001                    ADSC9   0,,PR7                   cn=0,n=1
         1 000451   200106 000004                    ADSC9   DVE_VFC+3,,AUTO          cn=0,n=4
         1 000452   200106 236100                    LDQ     DVE_VFC+3,,AUTO
         1 000453   000007 116007                    CMPQ    7,DL
         1 000454   000523 601000 1                  TNZ     s:13117

      341    13102    3                  DO;

      342    13103                       %LOCK (G=LDCT$->LDCT.LOCK);

  13104  1 000455   200063 236100                    LDQ     LDCT$,,AUTO
         1 000456   000020 036003                    ADLQ    16,DU
         1 000457   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000460   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000461   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000462   000000 701000 xent               TSX1    HFC$LOCK
         1 000463   000000 011000                    NOP     0

      343    13106    3                  IF ADDR(TCTL.M)->VLP$TRMATTR_V.INPUT~='01'B THEN

  13106  1 000464   200102 470500                    LDP0    TCTL$,,AUTO
         1 000465   000001 236100                    LDQ     1,,PR0
         1 000466   000300 376007                    ANQ     192,DL
         1 000467   000100 116007                    CMPQ    64,DL
         1 000470   000500 600000 1                  TZE     s:13110

      344    13107    3                   IF ADDR(TCTL.M)->VLP$TRMATTR_V.INPUT~=LDCT$->LDCT.DFLG.INPUT THEN

  13107  1 000471   200063 471500                    LDP1    LDCT$,,AUTO
         1 000472   000100 066500                    CMPB    filb='0'B
         1 000473   000001 610002                    BDSC    1,,PR0                   by=3,bit=1,n=2
         1 000474   100006 400001                    BDSC    6,,PR1                   by=2,bit=0,n=1
         1 000475   000500 600000 1                  TZE     s:13110

      345    13108    3                    LDCT$->LDCT.LKFLG.INTOGGLE='1'B;

  13108  1 000476   000020 236003                    LDQ     16,DU
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:40   
         1 000477   100011 256100                    ORSQ    9,,PR1

      346    13109                      /*N* MAY BE TURNING OFF OUTPUT BEFORE THE TRMATTR CAN BE DELIVERED */
      347    13110    3                  IF ADDR(TCTL.M)->VLP$TRMATTR_V.OUTPUT~='01'B THEN

  13110  1 000500   000001 236100                    LDQ     1,,PR0
         1 000501   000060 376007                    ANQ     48,DL
         1 000502   000020 116007                    CMPQ    16,DL
         1 000503   000512 600000 1                  TZE     s:13113

      348    13111    3                   LDCT$->LDCT.DFLG.OUTPUT=ADDR(TCTL.M)->VLP$TRMATTR_V.OUTPUT;

  13111  1 000504   200063 471500                    LDP1    LDCT$,,AUTO
         1 000505   000001 236100                    LDQ     1,,PR0
         1 000506   000013 736000                    QLS     11
         1 000507   100006 676100                    ERQ     6,,PR1
         1 000510   200000 376007                    ANQ     65536,DL
         1 000511   100006 656100                    ERSQ    6,,PR1

      349    13112                       %UNLOCK (G=LDCT$->LDCT.LOCK);

  13113  1 000512   200063 236100                    LDQ     LDCT$,,AUTO
         1 000513   000020 036003                    ADLQ    16,DU
         1 000514   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000515   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000516   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000517   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000520   000000 011000                    NOP     0

      350    13115    3                  DVE_VFC=%VFC_SPR;     /* so we recognize INTOGGLE in KCF$FEWRT */

  13115  1 000521   025000 236003                    LDQ     10752,DU
         1 000522   200103 756100                    STQ     DVE_VFC,,AUTO

      351    13116    3                  END;

      352    13117    2               CALL CSEND;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:41   

  13117  1 000523   000717 701000 1                  TSX1    CSEND
         1 000524   000000 011000                    NOP     0
         1 000525   000676 710000 1                  TRA     s:13145

      353    13118    2             CASE (MFC_RSTAT);

      354    13119    2               QFCN=%N_READ;

  13119  1 000526   000014 235007                    LDA     12,DL
         1 000527   200067 755100                    STA     QFCN,,AUTO

      355    13120    2               QOP=OP_USER|OP_BPF|OP_ARS;

  13120  1 000530   610000 236003                    LDQ     -61440,DU
         1 000531   200070 756100                    STQ     QOP,,AUTO

      356    13121    2               MSIZ=DCB$->F$DCB.UBYTES;

  13121  1 000532   200060 475500                    LDP5    DCB$,,AUTO
         1 000533   500076 235100                    LDA     62,,PR5
         1 000534   200065 755100                    STA     MSIZ,,AUTO

      357    13122    2               K$RWPARM = K_RWPARM_CON;

  13122  1 000535   000100 100400                    MLR     fill='000'O
         1 000536   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000537   200010 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      358    13123    2               K$RWPARM.STATION = DCB$->F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#;

  13123  1 000540   500006 476500                    LDP6    6,,PR5
         1 000541   040100 100500                    MLR     fill='040'O
         1 000542   600000 000010                    ADSC9   0,,PR6                   cn=0,n=8
         1 000543   200012 000010                    ADSC9   K$RWPARM+2,,AUTO         cn=0,n=8

      359    13124    2               K$RWPARM.MSGTYP = '*TCTL';
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:42   

  13124  1 000544   040100 100400                    MLR     fill='040'O
         1 000545   000006 000005 0                  ADSC9   BADVECTOR3+1             cn=0,n=5
         1 000546   200014 000010                    ADSC9   K$RWPARM+4,,AUTO         cn=0,n=8

      360    13125    2               K$RWPARM.PRMID = PCODE;

  13125  1 000547   000100 101500                    MRL     fill='000'O
         1 000550   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 000551   200055 400002                    ADSC9   K$RWPARM+37,,AUTO        cn=2,n=2

      361    13126    2               K$RWPARM.MAXRCRBYTSIZ = MZRD.T * 512 + MZRD.B;

  13126  1 000552   200065 236100                    LDQ     MSIZ,,AUTO
         1 000553   000377 376007                    ANQ     255,DL
         1 000554   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000555   200065 236100                    LDQ     MSIZ,,AUTO
         1 000556   000001 736000                    QLS     1
         1 000557   000003 376000 2                  ANQ     3
         1 000560   200106 036100                    ADLQ    DVE_VFC+3,,AUTO
         1 000561   000000 620006                    EAX0    0,QL
         1 000562   200052 740100                    STX0    K$RWPARM+34,,AUTO

      362    13127    2               CALL KCF$CKLDTKL (LDCT$->LDCT,CG$,ASTA.STATION#) ALTRET (DISC);

  13127  1 000563   200071 636500                    EPPR6   ASTA,,AUTO
         1 000564   200110 456500                    STP6    DVE_VFC+5,,AUTO
         1 000565   200064 637500                    EPPR7   CG$,,AUTO
         1 000566   200107 457500                    STP7    DVE_VFC+4,,AUTO
         1 000567   200063 236100                    LDQ     LDCT$,,AUTO
         1 000570   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000571   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000572   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000573   000000 701000 xent               TSX1    KCF$CKLDTKL
         1 000574   000713 702000 1                  TSX2    DISC

      363    13128    2              CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_RQSPRM,K$RWPARM) ALTRET(UNL_DISC)
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:43   
             13128                        ;

  13128  1 000575   200010 630500                    EPPR0   K$RWPARM,,AUTO
         1 000576   200110 450500                    STP0    DVE_VFC+5,,AUTO
         1 000577   000005 236000 2                  LDQ     5
         1 000600   200063 235100                    LDA     LDCT$,,AUTO
         1 000601   200106 757100                    STAQ    DVE_VFC+3,,AUTO
         1 000602   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000603   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000604   000000 701000 xent               TSX1    KIA$FCNOU
         1 000605   000704 702000 1                  TSX2    UNL_DISC

      364    13129                    %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

  13130  1 000606   200063 236100                    LDQ     LDCT$,,AUTO
         1 000607   000020 036003                    ADLQ    16,DU
         1 000610   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000611   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000612   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000613   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000614   000000 011000                    NOP     0

      365    13132    2               ASTA.CTL.DIRONLY#='1'B;

  13132  1 000615   004000 236003                    LDQ     2048,DU
         1 000616   200075 256100                    ORSQ    ASTA+4,,AUTO

      366    13133    2               CALL CSEND;

  13133  1 000617   000717 701000 1                  TSX1    CSEND
         1 000620   000000 011000                    NOP     0
         1 000621   000676 710000 1                  TRA     s:13145

      367    13134    2             CASE (MFC_TCTL);

      368    13135    2               TFCNU=TFCN;

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:44   
  13135  1 000622   200004 475500                    LDP5    @DVBYTE,,AUTO
         1 000623   000100 101500                    MRL     fill='000'O
         1 000624   500000 000001                    ADSC9   0,,PR5                   cn=0,n=1
         1 000625   200066 000004                    ADSC9   CMPCNT,,AUTO             cn=0,n=4

      369    13136    2               CALL KCF$CKLDTKL (LDCT$->LDCT,CG$,ASTA.STATION#) ALTRET (DISC);

  13136  1 000626   200071 636500                    EPPR6   ASTA,,AUTO
         1 000627   200110 456500                    STP6    DVE_VFC+5,,AUTO
         1 000630   200064 637500                    EPPR7   CG$,,AUTO
         1 000631   200107 457500                    STP7    DVE_VFC+4,,AUTO
         1 000632   200063 236100                    LDQ     LDCT$,,AUTO
         1 000633   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000634   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000635   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000636   000000 701000 xent               TSX1    KCF$CKLDTKL
         1 000637   000713 702000 1                  TSX2    DISC

      370    13137    2               IF TFCNU = 0 THEN

  13137  1 000640   200066 235100                    LDA     CMPCNT,,AUTO
         1 000641   000654 601000 1                  TNZ     s:13140

      371    13138    2                LDCT$->NK$LDCT.DFLG.NOSND = ~K$RWPARM.VDOFLGS.SEND;

  13138  1 000642   200050 236100                    LDQ     K$RWPARM+32,,AUTO
         1 000643   000016 736000                    QLS     14
         1 000644   400000 376003                    ANQ     -131072,DU
         1 000645   400000 676003                    ERQ     -131072,DU
         1 000646   200063 470500                    LDP0    LDCT$,,AUTO
         1 000647   000030 772000                    QRL     24
         1 000650   000006 676100                    ERQ     6,,PR0
         1 000651   004000 376007                    ANQ     2048,DL
         1 000652   000006 656100                    ERSQ    6,,PR0
         1 000653   000667 710000 1                  TRA     s:13142

      372    13139    2               ELSE
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:45   
      373    13140    2                CALL KIA$FCNOU (LDCT$->LDCT,TFCNU,ADDR(PSST)->B$PTR$->B$RWPARM) ALTRET
             13140                         (UNL_DISC);

  13140  1 000654   200007 470500                    LDP0    @PSST,,AUTO
         1 000655   000000 471500                    LDP1    0,,PR0
         1 000656   200110 451500                    STP1    DVE_VFC+5,,AUTO
         1 000657   200066 633500                    EPPR3   CMPCNT,,AUTO
         1 000660   200107 453500                    STP3    DVE_VFC+4,,AUTO
         1 000661   200063 236100                    LDQ     LDCT$,,AUTO
         1 000662   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000663   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000664   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000665   000000 701000 xent               TSX1    KIA$FCNOU
         1 000666   000704 702000 1                  TSX2    UNL_DISC

      374    13141                    %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

  13142  1 000667   200063 236100                    LDQ     LDCT$,,AUTO
         1 000670   000020 036003                    ADLQ    16,DU
         1 000671   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000672   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000673   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000674   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000675   000000 011000                    NOP     0

      375    13144    2           END;

      376    13145    1         IF B$JIT.ERR.CODE ~= 0 THEN ALTRETURN;

  13145  1 000676   000000 470400 xsym               LDP0    B$JIT$
         1 000677   000012 236100                    LDQ     10,,PR0
         1 000700   377770 316007                    CANQ    131064,DL
         1 000701   000703 600000 1                  TZE     s:13146

  13145  1 000702   000000 702200 xent               TSX2  ! X66_AALT

      377    13146    1         RETURN;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:46   

  13146  1 000703   000000 702200 xent               TSX2  ! X66_ARET

  13145  1 000704                       UNL_DISC     null
      378    13147        /**/
      379    13148    1   UNL_DISC: ;
      380    13149              %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

  13150  1 000704   200063 236100                    LDQ     LDCT$,,AUTO
         1 000705   000020 036003                    ADLQ    16,DU
         1 000706   200106 756100                    STQ     DVE_VFC+3,,AUTO
         1 000707   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000710   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000711   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000712   000000 011000                    NOP     0

  13145  1 000713                       DISC         null
      381    13152    1   DISC: ;
      382    13153    1         B$JIT.ERR=LDSC;

  13153  1 000713   000003 236000 0                  LDQ     LDSC
         1 000714   000000 470400 xsym               LDP0    B$JIT$
         1 000715   000012 756100                    STQ     10,,PR0

  13153  1 000716                       ALTRT        null
      383    13154        /*E*  ERROR:    KCI-E$LDSC-E
      384    13155               MESSAGE: That station is not connected.
      385    13156              MESSAGE1: Terminal control services require that the
      386    13157                        addressed station be connected during the
      387    13158                        service.  The one you specified is not.
      388    13159              DESCRIPTION: This is independent of WAS, RAS.                          */
      389    13160    1   ALTRT:;
      390    13161    1         ALTRETURN;

  13161  1 000716   000000 702200 xent               TSX2  ! X66_AALT

      391    13162        %EJECT;
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:47   
      392    13163        /**/
      393    13164        /******************************************************************************
      394    13165        *                                                                             *
      395    13166        *  SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS  *
      396    13167        * S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S *
      397    13168        * S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S     *
      398    13169        *  SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS  *
      399    13170        *     S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S *
      400    13171        * S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S *
      401    13172        *  SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS  *
      402    13173        *                                                                             *
      403    13174        ******************************************************************************/
      404    13175
      405    13176        /****************************************************************
      406    13177        *****************************************************************/
      407    13178        /*D* NAME:         CSEND
      408    13179             PURPOSE:      To perform the call to KQR/KQW via IOQ
      409    13180             DESCRIPTION:  Gets an IOQ packet, initializes it, and calls
      410    13181                           NIO$QUE to start the IO. */
      411    13182    1   CSEND: PROC;

  13182  1 000717   200104 741300       CSEND        STX1  ! DVE_VFC+1,,AUTO

      412    13183        /**/
      413    13184    2         CALL NIQ$GET (IOQ$);

  13184  1 000720   200066 630500                    EPPR0   CMPCNT,,AUTO
         1 000721   200106 450500                    STP0    DVE_VFC+3,,AUTO
         1 000722   200106 630500                    EPPR0   DVE_VFC+3,,AUTO
         1 000723   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000724   000000 701000 xent               TSX1    NIQ$GET
         1 000725   000000 011000                    NOP     0

      414    13185    2         N$REQ.FC=QFCN;

  13185  1 000726   200066 470500                    LDP0    CMPCNT,,AUTO
         1 000727   200067 236100                    LDQ     QFCN,,AUTO
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:48   
         1 000730   000003 552104                    STBQ    3,'04'O,PR0

      415    13186    2         N$REQ.USER#=B$JIT.USER;

  13186  1 000731   000000 470400 xsym               LDP0    B$JIT$
         1 000732   200066 471500                    LDP1    CMPCNT,,AUTO
         1 000733   000000 236100                    LDQ     0,,PR0
         1 000734   000022 772000                    QRL     18
         1 000735   100027 552104                    STBQ    23,'04'O,PR1

      416    13187    2         N$REQ.BUF$=DCB$->F$DCB.UB$;

  13187  1 000736   200060 471500                    LDP1    DCB$,,AUTO
         1 000737   100075 236100                    LDQ     61,,PR1
         1 000740   200066 473500                    LDP3    CMPCNT,,AUTO
         1 000741   300005 756100                    STQ     5,,PR3

      417    13188    2         N$REQ.BUFSIZE=DCB$->F$DCB.UBYTES;

  13188  1 000742   200066 473500                    LDP3    CMPCNT,,AUTO
         1 000743   100076 236100                    LDQ     62,,PR1
         1 000744   000020 736000                    QLS     16
         1 000745   300004 676100                    ERQ     4,,PR3
         1 000746   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 000747   300004 656100                    ERSQ    4,,PR3

      418    13189    2         N$REQ.DCB$=DCB$;

  13189  1 000750   200060 236100                    LDQ     DCB$,,AUTO
         1 000751   200066 473500                    LDP3    CMPCNT,,AUTO
         1 000752   300022 756100                    STQ     18,,PR3

      419    13190    2         N$REQ.DLA.DCTX=DCB$->F$DCB.LDCTX;

  13190  1 000753   200066 473500                    LDP3    CMPCNT,,AUTO
         1 000754   100051 236100                    LDQ     41,,PR1
         1 000755   000003 736000                    QLS     3
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:49   
         1 000756   300001 676100                    ERQ     1,,PR3
         1 000757   777770 376003                    ANQ     -8,DU
         1 000760   300001 656100                    ERSQ    1,,PR3

      420    13191    2         N$REQ.DVE.DVBYTE=DVBYTE;

  13191  1 000761   200004 473500                    LDP3    @DVBYTE,,AUTO
         1 000762   200066 474500                    LDP4    CMPCNT,,AUTO
         1 000763   000100 100500                    MLR     fill='000'O
         1 000764   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 000765   400031 000001                    ADSC9   25,,PR4                  cn=0,n=1

      421    13192    2         N$REQ.OPFLG=QOP;

  13192  1 000766   200066 474500                    LDP4    CMPCNT,,AUTO
         1 000767   200070 236100                    LDQ     QOP,,AUTO
         1 000770   000033 772000                    QRL     27
         1 000771   400004 552104                    STBQ    4,'04'O,PR4

      422    13193    2         IF N$REQ.DVE.DVBYTE.VFC THEN

  13193  1 000772   200066 474500                    LDP4    CMPCNT,,AUTO
         1 000773   400031 236100                    LDQ     25,,PR4
         1 000774   100000 316003                    CANQ    32768,DU
         1 000775   001001 600000 1                  TZE     s:13195

      423    13194    2          N$REQ.DVE.VFC=DVE_VFC;

  13194  1 000776   200103 236100                    LDQ     DVE_VFC,,AUTO
         1 000777   000011 772000                    QRL     9
         1 001000   400031 552120                    STBQ    25,'20'O,PR4

      424    13195    2         IF DCB$->F$DCB.WAIT=1 THEN N$REQ.OPFLG.WAIT='1'B;

  13195  1 001001   100064 236100                    LDQ     52,,PR1
         1 001002   000020 376007                    ANQ     16,DL
         1 001003   000020 116007                    CMPQ    16,DL
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:50   
         1 001004   001011 601000 1                  TNZ     s:13198

  13195  1 001005   200066 474500                    LDP4    CMPCNT,,AUTO
         1 001006   000020 236007                    LDQ     16,DL
         1 001007   400004 256100                    ORSQ    4,,PR4
         1 001010   001026 710000 1                  TRA     s:13202

      425    13196    2         ELSE
      426    13197    3           DO;

      427    13198    3           N$REQ.EVNTINFO=EVENT;

  13198  1 001011   200006 474500                    LDP4    @EVENT,,AUTO
         1 001012   200066 475500                    LDP5    CMPCNT,,AUTO
         1 001013   400000 235100                    LDA     0,,PR4
         1 001014   500026 755100                    STA     22,,PR5

      428    13199    3           N$REQ.NWIO=0;               /*NO-WAIT*/

  13199  1 001015   200066 475500                    LDP5    CMPCNT,,AUTO
         1 001016   000006 236000 2                  LDQ     6
         1 001017   500031 356100                    ANSQ    25,,PR5

      429    13200    3           N$REQ.WSR=B_MPT.SS$->B$SS.ISR.WSR; /* Give event to the right domain */

  13200  1 001020   000000 475400 xsym               LDP5    B_MPT
         1 001021   200066 476500                    LDP6    CMPCNT,,AUTO
         1 001022   500010 236100                    LDQ     8,,PR5
         1 001023   000160 376007                    ANQ     112,DL
         1 001024   000004 772000                    QRL     4
         1 001025   600031 552104                    STBQ    25,'04'O,PR6

      430    13201    3           END;

      431    13202    2         N$REQ.STATION.LSTA$=ADDR(ASTA);

  13202  1 001026   200071 634500                    EPPR4   ASTA,,AUTO
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:51   
         1 001027   200066 475500                    LDP5    CMPCNT,,AUTO
         1 001030   500013 454500                    STP4    11,,PR5

      432    13203    2         CALL NIO$QUE (N$REQ);

  13203  1 001031   200066 630500                    EPPR0   CMPCNT,,AUTO
         1 001032   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001033   000000 701000 xent               TSX1    NIO$QUE
         1 001034   000000 011000                    NOP     0

      433    13204    2         RETURN;

  13204  1 001035   200104 221300                    LDX1  ! DVE_VFC+1,,AUTO
         1 001036   000001 702211                    TSX2  ! 1,X1

DVBYTE_VFC
 Sect OctLoc
   0     000   100*** ******                                                    @...

TOOBIG
 Sect OctLoc
   0     001   130311 415354                                                    X...

NOSTA
 Sect OctLoc
   0     002   130311 415344                                                    X...

LDSC
 Sect OctLoc
   0     003   130311 400144                                                    X..d

NFPTCTL
 Sect OctLoc
   0     004   130311 415764                                                    X...

BADVECTOR3
 Sect OctLoc
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:52   
   0     005   130311 406474                                                    X...

(unnamed)
 Sect OctLoc
   0     006   052124 103124   114040 040040                                    *TCTL

(unnamed)
 Sect OctLoc
   2     000   000005 006000   077040 040040   000377 777777   777777 777000    ....?   ........
   2     004   000000 000027   000004 006000   777777 377777                    ............
      434    13205    2   END CSEND;
      435    13206        /**/
      436    13207    1   END KCI$RWCG;
      437    13208        /**/
      438    13209        /**/
      439    13210        %EOD;

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:53   
--  Include file information  --

   KV_PRMID_E.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B$SS.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KCI$RWCG.
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:54   

 **** Variables and constants ****

  ****  Section 000 RoData KCI$RWCG

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/b STRC        r     1 BADVECTOR3                 0-0-0/b BIT (9)     r     1 DVBYTE_VFC
     3-0-0/b STRC        r     1 LDSC                       4-0-0/b STRC        r     1 NFPTCTL
     2-0-0/b STRC        r     1 NOSTA                      1-0-0/b STRC        r     1 TOOBIG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @DVBYTE                    6-0-0/w PTR         r     1 @EVENT
     3-0-0/w PTR         r     1 @MFCN                      7-0-0/w PTR         r     1 @PSST
     5-0-0/w PTR         r     1 @VFC                      71-0-0/w STRC(288)   r     1 ASTA
    64-0-0/w PTR         r     1 CG$                       66-0-0/w UBIN        r     1 CMPCNT
    60-0-0/w PTR         r     1 DCB$                      *0-0-0/c BIT (9)     r     1 DVBYTE
   103-0-0/c CHAR        r     1 DVE_VFC                   61-0-0/w UBIN        r     1 ENT
    *0-0-0/w UBIN        r     1 EVENT                     66-0-0/w PTR         r     1 IOQ$
    10-0-0/d STRC(1404)  r     1 K$RWPARM                  63-0-0/w PTR         r     1 LDCT$
    *0-0-0/w UBIN        r     1 MFCN                      65-0-0/w UBIN        r     1 MSIZ
    65-0-0/w STRC        r     1 MZRD                      *0-0-0/c UBIN(9)     r     1 PCODE
   101-0-0/w PTR         r     1 PRF_HDR$                  *0-0-0/w STRC(432)   r     1 PSST
    67-0-0/w UBIN        r     1 QFCN                      70-0-0/w BIT         r     1 QOP
    62-0-0/w PTR         r     1 STA$                     102-0-0/w PTR         r     1 TCTL$
    *0-0-0/c UBIN(9)     r     1 TFCN                      66-0-0/w UBIN        r     1 TFCNU
    *0-0-0/c CHAR        r     1 VFC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:55   
     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS3$
     0-0-0/d STRC(432)   r     1 B_MPT                      0-0-0/d STRC(1404)  r     1 K_RWPARM_CON
     0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(7560)  r     1 B$JIT                      0-0-0/w PTR         r     1 B$PTR$
     0-0-0/d STRC(1404)  r     1 B$RWPARM                   0-0-0/d STRC(2304)  r     1 B$SS
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/c STRC(720)   r     1 KL$PHDR
     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d STRC(1080)  r     1 N$REQ
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/c STRC(540)   r     1 TCTL                       0-0-0/w STRC(432)   r     1 VLP$SETSTA
     0-0-0/w STRC(288)   r     1 VLP$STATION                0-0-0/d STRC(360)   r     1 VLP$TRMATTR_V


   Procedure KCI$RWCG requires 543 words for executable code.
   Procedure KCI$RWCG requires 74 words of local(AUTO) storage.
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:56   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:57   
          MINI XREF LISTING

ALTRT
     13153**LABEL   12989--CALLALT 13039--CALLALT 13067--CALLALT
ASTA
     12769**DCL     12981<<ASSIGN  12989<>CALL    13031<<ASSIGN  13039<>CALL    13202--ASSIGN
ASTA.CTL
     12773**DCL     13076<<ASSIGN
ASTA.CTL.ANYDCB#
     12776**DCL     13000>>IF      13005<<ASSIGN
ASTA.CTL.DIRONLY#
     12776**DCL     13132<<ASSIGN
ASTA.MSGID#
     12779**DCL     12982<<ASSIGN  13032<<ASSIGN  13078<<ASSIGN
ASTA.MSGIDXT
     12779**DCL     12782--REDEF
ASTA.MSGTYP#
     12773**DCL     12995>>IF      12997>>CALLBLT 12998<<CALLBLT 13077<<ASSIGN
ASTA.STATION#
     12773**DCL     13000>>IF      13002<<ASSIGN  13003>>IF      13007>>IF      13067<>CALL    13127<>CALL
     13136<>CALL
B$JIT.DCB$
     11010**DCL     12935>>ASSIGN  12949>>ASSIGN  13075>>ASSIGN
B$JIT.ERR
     10920**DCL     12972<<ASSIGN  12991<<ASSIGN  13009<<ASSIGN  13041<<ASSIGN  13069<<ASSIGN  13153<<ASSIGN
B$JIT.ERR.CODE
     10921**DCL     13047>>IF      13145>>IF
B$JIT.ERR.MID
     10921**DCL     10921--REDEF
B$JIT.USER
     10920**DCL     13186>>ASSIGN
B$JIT$
     12838**DCL     10915--IMP-PTR 12935>>ASSIGN  12949>>ASSIGN  12972>>ASSIGN  12991>>ASSIGN  13009>>ASSIGN
     13041>>ASSIGN  13047>>IF      13069>>ASSIGN  13075>>ASSIGN  13145>>IF      13153>>ASSIGN  13186>>ASSIGN
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:58   
B$PS3$
     12837**DCL     12989>>CALL    13039>>CALL
B$PTR$
     12416**DCL     13092>>ASSIGN  13140>>CALL
B$RWPARM
     12058**DCL     13140<>CALL
B$RWPARM.BLKREC
     12084**DCL     12109--REDEF
B$RWPARM.BLKREC.BLKU#
     12085**DCL     12087--REDEF
B$RWPARM.BLKREC.RECU#
     12097**DCL     12099--REDEF
B$RWPARM.DVE.DVBYTE.VFC
     12124**DCL     12125--REDEF
B$RWPARM.DVE.EOMCHAR
     12132**DCL     12136--REDEF
B$RWPARM.ERR
     12196**DCL     12201--REDEF
B$RWPARM.FC
     12160**DCL     12161--REDEF
B$RWPARM.FLDID
     12342**DCL     12343--REDEF
B$RWPARM.FPT$
     12223**DCL     12230--REDEF
B$RWPARM.KEYTYPE
     12349**DCL     12350--REDEF
B$RWPARM.MSG$
     12059**DCL     12065--REDEF
B$RWPARM.MSGID
     12171**DCL     12176--REDEF
B$RWPARM.MSGIDXT
     12184**DCL     12188--REDEF
B$RWPARM.ORG
     12320**DCL     12321--REDEF
B$RWPARM.THDRSZ
     12264**DCL     12268--REDEF
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:59   
B$RWPARM.VDOFLGS
     12322**DCL     12333--REDEF
B$SS.ISR.WSR
       414**DCL     13200>>ASSIGN
B$SS.RVA
       409**DCL       410--REDEF
BADVECTOR3
     12819**DCL     12991>>ASSIGN  13041>>ASSIGN
B_MPT.AS
     12875**DCL     12878--REDEF
B_MPT.ASDESC
     12907**DCL     12911--REDEF
B_MPT.ECCB
     12890**DCL     12893--REDEF
B_MPT.ECCBDESC
     12925**DCL     12929--REDEF
B_MPT.LS
     12870**DCL     12873--REDEF
B_MPT.LSDESC
     12901**DCL     12905--REDEF
B_MPT.PS
     12880**DCL     12883--REDEF
B_MPT.PSDESC
     12913**DCL     12917--REDEF
B_MPT.SS
     12865**DCL     12868--REDEF
B_MPT.SS$
     12868**DCL     13200>>ASSIGN
B_MPT.SSDESC
     12895**DCL     12899--REDEF
B_MPT.TCB
     12885**DCL     12888--REDEF
B_MPT.TCBDESC
     12919**DCL     12923--REDEF
CG$
     12747**DCL     13067<>CALL    13127<>CALL    13136<>CALL
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:60   
CMPCNT
     12752**DCL     12753--REDEF   12754--REDEF   12997<<CALLBLT 12998>>CALLBLT
CSEND
     13182**PROC    13046--CALL    13117--CALL    13133--CALL
DCB$
     12743**DCL     12935<<ASSIGN  12949<<ASSIGN  12950>>ASSIGN  12969>>IF      12969>>IF      13002>>ASSIGN
     13004>>IF      13075<<ASSIGN  13086>>ASSIGN  13121>>ASSIGN  13123>>ASSIGN  13187>>ASSIGN  13188>>ASSIGN
     13189>>ASSIGN  13190>>ASSIGN  13195>>IF
DISC
     13145**LABEL   13127--CALLALT 13136--CALLALT
DVBYTE
     10874**DCL        34--PROC    10875--REDEF   12946--ENTRY   13065--ENTRY   13087>>IF      13191>>ASSIGN
DVBYTE_VFC
     12801**DCL     13087>>IF
DVE_VFC
     12786**DCL     12952<<ASSIGN  13079<<ASSIGN  13087>>IF      13115<<ASSIGN  13194>>ASSIGN
ENT
     12744**DCL     12934<<ASSIGN  12948<<ASSIGN  12983>>IF      13033>>IF
EVENT
     10879**DCL        34--PROC    12946--ENTRY   13065--ENTRY   13198>>ASSIGN
F$DCB.ACTPOS
       680**DCL       680--REDEF
F$DCB.ARS
       655**DCL       655--REDEF
F$DCB.ATTR
       673**DCL       674--REDEF
F$DCB.BORROW
       688**DCL       688--REDEF     688--REDEF     688--REDEF
F$DCB.DCBNAME.L
       702**DCL       702--IMP-SIZ
F$DCB.EOMCHAR
       659**DCL       659--REDEF
F$DCB.FLDID
       683**DCL       683--REDEF
F$DCB.FORM$
       677**DCL       677--REDEF
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:61   
F$DCB.FSECT
       693**DCL       693--REDEF
F$DCB.FSN
       670**DCL       670--REDEF     670--REDEF     671--REDEF
F$DCB.HEADER$
       676**DCL       676--REDEF
F$DCB.IXTNSIZE
       674**DCL       674--REDEF
F$DCB.LASTSTA$
       664**DCL       664--REDEF   13002>>ASSIGN  13004>>IF
F$DCB.LDCTX
       677**DCL     12969>>IF      13190>>ASSIGN
F$DCB.LVL
       689**DCL       689--REDEF
F$DCB.NAME.C
       664**DCL       664--REDEF
F$DCB.NOEOF
       685**DCL       685--REDEF
F$DCB.NRECS
       675**DCL       675--REDEF
F$DCB.NRECX
       694**DCL       694--REDEF
F$DCB.OHDR
       686**DCL       686--REDEF
F$DCB.ORG
       669**DCL       669--REDEF
F$DCB.PRECNO
       692**DCL       692--REDEF
F$DCB.RCSZ
       697**DCL       697--REDEF
F$DCB.RES
       665**DCL       665--REDEF
F$DCB.SETSTA$
       664**DCL     12950>>ASSIGN  13123>>ASSIGN
F$DCB.SETX
       677**DCL       677--REDEF
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:62   
F$DCB.TAB$
       676**DCL       677--REDEF
F$DCB.TDA
       691**DCL       691--REDEF
F$DCB.UB$
       693**DCL     13086>>ASSIGN  13187>>ASSIGN
F$DCB.UBYTES
       693**DCL     12969>>IF      13121>>ASSIGN  13188>>ASSIGN
F$DCB.WAIT
       687**DCL     13195>>IF
F$DCB.WSN
       666**DCL       666--REDEF
HFC$LOCK
      9824**DCL-ENT 13090--CALL    13104--CALL
HFC$UNLOCK
      9824**DCL-ENT 13098--CALL    13113--CALL    13130--CALL    13142--CALL    13150--CALL
HFF$DSIZ
     12829**DCL-ENT 12987--CALL    13037--CALL
HFF$NILERASE
     12828**DCL-ENT 12984--CALL    13034--CALL
IOQ$
     12753**DCL     11081--IMP-PTR 13184<>CALL    13185>>ASSIGN  13186>>ASSIGN  13187>>ASSIGN  13188>>ASSIGN
     13189>>ASSIGN  13190>>ASSIGN  13191>>ASSIGN  13192>>ASSIGN  13193>>IF      13194>>ASSIGN  13195>>ASSIGN
     13198>>ASSIGN  13199>>ASSIGN  13200>>ASSIGN  13202>>ASSIGN  13203>>CALL
K$RWPARM
     12448**DCL     13122<<ASSIGN  13128<>CALL
K$RWPARM.BLKREC
     12474**DCL     12499--REDEF
K$RWPARM.BLKREC.BLKU#
     12475**DCL     12477--REDEF
K$RWPARM.BLKREC.RECU#
     12487**DCL     12489--REDEF
K$RWPARM.DVE.DVBYTE.VFC
     12514**DCL     12515--REDEF
K$RWPARM.DVE.EOMCHAR
     12522**DCL     12526--REDEF
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:63   
K$RWPARM.ERR
     12586**DCL     12591--REDEF
K$RWPARM.FC
     12550**DCL     12551--REDEF
K$RWPARM.FLDID
     12732**DCL     12733--REDEF
K$RWPARM.FPT$
     12613**DCL     12620--REDEF
K$RWPARM.KEYTYPE
     12739**DCL     12740--REDEF
K$RWPARM.MAXRCRBYTSIZ
     12728**DCL     13126<<ASSIGN
K$RWPARM.MSG$
     12449**DCL     12455--REDEF
K$RWPARM.MSGID
     12561**DCL     12566--REDEF
K$RWPARM.MSGIDXT
     12574**DCL     12578--REDEF
K$RWPARM.MSGTYP
     12465**DCL     13124<<ASSIGN
K$RWPARM.ORG
     12710**DCL     12711--REDEF
K$RWPARM.PRMID
     12733**DCL     13125<<ASSIGN
K$RWPARM.STATION
     12460**DCL     13123<<ASSIGN
K$RWPARM.THDRSZ
     12654**DCL     12658--REDEF
K$RWPARM.VDOFLGS
     12712**DCL     12723--REDEF
K$RWPARM.VDOFLGS.SEND
     12720**DCL     13138>>ASSIGN
KCF$CKLDTKL
     12832**DCL-ENT 13127--CALL    13136--CALL
KCI$CKSTAT
     12833**DCL-ENT 13067--CALL
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:64   
KCI$VALSTA
     12834**DCL-ENT 12989--CALL    13039--CALL
KIA$FCNOU
     12835**DCL-ENT 13128--CALL    13140--CALL
KL$PHDR.IO.INPUT
     12382**DCL     13093>>IF
KL$PHDR.IO.OUTPUT
     12383**DCL     13096>>ASSIGN
KQ$CG.AUCTL.DVBYTE.REREAD
     11634**DCL     11635--REDEF
KQ$CG.AUCTL.MAXMC
     11634**DCL     12969>>IF
K_RWPARM_CON
     10240**DCL     13122>>ASSIGN
K_RWPARM_CON.BLKREC
     10266**DCL     10291--REDEF
K_RWPARM_CON.BLKREC.BLKU#
     10267**DCL     10269--REDEF
K_RWPARM_CON.BLKREC.RECU#
     10279**DCL     10281--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
     10306**DCL     10307--REDEF
K_RWPARM_CON.DVE.EOMCHAR
     10314**DCL     10318--REDEF
K_RWPARM_CON.ERR
     10378**DCL     10383--REDEF
K_RWPARM_CON.FC
     10342**DCL     10343--REDEF
K_RWPARM_CON.FLDID
     10524**DCL     10525--REDEF
K_RWPARM_CON.FPT$
     10405**DCL     10412--REDEF
K_RWPARM_CON.KEYTYPE
     10531**DCL     10532--REDEF
K_RWPARM_CON.MSG$
     10241**DCL     10247--REDEF
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:65   
K_RWPARM_CON.MSGID
     10353**DCL     10358--REDEF
K_RWPARM_CON.MSGIDXT
     10366**DCL     10370--REDEF
K_RWPARM_CON.ORG
     10502**DCL     10503--REDEF
K_RWPARM_CON.THDRSZ
     10446**DCL     10450--REDEF
K_RWPARM_CON.VDOFLGS
     10504**DCL     10515--REDEF
LDCT$
     12746**DCL     13067<>CALL    13068>>IF      13090>>CALL    13093>>IF      13094>>ASSIGN  13096>>ASSIGN
     13098>>CALL    13104>>CALL    13107>>IF      13108>>ASSIGN  13111>>ASSIGN  13113>>CALL    13127>>CALL
     13128>>CALL    13130>>CALL    13136>>CALL    13138>>ASSIGN  13140>>CALL    13142>>CALL    13150>>CALL
LDSC
     12811**DCL     13153>>ASSIGN
MFCN
     10873**DCL        34--PROC    12946--ENTRY   12953>>DOCASE  13065--ENTRY   13080>>DOCASE
MOK
     13000**LABEL   12997--CALLALT
MSIZ
     12748**DCL     12749--REDEF   12987<>CALL    12988>>IF      13037<>CALL    13038>>IF      13121<<ASSIGN
MZRD.B
     12751**DCL     13126>>ASSIGN
MZRD.T
     12750**DCL     13126>>ASSIGN
N$DCT$$
      6160**DCL      6160--IMP-PTR 12969>>IF
N$REQ
     11081**DCL     13203<>CALL
N$REQ.BUF$
     11090**DCL     13187<<ASSIGN
N$REQ.BUFADDR
     11090**DCL     11091--REDEF   11091--REDEF
N$REQ.BUFSIZE
     11084**DCL     13188<<ASSIGN
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:66   
N$REQ.DCB$
     11112**DCL     13189<<ASSIGN
N$REQ.DLA.DCTX
     11081**DCL     13190<<ASSIGN
N$REQ.DLA.DRELADDR
     11082**DCL     11082--REDEF
N$REQ.DVE.DVBYTE
     11116**DCL     13191<<ASSIGN
N$REQ.DVE.DVBYTE.VFC
     11117**DCL     13193>>IF
N$REQ.DVE.EOMCHAR
     11119**DCL     11120--REDEF
N$REQ.DVE.VFC
     11120**DCL     13194<<ASSIGN
N$REQ.EAINFO
     11113**DCL     11113--REDEF
N$REQ.EAINFOX
     11113**DCL     11114--REDEF
N$REQ.EVNTINFO
     11114**DCL     11114--REDEF   13198<<ASSIGN
N$REQ.FC
     11084**DCL     13185<<ASSIGN
N$REQ.NWIO
     11120**DCL     13199<<ASSIGN
N$REQ.OPFLG
     11087**DCL     13192<<ASSIGN
N$REQ.OPFLG.WAIT
     11088**DCL     13195<<ASSIGN
N$REQ.STATION.LSTA$
     11094**DCL     13202<<ASSIGN
N$REQ.STATUS
     11095**DCL     11101--REDEF
N$REQ.USER#
     11115**DCL     13186<<ASSIGN
N$REQ.WSR
     11122**DCL     13200<<ASSIGN
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:67   
NFPTCTL
     12815**DCL     13069>>ASSIGN
NIO$QUE
     12830**DCL-ENT 13203--CALL
NIQ$GET
     12831**DCL-ENT 13184--CALL
NK$LDCT
     11143**DCL     13127<>CALL    13128<>CALL    13136<>CALL    13140<>CALL
NK$LDCT.CG$
     11174**DCL     12969>>IF
NK$LDCT.DDT$
     11145**DCL     11145--REDEF
NK$LDCT.DFLG.INPUT
     11147**DCL     13093>>IF      13107>>IF
NK$LDCT.DFLG.NOSND
     11149**DCL     13138<<ASSIGN
NK$LDCT.DFLG.OUTPUT
     11147**DCL     13096<<ASSIGN  13111<<ASSIGN
NK$LDCT.IOQ$
     11144**DCL     11145--REDEF
NK$LDCT.LDCTX
     11146**DCL     11146--REDEF
NK$LDCT.LKFLG.ABORTED
     11158**DCL     11159--REDEF
NK$LDCT.LKFLG.INTOGGLE
     11162**DCL     13094<<ASSIGN  13108<<ASSIGN
NK$LDCT.LOCK
     11171**DCL     13090<>CALL    13098<>CALL    13104<>CALL    13113<>CALL    13130<>CALL    13142<>CALL
     13150<>CALL
NK$LDCT.RESCOD
     11151**DCL     13068>>IF
NK$LDCT.RLCID.LDCTX
     11168**DCL     11168--REDEF
NK$LDCT.STA$
     11164**DCL     11165--REDEF
NK$LDCT.SYMB$
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:68   
     11143**DCL     11143--REDEF   11143--REDEF   11144--REDEF
NK$LDCT$
      6160**DCL     12969>>IF
NOSTA
     12807**DCL     13009>>ASSIGN
PCODE
     10877**DCL     13125>>ASSIGN
PRF_HDR$
     12784**DCL     13092<<ASSIGN  13093>>IF      13096>>ASSIGN
PSST
     10892**DCL        34--PROC    12936--ASSIGN  13065--ENTRY   13092--ASSIGN  13140--CALL
QFCN
     12755**DCL     12965<<ASSIGN  12968<<ASSIGN  13029<<ASSIGN  13084<<ASSIGN  13119<<ASSIGN  13185>>ASSIGN
QOP
     12756**DCL     12980<<ASSIGN  13030<<ASSIGN  13085<<ASSIGN  13120<<ASSIGN  13192>>ASSIGN
RWCG
     12950**LABEL   12937--GOTO
SC_BMDFCN
     12932**DCL-ENT 12955--CALL    13082--CALL
STA$
     12745**DCL     12936<<ASSIGN  12950<<ASSIGN  12981>>ASSIGN  13031>>ASSIGN
TCTL.M
     12420**DCL     13106--IF      13107--IF      13110--IF      13111--ASSIGN
TCTL.T
     12418**DCL     13101>>IF
TCTL$
     12785**DCL     12417--IMP-PTR 13086<<ASSIGN  13101>>IF      13106>>IF      13107>>IF      13110>>IF
     13111>>ASSIGN
TFCN
     10875**DCL     13135>>ASSIGN
TFCNU
     12754**DCL     13135<<ASSIGN  13137>>IF      13140<>CALL
TOOBIG
     12803**DCL     12972>>ASSIGN
UNL_DISC
     13145**LABEL   13128--CALLALT 13140--CALLALT
PL6.E3A0      #001=KCI$RWCG File=KCI$RWCG.:E05TSI                                WED 07/30/97 00:14 Page:69   
VFC
     10876**DCL        34--PROC    10877--REDEF   10878--REDEF   12946--ENTRY   12952>>ASSIGN  13065--ENTRY
     13079>>ASSIGN
VLP$SETSTA.ISTA
     11060**DCL     13031>>ASSIGN
VLP$SETSTA.MYSTATION#
     11060**DCL     13123>>ASSIGN
VLP$SETSTA.OSTA
     11065**DCL     12981>>ASSIGN
VLP$STATION
     11029**DCL     12988--IF      12989<>CALL    13038--IF      13039<>CALL
VLP$STATION.CTL.ANYDCB#
     11036**DCL     13004>>IF
VLP$STATION.MSGIDXT
     11039**DCL     11042--REDEF
VLP$STATION.STATION#
     11033**DCL     13002>>ASSIGN
VLP$TRMATTR_V.INPUT
     12410**DCL     13106>>IF      13107>>IF
VLP$TRMATTR_V.OUTPUT
     12410**DCL     13110>>IF      13111>>ASSIGN
WRITES
     12969**LABEL   12966--GOTO

PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:70   
      440        1        /*T***********************************************************/
      441        2        /*T*                                                         */
      442        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      443        4        /*T*                                                         */
      444        5        /*T***********************************************************/
      445        6        /**/
      446        7        /*F* NAME:         KCI$CKSTAT
      447        8             PURPOSE:      To provide checking of target station
      448        9                           for terminal control services on
      449       10                           comgroups.
      450       11             CALL:         KCI$CHKSTAT (LDCT$,CG$,STATION)
      451       12             DESCRIPTION:  Ensures the user has TCTL access to the
      452       13                           comgroup DCB pointed to by B$JIT.DCB$.
      453       14                           Picks up the SETSTA in the DCB, and merges
      454       15                           it with the VLP_STATION (if any) passed
      455       16                           with the PMME (in $PS1).  The result is
      456       17                           an 8-character destination station which
      457       18                           is then passed back in STATION.  We use
      458       19                           that to call KCO$FINDSTAD, which finds
      459       20                           the desired station on the B$JIT.DCB$
      460       21                           comgroup and passes back LDCT$ and
      461       22                           CG$.  */
      462       23        /**/
      463       24        KCI$CKSTAT: PROC (LDCT$,CG$,STATION) ALTRET;
      464       25        /**/
      465       26
      466       27
      467       28
      468       29        /**/
      469       30        /* INCLUDES */
      470       31        /**/
      471       32        %INCLUDE B$JIT_C;
      472      346        %INCLUDE NK$LDCT;
      473      448        %INCLUDE F$DCB;
      474      497        %INCLUDE KC_CP6;
      475     1057        %INCLUDE KC_DATA_R;
      476     1070        %INCLUDE NK_SUBS;
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:71   
      477     1095        %INCLUDE KC_ERRORS_C;
      478     1142        %INCLUDE F_ERRORS_C;
      479     1382        %INCLUDE F_MACROS_C;
      480     1393        %INCLUDE KI_ERRORS_C;
      481     1478        %INCLUDE K_DATA_R;
      482     2189        %INCLUDE UD_SEV_C;
      483     2203        %INCLUDE NK_LDCT_R;
      484     2212
      485     2213
      486     2214
      487     2215        /**/
      488     2216        /* PARAMETERS */
      489     2217        /**/
      490     2218    1   DCL LDCT$ PTR;
      491     2219    1   DCL CG$ PTR;
      492     2220    1   DCL STATION CHAR(8);
      493     2221
      494     2222
      495     2223
      496     2224        /**/
      497     2225        /* BASED STRUCTURES */
      498     2226        /**/
      499     2227    1   DCL B$$PTR PTR BASED ALIGNED;
      500     2228        %NK$LDCT;
      501     2274        %VLP_STATION (FPTN=VLP$STATION,STCLASS=BASED);
      502     2301        %VLP_SETSTA  (FPTN=VLP$SETSTA ,STCLASS=BASED);
      503     2329        %B$JIT0;
      504     2418        %U$JIT1X;
      505     2421        %M$JIT2X;
      506     2424        %F$JIT3;
      507     2429        %A$JIT6X;
      508     2432
      509     2433
      510     2434
      511     2435        /**/
      512     2436        /* AUTO */
      513     2437        /**/
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:72   
      514     2438        %VLP_STATION (FPTN=ASTA,STCLASS=AUTO);
      515     2465    1   DCL DCB$ PTR;
      516     2466        %VLP_STATION (FPTN=USTA,STCLASS=AUTO);
      517     2493    1   DCL ERR UBIN WORD;
      518     2494
      519     2495
      520     2496
      521     2497        /**/
      522     2498        /* SUBS */
      523     2499        /**/
      524     2500        %SUB FCG#='1303'O;
      525     2501        %SUB MID#='11'O;
      526     2502
      527     2503
      528     2504
      529     2505        /**/
      530     2506        /* CONSTANT */
      531     2507        /**/
      532     2508        %ERRCODE (NAME=NOSTA,COD#=%E$NOSTA,SEV#=SEV_ERROR#);
      533     2512        %ERRCODE (NAME=DACTR,COD#=%E$DACTR,SEV#=SEV_ERROR#);
      534     2516        %ERRCODE (NAME=LDSC,COD#=%E$LDSC,SEV#=SEV_ERROR#);
      535     2520        %ERRCODE (NAME=BTCSTA,COD#=%E$BTCSTA,SEV#=SEV_ERROR#);
      536     2524        %ERRCODE (NAME=NOTCL,COD#=%E$NOTCL,SEV#=SEV_ERROR#);
      537     2528
      538     2529
      539     2530
      540     2531        /**/
      541     2532        /* REFS */
      542     2533        /**/
      543     2534    1   DCL B$JIT$ PTR SYMREF;
      544     2535    1   DCL B$PS1$ PTR SYMREF;
      545     2536    1   DCL HFF$NILERASE  ENTRY(1) ALTRET;
      546     2537    1   DCL KCI$VALSTA    ENTRY(2) ALTRET;
      547     2538    1   DCL KCO$FINDSTAD  ENTRY(4) ALTRET;
      548     2539        %VLP_STATION (FPTN=KC_VLPSTATION,STCLASS=SYMREF);
      549     2566        %EJECT;
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:73   
      550     2567        /**/
      551     2568    1         DCB$=B$JIT.DCB$;
      552     2569    2         IF NK$LDCT$(DCB$->F$DCB.LDCTX)->LDCT.LKFLG.ACTIVE ~= '1'B THEN DO;
      553     2570    2           B$JIT.ERR=DACTR;
      554     2571        /*E*     ERROR:    KCI-E$DACTR-E
      555     2572                 MESSAGE: Your DCB is de-activated.  No I/O allowed.
      556     2573                 MESSAGE1:  Since your DCB is deactivated you are not
      557     2574                           permitted to do any I/O through it.           */
      558     2575    2           ALTRETURN;
      559     2576    2           END;
      560     2577    1         IF DCB$->F$DCB.FFLG.TCTL='0'B THEN
      561     2578    2           DO;
      562     2579    2           B$JIT.ERR=NOTCL;
      563     2580        /*E*  ERROR:        KCI-E$NOTCL-C
      564     2581               MESSAGE: You are not allowed to use terminal control services.
      565     2582              MESSAGE1: The terminal control services (including M$SETFP) may
      566     2583                        only be done on a comgroup by users authorized to do
      567     2584                        so.  You attempted a terminal control service without
      568     2585                        being authorized.  This can be done by the administrative
      569     2586                        user.
      570     2587              DESCRIPTION:  On comgroups terminal control is an access control
      571     2588                            like read or write.  He doesn't have it.                 */
      572     2589    2           ALTRETURN;
      573     2590    2           END;
      574     2591    1         ASTA=DCB$->F$DCB.SETSTA$->VLP$SETSTA.OSTA;
      575     2592    1         CALL HFF$NILERASE (1) ALTRET(NOCK);
      576     2593    1         USTA=KC_VLPSTATION;
      577     2594    1         USTA.STATION#=B$PS1$->VLP$STATION.STATION#;
      578     2595    1         CALL KCI$VALSTA (USTA,ASTA) ALTRET(ALTRT);
      579     2596    1   NOCK: ;
      580     2597    1         IF ASTA.STATION# = ' ' THEN
      581     2598    2           DO;
      582     2599    2           ASTA.STATION#=DCB$->F$DCB.LASTSTA$->VLP$STATION.STATION#;
      583     2600    2           IF ASTA.STATION# = ' ' THEN
      584     2601    3             DO;
      585     2602    3             B$JIT.ERR=NOSTA;
      586     2603    3             ALTRETURN;
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:74   
      587     2604    3             END;
      588     2605    2           END;
      589     2606    1         ERR=8;
      590     2607    1         CALL KCO$FINDSTAD (LDCT$,,ASTA,ERR) ALTRET(DISC);
      591     2608    1         CG$=LDCT$->LDCT.CG$;
      592     2609    1         IF CG$=ADDR(NIL) THEN
      593     2610    2           DO;
      594     2611    2   DISC:   ;
      595     2612    2           B$JIT.ERR=LDSC;
      596     2613    2   ALTRT:  ALTRETURN;
      597     2614    2           END;
      598     2615    1         IF (LDCT$->LDCT.RESCOD~=NK_CGTRM AND LDCT$->LDCT.RESCOD~=NK_CGFPRG)
      599     2616    2         OR LDCT$->LDCT.DFLG.LOCAL THEN DO;
      600     2617    2           B$JIT.ERR=BTCSTA;
      601     2618        /*E*  ERROR:    KCI-E$BTCSTA-E
      602     2619               MESSAGE: You can't terminal control a DCB!
      603     2620              MESSAGE1: The terminal control services (including M$SETFP) may
      604     2621                        only be issued to stations which represent communications
      605     2622                        terminals, not DCBs.  The station name you specified
      606     2623                        was that of a DCB or IOM connected device.
      607     2624              DESCRIPTION: Can't have them doing this can we?                        */
      608     2625    2           ALTRETURN;
      609     2626    2           END;
      610     2627    1         STATION=ASTA.STATION#;
      611     2628    1         RETURN;
      612     2629    1   END;
      613     2630        /**/
      614     2631        %EOD;

PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:75   
--  Include file information  --

   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KCI$CKSTAT.

   Procedure KCI$CKSTAT requires 102 words for executable code.
   Procedure KCI$CKSTAT requires 28 words of local(AUTO) storage.

PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:76   

 Object Unit name= KCI$CKSTAT                                 File name= KCI$RWCG.:E05TOU
 UTS= JUL 30 '97 00:15:19.44 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      5      5  KCI$CKSTAT
    1   Proc  even  none   102    146  KCI$CKSTAT
    2  RoData even  none     4      4  KCI$CKSTAT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  KCI$CKSTAT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 HFF$NILERASE
 yes     yes           Std       2 KCI$VALSTA
 yes     yes           Std       4 KCO$FINDSTAD
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:77   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               B$JIT$                                B$PS1$
     KC_VLPSTATION                         B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:78   


      440        1        /*T***********************************************************/
      441        2        /*T*                                                         */
      442        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      443        4        /*T*                                                         */
      444        5        /*T***********************************************************/
      445        6        /**/
      446        7        /*F* NAME:         KCI$CKSTAT
      447        8             PURPOSE:      To provide checking of target station
      448        9                           for terminal control services on
      449       10                           comgroups.
      450       11             CALL:         KCI$CHKSTAT (LDCT$,CG$,STATION)
      451       12             DESCRIPTION:  Ensures the user has TCTL access to the
      452       13                           comgroup DCB pointed to by B$JIT.DCB$.
      453       14                           Picks up the SETSTA in the DCB, and merges
      454       15                           it with the VLP_STATION (if any) passed
      455       16                           with the PMME (in $PS1).  The result is
      456       17                           an 8-character destination station which
      457       18                           is then passed back in STATION.  We use
      458       19                           that to call KCO$FINDSTAD, which finds
      459       20                           the desired station on the B$JIT.DCB$
      460       21                           comgroup and passes back LDCT$ and
      461       22                           CG$.  */
      462       23        /**/
      463       24        KCI$CKSTAT: PROC (LDCT$,CG$,STATION) ALTRET;

     24  1 000000   000000 700200 xent  KCI$CKSTAT   TSX0  ! X66_AUTO_3
         1 000001   000034 000003                    ZERO    28,3

      464       25        /**/
      465       26
      466       27
      467       28
      468       29        /**/
      469       30        /* INCLUDES */
      470       31        /**/
      471       32        %INCLUDE B$JIT_C;
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:79   
      472      346        %INCLUDE NK$LDCT;
      473      448        %INCLUDE F$DCB;
      474      497        %INCLUDE KC_CP6;
      475     1057        %INCLUDE KC_DATA_R;
      476     1070        %INCLUDE NK_SUBS;
      477     1095        %INCLUDE KC_ERRORS_C;
      478     1142        %INCLUDE F_ERRORS_C;
      479     1382        %INCLUDE F_MACROS_C;
      480     1393        %INCLUDE KI_ERRORS_C;
      481     1478        %INCLUDE K_DATA_R;
      482     2189        %INCLUDE UD_SEV_C;
      483     2203        %INCLUDE NK_LDCT_R;
      484     2212
      485     2213
      486     2214
      487     2215        /**/
      488     2216        /* PARAMETERS */
      489     2217        /**/
      490     2218    1   DCL LDCT$ PTR;
      491     2219    1   DCL CG$ PTR;
      492     2220    1   DCL STATION CHAR(8);
      493     2221
      494     2222
      495     2223
      496     2224        /**/
      497     2225        /* BASED STRUCTURES */
      498     2226        /**/
      499     2227    1   DCL B$$PTR PTR BASED ALIGNED;
      500     2228        %NK$LDCT;
      501     2274        %VLP_STATION (FPTN=VLP$STATION,STCLASS=BASED);
      502     2301        %VLP_SETSTA  (FPTN=VLP$SETSTA ,STCLASS=BASED);
      503     2329        %B$JIT0;
      504     2418        %U$JIT1X;
      505     2421        %M$JIT2X;
      506     2424        %F$JIT3;
      507     2429        %A$JIT6X;
      508     2432
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:80   
      509     2433
      510     2434
      511     2435        /**/
      512     2436        /* AUTO */
      513     2437        /**/
      514     2438        %VLP_STATION (FPTN=ASTA,STCLASS=AUTO);
      515     2465    1   DCL DCB$ PTR;
      516     2466        %VLP_STATION (FPTN=USTA,STCLASS=AUTO);
      517     2493    1   DCL ERR UBIN WORD;
      518     2494
      519     2495
      520     2496
      521     2497        /**/
      522     2498        /* SUBS */
      523     2499        /**/
      524     2500        %SUB FCG#='1303'O;
      525     2501        %SUB MID#='11'O;
      526     2502
      527     2503
      528     2504
      529     2505        /**/
      530     2506        /* CONSTANT */
      531     2507        /**/
      532     2508        %ERRCODE (NAME=NOSTA,COD#=%E$NOSTA,SEV#=SEV_ERROR#);
      533     2512        %ERRCODE (NAME=DACTR,COD#=%E$DACTR,SEV#=SEV_ERROR#);
      534     2516        %ERRCODE (NAME=LDSC,COD#=%E$LDSC,SEV#=SEV_ERROR#);
      535     2520        %ERRCODE (NAME=BTCSTA,COD#=%E$BTCSTA,SEV#=SEV_ERROR#);
      536     2524        %ERRCODE (NAME=NOTCL,COD#=%E$NOTCL,SEV#=SEV_ERROR#);
      537     2528
      538     2529
      539     2530
      540     2531        /**/
      541     2532        /* REFS */
      542     2533        /**/
      543     2534    1   DCL B$JIT$ PTR SYMREF;
      544     2535    1   DCL B$PS1$ PTR SYMREF;
      545     2536    1   DCL HFF$NILERASE  ENTRY(1) ALTRET;
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:81   
      546     2537    1   DCL KCI$VALSTA    ENTRY(2) ALTRET;
      547     2538    1   DCL KCO$FINDSTAD  ENTRY(4) ALTRET;
      548     2539        %VLP_STATION (FPTN=KC_VLPSTATION,STCLASS=SYMREF);
      549     2566        %EJECT;
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:82   
      550     2567        /**/
      551     2568    1         DCB$=B$JIT.DCB$;

   2568  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200016 756100                    STQ     DCB$,,AUTO

      552     2569    2         IF NK$LDCT$(DCB$->F$DCB.LDCTX)->LDCT.LKFLG.ACTIVE ~= '1'B THEN DO;

   2569  1 000005   200016 471500                    LDP1    DCB$,,AUTO
         1 000006   100051 220100                    LDX0    41,,PR1
         1 000007   000000 473400 xsym               LDP3    N$DCT$$
         1 000010   300000 474510                    LDP4    0,X0,PR3
         1 000011   400011 236100                    LDQ     9,,PR4
         1 000012   000040 316003                    CANQ    32,DU
         1 000013   000017 601000 1                  TNZ     s:2577

      553     2570    2           B$JIT.ERR=DACTR;

   2570  1 000014   000001 236000 0                  LDQ     DACTR
         1 000015   000012 756100                    STQ     10,,PR0

      554     2571        /*E*     ERROR:    KCI-E$DACTR-E
      555     2572                 MESSAGE: Your DCB is de-activated.  No I/O allowed.
      556     2573                 MESSAGE1:  Since your DCB is deactivated you are not
      557     2574                           permitted to do any I/O through it.           */
      558     2575    2           ALTRETURN;

   2575  1 000016   000000 702200 xent               TSX2  ! X66_AALT

      559     2576    2           END;
      560     2577    1         IF DCB$->F$DCB.FFLG.TCTL='0'B THEN

   2577  1 000017   100004 236100                    LDQ     4,,PR1
         1 000020   000100 316003                    CANQ    64,DU
         1 000021   000025 601000 1                  TNZ     s:2591

PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:83   
      561     2578    2           DO;

      562     2579    2           B$JIT.ERR=NOTCL;

   2579  1 000022   000004 236000 0                  LDQ     NOTCL
         1 000023   000012 756100                    STQ     10,,PR0

      563     2580        /*E*  ERROR:        KCI-E$NOTCL-C
      564     2581               MESSAGE: You are not allowed to use terminal control services.
      565     2582              MESSAGE1: The terminal control services (including M$SETFP) may
      566     2583                        only be done on a comgroup by users authorized to do
      567     2584                        so.  You attempted a terminal control service without
      568     2585                        being authorized.  This can be done by the administrative
      569     2586                        user.
      570     2587              DESCRIPTION:  On comgroups terminal control is an access control
      571     2588                            like read or write.  He doesn't have it.                 */
      572     2589    2           ALTRETURN;

   2589  1 000024   000000 702200 xent               TSX2  ! X66_AALT

      573     2590    2           END;
      574     2591    1         ASTA=DCB$->F$DCB.SETSTA$->VLP$SETSTA.OSTA;

   2591  1 000025   100006 475500                    LDP5    6,,PR1
         1 000026   000100 100500                    MLR     fill='000'O
         1 000027   500007 000024                    ADSC9   7,,PR5                   cn=0,n=20
         1 000030   200006 000040                    ADSC9   ASTA,,AUTO               cn=0,n=32

      575     2592    1         CALL HFF$NILERASE (1) ALTRET(NOCK);

   2592  1 000031   000000 630400 2                  EPPR0   0
         1 000032   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000033   000000 701000 xent               TSX1    HFF$NILERASE
         1 000034   000054 702000 1                  TSX2    NOCK

      576     2593    1         USTA=KC_VLPSTATION;

PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:84   
   2593  1 000035   000100 100400                    MLR     fill='000'O
         1 000036   000000 000040 xsym               ADSC9   KC_VLPSTATION            cn=0,n=32
         1 000037   200017 000040                    ADSC9   USTA,,AUTO               cn=0,n=32

      577     2594    1         USTA.STATION#=B$PS1$->VLP$STATION.STATION#;

   2594  1 000040   000000 470400 xsym               LDP0    B$PS1$
         1 000041   040100 100500                    MLR     fill='040'O
         1 000042   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000043   200017 000010                    ADSC9   USTA,,AUTO               cn=0,n=8

      578     2595    1         CALL KCI$VALSTA (USTA,ASTA) ALTRET(ALTRT);

   2595  1 000044   200006 631500                    EPPR1   ASTA,,AUTO
         1 000045   200031 451500                    STP1    ERR+2,,AUTO
         1 000046   200017 633500                    EPPR3   USTA,,AUTO
         1 000047   200030 453500                    STP3    ERR+1,,AUTO
         1 000050   200030 630500                    EPPR0   ERR+1,,AUTO
         1 000051   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000052   000000 701000 xent               TSX1    KCI$VALSTA
         1 000053   000122 702000 1                  TSX2    ALTRT

   2594  1 000054                       NOCK         null
      579     2596    1   NOCK: ;
      580     2597    1         IF ASTA.STATION# = ' ' THEN

   2597  1 000054   200006 237100                    LDAQ    ASTA,,AUTO
         1 000055   000002 117000 2                  CMPAQ   2
         1 000056   000073 601000 1                  TNZ     s:2606

      581     2598    2           DO;

      582     2599    2           ASTA.STATION#=DCB$->F$DCB.LASTSTA$->VLP$STATION.STATION#;

   2599  1 000057   200016 470500                    LDP0    DCB$,,AUTO
         1 000060   000007 471500                    LDP1    7,,PR0
         1 000061   040100 100500                    MLR     fill='040'O
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:85   
         1 000062   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000063   200006 000010                    ADSC9   ASTA,,AUTO               cn=0,n=8

      583     2600    2           IF ASTA.STATION# = ' ' THEN

   2600  1 000064   200006 237100                    LDAQ    ASTA,,AUTO
         1 000065   000002 117000 2                  CMPAQ   2
         1 000066   000073 601000 1                  TNZ     s:2606

      584     2601    3             DO;

      585     2602    3             B$JIT.ERR=NOSTA;

   2602  1 000067   000000 236000 0                  LDQ     NOSTA
         1 000070   000000 471400 xsym               LDP1    B$JIT$
         1 000071   100012 756100                    STQ     10,,PR1

      586     2603    3             ALTRETURN;

   2603  1 000072   000000 702200 xent               TSX2  ! X66_AALT

      587     2604    3             END;
      588     2605    2           END;
      589     2606    1         ERR=8;

   2606  1 000073   000010 235007                    LDA     8,DL
         1 000074   200027 755100                    STA     ERR,,AUTO

      590     2607    1         CALL KCO$FINDSTAD (LDCT$,,ASTA,ERR) ALTRET(DISC);

   2607  1 000075   200027 630500                    EPPR0   ERR,,AUTO
         1 000076   200033 450500                    STP0    ERR+4,,AUTO
         1 000077   200006 631500                    EPPR1   ASTA,,AUTO
         1 000100   200032 451500                    STP1    ERR+3,,AUTO
         1 000101   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000102   200003 235100                    LDA     @LDCT$,,AUTO
         1 000103   200030 757100                    STAQ    ERR+1,,AUTO
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:86   
         1 000104   200030 630500                    EPPR0   ERR+1,,AUTO
         1 000105   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000106   000000 701000 xent               TSX1    KCO$FINDSTAD
         1 000107   000117 702000 1                  TSX2    DISC

      591     2608    1         CG$=LDCT$->LDCT.CG$;

   2608  1 000110   200003 470500                    LDP0    @LDCT$,,AUTO
         1 000111   000000 471500                    LDP1    0,,PR0
         1 000112   100027 236100                    LDQ     23,,PR1
         1 000113   200004 473500                    LDP3    @CG$,,AUTO
         1 000114   300000 756100                    STQ     0,,PR3

      592     2609    1         IF CG$=ADDR(NIL) THEN

   2609  1 000115   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000116   000123 601000 1                  TNZ     s:2615

      593     2610    2           DO;

   2608  1 000117                       DISC         null
      594     2611    2   DISC:   ;
      595     2612    2           B$JIT.ERR=LDSC;

   2612  1 000117   000002 236000 0                  LDQ     LDSC
         1 000120   000000 470400 xsym               LDP0    B$JIT$
         1 000121   000012 756100                    STQ     10,,PR0

      596     2613    2   ALTRT:  ALTRETURN;

   2613  1 000122   000000 702200 xent  ALTRT        TSX2  ! X66_AALT

      597     2614    2           END;
      598     2615    1         IF (LDCT$->LDCT.RESCOD~=NK_CGTRM AND LDCT$->LDCT.RESCOD~=NK_CGFPRG)

   2615  1 000123   000000 471500                    LDP1    0,,PR0
         1 000124   100006 236100                    LDQ     6,,PR1
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:87   
         1 000125   000017 376007                    ANQ     15,DL
         1 000126   000002 116007                    CMPQ    2,DL
         1 000127   000132 600000 1                  TZE     s:2615+7
         1 000130   000011 116007                    CMPQ    9,DL
         1 000131   000135 601000 1                  TNZ     s:2617
         1 000132   100006 236100                    LDQ     6,,PR1
         1 000133   002000 316007                    CANQ    1024,DL
         1 000134   000141 600000 1                  TZE     s:2627

      599     2616    2         OR LDCT$->LDCT.DFLG.LOCAL THEN DO;

      600     2617    2           B$JIT.ERR=BTCSTA;

   2617  1 000135   000003 236000 0                  LDQ     BTCSTA
         1 000136   000000 474400 xsym               LDP4    B$JIT$
         1 000137   400012 756100                    STQ     10,,PR4

      601     2618        /*E*  ERROR:    KCI-E$BTCSTA-E
      602     2619               MESSAGE: You can't terminal control a DCB!
      603     2620              MESSAGE1: The terminal control services (including M$SETFP) may
      604     2621                        only be issued to stations which represent communications
      605     2622                        terminals, not DCBs.  The station name you specified
      606     2623                        was that of a DCB or IOM connected device.
      607     2624              DESCRIPTION: Can't have them doing this can we?                        */
      608     2625    2           ALTRETURN;

   2625  1 000140   000000 702200 xent               TSX2  ! X66_AALT

      609     2626    2           END;
      610     2627    1         STATION=ASTA.STATION#;

   2627  1 000141   200005 474500                    LDP4    @STATION,,AUTO
         1 000142   040100 100500                    MLR     fill='040'O
         1 000143   200006 000010                    ADSC9   ASTA,,AUTO               cn=0,n=8
         1 000144   400000 000010                    ADSC9   0,,PR4                   cn=0,n=8

      611     2628    1         RETURN;
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:88   

   2628  1 000145   000000 702200 xent               TSX2  ! X66_ARET

NOSTA
 Sect OctLoc
   0     000   130311 015344                                                    X...

DACTR
 Sect OctLoc
   0     001   130311 000154                                                    X..l

LDSC
 Sect OctLoc
   0     002   130311 000144                                                    X..d

BTCSTA
 Sect OctLoc
   0     003   130311 020534                                                    X...

NOTCL
 Sect OctLoc
   0     004   130311 015524                                                    X...

(unnamed)
 Sect OctLoc
   2     000   000003 006000   000000 000000   040040 040040   040040 040040    ........
      612     2629    1   END;
      613     2630        /**/
      614     2631        %EOD;

PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:89   
--  Include file information  --

   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KCI$CKSTAT.
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:90   

 **** Variables and constants ****

  ****  Section 000 RoData KCI$CKSTAT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/b STRC        r     1 BTCSTA                     1-0-0/b STRC        r     1 DACTR
     2-0-0/b STRC        r     1 LDSC                       0-0-0/b STRC        r     1 NOSTA
     4-0-0/b STRC        r     1 NOTCL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CG$                       3-0-0/w PTR         r     1 @LDCT$
     5-0-0/w PTR         r     1 @STATION                   6-0-0/w STRC(288)   r     1 ASTA
    *0-0-0/w PTR         r     1 CG$                       16-0-0/w PTR         r     1 DCB$
    27-0-0/w UBIN        r     1 ERR                       *0-0-0/w PTR         r     1 LDCT$
    *0-0-0/c CHAR(8)     r     1 STATION                   17-0-0/w STRC(288)   r     1 USTA

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS1$
     0-0-0/w STRC(288)   r     1 KC_VLPSTATION              0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(7560)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d STRC(864)   r     1 NK$LDCT
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:91   
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/w STRC(432)   r     1 VLP$SETSTA                 0-0-0/w STRC(288)   r     1 VLP$STATION


   Procedure KCI$CKSTAT requires 102 words for executable code.
   Procedure KCI$CKSTAT requires 28 words of local(AUTO) storage.
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:92   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:93   
          MINI XREF LISTING

ALTRT
      2613**LABEL    2595--CALLALT
ASTA
      2450**DCL      2591<<ASSIGN   2595<>CALL     2607<>CALL
ASTA.MSGIDXT
      2460**DCL      2463--REDEF
ASTA.STATION#
      2454**DCL      2597>>IF       2599<<ASSIGN   2600>>IF       2627>>ASSIGN
B$JIT.DCB$
      2425**DCL      2568>>ASSIGN
B$JIT.ERR
      2335**DCL      2570<<ASSIGN   2579<<ASSIGN   2602<<ASSIGN   2612<<ASSIGN   2617<<ASSIGN
B$JIT.ERR.MID
      2336**DCL      2336--REDEF
B$JIT$
      2534**DCL      2330--IMP-PTR  2568>>ASSIGN   2570>>ASSIGN   2579>>ASSIGN   2602>>ASSIGN   2612>>ASSIGN
      2617>>ASSIGN
B$PS1$
      2535**DCL      2594>>ASSIGN
BTCSTA
      2521**DCL      2617>>ASSIGN
CG$
      2219**DCL        24--PROC     2608<<ASSIGN   2609>>IF
DACTR
      2513**DCL      2570>>ASSIGN
DCB$
      2465**DCL      2568<<ASSIGN   2569>>IF       2577>>IF       2591>>ASSIGN   2599>>ASSIGN
DISC
      2608**LABEL    2607--CALLALT
ERR
      2493**DCL      2606<<ASSIGN   2607<>CALL
F$DCB.ACTPOS
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:94   
       474**DCL       474--REDEF
F$DCB.ARS
       449**DCL       449--REDEF
F$DCB.ATTR
       467**DCL       468--REDEF
F$DCB.BORROW
       482**DCL       482--REDEF     482--REDEF     482--REDEF
F$DCB.DCBNAME.L
       496**DCL       496--IMP-SIZ
F$DCB.EOMCHAR
       453**DCL       453--REDEF
F$DCB.FFLG.TCTL
       455**DCL      2577>>IF
F$DCB.FLDID
       477**DCL       477--REDEF
F$DCB.FORM$
       471**DCL       471--REDEF
F$DCB.FSECT
       487**DCL       487--REDEF
F$DCB.FSN
       464**DCL       464--REDEF     464--REDEF     465--REDEF
F$DCB.HEADER$
       470**DCL       470--REDEF
F$DCB.IXTNSIZE
       468**DCL       468--REDEF
F$DCB.LASTSTA$
       458**DCL       458--REDEF    2599>>ASSIGN
F$DCB.LDCTX
       471**DCL      2569>>IF
F$DCB.LVL
       483**DCL       483--REDEF
F$DCB.NAME.C
       458**DCL       458--REDEF
F$DCB.NOEOF
       479**DCL       479--REDEF
F$DCB.NRECS
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:95   
       469**DCL       469--REDEF
F$DCB.NRECX
       488**DCL       488--REDEF
F$DCB.OHDR
       480**DCL       480--REDEF
F$DCB.ORG
       463**DCL       463--REDEF
F$DCB.PRECNO
       486**DCL       486--REDEF
F$DCB.RCSZ
       491**DCL       491--REDEF
F$DCB.RES
       459**DCL       459--REDEF
F$DCB.SETSTA$
       458**DCL      2591>>ASSIGN
F$DCB.SETX
       471**DCL       471--REDEF
F$DCB.TAB$
       470**DCL       471--REDEF
F$DCB.TDA
       485**DCL       485--REDEF
F$DCB.WSN
       460**DCL       460--REDEF
HFF$NILERASE
      2536**DCL-ENT  2592--CALL
KCI$VALSTA
      2537**DCL-ENT  2595--CALL
KCO$FINDSTAD
      2538**DCL-ENT  2607--CALL
KC_VLPSTATION
      2551**DCL      2593>>ASSIGN
KC_VLPSTATION.MSGIDXT
      2561**DCL      2564--REDEF
K_RWPARM_CON.BLKREC
      1919**DCL      1944--REDEF
K_RWPARM_CON.BLKREC.BLKU#
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:96   
      1920**DCL      1922--REDEF
K_RWPARM_CON.BLKREC.RECU#
      1932**DCL      1934--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      1959**DCL      1960--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      1967**DCL      1971--REDEF
K_RWPARM_CON.ERR
      2031**DCL      2036--REDEF
K_RWPARM_CON.FC
      1995**DCL      1996--REDEF
K_RWPARM_CON.FLDID
      2177**DCL      2178--REDEF
K_RWPARM_CON.FPT$
      2058**DCL      2065--REDEF
K_RWPARM_CON.KEYTYPE
      2184**DCL      2185--REDEF
K_RWPARM_CON.MSG$
      1894**DCL      1900--REDEF
K_RWPARM_CON.MSGID
      2006**DCL      2011--REDEF
K_RWPARM_CON.MSGIDXT
      2019**DCL      2023--REDEF
K_RWPARM_CON.ORG
      2155**DCL      2156--REDEF
K_RWPARM_CON.THDRSZ
      2099**DCL      2103--REDEF
K_RWPARM_CON.VDOFLGS
      2157**DCL      2168--REDEF
LDCT$
      2218**DCL        24--PROC     2607<>CALL     2608>>ASSIGN   2615>>IF       2615>>IF       2615>>IF
LDSC
      2517**DCL      2612>>ASSIGN
N$DCT$$
      2210**DCL      2210--IMP-PTR  2569>>IF
NK$LDCT.CG$
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:97   
      2272**DCL      2608>>ASSIGN
NK$LDCT.DDT$
      2243**DCL      2243--REDEF
NK$LDCT.DFLG.LOCAL
      2247**DCL      2615>>IF
NK$LDCT.IOQ$
      2242**DCL      2243--REDEF
NK$LDCT.LDCTX
      2244**DCL      2244--REDEF
NK$LDCT.LKFLG.ABORTED
      2256**DCL      2257--REDEF
NK$LDCT.LKFLG.ACTIVE
      2260**DCL      2569>>IF
NK$LDCT.RESCOD
      2249**DCL      2615>>IF       2615>>IF
NK$LDCT.RLCID.LDCTX
      2266**DCL      2266--REDEF
NK$LDCT.STA$
      2262**DCL      2263--REDEF
NK$LDCT.SYMB$
      2241**DCL      2241--REDEF    2241--REDEF    2242--REDEF
NK$LDCT$
      2210**DCL      2569>>IF
NOCK
      2594**LABEL    2592--CALLALT
NOSTA
      2509**DCL      2602>>ASSIGN
NOTCL
      2525**DCL      2579>>ASSIGN
STATION
      2220**DCL        24--PROC     2627<<ASSIGN
USTA
      2478**DCL      2593<<ASSIGN   2595<>CALL
USTA.MSGIDXT
      2488**DCL      2491--REDEF
USTA.STATION#
PL6.E3A0      #002=KCI$CKSTAT File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:98   
      2482**DCL      2594<<ASSIGN
VLP$SETSTA.OSTA
      2322**DCL      2591>>ASSIGN
VLP$STATION.MSGIDXT
      2296**DCL      2299--REDEF
VLP$STATION.STATION#
      2290**DCL      2594>>ASSIGN   2599>>ASSIGN

PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:99   
      615        1        /*T***********************************************************/
      616        2        /*T*                                                         */
      617        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      618        4        /*T*                                                         */
      619        5        /*T***********************************************************/
      620        6        /**/
      621        7        /*F* NAME:         KCI$VALSTA
      622        8             PURPOSE:      To validate a user-supplied VLP_STATION
      623        9                           against a DCB- or comgroup-supplied
      624       10                           VLP_SETSTA
      625       11             CALL:         KCI$VALSTA (USERSTA,CHEKSTA)
      626       12             INPUT:        B$JIT.DCB$ points to the comgroup DCB being
      627       13                           operated on.
      628       14             DESCRIPTION:  This routine can be used to validate
      629       15                           VLP_STATION against a VLP_SETSTA, or
      630       16                           VLP_SETSTA against another VLP_SETSTA.
      631       17
      632       18                           This works because ISTA and OSTA in VLP_SETSTA
      633       19                           have the same structure, and this structure is
      634       20                           what the first bit of VLP_STATION looks like.
      635       21
      636       22                           Both CHEKSTA and USERSTA can be either a
      637       23                           VLP_STATION, or an ISTA/OSTA from a VLP_SETSTA.
      638       24
      639       25                           USERSTA is the item supplied by the
      640       26                           user.  CHEKSTA is the item which
      641       27                           is to limit, or supply defaults for,
      642       28                           the USERSTA.  The two are merged
      643       29                           together, and the result returned
      644       30                           in CHEKSTA.  If errors are encountered,
      645       31                           we ALTRET with B$JIT.ERR set.
      646       32
      647       33                           The following specific checks are made:
      648       34
      649       35                           If CHECKSTA.CTL.LOCK is set then:
      650       36
      651       37                           o If USERSTA.STATION is ' ' then no
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:100  
      652       38                             action is taken (i.e. the original
      653       39                             CHEKSTA.STATION is returned).  Else
      654       40                             USERSTA.STATION must match CHEKSTA.STATION
      655       41                             at least up to the first '?' in CHEKSTA.STATION,
      656       42                             even if CHEKSTA.STATION is blanks.
      657       43                             Furthermore, USERSTA.STATION must have
      658       44                             a legal first character (see KC_LGL1ST in
      659       45                             KC_DATA_D).  If these checks pass,
      660       46                             CHEKSTA.STATION is overwritten with
      661       47                             USERSTA.STATION.
      662       48
      663       49                           o An identical algorithm is performed upon
      664       50                             USERSTA.MSGTYP and CHEKSTA.MSGTYP with the
      665       51                             additional consideration that '*' is a valid
      666       52                             first character so long as the specified
      667       53                             MSGTYP is not '*AUEV' which is reserved for
      668       54                             CP-6 use.
      669       55
      670       56                           o If any bits in USERSTA.CTL are set, for
      671       57                             which the corresponding bits in CHEKSTA.CTL
      672       58                             are reset, an error occurs.  Else the
      673       59                             original CHEKSTA.CTL is returned.
      674       60
      675       61                           o EOFTIME in USERSTA must be 0 or =EOFTIME in CHEKSTA
      676       62                             or an error will result.
      677       63
      678       64                           Otherwise (CHEKSTA.CTL.LOCK is reset):
      679       65
      680       66                           o If USERSTA.STATION is blanks, then CHEKSTA.STATION
      681       67                             is returned intact.  Else USERSTA.STATION must
      682       68                             have a legal first character, and overwrites
      683       69                             CHEKSTA.STATION
      684       70
      685       71                           o An identical algorithm is performed upon
      686       72                             USERSTA.MSGTYP and CHEKSTA.MSGTYP with the
      687       73                             additional consideration that '*' is a valid
      688       74                             first character so long as the specified
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:101  
      689       75                             MSGTYP is not '*AUEV' which is reserved for
      690       76                             CP-6 use.
      691       77
      692       78                           o EOFTIME is taken from USERSTA if non-zero, otherwise
      693       79                             it is taken from CHEKSTA.
      694       80
      695       81                           o USERSTA.CTL is ORed into CHEKSTA.CTL
      696       82
      697       83
      698       84                           AU DCBs are exempt from all but the first-
      699       85                           character checks.
      700       86        */
      701       87        KCI$VALSTA: PROC (USERSTA,CHEKSTA) ALTRET;
      702       88        /**/
      703       89
      704       90
      705       91
      706       92        /**/
      707       93        /* INCLUDES */
      708       94        /**/
      709       95        %INCLUDE B$JIT_C;
      710      409        %INCLUDE F$DCB;
      711      458        %INCLUDE KC_CP6;
      712     1018        %INCLUDE KC_DATA_R;
      713     1031        %INCLUDE KC_ERRORS_C;
      714     1078        %INCLUDE F_ERRORS_C;
      715     1318        %INCLUDE F_MACROS_C;
      716     1329        %INCLUDE UD_SEV_C;
      717     1343
      718     1344
      719     1345
      720     1346        /**/
      721     1347        /* PARAMETERS */
      722     1348        /**/
      723     1349        %VLP_STATION (FPTN=USERSTA,STCLASS="");
      724     1376        %VLP_STATION (FPTN=CHEKSTA,STCLASS="");
      725     1403
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:102  
      726     1404
      727     1405
      728     1406
      729     1407        /**/
      730     1408        /* BASED STRUCTURES */
      731     1409        /**/
      732     1410    1   DCL B$$CHARS CHAR(K) BASED CALIGNED;
      733     1411    1   DCL B$$CHAR  CHAR(1) BASED CALIGNED;
      734     1412        %B$JIT0;
      735     1501        %U$JIT1X;
      736     1504        %M$JIT2X;
      737     1507        %F$JIT3;
      738     1512        %A$JIT6X;
      739     1515
      740     1516
      741     1517
      742     1518        /**/
      743     1519        /* AUTO */
      744     1520        /**/
      745     1521    1   DCL K UBIN WORD;
      746     1522        %VLP_STATION (FPTN=STA1,STCLASS=AUTO);
      747     1549        %VLP_STATION (FPTN=STA2,STCLASS=AUTO);
      748     1576
      749     1577
      750     1578
      751     1579        /**/
      752     1580        /* SUBS */
      753     1581        /**/
      754     1582        %SUB FCG#='1303'O;
      755     1583        %SUB MID#='11'O;
      756     1584
      757     1585
      758     1586
      759     1587        /**/
      760     1588        /* CONSTANT */
      761     1589        /**/
      762     1590        %ERRCODE (NAME=E_STACHAR,COD#=%E$STACHAR);
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:103  
      763     1594        %ERRCODE (NAME=E_TYPCHAR,COD#=%E$TYPCHAR);
      764     1598        %ERRCODE (NAME=E_LOCSTA ,COD#=%E$LOCSTA );
      765     1602        %ERRCODE (NAME=E_LOCTYP ,COD#=%E$LOCTYP );
      766     1606        %ERRCODE (NAME=E_LOCCTL ,COD#=%E$LOCCTL );
      767     1610
      768     1611
      769     1612
      770     1613        /**/
      771     1614        /* REFS */
      772     1615        /**/
      773     1616    1   DCL B$JIT$ PTR SYMREF;
      774     1617
      775     1618        /**/
      776     1619        %EJECT;
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:104  
      777     1620    1         IF CHEKSTA.CTL.LOCK THEN
      778     1621                     /*    SETSTA
      779     1622                      *    is
      780     1623                      *    LOCKed
      781     1624                      */
      782     1625    2           DO;
      783     1626    2           IF USERSTA.STATION#~=' ' THEN
      784     1627    3             DO;
      785     1628    3             CALL INDEX (K,'?',CHEKSTA.STATION#);
      786     1629    3             IF ADDR(USERSTA.STATION#)->B$$CHARS ~= ADDR(CHEKSTA.STATION#)->B$$CHARS
              1629                      THEN
      787     1630    3              IF NOT B$JIT$->B$JIT.DCB$->F$DCB.AU THEN
      788     1631    4                DO;
      789     1632    4                B$JIT$->B$JIT.ERR=E_LOCSTA;
      790     1633        /*E*   ERROR:      KCI-E$LOCSTA-E
      791     1634                MESSAGE: You are not permitted to use that STATION!
      792     1635               MESSAGE1: You have only restricted access to the comgroup
      793     1636                         you are using, and the STATION you specified is not
      794     1637                         allowed.
      795     1638               MESSAGE2: The possible STATIONs accessible by a comgroup
      796     1639                         user may be restricted by the comgroup itself or via
      797     1640                         a !SET command. You tried to specify a STATION outside
      798     1641                         of this restricted list
      799     1642               DESCRIPTION:  SETSTA.LOCK is set and the user specified a STATION
      800     1643                             not allowed by SETSTA.STATION.                          */
      801     1644    4                ALTRETURN;
      802     1645    4                END;
      803     1646    3             CALL INDEX (K,ADDR(USERSTA.STATION#)->B$$CHAR,KC_LGL1ST) ALTRET (STACHR);
      804     1647    3             CHEKSTA.STATION#=USERSTA.STATION#;
      805     1648    3             END;
      806     1649
      807     1650
      808     1651
      809     1652    2           IF USERSTA.MSGTYP#~=' ' THEN
      810     1653    3             DO;
      811     1654    3             CALL INDEX (K,'?',CHEKSTA.MSGTYP#);
      812     1655    3             IF ADDR(USERSTA.MSGTYP#)->B$$CHARS ~= ADDR(CHEKSTA.MSGTYP#)->B$$CHARS THEN
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:105  
      813     1656    3              IF NOT B$JIT$->B$JIT.DCB$->F$DCB.AU THEN
      814     1657    4                DO;
      815     1658    4                B$JIT$->B$JIT.ERR=E_LOCTYP;
      816     1659        /*E*   ERROR:      KCI-E$LOCTYP-E
      817     1660                MESSAGE: You are not permitted to use that MSGTYP!
      818     1661               MESSAGE1: You have only restricted access to the comgroup
      819     1662                         you are using, and the MSGTYP you specified is not
      820     1663                         allowed.
      821     1664               MESSAGE2: The possible MSGTYPs accessible by a comgroup
      822     1665                         user may be restricted by the comgroup itself or via
      823     1666                         a !SET command. You tried to specify a MSGTYP outside
      824     1667                         of this restricted list.
      825     1668               DESCRIPTION:  SETSTA.LOCK is set and the user specified a MSGTYP
      826     1669                             not allowed by SETSTA.MSGTYP.                          */
      827     1670    4                ALTRETURN;
      828     1671    4                END;
      829     1672    3             CALL INDEX (K,ADDR(USERSTA.MSGTYP#)->B$$CHAR,KC_LGL1ST) ALTRET(BTYP1);
      830     1673    3             GOTO OKTYP1;
      831     1674    3   BTYP1:    IF ADDR(USERSTA.MSGTYP#)->B$$CHAR~='*' OR USERSTA.MSGTYP#='*AUEV'
      832     1675    3             THEN GOTO TYPCHAR;
      833     1676    3   OKTYP1:   ;
      834     1677    3             CHEKSTA.MSGTYP#=USERSTA.MSGTYP#;
      835     1678    3             END;
      836     1679
      837     1680
      838     1681
      839     1682    2           IF USERSTA.CTL&~CHEKSTA.CTL THEN
      840     1683    2            IF NOT B$JIT$->B$JIT.DCB$->F$DCB.AU THEN
      841     1684    3              DO;
      842     1685    3   BADCTL:    B$JIT$->B$JIT.ERR=E_LOCCTL;
      843     1686        /*E*   ERROR:       KCI-E$LOCCTL-E
      844     1687                MESSAGE: You are not allowed to change STATION options!
      845     1688               MESSAGE1: Your access to comgroup is restricted such that you
      846     1689                         may not change STATION options (e.g. EOFNONE).
      847     1690               MESSAGE2: The VLP_STATION control flags (EOFNONE,ALLTRMS,etc.)
      848     1691                         that a comgroup user may specify may be restricted by
      849     1692                         the comgroup itself or via a !SET command.  You tried
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:106  
      850     1693                         to specify restricted control flags.
      851     1694               DESCRIPTION: SETSTA.LOCK is set and the users CTL is trying to
      852     1695                            specify options not set in SETSTA.CTL.                   */
      853     1696    3   ALTRT:     ALTRETURN;
      854     1697    3              END;
      855     1698    2           IF USERSTA.EOFTIME#~=0 AND USERSTA.EOFTIME#~=CHEKSTA.EOFTIME#
      856     1699    2           THEN GOTO BADCTL;
      857     1700    2           END;
      858     1701
      859     1702
      860     1703
      861     1704
      862     1705
      863     1706
      864     1707    1         ELSE
      865     1708                     /*    SETSTA
      866     1709                      *    is not
      867     1710                      *    LOCKed
      868     1711                      */
      869     1712    2           DO;
      870     1713    2           IF USERSTA.STATION#~=' ' THEN
      871     1714    3             DO;
      872     1715    3             CALL INDEX (K,ADDR(USERSTA.STATION#)->B$$CHAR,KC_LGL1ST) ALTRET (STACHR);
      873     1716    3             CHEKSTA.STATION#=USERSTA.STATION#;
      874     1717    3             END;
      875     1718    2           IF USERSTA.MSGTYP#~=' ' THEN
      876     1719    3             DO;
      877     1720    3             CALL INDEX (K,ADDR(USERSTA.MSGTYP#)->B$$CHAR,KC_LGL1ST) ALTRET (BTYP2);
      878     1721    3             GOTO OKTYP2;
      879     1722    3   BTYP2:    IF ADDR(USERSTA.MSGTYP#)->B$$CHAR~='*' OR USERSTA.MSGTYP#='*AUEV'
      880     1723    3             THEN GOTO TYPCHAR;
      881     1724    3   OKTYP2:   ;
      882     1725    3             CHEKSTA.MSGTYP#=USERSTA.MSGTYP#;
      883     1726    3             END;
      884     1727    2           CHEKSTA.MSGID#=USERSTA.MSGID#;
      885     1728    2           CHEKSTA.CTL=CHEKSTA.CTL|USERSTA.CTL;
      886     1729    2           IF USERSTA.EOFTIME#~=0 THEN CHEKSTA.EOFTIME#=USERSTA.EOFTIME#;
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:107  
      887     1730    2           END;
      888     1731    1   RTN:  ;
      889     1732    1         RETURN;
      890     1733        /**/
      891     1734    1   STACHR:;
      892     1735    1         B$JIT$->B$JIT.ERR=E_STACHAR;
      893     1736        /*E*   ERROR:     KCI-E$STACHAR-E
      894     1737                MESSAGE: Illegal STATION on comgroup read, write, or open.
      895     1738               MESSAGE1: STATIONs specified on comgroup service calls
      896     1739                         must have a legal file name character as their first
      897     1740                         character.  You specified one that does not.
      898     1741               DESCRIPTION:  Nobody can use special STATIONs                    */
      899     1742    1         ALTRETURN;
      900     1743        /**/
      901     1744    1   TYPCHAR:;
      902     1745    1         B$JIT$->B$JIT.ERR=E_TYPCHAR;
      903     1746        /*E*   ERROR:     KCI-E$TYPCHAR-E
      904     1747                MESSAGE: Illegal MSGTYP on comgroup read, write, or open.
      905     1748               MESSAGE1: MSGTYPs specified on comgroup service calls
      906     1749                         must have a legal file name character as their first
      907     1750                         character.  You specified one that does not or you
      908     1751                         specified '*AUEV' which is reserved for CP-6 use.
      909     1752               DESCRIPTION:  Only the AU can use special MSGTYPs, and then
      910     1753                             only on a read. */
      911     1754    1         ALTRETURN;
      912     1755        /**/
      913     1756        /*F* NAME:         KCI$VALSTA1
      914     1757             PURPOSE:      Same as KCI$VALSTA
      915     1758             DESCRIPTION:  Same as KCI$VALSTA, but the results are
      916     1759                           merged into USERSTA instead of CHEKSTA.
      917     1760                           CHEKSTA is not modified. */
      918     1761    1   KCI$VALSTA1: ENTRY (USERSTA,CHEKSTA) ALTRET;
      919     1762        /**/
      920     1763    1         STA1.STATION# =USERSTA.STATION#;
      921     1764    1         STA2.STATION# =CHEKSTA.STATION#;
      922     1765    1         STA1.MSGTYP#  =USERSTA.MSGTYP#;
      923     1766    1         STA2.MSGTYP#  =CHEKSTA.MSGTYP#;
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:108  
      924     1767    1         STA1.CTL  =USERSTA.CTL;
      925     1768    1         STA2.CTL  =CHEKSTA.CTL;
      926     1769    1         CALL KCI$VALSTA (STA1,STA2)           ALTRET(ALTRT);
      927     1770    1         USERSTA.STATION#=STA2.STATION#;
      928     1771    1         USERSTA.MSGTYP# =STA2.MSGTYP#;
      929     1772    1         USERSTA.CTL     =STA2.CTL;
      930     1773    1         RETURN;
      931     1774    1   END;

PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:109  
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KCI$VALSTA.

   Procedure KCI$VALSTA requires 208 words for executable code.
   Procedure KCI$VALSTA requires 24 words of local(AUTO) storage.

    No errors detected in file KCI$RWCG.:E05TSI    .

PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:110  

 Object Unit name= KCI$VALSTA                                 File name= KCI$RWCG.:E05TOU
 UTS= JUL 30 '97 00:15:39.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      7      7  KCI$VALSTA
    1   Proc  even  none   208    320  KCI$VALSTA
    2  RoData even  none     1      1  KCI$VALSTA

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KCI$VALSTA
     1    244          yes     yes      Std        2  KCI$VALSTA1

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KC_LGL1ST                             B$JIT$                                B_VECTNIL
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:111  


      615        1        /*T***********************************************************/
      616        2        /*T*                                                         */
      617        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      618        4        /*T*                                                         */
      619        5        /*T***********************************************************/
      620        6        /**/
      621        7        /*F* NAME:         KCI$VALSTA
      622        8             PURPOSE:      To validate a user-supplied VLP_STATION
      623        9                           against a DCB- or comgroup-supplied
      624       10                           VLP_SETSTA
      625       11             CALL:         KCI$VALSTA (USERSTA,CHEKSTA)
      626       12             INPUT:        B$JIT.DCB$ points to the comgroup DCB being
      627       13                           operated on.
      628       14             DESCRIPTION:  This routine can be used to validate
      629       15                           VLP_STATION against a VLP_SETSTA, or
      630       16                           VLP_SETSTA against another VLP_SETSTA.
      631       17
      632       18                           This works because ISTA and OSTA in VLP_SETSTA
      633       19                           have the same structure, and this structure is
      634       20                           what the first bit of VLP_STATION looks like.
      635       21
      636       22                           Both CHEKSTA and USERSTA can be either a
      637       23                           VLP_STATION, or an ISTA/OSTA from a VLP_SETSTA.
      638       24
      639       25                           USERSTA is the item supplied by the
      640       26                           user.  CHEKSTA is the item which
      641       27                           is to limit, or supply defaults for,
      642       28                           the USERSTA.  The two are merged
      643       29                           together, and the result returned
      644       30                           in CHEKSTA.  If errors are encountered,
      645       31                           we ALTRET with B$JIT.ERR set.
      646       32
      647       33                           The following specific checks are made:
      648       34
      649       35                           If CHECKSTA.CTL.LOCK is set then:
      650       36
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:112  
      651       37                           o If USERSTA.STATION is ' ' then no
      652       38                             action is taken (i.e. the original
      653       39                             CHEKSTA.STATION is returned).  Else
      654       40                             USERSTA.STATION must match CHEKSTA.STATION
      655       41                             at least up to the first '?' in CHEKSTA.STATION,
      656       42                             even if CHEKSTA.STATION is blanks.
      657       43                             Furthermore, USERSTA.STATION must have
      658       44                             a legal first character (see KC_LGL1ST in
      659       45                             KC_DATA_D).  If these checks pass,
      660       46                             CHEKSTA.STATION is overwritten with
      661       47                             USERSTA.STATION.
      662       48
      663       49                           o An identical algorithm is performed upon
      664       50                             USERSTA.MSGTYP and CHEKSTA.MSGTYP with the
      665       51                             additional consideration that '*' is a valid
      666       52                             first character so long as the specified
      667       53                             MSGTYP is not '*AUEV' which is reserved for
      668       54                             CP-6 use.
      669       55
      670       56                           o If any bits in USERSTA.CTL are set, for
      671       57                             which the corresponding bits in CHEKSTA.CTL
      672       58                             are reset, an error occurs.  Else the
      673       59                             original CHEKSTA.CTL is returned.
      674       60
      675       61                           o EOFTIME in USERSTA must be 0 or =EOFTIME in CHEKSTA
      676       62                             or an error will result.
      677       63
      678       64                           Otherwise (CHEKSTA.CTL.LOCK is reset):
      679       65
      680       66                           o If USERSTA.STATION is blanks, then CHEKSTA.STATION
      681       67                             is returned intact.  Else USERSTA.STATION must
      682       68                             have a legal first character, and overwrites
      683       69                             CHEKSTA.STATION
      684       70
      685       71                           o An identical algorithm is performed upon
      686       72                             USERSTA.MSGTYP and CHEKSTA.MSGTYP with the
      687       73                             additional consideration that '*' is a valid
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:113  
      688       74                             first character so long as the specified
      689       75                             MSGTYP is not '*AUEV' which is reserved for
      690       76                             CP-6 use.
      691       77
      692       78                           o EOFTIME is taken from USERSTA if non-zero, otherwise
      693       79                             it is taken from CHEKSTA.
      694       80
      695       81                           o USERSTA.CTL is ORed into CHEKSTA.CTL
      696       82
      697       83
      698       84                           AU DCBs are exempt from all but the first-
      699       85                           character checks.
      700       86        */
      701       87        KCI$VALSTA: PROC (USERSTA,CHEKSTA) ALTRET;

     87  1 000000   000000 700200 xent  KCI$VALSTA   TSX0  ! X66_AUTO_2
         1 000001   000030 000002                    ZERO    24,2

      702       88        /**/
      703       89
      704       90
      705       91
      706       92        /**/
      707       93        /* INCLUDES */
      708       94        /**/
      709       95        %INCLUDE B$JIT_C;
      710      409        %INCLUDE F$DCB;
      711      458        %INCLUDE KC_CP6;
      712     1018        %INCLUDE KC_DATA_R;
      713     1031        %INCLUDE KC_ERRORS_C;
      714     1078        %INCLUDE F_ERRORS_C;
      715     1318        %INCLUDE F_MACROS_C;
      716     1329        %INCLUDE UD_SEV_C;
      717     1343
      718     1344
      719     1345
      720     1346        /**/
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:114  
      721     1347        /* PARAMETERS */
      722     1348        /**/
      723     1349        %VLP_STATION (FPTN=USERSTA,STCLASS="");
      724     1376        %VLP_STATION (FPTN=CHEKSTA,STCLASS="");
      725     1403
      726     1404
      727     1405
      728     1406
      729     1407        /**/
      730     1408        /* BASED STRUCTURES */
      731     1409        /**/
      732     1410    1   DCL B$$CHARS CHAR(K) BASED CALIGNED;
      733     1411    1   DCL B$$CHAR  CHAR(1) BASED CALIGNED;
      734     1412        %B$JIT0;
      735     1501        %U$JIT1X;
      736     1504        %M$JIT2X;
      737     1507        %F$JIT3;
      738     1512        %A$JIT6X;
      739     1515
      740     1516
      741     1517
      742     1518        /**/
      743     1519        /* AUTO */
      744     1520        /**/
      745     1521    1   DCL K UBIN WORD;
      746     1522        %VLP_STATION (FPTN=STA1,STCLASS=AUTO);
      747     1549        %VLP_STATION (FPTN=STA2,STCLASS=AUTO);
      748     1576
      749     1577
      750     1578
      751     1579        /**/
      752     1580        /* SUBS */
      753     1581        /**/
      754     1582        %SUB FCG#='1303'O;
      755     1583        %SUB MID#='11'O;
      756     1584
      757     1585
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:115  
      758     1586
      759     1587        /**/
      760     1588        /* CONSTANT */
      761     1589        /**/
      762     1590        %ERRCODE (NAME=E_STACHAR,COD#=%E$STACHAR);
      763     1594        %ERRCODE (NAME=E_TYPCHAR,COD#=%E$TYPCHAR);
      764     1598        %ERRCODE (NAME=E_LOCSTA ,COD#=%E$LOCSTA );
      765     1602        %ERRCODE (NAME=E_LOCTYP ,COD#=%E$LOCTYP );
      766     1606        %ERRCODE (NAME=E_LOCCTL ,COD#=%E$LOCCTL );
      767     1610
      768     1611
      769     1612
      770     1613        /**/
      771     1614        /* REFS */
      772     1615        /**/
      773     1616    1   DCL B$JIT$ PTR SYMREF;
      774     1617
      775     1618        /**/
      776     1619        %EJECT;
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:116  
      777     1620    1         IF CHEKSTA.CTL.LOCK THEN

   1620  1 000002   200004 470500                    LDP0    @CHEKSTA,,AUTO
         1 000003   000004 234100                    SZN     4,,PR0
         1 000004   000146 605000 1                  TPL     s:1713

      778     1621                     /*    SETSTA
      779     1622                      *    is
      780     1623                      *    LOCKed
      781     1624                      */
      782     1625    2           DO;

      783     1626    2           IF USERSTA.STATION#~=' ' THEN

   1626  1 000005   200003 471500                    LDP1    @USERSTA,,AUTO
         1 000006   040000 106500                    CMPC    fill='040'O
         1 000007   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000010   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000011   000043 600000 1                  TZE     s:1652

      784     1627    3             DO;

      785     1628    3             CALL INDEX (K,'?',CHEKSTA.STATION#);

   1628  1 000012   000000 124500                    SCM     mask='000'O
         1 000013   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000014   000000 000001 2                  ADSC9   0                        cn=0,n=1
         1 000015   200005 000100                    ARG     K,,AUTO

      786     1629    3             IF ADDR(USERSTA.STATION#)->B$$CHARS ~= ADDR(CHEKSTA.STATION#)->B$$CHARS
              1629                      THEN

   1629  1 000016   200005 720100                    LXL0    K,,AUTO
         1 000017   040140 106540                    CMPC    fill='040'O
         1 000020   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 000021   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 000022   000033 600000 1                  TZE     s:1646
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:117  

      787     1630    3              IF NOT B$JIT$->B$JIT.DCB$->F$DCB.AU THEN

   1630  1 000023   000000 473400 xsym               LDP3    B$JIT$
         1 000024   300232 474500                    LDP4    154,,PR3
         1 000025   400031 236100                    LDQ     25,,PR4
         1 000026   200000 316003                    CANQ    65536,DU
         1 000027   000033 601000 1                  TNZ     s:1646

      788     1631    4                DO;

      789     1632    4                B$JIT$->B$JIT.ERR=E_LOCSTA;

   1632  1 000030   000002 236000 0                  LDQ     E_LOCSTA
         1 000031   300012 756100                    STQ     10,,PR3

      790     1633        /*E*   ERROR:      KCI-E$LOCSTA-E
      791     1634                MESSAGE: You are not permitted to use that STATION!
      792     1635               MESSAGE1: You have only restricted access to the comgroup
      793     1636                         you are using, and the STATION you specified is not
      794     1637                         allowed.
      795     1638               MESSAGE2: The possible STATIONs accessible by a comgroup
      796     1639                         user may be restricted by the comgroup itself or via
      797     1640                         a !SET command. You tried to specify a STATION outside
      798     1641                         of this restricted list
      799     1642               DESCRIPTION:  SETSTA.LOCK is set and the user specified a STATION
      800     1643                             not allowed by SETSTA.STATION.                          */
      801     1644    4                ALTRETURN;

   1644  1 000032   000000 702200 xent               TSX2  ! X66_AALT

      802     1645    4                END;
      803     1646    3             CALL INDEX (K,ADDR(USERSTA.STATION#)->B$$CHAR,KC_LGL1ST) ALTRET (STACHR);

   1646  1 000033   000100 124400                    SCM     mask='000'O
         1 000034   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000035   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:118  
         1 000036   200005 000100                    ARG     K,,AUTO
         1 000037   000234 606400 1                  TTN     STACHR

      804     1647    3             CHEKSTA.STATION#=USERSTA.STATION#;

   1647  1 000040   040100 100500                    MLR     fill='040'O
         1 000041   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000042   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8

      805     1648    3             END;

      806     1649
      807     1650
      808     1651
      809     1652    2           IF USERSTA.MSGTYP#~=' ' THEN

   1652  1 000043   040000 106500                    CMPC    fill='040'O
         1 000044   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 000045   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000046   000114 600000 1                  TZE     s:1682

      810     1653    3             DO;

      811     1654    3             CALL INDEX (K,'?',CHEKSTA.MSGTYP#);

   1654  1 000047   000000 124500                    SCM     mask='000'O
         1 000050   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000051   000000 000001 2                  ADSC9   0                        cn=0,n=1
         1 000052   200005 000100                    ARG     K,,AUTO

      812     1655    3            IF ADDR(USERSTA.MSGTYP#)->B$$CHARS ~= ADDR(CHEKSTA.MSGTYP#)->B$$CHARS THEN

   1655  1 000053   200005 720100                    LXL0    K,,AUTO
         1 000054   040140 106540                    CMPC    fill='040'O
         1 000055   100002 000010                    ADSC9   2,,PR1                   cn=0,n=*X0
         1 000056   000002 000010                    ADSC9   2,,PR0                   cn=0,n=*X0
         1 000057   000070 600000 1                  TZE     s:1672
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:119  

      813     1656    3              IF NOT B$JIT$->B$JIT.DCB$->F$DCB.AU THEN

   1656  1 000060   000000 473400 xsym               LDP3    B$JIT$
         1 000061   300232 474500                    LDP4    154,,PR3
         1 000062   400031 236100                    LDQ     25,,PR4
         1 000063   200000 316003                    CANQ    65536,DU
         1 000064   000070 601000 1                  TNZ     s:1672

      814     1657    4                DO;

      815     1658    4                B$JIT$->B$JIT.ERR=E_LOCTYP;

   1658  1 000065   000003 236000 0                  LDQ     E_LOCTYP
         1 000066   300012 756100                    STQ     10,,PR3

      816     1659        /*E*   ERROR:      KCI-E$LOCTYP-E
      817     1660                MESSAGE: You are not permitted to use that MSGTYP!
      818     1661               MESSAGE1: You have only restricted access to the comgroup
      819     1662                         you are using, and the MSGTYP you specified is not
      820     1663                         allowed.
      821     1664               MESSAGE2: The possible MSGTYPs accessible by a comgroup
      822     1665                         user may be restricted by the comgroup itself or via
      823     1666                         a !SET command. You tried to specify a MSGTYP outside
      824     1667                         of this restricted list.
      825     1668               DESCRIPTION:  SETSTA.LOCK is set and the user specified a MSGTYP
      826     1669                             not allowed by SETSTA.MSGTYP.                          */
      827     1670    4                ALTRETURN;

   1670  1 000067   000000 702200 xent               TSX2  ! X66_AALT

      828     1671    4                END;
      829     1672    3             CALL INDEX (K,ADDR(USERSTA.MSGTYP#)->B$$CHAR,KC_LGL1ST) ALTRET(BTYP1);

   1672  1 000070   000100 124400                    SCM     mask='000'O
         1 000071   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000072   100002 000001                    ADSC9   2,,PR1                   cn=0,n=1
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:120  
         1 000073   200005 000100                    ARG     K,,AUTO
         1 000074   000076 606400 1                  TTN     BTYP1

      830     1673    3             GOTO OKTYP1;

   1673  1 000075   000107 710000 1                  TRA     OKTYP1

      831     1674    3   BTYP1:    IF ADDR(USERSTA.MSGTYP#)->B$$CHAR~='*' OR USERSTA.MSGTYP#='*AUEV'

   1674  1 000076   200003 470500       BTYP1        LDP0    @USERSTA,,AUTO
         1 000077   000002 236100                    LDQ     2,,PR0
         1 000100   777000 376003                    ANQ     -512,DU
         1 000101   052000 116003                    CMPQ    21504,DU
         1 000102   000240 601000 1                  TNZ     TYPCHAR
         1 000103   040000 106500                    CMPC    fill='040'O
         1 000104   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000105   000005 000005 0                  ADSC9   E_LOCCTL+1               cn=0,n=5
         1 000106   000240 600000 1                  TZE     TYPCHAR

   1674  1 000107                       OKTYP1       null
      832     1675    3             THEN GOTO TYPCHAR;
      833     1676    3   OKTYP1:   ;
      834     1677    3             CHEKSTA.MSGTYP#=USERSTA.MSGTYP#;

   1677  1 000107   200003 470500                    LDP0    @USERSTA,,AUTO
         1 000110   200004 471500                    LDP1    @CHEKSTA,,AUTO
         1 000111   040100 100500                    MLR     fill='040'O
         1 000112   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000113   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8

      835     1678    3             END;

      836     1679
      837     1680
      838     1681
      839     1682    2           IF USERSTA.CTL&~CHEKSTA.CTL THEN

PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:121  
   1682  1 000114   200004 470500                    LDP0    @CHEKSTA,,AUTO
         1 000115   000004 236100                    LDQ     4,,PR0
         1 000116   777400 376003                    ANQ     -256,DU
         1 000117   777400 676003                    ERQ     -256,DU
         1 000120   200026 756100                    STQ     STA2+8,,AUTO
         1 000121   200003 471500                    LDP1    @USERSTA,,AUTO
         1 000122   100004 236100                    LDQ     4,,PR1
         1 000123   777400 376003                    ANQ     -256,DU
         1 000124   200026 376100                    ANQ     STA2+8,,AUTO
         1 000125   000137 600000 1                  TZE     s:1698

      840     1683    2            IF NOT B$JIT$->B$JIT.DCB$->F$DCB.AU THEN

   1683  1 000126   000000 473400 xsym               LDP3    B$JIT$
         1 000127   300232 474500                    LDP4    154,,PR3
         1 000130   400031 236100                    LDQ     25,,PR4
         1 000131   200000 316003                    CANQ    65536,DU
         1 000132   000137 601000 1                  TNZ     s:1698

      841     1684    3              DO;

      842     1685    3   BADCTL:    B$JIT$->B$JIT.ERR=E_LOCCTL;

   1685  1 000133   000004 236000 0     BADCTL       LDQ     E_LOCCTL
         1 000134   000000 470400 xsym               LDP0    B$JIT$
         1 000135   000012 756100                    STQ     10,,PR0

      843     1686        /*E*   ERROR:       KCI-E$LOCCTL-E
      844     1687                MESSAGE: You are not allowed to change STATION options!
      845     1688               MESSAGE1: Your access to comgroup is restricted such that you
      846     1689                         may not change STATION options (e.g. EOFNONE).
      847     1690               MESSAGE2: The VLP_STATION control flags (EOFNONE,ALLTRMS,etc.)
      848     1691                         that a comgroup user may specify may be restricted by
      849     1692                         the comgroup itself or via a !SET command.  You tried
      850     1693                         to specify restricted control flags.
      851     1694               DESCRIPTION: SETSTA.LOCK is set and the users CTL is trying to
      852     1695                            specify options not set in SETSTA.CTL.                   */
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:122  
      853     1696    3   ALTRT:     ALTRETURN;

   1696  1 000136   000000 702200 xent  ALTRT        TSX2  ! X66_AALT

      854     1697    3              END;
      855     1698    2           IF USERSTA.EOFTIME#~=0 AND USERSTA.EOFTIME#~=CHEKSTA.EOFTIME#

   1698  1 000137   100004 720100                    LXL0    4,,PR1
         1 000140   000145 600000 1                  TZE     s:1700
         1 000141   100004 236100                    LDQ     4,,PR1
         1 000142   000004 676100                    ERQ     4,,PR0
         1 000143   777777 376007                    ANQ     -1,DL
         1 000144   000133 601000 1                  TNZ     BADCTL

      856     1699    2           THEN GOTO BADCTL;
      857     1700    2           END;

   1700  1 000145   000233 710000 1                  TRA     RTN

      858     1701
      859     1702
      860     1703
      861     1704
      862     1705
      863     1706
      864     1707    1         ELSE
      865     1708                     /*    SETSTA
      866     1709                      *    is not
      867     1710                      *    LOCKed
      868     1711                      */
      869     1712    2           DO;

      870     1713    2           IF USERSTA.STATION#~=' ' THEN

   1713  1 000146   200003 471500                    LDP1    @USERSTA,,AUTO
         1 000147   040000 106500                    CMPC    fill='040'O
         1 000150   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:123  
         1 000151   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000152   000163 600000 1                  TZE     s:1718

      871     1714    3             DO;

      872     1715    3             CALL INDEX (K,ADDR(USERSTA.STATION#)->B$$CHAR,KC_LGL1ST) ALTRET (STACHR);

   1715  1 000153   000100 124400                    SCM     mask='000'O
         1 000154   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000155   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000156   200005 000100                    ARG     K,,AUTO
         1 000157   000234 606400 1                  TTN     STACHR

      873     1716    3             CHEKSTA.STATION#=USERSTA.STATION#;

   1716  1 000160   040100 100500                    MLR     fill='040'O
         1 000161   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000162   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8

      874     1717    3             END;

      875     1718    2           IF USERSTA.MSGTYP#~=' ' THEN

   1718  1 000163   040000 106500                    CMPC    fill='040'O
         1 000164   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 000165   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000166   000213 600000 1                  TZE     s:1727

      876     1719    3             DO;

      877     1720    3             CALL INDEX (K,ADDR(USERSTA.MSGTYP#)->B$$CHAR,KC_LGL1ST) ALTRET (BTYP2);

   1720  1 000167   000100 124400                    SCM     mask='000'O
         1 000170   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000171   100002 000001                    ADSC9   2,,PR1                   cn=0,n=1
         1 000172   200005 000100                    ARG     K,,AUTO
         1 000173   000175 606400 1                  TTN     BTYP2
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:124  

      878     1721    3             GOTO OKTYP2;

   1721  1 000174   000206 710000 1                  TRA     OKTYP2

      879     1722    3   BTYP2:    IF ADDR(USERSTA.MSGTYP#)->B$$CHAR~='*' OR USERSTA.MSGTYP#='*AUEV'

   1722  1 000175   200003 470500       BTYP2        LDP0    @USERSTA,,AUTO
         1 000176   000002 236100                    LDQ     2,,PR0
         1 000177   777000 376003                    ANQ     -512,DU
         1 000200   052000 116003                    CMPQ    21504,DU
         1 000201   000240 601000 1                  TNZ     TYPCHAR
         1 000202   040000 106500                    CMPC    fill='040'O
         1 000203   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000204   000005 000005 0                  ADSC9   E_LOCCTL+1               cn=0,n=5
         1 000205   000240 600000 1                  TZE     TYPCHAR

   1722  1 000206                       OKTYP2       null
      880     1723    3             THEN GOTO TYPCHAR;
      881     1724    3   OKTYP2:   ;
      882     1725    3             CHEKSTA.MSGTYP#=USERSTA.MSGTYP#;

   1725  1 000206   200003 470500                    LDP0    @USERSTA,,AUTO
         1 000207   200004 471500                    LDP1    @CHEKSTA,,AUTO
         1 000210   040100 100500                    MLR     fill='040'O
         1 000211   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000212   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8

      883     1726    3             END;

      884     1727    2           CHEKSTA.MSGID#=USERSTA.MSGID#;

   1727  1 000213   200003 470500                    LDP0    @USERSTA,,AUTO
         1 000214   200004 471500                    LDP1    @CHEKSTA,,AUTO
         1 000215   000005 235100                    LDA     5,,PR0
         1 000216   100005 755100                    STA     5,,PR1

PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:125  
      885     1728    2           CHEKSTA.CTL=CHEKSTA.CTL|USERSTA.CTL;

   1728  1 000217   000004 236100                    LDQ     4,,PR0
         1 000220   777400 376003                    ANQ     -256,DU
         1 000221   200026 756100                    STQ     STA2+8,,AUTO
         1 000222   100004 236100                    LDQ     4,,PR1
         1 000223   777400 376003                    ANQ     -256,DU
         1 000224   200026 276100                    ORQ     STA2+8,,AUTO
         1 000225   100004 676100                    ERQ     4,,PR1
         1 000226   777400 376003                    ANQ     -256,DU
         1 000227   100004 656100                    ERSQ    4,,PR1

      886     1729    2           IF USERSTA.EOFTIME#~=0 THEN CHEKSTA.EOFTIME#=USERSTA.EOFTIME#;

   1729  1 000230   000004 720100                    LXL0    4,,PR0
         1 000231   000233 600000 1                  TZE     RTN

   1729  1 000232   100004 440100                    SXL0    4,,PR1

      887     1730    2           END;

   1728  1 000233                       RTN          null
      888     1731    1   RTN:  ;
      889     1732    1         RETURN;

   1732  1 000233   000000 702200 xent               TSX2  ! X66_ARET

   1728  1 000234                       STACHR       null
      890     1733        /**/
      891     1734    1   STACHR:;
      892     1735    1         B$JIT$->B$JIT.ERR=E_STACHAR;

   1735  1 000234   000000 236000 0                  LDQ     E_STACHAR
         1 000235   000000 470400 xsym               LDP0    B$JIT$
         1 000236   000012 756100                    STQ     10,,PR0

      893     1736        /*E*   ERROR:     KCI-E$STACHAR-E
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:126  
      894     1737                MESSAGE: Illegal STATION on comgroup read, write, or open.
      895     1738               MESSAGE1: STATIONs specified on comgroup service calls
      896     1739                         must have a legal file name character as their first
      897     1740                         character.  You specified one that does not.
      898     1741               DESCRIPTION:  Nobody can use special STATIONs                    */
      899     1742    1         ALTRETURN;

   1742  1 000237   000000 702200 xent               TSX2  ! X66_AALT

   1735  1 000240                       TYPCHAR      null
      900     1743        /**/
      901     1744    1   TYPCHAR:;
      902     1745    1         B$JIT$->B$JIT.ERR=E_TYPCHAR;

   1745  1 000240   000001 236000 0                  LDQ     E_TYPCHAR
         1 000241   000000 471400 xsym               LDP1    B$JIT$
         1 000242   100012 756100                    STQ     10,,PR1

      903     1746        /*E*   ERROR:     KCI-E$TYPCHAR-E
      904     1747                MESSAGE: Illegal MSGTYP on comgroup read, write, or open.
      905     1748               MESSAGE1: MSGTYPs specified on comgroup service calls
      906     1749                         must have a legal file name character as their first
      907     1750                         character.  You specified one that does not or you
      908     1751                         specified '*AUEV' which is reserved for CP-6 use.
      909     1752               DESCRIPTION:  Only the AU can use special MSGTYPs, and then
      910     1753                             only on a read. */
      911     1754    1         ALTRETURN;

   1754  1 000243   000000 702200 xent               TSX2  ! X66_AALT

      912     1755        /**/
      913     1756        /*F* NAME:         KCI$VALSTA1
      914     1757             PURPOSE:      Same as KCI$VALSTA
      915     1758             DESCRIPTION:  Same as KCI$VALSTA, but the results are
      916     1759                           merged into USERSTA instead of CHEKSTA.
      917     1760                           CHEKSTA is not modified. */
      918     1761    1   KCI$VALSTA1: ENTRY (USERSTA,CHEKSTA) ALTRET;
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:127  

   1761  1 000244   000000 700200 xent  KCI$VALSTA1  TSX0  ! X66_AUTO_2
         1 000245   000030 000002                    ZERO    24,2

      919     1762        /**/
      920     1763    1         STA1.STATION# =USERSTA.STATION#;

   1763  1 000246   200003 470500                    LDP0    @USERSTA,,AUTO
         1 000247   040100 100500                    MLR     fill='040'O
         1 000250   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000251   200006 000010                    ADSC9   STA1,,AUTO               cn=0,n=8

      921     1764    1         STA2.STATION# =CHEKSTA.STATION#;

   1764  1 000252   200004 471500                    LDP1    @CHEKSTA,,AUTO
         1 000253   040100 100500                    MLR     fill='040'O
         1 000254   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000255   200016 000010                    ADSC9   STA2,,AUTO               cn=0,n=8

      922     1765    1         STA1.MSGTYP#  =USERSTA.MSGTYP#;

   1765  1 000256   040100 100500                    MLR     fill='040'O
         1 000257   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000260   200010 000010                    ADSC9   STA1+2,,AUTO             cn=0,n=8

      923     1766    1         STA2.MSGTYP#  =CHEKSTA.MSGTYP#;

   1766  1 000261   040100 100500                    MLR     fill='040'O
         1 000262   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 000263   200020 000010                    ADSC9   STA2+2,,AUTO             cn=0,n=8

      924     1767    1         STA1.CTL  =USERSTA.CTL;

   1767  1 000264   000004 236100                    LDQ     4,,PR0
         1 000265   200012 676100                    ERQ     STA1+4,,AUTO
         1 000266   777400 376003                    ANQ     -256,DU
         1 000267   200012 656100                    ERSQ    STA1+4,,AUTO
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:128  

      925     1768    1         STA2.CTL  =CHEKSTA.CTL;

   1768  1 000270   100004 236100                    LDQ     4,,PR1
         1 000271   200022 676100                    ERQ     STA2+4,,AUTO
         1 000272   777400 376003                    ANQ     -256,DU
         1 000273   200022 656100                    ERSQ    STA2+4,,AUTO

      926     1769    1         CALL KCI$VALSTA (STA1,STA2)           ALTRET(ALTRT);

   1769  1 000274   200016 633500                    EPPR3   STA2,,AUTO
         1 000275   200027 453500                    STP3    STA2+9,,AUTO
         1 000276   200006 634500                    EPPR4   STA1,,AUTO
         1 000277   200026 454500                    STP4    STA2+8,,AUTO
         1 000300   200026 630500                    EPPR0   STA2+8,,AUTO
         1 000301   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000302   000000 701000 1                  TSX1    s:87
         1 000303   000136 702000 1                  TSX2    ALTRT

      927     1770    1         USERSTA.STATION#=STA2.STATION#;

   1770  1 000304   200003 470500                    LDP0    @USERSTA,,AUTO
         1 000305   200016 237100                    LDAQ    STA2,,AUTO
         1 000306   000000 755100                    STA     0,,PR0
         1 000307   000001 756100                    STQ     1,,PR0

      928     1771    1         USERSTA.MSGTYP# =STA2.MSGTYP#;

   1771  1 000310   200020 237100                    LDAQ    STA2+2,,AUTO
         1 000311   000002 755100                    STA     2,,PR0
         1 000312   000003 756100                    STQ     3,,PR0

      929     1772    1         USERSTA.CTL     =STA2.CTL;

   1772  1 000313   200022 236100                    LDQ     STA2+4,,AUTO
         1 000314   000004 676100                    ERQ     4,,PR0
         1 000315   777400 376003                    ANQ     -256,DU
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:129  
         1 000316   000004 656100                    ERSQ    4,,PR0

      930     1773    1         RETURN;

   1773  1 000317   000000 702200 xent               TSX2  ! X66_ARET

E_STACHAR
 Sect OctLoc
   0     000   130311 015362                                                    X...

E_TYPCHAR
 Sect OctLoc
   0     001   130311 015372                                                    X...

E_LOCSTA
 Sect OctLoc
   0     002   130311 015552                                                    X...

E_LOCTYP
 Sect OctLoc
   0     003   130311 015562                                                    X...

E_LOCCTL
 Sect OctLoc
   0     004   130311 015572                                                    X...

(unnamed)
 Sect OctLoc
   0     005   052101 125105   126040 040040                                    *AUEV

(unnamed)
 Sect OctLoc
   2     000   077040 040040                                                    ?
      931     1774    1   END;

PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:130  
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KCI$VALSTA.
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:131  

 **** Variables and constants ****

  ****  Section 000 RoData KCI$VALSTA

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/b STRC        r     1 E_LOCCTL                   2-0-0/b STRC        r     1 E_LOCSTA
     3-0-0/b STRC        r     1 E_LOCTYP                   0-0-0/b STRC        r     1 E_STACHAR
     1-0-0/b STRC        r     1 E_TYPCHAR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CHEKSTA                   3-0-0/w PTR         r     1 @USERSTA
    *0-0-0/w STRC(288)   r     1 CHEKSTA                    5-0-0/w UBIN        r     1 K
     6-0-0/w STRC(288)   r     1 STA1                      16-0-0/w STRC(288)   r     1 STA2
    *0-0-0/w STRC(288)   r     1 USERSTA

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/c CHAR(68)    r     1 KC_LGL1ST

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR        r     1 B$$CHAR                    0-0-0/c ACHR        r     1 B$$CHARS
     0-0-0/d STRC(7560)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB

PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:132  

   Procedure KCI$VALSTA requires 208 words for executable code.
   Procedure KCI$VALSTA requires 24 words of local(AUTO) storage.

    No errors detected in file KCI$RWCG.:E05TSI    .
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:133  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:134  
          MINI XREF LISTING

ALTRT
      1696**LABEL    1769--CALLALT
B$$CHAR
      1411**DCL      1646>>CALLBLT  1672>>CALLBLT  1674>>IF       1715>>CALLBLT  1720>>CALLBLT  1722>>IF
B$$CHARS
      1410**DCL      1629>>IF       1629>>IF       1655>>IF       1655>>IF
B$JIT.DCB$
      1508**DCL      1630>>IF       1656>>IF       1683>>IF
B$JIT.ERR
      1418**DCL      1632<<ASSIGN   1658<<ASSIGN   1685<<ASSIGN   1735<<ASSIGN   1745<<ASSIGN
B$JIT.ERR.MID
      1419**DCL      1419--REDEF
B$JIT$
      1616**DCL      1413--IMP-PTR  1630>>IF       1632>>ASSIGN   1656>>IF       1658>>ASSIGN   1683>>IF
      1685>>ASSIGN   1735>>ASSIGN   1745>>ASSIGN
BADCTL
      1685**LABEL    1699--GOTO
BTYP1
      1674**LABEL    1672--CALLALT
BTYP2
      1722**LABEL    1720--CALLALT
CHEKSTA
      1388**DCL        87--PROC     1761--ENTRY
CHEKSTA.CTL
      1392**DCL      1682>>IF       1728<<ASSIGN   1728>>ASSIGN   1768>>ASSIGN
CHEKSTA.CTL.LOCK
      1393**DCL      1620>>IF
CHEKSTA.EOFTIME#
      1397**DCL      1698>>IF       1729<<ASSIGN
CHEKSTA.MSGID#
      1398**DCL      1727<<ASSIGN
CHEKSTA.MSGIDXT
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:135  
      1398**DCL      1401--REDEF
CHEKSTA.MSGTYP#
      1392**DCL      1654>>CALLBLT  1655--IF       1677<<ASSIGN   1725<<ASSIGN   1766>>ASSIGN
CHEKSTA.STATION#
      1392**DCL      1628>>CALLBLT  1629--IF       1647<<ASSIGN   1716<<ASSIGN   1764>>ASSIGN
E_LOCCTL
      1607**DCL      1685>>ASSIGN
E_LOCSTA
      1599**DCL      1632>>ASSIGN
E_LOCTYP
      1603**DCL      1658>>ASSIGN
E_STACHAR
      1591**DCL      1735>>ASSIGN
E_TYPCHAR
      1595**DCL      1745>>ASSIGN
F$DCB.ACTPOS
       435**DCL       435--REDEF
F$DCB.ARS
       410**DCL       410--REDEF
F$DCB.ATTR
       428**DCL       429--REDEF
F$DCB.AU
       421**DCL      1630>>IF       1656>>IF       1683>>IF
F$DCB.BORROW
       443**DCL       443--REDEF     443--REDEF     443--REDEF
F$DCB.DCBNAME.L
       457**DCL       457--IMP-SIZ
F$DCB.EOMCHAR
       414**DCL       414--REDEF
F$DCB.FLDID
       438**DCL       438--REDEF
F$DCB.FORM$
       432**DCL       432--REDEF
F$DCB.FSECT
       448**DCL       448--REDEF
F$DCB.FSN
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:136  
       425**DCL       425--REDEF     425--REDEF     426--REDEF
F$DCB.HEADER$
       431**DCL       431--REDEF
F$DCB.IXTNSIZE
       429**DCL       429--REDEF
F$DCB.LASTSTA$
       419**DCL       419--REDEF
F$DCB.LVL
       444**DCL       444--REDEF
F$DCB.NAME.C
       419**DCL       419--REDEF
F$DCB.NOEOF
       440**DCL       440--REDEF
F$DCB.NRECS
       430**DCL       430--REDEF
F$DCB.NRECX
       449**DCL       449--REDEF
F$DCB.OHDR
       441**DCL       441--REDEF
F$DCB.ORG
       424**DCL       424--REDEF
F$DCB.PRECNO
       447**DCL       447--REDEF
F$DCB.RCSZ
       452**DCL       452--REDEF
F$DCB.RES
       420**DCL       420--REDEF
F$DCB.SETX
       432**DCL       432--REDEF
F$DCB.TAB$
       431**DCL       432--REDEF
F$DCB.TDA
       446**DCL       446--REDEF
F$DCB.WSN
       421**DCL       421--REDEF
K
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:137  
      1521**DCL      1410--IMP-SIZ  1628<<CALLBLT  1629>>IF       1629>>IF       1646<<CALLBLT  1654<<CALLBLT
      1655>>IF       1655>>IF       1672<<CALLBLT  1715<<CALLBLT  1720<<CALLBLT
KCI$VALSTA
        87**PROC     1769--CALL
KC_LGL1ST
      1028**DCL      1646>>CALLBLT  1672>>CALLBLT  1715>>CALLBLT  1720>>CALLBLT
OKTYP1
      1674**LABEL    1673--GOTO
OKTYP2
      1722**LABEL    1721--GOTO
STA1
      1534**DCL      1769<>CALL
STA1.CTL
      1538**DCL      1767<<ASSIGN
STA1.MSGIDXT
      1544**DCL      1547--REDEF
STA1.MSGTYP#
      1538**DCL      1765<<ASSIGN
STA1.STATION#
      1538**DCL      1763<<ASSIGN
STA2
      1561**DCL      1769<>CALL
STA2.CTL
      1565**DCL      1768<<ASSIGN   1772>>ASSIGN
STA2.MSGIDXT
      1571**DCL      1574--REDEF
STA2.MSGTYP#
      1565**DCL      1766<<ASSIGN   1771>>ASSIGN
STA2.STATION#
      1565**DCL      1764<<ASSIGN   1770>>ASSIGN
STACHR
      1728**LABEL    1646--CALLALT  1715--CALLALT
TYPCHAR
      1735**LABEL    1675--GOTO     1723--GOTO
USERSTA
      1361**DCL        87--PROC     1761--ENTRY
PL6.E3A0      #003=KCI$VALSTA File=KCI$RWCG.:E05TSI                              WED 07/30/97 00:15 Page:138  
USERSTA.CTL
      1365**DCL      1682>>IF       1728>>ASSIGN   1767>>ASSIGN   1772<<ASSIGN
USERSTA.EOFTIME#
      1370**DCL      1698>>IF       1698>>IF       1729>>IF       1729>>ASSIGN
USERSTA.MSGID#
      1371**DCL      1727>>ASSIGN
USERSTA.MSGIDXT
      1371**DCL      1374--REDEF
USERSTA.MSGTYP#
      1365**DCL      1652>>IF       1655--IF       1672--CALLBLT  1674--IF       1674>>IF       1677>>ASSIGN
      1718>>IF       1720--CALLBLT  1722--IF       1722>>IF       1725>>ASSIGN   1765>>ASSIGN   1771<<ASSIGN
USERSTA.STATION#
      1365**DCL      1626>>IF       1629--IF       1646--CALLBLT  1647>>ASSIGN   1713>>IF       1715--CALLBLT
      1716>>ASSIGN   1763>>ASSIGN   1770<<ASSIGN
