VERSION E05

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:1    
        1        1        /*M* FTL$LBLTAP label construction and processing routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* CRT=1,CTI=4,DCI=6,SQB,ECI=3,CSI=3,IPC,DIN=2,SDI=3 */
        8        8
        9        9        FTL$LBLTAP: PROC( THELBL, LBL$, NUM, ULBL$, UNUM ) ALTRET;
       10       10
       11       11         /***
       12       12          *** INCLUDE files:
       13       13          ***/
       14       14
       15       15        %INCLUDE B$USER;
       16      231        %B$USERREFS;
       17      235        %INCLUDE B_PTRS_R;
       18      243        %INCLUDE CP_6;
       19     5802         %VLP_ULBL(FPTN=VLP_ULBL,STCLASS="BASED(LBL1$)");
       20     5816        %INCLUDE CP_6_SUBS;
       21     6356        %MACRO F$DCBBJ(BASED=BASED);
       22     6357        %INCLUDE F$DCB;
       23     6406        %MEND;
       24     6407         %F$DCBBJ(BASED="BASED(JDCB$)");
       25     6457        %INCLUDE F$JIT_C;
       26     6887        %INCLUDE F_ERRORS_C;
       27     7127        %INCLUDE FM_BUF_R;
       28     7136        %INCLUDE FT_SUBS;
       29     7216        %MACRO FT$DDTBD(BASED=BASED);
       30     7217        %INCLUDE FT$DDT;
       31     7278        %MEND;
       32     7279         %FT$DDTBD(BASED="BASED(DDDT$)");
       33     7341        %INCLUDE FT$LBLS;
       34     7609        %INCLUDE FT$RECS;
       35     7677        %INCLUDE NK$LDCT;
       36     7779        %INCLUDE NK_LDCT_R;
       37     7788         %NK$LDCT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:2    
       38     7834        %INCLUDE XUD_UTS_M;
       39     7916         %XUD$UTS_ENTRIES;
       40     7948
       41     7949         /***
       42     7950          *** External routines:
       43     7951          ***/
       44     7952
       45     7953    1     DCL FMD$GETBUF ENTRY(3);              /* Get specified FPOOL buffer         */
       46     7954    1     DCL FMD$RELBUF ENTRY(1);              /* Release specified FPOOL buffer     */
       47     7955    1     DCL FPO$RDEOFLBL ENTRY(1) ALTRET;     /* Read EOF/EOV label from OD         */
       48     7956    1     DCL FPO$WRITELBL ENTRY(2) ALTRET;     /* Write labels to OD file            */
       49     7957    1     DCL FPO$FINDSEQ ENTRY ALTRET;         /* Position to OD file by seq number  */
       50     7958    1     DCL FPO$CLOSEIN ENTRY ALTRET;         /* Tell controller about FUN=IN close */
       51     7959    1     DCL FPO$OPENIN ENTRY ALTRET;          /* Tell controller about input open   */
       52     7960    1     DCL FTI$RDASC ENTRY(1) ALTRET;        /* Read ASCII into specified buffer   */
       53     7961    1     DCL FTI$RDASCEBC ENTRY(1) ALTRET; /* Read ASCII or EBCDIC into specified buffer */
       54     7962    1     DCL FTI$REWIND ENTRY ALTRET;          /* Rewind the tape                    */
       55     7963    1     DCL FTI$SPFILE ENTRY ALTRET;          /* Space DCB.ARS of files             */
       56     7964    1     DCL FTI$SPREC ENTRY ALTRET;           /* Space DCB.ARS of records           */
       57     7965    1     DCL FTI$WRASCEBC ENTRY(1) ALTRET; /* Write specified ASCII or EBCDIC buffer */
       58     7966    1     DCL FTI$WRFM ENTRY ALTRET;            /* Write file mark                    */
       59     7967    1     DCL FTR$CHNGVOL ENTRY(1) ALTRET;      /* Change to specified volume         */
       60     7968    1     DCL FTR$CHNGVOLNR ENTRY(1) ALTRET; /* Change to specified volume--no rewind */
       61     7969    1     DCL FTR$GETSN ENTRY(2) ALTRET;        /* Get specified serial number        */
       62     7970    1     DCL FTW$CVOL ENTRY ALTRET;            /* Volume change                      */
       63     7971    1     DCL FTW$TRNCHLD ENTRY ALTRET;    /* Trunc FPOOL buffer (if any) and hold it */
       64     7972    1     DCL FTW$TRNCOD ENTRY ALTRET;          /* Truncate optical disk file buffers */
       65     7973    1     DCL HFF$DSIZ ENTRY(2) ALTRET;         /* Calc size of segment               */
       66     7974    1     DCL SSS$SYSTIME ENTRY(1);             /* Return universal time              */
       67     7975    1     DCL UMT$JDATE ENTRY(2) ALTRET;     /* Convert universal time to Julian date */
       68     7976
       69     7977         /***
       70     7978          *** SYMREF data:
       71     7979          ***/
       72     7980
       73     7981    1     DCL B$JIT$ PTR SYMREF;           /* J. Sheinberg says this needs no comment */
       74     7982    1     DCL B_TICSDAY UBIN SYMREF;            /* Number of universal time tics/day  */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:3    
       75     7983        %VLR_SITEINFO( FPTN=B_SITEINFO, STCLASS=SYMREF );
       76     8002
       77     8003         /***
       78     8004          *** Parameters:
       79     8005          ***/
       80     8006
       81     8007    1     DCL LBL$ PTR;                         /* Pointer to user label group        */
       82     8008    1     DCL NUM SBIN;                         /* Number of user labels in group     */
       83     8009    1     DCL THELBL CHAR(3);         /* Label type desired (HDR, EOF, EOV, UTL, UHL) */
       84     8010    1     DCL ULBL$ PTR;                        /* Pointer to second user label group */
       85     8011    1     DCL UNUM SBIN;                        /* Size of second label group         */
       86     8012
       87     8013         /***
       88     8014          *** AUTO data:
       89     8015          ***/
       90     8016
       91     8017    1     DCL DDDT$ PTR AUTO;                /* Pointer to DDT entry for DCB's device */
       92     8018    1     DCL JDCB$ PTR AUTO;                   /* Pointer to DCB                     */
       93     8019    1     DCL I SBIN AUTO;                      /* Indexing uses                      */
       94     8020    1     DCL J UBIN(36) AUTO;                  /* Used for UTS rounding              */
       95     8021    1     DCL LBL1$ PTR AUTO;                   /* Pointer to FPOOL buffer            */
       96     8022    1     DCL LBL2$ PTR AUTO;                   /* Pointer to second label in FPOOL   */
       97     8023    1     DCL LOOKDIR SBIN AUTO;                /* Direction that seq# searched for   */
       98     8024    1     DCL N SBIN AUTO;                      /* End of index range uses            */
       99     8025    1     DCL NBR_LBLS SBIN AUTO;               /* Number of labels to read/write     */
      100     8026    1     DCL NOT_TAPE_END BIT(1) ALIGNED AUTO; /* Set when tape end                  */
      101     8027    1     DCL SAVFSN SBIN AUTO;                 /* Saved file sequence number         */
      102     8028    1     DCL SAVVOL SBIN AUTO;                 /* Saved volume number                */
      103     8029    1     DCL SECTFIND BIT(1) AUTO;             /* Indicates find section of file     */
      104     8030    1     DCL SKIPS SBIN AUTO;                  /* Number of file marks to skip       */
      105     8031    1     DCL TEMP SBIN AUTO;                   /* For intermediate values            */
      106     8032    1     DCL TEMP$ PTR AUTO;                   /* TeMpOrArY pOiNtEr                  */
      107     8033    1     DCL THISFSECT SBIN AUTO;              /* FSECT of current file              */
      108     8034    1     DCL THISFSN SBIN AUTO;                /* FSN of current file                */
      109     8035    1     DCL SN CHAR(6) AUTO;                  /* Serial number                      */
      110     8036
      111     8037    1     DCL 1 DT1 AUTO UNAL,                  /* TEMP LOC. FOR CURRENT JULIAN DATE  */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:4    
      112     8038    1            2 CEN CHAR (1),                /* CENTURY INDICATOR                  */
      113     8039    1            2 JD_R CHAR (5),               /* JULIAN DATE                        */
      114     8040    1            2 JD REDEF JD_R,               /* JULIAN DATE (YYDDD)                */
      115     8041    1               3 YR CHAR (2),              /* YEAR                               */
      116     8042    1               3 DY CHAR (3);              /* DAY                                */
      117     8043
      118     8044         /***
      119     8045          *** BASED:
      120     8046          ***/
      121     8047
      122     8048    1     DCL NCHARS CHAR(N) BASED UNAL;
      123     8049    1     DCL ONE_WORD SBIN BASED CALIGNED;
      124     8050
      125     8051         /***
      126     8052          *** CONSTANT data:
      127     8053          ***/
      128     8054
      129     8055        %FT$ERR( ERRNAME=E_BADSPAN, MID='14'O, CODE=%E$BADSPAN, SEV=2 );
      130     8063        /*E*     ERROR: FTL-E$BADSPAN
      131     8064                 MESSAGE: Inconsistent spanning information% on %TA%
      132     8065                 MESSAGE1: Either the previous record segment indicated that the
      133     8066                           current segment should be a continuation or
      134     8067                           indicated that the current segment should begin the
      135     8068                           next record.
      136     8069                 DESCRIPTION: End of file hit while expecting continuing segment.
      137     8070         ***/
      138     8071
      139     8072        %FT$ERR( ERRNAME=E_BLKCNT, MID='14'O, CODE=%E$BLKCNT, SEV=2 );
      140     8080        /*E*     ERROR: FTL-E$BLKCNT-2
      141     8081                 MESSAGE: Inconsistent block count% for %TA%
      142     8082                 MESSAGE1: The accumulated block count did not match the
      143     8083                           count specified in the end of file section labels.
      144     8084                 DESCRIPTION: The system accumulated block count is not the
      145     8085                    same as the block count in the EOV or EOF label.
      146     8086         ***/
      147     8087
      148     8088        %FT$ERR( ERRNAME=E_EOF, MID='14'O, CODE=%E$EOF, SEV=2 );
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:5    
      149     8096        /*E*     ERROR: FTL-E$EOF-2
      150     8097                 MESSAGE: End of file% on %TA%
      151     8098                 MESSAGE1: The last record of the file has already been passed.
      152     8099                 DESCRIPTION: End of data hit on read.
      153     8100         ***/
      154     8101
      155     8102        %FT$ERR( ERRNAME=E_EOSET, MID='14'O, CODE=%E$EOSET, SEV=2 );
      156     8110        /*E*     ERROR: FTL-E$EOSET-2
      157     8111                 MESSAGE: End of volume set% on %TA%
      158     8112                 MESSAGE1: The last file of the volume set has already been passed.
      159     8113                 DESCRIPTION: Looking for file by file sequence number
      160     8114                    resulted in end of set.
      161     8115         ***/
      162     8116
      163     8117        %FT$ERR( ERRNAME=E_EOVOL, MID='14'O, CODE=%E$EOVOL, SEV=2 );
      164     8125        /*E*     ERROR: FTL-E$EOVOL-2
      165     8126                 MESSAGE: End of volume% on %TA%
      166     8127                 MESSAGE1: End of volume with user-requested CVOL notification.
      167     8128                 DESCRIPTION: End of volume hit on read--user requested CVOL handling.
      168     8129         ***/
      169     8130
      170     8131        %FT$ERR( ERRNAME=E_EOVOLS, MID='14'O, CODE=%E$EOVOLS, SEV=2 );
      171     8139        /*E*     ERROR: FTL-E$EOVOLS-2
      172     8140                 MESSAGE: End of volume...partial record% on %TA%
      173     8141                 MESSAGE1: The last record (segment) of the current volume
      174     8142                           indicates that the current record has not yet ended
      175     8143                           but you asked for CVOL control and you got it!
      176     8144                 DESCRIPTION: End of volume hit on read--user requested CVOL handling.
      177     8145         ***/
      178     8146
      179     8147        %FT$ERR( ERRNAME=E_FSNERR, MID='14'O, CODE=%E$FSNERR, SEV=2 );
      180     8155        /*E*     ERROR: FTL-E$FSNERR-2
      181     8156                 MESSAGE: File sequence number error% on %TA%
      182     8157                 MESSAGE1: File specified by sequence number was not found
      183     8158                    because file sequence numbers in volume set were out of order.
      184     8159         ***/
      185     8160
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:6    
      186     8161        %FT$ERR( ERRNAME=E_NOFILE, MID='14'O, CODE=%E$NOFILE, SEV=2 );
      187     8169        /*E*     ERROR: FTL-E$NOFILE-2
      188     8170                 MESSAGE: File% %TA% specified in DCB% %DC% was not found
      189     8171         ***/
      190     8172
      191     8173        %FT$ERR( ERRNAME=E_NOFPOOL, MID='14'O, CODE=%E$NOFPOOL, SEV=2 );
      192     8181        /*E*     ERROR: FTL-E$NOFPOOL-2
      193     8182                 MESSAGE: No FPOOL buffer% for %TA%
      194     8183                 MESSAGE1: The are no FPOOL buffers for label processing.
      195     8184                 DESCRIPTION: An attempt to find an available FPOOL buffer for
      196     8185                    label processing failed.
      197     8186         ***/
      198     8187        %FT$ERR( ERRNAME=E_POSERR, MID='14'O, CODE=%E$POSERR, SEV=2 );
      199     8195        /*E*     ERROR: FTL-E$POSERR-2
      200     8196                 MESSAGE: Illegal ANS tape label or file structure% on %TA%
      201     8197                 MESSAGE1: Error% on %TA% due to incorrect tape structure or
      202     8198                    bad or non-standard tape labels or file marks that are not
      203     8199                    what they are supposed to be.
      204     8200                 DESCRIPTION: An unexpected label was encountered.
      205     8201         ***/
      206     8202
      207     8203        %FT$ERR( ERRNAME=E_SECTERR, MID='14'O, CODE=%E$SECTERR, SEV=2 );
      208     8211        /*E*     ERROR: FTL-E$SECTERR-2
      209     8212                 MESSAGE: File section missing% for %TA%
      210     8213                 MESSAGE1: A file section which should be present can not
      211     8214                           be found in the volume set as described in the
      212     8215                           serial number list.
      213     8216                 DESCRIPTION: The previous or next file section couldn't
      214     8217                    be found.
      215     8218         ***/
      216     8219
      217     8220        %FT$ERR( ERRNAME=E_TAPBRK, MID='14'O, CODE=%E$TAPBRK, SEV=2 );
      218     8228        /*E*     ERROR: FTL-E$TAPBRK-2
      219     8229                 MESSAGE: Break or ctrl-Y during tape file search% for DCB %DC%
      220     8230                 MESSAGE1: A tape file search (by name or sequence number) was
      221     8231                    interrupted by a break or ctrl-Y.  The search is aborted.
      222     8232         ***/
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:7    
      223     8233
      224     8234        %FT$ERR( ERRNAME=E_VOLORDER, MID='14'O, CODE=%E$VOLORDER, SEV=2 );
      225     8242        /*E*     ERROR: FTL-E$VOLORDER-2
      226     8243                 MESSAGE: Volume missing or out of order% for %TA%
      227     8244                 MESSAGE1: The volume with expected file sequence numbers or file
      228     8245                           section cannot be found in the volume set as described
      229     8246                           in the serial number list.
      230     8247                 DESCRIPTION: Either an attempt to find a file by its sequence number
      231     8248                    failed even though files with higher and lower sequence numbers
      232     8249                    were found, or an attempt to file a file section failed although
      233     8250                    lower and higher file sections were found.
      234     8251         ***/
      235     8252
      236     8253        %FT$ERR( ERRNAME=E_VOLOUT, MID='14'O, CODE=%E$VOLOUT, SEV=2 );
      237     8261        /*E*     ERROR: FTL-E$VOLOUT-2
      238     8262                 MESSAGE: No next volume% on %TA%
      239     8263                 DESCRIPTION: An output CVOL was attempted with no next volume.
      240     8264         ***/
      241     8265
      242     8266        %FT$ERR( ERRNAME=E_WRONGFILE, MID='14'O, CODE=%E$WRONGFILE, SEV=0 );
      243     8274        /*E*     ERROR: FTL-E$WRONGFILE
      244     8275                 MESSAGE: File changed after I/O error% on %TA%.
      245     8276                 MESSAGE1: The earlier I/O error% on %TA% destroyed a file mark;
      246     8277                           data read after the error was from the next file on the
      247     8278                           tape.
      248     8279         ***/
      249     8280
      250     8281        /*********************************************************************/
      251     8282        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:8    
      252     8283        /*********************************************************************/
      253     8284    1   FTL$VOL1: ENTRY ALTRET;
      254     8285        /*F*    NAME: FTL$VOL1
      255     8286                PURPOSE: Construct and write VOL1.
      256     8287         ***/
      257     8288
      258     8289        /********************/
      259     8290
      260     8291    1           CALL FTL_LBLINIT ALTRET(JUSTALT); /* Initialize for label writing     */
      261     8292    1           LBL1$->FT$BLBL = ' ';           /* Initialize to blanks               */
      262     8293    1           LBL1$->FT$VOL1.LABEL_TYPE = 'VOL1';
      263     8294
      264     8295         /***
      265     8296          *** Set owner account and SNs.
      266     8297          ***/
      267     8298
      268     8299    1           LBL1$->FT$VOL1.SN = F$DCB.PSN;  /* Set SN                             */
      269     8300    1           LBL1$->FT$VOL1.ACCOUNT = FT$DDT.ACCT; /* Set owner account            */
      270     8301    1           LBL1$->FT$VOL1.SYSTEM_CODE.ID = 'CP-6';
      271     8302    1           LBL1$->FT$VOL1.SYSTEM_CODE.VERSION = B_SITEINFO.VERSION#;
      272     8303    1           LBL1$->FT$VOL1.SYSTEM = 'CP-6';
      273     8304    2           DO CASE(FT$DDT.VOLACCESS);      /* Determine access control           */
      274     8305    2              CASE(0,%ALL#);
      275     8306    2                 LBL1$->FT$VOL1.ACCESS = ' '; /* Everyone read/write             */
      276     8307    2              CASE(%IN#);
      277     8308    2                 LBL1$->FT$VOL1.ACCESS = 'I'; /* Only owner can write            */
      278     8309    2              CASE(%NONE#);
      279     8310    2                 LBL1$->FT$VOL1.ACCESS = 'N'; /* Only owner can read or write    */
      280     8311    2              CASE(ELSE);
      281     8312    2                 LBL1$->FT$VOL1.ACCESS = ' '; /* Owner strange                   */
      282     8313    2              END;
      283     8314    1           LBL1$->FT$VOL1.VERSION = '3';
      284     8315    1           FT$DDT.FRSTFSN = F$DCB.FSN - 1; /* Set FSN of first file              */
      285     8316    1           FT$DDT.FRSTFSECT = F$DCB.FSECT; /* Set FSECT of first file            */
      286     8317
      287     8318         /***
      288     8319          *** Convert label to EBCDIC (if necessary) and write it.
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:9    
      289     8320          ***/
      290     8321
      291     8322    1           IF F$DCB.IASN ~= %OD# THEN
      292     8323    1              CALL FTI$WRASCEBC (LBL1$) ALTRET (JUSTALT);
      293     8324    1           FT$DDT.POS = FTP_UND#;          /* Not at BOV anymore                 */
      294     8325    1           RETURN;
      295     8326
      296     8327        /*********************************************************************/
      297     8328        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:10   
      298     8329        /*********************************************************************/
      299     8330    1   FTL$LBLS: ENTRY( THELBL, LBL$ ) ALTRET;
      300     8331        /*F*    NAME: FTL$LBLS
      301     8332                PURPOSE: Construct and write HDRs, EOVs, or EOFs.
      302     8333         ***/
      303     8334
      304     8335        /********************/
      305     8336
      306     8337    1           CALL FTL_LBLINIT ALTRET(JUSTALT); /* Initialize for label writing     */
      307     8338    1           FT$DDT.FMCNT = 0;            /* No file marks written since last HDR1 */
      308     8339    1           LBL1$->FT$BLBL = ' ';           /* Initialize to blanks               */
      309     8340    1           LBL1$->FT$LBL1.LABEL_ID = THELBL; /* Insert label type                */
      310     8341    1           LBL1$->FT$LBL1.LABEL_NUM = '1'; /* LBL1                               */
      311     8342
      312     8343         /***
      313     8344          *** Set up rest of LBL1 with data from DCB.
      314     8345          ***/
      315     8346
      316     8347    1           LBL1$->FT$LBL1.GENERATION = '0001'; /* Default CP-6 generation        */
      317     8348    1           LBL1$->FT$LBL1.FVERSION = '00'; /* Default CP-6 version               */
      318     8349    1           IF THELBL = 'HDR'
      319     8350    1           THEN N = 0;                     /* Zero block count in HDR1           */
      320     8351    2           ELSE DO;
      321     8352    2              N = F$DCB.PRECNO;
      322     8353    2              IF NOT F$DCB.AFTRBLK
      323     8354    2              THEN N = N - 1;              /* Don't count unwritten block        */
      324     8355    2              IF F$DCB.FSECT = 1 AND F$DCB.TAPTYP.CP6F
      325     8356    2              THEN N = N + 1;              /* Count FIT as tape block            */
      326     8357    2              END;
      327     8358    1           CALL BINCHAR( LBL1$->FT$LBL1.BLK_CNT, N );
      328     8359                                                /* Set block count                    */
      329     8360    1           LBL1$->FT$LBL1.FILE_ID = F$DCB.NAME.C17.CC; /* Set file name          */
      330     8361    1           CALL FTR$GETSN(1,ADDR(LBL1$->FT$LBL1.FSETID)); /* Set file set id     */
      331     8362                                                /* Set initial serial number          */
      332     8363    1           IF F$DCB.IASN = %OD# THEN
      333     8364    1              CALL BINCHAR( LBL1$->FT$LBL1.ODFSEQU_NUM, F$DCB.FSN );
      334     8365    1           ELSE
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:11   
      335     8366    1              CALL BINCHAR( LBL1$->FT$LBL1.FSEQU_NUM, F$DCB.FSN );
      336     8367                                                /* Set file sequence number           */
      337     8368    1           IF F$DCB.EBCDIC THEN            /* set FSECT to volume number         */
      338     8369    1              CALL BINCHAR( LBL1$->FT$LBL1.FSECT, F$DCB.VOL );
      339     8370    1           ELSE                            /* set FSECT to section number        */
      340     8371    1              CALL BINCHAR( LBL1$->FT$LBL1.FSECT, F$DCB.FSECT );
      341     8372                                                /* Set file section number            */
      342     8373
      343     8374         /***
      344     8375          *** Set creation and expiration dates and system version.
      345     8376          ***/
      346     8377
      347     8378    1           CALL SSS$SYSTIME( J );          /* Get universal time                 */
      348     8379    1           CALL XUD$UTS_DIFF_SEC(TEMP,J,0); /* get UTS interval in seconds       */
      349     8380    1           TEMP = (TEMP/86400) * 86400;    /* round to nearest day               */
      350     8381    1           CALL XUD$UTS_ADJ_25TH(J,0,TEMP*25); /* make J a proper UTS            */
      351     8382    1           CALL UMT$JDATE( LBL1$->FT$LBL1.CREATE_DATE, J );
      352     8383                                                /* Set creation date                  */
      353     8384    1           DT1.JD_R = LBL1$->FT$LBL1.CREATE_DATE; /* julian creation date        */
      354     8385    1           IF DT1.JD.YR >= '00' AND DT1.JD.YR <= '20' /* check for century       */
      355     8386    1           THEN LBL1$->FT$LBL1.CENTURY1 = '0'; /* zero means year 20xx           */
      356     8387    1           ELSE LBL1$->FT$LBL1.CENTURY1 = ' '; /* space means year 19xx          */
      357     8388    1           LBL1$->FT$LBL1.EXPIRE_DATE = FT$DDT.EXPIRE;
      358     8389                                                /* Get expiration date from DDT       */
      359     8390    1           DT1.JD_R = FT$DDT.EXPIRE;       /* julian expiration date             */
      360     8391    1           IF DT1.JD.YR >= '00' AND DT1.JD.YR <= '20' /* check for century       */
      361     8392    1           THEN LBL1$->FT$LBL1.CENTURY2 = '0'; /* zero means year 20xx           */
      362     8393    1           ELSE LBL1$->FT$LBL1.CENTURY2= ' '; /* space means year 19xx           */
      363     8394    1           LBL1$->FT$LBL1.SYSTEM.ID = 'CP-6';
      364     8395    1           LBL1$->FT$LBL1.SYSTEM.VERSION = B_SITEINFO.VERSION#;
      365     8396
      366     8397         /***
      367     8398          *** Write out LBL1.
      368     8399          ***/
      369     8400
      370     8401    1           IF F$DCB.IASN ~= %OD# THEN
      371     8402    1              CALL FTI$WRASCEBC (LBL1$) ALTRET (JUSTALT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:12   
      372     8403
      373     8404         /***
      374     8405          *** Initialize label buffer for LBL2.
      375     8406          ***/
      376     8407
      377     8408    1           LBL2$->FT$BLBL = ' ';           /* Blank it out                       */
      378     8409    1           LBL2$->FT$LBL2.LABEL_ID = THELBL;
      379     8410    1           LBL2$->FT$LBL2.LABEL_NUM = '2'; /* LBL2                               */
      380     8411
      381     8412         /***
      382     8413          *** Set label fields from DCB.  Save file name.
      383     8414          ***/
      384     8415
      385     8416    1           IF F$DCB.TAPTYP.CP6F OR F$DCB.ORG = %RESTRICT#
      386     8417    1           THEN LBL2$->FT$LBL2.CP6.FILE_ID = F$DCB.NAME.C;
      387     8418                                                /* Set whole file name                */
      388     8419    1           IF F$DCB.EBCDIC
      389     8420    1           THEN CALL BINCHAR( LBL2$->FT$LBL2.OTHEROS.DENSITY, F$DCB.DENSITY );
      390     8421                                                /* Set density                        */
      391     8422    1           N = F$DCB.BLKL;
      392     8423    1           IF NOT F$DCB.TAPTYP.RWASC
      393     8424    1           THEN N = (N * 9 + 7) / 8;       /* Account for binary write           */
      394     8425    1           CALL BINCHAR( LBL2$->FT$LBL2.BLKL, N ); /* Set BLKL                   */
      395     8426    1           N = F$DCB.RECL;
      396     8427    1           IF NOT F$DCB.TAPTYP.RWASC
      397     8428    1           THEN N = (N * 9 + 7) / 8;
      398     8429    1           CALL BINCHAR( LBL2$->FT$LBL2.RECL, N ); /* Set RECL                   */
      399     8430    1           IF F$DCB.EBCDIC AND F$DCB.ORG = %VARIABLE#
      400     8431    1           THEN LBL2$->FT$LBL2.BUF_OFFSET = '  '; /* Funky, these IBM guys       */
      401     8432    1           ELSE CALL BINCHAR( LBL2$->FT$LBL2.BUF_OFFSET, F$DCB.BOL );
      402     8433                                                /* Set block header size              */
      403     8434
      404     8435         /***
      405     8436          *** Set format specified fields of HDR2.
      406     8437          ***/
      407     8438
      408     8439    2           DO CASE( F$DCB.ORG );
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:13   
      409     8440    2              CASE(%CONSEC#,%KEYED#,%RELATIVE#,%IDS#,%INDEXED#,%UR#,
      410     8441    2               %RESTRICT#,%RANDOM#,%SYMB#,%IREL#);
      411     8442    2                 LBL2$->FT$LBL2.FORMAT = 'U';
      412     8443    2                 IF F$DCB.BLOCKED
      413     8444    2                 THEN IF F$DCB.SPANNED
      414     8445    2                    THEN LBL2$->FT$LBL2.CP6.BLOCK_ATTR = 'R';
      415     8446    2                    ELSE LBL2$->FT$LBL2.CP6.BLOCK_ATTR = 'B';
      416     8447    2                 ELSE IF F$DCB.SPANNED
      417     8448    2                    THEN LBL2$->FT$LBL2.CP6.BLOCK_ATTR = 'S';
      418     8449    2                    ELSE ;
      419     8450    3                 DO CASE(F$DCB.ORG);       /* Sub-categorize CP-6 format         */
      420     8451    3                    CASE(%CONSEC#);
      421     8452    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'C';
      422     8453    3                    CASE(%KEYED#);
      423     8454    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'K';
      424     8455    3                    CASE(%RELATIVE#);
      425     8456    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'F';
      426     8457    3                    CASE(%IDS#);
      427     8458    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'D';
      428     8459    3                    CASE(%INDEXED#);
      429     8460    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'I';
      430     8461    3                    CASE(%IREL#);
      431     8462    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'i';
      432     8463    3                    CASE(%UR#);
      433     8464    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'U';
      434     8465    3                    CASE(%SYMB#);
      435     8466    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'S';
      436     8467    3                    CASE(%RESTRICT#);
      437     8468    3                       IF ADDR(LBL$) = ADDR(NIL)
      438     8469    3                       THEN LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'x';
      439     8470    3                       ELSE LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'X';
      440     8471    3                    CASE(%RANDOM#);
      441     8472    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'R';
      442     8473    3                    END;
      443     8474    2              CASE(%FIXED#);
      444     8475    2                 LBL2$->FT$LBL2.FORMAT = 'F';
      445     8476    2                 IF F$DCB.EBCDIC
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:14   
      446     8477    2                 THEN IF F$DCB.BLOCKED
      447     8478    2                    THEN LBL2$->FT$LBL2.CP6.BLOCK_ATTR = 'B';
      448     8479    2              CASE(%VARIABLE#);
      449     8480    2                 IF F$DCB.EBCDIC
      450     8481    3                 THEN DO;                  /* One of the EBCDIC formats          */
      451     8482    3                    LBL2$->FT$LBL2.FORMAT = 'V'; /* EBCDIC V format              */
      452     8483    3                    IF F$DCB.BLOCKED
      453     8484    3                    THEN IF F$DCB.SPANNED
      454     8485    3                       THEN LBL2$->FT$LBL2.OTHEROS.BLOCK_ATTR = 'R'; /* B,S      */
      455     8486    3                       ELSE LBL2$->FT$LBL2.OTHEROS.BLOCK_ATTR = 'B'; /* B        */
      456     8487    3                    ELSE IF F$DCB.SPANNED
      457     8488    3                       THEN LBL2$->FT$LBL2.OTHEROS.BLOCK_ATTR = 'S'; /* S        */
      458     8489    3                       ELSE ;              /* Left blank                         */
      459     8490    3                    END;
      460     8491    3                 ELSE DO;                  /* ANS format                         */
      461     8492    3                    IF F$DCB.SPANNED
      462     8493    3                    THEN LBL2$->FT$LBL2.FORMAT = 'S'; /* Spanned (blocked)       */
      463     8494    3                    ELSE LBL2$->FT$LBL2.FORMAT = 'D'; /* Just blocked            */
      464     8495    3                    END;
      465     8496    2              CASE(ELSE);
      466     8497    2                 LBL2$->FT$LBL2.FORMAT = 'U';
      467     8498    2              END;
      468     8499
      469     8500         /***
      470     8501          *** Write out LBL2.
      471     8502          ***/
      472     8503
      473     8504    1           IF F$DCB.IASN = %OD# THEN
      474     8505    1              CALL FPO$WRITELBL (LBL1$, LBL2$) ALTRET (JUSTALT);
      475     8506    1           ELSE
      476     8507    1              CALL FTI$WRASCEBC (LBL2$) ALTRET (JUSTALT);
      477     8508    1           RETURN;
      478     8509
      479     8510
      480     8511        /*********************************************************************/
      481     8512        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:15   
      482     8513        /*********************************************************************/
      483     8514    1   FTL$ULBLS: ENTRY(THELBL,LBL$,NUM) ALTRET;
      484     8515        /*F*    NAME: FTL$ULBLS
      485     8516                PURPOSE: Write user labels to tape.
      486     8517                DESCRIPTION: THELBL - type of label to write
      487     8518                    NUM - number of bytes in VLP_ULBL
      488     8519                    LBL$ - pointer to label group buffer
      489     8520                OUTPUT: NUM - number of labels written
      490     8521         ***/
      491     8522
      492     8523        /********************/
      493     8524
      494     8525         /***
      495     8526          *** If no labels, just return.
      496     8527          ***/
      497     8528
      498     8529    1           IF NUM = 0 OR LBL$ = ADDR(NIL) THEN RETURN;
      499     8530    1           LBL1$ = LBL$;
      500     8531    1           N = (NUM - LENGTHC(VLP_ULBL.NUM#)) / LENGTHC(VLP_ULBL.ULBL#(0));
      501     8532    1           IF N <= 0
      502     8533    2           THEN DO;                        /* No full labels can be read         */
      503     8534    2              VLP_ULBL.NUM# = 0;
      504     8535    2              RETURN;
      505     8536    2              END;
      506     8537
      507     8538    1           IF N > VLP_ULBL.NUM# THEN N = VLP_ULBL.NUM#;
              8538                    /* Write less than entire buffer */
      508     8539         /***
      509     8540          *** Write labels while buffer not exhausted and labels
      510     8541          *** are of the correct type.
      511     8542          ***/
      512     8543
      513     8544    1           I = 0;                          /* Label index                        */
      514     8545    2           DO WHILE( I < N );
      515     8546    2              IF VLP_ULBL.ULBLFIELD.LABELID(I) = THELBL
      516     8547    3              THEN DO;                     /* Label is correct type              */
      517     8548    3                 CALL FTI$WRASCEBC(ADDR(VLP_ULBL.ULBL#(I))) ALTRET(JUSTALT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:16   
      518     8549    3                 I = I + 1;                /* Increment label count              */
      519     8550    3                 END;
      520     8551    2              ELSE N = I;                  /* Terminate label writing            */
      521     8552    2              END;
      522     8553    1           NUM = N;                        /* Return # labels written            */
      523     8554    1           IF N ~= VLP_ULBL.NUM# THEN VLP_ULBL.NUM# = N; /* Rtrn actual # written */
      524     8555    1           RETURN;
      525     8556
      526     8557        /*********************************************************************/
      527     8558        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:17   
      528     8559        /*********************************************************************/
      529     8560    1   FTL$GETULBLS: ENTRY(THELBL,LBL$,NUM) ALTRET;
      530     8561        /*F*     NAME:FTL$GETULBLS
      531     8562                 PURPOSE: Read user labels until file mark hit.
      532     8563                 INPUT: LBL$ - Pointer to user label buffer
      533     8564                    NUM - number of bytes in VLP_ULBL
      534     8565                    THELBL - (dummy)
      535     8566                 DESCRIPTION: Reads labels until user buffer is full or
      536     8567                    file mark has been hit.
      537     8568         ***/
      538     8569
      539     8570        /********************/
      540     8571
      541     8572         /***
      542     8573          *** If no user buffer, number of labels is 0.
      543     8574          ***/
      544     8575
      545     8576    1           IF LBL$ = ADDR(NIL)
      546     8577    1           THEN NUM = 0;
      547     8578    1           ELSE LBL1$ = LBL$;
      548     8579    1           JDCB$ = B$JIT.DCB$;
      549     8580
      550     8581         /***
      551     8582          *** Read labels while buffer not exhausted and labels exist.
      552     8583          ***/
      553     8584
      554     8585    1           I = 0;                          /* Count labels read                  */
      555     8586    1           IF NUM ~= 0
      556     8587    2           THEN DO;
      557     8588    2              NUM = (NUM - LENGTHC(VLP_ULBL.NUM#)) / LENGTHC(VLP_ULBL.ULBL#(0));
      558     8589    3              DO WHILE( I < NUM AND NOT F$DCB.TYC.EOF(1) );
      559     8590    3                 CALL FTI$RDASCEBC(ADDR(VLP_ULBL.ULBL#(I))) ALTRET(JUSTALT);
      560     8591    3                 IF NOT F$DCB.TYC.EOF(1)
      561     8592    4                 THEN DO;                  /* A label was read                   */
      562     8593    4                    IF VLP_ULBL.ULBLFIELD.LABELID(I) = 'UVL'
      563     8594    4                        OR VLP_ULBL.ULBLFIELD.LABELID(I) = 'UHL'
      564     8595    4                        OR VLP_ULBL.ULBLFIELD.LABELID(I) = 'UTL'
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:18   
      565     8596    5                    THEN DO;               /* User label                         */
      566     8597    5                       IF F$DCB.ARS < 80
      567     8598    6                       THEN DO;            /* Blank fill label                   */
      568     8599    6                          N = 80 - F$DCB.ARS; /* Calc # fill bytes               */
      569     8600    6                          LBL2$ = PINCRC( ADDR(VLP_ULBL.ULBL#(I)), F$DCB.ARS );
      570     8601    6                          LBL2$->NCHARS = ' '; /* Blank fill missing area        */
      571     8602    6                          END;
      572     8603    5                       I = I + 1;          /* Count user label                   */
      573     8604    5                       END;
      574     8605    4                    END;
      575     8606    3                 ELSE NUM = I;             /* Done reading labels                */
      576     8607    3                 END;
      577     8608    2              VLP_ULBL.NUM# = I;
      578     8609    2              END;
      579     8610    1           NUM = I;                        /* Return # labels read               */
      580     8611
      581     8612         /***
      582     8613          *** If label reading terminated because user buffer was exhausted,
      583     8614          *** position after the file mark.  Translate labels if necessary.
      584     8615          ***/
      585     8616
      586     8617    1           IF NOT F$DCB.TYC.EOF(1)
      587     8618    2           THEN DO;           /* User buffer exhausted...position past file mark */
      588     8619    2              F$DCB.ARS = 1;
      589     8620    2              CALL FTI$SPFILE ALTRET(JUSTALT);
      590     8621    2              F$DCB.TYC.EOF(1) = %YES#;    /* Indicate file mark passed          */
      591     8622    2              END;
      592     8623    1           RETURN;
      593     8624
      594     8625        /*********************************************************************/
      595     8626        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:19   
      596     8627        /*********************************************************************/
      597     8628    1   FTL$CLOSE: ENTRY(THELBL,LBL$,NUM,ULBL$,UNUM) ALTRET;
      598     8629        /*F*     NAME: FTL$CLOSE
      599     8630                 PURPOSE: Process labels on labelled tape close.
      600     8631                 INPUT: NUM - number of parameter segment describing user trailing
      601     8632                          label buffer
      602     8633                    LBL$ - points to user label group
      603     8634                 OUTPUT: THELBL - type of label encountered last
      604     8635                 DESCRIPTION: If no EOF labels have yet been written (DCB.NOEOF)
      605     8636                    the current buffer is trunced, a file mark written and then
      606     8637                    EOF labels written.  If the file has EOF labels written,
      607     8638                    the end of the file is positioned to and block count checked.
      608     8639                    If the file has been modified, it is assumed that the trailing
      609     8640                    label buffer contains UTL labels to write after the EOF
      610     8641                    labels.  If not modified, any UTL labels present on the
      611     8642                    tape are read into the label buffer.  Two file marks are
      612     8643                    written for modified files.  Position is left following the
      613     8644                    file mark following the EOF/UTL label group.
      614     8645         ***/
      615     8646
      616     8647        /********************/
      617     8648
      618     8649         /***
      619     8650          *** If we already have an blocking FPOOL buffer, we can use it for label
      620     8651          *** processing after the trunc.
      621     8652          ***/
      622     8653
      623     8654    1           JDCB$ = B$JIT.DCB$;
      624     8655    1           IF F$DCB.CBUFNUM > 0 AND F$DCB.LPOOL = 0
      625     8656    1           THEN F$DCB.LPOOL = F$DCB.CBUFNUM + 1; /* Set for LBLINIT              */
      626     8657
      627     8658         /***
      628     8659          *** If EOF labels are necessary, write them.
      629     8660          *** If file has not been modified, process EOF
      630     8661          *** label (check block count).
      631     8662          ***/
      632     8663
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:20   
      633     8664    1           CALL FTL_LBLINIT ALTRET(JUSTALT);
      634     8665    1           IF (F$DCB.NOEOF) OR             /* EOF labels are necessary  or       */
      635     8666    2               (UNUM ~= 0) THEN DO;        /* EOF labels are requested           */
      636     8667    3              IF NOT F$DCB.TAPTYP.USRBUF THEN DO;
      637     8668                               /* Trunc FPOOL buffer but hold it for label processing */
      638     8669    3                 IF F$DCB.IASN = %OD# THEN
      639     8670    3                    CALL FTW$TRNCOD ALTRET(JUSTALT);
      640     8671    3                 ELSE
      641     8672    3                    CALL FTW$TRNCHLD ALTRET(JUSTALT);
      642     8673    3                 F$DCB.CBUFNUM = 0;        /* No blocking FPOOL buffer           */
      643     8674    3                 END;
      644     8675    2              IF F$DCB.IASN ~= %OD# THEN
      645     8676    2                 CALL FTI$WRFM ALTRET(JUSTALT); /* Write file mark               */
      646     8677    2              IF F$DCB.ORG = %RESTRICT# AND NOT F$DCB.TAPTYP.CP6F THEN
      647     8678    2                 CALL FTL$LBLS( THELBL ) ALTRET(JUSTALT); /* FITless RESTRICT    */
      648     8679    2              ELSE
      649     8680    2                 CALL FTL$LBLS( THELBL, ADDR(NIL) ) ALTRET(JUSTALT);
      650     8681    2              END;
      651     8682    2           ELSE DO;                        /* Process EOF label                  */
      652     8683    2              IF F$DCB.IASN = %OD# AND F$DCB.FUN = %IN# THEN /* If optical disk, */
      653     8684    2                 CALL FPO$CLOSEIN ALTRET(JUSTALT); /* tell controller about close. */
      654     8685    3              IF F$DCB.ASN = %DEVICE# OR F$DCB.IASN = %OD# THEN DO;
      655     8686                                                /* No labels, etc. needed for device  */
      656     8687    3                 THELBL = 'EOF';           /* and optical disk closes.           */
      657     8688    3                 RETURN;
      658     8689    3                 END;
      659     8690    3              IF FT$DDT.POS ~= FTP_CHK# THEN DO; /* Not already at EOF label     */
      660     8691    4                 IF F$DCB.FUN = %IN# AND LBL$ = ADDR(NIL) THEN DO;
      661     8692    4                    FT$DDT.NOTEOF = '1'B;  /* Remember we're not at EOF.         */
      662     8693    4                    RETURN;
      663     8694    4                    END;
      664     8695    4                 DO WHILE(FT$DDT.POS = FTP_BOD#); /* Space to EOF/EOV label.     */
      665     8696    4                    F$DCB.ARS = 65500;
      666     8697    4                    CALL FTI$SPREC ALTRET(JUSTALT);
      667     8698    4                    F$DCB.PRECNO = F$DCB.PRECNO + F$DCB.ARS; /* Count blocks skipped */
      668     8699    4                    IF F$DCB.TYC.EOF(1) THEN
      669     8700    4                       FT$DDT.POS = FTP_UND#;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:21   
      670     8701    4                    END;
      671     8702    3                 CALL FTL_CHKEOX ALTRET(JUSTALT); /* Check EOF/EOV label         */
      672     8703    3                 END;
      673     8704    3              ELSE DO;                     /* Already have EOF label             */
      674     8705    4                 IF F$DCB.TRNC ~= FT_NOTRUNC# THEN DO; /* Lost our EOF1 label... */
      675     8706    4                    F$DCB.ARS = -1;        /*         ...get it back.            */
      676     8707    4                    CALL FTI$SPREC ALTRET(JUSTALT);
      677     8708    4                    CALL FTL_CHKEOX ALTRET(JUSTALT);
      678     8709    4                    END;
      679     8710    3                 CALL FTL_CHKBLKCNT;
      680     8711    3                 THELBL = 'EOF';
      681     8712    3                 F$DCB.TYC(1) = '0'B;      /* Clear from last read               */
      682     8713    3                 END;
      683     8714    3              DO WHILE ( THELBL ~= 'EOF' ); /* Find last file section            */
      684     8715    3                 CALL FTL_PBNFS ALTRET(JUSTALT);
              8715                          /* Position to beginning of next sect */
      685     8716    3                 F$DCB.ARS = 1;            /* Skip to next EOx labels            */
      686     8717    3                 CALL FTI$SPFILE ALTRET(JUSTALT);
      687     8718    3                 CALL FTL_CHKEOX ALTRET(JUSTALT);
      688     8719    3                 B$JIT.ERR = '0'B;      /* Different section--ignore block count */
      689     8720    3                 END;
      690     8721    2              END;
      691     8722         /***
      692     8723          *** If file has been modified, write trailing labels if specified. If
      693     8724          *** not, get any trailing labels.
      694     8725          ***/
      695     8726
      696     8727    1           N = 0;                          /* Assume no UTLs                     */
      697     8728    1           IF NUM > 0
      698     8729    1           THEN CALL HFF$DSIZ(NUM,N) ALTRET(NOUTL); /* Get # bytes in label area */
      699     8730    1   NOUTL:  ;
      700     8731    2           IF F$DCB.IASN ~= %OD# THEN DO;
      701     8732    3              IF F$DCB.FMOD THEN DO;
      702     8733                                               /* Write user trailing labels (if any) */
      703     8734    4                 IF F$DCB.NOEOF THEN DO;
      704     8735    4                    CALL FTL$ULBLS('UTL',LBL$,N) ALTRET(JUSTALT);
      705     8736    4                    CALL FTI$WRFM ALTRET(JUSTALT); /* Write end of tape marks    */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:22   
      706     8737    4                    FT$DDT.FMNEEDED = %YES#; /* File mark is needed              */
      707     8738    4                    END;
      708     8739    4                 ELSE DO;                  /* No user labels to get              */
      709     8740    4                    F$DCB.ARS = 1;         /* Position to next HDR group         */
      710     8741    4                    CALL FTI$SPFILE ALTRET(JUSTALT);
      711     8742    4                    N = 0;
      712     8743    4                    END;
      713     8744    3                 END;
      714     8745    2              ELSE
      715     8746    2                 CALL FTL$GETULBLS( THELBL, LBL$, N ) ALTRET(JUSTALT);
      716     8747    2              END;
      717     8748                                                /* Get user trailing labels (if any)  */
      718     8749    1           NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_HDR#;
      719     8750    1           F$DCB.NOEOF = %NO#;             /* EOF labels written                 */
      720     8751    1           RETURN;
      721     8752
      722     8753        /*********************************************************************/
      723     8754        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:23   
      724     8755        /*********************************************************************/
      725     8756    1   FTL$CVOL: ENTRY(THELBL,LBL$,NUM,ULBL$,UNUM) ALTRET;
      726     8757        /*F*     NAME: FTL$CVOL
      727     8758                 PURPOSE: Process end of file (section).
      728     8759                 INPUT: LBL$ - pointer to UTL VLP_ULBL
      729     8760                    NUM - number of parameter segment of UTL VLP_ULBL
      730     8761                    ULBL$ - pointer to UHL VLP_ULBL (optional)
      731     8762                    UNUM - number of parameter segment of UHL VLP_ULBL (optional)
      732     8763                       On input files, position must be just before data
      733     8764                       section ending file mark.  On output files, position
      734     8765                       must be after last data block of section.
      735     8766                 OUTPUT: THELBL - type of label encountered last
      736     8767                 DESCRIPTION: If no labels have yet been written (DCB>NOEOF)
      737     8768                    a file mark is written followed by EOV labels.  If the
      738     8769                    file has labels, they are read; if an EOF label group, an
      739     8770                    end of file is altreturned and position left before the file
      740     8771                    mark preceeding the EOF label group.  Position is now after
      741     8772                    the EOV labels.  If the file has been modified, it is
      742     8773                    assumed that the label buffer contains labels
      743     8774                    to be written following the EOV labels.  If not modified,
      744     8775                    any UTL labels following the EOV label are read into the
      745     8776                    trailing label buffer.  Position is left following the
      746     8777                    file mark following the EOV/UTL label group.  If the
      747     8778                    file has not been modified, the next section of the file
      748     8779                    is found on the next volume.  If modified, the next volume
      749     8780                    is initialized with VOL1/HDR1/HDR2/UHL/ * and left ready for
      750     8781                    succeeding writes.
      751     8782         ***/
      752     8783
      753     8784        /********************/
      754     8785
      755     8786         /***
      756     8787          *** Before starting output CVOL, make sure that
      757     8788          *** there are enough volumes to complete it.
      758     8789          ***/
      759     8790
      760     8791    1           JDCB$ = B$JIT.DCB$;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:24   
      761     8792    1           IF F$DCB.NOEOF                  /* Is this an output CVOL?            */
      762     8793    1           THEN IF F$DCB.MAXVOL <= 0    /* Yes. Must volumes be taken from list? */
      763     8794    1              THEN CALL FTR$GETSN( F$DCB.VOL+1, ADDR(SN) ) ALTRET( VOLOUT );
      764     8795                                /* Yes. Make sure volume there before attempting CVOL */
      765     8796
      766     8797         /***
      767     8798          *** If EOV labels are necessary, write them.
      768     8799          *** If file has not been modified, process EOF or EOV
      769     8800          *** label (check block count).
      770     8801          ***/
      771     8802
      772     8803    1           CALL FTL_LBLINIT ALTRET(JUSTALT);
      773     8804    1           IF F$DCB.NOEOF
      774     8805    2           THEN DO;         /* Output CVOL. End of volume labels/marks necessary */
      775     8806    2              IF F$DCB.IASN ~= %OD# THEN
      776     8807    2                 CALL FTI$WRFM ALTRET (RELLBLPOOL); /* Write file mark           */
      777     8808    2              IF F$DCB.ASN = %TAPE# OR F$DCB.IASN = %OD#
      778     8809    2              THEN CALL FTL$LBLS( 'EOV' ) ALTRET( RELLBLPOOL );
      779     8810    3              ELSE DO;                     /* Managed device tape                */
      780     8811    3                 CALL FTI$WRFM ALTRET(JUSTALT); /* Second file mark              */
      781     8812    3                 F$DCB.ARS = -2;
      782     8813    3                 CALL FTI$SPFILE ALTRET(JUSTALT); /* Position to file end        */
      783     8814    3                 END;
      784     8815    2              END;
      785     8816    2           ELSE DO;                        /* Input CVOL. Get EOV (or EOF) label */
      786     8817    2              IF NOT F$DCB.TYC.EOF(1) AND F$DCB.IASN ~= %OD#
      787     8818    3              THEN DO;                     /* Not yet after file mark            */
      788     8819    3                 F$DCB.ARS = 1;
      789     8820    3                 CALL FTI$SPFILE ALTRET(RELLBLPOOL);
      790     8821    3                 END;
      791     8822    2              IF F$DCB.ASN ~= %TAPE#
      792     8823    3              THEN DO;
      793     8824    3                 IF F$DCB.IASN = %OD#
      794     8825    4                 THEN DO;                  /* Optical Disc                       */
      795     8826    4                    CALL FPO$RDEOFLBL (LBL1$) ALTRET (RELLBLPOOL);
      796     8827    4                    THELBL = LBL1$->FT$ULBL.LABEL_ID;
      797     8828    4                    CALL FTL_CHKBLKCNT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:25   
      798     8829    4                    IF B$JIT.ERR
      799     8830    4                    THEN ALTRETURN;
      800     8831    4                    IF THELBL = 'EOF'
      801     8832    5                    THEN DO;
      802     8833    5                       B$JIT.ERR = E_EOF;
      803     8834    5                       ALTRETURN;
      804     8835    5                       END;
      805     8836    4                    END;
      806     8837    4                 ELSE DO;                  /* Managed device tape                */
      807     8838    4                    F$DCB.ARS = -1;        /* Position to EOF                    */
      808     8839    4                    CALL FTI$SPFILE ALTRET (JUSTALT);
      809     8840    4                    B$JIT.ERR = E_EOF; /*E* ERROR: FTL-E$EOF */
      810     8841    4                    ALTRETURN;
      811     8842    4                    END;
      812     8843    3                 END;
      813     8844    3              ELSE DO;                     /* Labelled tape                      */
      814     8845    3                 CALL FTL_CHKEOX ALTRET(RELLBLPOOL);
              8845                          /* Check if EOF/EOV label follows */
      815     8846    3                 IF B$JIT.ERR
      816     8847    4                 THEN DO;                  /* Block count error                  */
      817     8848    4                    F$DCB.ARS = -1;        /* Position before file mark          */
      818     8849    4                    CALL FTI$SPFILE ALTRET(RELLBLPOOL);
      819     8850    4                    ALTRETURN;
      820     8851    4                    END;
      821     8852    3                 IF THELBL = 'EOF'
      822     8853    4                 THEN DO;                  /* End of file                        */
      823     8854    4                    F$DCB.ARS = -1;        /* Position before file mark          */
      824     8855    4                    CALL FTI$SPFILE ALTRET(RELLBLPOOL);
      825     8856    4                    B$JIT.ERR = E_EOF; /*E* ERROR: FTL-E$EOF */
      826     8857    4                    ALTRETURN;
      827     8858    4                    END;
      828     8859    3                 END;
      829     8860    2              END;
      830     8861
      831     8862         /***
      832     8863          *** Get or write user trailing labels.
      833     8864          ***/
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:26   
      834     8865
      835     8866    1           N = 0;
      836     8867    1           IF NUM > 0
      837     8868    1           THEN CALL HFF$DSIZ(NUM,N) ALTRET(NOCUTL); /* # bytes in UTL group     */
      838     8869    1           IF F$DCB.ASN = %TAPE#
      839     8870    2           THEN DO;
      840     8871    2   NOCUTL:    ;
      841     8872    2              IF F$DCB.FMOD
      842     8873    3              THEN DO;                    /* Write user trailing labels (if any) */
      843     8874    3                 IF F$DCB.NOEOF
      844     8875    4                 THEN DO;
      845     8876    4                    CALL FTL$ULBLS('UTL',LBL$,N) ALTRET(RELLBLPOOL);
      846     8877    4                    CALL FTI$WRFM ALTRET(RELLBLPOOL); /* Write end of tape marks */
      847     8878    4                    CALL FTI$WRFM ALTRET(RELLBLPOOL);
      848     8879    4                    F$DCB.ARS = -1;        /* Position before last file mark     */
      849     8880    4                    CALL FTI$SPFILE ALTRET(RELLBLPOOL);
      850     8881    4                    END;
      851     8882    4                 ELSE DO;                  /* No user labels                     */
      852     8883    4                    F$DCB.ARS = 1;
      853     8884    4                    CALL FTI$SPFILE ALTRET(RELLBLPOOL);
      854     8885    4                    N = 0;
      855     8886    4                    END;
      856     8887    3                 END;
      857     8888    2              ELSE CALL FTL$GETULBLS( THELBL, LBL$, N ) ALTRET(RELLBLPOOL);
      858     8889                                                /* Get user trailing labels (if any)  */
      859     8890    2              END;
      860     8891    2           ELSE DO;                        /* Zero returned label count          */
      861     8892    2              IF N > 3
      862     8893    2              THEN LBL$->ONE_WORD = 0;
      863     8894    2              END;
      864     8895    1           NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_EOV#;
      865     8896
      866     8897         /***
      867     8898          *** File section done.
      868     8899          ***/
      869     8900
      870     8901    1           N = 0;                          /* Assume no UHLs                     */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:27   
      871     8902    1           IF ADDR(ULBL$) ~= ADDR(NIL)
      872     8903    1           THEN IF UNUM > 0
      873     8904    2              THEN DO;
      874     8905    2                 CALL HFF$DSIZ(UNUM,N) ALTRET(NOCUHL); /* # bytes in UHL group   */
      875     8906    2   NOCUHL:       ;
      876     8907    2                 IF F$DCB.ASN ~= %TAPE#
      877     8908    2                 THEN IF N > 3
      878     8909    2                    THEN ULBL$->ONE_WORD = 0; /* Zero returned label count       */
      879     8910    2                 END;
      880     8911    1           IF F$DCB.NOEOF
      881     8912    2           THEN DO;                        /* Write                              */
      882     8913    2              F$DCB.SEZ_OK = %YES#;        /* Scratch ok                         */
      883     8914    2              CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(RELLBLPOOL);
      884     8915    2              DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
      885     8916    2              IF F$DCB.ASN = %TAPE#
      886     8917    3              THEN DO;                     /* Labelled tape                      */
      887     8918    3                 F$DCB.FSECT = F$DCB.FSECT + 1; /* Next section                  */
      888     8919    3                 CALL FTL$VOL1 ALTRET(RELLBLPOOL); /* Write VOL1                 */
      889     8920    3                 CALL FTL$LBLS('HDR') ALTRET(RELLBLPOOL); /* Write HDR1, HDR2    */
      890     8921    3                 CALL FTL$ULBLS('UHL',ULBL$,N) ALTRET(RELLBLPOOL);
      891     8922                                                /* Write UHLs (if any)                */
      892     8923    3                 CALL FTI$WRFM ALTRET(RELLBLPOOL);
      893     8924    3                 END;
      894     8925    2              ELSE
      895     8926    2                 IF F$DCB.IASN = %OD#
      896     8927    3                 THEN DO;
      897     8928    3                    F$DCB.FSECT = F$DCB.FSECT + 1; /* Next section               */
      898     8929    3                    CALL FTL$LBLS ('HDR') ALTRET (RELLBLPOOL);
      899     8930    3                    FT$DDT.SCRTCH = %NO#;
      900     8931    3                    END;
      901     8932    2              F$DCB.AFTRBLK = %NO#;        /* Ready to fill next block           */
      902     8933    2              F$DCB.PRECNO = 1;            /* First block of next section        */
      903     8934    2              DDDT$->FT$DDT.POS = FTP_BOD#;
      904     8935    2              END;
      905     8936    2           ELSE DO;                /* Reading (managed free tape won't get here) */
      906     8937    2              CALL FTL_PBNFS(ULBL$,N) ALTRET(RELLBLPOOL);
      907     8938                                             /* Position to beginning of next section */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:28   
      908     8939    2              END;
      909     8940    1           F$DCB.MUST_CVOL = %NO#;
      910     8941    1           IF F$DCB.LPOOL > 0
      911     8942    2           THEN DO;                        /* Have label FPOOL                   */
      912     8943    2              CALL FMD$RELBUF( F$DCB.LPOOL-1 );
      913     8944    2              F$DCB.LPOOL = 0;
      914     8945    2              END;
      915     8946    1           RETURN;
      916     8947    1   VOLOUT: ;
      917     8948    1           B$JIT.ERR = E_VOLOUT; /*E* ERROR: FTL-E$VOLOUT */
      918     8949    1           ALTRETURN;
      919     8950
      920     8951    1   RELLBLPOOL: ;
      921     8952    1           IF F$DCB.LPOOL > 0
      922     8953    2           THEN DO;                        /* Have label FPOOL                   */
      923     8954    2              CALL FMD$RELBUF( F$DCB.LPOOL-1 );
      924     8955    2              F$DCB.LPOOL = 0;
      925     8956    2              END;
      926     8957    1           ALTRETURN;
      927     8958
      928     8959        /*********************************************************************/
      929     8960        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:29   
      930     8961        /*********************************************************************/
      931     8962    1   FTL$FINDFILE: ENTRY ALTRET;
      932     8963        /*F*     NAME: FTL$FINDFILE
      933     8964                 PURPOSE: Find file by name specified by DCB.NAME and DCB.FSECT.
      934     8965                 DESCRIPTION: File name is specified by DCB.NAME.  Section number
      935     8966                    is specified by DCB.FSECT.  If DCB.FSECT is 0 then any file
      936     8967                    section of specified file will do.  The entire volume set is
      937     8968                    searched for a file with specified name.  If such file is not
      938     8969                    found, position is left before the HDR1 of the first section
      939     8970                    of the file on which the search started.  Any scratch volumes
      940     8971                    encountered are assumed to indicate the end of the volume set.
      941     8972                    The search then resumes with the first file on the first volume.
      942     8973                    If no such file is found, FTL$FINDFILE altreturns with
      943     8974                    a E$NOFILE error.  If the wrong file section is found,
      944     8975                    FTL$FINDSEQ is called after DCB.FSN is set with the
      945     8976                    sequence number of the file.  Other possible errors altreturned
      946     8977                    are standard I/O and position lost or volume missing errors.
      947     8978                    The HDR2 may be returned following the HDR1.
      948     8979         ***/
      949     8980
      950     8981        /********************/
      951     8982
      952     8983         /***
      953     8984          *** Initialize for label reading and tape searching.
      954     8985          ***/
      955     8986
      956     8987    1           CALL FTL_LBLINIT ALTRET(JUSTALT);
      957     8988    1           SAVFSN = 0;
      958     8989
      959     8990         /***
      960     8991          *** Look for that file...at this point we are always positioned
      961     8992          *** before a HDR1 or before a VOL1.
      962     8993          ***/
      963     8994
      964     8995    1   DO_FOREVER: ;
      965     8996    2           DO WHILE('1'B);
      966     8997    2              CALL FTL_GETNXTHDR ALTRET(JUSTALT); /* Get HDR1                    */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:30   
      967     8998
      968     8999         /***
      969     9000            *** We should have just read the HDR1 label of the next file or
      970     9001            *** a file mark indicating end of volume.
      971     9002            ***/
      972     9003
      973     9004    3              IF NOT F$DCB.TYC(1) THEN DO; /* No errors on last read             */
      974     9005    3                 CALL FTL_CHKLBL('HDR1',LBL1$) ALTRET(JUSTALT); /* Check if HDR1 */
      975     9006
      976     9007         /***
      977     9008               *** We have a HDR1 label...save info and check file name.
      978     9009               ***/
      979     9010
      980     9011    3                 CALL CHARBIN( THISFSN, LBL1$->FT$LBL1.FSEQU_NUM );
      981     9012    4                 IF SAVFSN = 0 THEN DO;
              9012                          /* First file encountered...remember to avoid cycling past */
      982     9013    4                    SAVFSN = THISFSN;
      983     9014    4                    SAVVOL = F$DCB.VOL;
      984     9015    4                    END;
      985     9016    3                 ELSE
      986     9017    4                    IF SAVFSN = THISFSN AND SAVVOL = F$DCB.VOL THEN DO;
      987     9018                                                /* Back at starting point             */
      988     9019    4                       F$DCB.ARS = -1;     /* Reposition where we started        */
      989     9020    4                       CALL FTI$SPREC ALTRET(JUSTALT);
      990     9021    4                       B$JIT.ERR = E_NOFILE; /*E* ERROR: FTL-E$NOFILE */
      991     9022    4                       FT$DDT.POS = FTP_HDR#; /* Positioned before HDR1          */
      992     9023    4                       FT$DDT.FSN = THISFSN - 1;
      993     9024    4                       ALTRETURN;
      994     9025    4                       END;
      995     9026    3                 CALL CHARBIN( THISFSECT, LBL1$->FT$LBL1.FSECT );
      996     9027    3                 CALL FTL_CHKNAME ALTRET(NOPE);
      997     9028
      998     9029         /***
      999     9030                *** File with proper name has been found.
     1000     9031                *** Make sure proper section has been found.
     1001     9032                ***/
     1002     9033
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:31   
     1003     9034    3                 F$DCB.FSN = THISFSN;      /* Set sequence number                */
     1004     9035    4                 IF F$DCB.FSECT = 0 OR F$DCB.FSECT = THISFSECT THEN DO;
     1005     9036                                                /* Specified name found               */
     1006     9037    4                    IF SKIPS = 2 THEN
     1007     9038    4                       FT$DDT.POS = FTP_BOD#;
     1008     9039    4                    ELSE
     1009     9040    4                       FT$DDT.POS = FTP_HDR#;
     1010     9041    4                    RETURN;
     1011     9042    4                    END;
     1012     9043    4                 ELSE DO;                  /* Not proper FSECT but have FSN      */
     1013     9044    4                    CALL FTL$FINDSEQ ALTRET(JUSTALT); /* Find by sequence number */
     1014     9045    4                    RETURN;
     1015     9046    4                    END;
     1016     9047
     1017     9048         /***
     1018     9049               *** File names did not match...move on to next file.
     1019     9050               ***/
     1020     9051
     1021     9052    3   NOPE:         ;
     1022     9053    3                 FT$DDT.FSN = THISFSN;     /* Remember where we were             */
     1023     9054    3                 IF B$JIT.ERR THEN
     1024     9055    3                    ALTRETURN;
     1025     9056    3                 F$DCB.ARS = SKIPS;        /* Set # file marks to next HDR1      */
     1026     9057    3                 CALL FTI$SPFILE ALTRET(JUSTALT);
     1027     9058    4                 IF S$CU$->B$U.ASYNCH & ~ %U_RESET THEN DO; /* Search interrupted */
     1028     9059    4                    FT$DDT.POS = FTP_HDR#;
     1029     9060    4                    B$JIT.ERR = E_TAPBRK; /*E* ERROR: FTL-E$TAPBRK */
     1030     9061    4                    ALTRETURN;
     1031     9062    4                    END;
     1032     9063    3                 END;
     1033     9064    3              ELSE DO;                     /* Got error on HDR1 label read       */
     1034     9065    3                 IF NOT F$DCB.TYC.EOF(1) THEN
     1035     9066    3                    ALTRETURN;
     1036     9067    3                 THISFSN = -1;
     1037     9068    3                 F$DCB.ARS = -3;         /* Skip to file mark preceeding EOV/EOF */
     1038     9069    3                 CALL FTI$SPFILE ALTRET(JUSTALT);
     1039     9070    4                 IF F$DCB.TYC.BOT(1) THEN DO; /* Not much of a tape              */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:32   
     1040     9071    4                    F$DCB.ARS = 1;         /* Position before HDR1               */
     1041     9072    4                    CALL FTI$SPREC ALTRET(JUSTALT);
     1042     9073    4                    FT$DDT.POS = FTP_HDR#;
     1043     9074    4                    B$JIT.ERR = E_EOSET;
     1044     9075    4                    ALTRETURN;
     1045     9076    4                    END;
     1046     9077    4                 ELSE DO;                  /* Check last EOx label               */
     1047     9078    4                    F$DCB.ARS = 1;         /* Skip to label                      */
     1048     9079    4                    CALL FTI$SPFILE ALTRET(JUSTALT);
     1049     9080    4                    CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);
     1050     9081    4                    F$DCB.ARS = 1;        /* Position just before last file mark */
     1051     9082    4                    CALL FTI$SPFILE ALTRET(JUSTALT);
     1052     9083    4                    FT$DDT.POS = FTP_HDR#;
     1053     9084    4                    IF LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOV1' THEN
              9084                             /* Must be end of set */
     1054     9085    4                       B$JIT.ERR = E_VOLOUT; /*E* ERROR: FTL-E$VOLOUT */
     1055     9086                                /* This error will be changed to E$EOSET below unless */
     1056     9087                                        /* the search is to continue (F$DCB.FSN = 0). */
     1057     9088    5                    ELSE DO;               /* Another volume must exist          */
     1058     9089    5                       F$DCB.SEZ_OK = %NO#; /* Say scratch not ok                */
     1059     9090    5                       CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(CHKSCRATCH);
     1060     9091    5                       DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1061     9092    5                       END;
     1062     9093    4                    END;
     1063     9094    4                 IF B$JIT.ERR.CODE ~= 0 THEN DO; /* Ran out of "next" volumes    */
     1064     9095    4   CHKSCRATCH:      ;
     1065     9096    4                    I = B$JIT.ERR.CODE;    /* Get error code                     */
     1066     9097    4                    IF I ~= %E$VOLOUT AND I ~= %E$VOLORDER THEN
     1067     9098    4                       ALTRETURN;          /* If unexpected error, altreturn now */
     1068     9099    5                    IF F$DCB.FSN > 0 OR F$DCB.IGNOREFSN THEN DO;
     1069     9100                                /* Start search at FSN or ignore FSN means end at EOS */
     1070     9101    5                       IF I = %E$VOLOUT THEN
     1071     9102    5                          B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */
     1072     9103    5                       ALTRETURN;
     1073     9104    5                       END;
     1074     9105    4                    B$JIT.ERR = '0'B;      /* Clear error                        */
     1075     9106    5                    IF F$DCB.VOL = 1 THEN DO; /* A one volume set                */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:33   
     1076     9107    6                       IF SAVFSN = THISFSN AND SAVVOL = F$DCB.VOL THEN DO;
     1077     9108    6                          B$JIT.ERR = E_NOFILE;
     1078     9109    6                          ALTRETURN;
     1079     9110    6                          END;
     1080     9111    6                       IF SAVFSN = 0 THEN DO;
     1081     9112    6                          SAVFSN = -1;
     1082     9113    6                          SAVVOL = F$DCB.VOL;
     1083     9114    6                          END;
     1084     9115    5                       CALL FTI$REWIND ALTRET(JUSTALT); /* Get to BOV            */
     1085     9116    5                       END;
     1086     9117    5                    ELSE DO;               /* Resume search at first vol of set  */
     1087     9118    5                       F$DCB.SEZ_OK = %NO#;
     1088     9119    5                       CALL FTR$CHNGVOL(1) ALTRET(JUSTALT); /* Get first volume  */
     1089     9120    5                       END;
     1090     9121    4                    END;
     1091     9122    3                 DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1092     9123                                          /* Get pointer to DDT entry for next volume */
     1093     9124    3                 END;
     1094     9125    2              END /* DO_FOREVER */;
     1095     9126
     1096     9127        /**************************************/
     1097     9128
     1098     9129    1   FTL_CHKNAME: PROC ALTRET;
     1099     9130        /*F*     NAME: FTL_CHKNAME
     1100     9131                 PURPOSE: Check if name contained in HDR1/HDR2 matches
     1101     9132                    that in the DCB.
     1102     9133                 DESCRIPTION: If the file was not created by CP-6, assume all
     1103     9134                    file name information is contained in the HDR1 label.  The
     1104     9135                    file names then match if the first 17 chars of DCB.NAME
     1105     9136                    match the 17 char name field in the HDR1 label and the
     1106     9137                    DCB name is 17 chars or less.  If not, altreturn to indicate
     1107     9138                    no match.  If the file was created by CP-6, get the HDR2
     1108     9139                    label.  If this label does not exist, the same criteria
     1109     9140                    as above are used to determine match.  If the HDR2
     1110     9141                    label exists but the file is not a CP-6 format file (with
     1111     9142                    extended name), the same criteria as above are also used.
     1112     9143                    For CP-6 format files the entire DCB.NAME must match the
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:34   
     1113     9144                    extended name field in the HDR2 label for a match.
     1114     9145                    Position is left after the HDR2 if the second label pointer
     1115     9146                    points to 'HDR2', possibly before the HDR2 is LBL2$ points
     1116     9147                    to blanks, and after the HDR1/[HDR2] if non-blank.  SKIPS
     1117     9148                    is set to the number of file marks to skip to get to the
     1118     9149                    next HDR1.
     1119     9150         ***/
     1120     9151
     1121     9152        /********************/
     1122     9153
     1123     9154    2              SKIPS = 3;           /* Just after HDR1...three file marks to next */
     1124     9155    2              IF LBL1$->FT$LBL1.FILE_ID ~= F$DCB.NAME.C17.CC THEN ALTRETURN;
     1125     9156                                              /* Not even the first 17 chars matched? */
     1126     9157    2              IF LBL1$->FT$LBL1.SYSTEM.ID = 'CP-6'
     1127     9158    3              THEN DO;                     /* More file name info in HDR2        */
     1128     9159    3                 CALL FTI$RDASCEBC(LBL2$) ALTRET(JUSTALT);
     1129     9160    3                 IF NOT F$DCB.TYC(1)
     1130     9161    4                 THEN DO;                  /* Error reading HDR2                 */
     1131     9162    4                    IF F$DCB.TYC.EOF(1) THEN SKIPS = 2;
     1132     9163    4                    END;
     1133     9164    3                 IF LBL2$->FT$ANYLBL.LABEL_TYPE = 'HDR2'
     1134     9165    3                 THEN IF F$DCB.ARS >= 80
     1135     9166    4                    THEN DO;
     1136     9167    4                       IF LBL2$->FT$LBL2.FORMAT = 'U' AND LBL2$->FT$LBL2.CP6.
              9167                                FILE_FORMAT ~= ' '
     1137     9168    4                       THEN     /* For CP-6 file, U format might have sub-format */
     1138     9169    4                          IF F$DCB.NAME.C = LBL2$->FT$LBL2.CP6.FILE_ID THEN RETURN;
     1139     9170                                                /* Return if all chars match          */
     1140     9171    4                       END;
     1141     9172    4                    ELSE DO;               /* Messed up HDR2                     */
     1142     9173    4                       FT$DDT.POSLOST = %YES#;
     1143     9174    4                       B$JIT.ERR = E_POSERR; /*E* ERROR: FTL-E$POSERR */
     1144     9175    4                       END;
     1145     9176    4                 ELSE DO;                  /* Not HDR2, assume user label        */
     1146     9177    4                    F$DCB.ARS = -1;        /* Position before it                 */
     1147     9178    4                    CALL FTI$SPREC ALTRET(JUSTALT);
     1148     9179    4                    END;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:35   
     1149     9180    3                 END;
     1150     9181    2              ELSE LBL2$->FT$ANYLBL.LABEL_TYPE = ' '; /* Indicate no HDR2        */
     1151     9182
     1152     9183         /***
     1153     9184          *** First 17 chars of DCB name and tape file name matched and
     1154     9185          *** there are no more than 17 chars in the tape file name.  If
     1155     9186          *** likewise for the DCB name...match.
     1156     9187          ***/
     1157     9188
     1158     9189    2              IF F$DCB.NAME.L > 17 THEN ALTRETURN;
     1159     9190    2              RETURN;
     1160     9191
     1161     9192    2   JUSTALT:   ;
     1162     9193    2              ALTRETURN;
     1163     9194
     1164     9195    2      END FTL_CHKNAME;
     1165     9196        /*********************************************************************/
     1166     9197        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:36   
     1167     9198        /*********************************************************************/
     1168     9199    1   FTL$FINDSEQIBM: ENTRY ALTRET;
     1169     9200        /*F*     NAME: FTL$FINDSEQIBM
     1170     9201                 PURPOSE: Find a file by its sequence number and file section, when
     1171     9202                          dealing with IBM "ANS" tapes.
     1172     9203             DESCRIPTION:
     1173     9204                          First, find the starting file section.  If we're looking
     1174     9205                          for the first section (F$DCB.FSECT = 1), we're done.  Else
     1175     9206                          skip to the volume with the desired file section on it.
     1176     9207         ***/
     1177     9208
     1178     9209        /********************/
     1179     9210
     1180     9211    1              CALL FTL_LBLINIT ALTRET(JUSTALT);
     1181     9212
     1182     9213    1              IF F$DCB.VOL > 1 THEN
     1183     9214    2              DO WHILE (F$DCB.FSN <= FT$DDT.FRSTFSN + 1);
     1184     9215    2                 F$DCB.SEZ_OK = %NO#;
     1185     9216    3                 CALL FTR$CHNGVOL(F$DCB.VOL - 1) WHENALTRETURN DO;
     1186     9217    3                    IF (B$JIT.ERR.CODE = %E$VOLOUT) THEN
     1187     9218    3                       B$JIT.ERR = E_EOSET;
     1188     9219    3                    ALTRETURN;
     1189     9220    3                    END;
     1190     9221    2                 DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1191     9222    2                 END;
     1192     9223
     1193     9224    1              IF FT$DDT.POS ~= FTP_BOV# AND FT$DDT.POS ~= FTP_HDR# THEN
     1194     9225    1                 CALL FTI$REWIND ALTRET(JUSTALT);
     1195     9226
     1196     9227    1              CALL FTL_GETFSN ALTRET(JUSTALT);
     1197     9228
     1198     9229    2              IF F$DCB.TYC.EOF(1) THEN DO;
     1199     9230    3                 IF (LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'E0V1') THEN DO;
     1200     9231                                 /* MUST BE EOF AND THEREFORE END OF SET AND AN ERROR */
     1201     9232    3                    B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */
     1202     9233    3                    ALTRETURN;
     1203     9234    3                    END;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:37   
     1204     9235    2                 F$DCB.SEZ_OK = %NO#;
     1205     9236    2                 CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(JUSTALT);
     1206     9237    2                 DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1207     9238    2                 CALL FTL_GETFSN ALTRET(JUSTALT);
     1208     9239    2                 END;
     1209     9240
     1210     9241    2              IF F$DCB.FSN < THISFSN THEN DO;
     1211     9242    2                 F$DCB.ARS = (THISFSN - F$DCB.FSN) * -3 - 1;
     1212     9243    2                 CALL FTI$SPFILE ALTRET(JUSTALT);
     1213     9244    2                 FT$DDT.POS = FTP_HDR#;
     1214     9245    2                 CALL FTL_GETFSN ALTRET(JUSTALT);
     1215     9246    3                 IF F$DCB.FSN ~= THISFSN THEN DO;
     1216     9247    3                    B$JIT.ERR = E_VOLORDER;
     1217     9248    3                    ALTRETURN;
     1218     9249    3                    END;
     1219     9250    2                 FT$DDT.POS = FTP_HDR#;
     1220     9251    2                 RETURN;
     1221     9252    2                 END;
     1222     9253
     1223     9254    2              IF F$DCB.FSN = THISFSN THEN DO;
     1224     9255    2                 FT$DDT.POS = FTP_HDR#;
     1225     9256    2                 RETURN;
     1226     9257    2                 END;
     1227     9258
     1228     9259    2              DO UNTIL (F$DCB.FSN = FT$DDT.FSN + 1);
     1229     9260    3                 IF F$DCB.TYC.EOF(1) THEN DO; /* END OF TAPE                     */
     1230     9261    4                    IF (LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'E0V1') THEN DO;
     1231     9262                                 /* MUST BE EOF AND THEREFORE END OF SET AND AN ERROR */
     1232     9263    4                       B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */
     1233     9264    4                       ALTRETURN;
     1234     9265    4                       END;
     1235     9266    3                    F$DCB.SEZ_OK = %NO#;
     1236     9267    3                    CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(JUSTALT);
     1237     9268    3                    DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1238     9269    3                    END;
     1239     9270    3                 ELSE DO;
     1240     9271    4                    IF F$DCB.FSN < THISFSN THEN DO;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:38   
     1241     9272    4                       B$JIT.ERR = E_VOLORDER;
     1242     9273    4                       ALTRETURN;
     1243     9274    4                       END;
     1244     9275    3                    F$DCB.ARS = 3;
     1245     9276    3                    CALL FTI$SPFILE ALTRET(JUSTALT);
     1246     9277    3                    END;
     1247     9278    2                 CALL FTL_GETFSN ALTRET(JUSTALT);
     1248     9279    2                 END;
     1249     9280
     1250     9281    1              FT$DDT.POS = FTP_HDR#;
     1251     9282    1              RETURN;
     1252     9283
     1253     9284        /*********************************************************************/
     1254     9285        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:39   
     1255     9286        /*********************************************************************/
     1256     9287    1   FTL$FINDSEQ: ENTRY ALTRET;
     1257     9288        /*F*     NAME: FTL$FINDSEQ
     1258     9289                 PURPOSE: Find a file (section) by its sequence number (and
     1259     9290                    section number).
     1260     9291         ***/
     1261     9292
     1262     9293        /********************/
     1263     9294
     1264     9295    1              CALL FTL_LBLINIT ALTRET(JUSTALT);
     1265     9296
     1266     9297         /***
     1267     9298          *** Keep looking for file until known to exist or not.
     1268     9299          ***/
     1269     9300
     1270     9301    1              SKIPS = 0;                   /* No volume changes made yet         */
     1271     9302    1              LOOKDIR = 0;                 /* Direction not known                */
     1272     9303    1              SECTFIND = %NO#;             /* Don't know where we are yet        */
     1273     9304    1              LBL2$->FT$ANYLBL.LABEL_TYPE = ' '; /* No HDR2 has be read          */
     1274     9305    2              DO WHILE('1'B);
     1275     9306    3                 IF S$CU$->B$U.ASYNCH & ~ %U_RESET THEN DO; /* Search interrupted */
     1276     9307    3                    B$JIT.ERR = E_TAPBRK; /*E* ERROR: FTL-E$TAPBRK */
     1277     9308    3                    ALTRETURN;
     1278     9309    3                    END;
     1279     9310    3                 IF F$DCB.FSN <= FT$DDT.FSN THEN DO;
     1280     9311                                     /* Required file must be before current position */
     1281     9312    3                    IF LOOKDIR > 0 THEN
     1282     9313    3                       GOTO FSNNOTHERE;
     1283     9314    3                    ELSE
     1284     9315    3                       LOOKDIR = -1;       /* Looking in backward direction      */
     1285     9316    4                    IF FT$DDT.ANST AND F$DCB.FSN <= (FT$DDT.FSN-FT$DDT.FRSTFSN)/3+1
              9316                             THEN DO;
     1286     9317                                                /* Rewind probably fastest            */
     1287     9318    4                       CALL FTI$REWIND ALTRET(JUSTALT);
     1288     9319    4                       LOOKDIR = 0;
     1289     9320    4                       END;
     1290     9321    4                    ELSE DO;               /* Use space files                    */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:40   
     1291     9322    4                       F$DCB.ARS = (FT$DDT.FSN + 1 - F$DCB.FSN) * -3 - 1;
     1292     9323                                              /* Calc number of file marks to back up */
     1293     9324    4                       CALL FTI$SPFILE ALTRET(JUSTALT);
     1294     9325    4                       END;
     1295     9326    3                    IF FT$DDT.POS ~= FTP_BOV# THEN
     1296     9327    3                       CALL FTI$SPREC ALTRET(JUSTALT); /* Skip file mark to HDR1 */
     1297     9328    3                    CALL FTL_GETFSN ALTRET(JUSTALT); /* Find where we actually are */
     1298     9329    4                    IF F$DCB.FSN < THISFSN THEN DO;
              9329                             /* Section must be on previous volume*/
     1299     9330    4                       IF SKIPS > 0 THEN
     1300     9331    4                          GOTO VOLORDER;   /* Volume with file seq missing       */
     1301     9332    4                       ELSE
     1302     9333    4                          SKIPS = -1;      /* PVOL                               */
     1303     9334    4                       END;
     1304     9335    4                    ELSE DO;
     1305     9336    4                       IF F$DCB.FSECT > THISFSECT AND SKIPS < 0 THEN
     1306     9337    4                          GOTO VOLORDER; /* Don't CVOL to the next volume again. */
     1307     9338    4                       END;
     1308     9339    3                    END;
     1309     9340    3                 ELSE DO;
              9340                          /* Must move forward (file by file to detect last file mark) */
     1310     9341    3                    IF LOOKDIR < 0 THEN
     1311     9342    3                       GOTO FSNNOTHERE;    /* Looking forward after backward.    */
     1312     9343    3                    ELSE
     1313     9344    3                       LOOKDIR = 1;        /* Looking in forward direction       */
     1314     9345    3                    NOT_TAPE_END = %YES#;  /* 'til tape end                      */
     1315     9346    4                    DO WHILE (NOT_TAPE_END);
     1316     9347    4                       CALL FTL_GETFSN ALTRET(JUSTALT);
     1317     9348    5                       IF F$DCB.TYC.EOF(1) THEN DO;
              9348                                /* Hit file mark...must be tape end */
     1318     9349    5                          NOT_TAPE_END = %NO#; /* Now at end                     */
     1319     9350    5                          IF SKIPS < 0 THEN
     1320     9351    5                             GOTO VOLORDER; /* Volume with seq must be missing   */
     1321     9352    6                          ELSE DO;         /* CVOL if not end of set             */
     1322     9353    7                             IF NOT FT$DDT.ANST THEN DO; /* PO tape              */
     1323     9354    8                                IF FT$DDT.FSN < 1 THEN DO; /* Can't back up (much) */
     1324     9355    8                                   F$DCB.ARS = -1;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:41   
     1325     9356    8                                   CALL FTI$SPFILE ALTRET(JUSTALT);
     1326     9357    8                                   B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */
     1327     9358    8                                   ALTRETURN;
     1328     9359    8                                   END;
     1329     9360    7                                END;
     1330     9361    6                             F$DCB.ARS = -3; /* Skip to file mark preceeding EOV/EOF */
     1331     9362    6                             CALL FTI$SPFILE ALTRET(JUSTALT);
     1332     9363    7                             IF F$DCB.TYC.BOT(1) THEN DO; /* Not much of a tape  */
     1333     9364    7                                B$JIT.ERR.CODE = %E$VOLOUT;
              9364                                         /* No more volumes in set */
     1334     9365    7                                F$DCB.ARS = 1;
     1335     9366    7                                CALL FTI$SPREC ALTRET(JUSTALT); /* Hop over VOL1 */
     1336     9367    7                                FT$DDT.POS = FTP_HDR#; /* Where HDR1 should be   */
     1337     9368    7                                GOTO NOSCRATCHES;
     1338     9369    7                                END;
     1339     9370    7                             ELSE DO;      /* Check last EOx label               */
     1340     9371    7                                F$DCB.ARS = 1; /* Skip to label                  */
     1341     9372    7                                CALL FTI$SPFILE ALTRET(JUSTALT);
     1342     9373    7                                CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);
     1343     9374    7                                F$DCB.ARS = 1;
              9374                                         /* Position just before last file mark */
     1344     9375    7                                CALL FTI$SPFILE ALTRET(JUSTALT);
     1345     9376    7                                FT$DDT.POS = FTP_HDR#;
     1346     9377    8                                IF LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOV1' THEN DO;
     1347     9378                                                /* Must be end of set                 */
     1348     9379    8                                   B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */
     1349     9380    8                                   ALTRETURN;
     1350     9381    8                                   END;
     1351     9382    8                                ELSE DO;
     1352     9383    8                                   SKIPS = 1; /* Another volume must exist       */
     1353     9384    8                                   END;
     1354     9385    7                                END;
     1355     9386    6                             END;
     1356     9387    5                          END;
     1357     9388    5                       ELSE DO;            /* Got next HDR1                      */
     1358     9389    5                          IF F$DCB.FSN = THISFSN THEN
     1359     9390    5                             IF F$DCB.FSECT > THISFSECT AND SKIPS < 0 THEN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:42   
     1360     9391    6                                IF F$DCB.IGNOREFSN THEN DO;
     1361     9392    6                                   NOT_TAPE_END = %NO#;
     1362     9393    6                                   F$DCB.OLDIOERR = 2;
     1363     9394    6                                   END;
     1364     9395    5                                ELSE
     1365     9396    5                                   GOTO VOLORDER;
              9396                                            /* Don't CVOL to next volume again. */
     1366     9397    5                             ELSE
     1367     9398    5                                NOT_TAPE_END = %NO#; /* Stop search here         */
     1368     9399    6                          ELSE DO;         /* Position to next HDR1              */
     1369     9400    6                             F$DCB.ARS = 3;
     1370     9401    6                             CALL FTI$SPFILE ALTRET(JUSTALT);
     1371     9402    6                             FT$DDT.FSN = THISFSN; /* Now past file              */
     1372     9403    7                             IF S$CU$->B$U.ASYNCH & ~ %U_RESET THEN DO;
     1373     9404                                                /* Search interrupted                 */
     1374     9405    7                                FT$DDT.POS = FTP_HDR#;
     1375     9406    7                                B$JIT.ERR = E_TAPBRK; /*E* ERROR: FTL-E$TAPBRK */
     1376     9407    7                                ALTRETURN;
     1377     9408    7                                END;
     1378     9409    6                             END;
     1379     9410    5                          END;
     1380     9411    4                       END;
     1381     9412    3                    END;
     1382     9413
     1383     9414         /***
     1384     9415             *** At this point we are either positioned at the proper file,
     1385     9416             *** positioned at a section of the proper file, or ready to
     1386     9417             *** CVOL or PVOL depending on SKIPS.
     1387     9418             ***/
     1388     9419
     1389     9420    3                 IF F$DCB.FSN = THISFSN AND NOT F$DCB.TYC(1) THEN DO;
     1390     9421                                                /* Positioned before section of file  */
     1391     9422    4                    IF F$DCB.FSECT = 0 OR F$DCB.FSECT = THISFSECT THEN DO;
     1392     9423                                                /* Positioned properly                */
     1393     9424    4                       FT$DDT.POS = FTP_HDR#;
     1394     9425    4                       RETURN;
     1395     9426    4                       END;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:43   
     1396     9427    3                    SKIPS = F$DCB.FSECT - THISFSECT;
     1397     9428    3                    SECTFIND = %YES#;      /* Now trying to find proper section  */
     1398     9429                                                /* Calc offset of volume to change to */
     1399     9430    3                    END;
     1400     9431    3                 IF FT$DDT.POS ~= FTP_HDR# THEN DO;/* Must reposition to HDR1    */
     1401     9432    3                    F$DCB.ARS = -1;        /* Position before file mark or HDR1  */
     1402     9433    3                    CALL FTI$SPREC ALTRET(JUSTALT);
     1403     9434    3                    FT$DDT.POS = FTP_HDR#;
     1404     9435    3                    END;
     1405     9436    3                 IF SKIPS ~= 0 THEN DO; /* Need to look for file on another volume */
     1406     9437    3                    F$DCB.SEZ_OK = %NO#;   /* No scratches                       */
     1407     9438    3                    CALL FTR$CHNGVOLNR(F$DCB.VOL + SKIPS) ALTRET(NOSCRATCHES);
              9438                             /* No rewind */
     1408     9439    3                    DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1409     9440    3                    LOOKDIR = 0;           /* Starting search on new volume      */
     1410     9441    4                    IF NOT FT$DDT.ANST AND FT$DDT.NOWANS THEN DO;
     1411     9442                                                /* Find first HDR1 if necessary       */
     1412     9443    5                       IF FT$DDT.POS = FTP_BOV# THEN DO;
     1413     9444    5                          F$DCB.ARS = 1;
     1414     9445    5                          CALL FTI$SPFILE ALTRET(JUSTALT);
     1415     9446    5                          FT$DDT.POS = FTP_HDR#;
     1416     9447    5                          CALL FTL_GETFSN ALTRET(JUSTALT);
     1417     9448    5                          F$DCB.ARS = -1;  /* Position before HDR1               */
     1418     9449    5                          CALL FTI$SPREC ALTRET(JUSTALT);
     1419     9450    5                          END;
     1420     9451    4                       END;
     1421     9452    3                    END;
     1422     9453    2                 END;
     1423     9454
     1424     9455    1   VOLORDER:  ; /* HDR1 or file mark hit and file with sequence number not found */
     1425     9456    1              F$DCB.ARS = -1;              /* Position before file mark or HDR1  */
     1426     9457    1              CALL FTI$SPREC ALTRET(JUSTALT);
     1427     9458    1              FT$DDT.POS = FTP_HDR#;       /* Should be before HDR1              */
     1428     9459    1              B$JIT.ERR = E_VOLORDER; /*E* ERROR: FTL-E$VOLORDER */
     1429     9460    1              ALTRETURN;
     1430     9461
     1431     9462    1   NOSCRATCHES: ;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:44   
     1432     9463    1              I = B$JIT.ERR.CODE;          /* What went wrong                    */
     1433     9464    2              IF I = %E$VOLORDER THEN DO;
     1434     9465    2                 IF SECTFIND THEN
     1435     9466    2                    B$JIT.ERR = E_SECTERR; /*E* ERROR: FTL-E$SECTERR */
     1436     9467    2                 END;                /* Tried to get another volume but couldn't */
     1437     9468    1              ELSE
     1438     9469    1                 IF I = %E$VOLOUT THEN
     1439     9470    1                    IF SECTFIND THEN
     1440     9471    1                       B$JIT.ERR = E_SECTERR; /*E* ERROR: FTL-E$SECTERR */
     1441     9472    1                    ELSE
     1442     9473    1                       B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */
     1443     9474                                                /* File must be missing               */
     1444     9475    1              ALTRETURN;
     1445     9476
     1446     9477    1   FSNNOTHERE: ;
     1447     9478    1              B$JIT.ERR = E_FSNERR; /*E* ERROR: FTL-E$FSNERR */
     1448     9479    1              ALTRETURN;
     1449     9480
     1450     9481        /*********************************************************************/
     1451     9482        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:45   
     1452     9483        /*********************************************************************/
     1453     9484    1   FTL$GETFSN: ENTRY ALTRET;
     1454     9485        /*F*     NAME: FTL$GETFSN
     1455     9486                 PURPOSE: Get file sequence number from HDR1.
     1456     9487         ***/
     1457     9488
     1458     9489        /********************/
     1459     9490
     1460     9491    1              CALL FTL_LBLINIT ALTRET(JUSTALT);
     1461     9492    1              CALL FTL_GETFSN ALTRET(JUSTALT); /* Get the sequence number        */
     1462     9493    1              F$DCB.ARS = -1;              /* Position before HDR1 or file mark  */
     1463     9494    1              CALL FTI$SPREC ALTRET(JUSTALT);
     1464     9495    1              FT$DDT.POS = FTP_HDR#;       /* Positioned at HDR                  */
     1465     9496    1              RETURN;
     1466     9497
     1467     9498        /*********************************************************************/
     1468     9499        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:46   
     1469     9500        /*********************************************************************/
     1470     9501    1   FTL_GETFSN: PROC ALTRET;
     1471     9502        /*F*     NAME: FTL_GETFSN
     1472     9503                 PURPOSE: Get next file sequence number.
     1473     9504                 DESCRIPTION: If at beginning of tape, skips labels until HDR1
     1474     9505                    has been read.  If not, next label should be HDR1.
     1475     9506                    If a label is read, it must be a HDR1...get its FSN and
     1476     9507                    FSECT.  If a file mark is hit, assume FSN is already
     1477     9508                    correct and position before it (resulting in TYC.BOF).
     1478     9509         ***/
     1479     9510
     1480     9511        /********************/
     1481     9512
     1482     9513         /***
     1483     9514         *** Get next HDR1.
     1484     9515          ***/
     1485     9516
     1486     9517    2              CALL FTL_GETNXTHDR ALTRET(JUSTALT);
     1487     9518
     1488     9519         /***
     1489     9520          *** If a label was read, it must be a HDR1.  Get the FSN and FSECT.
     1490     9521          *** If a file mark was read we must be at end of volume with file
     1491     9522          *** sequence number already correct.
     1492     9523          ***/
     1493     9524
     1494     9525    2              IF NOT F$DCB.TYC.EOF(1)
     1495     9526    3              THEN DO;                     /* Got label                          */
     1496     9527    3                 CALL FTL_CHKLBL( 'HDR1', LBL1$ ) ALTRET(JUSTALT); /* Must be HDR1 */
     1497     9528    3                 CALL CHARBIN( THISFSN, LBL1$->FT$LBL1.FSEQU_NUM );
     1498     9529    3                 FT$DDT.FSN = THISFSN - 1; /* Set FSN of previous file           */
     1499     9530    3                 CALL CHARBIN( THISFSECT, LBL1$->FT$LBL1.FSECT );
     1500     9531    3                 IF F$DCB.EBCDIC THEN
     1501     9532    3                    THISFSECT = THISFSECT - F$DCB.STR;
     1502     9533    3                 END;
     1503     9534    3              ELSE DO;                     /* File mark...must be end of volume  */
     1504     9535    3                 THISFSN = FT$DDT.FSN + 1; /* Return last FSN                    */
     1505     9536    3                 THISFSECT = 1;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:47   
     1506     9537    3                 END;
     1507     9538    2              RETURN;
     1508     9539
     1509     9540    2   JUSTALT:   ;
     1510     9541    2              ALTRETURN;
     1511     9542
     1512     9543    2      END FTL_GETFSN;
     1513     9544        /*********************************************************************/
     1514     9545        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:48   
     1515     9546        /*********************************************************************/
     1516     9547    1   FTL_CHKLBL: PROC(ALBL,ALBL$) ALTRET;
     1517     9548        /*F*     NAME: FTL_CHKLBL
     1518     9549                 PURPOSE: Check if specified label.  If not, position lost.
     1519     9550         ***/
     1520     9551
     1521     9552         /***
     1522     9553          *** Parameters:
     1523     9554          ***/
     1524     9555
     1525     9556    2     DCL ALBL CHAR(4);                     /* The label to check against         */
     1526     9557    2     DCL ALBL$ PTR;                        /* Pointer to label to check          */
     1527     9558
     1528     9559        /********************/
     1529     9560
     1530     9561    2              IF F$DCB.ARS < 80 OR ALBL$->FT$ANYLBL.LABEL_TYPE ~= ALBL
     1531     9562    3              THEN DO;                     /* Position lost                      */
     1532     9563    3                 FT$DDT.POSLOST = %YES#;
     1533     9564    3                 B$JIT.ERR = E_POSERR; /*E* ERROR: FTL-E$POSERR  */
     1534     9565    3                 ALTRETURN;
     1535     9566    3                 END;
     1536     9567    2              RETURN;
     1537     9568
     1538     9569    2      END FTL_CHKLBL;
     1539     9570        /*********************************************************************/
     1540     9571        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:49   
     1541     9572        /********************************************************************/
     1542     9573    1   FTL$FINDHDR1: ENTRY ALTRET;
     1543     9574        /*F*     NAME: FTL$FINDHDR1
     1544     9575                 PURPOSE: Finds next HDR1 label to right of current position.
     1545     9576         ***/
     1546     9577
     1547     9578        /********************/
     1548     9579
     1549     9580    1              CALL FTL_LBLINIT ALTRET(JUSTALT);
     1550     9581    1              FT$DDT.POSLOST = %NO#;       /* Permit position to be found        */
     1551     9582    1              F$DCB.ARS = 1;
     1552     9583    1              CALL FTI$SPFILE ALTRET(JUSTALT); /* Space to next file mark past error */
     1553     9584    2              DO WHILE('1'B);
     1554     9585    3   RDLP:         CALL FTI$RDASCEBC(LBL1$) WHENALTRETURN DO;
     1555     9586    4                    IF B$JIT.ERR.CODE = %E$IOERR THEN DO;
     1556     9587    4                       F$DCB.ARS = 1;
     1557     9588    4                       CALL FTI$SPFILE ALTRET(JUSTALT);
     1558     9589    4                       GOTO RDLP;
     1559     9590    4                       END;
     1560     9591    3                    ALTRETURN;
     1561     9592    3                    END;
     1562     9593    3                 IF F$DCB.TYC.EOF(1) OR F$DCB.TYC.EOT(1) THEN DO;
     1563     9594    3                    FT$DDT.POS = FTP_EOV#;
     1564     9595    3                    F$DCB.SEZ_OK = %NO#;
     1565     9596    3                    CALL FTR$CHNGVOL(F$DCB.VOL+1) ALTRET(JUSTALT);
     1566     9597    3                    DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1567     9598    3                    F$DCB.ARS = 1;
     1568     9599    3                    CALL FTI$SPREC ALTRET(JUSTALT); /* Position to HDR1.         */
     1569     9600    3                    END;
     1570     9601    3                 ELSE IF LBL1$->FT$ANYLBL.LABEL_TYPE = 'HDR1' AND F$DCB.ARS = 80 THEN
              9601                          DO;
     1571     9602    3                       CALL CHARBIN(THISFSN,LBL1$->FT$LBL1.FSEQU_NUM);
     1572     9603    3                       FT$DDT.FSN = THISFSN - 1;
     1573     9604    3                       CALL CHARBIN(THISFSECT,LBL1$->FT$LBL1.FSECT);
     1574     9605    4                       IF THISFSECT = 1 OR F$DCB.EBCDIC THEN DO; /* BOF/IBM tape? */
     1575     9606    4                          FT$DDT.POS = FTP_HDR#; /* Yep, we're finished.         */
     1576     9607    4                          RETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:50   
     1577     9608    4                          END;
     1578     9609    3                       F$DCB.ARS = 3;      /* Space to next HDR1.                */
     1579     9610    3                       CALL FTI$SPFILE ALTRET(JUSTALT);
     1580     9611    3                       END;
     1581     9612    3                    ELSE DO;
     1582     9613    3                       F$DCB.ARS = 1;
     1583     9614    3                       CALL FTI$SPFILE ALTRET(JUSTALT); /* Space to next file mark. */
     1584     9615    3                       END;
     1585     9616    2                 END;
     1586     9617
     1587     9618        /********************************************************************/
     1588     9619        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:51   
     1589     9620        /*********************************************************************/
     1590     9621    1   FTL$FINDNEXT: ENTRY ALTRET;
     1591     9622        /*F*     NAME: FTL$FINDNEXT
     1592     9623                 PURPOSE: Find the next beginning-of-file on the tape set.
     1593     9624                 DESCRIPTION: Works like FTL$FINDSEQ, except it ignores the
     1594     9625                 FSN and FSECT in the HDR1 label, and it just finds the next
     1595     9626                 file on the tape, rather than a file with a particular FSN.
     1596     9627         ***/
     1597     9628
     1598     9629        /********************/
     1599     9630
     1600     9631    1              CALL FTL_LBLINIT ALTRET(JUSTALT);
     1601     9632    2              DO WHILE('1'B);
     1602     9633    2                 CALL FTL_GETFSN ALTRET(JUSTALT);
     1603     9634    3                 IF F$DCB.TYC.EOF(1) THEN DO; /* File mark hit, must be EOT.     */
     1604     9635    4                    IF NOT FT$DDT.ANST THEN DO; /* PO tape.                      */
     1605     9636    5                       IF FT$DDT.FSN < 1 THEN DO;
     1606     9637    5                          F$DCB.ARS = -1;
     1607     9638    5                          CALL FTI$SPFILE ALTRET(JUSTALT);
     1608     9639    5                          B$JIT.ERR = E_EOSET;
     1609     9640    5                          ALTRETURN;
     1610     9641    5                          END;
     1611     9642    4                       END;
     1612     9643    3                    F$DCB.ARS = -3;        /* Skip back to before EOV/EOF.       */
     1613     9644    3                    CALL FTI$SPFILE ALTRET(JUSTALT);
     1614     9645    4                    IF F$DCB.TYC.BOT(1) THEN DO; /* Short tape.                  */
     1615     9646    4                       B$JIT.ERR = E_EOSET; /* No more volumes in set.           */
     1616     9647    4                       F$DCB.ARS = 1;
     1617     9648    4                       CALL FTI$SPREC ALTRET(JUSTALT); /* Skip over VOL1.        */
     1618     9649    4                       FT$DDT.POS = FTP_HDR#; /* Should be at HDR1.              */
     1619     9650    4                       ALTRETURN;
     1620     9651    4                       END;
     1621     9652    4                    ELSE DO;
     1622     9653    4                       F$DCB.ARS = 1;      /* Skip to EOF/EOV.                   */
     1623     9654    4                       CALL FTI$SPFILE ALTRET(JUSTALT);
     1624     9655    4                       CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);
     1625     9656    4                       F$DCB.ARS = 1;     /* Position just before last file mark */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:52   
     1626     9657    4                       CALL FTI$SPFILE ALTRET(JUSTALT);
     1627     9658    4                       FT$DDT.POS = FTP_HDR#;
     1628     9659    5                       IF LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOV1' THEN DO;
     1629     9660                                                /* Must be end of set                 */
     1630     9661    5                          B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */
     1631     9662    5                          ALTRETURN;
     1632     9663    5                          END;
     1633     9664    5                       ELSE DO;            /* Not EOSET, look on next volume.    */
     1634     9665    5                          F$DCB.SEZ_OK = %NO#; /* No scratches.                  */
     1635     9666    6                          CALL FTR$CHNGVOLNR(F$DCB.VOL+1) WHENALTRETURN DO;
     1636     9667    6                             IF B$JIT.ERR.CODE = %E$VOLOUT THEN
     1637     9668    6                                B$JIT.ERR = E_EOSET;
     1638     9669    6                             ALTRETURN;
     1639     9670    6                             END;
     1640     9671    5                          DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1641     9672    6                          IF NOT FT$DDT.ANST AND FT$DDT.NOWANS THEN DO;
     1642     9673                                                /* Find first HDR1 if necessary       */
     1643     9674    7                             IF FT$DDT.POS = FTP_BOV# THEN DO;
     1644     9675    7                                F$DCB.ARS = 1;
     1645     9676    7                                CALL FTI$SPFILE ALTRET(JUSTALT);
     1646     9677    7                                FT$DDT.POS = FTP_HDR#;
     1647     9678    7                                END;
     1648     9679    6                             END;
     1649     9680    5                          END;
     1650     9681    4                       END;
     1651     9682    3                    END;
     1652     9683    3                 ELSE DO;                  /* Got next HDR1                      */
     1653     9684    3                    F$DCB.FSN = THISFSN;   /* Set FSN from HDR1.                 */
     1654     9685    3                    RETURN;
     1655     9686    3                    END;
     1656     9687    2                 END;
     1657     9688
     1658     9689        /********************************************************************/
     1659     9690        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:53   
     1660     9691        /*********************************************************************/
     1661     9692    1   FTL$EOF:   ENTRY(THELBL) ALTRET;
     1662     9693        /*F*     NAME: FTL$EOF
     1663     9694                 PURPOSE: Handle EOF/EOV label after file mark after data blocks.
     1664     9695                 DESCRIPTION: If the following label is an EOF, return end of file.
     1665     9696                    If the following label is an EOV and the user requested
     1666     9697                    CVOL handling, return end of volume.  In either of the
     1667     9698                    above cases, position is left before the file mark
     1668     9699                    preceeding the EOx label group.
     1669     9700                    For EOV label with user not handling CVOL, auto CVOL.
     1670     9701                    For (managed) DEVICE tapes, always return end-of-file.
     1671     9702         ***/
     1672     9703
     1673     9704        /********************/
     1674     9705
     1675     9706         /***
     1676     9707          *** If end of file, return eof code.  If end of volume,
     1677     9708          *** and user desires CVOL control, backup to end of file section and
     1678     9709          *** get ready for CVOL.
     1679     9710          ***/
     1680     9711
     1681     9712    1              CALL FTL_LBLINIT ALTRET(JUSTALT);
     1682     9713         /***
     1683     9714         ***/
     1684     9715    1              IF F$DCB.IASN = %OD#
     1685     9716    2              THEN DO;
     1686     9717    2                 CALL FTL_ODEOF ALTRET (JUSTALT); /* Optical Disc EOF/EOV        */
     1687     9718    2                 RETURN;
     1688     9719    2                 END;
     1689     9720    1              IF F$DCB.ASN ~= %DEVICE#
     1690     9721    2              THEN DO;                     /* Check block count                  */
     1691     9722    2                 CALL FTL_CHKEOX ALTRET(JUSTALT);
     1692     9723    2                 IF B$JIT.ERR
     1693     9724    3                 THEN DO;                  /* Block count error                  */
     1694     9725    3                    F$DCB.ARS = -1;
     1695     9726    3                    CALL FTI$SPFILE ALTRET(JUSTALT); /* Pos before last file mark */
     1696     9727    3                    ALTRETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:54   
     1697     9728    3                    END;
     1698     9729    2                 END;
     1699     9730    2              ELSE DO;                     /* Device (managed tape)              */
     1700     9731    2                 F$DCB.ARS = 4;
     1701     9732    2                 CALL FTI$RDASCEBC(ADDR(I)) ALTRET(JUSTALT);
     1702     9733    2                 IF F$DCB.TYC.EOF(1)
     1703     9734    3                 THEN DO;                  /* Double file mark                   */
     1704     9735    3                    F$DCB.ARS = -1;
     1705     9736    3                    CALL FTI$SPFILE ALTRET(JUSTALT); /* Position between marks   */
     1706     9737    3                    IF F$DCB.CVOL          /* User desires CVOL control          */
     1707     9738    3                        AND NOT F$DCB.MUST_CVOL
     1708     9739    3                        AND NOT F$DCB.TAPTYP.NOCVOL
     1709     9740    4                    THEN DO;               /* User gets CVOL control             */
     1710     9741    4                       CALL FTR$GETSN( F$DCB.VOL+1, ADDR(SN) ) ALTRET(NO_NEXT_VOL);
     1711     9742    4                       IF F$DCB.SPAN
     1712     9743    4                       THEN B$JIT.ERR = E_EOVOLS; /*E* FTL-E$EOVOLS */
     1713     9744    4                       ELSE B$JIT.ERR = E_EOVOL; /*E* FTL-E$EOVOL */
     1714     9745    4                       F$DCB.MUST_CVOL = %YES#;
     1715     9746    4   NO_NEXT_VOL:        ;
     1716     9747    4                       IF F$DCB.SPAN
     1717     9748    5                       THEN DO;
     1718     9749    5                          B$JIT.ERR = E_BADSPAN; /*E* ERROR: FTL-E$BADSPAN */
     1719     9750    5                          F$DCB.SPAN = %NO#; /* Next read gets E$EOF             */
     1720     9751    5                          END;
     1721     9752    4                       ELSE B$JIT.ERR = E_EOF; /*E* ERROR: FTL-E$EOF */
     1722     9753    4                       F$DCB.ARS = -1;
     1723     9754    4                       CALL FTI$SPFILE ALTRET(JUSTALT); /* Pos before 1st        */
     1724     9755    4                       ALTRETURN;
     1725     9756    4                       END;
     1726     9757    3                    CALL FTW$CVOL ALTRET(CHKVOLOUT);
     1727     9758    3                    RETURN;                /* Successful CVOL                    */
     1728     9759    3                    END;
     1729     9760    3                 ELSE DO;
     1730     9761    3                    F$DCB.ARS = -1;
     1731     9762    3                    CALL FTI$SPREC ALTRET(JUSTALT);
              9762                             /* Back up to just after file mark */
     1732     9763    3                    END;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:55   
     1733     9764    2                 END;
     1734     9765
     1735     9766    2              DO WHILE('0'B);
     1736     9767    2   CHKVOLOUT:    ;
     1737     9768    2                 IF B$JIT.ERR.CODE ~= %E$VOLOUT
     1738     9769    2                 THEN ALTRETURN;           /* Return with other error            */
     1739     9770    2                 END;
     1740     9771    1              IF THELBL = 'EOF' OR F$DCB.ASN = %DEVICE#
     1741     9772    2              THEN DO;                     /* End of file                        */
     1742     9773    2                 IF F$DCB.SPAN
     1743     9774    3                 THEN DO;                  /* End of file in span?               */
     1744     9775    3                    B$JIT.ERR = E_BADSPAN; /*E* ERROR: FTL-E$BADSPAN */
     1745     9776    3                    F$DCB.SPAN = %NO#;
     1746     9777    3                    END;
     1747     9778    2                 ELSE B$JIT.ERR = E_EOF; /*E* ERROR: FTL-E$EOF */
     1748     9779    2                 F$DCB.LSTBLK = %YES#;     /* At last block of file              */
     1749     9780    2                 IF F$DCB.ASN ~= %DEVICE#
     1750     9781    2                 THEN FT$DDT.POS = FTP_CHK#; /* Not in data                      */
     1751     9782    3                 ELSE DO;
     1752     9783    3                    F$DCB.ARS = -1;        /* Position before file mark          */
     1753     9784    3                    CALL FTI$SPFILE ALTRET(JUSTALT);
     1754     9785    3                    F$DCB.TYC(1) = '0'B;   /* Reset EOF                          */
     1755     9786    3                    END;
     1756     9787    2                 ALTRETURN;
     1757     9788    2                 END;
     1758     9789    2              ELSE DO;
     1759     9790    2                 IF F$DCB.CVOL             /* User desires CVOL control          */
     1760     9791    2                     AND NOT F$DCB.MUST_CVOL /* And CVOLing is not required      */
     1761     9792    2                     AND NOT F$DCB.TAPTYP.NOCVOL /* And user CVOL control is allowed */
     1762     9793    3                 THEN DO;                  /* User desires CVOL handling         */
     1763     9794    3                    IF F$DCB.SPAN
     1764     9795    3                    THEN B$JIT.ERR = E_EOVOLS; /*E* ERROR: FTL-E$EOVOLS */
     1765     9796    3                    ELSE B$JIT.ERR = E_EOVOL; /*E* ERROR: FTL-E$EOVOL */
     1766     9797    3                    F$DCB.MUST_CVOL = %YES#; /* CVOL before next operation       */
     1767     9798    3                    F$DCB.ARS = -1;   /* Position to end of current file section */
     1768     9799    3                    CALL FTI$SPFILE ALTRET(JUSTALT);
     1769     9800    3                    ALTRETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:56   
     1770     9801    3                    END;
     1771     9802    2                 END;
     1772     9803
     1773     9804         /***
     1774     9805          *** User does not desire CVOL control.  Change to next volume and
     1775     9806          *** find file section.
     1776     9807          ***/
     1777     9808
     1778     9809    1              CALL FTL_PBNFS ALTRET(JUSTALT);
              9809                       /* Position to beginning of next file sect */
     1779     9810    1              RETURN;
     1780     9811
     1781     9812        /*********************************************************************/
     1782     9813        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:57   
     1783     9814        /******************************************************************/
     1784     9815    1   FTL_ODEOF: PROC ALTRET;
     1785     9816        /*F*     NAME: FTL_ODEOF
     1786     9817                 PURPOSE: Handle EOF/EOV for Optical Disc file.
     1787     9818                 DESCRIPTION:  Get the EOF or EOV label record from the disc
     1788     9819                    and return the same conditions as labeled tape would.
     1789     9820                    Ignore user CVOL requests.
     1790     9821        ***/
     1791     9822
     1792     9823        /***************************/
     1793     9824
     1794     9825    2              CALL FPO$RDEOFLBL (LBL1$) ALTRET(JUSTALT);
     1795     9826    2              THELBL = LBL1$->FT$ULBL.LABEL_ID; /* Return label id               */
     1796     9827    2              CALL FTL_CHKBLKCNT;          /* Check block count error            */
     1797     9828    2              IF B$JIT.ERR THEN ALTRETURN; /*Block count error                   */
     1798     9829    2              IF THELBL = 'EOF'
     1799     9830    3              THEN DO;
     1800     9831    3                 IF F$DCB.SPAN
     1801     9832    4                 THEN DO;
     1802     9833    4                    B$JIT.ERR = E_BADSPAN;
     1803     9834    4                    F$DCB.SPAN = %NO#;
     1804     9835    4                    END;
     1805     9836    3                 ELSE B$JIT.ERR = E_EOF;
     1806     9837    3                 F$DCB.LSTBLK = %YES#;
     1807     9838    3                 FT$DDT.POS = FTP_CHK#;
     1808     9839    3                 ALTRETURN;
     1809     9840    3                 END;
     1810     9841    2              CALL FTL_PBNFS ALTRET(JUSTALT);
     1811     9842    2              RETURN;
     1812     9843
     1813     9844    2   JUSTALT:   ALTRETURN;
     1814     9845
     1815     9846    2      END FTL_ODEOF;
     1816     9847        /*******************************************************************/
     1817     9848        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:58   
     1818     9849        /*********************************************************************/
     1819     9850    1   FTL_PBNFS: PROC(UHL$,NUHL) ALTRET;
     1820     9851        /*F*     NAME: FTL_PBNFS
     1821     9852                 PURPOSE: Position to beginning of next file section after EOV label.
     1822     9853         ***/
     1823     9854
     1824     9855         /***
     1825     9856          *** Parameters:
     1826     9857          ***/
     1827     9858
     1828     9859    2     DCL NUHL SBIN;                        /* Number of bytes in UHL group       */
     1829     9860    2     DCL UHL$ PTR;                         /* Pointer to UHL VLP_ULBL (optional) */
     1830     9861
     1831     9862
     1832     9863        /********************/
     1833     9864
     1834     9865         /***
     1835     9866          *** If somewhere in EOV labels,  position past next file mark.
     1836     9867          ***/
     1837     9868
     1838     9869    3              IF NOT F$DCB.TYC.EOF(1) AND F$DCB.IASN ~= %OD# THEN DO;
     1839     9870    3                 F$DCB.ARS = 1;
     1840     9871    3                 CALL FTI$SPFILE ALTRET(JUSTALT);
     1841     9872    3                 END;
     1842     9873
     1843     9874    2              IF F$DCB.IASN = %OD# THEN
     1844     9875    2                 CALL FPO$CLOSEIN ALTRET(JUSTALT);
     1845     9876
     1846     9877    2              NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_EOV#;
     1847     9878
     1848     9879
     1849     9880         /***
     1850     9881          *** Change to next volume and find section with proper number.
     1851     9882          ***/
     1852     9883
     1853     9884    2              F$DCB.SEZ_OK = %NO#;         /* Don't CVOL to scratch              */
     1854     9885    2              CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(CHKFSECT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:59   
     1855     9886    2              F$DCB.FSECT = F$DCB.FSECT + 1; /* Get next section                 */
     1856     9887    3              IF F$DCB.IASN = %OD# THEN DO;
     1857     9888    3                 CALL FPO$FINDSEQ ALTRET (CHKFSECT);
     1858     9889    3                 CALL FPO$OPENIN ALTRET(JUSTALT);
     1859     9890    3                 END;
     1860     9891    3              ELSE DO;
     1861     9892    3                 CALL FTL$FINDSEQ ALTRET (CHKFSECT);
     1862     9893    4                 IF ADDR(UHL$) = ADDR(NIL) THEN DO;
              9893                          /* Non-M$CVOL call...don't get UHLs */
     1863     9894    5                    IF NOT F$DCB.TYC.EOF(1) THEN DO;
     1864     9895    5                       F$DCB.ARS = 1;      /* Get to data                        */
     1865     9896    5                       CALL FTI$SPFILE ALTRET(JUSTALT);
     1866     9897    5                       END;
     1867     9898    4                    END;
     1868     9899    4                 ELSE DO;                  /* M$CVOL call...get UHLs             */
     1869     9900    4                    IF NUHL > 0 THEN
     1870     9901    4                       CALL FTL$GETULBLS('UHL',UHL$,NUHL) ALTRET(JUSTALT);
     1871     9902    4                    ELSE
     1872     9903    4                       CALL FTL$GETULBLS('UHL',ADDR(NIL),NUHL) ALTRET(JUSTALT);
     1873     9904    4                    END;
     1874     9905    3                 END;
     1875     9906    2              F$DCB.PRECNO = 1;            /* At first block of next section     */
     1876     9907    2              F$DCB.AFTRBLK = %NO#;
     1877     9908    2              F$DCB.NEW_FSECT = %YES#;     /* At beginning of file section       */
     1878     9909    2              F$DCB.MUST_CVOL = %NO#;      /* CVOL done                          */
     1879     9910    2              NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_BOD#;
     1880     9911    2              RETURN;
     1881     9912
     1882     9913
     1883     9914    2   CHKFSECT:  ;
     1884     9915    2              I = B$JIT.ERR.CODE;
     1885     9916    2              IF I = %E$NOFILE THEN        /* File section could not be found    */
     1886     9917    2                 B$JIT.ERR = E_SECTERR; /*E* ERROR: FTL-E$SECTERR             */
     1887     9918    2              IF I = %E$VOLOUT THEN        /* No next volume to CVOL to          */
     1888     9919    2                 B$JIT.ERR = E_VOLORDER; /*E* ERROR: FTL-E$VOLORDER            */
     1889     9920
     1890     9921    2   JUSTALT:   ;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:60   
     1891     9922    2              ALTRETURN;
     1892     9923
     1893     9924    2      END FTL_PBNFS;
     1894     9925        /*********************************************************************/
     1895     9926        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:61   
     1896     9927        /*********************************************************************/
     1897     9928    1   FTL$PBSN:  ENTRY( THELBL, LBL$, NUM ) ALTRET;
     1898     9929        /*F*     NAME: FTL$PBSN
     1899     9930                 PURPOSE: Position to beginning of specified section number.
     1900     9931                 INPUT: NUM - number of section to position to.
     1901     9932         ***/
     1902     9933
     1903     9934        /********************/
     1904     9935
     1905     9936         /***
     1906     9937          *** Position current tape to the nearest HDR1.
     1907     9938          ***/
     1908     9939
     1909     9940    1              JDCB$ = B$JIT.DCB$;
     1910     9941    1              DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1911     9942    1              IF FT$DDT.POS = FTP_BOD#
     1912     9943    2              THEN DO;
     1913     9944    2                 F$DCB.ARS = 2;
     1914     9945    2                 CALL FTI$SPFILE ALTRET(JUSTALT); /* To next HDR1                */
     1915     9946    2                 FT$DDT.POS = FTP_HDR#;
     1916     9947    2                 END;
     1917     9948    1              SKIPS = NUM - F$DCB.FSECT;   /* Calc offset to next section        */
     1918     9949    1              IF SKIPS ~= 0
     1919     9950    2              THEN DO;                     /* Must change volume                 */
     1920     9951    2                 F$DCB.SEZ_OK = %NO#;      /* No scratches                       */
     1921     9952    2                 CALL FTR$CHNGVOL(F$DCB.VOL + SKIPS) ALTRET(JUSTALT);
     1922     9953    2                 END;
     1923     9954    1              F$DCB.FSECT = NUM;
     1924     9955    1              CALL FTL$FINDSEQ ALTRET(CHKFSECTX);
     1925     9956    1              F$DCB.ARS = 1;               /* Position to data blocks            */
     1926     9957    1              CALL FTI$SPFILE ALTRET(JUSTALT);
     1927     9958    1              F$DCB.PRECNO = 1;
     1928     9959    1              F$DCB.AFTRBLK = %NO#;
     1929     9960    1              F$DCB.NEW_FSECT = %YES#;     /* At file section beginning          */
     1930     9961    1              NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_BOD#;
     1931     9962    1              RETURN;
     1932     9963
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:62   
     1933     9964    1   CHKFSECTX: ;
     1934     9965    1              IF B$JIT.ERR.CODE = %E$NOFILE
     1935     9966    1              THEN B$JIT.ERR = E_SECTERR; /*E* ERROR: FTL-E$SECTERR */
     1936     9967    1              ALTRETURN;
     1937     9968
     1938     9969        /*********************************************************************/
     1939     9970        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:63   
     1940     9971        /*********************************************************************/
     1941     9972    1   FTL$PEOS:  ENTRY ALTRET;
     1942     9973        /*F*     NAME: FTL$PEOS
     1943     9974              PURPOSE: Position to end of tape set.
     1944     9975         ***/
     1945     9976
     1946     9977        /********************/
     1947     9978
     1948     9979    1              CALL FTL_LBLINIT ALTRET(JUSTALT);
     1949     9980
     1950     9981         /***
     1951     9982          *** If scratch, already at set end.
     1952     9983          ***/
     1953     9984
     1954     9985    1              IF FT$DDT.SCRTCH THEN RETURN;
     1955     9986    1              IF NOT FT$DDT.ANST
     1956     9987    2              THEN DO;                     /* Not ANS...must be PO               */
     1957     9988    2                 IF NOT FT$DDT.NOWANS
     1958     9989    2                 THEN RETURN;              /* Not even PO                        */
     1959     9990    2                 END;
     1960     9991    1              IF FT$DDT.FMNEEDED
     1961     9992    2              THEN DO;                    /* File mark needed before positioning */
     1962     9993    2                 FT$DDT.FMNEEDED = %NO#;
     1963     9994    2                 CALL FTI$WRFM ALTRET(JUSTALT);
     1964     9995    2                 F$DCB.ARS = -1;
     1965     9996    2                 CALL FTI$SPREC ALTRET(JUSTALT);
     1966     9997    2                 END;
     1967     9998
     1968     9999         /***
     1969    10000          *** Find end of set.
     1970    10001          ***/
     1971    10002
     1972    10003    2              DO WHILE('1'B);              /* For each tape of set               */
     1973    10004    2                 NOT_TAPE_END = %YES#;     /* Find end of tape                   */
     1974    10005    3                 DO WHILE(NOT_TAPE_END);
     1975    10006    3                    CALL FTL_GETNXTHDR ALTRET(JUSTALT); /* Get HDR1              */
     1976    10007    3                    IF F$DCB.TYC.EOF(1)
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:64   
     1977    10008    4                    THEN DO;               /* File mark, not HDR1                */
     1978    10009    4                       NOT_TAPE_END = %NO#; /* At tape end                       */
     1979    10010    4                       F$DCB.ARS = -3;     /* Get last tape label                */
     1980    10011    4                       CALL FTI$SPFILE ALTRET(JUSTALT);
     1981    10012    4                       F$DCB.ARS = 1;
     1982    10013    4                       CALL FTI$SPREC ALTRET(JUSTALT); /*PS* * ^ EOX             */
     1983    10014    4                       CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);
     1984    10015    4                       IF F$DCB.ARS < 80
     1985    10016    4                           OR ( LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOV1'
     1986    10017    4                           AND LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOF1' )
     1987    10018    5                       THEN DO;            /* Where are we?                      */
     1988    10019    5                          B$JIT.ERR = E_POSERR; /*E* ERROR: FTL-E$POSERR */
     1989    10020    5                          FT$DDT.POSLOST = %YES#;
     1990    10021    5                          ALTRETURN;
     1991    10022    5                          END;
     1992    10023    4                       F$DCB.ARS = 1;      /* Position past EOx label group      */
     1993    10024    4                       CALL FTI$SPFILE ALTRET(JUSTALT);
     1994    10025    4                       CALL CHARBIN( THISFSN, LBL1$->FT$LBL1.FSEQU_NUM );
     1995    10026    4                       FT$DDT.FSN = THISFSN; /* Remember position                */
     1996    10027    4                       IF LBL1$->FT$ANYLBL.LABEL_TYPE = 'EOF1'
     1997    10028    5                       THEN DO;            /* End of file/end of tape            */
     1998    10029    5                          FT$DDT.POS = FTP_HDR#;
     1999    10030    5                          RETURN;          /* End of tape                        */
     2000    10031    5                          END;
     2001    10032    4                       FT$DDT.POS = FTP_EOV#;
     2002    10033    4                       CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(JUSTALT);
     2003    10034    4                       DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     2004    10035    4                       IF FT$DDT.SCRTCH THEN RETURN;
     2005    10036    4                       END;
     2006    10037    4                    ELSE DO;               /* Not end of tape                    */
     2007    10038    4                       CALL FTL_CHKLBL( 'HDR1', LBL1$ ) ALTRET(JUSTALT);
     2008    10039    4                       CALL CHARBIN( THISFSN, LBL1$->FT$LBL1.FSEQU_NUM );
     2009    10040    4                       FT$DDT.FSN = THISFSN;
     2010    10041    4                       F$DCB.ARS = 3;      /* Skip to next HDR1                  */
     2011    10042    4                       CALL FTI$SPFILE ALTRET(JUSTALT);
     2012    10043    4                       END;
     2013    10044    3                    END;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:65   
     2014    10045    2                 END;
     2015    10046        /*********************************************************************/
     2016    10047        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:66   
     2017    10048        /*********************************************************************/
     2018    10049    1   FTL$SPF:   ENTRY(THELBL) ALTRET;
     2019    10050        /*F*     NAME: FTL$SPF
     2020    10051              PURPOSE: Position to the next beginning-of-file in the tape set,
     2021    10052                       when the last close left the tape positioned somewhere
     2022    10053                       in the middle of the file.
     2023    10054         ***/
     2024    10055
     2025    10056        /********************/
     2026    10057
     2027    10058    1              CALL FTL_LBLINIT ALTRET(JUSTALT);
     2028    10059    2              DO WHILE(FT$DDT.POS = FTP_BOD#); /* Space to next file mark.       */
     2029    10060    2                 F$DCB.ARS = 65500;
     2030    10061    2                 CALL FTI$SPREC ALTRET(JUSTALT);
     2031    10062    2                 IF F$DCB.TYC.EOF(1) THEN
     2032    10063    2                    FT$DDT.POS = FTP_UND#;
     2033    10064    2                 END;
     2034    10065    1              CALL FTL_CHKEOX ALTRET(JUSTALT); /* Verify EOF/EOV label.          */
     2035    10066    1              CALL CHARBIN(SAVFSN,LBL1$->FT$LBL1.FSEQU_NUM); /* Get real FSN.    */
     2036    10067    1              IF NOT F$DCB.EBCDIC THEN
     2037    10068    1                 CALL CHARBIN(SAVVOL,LBL1$->FT$LBL1.FSECT); /* Get real FSECT.   */
     2038    10069    1              B$JIT.ERR = '0'B;            /* Ignore block count error.          */
     2039    10070    2              DO WHILE(THELBL ~= 'EOF');   /* Find the last FSECT of the file.   */
     2040    10071    3                 IF NOT F$DCB.TYC.EOF(1) THEN DO;
     2041    10072    3                    F$DCB.ARS = 1;
     2042    10073    3                    CALL FTI$SPFILE ALTRET(JUSTALT);
     2043    10074    3                    END;
     2044    10075    2                 FT$DDT.POS = FTP_EOV#;
     2045    10076    2                 F$DCB.SEZ_OK = %NO#;
     2046    10077    2                 CALL FTR$CHNGVOL(F$DCB.VOL+1) ALTRET(JUSTALT);
     2047    10078    2                 DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     2048    10079    2                 CALL FTL_GETFSN ALTRET(JUSTALT);
     2049    10080    3                 IF NOT F$DCB.EBCDIC THEN DO;
     2050    10081    4                    IF NOT F$DCB.IGNOREFSN AND (THISFSN ~= SAVFSN OR THISFSECT ~=
             10081                             SAVVOL + 1) THEN DO;
     2051    10082    4                       B$JIT.ERR = E_VOLORDER;
     2052    10083    4                       ALTRETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:67   
     2053    10084    4                       END;
     2054    10085    3                    SAVVOL = THISFSECT;
     2055    10086    3                    END;
     2056    10087    3                 ELSE DO;
     2057    10088    4                    IF NOT F$DCB.IGNOREFSN AND THISFSN ~= SAVFSN THEN DO;
     2058    10089    4                       B$JIT.ERR = E_VOLORDER;
     2059    10090    4                       ALTRETURN;
     2060    10091    4                       END;
     2061    10092    3                    END;
     2062    10093    2                 F$DCB.ARS = 2;
     2063    10094    2                 CALL FTI$SPFILE ALTRET(JUSTALT); /* Position to end of that FSECT. */
     2064    10095    2                 CALL FTL_CHKEOX ALTRET(JUSTALT); /* Verify EOF/EOV label.       */
     2065    10096    2                 B$JIT.ERR = '0'B;         /* Ignore block count error.          */
     2066    10097    2                 END;
     2067    10098    1              F$DCB.ARS = 1;
     2068    10099    1              CALL FTI$SPFILE ALTRET(JUSTALT); /* Position to HDR1.              */
     2069    10100    1              IF NOT F$DCB.IGNOREFSN THEN
     2070    10101    1                 FT$DDT.FSN = SAVFSN;      /* FSN of previous file.              */
     2071    10102    1              FT$DDT.POS = FTP_HDR#;
     2072    10103    1              RETURN;
     2073    10104
     2074    10105        /*********************************************************************/
     2075    10106        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:68   
     2076    10107        /*********************************************************************/
     2077    10108    1   FTL_GETNXTHDR: PROC ALTRET;
     2078    10109        /*F*     NAME: FTL_GETNXTHDR
     2079    10110                 PURPOSE: Find next HDR1.
     2080    10111         ***/
     2081    10112
     2082    10113        /********************/
     2083    10114
     2084    10115         /***
     2085    10116          *** If at beginning of volume get next HDR1.
     2086    10117          ***/
     2087    10118
     2088    10119    2              LBL1$->FT$ANYLBL.LABEL_TYPE = 'VOL1'; /* Init HDR1 search          */
     2089    10120    2              IF FT$DDT.POS = FTP_BOV#
     2090    10121    3              THEN DO;                     /* At BOV                             */
     2091    10122    3                 IF NOT FT$DDT.ANST
     2092    10123    4                 THEN DO;                  /* Must be PO type tape               */
     2093    10124    4                    F$DCB.ARS = 1;
     2094    10125    4                    CALL FTI$SPFILE ALTRET(JUSTALT); /* Skip to HDR1             */
     2095    10126    4                    CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT); /* Get HDR1        */
     2096    10127    4                    END;
     2097    10128    4                 ELSE DO;                  /* Find first HDR1                    */
     2098    10129    4                    F$DCB.TYC(1) = '0'B;
     2099    10130    5                    DO WHILE(NOT F$DCB.TYC(1) AND LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'HDR1'
             10130                             );
     2100    10131    5                       CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT); /* Get next label */
     2101    10132    5                       END;
     2102    10133    4                    END;
     2103    10134    3                 END;
     2104    10135    2              ELSE CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT); /* Must be at HDR1  */
     2105    10136    2              IF NOT F$DCB.TYC(1)
     2106    10137    2              THEN CALL FTL_CHKLBL( 'HDR1', LBL1$ ) ALTRET(JUSTALT);
     2107    10138    2              FT$DDT.POS = FTP_UND#;       /* Not at BOV or HDR anymore          */
     2108    10139    2              RETURN;
     2109    10140
     2110    10141    2   JUSTALT:   ;
     2111    10142    2              ALTRETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:69   
     2112    10143
     2113    10144    2      END FTL_GETNXTHDR;
     2114    10145        /*********************************************************************/
     2115    10146        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:70   
     2116    10147        /*********************************************************************/
     2117    10148    1   FTL_CHKEOX: PROC ALTRET;
     2118    10149        /*F*     NAME: FTL_CHKEOX
     2119    10150                 PURPOSE: Process EOx1 label.
     2120    10151         ***/
     2121    10152
     2122    10153        /********************/
     2123    10154
     2124    10155         /***
     2125    10156          *** Read label...it must have proper size and be EOF or EOV.
     2126    10157          ***/
     2127    10158
     2128    10159    2              CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);
     2129    10160    2              THELBL = LBL1$->FT$ULBL.LABEL_ID; /* Return label id               */
     2130    10161    2              IF F$DCB.ARS < 80 OR (THELBL ~= 'EOF' AND THELBL ~= 'EOV') OR
     2131    10162    3                  LBL1$->FT$LBL1.LABEL_NUM ~= '1' THEN DO;
     2132    10163                                                /* Expected EOF/EOV label not present */
     2133    10164    3                 B$JIT.ERR = E_POSERR; /*E* ERROR: FTL-E$POSERR */
     2134    10165    3                 FT$DDT.POSLOST = %YES#;
     2135    10166    3                 ALTRETURN;
     2136    10167    3                 END;
     2137    10168    3              IF F$DCB.OLDIOERR ~= 0 AND NOT F$DCB.IGNOREFSN THEN DO;
             10168                       /* Had an I/O error on this file. */
     2138    10169    3                 CALL CHARBIN(N,LBL1$->FT$LBL1.FSEQU_NUM);
     2139    10170    4                 IF F$DCB.FSN < N THEN DO; /* Was a file mark hit?               */
     2140    10171    4                    B$JIT.ERR = E_WRONGFILE; /*E* FTL-E$WRONGFILE */
     2141    10172    4                    ALTRETURN;
     2142    10173    4                    END;
     2143    10174    3                 END;
     2144    10175    2              ELSE                         /* Don't verify block count if we had */
     2145    10176                                              /* an I/O error, since it will probably */
     2146    10177                                                /* always fail.                       */
     2147    10178    2                 CALL FTL_CHKBLKCNT;       /* Check block count error            */
     2148    10179    2              RETURN;
     2149    10180
     2150    10181    2   JUSTALT:   ;
     2151    10182    2              ALTRETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:71   
     2152    10183
     2153    10184    2      END FTL_CHKEOX;
     2154    10185        /**********************************************************************/
     2155    10186        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:72   
     2156    10187        /**********************************************************************/
     2157    10188    1   FTL_CHKBLKCNT: PROC;
     2158    10189        /*F*     NAME: FTL_CHKBLKCNT
     2159    10190                 PURPOSE: Check for block count error.
     2160    10191         ***/
     2161    10192
     2162    10193        /********************/
     2163    10194
     2164    10195
     2165    10196         /***
     2166    10197          *** Have EOF1 or EOV1 label.  Check block count.
     2167    10198          ***/
     2168    10199
     2169    10200    2              N = F$DCB.PRECNO;            /* Get data block count               */
     2170    10201    2              IF NOT F$DCB.AFTRBLK THEN
     2171    10202    2                 N = N - 1;                /* Don't count unread  block          */
     2172    10203    2              IF F$DCB.TAPTYP.CP6F AND F$DCB.FSECT = 1
     2173    10204    2              THEN N = N + 1;              /* Account for FIT (if any)           */
     2174    10205    2              CALL CHARBIN( I, LBL1$->FT$LBL1.BLK_CNT ); /* Get block count      */
     2175    10206    2              IF N ~= I
     2176    10207         /*E* ERROR: FTL-E$BLKCNT */
     2177    10208    2              THEN B$JIT.ERR = E_BLKCNT;
     2178    10209    2              RETURN;
     2179    10210
     2180    10211    2      END FTL_CHKBLKCNT;
     2181    10212        /*********************************************************************/
     2182    10213        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:73   
     2183    10214        /*********************************************************************/
     2184    10215    1   FTL_LBLINIT: PROC ALTRET;
     2185    10216        /*F*    NAME: FTL_LBLINIT
     2186    10217                PURPOSE: Find label FPOOL buffer for label write.
     2187    10218         ***/
     2188    10219
     2189    10220        /********************/
     2190    10221
     2191    10222         /***
     2192    10223          *** Initialize pointers.
     2193    10224          ***/
     2194    10225
     2195    10226    2              JDCB$ = B$JIT.DCB$;          /* Get pointer to DCB                 */
     2196    10227    2              DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
             10227                       /* Get pointer to DDT entry */
     2197    10228    2              IF F$DCB.ASN = %DEVICE# THEN RETURN; /* No label FPOOL needed      */
     2198    10229
     2199    10230         /***
     2200    10231          *** An FPOOL buffer must be available to create the label in.
     2201    10232          ***/
     2202    10233
     2203    10234    2              I = F$DCB.LPOOL - 1;         /* Calc ix of label FPOOL buffer      */
     2204    10235    2              IF I >= 0
     2205    10236    3              THEN DO;     /* FPOOL buffer for label processing already obtained */
     2206    10237    3                 LBL1$ = FM$BUF$(F$DCB.BFR.BUFX(I)); /* Get pointer              */
     2207    10238    3                 LBL2$ = PINCRC( LBL1$, 80 ); /* Get pointer to second label     */
     2208    10239    3                 RETURN;
     2209    10240
     2210    10241    3                 END;
     2211    10242    3              DO I=0 TO 4;
     2212    10243    3                 IF F$DCB.BFR.BUFX(I) = 0
     2213    10244    4                 THEN DO;                  /* Found an FPOOL buffer              */
     2214    10245    4                    CALL FMD$GETBUF( I, 1, LBL1$ ); /* Get FPOOL buffer          */
     2215    10246    4                    LBL2$ = PINCRC( LBL1$, 80 ); /* Get pointer to second label  */
     2216    10247    4                    F$DCB.LPOOL = I + 1;   /* Remember label FPOOL buffer        */
     2217    10248    4                    RETURN;
     2218    10249    4                    END;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:74   
     2219    10250    3                 END;
     2220    10251
     2221    10252    2              B$JIT.ERR = E_NOFPOOL; /*E* ERROR: FTL-E$NOFPOOL */
     2222    10253    2              ALTRETURN;
     2223    10254
     2224    10255    2      END FTL_LBLINIT;
     2225    10256        /*********************************************************************/
     2226    10257
     2227    10258    1   JUSTALT:   ;
     2228    10259    1              ALTRETURN;
     2229    10260
     2230    10261    1   END FTL$LBLTAP;
     2231    10262        /*********************************************************************/

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:75   
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FT$RECS.:E05TOU  cannot be made into a system file and is referenced.
   FT$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FT$DDT.:E05TOU  is referenced.
   FT_SUBS.:E05TOU  is referenced.
   FM_BUF_R.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_PTRS_R.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FTL$LBLTAP.

   Procedure FTL$LBLTAP requires 3576 words for executable code.
   Procedure FTL$LBLTAP requires 42 words of local(AUTO) storage.

    No errors detected in file FTL$LBLTAP.:E05TSI    .

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:76   

 Object Unit name= FTL$LBLTAP                                 File name= FTL$LBLTAP.:E05TOU
 UTS= JUL 29 '97 17:41:04.80 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     31     37  FTL$LBLTAP
    2   Proc  even  none  3576   6770  FTL$LBLTAP
    3  RoData even  none    41     51  FTL$LBLTAP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        5  FTL$LBLTAP
     2      3          yes     yes      Std        0  FTL$VOL1
     2    130          yes     yes      Std        2  FTL$LBLS
     2   1125          yes     yes      Std        3  FTL$ULBLS
     2   1225          yes     yes      Std        3  FTL$GETULBLS
     2   1402          yes     yes      Std        5  FTL$CLOSE
     2   2000          yes     yes      Std        5  FTL$CVOL
     2   2567          yes     yes      Std        0  FTL$FINDFILE
     2   3305          yes     yes      Std        0  FTL$FINDSEQIBM
     2   3602          yes     yes      Std        0  FTL$FINDSEQ
     2   4342          yes     yes      Std        0  FTL$GETFSN
     2   4470          yes     yes      Std        0  FTL$FINDHDR1
     2   4646          yes     yes      Std        0  FTL$FINDNEXT
     2   5051          yes     yes      Std        1  FTL$EOF
     2   5647          yes     yes      Std        3  FTL$PBSN
     2   5773          yes     yes      Std        0  FTL$PEOS
     2   6214          yes     yes      Std        1  FTL$SPF
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:77   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       3 XUD$UTS_DIFF_SEC
 yes     yes           Std       0 FTW$TRNCOD
 yes     yes           Std       0 FTI$WRFM
         yes           Std       1 FMD$RELBUF
 yes     yes           Std       1 FTI$WRASCEBC
 yes     yes           Std       2 FTR$GETSN
 yes     yes           Std       2 FPO$WRITELBL
 yes     yes           Std       1 FTR$CHNGVOL
 yes     yes           Std       3 XUD$UTS_ADJ_25TH
 yes     yes           Std       2 UMT$JDATE
 yes     yes           Std       1 FTI$RDASCEBC
 yes     yes           Std       0 FTW$TRNCHLD
 yes     yes           Std       2 HFF$DSIZ
 yes     yes           Std       0 FTI$SPFILE
 yes     yes           Std       0 FPO$CLOSEIN
 yes     yes           Std       1 FPO$RDEOFLBL
 yes     yes           Std       1 FTR$CHNGVOLNR
 yes     yes           Std       0 FTW$CVOL
 yes     yes           Std       0 FTI$SPREC
 yes     yes           Std       0 FTI$REWIND
 yes     yes           Std       0 FPO$FINDSEQ
 yes     yes           Std       0 FPO$OPENIN
         yes           Std       3 FMD$GETBUF
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_5
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:78   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     S$CU$                                 M$UC                                  FM$BUF$
     N$DCT$$                               B$JIT$                                B_SITEINFO
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:79   


        1        1        /*M* FTL$LBLTAP label construction and processing routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* CRT=1,CTI=4,DCI=6,SQB,ECI=3,CSI=3,IPC,DIN=2,SDI=3 */
        8        8
        9        9        FTL$LBLTAP: PROC( THELBL, LBL$, NUM, ULBL$, UNUM ) ALTRET;

      9  2 000000   000000 700200 xent  FTL$LBLTAP   TSX0  ! X66_AUTO_5
         2 000001   000052 000005                    ZERO    42,5
         2 000002   000005 710000 2                  TRA     s:8291

       10       10
       11       11         /***
       12       12          *** INCLUDE files:
       13       13          ***/
       14       14
       15       15        %INCLUDE B$USER;
       16      231        %B$USERREFS;
       17      235        %INCLUDE B_PTRS_R;
       18      243        %INCLUDE CP_6;
       19     5802         %VLP_ULBL(FPTN=VLP_ULBL,STCLASS="BASED(LBL1$)");
       20     5816        %INCLUDE CP_6_SUBS;
       21     6356        %MACRO F$DCBBJ(BASED=BASED);
       22     6357        %INCLUDE F$DCB;
       23     6406        %MEND;
       24     6407         %F$DCBBJ(BASED="BASED(JDCB$)");
       25     6457        %INCLUDE F$JIT_C;
       26     6887        %INCLUDE F_ERRORS_C;
       27     7127        %INCLUDE FM_BUF_R;
       28     7136        %INCLUDE FT_SUBS;
       29     7216        %MACRO FT$DDTBD(BASED=BASED);
       30     7217        %INCLUDE FT$DDT;
       31     7278        %MEND;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:80   
       32     7279         %FT$DDTBD(BASED="BASED(DDDT$)");
       33     7341        %INCLUDE FT$LBLS;
       34     7609        %INCLUDE FT$RECS;
       35     7677        %INCLUDE NK$LDCT;
       36     7779        %INCLUDE NK_LDCT_R;
       37     7788         %NK$LDCT;
       38     7834        %INCLUDE XUD_UTS_M;
       39     7916         %XUD$UTS_ENTRIES;
       40     7948
       41     7949         /***
       42     7950          *** External routines:
       43     7951          ***/
       44     7952
       45     7953    1     DCL FMD$GETBUF ENTRY(3);              /* Get specified FPOOL buffer         */
       46     7954    1     DCL FMD$RELBUF ENTRY(1);              /* Release specified FPOOL buffer     */
       47     7955    1     DCL FPO$RDEOFLBL ENTRY(1) ALTRET;     /* Read EOF/EOV label from OD         */
       48     7956    1     DCL FPO$WRITELBL ENTRY(2) ALTRET;     /* Write labels to OD file            */
       49     7957    1     DCL FPO$FINDSEQ ENTRY ALTRET;         /* Position to OD file by seq number  */
       50     7958    1     DCL FPO$CLOSEIN ENTRY ALTRET;         /* Tell controller about FUN=IN close */
       51     7959    1     DCL FPO$OPENIN ENTRY ALTRET;          /* Tell controller about input open   */
       52     7960    1     DCL FTI$RDASC ENTRY(1) ALTRET;        /* Read ASCII into specified buffer   */
       53     7961    1    DCL FTI$RDASCEBC ENTRY(1) ALTRET; /* Read ASCII or EBCDIC into specified buffer */
       54     7962    1     DCL FTI$REWIND ENTRY ALTRET;          /* Rewind the tape                    */
       55     7963    1     DCL FTI$SPFILE ENTRY ALTRET;          /* Space DCB.ARS of files             */
       56     7964    1     DCL FTI$SPREC ENTRY ALTRET;           /* Space DCB.ARS of records           */
       57     7965    1     DCL FTI$WRASCEBC ENTRY(1) ALTRET; /* Write specified ASCII or EBCDIC buffer */
       58     7966    1     DCL FTI$WRFM ENTRY ALTRET;            /* Write file mark                    */
       59     7967    1     DCL FTR$CHNGVOL ENTRY(1) ALTRET;      /* Change to specified volume         */
       60     7968    1     DCL FTR$CHNGVOLNR ENTRY(1) ALTRET; /* Change to specified volume--no rewind */
       61     7969    1     DCL FTR$GETSN ENTRY(2) ALTRET;        /* Get specified serial number        */
       62     7970    1     DCL FTW$CVOL ENTRY ALTRET;            /* Volume change                      */
       63     7971    1     DCL FTW$TRNCHLD ENTRY ALTRET;    /* Trunc FPOOL buffer (if any) and hold it */
       64     7972    1     DCL FTW$TRNCOD ENTRY ALTRET;          /* Truncate optical disk file buffers */
       65     7973    1     DCL HFF$DSIZ ENTRY(2) ALTRET;         /* Calc size of segment               */
       66     7974    1     DCL SSS$SYSTIME ENTRY(1);             /* Return universal time              */
       67     7975    1     DCL UMT$JDATE ENTRY(2) ALTRET;     /* Convert universal time to Julian date */
       68     7976
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:81   
       69     7977         /***
       70     7978          *** SYMREF data:
       71     7979          ***/
       72     7980
       73     7981    1     DCL B$JIT$ PTR SYMREF;           /* J. Sheinberg says this needs no comment */
       74     7982    1     DCL B_TICSDAY UBIN SYMREF;            /* Number of universal time tics/day  */
       75     7983        %VLR_SITEINFO( FPTN=B_SITEINFO, STCLASS=SYMREF );
       76     8002
       77     8003         /***
       78     8004          *** Parameters:
       79     8005          ***/
       80     8006
       81     8007    1     DCL LBL$ PTR;                         /* Pointer to user label group        */
       82     8008    1     DCL NUM SBIN;                         /* Number of user labels in group     */
       83     8009    1     DCL THELBL CHAR(3);         /* Label type desired (HDR, EOF, EOV, UTL, UHL) */
       84     8010    1     DCL ULBL$ PTR;                        /* Pointer to second user label group */
       85     8011    1     DCL UNUM SBIN;                        /* Size of second label group         */
       86     8012
       87     8013         /***
       88     8014          *** AUTO data:
       89     8015          ***/
       90     8016
       91     8017    1     DCL DDDT$ PTR AUTO;                /* Pointer to DDT entry for DCB's device */
       92     8018    1     DCL JDCB$ PTR AUTO;                   /* Pointer to DCB                     */
       93     8019    1     DCL I SBIN AUTO;                      /* Indexing uses                      */
       94     8020    1     DCL J UBIN(36) AUTO;                  /* Used for UTS rounding              */
       95     8021    1     DCL LBL1$ PTR AUTO;                   /* Pointer to FPOOL buffer            */
       96     8022    1     DCL LBL2$ PTR AUTO;                   /* Pointer to second label in FPOOL   */
       97     8023    1     DCL LOOKDIR SBIN AUTO;                /* Direction that seq# searched for   */
       98     8024    1     DCL N SBIN AUTO;                      /* End of index range uses            */
       99     8025    1     DCL NBR_LBLS SBIN AUTO;               /* Number of labels to read/write     */
      100     8026    1     DCL NOT_TAPE_END BIT(1) ALIGNED AUTO; /* Set when tape end                  */
      101     8027    1     DCL SAVFSN SBIN AUTO;                 /* Saved file sequence number         */
      102     8028    1     DCL SAVVOL SBIN AUTO;                 /* Saved volume number                */
      103     8029    1     DCL SECTFIND BIT(1) AUTO;             /* Indicates find section of file     */
      104     8030    1     DCL SKIPS SBIN AUTO;                  /* Number of file marks to skip       */
      105     8031    1     DCL TEMP SBIN AUTO;                   /* For intermediate values            */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:82   
      106     8032    1     DCL TEMP$ PTR AUTO;                   /* TeMpOrArY pOiNtEr                  */
      107     8033    1     DCL THISFSECT SBIN AUTO;              /* FSECT of current file              */
      108     8034    1     DCL THISFSN SBIN AUTO;                /* FSN of current file                */
      109     8035    1     DCL SN CHAR(6) AUTO;                  /* Serial number                      */
      110     8036
      111     8037    1     DCL 1 DT1 AUTO UNAL,                  /* TEMP LOC. FOR CURRENT JULIAN DATE  */
      112     8038    1            2 CEN CHAR (1),                /* CENTURY INDICATOR                  */
      113     8039    1            2 JD_R CHAR (5),               /* JULIAN DATE                        */
      114     8040    1            2 JD REDEF JD_R,               /* JULIAN DATE (YYDDD)                */
      115     8041    1               3 YR CHAR (2),              /* YEAR                               */
      116     8042    1               3 DY CHAR (3);              /* DAY                                */
      117     8043
      118     8044         /***
      119     8045          *** BASED:
      120     8046          ***/
      121     8047
      122     8048    1     DCL NCHARS CHAR(N) BASED UNAL;
      123     8049    1     DCL ONE_WORD SBIN BASED CALIGNED;
      124     8050
      125     8051         /***
      126     8052          *** CONSTANT data:
      127     8053          ***/
      128     8054
      129     8055        %FT$ERR( ERRNAME=E_BADSPAN, MID='14'O, CODE=%E$BADSPAN, SEV=2 );
      130     8063        /*E*     ERROR: FTL-E$BADSPAN
      131     8064                 MESSAGE: Inconsistent spanning information% on %TA%
      132     8065                 MESSAGE1: Either the previous record segment indicated that the
      133     8066                           current segment should be a continuation or
      134     8067                           indicated that the current segment should begin the
      135     8068                           next record.
      136     8069                 DESCRIPTION: End of file hit while expecting continuing segment.
      137     8070         ***/
      138     8071
      139     8072        %FT$ERR( ERRNAME=E_BLKCNT, MID='14'O, CODE=%E$BLKCNT, SEV=2 );
      140     8080        /*E*     ERROR: FTL-E$BLKCNT-2
      141     8081                 MESSAGE: Inconsistent block count% for %TA%
      142     8082                 MESSAGE1: The accumulated block count did not match the
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:83   
      143     8083                           count specified in the end of file section labels.
      144     8084                 DESCRIPTION: The system accumulated block count is not the
      145     8085                    same as the block count in the EOV or EOF label.
      146     8086         ***/
      147     8087
      148     8088        %FT$ERR( ERRNAME=E_EOF, MID='14'O, CODE=%E$EOF, SEV=2 );
      149     8096        /*E*     ERROR: FTL-E$EOF-2
      150     8097                 MESSAGE: End of file% on %TA%
      151     8098                 MESSAGE1: The last record of the file has already been passed.
      152     8099                 DESCRIPTION: End of data hit on read.
      153     8100         ***/
      154     8101
      155     8102        %FT$ERR( ERRNAME=E_EOSET, MID='14'O, CODE=%E$EOSET, SEV=2 );
      156     8110        /*E*     ERROR: FTL-E$EOSET-2
      157     8111                 MESSAGE: End of volume set% on %TA%
      158     8112                 MESSAGE1: The last file of the volume set has already been passed.
      159     8113                 DESCRIPTION: Looking for file by file sequence number
      160     8114                    resulted in end of set.
      161     8115         ***/
      162     8116
      163     8117        %FT$ERR( ERRNAME=E_EOVOL, MID='14'O, CODE=%E$EOVOL, SEV=2 );
      164     8125        /*E*     ERROR: FTL-E$EOVOL-2
      165     8126                 MESSAGE: End of volume% on %TA%
      166     8127                 MESSAGE1: End of volume with user-requested CVOL notification.
      167     8128                 DESCRIPTION: End of volume hit on read--user requested CVOL handling.
      168     8129         ***/
      169     8130
      170     8131        %FT$ERR( ERRNAME=E_EOVOLS, MID='14'O, CODE=%E$EOVOLS, SEV=2 );
      171     8139        /*E*     ERROR: FTL-E$EOVOLS-2
      172     8140                 MESSAGE: End of volume...partial record% on %TA%
      173     8141                 MESSAGE1: The last record (segment) of the current volume
      174     8142                           indicates that the current record has not yet ended
      175     8143                           but you asked for CVOL control and you got it!
      176     8144                 DESCRIPTION: End of volume hit on read--user requested CVOL handling.
      177     8145         ***/
      178     8146
      179     8147        %FT$ERR( ERRNAME=E_FSNERR, MID='14'O, CODE=%E$FSNERR, SEV=2 );
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:84   
      180     8155        /*E*     ERROR: FTL-E$FSNERR-2
      181     8156                 MESSAGE: File sequence number error% on %TA%
      182     8157                 MESSAGE1: File specified by sequence number was not found
      183     8158                    because file sequence numbers in volume set were out of order.
      184     8159         ***/
      185     8160
      186     8161        %FT$ERR( ERRNAME=E_NOFILE, MID='14'O, CODE=%E$NOFILE, SEV=2 );
      187     8169        /*E*     ERROR: FTL-E$NOFILE-2
      188     8170                 MESSAGE: File% %TA% specified in DCB% %DC% was not found
      189     8171         ***/
      190     8172
      191     8173        %FT$ERR( ERRNAME=E_NOFPOOL, MID='14'O, CODE=%E$NOFPOOL, SEV=2 );
      192     8181        /*E*     ERROR: FTL-E$NOFPOOL-2
      193     8182                 MESSAGE: No FPOOL buffer% for %TA%
      194     8183                 MESSAGE1: The are no FPOOL buffers for label processing.
      195     8184                 DESCRIPTION: An attempt to find an available FPOOL buffer for
      196     8185                    label processing failed.
      197     8186         ***/
      198     8187        %FT$ERR( ERRNAME=E_POSERR, MID='14'O, CODE=%E$POSERR, SEV=2 );
      199     8195        /*E*     ERROR: FTL-E$POSERR-2
      200     8196                 MESSAGE: Illegal ANS tape label or file structure% on %TA%
      201     8197                 MESSAGE1: Error% on %TA% due to incorrect tape structure or
      202     8198                    bad or non-standard tape labels or file marks that are not
      203     8199                    what they are supposed to be.
      204     8200                 DESCRIPTION: An unexpected label was encountered.
      205     8201         ***/
      206     8202
      207     8203        %FT$ERR( ERRNAME=E_SECTERR, MID='14'O, CODE=%E$SECTERR, SEV=2 );
      208     8211        /*E*     ERROR: FTL-E$SECTERR-2
      209     8212                 MESSAGE: File section missing% for %TA%
      210     8213                 MESSAGE1: A file section which should be present can not
      211     8214                           be found in the volume set as described in the
      212     8215                           serial number list.
      213     8216                 DESCRIPTION: The previous or next file section couldn't
      214     8217                    be found.
      215     8218         ***/
      216     8219
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:85   
      217     8220        %FT$ERR( ERRNAME=E_TAPBRK, MID='14'O, CODE=%E$TAPBRK, SEV=2 );
      218     8228        /*E*     ERROR: FTL-E$TAPBRK-2
      219     8229                 MESSAGE: Break or ctrl-Y during tape file search% for DCB %DC%
      220     8230                 MESSAGE1: A tape file search (by name or sequence number) was
      221     8231                    interrupted by a break or ctrl-Y.  The search is aborted.
      222     8232         ***/
      223     8233
      224     8234        %FT$ERR( ERRNAME=E_VOLORDER, MID='14'O, CODE=%E$VOLORDER, SEV=2 );
      225     8242        /*E*     ERROR: FTL-E$VOLORDER-2
      226     8243                 MESSAGE: Volume missing or out of order% for %TA%
      227     8244                 MESSAGE1: The volume with expected file sequence numbers or file
      228     8245                           section cannot be found in the volume set as described
      229     8246                           in the serial number list.
      230     8247                 DESCRIPTION: Either an attempt to find a file by its sequence number
      231     8248                    failed even though files with higher and lower sequence numbers
      232     8249                    were found, or an attempt to file a file section failed although
      233     8250                    lower and higher file sections were found.
      234     8251         ***/
      235     8252
      236     8253        %FT$ERR( ERRNAME=E_VOLOUT, MID='14'O, CODE=%E$VOLOUT, SEV=2 );
      237     8261        /*E*     ERROR: FTL-E$VOLOUT-2
      238     8262                 MESSAGE: No next volume% on %TA%
      239     8263                 DESCRIPTION: An output CVOL was attempted with no next volume.
      240     8264         ***/
      241     8265
      242     8266        %FT$ERR( ERRNAME=E_WRONGFILE, MID='14'O, CODE=%E$WRONGFILE, SEV=0 );
      243     8274        /*E*     ERROR: FTL-E$WRONGFILE
      244     8275                 MESSAGE: File changed after I/O error% on %TA%.
      245     8276                 MESSAGE1: The earlier I/O error% on %TA% destroyed a file mark;
      246     8277                           data read after the error was from the next file on the
      247     8278                           tape.
      248     8279         ***/
      249     8280
      250     8281        /*********************************************************************/
      251     8282        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:86   
      252     8283        /*********************************************************************/
      253     8284    1   FTL$VOL1: ENTRY ALTRET;

   8284  2 000003   000000 700200 xent  FTL$VOL1     TSX0  ! X66_AUTO_5
         2 000004   000052 000005                    ZERO    42,5

      254     8285        /*F*    NAME: FTL$VOL1
      255     8286                PURPOSE: Construct and write VOL1.
      256     8287         ***/
      257     8288
      258     8289        /********************/
      259     8290
      260     8291    1           CALL FTL_LBLINIT ALTRET(JUSTALT); /* Initialize for label writing     */

   8291  2 000005   006665 701000 2                  TSX1    FTL_LBLINIT
         2 000006   006767 702000 2                  TSX2    JUSTALT

      261     8292    1           LBL1$->FT$BLBL = ' ';           /* Initialize to blanks               */

   8292  2 000007   200014 470500                    LDP0    LBL1$,,AUTO
         2 000010   040100 100400                    MLR     fill='040'O
         2 000011   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000012   000000 000120                    ADSC9   0,,PR0                   cn=0,n=80

      262     8293    1           LBL1$->FT$VOL1.LABEL_TYPE = 'VOL1';

   8293  2 000013   200014 470500                    LDP0    LBL1$,,AUTO
         2 000014   040100 100400                    MLR     fill='040'O
         2 000015   000017 000004 1                  ADSC9   E_WRONGFILE+1            cn=0,n=4
         2 000016   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4

      263     8294
      264     8295         /***
      265     8296          *** Set owner account and SNs.
      266     8297          ***/
      267     8298
      268     8299    1           LBL1$->FT$VOL1.SN = F$DCB.PSN;  /* Set SN                             */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:87   

   8299  2 000017   200011 470500                    LDP0    JDCB$,,AUTO
         2 000020   200014 471500                    LDP1    LBL1$,,AUTO
         2 000021   040100 100500                    MLR     fill='040'O
         2 000022   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 000023   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6

      269     8300    1           LBL1$->FT$VOL1.ACCOUNT = FT$DDT.ACCT; /* Set owner account            */

   8300  2 000024   200010 471500                    LDP1    DDDT$,,AUTO
         2 000025   200014 473500                    LDP3    LBL1$,,AUTO
         2 000026   040100 100500                    MLR     fill='040'O
         2 000027   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         2 000030   300011 200010                    ADSC9   9,,PR3                   cn=1,n=8

      270     8301    1           LBL1$->FT$VOL1.SYSTEM_CODE.ID = 'CP-6';

   8301  2 000031   200014 473500                    LDP3    LBL1$,,AUTO
         2 000032   040100 100400                    MLR     fill='040'O
         2 000033   000020 000004 1                  ADSC9   E_WRONGFILE+2            cn=0,n=4
         2 000034   300006 000004                    ADSC9   6,,PR3                   cn=0,n=4

      271     8302    1           LBL1$->FT$VOL1.SYSTEM_CODE.VERSION = B_SITEINFO.VERSION#;

   8302  2 000035   200014 473500                    LDP3    LBL1$,,AUTO
         2 000036   040100 100400                    MLR     fill='040'O
         2 000037   000064 000004 xsym               ADSC9   B_SITEINFO+52            cn=0,n=4
         2 000040   300007 000011                    ADSC9   7,,PR3                   cn=0,n=9

      272     8303    1           LBL1$->FT$VOL1.SYSTEM = 'CP-6';

   8303  2 000041   200014 473500                    LDP3    LBL1$,,AUTO
         2 000042   040100 100400                    MLR     fill='040'O
         2 000043   000020 000004 1                  ADSC9   E_WRONGFILE+2            cn=0,n=4
         2 000044   300013 200006                    ADSC9   11,,PR3                  cn=1,n=6

      273     8304    2           DO CASE(FT$DDT.VOLACCESS);      /* Determine access control           */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:88   

   8304  2 000045   100007 720100                    LXL0    7,,PR1
         2 000046   000003 360003                    ANX0    3,DU
         2 000047   000004 100003                    CMPX0   4,DU
         2 000050   000052 602010 2                  TNC     s:8304+5,X0
         2 000051   000075 710000 2                  TRA     s:8312
         2 000052   000056 710000 2                  TRA     s:8306
         2 000053   000056 710000 2                  TRA     s:8306
         2 000054   000063 710000 2                  TRA     s:8308
         2 000055   000070 710000 2                  TRA     s:8310

      274     8305    2              CASE(0,%ALL#);

      275     8306    2                 LBL1$->FT$VOL1.ACCESS = ' '; /* Everyone read/write             */

   8306  2 000056   200014 473500                    LDP3    LBL1$,,AUTO
         2 000057   040100 100400                    MLR     fill='040'O
         2 000060   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000061   300002 400001                    ADSC9   2,,PR3                   cn=2,n=1
         2 000062   000101 710000 2                  TRA     s:8314

      276     8307    2              CASE(%IN#);

      277     8308    2                 LBL1$->FT$VOL1.ACCESS = 'I'; /* Only owner can write            */

   8308  2 000063   200014 473500                    LDP3    LBL1$,,AUTO
         2 000064   040100 100400                    MLR     fill='040'O
         2 000065   000000 000001 3                  ADSC9   0                        cn=0,n=1
         2 000066   300002 400001                    ADSC9   2,,PR3                   cn=2,n=1
         2 000067   000101 710000 2                  TRA     s:8314

      278     8309    2              CASE(%NONE#);

      279     8310    2                 LBL1$->FT$VOL1.ACCESS = 'N'; /* Only owner can read or write    */

   8310  2 000070   200014 473500                    LDP3    LBL1$,,AUTO
         2 000071   040100 100400                    MLR     fill='040'O
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:89   
         2 000072   000001 000001 3                  ADSC9   1                        cn=0,n=1
         2 000073   300002 400001                    ADSC9   2,,PR3                   cn=2,n=1
         2 000074   000101 710000 2                  TRA     s:8314

      280     8311    2              CASE(ELSE);

      281     8312    2                 LBL1$->FT$VOL1.ACCESS = ' '; /* Owner strange                   */

   8312  2 000075   200014 473500                    LDP3    LBL1$,,AUTO
         2 000076   040100 100400                    MLR     fill='040'O
         2 000077   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000100   300002 400001                    ADSC9   2,,PR3                   cn=2,n=1

      282     8313    2              END;

      283     8314    1           LBL1$->FT$VOL1.VERSION = '3';

   8314  2 000101   200014 473500                    LDP3    LBL1$,,AUTO
         2 000102   040100 100400                    MLR     fill='040'O
         2 000103   000002 000001 3                  ADSC9   2                        cn=0,n=1
         2 000104   300023 600001                    ADSC9   19,,PR3                  cn=3,n=1

      284     8315    1           FT$DDT.FRSTFSN = F$DCB.FSN - 1; /* Set FSN of first file              */

   8315  2 000105   000034 220100                    LDX0    28,,PR0
         2 000106   777777 621010                    EAX1    -1,X0
         2 000107   100005 441100                    SXL1    5,,PR1

      285     8316    1           FT$DDT.FRSTFSECT = F$DCB.FSECT; /* Set FSECT of first file            */

   8316  2 000110   000077 220100                    LDX0    63,,PR0
         2 000111   100007 740100                    STX0    7,,PR1

      286     8317
      287     8318         /***
      288     8319          *** Convert label to EBCDIC (if necessary) and write it.
      289     8320          ***/
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:90   
      290     8321
      291     8322    1           IF F$DCB.IASN ~= %OD# THEN

   8322  2 000112   000103 236100                    LDQ     67,,PR0
         2 000113   000777 376007                    ANQ     511,DL
         2 000114   000012 116007                    CMPQ    10,DL
         2 000115   000124 600000 2                  TZE     s:8324

      292     8323    1              CALL FTI$WRASCEBC (LBL1$) ALTRET (JUSTALT);

   8323  2 000116   200014 633500                    EPPR3   LBL1$,,AUTO
         2 000117   200046 453500                    STP3    @ALBL$+2,,AUTO
         2 000120   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 000121   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000122   000000 701000 xent               TSX1    FTI$WRASCEBC
         2 000123   006767 702000 2                  TSX2    JUSTALT

      293     8324    1           FT$DDT.POS = FTP_UND#;          /* Not at BOV anymore                 */

   8324  2 000124   200010 470500                    LDP0    DDDT$,,AUTO
         2 000125   000003 236000 3                  LDQ     3
         2 000126   000006 356100                    ANSQ    6,,PR0

      294     8325    1           RETURN;

   8325  2 000127   000000 702200 xent               TSX2  ! X66_ARET

      295     8326
      296     8327        /*********************************************************************/
      297     8328        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:91   
      298     8329        /*********************************************************************/
      299     8330    1   FTL$LBLS: ENTRY( THELBL, LBL$ ) ALTRET;

   8330  2 000130   000000 700200 xent  FTL$LBLS     TSX0  ! X66_AUTO_5
         2 000131   000052 000005                    ZERO    42,5

      300     8331        /*F*    NAME: FTL$LBLS
      301     8332                PURPOSE: Construct and write HDRs, EOVs, or EOFs.
      302     8333         ***/
      303     8334
      304     8335        /********************/
      305     8336
      306     8337    1           CALL FTL_LBLINIT ALTRET(JUSTALT); /* Initialize for label writing     */

   8337  2 000132   006665 701000 2                  TSX1    FTL_LBLINIT
         2 000133   006767 702000 2                  TSX2    JUSTALT

      307     8338    1           FT$DDT.FMCNT = 0;            /* No file marks written since last HDR1 */

   8338  2 000134   000000 220003                    LDX0    0,DU
         2 000135   200010 470500                    LDP0    DDDT$,,AUTO
         2 000136   000006 740100                    STX0    6,,PR0

      308     8339    1           LBL1$->FT$BLBL = ' ';           /* Initialize to blanks               */

   8339  2 000137   200014 471500                    LDP1    LBL1$,,AUTO
         2 000140   040100 100400                    MLR     fill='040'O
         2 000141   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000142   100000 000120                    ADSC9   0,,PR1                   cn=0,n=80

      309     8340    1           LBL1$->FT$LBL1.LABEL_ID = THELBL; /* Insert label type                */

   8340  2 000143   200003 471500                    LDP1    @THELBL,,AUTO
         2 000144   200014 473500                    LDP3    LBL1$,,AUTO
         2 000145   040100 100500                    MLR     fill='040'O
         2 000146   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 000147   300000 000003                    ADSC9   0,,PR3                   cn=0,n=3
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:92   

      310     8341    1           LBL1$->FT$LBL1.LABEL_NUM = '1'; /* LBL1                               */

   8341  2 000150   200014 473500                    LDP3    LBL1$,,AUTO
         2 000151   040100 100400                    MLR     fill='040'O
         2 000152   000004 000001 3                  ADSC9   4                        cn=0,n=1
         2 000153   300000 600001                    ADSC9   0,,PR3                   cn=3,n=1

      311     8342
      312     8343         /***
      313     8344          *** Set up rest of LBL1 with data from DCB.
      314     8345          ***/
      315     8346
      316     8347    1           LBL1$->FT$LBL1.GENERATION = '0001'; /* Default CP-6 generation        */

   8347  2 000154   200014 473500                    LDP3    LBL1$,,AUTO
         2 000155   040100 100400                    MLR     fill='040'O
         2 000156   000021 000004 1                  ADSC9   E_WRONGFILE+3            cn=0,n=4
         2 000157   300010 600004                    ADSC9   8,,PR3                   cn=3,n=4

      317     8348    1           LBL1$->FT$LBL1.FVERSION = '00'; /* Default CP-6 version               */

   8348  2 000160   200014 473500                    LDP3    LBL1$,,AUTO
         2 000161   040100 100400                    MLR     fill='040'O
         2 000162   000021 000002 1                  ADSC9   E_WRONGFILE+3            cn=0,n=2
         2 000163   300011 600002                    ADSC9   9,,PR3                   cn=3,n=2

      318     8349    1           IF THELBL = 'HDR'

   8349  2 000164   040000 106500                    CMPC    fill='040'O
         2 000165   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 000166   000022 000003 1                  ADSC9   E_WRONGFILE+4            cn=0,n=3
         2 000167   000172 601000 2                  TNZ     s:8352

      319     8350    1           THEN N = 0;                     /* Zero block count in HDR1           */

   8350  2 000170   200017 450100                    STZ     N,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:93   
         2 000171   000211 710000 2                  TRA     s:8358

      320     8351    2           ELSE DO;

      321     8352    2              N = F$DCB.PRECNO;

   8352  2 000172   200011 473500                    LDP3    JDCB$,,AUTO
         2 000173   300072 235100                    LDA     58,,PR3
         2 000174   200017 755100                    STA     N,,AUTO

      322     8353    2              IF NOT F$DCB.AFTRBLK

   8353  2 000175   300064 236100                    LDQ     52,,PR3
         2 000176   000002 316007                    CANQ    2,DL
         2 000177   000202 601000 2                  TNZ     s:8355

      323     8354    2              THEN N = N - 1;              /* Don't count unwritten block        */

   8354  2 000200   000001 336007                    LCQ     1,DL
         2 000201   200017 056100                    ASQ     N,,AUTO

      324     8355    2              IF F$DCB.FSECT = 1 AND F$DCB.TAPTYP.CP6F

   8355  2 000202   300077 221100                    LDX1    63,,PR3
         2 000203   000001 101003                    CMPX1   1,DU
         2 000204   000211 601000 2                  TNZ     s:8358
         2 000205   300067 236100                    LDQ     55,,PR3
         2 000206   000200 316003                    CANQ    128,DU
         2 000207   000211 600000 2                  TZE     s:8358

      325     8356    2              THEN N = N + 1;              /* Count FIT as tape block            */

   8356  2 000210   200017 054100                    AOS     N,,AUTO

      326     8357    2              END;

      327     8358    1           CALL BINCHAR( LBL1$->FT$LBL1.BLK_CNT, N );
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:94   

   8358  2 000211   200014 473500                    LDP3    LBL1$,,AUTO
         2 000212   000100 301500                    BTD
         2 000213   200017 000004                    NDSC9   N,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         2 000214   300015 430006                    NDSC9   13,,PR3                  cn=2,s=nosgn,sf=0,n=6

      328     8359                                                /* Set block count                    */
      329     8360    1           LBL1$->FT$LBL1.FILE_ID = F$DCB.NAME.C17.CC; /* Set file name          */

   8360  2 000215   200011 474500                    LDP4    JDCB$,,AUTO
         2 000216   040100 100500                    MLR     fill='040'O
         2 000217   400010 200021                    ADSC9   8,,PR4                   cn=1,n=17
         2 000220   300001 000021                    ADSC9   1,,PR3                   cn=0,n=17

      330     8361    1           CALL FTR$GETSN(1,ADDR(LBL1$->FT$LBL1.FSETID)); /* Set file set id     */

   8361  2 000221   200014 236100                    LDQ     LBL1$,,AUTO
         2 000222   000005 036000 3                  ADLQ    5
         2 000223   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 000224   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 000225   200051 453500                    STP3    @ALBL$+5,,AUTO
         2 000226   000006 236000 3                  LDQ     6
         2 000227   200050 756100                    STQ     @ALBL$+4,,AUTO
         2 000230   200050 630500                    EPPR0   @ALBL$+4,,AUTO
         2 000231   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000232   000000 701000 xent               TSX1    FTR$GETSN
         2 000233   000000 011000                    NOP     0

      331     8362                                                /* Set initial serial number          */
      332     8363    1           IF F$DCB.IASN = %OD# THEN

   8363  2 000234   200011 470500                    LDP0    JDCB$,,AUTO
         2 000235   000103 236100                    LDQ     67,,PR0
         2 000236   000777 376007                    ANQ     511,DL
         2 000237   000012 116007                    CMPQ    10,DL
         2 000240   000252 601000 2                  TNZ     s:8366

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:95   
      333     8364    1              CALL BINCHAR( LBL1$->FT$LBL1.ODFSEQU_NUM, F$DCB.FSN );

   8364  2 000241   000034 236100                    LDQ     28,,PR0
         2 000242   000022 772000                    QRL     18
         2 000243   000000 235003                    LDA     0,DU
         2 000244   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 000245   200014 471500                    LDP1    LBL1$,,AUTO
         2 000246   000100 301500                    BTD
         2 000247   200046 000010                    NDSC9   @ALBL$+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         2 000250   100022 230006                    NDSC9   18,,PR1                  cn=1,s=nosgn,sf=0,n=6
         2 000251   000262 710000 2                  TRA     s:8368

      334     8365    1           ELSE
      335     8366    1              CALL BINCHAR( LBL1$->FT$LBL1.FSEQU_NUM, F$DCB.FSN );

   8366  2 000252   000034 236100                    LDQ     28,,PR0
         2 000253   000022 772000                    QRL     18
         2 000254   000000 235003                    LDA     0,DU
         2 000255   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 000256   200014 471500                    LDP1    LBL1$,,AUTO
         2 000257   000100 301500                    BTD
         2 000260   200046 000010                    NDSC9   @ALBL$+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         2 000261   100007 630004                    NDSC9   7,,PR1                   cn=3,s=nosgn,sf=0,n=4

      336     8367                                                /* Set file sequence number           */
      337     8368    1           IF F$DCB.EBCDIC THEN            /* set FSECT to volume number         */

   8368  2 000262   000031 236100                    LDQ     25,,PR0
         2 000263   100000 316007                    CANQ    32768,DL
         2 000264   000276 600000 2                  TZE     s:8371

      338     8369    1              CALL BINCHAR( LBL1$->FT$LBL1.FSECT, F$DCB.VOL );

   8369  2 000265   000043 236100                    LDQ     35,,PR0
         2 000266   000033 772000                    QRL     27
         2 000267   000000 235003                    LDA     0,DU
         2 000270   200046 757100                    STAQ    @ALBL$+2,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:96   
         2 000271   200014 471500                    LDP1    LBL1$,,AUTO
         2 000272   000100 301500                    BTD
         2 000273   200046 000010                    NDSC9   @ALBL$+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         2 000274   100006 630004                    NDSC9   6,,PR1                   cn=3,s=nosgn,sf=0,n=4
         2 000275   000306 710000 2                  TRA     s:8378

      339     8370    1           ELSE                            /* set FSECT to section number        */
      340     8371    1              CALL BINCHAR( LBL1$->FT$LBL1.FSECT, F$DCB.FSECT );

   8371  2 000276   000077 236100                    LDQ     63,,PR0
         2 000277   000022 772000                    QRL     18
         2 000300   000000 235003                    LDA     0,DU
         2 000301   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 000302   200014 471500                    LDP1    LBL1$,,AUTO
         2 000303   000100 301500                    BTD
         2 000304   200046 000010                    NDSC9   @ALBL$+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         2 000305   100006 630004                    NDSC9   6,,PR1                   cn=3,s=nosgn,sf=0,n=4

      341     8372                                                /* Set file section number            */
      342     8373
      343     8374         /***
      344     8375          *** Set creation and expiration dates and system version.
      345     8376          ***/
      346     8377
      347     8378    1           CALL SSS$SYSTIME( J );          /* Get universal time                 */

   8378  2 000306   200013 631500                    EPPR1   J,,AUTO
         2 000307   200046 451500                    STP1    @ALBL$+2,,AUTO
         2 000310   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 000311   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000312   000000 701000 xent               TSX1    SSS$SYSTIME
         2 000313   000000 011000                    NOP     0

      348     8379    1           CALL XUD$UTS_DIFF_SEC(TEMP,J,0); /* get UTS interval in seconds       */

   8379  2 000314   000007 236000 3                  LDQ     7
         2 000315   200050 756100                    STQ     @ALBL$+4,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:97   
         2 000316   200013 630500                    EPPR0   J,,AUTO
         2 000317   200047 450500                    STP0    @ALBL$+3,,AUTO
         2 000320   200026 631500                    EPPR1   TEMP,,AUTO
         2 000321   200046 451500                    STP1    @ALBL$+2,,AUTO
         2 000322   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 000323   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000324   000000 701000 xent               TSX1    XUD$UTS_DIFF_SEC
         2 000325   000000 011000                    NOP     0

      349     8380    1           TEMP = (TEMP/86400) * 86400;    /* round to nearest day               */

   8380  2 000326   200026 236100                    LDQ     TEMP,,AUTO
         2 000327   250600 506007                    DIV     86400,DL
         2 000330   250600 402007                    MPY     86400,DL
         2 000331   200026 756100                    STQ     TEMP,,AUTO

      350     8381    1           CALL XUD$UTS_ADJ_25TH(J,0,TEMP*25); /* make J a proper UTS            */

   8381  2 000332   000031 402007                    MPY     25,DL
         2 000333   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 000334   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 000335   200051 450500                    STP0    @ALBL$+5,,AUTO
         2 000336   000007 236000 3                  LDQ     7
         2 000337   200050 756100                    STQ     @ALBL$+4,,AUTO
         2 000340   200013 631500                    EPPR1   J,,AUTO
         2 000341   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 000342   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 000343   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000344   000000 701000 xent               TSX1    XUD$UTS_ADJ_25TH
         2 000345   000000 011000                    NOP     0

      351     8382    1           CALL UMT$JDATE( LBL1$->FT$LBL1.CREATE_DATE, J );

   8382  2 000346   200013 630500                    EPPR0   J,,AUTO
         2 000347   200047 450500                    STP0    @ALBL$+3,,AUTO
         2 000350   200014 236100                    LDQ     LBL1$,,AUTO
         2 000351   000010 036000 3                  ADLQ    8
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:98   
         2 000352   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 000353   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 000354   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000355   000000 701000 xent               TSX1    UMT$JDATE
         2 000356   000000 011000                    NOP     0

      352     8383                                                /* Set creation date                  */
      353     8384    1           DT1.JD_R = LBL1$->FT$LBL1.CREATE_DATE; /* julian creation date        */

   8384  2 000357   200014 470500                    LDP0    LBL1$,,AUTO
         2 000360   040100 100500                    MLR     fill='040'O
         2 000361   000012 400005                    ADSC9   10,,PR0                  cn=2,n=5
         2 000362   200034 200005                    ADSC9   DT1,,AUTO                cn=1,n=5

      354     8385    1           IF DT1.JD.YR >= '00' AND DT1.JD.YR <= '20' /* check for century       */

   8385  2 000363   040000 106500                    CMPC    fill='040'O
         2 000364   200034 200002                    ADSC9   DT1,,AUTO                cn=1,n=2
         2 000365   000021 000002 1                  ADSC9   E_WRONGFILE+3            cn=0,n=2
         2 000366   000377 602000 2                  TNC     s:8387
         2 000367   040100 106400                    CMPC    fill='040'O
         2 000370   000023 000002 1                  ADSC9   E_WRONGFILE+5            cn=0,n=2
         2 000371   200034 200002                    ADSC9   DT1,,AUTO                cn=1,n=2
         2 000372   000377 602000 2                  TNC     s:8387

      355     8386    1           THEN LBL1$->FT$LBL1.CENTURY1 = '0'; /* zero means year 20xx           */

   8386  2 000373   040100 100400                    MLR     fill='040'O
         2 000374   000011 000001 3                  ADSC9   9                        cn=0,n=1
         2 000375   000012 200001                    ADSC9   10,,PR0                  cn=1,n=1
         2 000376   000402 710000 2                  TRA     s:8388

      356     8387    1           ELSE LBL1$->FT$LBL1.CENTURY1 = ' '; /* space means year 19xx          */

   8387  2 000377   040100 100400                    MLR     fill='040'O
         2 000400   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000401   000012 200001                    ADSC9   10,,PR0                  cn=1,n=1
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:99   

      357     8388    1           LBL1$->FT$LBL1.EXPIRE_DATE = FT$DDT.EXPIRE;

   8388  2 000402   200010 470500                    LDP0    DDDT$,,AUTO
         2 000403   200014 471500                    LDP1    LBL1$,,AUTO
         2 000404   040100 100500                    MLR     fill='040'O
         2 000405   000003 400005                    ADSC9   3,,PR0                   cn=2,n=5
         2 000406   100014 000005                    ADSC9   12,,PR1                  cn=0,n=5

      358     8389                                                /* Get expiration date from DDT       */
      359     8390    1           DT1.JD_R = FT$DDT.EXPIRE;       /* julian expiration date             */

   8390  2 000407   040100 100500                    MLR     fill='040'O
         2 000410   000003 400005                    ADSC9   3,,PR0                   cn=2,n=5
         2 000411   200034 200005                    ADSC9   DT1,,AUTO                cn=1,n=5

      360     8391    1           IF DT1.JD.YR >= '00' AND DT1.JD.YR <= '20' /* check for century       */

   8391  2 000412   040000 106500                    CMPC    fill='040'O
         2 000413   200034 200002                    ADSC9   DT1,,AUTO                cn=1,n=2
         2 000414   000021 000002 1                  ADSC9   E_WRONGFILE+3            cn=0,n=2
         2 000415   000427 602000 2                  TNC     s:8393
         2 000416   040100 106400                    CMPC    fill='040'O
         2 000417   000023 000002 1                  ADSC9   E_WRONGFILE+5            cn=0,n=2
         2 000420   200034 200002                    ADSC9   DT1,,AUTO                cn=1,n=2
         2 000421   000427 602000 2                  TNC     s:8393

      361     8392    1           THEN LBL1$->FT$LBL1.CENTURY2 = '0'; /* zero means year 20xx           */

   8392  2 000422   200014 471500                    LDP1    LBL1$,,AUTO
         2 000423   040100 100400                    MLR     fill='040'O
         2 000424   000011 000001 3                  ADSC9   9                        cn=0,n=1
         2 000425   100013 600001                    ADSC9   11,,PR1                  cn=3,n=1
         2 000426   000433 710000 2                  TRA     s:8394

      362     8393    1           ELSE LBL1$->FT$LBL1.CENTURY2= ' '; /* space means year 19xx           */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:100  
   8393  2 000427   200014 471500                    LDP1    LBL1$,,AUTO
         2 000430   040100 100400                    MLR     fill='040'O
         2 000431   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000432   100013 600001                    ADSC9   11,,PR1                  cn=3,n=1

      363     8394    1           LBL1$->FT$LBL1.SYSTEM.ID = 'CP-6';

   8394  2 000433   200014 471500                    LDP1    LBL1$,,AUTO
         2 000434   040100 100400                    MLR     fill='040'O
         2 000435   000020 000004 1                  ADSC9   E_WRONGFILE+2            cn=0,n=4
         2 000436   100017 000004                    ADSC9   15,,PR1                  cn=0,n=4

      364     8395    1           LBL1$->FT$LBL1.SYSTEM.VERSION = B_SITEINFO.VERSION#;

   8395  2 000437   040100 100400                    MLR     fill='040'O
         2 000440   000064 000004 xsym               ADSC9   B_SITEINFO+52            cn=0,n=4
         2 000441   100020 000011                    ADSC9   16,,PR1                  cn=0,n=9

      365     8396
      366     8397         /***
      367     8398          *** Write out LBL1.
      368     8399          ***/
      369     8400
      370     8401    1           IF F$DCB.IASN ~= %OD# THEN

   8401  2 000442   200011 473500                    LDP3    JDCB$,,AUTO
         2 000443   300103 236100                    LDQ     67,,PR3
         2 000444   000777 376007                    ANQ     511,DL
         2 000445   000012 116007                    CMPQ    10,DL
         2 000446   000455 600000 2                  TZE     s:8408

      371     8402    1              CALL FTI$WRASCEBC (LBL1$) ALTRET (JUSTALT);

   8402  2 000447   200014 634500                    EPPR4   LBL1$,,AUTO
         2 000450   200046 454500                    STP4    @ALBL$+2,,AUTO
         2 000451   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 000452   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:101  
         2 000453   000000 701000 xent               TSX1    FTI$WRASCEBC
         2 000454   006767 702000 2                  TSX2    JUSTALT

      372     8403
      373     8404         /***
      374     8405          *** Initialize label buffer for LBL2.
      375     8406          ***/
      376     8407
      377     8408    1           LBL2$->FT$BLBL = ' ';           /* Blank it out                       */

   8408  2 000455   200015 470500                    LDP0    LBL2$,,AUTO
         2 000456   040100 100400                    MLR     fill='040'O
         2 000457   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000460   000000 000120                    ADSC9   0,,PR0                   cn=0,n=80

      378     8409    1           LBL2$->FT$LBL2.LABEL_ID = THELBL;

   8409  2 000461   200003 470500                    LDP0    @THELBL,,AUTO
         2 000462   200015 471500                    LDP1    LBL2$,,AUTO
         2 000463   040100 100500                    MLR     fill='040'O
         2 000464   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         2 000465   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3

      379     8410    1           LBL2$->FT$LBL2.LABEL_NUM = '2'; /* LBL2                               */

   8410  2 000466   200015 471500                    LDP1    LBL2$,,AUTO
         2 000467   040100 100400                    MLR     fill='040'O
         2 000470   000012 000001 3                  ADSC9   10                       cn=0,n=1
         2 000471   100000 600001                    ADSC9   0,,PR1                   cn=3,n=1

      380     8411
      381     8412         /***
      382     8413          *** Set label fields from DCB.  Save file name.
      383     8414          ***/
      384     8415
      385     8416    1           IF F$DCB.TAPTYP.CP6F OR F$DCB.ORG = %RESTRICT#

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:102  
   8416  2 000472   200011 471500                    LDP1    JDCB$,,AUTO
         2 000473   100067 236100                    LDQ     55,,PR1
         2 000474   000200 316003                    CANQ    128,DU
         2 000475   000502 601000 2                  TNZ     s:8417
         2 000476   100032 236100                    LDQ     26,,PR1
         2 000477   777000 376003                    ANQ     -512,DU
         2 000500   022000 116003                    CMPQ    9216,DU
         2 000501   000506 601000 2                  TNZ     s:8419

      386     8417    1           THEN LBL2$->FT$LBL2.CP6.FILE_ID = F$DCB.NAME.C;

   8417  2 000502   200015 473500                    LDP3    LBL2$,,AUTO
         2 000503   040100 100500                    MLR     fill='040'O
         2 000504   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31
         2 000505   300004 200037                    ADSC9   4,,PR3                   cn=1,n=31

      387     8418                                                /* Set whole file name                */
      388     8419    1           IF F$DCB.EBCDIC

   8419  2 000506   100031 236100                    LDQ     25,,PR1
         2 000507   100000 316007                    CANQ    32768,DL
         2 000510   000521 600000 2                  TZE     s:8422

      389     8420    1           THEN CALL BINCHAR( LBL2$->FT$LBL2.OTHEROS.DENSITY, F$DCB.DENSITY );

   8420  2 000511   100043 236100                    LDQ     35,,PR1
         2 000512   000777 376007                    ANQ     511,DL
         2 000513   000000 235003                    LDA     0,DU
         2 000514   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 000515   200015 473500                    LDP3    LBL2$,,AUTO
         2 000516   000100 301500                    BTD
         2 000517   200046 000010                    NDSC9   @ALBL$+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         2 000520   300003 630001                    NDSC9   3,,PR3                   cn=3,s=nosgn,sf=0,n=1

      390     8421                                                /* Set density                        */
      391     8422    1           N = F$DCB.BLKL;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:103  
   8422  2 000521   100033 236100                    LDQ     27,,PR1
         2 000522   000022 772000                    QRL     18
         2 000523   200017 756100                    STQ     N,,AUTO

      392     8423    1           IF NOT F$DCB.TAPTYP.RWASC

   8423  2 000524   100067 236100                    LDQ     55,,PR1
         2 000525   000400 316003                    CANQ    256,DU
         2 000526   000534 601000 2                  TNZ     s:8425

      393     8424    1           THEN N = (N * 9 + 7) / 8;       /* Account for binary write           */

   8424  2 000527   200017 236100                    LDQ     N,,AUTO
         2 000530   000011 402007                    MPY     9,DL
         2 000531   000007 036007                    ADLQ    7,DL
         2 000532   000010 506007                    DIV     8,DL
         2 000533   200017 756100                    STQ     N,,AUTO

      394     8425    1           CALL BINCHAR( LBL2$->FT$LBL2.BLKL, N ); /* Set BLKL                   */

   8425  2 000534   200015 473500                    LDP3    LBL2$,,AUTO
         2 000535   000100 301500                    BTD
         2 000536   200017 000004                    NDSC9   N,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         2 000537   300001 230005                    NDSC9   1,,PR3                   cn=1,s=nosgn,sf=0,n=5

      395     8426    1           N = F$DCB.RECL;

   8426  2 000540   100033 236100                    LDQ     27,,PR1
         2 000541   777777 376007                    ANQ     -1,DL
         2 000542   200017 756100                    STQ     N,,AUTO

      396     8427    1           IF NOT F$DCB.TAPTYP.RWASC

   8427  2 000543   100067 236100                    LDQ     55,,PR1
         2 000544   000400 316003                    CANQ    256,DU
         2 000545   000553 601000 2                  TNZ     s:8429

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:104  
      397     8428    1           THEN N = (N * 9 + 7) / 8;

   8428  2 000546   200017 236100                    LDQ     N,,AUTO
         2 000547   000011 402007                    MPY     9,DL
         2 000550   000007 036007                    ADLQ    7,DL
         2 000551   000010 506007                    DIV     8,DL
         2 000552   200017 756100                    STQ     N,,AUTO

      398     8429    1           CALL BINCHAR( LBL2$->FT$LBL2.RECL, N ); /* Set RECL                   */

   8429  2 000553   200015 473500                    LDP3    LBL2$,,AUTO
         2 000554   000100 301500                    BTD
         2 000555   200017 000004                    NDSC9   N,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         2 000556   300002 430005                    NDSC9   2,,PR3                   cn=2,s=nosgn,sf=0,n=5

      399     8430    1           IF F$DCB.EBCDIC AND F$DCB.ORG = %VARIABLE#

   8430  2 000557   100031 236100                    LDQ     25,,PR1
         2 000560   100000 316007                    CANQ    32768,DL
         2 000561   000573 600000 2                  TZE     s:8432
         2 000562   100032 236100                    LDQ     26,,PR1
         2 000563   777000 376003                    ANQ     -512,DU
         2 000564   020000 116003                    CMPQ    8192,DU
         2 000565   000573 601000 2                  TNZ     s:8432

      400     8431    1           THEN LBL2$->FT$LBL2.BUF_OFFSET = '  '; /* Funky, these IBM guys       */

   8431  2 000566   200015 473500                    LDP3    LBL2$,,AUTO
         2 000567   040100 100400                    MLR     fill='040'O
         2 000570   000024 000002 1                  ADSC9   E_WRONGFILE+6            cn=0,n=2
         2 000571   300014 400002                    ADSC9   12,,PR3                  cn=2,n=2
         2 000572   000603 710000 2                  TRA     s:8439

      401     8432    1           ELSE CALL BINCHAR( LBL2$->FT$LBL2.BUF_OFFSET, F$DCB.BOL );

   8432  2 000573   100034 236100                    LDQ     28,,PR1
         2 000574   000777 376007                    ANQ     511,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:105  
         2 000575   000000 235003                    LDA     0,DU
         2 000576   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 000577   200015 473500                    LDP3    LBL2$,,AUTO
         2 000600   000100 301500                    BTD
         2 000601   200046 000010                    NDSC9   @ALBL$+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         2 000602   300014 430002                    NDSC9   12,,PR3                  cn=2,s=nosgn,sf=0,n=2

      402     8433                                                /* Set block header size              */
      403     8434
      404     8435         /***
      405     8436          *** Set format specified fields of HDR2.
      406     8437          ***/
      407     8438
      408     8439    2           DO CASE( F$DCB.ORG );

   8439  2 000603   100032 236100                    LDQ     26,,PR1
         2 000604   000033 772000                    QRL     27
         2 000605   000023 116007                    CMPQ    19,DL
         2 000606   000610 602006 2                  TNC     s:8439+5,QL
         2 000607   001075 710000 2                  TRA     s:8497
         2 000610   001075 710000 2                  TRA     s:8497
         2 000611   000633 710000 2                  TRA     s:8442
         2 000612   000633 710000 2                  TRA     s:8442
         2 000613   000633 710000 2                  TRA     s:8442
         2 000614   000633 710000 2                  TRA     s:8442
         2 000615   000633 710000 2                  TRA     s:8442
         2 000616   000633 710000 2                  TRA     s:8442
         2 000617   000633 710000 2                  TRA     s:8442
         2 000620   001075 710000 2                  TRA     s:8497
         2 000621   000633 710000 2                  TRA     s:8442
         2 000622   001075 710000 2                  TRA     s:8497
         2 000623   001075 710000 2                  TRA     s:8497
         2 000624   001075 710000 2                  TRA     s:8497
         2 000625   000633 710000 2                  TRA     s:8442
         2 000626   001075 710000 2                  TRA     s:8497
         2 000627   001006 710000 2                  TRA     s:8475
         2 000630   001024 710000 2                  TRA     s:8480
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:106  
         2 000631   001075 710000 2                  TRA     s:8497
         2 000632   000633 710000 2                  TRA     s:8442

      409     8440    2              CASE(%CONSEC#,%KEYED#,%RELATIVE#,%IDS#,%INDEXED#,%UR#,

      410     8441    2               %RESTRICT#,%RANDOM#,%SYMB#,%IREL#);
      411     8442    2                 LBL2$->FT$LBL2.FORMAT = 'U';

   8442  2 000633   200015 473500                    LDP3    LBL2$,,AUTO
         2 000634   040100 100400                    MLR     fill='040'O
         2 000635   000013 000001 3                  ADSC9   11                       cn=0,n=1
         2 000636   300001 000001                    ADSC9   1,,PR3                   cn=0,n=1

      412     8443    2                 IF F$DCB.BLOCKED

   8443  2 000637   100031 236100                    LDQ     25,,PR1
         2 000640   000010 316007                    CANQ    8,DL
         2 000641   000656 600000 2                  TZE     s:8447

      413     8444    2                 THEN IF F$DCB.SPANNED

   8444  2 000642   000004 316007                    CANQ    4,DL
         2 000643   000651 600000 2                  TZE     s:8446

      414     8445    2                    THEN LBL2$->FT$LBL2.CP6.BLOCK_ATTR = 'R';

   8445  2 000644   200015 473500                    LDP3    LBL2$,,AUTO
         2 000645   040100 100400                    MLR     fill='040'O
         2 000646   000014 000001 3                  ADSC9   12                       cn=0,n=1
         2 000647   300014 200001                    ADSC9   12,,PR3                  cn=1,n=1
         2 000650   000664 710000 2                  TRA     s:8450

      415     8446    2                    ELSE LBL2$->FT$LBL2.CP6.BLOCK_ATTR = 'B';

   8446  2 000651   200015 473500                    LDP3    LBL2$,,AUTO
         2 000652   040100 100400                    MLR     fill='040'O
         2 000653   000015 000001 3                  ADSC9   13                       cn=0,n=1
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:107  
         2 000654   300014 200001                    ADSC9   12,,PR3                  cn=1,n=1
         2 000655   000664 710000 2                  TRA     s:8450

      416     8447    2                 ELSE IF F$DCB.SPANNED

   8447  2 000656   000004 316007                    CANQ    4,DL
         2 000657   000664 600000 2                  TZE     s:8450

      417     8448    2                    THEN LBL2$->FT$LBL2.CP6.BLOCK_ATTR = 'S';

   8448  2 000660   200015 473500                    LDP3    LBL2$,,AUTO
         2 000661   040100 100400                    MLR     fill='040'O
         2 000662   000016 000001 3                  ADSC9   14                       cn=0,n=1
         2 000663   300014 200001                    ADSC9   12,,PR3                  cn=1,n=1

      418     8449    2                    ELSE ;
      419     8450    3                 DO CASE(F$DCB.ORG);       /* Sub-categorize CP-6 format         */

   8450  2 000664   100032 236100                    LDQ     26,,PR1
         2 000665   000033 772000                    QRL     27
         2 000666   000023 116007                    CMPQ    19,DL
         2 000667   000671 602006 2                  TNC     s:8450+5,QL
         2 000670   001101 710000 2                  TRA     s:8504
         2 000671   001005 710000 2                  TRA     s:8473
         2 000672   000714 710000 2                  TRA     s:8452
         2 000673   000721 710000 2                  TRA     s:8454
         2 000674   001001 710000 2                  TRA     s:8472
         2 000675   000752 710000 2                  TRA     s:8464
         2 000676   000726 710000 2                  TRA     s:8456
         2 000677   000740 710000 2                  TRA     s:8460
         2 000700   000733 710000 2                  TRA     s:8458
         2 000701   001005 710000 2                  TRA     s:8473
         2 000702   000757 710000 2                  TRA     s:8466
         2 000703   001005 710000 2                  TRA     s:8473
         2 000704   001005 710000 2                  TRA     s:8473
         2 000705   001005 710000 2                  TRA     s:8473
         2 000706   000745 710000 2                  TRA     s:8462
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:108  
         2 000707   001005 710000 2                  TRA     s:8473
         2 000710   001005 710000 2                  TRA     s:8473
         2 000711   001005 710000 2                  TRA     s:8473
         2 000712   001005 710000 2                  TRA     s:8473
         2 000713   000764 710000 2                  TRA     s:8468

      420     8451    3                    CASE(%CONSEC#);

      421     8452    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'C';

   8452  2 000714   200015 473500                    LDP3    LBL2$,,AUTO
         2 000715   040100 100400                    MLR     fill='040'O
         2 000716   000017 000001 3                  ADSC9   15                       cn=0,n=1
         2 000717   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 000720   001101 710000 2                  TRA     s:8504

      422     8453    3                    CASE(%KEYED#);

      423     8454    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'K';

   8454  2 000721   200015 473500                    LDP3    LBL2$,,AUTO
         2 000722   040100 100400                    MLR     fill='040'O
         2 000723   000020 000001 3                  ADSC9   16                       cn=0,n=1
         2 000724   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 000725   001101 710000 2                  TRA     s:8504

      424     8455    3                    CASE(%RELATIVE#);

      425     8456    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'F';

   8456  2 000726   200015 473500                    LDP3    LBL2$,,AUTO
         2 000727   040100 100400                    MLR     fill='040'O
         2 000730   000021 000001 3                  ADSC9   17                       cn=0,n=1
         2 000731   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 000732   001101 710000 2                  TRA     s:8504

      426     8457    3                    CASE(%IDS#);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:109  

      427     8458    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'D';

   8458  2 000733   200015 473500                    LDP3    LBL2$,,AUTO
         2 000734   040100 100400                    MLR     fill='040'O
         2 000735   000022 000001 3                  ADSC9   18                       cn=0,n=1
         2 000736   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 000737   001101 710000 2                  TRA     s:8504

      428     8459    3                    CASE(%INDEXED#);

      429     8460    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'I';

   8460  2 000740   200015 473500                    LDP3    LBL2$,,AUTO
         2 000741   040100 100400                    MLR     fill='040'O
         2 000742   000000 000001 3                  ADSC9   0                        cn=0,n=1
         2 000743   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 000744   001101 710000 2                  TRA     s:8504

      430     8461    3                    CASE(%IREL#);

      431     8462    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'i';

   8462  2 000745   200015 473500                    LDP3    LBL2$,,AUTO
         2 000746   040100 100400                    MLR     fill='040'O
         2 000747   000023 000001 3                  ADSC9   19                       cn=0,n=1
         2 000750   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 000751   001101 710000 2                  TRA     s:8504

      432     8463    3                    CASE(%UR#);

      433     8464    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'U';

   8464  2 000752   200015 473500                    LDP3    LBL2$,,AUTO
         2 000753   040100 100400                    MLR     fill='040'O
         2 000754   000013 000001 3                  ADSC9   11                       cn=0,n=1
         2 000755   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:110  
         2 000756   001101 710000 2                  TRA     s:8504

      434     8465    3                    CASE(%SYMB#);

      435     8466    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'S';

   8466  2 000757   200015 473500                    LDP3    LBL2$,,AUTO
         2 000760   040100 100400                    MLR     fill='040'O
         2 000761   000016 000001 3                  ADSC9   14                       cn=0,n=1
         2 000762   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 000763   001101 710000 2                  TRA     s:8504

      436     8467    3                    CASE(%RESTRICT#);

      437     8468    3                       IF ADDR(LBL$) = ADDR(NIL)

   8468  2 000764   200004 236100                    LDQ     @LBL$,,AUTO
         2 000765   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000766   000774 601000 2                  TNZ     s:8470

      438     8469    3                       THEN LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'x';

   8469  2 000767   200015 473500                    LDP3    LBL2$,,AUTO
         2 000770   040100 100400                    MLR     fill='040'O
         2 000771   000024 000001 3                  ADSC9   20                       cn=0,n=1
         2 000772   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 000773   001101 710000 2                  TRA     s:8504

      439     8470    3                       ELSE LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'X';

   8470  2 000774   200015 473500                    LDP3    LBL2$,,AUTO
         2 000775   040100 100400                    MLR     fill='040'O
         2 000776   000025 000001 3                  ADSC9   21                       cn=0,n=1
         2 000777   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1
         2 001000   001101 710000 2                  TRA     s:8504

      440     8471    3                    CASE(%RANDOM#);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:111  

      441     8472    3                       LBL2$->FT$LBL2.CP6.FILE_FORMAT = 'R';

   8472  2 001001   200015 473500                    LDP3    LBL2$,,AUTO
         2 001002   040100 100400                    MLR     fill='040'O
         2 001003   000014 000001 3                  ADSC9   12                       cn=0,n=1
         2 001004   300014 000001                    ADSC9   12,,PR3                  cn=0,n=1

      442     8473    3                    END;

   8473  2 001005   001101 710000 2                  TRA     s:8504

      443     8474    2              CASE(%FIXED#);

      444     8475    2                 LBL2$->FT$LBL2.FORMAT = 'F';

   8475  2 001006   200015 473500                    LDP3    LBL2$,,AUTO
         2 001007   040100 100400                    MLR     fill='040'O
         2 001010   000021 000001 3                  ADSC9   17                       cn=0,n=1
         2 001011   300001 000001                    ADSC9   1,,PR3                   cn=0,n=1

      445     8476    2                 IF F$DCB.EBCDIC

   8476  2 001012   100031 236100                    LDQ     25,,PR1
         2 001013   100000 316007                    CANQ    32768,DL
         2 001014   001101 600000 2                  TZE     s:8504

      446     8477    2                 THEN IF F$DCB.BLOCKED

   8477  2 001015   000010 316007                    CANQ    8,DL
         2 001016   001101 600000 2                  TZE     s:8504

      447     8478    2                    THEN LBL2$->FT$LBL2.CP6.BLOCK_ATTR = 'B';

   8478  2 001017   200015 473500                    LDP3    LBL2$,,AUTO
         2 001020   040100 100400                    MLR     fill='040'O
         2 001021   000015 000001 3                  ADSC9   13                       cn=0,n=1
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:112  
         2 001022   300014 200001                    ADSC9   12,,PR3                  cn=1,n=1
         2 001023   001101 710000 2                  TRA     s:8504

      448     8479    2              CASE(%VARIABLE#);

      449     8480    2                 IF F$DCB.EBCDIC

   8480  2 001024   100031 236100                    LDQ     25,,PR1
         2 001025   100000 316007                    CANQ    32768,DL
         2 001026   001061 600000 2                  TZE     s:8492

      450     8481    3                 THEN DO;                  /* One of the EBCDIC formats          */

      451     8482    3                    LBL2$->FT$LBL2.FORMAT = 'V'; /* EBCDIC V format              */

   8482  2 001027   200015 473500                    LDP3    LBL2$,,AUTO
         2 001030   040100 100400                    MLR     fill='040'O
         2 001031   000026 000001 3                  ADSC9   22                       cn=0,n=1
         2 001032   300001 000001                    ADSC9   1,,PR3                   cn=0,n=1

      452     8483    3                    IF F$DCB.BLOCKED

   8483  2 001033   100031 236100                    LDQ     25,,PR1
         2 001034   000010 316007                    CANQ    8,DL
         2 001035   001052 600000 2                  TZE     s:8487

      453     8484    3                    THEN IF F$DCB.SPANNED

   8484  2 001036   000004 316007                    CANQ    4,DL
         2 001037   001045 600000 2                  TZE     s:8486

      454     8485    3                       THEN LBL2$->FT$LBL2.OTHEROS.BLOCK_ATTR = 'R'; /* B,S      */

   8485  2 001040   200015 473500                    LDP3    LBL2$,,AUTO
         2 001041   040100 100400                    MLR     fill='040'O
         2 001042   000014 000001 3                  ADSC9   12                       cn=0,n=1
         2 001043   300011 400001                    ADSC9   9,,PR3                   cn=2,n=1
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:113  
         2 001044   001101 710000 2                  TRA     s:8504

      455     8486    3                       ELSE LBL2$->FT$LBL2.OTHEROS.BLOCK_ATTR = 'B'; /* B        */

   8486  2 001045   200015 473500                    LDP3    LBL2$,,AUTO
         2 001046   040100 100400                    MLR     fill='040'O
         2 001047   000015 000001 3                  ADSC9   13                       cn=0,n=1
         2 001050   300011 400001                    ADSC9   9,,PR3                   cn=2,n=1
         2 001051   001101 710000 2                  TRA     s:8504

      456     8487    3                    ELSE IF F$DCB.SPANNED

   8487  2 001052   000004 316007                    CANQ    4,DL
         2 001053   001101 600000 2                  TZE     s:8504

      457     8488    3                       THEN LBL2$->FT$LBL2.OTHEROS.BLOCK_ATTR = 'S'; /* S        */

   8488  2 001054   200015 473500                    LDP3    LBL2$,,AUTO
         2 001055   040100 100400                    MLR     fill='040'O
         2 001056   000016 000001 3                  ADSC9   14                       cn=0,n=1
         2 001057   300011 400001                    ADSC9   9,,PR3                   cn=2,n=1

      458     8489    3                       ELSE ;              /* Left blank                         */
      459     8490    3                    END;

   8490  2 001060   001101 710000 2                  TRA     s:8504

      460     8491    3                 ELSE DO;                  /* ANS format                         */

      461     8492    3                    IF F$DCB.SPANNED

   8492  2 001061   000004 316007                    CANQ    4,DL
         2 001062   001070 600000 2                  TZE     s:8494

      462     8493    3                    THEN LBL2$->FT$LBL2.FORMAT = 'S'; /* Spanned (blocked)       */

   8493  2 001063   200015 473500                    LDP3    LBL2$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:114  
         2 001064   040100 100400                    MLR     fill='040'O
         2 001065   000016 000001 3                  ADSC9   14                       cn=0,n=1
         2 001066   300001 000001                    ADSC9   1,,PR3                   cn=0,n=1
         2 001067   001101 710000 2                  TRA     s:8504

      463     8494    3                    ELSE LBL2$->FT$LBL2.FORMAT = 'D'; /* Just blocked            */

   8494  2 001070   200015 473500                    LDP3    LBL2$,,AUTO
         2 001071   040100 100400                    MLR     fill='040'O
         2 001072   000022 000001 3                  ADSC9   18                       cn=0,n=1
         2 001073   300001 000001                    ADSC9   1,,PR3                   cn=0,n=1

      464     8495    3                    END;

   8495  2 001074   001101 710000 2                  TRA     s:8504

      465     8496    2              CASE(ELSE);

      466     8497    2                 LBL2$->FT$LBL2.FORMAT = 'U';

   8497  2 001075   200015 473500                    LDP3    LBL2$,,AUTO
         2 001076   040100 100400                    MLR     fill='040'O
         2 001077   000013 000001 3                  ADSC9   11                       cn=0,n=1
         2 001100   300001 000001                    ADSC9   1,,PR3                   cn=0,n=1

      467     8498    2              END;

      468     8499
      469     8500         /***
      470     8501          *** Write out LBL2.
      471     8502          ***/
      472     8503
      473     8504    1           IF F$DCB.IASN = %OD# THEN

   8504  2 001101   100103 236100                    LDQ     67,,PR1
         2 001102   000777 376007                    ANQ     511,DL
         2 001103   000012 116007                    CMPQ    10,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:115  
         2 001104   001116 601000 2                  TNZ     s:8507

      474     8505    1              CALL FPO$WRITELBL (LBL1$, LBL2$) ALTRET (JUSTALT);

   8505  2 001105   200015 633500                    EPPR3   LBL2$,,AUTO
         2 001106   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 001107   200014 634500                    EPPR4   LBL1$,,AUTO
         2 001110   200046 454500                    STP4    @ALBL$+2,,AUTO
         2 001111   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 001112   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001113   000000 701000 xent               TSX1    FPO$WRITELBL
         2 001114   006767 702000 2                  TSX2    JUSTALT
         2 001115   001124 710000 2                  TRA     s:8508

      475     8506    1           ELSE
      476     8507    1              CALL FTI$WRASCEBC (LBL2$) ALTRET (JUSTALT);

   8507  2 001116   200015 633500                    EPPR3   LBL2$,,AUTO
         2 001117   200046 453500                    STP3    @ALBL$+2,,AUTO
         2 001120   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 001121   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001122   000000 701000 xent               TSX1    FTI$WRASCEBC
         2 001123   006767 702000 2                  TSX2    JUSTALT

      477     8508    1           RETURN;

   8508  2 001124   000000 702200 xent               TSX2  ! X66_ARET

      478     8509
      479     8510
      480     8511        /*********************************************************************/
      481     8512        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:116  
      482     8513        /*********************************************************************/
      483     8514    1   FTL$ULBLS: ENTRY(THELBL,LBL$,NUM) ALTRET;

   8514  2 001125   000000 700200 xent  FTL$ULBLS    TSX0  ! X66_AUTO_5
         2 001126   000052 000005                    ZERO    42,5

      484     8515        /*F*    NAME: FTL$ULBLS
      485     8516                PURPOSE: Write user labels to tape.
      486     8517                DESCRIPTION: THELBL - type of label to write
      487     8518                    NUM - number of bytes in VLP_ULBL
      488     8519                    LBL$ - pointer to label group buffer
      489     8520                OUTPUT: NUM - number of labels written
      490     8521         ***/
      491     8522
      492     8523        /********************/
      493     8524
      494     8525         /***
      495     8526          *** If no labels, just return.
      496     8527          ***/
      497     8528
      498     8529    1           IF NUM = 0 OR LBL$ = ADDR(NIL) THEN RETURN;

   8529  2 001127   200005 470500                    LDP0    @NUM,,AUTO
         2 001130   000000 235100                    LDA     0,,PR0
         2 001131   001136 600000 2                  TZE     s:8529+7
         2 001132   200004 471500                    LDP1    @LBL$,,AUTO
         2 001133   100000 236100                    LDQ     0,,PR1
         2 001134   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001135   001137 601000 2                  TNZ     s:8530

   8529  2 001136   000000 702200 xent               TSX2  ! X66_ARET

      499     8530    1           LBL1$ = LBL$;

   8530  2 001137   200014 756100                    STQ     LBL1$,,AUTO

      500     8531    1           N = (NUM - LENGTHC(VLP_ULBL.NUM#)) / LENGTHC(VLP_ULBL.ULBL#(0));
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:117  

   8531  2 001140   000000 236100                    LDQ     0,,PR0
         2 001141   000004 136007                    SBLQ    4,DL
         2 001142   000120 506007                    DIV     80,DL
         2 001143   200017 756100                    STQ     N,,AUTO

      501     8532    1           IF N <= 0

   8532  2 001144   000000 116003                    CMPQ    0,DU
         2 001145   001151 605400 2                  TPNZ    s:8538

      502     8533    2           THEN DO;                        /* No full labels can be read         */

      503     8534    2              VLP_ULBL.NUM# = 0;

   8534  2 001146   200014 473500                    LDP3    LBL1$,,AUTO
         2 001147   300000 450100                    STZ     0,,PR3

      504     8535    2              RETURN;

   8535  2 001150   000000 702200 xent               TSX2  ! X66_ARET

      505     8536    2              END;
      506     8537
      507     8538    1           IF N > VLP_ULBL.NUM# THEN N = VLP_ULBL.NUM#;
              8538                    /* Write less than entire buffer */

   8538  2 001151   200014 473500                    LDP3    LBL1$,,AUTO
         2 001152   300000 116100                    CMPQ    0,,PR3
         2 001153   001156 604400 2                  TMOZ    s:8544

   8538  2 001154   300000 235100                    LDA     0,,PR3
         2 001155   200017 755100                    STA     N,,AUTO

      508     8539         /***
      509     8540          *** Write labels while buffer not exhausted and labels
      510     8541          *** are of the correct type.
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:118  
      511     8542          ***/
      512     8543
      513     8544    1           I = 0;                          /* Label index                        */

   8544  2 001156   200012 450100                    STZ     I,,AUTO

      514     8545    2           DO WHILE( I < N );

   8545  2 001157   200012 236100                    LDQ     I,,AUTO
         2 001160   200017 116100                    CMPQ    N,,AUTO
         2 001161   001214 605000 2                  TPL     s:8553

      515     8546    2              IF VLP_ULBL.ULBLFIELD.LABELID(I) = THELBL

   8546  2 001162   200012 236100                    LDQ     I,,AUTO
         2 001163   000120 402007                    MPY     80,DL
         2 001164   200014 470500                    LDP0    LBL1$,,AUTO
         2 001165   200003 471500                    LDP1    @THELBL,,AUTO
         2 001166   040100 106506                    CMPC    fill='040'O
         2 001167   000001 000003                    ADSC9   1,Q,PR0                  cn=0,n=3
         2 001170   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 001171   001207 601000 2                  TNZ     s:8551

      516     8547    3              THEN DO;                     /* Label is correct type              */

      517     8548    3                 CALL FTI$WRASCEBC(ADDR(VLP_ULBL.ULBL#(I))) ALTRET(JUSTALT);

   8548  2 001172   200012 236100                    LDQ     I,,AUTO
         2 001173   000024 402003                    MPY     20,DU
         2 001174   000001 036003                    ADLQ    1,DU
         2 001175   200014 036100                    ADLQ    LBL1$,,AUTO
         2 001176   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 001177   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 001200   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 001201   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 001202   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001203   000000 701000 xent               TSX1    FTI$WRASCEBC
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:119  
         2 001204   006767 702000 2                  TSX2    JUSTALT

      518     8549    3                 I = I + 1;                /* Increment label count              */

   8549  2 001205   200012 054100                    AOS     I,,AUTO

      519     8550    3                 END;

   8550  2 001206   001211 710000 2                  TRA     s:8552

      520     8551    2              ELSE N = I;                  /* Terminate label writing            */

   8551  2 001207   200012 235100                    LDA     I,,AUTO
         2 001210   200017 755100                    STA     N,,AUTO

      521     8552    2              END;

   8552  2 001211   200012 236100                    LDQ     I,,AUTO
         2 001212   200017 116100                    CMPQ    N,,AUTO
         2 001213   001162 604000 2                  TMI     s:8546

      522     8553    1           NUM = N;                        /* Return # labels written            */

   8553  2 001214   200005 470500                    LDP0    @NUM,,AUTO
         2 001215   200017 235100                    LDA     N,,AUTO
         2 001216   000000 755100                    STA     0,,PR0

      523     8554    1           IF N ~= VLP_ULBL.NUM# THEN VLP_ULBL.NUM# = N; /* Rtrn actual # written */

   8554  2 001217   200014 471500                    LDP1    LBL1$,,AUTO
         2 001220   200017 236100                    LDQ     N,,AUTO
         2 001221   100000 116100                    CMPQ    0,,PR1
         2 001222   001224 600000 2                  TZE     s:8555

   8554  2 001223   100000 756100                    STQ     0,,PR1

      524     8555    1           RETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:120  

   8555  2 001224   000000 702200 xent               TSX2  ! X66_ARET

      525     8556
      526     8557        /*********************************************************************/
      527     8558        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:121  
      528     8559        /*********************************************************************/
      529     8560    1   FTL$GETULBLS: ENTRY(THELBL,LBL$,NUM) ALTRET;

   8560  2 001225   000000 700200 xent  FTL$GETULBLS TSX0  ! X66_AUTO_5
         2 001226   000052 000005                    ZERO    42,5

      530     8561        /*F*     NAME:FTL$GETULBLS
      531     8562                 PURPOSE: Read user labels until file mark hit.
      532     8563                 INPUT: LBL$ - Pointer to user label buffer
      533     8564                    NUM - number of bytes in VLP_ULBL
      534     8565                    THELBL - (dummy)
      535     8566                 DESCRIPTION: Reads labels until user buffer is full or
      536     8567                    file mark has been hit.
      537     8568         ***/
      538     8569
      539     8570        /********************/
      540     8571
      541     8572         /***
      542     8573          *** If no user buffer, number of labels is 0.
      543     8574          ***/
      544     8575
      545     8576    1           IF LBL$ = ADDR(NIL)

   8576  2 001227   200004 470500                    LDP0    @LBL$,,AUTO
         2 001230   000000 236100                    LDQ     0,,PR0
         2 001231   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001232   001236 601000 2                  TNZ     s:8578

      546     8577    1           THEN NUM = 0;

   8577  2 001233   200005 471500                    LDP1    @NUM,,AUTO
         2 001234   100000 450100                    STZ     0,,PR1
         2 001235   001237 710000 2                  TRA     s:8579

      547     8578    1           ELSE LBL1$ = LBL$;

   8578  2 001236   200014 756100                    STQ     LBL1$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:122  

      548     8579    1           JDCB$ = B$JIT.DCB$;

   8579  2 001237   000000 471400 xsym               LDP1    B$JIT$
         2 001240   100232 236100                    LDQ     154,,PR1
         2 001241   200011 756100                    STQ     JDCB$,,AUTO

      549     8580
      550     8581         /***
      551     8582          *** Read labels while buffer not exhausted and labels exist.
      552     8583          ***/
      553     8584
      554     8585    1           I = 0;                          /* Count labels read                  */

   8585  2 001242   200012 450100                    STZ     I,,AUTO

      555     8586    1           IF NUM ~= 0

   8586  2 001243   200005 473500                    LDP3    @NUM,,AUTO
         2 001244   300000 235100                    LDA     0,,PR3
         2 001245   001362 600000 2                  TZE     s:8610

      556     8587    2           THEN DO;

      557     8588    2              NUM = (NUM - LENGTHC(VLP_ULBL.NUM#)) / LENGTHC(VLP_ULBL.ULBL#(0));

   8588  2 001246   300000 236100                    LDQ     0,,PR3
         2 001247   000004 136007                    SBLQ    4,DL
         2 001250   000120 506007                    DIV     80,DL
         2 001251   300000 756100                    STQ     0,,PR3

      558     8589    3              DO WHILE( I < NUM AND NOT F$DCB.TYC.EOF(1) );

   8589  2 001252   001347 710000 2                  TRA     s:8607

      559     8590    3                 CALL FTI$RDASCEBC(ADDR(VLP_ULBL.ULBL#(I))) ALTRET(JUSTALT);

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:123  
   8590  2 001253   200012 236100                    LDQ     I,,AUTO
         2 001254   000024 402003                    MPY     20,DU
         2 001255   000001 036003                    ADLQ    1,DU
         2 001256   200014 036100                    ADLQ    LBL1$,,AUTO
         2 001257   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 001260   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 001261   200047 450500                    STP0    @ALBL$+3,,AUTO
         2 001262   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 001263   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001264   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 001265   006767 702000 2                  TSX2    JUSTALT

      560     8591    3                 IF NOT F$DCB.TYC.EOF(1)

   8591  2 001266   200011 470500                    LDP0    JDCB$,,AUTO
         2 001267   000002 236100                    LDQ     2,,PR0
         2 001270   004000 316003                    CANQ    2048,DU
         2 001271   001344 601000 2                  TNZ     s:8606

      561     8592    4                 THEN DO;                  /* A label was read                   */

      562     8593    4                    IF VLP_ULBL.ULBLFIELD.LABELID(I) = 'UVL'

   8593  2 001272   200012 236100                    LDQ     I,,AUTO
         2 001273   000024 402007                    MPY     20,DL
         2 001274   200014 471500                    LDP1    LBL1$,,AUTO
         2 001275   100001 236106                    LDQ     1,QL,PR1
         2 001276   000025 676000 1                  ERQ     E_WRONGFILE+7
         2 001277   000027 376000 3                  ANQ     23
         2 001300   001315 600000 2                  TZE     s:8597
         2 001301   200012 236100                    LDQ     I,,AUTO
         2 001302   000024 402007                    MPY     20,DL
         2 001303   100001 236106                    LDQ     1,QL,PR1
         2 001304   000026 676000 1                  ERQ     E_WRONGFILE+8
         2 001305   000027 376000 3                  ANQ     23
         2 001306   001315 600000 2                  TZE     s:8597
         2 001307   200012 236100                    LDQ     I,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:124  
         2 001310   000024 402007                    MPY     20,DL
         2 001311   100001 236106                    LDQ     1,QL,PR1
         2 001312   000027 676000 1                  ERQ     E_WRONGFILE+9
         2 001313   000027 376000 3                  ANQ     23
         2 001314   001347 601000 2                  TNZ     s:8607

      563     8594    4                        OR VLP_ULBL.ULBLFIELD.LABELID(I) = 'UHL'
      564     8595    4                        OR VLP_ULBL.ULBLFIELD.LABELID(I) = 'UTL'
      565     8596    5                    THEN DO;               /* User label                         */

      566     8597    5                       IF F$DCB.ARS < 80

   8597  2 001315   000000 235100                    LDA     0,,PR0
         2 001316   000120 115007                    CMPA    80,DL
         2 001317   001342 605000 2                  TPL     s:8603

      567     8598    6                       THEN DO;            /* Blank fill label                   */

      568     8599    6                          N = 80 - F$DCB.ARS; /* Calc # fill bytes               */

   8599  2 001320   000000 235100                    LDA     0,,PR0
         2 001321   000027 675000 xsym               ERA     B_VECTNIL+23
         2 001322   000121 035007                    ADLA    81,DL
         2 001323   200017 755100                    STA     N,,AUTO

      569     8600    6                          LBL2$ = PINCRC( ADDR(VLP_ULBL.ULBL#(I)), F$DCB.ARS );

   8600  2 001324   000000 236100                    LDQ     0,,PR0
         2 001325   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 001326   200012 236100                    LDQ     I,,AUTO
         2 001327   000120 402007                    MPY     80,DL
         2 001330   200046 036100                    ADLQ    @ALBL$+2,,AUTO
         2 001331   000020 736000                    QLS     16
         2 001332   000001 036003                    ADLQ    1,DU
         2 001333   200014 036100                    ADLQ    LBL1$,,AUTO
         2 001334   200015 756100                    STQ     LBL2$,,AUTO

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:125  
      570     8601    6                          LBL2$->NCHARS = ' '; /* Blank fill missing area        */

   8601  2 001335   200015 473500                    LDP3    LBL2$,,AUTO
         2 001336   200017 720100                    LXL0    N,,AUTO
         2 001337   040140 100400                    MLR     fill='040'O
         2 001340   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001341   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      571     8602    6                          END;

      572     8603    5                       I = I + 1;          /* Count user label                   */

   8603  2 001342   200012 054100                    AOS     I,,AUTO

      573     8604    5                       END;

      574     8605    4                    END;

   8605  2 001343   001347 710000 2                  TRA     s:8607

      575     8606    3                 ELSE NUM = I;             /* Done reading labels                */

   8606  2 001344   200005 471500                    LDP1    @NUM,,AUTO
         2 001345   200012 235100                    LDA     I,,AUTO
         2 001346   100000 755100                    STA     0,,PR1

      576     8607    3                 END;

   8607  2 001347   200005 470500                    LDP0    @NUM,,AUTO
         2 001350   200012 236100                    LDQ     I,,AUTO
         2 001351   000000 116100                    CMPQ    0,,PR0
         2 001352   001357 605000 2                  TPL     s:8608
         2 001353   200011 471500                    LDP1    JDCB$,,AUTO
         2 001354   100002 236100                    LDQ     2,,PR1
         2 001355   004000 316003                    CANQ    2048,DU
         2 001356   001253 600000 2                  TZE     s:8590

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:126  
      577     8608    2              VLP_ULBL.NUM# = I;

   8608  2 001357   200014 471500                    LDP1    LBL1$,,AUTO
         2 001360   200012 235100                    LDA     I,,AUTO
         2 001361   100000 755100                    STA     0,,PR1

      578     8609    2              END;

      579     8610    1           NUM = I;                        /* Return # labels read               */

   8610  2 001362   200005 470500                    LDP0    @NUM,,AUTO
         2 001363   200012 235100                    LDA     I,,AUTO
         2 001364   000000 755100                    STA     0,,PR0

      580     8611
      581     8612         /***
      582     8613          *** If label reading terminated because user buffer was exhausted,
      583     8614          *** position after the file mark.  Translate labels if necessary.
      584     8615          ***/
      585     8616
      586     8617    1           IF NOT F$DCB.TYC.EOF(1)

   8617  2 001365   200011 471500                    LDP1    JDCB$,,AUTO
         2 001366   100002 236100                    LDQ     2,,PR1
         2 001367   004000 316003                    CANQ    2048,DU
         2 001370   001401 601000 2                  TNZ     s:8623

      587     8618    2           THEN DO;           /* User buffer exhausted...position past file mark */

      588     8619    2              F$DCB.ARS = 1;

   8619  2 001371   000001 235007                    LDA     1,DL
         2 001372   100000 755100                    STA     0,,PR1

      589     8620    2              CALL FTI$SPFILE ALTRET(JUSTALT);

   8620  2 001373   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:127  
         2 001374   000000 701000 xent               TSX1    FTI$SPFILE
         2 001375   006767 702000 2                  TSX2    JUSTALT

      590     8621    2              F$DCB.TYC.EOF(1) = %YES#;    /* Indicate file mark passed          */

   8621  2 001376   200011 470500                    LDP0    JDCB$,,AUTO
         2 001377   004000 236003                    LDQ     2048,DU
         2 001400   000002 256100                    ORSQ    2,,PR0

      591     8622    2              END;

      592     8623    1           RETURN;

   8623  2 001401   000000 702200 xent               TSX2  ! X66_ARET

      593     8624
      594     8625        /*********************************************************************/
      595     8626        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:128  
      596     8627        /*********************************************************************/
      597     8628    1   FTL$CLOSE: ENTRY(THELBL,LBL$,NUM,ULBL$,UNUM) ALTRET;

   8628  2 001402   000000 700200 xent  FTL$CLOSE    TSX0  ! X66_AUTO_5
         2 001403   000052 000005                    ZERO    42,5

      598     8629        /*F*     NAME: FTL$CLOSE
      599     8630                 PURPOSE: Process labels on labelled tape close.
      600     8631                 INPUT: NUM - number of parameter segment describing user trailing
      601     8632                          label buffer
      602     8633                    LBL$ - points to user label group
      603     8634                 OUTPUT: THELBL - type of label encountered last
      604     8635                 DESCRIPTION: If no EOF labels have yet been written (DCB.NOEOF)
      605     8636                    the current buffer is trunced, a file mark written and then
      606     8637                    EOF labels written.  If the file has EOF labels written,
      607     8638                    the end of the file is positioned to and block count checked.
      608     8639                    If the file has been modified, it is assumed that the trailing
      609     8640                    label buffer contains UTL labels to write after the EOF
      610     8641                    labels.  If not modified, any UTL labels present on the
      611     8642                    tape are read into the label buffer.  Two file marks are
      612     8643                    written for modified files.  Position is left following the
      613     8644                    file mark following the EOF/UTL label group.
      614     8645         ***/
      615     8646
      616     8647        /********************/
      617     8648
      618     8649         /***
      619     8650          *** If we already have an blocking FPOOL buffer, we can use it for label
      620     8651          *** processing after the trunc.
      621     8652          ***/
      622     8653
      623     8654    1           JDCB$ = B$JIT.DCB$;

   8654  2 001404   000000 470400 xsym               LDP0    B$JIT$
         2 001405   000232 236100                    LDQ     154,,PR0
         2 001406   200011 756100                    STQ     JDCB$,,AUTO

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:129  
      624     8655    1           IF F$DCB.CBUFNUM > 0 AND F$DCB.LPOOL = 0

   8655  2 001407   200011 471500                    LDP1    JDCB$,,AUTO
         2 001410   100070 236100                    LDQ     56,,PR1
         2 001411   700000 316003                    CANQ    -32768,DU
         2 001412   001425 600000 2                  TZE     s:8664
         2 001413   100067 236100                    LDQ     55,,PR1
         2 001414   070000 316003                    CANQ    28672,DU
         2 001415   001425 601000 2                  TNZ     s:8664

      625     8656    1           THEN F$DCB.LPOOL = F$DCB.CBUFNUM + 1; /* Set for LBLINIT              */

   8656  2 001416   100070 236100                    LDQ     56,,PR1
         2 001417   000041 772000                    QRL     33
         2 001420   000001 036007                    ADLQ    1,DL
         2 001421   000036 736000                    QLS     30
         2 001422   100067 676100                    ERQ     55,,PR1
         2 001423   070000 376003                    ANQ     28672,DU
         2 001424   100067 656100                    ERSQ    55,,PR1

      626     8657
      627     8658         /***
      628     8659          *** If EOF labels are necessary, write them.
      629     8660          *** If file has not been modified, process EOF
      630     8661          *** label (check block count).
      631     8662          ***/
      632     8663
      633     8664    1           CALL FTL_LBLINIT ALTRET(JUSTALT);

   8664  2 001425   006665 701000 2                  TSX1    FTL_LBLINIT
         2 001426   006767 702000 2                  TSX2    JUSTALT

      634     8665    1           IF (F$DCB.NOEOF) OR             /* EOF labels are necessary  or       */

   8665  2 001427   200011 470500                    LDP0    JDCB$,,AUTO
         2 001430   000064 236100                    LDQ     52,,PR0
         2 001431   400000 316007                    CANQ    -131072,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:130  
         2 001432   001436 601000 2                  TNZ     s:8667
         2 001433   200007 471500                    LDP1    @UNUM,,AUTO
         2 001434   100000 235100                    LDA     0,,PR1
         2 001435   001516 600000 2                  TZE     s:8683

      635     8666    2               (UNUM ~= 0) THEN DO;        /* EOF labels are requested           */

      636     8667    3              IF NOT F$DCB.TAPTYP.USRBUF THEN DO;

   8667  2 001436   000067 236100                    LDQ     55,,PR0
         2 001437   000100 316003                    CANQ    64,DU
         2 001440   001457 601000 2                  TNZ     s:8675

      637     8668                               /* Trunc FPOOL buffer but hold it for label processing */
      638     8669    3                 IF F$DCB.IASN = %OD# THEN

   8669  2 001441   000103 236100                    LDQ     67,,PR0
         2 001442   000777 376007                    ANQ     511,DL
         2 001443   000012 116007                    CMPQ    10,DL
         2 001444   001451 601000 2                  TNZ     s:8672

      639     8670    3                    CALL FTW$TRNCOD ALTRET(JUSTALT);

   8670  2 001445   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001446   000000 701000 xent               TSX1    FTW$TRNCOD
         2 001447   006767 702000 2                  TSX2    JUSTALT
         2 001450   001454 710000 2                  TRA     s:8673

      640     8671    3                 ELSE
      641     8672    3                    CALL FTW$TRNCHLD ALTRET(JUSTALT);

   8672  2 001451   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001452   000000 701000 xent               TSX1    FTW$TRNCHLD
         2 001453   006767 702000 2                  TSX2    JUSTALT

      642     8673    3                 F$DCB.CBUFNUM = 0;        /* No blocking FPOOL buffer           */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:131  
   8673  2 001454   200011 470500                    LDP0    JDCB$,,AUTO
         2 001455   000030 236000 3                  LDQ     24
         2 001456   000070 356100                    ANSQ    56,,PR0

      643     8674    3                 END;

      644     8675    2              IF F$DCB.IASN ~= %OD# THEN

   8675  2 001457   000103 236100                    LDQ     67,,PR0
         2 001460   000777 376007                    ANQ     511,DL
         2 001461   000012 116007                    CMPQ    10,DL
         2 001462   001466 600000 2                  TZE     s:8677

      645     8676    2                 CALL FTI$WRFM ALTRET(JUSTALT); /* Write file mark               */

   8676  2 001463   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001464   000000 701000 xent               TSX1    FTI$WRFM
         2 001465   006767 702000 2                  TSX2    JUSTALT

      646     8677    2              IF F$DCB.ORG = %RESTRICT# AND NOT F$DCB.TAPTYP.CP6F THEN

   8677  2 001466   200011 470500                    LDP0    JDCB$,,AUTO
         2 001467   000032 236100                    LDQ     26,,PR0
         2 001470   777000 376003                    ANQ     -512,DU
         2 001471   022000 116003                    CMPQ    9216,DU
         2 001472   001503 601000 2                  TNZ     s:8680
         2 001473   000067 236100                    LDQ     55,,PR0
         2 001474   000200 316003                    CANQ    128,DU
         2 001475   001503 601000 2                  TNZ     s:8680

      647     8678    2                 CALL FTL$LBLS( THELBL ) ALTRET(JUSTALT); /* FITless RESTRICT    */

   8678  2 001476   200003 630500                    EPPR0   @THELBL,,AUTO
         2 001477   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001500   000130 701000 2                  TSX1    s:8330
         2 001501   006767 702000 2                  TSX2    JUSTALT
         2 001502   001676 710000 2                  TRA     s:8727
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:132  

      648     8679    2              ELSE
      649     8680    2                 CALL FTL$LBLS( THELBL, ADDR(NIL) ) ALTRET(JUSTALT);

   8680  2 001503   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001504   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 001505   200046 631500                    EPPR1   @ALBL$+2,,AUTO
         2 001506   200051 451500                    STP1    @ALBL$+5,,AUTO
         2 001507   200003 236100                    LDQ     @THELBL,,AUTO
         2 001510   200050 756100                    STQ     @ALBL$+4,,AUTO
         2 001511   200050 630500                    EPPR0   @ALBL$+4,,AUTO
         2 001512   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001513   000130 701000 2                  TSX1    s:8330
         2 001514   006767 702000 2                  TSX2    JUSTALT

      650     8681    2              END;

   8681  2 001515   001676 710000 2                  TRA     s:8727

      651     8682    2           ELSE DO;                        /* Process EOF label                  */

      652     8683    2              IF F$DCB.IASN = %OD# AND F$DCB.FUN = %IN# THEN /* If optical disk, */

   8683  2 001516   000103 236100                    LDQ     67,,PR0
         2 001517   000777 376007                    ANQ     511,DL
         2 001520   000012 116007                    CMPQ    10,DL
         2 001521   001531 601000 2                  TNZ     s:8685
         2 001522   000032 236100                    LDQ     26,,PR0
         2 001523   000777 376003                    ANQ     511,DU
         2 001524   000002 116003                    CMPQ    2,DU
         2 001525   001531 601000 2                  TNZ     s:8685

      653     8684    2                 CALL FPO$CLOSEIN ALTRET(JUSTALT); /* tell controller about close. */

   8684  2 001526   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001527   000000 701000 xent               TSX1    FPO$CLOSEIN
         2 001530   006767 702000 2                  TSX2    JUSTALT
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:133  

      654     8685    3              IF F$DCB.ASN = %DEVICE# OR F$DCB.IASN = %OD# THEN DO;

   8685  2 001531   200011 470500                    LDP0    JDCB$,,AUTO
         2 001532   000032 236100                    LDQ     26,,PR0
         2 001533   777000 376007                    ANQ     -512,DL
         2 001534   003000 116007                    CMPQ    1536,DL
         2 001535   001542 600000 2                  TZE     s:8687
         2 001536   000103 236100                    LDQ     67,,PR0
         2 001537   000777 376007                    ANQ     511,DL
         2 001540   000012 116007                    CMPQ    10,DL
         2 001541   001547 601000 2                  TNZ     s:8690

      655     8686                                                /* No labels, etc. needed for device  */
      656     8687    3                 THELBL = 'EOF';           /* and optical disk closes.           */

   8687  2 001542   200003 471500                    LDP1    @THELBL,,AUTO
         2 001543   040100 100400                    MLR     fill='040'O
         2 001544   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 001545   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3

      657     8688    3                 RETURN;

   8688  2 001546   000000 702200 xent               TSX2  ! X66_ARET

      658     8689    3                 END;
      659     8690    3              IF FT$DDT.POS ~= FTP_CHK# THEN DO; /* Not already at EOF label     */

   8690  2 001547   200010 471500                    LDP1    DDDT$,,AUTO
         2 001550   100006 236100                    LDQ     6,,PR1
         2 001551   000160 376007                    ANQ     112,DL
         2 001552   000120 116007                    CMPQ    80,DL
         2 001553   001623 600000 2                  TZE     s:8705

      660     8691    4                 IF F$DCB.FUN = %IN# AND LBL$ = ADDR(NIL) THEN DO;

   8691  2 001554   000032 236100                    LDQ     26,,PR0
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:134  
         2 001555   000777 376003                    ANQ     511,DU
         2 001556   000002 116003                    CMPQ    2,DU
         2 001557   001567 601000 2                  TNZ     s:8695
         2 001560   200004 473500                    LDP3    @LBL$,,AUTO
         2 001561   300000 236100                    LDQ     0,,PR3
         2 001562   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001563   001567 601000 2                  TNZ     s:8695

      661     8692    4                    FT$DDT.NOTEOF = '1'B;  /* Remember we're not at EOF.         */

   8692  2 001564   200000 236007                    LDQ     65536,DL
         2 001565   100007 256100                    ORSQ    7,,PR1

      662     8693    4                    RETURN;

   8693  2 001566   000000 702200 xent               TSX2  ! X66_ARET

      663     8694    4                    END;
      664     8695    4                 DO WHILE(FT$DDT.POS = FTP_BOD#); /* Space to EOF/EOV label.     */

   8695  2 001567   100006 236100                    LDQ     6,,PR1
         2 001570   000160 376007                    ANQ     112,DL
         2 001571   000060 116007                    CMPQ    48,DL
         2 001572   001620 601000 2                  TNZ     s:8702

      665     8696    4                    F$DCB.ARS = 65500;

   8696  2 001573   177734 235007                    LDA     65500,DL
         2 001574   200011 470500                    LDP0    JDCB$,,AUTO
         2 001575   000000 755100                    STA     0,,PR0

      666     8697    4                    CALL FTI$SPREC ALTRET(JUSTALT);

   8697  2 001576   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001577   000000 701000 xent               TSX1    FTI$SPREC
         2 001600   006767 702000 2                  TSX2    JUSTALT

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:135  
      667     8698    4                   F$DCB.PRECNO = F$DCB.PRECNO + F$DCB.ARS; /* Count blocks skipped */

   8698  2 001601   200011 470500                    LDP0    JDCB$,,AUTO
         2 001602   000072 236100                    LDQ     58,,PR0
         2 001603   000000 036100                    ADLQ    0,,PR0
         2 001604   000072 756100                    STQ     58,,PR0

      668     8699    4                    IF F$DCB.TYC.EOF(1) THEN

   8699  2 001605   000002 236100                    LDQ     2,,PR0
         2 001606   004000 316003                    CANQ    2048,DU
         2 001607   001613 600000 2                  TZE     s:8701

      669     8700    4                       FT$DDT.POS = FTP_UND#;

   8700  2 001610   200010 471500                    LDP1    DDDT$,,AUTO
         2 001611   000003 236000 3                  LDQ     3
         2 001612   100006 356100                    ANSQ    6,,PR1

      670     8701    4                    END;

   8701  2 001613   200010 471500                    LDP1    DDDT$,,AUTO
         2 001614   100006 236100                    LDQ     6,,PR1
         2 001615   000160 376007                    ANQ     112,DL
         2 001616   000060 116007                    CMPQ    48,DL
         2 001617   001573 600000 2                  TZE     s:8696

      671     8702    3                 CALL FTL_CHKEOX ALTRET(JUSTALT); /* Check EOF/EOV label         */

   8702  2 001620   006535 701000 2                  TSX1    FTL_CHKEOX
         2 001621   006767 702000 2                  TSX2    JUSTALT

      672     8703    3                 END;

   8703  2 001622   001645 710000 2                  TRA     s:8714

      673     8704    3              ELSE DO;                     /* Already have EOF label             */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:136  

      674     8705    4                 IF F$DCB.TRNC ~= FT_NOTRUNC# THEN DO; /* Lost our EOF1 label... */

   8705  2 001623   000064 236100                    LDQ     52,,PR0
         2 001624   000014 316007                    CANQ    12,DL
         2 001625   001635 600000 2                  TZE     s:8710

      675     8706    4                    F$DCB.ARS = -1;        /*         ...get it back.            */

   8706  2 001626   000001 335007                    LCA     1,DL
         2 001627   000000 755100                    STA     0,,PR0

      676     8707    4                    CALL FTI$SPREC ALTRET(JUSTALT);

   8707  2 001630   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001631   000000 701000 xent               TSX1    FTI$SPREC
         2 001632   006767 702000 2                  TSX2    JUSTALT

      677     8708    4                    CALL FTL_CHKEOX ALTRET(JUSTALT);

   8708  2 001633   006535 701000 2                  TSX1    FTL_CHKEOX
         2 001634   006767 702000 2                  TSX2    JUSTALT

      678     8709    4                    END;

      679     8710    3                 CALL FTL_CHKBLKCNT;

   8710  2 001635   006631 701000 2                  TSX1    FTL_CHKBLKCNT
         2 001636   000000 011000                    NOP     0

      680     8711    3                 THELBL = 'EOF';

   8711  2 001637   200003 470500                    LDP0    @THELBL,,AUTO
         2 001640   040100 100400                    MLR     fill='040'O
         2 001641   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 001642   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:137  
      681     8712    3                 F$DCB.TYC(1) = '0'B;      /* Clear from last read               */

   8712  2 001643   200011 471500                    LDP1    JDCB$,,AUTO
         2 001644   100002 450100                    STZ     2,,PR1

      682     8713    3                 END;

      683     8714    3              DO WHILE ( THELBL ~= 'EOF' ); /* Find last file section            */

   8714  2 001645   200003 470500                    LDP0    @THELBL,,AUTO
         2 001646   040000 106500                    CMPC    fill='040'O
         2 001647   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         2 001650   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 001651   001676 600000 2                  TZE     s:8727

      684     8715    3                 CALL FTL_PBNFS ALTRET(JUSTALT);
              8715                          /* Position to beginning of next sect */

   8715  2 001652   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001653   200042 756100                    STQ     @UHL$+1,,AUTO
         2 001654   200041 756100                    STQ     DT1+5,,AUTO
         2 001655   005441 701000 2                  TSX1    FTL_PBNFS
         2 001656   006767 702000 2                  TSX2    JUSTALT

      685     8716    3                 F$DCB.ARS = 1;            /* Skip to next EOx labels            */

   8716  2 001657   000001 235007                    LDA     1,DL
         2 001660   200011 470500                    LDP0    JDCB$,,AUTO
         2 001661   000000 755100                    STA     0,,PR0

      686     8717    3                 CALL FTI$SPFILE ALTRET(JUSTALT);

   8717  2 001662   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001663   000000 701000 xent               TSX1    FTI$SPFILE
         2 001664   006767 702000 2                  TSX2    JUSTALT

      687     8718    3                 CALL FTL_CHKEOX ALTRET(JUSTALT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:138  

   8718  2 001665   006535 701000 2                  TSX1    FTL_CHKEOX
         2 001666   006767 702000 2                  TSX2    JUSTALT

      688     8719    3                 B$JIT.ERR = '0'B;      /* Different section--ignore block count */

   8719  2 001667   000000 470400 xsym               LDP0    B$JIT$
         2 001670   000012 450100                    STZ     10,,PR0

      689     8720    3                 END;

   8720  2 001671   200003 471500                    LDP1    @THELBL,,AUTO
         2 001672   040000 106500                    CMPC    fill='040'O
         2 001673   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 001674   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 001675   001652 601000 2                  TNZ     s:8715

      690     8721    2              END;

      691     8722         /***
      692     8723          *** If file has been modified, write trailing labels if specified. If
      693     8724          *** not, get any trailing labels.
      694     8725          ***/
      695     8726
      696     8727    1           N = 0;                          /* Assume no UTLs                     */

   8727  2 001676   200017 450100                    STZ     N,,AUTO

      697     8728    1           IF NUM > 0

   8728  2 001677   200005 470500                    LDP0    @NUM,,AUTO
         2 001700   000000 235100                    LDA     0,,PR0
         2 001701   001712 604400 2                  TMOZ    NOUTL

      698     8729    1           THEN CALL HFF$DSIZ(NUM,N) ALTRET(NOUTL); /* Get # bytes in label area */

   8729  2 001702   200017 631500                    EPPR1   N,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:139  
         2 001703   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 001704   200005 236100                    LDQ     @NUM,,AUTO
         2 001705   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 001706   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 001707   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001710   000000 701000 xent               TSX1    HFF$DSIZ
         2 001711   001712 702000 2                  TSX2    NOUTL

   8728  2 001712                       NOUTL        null
      699     8730    1   NOUTL:  ;
      700     8731    2           IF F$DCB.IASN ~= %OD# THEN DO;

   8731  2 001712   200011 470500                    LDP0    JDCB$,,AUTO
         2 001713   000103 236100                    LDQ     67,,PR0
         2 001714   000777 376007                    ANQ     511,DL
         2 001715   000012 116007                    CMPQ    10,DL
         2 001716   001764 600000 2                  TZE     s:8749

      701     8732    3              IF F$DCB.FMOD THEN DO;

   8732  2 001717   000064 236100                    LDQ     52,,PR0
         2 001720   040000 316003                    CANQ    16384,DU
         2 001721   001753 600000 2                  TZE     s:8746

      702     8733                                               /* Write user trailing labels (if any) */
      703     8734    4                 IF F$DCB.NOEOF THEN DO;

   8734  2 001722   400000 316007                    CANQ    -131072,DL
         2 001723   001744 600000 2                  TZE     s:8740

      704     8735    4                    CALL FTL$ULBLS('UTL',LBL$,N) ALTRET(JUSTALT);

   8735  2 001724   200017 631500                    EPPR1   N,,AUTO
         2 001725   200050 451500                    STP1    @ALBL$+4,,AUTO
         2 001726   200004 236100                    LDQ     @LBL$,,AUTO
         2 001727   000031 235000 3                  LDA     25
         2 001730   200046 757100                    STAQ    @ALBL$+2,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:140  
         2 001731   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 001732   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001733   001125 701000 2                  TSX1    s:8514
         2 001734   006767 702000 2                  TSX2    JUSTALT

      705     8736    4                    CALL FTI$WRFM ALTRET(JUSTALT); /* Write end of tape marks    */

   8736  2 001735   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001736   000000 701000 xent               TSX1    FTI$WRFM
         2 001737   006767 702000 2                  TSX2    JUSTALT

      706     8737    4                    FT$DDT.FMNEEDED = %YES#; /* File mark is needed              */

   8737  2 001740   200010 470500                    LDP0    DDDT$,,AUTO
         2 001741   000200 236007                    LDQ     128,DL
         2 001742   000006 256100                    ORSQ    6,,PR0

      707     8738    4                    END;

   8738  2 001743   001764 710000 2                  TRA     s:8749

      708     8739    4                 ELSE DO;                  /* No user labels to get              */

      709     8740    4                    F$DCB.ARS = 1;         /* Position to next HDR group         */

   8740  2 001744   000001 235007                    LDA     1,DL
         2 001745   000000 755100                    STA     0,,PR0

      710     8741    4                    CALL FTI$SPFILE ALTRET(JUSTALT);

   8741  2 001746   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001747   000000 701000 xent               TSX1    FTI$SPFILE
         2 001750   006767 702000 2                  TSX2    JUSTALT

      711     8742    4                    N = 0;

   8742  2 001751   200017 450100                    STZ     N,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:141  

      712     8743    4                    END;

      713     8744    3                 END;

   8744  2 001752   001764 710000 2                  TRA     s:8749

      714     8745    2              ELSE
      715     8746    2                 CALL FTL$GETULBLS( THELBL, LBL$, N ) ALTRET(JUSTALT);

   8746  2 001753   200017 631500                    EPPR1   N,,AUTO
         2 001754   200050 451500                    STP1    @ALBL$+4,,AUTO
         2 001755   200004 236100                    LDQ     @LBL$,,AUTO
         2 001756   200003 235100                    LDA     @THELBL,,AUTO
         2 001757   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 001760   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 001761   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001762   001225 701000 2                  TSX1    s:8560
         2 001763   006767 702000 2                  TSX2    JUSTALT

      716     8747    2              END;

      717     8748                                                /* Get user trailing labels (if any)  */
      718     8749    1           NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_HDR#;

   8749  2 001764   200011 470500                    LDP0    JDCB$,,AUTO
         2 001765   000051 720100                    LXL0    41,,PR0
         2 001766   000000 471400 xsym               LDP1    N$DCT$$
         2 001767   100000 473510                    LDP3    0,X0,PR1
         2 001770   300004 474500                    LDP4    4,,PR3
         2 001771   400006 236100                    LDQ     6,,PR4
         2 001772   000003 376000 3                  ANQ     3
         2 001773   000040 276007                    ORQ     32,DL
         2 001774   400006 756100                    STQ     6,,PR4

      719     8750    1           F$DCB.NOEOF = %NO#;             /* EOF labels written                 */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:142  
   8750  2 001775   000032 236000 3                  LDQ     26
         2 001776   000064 356100                    ANSQ    52,,PR0

      720     8751    1           RETURN;

   8751  2 001777   000000 702200 xent               TSX2  ! X66_ARET

      721     8752
      722     8753        /*********************************************************************/
      723     8754        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:143  
      724     8755        /*********************************************************************/
      725     8756    1   FTL$CVOL: ENTRY(THELBL,LBL$,NUM,ULBL$,UNUM) ALTRET;

   8756  2 002000   000000 700200 xent  FTL$CVOL     TSX0  ! X66_AUTO_5
         2 002001   000052 000005                    ZERO    42,5

      726     8757        /*F*     NAME: FTL$CVOL
      727     8758                 PURPOSE: Process end of file (section).
      728     8759                 INPUT: LBL$ - pointer to UTL VLP_ULBL
      729     8760                    NUM - number of parameter segment of UTL VLP_ULBL
      730     8761                    ULBL$ - pointer to UHL VLP_ULBL (optional)
      731     8762                    UNUM - number of parameter segment of UHL VLP_ULBL (optional)
      732     8763                       On input files, position must be just before data
      733     8764                       section ending file mark.  On output files, position
      734     8765                       must be after last data block of section.
      735     8766                 OUTPUT: THELBL - type of label encountered last
      736     8767                 DESCRIPTION: If no labels have yet been written (DCB>NOEOF)
      737     8768                    a file mark is written followed by EOV labels.  If the
      738     8769                    file has labels, they are read; if an EOF label group, an
      739     8770                    end of file is altreturned and position left before the file
      740     8771                    mark preceeding the EOF label group.  Position is now after
      741     8772                    the EOV labels.  If the file has been modified, it is
      742     8773                    assumed that the label buffer contains labels
      743     8774                    to be written following the EOV labels.  If not modified,
      744     8775                    any UTL labels following the EOV label are read into the
      745     8776                    trailing label buffer.  Position is left following the
      746     8777                    file mark following the EOV/UTL label group.  If the
      747     8778                    file has not been modified, the next section of the file
      748     8779                    is found on the next volume.  If modified, the next volume
      749     8780                    is initialized with VOL1/HDR1/HDR2/UHL/ * and left ready for
      750     8781                    succeeding writes.
      751     8782         ***/
      752     8783
      753     8784        /********************/
      754     8785
      755     8786         /***
      756     8787          *** Before starting output CVOL, make sure that
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:144  
      757     8788          *** there are enough volumes to complete it.
      758     8789          ***/
      759     8790
      760     8791    1           JDCB$ = B$JIT.DCB$;

   8791  2 002002   000000 470400 xsym               LDP0    B$JIT$
         2 002003   000232 236100                    LDQ     154,,PR0
         2 002004   200011 756100                    STQ     JDCB$,,AUTO

      761     8792    1           IF F$DCB.NOEOF                  /* Is this an output CVOL?            */

   8792  2 002005   200011 471500                    LDP1    JDCB$,,AUTO
         2 002006   100064 236100                    LDQ     52,,PR1
         2 002007   400000 316007                    CANQ    -131072,DL
         2 002010   002032 600000 2                  TZE     s:8803

      762     8793    1           THEN IF F$DCB.MAXVOL <= 0    /* Yes. Must volumes be taken from list? */

   8793  2 002011   100043 236100                    LDQ     35,,PR1
         2 002012   000777 316003                    CANQ    511,DU
         2 002013   002032 601000 2                  TNZ     s:8803

      763     8794    1              THEN CALL FTR$GETSN( F$DCB.VOL+1, ADDR(SN) ) ALTRET( VOLOUT );

   8794  2 002014   100043 236100                    LDQ     35,,PR1
         2 002015   000033 772000                    QRL     27
         2 002016   000001 036007                    ADLQ    1,DL
         2 002017   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 002020   200032 633500                    EPPR3   SN,,AUTO
         2 002021   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 002022   200047 634500                    EPPR4   @ALBL$+3,,AUTO
         2 002023   200051 454500                    STP4    @ALBL$+5,,AUTO
         2 002024   200046 635500                    EPPR5   @ALBL$+2,,AUTO
         2 002025   200050 455500                    STP5    @ALBL$+4,,AUTO
         2 002026   200050 630500                    EPPR0   @ALBL$+4,,AUTO
         2 002027   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002030   000000 701000 xent               TSX1    FTR$GETSN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:145  
         2 002031   002540 702000 2                  TSX2    VOLOUT

      764     8795                                /* Yes. Make sure volume there before attempting CVOL */
      765     8796
      766     8797         /***
      767     8798          *** If EOV labels are necessary, write them.
      768     8799          *** If file has not been modified, process EOF or EOV
      769     8800          *** label (check block count).
      770     8801          ***/
      771     8802
      772     8803    1           CALL FTL_LBLINIT ALTRET(JUSTALT);

   8803  2 002032   006665 701000 2                  TSX1    FTL_LBLINIT
         2 002033   006767 702000 2                  TSX2    JUSTALT

      773     8804    1           IF F$DCB.NOEOF

   8804  2 002034   200011 470500                    LDP0    JDCB$,,AUTO
         2 002035   000064 236100                    LDQ     52,,PR0
         2 002036   400000 316007                    CANQ    -131072,DL
         2 002037   002077 600000 2                  TZE     s:8817

      774     8805    2           THEN DO;         /* Output CVOL. End of volume labels/marks necessary */

      775     8806    2              IF F$DCB.IASN ~= %OD# THEN

   8806  2 002040   000103 236100                    LDQ     67,,PR0
         2 002041   000777 376007                    ANQ     511,DL
         2 002042   000012 116007                    CMPQ    10,DL
         2 002043   002047 600000 2                  TZE     s:8808

      776     8807    2                 CALL FTI$WRFM ALTRET (RELLBLPOOL); /* Write file mark           */

   8807  2 002044   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002045   000000 701000 xent               TSX1    FTI$WRFM
         2 002046   002544 702000 2                  TSX2    RELLBLPOOL

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:146  
      777     8808    2              IF F$DCB.ASN = %TAPE# OR F$DCB.IASN = %OD#

   8808  2 002047   200011 470500                    LDP0    JDCB$,,AUTO
         2 002050   000032 236100                    LDQ     26,,PR0
         2 002051   777000 376007                    ANQ     -512,DL
         2 002052   002000 116007                    CMPQ    1024,DL
         2 002053   002060 600000 2                  TZE     s:8809
         2 002054   000103 236100                    LDQ     67,,PR0
         2 002055   000777 376007                    ANQ     511,DL
         2 002056   000012 116007                    CMPQ    10,DL
         2 002057   002065 601000 2                  TNZ     s:8811

      778     8809    2              THEN CALL FTL$LBLS( 'EOV' ) ALTRET( RELLBLPOOL );

   8809  2 002060   000033 630400 3                  EPPR0   27
         2 002061   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002062   000130 701000 2                  TSX1    s:8330
         2 002063   002544 702000 2                  TSX2    RELLBLPOOL
         2 002064   002221 710000 2                  TRA     s:8866

      779     8810    3              ELSE DO;                     /* Managed device tape                */

      780     8811    3                 CALL FTI$WRFM ALTRET(JUSTALT); /* Second file mark              */

   8811  2 002065   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002066   000000 701000 xent               TSX1    FTI$WRFM
         2 002067   006767 702000 2                  TSX2    JUSTALT

      781     8812    3                 F$DCB.ARS = -2;

   8812  2 002070   000002 335007                    LCA     2,DL
         2 002071   200011 470500                    LDP0    JDCB$,,AUTO
         2 002072   000000 755100                    STA     0,,PR0

      782     8813    3                 CALL FTI$SPFILE ALTRET(JUSTALT); /* Position to file end        */

   8813  2 002073   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:147  
         2 002074   000000 701000 xent               TSX1    FTI$SPFILE
         2 002075   006767 702000 2                  TSX2    JUSTALT

      783     8814    3                 END;

      784     8815    2              END;

   8815  2 002076   002221 710000 2                  TRA     s:8866

      785     8816    2           ELSE DO;                        /* Input CVOL. Get EOV (or EOF) label */

      786     8817    2              IF NOT F$DCB.TYC.EOF(1) AND F$DCB.IASN ~= %OD#

   8817  2 002077   000002 236100                    LDQ     2,,PR0
         2 002100   004000 316003                    CANQ    2048,DU
         2 002101   002113 601000 2                  TNZ     s:8822
         2 002102   000103 236100                    LDQ     67,,PR0
         2 002103   000777 376007                    ANQ     511,DL
         2 002104   000012 116007                    CMPQ    10,DL
         2 002105   002113 600000 2                  TZE     s:8822

      787     8818    3              THEN DO;                     /* Not yet after file mark            */

      788     8819    3                 F$DCB.ARS = 1;

   8819  2 002106   000001 235007                    LDA     1,DL
         2 002107   000000 755100                    STA     0,,PR0

      789     8820    3                 CALL FTI$SPFILE ALTRET(RELLBLPOOL);

   8820  2 002110   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002111   000000 701000 xent               TSX1    FTI$SPFILE
         2 002112   002544 702000 2                  TSX2    RELLBLPOOL

      790     8821    3                 END;

      791     8822    2              IF F$DCB.ASN ~= %TAPE#
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:148  

   8822  2 002113   200011 470500                    LDP0    JDCB$,,AUTO
         2 002114   000032 236100                    LDQ     26,,PR0
         2 002115   777000 376007                    ANQ     -512,DL
         2 002116   002000 116007                    CMPQ    1024,DL
         2 002117   002166 600000 2                  TZE     s:8845

      792     8823    3              THEN DO;

      793     8824    3                 IF F$DCB.IASN = %OD#

   8824  2 002120   000103 236100                    LDQ     67,,PR0
         2 002121   000777 376007                    ANQ     511,DL
         2 002122   000012 116007                    CMPQ    10,DL
         2 002123   002155 601000 2                  TNZ     s:8838

      794     8825    4                 THEN DO;                  /* Optical Disc                       */

      795     8826    4                    CALL FPO$RDEOFLBL (LBL1$) ALTRET (RELLBLPOOL);

   8826  2 002124   200014 631500                    EPPR1   LBL1$,,AUTO
         2 002125   200046 451500                    STP1    @ALBL$+2,,AUTO
         2 002126   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 002127   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002130   000000 701000 xent               TSX1    FPO$RDEOFLBL
         2 002131   002544 702000 2                  TSX2    RELLBLPOOL

      796     8827    4                    THELBL = LBL1$->FT$ULBL.LABEL_ID;

   8827  2 002132   200014 470500                    LDP0    LBL1$,,AUTO
         2 002133   200003 471500                    LDP1    @THELBL,,AUTO
         2 002134   040100 100500                    MLR     fill='040'O
         2 002135   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         2 002136   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3

      797     8828    4                    CALL FTL_CHKBLKCNT;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:149  
   8828  2 002137   006631 701000 2                  TSX1    FTL_CHKBLKCNT
         2 002140   000000 011000                    NOP     0

      798     8829    4                    IF B$JIT.ERR

   8829  2 002141   000000 470400 xsym               LDP0    B$JIT$
         2 002142   000012 235100                    LDA     10,,PR0
         2 002143   002145 600000 2                  TZE     s:8831

      799     8830    4                    THEN ALTRETURN;

   8830  2 002144   000000 702200 xent               TSX2  ! X66_AALT

      800     8831    4                    IF THELBL = 'EOF'

   8831  2 002145   200003 471500                    LDP1    @THELBL,,AUTO
         2 002146   040000 106500                    CMPC    fill='040'O
         2 002147   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 002150   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 002151   002221 601000 2                  TNZ     s:8866

      801     8832    5                    THEN DO;

      802     8833    5                       B$JIT.ERR = E_EOF;

   8833  2 002152   000002 236000 1                  LDQ     E_EOF
         2 002153   000012 756100                    STQ     10,,PR0

      803     8834    5                       ALTRETURN;

   8834  2 002154   000000 702200 xent               TSX2  ! X66_AALT

      804     8835    5                       END;
      805     8836    4                    END;
      806     8837    4                 ELSE DO;                  /* Managed device tape                */

      807     8838    4                    F$DCB.ARS = -1;        /* Position to EOF                    */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:150  

   8838  2 002155   000001 335007                    LCA     1,DL
         2 002156   000000 755100                    STA     0,,PR0

      808     8839    4                    CALL FTI$SPFILE ALTRET (JUSTALT);

   8839  2 002157   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002160   000000 701000 xent               TSX1    FTI$SPFILE
         2 002161   006767 702000 2                  TSX2    JUSTALT

      809     8840    4                    B$JIT.ERR = E_EOF; /*E* ERROR: FTL-E$EOF */

   8840  2 002162   000002 236000 1                  LDQ     E_EOF
         2 002163   000000 470400 xsym               LDP0    B$JIT$
         2 002164   000012 756100                    STQ     10,,PR0

      810     8841    4                    ALTRETURN;

   8841  2 002165   000000 702200 xent               TSX2  ! X66_AALT

      811     8842    4                    END;
      812     8843    3                 END;
      813     8844    3              ELSE DO;                     /* Labelled tape                      */

      814     8845    3                 CALL FTL_CHKEOX ALTRET(RELLBLPOOL);
              8845                          /* Check if EOF/EOV label follows */

   8845  2 002166   006535 701000 2                  TSX1    FTL_CHKEOX
         2 002167   002544 702000 2                  TSX2    RELLBLPOOL

      815     8846    3                 IF B$JIT.ERR

   8846  2 002170   000000 470400 xsym               LDP0    B$JIT$
         2 002171   000012 235100                    LDA     10,,PR0
         2 002172   002202 600000 2                  TZE     s:8852

      816     8847    4                 THEN DO;                  /* Block count error                  */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:151  

      817     8848    4                    F$DCB.ARS = -1;        /* Position before file mark          */

   8848  2 002173   000001 336007                    LCQ     1,DL
         2 002174   200011 471500                    LDP1    JDCB$,,AUTO
         2 002175   100000 756100                    STQ     0,,PR1

      818     8849    4                    CALL FTI$SPFILE ALTRET(RELLBLPOOL);

   8849  2 002176   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002177   000000 701000 xent               TSX1    FTI$SPFILE
         2 002200   002544 702000 2                  TSX2    RELLBLPOOL

      819     8850    4                    ALTRETURN;

   8850  2 002201   000000 702200 xent               TSX2  ! X66_AALT

      820     8851    4                    END;
      821     8852    3                 IF THELBL = 'EOF'

   8852  2 002202   200003 471500                    LDP1    @THELBL,,AUTO
         2 002203   040000 106500                    CMPC    fill='040'O
         2 002204   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 002205   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 002206   002221 601000 2                  TNZ     s:8866

      822     8853    4                 THEN DO;                  /* End of file                        */

      823     8854    4                    F$DCB.ARS = -1;        /* Position before file mark          */

   8854  2 002207   000001 336007                    LCQ     1,DL
         2 002210   200011 473500                    LDP3    JDCB$,,AUTO
         2 002211   300000 756100                    STQ     0,,PR3

      824     8855    4                    CALL FTI$SPFILE ALTRET(RELLBLPOOL);

   8855  2 002212   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:152  
         2 002213   000000 701000 xent               TSX1    FTI$SPFILE
         2 002214   002544 702000 2                  TSX2    RELLBLPOOL

      825     8856    4                    B$JIT.ERR = E_EOF; /*E* ERROR: FTL-E$EOF */

   8856  2 002215   000002 236000 1                  LDQ     E_EOF
         2 002216   000000 470400 xsym               LDP0    B$JIT$
         2 002217   000012 756100                    STQ     10,,PR0

      826     8857    4                    ALTRETURN;

   8857  2 002220   000000 702200 xent               TSX2  ! X66_AALT

      827     8858    4                    END;
      828     8859    3                 END;
      829     8860    2              END;
      830     8861
      831     8862         /***
      832     8863          *** Get or write user trailing labels.
      833     8864          ***/
      834     8865
      835     8866    1           N = 0;

   8866  2 002221   200017 450100                    STZ     N,,AUTO

      836     8867    1           IF NUM > 0

   8867  2 002222   200005 470500                    LDP0    @NUM,,AUTO
         2 002223   000000 235100                    LDA     0,,PR0
         2 002224   002235 604400 2                  TMOZ    s:8869

      837     8868    1           THEN CALL HFF$DSIZ(NUM,N) ALTRET(NOCUTL); /* # bytes in UTL group     */

   8868  2 002225   200017 631500                    EPPR1   N,,AUTO
         2 002226   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 002227   200005 236100                    LDQ     @NUM,,AUTO
         2 002230   200046 756100                    STQ     @ALBL$+2,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:153  
         2 002231   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 002232   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002233   000000 701000 xent               TSX1    HFF$DSIZ
         2 002234   002242 702000 2                  TSX2    NOCUTL

      838     8869    1           IF F$DCB.ASN = %TAPE#

   8869  2 002235   200011 470500                    LDP0    JDCB$,,AUTO
         2 002236   000032 236100                    LDQ     26,,PR0
         2 002237   777000 376007                    ANQ     -512,DL
         2 002240   002000 116007                    CMPQ    1024,DL
         2 002241   002317 601000 2                  TNZ     s:8892

      839     8870    2           THEN DO;

   8868  2 002242                       NOCUTL       null
      840     8871    2   NOCUTL:    ;
      841     8872    2              IF F$DCB.FMOD

   8872  2 002242   200011 470500                    LDP0    JDCB$,,AUTO
         2 002243   000064 236100                    LDQ     52,,PR0
         2 002244   040000 316003                    CANQ    16384,DU
         2 002245   002305 600000 2                  TZE     s:8888

      842     8873    3              THEN DO;                    /* Write user trailing labels (if any) */

      843     8874    3                 IF F$DCB.NOEOF

   8874  2 002246   400000 316007                    CANQ    -131072,DL
         2 002247   002276 600000 2                  TZE     s:8883

      844     8875    4                 THEN DO;

      845     8876    4                    CALL FTL$ULBLS('UTL',LBL$,N) ALTRET(RELLBLPOOL);

   8876  2 002250   200017 631500                    EPPR1   N,,AUTO
         2 002251   200050 451500                    STP1    @ALBL$+4,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:154  
         2 002252   200004 236100                    LDQ     @LBL$,,AUTO
         2 002253   000031 235000 3                  LDA     25
         2 002254   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 002255   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 002256   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002257   001125 701000 2                  TSX1    s:8514
         2 002260   002544 702000 2                  TSX2    RELLBLPOOL

      846     8877    4                    CALL FTI$WRFM ALTRET(RELLBLPOOL); /* Write end of tape marks */

   8877  2 002261   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002262   000000 701000 xent               TSX1    FTI$WRFM
         2 002263   002544 702000 2                  TSX2    RELLBLPOOL

      847     8878    4                    CALL FTI$WRFM ALTRET(RELLBLPOOL);

   8878  2 002264   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002265   000000 701000 xent               TSX1    FTI$WRFM
         2 002266   002544 702000 2                  TSX2    RELLBLPOOL

      848     8879    4                    F$DCB.ARS = -1;        /* Position before last file mark     */

   8879  2 002267   000001 335007                    LCA     1,DL
         2 002270   200011 470500                    LDP0    JDCB$,,AUTO
         2 002271   000000 755100                    STA     0,,PR0

      849     8880    4                    CALL FTI$SPFILE ALTRET(RELLBLPOOL);

   8880  2 002272   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002273   000000 701000 xent               TSX1    FTI$SPFILE
         2 002274   002544 702000 2                  TSX2    RELLBLPOOL

      850     8881    4                    END;

   8881  2 002275   002327 710000 2                  TRA     s:8895

      851     8882    4                 ELSE DO;                  /* No user labels                     */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:155  

      852     8883    4                    F$DCB.ARS = 1;

   8883  2 002276   000001 235007                    LDA     1,DL
         2 002277   000000 755100                    STA     0,,PR0

      853     8884    4                    CALL FTI$SPFILE ALTRET(RELLBLPOOL);

   8884  2 002300   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002301   000000 701000 xent               TSX1    FTI$SPFILE
         2 002302   002544 702000 2                  TSX2    RELLBLPOOL

      854     8885    4                    N = 0;

   8885  2 002303   200017 450100                    STZ     N,,AUTO

      855     8886    4                    END;

      856     8887    3                 END;

   8887  2 002304   002327 710000 2                  TRA     s:8895

      857     8888    2              ELSE CALL FTL$GETULBLS( THELBL, LBL$, N ) ALTRET(RELLBLPOOL);

   8888  2 002305   200017 631500                    EPPR1   N,,AUTO
         2 002306   200050 451500                    STP1    @ALBL$+4,,AUTO
         2 002307   200004 236100                    LDQ     @LBL$,,AUTO
         2 002310   200003 235100                    LDA     @THELBL,,AUTO
         2 002311   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 002312   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 002313   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002314   001225 701000 2                  TSX1    s:8560
         2 002315   002544 702000 2                  TSX2    RELLBLPOOL

      858     8889                                                /* Get user trailing labels (if any)  */
      859     8890    2              END;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:156  
   8890  2 002316   002327 710000 2                  TRA     s:8895

      860     8891    2           ELSE DO;                        /* Zero returned label count          */

      861     8892    2              IF N > 3

   8892  2 002317   200017 235100                    LDA     N,,AUTO
         2 002320   000003 115007                    CMPA    3,DL
         2 002321   002327 604400 2                  TMOZ    s:8895

      862     8893    2              THEN LBL$->ONE_WORD = 0;

   8893  2 002322   200004 471500                    LDP1    @LBL$,,AUTO
         2 002323   100000 473500                    LDP3    0,,PR1
         2 002324   000100 100400                    MLR     fill='000'O
         2 002325   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         2 002326   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4

      863     8894    2              END;

      864     8895    1           NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_EOV#;

   8895  2 002327   200011 470500                    LDP0    JDCB$,,AUTO
         2 002330   000051 720100                    LXL0    41,,PR0
         2 002331   000000 471400 xsym               LDP1    N$DCT$$
         2 002332   100000 473510                    LDP3    0,X0,PR1
         2 002333   300004 474500                    LDP4    4,,PR3
         2 002334   400006 236100                    LDQ     6,,PR4
         2 002335   000003 376000 3                  ANQ     3
         2 002336   000100 276007                    ORQ     64,DL
         2 002337   400006 756100                    STQ     6,,PR4

      865     8896
      866     8897         /***
      867     8898          *** File section done.
      868     8899          ***/
      869     8900
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:157  
      870     8901    1           N = 0;                          /* Assume no UHLs                     */

   8901  2 002340   200017 450100                    STZ     N,,AUTO

      871     8902    1           IF ADDR(ULBL$) ~= ADDR(NIL)

   8902  2 002341   200006 236100                    LDQ     @ULBL$,,AUTO
         2 002342   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002343   002374 600000 2                  TZE     s:8911

      872     8903    1           THEN IF UNUM > 0

   8903  2 002344   200007 473500                    LDP3    @UNUM,,AUTO
         2 002345   300000 235100                    LDA     0,,PR3
         2 002346   002374 604400 2                  TMOZ    s:8911

      873     8904    2              THEN DO;

      874     8905    2                 CALL HFF$DSIZ(UNUM,N) ALTRET(NOCUHL); /* # bytes in UHL group   */

   8905  2 002347   200017 634500                    EPPR4   N,,AUTO
         2 002350   200047 454500                    STP4    @ALBL$+3,,AUTO
         2 002351   200007 236100                    LDQ     @UNUM,,AUTO
         2 002352   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 002353   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 002354   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002355   000000 701000 xent               TSX1    HFF$DSIZ
         2 002356   002357 702000 2                  TSX2    NOCUHL

   8905  2 002357                       NOCUHL       null
      875     8906    2   NOCUHL:       ;
      876     8907    2                 IF F$DCB.ASN ~= %TAPE#

   8907  2 002357   200011 470500                    LDP0    JDCB$,,AUTO
         2 002360   000032 236100                    LDQ     26,,PR0
         2 002361   777000 376007                    ANQ     -512,DL
         2 002362   002000 116007                    CMPQ    1024,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:158  
         2 002363   002374 600000 2                  TZE     s:8911

      877     8908    2                 THEN IF N > 3

   8908  2 002364   200017 235100                    LDA     N,,AUTO
         2 002365   000003 115007                    CMPA    3,DL
         2 002366   002374 604400 2                  TMOZ    s:8911

      878     8909    2                    THEN ULBL$->ONE_WORD = 0; /* Zero returned label count       */

   8909  2 002367   200006 471500                    LDP1    @ULBL$,,AUTO
         2 002370   100000 473500                    LDP3    0,,PR1
         2 002371   000100 100400                    MLR     fill='000'O
         2 002372   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         2 002373   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4

      879     8910    2                 END;

      880     8911    1           IF F$DCB.NOEOF

   8911  2 002374   000064 236100                    LDQ     52,,PR0
         2 002375   400000 316007                    CANQ    -131072,DL
         2 002376   002505 600000 2                  TZE     s:8937

      881     8912    2           THEN DO;                        /* Write                              */

      882     8913    2              F$DCB.SEZ_OK = %YES#;        /* Scratch ok                         */

   8913  2 002377   000004 236003                    LDQ     4,DU
         2 002400   000064 256100                    ORSQ    52,,PR0

      883     8914    2              CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(RELLBLPOOL);

   8914  2 002401   000043 236100                    LDQ     35,,PR0
         2 002402   000033 772000                    QRL     27
         2 002403   000001 036007                    ADLQ    1,DL
         2 002404   200046 756100                    STQ     @ALBL$+2,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:159  
         2 002405   200046 631500                    EPPR1   @ALBL$+2,,AUTO
         2 002406   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 002407   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 002410   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002411   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 002412   002544 702000 2                  TSX2    RELLBLPOOL

      884     8915    2              DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   8915  2 002413   200011 470500                    LDP0    JDCB$,,AUTO
         2 002414   000051 720100                    LXL0    41,,PR0
         2 002415   000000 471400 xsym               LDP1    N$DCT$$
         2 002416   100000 473510                    LDP3    0,X0,PR1
         2 002417   300004 236100                    LDQ     4,,PR3
         2 002420   200010 756100                    STQ     DDDT$,,AUTO

      885     8916    2              IF F$DCB.ASN = %TAPE#

   8916  2 002421   000032 236100                    LDQ     26,,PR0
         2 002422   777000 376007                    ANQ     -512,DL
         2 002423   002000 116007                    CMPQ    1024,DL
         2 002424   002454 601000 2                  TNZ     s:8926

      886     8917    3              THEN DO;                     /* Labelled tape                      */

      887     8918    3                 F$DCB.FSECT = F$DCB.FSECT + 1; /* Next section                  */

   8918  2 002425   000077 221100                    LDX1    63,,PR0
         2 002426   000001 622011                    EAX2    1,X1
         2 002427   000077 742100                    STX2    63,,PR0

      888     8919    3                 CALL FTL$VOL1 ALTRET(RELLBLPOOL); /* Write VOL1                 */

   8919  2 002430   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002431   000003 701000 2                  TSX1    s:8284
         2 002432   002544 702000 2                  TSX2    RELLBLPOOL

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:160  
      889     8920    3                 CALL FTL$LBLS('HDR') ALTRET(RELLBLPOOL); /* Write HDR1, HDR2    */

   8920  2 002433   000034 630400 3                  EPPR0   28
         2 002434   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002435   000130 701000 2                  TSX1    s:8330
         2 002436   002544 702000 2                  TSX2    RELLBLPOOL

      890     8921    3                 CALL FTL$ULBLS('UHL',ULBL$,N) ALTRET(RELLBLPOOL);

   8921  2 002437   200017 630500                    EPPR0   N,,AUTO
         2 002440   200050 450500                    STP0    @ALBL$+4,,AUTO
         2 002441   200006 236100                    LDQ     @ULBL$,,AUTO
         2 002442   000035 235000 3                  LDA     29
         2 002443   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 002444   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 002445   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002446   001125 701000 2                  TSX1    s:8514
         2 002447   002544 702000 2                  TSX2    RELLBLPOOL

      891     8922                                                /* Write UHLs (if any)                */
      892     8923    3                 CALL FTI$WRFM ALTRET(RELLBLPOOL);

   8923  2 002450   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002451   000000 701000 xent               TSX1    FTI$WRFM
         2 002452   002544 702000 2                  TSX2    RELLBLPOOL

      893     8924    3                 END;

   8924  2 002453   002472 710000 2                  TRA     s:8932

      894     8925    2              ELSE
      895     8926    2                 IF F$DCB.IASN = %OD#

   8926  2 002454   000103 236100                    LDQ     67,,PR0
         2 002455   000777 376007                    ANQ     511,DL
         2 002456   000012 116007                    CMPQ    10,DL
         2 002457   002472 601000 2                  TNZ     s:8932
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:161  

      896     8927    3                 THEN DO;

      897     8928    3                    F$DCB.FSECT = F$DCB.FSECT + 1; /* Next section               */

   8928  2 002460   000077 221100                    LDX1    63,,PR0
         2 002461   000001 622011                    EAX2    1,X1
         2 002462   000077 742100                    STX2    63,,PR0

      898     8929    3                    CALL FTL$LBLS ('HDR') ALTRET (RELLBLPOOL);

   8929  2 002463   000034 630400 3                  EPPR0   28
         2 002464   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002465   000130 701000 2                  TSX1    s:8330
         2 002466   002544 702000 2                  TSX2    RELLBLPOOL

      899     8930    3                    FT$DDT.SCRTCH = %NO#;

   8930  2 002467   200010 470500                    LDP0    DDDT$,,AUTO
         2 002470   000036 236000 3                  LDQ     30
         2 002471   000006 356100                    ANSQ    6,,PR0

      900     8931    3                    END;

      901     8932    2              F$DCB.AFTRBLK = %NO#;        /* Ready to fill next block           */

   8932  2 002472   200011 470500                    LDP0    JDCB$,,AUTO
         2 002473   000037 236000 3                  LDQ     31
         2 002474   000064 356100                    ANSQ    52,,PR0

      902     8933    2              F$DCB.PRECNO = 1;            /* First block of next section        */

   8933  2 002475   000001 235007                    LDA     1,DL
         2 002476   000072 755100                    STA     58,,PR0

      903     8934    2              DDDT$->FT$DDT.POS = FTP_BOD#;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:162  
   8934  2 002477   200010 471500                    LDP1    DDDT$,,AUTO
         2 002500   100006 236100                    LDQ     6,,PR1
         2 002501   000003 376000 3                  ANQ     3
         2 002502   000060 276007                    ORQ     48,DL
         2 002503   100006 756100                    STQ     6,,PR1

      904     8935    2              END;

   8935  2 002504   002513 710000 2                  TRA     s:8940

      905     8936    2           ELSE DO;                /* Reading (managed free tape won't get here) */

      906     8937    2              CALL FTL_PBNFS(ULBL$,N) ALTRET(RELLBLPOOL);

   8937  2 002505   200017 631500                    EPPR1   N,,AUTO
         2 002506   200042 451500                    STP1    @UHL$+1,,AUTO
         2 002507   200006 236100                    LDQ     @ULBL$,,AUTO
         2 002510   200041 756100                    STQ     DT1+5,,AUTO
         2 002511   005441 701000 2                  TSX1    FTL_PBNFS
         2 002512   002544 702000 2                  TSX2    RELLBLPOOL

      907     8938                                             /* Position to beginning of next section */
      908     8939    2              END;

      909     8940    1           F$DCB.MUST_CVOL = %NO#;

   8940  2 002513   200011 470500                    LDP0    JDCB$,,AUTO
         2 002514   000040 236000 3                  LDQ     32
         2 002515   000064 356100                    ANSQ    52,,PR0

      910     8941    1           IF F$DCB.LPOOL > 0

   8941  2 002516   000067 236100                    LDQ     55,,PR0
         2 002517   070000 316003                    CANQ    28672,DU
         2 002520   002537 600000 2                  TZE     s:8946

      911     8942    2           THEN DO;                        /* Have label FPOOL                   */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:163  

      912     8943    2              CALL FMD$RELBUF( F$DCB.LPOOL-1 );

   8943  2 002521   000067 236100                    LDQ     55,,PR0
         2 002522   000036 772000                    QRL     30
         2 002523   000007 376007                    ANQ     7,DL
         2 002524   000001 136007                    SBLQ    1,DL
         2 002525   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 002526   200046 631500                    EPPR1   @ALBL$+2,,AUTO
         2 002527   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 002530   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 002531   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002532   000000 701000 xent               TSX1    FMD$RELBUF
         2 002533   000000 011000                    NOP     0

      913     8944    2              F$DCB.LPOOL = 0;

   8944  2 002534   200011 470500                    LDP0    JDCB$,,AUTO
         2 002535   000041 236000 3                  LDQ     33
         2 002536   000067 356100                    ANSQ    55,,PR0

      914     8945    2              END;

      915     8946    1           RETURN;

   8946  2 002537   000000 702200 xent               TSX2  ! X66_ARET

   8941  2 002540                       VOLOUT       null
      916     8947    1   VOLOUT: ;
      917     8948    1           B$JIT.ERR = E_VOLOUT; /*E* ERROR: FTL-E$VOLOUT */

   8948  2 002540   000015 236000 1                  LDQ     E_VOLOUT
         2 002541   000000 470400 xsym               LDP0    B$JIT$
         2 002542   000012 756100                    STQ     10,,PR0

      918     8949    1           ALTRETURN;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:164  
   8949  2 002543   000000 702200 xent               TSX2  ! X66_AALT

   8948  2 002544                       RELLBLPOOL   null
      919     8950
      920     8951    1   RELLBLPOOL: ;
      921     8952    1           IF F$DCB.LPOOL > 0

   8952  2 002544   200011 470500                    LDP0    JDCB$,,AUTO
         2 002545   000067 236100                    LDQ     55,,PR0
         2 002546   070000 316003                    CANQ    28672,DU
         2 002547   002566 600000 2                  TZE     s:8957

      922     8953    2           THEN DO;                        /* Have label FPOOL                   */

      923     8954    2              CALL FMD$RELBUF( F$DCB.LPOOL-1 );

   8954  2 002550   000067 236100                    LDQ     55,,PR0
         2 002551   000036 772000                    QRL     30
         2 002552   000007 376007                    ANQ     7,DL
         2 002553   000001 136007                    SBLQ    1,DL
         2 002554   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 002555   200046 631500                    EPPR1   @ALBL$+2,,AUTO
         2 002556   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 002557   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 002560   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002561   000000 701000 xent               TSX1    FMD$RELBUF
         2 002562   000000 011000                    NOP     0

      924     8955    2              F$DCB.LPOOL = 0;

   8955  2 002563   200011 470500                    LDP0    JDCB$,,AUTO
         2 002564   000041 236000 3                  LDQ     33
         2 002565   000067 356100                    ANSQ    55,,PR0

      925     8956    2              END;

      926     8957    1           ALTRETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:165  

   8957  2 002566   000000 702200 xent               TSX2  ! X66_AALT

      927     8958
      928     8959        /*********************************************************************/
      929     8960        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:166  
      930     8961        /*********************************************************************/
      931     8962    1   FTL$FINDFILE: ENTRY ALTRET;

   8962  2 002567   000000 700200 xent  FTL$FINDFILE TSX0  ! X66_AUTO_5
         2 002570   000052 000005                    ZERO    42,5

      932     8963        /*F*     NAME: FTL$FINDFILE
      933     8964                 PURPOSE: Find file by name specified by DCB.NAME and DCB.FSECT.
      934     8965                 DESCRIPTION: File name is specified by DCB.NAME.  Section number
      935     8966                    is specified by DCB.FSECT.  If DCB.FSECT is 0 then any file
      936     8967                    section of specified file will do.  The entire volume set is
      937     8968                    searched for a file with specified name.  If such file is not
      938     8969                    found, position is left before the HDR1 of the first section
      939     8970                    of the file on which the search started.  Any scratch volumes
      940     8971                    encountered are assumed to indicate the end of the volume set.
      941     8972                    The search then resumes with the first file on the first volume.
      942     8973                    If no such file is found, FTL$FINDFILE altreturns with
      943     8974                    a E$NOFILE error.  If the wrong file section is found,
      944     8975                    FTL$FINDSEQ is called after DCB.FSN is set with the
      945     8976                    sequence number of the file.  Other possible errors altreturned
      946     8977                    are standard I/O and position lost or volume missing errors.
      947     8978                    The HDR2 may be returned following the HDR1.
      948     8979         ***/
      949     8980
      950     8981        /********************/
      951     8982
      952     8983         /***
      953     8984          *** Initialize for label reading and tape searching.
      954     8985          ***/
      955     8986
      956     8987    1           CALL FTL_LBLINIT ALTRET(JUSTALT);

   8987  2 002571   006665 701000 2                  TSX1    FTL_LBLINIT
         2 002572   006767 702000 2                  TSX2    JUSTALT

      957     8988    1           SAVFSN = 0;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:167  
   8988  2 002573   200022 450100                    STZ     SAVFSN,,AUTO

   8988  2 002574                       DO_FOREVER   null
      958     8989
      959     8990         /***
      960     8991          *** Look for that file...at this point we are always positioned
      961     8992          *** before a HDR1 or before a VOL1.
      962     8993          ***/
      963     8994
      964     8995    1   DO_FOREVER: ;
      965     8996    2           DO WHILE('1'B);

      966     8997    2              CALL FTL_GETNXTHDR ALTRET(JUSTALT); /* Get HDR1                    */

   8997  2 002574   006433 701000 2                  TSX1    FTL_GETNXTHDR
         2 002575   006767 702000 2                  TSX2    JUSTALT

      967     8998
      968     8999         /***
      969     9000            *** We should have just read the HDR1 label of the next file or
      970     9001            *** a file mark indicating end of volume.
      971     9002            ***/
      972     9003
      973     9004    3              IF NOT F$DCB.TYC(1) THEN DO; /* No errors on last read             */

   9004  2 002576   200011 470500                    LDP0    JDCB$,,AUTO
         2 002577   000002 235100                    LDA     2,,PR0
         2 002600   002751 601000 2                  TNZ     s:9065

      974     9005    3                 CALL FTL_CHKLBL('HDR1',LBL1$) ALTRET(JUSTALT); /* Check if HDR1 */

   9005  2 002601   200014 631500                    EPPR1   LBL1$,,AUTO
         2 002602   200044 451500                    STP1    @ALBL+1,,AUTO
         2 002603   000042 236000 3                  LDQ     34
         2 002604   200043 756100                    STQ     @NUHL+1,,AUTO
         2 002605   004443 701000 2                  TSX1    FTL_CHKLBL
         2 002606   006767 702000 2                  TSX2    JUSTALT
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:168  

      975     9006
      976     9007         /***
      977     9008               *** We have a HDR1 label...save info and check file name.
      978     9009               ***/
      979     9010
      980     9011    3                 CALL CHARBIN( THISFSN, LBL1$->FT$LBL1.FSEQU_NUM );

   9011  2 002607   200014 470500                    LDP0    LBL1$,,AUTO
         2 002610   000100 305500                    DTB
         2 002611   000007 630004                    NDSC9   7,,PR0                   cn=3,s=nosgn,sf=0,n=4
         2 002612   200031 000004                    NDSC9   THISFSN,,AUTO            cn=0,s=lsgnf,sf=0,n=4

      981     9012    4                 IF SAVFSN = 0 THEN DO;
              9012                          /* First file encountered...remember to avoid cycling past */

   9012  2 002613   200022 235100                    LDA     SAVFSN,,AUTO
         2 002614   002624 601000 2                  TNZ     s:9017

      982     9013    4                    SAVFSN = THISFSN;

   9013  2 002615   200031 236100                    LDQ     THISFSN,,AUTO
         2 002616   200022 756100                    STQ     SAVFSN,,AUTO

      983     9014    4                    SAVVOL = F$DCB.VOL;

   9014  2 002617   200011 471500                    LDP1    JDCB$,,AUTO
         2 002620   100043 236100                    LDQ     35,,PR1
         2 002621   000033 772000                    QRL     27
         2 002622   200023 756100                    STQ     SAVVOL,,AUTO

      984     9015    4                    END;

   9015  2 002623   002655 710000 2                  TRA     s:9026

      985     9016    3                 ELSE
      986     9017    4                    IF SAVFSN = THISFSN AND SAVVOL = F$DCB.VOL THEN DO;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:169  

   9017  2 002624   200022 236100                    LDQ     SAVFSN,,AUTO
         2 002625   200031 116100                    CMPQ    THISFSN,,AUTO
         2 002626   002655 601000 2                  TNZ     s:9026
         2 002627   200011 471500                    LDP1    JDCB$,,AUTO
         2 002630   100043 236100                    LDQ     35,,PR1
         2 002631   000033 772000                    QRL     27
         2 002632   200023 116100                    CMPQ    SAVVOL,,AUTO
         2 002633   002655 601000 2                  TNZ     s:9026

      987     9018                                                /* Back at starting point             */
      988     9019    4                       F$DCB.ARS = -1;     /* Reposition where we started        */

   9019  2 002634   000001 335007                    LCA     1,DL
         2 002635   100000 755100                    STA     0,,PR1

      989     9020    4                       CALL FTI$SPREC ALTRET(JUSTALT);

   9020  2 002636   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002637   000000 701000 xent               TSX1    FTI$SPREC
         2 002640   006767 702000 2                  TSX2    JUSTALT

      990     9021    4                       B$JIT.ERR = E_NOFILE; /*E* ERROR: FTL-E$NOFILE */

   9021  2 002641   000007 236000 1                  LDQ     E_NOFILE
         2 002642   000000 470400 xsym               LDP0    B$JIT$
         2 002643   000012 756100                    STQ     10,,PR0

      991     9022    4                       FT$DDT.POS = FTP_HDR#; /* Positioned before HDR1          */

   9022  2 002644   200010 471500                    LDP1    DDDT$,,AUTO
         2 002645   100006 236100                    LDQ     6,,PR1
         2 002646   000003 376000 3                  ANQ     3
         2 002647   000040 276007                    ORQ     32,DL
         2 002650   100006 756100                    STQ     6,,PR1

      992     9023    4                       FT$DDT.FSN = THISFSN - 1;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:170  

   9023  2 002651   200031 720100                    LXL0    THISFSN,,AUTO
         2 002652   777777 621010                    EAX1    -1,X0
         2 002653   100005 741100                    STX1    5,,PR1

      993     9024    4                       ALTRETURN;

   9024  2 002654   000000 702200 xent               TSX2  ! X66_AALT

      994     9025    4                       END;
      995     9026    3                 CALL CHARBIN( THISFSECT, LBL1$->FT$LBL1.FSECT );

   9026  2 002655   000100 305500                    DTB
         2 002656   000006 630004                    NDSC9   6,,PR0                   cn=3,s=nosgn,sf=0,n=4
         2 002657   200030 000004                    NDSC9   THISFSECT,,AUTO          cn=0,s=lsgnf,sf=0,n=4

      996     9027    3                 CALL FTL_CHKNAME ALTRET(NOPE);

   9027  2 002660   003167 701000 2                  TSX1    FTL_CHKNAME
         2 002661   002716 702000 2                  TSX2    NOPE

      997     9028
      998     9029         /***
      999     9030                *** File with proper name has been found.
     1000     9031                *** Make sure proper section has been found.
     1001     9032                ***/
     1002     9033
     1003     9034    3                 F$DCB.FSN = THISFSN;      /* Set sequence number                */

   9034  2 002662   200031 720100                    LXL0    THISFSN,,AUTO
         2 002663   200011 470500                    LDP0    JDCB$,,AUTO
         2 002664   000034 740100                    STX0    28,,PR0

     1004     9035    4                 IF F$DCB.FSECT = 0 OR F$DCB.FSECT = THISFSECT THEN DO;

   9035  2 002665   000077 221100                    LDX1    63,,PR0
         2 002666   002673 600000 2                  TZE     s:9037
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:171  
         2 002667   000077 236100                    LDQ     63,,PR0
         2 002670   000022 772000                    QRL     18
         2 002671   200030 116100                    CMPQ    THISFSECT,,AUTO
         2 002672   002712 601000 2                  TNZ     s:9044

     1005     9036                                                /* Specified name found               */
     1006     9037    4                    IF SKIPS = 2 THEN

   9037  2 002673   200025 235100                    LDA     SKIPS,,AUTO
         2 002674   000002 115007                    CMPA    2,DL
         2 002675   002704 601000 2                  TNZ     s:9040

     1007     9038    4                       FT$DDT.POS = FTP_BOD#;

   9038  2 002676   200010 471500                    LDP1    DDDT$,,AUTO
         2 002677   100006 236100                    LDQ     6,,PR1
         2 002700   000003 376000 3                  ANQ     3
         2 002701   000060 276007                    ORQ     48,DL
         2 002702   100006 756100                    STQ     6,,PR1
         2 002703   002711 710000 2                  TRA     s:9041

     1008     9039    4                    ELSE
     1009     9040    4                       FT$DDT.POS = FTP_HDR#;

   9040  2 002704   200010 471500                    LDP1    DDDT$,,AUTO
         2 002705   100006 236100                    LDQ     6,,PR1
         2 002706   000003 376000 3                  ANQ     3
         2 002707   000040 276007                    ORQ     32,DL
         2 002710   100006 756100                    STQ     6,,PR1

     1010     9041    4                    RETURN;

   9041  2 002711   000000 702200 xent               TSX2  ! X66_ARET

     1011     9042    4                    END;
     1012     9043    4                 ELSE DO;                  /* Not proper FSECT but have FSN      */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:172  
     1013     9044    4                    CALL FTL$FINDSEQ ALTRET(JUSTALT); /* Find by sequence number */

   9044  2 002712   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002713   003602 701000 2                  TSX1    s:9287
         2 002714   006767 702000 2                  TSX2    JUSTALT

     1014     9045    4                    RETURN;

   9045  2 002715   000000 702200 xent               TSX2  ! X66_ARET

     1015     9046    4                    END;
     1016     9047
     1017     9048         /***
     1018     9049               *** File names did not match...move on to next file.
     1019     9050               ***/
     1020     9051
     1021     9052    3   NOPE:         ;

   9052  2 002716                       NOPE         null
     1022     9053    3                 FT$DDT.FSN = THISFSN;     /* Remember where we were             */

   9053  2 002716   200031 720100                    LXL0    THISFSN,,AUTO
         2 002717   200010 470500                    LDP0    DDDT$,,AUTO
         2 002720   000005 740100                    STX0    5,,PR0

     1023     9054    3                 IF B$JIT.ERR THEN

   9054  2 002721   000000 471400 xsym               LDP1    B$JIT$
         2 002722   100012 235100                    LDA     10,,PR1
         2 002723   002725 600000 2                  TZE     s:9056

     1024     9055    3                    ALTRETURN;

   9055  2 002724   000000 702200 xent               TSX2  ! X66_AALT

     1025     9056    3                 F$DCB.ARS = SKIPS;        /* Set # file marks to next HDR1      */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:173  
   9056  2 002725   200011 473500                    LDP3    JDCB$,,AUTO
         2 002726   200025 236100                    LDQ     SKIPS,,AUTO
         2 002727   300000 756100                    STQ     0,,PR3

     1026     9057    3                 CALL FTI$SPFILE ALTRET(JUSTALT);

   9057  2 002730   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002731   000000 701000 xent               TSX1    FTI$SPFILE
         2 002732   006767 702000 2                  TSX2    JUSTALT

     1027     9058    4                 IF S$CU$->B$U.ASYNCH & ~ %U_RESET THEN DO; /* Search interrupted */

   9058  2 002733   000003 236000 xsym               LDQ     B_VECTNIL+3
         2 002734   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 002735   000000 470400 xsym               LDP0    S$CU$
         2 002736   000001 376100                    ANQ     1,,PR0
         2 002737   002574 600000 2                  TZE     DO_FOREVER

     1028     9059    4                    FT$DDT.POS = FTP_HDR#;

   9059  2 002740   200010 471500                    LDP1    DDDT$,,AUTO
         2 002741   100006 236100                    LDQ     6,,PR1
         2 002742   000003 376000 3                  ANQ     3
         2 002743   000040 276007                    ORQ     32,DL
         2 002744   100006 756100                    STQ     6,,PR1

     1029     9060    4                    B$JIT.ERR = E_TAPBRK; /*E* ERROR: FTL-E$TAPBRK */

   9060  2 002745   000013 236000 1                  LDQ     E_TAPBRK
         2 002746   000000 473400 xsym               LDP3    B$JIT$
         2 002747   300012 756100                    STQ     10,,PR3

     1030     9061    4                    ALTRETURN;

   9061  2 002750   000000 702200 xent               TSX2  ! X66_AALT

     1031     9062    4                    END;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:174  
     1032     9063    3                 END;
     1033     9064    3              ELSE DO;                     /* Got error on HDR1 label read       */

     1034     9065    3                 IF NOT F$DCB.TYC.EOF(1) THEN

   9065  2 002751   000002 236100                    LDQ     2,,PR0
         2 002752   004000 316003                    CANQ    2048,DU
         2 002753   002755 601000 2                  TNZ     s:9067

     1035     9066    3                    ALTRETURN;

   9066  2 002754   000000 702200 xent               TSX2  ! X66_AALT

     1036     9067    3                 THISFSN = -1;

   9067  2 002755   000001 335007                    LCA     1,DL
         2 002756   200031 755100                    STA     THISFSN,,AUTO

     1037     9068    3                 F$DCB.ARS = -3;         /* Skip to file mark preceeding EOV/EOF */

   9068  2 002757   000003 335007                    LCA     3,DL
         2 002760   000000 755100                    STA     0,,PR0

     1038     9069    3                 CALL FTI$SPFILE ALTRET(JUSTALT);

   9069  2 002761   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002762   000000 701000 xent               TSX1    FTI$SPFILE
         2 002763   006767 702000 2                  TSX2    JUSTALT

     1039     9070    4                 IF F$DCB.TYC.BOT(1) THEN DO; /* Not much of a tape              */

   9070  2 002764   200011 470500                    LDP0    JDCB$,,AUTO
         2 002765   000002 236100                    LDQ     2,,PR0
         2 002766   040000 316003                    CANQ    16384,DU
         2 002767   003006 600000 2                  TZE     s:9078

     1040     9071    4                    F$DCB.ARS = 1;         /* Position before HDR1               */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:175  

   9071  2 002770   000001 235007                    LDA     1,DL
         2 002771   000000 755100                    STA     0,,PR0

     1041     9072    4                    CALL FTI$SPREC ALTRET(JUSTALT);

   9072  2 002772   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002773   000000 701000 xent               TSX1    FTI$SPREC
         2 002774   006767 702000 2                  TSX2    JUSTALT

     1042     9073    4                    FT$DDT.POS = FTP_HDR#;

   9073  2 002775   200010 470500                    LDP0    DDDT$,,AUTO
         2 002776   000006 236100                    LDQ     6,,PR0
         2 002777   000003 376000 3                  ANQ     3
         2 003000   000040 276007                    ORQ     32,DL
         2 003001   000006 756100                    STQ     6,,PR0

     1043     9074    4                    B$JIT.ERR = E_EOSET;

   9074  2 003002   000003 236000 1                  LDQ     E_EOSET
         2 003003   000000 471400 xsym               LDP1    B$JIT$
         2 003004   100012 756100                    STQ     10,,PR1

     1044     9075    4                    ALTRETURN;

   9075  2 003005   000000 702200 xent               TSX2  ! X66_AALT

     1045     9076    4                    END;
     1046     9077    4                 ELSE DO;                  /* Check last EOx label               */

     1047     9078    4                    F$DCB.ARS = 1;         /* Skip to label                      */

   9078  2 003006   000001 235007                    LDA     1,DL
         2 003007   000000 755100                    STA     0,,PR0

     1048     9079    4                    CALL FTI$SPFILE ALTRET(JUSTALT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:176  

   9079  2 003010   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003011   000000 701000 xent               TSX1    FTI$SPFILE
         2 003012   006767 702000 2                  TSX2    JUSTALT

     1049     9080    4                    CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);

   9080  2 003013   200014 630500                    EPPR0   LBL1$,,AUTO
         2 003014   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 003015   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 003016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003017   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 003020   006767 702000 2                  TSX2    JUSTALT

     1050     9081    4                    F$DCB.ARS = 1;        /* Position just before last file mark */

   9081  2 003021   000001 235007                    LDA     1,DL
         2 003022   200011 470500                    LDP0    JDCB$,,AUTO
         2 003023   000000 755100                    STA     0,,PR0

     1051     9082    4                    CALL FTI$SPFILE ALTRET(JUSTALT);

   9082  2 003024   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003025   000000 701000 xent               TSX1    FTI$SPFILE
         2 003026   006767 702000 2                  TSX2    JUSTALT

     1052     9083    4                    FT$DDT.POS = FTP_HDR#;

   9083  2 003027   200010 470500                    LDP0    DDDT$,,AUTO
         2 003030   000006 236100                    LDQ     6,,PR0
         2 003031   000003 376000 3                  ANQ     3
         2 003032   000040 276007                    ORQ     32,DL
         2 003033   000006 756100                    STQ     6,,PR0

     1053     9084    4                    IF LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOV1' THEN
              9084                             /* Must be end of set */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:177  
   9084  2 003034   200014 471500                    LDP1    LBL1$,,AUTO
         2 003035   040000 106500                    CMPC    fill='040'O
         2 003036   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 003037   000033 000004 1                  ADSC9   E_WRONGFILE+13           cn=0,n=4
         2 003040   003045 600000 2                  TZE     s:9089

     1054     9085    4                       B$JIT.ERR = E_VOLOUT; /*E* ERROR: FTL-E$VOLOUT */

   9085  2 003041   000015 236000 1                  LDQ     E_VOLOUT
         2 003042   000000 473400 xsym               LDP3    B$JIT$
         2 003043   300012 756100                    STQ     10,,PR3
         2 003044   003070 710000 2                  TRA     s:9094

     1055     9086                                /* This error will be changed to E$EOSET below unless */
     1056     9087                                        /* the search is to continue (F$DCB.FSN = 0). */
     1057     9088    5                    ELSE DO;               /* Another volume must exist          */

     1058     9089    5                       F$DCB.SEZ_OK = %NO#; /* Say scratch not ok                */

   9089  2 003045   200011 473500                    LDP3    JDCB$,,AUTO
         2 003046   000043 236000 3                  LDQ     35
         2 003047   300064 356100                    ANSQ    52,,PR3

     1059     9090    5                       CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(CHKSCRATCH);

   9090  2 003050   300043 236100                    LDQ     35,,PR3
         2 003051   000033 772000                    QRL     27
         2 003052   000001 036007                    ADLQ    1,DL
         2 003053   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 003054   200046 634500                    EPPR4   @ALBL$+2,,AUTO
         2 003055   200047 454500                    STP4    @ALBL$+3,,AUTO
         2 003056   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 003057   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003060   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 003061   003074 702000 2                  TSX2    CHKSCRATCH

     1060     9091    5                       DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:178  

   9091  2 003062   200011 470500                    LDP0    JDCB$,,AUTO
         2 003063   000051 720100                    LXL0    41,,PR0
         2 003064   000000 471400 xsym               LDP1    N$DCT$$
         2 003065   100000 473510                    LDP3    0,X0,PR1
         2 003066   300004 236100                    LDQ     4,,PR3
         2 003067   200010 756100                    STQ     DDDT$,,AUTO

     1061     9092    5                       END;

     1062     9093    4                    END;

     1063     9094    4                 IF B$JIT.ERR.CODE ~= 0 THEN DO; /* Ran out of "next" volumes    */

   9094  2 003070   000000 470400 xsym               LDP0    B$JIT$
         2 003071   000012 236100                    LDQ     10,,PR0
         2 003072   377770 316007                    CANQ    131064,DL
         2 003073   003160 600000 2                  TZE     s:9122

   9094  2 003074                       CHKSCRATCH   null
     1064     9095    4   CHKSCRATCH:      ;
     1065     9096    4                    I = B$JIT.ERR.CODE;    /* Get error code                     */

   9096  2 003074   000000 470400 xsym               LDP0    B$JIT$
         2 003075   000012 236100                    LDQ     10,,PR0
         2 003076   000003 772000                    QRL     3
         2 003077   037777 376007                    ANQ     16383,DL
         2 003100   200012 756100                    STQ     I,,AUTO

     1066     9097    4                    IF I ~= %E$VOLOUT AND I ~= %E$VOLORDER THEN

   9097  2 003101   001327 116007                    CMPQ    727,DL
         2 003102   003106 600000 2                  TZE     s:9099
         2 003103   001330 116007                    CMPQ    728,DL
         2 003104   003106 600000 2                  TZE     s:9099

     1067     9098    4                       ALTRETURN;          /* If unexpected error, altreturn now */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:179  

   9098  2 003105   000000 702200 xent               TSX2  ! X66_AALT

     1068     9099    5                    IF F$DCB.FSN > 0 OR F$DCB.IGNOREFSN THEN DO;

   9099  2 003106   200011 471500                    LDP1    JDCB$,,AUTO
         2 003107   100034 220100                    LDX0    28,,PR1
         2 003110   003113 601000 2                  TNZ     s:9101
         2 003111   100031 234100                    SZN     25,,PR1
         2 003112   003120 605000 2                  TPL     s:9105

     1069     9100                                /* Start search at FSN or ignore FSN means end at EOS */
     1070     9101    5                       IF I = %E$VOLOUT THEN

   9101  2 003113   001327 116007                    CMPQ    727,DL
         2 003114   003117 601000 2                  TNZ     s:9103

     1071     9102    5                          B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */

   9102  2 003115   000003 236000 1                  LDQ     E_EOSET
         2 003116   000012 756100                    STQ     10,,PR0

     1072     9103    5                       ALTRETURN;

   9103  2 003117   000000 702200 xent               TSX2  ! X66_AALT

     1073     9104    5                       END;
     1074     9105    4                    B$JIT.ERR = '0'B;      /* Clear error                        */

   9105  2 003120   000012 450100                    STZ     10,,PR0

     1075     9106    5                    IF F$DCB.VOL = 1 THEN DO; /* A one volume set                */

   9106  2 003121   100043 236100                    LDQ     35,,PR1
         2 003122   777000 376003                    ANQ     -512,DU
         2 003123   001000 116003                    CMPQ    512,DU
         2 003124   003152 601000 2                  TNZ     s:9118
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:180  

     1076     9107    6                       IF SAVFSN = THISFSN AND SAVVOL = F$DCB.VOL THEN DO;

   9107  2 003125   200022 236100                    LDQ     SAVFSN,,AUTO
         2 003126   200031 116100                    CMPQ    THISFSN,,AUTO
         2 003127   003137 601000 2                  TNZ     s:9111
         2 003130   100043 236100                    LDQ     35,,PR1
         2 003131   000033 772000                    QRL     27
         2 003132   200023 116100                    CMPQ    SAVVOL,,AUTO
         2 003133   003137 601000 2                  TNZ     s:9111

     1077     9108    6                          B$JIT.ERR = E_NOFILE;

   9108  2 003134   000007 236000 1                  LDQ     E_NOFILE
         2 003135   000012 756100                    STQ     10,,PR0

     1078     9109    6                          ALTRETURN;

   9109  2 003136   000000 702200 xent               TSX2  ! X66_AALT

     1079     9110    6                          END;
     1080     9111    6                       IF SAVFSN = 0 THEN DO;

   9111  2 003137   200022 235100                    LDA     SAVFSN,,AUTO
         2 003140   003146 601000 2                  TNZ     s:9115

     1081     9112    6                          SAVFSN = -1;

   9112  2 003141   000001 336007                    LCQ     1,DL
         2 003142   200022 756100                    STQ     SAVFSN,,AUTO

     1082     9113    6                          SAVVOL = F$DCB.VOL;

   9113  2 003143   100043 236100                    LDQ     35,,PR1
         2 003144   000033 772000                    QRL     27
         2 003145   200023 756100                    STQ     SAVVOL,,AUTO

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:181  
     1083     9114    6                          END;

     1084     9115    5                       CALL FTI$REWIND ALTRET(JUSTALT); /* Get to BOV            */

   9115  2 003146   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003147   000000 701000 xent               TSX1    FTI$REWIND
         2 003150   006767 702000 2                  TSX2    JUSTALT

     1085     9116    5                       END;

   9116  2 003151   003160 710000 2                  TRA     s:9122

     1086     9117    5                    ELSE DO;               /* Resume search at first vol of set  */

     1087     9118    5                       F$DCB.SEZ_OK = %NO#;

   9118  2 003152   000043 236000 3                  LDQ     35
         2 003153   100064 356100                    ANSQ    52,,PR1

     1088     9119    5                       CALL FTR$CHNGVOL(1) ALTRET(JUSTALT); /* Get first volume  */

   9119  2 003154   000006 630400 3                  EPPR0   6
         2 003155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003156   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 003157   006767 702000 2                  TSX2    JUSTALT

     1089     9120    5                       END;

     1090     9121    4                    END;

     1091     9122    3                 DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9122  2 003160   200011 470500                    LDP0    JDCB$,,AUTO
         2 003161   000051 720100                    LXL0    41,,PR0
         2 003162   000000 471400 xsym               LDP1    N$DCT$$
         2 003163   100000 473510                    LDP3    0,X0,PR1
         2 003164   300004 236100                    LDQ     4,,PR3
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:182  
         2 003165   200010 756100                    STQ     DDDT$,,AUTO

     1092     9123                                          /* Get pointer to DDT entry for next volume */
     1093     9124    3                 END;

     1094     9125    2              END /* DO_FOREVER */;

   9125  2 003166   002574 710000 2                  TRA     DO_FOREVER

     1095     9126
     1096     9127        /**************************************/
     1097     9128
     1098     9129    1   FTL_CHKNAME: PROC ALTRET;

   9129  2 003167   200036 741300       FTL_CHKNAME  STX1  ! DT1+2,,AUTO

     1099     9130        /*F*     NAME: FTL_CHKNAME
     1100     9131                 PURPOSE: Check if name contained in HDR1/HDR2 matches
     1101     9132                    that in the DCB.
     1102     9133                 DESCRIPTION: If the file was not created by CP-6, assume all
     1103     9134                    file name information is contained in the HDR1 label.  The
     1104     9135                    file names then match if the first 17 chars of DCB.NAME
     1105     9136                    match the 17 char name field in the HDR1 label and the
     1106     9137                    DCB name is 17 chars or less.  If not, altreturn to indicate
     1107     9138                    no match.  If the file was created by CP-6, get the HDR2
     1108     9139                    label.  If this label does not exist, the same criteria
     1109     9140                    as above are used to determine match.  If the HDR2
     1110     9141                    label exists but the file is not a CP-6 format file (with
     1111     9142                    extended name), the same criteria as above are also used.
     1112     9143                    For CP-6 format files the entire DCB.NAME must match the
     1113     9144                    extended name field in the HDR2 label for a match.
     1114     9145                    Position is left after the HDR2 if the second label pointer
     1115     9146                    points to 'HDR2', possibly before the HDR2 is LBL2$ points
     1116     9147                    to blanks, and after the HDR1/[HDR2] if non-blank.  SKIPS
     1117     9148                    is set to the number of file marks to skip to get to the
     1118     9149                    next HDR1.
     1119     9150         ***/
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:183  
     1120     9151
     1121     9152        /********************/
     1122     9153
     1123     9154    2              SKIPS = 3;           /* Just after HDR1...three file marks to next */

   9154  2 003170   000003 235007                    LDA     3,DL
         2 003171   200025 755100                    STA     SKIPS,,AUTO

     1124     9155    2              IF LBL1$->FT$LBL1.FILE_ID ~= F$DCB.NAME.C17.CC THEN ALTRETURN;

   9155  2 003172   200014 470500                    LDP0    LBL1$,,AUTO
         2 003173   200011 471500                    LDP1    JDCB$,,AUTO
         2 003174   040100 106500                    CMPC    fill='040'O
         2 003175   000001 000021                    ADSC9   1,,PR0                   cn=0,n=17
         2 003176   100010 200021                    ADSC9   8,,PR1                   cn=1,n=17
         2 003177   003201 600000 2                  TZE     s:9157

   9155  2 003200   000000 702211                    TSX2  ! 0,X1

     1125     9156                                              /* Not even the first 17 chars matched? */
     1126     9157    2              IF LBL1$->FT$LBL1.SYSTEM.ID = 'CP-6'

   9157  2 003201   040000 106500                    CMPC    fill='040'O
         2 003202   000017 000004                    ADSC9   15,,PR0                  cn=0,n=4
         2 003203   000020 000004 1                  ADSC9   E_WRONGFILE+2            cn=0,n=4
         2 003204   003266 601000 2                  TNZ     s:9181

     1127     9158    3              THEN DO;                     /* More file name info in HDR2        */

     1128     9159    3                 CALL FTI$RDASCEBC(LBL2$) ALTRET(JUSTALT);

   9159  2 003205   200015 633500                    EPPR3   LBL2$,,AUTO
         2 003206   200046 453500                    STP3    @ALBL$+2,,AUTO
         2 003207   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 003210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003211   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 003212   003303 702000 2                  TSX2    JUSTALT
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:184  

     1129     9160    3                 IF NOT F$DCB.TYC(1)

   9160  2 003213   200011 470500                    LDP0    JDCB$,,AUTO
         2 003214   000002 235100                    LDA     2,,PR0
         2 003215   003223 601000 2                  TNZ     s:9164

     1130     9161    4                 THEN DO;                  /* Error reading HDR2                 */

     1131     9162    4                    IF F$DCB.TYC.EOF(1) THEN SKIPS = 2;

   9162  2 003216   000002 236100                    LDQ     2,,PR0
         2 003217   004000 316003                    CANQ    2048,DU
         2 003220   003223 600000 2                  TZE     s:9164

   9162  2 003221   000002 235007                    LDA     2,DL
         2 003222   200025 755100                    STA     SKIPS,,AUTO

     1132     9163    4                    END;

     1133     9164    3                 IF LBL2$->FT$ANYLBL.LABEL_TYPE = 'HDR2'

   9164  2 003223   200015 471500                    LDP1    LBL2$,,AUTO
         2 003224   040000 106500                    CMPC    fill='040'O
         2 003225   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 003226   000034 000004 1                  ADSC9   E_WRONGFILE+14           cn=0,n=4
         2 003227   003260 601000 2                  TNZ     s:9177

     1134     9165    3                 THEN IF F$DCB.ARS >= 80

   9165  2 003230   000000 235100                    LDA     0,,PR0
         2 003231   000120 115007                    CMPA    80,DL
         2 003232   003251 604000 2                  TMI     s:9173

     1135     9166    4                    THEN DO;

     1136     9167    4                       IF LBL2$->FT$LBL2.FORMAT = 'U' AND LBL2$->FT$LBL2.CP6.
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:185  
              9167                                FILE_FORMAT ~= ' '

   9167  2 003233   040000 106500                    CMPC    fill='040'O
         2 003234   100001 000001                    ADSC9   1,,PR1                   cn=0,n=1
         2 003235   000013 000001 3                  ADSC9   11                       cn=0,n=1
         2 003236   003272 601000 2                  TNZ     s:9189
         2 003237   040000 106500                    CMPC    fill='040'O
         2 003240   100014 000001                    ADSC9   12,,PR1                  cn=0,n=1
         2 003241   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 003242   003272 600000 2                  TZE     s:9189

     1137     9168    4                       THEN     /* For CP-6 file, U format might have sub-format */
     1138     9169    4                          IF F$DCB.NAME.C = LBL2$->FT$LBL2.CP6.FILE_ID THEN RETURN;

   9169  2 003243   040100 106500                    CMPC    fill='040'O
         2 003244   000010 200037                    ADSC9   8,,PR0                   cn=1,n=31
         2 003245   100004 200037                    ADSC9   4,,PR1                   cn=1,n=31
         2 003246   003272 601000 2                  TNZ     s:9189

   9169  2 003247   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 003250   000001 702211                    TSX2  ! 1,X1

     1139     9170                                                /* Return if all chars match          */
     1140     9171    4                       END;
     1141     9172    4                    ELSE DO;               /* Messed up HDR2                     */

     1142     9173    4                       FT$DDT.POSLOST = %YES#;

   9173  2 003251   200010 473500                    LDP3    DDDT$,,AUTO
         2 003252   004000 236007                    LDQ     2048,DL
         2 003253   300006 256100                    ORSQ    6,,PR3

     1143     9174    4                       B$JIT.ERR = E_POSERR; /*E* ERROR: FTL-E$POSERR */

   9174  2 003254   000011 236000 1                  LDQ     E_POSERR
         2 003255   000000 471400 xsym               LDP1    B$JIT$
         2 003256   100012 756100                    STQ     10,,PR1
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:186  

     1144     9175    4                       END;

   9175  2 003257   003272 710000 2                  TRA     s:9189

     1145     9176    4                 ELSE DO;                  /* Not HDR2, assume user label        */

     1146     9177    4                    F$DCB.ARS = -1;        /* Position before it                 */

   9177  2 003260   000001 335007                    LCA     1,DL
         2 003261   000000 755100                    STA     0,,PR0

     1147     9178    4                    CALL FTI$SPREC ALTRET(JUSTALT);

   9178  2 003262   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003263   000000 701000 xent               TSX1    FTI$SPREC
         2 003264   003303 702000 2                  TSX2    JUSTALT

     1148     9179    4                    END;

     1149     9180    3                 END;

   9180  2 003265   003272 710000 2                  TRA     s:9189

     1150     9181    2              ELSE LBL2$->FT$ANYLBL.LABEL_TYPE = ' '; /* Indicate no HDR2        */

   9181  2 003266   200015 473500                    LDP3    LBL2$,,AUTO
         2 003267   040100 100400                    MLR     fill='040'O
         2 003270   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 003271   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4

     1151     9182
     1152     9183         /***
     1153     9184          *** First 17 chars of DCB name and tape file name matched and
     1154     9185          *** there are no more than 17 chars in the tape file name.  If
     1155     9186          *** likewise for the DCB name...match.
     1156     9187          ***/
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:187  
     1157     9188
     1158     9189    2              IF F$DCB.NAME.L > 17 THEN ALTRETURN;

   9189  2 003272   200011 470500                    LDP0    JDCB$,,AUTO
         2 003273   000010 236100                    LDQ     8,,PR0
         2 003274   777000 376003                    ANQ     -512,DU
         2 003275   022000 116003                    CMPQ    9216,DU
         2 003276   003301 602000 2                  TNC     s:9190

   9189  2 003277   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 003300   000000 702211                    TSX2  ! 0,X1

     1159     9190    2              RETURN;

   9190  2 003301   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 003302   000001 702211                    TSX2  ! 1,X1

   9189  2 003303                       JUSTALT      null
     1160     9191
     1161     9192    2   JUSTALT:   ;
     1162     9193    2              ALTRETURN;

   9193  2 003303   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 003304   000000 702211                    TSX2  ! 0,X1

     1163     9194
     1164     9195    2      END FTL_CHKNAME;
     1165     9196        /*********************************************************************/
     1166     9197        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:188  
     1167     9198        /*********************************************************************/
     1168     9199    1   FTL$FINDSEQIBM: ENTRY ALTRET;

   9199  2 003305   000000 700200 xent  FTL$FINDSEQ* TSX0  ! X66_AUTO_5
         2 003306   000052 000005                    ZERO    42,5

     1169     9200        /*F*     NAME: FTL$FINDSEQIBM
     1170     9201                 PURPOSE: Find a file by its sequence number and file section, when
     1171     9202                          dealing with IBM "ANS" tapes.
     1172     9203             DESCRIPTION:
     1173     9204                          First, find the starting file section.  If we're looking
     1174     9205                          for the first section (F$DCB.FSECT = 1), we're done.  Else
     1175     9206                          skip to the volume with the desired file section on it.
     1176     9207         ***/
     1177     9208
     1178     9209        /********************/
     1179     9210
     1180     9211    1              CALL FTL_LBLINIT ALTRET(JUSTALT);

   9211  2 003307   006665 701000 2                  TSX1    FTL_LBLINIT
         2 003310   006767 702000 2                  TSX2    JUSTALT

     1181     9212
     1182     9213    1              IF F$DCB.VOL > 1 THEN

   9213  2 003311   200011 470500                    LDP0    JDCB$,,AUTO
         2 003312   000043 236100                    LDQ     35,,PR0
         2 003313   777000 376003                    ANQ     -512,DU
         2 003314   002000 116003                    CMPQ    1024,DU
         2 003315   003360 602000 2                  TNC     s:9224

     1183     9214    2              DO WHILE (F$DCB.FSN <= FT$DDT.FRSTFSN + 1);

   9214  2 003316   003353 710000 2                  TRA     s:9222

     1184     9215    2                 F$DCB.SEZ_OK = %NO#;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:189  
   9215  2 003317   200011 470500                    LDP0    JDCB$,,AUTO
         2 003320   000043 236000 3                  LDQ     35
         2 003321   000064 356100                    ANSQ    52,,PR0

     1185     9216    3                 CALL FTR$CHNGVOL(F$DCB.VOL - 1) WHENALTRETURN DO;

   9216  2 003322   000043 236100                    LDQ     35,,PR0
         2 003323   000033 772000                    QRL     27
         2 003324   000001 136007                    SBLQ    1,DL
         2 003325   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 003326   200046 631500                    EPPR1   @ALBL$+2,,AUTO
         2 003327   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 003330   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 003331   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003332   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 003333   003335 702000 2                  TSX2    s:9217
         2 003334   003345 710000 2                  TRA     s:9221

     1186     9217    3                    IF (B$JIT.ERR.CODE = %E$VOLOUT) THEN

   9217  2 003335   000000 470400 xsym               LDP0    B$JIT$
         2 003336   000012 236100                    LDQ     10,,PR0
         2 003337   377770 376007                    ANQ     131064,DL
         2 003340   013270 116007                    CMPQ    5816,DL
         2 003341   003344 601000 2                  TNZ     s:9219

     1187     9218    3                       B$JIT.ERR = E_EOSET;

   9218  2 003342   000003 236000 1                  LDQ     E_EOSET
         2 003343   000012 756100                    STQ     10,,PR0

     1188     9219    3                    ALTRETURN;

   9219  2 003344   000000 702200 xent               TSX2  ! X66_AALT

     1189     9220    3                    END;
     1190     9221    2                 DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:190  

   9221  2 003345   200011 470500                    LDP0    JDCB$,,AUTO
         2 003346   000051 720100                    LXL0    41,,PR0
         2 003347   000000 471400 xsym               LDP1    N$DCT$$
         2 003350   100000 473510                    LDP3    0,X0,PR1
         2 003351   300004 236100                    LDQ     4,,PR3
         2 003352   200010 756100                    STQ     DDDT$,,AUTO

     1191     9222    2                 END;

   9222  2 003353   200010 471500                    LDP1    DDDT$,,AUTO
         2 003354   100005 720100                    LXL0    5,,PR1
         2 003355   000001 621010                    EAX1    1,X0
         2 003356   000034 101100                    CMPX1   28,,PR0
         2 003357   003317 603000 2                  TRC     s:9215

     1192     9223
     1193     9224    1              IF FT$DDT.POS ~= FTP_BOV# AND FT$DDT.POS ~= FTP_HDR# THEN

   9224  2 003360   200010 471500                    LDP1    DDDT$,,AUTO
         2 003361   100006 236100                    LDQ     6,,PR1
         2 003362   000160 376007                    ANQ     112,DL
         2 003363   000020 116007                    CMPQ    16,DL
         2 003364   003372 600000 2                  TZE     s:9227
         2 003365   000040 116007                    CMPQ    32,DL
         2 003366   003372 600000 2                  TZE     s:9227

     1194     9225    1                 CALL FTI$REWIND ALTRET(JUSTALT);

   9225  2 003367   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003370   000000 701000 xent               TSX1    FTI$REWIND
         2 003371   006767 702000 2                  TSX2    JUSTALT

     1195     9226
     1196     9227    1              CALL FTL_GETFSN ALTRET(JUSTALT);

   9227  2 003372   004364 701000 2                  TSX1    FTL_GETFSN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:191  
         2 003373   006767 702000 2                  TSX2    JUSTALT

     1197     9228
     1198     9229    2              IF F$DCB.TYC.EOF(1) THEN DO;

   9229  2 003374   200011 470500                    LDP0    JDCB$,,AUTO
         2 003375   000002 236100                    LDQ     2,,PR0
         2 003376   004000 316003                    CANQ    2048,DU
         2 003377   003435 600000 2                  TZE     s:9241

     1199     9230    3                 IF (LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'E0V1') THEN DO;

   9230  2 003400   200014 471500                    LDP1    LBL1$,,AUTO
         2 003401   040000 106500                    CMPC    fill='040'O
         2 003402   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 003403   000035 000004 1                  ADSC9   E_WRONGFILE+15           cn=0,n=4
         2 003404   003411 600000 2                  TZE     s:9235

     1200     9231                                 /* MUST BE EOF AND THEREFORE END OF SET AND AN ERROR */
     1201     9232    3                    B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */

   9232  2 003405   000003 236000 1                  LDQ     E_EOSET
         2 003406   000000 473400 xsym               LDP3    B$JIT$
         2 003407   300012 756100                    STQ     10,,PR3

     1202     9233    3                    ALTRETURN;

   9233  2 003410   000000 702200 xent               TSX2  ! X66_AALT

     1203     9234    3                    END;
     1204     9235    2                 F$DCB.SEZ_OK = %NO#;

   9235  2 003411   000043 236000 3                  LDQ     35
         2 003412   000064 356100                    ANSQ    52,,PR0

     1205     9236    2                 CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(JUSTALT);

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:192  
   9236  2 003413   000043 236100                    LDQ     35,,PR0
         2 003414   000033 772000                    QRL     27
         2 003415   000001 036007                    ADLQ    1,DL
         2 003416   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 003417   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 003420   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 003421   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 003422   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003423   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 003424   006767 702000 2                  TSX2    JUSTALT

     1206     9237    2                 DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9237  2 003425   200011 470500                    LDP0    JDCB$,,AUTO
         2 003426   000051 720100                    LXL0    41,,PR0
         2 003427   000000 471400 xsym               LDP1    N$DCT$$
         2 003430   100000 473510                    LDP3    0,X0,PR1
         2 003431   300004 236100                    LDQ     4,,PR3
         2 003432   200010 756100                    STQ     DDDT$,,AUTO

     1207     9238    2                 CALL FTL_GETFSN ALTRET(JUSTALT);

   9238  2 003433   004364 701000 2                  TSX1    FTL_GETFSN
         2 003434   006767 702000 2                  TSX2    JUSTALT

     1208     9239    2                 END;

     1209     9240
     1210     9241    2              IF F$DCB.FSN < THISFSN THEN DO;

   9241  2 003435   200011 470500                    LDP0    JDCB$,,AUTO
         2 003436   000034 236100                    LDQ     28,,PR0
         2 003437   000022 772000                    QRL     18
         2 003440   200031 116100                    CMPQ    THISFSN,,AUTO
         2 003441   003501 605000 2                  TPL     s:9254

     1211     9242    2                 F$DCB.ARS = (THISFSN - F$DCB.FSN) * -3 - 1;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:193  

   9242  2 003442   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 003443   200031 236100                    LDQ     THISFSN,,AUTO
         2 003444   200046 136100                    SBLQ    @ALBL$+2,,AUTO
         2 003445   000037 402000 3                  MPY     31
         2 003446   000001 136007                    SBLQ    1,DL
         2 003447   000000 756100                    STQ     0,,PR0

     1212     9243    2                 CALL FTI$SPFILE ALTRET(JUSTALT);

   9243  2 003450   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003451   000000 701000 xent               TSX1    FTI$SPFILE
         2 003452   006767 702000 2                  TSX2    JUSTALT

     1213     9244    2                 FT$DDT.POS = FTP_HDR#;

   9244  2 003453   200010 470500                    LDP0    DDDT$,,AUTO
         2 003454   000006 236100                    LDQ     6,,PR0
         2 003455   000003 376000 3                  ANQ     3
         2 003456   000040 276007                    ORQ     32,DL
         2 003457   000006 756100                    STQ     6,,PR0

     1214     9245    2                 CALL FTL_GETFSN ALTRET(JUSTALT);

   9245  2 003460   004364 701000 2                  TSX1    FTL_GETFSN
         2 003461   006767 702000 2                  TSX2    JUSTALT

     1215     9246    3                 IF F$DCB.FSN ~= THISFSN THEN DO;

   9246  2 003462   200011 470500                    LDP0    JDCB$,,AUTO
         2 003463   000034 236100                    LDQ     28,,PR0
         2 003464   000022 772000                    QRL     18
         2 003465   200031 116100                    CMPQ    THISFSN,,AUTO
         2 003466   003473 600000 2                  TZE     s:9250

     1216     9247    3                    B$JIT.ERR = E_VOLORDER;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:194  
   9247  2 003467   000014 236000 1                  LDQ     E_VOLORDER
         2 003470   000000 471400 xsym               LDP1    B$JIT$
         2 003471   100012 756100                    STQ     10,,PR1

     1217     9248    3                    ALTRETURN;

   9248  2 003472   000000 702200 xent               TSX2  ! X66_AALT

     1218     9249    3                    END;
     1219     9250    2                 FT$DDT.POS = FTP_HDR#;

   9250  2 003473   200010 471500                    LDP1    DDDT$,,AUTO
         2 003474   100006 236100                    LDQ     6,,PR1
         2 003475   000003 376000 3                  ANQ     3
         2 003476   000040 276007                    ORQ     32,DL
         2 003477   100006 756100                    STQ     6,,PR1

     1220     9251    2                 RETURN;

   9251  2 003500   000000 702200 xent               TSX2  ! X66_ARET

     1221     9252    2                 END;
     1222     9253
     1223     9254    2              IF F$DCB.FSN = THISFSN THEN DO;

   9254  2 003501   003510 601000 2                  TNZ     s:9260

     1224     9255    2                 FT$DDT.POS = FTP_HDR#;

   9255  2 003502   200010 471500                    LDP1    DDDT$,,AUTO
         2 003503   100006 236100                    LDQ     6,,PR1
         2 003504   000003 376000 3                  ANQ     3
         2 003505   000040 276007                    ORQ     32,DL
         2 003506   100006 756100                    STQ     6,,PR1

     1225     9256    2                 RETURN;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:195  
   9256  2 003507   000000 702200 xent               TSX2  ! X66_ARET

     1226     9257    2                 END;
     1227     9258
     1228     9259    2              DO UNTIL (F$DCB.FSN = FT$DDT.FSN + 1);

     1229     9260    3                 IF F$DCB.TYC.EOF(1) THEN DO; /* END OF TAPE                     */

   9260  2 003510   200011 470500                    LDP0    JDCB$,,AUTO
         2 003511   000002 236100                    LDQ     2,,PR0
         2 003512   004000 316003                    CANQ    2048,DU
         2 003513   003550 600000 2                  TZE     s:9271

     1230     9261    4                    IF (LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'E0V1') THEN DO;

   9261  2 003514   200014 471500                    LDP1    LBL1$,,AUTO
         2 003515   040000 106500                    CMPC    fill='040'O
         2 003516   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 003517   000035 000004 1                  ADSC9   E_WRONGFILE+15           cn=0,n=4
         2 003520   003525 600000 2                  TZE     s:9266

     1231     9262                                 /* MUST BE EOF AND THEREFORE END OF SET AND AN ERROR */
     1232     9263    4                       B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */

   9263  2 003521   000003 236000 1                  LDQ     E_EOSET
         2 003522   000000 473400 xsym               LDP3    B$JIT$
         2 003523   300012 756100                    STQ     10,,PR3

     1233     9264    4                       ALTRETURN;

   9264  2 003524   000000 702200 xent               TSX2  ! X66_AALT

     1234     9265    4                       END;
     1235     9266    3                    F$DCB.SEZ_OK = %NO#;

   9266  2 003525   000043 236000 3                  LDQ     35
         2 003526   000064 356100                    ANSQ    52,,PR0
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:196  

     1236     9267    3                    CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(JUSTALT);

   9267  2 003527   000043 236100                    LDQ     35,,PR0
         2 003530   000033 772000                    QRL     27
         2 003531   000001 036007                    ADLQ    1,DL
         2 003532   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 003533   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 003534   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 003535   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 003536   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003537   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 003540   006767 702000 2                  TSX2    JUSTALT

     1237     9268    3                    DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9268  2 003541   200011 470500                    LDP0    JDCB$,,AUTO
         2 003542   000051 720100                    LXL0    41,,PR0
         2 003543   000000 471400 xsym               LDP1    N$DCT$$
         2 003544   100000 473510                    LDP3    0,X0,PR1
         2 003545   300004 236100                    LDQ     4,,PR3
         2 003546   200010 756100                    STQ     DDDT$,,AUTO

     1238     9269    3                    END;

   9269  2 003547   003565 710000 2                  TRA     s:9278

     1239     9270    3                 ELSE DO;

     1240     9271    4                    IF F$DCB.FSN < THISFSN THEN DO;

   9271  2 003550   000034 236100                    LDQ     28,,PR0
         2 003551   000022 772000                    QRL     18
         2 003552   200031 116100                    CMPQ    THISFSN,,AUTO
         2 003553   003560 605000 2                  TPL     s:9275

     1241     9272    4                       B$JIT.ERR = E_VOLORDER;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:197  

   9272  2 003554   000014 236000 1                  LDQ     E_VOLORDER
         2 003555   000000 471400 xsym               LDP1    B$JIT$
         2 003556   100012 756100                    STQ     10,,PR1

     1242     9273    4                       ALTRETURN;

   9273  2 003557   000000 702200 xent               TSX2  ! X66_AALT

     1243     9274    4                       END;
     1244     9275    3                    F$DCB.ARS = 3;

   9275  2 003560   000003 235007                    LDA     3,DL
         2 003561   000000 755100                    STA     0,,PR0

     1245     9276    3                    CALL FTI$SPFILE ALTRET(JUSTALT);

   9276  2 003562   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003563   000000 701000 xent               TSX1    FTI$SPFILE
         2 003564   006767 702000 2                  TSX2    JUSTALT

     1246     9277    3                    END;

     1247     9278    2                 CALL FTL_GETFSN ALTRET(JUSTALT);

   9278  2 003565   004364 701000 2                  TSX1    FTL_GETFSN
         2 003566   006767 702000 2                  TSX2    JUSTALT

     1248     9279    2                 END;

   9279  2 003567   200010 470500                    LDP0    DDDT$,,AUTO
         2 003570   000005 220100                    LDX0    5,,PR0
         2 003571   000001 621010                    EAX1    1,X0
         2 003572   200011 471500                    LDP1    JDCB$,,AUTO
         2 003573   100034 101100                    CMPX1   28,,PR1
         2 003574   003510 601000 2                  TNZ     s:9260

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:198  
     1249     9280
     1250     9281    1              FT$DDT.POS = FTP_HDR#;

   9281  2 003575   000006 236100                    LDQ     6,,PR0
         2 003576   000003 376000 3                  ANQ     3
         2 003577   000040 276007                    ORQ     32,DL
         2 003600   000006 756100                    STQ     6,,PR0

     1251     9282    1              RETURN;

   9282  2 003601   000000 702200 xent               TSX2  ! X66_ARET

     1252     9283
     1253     9284        /*********************************************************************/
     1254     9285        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:199  
     1255     9286        /*********************************************************************/
     1256     9287    1   FTL$FINDSEQ: ENTRY ALTRET;

   9287  2 003602   000000 700200 xent  FTL$FINDSEQ  TSX0  ! X66_AUTO_5
         2 003603   000052 000005                    ZERO    42,5

     1257     9288        /*F*     NAME: FTL$FINDSEQ
     1258     9289                 PURPOSE: Find a file (section) by its sequence number (and
     1259     9290                    section number).
     1260     9291         ***/
     1261     9292
     1262     9293        /********************/
     1263     9294
     1264     9295    1              CALL FTL_LBLINIT ALTRET(JUSTALT);

   9295  2 003604   006665 701000 2                  TSX1    FTL_LBLINIT
         2 003605   006767 702000 2                  TSX2    JUSTALT

     1265     9296
     1266     9297         /***
     1267     9298          *** Keep looking for file until known to exist or not.
     1268     9299          ***/
     1269     9300
     1270     9301    1              SKIPS = 0;                   /* No volume changes made yet         */

   9301  2 003606   200025 450100                    STZ     SKIPS,,AUTO

     1271     9302    1              LOOKDIR = 0;                 /* Direction not known                */

   9302  2 003607   200016 450100                    STZ     LOOKDIR,,AUTO

     1272     9303    1              SECTFIND = %NO#;             /* Don't know where we are yet        */

   9303  2 003610   200024 450100                    STZ     SECTFIND,,AUTO

     1273     9304    1              LBL2$->FT$ANYLBL.LABEL_TYPE = ' '; /* No HDR2 has be read          */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:200  
   9304  2 003611   200015 470500                    LDP0    LBL2$,,AUTO
         2 003612   040100 100400                    MLR     fill='040'O
         2 003613   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 003614   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4

     1274     9305    2              DO WHILE('1'B);

     1275     9306    3                 IF S$CU$->B$U.ASYNCH & ~ %U_RESET THEN DO; /* Search interrupted */

   9306  2 003615   000003 236000 xsym               LDQ     B_VECTNIL+3
         2 003616   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 003617   000000 470400 xsym               LDP0    S$CU$
         2 003620   000001 376100                    ANQ     1,,PR0
         2 003621   003626 600000 2                  TZE     s:9310

     1276     9307    3                    B$JIT.ERR = E_TAPBRK; /*E* ERROR: FTL-E$TAPBRK */

   9307  2 003622   000013 236000 1                  LDQ     E_TAPBRK
         2 003623   000000 471400 xsym               LDP1    B$JIT$
         2 003624   100012 756100                    STQ     10,,PR1

     1277     9308    3                    ALTRETURN;

   9308  2 003625   000000 702200 xent               TSX2  ! X66_AALT

     1278     9309    3                    END;
     1279     9310    3                 IF F$DCB.FSN <= FT$DDT.FSN THEN DO;

   9310  2 003626   200010 471500                    LDP1    DDDT$,,AUTO
         2 003627   100005 220100                    LDX0    5,,PR1
         2 003630   200011 473500                    LDP3    JDCB$,,AUTO
         2 003631   300034 100100                    CMPX0   28,,PR3
         2 003632   003733 602000 2                  TNC     s:9341

     1280     9311                                     /* Required file must be before current position */
     1281     9312    3                    IF LOOKDIR > 0 THEN

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:201  
   9312  2 003633   200016 235100                    LDA     LOOKDIR,,AUTO
         2 003634   004336 605400 2                  TPNZ    FSNNOTHERE

     1282     9313    3                       GOTO FSNNOTHERE;
     1283     9314    3                    ELSE
     1284     9315    3                       LOOKDIR = -1;       /* Looking in backward direction      */

   9315  2 003635   000001 336007                    LCQ     1,DL
         2 003636   200016 756100                    STQ     LOOKDIR,,AUTO

     1285     9316    4                    IF FT$DDT.ANST AND F$DCB.FSN <= (FT$DDT.FSN-FT$DDT.FRSTFSN)/3+1
              9316                             THEN DO;

   9316  2 003637   100006 236100                    LDQ     6,,PR1
         2 003640   400000 316007                    CANQ    -131072,DL
         2 003641   003664 600000 2                  TZE     s:9322
         2 003642   100005 236100                    LDQ     5,,PR1
         2 003643   777777 376007                    ANQ     -1,DL
         2 003644   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 003645   100005 236100                    LDQ     5,,PR1
         2 003646   000022 772000                    QRL     18
         2 003647   200046 136100                    SBLQ    @ALBL$+2,,AUTO
         2 003650   000003 506007                    DIV     3,DL
         2 003651   000001 036007                    ADLQ    1,DL
         2 003652   200047 756100                    STQ     @ALBL$+3,,AUTO
         2 003653   300034 236100                    LDQ     28,,PR3
         2 003654   000022 772000                    QRL     18
         2 003655   200047 116100                    CMPQ    @ALBL$+3,,AUTO
         2 003656   003664 605400 2                  TPNZ    s:9322

     1286     9317                                                /* Rewind probably fastest            */
     1287     9318    4                       CALL FTI$REWIND ALTRET(JUSTALT);

   9318  2 003657   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003660   000000 701000 xent               TSX1    FTI$REWIND
         2 003661   006767 702000 2                  TSX2    JUSTALT

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:202  
     1288     9319    4                       LOOKDIR = 0;

   9319  2 003662   200016 450100                    STZ     LOOKDIR,,AUTO

     1289     9320    4                       END;

   9320  2 003663   003700 710000 2                  TRA     s:9326

     1290     9321    4                    ELSE DO;               /* Use space files                    */

     1291     9322    4                       F$DCB.ARS = (FT$DDT.FSN + 1 - F$DCB.FSN) * -3 - 1;

   9322  2 003664   300034 236100                    LDQ     28,,PR3
         2 003665   000022 772000                    QRL     18
         2 003666   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 003667   100005 236100                    LDQ     5,,PR1
         2 003670   000022 772000                    QRL     18
         2 003671   200046 136100                    SBLQ    @ALBL$+2,,AUTO
         2 003672   000037 402000 3                  MPY     31
         2 003673   000004 136007                    SBLQ    4,DL
         2 003674   300000 756100                    STQ     0,,PR3

     1292     9323                                              /* Calc number of file marks to back up */
     1293     9324    4                       CALL FTI$SPFILE ALTRET(JUSTALT);

   9324  2 003675   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003676   000000 701000 xent               TSX1    FTI$SPFILE
         2 003677   006767 702000 2                  TSX2    JUSTALT

     1294     9325    4                       END;

     1295     9326    3                    IF FT$DDT.POS ~= FTP_BOV# THEN

   9326  2 003700   200010 470500                    LDP0    DDDT$,,AUTO
         2 003701   000006 236100                    LDQ     6,,PR0
         2 003702   000160 376007                    ANQ     112,DL
         2 003703   000020 116007                    CMPQ    16,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:203  
         2 003704   003710 600000 2                  TZE     s:9328

     1296     9327    3                       CALL FTI$SPREC ALTRET(JUSTALT); /* Skip file mark to HDR1 */

   9327  2 003705   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003706   000000 701000 xent               TSX1    FTI$SPREC
         2 003707   006767 702000 2                  TSX2    JUSTALT

     1297     9328    3                    CALL FTL_GETFSN ALTRET(JUSTALT); /* Find where we actually are */

   9328  2 003710   004364 701000 2                  TSX1    FTL_GETFSN
         2 003711   006767 702000 2                  TSX2    JUSTALT

     1298     9329    4                    IF F$DCB.FSN < THISFSN THEN DO;
              9329                             /* Section must be on previous volume*/

   9329  2 003712   200011 470500                    LDP0    JDCB$,,AUTO
         2 003713   000034 236100                    LDQ     28,,PR0
         2 003714   000022 772000                    QRL     18
         2 003715   200031 116100                    CMPQ    THISFSN,,AUTO
         2 003716   003724 605000 2                  TPL     s:9336

     1299     9330    4                       IF SKIPS > 0 THEN

   9330  2 003717   200025 235100                    LDA     SKIPS,,AUTO
         2 003720   004272 605400 2                  TPNZ    VOLORDER

     1300     9331    4                          GOTO VOLORDER;   /* Volume with file seq missing       */
     1301     9332    4                       ELSE
     1302     9333    4                          SKIPS = -1;      /* PVOL                               */

   9333  2 003721   000001 335007                    LCA     1,DL
         2 003722   200025 755100                    STA     SKIPS,,AUTO

     1303     9334    4                       END;

   9334  2 003723   004141 710000 2                  TRA     s:9420
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:204  

     1304     9335    4                    ELSE DO;

     1305     9336    4                       IF F$DCB.FSECT > THISFSECT AND SKIPS < 0 THEN

   9336  2 003724   000077 236100                    LDQ     63,,PR0
         2 003725   000022 772000                    QRL     18
         2 003726   200030 116100                    CMPQ    THISFSECT,,AUTO
         2 003727   003732 604400 2                  TMOZ    s:9339
         2 003730   200025 235100                    LDA     SKIPS,,AUTO
         2 003731   004272 604000 2                  TMI     VOLORDER

     1306     9337    4                          GOTO VOLORDER; /* Don't CVOL to the next volume again. */
     1307     9338    4                       END;

     1308     9339    3                    END;

   9339  2 003732   004141 710000 2                  TRA     s:9420

     1309     9340    3                 ELSE DO;
              9340                          /* Must move forward (file by file to detect last file mark) */

     1310     9341    3                    IF LOOKDIR < 0 THEN

   9341  2 003733   200016 235100                    LDA     LOOKDIR,,AUTO
         2 003734   004336 604000 2                  TMI     FSNNOTHERE

     1311     9342    3                       GOTO FSNNOTHERE;    /* Looking forward after backward.    */
     1312     9343    3                    ELSE
     1313     9344    3                       LOOKDIR = 1;        /* Looking in forward direction       */

   9344  2 003735   000001 236007                    LDQ     1,DL
         2 003736   200016 756100                    STQ     LOOKDIR,,AUTO

     1314     9345    3                    NOT_TAPE_END = %YES#;  /* 'til tape end                      */

   9345  2 003737   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:205  
         2 003740   200021 756100                    STQ     NOT_TAPE_END,,AUTO

     1315     9346    4                    DO WHILE (NOT_TAPE_END);

   9346  2 003741   200021 234100                    SZN     NOT_TAPE_END,,AUTO
         2 003742   004141 605000 2                  TPL     s:9420

     1316     9347    4                       CALL FTL_GETFSN ALTRET(JUSTALT);

   9347  2 003743   004364 701000 2                  TSX1    FTL_GETFSN
         2 003744   006767 702000 2                  TSX2    JUSTALT

     1317     9348    5                       IF F$DCB.TYC.EOF(1) THEN DO;
              9348                                /* Hit file mark...must be tape end */

   9348  2 003745   200011 470500                    LDP0    JDCB$,,AUTO
         2 003746   000002 236100                    LDQ     2,,PR0
         2 003747   004000 316003                    CANQ    2048,DU
         2 003750   004066 600000 2                  TZE     s:9389

     1318     9349    5                          NOT_TAPE_END = %NO#; /* Now at end                     */

   9349  2 003751   200021 450100                    STZ     NOT_TAPE_END,,AUTO

     1319     9350    5                          IF SKIPS < 0 THEN

   9350  2 003752   200025 235100                    LDA     SKIPS,,AUTO
         2 003753   004272 604000 2                  TMI     VOLORDER

     1320     9351    5                             GOTO VOLORDER; /* Volume with seq must be missing   */
     1321     9352    6                          ELSE DO;         /* CVOL if not end of set             */

     1322     9353    7                             IF NOT FT$DDT.ANST THEN DO; /* PO tape              */

   9353  2 003754   200010 471500                    LDP1    DDDT$,,AUTO
         2 003755   100006 236100                    LDQ     6,,PR1
         2 003756   400000 316007                    CANQ    -131072,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:206  
         2 003757   003773 601000 2                  TNZ     s:9361

     1323     9354    8                                IF FT$DDT.FSN < 1 THEN DO; /* Can't back up (much) */

   9354  2 003760   100005 220100                    LDX0    5,,PR1
         2 003761   003773 601000 2                  TNZ     s:9361

     1324     9355    8                                   F$DCB.ARS = -1;

   9355  2 003762   000001 335007                    LCA     1,DL
         2 003763   000000 755100                    STA     0,,PR0

     1325     9356    8                                   CALL FTI$SPFILE ALTRET(JUSTALT);

   9356  2 003764   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003765   000000 701000 xent               TSX1    FTI$SPFILE
         2 003766   006767 702000 2                  TSX2    JUSTALT

     1326     9357    8                                   B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */

   9357  2 003767   000003 236000 1                  LDQ     E_EOSET
         2 003770   000000 470400 xsym               LDP0    B$JIT$
         2 003771   000012 756100                    STQ     10,,PR0

     1327     9358    8                                   ALTRETURN;

   9358  2 003772   000000 702200 xent               TSX2  ! X66_AALT

     1328     9359    8                                   END;
     1329     9360    7                                END;
     1330     9361    6                            F$DCB.ARS = -3; /* Skip to file mark preceeding EOV/EOF */

   9361  2 003773   000003 335007                    LCA     3,DL
         2 003774   000000 755100                    STA     0,,PR0

     1331     9362    6                             CALL FTI$SPFILE ALTRET(JUSTALT);

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:207  
   9362  2 003775   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003776   000000 701000 xent               TSX1    FTI$SPFILE
         2 003777   006767 702000 2                  TSX2    JUSTALT

     1332     9363    7                             IF F$DCB.TYC.BOT(1) THEN DO; /* Not much of a tape  */

   9363  2 004000   200011 470500                    LDP0    JDCB$,,AUTO
         2 004001   000002 236100                    LDQ     2,,PR0
         2 004002   040000 316003                    CANQ    16384,DU
         2 004003   004024 600000 2                  TZE     s:9371

     1333     9364    7                                B$JIT.ERR.CODE = %E$VOLOUT;
              9364                                         /* No more volumes in set */

   9364  2 004004   000000 471400 xsym               LDP1    B$JIT$
         2 004005   100012 236100                    LDQ     10,,PR1
         2 004006   000044 376000 3                  ANQ     36
         2 004007   013270 276007                    ORQ     5816,DL
         2 004010   100012 756100                    STQ     10,,PR1

     1334     9365    7                                F$DCB.ARS = 1;

   9365  2 004011   000001 235007                    LDA     1,DL
         2 004012   000000 755100                    STA     0,,PR0

     1335     9366    7                                CALL FTI$SPREC ALTRET(JUSTALT); /* Hop over VOL1 */

   9366  2 004013   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004014   000000 701000 xent               TSX1    FTI$SPREC
         2 004015   006767 702000 2                  TSX2    JUSTALT

     1336     9367    7                                FT$DDT.POS = FTP_HDR#; /* Where HDR1 should be   */

   9367  2 004016   200010 470500                    LDP0    DDDT$,,AUTO
         2 004017   000006 236100                    LDQ     6,,PR0
         2 004020   000003 376000 3                  ANQ     3
         2 004021   000040 276007                    ORQ     32,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:208  
         2 004022   000006 756100                    STQ     6,,PR0

     1337     9368    7                                GOTO NOSCRATCHES;

   9368  2 004023   004310 710000 2                  TRA     NOSCRATCHES

     1338     9369    7                                END;
     1339     9370    7                             ELSE DO;      /* Check last EOx label               */

     1340     9371    7                                F$DCB.ARS = 1; /* Skip to label                  */

   9371  2 004024   000001 235007                    LDA     1,DL
         2 004025   000000 755100                    STA     0,,PR0

     1341     9372    7                                CALL FTI$SPFILE ALTRET(JUSTALT);

   9372  2 004026   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004027   000000 701000 xent               TSX1    FTI$SPFILE
         2 004030   006767 702000 2                  TSX2    JUSTALT

     1342     9373    7                                CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);

   9373  2 004031   200014 630500                    EPPR0   LBL1$,,AUTO
         2 004032   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 004033   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 004034   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004035   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 004036   006767 702000 2                  TSX2    JUSTALT

     1343     9374    7                                F$DCB.ARS = 1;
              9374                                         /* Position just before last file mark */

   9374  2 004037   000001 235007                    LDA     1,DL
         2 004040   200011 470500                    LDP0    JDCB$,,AUTO
         2 004041   000000 755100                    STA     0,,PR0

     1344     9375    7                                CALL FTI$SPFILE ALTRET(JUSTALT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:209  

   9375  2 004042   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004043   000000 701000 xent               TSX1    FTI$SPFILE
         2 004044   006767 702000 2                  TSX2    JUSTALT

     1345     9376    7                                FT$DDT.POS = FTP_HDR#;

   9376  2 004045   200010 470500                    LDP0    DDDT$,,AUTO
         2 004046   000006 236100                    LDQ     6,,PR0
         2 004047   000003 376000 3                  ANQ     3
         2 004050   000040 276007                    ORQ     32,DL
         2 004051   000006 756100                    STQ     6,,PR0

     1346     9377    8                                IF LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOV1' THEN DO;

   9377  2 004052   200014 471500                    LDP1    LBL1$,,AUTO
         2 004053   040000 106500                    CMPC    fill='040'O
         2 004054   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 004055   000033 000004 1                  ADSC9   E_WRONGFILE+13           cn=0,n=4
         2 004056   004063 600000 2                  TZE     s:9383

     1347     9378                                                /* Must be end of set                 */
     1348     9379    8                                   B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */

   9379  2 004057   000003 236000 1                  LDQ     E_EOSET
         2 004060   000000 473400 xsym               LDP3    B$JIT$
         2 004061   300012 756100                    STQ     10,,PR3

     1349     9380    8                                   ALTRETURN;

   9380  2 004062   000000 702200 xent               TSX2  ! X66_AALT

     1350     9381    8                                   END;
     1351     9382    8                                ELSE DO;

     1352     9383    8                                   SKIPS = 1; /* Another volume must exist       */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:210  
   9383  2 004063   000001 235007                    LDA     1,DL
         2 004064   200025 755100                    STA     SKIPS,,AUTO

     1353     9384    8                                   END;

     1354     9385    7                                END;

     1355     9386    6                             END;

     1356     9387    5                          END;

   9387  2 004065   004137 710000 2                  TRA     s:9411

     1357     9388    5                       ELSE DO;            /* Got next HDR1                      */

     1358     9389    5                          IF F$DCB.FSN = THISFSN THEN

   9389  2 004066   000034 236100                    LDQ     28,,PR0
         2 004067   000022 772000                    QRL     18
         2 004070   200031 116100                    CMPQ    THISFSN,,AUTO
         2 004071   004112 601000 2                  TNZ     s:9400

     1359     9390    5                             IF F$DCB.FSECT > THISFSECT AND SKIPS < 0 THEN

   9390  2 004072   000077 236100                    LDQ     63,,PR0
         2 004073   000022 772000                    QRL     18
         2 004074   200030 116100                    CMPQ    THISFSECT,,AUTO
         2 004075   004110 604400 2                  TMOZ    s:9398
         2 004076   200025 235100                    LDA     SKIPS,,AUTO
         2 004077   004110 605000 2                  TPL     s:9398

     1360     9391    6                                IF F$DCB.IGNOREFSN THEN DO;

   9391  2 004100   000031 234100                    SZN     25,,PR0
         2 004101   004272 605000 2                  TPL     VOLORDER

     1361     9392    6                                   NOT_TAPE_END = %NO#;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:211  

   9392  2 004102   200021 450100                    STZ     NOT_TAPE_END,,AUTO

     1362     9393    6                                   F$DCB.OLDIOERR = 2;

   9393  2 004103   000102 236100                    LDQ     66,,PR0
         2 004104   000045 376000 3                  ANQ     37
         2 004105   100000 276003                    ORQ     32768,DU
         2 004106   000102 756100                    STQ     66,,PR0

     1363     9394    6                                   END;

   9394  2 004107   004137 710000 2                  TRA     s:9411

     1364     9395    5                                ELSE
     1365     9396    5                                   GOTO VOLORDER;
              9396                                            /* Don't CVOL to next volume again. */
     1366     9397    5                             ELSE
     1367     9398    5                                NOT_TAPE_END = %NO#; /* Stop search here         */

   9398  2 004110   200021 450100                    STZ     NOT_TAPE_END,,AUTO
         2 004111   004137 710000 2                  TRA     s:9411

     1368     9399    6                          ELSE DO;         /* Position to next HDR1              */

     1369     9400    6                             F$DCB.ARS = 3;

   9400  2 004112   000003 235007                    LDA     3,DL
         2 004113   000000 755100                    STA     0,,PR0

     1370     9401    6                             CALL FTI$SPFILE ALTRET(JUSTALT);

   9401  2 004114   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004115   000000 701000 xent               TSX1    FTI$SPFILE
         2 004116   006767 702000 2                  TSX2    JUSTALT

     1371     9402    6                             FT$DDT.FSN = THISFSN; /* Now past file              */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:212  

   9402  2 004117   200031 720100                    LXL0    THISFSN,,AUTO
         2 004120   200010 470500                    LDP0    DDDT$,,AUTO
         2 004121   000005 740100                    STX0    5,,PR0

     1372     9403    7                             IF S$CU$->B$U.ASYNCH & ~ %U_RESET THEN DO;

   9403  2 004122   000003 236000 xsym               LDQ     B_VECTNIL+3
         2 004123   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 004124   000000 471400 xsym               LDP1    S$CU$
         2 004125   100001 376100                    ANQ     1,,PR1
         2 004126   004137 600000 2                  TZE     s:9411

     1373     9404                                                /* Search interrupted                 */
     1374     9405    7                                FT$DDT.POS = FTP_HDR#;

   9405  2 004127   000006 236100                    LDQ     6,,PR0
         2 004130   000003 376000 3                  ANQ     3
         2 004131   000040 276007                    ORQ     32,DL
         2 004132   000006 756100                    STQ     6,,PR0

     1375     9406    7                                B$JIT.ERR = E_TAPBRK; /*E* ERROR: FTL-E$TAPBRK */

   9406  2 004133   000013 236000 1                  LDQ     E_TAPBRK
         2 004134   000000 473400 xsym               LDP3    B$JIT$
         2 004135   300012 756100                    STQ     10,,PR3

     1376     9407    7                                ALTRETURN;

   9407  2 004136   000000 702200 xent               TSX2  ! X66_AALT

     1377     9408    7                                END;
     1378     9409    6                             END;
     1379     9410    5                          END;
     1380     9411    4                       END;

   9411  2 004137   200021 234100                    SZN     NOT_TAPE_END,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:213  
         2 004140   003743 604000 2                  TMI     s:9347

     1381     9412    3                    END;

     1382     9413
     1383     9414         /***
     1384     9415             *** At this point we are either positioned at the proper file,
     1385     9416             *** positioned at a section of the proper file, or ready to
     1386     9417             *** CVOL or PVOL depending on SKIPS.
     1387     9418             ***/
     1388     9419
     1389     9420    3                 IF F$DCB.FSN = THISFSN AND NOT F$DCB.TYC(1) THEN DO;

   9420  2 004141   200011 470500                    LDP0    JDCB$,,AUTO
         2 004142   000034 236100                    LDQ     28,,PR0
         2 004143   000022 772000                    QRL     18
         2 004144   200031 116100                    CMPQ    THISFSN,,AUTO
         2 004145   004170 601000 2                  TNZ     s:9431
         2 004146   000002 235100                    LDA     2,,PR0
         2 004147   004170 601000 2                  TNZ     s:9431

     1390     9421                                                /* Positioned before section of file  */
     1391     9422    4                    IF F$DCB.FSECT = 0 OR F$DCB.FSECT = THISFSECT THEN DO;

   9422  2 004150   000077 220100                    LDX0    63,,PR0
         2 004151   004156 600000 2                  TZE     s:9424
         2 004152   000077 236100                    LDQ     63,,PR0
         2 004153   000022 772000                    QRL     18
         2 004154   200030 116100                    CMPQ    THISFSECT,,AUTO
         2 004155   004164 601000 2                  TNZ     s:9427

     1392     9423                                                /* Positioned properly                */
     1393     9424    4                       FT$DDT.POS = FTP_HDR#;

   9424  2 004156   200010 471500                    LDP1    DDDT$,,AUTO
         2 004157   100006 236100                    LDQ     6,,PR1
         2 004160   000003 376000 3                  ANQ     3
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:214  
         2 004161   000040 276007                    ORQ     32,DL
         2 004162   100006 756100                    STQ     6,,PR1

     1394     9425    4                       RETURN;

   9425  2 004163   000000 702200 xent               TSX2  ! X66_ARET

     1395     9426    4                       END;
     1396     9427    3                    SKIPS = F$DCB.FSECT - THISFSECT;

   9427  2 004164   200030 136100                    SBLQ    THISFSECT,,AUTO
         2 004165   200025 756100                    STQ     SKIPS,,AUTO

     1397     9428    3                    SECTFIND = %YES#;      /* Now trying to find proper section  */

   9428  2 004166   400000 236003                    LDQ     -131072,DU
         2 004167   200024 756100                    STQ     SECTFIND,,AUTO

     1398     9429                                                /* Calc offset of volume to change to */
     1399     9430    3                    END;

     1400     9431    3                 IF FT$DDT.POS ~= FTP_HDR# THEN DO;/* Must reposition to HDR1    */

   9431  2 004170   200010 471500                    LDP1    DDDT$,,AUTO
         2 004171   100006 236100                    LDQ     6,,PR1
         2 004172   000160 376007                    ANQ     112,DL
         2 004173   000040 116007                    CMPQ    32,DL
         2 004174   004207 600000 2                  TZE     s:9436

     1401     9432    3                    F$DCB.ARS = -1;        /* Position before file mark or HDR1  */

   9432  2 004175   000001 335007                    LCA     1,DL
         2 004176   000000 755100                    STA     0,,PR0

     1402     9433    3                    CALL FTI$SPREC ALTRET(JUSTALT);

   9433  2 004177   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:215  
         2 004200   000000 701000 xent               TSX1    FTI$SPREC
         2 004201   006767 702000 2                  TSX2    JUSTALT

     1403     9434    3                    FT$DDT.POS = FTP_HDR#;

   9434  2 004202   200010 470500                    LDP0    DDDT$,,AUTO
         2 004203   000006 236100                    LDQ     6,,PR0
         2 004204   000003 376000 3                  ANQ     3
         2 004205   000040 276007                    ORQ     32,DL
         2 004206   000006 756100                    STQ     6,,PR0

     1404     9435    3                    END;

     1405     9436    3                 IF SKIPS ~= 0 THEN DO; /* Need to look for file on another volume */

   9436  2 004207   200025 235100                    LDA     SKIPS,,AUTO
         2 004210   003615 600000 2                  TZE     s:9306

     1406     9437    3                    F$DCB.SEZ_OK = %NO#;   /* No scratches                       */

   9437  2 004211   200011 470500                    LDP0    JDCB$,,AUTO
         2 004212   000043 236000 3                  LDQ     35
         2 004213   000064 356100                    ANSQ    52,,PR0

     1407     9438    3                    CALL FTR$CHNGVOLNR(F$DCB.VOL + SKIPS) ALTRET(NOSCRATCHES);
              9438                             /* No rewind */

   9438  2 004214   000043 236100                    LDQ     35,,PR0
         2 004215   000033 772000                    QRL     27
         2 004216   200025 036100                    ADLQ    SKIPS,,AUTO
         2 004217   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 004220   200046 631500                    EPPR1   @ALBL$+2,,AUTO
         2 004221   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 004222   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 004223   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004224   000000 701000 xent               TSX1    FTR$CHNGVOLNR
         2 004225   004310 702000 2                  TSX2    NOSCRATCHES
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:216  

     1408     9439    3                    DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9439  2 004226   200011 470500                    LDP0    JDCB$,,AUTO
         2 004227   000051 720100                    LXL0    41,,PR0
         2 004230   000000 471400 xsym               LDP1    N$DCT$$
         2 004231   100000 473510                    LDP3    0,X0,PR1
         2 004232   300004 236100                    LDQ     4,,PR3
         2 004233   200010 756100                    STQ     DDDT$,,AUTO

     1409     9440    3                    LOOKDIR = 0;           /* Starting search on new volume      */

   9440  2 004234   200016 450100                    STZ     LOOKDIR,,AUTO

     1410     9441    4                    IF NOT FT$DDT.ANST AND FT$DDT.NOWANS THEN DO;

   9441  2 004235   200010 474500                    LDP4    DDDT$,,AUTO
         2 004236   400006 236100                    LDQ     6,,PR4
         2 004237   400000 316007                    CANQ    -131072,DL
         2 004240   003615 601000 2                  TNZ     s:9306
         2 004241   010000 316007                    CANQ    4096,DL
         2 004242   003615 600000 2                  TZE     s:9306

     1411     9442                                                /* Find first HDR1 if necessary       */
     1412     9443    5                       IF FT$DDT.POS = FTP_BOV# THEN DO;

   9443  2 004243   400006 236100                    LDQ     6,,PR4
         2 004244   000160 376007                    ANQ     112,DL
         2 004245   000020 116007                    CMPQ    16,DL
         2 004246   003615 601000 2                  TNZ     s:9306

     1413     9444    5                          F$DCB.ARS = 1;

   9444  2 004247   000001 235007                    LDA     1,DL
         2 004250   000000 755100                    STA     0,,PR0

     1414     9445    5                          CALL FTI$SPFILE ALTRET(JUSTALT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:217  

   9445  2 004251   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004252   000000 701000 xent               TSX1    FTI$SPFILE
         2 004253   006767 702000 2                  TSX2    JUSTALT

     1415     9446    5                          FT$DDT.POS = FTP_HDR#;

   9446  2 004254   200010 470500                    LDP0    DDDT$,,AUTO
         2 004255   000006 236100                    LDQ     6,,PR0
         2 004256   000003 376000 3                  ANQ     3
         2 004257   000040 276007                    ORQ     32,DL
         2 004260   000006 756100                    STQ     6,,PR0

     1416     9447    5                          CALL FTL_GETFSN ALTRET(JUSTALT);

   9447  2 004261   004364 701000 2                  TSX1    FTL_GETFSN
         2 004262   006767 702000 2                  TSX2    JUSTALT

     1417     9448    5                          F$DCB.ARS = -1;  /* Position before HDR1               */

   9448  2 004263   000001 335007                    LCA     1,DL
         2 004264   200011 470500                    LDP0    JDCB$,,AUTO
         2 004265   000000 755100                    STA     0,,PR0

     1418     9449    5                          CALL FTI$SPREC ALTRET(JUSTALT);

   9449  2 004266   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004267   000000 701000 xent               TSX1    FTI$SPREC
         2 004270   006767 702000 2                  TSX2    JUSTALT

     1419     9450    5                          END;

     1420     9451    4                       END;

     1421     9452    3                    END;

     1422     9453    2                 END;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:218  

   9453  2 004271   003615 710000 2                  TRA     s:9306

   9447  2 004272                       VOLORDER     null
     1423     9454
     1424     9455    1   VOLORDER:  ; /* HDR1 or file mark hit and file with sequence number not found */
     1425     9456    1              F$DCB.ARS = -1;              /* Position before file mark or HDR1  */

   9456  2 004272   000001 336007                    LCQ     1,DL
         2 004273   000000 756100                    STQ     0,,PR0

     1426     9457    1              CALL FTI$SPREC ALTRET(JUSTALT);

   9457  2 004274   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004275   000000 701000 xent               TSX1    FTI$SPREC
         2 004276   006767 702000 2                  TSX2    JUSTALT

     1427     9458    1              FT$DDT.POS = FTP_HDR#;       /* Should be before HDR1              */

   9458  2 004277   200010 470500                    LDP0    DDDT$,,AUTO
         2 004300   000006 236100                    LDQ     6,,PR0
         2 004301   000003 376000 3                  ANQ     3
         2 004302   000040 276007                    ORQ     32,DL
         2 004303   000006 756100                    STQ     6,,PR0

     1428     9459    1              B$JIT.ERR = E_VOLORDER; /*E* ERROR: FTL-E$VOLORDER */

   9459  2 004304   000014 236000 1                  LDQ     E_VOLORDER
         2 004305   000000 471400 xsym               LDP1    B$JIT$
         2 004306   100012 756100                    STQ     10,,PR1

     1429     9460    1              ALTRETURN;

   9460  2 004307   000000 702200 xent               TSX2  ! X66_AALT

   9459  2 004310                       NOSCRATCHES  null
     1430     9461
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:219  
     1431     9462    1   NOSCRATCHES: ;
     1432     9463    1              I = B$JIT.ERR.CODE;          /* What went wrong                    */

   9463  2 004310   000000 470400 xsym               LDP0    B$JIT$
         2 004311   000012 236100                    LDQ     10,,PR0
         2 004312   000003 772000                    QRL     3
         2 004313   037777 376007                    ANQ     16383,DL
         2 004314   200012 756100                    STQ     I,,AUTO

     1433     9464    2              IF I = %E$VOLORDER THEN DO;

   9464  2 004315   001330 116007                    CMPQ    728,DL
         2 004316   004324 601000 2                  TNZ     s:9469

     1434     9465    2                 IF SECTFIND THEN

   9465  2 004317   200024 234100                    SZN     SECTFIND,,AUTO
         2 004320   004335 605000 2                  TPL     s:9475

     1435     9466    2                    B$JIT.ERR = E_SECTERR; /*E* ERROR: FTL-E$SECTERR */

   9466  2 004321   000012 236000 1                  LDQ     E_SECTERR
         2 004322   000012 756100                    STQ     10,,PR0

     1436     9467    2                 END;                /* Tried to get another volume but couldn't */

   9467  2 004323   004335 710000 2                  TRA     s:9475

     1437     9468    1              ELSE
     1438     9469    1                 IF I = %E$VOLOUT THEN

   9469  2 004324   001327 116007                    CMPQ    727,DL
         2 004325   004335 601000 2                  TNZ     s:9475

     1439     9470    1                    IF SECTFIND THEN

   9470  2 004326   200024 234100                    SZN     SECTFIND,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:220  
         2 004327   004333 605000 2                  TPL     s:9473

     1440     9471    1                       B$JIT.ERR = E_SECTERR; /*E* ERROR: FTL-E$SECTERR */

   9471  2 004330   000012 236000 1                  LDQ     E_SECTERR
         2 004331   000012 756100                    STQ     10,,PR0
         2 004332   004335 710000 2                  TRA     s:9475

     1441     9472    1                    ELSE
     1442     9473    1                       B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */

   9473  2 004333   000003 236000 1                  LDQ     E_EOSET
         2 004334   000012 756100                    STQ     10,,PR0

     1443     9474                                                /* File must be missing               */
     1444     9475    1              ALTRETURN;

   9475  2 004335   000000 702200 xent               TSX2  ! X66_AALT

   9464  2 004336                       FSNNOTHERE   null
     1445     9476
     1446     9477    1   FSNNOTHERE: ;
     1447     9478    1              B$JIT.ERR = E_FSNERR; /*E* ERROR: FTL-E$FSNERR */

   9478  2 004336   000006 236000 1                  LDQ     E_FSNERR
         2 004337   000000 474400 xsym               LDP4    B$JIT$
         2 004340   400012 756100                    STQ     10,,PR4

     1448     9479    1              ALTRETURN;

   9479  2 004341   000000 702200 xent               TSX2  ! X66_AALT

     1449     9480
     1450     9481        /*********************************************************************/
     1451     9482        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:221  
     1452     9483        /*********************************************************************/
     1453     9484    1   FTL$GETFSN: ENTRY ALTRET;

   9484  2 004342   000000 700200 xent  FTL$GETFSN   TSX0  ! X66_AUTO_5
         2 004343   000052 000005                    ZERO    42,5

     1454     9485        /*F*     NAME: FTL$GETFSN
     1455     9486                 PURPOSE: Get file sequence number from HDR1.
     1456     9487         ***/
     1457     9488
     1458     9489        /********************/
     1459     9490
     1460     9491    1              CALL FTL_LBLINIT ALTRET(JUSTALT);

   9491  2 004344   006665 701000 2                  TSX1    FTL_LBLINIT
         2 004345   006767 702000 2                  TSX2    JUSTALT

     1461     9492    1              CALL FTL_GETFSN ALTRET(JUSTALT); /* Get the sequence number        */

   9492  2 004346   004364 701000 2                  TSX1    FTL_GETFSN
         2 004347   006767 702000 2                  TSX2    JUSTALT

     1462     9493    1              F$DCB.ARS = -1;              /* Position before HDR1 or file mark  */

   9493  2 004350   000001 335007                    LCA     1,DL
         2 004351   200011 470500                    LDP0    JDCB$,,AUTO
         2 004352   000000 755100                    STA     0,,PR0

     1463     9494    1              CALL FTI$SPREC ALTRET(JUSTALT);

   9494  2 004353   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004354   000000 701000 xent               TSX1    FTI$SPREC
         2 004355   006767 702000 2                  TSX2    JUSTALT

     1464     9495    1              FT$DDT.POS = FTP_HDR#;       /* Positioned at HDR                  */

   9495  2 004356   200010 470500                    LDP0    DDDT$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:222  
         2 004357   000006 236100                    LDQ     6,,PR0
         2 004360   000003 376000 3                  ANQ     3
         2 004361   000040 276007                    ORQ     32,DL
         2 004362   000006 756100                    STQ     6,,PR0

     1465     9496    1              RETURN;

   9496  2 004363   000000 702200 xent               TSX2  ! X66_ARET

     1466     9497
     1467     9498        /*********************************************************************/
     1468     9499        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:223  
     1469     9500        /*********************************************************************/
     1470     9501    1   FTL_GETFSN: PROC ALTRET;

   9501  2 004364   200036 741300       FTL_GETFSN   STX1  ! DT1+2,,AUTO

     1471     9502        /*F*     NAME: FTL_GETFSN
     1472     9503                 PURPOSE: Get next file sequence number.
     1473     9504                 DESCRIPTION: If at beginning of tape, skips labels until HDR1
     1474     9505                    has been read.  If not, next label should be HDR1.
     1475     9506                    If a label is read, it must be a HDR1...get its FSN and
     1476     9507                    FSECT.  If a file mark is hit, assume FSN is already
     1477     9508                    correct and position before it (resulting in TYC.BOF).
     1478     9509         ***/
     1479     9510
     1480     9511        /********************/
     1481     9512
     1482     9513         /***
     1483     9514         *** Get next HDR1.
     1484     9515          ***/
     1485     9516
     1486     9517    2              CALL FTL_GETNXTHDR ALTRET(JUSTALT);

   9517  2 004365   006433 701000 2                  TSX1    FTL_GETNXTHDR
         2 004366   004441 702000 2                  TSX2    JUSTALT

     1487     9518
     1488     9519         /***
     1489     9520          *** If a label was read, it must be a HDR1.  Get the FSN and FSECT.
     1490     9521          *** If a file mark was read we must be at end of volume with file
     1491     9522          *** sequence number already correct.
     1492     9523          ***/
     1493     9524
     1494     9525    2              IF NOT F$DCB.TYC.EOF(1)

   9525  2 004367   200011 470500                    LDP0    JDCB$,,AUTO
         2 004370   000002 236100                    LDQ     2,,PR0
         2 004371   004000 316003                    CANQ    2048,DU
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:224  
         2 004372   004430 601000 2                  TNZ     s:9535

     1495     9526    3              THEN DO;                     /* Got label                          */

     1496     9527    3                 CALL FTL_CHKLBL( 'HDR1', LBL1$ ) ALTRET(JUSTALT); /* Must be HDR1 */

   9527  2 004373   200014 631500                    EPPR1   LBL1$,,AUTO
         2 004374   200044 451500                    STP1    @ALBL+1,,AUTO
         2 004375   000042 236000 3                  LDQ     34
         2 004376   200043 756100                    STQ     @NUHL+1,,AUTO
         2 004377   004443 701000 2                  TSX1    FTL_CHKLBL
         2 004400   004441 702000 2                  TSX2    JUSTALT

     1497     9528    3                 CALL CHARBIN( THISFSN, LBL1$->FT$LBL1.FSEQU_NUM );

   9528  2 004401   200014 470500                    LDP0    LBL1$,,AUTO
         2 004402   000100 305500                    DTB
         2 004403   000007 630004                    NDSC9   7,,PR0                   cn=3,s=nosgn,sf=0,n=4
         2 004404   200031 000004                    NDSC9   THISFSN,,AUTO            cn=0,s=lsgnf,sf=0,n=4

     1498     9529    3                 FT$DDT.FSN = THISFSN - 1; /* Set FSN of previous file           */

   9529  2 004405   200031 720100                    LXL0    THISFSN,,AUTO
         2 004406   777777 621010                    EAX1    -1,X0
         2 004407   200010 471500                    LDP1    DDDT$,,AUTO
         2 004410   100005 741100                    STX1    5,,PR1

     1499     9530    3                 CALL CHARBIN( THISFSECT, LBL1$->FT$LBL1.FSECT );

   9530  2 004411   200014 470500                    LDP0    LBL1$,,AUTO
         2 004412   000100 305500                    DTB
         2 004413   000006 630004                    NDSC9   6,,PR0                   cn=3,s=nosgn,sf=0,n=4
         2 004414   200030 000004                    NDSC9   THISFSECT,,AUTO          cn=0,s=lsgnf,sf=0,n=4

     1500     9531    3                 IF F$DCB.EBCDIC THEN

   9531  2 004415   200011 473500                    LDP3    JDCB$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:225  
         2 004416   300031 236100                    LDQ     25,,PR3
         2 004417   100000 316007                    CANQ    32768,DL
         2 004420   004437 600000 2                  TZE     s:9538

     1501     9532    3                    THISFSECT = THISFSECT - F$DCB.STR;

   9532  2 004421   300077 236100                    LDQ     63,,PR3
         2 004422   000777 376007                    ANQ     511,DL
         2 004423   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 004424   200030 236100                    LDQ     THISFSECT,,AUTO
         2 004425   200046 136100                    SBLQ    @ALBL$+2,,AUTO
         2 004426   200030 756100                    STQ     THISFSECT,,AUTO

     1502     9533    3                 END;

   9533  2 004427   004437 710000 2                  TRA     s:9538

     1503     9534    3              ELSE DO;                     /* File mark...must be end of volume  */

     1504     9535    3                 THISFSN = FT$DDT.FSN + 1; /* Return last FSN                    */

   9535  2 004430   200010 471500                    LDP1    DDDT$,,AUTO
         2 004431   100005 236100                    LDQ     5,,PR1
         2 004432   000022 772000                    QRL     18
         2 004433   000001 036007                    ADLQ    1,DL
         2 004434   200031 756100                    STQ     THISFSN,,AUTO

     1505     9536    3                 THISFSECT = 1;

   9536  2 004435   000001 235007                    LDA     1,DL
         2 004436   200030 755100                    STA     THISFSECT,,AUTO

     1506     9537    3                 END;

     1507     9538    2              RETURN;

   9538  2 004437   200036 221300                    LDX1  ! DT1+2,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:226  
         2 004440   000001 702211                    TSX2  ! 1,X1

   9530  2 004441                       JUSTALT      null
     1508     9539
     1509     9540    2   JUSTALT:   ;
     1510     9541    2              ALTRETURN;

   9541  2 004441   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 004442   000000 702211                    TSX2  ! 0,X1

     1511     9542
     1512     9543    2      END FTL_GETFSN;
     1513     9544        /*********************************************************************/
     1514     9545        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:227  
     1515     9546        /*********************************************************************/
     1516     9547    1   FTL_CHKLBL: PROC(ALBL,ALBL$) ALTRET;

   9547  2 004443   200042 741300       FTL_CHKLBL   STX1  ! @UHL$+1,,AUTO

     1517     9548        /*F*     NAME: FTL_CHKLBL
     1518     9549                 PURPOSE: Check if specified label.  If not, position lost.
     1519     9550         ***/
     1520     9551
     1521     9552         /***
     1522     9553          *** Parameters:
     1523     9554          ***/
     1524     9555
     1525     9556    2     DCL ALBL CHAR(4);                     /* The label to check against         */
     1526     9557    2     DCL ALBL$ PTR;                        /* Pointer to label to check          */
     1527     9558
     1528     9559        /********************/
     1529     9560
     1530     9561    2              IF F$DCB.ARS < 80 OR ALBL$->FT$ANYLBL.LABEL_TYPE ~= ALBL

   9561  2 004444   200011 470500                    LDP0    JDCB$,,AUTO
         2 004445   000000 235100                    LDA     0,,PR0
         2 004446   000120 115007                    CMPA    80,DL
         2 004447   004457 604000 2                  TMI     s:9563
         2 004450   200044 471500                    LDP1    @ALBL$,,AUTO
         2 004451   100000 473500                    LDP3    0,,PR1
         2 004452   200043 474500                    LDP4    @ALBL,,AUTO
         2 004453   040100 106500                    CMPC    fill='040'O
         2 004454   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
         2 004455   400000 000004                    ADSC9   0,,PR4                   cn=0,n=4
         2 004456   004467 600000 2                  TZE     s:9567

     1531     9562    3              THEN DO;                     /* Position lost                      */

     1532     9563    3                 FT$DDT.POSLOST = %YES#;

   9563  2 004457   200010 471500                    LDP1    DDDT$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:228  
         2 004460   004000 236007                    LDQ     2048,DL
         2 004461   100006 256100                    ORSQ    6,,PR1

     1533     9564    3                 B$JIT.ERR = E_POSERR; /*E* ERROR: FTL-E$POSERR  */

   9564  2 004462   000011 236000 1                  LDQ     E_POSERR
         2 004463   000000 473400 xsym               LDP3    B$JIT$
         2 004464   300012 756100                    STQ     10,,PR3

     1534     9565    3                 ALTRETURN;

   9565  2 004465   200042 221300                    LDX1  ! @UHL$+1,,AUTO
         2 004466   000000 702211                    TSX2  ! 0,X1

     1535     9566    3                 END;
     1536     9567    2              RETURN;

   9567  2 004467   000001 702211                    TSX2  ! 1,X1

     1537     9568
     1538     9569    2      END FTL_CHKLBL;
     1539     9570        /*********************************************************************/
     1540     9571        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:229  
     1541     9572        /********************************************************************/
     1542     9573    1   FTL$FINDHDR1: ENTRY ALTRET;

   9573  2 004470   000000 700200 xent  FTL$FINDHDR1 TSX0  ! X66_AUTO_5
         2 004471   000052 000005                    ZERO    42,5

     1543     9574        /*F*     NAME: FTL$FINDHDR1
     1544     9575                 PURPOSE: Finds next HDR1 label to right of current position.
     1545     9576         ***/
     1546     9577
     1547     9578        /********************/
     1548     9579
     1549     9580    1              CALL FTL_LBLINIT ALTRET(JUSTALT);

   9580  2 004472   006665 701000 2                  TSX1    FTL_LBLINIT
         2 004473   006767 702000 2                  TSX2    JUSTALT

     1550     9581    1              FT$DDT.POSLOST = %NO#;       /* Permit position to be found        */

   9581  2 004474   200010 470500                    LDP0    DDDT$,,AUTO
         2 004475   000046 236000 3                  LDQ     38
         2 004476   000006 356100                    ANSQ    6,,PR0

     1551     9582    1              F$DCB.ARS = 1;

   9582  2 004477   000001 235007                    LDA     1,DL
         2 004500   200011 471500                    LDP1    JDCB$,,AUTO
         2 004501   100000 755100                    STA     0,,PR1

     1552     9583    1             CALL FTI$SPFILE ALTRET(JUSTALT); /* Space to next file mark past error */

   9583  2 004502   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004503   000000 701000 xent               TSX1    FTI$SPFILE
         2 004504   006767 702000 2                  TSX2    JUSTALT

     1553     9584    2              DO WHILE('1'B);

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:230  
     1554     9585    3   RDLP:         CALL FTI$RDASCEBC(LBL1$) WHENALTRETURN DO;

   9585  2 004505   200014 630500       RDLP         EPPR0   LBL1$,,AUTO
         2 004506   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 004507   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 004510   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004511   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 004512   004514 702000 2                  TSX2    s:9586
         2 004513   004531 710000 2                  TRA     s:9593

     1555     9586    4                    IF B$JIT.ERR.CODE = %E$IOERR THEN DO;

   9586  2 004514   000000 470400 xsym               LDP0    B$JIT$
         2 004515   000012 236100                    LDQ     10,,PR0
         2 004516   377770 376007                    ANQ     131064,DL
         2 004517   000100 116007                    CMPQ    64,DL
         2 004520   004530 601000 2                  TNZ     s:9591

     1556     9587    4                       F$DCB.ARS = 1;

   9587  2 004521   000001 235007                    LDA     1,DL
         2 004522   200011 471500                    LDP1    JDCB$,,AUTO
         2 004523   100000 755100                    STA     0,,PR1

     1557     9588    4                       CALL FTI$SPFILE ALTRET(JUSTALT);

   9588  2 004524   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004525   000000 701000 xent               TSX1    FTI$SPFILE
         2 004526   006767 702000 2                  TSX2    JUSTALT

     1558     9589    4                       GOTO RDLP;

   9589  2 004527   004505 710000 2                  TRA     RDLP

     1559     9590    4                       END;
     1560     9591    3                    ALTRETURN;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:231  
   9591  2 004530   000000 702200 xent               TSX2  ! X66_AALT

     1561     9592    3                    END;
     1562     9593    3                 IF F$DCB.TYC.EOF(1) OR F$DCB.TYC.EOT(1) THEN DO;

   9593  2 004531   200011 470500                    LDP0    JDCB$,,AUTO
         2 004532   000002 236100                    LDQ     2,,PR0
         2 004533   004000 316003                    CANQ    2048,DU
         2 004534   004537 601000 2                  TNZ     s:9594
         2 004535   100000 316003                    CANQ    32768,DU
         2 004536   004574 600000 2                  TZE     s:9601

     1563     9594    3                    FT$DDT.POS = FTP_EOV#;

   9594  2 004537   200010 471500                    LDP1    DDDT$,,AUTO
         2 004540   100006 236100                    LDQ     6,,PR1
         2 004541   000003 376000 3                  ANQ     3
         2 004542   000100 276007                    ORQ     64,DL
         2 004543   100006 756100                    STQ     6,,PR1

     1564     9595    3                    F$DCB.SEZ_OK = %NO#;

   9595  2 004544   000043 236000 3                  LDQ     35
         2 004545   000064 356100                    ANSQ    52,,PR0

     1565     9596    3                    CALL FTR$CHNGVOL(F$DCB.VOL+1) ALTRET(JUSTALT);

   9596  2 004546   000043 236100                    LDQ     35,,PR0
         2 004547   000033 772000                    QRL     27
         2 004550   000001 036007                    ADLQ    1,DL
         2 004551   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 004552   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 004553   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 004554   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 004555   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004556   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 004557   006767 702000 2                  TSX2    JUSTALT
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:232  

     1566     9597    3                    DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9597  2 004560   200011 470500                    LDP0    JDCB$,,AUTO
         2 004561   000051 720100                    LXL0    41,,PR0
         2 004562   000000 471400 xsym               LDP1    N$DCT$$
         2 004563   100000 473510                    LDP3    0,X0,PR1
         2 004564   300004 236100                    LDQ     4,,PR3
         2 004565   200010 756100                    STQ     DDDT$,,AUTO

     1567     9598    3                    F$DCB.ARS = 1;

   9598  2 004566   000001 235007                    LDA     1,DL
         2 004567   000000 755100                    STA     0,,PR0

     1568     9599    3                    CALL FTI$SPREC ALTRET(JUSTALT); /* Position to HDR1.         */

   9599  2 004570   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004571   000000 701000 xent               TSX1    FTI$SPREC
         2 004572   006767 702000 2                  TSX2    JUSTALT

     1569     9600    3                    END;

   9600  2 004573   004505 710000 2                  TRA     RDLP

     1570     9601    3                 ELSE IF LBL1$->FT$ANYLBL.LABEL_TYPE = 'HDR1' AND F$DCB.ARS = 80 THEN
              9601                          DO;

   9601  2 004574   200014 471500                    LDP1    LBL1$,,AUTO
         2 004575   040000 106500                    CMPC    fill='040'O
         2 004576   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 004577   000032 000004 1                  ADSC9   E_WRONGFILE+12           cn=0,n=4
         2 004600   004640 601000 2                  TNZ     s:9613
         2 004601   000000 235100                    LDA     0,,PR0
         2 004602   000120 115007                    CMPA    80,DL
         2 004603   004640 601000 2                  TNZ     s:9613

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:233  
     1571     9602    3                       CALL CHARBIN(THISFSN,LBL1$->FT$LBL1.FSEQU_NUM);

   9602  2 004604   000100 305500                    DTB
         2 004605   100007 630004                    NDSC9   7,,PR1                   cn=3,s=nosgn,sf=0,n=4
         2 004606   200031 000004                    NDSC9   THISFSN,,AUTO            cn=0,s=lsgnf,sf=0,n=4

     1572     9603    3                       FT$DDT.FSN = THISFSN - 1;

   9603  2 004607   200031 720100                    LXL0    THISFSN,,AUTO
         2 004610   777777 621010                    EAX1    -1,X0
         2 004611   200010 473500                    LDP3    DDDT$,,AUTO
         2 004612   300005 741100                    STX1    5,,PR3

     1573     9604    3                       CALL CHARBIN(THISFSECT,LBL1$->FT$LBL1.FSECT);

   9604  2 004613   200014 471500                    LDP1    LBL1$,,AUTO
         2 004614   000100 305500                    DTB
         2 004615   100006 630004                    NDSC9   6,,PR1                   cn=3,s=nosgn,sf=0,n=4
         2 004616   200030 000004                    NDSC9   THISFSECT,,AUTO          cn=0,s=lsgnf,sf=0,n=4

     1574     9605    4                       IF THISFSECT = 1 OR F$DCB.EBCDIC THEN DO; /* BOF/IBM tape? */

   9605  2 004617   200030 235100                    LDA     THISFSECT,,AUTO
         2 004620   000001 115007                    CMPA    1,DL
         2 004621   004625 600000 2                  TZE     s:9606
         2 004622   000031 236100                    LDQ     25,,PR0
         2 004623   100000 316007                    CANQ    32768,DL
         2 004624   004632 600000 2                  TZE     s:9609

     1575     9606    4                          FT$DDT.POS = FTP_HDR#; /* Yep, we're finished.         */

   9606  2 004625   300006 236100                    LDQ     6,,PR3
         2 004626   000003 376000 3                  ANQ     3
         2 004627   000040 276007                    ORQ     32,DL
         2 004630   300006 756100                    STQ     6,,PR3

     1576     9607    4                          RETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:234  

   9607  2 004631   000000 702200 xent               TSX2  ! X66_ARET

     1577     9608    4                          END;
     1578     9609    3                       F$DCB.ARS = 3;      /* Space to next HDR1.                */

   9609  2 004632   000003 235007                    LDA     3,DL
         2 004633   000000 755100                    STA     0,,PR0

     1579     9610    3                       CALL FTI$SPFILE ALTRET(JUSTALT);

   9610  2 004634   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004635   000000 701000 xent               TSX1    FTI$SPFILE
         2 004636   006767 702000 2                  TSX2    JUSTALT

     1580     9611    3                       END;

   9611  2 004637   004505 710000 2                  TRA     RDLP

     1581     9612    3                    ELSE DO;

     1582     9613    3                       F$DCB.ARS = 1;

   9613  2 004640   000001 235007                    LDA     1,DL
         2 004641   000000 755100                    STA     0,,PR0

     1583     9614    3                       CALL FTI$SPFILE ALTRET(JUSTALT); /* Space to next file mark. */

   9614  2 004642   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004643   000000 701000 xent               TSX1    FTI$SPFILE
         2 004644   006767 702000 2                  TSX2    JUSTALT

     1584     9615    3                       END;

     1585     9616    2                 END;

   9616  2 004645   004505 710000 2                  TRA     RDLP
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:235  

     1586     9617
     1587     9618        /********************************************************************/
     1588     9619        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:236  
     1589     9620        /*********************************************************************/
     1590     9621    1   FTL$FINDNEXT: ENTRY ALTRET;

   9621  2 004646   000000 700200 xent  FTL$FINDNEXT TSX0  ! X66_AUTO_5
         2 004647   000052 000005                    ZERO    42,5

     1591     9622        /*F*     NAME: FTL$FINDNEXT
     1592     9623                 PURPOSE: Find the next beginning-of-file on the tape set.
     1593     9624                 DESCRIPTION: Works like FTL$FINDSEQ, except it ignores the
     1594     9625                 FSN and FSECT in the HDR1 label, and it just finds the next
     1595     9626                 file on the tape, rather than a file with a particular FSN.
     1596     9627         ***/
     1597     9628
     1598     9629        /********************/
     1599     9630
     1600     9631    1              CALL FTL_LBLINIT ALTRET(JUSTALT);

   9631  2 004650   006665 701000 2                  TSX1    FTL_LBLINIT
         2 004651   006767 702000 2                  TSX2    JUSTALT

     1601     9632    2              DO WHILE('1'B);

     1602     9633    2                 CALL FTL_GETFSN ALTRET(JUSTALT);

   9633  2 004652   004364 701000 2                  TSX1    FTL_GETFSN
         2 004653   006767 702000 2                  TSX2    JUSTALT

     1603     9634    3                 IF F$DCB.TYC.EOF(1) THEN DO; /* File mark hit, must be EOT.     */

   9634  2 004654   200011 470500                    LDP0    JDCB$,,AUTO
         2 004655   000002 236100                    LDQ     2,,PR0
         2 004656   004000 316003                    CANQ    2048,DU
         2 004657   005046 600000 2                  TZE     s:9684

     1604     9635    4                    IF NOT FT$DDT.ANST THEN DO; /* PO tape.                      */

   9635  2 004660   200010 471500                    LDP1    DDDT$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:237  
         2 004661   100006 236100                    LDQ     6,,PR1
         2 004662   400000 316007                    CANQ    -131072,DL
         2 004663   004677 601000 2                  TNZ     s:9643

     1605     9636    5                       IF FT$DDT.FSN < 1 THEN DO;

   9636  2 004664   100005 220100                    LDX0    5,,PR1
         2 004665   004677 601000 2                  TNZ     s:9643

     1606     9637    5                          F$DCB.ARS = -1;

   9637  2 004666   000001 335007                    LCA     1,DL
         2 004667   000000 755100                    STA     0,,PR0

     1607     9638    5                          CALL FTI$SPFILE ALTRET(JUSTALT);

   9638  2 004670   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004671   000000 701000 xent               TSX1    FTI$SPFILE
         2 004672   006767 702000 2                  TSX2    JUSTALT

     1608     9639    5                          B$JIT.ERR = E_EOSET;

   9639  2 004673   000003 236000 1                  LDQ     E_EOSET
         2 004674   000000 470400 xsym               LDP0    B$JIT$
         2 004675   000012 756100                    STQ     10,,PR0

     1609     9640    5                          ALTRETURN;

   9640  2 004676   000000 702200 xent               TSX2  ! X66_AALT

     1610     9641    5                          END;
     1611     9642    4                       END;
     1612     9643    3                    F$DCB.ARS = -3;        /* Skip back to before EOV/EOF.       */

   9643  2 004677   000003 335007                    LCA     3,DL
         2 004700   000000 755100                    STA     0,,PR0

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:238  
     1613     9644    3                    CALL FTI$SPFILE ALTRET(JUSTALT);

   9644  2 004701   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004702   000000 701000 xent               TSX1    FTI$SPFILE
         2 004703   006767 702000 2                  TSX2    JUSTALT

     1614     9645    4                    IF F$DCB.TYC.BOT(1) THEN DO; /* Short tape.                  */

   9645  2 004704   200011 470500                    LDP0    JDCB$,,AUTO
         2 004705   000002 236100                    LDQ     2,,PR0
         2 004706   040000 316003                    CANQ    16384,DU
         2 004707   004726 600000 2                  TZE     s:9653

     1615     9646    4                       B$JIT.ERR = E_EOSET; /* No more volumes in set.           */

   9646  2 004710   000003 236000 1                  LDQ     E_EOSET
         2 004711   000000 471400 xsym               LDP1    B$JIT$
         2 004712   100012 756100                    STQ     10,,PR1

     1616     9647    4                       F$DCB.ARS = 1;

   9647  2 004713   000001 235007                    LDA     1,DL
         2 004714   000000 755100                    STA     0,,PR0

     1617     9648    4                       CALL FTI$SPREC ALTRET(JUSTALT); /* Skip over VOL1.        */

   9648  2 004715   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004716   000000 701000 xent               TSX1    FTI$SPREC
         2 004717   006767 702000 2                  TSX2    JUSTALT

     1618     9649    4                       FT$DDT.POS = FTP_HDR#; /* Should be at HDR1.              */

   9649  2 004720   200010 470500                    LDP0    DDDT$,,AUTO
         2 004721   000006 236100                    LDQ     6,,PR0
         2 004722   000003 376000 3                  ANQ     3
         2 004723   000040 276007                    ORQ     32,DL
         2 004724   000006 756100                    STQ     6,,PR0
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:239  

     1619     9650    4                       ALTRETURN;

   9650  2 004725   000000 702200 xent               TSX2  ! X66_AALT

     1620     9651    4                       END;
     1621     9652    4                    ELSE DO;

     1622     9653    4                       F$DCB.ARS = 1;      /* Skip to EOF/EOV.                   */

   9653  2 004726   000001 235007                    LDA     1,DL
         2 004727   000000 755100                    STA     0,,PR0

     1623     9654    4                       CALL FTI$SPFILE ALTRET(JUSTALT);

   9654  2 004730   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004731   000000 701000 xent               TSX1    FTI$SPFILE
         2 004732   006767 702000 2                  TSX2    JUSTALT

     1624     9655    4                       CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);

   9655  2 004733   200014 630500                    EPPR0   LBL1$,,AUTO
         2 004734   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 004735   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 004736   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004737   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 004740   006767 702000 2                  TSX2    JUSTALT

     1625     9656    4                       F$DCB.ARS = 1;     /* Position just before last file mark */

   9656  2 004741   000001 235007                    LDA     1,DL
         2 004742   200011 470500                    LDP0    JDCB$,,AUTO
         2 004743   000000 755100                    STA     0,,PR0

     1626     9657    4                       CALL FTI$SPFILE ALTRET(JUSTALT);

   9657  2 004744   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:240  
         2 004745   000000 701000 xent               TSX1    FTI$SPFILE
         2 004746   006767 702000 2                  TSX2    JUSTALT

     1627     9658    4                       FT$DDT.POS = FTP_HDR#;

   9658  2 004747   200010 470500                    LDP0    DDDT$,,AUTO
         2 004750   000006 236100                    LDQ     6,,PR0
         2 004751   000003 376000 3                  ANQ     3
         2 004752   000040 276007                    ORQ     32,DL
         2 004753   000006 756100                    STQ     6,,PR0

     1628     9659    5                       IF LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOV1' THEN DO;

   9659  2 004754   200014 471500                    LDP1    LBL1$,,AUTO
         2 004755   040000 106500                    CMPC    fill='040'O
         2 004756   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 004757   000033 000004 1                  ADSC9   E_WRONGFILE+13           cn=0,n=4
         2 004760   004765 600000 2                  TZE     s:9665

     1629     9660                                                /* Must be end of set                 */
     1630     9661    5                          B$JIT.ERR = E_EOSET; /*E* ERROR: FTL-E$EOSET */

   9661  2 004761   000003 236000 1                  LDQ     E_EOSET
         2 004762   000000 473400 xsym               LDP3    B$JIT$
         2 004763   300012 756100                    STQ     10,,PR3

     1631     9662    5                          ALTRETURN;

   9662  2 004764   000000 702200 xent               TSX2  ! X66_AALT

     1632     9663    5                          END;
     1633     9664    5                       ELSE DO;            /* Not EOSET, look on next volume.    */

     1634     9665    5                          F$DCB.SEZ_OK = %NO#; /* No scratches.                  */

   9665  2 004765   200011 473500                    LDP3    JDCB$,,AUTO
         2 004766   000043 236000 3                  LDQ     35
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:241  
         2 004767   300064 356100                    ANSQ    52,,PR3

     1635     9666    6                          CALL FTR$CHNGVOLNR(F$DCB.VOL+1) WHENALTRETURN DO;

   9666  2 004770   300043 236100                    LDQ     35,,PR3
         2 004771   000033 772000                    QRL     27
         2 004772   000001 036007                    ADLQ    1,DL
         2 004773   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 004774   200046 634500                    EPPR4   @ALBL$+2,,AUTO
         2 004775   200047 454500                    STP4    @ALBL$+3,,AUTO
         2 004776   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 004777   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005000   000000 701000 xent               TSX1    FTR$CHNGVOLNR
         2 005001   005003 702000 2                  TSX2    s:9667
         2 005002   005013 710000 2                  TRA     s:9671

     1636     9667    6                             IF B$JIT.ERR.CODE = %E$VOLOUT THEN

   9667  2 005003   000000 470400 xsym               LDP0    B$JIT$
         2 005004   000012 236100                    LDQ     10,,PR0
         2 005005   377770 376007                    ANQ     131064,DL
         2 005006   013270 116007                    CMPQ    5816,DL
         2 005007   005012 601000 2                  TNZ     s:9669

     1637     9668    6                                B$JIT.ERR = E_EOSET;

   9668  2 005010   000003 236000 1                  LDQ     E_EOSET
         2 005011   000012 756100                    STQ     10,,PR0

     1638     9669    6                             ALTRETURN;

   9669  2 005012   000000 702200 xent               TSX2  ! X66_AALT

     1639     9670    6                             END;
     1640     9671    5                          DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9671  2 005013   200011 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:242  
         2 005014   000051 720100                    LXL0    41,,PR0
         2 005015   000000 471400 xsym               LDP1    N$DCT$$
         2 005016   100000 473510                    LDP3    0,X0,PR1
         2 005017   300004 236100                    LDQ     4,,PR3
         2 005020   200010 756100                    STQ     DDDT$,,AUTO

     1641     9672    6                          IF NOT FT$DDT.ANST AND FT$DDT.NOWANS THEN DO;

   9672  2 005021   200010 474500                    LDP4    DDDT$,,AUTO
         2 005022   400006 236100                    LDQ     6,,PR4
         2 005023   400000 316007                    CANQ    -131072,DL
         2 005024   004652 601000 2                  TNZ     s:9633
         2 005025   010000 316007                    CANQ    4096,DL
         2 005026   004652 600000 2                  TZE     s:9633

     1642     9673                                                /* Find first HDR1 if necessary       */
     1643     9674    7                             IF FT$DDT.POS = FTP_BOV# THEN DO;

   9674  2 005027   400006 236100                    LDQ     6,,PR4
         2 005030   000160 376007                    ANQ     112,DL
         2 005031   000020 116007                    CMPQ    16,DL
         2 005032   004652 601000 2                  TNZ     s:9633

     1644     9675    7                                F$DCB.ARS = 1;

   9675  2 005033   000001 235007                    LDA     1,DL
         2 005034   000000 755100                    STA     0,,PR0

     1645     9676    7                                CALL FTI$SPFILE ALTRET(JUSTALT);

   9676  2 005035   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005036   000000 701000 xent               TSX1    FTI$SPFILE
         2 005037   006767 702000 2                  TSX2    JUSTALT

     1646     9677    7                                FT$DDT.POS = FTP_HDR#;

   9677  2 005040   200010 470500                    LDP0    DDDT$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:243  
         2 005041   000006 236100                    LDQ     6,,PR0
         2 005042   000003 376000 3                  ANQ     3
         2 005043   000040 276007                    ORQ     32,DL
         2 005044   000006 756100                    STQ     6,,PR0

     1647     9678    7                                END;

     1648     9679    6                             END;

     1649     9680    5                          END;

     1650     9681    4                       END;

     1651     9682    3                    END;

   9682  2 005045   004652 710000 2                  TRA     s:9633

     1652     9683    3                 ELSE DO;                  /* Got next HDR1                      */

     1653     9684    3                    F$DCB.FSN = THISFSN;   /* Set FSN from HDR1.                 */

   9684  2 005046   200031 720100                    LXL0    THISFSN,,AUTO
         2 005047   000034 740100                    STX0    28,,PR0

     1654     9685    3                    RETURN;

   9685  2 005050   000000 702200 xent               TSX2  ! X66_ARET

     1655     9686    3                    END;
     1656     9687    2                 END;

     1657     9688
     1658     9689        /********************************************************************/
     1659     9690        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:244  
     1660     9691        /*********************************************************************/
     1661     9692    1   FTL$EOF:   ENTRY(THELBL) ALTRET;

   9692  2 005051   000000 700200 xent  FTL$EOF      TSX0  ! X66_AUTO_5
         2 005052   000052 000005                    ZERO    42,5

     1662     9693        /*F*     NAME: FTL$EOF
     1663     9694                 PURPOSE: Handle EOF/EOV label after file mark after data blocks.
     1664     9695                 DESCRIPTION: If the following label is an EOF, return end of file.
     1665     9696                    If the following label is an EOV and the user requested
     1666     9697                    CVOL handling, return end of volume.  In either of the
     1667     9698                    above cases, position is left before the file mark
     1668     9699                    preceeding the EOx label group.
     1669     9700                    For EOV label with user not handling CVOL, auto CVOL.
     1670     9701                    For (managed) DEVICE tapes, always return end-of-file.
     1671     9702         ***/
     1672     9703
     1673     9704        /********************/
     1674     9705
     1675     9706         /***
     1676     9707          *** If end of file, return eof code.  If end of volume,
     1677     9708          *** and user desires CVOL control, backup to end of file section and
     1678     9709          *** get ready for CVOL.
     1679     9710          ***/
     1680     9711
     1681     9712    1              CALL FTL_LBLINIT ALTRET(JUSTALT);

   9712  2 005053   006665 701000 2                  TSX1    FTL_LBLINIT
         2 005054   006767 702000 2                  TSX2    JUSTALT

     1682     9713         /***
     1683     9714         ***/
     1684     9715    1              IF F$DCB.IASN = %OD#

   9715  2 005055   200011 470500                    LDP0    JDCB$,,AUTO
         2 005056   000103 236100                    LDQ     67,,PR0
         2 005057   000777 376007                    ANQ     511,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:245  
         2 005060   000012 116007                    CMPQ    10,DL
         2 005061   005065 601000 2                  TNZ     s:9720

     1685     9716    2              THEN DO;

     1686     9717    2                 CALL FTL_ODEOF ALTRET (JUSTALT); /* Optical Disc EOF/EOV        */

   9717  2 005062   005354 701000 2                  TSX1    FTL_ODEOF
         2 005063   006767 702000 2                  TSX2    JUSTALT

     1687     9718    2                 RETURN;

   9718  2 005064   000000 702200 xent               TSX2  ! X66_ARET

     1688     9719    2                 END;
     1689     9720    1              IF F$DCB.ASN ~= %DEVICE#

   9720  2 005065   000032 236100                    LDQ     26,,PR0
         2 005066   777000 376007                    ANQ     -512,DL
         2 005067   003000 116007                    CMPQ    1536,DL
         2 005070   005105 600000 2                  TZE     s:9731

     1690     9721    2              THEN DO;                     /* Check block count                  */

     1691     9722    2                 CALL FTL_CHKEOX ALTRET(JUSTALT);

   9722  2 005071   006535 701000 2                  TSX1    FTL_CHKEOX
         2 005072   006767 702000 2                  TSX2    JUSTALT

     1692     9723    2                 IF B$JIT.ERR

   9723  2 005073   000000 470400 xsym               LDP0    B$JIT$
         2 005074   000012 235100                    LDA     10,,PR0
         2 005075   005231 600000 2                  TZE     s:9766

     1693     9724    3                 THEN DO;                  /* Block count error                  */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:246  
     1694     9725    3                    F$DCB.ARS = -1;

   9725  2 005076   000001 336007                    LCQ     1,DL
         2 005077   200011 471500                    LDP1    JDCB$,,AUTO
         2 005100   100000 756100                    STQ     0,,PR1

     1695     9726    3                    CALL FTI$SPFILE ALTRET(JUSTALT); /* Pos before last file mark */

   9726  2 005101   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005102   000000 701000 xent               TSX1    FTI$SPFILE
         2 005103   006767 702000 2                  TSX2    JUSTALT

     1696     9727    3                    ALTRETURN;

   9727  2 005104   000000 702200 xent               TSX2  ! X66_AALT

     1697     9728    3                    END;
     1698     9729    2                 END;
     1699     9730    2              ELSE DO;                     /* Device (managed tape)              */

     1700     9731    2                 F$DCB.ARS = 4;

   9731  2 005105   000004 235007                    LDA     4,DL
         2 005106   000000 755100                    STA     0,,PR0

     1701     9732    2                 CALL FTI$RDASCEBC(ADDR(I)) ALTRET(JUSTALT);

   9732  2 005107   200012 631500                    EPPR1   I,,AUTO
         2 005110   200046 451500                    STP1    @ALBL$+2,,AUTO
         2 005111   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 005112   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 005113   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 005114   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005115   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 005116   006767 702000 2                  TSX2    JUSTALT

     1702     9733    2                 IF F$DCB.TYC.EOF(1)
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:247  

   9733  2 005117   200011 470500                    LDP0    JDCB$,,AUTO
         2 005120   000002 236100                    LDQ     2,,PR0
         2 005121   004000 316003                    CANQ    2048,DU
         2 005122   005224 600000 2                  TZE     s:9761

     1703     9734    3                 THEN DO;                  /* Double file mark                   */

     1704     9735    3                    F$DCB.ARS = -1;

   9735  2 005123   000001 335007                    LCA     1,DL
         2 005124   000000 755100                    STA     0,,PR0

     1705     9736    3                    CALL FTI$SPFILE ALTRET(JUSTALT); /* Position between marks   */

   9736  2 005125   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005126   000000 701000 xent               TSX1    FTI$SPFILE
         2 005127   006767 702000 2                  TSX2    JUSTALT

     1706     9737    3                    IF F$DCB.CVOL          /* User desires CVOL control          */

   9737  2 005130   200011 470500                    LDP0    JDCB$,,AUTO
         2 005131   000031 236100                    LDQ     25,,PR0
         2 005132   000020 316007                    CANQ    16,DL
         2 005133   005220 600000 2                  TZE     s:9757
         2 005134   000064 236100                    LDQ     52,,PR0
         2 005135   000002 316003                    CANQ    2,DU
         2 005136   005220 601000 2                  TNZ     s:9757
         2 005137   000067 236100                    LDQ     55,,PR0
         2 005140   000020 316003                    CANQ    16,DU
         2 005141   005220 601000 2                  TNZ     s:9757

     1707     9738    3                        AND NOT F$DCB.MUST_CVOL
     1708     9739    3                        AND NOT F$DCB.TAPTYP.NOCVOL
     1709     9740    4                    THEN DO;               /* User gets CVOL control             */

     1710     9741    4                       CALL FTR$GETSN( F$DCB.VOL+1, ADDR(SN) ) ALTRET(NO_NEXT_VOL);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:248  

   9741  2 005142   000043 236100                    LDQ     35,,PR0
         2 005143   000033 772000                    QRL     27
         2 005144   000001 036007                    ADLQ    1,DL
         2 005145   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 005146   200032 631500                    EPPR1   SN,,AUTO
         2 005147   200047 451500                    STP1    @ALBL$+3,,AUTO
         2 005150   200047 633500                    EPPR3   @ALBL$+3,,AUTO
         2 005151   200051 453500                    STP3    @ALBL$+5,,AUTO
         2 005152   200046 634500                    EPPR4   @ALBL$+2,,AUTO
         2 005153   200050 454500                    STP4    @ALBL$+4,,AUTO
         2 005154   200050 630500                    EPPR0   @ALBL$+4,,AUTO
         2 005155   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005156   000000 701000 xent               TSX1    FTR$GETSN
         2 005157   005175 702000 2                  TSX2    NO_NEXT_VOL

     1711     9742    4                       IF F$DCB.SPAN

   9742  2 005160   200011 470500                    LDP0    JDCB$,,AUTO
         2 005161   000064 236100                    LDQ     52,,PR0
         2 005162   100000 316007                    CANQ    32768,DL
         2 005163   005170 600000 2                  TZE     s:9744

     1712     9743    4                       THEN B$JIT.ERR = E_EOVOLS; /*E* FTL-E$EOVOLS */

   9743  2 005164   000005 236000 1                  LDQ     E_EOVOLS
         2 005165   000000 471400 xsym               LDP1    B$JIT$
         2 005166   100012 756100                    STQ     10,,PR1
         2 005167   005173 710000 2                  TRA     s:9745

     1713     9744    4                       ELSE B$JIT.ERR = E_EOVOL; /*E* FTL-E$EOVOL */

   9744  2 005170   000004 236000 1                  LDQ     E_EOVOL
         2 005171   000000 471400 xsym               LDP1    B$JIT$
         2 005172   100012 756100                    STQ     10,,PR1

     1714     9745    4                       F$DCB.MUST_CVOL = %YES#;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:249  

   9745  2 005173   000002 236003                    LDQ     2,DU
         2 005174   000064 256100                    ORSQ    52,,PR0

   9745  2 005175                       NO_NEXT_VOL  null
     1715     9746    4   NO_NEXT_VOL:        ;
     1716     9747    4                       IF F$DCB.SPAN

   9747  2 005175   200011 470500                    LDP0    JDCB$,,AUTO
         2 005176   000064 236100                    LDQ     52,,PR0
         2 005177   100000 316007                    CANQ    32768,DL
         2 005200   005207 600000 2                  TZE     s:9752

     1717     9748    5                       THEN DO;

     1718     9749    5                          B$JIT.ERR = E_BADSPAN; /*E* ERROR: FTL-E$BADSPAN */

   9749  2 005201   000000 236000 1                  LDQ     E_BADSPAN
         2 005202   000000 471400 xsym               LDP1    B$JIT$
         2 005203   100012 756100                    STQ     10,,PR1

     1719     9750    5                          F$DCB.SPAN = %NO#; /* Next read gets E$EOF             */

   9750  2 005204   000047 236000 3                  LDQ     39
         2 005205   000064 356100                    ANSQ    52,,PR0

     1720     9751    5                          END;

   9751  2 005206   005212 710000 2                  TRA     s:9753

     1721     9752    4                       ELSE B$JIT.ERR = E_EOF; /*E* ERROR: FTL-E$EOF */

   9752  2 005207   000002 236000 1                  LDQ     E_EOF
         2 005210   000000 471400 xsym               LDP1    B$JIT$
         2 005211   100012 756100                    STQ     10,,PR1

     1722     9753    4                       F$DCB.ARS = -1;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:250  

   9753  2 005212   000001 335007                    LCA     1,DL
         2 005213   000000 755100                    STA     0,,PR0

     1723     9754    4                       CALL FTI$SPFILE ALTRET(JUSTALT); /* Pos before 1st        */

   9754  2 005214   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005215   000000 701000 xent               TSX1    FTI$SPFILE
         2 005216   006767 702000 2                  TSX2    JUSTALT

     1724     9755    4                       ALTRETURN;

   9755  2 005217   000000 702200 xent               TSX2  ! X66_AALT

     1725     9756    4                       END;
     1726     9757    3                    CALL FTW$CVOL ALTRET(CHKVOLOUT);

   9757  2 005220   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005221   000000 701000 xent               TSX1    FTW$CVOL
         2 005222   005232 702000 2                  TSX2    CHKVOLOUT

     1727     9758    3                    RETURN;                /* Successful CVOL                    */

   9758  2 005223   000000 702200 xent               TSX2  ! X66_ARET

     1728     9759    3                    END;
     1729     9760    3                 ELSE DO;

     1730     9761    3                    F$DCB.ARS = -1;

   9761  2 005224   000001 335007                    LCA     1,DL
         2 005225   000000 755100                    STA     0,,PR0

     1731     9762    3                    CALL FTI$SPREC ALTRET(JUSTALT);
              9762                             /* Back up to just after file mark */

   9762  2 005226   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:251  
         2 005227   000000 701000 xent               TSX1    FTI$SPREC
         2 005230   006767 702000 2                  TSX2    JUSTALT

     1732     9763    3                    END;

     1733     9764    2                 END;

     1734     9765
     1735     9766    2              DO WHILE('0'B);

   9766  2 005231   005240 710000 2                  TRA     s:9771

   9759  2 005232                       CHKVOLOUT    null
     1736     9767    2   CHKVOLOUT:    ;
     1737     9768    2                 IF B$JIT.ERR.CODE ~= %E$VOLOUT

   9768  2 005232   000000 470400 xsym               LDP0    B$JIT$
         2 005233   000012 236100                    LDQ     10,,PR0
         2 005234   377770 376007                    ANQ     131064,DL
         2 005235   013270 116007                    CMPQ    5816,DL
         2 005236   005240 600000 2                  TZE     s:9771

     1738     9769    2                 THEN ALTRETURN;           /* Return with other error            */

   9769  2 005237   000000 702200 xent               TSX2  ! X66_AALT

     1739     9770    2                 END;

     1740     9771    1              IF THELBL = 'EOF' OR F$DCB.ASN = %DEVICE#

   9771  2 005240   200003 470500                    LDP0    @THELBL,,AUTO
         2 005241   040000 106500                    CMPC    fill='040'O
         2 005242   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         2 005243   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 005244   005252 600000 2                  TZE     s:9773
         2 005245   200011 471500                    LDP1    JDCB$,,AUTO
         2 005246   100032 236100                    LDQ     26,,PR1
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:252  
         2 005247   777000 376007                    ANQ     -512,DL
         2 005250   003000 116007                    CMPQ    1536,DL
         2 005251   005313 601000 2                  TNZ     s:9790

     1741     9772    2              THEN DO;                     /* End of file                        */

     1742     9773    2                 IF F$DCB.SPAN

   9773  2 005252   200011 471500                    LDP1    JDCB$,,AUTO
         2 005253   100064 236100                    LDQ     52,,PR1
         2 005254   100000 316007                    CANQ    32768,DL
         2 005255   005264 600000 2                  TZE     s:9778

     1743     9774    3                 THEN DO;                  /* End of file in span?               */

     1744     9775    3                    B$JIT.ERR = E_BADSPAN; /*E* ERROR: FTL-E$BADSPAN */

   9775  2 005256   000000 236000 1                  LDQ     E_BADSPAN
         2 005257   000000 473400 xsym               LDP3    B$JIT$
         2 005260   300012 756100                    STQ     10,,PR3

     1745     9776    3                    F$DCB.SPAN = %NO#;

   9776  2 005261   000047 236000 3                  LDQ     39
         2 005262   100064 356100                    ANSQ    52,,PR1

     1746     9777    3                    END;

   9777  2 005263   005267 710000 2                  TRA     s:9779

     1747     9778    2                 ELSE B$JIT.ERR = E_EOF; /*E* ERROR: FTL-E$EOF */

   9778  2 005264   000002 236000 1                  LDQ     E_EOF
         2 005265   000000 473400 xsym               LDP3    B$JIT$
         2 005266   300012 756100                    STQ     10,,PR3

     1748     9779    2                 F$DCB.LSTBLK = %YES#;     /* At last block of file              */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:253  

   9779  2 005267   000001 236007                    LDQ     1,DL
         2 005270   100064 256100                    ORSQ    52,,PR1

     1749     9780    2                 IF F$DCB.ASN ~= %DEVICE#

   9780  2 005271   100032 236100                    LDQ     26,,PR1
         2 005272   777000 376007                    ANQ     -512,DL
         2 005273   003000 116007                    CMPQ    1536,DL
         2 005274   005303 600000 2                  TZE     s:9783

     1750     9781    2                 THEN FT$DDT.POS = FTP_CHK#; /* Not in data                      */

   9781  2 005275   200010 474500                    LDP4    DDDT$,,AUTO
         2 005276   400006 236100                    LDQ     6,,PR4
         2 005277   000003 376000 3                  ANQ     3
         2 005300   000120 276007                    ORQ     80,DL
         2 005301   400006 756100                    STQ     6,,PR4
         2 005302   005312 710000 2                  TRA     s:9787

     1751     9782    3                 ELSE DO;

     1752     9783    3                    F$DCB.ARS = -1;        /* Position before file mark          */

   9783  2 005303   000001 335007                    LCA     1,DL
         2 005304   100000 755100                    STA     0,,PR1

     1753     9784    3                    CALL FTI$SPFILE ALTRET(JUSTALT);

   9784  2 005305   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005306   000000 701000 xent               TSX1    FTI$SPFILE
         2 005307   006767 702000 2                  TSX2    JUSTALT

     1754     9785    3                    F$DCB.TYC(1) = '0'B;   /* Reset EOF                          */

   9785  2 005310   200011 470500                    LDP0    JDCB$,,AUTO
         2 005311   000002 450100                    STZ     2,,PR0
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:254  

     1755     9786    3                    END;

     1756     9787    2                 ALTRETURN;

   9787  2 005312   000000 702200 xent               TSX2  ! X66_AALT

     1757     9788    2                 END;
     1758     9789    2              ELSE DO;

     1759     9790    2                 IF F$DCB.CVOL             /* User desires CVOL control          */

   9790  2 005313   100031 236100                    LDQ     25,,PR1
         2 005314   000020 316007                    CANQ    16,DL
         2 005315   005346 600000 2                  TZE     s:9809
         2 005316   100064 236100                    LDQ     52,,PR1
         2 005317   000002 316003                    CANQ    2,DU
         2 005320   005346 601000 2                  TNZ     s:9809
         2 005321   100067 236100                    LDQ     55,,PR1
         2 005322   000020 316003                    CANQ    16,DU
         2 005323   005346 601000 2                  TNZ     s:9809

     1760     9791    2                     AND NOT F$DCB.MUST_CVOL /* And CVOLing is not required      */
     1761     9792    2                    AND NOT F$DCB.TAPTYP.NOCVOL /* And user CVOL control is allowed */
     1762     9793    3                 THEN DO;                  /* User desires CVOL handling         */

     1763     9794    3                    IF F$DCB.SPAN

   9794  2 005324   100064 236100                    LDQ     52,,PR1
         2 005325   100000 316007                    CANQ    32768,DL
         2 005326   005333 600000 2                  TZE     s:9796

     1764     9795    3                    THEN B$JIT.ERR = E_EOVOLS; /*E* ERROR: FTL-E$EOVOLS */

   9795  2 005327   000005 236000 1                  LDQ     E_EOVOLS
         2 005330   000000 473400 xsym               LDP3    B$JIT$
         2 005331   300012 756100                    STQ     10,,PR3
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:255  
         2 005332   005336 710000 2                  TRA     s:9797

     1765     9796    3                    ELSE B$JIT.ERR = E_EOVOL; /*E* ERROR: FTL-E$EOVOL */

   9796  2 005333   000004 236000 1                  LDQ     E_EOVOL
         2 005334   000000 473400 xsym               LDP3    B$JIT$
         2 005335   300012 756100                    STQ     10,,PR3

     1766     9797    3                    F$DCB.MUST_CVOL = %YES#; /* CVOL before next operation       */

   9797  2 005336   000002 236003                    LDQ     2,DU
         2 005337   100064 256100                    ORSQ    52,,PR1

     1767     9798    3                    F$DCB.ARS = -1;   /* Position to end of current file section */

   9798  2 005340   000001 335007                    LCA     1,DL
         2 005341   100000 755100                    STA     0,,PR1

     1768     9799    3                    CALL FTI$SPFILE ALTRET(JUSTALT);

   9799  2 005342   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005343   000000 701000 xent               TSX1    FTI$SPFILE
         2 005344   006767 702000 2                  TSX2    JUSTALT

     1769     9800    3                    ALTRETURN;

   9800  2 005345   000000 702200 xent               TSX2  ! X66_AALT

     1770     9801    3                    END;
     1771     9802    2                 END;
     1772     9803
     1773     9804         /***
     1774     9805          *** User does not desire CVOL control.  Change to next volume and
     1775     9806          *** find file section.
     1776     9807          ***/
     1777     9808
     1778     9809    1              CALL FTL_PBNFS ALTRET(JUSTALT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:256  
              9809                       /* Position to beginning of next file sect */

   9809  2 005346   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 005347   200042 756100                    STQ     @UHL$+1,,AUTO
         2 005350   200041 756100                    STQ     DT1+5,,AUTO
         2 005351   005441 701000 2                  TSX1    FTL_PBNFS
         2 005352   006767 702000 2                  TSX2    JUSTALT

     1779     9810    1              RETURN;

   9810  2 005353   000000 702200 xent               TSX2  ! X66_ARET

     1780     9811
     1781     9812        /*********************************************************************/
     1782     9813        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:257  
     1783     9814        /******************************************************************/
     1784     9815    1   FTL_ODEOF: PROC ALTRET;

   9815  2 005354   200036 741300       FTL_ODEOF    STX1  ! DT1+2,,AUTO

     1785     9816        /*F*     NAME: FTL_ODEOF
     1786     9817                 PURPOSE: Handle EOF/EOV for Optical Disc file.
     1787     9818                 DESCRIPTION:  Get the EOF or EOV label record from the disc
     1788     9819                    and return the same conditions as labeled tape would.
     1789     9820                    Ignore user CVOL requests.
     1790     9821        ***/
     1791     9822
     1792     9823        /***************************/
     1793     9824
     1794     9825    2              CALL FPO$RDEOFLBL (LBL1$) ALTRET(JUSTALT);

   9825  2 005355   200014 630500                    EPPR0   LBL1$,,AUTO
         2 005356   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 005357   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 005360   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005361   000000 701000 xent               TSX1    FPO$RDEOFLBL
         2 005362   005437 702000 2                  TSX2    JUSTALT

     1795     9826    2              THELBL = LBL1$->FT$ULBL.LABEL_ID; /* Return label id               */

   9826  2 005363   200014 470500                    LDP0    LBL1$,,AUTO
         2 005364   200003 471500                    LDP1    @THELBL,,AUTO
         2 005365   040100 100500                    MLR     fill='040'O
         2 005366   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         2 005367   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3

     1796     9827    2              CALL FTL_CHKBLKCNT;          /* Check block count error            */

   9827  2 005370   006631 701000 2                  TSX1    FTL_CHKBLKCNT
         2 005371   000000 011000                    NOP     0

     1797     9828    2              IF B$JIT.ERR THEN ALTRETURN; /*Block count error                   */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:258  

   9828  2 005372   000000 470400 xsym               LDP0    B$JIT$
         2 005373   000012 235100                    LDA     10,,PR0
         2 005374   005377 600000 2                  TZE     s:9829

   9828  2 005375   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 005376   000000 702211                    TSX2  ! 0,X1

     1798     9829    2              IF THELBL = 'EOF'

   9829  2 005377   200003 471500                    LDP1    @THELBL,,AUTO
         2 005400   040000 106500                    CMPC    fill='040'O
         2 005401   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 005402   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 005403   005430 601000 2                  TNZ     s:9841

     1799     9830    3              THEN DO;

     1800     9831    3                 IF F$DCB.SPAN

   9831  2 005404   200011 473500                    LDP3    JDCB$,,AUTO
         2 005405   300064 236100                    LDQ     52,,PR3
         2 005406   100000 316007                    CANQ    32768,DL
         2 005407   005415 600000 2                  TZE     s:9836

     1801     9832    4                 THEN DO;

     1802     9833    4                    B$JIT.ERR = E_BADSPAN;

   9833  2 005410   000000 236000 1                  LDQ     E_BADSPAN
         2 005411   000012 756100                    STQ     10,,PR0

     1803     9834    4                    F$DCB.SPAN = %NO#;

   9834  2 005412   000047 236000 3                  LDQ     39
         2 005413   300064 356100                    ANSQ    52,,PR3

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:259  
     1804     9835    4                    END;

   9835  2 005414   005417 710000 2                  TRA     s:9837

     1805     9836    3                 ELSE B$JIT.ERR = E_EOF;

   9836  2 005415   000002 236000 1                  LDQ     E_EOF
         2 005416   000012 756100                    STQ     10,,PR0

     1806     9837    3                 F$DCB.LSTBLK = %YES#;

   9837  2 005417   000001 236007                    LDQ     1,DL
         2 005420   300064 256100                    ORSQ    52,,PR3

     1807     9838    3                 FT$DDT.POS = FTP_CHK#;

   9838  2 005421   200010 474500                    LDP4    DDDT$,,AUTO
         2 005422   400006 236100                    LDQ     6,,PR4
         2 005423   000003 376000 3                  ANQ     3
         2 005424   000120 276007                    ORQ     80,DL
         2 005425   400006 756100                    STQ     6,,PR4

     1808     9839    3                 ALTRETURN;

   9839  2 005426   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 005427   000000 702211                    TSX2  ! 0,X1

     1809     9840    3                 END;
     1810     9841    2              CALL FTL_PBNFS ALTRET(JUSTALT);

   9841  2 005430   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 005431   200042 756100                    STQ     @UHL$+1,,AUTO
         2 005432   200041 756100                    STQ     DT1+5,,AUTO
         2 005433   005441 701000 2                  TSX1    FTL_PBNFS
         2 005434   005437 702000 2                  TSX2    JUSTALT

     1811     9842    2              RETURN;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:260  

   9842  2 005435   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 005436   000001 702211                    TSX2  ! 1,X1

     1812     9843
     1813     9844    2   JUSTALT:   ALTRETURN;

   9844  2 005437   200036 221300       JUSTALT      LDX1  ! DT1+2,,AUTO
         2 005440   000000 702211                    TSX2  ! 0,X1

     1814     9845
     1815     9846    2      END FTL_ODEOF;
     1816     9847        /*******************************************************************/
     1817     9848        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:261  
     1818     9849        /*********************************************************************/
     1819     9850    1   FTL_PBNFS: PROC(UHL$,NUHL) ALTRET;

   9850  2 005441   200040 741300       FTL_PBNFS    STX1  ! DT1+4,,AUTO

     1820     9851        /*F*     NAME: FTL_PBNFS
     1821     9852                 PURPOSE: Position to beginning of next file section after EOV label.
     1822     9853         ***/
     1823     9854
     1824     9855         /***
     1825     9856          *** Parameters:
     1826     9857          ***/
     1827     9858
     1828     9859    2     DCL NUHL SBIN;                        /* Number of bytes in UHL group       */
     1829     9860    2     DCL UHL$ PTR;                         /* Pointer to UHL VLP_ULBL (optional) */
     1830     9861
     1831     9862
     1832     9863        /********************/
     1833     9864
     1834     9865         /***
     1835     9866          *** If somewhere in EOV labels,  position past next file mark.
     1836     9867          ***/
     1837     9868
     1838     9869    3              IF NOT F$DCB.TYC.EOF(1) AND F$DCB.IASN ~= %OD# THEN DO;

   9869  2 005442   200011 470500                    LDP0    JDCB$,,AUTO
         2 005443   000002 236100                    LDQ     2,,PR0
         2 005444   004000 316003                    CANQ    2048,DU
         2 005445   005457 601000 2                  TNZ     s:9874
         2 005446   000103 236100                    LDQ     67,,PR0
         2 005447   000777 376007                    ANQ     511,DL
         2 005450   000012 116007                    CMPQ    10,DL
         2 005451   005457 600000 2                  TZE     s:9874

     1839     9870    3                 F$DCB.ARS = 1;

   9870  2 005452   000001 235007                    LDA     1,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:262  
         2 005453   000000 755100                    STA     0,,PR0

     1840     9871    3                 CALL FTI$SPFILE ALTRET(JUSTALT);

   9871  2 005454   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005455   000000 701000 xent               TSX1    FTI$SPFILE
         2 005456   005645 702000 2                  TSX2    JUSTALT

     1841     9872    3                 END;

     1842     9873
     1843     9874    2              IF F$DCB.IASN = %OD# THEN

   9874  2 005457   200011 470500                    LDP0    JDCB$,,AUTO
         2 005460   000103 236100                    LDQ     67,,PR0
         2 005461   000777 376007                    ANQ     511,DL
         2 005462   000012 116007                    CMPQ    10,DL
         2 005463   005467 601000 2                  TNZ     s:9877

     1844     9875    2                 CALL FPO$CLOSEIN ALTRET(JUSTALT);

   9875  2 005464   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005465   000000 701000 xent               TSX1    FPO$CLOSEIN
         2 005466   005645 702000 2                  TSX2    JUSTALT

     1845     9876
     1846     9877    2              NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_EOV#;

   9877  2 005467   200011 470500                    LDP0    JDCB$,,AUTO
         2 005470   000051 720100                    LXL0    41,,PR0
         2 005471   000000 471400 xsym               LDP1    N$DCT$$
         2 005472   100000 473510                    LDP3    0,X0,PR1
         2 005473   300004 474500                    LDP4    4,,PR3
         2 005474   400006 236100                    LDQ     6,,PR4
         2 005475   000003 376000 3                  ANQ     3
         2 005476   000100 276007                    ORQ     64,DL
         2 005477   400006 756100                    STQ     6,,PR4
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:263  

     1847     9878
     1848     9879
     1849     9880         /***
     1850     9881          *** Change to next volume and find section with proper number.
     1851     9882          ***/
     1852     9883
     1853     9884    2              F$DCB.SEZ_OK = %NO#;         /* Don't CVOL to scratch              */

   9884  2 005500   000043 236000 3                  LDQ     35
         2 005501   000064 356100                    ANSQ    52,,PR0

     1854     9885    2              CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(CHKFSECT);

   9885  2 005502   000043 236100                    LDQ     35,,PR0
         2 005503   000033 772000                    QRL     27
         2 005504   000001 036007                    ADLQ    1,DL
         2 005505   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 005506   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 005507   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 005510   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 005511   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005512   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 005513   005627 702000 2                  TSX2    CHKFSECT

     1855     9886    2              F$DCB.FSECT = F$DCB.FSECT + 1; /* Get next section                 */

   9886  2 005514   200011 470500                    LDP0    JDCB$,,AUTO
         2 005515   000077 220100                    LDX0    63,,PR0
         2 005516   000001 621010                    EAX1    1,X0
         2 005517   000077 741100                    STX1    63,,PR0

     1856     9887    3              IF F$DCB.IASN = %OD# THEN DO;

   9887  2 005520   000103 236100                    LDQ     67,,PR0
         2 005521   000777 376007                    ANQ     511,DL
         2 005522   000012 116007                    CMPQ    10,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:264  
         2 005523   005533 601000 2                  TNZ     s:9892

     1857     9888    3                 CALL FPO$FINDSEQ ALTRET (CHKFSECT);

   9888  2 005524   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005525   000000 701000 xent               TSX1    FPO$FINDSEQ
         2 005526   005627 702000 2                  TSX2    CHKFSECT

     1858     9889    3                 CALL FPO$OPENIN ALTRET(JUSTALT);

   9889  2 005527   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005530   000000 701000 xent               TSX1    FPO$OPENIN
         2 005531   005645 702000 2                  TSX2    JUSTALT

     1859     9890    3                 END;

   9890  2 005532   005604 710000 2                  TRA     s:9906

     1860     9891    3              ELSE DO;

     1861     9892    3                 CALL FTL$FINDSEQ ALTRET (CHKFSECT);

   9892  2 005533   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005534   003602 701000 2                  TSX1    s:9287
         2 005535   005627 702000 2                  TSX2    CHKFSECT

     1862     9893    4                 IF ADDR(UHL$) = ADDR(NIL) THEN DO;
              9893                          /* Non-M$CVOL call...don't get UHLs */

   9893  2 005536   200041 236100                    LDQ     @UHL$,,AUTO
         2 005537   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 005540   005553 601000 2                  TNZ     s:9900

     1863     9894    5                    IF NOT F$DCB.TYC.EOF(1) THEN DO;

   9894  2 005541   200011 470500                    LDP0    JDCB$,,AUTO
         2 005542   000002 236100                    LDQ     2,,PR0
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:265  
         2 005543   004000 316003                    CANQ    2048,DU
         2 005544   005604 601000 2                  TNZ     s:9906

     1864     9895    5                       F$DCB.ARS = 1;      /* Get to data                        */

   9895  2 005545   000001 235007                    LDA     1,DL
         2 005546   000000 755100                    STA     0,,PR0

     1865     9896    5                       CALL FTI$SPFILE ALTRET(JUSTALT);

   9896  2 005547   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005550   000000 701000 xent               TSX1    FTI$SPFILE
         2 005551   005645 702000 2                  TSX2    JUSTALT

     1866     9897    5                       END;

     1867     9898    4                    END;

   9898  2 005552   005604 710000 2                  TRA     s:9906

     1868     9899    4                 ELSE DO;                  /* M$CVOL call...get UHLs             */

     1869     9900    4                    IF NUHL > 0 THEN

   9900  2 005553   200042 470500                    LDP0    @NUHL,,AUTO
         2 005554   000000 235100                    LDA     0,,PR0
         2 005555   005570 604400 2                  TMOZ    s:9903

     1870     9901    4                       CALL FTL$GETULBLS('UHL',UHL$,NUHL) ALTRET(JUSTALT);

   9901  2 005556   200042 236100                    LDQ     @NUHL,,AUTO
         2 005557   200050 756100                    STQ     @ALBL$+4,,AUTO
         2 005560   200041 236100                    LDQ     @UHL$,,AUTO
         2 005561   000035 235000 3                  LDA     29
         2 005562   200046 757100                    STAQ    @ALBL$+2,,AUTO
         2 005563   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 005564   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:266  
         2 005565   001225 701000 2                  TSX1    s:8560
         2 005566   005645 702000 2                  TSX2    JUSTALT
         2 005567   005604 710000 2                  TRA     s:9906

     1871     9902    4                    ELSE
     1872     9903    4                       CALL FTL$GETULBLS('UHL',ADDR(NIL),NUHL) ALTRET(JUSTALT);

   9903  2 005570   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 005571   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 005572   200042 236100                    LDQ     @NUHL,,AUTO
         2 005573   200051 756100                    STQ     @ALBL$+5,,AUTO
         2 005574   200046 631500                    EPPR1   @ALBL$+2,,AUTO
         2 005575   200050 451500                    STP1    @ALBL$+4,,AUTO
         2 005576   000035 236000 3                  LDQ     29
         2 005577   200047 756100                    STQ     @ALBL$+3,,AUTO
         2 005600   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 005601   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 005602   001225 701000 2                  TSX1    s:8560
         2 005603   005645 702000 2                  TSX2    JUSTALT

     1873     9904    4                    END;

     1874     9905    3                 END;

     1875     9906    2              F$DCB.PRECNO = 1;            /* At first block of next section     */

   9906  2 005604   000001 235007                    LDA     1,DL
         2 005605   200011 470500                    LDP0    JDCB$,,AUTO
         2 005606   000072 755100                    STA     58,,PR0

     1876     9907    2              F$DCB.AFTRBLK = %NO#;

   9907  2 005607   000037 236000 3                  LDQ     31
         2 005610   000064 356100                    ANSQ    52,,PR0

     1877     9908    2              F$DCB.NEW_FSECT = %YES#;     /* At beginning of file section       */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:267  
   9908  2 005611   000001 236003                    LDQ     1,DU
         2 005612   000064 256100                    ORSQ    52,,PR0

     1878     9909    2              F$DCB.MUST_CVOL = %NO#;      /* CVOL done                          */

   9909  2 005613   000040 236000 3                  LDQ     32
         2 005614   000064 356100                    ANSQ    52,,PR0

     1879     9910    2              NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_BOD#;

   9910  2 005615   000051 720100                    LXL0    41,,PR0
         2 005616   000000 471400 xsym               LDP1    N$DCT$$
         2 005617   100000 473510                    LDP3    0,X0,PR1
         2 005620   300004 474500                    LDP4    4,,PR3
         2 005621   400006 236100                    LDQ     6,,PR4
         2 005622   000003 376000 3                  ANQ     3
         2 005623   000060 276007                    ORQ     48,DL
         2 005624   400006 756100                    STQ     6,,PR4

     1880     9911    2              RETURN;

   9911  2 005625   200040 221300                    LDX1  ! DT1+4,,AUTO
         2 005626   000001 702211                    TSX2  ! 1,X1

   9910  2 005627                       CHKFSECT     null
     1881     9912
     1882     9913
     1883     9914    2   CHKFSECT:  ;
     1884     9915    2              I = B$JIT.ERR.CODE;

   9915  2 005627   000000 470400 xsym               LDP0    B$JIT$
         2 005630   000012 236100                    LDQ     10,,PR0
         2 005631   000003 772000                    QRL     3
         2 005632   037777 376007                    ANQ     16383,DL
         2 005633   200012 756100                    STQ     I,,AUTO

     1885     9916    2              IF I = %E$NOFILE THEN        /* File section could not be found    */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:268  

   9916  2 005634   000161 116007                    CMPQ    113,DL
         2 005635   005640 601000 2                  TNZ     s:9918

     1886     9917    2                 B$JIT.ERR = E_SECTERR; /*E* ERROR: FTL-E$SECTERR             */

   9917  2 005636   000012 236000 1                  LDQ     E_SECTERR
         2 005637   000012 756100                    STQ     10,,PR0

     1887     9918    2              IF I = %E$VOLOUT THEN        /* No next volume to CVOL to          */

   9918  2 005640   200012 235100                    LDA     I,,AUTO
         2 005641   001327 115007                    CMPA    727,DL
         2 005642   005645 601000 2                  TNZ     JUSTALT

     1888     9919    2                 B$JIT.ERR = E_VOLORDER; /*E* ERROR: FTL-E$VOLORDER            */

   9919  2 005643   000014 236000 1                  LDQ     E_VOLORDER
         2 005644   000012 756100                    STQ     10,,PR0

   9918  2 005645                       JUSTALT      null
     1889     9920
     1890     9921    2   JUSTALT:   ;
     1891     9922    2              ALTRETURN;

   9922  2 005645   200040 221300                    LDX1  ! DT1+4,,AUTO
         2 005646   000000 702211                    TSX2  ! 0,X1

     1892     9923
     1893     9924    2      END FTL_PBNFS;
     1894     9925        /*********************************************************************/
     1895     9926        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:269  
     1896     9927        /*********************************************************************/
     1897     9928    1   FTL$PBSN:  ENTRY( THELBL, LBL$, NUM ) ALTRET;

   9928  2 005647   000000 700200 xent  FTL$PBSN     TSX0  ! X66_AUTO_5
         2 005650   000052 000005                    ZERO    42,5

     1898     9929        /*F*     NAME: FTL$PBSN
     1899     9930                 PURPOSE: Position to beginning of specified section number.
     1900     9931                 INPUT: NUM - number of section to position to.
     1901     9932         ***/
     1902     9933
     1903     9934        /********************/
     1904     9935
     1905     9936         /***
     1906     9937          *** Position current tape to the nearest HDR1.
     1907     9938          ***/
     1908     9939
     1909     9940    1              JDCB$ = B$JIT.DCB$;

   9940  2 005651   000000 470400 xsym               LDP0    B$JIT$
         2 005652   000232 236100                    LDQ     154,,PR0
         2 005653   200011 756100                    STQ     JDCB$,,AUTO

     1910     9941    1              DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9941  2 005654   200011 471500                    LDP1    JDCB$,,AUTO
         2 005655   100051 720100                    LXL0    41,,PR1
         2 005656   000000 473400 xsym               LDP3    N$DCT$$
         2 005657   300000 474510                    LDP4    0,X0,PR3
         2 005660   400004 236100                    LDQ     4,,PR4
         2 005661   200010 756100                    STQ     DDDT$,,AUTO

     1911     9942    1              IF FT$DDT.POS = FTP_BOD#

   9942  2 005662   200010 475500                    LDP5    DDDT$,,AUTO
         2 005663   500006 236100                    LDQ     6,,PR5
         2 005664   000160 376007                    ANQ     112,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:270  
         2 005665   000060 116007                    CMPQ    48,DL
         2 005666   005701 601000 2                  TNZ     s:9948

     1912     9943    2              THEN DO;

     1913     9944    2                 F$DCB.ARS = 2;

   9944  2 005667   000002 235007                    LDA     2,DL
         2 005670   100000 755100                    STA     0,,PR1

     1914     9945    2                 CALL FTI$SPFILE ALTRET(JUSTALT); /* To next HDR1                */

   9945  2 005671   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005672   000000 701000 xent               TSX1    FTI$SPFILE
         2 005673   006767 702000 2                  TSX2    JUSTALT

     1915     9946    2                 FT$DDT.POS = FTP_HDR#;

   9946  2 005674   200010 470500                    LDP0    DDDT$,,AUTO
         2 005675   000006 236100                    LDQ     6,,PR0
         2 005676   000003 376000 3                  ANQ     3
         2 005677   000040 276007                    ORQ     32,DL
         2 005700   000006 756100                    STQ     6,,PR0

     1916     9947    2                 END;

     1917     9948    1              SKIPS = NUM - F$DCB.FSECT;   /* Calc offset to next section        */

   9948  2 005701   200011 470500                    LDP0    JDCB$,,AUTO
         2 005702   000077 236100                    LDQ     63,,PR0
         2 005703   000022 772000                    QRL     18
         2 005704   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 005705   200005 471500                    LDP1    @NUM,,AUTO
         2 005706   100000 236100                    LDQ     0,,PR1
         2 005707   200046 136100                    SBLQ    @ALBL$+2,,AUTO
         2 005710   200025 756100                    STQ     SKIPS,,AUTO

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:271  
     1918     9949    1              IF SKIPS ~= 0

   9949  2 005711   005726 600000 2                  TZE     s:9954

     1919     9950    2              THEN DO;                     /* Must change volume                 */

     1920     9951    2                 F$DCB.SEZ_OK = %NO#;      /* No scratches                       */

   9951  2 005712   000043 236000 3                  LDQ     35
         2 005713   000064 356100                    ANSQ    52,,PR0

     1921     9952    2                 CALL FTR$CHNGVOL(F$DCB.VOL + SKIPS) ALTRET(JUSTALT);

   9952  2 005714   000043 236100                    LDQ     35,,PR0
         2 005715   000033 772000                    QRL     27
         2 005716   200025 036100                    ADLQ    SKIPS,,AUTO
         2 005717   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 005720   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 005721   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 005722   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 005723   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005724   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 005725   006767 702000 2                  TSX2    JUSTALT

     1922     9953    2                 END;

     1923     9954    1              F$DCB.FSECT = NUM;

   9954  2 005726   200005 470500                    LDP0    @NUM,,AUTO
         2 005727   000000 720100                    LXL0    0,,PR0
         2 005730   200011 471500                    LDP1    JDCB$,,AUTO
         2 005731   100077 740100                    STX0    63,,PR1

     1924     9955    1              CALL FTL$FINDSEQ ALTRET(CHKFSECTX);

   9955  2 005732   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005733   003602 701000 2                  TSX1    s:9287
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:272  
         2 005734   005763 702000 2                  TSX2    CHKFSECTX

     1925     9956    1              F$DCB.ARS = 1;               /* Position to data blocks            */

   9956  2 005735   000001 235007                    LDA     1,DL
         2 005736   200011 470500                    LDP0    JDCB$,,AUTO
         2 005737   000000 755100                    STA     0,,PR0

     1926     9957    1              CALL FTI$SPFILE ALTRET(JUSTALT);

   9957  2 005740   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005741   000000 701000 xent               TSX1    FTI$SPFILE
         2 005742   006767 702000 2                  TSX2    JUSTALT

     1927     9958    1              F$DCB.PRECNO = 1;

   9958  2 005743   000001 235007                    LDA     1,DL
         2 005744   200011 470500                    LDP0    JDCB$,,AUTO
         2 005745   000072 755100                    STA     58,,PR0

     1928     9959    1              F$DCB.AFTRBLK = %NO#;

   9959  2 005746   000037 236000 3                  LDQ     31
         2 005747   000064 356100                    ANSQ    52,,PR0

     1929     9960    1              F$DCB.NEW_FSECT = %YES#;     /* At file section beginning          */

   9960  2 005750   000001 236003                    LDQ     1,DU
         2 005751   000064 256100                    ORSQ    52,,PR0

     1930     9961    1              NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POS = FTP_BOD#;

   9961  2 005752   000051 720100                    LXL0    41,,PR0
         2 005753   000000 471400 xsym               LDP1    N$DCT$$
         2 005754   100000 473510                    LDP3    0,X0,PR1
         2 005755   300004 474500                    LDP4    4,,PR3
         2 005756   400006 236100                    LDQ     6,,PR4
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:273  
         2 005757   000003 376000 3                  ANQ     3
         2 005760   000060 276007                    ORQ     48,DL
         2 005761   400006 756100                    STQ     6,,PR4

     1931     9962    1              RETURN;

   9962  2 005762   000000 702200 xent               TSX2  ! X66_ARET

   9961  2 005763                       CHKFSECTX    null
     1932     9963
     1933     9964    1   CHKFSECTX: ;
     1934     9965    1              IF B$JIT.ERR.CODE = %E$NOFILE

   9965  2 005763   000000 470400 xsym               LDP0    B$JIT$
         2 005764   000012 236100                    LDQ     10,,PR0
         2 005765   377770 376007                    ANQ     131064,DL
         2 005766   001610 116007                    CMPQ    904,DL
         2 005767   005772 601000 2                  TNZ     s:9967

     1935     9966    1              THEN B$JIT.ERR = E_SECTERR; /*E* ERROR: FTL-E$SECTERR */

   9966  2 005770   000012 236000 1                  LDQ     E_SECTERR
         2 005771   000012 756100                    STQ     10,,PR0

     1936     9967    1              ALTRETURN;

   9967  2 005772   000000 702200 xent               TSX2  ! X66_AALT

     1937     9968
     1938     9969        /*********************************************************************/
     1939     9970        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:274  
     1940     9971        /*********************************************************************/
     1941     9972    1   FTL$PEOS:  ENTRY ALTRET;

   9972  2 005773   000000 700200 xent  FTL$PEOS     TSX0  ! X66_AUTO_5
         2 005774   000052 000005                    ZERO    42,5

     1942     9973        /*F*     NAME: FTL$PEOS
     1943     9974              PURPOSE: Position to end of tape set.
     1944     9975         ***/
     1945     9976
     1946     9977        /********************/
     1947     9978
     1948     9979    1              CALL FTL_LBLINIT ALTRET(JUSTALT);

   9979  2 005775   006665 701000 2                  TSX1    FTL_LBLINIT
         2 005776   006767 702000 2                  TSX2    JUSTALT

     1949     9980
     1950     9981         /***
     1951     9982          *** If scratch, already at set end.
     1952     9983          ***/
     1953     9984
     1954     9985    1              IF FT$DDT.SCRTCH THEN RETURN;

   9985  2 005777   200010 470500                    LDP0    DDDT$,,AUTO
         2 006000   000006 236100                    LDQ     6,,PR0
         2 006001   200000 316007                    CANQ    65536,DL
         2 006002   006004 600000 2                  TZE     s:9986

   9985  2 006003   000000 702200 xent               TSX2  ! X66_ARET

     1955     9986    1              IF NOT FT$DDT.ANST

   9986  2 006004   400000 316007                    CANQ    -131072,DL
         2 006005   006011 601000 2                  TNZ     s:9991

     1956     9987    2              THEN DO;                     /* Not ANS...must be PO               */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:275  

     1957     9988    2                 IF NOT FT$DDT.NOWANS

   9988  2 006006   010000 316007                    CANQ    4096,DL
         2 006007   006011 601000 2                  TNZ     s:9991

     1958     9989    2                 THEN RETURN;              /* Not even PO                        */

   9989  2 006010   000000 702200 xent               TSX2  ! X66_ARET

     1959     9990    2                 END;
     1960     9991    1              IF FT$DDT.FMNEEDED

   9991  2 006011   000200 316007                    CANQ    128,DL
         2 006012   006026 600000 2                  TZE     s:10004

     1961     9992    2              THEN DO;                    /* File mark needed before positioning */

     1962     9993    2                 FT$DDT.FMNEEDED = %NO#;

   9993  2 006013   000050 236000 3                  LDQ     40
         2 006014   000006 356100                    ANSQ    6,,PR0

     1963     9994    2                 CALL FTI$WRFM ALTRET(JUSTALT);

   9994  2 006015   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006016   000000 701000 xent               TSX1    FTI$WRFM
         2 006017   006767 702000 2                  TSX2    JUSTALT

     1964     9995    2                 F$DCB.ARS = -1;

   9995  2 006020   000001 335007                    LCA     1,DL
         2 006021   200011 470500                    LDP0    JDCB$,,AUTO
         2 006022   000000 755100                    STA     0,,PR0

     1965     9996    2                 CALL FTI$SPREC ALTRET(JUSTALT);

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:276  
   9996  2 006023   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006024   000000 701000 xent               TSX1    FTI$SPREC
         2 006025   006767 702000 2                  TSX2    JUSTALT

     1966     9997    2                 END;

     1967     9998
     1968     9999         /***
     1969    10000          *** Find end of set.
     1970    10001          ***/
     1971    10002
     1972    10003    2              DO WHILE('1'B);              /* For each tape of set               */

     1973    10004    2                 NOT_TAPE_END = %YES#;     /* Find end of tape                   */

  10004  2 006026   400000 236003                    LDQ     -131072,DU
         2 006027   200021 756100                    STQ     NOT_TAPE_END,,AUTO

     1974    10005    3                 DO WHILE(NOT_TAPE_END);

  10005  2 006030   200021 234100                    SZN     NOT_TAPE_END,,AUTO
         2 006031   006026 605000 2                  TPL     s:10004

     1975    10006    3                    CALL FTL_GETNXTHDR ALTRET(JUSTALT); /* Get HDR1              */

  10006  2 006032   006433 701000 2                  TSX1    FTL_GETNXTHDR
         2 006033   006767 702000 2                  TSX2    JUSTALT

     1976    10007    3                    IF F$DCB.TYC.EOF(1)

  10007  2 006034   200011 470500                    LDP0    JDCB$,,AUTO
         2 006035   000002 236100                    LDQ     2,,PR0
         2 006036   004000 316003                    CANQ    2048,DU
         2 006037   006166 600000 2                  TZE     s:10038

     1977    10008    4                    THEN DO;               /* File mark, not HDR1                */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:277  
     1978    10009    4                       NOT_TAPE_END = %NO#; /* At tape end                       */

  10009  2 006040   200021 450100                    STZ     NOT_TAPE_END,,AUTO

     1979    10010    4                       F$DCB.ARS = -3;     /* Get last tape label                */

  10010  2 006041   000003 335007                    LCA     3,DL
         2 006042   000000 755100                    STA     0,,PR0

     1980    10011    4                       CALL FTI$SPFILE ALTRET(JUSTALT);

  10011  2 006043   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006044   000000 701000 xent               TSX1    FTI$SPFILE
         2 006045   006767 702000 2                  TSX2    JUSTALT

     1981    10012    4                       F$DCB.ARS = 1;

  10012  2 006046   000001 235007                    LDA     1,DL
         2 006047   200011 470500                    LDP0    JDCB$,,AUTO
         2 006050   000000 755100                    STA     0,,PR0

     1982    10013    4                       CALL FTI$SPREC ALTRET(JUSTALT); /*PS* * ^ EOX             */

  10013  2 006051   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006052   000000 701000 xent               TSX1    FTI$SPREC
         2 006053   006767 702000 2                  TSX2    JUSTALT

     1983    10014    4                       CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);

  10014  2 006054   200014 630500                    EPPR0   LBL1$,,AUTO
         2 006055   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 006056   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 006057   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006060   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 006061   006767 702000 2                  TSX2    JUSTALT

     1984    10015    4                       IF F$DCB.ARS < 80
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:278  

  10015  2 006062   200011 470500                    LDP0    JDCB$,,AUTO
         2 006063   000000 235100                    LDA     0,,PR0
         2 006064   000120 115007                    CMPA    80,DL
         2 006065   006077 604000 2                  TMI     s:10019
         2 006066   200014 471500                    LDP1    LBL1$,,AUTO
         2 006067   040000 106500                    CMPC    fill='040'O
         2 006070   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 006071   000033 000004 1                  ADSC9   E_WRONGFILE+13           cn=0,n=4
         2 006072   006106 600000 2                  TZE     s:10023
         2 006073   040000 106500                    CMPC    fill='040'O
         2 006074   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 006075   000036 000004 1                  ADSC9   E_WRONGFILE+16           cn=0,n=4
         2 006076   006106 600000 2                  TZE     s:10023

     1985    10016    4                           OR ( LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOV1'
     1986    10017    4                           AND LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'EOF1' )
     1987    10018    5                       THEN DO;            /* Where are we?                      */

     1988    10019    5                          B$JIT.ERR = E_POSERR; /*E* ERROR: FTL-E$POSERR */

  10019  2 006077   000011 236000 1                  LDQ     E_POSERR
         2 006100   000000 471400 xsym               LDP1    B$JIT$
         2 006101   100012 756100                    STQ     10,,PR1

     1989    10020    5                          FT$DDT.POSLOST = %YES#;

  10020  2 006102   200010 473500                    LDP3    DDDT$,,AUTO
         2 006103   004000 236007                    LDQ     2048,DL
         2 006104   300006 256100                    ORSQ    6,,PR3

     1990    10021    5                          ALTRETURN;

  10021  2 006105   000000 702200 xent               TSX2  ! X66_AALT

     1991    10022    5                          END;
     1992    10023    4                       F$DCB.ARS = 1;      /* Position past EOx label group      */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:279  

  10023  2 006106   000001 236007                    LDQ     1,DL
         2 006107   000000 756100                    STQ     0,,PR0

     1993    10024    4                       CALL FTI$SPFILE ALTRET(JUSTALT);

  10024  2 006110   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006111   000000 701000 xent               TSX1    FTI$SPFILE
         2 006112   006767 702000 2                  TSX2    JUSTALT

     1994    10025    4                       CALL CHARBIN( THISFSN, LBL1$->FT$LBL1.FSEQU_NUM );

  10025  2 006113   200014 470500                    LDP0    LBL1$,,AUTO
         2 006114   000100 305500                    DTB
         2 006115   000007 630004                    NDSC9   7,,PR0                   cn=3,s=nosgn,sf=0,n=4
         2 006116   200031 000004                    NDSC9   THISFSN,,AUTO            cn=0,s=lsgnf,sf=0,n=4

     1995    10026    4                       FT$DDT.FSN = THISFSN; /* Remember position                */

  10026  2 006117   200031 720100                    LXL0    THISFSN,,AUTO
         2 006120   200010 471500                    LDP1    DDDT$,,AUTO
         2 006121   100005 740100                    STX0    5,,PR1

     1996    10027    4                       IF LBL1$->FT$ANYLBL.LABEL_TYPE = 'EOF1'

  10027  2 006122   200014 470500                    LDP0    LBL1$,,AUTO
         2 006123   040000 106500                    CMPC    fill='040'O
         2 006124   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         2 006125   000036 000004 1                  ADSC9   E_WRONGFILE+16           cn=0,n=4
         2 006126   006134 601000 2                  TNZ     s:10032

     1997    10028    5                       THEN DO;            /* End of file/end of tape            */

     1998    10029    5                          FT$DDT.POS = FTP_HDR#;

  10029  2 006127   100006 236100                    LDQ     6,,PR1
         2 006130   000003 376000 3                  ANQ     3
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:280  
         2 006131   000040 276007                    ORQ     32,DL
         2 006132   100006 756100                    STQ     6,,PR1

     1999    10030    5                          RETURN;          /* End of tape                        */

  10030  2 006133   000000 702200 xent               TSX2  ! X66_ARET

     2000    10031    5                          END;
     2001    10032    4                       FT$DDT.POS = FTP_EOV#;

  10032  2 006134   100006 236100                    LDQ     6,,PR1
         2 006135   000003 376000 3                  ANQ     3
         2 006136   000100 276007                    ORQ     64,DL
         2 006137   100006 756100                    STQ     6,,PR1

     2002    10033    4                       CALL FTR$CHNGVOL(F$DCB.VOL + 1) ALTRET(JUSTALT);

  10033  2 006140   200011 470500                    LDP0    JDCB$,,AUTO
         2 006141   000043 236100                    LDQ     35,,PR0
         2 006142   000033 772000                    QRL     27
         2 006143   000001 036007                    ADLQ    1,DL
         2 006144   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 006145   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 006146   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 006147   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 006150   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006151   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 006152   006767 702000 2                  TSX2    JUSTALT

     2003    10034    4                       DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

  10034  2 006153   200011 470500                    LDP0    JDCB$,,AUTO
         2 006154   000051 720100                    LXL0    41,,PR0
         2 006155   000000 471400 xsym               LDP1    N$DCT$$
         2 006156   100000 473510                    LDP3    0,X0,PR1
         2 006157   300004 236100                    LDQ     4,,PR3
         2 006160   200010 756100                    STQ     DDDT$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:281  

     2004    10035    4                       IF FT$DDT.SCRTCH THEN RETURN;

  10035  2 006161   200010 474500                    LDP4    DDDT$,,AUTO
         2 006162   400006 236100                    LDQ     6,,PR4
         2 006163   200000 316007                    CANQ    65536,DL
         2 006164   006211 600000 2                  TZE     s:10044

  10035  2 006165   000000 702200 xent               TSX2  ! X66_ARET

     2005    10036    4                       END;
     2006    10037    4                    ELSE DO;               /* Not end of tape                    */

     2007    10038    4                       CALL FTL_CHKLBL( 'HDR1', LBL1$ ) ALTRET(JUSTALT);

  10038  2 006166   200014 631500                    EPPR1   LBL1$,,AUTO
         2 006167   200044 451500                    STP1    @ALBL+1,,AUTO
         2 006170   000042 236000 3                  LDQ     34
         2 006171   200043 756100                    STQ     @NUHL+1,,AUTO
         2 006172   004443 701000 2                  TSX1    FTL_CHKLBL
         2 006173   006767 702000 2                  TSX2    JUSTALT

     2008    10039    4                       CALL CHARBIN( THISFSN, LBL1$->FT$LBL1.FSEQU_NUM );

  10039  2 006174   200014 470500                    LDP0    LBL1$,,AUTO
         2 006175   000100 305500                    DTB
         2 006176   000007 630004                    NDSC9   7,,PR0                   cn=3,s=nosgn,sf=0,n=4
         2 006177   200031 000004                    NDSC9   THISFSN,,AUTO            cn=0,s=lsgnf,sf=0,n=4

     2009    10040    4                       FT$DDT.FSN = THISFSN;

  10040  2 006200   200031 720100                    LXL0    THISFSN,,AUTO
         2 006201   200010 471500                    LDP1    DDDT$,,AUTO
         2 006202   100005 740100                    STX0    5,,PR1

     2010    10041    4                       F$DCB.ARS = 3;      /* Skip to next HDR1                  */

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:282  
  10041  2 006203   000003 235007                    LDA     3,DL
         2 006204   200011 470500                    LDP0    JDCB$,,AUTO
         2 006205   000000 755100                    STA     0,,PR0

     2011    10042    4                       CALL FTI$SPFILE ALTRET(JUSTALT);

  10042  2 006206   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006207   000000 701000 xent               TSX1    FTI$SPFILE
         2 006210   006767 702000 2                  TSX2    JUSTALT

     2012    10043    4                       END;

     2013    10044    3                    END;

  10044  2 006211   200021 234100                    SZN     NOT_TAPE_END,,AUTO
         2 006212   006032 604000 2                  TMI     s:10006

     2014    10045    2                 END;

  10045  2 006213   006026 710000 2                  TRA     s:10004

     2015    10046        /*********************************************************************/
     2016    10047        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:283  
     2017    10048        /*********************************************************************/
     2018    10049    1   FTL$SPF:   ENTRY(THELBL) ALTRET;

  10049  2 006214   000000 700200 xent  FTL$SPF      TSX0  ! X66_AUTO_5
         2 006215   000052 000005                    ZERO    42,5

     2019    10050        /*F*     NAME: FTL$SPF
     2020    10051              PURPOSE: Position to the next beginning-of-file in the tape set,
     2021    10052                       when the last close left the tape positioned somewhere
     2022    10053                       in the middle of the file.
     2023    10054         ***/
     2024    10055
     2025    10056        /********************/
     2026    10057
     2027    10058    1              CALL FTL_LBLINIT ALTRET(JUSTALT);

  10058  2 006216   006665 701000 2                  TSX1    FTL_LBLINIT
         2 006217   006767 702000 2                  TSX2    JUSTALT

     2028    10059    2              DO WHILE(FT$DDT.POS = FTP_BOD#); /* Space to next file mark.       */

  10059  2 006220   200010 470500                    LDP0    DDDT$,,AUTO
         2 006221   000006 236100                    LDQ     6,,PR0
         2 006222   000160 376007                    ANQ     112,DL
         2 006223   000060 116007                    CMPQ    48,DL
         2 006224   006247 601000 2                  TNZ     s:10065

     2029    10060    2                 F$DCB.ARS = 65500;

  10060  2 006225   177734 235007                    LDA     65500,DL
         2 006226   200011 470500                    LDP0    JDCB$,,AUTO
         2 006227   000000 755100                    STA     0,,PR0

     2030    10061    2                 CALL FTI$SPREC ALTRET(JUSTALT);

  10061  2 006230   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006231   000000 701000 xent               TSX1    FTI$SPREC
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:284  
         2 006232   006767 702000 2                  TSX2    JUSTALT

     2031    10062    2                 IF F$DCB.TYC.EOF(1) THEN

  10062  2 006233   200011 470500                    LDP0    JDCB$,,AUTO
         2 006234   000002 236100                    LDQ     2,,PR0
         2 006235   004000 316003                    CANQ    2048,DU
         2 006236   006242 600000 2                  TZE     s:10064

     2032    10063    2                    FT$DDT.POS = FTP_UND#;

  10063  2 006237   200010 471500                    LDP1    DDDT$,,AUTO
         2 006240   000003 236000 3                  LDQ     3
         2 006241   100006 356100                    ANSQ    6,,PR1

     2033    10064    2                 END;

  10064  2 006242   200010 471500                    LDP1    DDDT$,,AUTO
         2 006243   100006 236100                    LDQ     6,,PR1
         2 006244   000160 376007                    ANQ     112,DL
         2 006245   000060 116007                    CMPQ    48,DL
         2 006246   006225 600000 2                  TZE     s:10060

     2034    10065    1              CALL FTL_CHKEOX ALTRET(JUSTALT); /* Verify EOF/EOV label.          */

  10065  2 006247   006535 701000 2                  TSX1    FTL_CHKEOX
         2 006250   006767 702000 2                  TSX2    JUSTALT

     2035    10066    1              CALL CHARBIN(SAVFSN,LBL1$->FT$LBL1.FSEQU_NUM); /* Get real FSN.    */

  10066  2 006251   200014 470500                    LDP0    LBL1$,,AUTO
         2 006252   000100 305500                    DTB
         2 006253   000007 630004                    NDSC9   7,,PR0                   cn=3,s=nosgn,sf=0,n=4
         2 006254   200022 000004                    NDSC9   SAVFSN,,AUTO             cn=0,s=lsgnf,sf=0,n=4

     2036    10067    1              IF NOT F$DCB.EBCDIC THEN

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:285  
  10067  2 006255   200011 471500                    LDP1    JDCB$,,AUTO
         2 006256   100031 236100                    LDQ     25,,PR1
         2 006257   100000 316007                    CANQ    32768,DL
         2 006260   006264 601000 2                  TNZ     s:10069

     2037    10068    1                 CALL CHARBIN(SAVVOL,LBL1$->FT$LBL1.FSECT); /* Get real FSECT.   */

  10068  2 006261   000100 305500                    DTB
         2 006262   000006 630004                    NDSC9   6,,PR0                   cn=3,s=nosgn,sf=0,n=4
         2 006263   200023 000004                    NDSC9   SAVVOL,,AUTO             cn=0,s=lsgnf,sf=0,n=4

     2038    10069    1              B$JIT.ERR = '0'B;            /* Ignore block count error.          */

  10069  2 006264   000000 473400 xsym               LDP3    B$JIT$
         2 006265   300012 450100                    STZ     10,,PR3

     2039    10070    2              DO WHILE(THELBL ~= 'EOF');   /* Find the last FSECT of the file.   */

  10070  2 006266   200003 470500                    LDP0    @THELBL,,AUTO
         2 006267   040000 106500                    CMPC    fill='040'O
         2 006270   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         2 006271   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 006272   006411 600000 2                  TZE     s:10098

     2040    10071    3                 IF NOT F$DCB.TYC.EOF(1) THEN DO;

  10071  2 006273   200011 470500                    LDP0    JDCB$,,AUTO
         2 006274   000002 236100                    LDQ     2,,PR0
         2 006275   004000 316003                    CANQ    2048,DU
         2 006276   006304 601000 2                  TNZ     s:10075

     2041    10072    3                    F$DCB.ARS = 1;

  10072  2 006277   000001 235007                    LDA     1,DL
         2 006300   000000 755100                    STA     0,,PR0

     2042    10073    3                    CALL FTI$SPFILE ALTRET(JUSTALT);
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:286  

  10073  2 006301   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006302   000000 701000 xent               TSX1    FTI$SPFILE
         2 006303   006767 702000 2                  TSX2    JUSTALT

     2043    10074    3                    END;

     2044    10075    2                 FT$DDT.POS = FTP_EOV#;

  10075  2 006304   200010 470500                    LDP0    DDDT$,,AUTO
         2 006305   000006 236100                    LDQ     6,,PR0
         2 006306   000003 376000 3                  ANQ     3
         2 006307   000100 276007                    ORQ     64,DL
         2 006310   000006 756100                    STQ     6,,PR0

     2045    10076    2                 F$DCB.SEZ_OK = %NO#;

  10076  2 006311   200011 471500                    LDP1    JDCB$,,AUTO
         2 006312   000043 236000 3                  LDQ     35
         2 006313   100064 356100                    ANSQ    52,,PR1

     2046    10077    2                 CALL FTR$CHNGVOL(F$DCB.VOL+1) ALTRET(JUSTALT);

  10077  2 006314   100043 236100                    LDQ     35,,PR1
         2 006315   000033 772000                    QRL     27
         2 006316   000001 036007                    ADLQ    1,DL
         2 006317   200046 756100                    STQ     @ALBL$+2,,AUTO
         2 006320   200046 633500                    EPPR3   @ALBL$+2,,AUTO
         2 006321   200047 453500                    STP3    @ALBL$+3,,AUTO
         2 006322   200047 630500                    EPPR0   @ALBL$+3,,AUTO
         2 006323   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006324   000000 701000 xent               TSX1    FTR$CHNGVOL
         2 006325   006767 702000 2                  TSX2    JUSTALT

     2047    10078    2                 DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

  10078  2 006326   200011 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:287  
         2 006327   000051 720100                    LXL0    41,,PR0
         2 006330   000000 471400 xsym               LDP1    N$DCT$$
         2 006331   100000 473510                    LDP3    0,X0,PR1
         2 006332   300004 236100                    LDQ     4,,PR3
         2 006333   200010 756100                    STQ     DDDT$,,AUTO

     2048    10079    2                 CALL FTL_GETFSN ALTRET(JUSTALT);

  10079  2 006334   004364 701000 2                  TSX1    FTL_GETFSN
         2 006335   006767 702000 2                  TSX2    JUSTALT

     2049    10080    3                 IF NOT F$DCB.EBCDIC THEN DO;

  10080  2 006336   200011 470500                    LDP0    JDCB$,,AUTO
         2 006337   000031 236100                    LDQ     25,,PR0
         2 006340   100000 316007                    CANQ    32768,DL
         2 006341   006362 601000 2                  TNZ     s:10088

     2050    10081    4                    IF NOT F$DCB.IGNOREFSN AND (THISFSN ~= SAVFSN OR THISFSECT ~=
             10081                             SAVVOL + 1) THEN DO;

  10081  2 006342   000031 234100                    SZN     25,,PR0
         2 006343   006357 604000 2                  TMI     s:10085
         2 006344   200031 236100                    LDQ     THISFSN,,AUTO
         2 006345   200022 116100                    CMPQ    SAVFSN,,AUTO
         2 006346   006353 601000 2                  TNZ     s:10082
         2 006347   200023 236100                    LDQ     SAVVOL,,AUTO
         2 006350   000001 036007                    ADLQ    1,DL
         2 006351   200030 116100                    CMPQ    THISFSECT,,AUTO
         2 006352   006357 600000 2                  TZE     s:10085

     2051    10082    4                       B$JIT.ERR = E_VOLORDER;

  10082  2 006353   000014 236000 1                  LDQ     E_VOLORDER
         2 006354   000000 471400 xsym               LDP1    B$JIT$
         2 006355   100012 756100                    STQ     10,,PR1

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:288  
     2052    10083    4                       ALTRETURN;

  10083  2 006356   000000 702200 xent               TSX2  ! X66_AALT

     2053    10084    4                       END;
     2054    10085    3                    SAVVOL = THISFSECT;

  10085  2 006357   200030 235100                    LDA     THISFSECT,,AUTO
         2 006360   200023 755100                    STA     SAVVOL,,AUTO

     2055    10086    3                    END;

  10086  2 006361   006373 710000 2                  TRA     s:10093

     2056    10087    3                 ELSE DO;

     2057    10088    4                    IF NOT F$DCB.IGNOREFSN AND THISFSN ~= SAVFSN THEN DO;

  10088  2 006362   000031 234100                    SZN     25,,PR0
         2 006363   006373 604000 2                  TMI     s:10093
         2 006364   200031 236100                    LDQ     THISFSN,,AUTO
         2 006365   200022 116100                    CMPQ    SAVFSN,,AUTO
         2 006366   006373 600000 2                  TZE     s:10093

     2058    10089    4                       B$JIT.ERR = E_VOLORDER;

  10089  2 006367   000014 236000 1                  LDQ     E_VOLORDER
         2 006370   000000 471400 xsym               LDP1    B$JIT$
         2 006371   100012 756100                    STQ     10,,PR1

     2059    10090    4                       ALTRETURN;

  10090  2 006372   000000 702200 xent               TSX2  ! X66_AALT

     2060    10091    4                       END;
     2061    10092    3                    END;
     2062    10093    2                 F$DCB.ARS = 2;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:289  

  10093  2 006373   000002 235007                    LDA     2,DL
         2 006374   000000 755100                    STA     0,,PR0

     2063    10094    2                 CALL FTI$SPFILE ALTRET(JUSTALT); /* Position to end of that FSECT. */

  10094  2 006375   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006376   000000 701000 xent               TSX1    FTI$SPFILE
         2 006377   006767 702000 2                  TSX2    JUSTALT

     2064    10095    2                 CALL FTL_CHKEOX ALTRET(JUSTALT); /* Verify EOF/EOV label.       */

  10095  2 006400   006535 701000 2                  TSX1    FTL_CHKEOX
         2 006401   006767 702000 2                  TSX2    JUSTALT

     2065    10096    2                 B$JIT.ERR = '0'B;         /* Ignore block count error.          */

  10096  2 006402   000000 470400 xsym               LDP0    B$JIT$
         2 006403   000012 450100                    STZ     10,,PR0

     2066    10097    2                 END;

  10097  2 006404   200003 471500                    LDP1    @THELBL,,AUTO
         2 006405   040000 106500                    CMPC    fill='040'O
         2 006406   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 006407   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 006410   006273 601000 2                  TNZ     s:10071

     2067    10098    1              F$DCB.ARS = 1;

  10098  2 006411   000001 235007                    LDA     1,DL
         2 006412   200011 470500                    LDP0    JDCB$,,AUTO
         2 006413   000000 755100                    STA     0,,PR0

     2068    10099    1              CALL FTI$SPFILE ALTRET(JUSTALT); /* Position to HDR1.              */

  10099  2 006414   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:290  
         2 006415   000000 701000 xent               TSX1    FTI$SPFILE
         2 006416   006767 702000 2                  TSX2    JUSTALT

     2069    10100    1              IF NOT F$DCB.IGNOREFSN THEN

  10100  2 006417   200011 470500                    LDP0    JDCB$,,AUTO
         2 006420   000031 234100                    SZN     25,,PR0
         2 006421   006425 604000 2                  TMI     s:10102

     2070    10101    1                 FT$DDT.FSN = SAVFSN;      /* FSN of previous file.              */

  10101  2 006422   200022 720100                    LXL0    SAVFSN,,AUTO
         2 006423   200010 471500                    LDP1    DDDT$,,AUTO
         2 006424   100005 740100                    STX0    5,,PR1

     2071    10102    1              FT$DDT.POS = FTP_HDR#;

  10102  2 006425   200010 471500                    LDP1    DDDT$,,AUTO
         2 006426   100006 236100                    LDQ     6,,PR1
         2 006427   000003 376000 3                  ANQ     3
         2 006430   000040 276007                    ORQ     32,DL
         2 006431   100006 756100                    STQ     6,,PR1

     2072    10103    1              RETURN;

  10103  2 006432   000000 702200 xent               TSX2  ! X66_ARET

     2073    10104
     2074    10105        /*********************************************************************/
     2075    10106        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:291  
     2076    10107        /*********************************************************************/
     2077    10108    1   FTL_GETNXTHDR: PROC ALTRET;

  10108  2 006433   200040 741300       FTL_GETNXTH* STX1  ! DT1+4,,AUTO

     2078    10109        /*F*     NAME: FTL_GETNXTHDR
     2079    10110                 PURPOSE: Find next HDR1.
     2080    10111         ***/
     2081    10112
     2082    10113        /********************/
     2083    10114
     2084    10115         /***
     2085    10116          *** If at beginning of volume get next HDR1.
     2086    10117          ***/
     2087    10118
     2088    10119    2              LBL1$->FT$ANYLBL.LABEL_TYPE = 'VOL1'; /* Init HDR1 search          */

  10119  2 006434   200014 470500                    LDP0    LBL1$,,AUTO
         2 006435   040100 100400                    MLR     fill='040'O
         2 006436   000017 000004 1                  ADSC9   E_WRONGFILE+1            cn=0,n=4
         2 006437   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4

     2089    10120    2              IF FT$DDT.POS = FTP_BOV#

  10120  2 006440   200010 470500                    LDP0    DDDT$,,AUTO
         2 006441   000006 236100                    LDQ     6,,PR0
         2 006442   000160 376007                    ANQ     112,DL
         2 006443   000020 116007                    CMPQ    16,DL
         2 006444   006507 601000 2                  TNZ     s:10135

     2090    10121    3              THEN DO;                     /* At BOV                             */

     2091    10122    3                 IF NOT FT$DDT.ANST

  10122  2 006445   000006 236100                    LDQ     6,,PR0
         2 006446   400000 316007                    CANQ    -131072,DL
         2 006447   006465 601000 2                  TNZ     s:10129
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:292  

     2092    10123    4                 THEN DO;                  /* Must be PO type tape               */

     2093    10124    4                    F$DCB.ARS = 1;

  10124  2 006450   000001 235007                    LDA     1,DL
         2 006451   200011 471500                    LDP1    JDCB$,,AUTO
         2 006452   100000 755100                    STA     0,,PR1

     2094    10125    4                    CALL FTI$SPFILE ALTRET(JUSTALT); /* Skip to HDR1             */

  10125  2 006453   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006454   000000 701000 xent               TSX1    FTI$SPFILE
         2 006455   006533 702000 2                  TSX2    JUSTALT

     2095    10126    4                    CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT); /* Get HDR1        */

  10126  2 006456   200014 630500                    EPPR0   LBL1$,,AUTO
         2 006457   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 006460   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 006461   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006462   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 006463   006533 702000 2                  TSX2    JUSTALT

     2096    10127    4                    END;

  10127  2 006464   006515 710000 2                  TRA     s:10136

     2097    10128    4                 ELSE DO;                  /* Find first HDR1                    */

     2098    10129    4                    F$DCB.TYC(1) = '0'B;

  10129  2 006465   200011 471500                    LDP1    JDCB$,,AUTO
         2 006466   100002 450100                    STZ     2,,PR1

     2099    10130    5                   DO WHILE(NOT F$DCB.TYC(1) AND LBL1$->FT$ANYLBL.LABEL_TYPE ~= 'HDR1'
             10130                             );
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:293  

  10130  2 006467   006476 710000 2                  TRA     s:10132

     2100    10131    5                       CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT); /* Get next label */

  10131  2 006470   200014 630500                    EPPR0   LBL1$,,AUTO
         2 006471   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 006472   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 006473   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006474   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 006475   006533 702000 2                  TSX2    JUSTALT

     2101    10132    5                       END;

  10132  2 006476   200011 470500                    LDP0    JDCB$,,AUTO
         2 006477   000002 235100                    LDA     2,,PR0
         2 006500   006506 601000 2                  TNZ     s:10134
         2 006501   200014 471500                    LDP1    LBL1$,,AUTO
         2 006502   040000 106500                    CMPC    fill='040'O
         2 006503   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 006504   000032 000004 1                  ADSC9   E_WRONGFILE+12           cn=0,n=4
         2 006505   006470 601000 2                  TNZ     s:10131

     2102    10133    4                    END;

     2103    10134    3                 END;

  10134  2 006506   006515 710000 2                  TRA     s:10136

     2104    10135    2              ELSE CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT); /* Must be at HDR1  */

  10135  2 006507   200014 631500                    EPPR1   LBL1$,,AUTO
         2 006510   200046 451500                    STP1    @ALBL$+2,,AUTO
         2 006511   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 006512   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006513   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 006514   006533 702000 2                  TSX2    JUSTALT
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:294  

     2105    10136    2              IF NOT F$DCB.TYC(1)

  10136  2 006515   200011 470500                    LDP0    JDCB$,,AUTO
         2 006516   000002 235100                    LDA     2,,PR0
         2 006517   006526 601000 2                  TNZ     s:10138

     2106    10137    2              THEN CALL FTL_CHKLBL( 'HDR1', LBL1$ ) ALTRET(JUSTALT);

  10137  2 006520   200014 631500                    EPPR1   LBL1$,,AUTO
         2 006521   200044 451500                    STP1    @ALBL$,,AUTO
         2 006522   000042 236000 3                  LDQ     34
         2 006523   200043 756100                    STQ     @ALBL,,AUTO
         2 006524   004443 701000 2                  TSX1    FTL_CHKLBL
         2 006525   006533 702000 2                  TSX2    JUSTALT

     2107    10138    2              FT$DDT.POS = FTP_UND#;       /* Not at BOV or HDR anymore          */

  10138  2 006526   200010 470500                    LDP0    DDDT$,,AUTO
         2 006527   000003 236000 3                  LDQ     3
         2 006530   000006 356100                    ANSQ    6,,PR0

     2108    10139    2              RETURN;

  10139  2 006531   200040 221300                    LDX1  ! DT1+4,,AUTO
         2 006532   000001 702211                    TSX2  ! 1,X1

  10138  2 006533                       JUSTALT      null
     2109    10140
     2110    10141    2   JUSTALT:   ;
     2111    10142    2              ALTRETURN;

  10142  2 006533   200040 221300                    LDX1  ! DT1+4,,AUTO
         2 006534   000000 702211                    TSX2  ! 0,X1

     2112    10143
     2113    10144    2      END FTL_GETNXTHDR;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:295  
     2114    10145        /*********************************************************************/
     2115    10146        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:296  
     2116    10147        /*********************************************************************/
     2117    10148    1   FTL_CHKEOX: PROC ALTRET;

  10148  2 006535   200036 741300       FTL_CHKEOX   STX1  ! DT1+2,,AUTO

     2118    10149        /*F*     NAME: FTL_CHKEOX
     2119    10150                 PURPOSE: Process EOx1 label.
     2120    10151         ***/
     2121    10152
     2122    10153        /********************/
     2123    10154
     2124    10155         /***
     2125    10156          *** Read label...it must have proper size and be EOF or EOV.
     2126    10157          ***/
     2127    10158
     2128    10159    2              CALL FTI$RDASCEBC(LBL1$) ALTRET(JUSTALT);

  10159  2 006536   200014 630500                    EPPR0   LBL1$,,AUTO
         2 006537   200046 450500                    STP0    @ALBL$+2,,AUTO
         2 006540   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 006541   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006542   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 006543   006627 702000 2                  TSX2    JUSTALT

     2129    10160    2              THELBL = LBL1$->FT$ULBL.LABEL_ID; /* Return label id               */

  10160  2 006544   200014 470500                    LDP0    LBL1$,,AUTO
         2 006545   200003 471500                    LDP1    @THELBL,,AUTO
         2 006546   040100 100500                    MLR     fill='040'O
         2 006547   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         2 006550   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3

     2130    10161    2              IF F$DCB.ARS < 80 OR (THELBL ~= 'EOF' AND THELBL ~= 'EOV') OR

  10161  2 006551   200011 470500                    LDP0    JDCB$,,AUTO
         2 006552   000000 235100                    LDA     0,,PR0
         2 006553   000120 115007                    CMPA    80,DL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:297  
         2 006554   006572 604000 2                  TMI     s:10164
         2 006555   040000 106500                    CMPC    fill='040'O
         2 006556   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 006557   000030 000003 1                  ADSC9   E_WRONGFILE+10           cn=0,n=3
         2 006560   006565 600000 2                  TZE     s:10161+12
         2 006561   040000 106500                    CMPC    fill='040'O
         2 006562   100000 000003                    ADSC9   0,,PR1                   cn=0,n=3
         2 006563   000031 000003 1                  ADSC9   E_WRONGFILE+11           cn=0,n=3
         2 006564   006572 601000 2                  TNZ     s:10164
         2 006565   200014 473500                    LDP3    LBL1$,,AUTO
         2 006566   040000 106500                    CMPC    fill='040'O
         2 006567   300000 600001                    ADSC9   0,,PR3                   cn=3,n=1
         2 006570   000004 000001 3                  ADSC9   4                        cn=0,n=1
         2 006571   006602 600000 2                  TZE     s:10168

     2131    10162    3                  LBL1$->FT$LBL1.LABEL_NUM ~= '1' THEN DO;

     2132    10163                                                /* Expected EOF/EOV label not present */
     2133    10164    3                 B$JIT.ERR = E_POSERR; /*E* ERROR: FTL-E$POSERR */

  10164  2 006572   000011 236000 1                  LDQ     E_POSERR
         2 006573   000000 473400 xsym               LDP3    B$JIT$
         2 006574   300012 756100                    STQ     10,,PR3

     2134    10165    3                 FT$DDT.POSLOST = %YES#;

  10165  2 006575   200010 474500                    LDP4    DDDT$,,AUTO
         2 006576   004000 236007                    LDQ     2048,DL
         2 006577   400006 256100                    ORSQ    6,,PR4

     2135    10166    3                 ALTRETURN;

  10166  2 006600   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 006601   000000 702211                    TSX2  ! 0,X1

     2136    10167    3                 END;
     2137    10168    3              IF F$DCB.OLDIOERR ~= 0 AND NOT F$DCB.IGNOREFSN THEN DO;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:298  
             10168                       /* Had an I/O error on this file. */

  10168  2 006602   000102 236100                    LDQ     66,,PR0
         2 006603   140000 316003                    CANQ    49152,DU
         2 006604   006623 600000 2                  TZE     s:10178
         2 006605   000031 234100                    SZN     25,,PR0
         2 006606   006623 604000 2                  TMI     s:10178

     2138    10169    3                 CALL CHARBIN(N,LBL1$->FT$LBL1.FSEQU_NUM);

  10169  2 006607   000100 305500                    DTB
         2 006610   300007 630004                    NDSC9   7,,PR3                   cn=3,s=nosgn,sf=0,n=4
         2 006611   200017 000004                    NDSC9   N,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

     2139    10170    4                 IF F$DCB.FSN < N THEN DO; /* Was a file mark hit?               */

  10170  2 006612   000034 236100                    LDQ     28,,PR0
         2 006613   000022 772000                    QRL     18
         2 006614   200017 116100                    CMPQ    N,,AUTO
         2 006615   006625 605000 2                  TPL     s:10179

     2140    10171    4                    B$JIT.ERR = E_WRONGFILE; /*E* FTL-E$WRONGFILE */

  10171  2 006616   000016 236000 1                  LDQ     E_WRONGFILE
         2 006617   000000 474400 xsym               LDP4    B$JIT$
         2 006620   400012 756100                    STQ     10,,PR4

     2141    10172    4                    ALTRETURN;

  10172  2 006621   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 006622   000000 702211                    TSX2  ! 0,X1

     2142    10173    4                    END;
     2143    10174    3                 END;
     2144    10175    2              ELSE                         /* Don't verify block count if we had */
     2145    10176                                              /* an I/O error, since it will probably */
     2146    10177                                                /* always fail.                       */
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:299  
     2147    10178    2                 CALL FTL_CHKBLKCNT;       /* Check block count error            */

  10178  2 006623   006631 701000 2                  TSX1    FTL_CHKBLKCNT
         2 006624   000000 011000                    NOP     0

     2148    10179    2              RETURN;

  10179  2 006625   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 006626   000001 702211                    TSX2  ! 1,X1

  10179  2 006627                       JUSTALT      null
     2149    10180
     2150    10181    2   JUSTALT:   ;
     2151    10182    2              ALTRETURN;

  10182  2 006627   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 006630   000000 702211                    TSX2  ! 0,X1

     2152    10183
     2153    10184    2      END FTL_CHKEOX;
     2154    10185        /**********************************************************************/
     2155    10186        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:300  
     2156    10187        /**********************************************************************/
     2157    10188    1   FTL_CHKBLKCNT: PROC;

  10188  2 006631   200040 741300       FTL_CHKBLKC* STX1  ! DT1+4,,AUTO

     2158    10189        /*F*     NAME: FTL_CHKBLKCNT
     2159    10190                 PURPOSE: Check for block count error.
     2160    10191         ***/
     2161    10192
     2162    10193        /********************/
     2163    10194
     2164    10195
     2165    10196         /***
     2166    10197          *** Have EOF1 or EOV1 label.  Check block count.
     2167    10198          ***/
     2168    10199
     2169    10200    2              N = F$DCB.PRECNO;            /* Get data block count               */

  10200  2 006632   200011 470500                    LDP0    JDCB$,,AUTO
         2 006633   000072 235100                    LDA     58,,PR0
         2 006634   200017 755100                    STA     N,,AUTO

     2170    10201    2              IF NOT F$DCB.AFTRBLK THEN

  10201  2 006635   000064 236100                    LDQ     52,,PR0
         2 006636   000002 316007                    CANQ    2,DL
         2 006637   006642 601000 2                  TNZ     s:10203

     2171    10202    2                 N = N - 1;                /* Don't count unread  block          */

  10202  2 006640   000001 336007                    LCQ     1,DL
         2 006641   200017 056100                    ASQ     N,,AUTO

     2172    10203    2              IF F$DCB.TAPTYP.CP6F AND F$DCB.FSECT = 1

  10203  2 006642   000067 236100                    LDQ     55,,PR0
         2 006643   000200 316003                    CANQ    128,DU
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:301  
         2 006644   006651 600000 2                  TZE     s:10205
         2 006645   000077 220100                    LDX0    63,,PR0
         2 006646   000001 100003                    CMPX0   1,DU
         2 006647   006651 601000 2                  TNZ     s:10205

     2173    10204    2              THEN N = N + 1;              /* Account for FIT (if any)           */

  10204  2 006650   200017 054100                    AOS     N,,AUTO

     2174    10205    2              CALL CHARBIN( I, LBL1$->FT$LBL1.BLK_CNT ); /* Get block count      */

  10205  2 006651   200014 471500                    LDP1    LBL1$,,AUTO
         2 006652   000100 305500                    DTB
         2 006653   100015 430006                    NDSC9   13,,PR1                  cn=2,s=nosgn,sf=0,n=6
         2 006654   200012 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

     2175    10206    2              IF N ~= I

  10206  2 006655   200017 236100                    LDQ     N,,AUTO
         2 006656   200012 116100                    CMPQ    I,,AUTO
         2 006657   006663 600000 2                  TZE     s:10209

     2176    10207         /*E* ERROR: FTL-E$BLKCNT */
     2177    10208    2              THEN B$JIT.ERR = E_BLKCNT;

  10208  2 006660   000001 236000 1                  LDQ     E_BLKCNT
         2 006661   000000 473400 xsym               LDP3    B$JIT$
         2 006662   300012 756100                    STQ     10,,PR3

     2178    10209    2              RETURN;

  10209  2 006663   200040 221300                    LDX1  ! DT1+4,,AUTO
         2 006664   000001 702211                    TSX2  ! 1,X1

     2179    10210
     2180    10211    2      END FTL_CHKBLKCNT;
     2181    10212        /*********************************************************************/
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:302  
     2182    10213        %EJECT;
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:303  
     2183    10214        /*********************************************************************/
     2184    10215    1   FTL_LBLINIT: PROC ALTRET;

  10215  2 006665   200036 741300       FTL_LBLINIT  STX1  ! DT1+2,,AUTO

     2185    10216        /*F*    NAME: FTL_LBLINIT
     2186    10217                PURPOSE: Find label FPOOL buffer for label write.
     2187    10218         ***/
     2188    10219
     2189    10220        /********************/
     2190    10221
     2191    10222         /***
     2192    10223          *** Initialize pointers.
     2193    10224          ***/
     2194    10225
     2195    10226    2              JDCB$ = B$JIT.DCB$;          /* Get pointer to DCB                 */

  10226  2 006666   000000 470400 xsym               LDP0    B$JIT$
         2 006667   000232 236100                    LDQ     154,,PR0
         2 006670   200011 756100                    STQ     JDCB$,,AUTO

     2196    10227    2              DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
             10227                       /* Get pointer to DDT entry */

  10227  2 006671   200011 471500                    LDP1    JDCB$,,AUTO
         2 006672   100051 720100                    LXL0    41,,PR1
         2 006673   000000 473400 xsym               LDP3    N$DCT$$
         2 006674   300000 474510                    LDP4    0,X0,PR3
         2 006675   400004 236100                    LDQ     4,,PR4
         2 006676   200010 756100                    STQ     DDDT$,,AUTO

     2197    10228    2              IF F$DCB.ASN = %DEVICE# THEN RETURN; /* No label FPOOL needed      */

  10228  2 006677   100032 236100                    LDQ     26,,PR1
         2 006700   777000 376007                    ANQ     -512,DL
         2 006701   003000 116007                    CMPQ    1536,DL
         2 006702   006704 601000 2                  TNZ     s:10234
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:304  

  10228  2 006703   000001 702211                    TSX2  ! 1,X1

     2198    10229
     2199    10230         /***
     2200    10231          *** An FPOOL buffer must be available to create the label in.
     2201    10232          ***/
     2202    10233
     2203    10234    2              I = F$DCB.LPOOL - 1;         /* Calc ix of label FPOOL buffer      */

  10234  2 006704   100067 236100                    LDQ     55,,PR1
         2 006705   000036 772000                    QRL     30
         2 006706   000007 376007                    ANQ     7,DL
         2 006707   000001 136007                    SBLQ    1,DL
         2 006710   200012 756100                    STQ     I,,AUTO

     2204    10235    2              IF I >= 0

  10235  2 006711   006722 604000 2                  TMI     s:10242

     2205    10236    3              THEN DO;     /* FPOOL buffer for label processing already obtained */

     2206    10237    3                 LBL1$ = FM$BUF$(F$DCB.BFR.BUFX(I)); /* Get pointer              */

  10237  2 006712   100115 236106                    LDQ     77,QL,PR1
         2 006713   000033 772000                    QRL     27
         2 006714   000037 376007                    ANQ     31,DL
         2 006715   000000 236006 xsym               LDQ     FM$BUF$,QL
         2 006716   200014 756100                    STQ     LBL1$,,AUTO

     2207    10238    3                 LBL2$ = PINCRC( LBL1$, 80 ); /* Get pointer to second label     */

  10238  2 006717   000024 036003                    ADLQ    20,DU
         2 006720   200015 756100                    STQ     LBL2$,,AUTO

     2208    10239    3                 RETURN;

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:305  
  10239  2 006721   000001 702211                    TSX2  ! 1,X1

     2209    10240
     2210    10241    3                 END;
     2211    10242    3              DO I=0 TO 4;

  10242  2 006722   200012 450100                    STZ     I,,AUTO

     2212    10243    3                 IF F$DCB.BFR.BUFX(I) = 0

  10243  2 006723   200011 470500                    LDP0    JDCB$,,AUTO
         2 006724   200012 720100                    LXL0    I,,AUTO
         2 006725   000115 236110                    LDQ     77,X0,PR0
         2 006726   037000 316003                    CANQ    15872,DU
         2 006727   006756 601000 2                  TNZ     s:10250

     2213    10244    4                 THEN DO;                  /* Found an FPOOL buffer              */

     2214    10245    4                    CALL FMD$GETBUF( I, 1, LBL1$ ); /* Get FPOOL buffer          */

  10245  2 006730   200014 631500                    EPPR1   LBL1$,,AUTO
         2 006731   200050 451500                    STP1    @ALBL$+4,,AUTO
         2 006732   000006 236000 3                  LDQ     6
         2 006733   200047 756100                    STQ     @ALBL$+3,,AUTO
         2 006734   200012 633500                    EPPR3   I,,AUTO
         2 006735   200046 453500                    STP3    @ALBL$+2,,AUTO
         2 006736   200046 630500                    EPPR0   @ALBL$+2,,AUTO
         2 006737   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 006740   000000 701000 xent               TSX1    FMD$GETBUF
         2 006741   000000 011000                    NOP     0

     2215    10246    4                    LBL2$ = PINCRC( LBL1$, 80 ); /* Get pointer to second label  */

  10246  2 006742   200014 236100                    LDQ     LBL1$,,AUTO
         2 006743   000024 036003                    ADLQ    20,DU
         2 006744   200015 756100                    STQ     LBL2$,,AUTO

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:306  
     2216    10247    4                    F$DCB.LPOOL = I + 1;   /* Remember label FPOOL buffer        */

  10247  2 006745   200011 470500                    LDP0    JDCB$,,AUTO
         2 006746   200012 236100                    LDQ     I,,AUTO
         2 006747   000001 036007                    ADLQ    1,DL
         2 006750   000036 736000                    QLS     30
         2 006751   000067 676100                    ERQ     55,,PR0
         2 006752   070000 376003                    ANQ     28672,DU
         2 006753   000067 656100                    ERSQ    55,,PR0

     2217    10248    4                    RETURN;

  10248  2 006754   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 006755   000001 702211                    TSX2  ! 1,X1

     2218    10249    4                    END;
     2219    10250    3                 END;

  10250  2 006756   200012 054100                    AOS     I,,AUTO
         2 006757   200012 235100                    LDA     I,,AUTO
         2 006760   000004 115007                    CMPA    4,DL
         2 006761   006723 604400 2                  TMOZ    s:10243

     2220    10251
     2221    10252    2              B$JIT.ERR = E_NOFPOOL; /*E* ERROR: FTL-E$NOFPOOL */

  10252  2 006762   000010 236000 1                  LDQ     E_NOFPOOL
         2 006763   000000 471400 xsym               LDP1    B$JIT$
         2 006764   100012 756100                    STQ     10,,PR1

     2222    10253    2              ALTRETURN;

  10253  2 006765   200036 221300                    LDX1  ! DT1+2,,AUTO
         2 006766   000000 702211                    TSX2  ! 0,X1

  10253  2 006767                       JUSTALT      null
     2223    10254
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:307  
     2224    10255    2      END FTL_LBLINIT;
     2225    10256        /*********************************************************************/
     2226    10257
     2227    10258    1   JUSTALT:   ;
     2228    10259    1              ALTRETURN;

  10259  2 006767   000000 702200 xent               TSX2  ! X66_AALT

E_BADSPAN
 Sect OctLoc
   1     000   062414 413232                                                    2...

E_BLKCNT
 Sect OctLoc
   1     001   062414 413252                                                    2...

E_EOF
 Sect OctLoc
   1     002   062414 400062                                                    2..2

E_EOSET
 Sect OctLoc
   1     003   062414 413142                                                    2..b

E_EOVOL
 Sect OctLoc
   1     004   062414 413132                                                    2..Z

E_EOVOLS
 Sect OctLoc
   1     005   062414 413152                                                    2..j

E_FSNERR
 Sect OctLoc
   1     006   062414 413372                                                    2...

E_NOFILE
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:308  
 Sect OctLoc
   1     007   062414 401612                                                    2...

E_NOFPOOL
 Sect OctLoc
   1     010   062414 413202                                                    2...

E_POSERR
 Sect OctLoc
   1     011   062414 412752                                                    2...

E_SECTERR
 Sect OctLoc
   1     012   062414 413412                                                    2...

E_TAPBRK
 Sect OctLoc
   1     013   062414 413162                                                    2..r

E_VOLORDER
 Sect OctLoc
   1     014   062414 413302                                                    2...

E_VOLOUT
 Sect OctLoc
   1     015   062414 413272                                                    2...

E_WRONGFILE
 Sect OctLoc
   1     016   062414 413530                                                    2...

(unnamed)
 Sect OctLoc
   1     017   126117 114061   103120 055066   060060 060061   110104 122040    VOL1CP-60001HDR
   1     023   062060 040040   040040 040040   125126 114040   125110 114040    20      UVL UHL
   1     027   125124 114040   105117 106040   105117 126040   110104 122061    UTL EOF EOV HDR1
   1     033   105117 126061   110104 122062   105060 126061   105117 106061    EOV1HDR2E0V1EOF1
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:309  

(unnamed)
 Sect OctLoc
   3     000   111040 040040   116040 040040   063040 040040   777777 777617    I   N   3   ....
   3     004   061040 040040   000005 200000   000003 006000   000002 006000    1   ............
   3     010   000012 400000   060040 040040   062040 040040   125040 040040    ....0   2   U
   3     014   122040 040040   102040 040040   123040 040040   103040 040040    R   B   S   C
   3     020   113040 040040   106040 040040   104040 040040   151040 040040    K   F   D   i
   3     024   170040 040040   130040 040040   126040 040040   777777 777000    x   X   V   ....
   3     030   077777 777777   000027 006000   777777 377777   000031 006000    ?...............
   3     034   000022 006000   000026 006000   777777 577777   777777 777775    ................
   3     040   777775 777777   707777 777777   000032 006000   777773 777777    ................
   3     044   777777 400007   637777 777777   777777 773777   777777 677777    ................
   3     050   777777 777577                                                    ....
     2229    10260
     2230    10261    1   END FTL$LBLTAP;
     2231    10262        /*********************************************************************/

PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:310  
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FT$RECS.:E05TOU  cannot be made into a system file and is referenced.
   FT$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FT$DDT.:E05TOU  is referenced.
   FT_SUBS.:E05TOU  is referenced.
   FM_BUF_R.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_PTRS_R.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FTL$LBLTAP.
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:311  

 **** Variables and constants ****

  ****  Section 001 RoData FTL$LBLTAP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 E_BADSPAN                  1-0-0/b STRC        r     1 E_BLKCNT
     2-0-0/b STRC        r     1 E_EOF                      3-0-0/b STRC        r     1 E_EOSET
     4-0-0/b STRC        r     1 E_EOVOL                    5-0-0/b STRC        r     1 E_EOVOLS
     6-0-0/b STRC        r     1 E_FSNERR                   7-0-0/b STRC        r     1 E_NOFILE
    10-0-0/b STRC        r     1 E_NOFPOOL                 11-0-0/b STRC        r     1 E_POSERR
    12-0-0/b STRC        r     1 E_SECTERR                 13-0-0/b STRC        r     1 E_TAPBRK
    14-0-0/b STRC        r     1 E_VOLORDER                15-0-0/b STRC        r     1 E_VOLOUT
    16-0-0/b STRC        r     1 E_WRONGFILE

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    43-0-0/w PTR         r     1 @ALBL                     44-0-0/w PTR         r     1 @ALBL$
     4-0-0/w PTR         r     1 @LBL$                     42-0-0/w PTR         r     1 @NUHL
     5-0-0/w PTR         r     1 @NUM                       3-0-0/w PTR         r     1 @THELBL
    41-0-0/w PTR         r     1 @UHL$                      6-0-0/w PTR         r     1 @ULBL$
     7-0-0/w PTR         r     1 @UNUM                     *0-0-0/c CHAR(4)     r     1 ALBL
    *0-0-0/w PTR         r     1 ALBL$                     10-0-0/w PTR         r     1 DDDT$
    34-0-0/c STRC(54)    r     1 DT1                       12-0-0/w SBIN        r     1 I
    13-0-0/w UBIN        r     1 J                         11-0-0/w PTR         r     1 JDCB$
    *0-0-0/w PTR         r     1 LBL$                      14-0-0/w PTR         r     1 LBL1$
    15-0-0/w PTR         r     1 LBL2$                     16-0-0/w SBIN        r     1 LOOKDIR
    17-0-0/w SBIN        r     1 N                         21-0-0/w BIT         r     1 NOT_TAPE_END
    *0-0-0/w SBIN        r     1 NUHL                      *0-0-0/w SBIN        r     1 NUM
    22-0-0/w SBIN        r     1 SAVFSN                    23-0-0/w SBIN        r     1 SAVVOL
    24-0-0/b BIT         r     1 SECTFIND                  25-0-0/w SBIN        r     1 SKIPS
    32-0-0/c CHAR(6)     r     1 SN                        26-0-0/w SBIN        r     1 TEMP
    *0-0-0/c CHAR(3)     r     1 THELBL                    30-0-0/w SBIN        r     1 THISFSECT
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:312  
    31-0-0/w SBIN        r     1 THISFSN                   *0-0-0/w PTR         r     1 UHL$
    *0-0-0/w PTR         r     1 ULBL$                     *0-0-0/w SBIN        r     1 UNUM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/d STRC(2232)  r     1 B_SITEINFO
     0-0-0/w PTR         r     1 FM$BUF$(0:31)              0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 S$CU$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(576)   r     1 B$U
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/c STRC(720)   r     1 FT$ANYLBL
     0-0-0/c CHAR(80)    r     1 FT$BLBL                    0-0-0/w STRC(288)   r     1 FT$DDT
     0-0-0/c ASTR(9)     r     1 FT$KEY                     0-0-0/c STRC(720)   r     1 FT$LBL1
     0-0-0/c STRC(720)   r     1 FT$LBL2                    0-0-0/c STRC(720)   r     1 FT$ULBL
     0-0-0/c STRC(720)   r     1 FT$VOL1                    0-0-0/c ACHR        r     1 NCHARS
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/c SBIN        r     1 ONE_WORD                   0-0-0/d STRC(756)   r     1 VLP_ULBL


   Procedure FTL$LBLTAP requires 3576 words for executable code.
   Procedure FTL$LBLTAP requires 42 words of local(AUTO) storage.

    No errors detected in file FTL$LBLTAP.:E05TSI    .
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:313  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:314  
          MINI XREF LISTING

ALBL IN PROCEDURE FTL_CHKLBL
      9556**DCL      9547--PROC     9561>>IF
ALBL$ IN PROCEDURE FTL_CHKLBL
      9557**DCL      9547--PROC     9561>>IF
B$DO.ECCINFO
       166**DCL       167--REDEF
B$JIT.DCB$
      6874**DCL      8579>>ASSIGN   8654>>ASSIGN   8791>>ASSIGN   9940>>ASSIGN  10226>>ASSIGN
B$JIT.ERR
      6784**DCL      8719<<ASSIGN   8829>>IF       8833<<ASSIGN   8840<<ASSIGN   8846>>IF       8856<<ASSIGN
      8948<<ASSIGN   9021<<ASSIGN   9054>>IF       9060<<ASSIGN   9074<<ASSIGN   9085<<ASSIGN   9102<<ASSIGN
      9105<<ASSIGN   9108<<ASSIGN   9174<<ASSIGN   9218<<ASSIGN   9232<<ASSIGN   9247<<ASSIGN   9263<<ASSIGN
      9272<<ASSIGN   9307<<ASSIGN   9357<<ASSIGN   9379<<ASSIGN   9406<<ASSIGN   9459<<ASSIGN   9466<<ASSIGN
      9471<<ASSIGN   9473<<ASSIGN   9478<<ASSIGN   9564<<ASSIGN   9639<<ASSIGN   9646<<ASSIGN   9661<<ASSIGN
      9668<<ASSIGN   9723>>IF       9743<<ASSIGN   9744<<ASSIGN   9749<<ASSIGN   9752<<ASSIGN   9775<<ASSIGN
      9778<<ASSIGN   9795<<ASSIGN   9796<<ASSIGN   9828>>IF       9833<<ASSIGN   9836<<ASSIGN   9917<<ASSIGN
      9919<<ASSIGN   9966<<ASSIGN  10019<<ASSIGN  10069<<ASSIGN  10082<<ASSIGN  10089<<ASSIGN  10096<<ASSIGN
     10164<<ASSIGN  10171<<ASSIGN  10208<<ASSIGN  10252<<ASSIGN
B$JIT.ERR.CODE
      6785**DCL      9094>>IF       9096>>ASSIGN   9217>>IF       9364<<ASSIGN   9463>>ASSIGN   9586>>IF
      9667>>IF       9768>>IF       9915>>ASSIGN   9965>>IF
B$JIT.ERR.MID
      6785**DCL      6785--REDEF
B$JIT$
      7981**DCL      6779--IMP-PTR  8579>>ASSIGN   8654>>ASSIGN   8719>>ASSIGN   8791>>ASSIGN   8829>>IF
      8833>>ASSIGN   8840>>ASSIGN   8846>>IF       8856>>ASSIGN   8948>>ASSIGN   9021>>ASSIGN   9054>>IF
      9060>>ASSIGN   9074>>ASSIGN   9085>>ASSIGN   9094>>IF       9096>>ASSIGN   9102>>ASSIGN   9105>>ASSIGN
      9108>>ASSIGN   9174>>ASSIGN   9217>>IF       9218>>ASSIGN   9232>>ASSIGN   9247>>ASSIGN   9263>>ASSIGN
      9272>>ASSIGN   9307>>ASSIGN   9357>>ASSIGN   9364>>ASSIGN   9379>>ASSIGN   9406>>ASSIGN   9459>>ASSIGN
      9463>>ASSIGN   9466>>ASSIGN   9471>>ASSIGN   9473>>ASSIGN   9478>>ASSIGN   9564>>ASSIGN   9586>>IF
      9639>>ASSIGN   9646>>ASSIGN   9661>>ASSIGN   9667>>IF       9668>>ASSIGN   9723>>IF       9743>>ASSIGN
      9744>>ASSIGN   9749>>ASSIGN   9752>>ASSIGN   9768>>IF       9775>>ASSIGN   9778>>ASSIGN   9795>>ASSIGN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:315  
      9796>>ASSIGN   9828>>IF       9833>>ASSIGN   9836>>ASSIGN   9915>>ASSIGN   9917>>ASSIGN   9919>>ASSIGN
      9940>>ASSIGN   9965>>IF       9966>>ASSIGN  10019>>ASSIGN  10069>>ASSIGN  10082>>ASSIGN  10089>>ASSIGN
     10096>>ASSIGN  10164>>ASSIGN  10171>>ASSIGN  10208>>ASSIGN  10226>>ASSIGN  10252>>ASSIGN
B$U.ASYNCH
       103**DCL      9058>>IF       9306>>IF       9403>>IF
B$U.MISC
       145**DCL       146--REDEF
B$USER.MISC
       221**DCL       222--REDEF
B_SITEINFO.VERSION#
      7997**DCL      8302>>ASSIGN   8395>>ASSIGN
CHKFSECT IN PROCEDURE FTL_PBNFS
      9910**LABEL    9885--CALLALT  9888--CALLALT  9892--CALLALT
CHKFSECTX
      9961**LABEL    9955--CALLALT
CHKSCRATCH
      9094**LABEL    9090--CALLALT
CHKVOLOUT
      9759**LABEL    9757--CALLALT
DDDT$
      8017**DCL      7287--IMP-PTR  8300>>ASSIGN   8304>>DOCASE   8315>>ASSIGN   8316>>ASSIGN   8324>>ASSIGN
      8338>>ASSIGN   8388>>ASSIGN   8390>>ASSIGN   8690>>IF       8692>>ASSIGN   8695>>DOWHILE  8700>>ASSIGN
      8737>>ASSIGN   8915<<ASSIGN   8930>>ASSIGN   8934>>ASSIGN   9022>>ASSIGN   9023>>ASSIGN   9038>>ASSIGN
      9040>>ASSIGN   9053>>ASSIGN   9059>>ASSIGN   9073>>ASSIGN   9083>>ASSIGN   9091<<ASSIGN   9122<<ASSIGN
      9173>>ASSIGN   9214>>DOWHILE  9221<<ASSIGN   9224>>IF       9224>>IF       9237<<ASSIGN   9244>>ASSIGN
      9250>>ASSIGN   9255>>ASSIGN   9259>>DOUNTIL  9268<<ASSIGN   9281>>ASSIGN   9310>>IF       9316>>IF
      9316>>IF       9316>>IF       9322>>ASSIGN   9326>>IF       9353>>IF       9354>>IF       9367>>ASSIGN
      9376>>ASSIGN   9402>>ASSIGN   9405>>ASSIGN   9424>>ASSIGN   9431>>IF       9434>>ASSIGN   9439<<ASSIGN
      9441>>IF       9441>>IF       9443>>IF       9446>>ASSIGN   9458>>ASSIGN   9495>>ASSIGN   9529>>ASSIGN
      9535>>ASSIGN   9563>>ASSIGN   9581>>ASSIGN   9594>>ASSIGN   9597<<ASSIGN   9603>>ASSIGN   9606>>ASSIGN
      9635>>IF       9636>>IF       9649>>ASSIGN   9658>>ASSIGN   9671<<ASSIGN   9672>>IF       9672>>IF
      9674>>IF       9677>>ASSIGN   9781>>ASSIGN   9838>>ASSIGN   9941<<ASSIGN   9942>>IF       9946>>ASSIGN
      9985>>IF       9986>>IF       9988>>IF       9991>>IF       9993>>ASSIGN  10020>>ASSIGN  10026>>ASSIGN
     10029>>ASSIGN  10032>>ASSIGN  10034<<ASSIGN  10035>>IF      10040>>ASSIGN  10059>>DOWHILE 10063>>ASSIGN
     10075>>ASSIGN  10078<<ASSIGN  10101>>ASSIGN  10102>>ASSIGN  10120>>IF      10122>>IF      10138>>ASSIGN
     10165>>ASSIGN  10227<<ASSIGN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:316  
DT1.JD.YR
      8041**DCL      8385>>IF       8385>>IF       8391>>IF       8391>>IF
DT1.JD_R
      8039**DCL      8040--REDEF    8384<<ASSIGN   8390<<ASSIGN
E_BADSPAN
      8056**DCL      9749>>ASSIGN   9775>>ASSIGN   9833>>ASSIGN
E_BLKCNT
      8073**DCL     10208>>ASSIGN
E_EOF
      8089**DCL      8833>>ASSIGN   8840>>ASSIGN   8856>>ASSIGN   9752>>ASSIGN   9778>>ASSIGN   9836>>ASSIGN
E_EOSET
      8103**DCL      9074>>ASSIGN   9102>>ASSIGN   9218>>ASSIGN   9232>>ASSIGN   9263>>ASSIGN   9357>>ASSIGN
      9379>>ASSIGN   9473>>ASSIGN   9639>>ASSIGN   9646>>ASSIGN   9661>>ASSIGN   9668>>ASSIGN
E_EOVOL
      8118**DCL      9744>>ASSIGN   9796>>ASSIGN
E_EOVOLS
      8132**DCL      9743>>ASSIGN   9795>>ASSIGN
E_FSNERR
      8148**DCL      9478>>ASSIGN
E_NOFILE
      8162**DCL      9021>>ASSIGN   9108>>ASSIGN
E_NOFPOOL
      8174**DCL     10252>>ASSIGN
E_POSERR
      8188**DCL      9174>>ASSIGN   9564>>ASSIGN  10019>>ASSIGN  10164>>ASSIGN
E_SECTERR
      8204**DCL      9466>>ASSIGN   9471>>ASSIGN   9917>>ASSIGN   9966>>ASSIGN
E_TAPBRK
      8221**DCL      9060>>ASSIGN   9307>>ASSIGN   9406>>ASSIGN
E_VOLORDER
      8235**DCL      9247>>ASSIGN   9272>>ASSIGN   9459>>ASSIGN   9919>>ASSIGN  10082>>ASSIGN  10089>>ASSIGN
E_VOLOUT
      8254**DCL      8948>>ASSIGN   9085>>ASSIGN
E_WRONGFILE
      8267**DCL     10171>>ASSIGN
F$DCB.ACTPOS
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:317  
      6433**DCL      6433--REDEF
F$DCB.AFTRBLK
      6440**DCL      8353>>IF       8932<<ASSIGN   9907<<ASSIGN   9959<<ASSIGN  10201>>IF
F$DCB.ARS
      6408**DCL      6408--REDEF    8597>>IF       8599>>ASSIGN   8600>>ASSIGN   8619<<ASSIGN   8696<<ASSIGN
      8698>>ASSIGN   8706<<ASSIGN   8716<<ASSIGN   8740<<ASSIGN   8812<<ASSIGN   8819<<ASSIGN   8838<<ASSIGN
      8848<<ASSIGN   8854<<ASSIGN   8879<<ASSIGN   8883<<ASSIGN   9019<<ASSIGN   9056<<ASSIGN   9068<<ASSIGN
      9071<<ASSIGN   9078<<ASSIGN   9081<<ASSIGN   9165>>IF       9177<<ASSIGN   9242<<ASSIGN   9275<<ASSIGN
      9322<<ASSIGN   9355<<ASSIGN   9361<<ASSIGN   9365<<ASSIGN   9371<<ASSIGN   9374<<ASSIGN   9400<<ASSIGN
      9432<<ASSIGN   9444<<ASSIGN   9448<<ASSIGN   9456<<ASSIGN   9493<<ASSIGN   9561>>IF       9582<<ASSIGN
      9587<<ASSIGN   9598<<ASSIGN   9601>>IF       9609<<ASSIGN   9613<<ASSIGN   9637<<ASSIGN   9643<<ASSIGN
      9647<<ASSIGN   9653<<ASSIGN   9656<<ASSIGN   9675<<ASSIGN   9725<<ASSIGN   9731<<ASSIGN   9735<<ASSIGN
      9753<<ASSIGN   9761<<ASSIGN   9783<<ASSIGN   9798<<ASSIGN   9870<<ASSIGN   9895<<ASSIGN   9944<<ASSIGN
      9956<<ASSIGN   9995<<ASSIGN  10010<<ASSIGN  10012<<ASSIGN  10015>>IF      10023<<ASSIGN  10041<<ASSIGN
     10060<<ASSIGN  10072<<ASSIGN  10093<<ASSIGN  10098<<ASSIGN  10124<<ASSIGN  10161>>IF
F$DCB.ASN
      6423**DCL      8685>>IF       8808>>IF       8822>>IF       8869>>IF       8907>>IF       8916>>IF
      9720>>IF       9771>>IF       9780>>IF      10228>>IF
F$DCB.ATTR
      6426**DCL      6427--REDEF
F$DCB.BFR.BUFX
      6453**DCL     10237>>ASSIGN  10243>>IF
F$DCB.BLKL
      6423**DCL      8422>>ASSIGN
F$DCB.BLOCKED
      6422**DCL      8443>>IF       8477>>IF       8483>>IF
F$DCB.BOL
      6424**DCL      8432>>CALLBLT
F$DCB.BORROW
      6441**DCL      6441--REDEF    6441--REDEF    6441--REDEF
F$DCB.CBUFNUM
      6444**DCL      8655>>IF       8656>>ASSIGN   8673<<ASSIGN
F$DCB.CVOL
      6422**DCL      9737>>IF       9790>>IF
F$DCB.DCBNAME.L
      6455**DCL      6455--IMP-SIZ
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:318  
F$DCB.DENSITY
      6428**DCL      8420>>CALLBLT
F$DCB.EBCDIC
      6420**DCL      8368>>IF       8419>>IF       8430>>IF       8476>>IF       8480>>IF       9531>>IF
      9605>>IF      10067>>IF      10080>>IF
F$DCB.EOMCHAR
      6412**DCL      6412--REDEF
F$DCB.FLDID
      6436**DCL      6436--REDEF
F$DCB.FMOD
      6437**DCL      8732>>IF       8872>>IF
F$DCB.FORM$
      6430**DCL      6430--REDEF
F$DCB.FSECT
      6446**DCL      6446--REDEF    8316>>ASSIGN   8355>>IF       8371>>CALLBLT  8918<<ASSIGN   8918>>ASSIGN
      8928<<ASSIGN   8928>>ASSIGN   9035>>IF       9035>>IF       9336>>IF       9390>>IF       9422>>IF
      9422>>IF       9427>>ASSIGN   9886<<ASSIGN   9886>>ASSIGN   9948>>ASSIGN   9954<<ASSIGN  10203>>IF
F$DCB.FSN
      6423**DCL      6423--REDEF    6423--REDEF    6424--REDEF    8315>>ASSIGN   8364>>CALLBLT  8366>>CALLBLT
      9034<<ASSIGN   9099>>IF       9214>>DOWHILE  9241>>IF       9242>>ASSIGN   9246>>IF       9254>>IF
      9259>>DOUNTIL  9271>>IF       9310>>IF       9316>>IF       9322>>ASSIGN   9329>>IF       9389>>IF
      9420>>IF       9684<<ASSIGN  10170>>IF
F$DCB.FUN
      6422**DCL      8683>>IF       8691>>IF
F$DCB.HEADER$
      6429**DCL      6429--REDEF
F$DCB.IASN
      6449**DCL      8322>>IF       8363>>IF       8401>>IF       8504>>IF       8669>>IF       8675>>IF
      8683>>IF       8685>>IF       8731>>IF       8806>>IF       8808>>IF       8817>>IF       8824>>IF
      8926>>IF       9715>>IF       9869>>IF       9874>>IF       9887>>IF
F$DCB.IGNOREFSN
      6419**DCL      9099>>IF       9391>>IF      10081>>IF      10088>>IF      10100>>IF      10168>>IF
F$DCB.IXTNSIZE
      6427**DCL      6427--REDEF
F$DCB.LASTSTA$
      6417**DCL      6417--REDEF
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:319  
F$DCB.LPOOL
      6442**DCL      8655>>IF       8656<<ASSIGN   8941>>IF       8943>>CALL     8944<<ASSIGN   8952>>IF
      8954>>CALL     8955<<ASSIGN  10234>>ASSIGN  10247<<ASSIGN
F$DCB.LSTBLK
      6440**DCL      9779<<ASSIGN   9837<<ASSIGN
F$DCB.LVL
      6442**DCL      6442--REDEF
F$DCB.MAXVOL
      6428**DCL      8793>>IF
F$DCB.MUST_CVOL
      6438**DCL      8940<<ASSIGN   9737>>IF       9745<<ASSIGN   9790>>IF       9797<<ASSIGN   9909<<ASSIGN
F$DCB.NAME.C
      6417**DCL      6417--REDEF    8417>>ASSIGN   9169>>IF
F$DCB.NAME.C17.CC
      6418**DCL      8360>>ASSIGN   9155>>IF
F$DCB.NAME.L
      6417**DCL      9189>>IF
F$DCB.NEW_FSECT
      6438**DCL      9908<<ASSIGN   9960<<ASSIGN
F$DCB.NOEOF
      6438**DCL      6438--REDEF    8665>>IF       8734>>IF       8750<<ASSIGN   8792>>IF       8804>>IF
      8874>>IF       8911>>IF
F$DCB.NRECS
      6428**DCL      6428--REDEF
F$DCB.NRECX
      6447**DCL      6447--REDEF
F$DCB.OHDR
      6439**DCL      6439--REDEF
F$DCB.OLDIOERR
      6448**DCL      9393<<ASSIGN  10168>>IF
F$DCB.ORG
      6422**DCL      6422--REDEF    8416>>IF       8430>>IF       8439>>DOCASE   8450>>DOCASE   8677>>IF
F$DCB.PRECNO
      6445**DCL      6445--REDEF    8352>>ASSIGN   8698<<ASSIGN   8698>>ASSIGN   8933<<ASSIGN   9906<<ASSIGN
      9958<<ASSIGN  10200>>ASSIGN
F$DCB.PSN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:320  
      6418**DCL      8299>>ASSIGN
F$DCB.RCSZ
      6450**DCL      6450--REDEF
F$DCB.RECL
      6423**DCL      8426>>ASSIGN
F$DCB.RES
      6418**DCL      6418--REDEF
F$DCB.SETX
      6430**DCL      6430--REDEF    8749>>ASSIGN   8895>>ASSIGN   8915>>ASSIGN   9091>>ASSIGN   9122>>ASSIGN
      9221>>ASSIGN   9237>>ASSIGN   9268>>ASSIGN   9439>>ASSIGN   9597>>ASSIGN   9671>>ASSIGN   9877>>ASSIGN
      9910>>ASSIGN   9941>>ASSIGN   9961>>ASSIGN  10034>>ASSIGN  10078>>ASSIGN  10227>>ASSIGN
F$DCB.SEZ_OK
      6438**DCL      8913<<ASSIGN   9089<<ASSIGN   9118<<ASSIGN   9215<<ASSIGN   9235<<ASSIGN   9266<<ASSIGN
      9437<<ASSIGN   9595<<ASSIGN   9665<<ASSIGN   9884<<ASSIGN   9951<<ASSIGN  10076<<ASSIGN
F$DCB.SPAN
      6439**DCL      9742>>IF       9747>>IF       9750<<ASSIGN   9773>>IF       9776<<ASSIGN   9794>>IF
      9831>>IF       9834<<ASSIGN
F$DCB.SPANNED
      6422**DCL      8444>>IF       8447>>IF       8484>>IF       8487>>IF       8492>>IF
F$DCB.STR
      6446**DCL      9532>>ASSIGN
F$DCB.TAB$
      6429**DCL      6430--REDEF
F$DCB.TAPTYP.CP6F
      6443**DCL      8355>>IF       8416>>IF       8677>>IF      10203>>IF
F$DCB.TAPTYP.NOCVOL
      6443**DCL      9737>>IF       9790>>IF
F$DCB.TAPTYP.RWASC
      6443**DCL      8423>>IF       8427>>IF
F$DCB.TAPTYP.USRBUF
      6443**DCL      8667>>IF
F$DCB.TDA
      6444**DCL      6444--REDEF
F$DCB.TRNC
      6440**DCL      8705>>IF
F$DCB.TYC
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:321  
      6408**DCL      8712<<ASSIGN   9004>>IF       9160>>IF       9420>>IF       9785<<ASSIGN  10129<<ASSIGN
     10130>>DOWHILE 10136>>IF
F$DCB.TYC.BOT
      6408**DCL      9070>>IF       9363>>IF       9645>>IF
F$DCB.TYC.EOF
      6409**DCL      8589>>DOWHILE  8591>>IF       8617>>IF       8621<<ASSIGN   8699>>IF       8817>>IF
      9065>>IF       9162>>IF       9229>>IF       9260>>IF       9348>>IF       9525>>IF       9593>>IF
      9634>>IF       9733>>IF       9869>>IF       9894>>IF      10007>>IF      10062>>IF      10071>>IF
F$DCB.TYC.EOT
      6408**DCL      9593>>IF
F$DCB.VOL
      6428**DCL      8369>>CALLBLT  8794>>CALL     8914>>CALL     9014>>ASSIGN   9017>>IF       9090>>CALL
      9106>>IF       9107>>IF       9113>>ASSIGN   9213>>IF       9216>>CALL     9236>>CALL     9267>>CALL
      9438>>CALL     9596>>CALL     9666>>CALL     9741>>CALL     9885>>CALL     9952>>CALL    10033>>CALL
     10077>>CALL
F$DCB.WSN
      6419**DCL      6419--REDEF
FM$BUF$
      7135**DCL     10237>>ASSIGN
FMD$GETBUF
      7953**DCL-ENT 10245--CALL
FMD$RELBUF
      7954**DCL-ENT  8943--CALL     8954--CALL
FPO$CLOSEIN
      7958**DCL-ENT  8684--CALL     9875--CALL
FPO$FINDSEQ
      7957**DCL-ENT  9888--CALL
FPO$OPENIN
      7959**DCL-ENT  9889--CALL
FPO$RDEOFLBL
      7955**DCL-ENT  8826--CALL     9825--CALL
FPO$WRITELBL
      7956**DCL-ENT  8505--CALL
FSNNOTHERE
      9464**LABEL    9313--GOTO     9342--GOTO
FT$ANYLBL.LABEL_TYPE
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:322  
      7607**DCL      9084>>IF       9164>>IF       9181<<ASSIGN   9230>>IF       9261>>IF       9304<<ASSIGN
      9377>>IF       9561>>IF       9601>>IF       9659>>IF      10015>>IF      10015>>IF      10027>>IF
     10119<<ASSIGN  10130>>DOWHILE
FT$BLBL
      7590**DCL      8292<<ASSIGN   8339<<ASSIGN   8408<<ASSIGN
FT$DDT.ACCT
      7288**DCL      8300>>ASSIGN
FT$DDT.ANST
      7303**DCL      9316>>IF       9353>>IF       9441>>IF       9635>>IF       9672>>IF       9986>>IF
     10122>>IF
FT$DDT.EXPIRE
      7296**DCL      8388>>ASSIGN   8390>>ASSIGN
FT$DDT.FMCNT
      7301**DCL      8338<<ASSIGN
FT$DDT.FMNEEDED
      7319**DCL      8737<<ASSIGN   9991>>IF       9993<<ASSIGN
FT$DDT.FRSTFSECT
      7324**DCL      8316<<ASSIGN
FT$DDT.FRSTFSN
      7299**DCL      8315<<ASSIGN   9214>>DOWHILE  9316>>IF
FT$DDT.FSN
      7297**DCL      9023<<ASSIGN   9053<<ASSIGN   9259>>DOUNTIL  9310>>IF       9316>>IF       9322>>ASSIGN
      9354>>IF       9402<<ASSIGN   9529<<ASSIGN   9535>>ASSIGN   9603<<ASSIGN   9636>>IF      10026<<ASSIGN
     10040<<ASSIGN  10101<<ASSIGN
FT$DDT.NOTEOF
      7334**DCL      8692<<ASSIGN
FT$DDT.NOWANS
      7310**DCL      9441>>IF       9672>>IF       9988>>IF
FT$DDT.POS
      7321**DCL      8324<<ASSIGN   8690>>IF       8695>>DOWHILE  8700<<ASSIGN   8749<<ASSIGN   8895<<ASSIGN
      8934<<ASSIGN   9022<<ASSIGN   9038<<ASSIGN   9040<<ASSIGN   9059<<ASSIGN   9073<<ASSIGN   9083<<ASSIGN
      9224>>IF       9224>>IF       9244<<ASSIGN   9250<<ASSIGN   9255<<ASSIGN   9281<<ASSIGN   9326>>IF
      9367<<ASSIGN   9376<<ASSIGN   9405<<ASSIGN   9424<<ASSIGN   9431>>IF       9434<<ASSIGN   9443>>IF
      9446<<ASSIGN   9458<<ASSIGN   9495<<ASSIGN   9594<<ASSIGN   9606<<ASSIGN   9649<<ASSIGN   9658<<ASSIGN
      9674>>IF       9677<<ASSIGN   9781<<ASSIGN   9838<<ASSIGN   9877<<ASSIGN   9910<<ASSIGN   9942>>IF
      9946<<ASSIGN   9961<<ASSIGN  10029<<ASSIGN  10032<<ASSIGN  10059>>DOWHILE 10063<<ASSIGN  10075<<ASSIGN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:323  
     10102<<ASSIGN  10120>>IF      10138<<ASSIGN
FT$DDT.POSLOST
      7314**DCL      9173<<ASSIGN   9563<<ASSIGN   9581<<ASSIGN  10020<<ASSIGN  10165<<ASSIGN
FT$DDT.SCRTCH
      7305**DCL      8930<<ASSIGN   9985>>IF      10035>>IF
FT$DDT.VOLACCESS
      7339**DCL      8304>>DOCASE
FT$KEY.KL
      7675**DCL      7676--IMP-SIZ
FT$LBL1.BLK_CNT
      7429**DCL      8358<<CALLBLT 10205>>CALLBLT
FT$LBL1.CENTURY1
      7424**DCL      8386<<ASSIGN   8387<<ASSIGN
FT$LBL1.CENTURY2
      7426**DCL      8392<<ASSIGN   8393<<ASSIGN
FT$LBL1.CREATE_DATE
      7425**DCL      8382<>CALL     8384>>ASSIGN
FT$LBL1.EXPIRE_DATE
      7427**DCL      8388<<ASSIGN
FT$LBL1.FILE_ID
      7415**DCL      8360<<ASSIGN   9155>>IF
FT$LBL1.FSECT
      7418**DCL      8369<<CALLBLT  8371<<CALLBLT  9026>>CALLBLT  9530>>CALLBLT  9604>>CALLBLT 10068>>CALLBLT
FT$LBL1.FSEQU_NUM
      7420**DCL      8366<<CALLBLT  9011>>CALLBLT  9528>>CALLBLT  9602>>CALLBLT 10025>>CALLBLT 10039>>CALLBLT
     10066>>CALLBLT 10169>>CALLBLT
FT$LBL1.FSETID
      7417**DCL      8361--CALL
FT$LBL1.FVERSION
      7423**DCL      8348<<ASSIGN
FT$LBL1.GENERATION
      7422**DCL      8347<<ASSIGN
FT$LBL1.LABEL_ID
      7413**DCL      8340<<ASSIGN
FT$LBL1.LABEL_NUM
      7414**DCL      8341<<ASSIGN  10161>>IF
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:324  
FT$LBL1.ODFSEQU_NUM
      7435**DCL      8364<<CALLBLT
FT$LBL1.SYSTEM.ID
      7433**DCL      8394<<ASSIGN   9157>>IF
FT$LBL1.SYSTEM.VERSION
      7434**DCL      8395<<ASSIGN
FT$LBL1.SYSTEM_ID
      7431**DCL      7432--REDEF
FT$LBL2.BLKL
      7502**DCL      8425<<CALLBLT
FT$LBL2.BUF_OFFSET
      7533**DCL      8431<<ASSIGN   8432<<CALLBLT
FT$LBL2.CP6
      7504**DCL      7522--REDEF
FT$LBL2.CP6.BLOCK_ATTR
      7519**DCL      8445<<ASSIGN   8446<<ASSIGN   8448<<ASSIGN   8478<<ASSIGN
FT$LBL2.CP6.FILE_FORMAT
      7508**DCL      8452<<ASSIGN   8454<<ASSIGN   8456<<ASSIGN   8458<<ASSIGN   8460<<ASSIGN   8462<<ASSIGN
      8464<<ASSIGN   8466<<ASSIGN   8469<<ASSIGN   8470<<ASSIGN   8472<<ASSIGN   9167>>IF
FT$LBL2.CP6.FILE_ID
      7506**DCL      8417<<ASSIGN   9169>>IF
FT$LBL2.FORMAT
      7497**DCL      8442<<ASSIGN   8475<<ASSIGN   8482<<ASSIGN   8493<<ASSIGN   8494<<ASSIGN   8497<<ASSIGN
      9167>>IF
FT$LBL2.LABEL_ID
      7495**DCL      8409<<ASSIGN
FT$LBL2.LABEL_NUM
      7496**DCL      8410<<ASSIGN
FT$LBL2.OTHEROS.BLOCK_ATTR
      7529**DCL      8485<<ASSIGN   8486<<ASSIGN   8488<<ASSIGN
FT$LBL2.OTHEROS.DENSITY
      7523**DCL      8420<<CALLBLT
FT$LBL2.RECL
      7503**DCL      8429<<CALLBLT
FT$ULBL.LABEL_ID
      7597**DCL      8827>>ASSIGN   9826>>ASSIGN  10160>>ASSIGN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:325  
FT$ULBL.LABEL_NBIN
      7598**DCL      7599--REDEF
FT$VOL1.ACCESS
      7357**DCL      8306<<ASSIGN   8308<<ASSIGN   8310<<ASSIGN   8312<<ASSIGN
FT$VOL1.ACCOUNT
      7365**DCL      8300<<ASSIGN
FT$VOL1.LABEL_TYPE
      7355**DCL      8293<<ASSIGN
FT$VOL1.SN
      7356**DCL      8299<<ASSIGN
FT$VOL1.SYSTEM
      7366**DCL      8303<<ASSIGN
FT$VOL1.SYSTEM_CODE.ID
      7363**DCL      8301<<ASSIGN
FT$VOL1.SYSTEM_CODE.VERSION
      7364**DCL      8302<<ASSIGN
FT$VOL1.VERSION
      7368**DCL      8314<<ASSIGN
FTI$RDASCEBC
      7961**DCL-ENT  8590--CALL     9080--CALL     9159--CALL     9373--CALL     9585--CALL     9655--CALL
      9732--CALL    10014--CALL    10126--CALL    10131--CALL    10135--CALL    10159--CALL
FTI$REWIND
      7962**DCL-ENT  9115--CALL     9225--CALL     9318--CALL
FTI$SPFILE
      7963**DCL-ENT  8620--CALL     8717--CALL     8741--CALL     8813--CALL     8820--CALL     8839--CALL
      8849--CALL     8855--CALL     8880--CALL     8884--CALL     9057--CALL     9069--CALL     9079--CALL
      9082--CALL     9243--CALL     9276--CALL     9324--CALL     9356--CALL     9362--CALL     9372--CALL
      9375--CALL     9401--CALL     9445--CALL     9583--CALL     9588--CALL     9610--CALL     9614--CALL
      9638--CALL     9644--CALL     9654--CALL     9657--CALL     9676--CALL     9726--CALL     9736--CALL
      9754--CALL     9784--CALL     9799--CALL     9871--CALL     9896--CALL     9945--CALL     9957--CALL
     10011--CALL    10024--CALL    10042--CALL    10073--CALL    10094--CALL    10099--CALL    10125--CALL
FTI$SPREC
      7964**DCL-ENT  8697--CALL     8707--CALL     9020--CALL     9072--CALL     9178--CALL     9327--CALL
      9366--CALL     9433--CALL     9449--CALL     9457--CALL     9494--CALL     9599--CALL     9648--CALL
      9762--CALL     9996--CALL    10013--CALL    10061--CALL
FTI$WRASCEBC
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:326  
      7965**DCL-ENT  8323--CALL     8402--CALL     8507--CALL     8548--CALL
FTI$WRFM
      7966**DCL-ENT  8676--CALL     8736--CALL     8807--CALL     8811--CALL     8877--CALL     8878--CALL
      8923--CALL     9994--CALL
FTL$FINDSEQ
      9287**ENTRY    9044--CALL     9892--CALL     9955--CALL
FTL$GETULBLS
      8560**ENTRY    8746--CALL     8888--CALL     9901--CALL     9903--CALL
FTL$LBLS
      8330**ENTRY    8678--CALL     8680--CALL     8809--CALL     8920--CALL     8929--CALL
FTL$ULBLS
      8514**ENTRY    8735--CALL     8876--CALL     8921--CALL
FTL$VOL1
      8284**ENTRY    8919--CALL
FTL_CHKBLKCNT
     10188**PROC     8710--CALL     8828--CALL     9827--CALL    10178--CALL
FTL_CHKEOX
     10148**PROC     8702--CALL     8708--CALL     8718--CALL     8845--CALL     9722--CALL    10065--CALL
     10095--CALL
FTL_CHKLBL
      9547**PROC     9005--CALL     9527--CALL    10038--CALL    10137--CALL
FTL_CHKNAME
      9129**PROC     9027--CALL
FTL_GETFSN
      9501**PROC     9227--CALL     9238--CALL     9245--CALL     9278--CALL     9328--CALL     9347--CALL
      9447--CALL     9492--CALL     9633--CALL    10079--CALL
FTL_GETNXTHDR
     10108**PROC     8997--CALL     9517--CALL    10006--CALL
FTL_LBLINIT
     10215**PROC     8291--CALL     8337--CALL     8664--CALL     8803--CALL     8987--CALL     9211--CALL
      9295--CALL     9491--CALL     9580--CALL     9631--CALL     9712--CALL     9979--CALL    10058--CALL
FTL_ODEOF
      9815**PROC     9717--CALL
FTL_PBNFS
      9850**PROC     8715--CALL     8937--CALL     9809--CALL     9841--CALL
FTR$CHNGVOL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:327  
      7967**DCL-ENT  8914--CALL     9090--CALL     9119--CALL     9216--CALL     9236--CALL     9267--CALL
      9596--CALL     9885--CALL     9952--CALL    10033--CALL    10077--CALL
FTR$CHNGVOLNR
      7968**DCL-ENT  9438--CALL     9666--CALL
FTR$GETSN
      7969**DCL-ENT  8361--CALL     8794--CALL     9741--CALL
FTW$CVOL
      7970**DCL-ENT  9757--CALL
FTW$TRNCHLD
      7971**DCL-ENT  8672--CALL
FTW$TRNCOD
      7972**DCL-ENT  8670--CALL
HFF$DSIZ
      7973**DCL-ENT  8729--CALL     8868--CALL     8905--CALL
I
      8019**DCL      8544<<ASSIGN   8545>>DOWHILE  8546>>IF       8548>>CALL     8549<<ASSIGN   8549>>ASSIGN
      8551>>ASSIGN   8585<<ASSIGN   8589>>DOWHILE  8590>>CALL     8593>>IF       8593>>IF       8593>>IF
      8600>>ASSIGN   8603<<ASSIGN   8603>>ASSIGN   8606>>ASSIGN   8608>>ASSIGN   8610>>ASSIGN   9096<<ASSIGN
      9097>>IF       9097>>IF       9101>>IF       9463<<ASSIGN   9464>>IF       9469>>IF       9732--CALL
      9915<<ASSIGN   9916>>IF       9918>>IF      10205<<CALLBLT 10206>>IF      10234<<ASSIGN  10235>>IF
     10237>>ASSIGN  10242<<DOINDEX 10243>>IF      10245<>CALL    10247>>ASSIGN
J
      8020**DCL      8378<>CALL     8379<>CALL     8381<>CALL     8382<>CALL
JDCB$
      8018**DCL      6408--IMP-PTR  8299>>ASSIGN   8315>>ASSIGN   8316>>ASSIGN   8322>>IF       8352>>ASSIGN
      8353>>IF       8355>>IF       8355>>IF       8360>>ASSIGN   8363>>IF       8364>>CALLBLT  8366>>CALLBLT
      8368>>IF       8369>>CALLBLT  8371>>CALLBLT  8401>>IF       8416>>IF       8416>>IF       8417>>ASSIGN
      8419>>IF       8420>>CALLBLT  8422>>ASSIGN   8423>>IF       8426>>ASSIGN   8427>>IF       8430>>IF
      8430>>IF       8432>>CALLBLT  8439>>DOCASE   8443>>IF       8444>>IF       8447>>IF       8450>>DOCASE
      8476>>IF       8477>>IF       8480>>IF       8483>>IF       8484>>IF       8487>>IF       8492>>IF
      8504>>IF       8579<<ASSIGN   8589>>DOWHILE  8591>>IF       8597>>IF       8599>>ASSIGN   8600>>ASSIGN
      8617>>IF       8619>>ASSIGN   8621>>ASSIGN   8654<<ASSIGN   8655>>IF       8655>>IF       8656>>ASSIGN
      8656>>ASSIGN   8665>>IF       8667>>IF       8669>>IF       8673>>ASSIGN   8675>>IF       8677>>IF
      8677>>IF       8683>>IF       8683>>IF       8685>>IF       8685>>IF       8691>>IF       8696>>ASSIGN
      8698>>ASSIGN   8698>>ASSIGN   8698>>ASSIGN   8699>>IF       8705>>IF       8706>>ASSIGN   8712>>ASSIGN
      8716>>ASSIGN   8731>>IF       8732>>IF       8734>>IF       8740>>ASSIGN   8749>>ASSIGN   8750>>ASSIGN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:328  
      8791<<ASSIGN   8792>>IF       8793>>IF       8794>>CALL     8804>>IF       8806>>IF       8808>>IF
      8808>>IF       8812>>ASSIGN   8817>>IF       8817>>IF       8819>>ASSIGN   8822>>IF       8824>>IF
      8838>>ASSIGN   8848>>ASSIGN   8854>>ASSIGN   8869>>IF       8872>>IF       8874>>IF       8879>>ASSIGN
      8883>>ASSIGN   8895>>ASSIGN   8907>>IF       8911>>IF       8913>>ASSIGN   8914>>CALL     8915>>ASSIGN
      8916>>IF       8918>>ASSIGN   8918>>ASSIGN   8926>>IF       8928>>ASSIGN   8928>>ASSIGN   8932>>ASSIGN
      8933>>ASSIGN   8940>>ASSIGN   8941>>IF       8943>>CALL     8944>>ASSIGN   8952>>IF       8954>>CALL
      8955>>ASSIGN   9004>>IF       9014>>ASSIGN   9017>>IF       9019>>ASSIGN   9034>>ASSIGN   9035>>IF
      9035>>IF       9056>>ASSIGN   9065>>IF       9068>>ASSIGN   9070>>IF       9071>>ASSIGN   9078>>ASSIGN
      9081>>ASSIGN   9089>>ASSIGN   9090>>CALL     9091>>ASSIGN   9099>>IF       9099>>IF       9106>>IF
      9107>>IF       9113>>ASSIGN   9118>>ASSIGN   9122>>ASSIGN   9155>>IF       9160>>IF       9162>>IF
      9165>>IF       9169>>IF       9177>>ASSIGN   9189>>IF       9213>>IF       9214>>DOWHILE  9215>>ASSIGN
      9216>>CALL     9221>>ASSIGN   9229>>IF       9235>>ASSIGN   9236>>CALL     9237>>ASSIGN   9241>>IF
      9242>>ASSIGN   9242>>ASSIGN   9246>>IF       9254>>IF       9259>>DOUNTIL  9260>>IF       9266>>ASSIGN
      9267>>CALL     9268>>ASSIGN   9271>>IF       9275>>ASSIGN   9310>>IF       9316>>IF       9322>>ASSIGN
      9322>>ASSIGN   9329>>IF       9336>>IF       9348>>IF       9355>>ASSIGN   9361>>ASSIGN   9363>>IF
      9365>>ASSIGN   9371>>ASSIGN   9374>>ASSIGN   9389>>IF       9390>>IF       9391>>IF       9393>>ASSIGN
      9400>>ASSIGN   9420>>IF       9420>>IF       9422>>IF       9422>>IF       9427>>ASSIGN   9432>>ASSIGN
      9437>>ASSIGN   9438>>CALL     9439>>ASSIGN   9444>>ASSIGN   9448>>ASSIGN   9456>>ASSIGN   9493>>ASSIGN
      9525>>IF       9531>>IF       9532>>ASSIGN   9561>>IF       9582>>ASSIGN   9587>>ASSIGN   9593>>IF
      9593>>IF       9595>>ASSIGN   9596>>CALL     9597>>ASSIGN   9598>>ASSIGN   9601>>IF       9605>>IF
      9609>>ASSIGN   9613>>ASSIGN   9634>>IF       9637>>ASSIGN   9643>>ASSIGN   9645>>IF       9647>>ASSIGN
      9653>>ASSIGN   9656>>ASSIGN   9665>>ASSIGN   9666>>CALL     9671>>ASSIGN   9675>>ASSIGN   9684>>ASSIGN
      9715>>IF       9720>>IF       9725>>ASSIGN   9731>>ASSIGN   9733>>IF       9735>>ASSIGN   9737>>IF
      9737>>IF       9737>>IF       9741>>CALL     9742>>IF       9745>>ASSIGN   9747>>IF       9750>>ASSIGN
      9753>>ASSIGN   9761>>ASSIGN   9771>>IF       9773>>IF       9776>>ASSIGN   9779>>ASSIGN   9780>>IF
      9783>>ASSIGN   9785>>ASSIGN   9790>>IF       9790>>IF       9790>>IF       9794>>IF       9797>>ASSIGN
      9798>>ASSIGN   9831>>IF       9834>>ASSIGN   9837>>ASSIGN   9869>>IF       9869>>IF       9870>>ASSIGN
      9874>>IF       9877>>ASSIGN   9884>>ASSIGN   9885>>CALL     9886>>ASSIGN   9886>>ASSIGN   9887>>IF
      9894>>IF       9895>>ASSIGN   9906>>ASSIGN   9907>>ASSIGN   9908>>ASSIGN   9909>>ASSIGN   9910>>ASSIGN
      9940<<ASSIGN   9941>>ASSIGN   9944>>ASSIGN   9948>>ASSIGN   9951>>ASSIGN   9952>>CALL     9954>>ASSIGN
      9956>>ASSIGN   9958>>ASSIGN   9959>>ASSIGN   9960>>ASSIGN   9961>>ASSIGN   9995>>ASSIGN  10007>>IF
     10010>>ASSIGN  10012>>ASSIGN  10015>>IF      10023>>ASSIGN  10033>>CALL    10034>>ASSIGN  10041>>ASSIGN
     10060>>ASSIGN  10062>>IF      10067>>IF      10071>>IF      10072>>ASSIGN  10076>>ASSIGN  10077>>CALL
     10078>>ASSIGN  10080>>IF      10081>>IF      10088>>IF      10093>>ASSIGN  10098>>ASSIGN  10100>>IF
     10124>>ASSIGN  10129>>ASSIGN  10130>>DOWHILE 10136>>IF      10161>>IF      10168>>IF      10168>>IF
     10170>>IF      10200>>ASSIGN  10201>>IF      10203>>IF      10203>>IF      10226<<ASSIGN  10227>>ASSIGN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:329  
     10228>>IF      10234>>ASSIGN  10237>>ASSIGN  10243>>IF      10247>>ASSIGN
JUSTALT
     10253**LABEL    8291--CALLALT  8323--CALLALT  8337--CALLALT  8402--CALLALT  8505--CALLALT  8507--CALLALT
      8548--CALLALT  8590--CALLALT  8620--CALLALT  8664--CALLALT  8670--CALLALT  8672--CALLALT  8676--CALLALT
      8678--CALLALT  8680--CALLALT  8684--CALLALT  8697--CALLALT  8702--CALLALT  8707--CALLALT  8708--CALLALT
      8715--CALLALT  8717--CALLALT  8718--CALLALT  8735--CALLALT  8736--CALLALT  8741--CALLALT  8746--CALLALT
      8803--CALLALT  8811--CALLALT  8813--CALLALT  8839--CALLALT  8987--CALLALT  8997--CALLALT  9005--CALLALT
      9020--CALLALT  9044--CALLALT  9057--CALLALT  9069--CALLALT  9072--CALLALT  9079--CALLALT  9080--CALLALT
      9082--CALLALT  9115--CALLALT  9119--CALLALT  9211--CALLALT  9225--CALLALT  9227--CALLALT  9236--CALLALT
      9238--CALLALT  9243--CALLALT  9245--CALLALT  9267--CALLALT  9276--CALLALT  9278--CALLALT  9295--CALLALT
      9318--CALLALT  9324--CALLALT  9327--CALLALT  9328--CALLALT  9347--CALLALT  9356--CALLALT  9362--CALLALT
      9366--CALLALT  9372--CALLALT  9373--CALLALT  9375--CALLALT  9401--CALLALT  9433--CALLALT  9445--CALLALT
      9447--CALLALT  9449--CALLALT  9457--CALLALT  9491--CALLALT  9492--CALLALT  9494--CALLALT  9580--CALLALT
      9583--CALLALT  9588--CALLALT  9596--CALLALT  9599--CALLALT  9610--CALLALT  9614--CALLALT  9631--CALLALT
      9633--CALLALT  9638--CALLALT  9644--CALLALT  9648--CALLALT  9654--CALLALT  9655--CALLALT  9657--CALLALT
      9676--CALLALT  9712--CALLALT  9717--CALLALT  9722--CALLALT  9726--CALLALT  9732--CALLALT  9736--CALLALT
      9754--CALLALT  9762--CALLALT  9784--CALLALT  9799--CALLALT  9809--CALLALT  9945--CALLALT  9952--CALLALT
      9957--CALLALT  9979--CALLALT  9994--CALLALT  9996--CALLALT 10006--CALLALT 10011--CALLALT 10013--CALLALT
     10014--CALLALT 10024--CALLALT 10033--CALLALT 10038--CALLALT 10042--CALLALT 10058--CALLALT 10061--CALLALT
     10065--CALLALT 10073--CALLALT 10077--CALLALT 10079--CALLALT 10094--CALLALT 10095--CALLALT 10099--CALLALT
JUSTALT IN PROCEDURE FTL_CHKEOX
     10179**LABEL   10159--CALLALT
JUSTALT IN PROCEDURE FTL_CHKNAME
      9189**LABEL    9159--CALLALT  9178--CALLALT
JUSTALT IN PROCEDURE FTL_GETFSN
      9530**LABEL    9517--CALLALT  9527--CALLALT
JUSTALT IN PROCEDURE FTL_GETNXTHDR
     10138**LABEL   10125--CALLALT 10126--CALLALT 10131--CALLALT 10135--CALLALT 10137--CALLALT
JUSTALT IN PROCEDURE FTL_ODEOF
      9844**LABEL    9825--CALLALT  9841--CALLALT
JUSTALT IN PROCEDURE FTL_PBNFS
      9918**LABEL    9871--CALLALT  9875--CALLALT  9889--CALLALT  9896--CALLALT  9901--CALLALT  9903--CALLALT
LBL$
      8007**DCL         9--PROC     8330--ENTRY    8468--IF       8514--ENTRY    8529>>IF       8530>>ASSIGN
      8560--ENTRY    8576>>IF       8578>>ASSIGN   8628--ENTRY    8691>>IF       8735<>CALL     8746<>CALL
      8756--ENTRY    8876<>CALL     8888<>CALL     8893>>ASSIGN   9928--ENTRY
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:330  
LBL1$
      8021**DCL      5813--IMP-PTR  8292>>ASSIGN   8293>>ASSIGN   8299>>ASSIGN   8300>>ASSIGN   8301>>ASSIGN
      8302>>ASSIGN   8303>>ASSIGN   8306>>ASSIGN   8308>>ASSIGN   8310>>ASSIGN   8312>>ASSIGN   8314>>ASSIGN
      8323<>CALL     8339>>ASSIGN   8340>>ASSIGN   8341>>ASSIGN   8347>>ASSIGN   8348>>ASSIGN   8358>>CALLBLT
      8360>>ASSIGN   8361>>CALL     8364>>CALLBLT  8366>>CALLBLT  8369>>CALLBLT  8371>>CALLBLT  8382>>CALL
      8384>>ASSIGN   8386>>ASSIGN   8387>>ASSIGN   8388>>ASSIGN   8392>>ASSIGN   8393>>ASSIGN   8394>>ASSIGN
      8395>>ASSIGN   8402<>CALL     8505<>CALL     8530<<ASSIGN   8534>>ASSIGN   8538>>IF       8538>>ASSIGN
      8546>>IF       8548>>CALL     8554>>IF       8554>>ASSIGN   8578<<ASSIGN   8590>>CALL     8593>>IF
      8593>>IF       8593>>IF       8600>>ASSIGN   8608>>ASSIGN   8826<>CALL     8827>>ASSIGN   9005<>CALL
      9011>>CALLBLT  9026>>CALLBLT  9080<>CALL     9084>>IF       9155>>IF       9157>>IF       9230>>IF
      9261>>IF       9373<>CALL     9377>>IF       9527<>CALL     9528>>CALLBLT  9530>>CALLBLT  9585<>CALL
      9601>>IF       9602>>CALLBLT  9604>>CALLBLT  9655<>CALL     9659>>IF       9825<>CALL     9826>>ASSIGN
     10014<>CALL    10015>>IF      10015>>IF      10025>>CALLBLT 10027>>IF      10038<>CALL    10039>>CALLBLT
     10066>>CALLBLT 10068>>CALLBLT 10119>>ASSIGN  10126<>CALL    10130>>DOWHILE 10131<>CALL    10135<>CALL
     10137<>CALL    10159<>CALL    10160>>ASSIGN  10161>>IF      10169>>CALLBLT 10205>>CALLBLT 10237<<ASSIGN
     10238>>ASSIGN  10245<>CALL    10246>>ASSIGN
LBL2$
      8022**DCL      8408>>ASSIGN   8409>>ASSIGN   8410>>ASSIGN   8417>>ASSIGN   8420>>CALLBLT  8425>>CALLBLT
      8429>>CALLBLT  8431>>ASSIGN   8432>>CALLBLT  8442>>ASSIGN   8445>>ASSIGN   8446>>ASSIGN   8448>>ASSIGN
      8452>>ASSIGN   8454>>ASSIGN   8456>>ASSIGN   8458>>ASSIGN   8460>>ASSIGN   8462>>ASSIGN   8464>>ASSIGN
      8466>>ASSIGN   8469>>ASSIGN   8470>>ASSIGN   8472>>ASSIGN   8475>>ASSIGN   8478>>ASSIGN   8482>>ASSIGN
      8485>>ASSIGN   8486>>ASSIGN   8488>>ASSIGN   8493>>ASSIGN   8494>>ASSIGN   8497>>ASSIGN   8505<>CALL
      8507<>CALL     8600<<ASSIGN   8601>>ASSIGN   9159<>CALL     9164>>IF       9167>>IF       9167>>IF
      9169>>IF       9181>>ASSIGN   9304>>ASSIGN  10238<<ASSIGN  10246<<ASSIGN
LOOKDIR
      8023**DCL      9302<<ASSIGN   9312>>IF       9315<<ASSIGN   9319<<ASSIGN   9341>>IF       9344<<ASSIGN
      9440<<ASSIGN
N
      8024**DCL      8048--IMP-SIZ  8350<<ASSIGN   8352<<ASSIGN   8354<<ASSIGN   8354>>ASSIGN   8356<<ASSIGN
      8356>>ASSIGN   8358>>CALLBLT  8422<<ASSIGN   8424<<ASSIGN   8424>>ASSIGN   8425>>CALLBLT  8426<<ASSIGN
      8428<<ASSIGN   8428>>ASSIGN   8429>>CALLBLT  8531<<ASSIGN   8532>>IF       8538>>IF       8538<<ASSIGN
      8545>>DOWHILE  8551<<ASSIGN   8553>>ASSIGN   8554>>IF       8554>>ASSIGN   8599<<ASSIGN   8601>>ASSIGN
      8727<<ASSIGN   8729<>CALL     8735<>CALL     8742<<ASSIGN   8746<>CALL     8866<<ASSIGN   8868<>CALL
      8876<>CALL     8885<<ASSIGN   8888<>CALL     8892>>IF       8901<<ASSIGN   8905<>CALL     8908>>IF
      8921<>CALL     8937<>CALL    10169<<CALLBLT 10170>>IF      10200<<ASSIGN  10202<<ASSIGN  10202>>ASSIGN
     10204<<ASSIGN  10204>>ASSIGN  10206>>IF
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:331  
N$DCT$$
      7786**DCL      7786--IMP-PTR  8749>>ASSIGN   8895>>ASSIGN   8915>>ASSIGN   9091>>ASSIGN   9122>>ASSIGN
      9221>>ASSIGN   9237>>ASSIGN   9268>>ASSIGN   9439>>ASSIGN   9597>>ASSIGN   9671>>ASSIGN   9877>>ASSIGN
      9910>>ASSIGN   9941>>ASSIGN   9961>>ASSIGN  10034>>ASSIGN  10078>>ASSIGN  10227>>ASSIGN
NCHARS
      8048**DCL      8601<<ASSIGN
NK$LDCT.DDT$
      7803**DCL      7803--REDEF    8749>>ASSIGN   8895>>ASSIGN   8915>>ASSIGN   9091>>ASSIGN   9122>>ASSIGN
      9221>>ASSIGN   9237>>ASSIGN   9268>>ASSIGN   9439>>ASSIGN   9597>>ASSIGN   9671>>ASSIGN   9877>>ASSIGN
      9910>>ASSIGN   9941>>ASSIGN   9961>>ASSIGN  10034>>ASSIGN  10078>>ASSIGN  10227>>ASSIGN
NK$LDCT.IOQ$
      7802**DCL      7803--REDEF
NK$LDCT.LDCTX
      7804**DCL      7804--REDEF
NK$LDCT.LKFLG.ABORTED
      7816**DCL      7817--REDEF
NK$LDCT.RLCID.LDCTX
      7826**DCL      7826--REDEF
NK$LDCT.STA$
      7822**DCL      7823--REDEF
NK$LDCT.SYMB$
      7801**DCL      7801--REDEF    7801--REDEF    7802--REDEF
NK$LDCT$
      7786**DCL      8749>>ASSIGN   8895>>ASSIGN   8915>>ASSIGN   9091>>ASSIGN   9122>>ASSIGN   9221>>ASSIGN
      9237>>ASSIGN   9268>>ASSIGN   9439>>ASSIGN   9597>>ASSIGN   9671>>ASSIGN   9877>>ASSIGN   9910>>ASSIGN
      9941>>ASSIGN   9961>>ASSIGN  10034>>ASSIGN  10078>>ASSIGN  10227>>ASSIGN
NOCUHL
      8905**LABEL    8905--CALLALT
NOCUTL
      8868**LABEL    8868--CALLALT
NOPE
      9052**LABEL    9027--CALLALT
NOSCRATCHES
      9459**LABEL    9368--GOTO     9438--CALLALT
NOT_TAPE_END
      8026**DCL      9345<<ASSIGN   9346>>DOWHILE  9349<<ASSIGN   9392<<ASSIGN   9398<<ASSIGN  10004<<ASSIGN
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:332  
     10005>>DOWHILE 10009<<ASSIGN
NOUTL
      8728**LABEL    8729--CALLALT
NO_NEXT_VOL
      9745**LABEL    9741--CALLALT
NUHL IN PROCEDURE FTL_PBNFS
      9859**DCL      9850--PROC     9900>>IF       9901<>CALL     9903<>CALL
NUM
      8008**DCL         9--PROC     8514--ENTRY    8529>>IF       8531>>ASSIGN   8553<<ASSIGN   8560--ENTRY
      8577<<ASSIGN   8586>>IF       8588<<ASSIGN   8588>>ASSIGN   8589>>DOWHILE  8606<<ASSIGN   8610<<ASSIGN
      8628--ENTRY    8728>>IF       8729<>CALL     8756--ENTRY    8867>>IF       8868<>CALL     9928--ENTRY
      9948>>ASSIGN   9954>>ASSIGN
ONE_WORD
      8049**DCL      8893<<ASSIGN   8909<<ASSIGN
RDLP
      9585**LABEL    9589--GOTO
RELLBLPOOL
      8948**LABEL    8807--CALLALT  8809--CALLALT  8820--CALLALT  8826--CALLALT  8845--CALLALT  8849--CALLALT
      8855--CALLALT  8876--CALLALT  8877--CALLALT  8878--CALLALT  8880--CALLALT  8884--CALLALT  8888--CALLALT
      8914--CALLALT  8919--CALLALT  8920--CALLALT  8921--CALLALT  8923--CALLALT  8929--CALLALT  8937--CALLALT
S$CU$
       232**DCL      9058>>IF       9306>>IF       9403>>IF
SAVFSN
      8027**DCL      8988<<ASSIGN   9012>>IF       9013<<ASSIGN   9017>>IF       9107>>IF       9111>>IF
      9112<<ASSIGN  10066<<CALLBLT 10081>>IF      10088>>IF      10101>>ASSIGN
SAVVOL
      8028**DCL      9014<<ASSIGN   9017>>IF       9107>>IF       9113<<ASSIGN  10068<<CALLBLT 10081>>IF
     10085<<ASSIGN
SECTFIND
      8029**DCL      9303<<ASSIGN   9428<<ASSIGN   9465>>IF       9470>>IF
SKIPS
      8030**DCL      9037>>IF       9056>>ASSIGN   9154<<ASSIGN   9162<<ASSIGN   9301<<ASSIGN   9330>>IF
      9333<<ASSIGN   9336>>IF       9350>>IF       9383<<ASSIGN   9390>>IF       9427<<ASSIGN   9436>>IF
      9438>>CALL     9948<<ASSIGN   9949>>IF       9952>>CALL
SN
      8035**DCL      8794--CALL     9741--CALL
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:333  
SSS$SYSTIME
      7974**DCL-ENT  8378--CALL
TEMP
      8031**DCL      8379<>CALL     8380<<ASSIGN   8380>>ASSIGN   8381>>CALL
THELBL
      8009**DCL         9--PROC     8330--ENTRY    8340>>ASSIGN   8349>>IF       8409>>ASSIGN   8514--ENTRY
      8546>>IF       8560--ENTRY    8628--ENTRY    8678<>CALL     8680<>CALL     8687<<ASSIGN   8711<<ASSIGN
      8714>>DOWHILE  8746<>CALL     8756--ENTRY    8827<<ASSIGN   8831>>IF       8852>>IF       8888<>CALL
      9692--ENTRY    9771>>IF       9826<<ASSIGN   9829>>IF       9928--ENTRY   10049--ENTRY   10070>>DOWHILE
     10160<<ASSIGN  10161>>IF      10161>>IF
THISFSECT
      8033**DCL      9026<<CALLBLT  9035>>IF       9336>>IF       9390>>IF       9422>>IF       9427>>ASSIGN
      9530<<CALLBLT  9532<<ASSIGN   9532>>ASSIGN   9536<<ASSIGN   9604<<CALLBLT  9605>>IF      10081>>IF
     10085>>ASSIGN
THISFSN
      8034**DCL      9011<<CALLBLT  9013>>ASSIGN   9017>>IF       9023>>ASSIGN   9034>>ASSIGN   9053>>ASSIGN
      9067<<ASSIGN   9107>>IF       9241>>IF       9242>>ASSIGN   9246>>IF       9254>>IF       9271>>IF
      9329>>IF       9389>>IF       9402>>ASSIGN   9420>>IF       9528<<CALLBLT  9529>>ASSIGN   9535<<ASSIGN
      9602<<CALLBLT  9603>>ASSIGN   9684>>ASSIGN  10025<<CALLBLT 10026>>ASSIGN  10039<<CALLBLT 10040>>ASSIGN
     10081>>IF      10088>>IF
UHL$ IN PROCEDURE FTL_PBNFS
      9860**DCL      9850--PROC     9893--IF       9901<>CALL
ULBL$
      8010**DCL         9--PROC     8628--ENTRY    8756--ENTRY    8902--IF       8909>>ASSIGN   8921<>CALL
      8937<>CALL
UMT$JDATE
      7975**DCL-ENT  8382--CALL
UNUM
      8011**DCL         9--PROC     8628--ENTRY    8665>>IF       8756--ENTRY    8903>>IF       8905<>CALL
VLP_ULBL.NUM#
      5813**DCL      8531--ASSIGN   8534<<ASSIGN   8538>>IF       8538>>ASSIGN   8554>>IF       8554<<ASSIGN
      8588--ASSIGN   8608<<ASSIGN
VLP_ULBL.ULBL#
      5813**DCL      5813--REDEF    8531--ASSIGN   8548--CALL     8588--ASSIGN   8590--CALL     8600--ASSIGN
VLP_ULBL.ULBLFIELD.LABELID
      5814**DCL      8546>>IF       8593>>IF       8593>>IF       8593>>IF
PL6.E3A0      #001=FTL$LBLTAP File=FTL$LBLTAP.:E05TSI                            TUE 07/29/97 17:41 Page:334  
VOLORDER
      9447**LABEL    9331--GOTO     9337--GOTO     9351--GOTO     9396--GOTO
VOLOUT
      8941**LABEL    8794--CALLALT
XUD$UTS_ADJ_25TH
      7941**DCL-ENT  8381--CALL
XUD$UTS_DIFF_SEC
      7923**DCL-ENT  8379--CALL
