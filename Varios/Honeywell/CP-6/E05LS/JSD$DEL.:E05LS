VERSION E05

PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:1    
        1        1        /*M*   JSD$DEL    ROUTINES FOR REMOVING A USER FROM THE SYSTEM */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=8,IND=5,ENU=0,ECU=0    */
        8        8        JSD$DELUSR: PROC;
        9        9                                                /**/
       10       10    1   DCL RNDFLG BIT(1);
       11       11    1   DCL ABNFLG BIT(1);
       12       12    1   DCL N SBIN;
       13       13    1   DCL LASTPG SBIN;
       14       14    1   DCL SID SBIN;
       15       15    1   DCL ERR SBIN;
       16       16    1   DCL PPTR$ PTR;
       17       17    1   DCL DCT$ PTR;
       18       18    1   DCL JOB$ REDEF DCT$ PTR;
       19       19    1   DCL 1 JOB$R REDEF DCT$,
       20       20    1         2 DISP UBIN HALF HALIGNED,
       21       21    1         2 *    UBIN HALF HALIGNED;
       22       22                                                /**/
       23       23    1   DCL NIS$ABIO ENTRY(1);                  /* Routine to delete q'd i/o requests */
       24       24    1   DCL MMG$SFVP ENTRY(5) ALTRET;      /* Routine to free seg-relative V.P.'S     */
       25       25    1   DCL JSR$RUNDOWN ENTRY ALTRET;
       26       26    1   DCL JSN$1SSSF ENTRY;
       27       27    1   DCL JSU$RELMEM ENTRY(1);                /* Routine to free iseg & data segs   */
       28       28    1   DCL JSU$RELFSEG ENTRY;                  /* Routine to free file buffers       */
       29       29    1   DCL JSU$DECRUC ENTRY;                   /* Routine to decrement uc for A.P.'S */
       30       30    1   DCL SSR$REG ENTRY(3) ALTRET;  /* Routine to report (delete) event on user     */
       31       31    1   DCL SSS$BLOCK ENTRY;
       32       32    1   DCL TDP$RSETCPUJ ENTRY;       /* Routine to reset TDCPUJ flag at end of job*/
       33       33    1   DCL NKU$DRQ ENTRY ALTRET;               /* Routine to insure line disconnect  */
       34       34    1   DCL NKU$UCCLS ENTRY ALTRET;
       35       35    1   DCL KUW$WRITE ENTRY(3) ALTRET;          /* Write the central systems comgroup */
       36       36    1   DCL FMQ$RELSTARF ENTRY;                 /* Release all star files             */
       37       37    1   DCL FRP$RLALL ENTRY;
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:2    
       38       38    1   DCL FSX$ENDJOB ENTRY;                   /* Stream close                       */
       39       39    1   DCL FSD$ENDJOB ENTRY ALTRET;
       40       40    1   DCL FSD$XFLUSH ENTRY ALTRET;
       41       41    1   DCL M$MCLOSE ENTRY(1) ALTRET;
       42       42    1   DCL SSC$MONTIMR ENTRY(3);
       43       43                                                /**/
       44       44        %PLIST;
       45       45        /**/
       46       46        %INCLUDE B$JIT_C;
       47      360                %B$JIT0;
       48      449                %U$JIT1;
       49      523                %M$JIT2;
       50      533                %F$JIT3;
       51      538                %S$JIT4;
       52      544                %J$JIT5;
       53      632                %A$JIT6X;
       54      635        %INCLUDE B$USER;                        /* User table definitions             */
       55      851        %B$USERREFS;
       56      855        %INCLUDE B$P;
       57      939        %INCLUDE B_STRINGS_C;                   /* System string substitutions        */
       58     1068        %INCLUDE B_SEGIDS_C;                    /* Segid definitions                  */
       59     1607        %INCLUDE CP_6_SUBS;
       60     2147        %INCLUDE F$DCB;
       61     2196        %INCLUDE SS_SCHED_R;                    /* Scheduler data references          */
       62     2239        %INCLUDE SS_SCHED_C;                    /* Scheduler event definitions        */
       63     2472        %INCLUDE CP_6;                          /* Used for close fpt                 */
       64     8031        %INCLUDE FOO_MAC_C;
       65     8779        %INCLUDE HF_LOCK_C;
       66     8793        %INCLUDE JC_MACRO_C;
       67     8907        %INCLUDE JG_EVID_C;
       68     9132        %INCLUDE FOS_SUBS_C;
       69     9149        %INCLUDE FOS_DATA_R;
       70     9159        %INCLUDE JM$STRUCT;
       71     9904        %JM_IF (FPTN=JM$IF,STCLASS=BASED);
       72    10062        %INCLUDE JMA_DATA_R;
       73    10071        %INCLUDE JM_CNTRL_R;
       74    10960        %JM_PART (FPTN=JM$PT,STCLASS=BASED);
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:3    
       75    11015        %INCLUDE NI_DATA_R;                     /* IO DATA REFS                       */
       76    11452                %NI$DCT (NAME=NI$DCT,STCLASS="BASED(DCT$)");
       77    11500                                                /**/
       78    11501        %FPT_CLOSE(FPTN=CLOSE_UC,
       79    11502                   DCB=M$UC,
       80    11503                   STCLASS=CONSTANT);
       81    11545
       82    11546    1   DCL J_PHASE2FLG UBIN SYMREF;
       83    11547
       84    11548    1   DCL B$JIT$ PTR SYMREF READONLY;
       85    11549    1   DCL B$M$UC$ PTR SYMREF READONLY;
       86    11550    1   DCL S_CUN SBIN SYMREF;
       87    11551    1   DCL NK_MXLOCAL SBIN SYMREF;             /* MAX LOCAL DCTX                     */
       88    11552
       89    11553    1   DCL J_MBS CHAR(8) SYMREF READONLY DALIGNED;
       90    11554    1   DCL J_OUTSYM CHAR(8) SYMREF READONLY DALIGNED;
       91    11555    1   DCL J_SLUG CHAR(8) SYMREF READONLY DALIGNED;
       92    11556
       93    11557        %INCLUDE JG_GHOSTS_C;
       94    11647        %JM_CITE (FPTN=JM$CITE,STCLASS=AUTO);
       95    11697        %FO_CITE (FPTN=FO$CITE,STCLASS=AUTO);
       96    11756        %JC_CITE (FPTN=JC_PCMP,TYP=PCMP,COD=JCEV_PCMP#,USR=JG_PIG#  ,STCLASS=CONSTANT);
       97    11806        %JC_CITE (FPTN=JC_SOFF,TYP=OFF ,COD=JCEV_OFF# ,USR=JG_SUPER#,STCLASS=CONSTANT);
       98    11856        %JC_CITE (FPTN=JC_DOFF,TYP=OFF ,COD=JCEV_OFF# ,USR=JG_DINGO#,STCLASS=CONSTANT);
       99    11906
      100    11907        %SUB B$P=B$P$->B$P;
      101    11908        %SUB B$U=S$CU$->B$U;
      102    11909        %EJECT;
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:4    
      103    11910        /*F*   NAME:   JSD$DELUSR                                          */
      104    11911        /*F*   PURPOSE: To remove a normal, healthy user from the system as */
      105    11912        /*,*           the final part of the logoff process.               */
      106    11913    1           RNDFLG = %YES#;                 /* Do jit-dependent rundown           */
      107    11914    1           ABNFLG = %NO#;                  /* Not an abnormal delete             */
      108    11915    1           GOTO JSD$DELETE;
      109    11916                                                /**/
      110    11917        /*F*   NAME:   JSD$ZAPUSR                                          */
      111    11918        /*F*   PURPOSE: To delete a user whose context is suspected of     */
      112    11919        /*,*           being too damaged to delete gracefully.             */
      113    11920    1   JSD$ZAPUSR: ENTRY;
      114    11921    1           RNDFLG = %YES#;                 /* Do jit-dependent rundown           */
      115    11922    1           ABNFLG = %YES#;                 /* Set abnormal delete flag           */
      116    11923    1           GOTO JSD$DELETE;
      117    11924                                                /**/
      118    11925        %EJECT;
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:5    
      119    11926    1   JSD$DELETE:;
      120    11927    1           CALL JSN$1SSSF;                 /*Flush safe-store                    */
      121    11928    1           IF ~ ABNFLG
      122    11929    2           THEN DO;
      123    11930    2                CALL JSR$RUNDOWN ALTRET(XX);
      124    11931        /* Don't disconnect a disconnected line!!! */
      125    11932    2                IF B$M$UC$->F$DCB.LDCTX ~= 0
      126    11933    3                THEN DO;
      127    11934    3                     CALL NKU$DRQ ALTRET(CONT); /* Insure line is disconnected   */
      128    11935    3   CONT:             IF (B$JIT.MODE = %M_INT#) AND (B$M$UC$->F$DCB.ASN = %DEVICE#)
      129    11936    3                     THEN CALL NKU$UCCLS ALTRET(CONT3);
      130    11937    3                     END;
      131    11938    2   CONT3:       CALL M$MCLOSE(CLOSE_UC) ALTRET(CONT2);
      132    11939    2   CONT2:       ; END;
      133    11940        /* Close out all symbiont stuff for this guy unless he's a batch
      134    11941           job being aborted for rerun, in which case we won't delete his
      135    11942           input symbiont file.                                            */
      136    11943    1           CALL FSX$ENDJOB;
      137    11944    1           CALL FSD$XFLUSH ALTRET(NOPE1);
      138    11945    1   NOPE1:  IF B$JIT.MODE = %M_BATCH#
      139    11946    1           THEN
      140    11947    2   MBS_STUFF: DO;
      141    11948    2                PPTR$ = JM_PPTR$(B$JIT.PNR);
      142    11949                          /*    Find our job frame in
      143    11950                           *    MBS's tables.  Mark
      144    11951                           *    it 'GOING OFF' so MBS
      145    11952                           *    will know that the RERUN
      146    11953                           *    keyin won't work on us anymore.
      147    11954                           *    Then unless the rerun flag is
      148    11955                           *    set, go delete our input symbiont
      149    11956                           *    file.
      150    11957                           */
      151    11958    2                CALL SSS$BLOCK;            /* Get onto MBS's CPU                 */
      152    11959    2                JOB$=PPTR$->JM$PT.JOB$;
      153    11960    3   FIND_MBSJOB: DO WHILE (JOB$ ~= ADDR(NIL));
      154    11961    3                     JOB$=PINCRW(FOS_SEG$(FOSS_MBSJOB#),JOB$R.DISP);
      155    11962    3                     IF JOB$->JM$IF.SYSID = B$JIT.SYSID
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:6    
      156    11963    4                     THEN DO;
      157    11964    4                          IF JOB$->JM$IF.FLG.KRERUN
      158    11965    4                          THEN EXIT MBS_STUFF;
      159    11966    5                          ELSE DO;
      160    11967    5                               JOB$->JM$IF.OFFIP='1'B;
      161    11968    5                               EXIT FIND_MBSJOB;
      162    11969    5                               END;
      163    11970    4                          END;
      164    11971    3                     JOB$=JOB$->JM$IF.NXTJ$;
      165    11972    3                     END FIND_MBSJOB;
      166    11973    2                CALL FSD$ENDJOB ALTRET(NOPE2);
      167    11974    2                END MBS_STUFF;
      168    11975    1   NOPE2:
      169    11976        /*    Release star files    */
      170    11977    1           IF RNDFLG AND NOT ABNFLG
      171    11978    1           THEN CALL FMQ$RELSTARF;
      172    11979        /**/
      173    11980        /* Release all resources allocated to this USER... */
      174    11981    1           CALL FRP$RLALL;
      175    11982        /* Remove association with any command PROCESSOR: */
      176    11983    1           IF B$U.FLG.CPIC
      177    11984    1           THEN B$P.UC(B$U.ACP) = B$P.UC(B$U.ACP) -1;
      178    11985        /* If user had done any T & D opens then remove his user number
      179    11986           from the DCTs.                                                  */
      180    11987    2           IF B$U.FLG & %(%U_TDOPPERM|%U_TDNOPERM) THEN DO;
      181    11988    3                DO N=1 TO NK_MXLOCAL;
      182    11989    3                     DCT$=N$DCT$(N);
      183    11990    3                     IF NI$DCT.TDUSER#=S_CUN THEN NI$DCT.TDUSER#=0;
      184    11991    3                     END;
      185    11992    2                END;
      186    11993        /* Now, release all memory except the jit and hjit pages           */
      187    11994    1           IF RNDFLG                       /* Do only if the jit is ok           */
      188    11995    2           THEN DO;
      189    11996    2                CALL JSU$RELMEM(1);        /* Free isr & all data segs           */
      190    11997    2                CALL JSU$RELFSEG;          /* Free all buffer segment pages      */
      191    11998    2                N = B$JIT.PCROS;           /* Prepare to free all of roseg       */
      192    11999    2                LASTPG = N - 1;
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:7    
      193    12000    2                SID = BITBIN(%ROSID);
      194    12001    2                CALL MMG$SFVP(%USERWSQ,SID,LASTPG,N,ERR) ALTRET(XX);
      195    12002    2   XX:          END;
      196    12003    1           IF S_TDCPUF = S_CUN
      197    12004    1           THEN CALL TDP$RSETCPUJ;         /* Turn off specific CPU request      */
      198    12005    1           CALL JSU$DECRUC;           /* Decr. Use counts for associated procs   */
      199    12006        /*
      200    12007               If user is online and is not a hungup saved user, then
      201    12008               reset all line table information.
      202    12009        */
      203    12010        /**/
      204    12011        /* Run down all I/O */
      205    12012        /**/
      206    12013    2           DO WHILE(B$U.MF~=0);
      207    12014    2                CALL SSR$REG(%SS_QMF);
      208    12015    2                END;
      209    12016        /*
      210    12017                If user is batch, kick the batch scheduler and outsym.
      211    12018        */
      212    12019    1           IF B$JIT.MODE = %M_BATCH#
      213    12020    2           THEN DO;
      214    12021    2                JM$CITE = '0'B;
      215    12022    2                JM$CITE.CODE  = JMEV_JOFF#;
      216    12023    2                JM$CITE.SYSID = B$JIT.SYSID;
      217    12024    2                JM$CITE.SUBCODE = B$JIT.STEPCC;
      218    12025    2                JM$CITE.JOFF_INFO.FRS = BITBIN(B$JIT.USRRNST);
      219    12026    2                CALL KUW$WRITE(JM$CITE,SIZEC(JM$CITE),J_MBS);
      220    12027    2                FO$CITE='0'B;
      221    12028    2                FO$CITE.CODE=FOEV_JOFF#;
      222    12029    2                FO$CITE.SYSID=B$JIT.SYSID;
      223    12030    2                CALL KUW$WRITE (FO$CITE,SIZEC(FO$CITE),J_OUTSYM);
      224    12031    2                END;
      225    12032        /**/
      226    12033        /*       Do strange things for the startup process if this
      227    12034                 is a special ghost going off
      228    12035        */
      229    12036        /**/
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:8    
      230    12037    2           DO CASE (S_CUN);
      231    12038
      232    12039    2            CASE (JG_SUPER#);
      233    12040    2              CALL KUW$WRITE (JC_SOFF,SIZEC(JC_SOFF),J_SLUG);
      234    12041
      235    12042    2            CASE (JG_DINGO#);
      236    12043                          /*    Start watching now for completion
      237    12044                           *    of startup phase 2
      238    12045                           */
      239    12046    2              CALL KUW$WRITE (JC_DOFF,SIZEC(JC_DOFF),J_SLUG);
      240    12047    2              CALL SSC$MONTIMR (100,ENTADDR(JSD$PHASE2),0);
      241    12048
      242    12049    2              END;
      243    12050        /**/
      244    12051        /* Finally, call the execution scheduler to finish deleting this   */
      245    12052        /* USER: Free jit & hjit pages and reset necessary user table info.*/
      246    12053        /**/
      247    12054    1           CALL SSR$REG(%SS_DU);           /* Will never return                  */
      248    12055        /**/
      249    12056        /**/
      250    12057        /*F* NAME:         JSD$PHASE2
      251    12058             PURPOSE:      To watch for completion of startup phase 2
      252    12059             DESCRIPTION:  Startup phase 2 is complete when DINGO has
      253    12060                           gone off, and the rest of the running ghosts
      254    12061                           except SLUG have gone quiescent.  JSD$PHASE2
      255    12062                           is goosed by JSD$DEL when DINGO goes off
      256    12063                           (or by OCA$KMISC if DINGO is not started),
      257    12064                           and waits for the others to go idle, via
      258    12065                           MONTIMR.  When they do, SLUG is sent the
      259    12066                           'phase complete' message.
      260    12067        */
      261    12068    1   JSD$PHASE2: ENTRY;
      262    12069        /**/
      263    12070                %LOCK (G=S_SCHDGATE);
      264    12073    1           IF B$USRT$->B$USER.US(JG_KEYIN#) ~= %SS_SW
      265    12074    1             AND B$USRT$->B$USER.US(JG_KEYIN#) ~= %SS_SIOWC
      266    12075    2           THEN DO;
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:9    
      267    12076    2   P2WAIT:      ;
      268    12077    2                J_PHASE2FLG=0;
      269    12078    2   P2WAIT1:     ;
      270    12079                     %UNLOCK (G=S_SCHDGATE);
      271    12082    2                CALL SSC$MONTIMR (100,ENTADDR(JSD$PHASE2),0);
      272    12083    2                RETURN;
      273    12084    2                END;
      274    12085    1           IF B$USRT$->B$USER.US(JG_PIG#) ~= %SS_SIOWC THEN GOTO P2WAIT;
      275    12086    1           IF J_PHASE2FLG = 0
      276    12087    2           THEN DO;
      277    12088    2                J_PHASE2FLG=1;
      278    12089    2                GOTO P2WAIT1;
      279    12090    2                END;
      280    12091        /**/                                    /* DONE                               */
      281    12092                %UNLOCK (G=S_SCHDGATE);
      282    12095    1           CALL KUW$WRITE (JC_PCMP,SIZEC(JC_PCMP),J_SLUG);
      283    12096    1           RETURN;
      284    12097    1   END JSD$DELUSR;

PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:10   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   JM_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   JMA_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   JM$STRUCT.:E05TOU  is referenced.
   FOS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOS_SUBS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   JC_MACRO_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FOO_MAC_C.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure JSD$DELUSR.

   Procedure JSD$DELUSR requires 325 words for executable code.
   Procedure JSD$DELUSR requires 26 words of local(AUTO) storage.

    No errors detected in file JSD$DEL.:E05TSI    .
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:11   

PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:12   

 Object Unit name= JSD$DELUSR                                 File name= JSD$DEL.:E05TOU
 UTS= JUL 29 '97 23:42:19.96 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     37     45  JSD$DELUSR
    2   Proc  even  none   325    505  JSD$DELUSR
    3  RoData even  none    25     31  JSD$DELUSR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        0  JSD$DELUSR
     2      6                  yes      Std        0  JSD$ZAPUSR
     2    424                  yes      Std        0  JSD$PHASE2
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:13   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 JSN$1SSSF
 yes     yes           Std       0 JSR$RUNDOWN
 yes     yes           Std       0 NKU$DRQ
 yes     yes           Std       3 SSR$REG
         yes           Std       1 HFC$UNLOCK
         yes           Std       3 SSC$MONTIMR
 yes     yes           Std       0 NKU$UCCLS
         yes           Std       0 FSX$ENDJOB
 yes     yes           Std       0 FSD$XFLUSH
         yes           Std       0 FMQ$RELSTARF
         yes           Std       1 JSU$RELMEM
         yes           Std       0 JSU$RELFSEG
         yes           Std       0 SSS$BLOCK
 yes     yes           Std       0 FSD$ENDJOB
         yes           Std       1 HFC$LOCK
         yes           Std       0 JSU$DECRUC
 yes     yes           Std       3 KUW$WRITE
         yes           Std       0 TDP$RSETCPUJ
 yes     yes           Std       1 M$MCLOSE
         yes           Std       0 FRP$RLALL
 yes     yes           Std       5 MMG$SFVP
         yes           Std       0 JSD$PHASE2
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:14   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     S$CU$                                 B$USRT$                               B$P$
     S_TDCPUF                              S_SCHDGATE                            M$UC
     FOS_SEG$                              JM_PPTR$                              N$DCT$$
     N$FQ$                                 NI$FQ$                                NI$IBUF$
     NI$RP$                                J_PHASE2FLG                      r    B$JIT$
r    B$M$UC$                               S_CUN                                 NK_MXLOCAL
r    J_MBS                            r    J_OUTSYM                         r    J_SLUG
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:15   


        1        1        /*M*   JSD$DEL    ROUTINES FOR REMOVING A USER FROM THE SYSTEM */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=8,IND=5,ENU=0,ECU=0    */
        8        8        JSD$DELUSR: PROC;

      8  2 000000   000000 700200 xent  JSD$DELUSR   TSX0  ! X66_AUTO_0
         2 000001   000032 000000                    ZERO    26,0

        9        9                                                /**/
       10       10    1   DCL RNDFLG BIT(1);
       11       11    1   DCL ABNFLG BIT(1);
       12       12    1   DCL N SBIN;
       13       13    1   DCL LASTPG SBIN;
       14       14    1   DCL SID SBIN;
       15       15    1   DCL ERR SBIN;
       16       16    1   DCL PPTR$ PTR;
       17       17    1   DCL DCT$ PTR;
       18       18    1   DCL JOB$ REDEF DCT$ PTR;
       19       19    1   DCL 1 JOB$R REDEF DCT$,
       20       20    1         2 DISP UBIN HALF HALIGNED,
       21       21    1         2 *    UBIN HALF HALIGNED;
       22       22                                                /**/
       23       23    1   DCL NIS$ABIO ENTRY(1);                  /* Routine to delete q'd i/o requests */
       24       24    1   DCL MMG$SFVP ENTRY(5) ALTRET;      /* Routine to free seg-relative V.P.'S     */
       25       25    1   DCL JSR$RUNDOWN ENTRY ALTRET;
       26       26    1   DCL JSN$1SSSF ENTRY;
       27       27    1   DCL JSU$RELMEM ENTRY(1);                /* Routine to free iseg & data segs   */
       28       28    1   DCL JSU$RELFSEG ENTRY;                  /* Routine to free file buffers       */
       29       29    1   DCL JSU$DECRUC ENTRY;                   /* Routine to decrement uc for A.P.'S */
       30       30    1   DCL SSR$REG ENTRY(3) ALTRET;  /* Routine to report (delete) event on user     */
       31       31    1   DCL SSS$BLOCK ENTRY;
       32       32    1   DCL TDP$RSETCPUJ ENTRY;       /* Routine to reset TDCPUJ flag at end of job*/
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:16   
       33       33    1   DCL NKU$DRQ ENTRY ALTRET;               /* Routine to insure line disconnect  */
       34       34    1   DCL NKU$UCCLS ENTRY ALTRET;
       35       35    1   DCL KUW$WRITE ENTRY(3) ALTRET;          /* Write the central systems comgroup */
       36       36    1   DCL FMQ$RELSTARF ENTRY;                 /* Release all star files             */
       37       37    1   DCL FRP$RLALL ENTRY;
       38       38    1   DCL FSX$ENDJOB ENTRY;                   /* Stream close                       */
       39       39    1   DCL FSD$ENDJOB ENTRY ALTRET;
       40       40    1   DCL FSD$XFLUSH ENTRY ALTRET;
       41       41    1   DCL M$MCLOSE ENTRY(1) ALTRET;
       42       42    1   DCL SSC$MONTIMR ENTRY(3);
       43       43                                                /**/
       44       44        %PLIST;
       45       45        /**/
       46       46        %INCLUDE B$JIT_C;
       47      360                %B$JIT0;
       48      449                %U$JIT1;
       49      523                %M$JIT2;
       50      533                %F$JIT3;
       51      538                %S$JIT4;
       52      544                %J$JIT5;
       53      632                %A$JIT6X;
       54      635        %INCLUDE B$USER;                        /* User table definitions             */
       55      851        %B$USERREFS;
       56      855        %INCLUDE B$P;
       57      939        %INCLUDE B_STRINGS_C;                   /* System string substitutions        */
       58     1068        %INCLUDE B_SEGIDS_C;                    /* Segid definitions                  */
       59     1607        %INCLUDE CP_6_SUBS;
       60     2147        %INCLUDE F$DCB;
       61     2196        %INCLUDE SS_SCHED_R;                    /* Scheduler data references          */
       62     2239        %INCLUDE SS_SCHED_C;                    /* Scheduler event definitions        */
       63     2472        %INCLUDE CP_6;                          /* Used for close fpt                 */
       64     8031        %INCLUDE FOO_MAC_C;
       65     8779        %INCLUDE HF_LOCK_C;
       66     8793        %INCLUDE JC_MACRO_C;
       67     8907        %INCLUDE JG_EVID_C;
       68     9132        %INCLUDE FOS_SUBS_C;
       69     9149        %INCLUDE FOS_DATA_R;
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:17   
       70     9159        %INCLUDE JM$STRUCT;
       71     9904        %JM_IF (FPTN=JM$IF,STCLASS=BASED);
       72    10062        %INCLUDE JMA_DATA_R;
       73    10071        %INCLUDE JM_CNTRL_R;
       74    10960        %JM_PART (FPTN=JM$PT,STCLASS=BASED);
       75    11015        %INCLUDE NI_DATA_R;                     /* IO DATA REFS                       */
       76    11452                %NI$DCT (NAME=NI$DCT,STCLASS="BASED(DCT$)");
       77    11500                                                /**/
       78    11501        %FPT_CLOSE(FPTN=CLOSE_UC,
       79    11502                   DCB=M$UC,
       80    11503                   STCLASS=CONSTANT);
       81    11545
       82    11546    1   DCL J_PHASE2FLG UBIN SYMREF;
       83    11547
       84    11548    1   DCL B$JIT$ PTR SYMREF READONLY;
       85    11549    1   DCL B$M$UC$ PTR SYMREF READONLY;
       86    11550    1   DCL S_CUN SBIN SYMREF;
       87    11551    1   DCL NK_MXLOCAL SBIN SYMREF;             /* MAX LOCAL DCTX                     */
       88    11552
       89    11553    1   DCL J_MBS CHAR(8) SYMREF READONLY DALIGNED;
       90    11554    1   DCL J_OUTSYM CHAR(8) SYMREF READONLY DALIGNED;
       91    11555    1   DCL J_SLUG CHAR(8) SYMREF READONLY DALIGNED;
       92    11556
       93    11557        %INCLUDE JG_GHOSTS_C;
       94    11647        %JM_CITE (FPTN=JM$CITE,STCLASS=AUTO);
       95    11697        %FO_CITE (FPTN=FO$CITE,STCLASS=AUTO);
       96    11756        %JC_CITE (FPTN=JC_PCMP,TYP=PCMP,COD=JCEV_PCMP#,USR=JG_PIG#  ,STCLASS=CONSTANT);
       97    11806        %JC_CITE (FPTN=JC_SOFF,TYP=OFF ,COD=JCEV_OFF# ,USR=JG_SUPER#,STCLASS=CONSTANT);
       98    11856        %JC_CITE (FPTN=JC_DOFF,TYP=OFF ,COD=JCEV_OFF# ,USR=JG_DINGO#,STCLASS=CONSTANT);
       99    11906
      100    11907        %SUB B$P=B$P$->B$P;
      101    11908        %SUB B$U=S$CU$->B$U;
      102    11909        %EJECT;
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:18   
      103    11910        /*F*   NAME:   JSD$DELUSR                                          */
      104    11911        /*F*   PURPOSE: To remove a normal, healthy user from the system as */
      105    11912        /*,*           the final part of the logoff process.               */
      106    11913    1           RNDFLG = %YES#;                 /* Do jit-dependent rundown           */

  11913  2 000002   400000 236003                    LDQ     -131072,DU
         2 000003   200003 756100                    STQ     RNDFLG,,AUTO

      107    11914    1           ABNFLG = %NO#;                  /* Not an abnormal delete             */

  11914  2 000004   200004 450100                    STZ     ABNFLG,,AUTO

      108    11915    1           GOTO JSD$DELETE;

  11915  2 000005   000014 710000 2                  TRA     JSD$DELETE

      109    11916                                                /**/
      110    11917        /*F*   NAME:   JSD$ZAPUSR                                          */
      111    11918        /*F*   PURPOSE: To delete a user whose context is suspected of     */
      112    11919        /*,*           being too damaged to delete gracefully.             */
      113    11920    1   JSD$ZAPUSR: ENTRY;

  11920  2 000006   000000 700200 xent  JSD$ZAPUSR   TSX0  ! X66_AUTO_0
         2 000007   000032 000000                    ZERO    26,0

      114    11921    1           RNDFLG = %YES#;                 /* Do jit-dependent rundown           */

  11921  2 000010   400000 236003                    LDQ     -131072,DU
         2 000011   200003 756100                    STQ     RNDFLG,,AUTO

      115    11922    1           ABNFLG = %YES#;                 /* Set abnormal delete flag           */

  11922  2 000012   200004 756100                    STQ     ABNFLG,,AUTO

      116    11923    1           GOTO JSD$DELETE;

  11923  2 000013   000014 710000 2                  TRA     JSD$DELETE
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:19   

  11922  2 000014                       JSD$DELETE   null
      117    11924                                                /**/
      118    11925        %EJECT;
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:20   
      119    11926    1   JSD$DELETE:;
      120    11927    1           CALL JSN$1SSSF;                 /*Flush safe-store                    */

  11927  2 000014   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000015   000000 701000 xent               TSX1    JSN$1SSSF
         2 000016   000000 011000                    NOP     0

      121    11928    1           IF ~ ABNFLG

  11928  2 000017   200004 236100                    LDQ     ABNFLG,,AUTO
         2 000020   400000 376003                    ANQ     -131072,DU
         2 000021   400000 676003                    ERQ     -131072,DU
         2 000022   000055 600000 2                  TZE     CONT2

      122    11929    2           THEN DO;

      123    11930    2                CALL JSR$RUNDOWN ALTRET(XX);

  11930  2 000023   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000024   000000 701000 xent               TSX1    JSR$RUNDOWN
         2 000025   000255 702000 2                  TSX2    XX

      124    11931        /* Don't disconnect a disconnected line!!! */
      125    11932    2                IF B$M$UC$->F$DCB.LDCTX ~= 0

  11932  2 000026   000000 470400 xsym               LDP0    B$M$UC$
         2 000027   000051 220100                    LDX0    41,,PR0
         2 000030   000051 600000 2                  TZE     CONT3

      126    11933    3                THEN DO;

      127    11934    3                     CALL NKU$DRQ ALTRET(CONT); /* Insure line is disconnected   */

  11934  2 000031   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000032   000000 701000 xent               TSX1    NKU$DRQ
         2 000033   000034 702000 2                  TSX2    CONT

PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:21   
      128    11935    3   CONT:             IF (B$JIT.MODE = %M_INT#) AND (B$M$UC$->F$DCB.ASN = %DEVICE#)

  11935  2 000034   000000 470400 xsym  CONT         LDP0    B$JIT$
         2 000035   000000 236100                    LDQ     0,,PR0
         2 000036   740000 376003                    ANQ     -16384,DU
         2 000037   140000 116003                    CMPQ    49152,DU
         2 000040   000051 601000 2                  TNZ     CONT3
         2 000041   000000 471400 xsym               LDP1    B$M$UC$
         2 000042   100032 236100                    LDQ     26,,PR1
         2 000043   777000 376007                    ANQ     -512,DL
         2 000044   003000 116007                    CMPQ    1536,DL
         2 000045   000051 601000 2                  TNZ     CONT3

      129    11936    3                     THEN CALL NKU$UCCLS ALTRET(CONT3);

  11936  2 000046   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000047   000000 701000 xent               TSX1    NKU$UCCLS
         2 000050   000051 702000 2                  TSX2    CONT3

      130    11937    3                     END;

      131    11938    2   CONT3:       CALL M$MCLOSE(CLOSE_UC) ALTRET(CONT2);

  11938  2 000051   000000 630400 3     CONT3        EPPR0   0
         2 000052   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000053   000000 701000 xent               TSX1    M$MCLOSE
         2 000054   000055 702000 2                  TSX2    CONT2

  11938  2 000055                       CONT2        null
      132    11939    2   CONT2:       ; END;

      133    11940        /* Close out all symbiont stuff for this guy unless he's a batch
      134    11941           job being aborted for rerun, in which case we won't delete his
      135    11942           input symbiont file.                                            */
      136    11943    1           CALL FSX$ENDJOB;

  11943  2 000055   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:22   
         2 000056   000000 701000 xent               TSX1    FSX$ENDJOB
         2 000057   000000 011000                    NOP     0

      137    11944    1           CALL FSD$XFLUSH ALTRET(NOPE1);

  11944  2 000060   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000061   000000 701000 xent               TSX1    FSD$XFLUSH
         2 000062   000063 702000 2                  TSX2    NOPE1

      138    11945    1   NOPE1:  IF B$JIT.MODE = %M_BATCH#

  11945  2 000063   000000 470400 xsym  NOPE1        LDP0    B$JIT$
         2 000064   000000 236100                    LDQ     0,,PR0
         2 000065   740000 376003                    ANQ     -16384,DU
         2 000066   040000 116003                    CMPQ    16384,DU
         2 000067   000132 601000 2                  TNZ     NOPE2

      139    11946    1           THEN
      140    11947    2   MBS_STUFF: DO;

  11947  2 000070                       MBS_STUFF    null
      141    11948    2                PPTR$ = JM_PPTR$(B$JIT.PNR);

  11948  2 000070   000302 236100                    LDQ     194,,PR0
         2 000071   000033 772000                    QRL     27
         2 000072   000000 236006 xsym               LDQ     JM_PPTR$,QL
         2 000073   200011 756100                    STQ     PPTR$,,AUTO

      142    11949                          /*    Find our job frame in
      143    11950                           *    MBS's tables.  Mark
      144    11951                           *    it 'GOING OFF' so MBS
      145    11952                           *    will know that the RERUN
      146    11953                           *    keyin won't work on us anymore.
      147    11954                           *    Then unless the rerun flag is
      148    11955                           *    set, go delete our input symbiont
      149    11956                           *    file.
      150    11957                           */
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:23   
      151    11958    2                CALL SSS$BLOCK;            /* Get onto MBS's CPU                 */

  11958  2 000074   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000075   000000 701000 xent               TSX1    SSS$BLOCK
         2 000076   000000 011000                    NOP     0

      152    11959    2                JOB$=PPTR$->JM$PT.JOB$;

  11959  2 000077   200011 470500                    LDP0    PPTR$,,AUTO
         2 000100   000006 236100                    LDQ     6,,PR0
         2 000101   200012 756100                    STQ     DCT$,,AUTO

      153    11960    3   FIND_MBSJOB: DO WHILE (JOB$ ~= ADDR(NIL));

  11960  2 000102   000125 710000 2     FIND_MBSJOB  TRA     s:11972

      154    11961    3                     JOB$=PINCRW(FOS_SEG$(FOSS_MBSJOB#),JOB$R.DISP);

  11961  2 000103   200012 236100                    LDQ     DCT$,,AUTO
         2 000104   777777 376003                    ANQ     -1,DU
         2 000105   000000 036000 xsym               ADLQ    FOS_SEG$
         2 000106   200012 756100                    STQ     DCT$,,AUTO

      155    11962    3                     IF JOB$->JM$IF.SYSID = B$JIT.SYSID

  11962  2 000107   000000 470400 xsym               LDP0    B$JIT$
         2 000110   200012 471500                    LDP1    DCT$,,AUTO
         2 000111   100014 236100                    LDQ     12,,PR1
         2 000112   000000 676100                    ERQ     0,,PR0
         2 000113   777777 376007                    ANQ     -1,DL
         2 000114   000123 601000 2                  TNZ     s:11971

      156    11963    4                     THEN DO;

      157    11964    4                          IF JOB$->JM$IF.FLG.KRERUN

  11964  2 000115   100013 236100                    LDQ     11,,PR1
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:24   
         2 000116   001000 316007                    CANQ    512,DL
         2 000117   000132 601000 2                  TNZ     NOPE2

      158    11965    4                          THEN EXIT MBS_STUFF;
      159    11966    5                          ELSE DO;

      160    11967    5                               JOB$->JM$IF.OFFIP='1'B;

  11967  2 000120   400000 236003                    LDQ     -131072,DU
         2 000121   100011 756100                    STQ     9,,PR1

      161    11968    5                               EXIT FIND_MBSJOB;

  11968  2 000122   000127 710000 2                  TRA     s:11973

      162    11969    5                               END;
      163    11970    4                          END;
      164    11971    3                     JOB$=JOB$->JM$IF.NXTJ$;

  11971  2 000123   100001 236100                    LDQ     1,,PR1
         2 000124   200012 756100                    STQ     DCT$,,AUTO

      165    11972    3                     END FIND_MBSJOB;

  11972  2 000125   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000126   000103 601000 2                  TNZ     s:11961

      166    11973    2                CALL FSD$ENDJOB ALTRET(NOPE2);

  11973  2 000127   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000130   000000 701000 xent               TSX1    FSD$ENDJOB
         2 000131   000132 702000 2                  TSX2    NOPE2

      167    11974    2                END MBS_STUFF;

      168    11975    1   NOPE2:
      169    11976        /*    Release star files    */
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:25   
      170    11977    1           IF RNDFLG AND NOT ABNFLG

  11977  2 000132   200003 234100       NOPE2        SZN     RNDFLG,,AUTO
         2 000133   000141 605000 2                  TPL     s:11981
         2 000134   200004 234100                    SZN     ABNFLG,,AUTO
         2 000135   000141 604000 2                  TMI     s:11981

      171    11978    1           THEN CALL FMQ$RELSTARF;

  11978  2 000136   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000137   000000 701000 xent               TSX1    FMQ$RELSTARF
         2 000140   000000 011000                    NOP     0

      172    11979        /**/
      173    11980        /* Release all resources allocated to this USER... */
      174    11981    1           CALL FRP$RLALL;

  11981  2 000141   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000142   000000 701000 xent               TSX1    FRP$RLALL
         2 000143   000000 011000                    NOP     0

      175    11982        /* Remove association with any command PROCESSOR: */
      176    11983    1           IF B$U.FLG.CPIC

  11983  2 000144   000000 470400 xsym               LDP0    S$CU$
         2 000145   000000 236100                    LDQ     0,,PR0
         2 000146   020000 316003                    CANQ    8192,DU
         2 000147   000167 600000 2                  TZE     s:11987

      177    11984    1           THEN B$P.UC(B$U.ACP) = B$P.UC(B$U.ACP) -1;

  11984  2 000150   000006 236100                    LDQ     6,,PR0
         2 000151   000022 772000                    QRL     18
         2 000152   000777 376007                    ANQ     511,DL
         2 000153   000021 402007                    MPY     17,DL
         2 000154   000001 736000                    QLS     1
         2 000155   000000 620006                    EAX0    0,QL
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:26   
         2 000156   000006 236100                    LDQ     6,,PR0
         2 000157   000022 772000                    QRL     18
         2 000160   000777 376007                    ANQ     511,DL
         2 000161   000021 402007                    MPY     17,DL
         2 000162   000001 736000                    QLS     1
         2 000163   000000 471400 xsym               LDP1    B$P$
         2 000164   100000 235106                    LDA     0,QL,PR1
         2 000165   000001 135007                    SBLA    1,DL
         2 000166   100000 755110                    STA     0,X0,PR1

      178    11985        /* If user had done any T & D opens then remove his user number
      179    11986           from the DCTs.                                                  */
      180    11987    2           IF B$U.FLG & %(%U_TDOPPERM|%U_TDNOPERM) THEN DO;

  11987  2 000167   000000 470400 xsym               LDP0    S$CU$
         2 000170   000000 236100                    LDQ     0,,PR0
         2 000171   000044 376000 1                  ANQ     JC_DOFF+2
         2 000172   000216 600000 2                  TZE     s:11994

      181    11988    3                DO N=1 TO NK_MXLOCAL;

  11988  2 000173   000001 235007                    LDA     1,DL
         2 000174   200005 755100                    STA     N,,AUTO
         2 000175   000213 710000 2                  TRA     s:11991+1

      182    11989    3                     DCT$=N$DCT$(N);

  11989  2 000176   000000 470400 xsym               LDP0    N$DCT$$
         2 000177   200005 720100                    LXL0    N,,AUTO
         2 000200   000000 236110                    LDQ     0,X0,PR0
         2 000201   200012 756100                    STQ     DCT$,,AUTO

      183    11990    3                     IF NI$DCT.TDUSER#=S_CUN THEN NI$DCT.TDUSER#=0;

  11990  2 000202   200012 471500                    LDP1    DCT$,,AUTO
         2 000203   100027 236100                    LDQ     23,,PR1
         2 000204   000022 772000                    QRL     18
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:27   
         2 000205   000777 376007                    ANQ     511,DL
         2 000206   000000 116000 xsym               CMPQ    S_CUN
         2 000207   000212 601000 2                  TNZ     s:11991

  11990  2 000210   000000 236003                    LDQ     0,DU
         2 000211   100027 552120                    STBQ    23,'20'O,PR1

      184    11991    3                     END;

  11991  2 000212   200005 054100                    AOS     N,,AUTO
         2 000213   200005 236100                    LDQ     N,,AUTO
         2 000214   000000 116000 xsym               CMPQ    NK_MXLOCAL
         2 000215   000176 604400 2                  TMOZ    s:11989

      185    11992    2                END;

      186    11993        /* Now, release all memory except the jit and hjit pages           */
      187    11994    1           IF RNDFLG                       /* Do only if the jit is ok           */

  11994  2 000216   200003 234100                    SZN     RNDFLG,,AUTO
         2 000217   000255 605000 2                  TPL     XX

      188    11995    2           THEN DO;

      189    11996    2                CALL JSU$RELMEM(1);        /* Free isr & all data segs           */

  11996  2 000220   000001 630400 3                  EPPR0   1
         2 000221   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000222   000000 701000 xent               TSX1    JSU$RELMEM
         2 000223   000000 011000                    NOP     0

      190    11997    2                CALL JSU$RELFSEG;          /* Free all buffer segment pages      */

  11997  2 000224   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000225   000000 701000 xent               TSX1    JSU$RELFSEG
         2 000226   000000 011000                    NOP     0

PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:28   
      191    11998    2                N = B$JIT.PCROS;           /* Prepare to free all of roseg       */

  11998  2 000227   000000 470400 xsym               LDP0    B$JIT$
         2 000230   000203 236100                    LDQ     131,,PR0
         2 000231   000022 772000                    QRL     18
         2 000232   200005 756100                    STQ     N,,AUTO

      192    11999    2                LASTPG = N - 1;

  11999  2 000233   000001 136007                    SBLQ    1,DL
         2 000234   200006 756100                    STQ     LASTPG,,AUTO

      193    12000    2                SID = BITBIN(%ROSID);

  12000  2 000235   006003 235007                    LDA     3075,DL
         2 000236   200007 755100                    STA     SID,,AUTO

      194    12001    2                CALL MMG$SFVP(%USERWSQ,SID,LASTPG,N,ERR) ALTRET(XX);

  12001  2 000237   200010 631500                    EPPR1   ERR,,AUTO
         2 000240   200030 451500                    STP1    FO$CITE+8,,AUTO
         2 000241   200005 633500                    EPPR3   N,,AUTO
         2 000242   200027 453500                    STP3    FO$CITE+7,,AUTO
         2 000243   200006 634500                    EPPR4   LASTPG,,AUTO
         2 000244   200026 454500                    STP4    FO$CITE+6,,AUTO
         2 000245   200007 635500                    EPPR5   SID,,AUTO
         2 000246   200025 455500                    STP5    FO$CITE+5,,AUTO
         2 000247   000002 236000 3                  LDQ     2
         2 000250   200024 756100                    STQ     FO$CITE+4,,AUTO
         2 000251   200024 630500                    EPPR0   FO$CITE+4,,AUTO
         2 000252   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000253   000000 701000 xent               TSX1    MMG$SFVP
         2 000254   000255 702000 2                  TSX2    XX

      195    12002    2   XX:          END;

  12002  2 000255                       XX           null
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:29   
      196    12003    1           IF S_TDCPUF = S_CUN

  12003  2 000255   000000 236000 xsym               LDQ     S_TDCPUF
         2 000256   000000 116000 xsym               CMPQ    S_CUN
         2 000257   000263 601000 2                  TNZ     s:12005

      197    12004    1           THEN CALL TDP$RSETCPUJ;         /* Turn off specific CPU request      */

  12004  2 000260   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000261   000000 701000 xent               TSX1    TDP$RSETCPUJ
         2 000262   000000 011000                    NOP     0

      198    12005    1           CALL JSU$DECRUC;           /* Decr. Use counts for associated procs   */

  12005  2 000263   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000264   000000 701000 xent               TSX1    JSU$DECRUC
         2 000265   000000 011000                    NOP     0

      199    12006        /*
      200    12007               If user is online and is not a hungup saved user, then
      201    12008               reset all line table information.
      202    12009        */
      203    12010        /**/
      204    12011        /* Run down all I/O */
      205    12012        /**/
      206    12013    2           DO WHILE(B$U.MF~=0);

  12013  2 000266   000000 470400 xsym               LDP0    S$CU$
         2 000267   000006 236100                    LDQ     6,,PR0
         2 000270   777000 316003                    CANQ    -512,DU
         2 000271   000302 600000 2                  TZE     s:12019

      207    12014    2                CALL SSR$REG(%SS_QMF);

  12014  2 000272   000003 630400 3                  EPPR0   3
         2 000273   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000274   000000 701000 xent               TSX1    SSR$REG
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:30   
         2 000275   000000 011000                    NOP     0

      208    12015    2                END;

  12015  2 000276   000000 470400 xsym               LDP0    S$CU$
         2 000277   000006 236100                    LDQ     6,,PR0
         2 000300   777000 316003                    CANQ    -512,DU
         2 000301   000272 601000 2                  TNZ     s:12014

      209    12016        /*
      210    12017                If user is batch, kick the batch scheduler and outsym.
      211    12018        */
      212    12019    1           IF B$JIT.MODE = %M_BATCH#

  12019  2 000302   000000 471400 xsym               LDP1    B$JIT$
         2 000303   100000 236100                    LDQ     0,,PR1
         2 000304   740000 376003                    ANQ     -16384,DU
         2 000305   040000 116003                    CMPQ    16384,DU
         2 000306   000362 601000 2                  TNZ     s:12037

      213    12020    2           THEN DO;

      214    12021    2                JM$CITE = '0'B;

  12021  2 000307   000100 100400                    MLR     fill='000'O
         2 000310   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000311   200013 000024                    ADSC9   JM$CITE,,AUTO            cn=0,n=20

      215    12022    2                JM$CITE.CODE  = JMEV_JOFF#;

  12022  2 000312   000002 220003                    LDX0    2,DU
         2 000313   200013 740100                    STX0    JM$CITE,,AUTO

      216    12023    2                JM$CITE.SYSID = B$JIT.SYSID;

  12023  2 000314   100000 721100                    LXL1    0,,PR1
         2 000315   200013 441100                    SXL1    JM$CITE,,AUTO
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:31   

      217    12024    2                JM$CITE.SUBCODE = B$JIT.STEPCC;

  12024  2 000316   100316 236100                    LDQ     206,,PR1
         2 000317   000022 772000                    QRL     18
         2 000320   000777 376007                    ANQ     511,DL
         2 000321   200014 756100                    STQ     JM$CITE+1,,AUTO

      218    12025    2                JM$CITE.JOFF_INFO.FRS = BITBIN(B$JIT.USRRNST);

  12025  2 000322   100145 236100                    LDQ     101,,PR1
         2 000323   000011 772000                    QRL     9
         2 000324   000777 376007                    ANQ     511,DL
         2 000325   200017 756100                    STQ     JM$CITE+4,,AUTO

      219    12026    2                CALL KUW$WRITE(JM$CITE,SIZEC(JM$CITE),J_MBS);

  12026  2 000326   000005 236000 3                  LDQ     5
         2 000327   200026 756100                    STQ     FO$CITE+6,,AUTO
         2 000330   000006 236000 3                  LDQ     6
         2 000331   200025 756100                    STQ     FO$CITE+5,,AUTO
         2 000332   200013 633500                    EPPR3   JM$CITE,,AUTO
         2 000333   200024 453500                    STP3    FO$CITE+4,,AUTO
         2 000334   200024 630500                    EPPR0   FO$CITE+4,,AUTO
         2 000335   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000336   000000 701000 xent               TSX1    KUW$WRITE
         2 000337   000000 011000                    NOP     0

      220    12027    2                FO$CITE='0'B;

  12027  2 000340   000100 100400                    MLR     fill='000'O
         2 000341   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000342   200020 000012                    ADSC9   FO$CITE,,AUTO            cn=0,n=10

      221    12028    2                FO$CITE.CODE=FOEV_JOFF#;

  12028  2 000343   000005 220003                    LDX0    5,DU
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:32   
         2 000344   200020 740100                    STX0    FO$CITE,,AUTO

      222    12029    2                FO$CITE.SYSID=B$JIT.SYSID;

  12029  2 000345   000000 470400 xsym               LDP0    B$JIT$
         2 000346   000000 721100                    LXL1    0,,PR0
         2 000347   200020 441100                    SXL1    FO$CITE,,AUTO

      223    12030    2                CALL KUW$WRITE (FO$CITE,SIZEC(FO$CITE),J_OUTSYM);

  12030  2 000350   000010 236000 3                  LDQ     8
         2 000351   200026 756100                    STQ     FO$CITE+6,,AUTO
         2 000352   000011 236000 3                  LDQ     9
         2 000353   200025 756100                    STQ     FO$CITE+5,,AUTO
         2 000354   200020 631500                    EPPR1   FO$CITE,,AUTO
         2 000355   200024 451500                    STP1    FO$CITE+4,,AUTO
         2 000356   200024 630500                    EPPR0   FO$CITE+4,,AUTO
         2 000357   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000360   000000 701000 xent               TSX1    KUW$WRITE
         2 000361   000000 011000                    NOP     0

      224    12031    2                END;

      225    12032        /**/
      226    12033        /*       Do strange things for the startup process if this
      227    12034                 is a special ghost going off
      228    12035        */
      229    12036        /**/
      230    12037    2           DO CASE (S_CUN);

  12037  2 000362   000000 235000 xsym               LDA     S_CUN
         2 000363   000014 135007                    SBLA    12,DL
         2 000364   000003 115007                    CMPA    3,DL
         2 000365   000367 602005 2                  TNC     s:12037+5,AL
         2 000366   000417 710000 2                  TRA     s:12054
         2 000367   000377 710000 2                  TRA     s:12046
         2 000370   000417 710000 2                  TRA     s:12054
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:33   
         2 000371   000372 710000 2                  TRA     s:12040

      231    12038
      232    12039    2            CASE (JG_SUPER#);

      233    12040    2              CALL KUW$WRITE (JC_SOFF,SIZEC(JC_SOFF),J_SLUG);

  12040  2 000372   000012 630400 3                  EPPR0   10
         2 000373   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000374   000000 701000 xent               TSX1    KUW$WRITE
         2 000375   000000 011000                    NOP     0
         2 000376   000417 710000 2                  TRA     s:12054

      234    12041
      235    12042    2            CASE (JG_DINGO#);

      236    12043                          /*    Start watching now for completion
      237    12044                           *    of startup phase 2
      238    12045                           */
      239    12046    2              CALL KUW$WRITE (JC_DOFF,SIZEC(JC_DOFF),J_SLUG);

  12046  2 000377   000015 630400 3                  EPPR0   13
         2 000400   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000401   000000 701000 xent               TSX1    KUW$WRITE
         2 000402   000000 011000                    NOP     0

      240    12047    2              CALL SSC$MONTIMR (100,ENTADDR(JSD$PHASE2),0);

  12047  2 000403   000424 636000 2                  EAQ     s:12068
         2 000404   200024 756100                    STQ     FO$CITE+4,,AUTO
         2 000405   000021 236000 3                  LDQ     17
         2 000406   200027 756100                    STQ     FO$CITE+7,,AUTO
         2 000407   200024 630500                    EPPR0   FO$CITE+4,,AUTO
         2 000410   200026 450500                    STP0    FO$CITE+6,,AUTO
         2 000411   000022 236000 3                  LDQ     18
         2 000412   200025 756100                    STQ     FO$CITE+5,,AUTO
         2 000413   200025 630500                    EPPR0   FO$CITE+5,,AUTO
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:34   
         2 000414   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000415   000000 701000 xent               TSX1    SSC$MONTIMR
         2 000416   000000 011000                    NOP     0

      241    12048
      242    12049    2              END;

      243    12050        /**/
      244    12051        /* Finally, call the execution scheduler to finish deleting this   */
      245    12052        /* USER: Free jit & hjit pages and reset necessary user table info.*/
      246    12053        /**/
      247    12054    1           CALL SSR$REG(%SS_DU);           /* Will never return                  */

  12054  2 000417   000024 630400 3                  EPPR0   20
         2 000420   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000421   000000 701000 xent               TSX1    SSR$REG
         2 000422   000000 011000                    NOP     0
         2 000423   000426 710000 2                  TRA     s:12071

      248    12055        /**/
      249    12056        /**/
      250    12057        /*F* NAME:         JSD$PHASE2
      251    12058             PURPOSE:      To watch for completion of startup phase 2
      252    12059             DESCRIPTION:  Startup phase 2 is complete when DINGO has
      253    12060                           gone off, and the rest of the running ghosts
      254    12061                           except SLUG have gone quiescent.  JSD$PHASE2
      255    12062                           is goosed by JSD$DEL when DINGO goes off
      256    12063                           (or by OCA$KMISC if DINGO is not started),
      257    12064                           and waits for the others to go idle, via
      258    12065                           MONTIMR.  When they do, SLUG is sent the
      259    12066                           'phase complete' message.
      260    12067        */
      261    12068    1   JSD$PHASE2: ENTRY;

  12068  2 000424   000000 700200 xent  JSD$PHASE2   TSX0  ! X66_AUTO_0
         2 000425   000032 000000                    ZERO    26,0

PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:35   
      262    12069        /**/
      263    12070                %LOCK (G=S_SCHDGATE);

  12071  2 000426   000025 630400 3                  EPPR0   21
         2 000427   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000430   000000 701000 xent               TSX1    HFC$LOCK
         2 000431   000000 011000                    NOP     0

      264    12073    1           IF B$USRT$->B$USER.US(JG_KEYIN#) ~= %SS_SW

  12073  2 000432   000000 470400 xsym               LDP0    B$USRT$
         2 000433   000051 236100                    LDQ     41,,PR0
         2 000434   770000 376003                    ANQ     -4096,DU
         2 000435   210000 116003                    CMPQ    69632,DU
         2 000436   000463 600000 2                  TZE     s:12085
         2 000437   170000 116003                    CMPQ    61440,DU
         2 000440   000463 600000 2                  TZE     s:12085

      265    12074    1             AND B$USRT$->B$USER.US(JG_KEYIN#) ~= %SS_SIOWC
      266    12075    2           THEN DO;

  12074  2 000441                       P2WAIT       null
      267    12076    2   P2WAIT:      ;
      268    12077    2                J_PHASE2FLG=0;

  12077  2 000441   000000 450000 xsym               STZ     J_PHASE2FLG

  12077  2 000442                       P2WAIT1      null
      269    12078    2   P2WAIT1:     ;
      270    12079                     %UNLOCK (G=S_SCHDGATE);

  12080  2 000442   000025 630400 3                  EPPR0   21
         2 000443   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000444   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000445   000000 011000                    NOP     0

      271    12082    2                CALL SSC$MONTIMR (100,ENTADDR(JSD$PHASE2),0);
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:36   

  12082  2 000446   000424 636000 2                  EAQ     s:12068
         2 000447   200024 756100                    STQ     FO$CITE+4,,AUTO
         2 000450   000021 236000 3                  LDQ     17
         2 000451   200027 756100                    STQ     FO$CITE+7,,AUTO
         2 000452   200024 630500                    EPPR0   FO$CITE+4,,AUTO
         2 000453   200026 450500                    STP0    FO$CITE+6,,AUTO
         2 000454   000022 236000 3                  LDQ     18
         2 000455   200025 756100                    STQ     FO$CITE+5,,AUTO
         2 000456   200025 630500                    EPPR0   FO$CITE+5,,AUTO
         2 000457   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000460   000000 701000 xent               TSX1    SSC$MONTIMR
         2 000461   000000 011000                    NOP     0

      272    12083    2                RETURN;

  12083  2 000462   000000 702200 xent               TSX2  ! X66_ARET

      273    12084    2                END;
      274    12085    1           IF B$USRT$->B$USER.US(JG_PIG#) ~= %SS_SIOWC THEN GOTO P2WAIT;

  12085  2 000463   000171 236100                    LDQ     121,,PR0
         2 000464   770000 376003                    ANQ     -4096,DU
         2 000465   170000 116003                    CMPQ    61440,DU
         2 000466   000441 601000 2                  TNZ     P2WAIT

      275    12086    1           IF J_PHASE2FLG = 0

  12086  2 000467   000000 235000 xsym               LDA     J_PHASE2FLG
         2 000470   000474 601000 2                  TNZ     s:12093

      276    12087    2           THEN DO;

      277    12088    2                J_PHASE2FLG=1;

  12088  2 000471   000001 235007                    LDA     1,DL
         2 000472   000000 755000 xsym               STA     J_PHASE2FLG
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:37   

      278    12089    2                GOTO P2WAIT1;

  12089  2 000473   000442 710000 2                  TRA     P2WAIT1

      279    12090    2                END;
      280    12091        /**/                                    /* DONE                               */
      281    12092                %UNLOCK (G=S_SCHDGATE);

  12093  2 000474   000025 630400 3                  EPPR0   21
         2 000475   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000476   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000477   000000 011000                    NOP     0

      282    12095    1           CALL KUW$WRITE (JC_PCMP,SIZEC(JC_PCMP),J_SLUG);

  12095  2 000500   000026 630400 3                  EPPR0   22
         2 000501   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000502   000000 701000 xent               TSX1    KUW$WRITE
         2 000503   000000 011000                    NOP     0

      283    12096    1           RETURN;

  12096  2 000504   000000 702200 xent               TSX2  ! X66_ARET

CLOSE_UC
 Sect OctLoc
   1     000   000003 777640   000032 006000   000000 177640   000000 006014    ................
   1     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     030*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   1     034   000220 000000   000000 000000                                    ........

JC_PCMP
 Sect OctLoc
   1     036   000000 000001   000007 ******                                    ........

JC_SOFF
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:38   
 Sect OctLoc
   1     040   000000 000002   000016 ******                                    ........

JC_DOFF
 Sect OctLoc
   1     042   000000 000002   000014 ******                                    ........

(unnamed)
 Sect OctLoc
   1     044   001400 000000                                                    ....

(unnamed)
 Sect OctLoc
   3     000   000000 006000   000003 006000   000012 006000   000005 006000    ................
   3     004   000000 000024   000000 006000   000004 006000   000000 000014    ................
   3     010   000000 006000   000007 006000   000040 006000   000012 006000    ......... ......
   3     014   000000 006000   000042 006000   000012 006000   000000 006000    ....."..........
   3     020   000000 000144   000002 006000   000020 006000   000000 000041    ...d...........!
   3     024   000023 006000   000000 006000   000036 006000   000012 006000    ................
   3     030   000000 006000                                                    ....
      284    12097    1   END JSD$DELUSR;

PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:39   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   JM_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   JMA_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   JM$STRUCT.:E05TOU  is referenced.
   FOS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOS_SUBS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   JC_MACRO_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FOO_MAC_C.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure JSD$DELUSR.
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:40   

 **** Variables and constants ****

  ****  Section 001 RoData JSD$DELUSR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 CLOSE_UC                  42-0-0/w STRC(54)    r     1 JC_DOFF
    36-0-0/w STRC(54)    r     1 JC_PCMP                   40-0-0/w STRC(54)    r     1 JC_SOFF

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/b BIT         r     1 ABNFLG                    12-0-0/w PTR         r     1 DCT$
    10-0-0/w SBIN        r     1 ERR                       20-0-0/w STRC(90)    r     1 FO$CITE
    13-0-0/w STRC(180)   r     1 JM$CITE                   12-0-0/w PTR         r     1 JOB$
    12-0-0/w STRC        r     1 JOB$R                      6-0-0/w SBIN        r     1 LASTPG
     5-0-0/w SBIN        r     1 N                         11-0-0/w PTR         r     1 PPTR$
     3-0-0/b BIT         r     1 RNDFLG                     7-0-0/w SBIN        r     1 SID

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$UC$
     0-0-0/w PTR         r     1 B$P$                       0-0-0/w PTR         r     1 B$USRT$
     0-0-0/w PTR         r     1 FOS_SEG$(0:0)
     0-0-0/w PTR         r     1 JM_PPTR$(0:15)
     0-0-0/d CHAR(8)     r     1 J_MBS                      0-0-0/d CHAR(8)     r     1 J_OUTSYM
     0-0-0/w UBIN        r     1 J_PHASE2FLG                0-0-0/d CHAR(8)     r     1 J_SLUG
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w SBIN        r     1 NK_MXLOCAL
     0-0-0/w PTR         r     1 S$CU$                      0-0-0/w SBIN        r     1 S_CUN
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:41   
     0-0-0/b BIT (72)    r     1 S_SCHDGATE                 0-0-0/w SBIN        r     1 S_TDCPUF

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(1224)  r     1 B$P(0:0)
     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/w STRC(576)   r     1 B$USER(0:0)
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w ASTR(1665)  r     1 JM$IF
     0-0-0/w STRC(684)   r     1 JM$PT                      0-0-0N  NULL        r     1 M$UC
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/w STRC(1332)  r     1 NI$DCT


   Procedure JSD$DELUSR requires 325 words for executable code.
   Procedure JSD$DELUSR requires 26 words of local(AUTO) storage.

    No errors detected in file JSD$DEL.:E05TSI    .
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:42   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:43   
          MINI XREF LISTING

ABNFLG
        11**DCL     11914<<ASSIGN  11922<<ASSIGN  11928>>IF      11977>>IF
B$DO.ECCINFO
       786**DCL       787--REDEF
B$JIT.CPFLAGS1.SLEAZE
       460**DCL       460--REDEF
B$JIT.ERR.MID
       367**DCL       367--REDEF
B$JIT.JRESPEAK
       528**DCL       529--REDEF
B$JIT.MODE
       361**DCL     11935>>IF      11945>>IF      12019>>IF
B$JIT.PCROS
       525**DCL     11998>>ASSIGN
B$JIT.PNR
       541**DCL       541--REDEF   11948>>ASSIGN
B$JIT.STEPCC
       593**DCL     12024>>ASSIGN
B$JIT.SYSID
       366**DCL     11962>>IF      12023>>ASSIGN  12029>>ASSIGN
B$JIT.USRRNST
       502**DCL     12025>>ASSIGN
B$JIT$
     11548**DCL       361--IMP-PTR 11935>>IF      11945>>IF      11948>>ASSIGN  11962>>IF      11998>>ASSIGN
     12019>>IF      12023>>ASSIGN  12024>>ASSIGN  12025>>ASSIGN  12029>>ASSIGN
B$M$UC$
     11549**DCL     11932>>IF      11935>>IF
B$P.UC
       864**DCL     11984<<ASSIGN  11984>>ASSIGN
B$P$
       917**DCL     11984>>ASSIGN  11984>>ASSIGN
B$U.ACP
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:44   
       742**DCL     11984>>ASSIGN  11984>>ASSIGN
B$U.FLG
       652**DCL     11987>>IF
B$U.FLG.CPIC
       658**DCL     11983>>IF
B$U.MF
       741**DCL     12013>>DOWHILE
B$U.MISC
       765**DCL       766--REDEF
B$USER.MISC
       841**DCL       842--REDEF
B$USER.US
       828**DCL     12073>>IF      12073>>IF      12085>>IF
B$USRT$
       853**DCL     12073>>IF      12073>>IF      12085>>IF
CLOSE_UC
     11526**DCL     11938<>CALL
CLOSE_UC.SN_
     11526**DCL     11526--REDEF
CLOSE_UC.UTL_
     11527**DCL     11527--REDEF
CLOSE_UC.V
     11531**DCL     11526--DCLINIT
CLOSE_UC.V.EXPIRE#
     11541**DCL     11541--REDEF
CLOSE_UC.V.TYPE#
     11539**DCL     11539--REDEF
CLOSE_UC.V.XTNSIZE#
     11536**DCL     11536--REDEF   11538--REDEF
CONT
     11935**LABEL   11934--CALLALT
CONT2
     11938**LABEL   11938--CALLALT
CONT3
     11938**LABEL   11936--CALLALT
DCT$
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:45   
        17**DCL        18--REDEF      19--REDEF   11461--IMP-PTR 11989<<ASSIGN  11990>>IF      11990>>ASSIGN
ERR
        15**DCL     12001<>CALL
F$DCB.ACTPOS
      2173**DCL      2173--REDEF
F$DCB.ARS
      2148**DCL      2148--REDEF
F$DCB.ASN
      2163**DCL     11935>>IF
F$DCB.ATTR
      2166**DCL      2167--REDEF
F$DCB.BORROW
      2181**DCL      2181--REDEF    2181--REDEF    2181--REDEF
F$DCB.DCBNAME.L
      2195**DCL      2195--IMP-SIZ
F$DCB.EOMCHAR
      2152**DCL      2152--REDEF
F$DCB.FLDID
      2176**DCL      2176--REDEF
F$DCB.FORM$
      2170**DCL      2170--REDEF
F$DCB.FSECT
      2186**DCL      2186--REDEF
F$DCB.FSN
      2163**DCL      2163--REDEF    2163--REDEF    2164--REDEF
F$DCB.HEADER$
      2169**DCL      2169--REDEF
F$DCB.IXTNSIZE
      2167**DCL      2167--REDEF
F$DCB.LASTSTA$
      2157**DCL      2157--REDEF
F$DCB.LDCTX
      2170**DCL     11932>>IF
F$DCB.LVL
      2182**DCL      2182--REDEF
F$DCB.NAME.C
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:46   
      2157**DCL      2157--REDEF
F$DCB.NOEOF
      2178**DCL      2178--REDEF
F$DCB.NRECS
      2168**DCL      2168--REDEF
F$DCB.NRECX
      2187**DCL      2187--REDEF
F$DCB.OHDR
      2179**DCL      2179--REDEF
F$DCB.ORG
      2162**DCL      2162--REDEF
F$DCB.PRECNO
      2185**DCL      2185--REDEF
F$DCB.RCSZ
      2190**DCL      2190--REDEF
F$DCB.RES
      2158**DCL      2158--REDEF
F$DCB.SETX
      2170**DCL      2170--REDEF
F$DCB.TAB$
      2169**DCL      2170--REDEF
F$DCB.TDA
      2184**DCL      2184--REDEF
F$DCB.WSN
      2159**DCL      2159--REDEF
FIND_MBSJOB
     11960**LABEL   11968--EXIT
FMQ$RELSTARF
        36**DCL-ENT 11978--CALL
FO$CITE
     11711**DCL     12027<<ASSIGN  12030<>CALL    12030--CALL
FO$CITE.BATCH
     11721**DCL     11724--REDEF   11728--REDEF
FO$CITE.CODE
     11715**DCL     12028<<ASSIGN
FO$CITE.NUM
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:47   
     11730**DCL     11733--REDEF
FO$CITE.SYSID
     11719**DCL     12029<<ASSIGN
FOS_SEG$
      9157**DCL      9157--REDEF   11961>>ASSIGN
FRP$RLALL
        37**DCL-ENT 11981--CALL
FSD$ENDJOB
        39**DCL-ENT 11973--CALL
FSD$XFLUSH
        40**DCL-ENT 11944--CALL
FSX$ENDJOB
        38**DCL-ENT 11943--CALL
HFC$LOCK
      8792**DCL-ENT 12071--CALL
HFC$UNLOCK
      8792**DCL-ENT 12080--CALL    12093--CALL
JC_DOFF
     11869**DCL     12046<>CALL    12046--CALL
JC_PCMP
     11769**DCL     12095<>CALL    12095--CALL
JC_SOFF
     11819**DCL     12040<>CALL    12040--CALL
JM$CITE
     11662**DCL     12021<<ASSIGN  12026<>CALL    12026--CALL
JM$CITE.ACCT
     11679**DCL     11682--REDEF
JM$CITE.CODE
     11667**DCL     12022<<ASSIGN
JM$CITE.JOFF_INFO.FRS
     11692**DCL     12025<<ASSIGN
JM$CITE.SUBCODE
     11673**DCL     12024<<ASSIGN
JM$CITE.SYSID
     11671**DCL     12023<<ASSIGN
JM$IF.FLG.KRERUN
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:48   
      9981**DCL     11964>>IF
JM$IF.JNL
     10047**DCL     10059--IMP-SIZ
JM$IF.NXTJ$
      9923**DCL     11971>>ASSIGN
JM$IF.OFFIP
      9949**DCL     11967<<ASSIGN
JM$IF.SYSID
      9991**DCL     11962>>IF
JM$PT.JOB$
     11007**DCL     11959>>ASSIGN
JM_PPTR$
     10070**DCL     11948>>ASSIGN
JOB$
        18**DCL     11959<<ASSIGN  11960>>DOWHILE 11961<<ASSIGN  11962>>IF      11964>>IF      11967>>ASSIGN
     11971<<ASSIGN  11971>>ASSIGN
JOB$R.DISP
        20**DCL     11961>>ASSIGN
JSD$DELETE
     11922**LABEL   11915--GOTO    11923--GOTO
JSD$PHASE2
     12068**ENTRY   12047--CALL    12082--CALL
JSN$1SSSF
        26**DCL-ENT 11927--CALL
JSR$RUNDOWN
        25**DCL-ENT 11930--CALL
JSU$DECRUC
        29**DCL-ENT 12005--CALL
JSU$RELFSEG
        28**DCL-ENT 11997--CALL
JSU$RELMEM
        27**DCL-ENT 11996--CALL
J_MBS
     11553**DCL     12026<>CALL
J_OUTSYM
     11554**DCL     12030<>CALL
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:49   
J_PHASE2FLG
     11546**DCL     12077<<ASSIGN  12086>>IF      12088<<ASSIGN
J_SLUG
     11555**DCL     12040<>CALL    12046<>CALL    12095<>CALL
KUW$WRITE
        35**DCL-ENT 12026--CALL    12030--CALL    12040--CALL    12046--CALL    12095--CALL
LASTPG
        13**DCL     11999<<ASSIGN  12001<>CALL
M$MCLOSE
        41**DCL-ENT 11938--CALL
MBS_STUFF
     11947**LABEL   11965--EXIT
MMG$SFVP
        24**DCL-ENT 12001--CALL
N
        12**DCL     11988<<DOINDEX 11989>>ASSIGN  11998<<ASSIGN  11999>>ASSIGN  12001<>CALL
N$DCT$
     11447**DCL     11989>>ASSIGN
N$DCT$$
     11313**DCL     11447--IMP-PTR 11989>>ASSIGN
N$FQ$
     11313**DCL     11448--IMP-PTR
N$REQ_INIT.BUFADDR
     11332**DCL     11333--REDEF   11333--REDEF
N$REQ_INIT.DLA.DRELADDR
     11324**DCL     11324--REDEF
N$REQ_INIT.DVE.EOMCHAR
     11361**DCL     11362--REDEF
N$REQ_INIT.EAINFO
     11355**DCL     11355--REDEF
N$REQ_INIT.EAINFOX
     11355**DCL     11356--REDEF
N$REQ_INIT.EVNTINFO
     11356**DCL     11356--REDEF
N$REQ_INIT.STATUS
     11337**DCL     11343--REDEF
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:50   
NI$DCT.DP
     11481**DCL     11488--REDEF   11491--REDEF   11492--REDEF   11494--REDEF   11494--REDEF   11495--REDEF
     11496--REDEF   11496--REDEF
NI$DCT.MPC.IOCHANX
     11489**DCL     11489--REDEF
NI$DCT.TDUSER#
     11480**DCL     11990>>IF      11990<<ASSIGN
NI$FQ$
     11373**DCL     11449--IMP-PTR
NI$IBUF$
     11373**DCL     11449--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
     11383**DCL     11384--REDEF   11384--REDEF
NI$IMXMBX_INIT.SIZE
     11385**DCL     11385--REDEF
NI$REQ_INIT.DCW
     11407**DCL     11410--REDEF
NI$REQ_INIT.DCW.TALLY
     11408**DCL     11408--REDEF
NI$REQ_INIT.IDCW.EXTA
     11410**DCL     11410--REDEF
NI$REQ_INIT.PCW
     11412**DCL     11416--REDEF
NI$REQ_INIT.SEEK
     11417**DCL     11418--REDEF   11419--REDEF
NI$RP$
     11421**DCL     11451--IMP-PTR
NI_MBX_INIT.DCW.CONTROL.AE
     11443**DCL     11443--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
     11439**DCL     11439--REDEF
NKU$DRQ
        33**DCL-ENT 11934--CALL
NKU$UCCLS
        34**DCL-ENT 11936--CALL
NK_MXLOCAL
PL6.E3A0      #001=JSD$DELUSR File=JSD$DEL.:E05TSI                               TUE 07/29/97 23:42 Page:51   
     11551**DCL     11988>>DOINDEX
NOPE1
     11945**LABEL   11944--CALLALT
NOPE2
     11977**LABEL   11973--CALLALT
P2WAIT
     12074**LABEL   12085--GOTO
P2WAIT1
     12077**LABEL   12089--GOTO
PPTR$
        16**DCL     11948<<ASSIGN  11959>>ASSIGN
RNDFLG
        10**DCL     11913<<ASSIGN  11921<<ASSIGN  11977>>IF      11994>>IF
S$CU$
       852**DCL     11983>>IF      11984>>ASSIGN  11984>>ASSIGN  11987>>IF      12013>>DOWHILE
SID
        14**DCL     12000<<ASSIGN  12001<>CALL
SSC$MONTIMR
        42**DCL-ENT 12047--CALL    12082--CALL
SSR$REG
        30**DCL-ENT 12014--CALL    12054--CALL
SSS$BLOCK
        31**DCL-ENT 11958--CALL
S_CUN
     11550**DCL     11990>>IF      12003>>IF      12037>>DOCASE
S_SCHDGATE
      2237**DCL     12071<>CALL    12080<>CALL    12093<>CALL
S_TDCPUF
      2227**DCL     12003>>IF
TDP$RSETCPUJ
        32**DCL-ENT 12004--CALL
XX
     12002**LABEL   11930--CALLALT 12001--CALLALT
