VERSION E05

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:1    
        1        1        /*M* KIP$PMME Handler for terminal control pmmes */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        /**/
        9        9        /**/
       10       10        KIP$PMME: PROC (PMMECOD);
       11       11        /**/
       12       12        %INCLUDE B$JIT;
       13      302        %INCLUDE CP_6;
       14      383        %INCLUDE F$DCB;
       15      432        %INCLUDE B$ROSEG;
       16      495        %INCLUDE B$USER;
       17      711        %B$USERREFS;
       18      715        %INCLUDE KL_SUPER_C;
       19     3617        %INCLUDE SS_SCHED_C;
       20     3850        %INCLUDE B_STRINGS_C;
       21     3979        %INCLUDE KV_PRMID_E;
       22     4153        %KV_PRMID_E;
       23     4309        %INCLUDE NK_VFC_C;
       24     4383        %INCLUDE CP_6_SUBS;
       25     4923        %INCLUDE F_FPTCODE_C;
       26     4959        %INCLUDE F_FMTCODE_C;
       27     4993        %INCLUDE KI$CP6V_C;
       28     5432        %INCLUDE F$CP6V_C;
       29     5658        %INCLUDE KI_SUBS_C;
       30     5794        %INCLUDE KI_MACROS_C;
       31     6402        %INCLUDE K_DATA_R;
       32     7113        %INCLUDE KV$VDO;
       33     8128        %KV_VDO_ALL_E;
       34     8207        %INCLUDE NK$LDCT;
       35     8309             %NK$LDCT;
       36     8355        %INCLUDE NK_LDCT_R;
       37     8364        %INCLUDE NK_SUBS;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:2    
       38     8389        %INCLUDE B$TABLES_C;
       39     8497             %B$XL_UPPER_UR;
       40     8501        %INCLUDE UD_EQU_E;
       41     8890        /**/
       42     8891        /**/
       43     8892        %KL_PHDR (NAME=KL$PHDR,STCLASS="BASED DALIGNED");
       44     8933        %FPT$PROMPT_V;
       45     8945        %FPT$EOM_V;
       46     8958        %FPT$TRMCTL_V (BASED="BASED(B$PS0$)");
       47     8969        %FPT$TRMPRG_V;
       48     8981        %FPT$TRMISC_V;
       49     8991        %VLP$FLDATR_V (BASED="BASED(B$PS3$)");
       50     9008        %VLP$TAB_V;
       51     9011        %VLP$TRMCTL_V;
       52     9032        %VLP$EOMTABLE_V;
       53     9046        %VLP$LINEATTR_V;
       54     9059        %VLP$TRMATTR_V;
       55     9081        %VLP$PLATEN_V;
       56     9097        %VLP$WINDOW_V;
       57     9119        %VLP$EDTCTL_V;
       58     9139        %FPT$SINPUT_V (BASED="BASED(B$PS0$)");
       59     9155        %FPT$MDFFLD_V (BASED="BASED(B$PS0$)");
       60     9171        %FPT$DCLFLD_V (BASED="BASED(B$PS0$)");
       61     9191        %FPT$SLCFLD_V (BASED="BASED(B$PS0$)");
       62     9207        %FPT$RLSFLD_V (BASED="BASED(B$PS0$)");
       63     9223        %FPT$ERASE_V (BASED="BASED(B$PS0$)");
       64     9239    1   DCL 1 VEC BASED DALIGNED,
       65     9240    1            2 * UBIN,2 P$ PTR;
       66     9241        %VLP_NAME (FPTN=PRO,STCLASS=CONSTANT,NAME=':PRO');
       67     9268        %FPT_READ (FPTN=RDPC,STCLASS=CONSTANT,KEYS=YES);
       68     9307        %KI_VCHRPMT (NAME=VCHRPMT,SIZE=VLPSIZ);
       69     9315        /**/
       70     9316    1   DCL PROBUF CHAR(4096) BASED;
       71     9317    1   DCL VCHRZ CHAR(VLPSIZ) BASED;
       72     9318    1   DCL 1 VTXTC BASED UNAL,
       73     9319    1            2 CNT UBIN BYTE UNAL,
       74     9320    1            2 TXT CHAR(VTXTC.CNT) UNAL;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:3    
       75     9321    1   DCL 1 VSIN BASED,
       76     9322    1            2 PFB UBIN BYTE CALIGNED,
       77     9323    1            2 RFU UBIN BYTE CALIGNED,
       78     9324    1            2 POS UBIN(18) CALIGNED,
       79     9325    1            2 POSL6 REDEF POS,
       80     9326    1                 3 T BIT(9), 3 * BIT(9),
       81     9327    1            2 POSL66 REDEF POS,
       82     9328    1                 3 * BIT(1),3 T BIT(9), 3 * BIT(8);
       83     9329    1   DCL 1 L6 BASED,
       84     9330    1            2 T UBIN BYTE CALIGNED;
       85     9331    1   DCL 1 L66 BASED,
       86     9332    1            2 T UBIN(10) CALIGNED;
       87     9333    1   DCL 1 VCHRET BASED,
       88     9334    1            2 PFB UBIN BYTE UNAL,
       89     9335    1            2 RFU BIT(10) UNAL,
       90     9336    1            2 SUPPHALT BIT(1) UNAL,
       91     9337    1            2 RSVD BIT(5) UNAL,
       92     9338    1            2 UNITS UBIN(2) UNAL,
       93     9339    1            2 TIMEOUT UBIN BYTE UNAL,
       94     9340    1            2 M CHAR(VLPSIZ) UNAL;
       95     9341    1   DCL 1 VCHRV BASED,
       96     9342    1            2 VFC CHAR(1) UNAL,
       97     9343    1            2 M CHAR(VLPSIZ) UNAL;
       98     9344        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:4    
       99     9345
      100     9346        /* AUTO and PARAMETER variables */
      101     9347
      102     9348    1   DCL PMMECOD UBIN PARAM;
      103     9349    1   DCL FPTCODE UBIN WORD;
      104     9350    1   DCL VLPSIZ UBIN WORD;
      105     9351    1   DCL 1 VLPSZB REDEF VLPSIZ,
      106     9352    1            2 * BIT(35) UNAL,
      107     9353    1            2 ODD UBIN(1) UNAL;
      108     9354    1   DCL PFB UBIN WORD;
      109     9355    1   DCL 1 TFCN REDEF PFB ALIGNED,
      110     9356    1            2 FCN UBIN(9) UNAL,
      111     9357    1            2 * UBIN(27) UNAL;
      112     9358    1   DCL TDCB$ REDEF PFB PTR;
      113     9359    1   DCL DCB$ PTR;
      114     9360    1   DCL LENGTH SBIN WORD;
      115     9361    1   DCL 1 TERR REDEF LENGTH,
      116     9362    1            2 FCGMID BIT(18) UNAL,
      117     9363    1            2 MON BIT(1) UNAL,
      118     9364    1            2 CODE UBIN(14) UNAL,
      119     9365    1            2 SEV UBIN(3) UNAL;
      120     9366    1   DCL WIDTH SBIN WORD;
      121     9367    1   DCL UCFLG SBIN WORD;
      122     9368    1   DCL MEDIA EPTR;
      123     9369    1   DCL SDCB$ PTR;
      124     9370    1   DCL BUF$ PTR;
      125     9371    1   DCL 1 IMPPROKEY,
      126     9372    1            2 KEYSZ UBIN BYTE UNAL,
      127     9373    1            2 KEY,
      128     9374    1                 3 NAME CHAR(11) UNAL,
      129     9375    1                 3 IMP# UBIN BYTE UNAL;
      130     9376    1   DCL 1 XPNAME REDEF IMPPROKEY,
      131     9377    1            2 CNT UBIN BYTE UNAL,
      132     9378    1            2 TXT CHAR (11),
      133     9379    1            2 * UBIN BYTE UNAL;
      134     9380    1   DCL IMP# UBIN;
      135     9381        %VLP_FLDATR (STCLASS=AUTO);
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:5    
      136     9407    1   DCL 1 TCTL ALIGNED,
      137     9408    1            2 T UBIN(9) UNAL,
      138     9409    1            2 L UBIN(9) UNAL,
      139     9410    1            2 LR REDEF L BIT(9) UNAL,
      140     9411    1            2 M CHAR(58) UNAL;
      141     9412        /* For M$PROMPT, large prompts will overlap into K$RWPARM */
      142     9413        %K$RWPARM (NAME=K$RWPARM,STCLASS=AUTO);
      143     9729        %FPT_READ (FPTN=RDPRO,STCLASS="");
      144     9768        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:6    
      145     9769
      146     9770        /* CONSTANT data */
      147     9771
      148     9772    1   DCL DPMT (0:3) CHAR(1) UNAL CONSTANT INIT('!','!','*','?');
      149     9773    1   DCL VFCDP (0:3) CHAR(1) UNAL CONSTANT INIT(%VFC_HDR0*2,%VFC_EXT*2);
      150     9774        %EQU FPT_OFFSET = 10;
      151     9775    1   DCL 1 VLPCTL(0:22) CONSTANT ALIGNED,
      152     9776    1            2 PCODE UBIN BYTE UNAL INIT(0*6, /* Spares */
      153     9777    1                                         %KV_PRMID_EDTCTL*2,%KV_PRMID_WINDOW*2,
      154     9778    1                                         %KV_PRMID_TRMCTL*2,%KV_PRMID_PROMPT,
      155     9779    1                                         %KV_PRMID_EOM,0,%KV_PRMID_LINEATTR,
      156     9780    1                                         %KV_PRMID_TRMATTR*2,%KV_PRMID_PLATEN,
      157     9781    1                                         %KV_PRMID_TRMTAB*2,%KV_PRMID_SINPUT,0),
      158     9782
      159     9783    1            2 MINVLP UBIN BYTE UNAL INIT       (0*6,
      160     9784    1                                                SIZEC(VLP$EDTCTL_V)*2,
      161     9785    1                                                SIZEC(VLP$WINDOW_V)*2,
      162     9786    1                                                SIZEC(VLP$TRMCTL_V)*2,0,0,
      163     9787    1                                                0,SIZEC(VLP$LINEATTR_V),
      164     9788    1                                                SIZEC(VLP$TRMATTR_V)*2,
      165     9789    1                                                SIZEC(VLP$PLATEN_V),
      166     9790    1                                                SIZEC(VLP$TAB_V)*2,
      167     9791    1                                                0,1),
      168     9792    1            2 MXVLP UBIN HALF UNAL INIT    (262143*6,
      169     9793    1                                            SIZEC(VLP$EDTCTL_V),262143,
      170     9794    1                                            SIZEC(VLP$WINDOW_V),262143,
      171     9795    1                                            SIZEC(VLP$TRMCTL_V),262143,95,
      172     9796    1                                            SIZEC(VLP$EOMTABLE_V),262143*2,
      173     9797    1                                            SIZEC(VLP$TRMATTR_V),262143,
      174     9798    1                                            SIZEC(VLP$PLATEN_V),
      175     9799    1                                            SIZEC(VLP$TAB_V),262143,4096,8);
      176     9800    1   DCL B$JIT$ PTR SYMREF;
      177     9801    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      178     9802    1   DCL B$M$UC$ PTR SYMREF READONLY;
      179     9803    1   DCL B$PS2$ PTR SYMREF;
      180     9804    1   DCL B$PS0$ PTR SYMREF;
      181     9805    1   DCL B$PS1$ PTR SYMREF;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:7    
      182     9806    1   DCL B$PS3$ PTR SYMREF;
      183     9807    1   DCL B$PS4$ PTR SYMREF;
      184     9808    1   DCL B$ROSEG$ PTR SYMREF;
      185     9809    1   DCL S_CUN UBIN WORD SYMREF;
      186     9810    1   DCL SSR$REG ENTRY(3) ALTRET;
      187     9811    1   DCL FMM$DFLOPN ENTRY;
      188     9812    1   DCL FMO$GETDOMAIN ENTRY(1);
      189     9813    1   DCL FMO$GETPFB ENTRY(1);
      190     9814    1   DCL FMP$CLSF ENTRY(1);
      191     9815    1   DCL FMF$TYC ENTRY(2);
      192     9816    1   DCL KIA$WINDOW ENTRY(2) ALTRET;
      193     9817    1   DCL OCU$RWUC ENTRY(4) ALTRET;
      194     9818    1   DCL KIA$UCIO ENTRY(5) ALTRET;
      195     9819    1   DCL KCI$TCTL ENTRY(5) ALTRET;
      196     9820    1   DCL KCI$CKSTAT ENTRY(3) ALTRET;
      197     9821    1   DCL UDB$PMMEXIT ENTRY;
      198     9822    1   DCL UMD$DBPRMT ENTRY(2) ALTRET;
      199     9823    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      200     9824    1   DCL HFF$DSIZ ENTRY(2) ALTRET;
      201     9825    1   DCL M$MREAD ENTRY(1) ALTRET;
      202     9826    1   DCL HFF$WRITE1 ENTRY(2) ALTRET;
      203     9827    1   DCL HFF$TRAPALT ENTRY ALTRET;
      204     9828    1   DCL FMD$GBUF ENTRY(1);
      205     9829    1   DCL FMD$RBUF ENTRY(1);
      206     9830    1   DCL FMM$SCRUB ENTRY(1);
      207     9831        /**/
      208     9832        /**/
      209     9833        %INCLUDE KI_ERRORS_C;
      210     9918        %INCLUDE F_ERRORS_C;
      211    10158        %INCLUDE UD_SEV_C;
      212    10172        /**/
      213    10173    1   DCL 1 NO_WRT CONSTANT ALIGNED,
      214    10174    1            2 FCG BIT(18) UNAL INIT('131120'O),
      215    10175    1            2 ERR UBIN(15) UNAL INIT(%E$NOACC),
      216    10176    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      217    10177    1   DCL 1 NOTTY CONSTANT ALIGNED,
      218    10178    1            2 FCG BIT(18) UNAL INIT('131120'O),
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:8    
      219    10179    1            2 ERR UBIN(15) UNAL INIT(%E$NOTTY),
      220    10180    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      221    10181    1   DCL 1 NOTTS CONSTANT ALIGNED,
      222    10182    1            2 FCG BIT(18) UNAL INIT('131120'O),
      223    10183    1            2 ERR UBIN(15) UNAL INIT(%E$NOTTS),
      224    10184    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      225    10185    1   DCL 1 MISOPT CONSTANT ALIGNED,
      226    10186    1            2 FCG BIT(18) UNAL INIT('131120'O),
      227    10187    1            2 ERR UBIN(15) UNAL INIT(%E$NILOPT),
      228    10188    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      229    10189    1   DCL 1 TOOBIG CONSTANT ALIGNED,
      230    10190    1            2 FCG BIT(18) UNAL INIT('131120'O),
      231    10191    1            2 ERR UBIN(15) UNAL INIT(%E$O2BIG),
      232    10192    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      233    10193    1   DCL 1 TOOSMALL CONSTANT ALIGNED,
      234    10194    1            2 FCG BIT(18) UNAL INIT('131120'O),
      235    10195    1            2 ERR UBIN(15) UNAL INIT(%E$O2SMALL),
      236    10196    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      237    10197    1   DCL 1 BPRTY CONSTANT ALIGNED,
      238    10198    1            2 FCG BIT(18) UNAL INIT('131120'O),
      239    10199    1            2 ERR UBIN(15) UNAL INIT(%E$BPROTYP),
      240    10200    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      241    10201    1   DCL 1 NKFUNC CONSTANT ALIGNED,
      242    10202    1            2 FCG BIT(18) UNAL INIT('131120'O),
      243    10203    1            2 ERR UBIN(15) UNAL INIT(%E$NKFUNC),
      244    10204    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      245    10205    1   DCL 1 ILGLNOTFORM CONSTANT ALIGNED,
      246    10206    1            2 FCG BIT(18) UNAL INIT('131120'O),
      247    10207    1            2 ERR UBIN(15) UNAL INIT(%E$ILGLNOTFORM),
      248    10208    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      249    10209    1   DCL 1 OUTPUTONLY CONSTANT ALIGNED,
      250    10210    1            2 FCG BIT(18) UNAL INIT('131120'O),
      251    10211    1            2 ERR UBIN(15) UNAL INIT(%E$OUTPUTONLY),
      252    10212    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      253    10213        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:9    
      254    10214        /**/
      255    10215        /**/
      256    10216    1        DCB$=B$JIT$->B$JIT.DCB$;
      257    10217    2        IF NOT DCB$->F$DCB.FCD THEN DO;    /* MUST DO IMPLICIT OPEN              */
      258    10218    2             CALL FMO$GETDOMAIN(PFB);
      259    10219    2             DCB$->F$DCB.WSR=PFB;          /* Set current domain                 */
      260    10220    2             CALL FMM$DFLOPN;
      261    10221    2           END;
      262    10222    1        IF DCB$->F$DCB.FCD='0'B THEN RETURN;
      263    10223    1        SDCB$ = DCB$;                      /* Save the DCB                       */
      264    10224    2        IF DCB$->F$DCB.IASN=%STREAM# THEN DO;
      265    10225    2             IF (DCB$->F$DCB.CFU$=B$M$UC$ AND B$M$UC$->F$DCB.MEDIA=FMTUC#)
      266    10226    3                  OR (DCB$->F$DCB.CTLCMDIN AND DCB$->F$DCB.UCOUT) THEN DO;
      267    10227    3                  DCB$=B$M$UC$;
      268    10228    3                  B$JIT.DCB$=DCB$;
      269    10229    3                END;
      270    10230    3             ELSE DO;
      271    10231    3   BDFC:          ;
      272    10232    3                  B$JIT$->B$JIT.ERR=NOTTS;
      273    10233        /*E*  ERROR:         KIP-E$NOTTS-C
      274    10234               MESSAGE: You have no terminal to control!
      275    10235              MESSAGE1: The terminal control service requests are only legal
      276    10236                        if the user has a terminal to control.  This is not true
      277    10237                        if the job is BATCH or a system GHOST.  The best
      278    10238                        thing to do is ignore this CONTINUE severity error
      279    10239                        or use it to check mode.
      280    10240              DESCRIPTION:   This CONTINUE severity error is produced mainly
      281    10241                             to provide an easy way to check mode by issuing
      282    10242                             an M$PROMPT pmme.  In this way, the JIT need not
      283    10243                             be INCLUDEd                                             */
      284    10244    3                  RETURN;
      285    10245    3                END;
      286    10246    2           END;
      287    10247    1        IF DCB$->F$DCB.IASN=0 THEN GOTO BDFC; /*DEVICE NO                     */
      288    10248    2        IF DCB$=B$M$UC$ THEN DO;
      289    10249    2             IF B$JIT.MODE~=%M_INT# THEN GOTO BDFC;
      290    10250    3             IF DCB$->F$DCB.ASN=%COMGROUP# THEN DO;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:10   
      291    10251    4                  IF PMMECOD~=%C$PROMPT# AND PMMECOD~=%C$TRMISC# THEN DO;
      292    10252    4                       B$JIT.ERR=NKFUNC;
      293    10253        /*E*  ERROR:    KIP-E$NKFUNC-C
      294    10254               MESSAGE: That terminal control service is not available to console ghosts
      295    10255              DESCRIPTION: KEYIN only process some terminal control PMMEs.
      296    10256                           Other functions must be performed via keyins              */
      297    10257    4                       RETURN;
      298    10258    4                     END;
      299    10259    3                  MEDIA=ENTADDR(OCU$RWUC);
      300    10260    3                END;
      301    10261    2             ELSE MEDIA=ENTADDR(KIA$UCIO);
      302    10262    2             UCFLG=0;
      303    10263    2           END;
      304    10264    2        ELSE IF DCB$->F$DCB.ASN=%COMGROUP# THEN DO;
      305    10265    2                  MEDIA=ENTADDR(KCI$TCTL);
      306    10266    2                  UCFLG=-1;
      307    10267    2                END;
      308    10268    2             ELSE IF DCB$->F$DCB.MEDIA=FMTUC# THEN DO;
      309    10269    2                       MEDIA=ENTADDR(KIA$UCIO);
      310    10270    2                       UCFLG=-1;
      311    10271    2                     END;
      312    10272    1                  ELSE GOTO BDFC;
      313    10273    1        DCB$->F$DCB.WAIT=1;
      314    10274    1        DCB$->F$DCB.TYC(1)='0'B;
      315    10275    1        IF UCFLG < 0
      316    10276    1        THEN
      317    10277    1             PFB = KIDM_CP;
      318    10278    2        ELSE DO;
      319    10279    2             IF SDCB$ = B$M$UC$
      320    10280    3             THEN DO;
      321    10281    3                  CALL FMO$GETPFB(PFB);
      322    10282    3                  IF PFB = KIDM_CP
      323    10283    3                  THEN
      324    10284    3                       PFB = 0;
      325    10285    3                  ELSE
      326    10286    3                       IF NOT B$ROSEG$->B$ROSEG.STREAM_VALID(PFB)
      327    10287    3                       THEN
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:11   
      328    10288    3                            PFB = KIDM_CP;
      329    10289    3                  DCB$->F$DCB.STR = PFB;
      330    10290    3                END;
      331    10291    3             ELSE DO;
      332    10292    3                  PFB = SDCB$->F$DCB.STR;
      333    10293    3                  DCB$->F$DCB.STR = PFB;
      334    10294    3                END;
      335    10295    2           END;
      336    10296    1        FPTCODE = PMMECOD+%FPT_OFFSET;
      337    10297        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:12   
      338    10298    2        DO CASE (PMMECOD);
      339    10299    2        CASE (%C$DCLFLD#);
      340    10300                                           /* Check to see if it is the ORG is form   */
      341    10301    2           IF SDCB$->F$DCB.ORG ~= %FORM#
      342    10302    3           THEN DO;
      343    10303    3   NOTFORM:     ;
      344    10304    3                B$JIT.ERR = ILGLNOTFORM;
      345    10305                       /*E* ERROR: KIP-E$ILGLNOTFORM
      346    10306                            MESSAGE: That PMME requires DCB% %DC%.ORG=FORM.
      347    10307                            MESSAGE1: M$DCLFLD, M$MDFFLD, M$RLSFLD, and M$SLCFLD
      348    10308                                      require that DCB% %DC%.ORG be FORM.
      349    10309                             */
      350    10310    3                RETURN;
      351    10311    3              END;
      352    10312    2           K$RWPARM = K_RWPARM_CON;
      353    10313    2           K$RWPARM.DVE.DVBYTE = FPT$DCLFLD_V.DVBYTE;
      354    10314    2           K$RWPARM.V$ = B$PS0$;
      355    10315    2           K$RWPARM.MSG$ = B$PS2$;
      356    10316    2           VLP_FLDATR = VLP$FLDATR_V;
      357    10317    2           K$RWPARM.VLP$ = ADDR(VLP_FLDATR);
      358    10318    2           CALL HFF$DSIZ(2,K$RWPARM.MSGSZ);
      359    10319    2           TFCN.FCN = %KV_VDO_FNC_DCLFLD;
      360    10320    2           B$JIT.DCB$=SDCB$;               /* Get FLDID back in the right DCB */
      361    10321    2           CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));
      362    10322    2           RETURN;
      363    10323
      364    10324        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:13   
      365    10325    2        CASE (%C$ERASE#);
      366    10326    2           K$RWPARM = K_RWPARM_CON;
      367    10327    2           K$RWPARM.DVE.DVBYTE = FPT$ERASE_V.DVBYTE;
      368    10328    2           K$RWPARM.KEYTYPE = FPT$ERASE_V.KEYTYPE;
      369    10329    2           TFCN.FCN = %KV_VDO_FNC_ERS;
      370    10330    2           GOTO CMNFLDSRV;
      371    10331
      372    10332        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:14   
      373    10333    2        CASE (%C$MDFFLD#);
      374    10334    2           IF SDCB$->F$DCB.ORG ~= %FORM#
      375    10335    2           THEN
      376    10336    2                GOTO NOTFORM;
      377    10337    2           K$RWPARM = K_RWPARM_CON;
      378    10338    2           K$RWPARM.DVE.DVBYTE = FPT$MDFFLD_V.DVBYTE;
      379    10339    2           K$RWPARM.KEYTYPE = FPT$MDFFLD_V.KEYTYPE;
      380    10340    2           IF K$RWPARM.KEYTYPE = 0
      381    10341    2           THEN
      382    10342    2                K$RWPARM.KEYTYPE = SDCB$->F$DCB.KEYTYPE;
      383    10343    2           K$RWPARM.V$ = B$PS0$;
      384    10344    2           VLP_FLDATR = B$PS4$->VLP$FLDATR_V;
      385    10345    2           K$RWPARM.VLP$ = ADDR(VLP_FLDATR);
      386    10346    2           K$RWPARM.MSG$ = B$PS2$;
      387    10347    2           CALL HFF$DSIZ(2,K$RWPARM.MSGSZ);
      388    10348    2           CALL HFF$DSIZ(3,VLPSIZ);
      389    10349    2           K$RWPARM.KEYSZ = MINIMUM(VLPSIZ,255);
      390    10350    2           IF VLPSIZ~=0 THEN K$RWPARM.KEY$ = B$PS3$;
      391    10351    2           IF FPT$MDFFLD_V.SETGRPRND
      392    10352    3           THEN DO;
      393    10353    3                TFCN.FCN = %KV_VDO_FNC_SLCGRPRND;
      394    10354    3                CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));
      395    10355    3                K$RWPARM.MSGSZ = 0;        /* Only send the data once.           */
      396    10356    3              END;
      397    10357    2           IF FPT$MDFFLD_V.SETQLF
      398    10358    3           THEN DO;
      399    10359    3                TFCN.FCN = %KV_VDO_FNC_SLCQLF;
      400    10360    3                CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));
      401    10361    3                K$RWPARM.MSGSZ = 0;        /* Only send the data once.           */
      402    10362    3              END;
      403    10363    3           IF K$RWPARM.MSGSZ~=0 THEN DO;
      404    10364    3                TFCN.FCN = %KV_VDO_FNC_DAT;
      405    10365    3                CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));
      406    10366    3              END;
      407    10367    2           RETURN;
      408    10368
      409    10369        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:15   
      410    10370    2        CASE (%C$RLSFLD#);
      411    10371    2           IF SDCB$->F$DCB.ORG ~= %FORM#
      412    10372    2           THEN
      413    10373    2                GOTO NOTFORM;
      414    10374    2           K$RWPARM = K_RWPARM_CON;
      415    10375    2           K$RWPARM.DVE.DVBYTE = FPT$RLSFLD_V.DVBYTE;
      416    10376    2           K$RWPARM.KEYTYPE = FPT$RLSFLD_V.KEYTYPE;
      417    10377    2           TFCN.FCN = %KV_VDO_FNC_RLSFLD;
      418    10378    2           GOTO CMNFLDSRV;
      419    10379
      420    10380        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:16   
      421    10381    2        CASE (%C$SCLFLD#);
      422    10382    2           IF SDCB$->F$DCB.ORG ~= %FORM#
      423    10383    2           THEN
      424    10384    2                GOTO NOTFORM;
      425    10385    2           K$RWPARM = K_RWPARM_CON;
      426    10386    2           K$RWPARM.DVE.DVBYTE = FPT$SLCFLD_V.DVBYTE;
      427    10387    2           K$RWPARM.KEYTYPE = FPT$SLCFLD_V.KEYTYPE;
      428    10388    2           TFCN.FCN = %KV_VDO_FNC_SLCFLD;
      429    10389    2   CMNFLDSRV: ;
      430    10390    2           IF K$RWPARM.KEYTYPE = 0
      431    10391    2           THEN
      432    10392    2                K$RWPARM.KEYTYPE = SDCB$->F$DCB.KEYTYPE;
      433    10393    2           K$RWPARM.V$ = B$PS0$;
      434    10394    2           CALL HFF$DSIZ(2,VLPSIZ);
      435    10395    2           K$RWPARM.KEYSZ = MINIMUM(255,VLPSIZ);
      436    10396    2           IF VLPSIZ~=0 THEN K$RWPARM.KEY$ = B$PS2$;
      437    10397    2           CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));
      438    10398    2           RETURN;
      439    10399
      440    10400        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:17   
      441    10401    2        CASE(%C$STRMTAB#);
      442    10402    2           CALL VLPCK ALTRET (NOVEC);
      443    10403    2           ADDR(TCTL.M)->VCHRZ=B$PS2$->VCHRZ;
      444    10404        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:18   
      445    10405    2        CASE(%C$STRMCTL#);
      446    10406    2           IF FPT$TRMCTL_V.VLPTYPE ~= %TRMCTL_TRMCTL#
      447    10407    2                AND FPT$TRMCTL_V.VLPTYPE <= %FPT_OFFSET/2
      448    10408    2           THEN FPTCODE = FPTCODE-2*FPT$TRMCTL_V.VLPTYPE;
      449    10409    2           CALL VLPCK ALTRET(NOVEC);
      450    10410    2           ADDR(TCTL.M)->VCHRZ=B$PS2$->VCHRZ;
      451    10411    3           IF FPTCODE=%C$STRMCTL# +%FPT_OFFSET THEN DO;
      452    10412    3                IF UCFLG~=0 THEN EXIT;
      453    10413    3                IF ADDR(TCTL.M)->VLP$TRMCTL_V.SINPUTSZ~=255
      454    10414    3                THEN B$JIT.SINPUTSZ = ADDR(TCTL.M)->VLP$TRMCTL_V.SINPUTSZ;
      455    10415    3                IF NOT ADDR(TCTL.M)->VLP$TRMCTL_V.OUTPUTDISCARD
      456    10416    3                     AND NK$LDCT$(DCB$->F$DCB.LDCTX)->LDCT.TH.MAXRCRBYTSIZ=0
      457    10417        /* If OUTPUTDISCARD's going off, wait for a response before attempting output,
      458    10418           by simulating an output blocked state. */
      459    10419    3                THEN NK$LDCT$(DCB$->F$DCB.LDCTX)->LDCT.TH.MAXNMBRCR=0;
      460    10420    3              END;
      461    10421    3           IF FPTCODE = %C$STRMCTL# +%FPT_OFFSET-2*%TRMCTL_WINDOW# THEN DO;
      462    10422    3                ADDR(TCTL.M)->VLP$WINDOW_V.POSITION = 0;
      463    10423    3                CALL KIA$WINDOW (PFB,TCTL.M);
      464    10424    3                RETURN;
      465    10425    3              END;
      466    10426    3           ELSE IF FPTCODE = %C$STRMCTL# +%FPT_OFFSET-2*%TRMCTL_EDTCTL# THEN DO;
      467    10427    3                     IF ADDR(TCTL.M)->VLP$EDTCTL_V.KEYTYPE~=255
      468    10428    3                     THEN SDCB$->F$DCB.KEYTYPE = ADDR(TCTL.M)->VLP$EDTCTL_V.KEYTYPE;
      469    10429    3                     ADDR(ADDR(TCTL.M)->VLP$EDTCTL_V.KEYINCR)->L6.T =
      470    10430    3                          ADDR(ADDR(TCTL.M)->VLP$EDTCTL_V.KEYINCR)->L66.T;
      471    10431    3                   END;
      472    10432        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:19   
      473    10433    2        CASE(%C$STRMATTR#);
      474    10434    2           CALL VLPCK ALTRET(NOVEC);
      475    10435    2           IF B$PS2$->VLP$TRMATTR_V.SPEED~=255 AND UCFLG=0 THEN
      476    10436    2                B$JIT$->B$JIT.TSLINE.SPEED=B$PS2$->VLP$TRMATTR_V.SPEED;
      477    10437    2           ADDR(TCTL.M)->VCHRZ=B$PS2$->VCHRZ;
      478    10438    3           DO WHILE ('1'B);
      479    10439    3                CALL NXTDCB ALTRET (CSEND);
      480    10440    3                IF B$PS2$->VLP$TRMATTR_V.TRUOVRPRT~='01'B THEN
      481    10441    3                     SDCB$->F$DCB.ATTR.TRUOVRPRT=B$PS2$->VLP$TRMATTR_V.TRUOVRPRT;
      482    10442    3                IF B$PS2$->VLP$TRMATTR_V.APL~='01'B THEN
      483    10443    3                     SDCB$->F$DCB.ATTR.APL=B$PS2$->VLP$TRMATTR_V.APL;
      484    10444    3                IF B$PS2$->VLP$TRMATTR_V.LOWERCASEPRINTS~='01'B THEN
      485    10445    3                     SDCB$->F$DCB.ATTR.LOWERCASE=B$PS2$->VLP$TRMATTR_V.LOWERCASEPRINTS;
      486    10446    3              END;
      487    10447
      488    10448        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:20   
      489    10449    2        CASE (%C$GPROMPT#);
      490    10450    2           FPTCODE = %C$TRMPRG#+%FPT_OFFSET; /* Unused slot in VLPCTL table */
      491    10451    2           CALL VLPCK ALTRET(NOVEC);
      492    10452    2           DCB$->F$DCB.UB$ = B$PS2$;
      493    10453    2           DCB$->F$DCB.UBYTES = VLPSIZ;
      494    10454    2           CALL MEDIA (MFC_RSTAT,0,VLPCTL.PCODE(%C$PROMPT#+%FPT_OFFSET),0)
      495    10455    2                ALTRET(ERRCHK);
      496    10456    2           B$PS0$->FPT$PROMPT_V.DVBYTE = DCB$->F$DCB.UB$->VCHRPMT.DVBYTE;
      497    10457    2           LENGTH = DCB$->F$DCB.ARS;
      498    10458    2           IF B$PS0$->FPT$PROMPT_V.DVBYTE.VFC
      499    10459    3           THEN DO;
      500    10460    3                B$PS2$->VCHRZ = SUBSTR(B$PS2$->VCHRZ,2,VLPSIZ-2);
      501    10461    3                SDCB$->F$DCB.ARS = DCB$->F$DCB.ARS - 2;
      502    10462    3              END;
      503    10463    3           ELSE DO;
      504    10464    3                B$PS2$->VCHRZ = SUBSTR(B$PS2$->VCHRZ,3,VLPSIZ-3);
      505    10465    3                SDCB$->F$DCB.ARS = DCB$->F$DCB.ARS - 3;
      506    10466    3              END;
      507    10467    2           GOTO ERRCHK;
      508    10468        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:21   
      509    10469    2        CASE (%C$GTRMCTL#);
      510    10470    2           IF FPT$TRMCTL_V.VLPTYPE ~= %TRMCTL_TRMCTL#
      511    10471    2                AND FPT$TRMCTL_V.VLPTYPE <= %FPT_OFFSET/2
      512    10472    2           THEN FPTCODE = FPTCODE-2*FPT$TRMCTL_V.VLPTYPE;
      513    10473    2           GOTO GET_CMN;
      514    10474        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:22   
      515    10475    2        CASE (%C$GLINEATTR#, %C$GTRMATTR#, %C$GTRMTAB#);
      516    10476    2   GET_CMN: ;
      517    10477    2           CALL VLPCK ALTRET (NOVEC);
      518    10478    2           DCB$->F$DCB.UB$=B$PS2$;
      519    10479    2           DCB$->F$DCB.UBYTES=VLPSIZ;
      520    10480    2           CALL MEDIA (MFC_RSTAT,0,VLPCTL.PCODE(FPTCODE),0);
      521    10481    2           GOTO ERRCHK;
      522    10482        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:23   
      523    10483    2        CASE(%C$PLATEN#);
      524    10484    2           CALL VLPCK ALTRET (NOVEC);
      525    10485    2           ADDR(TCTL.M)->VCHRZ=B$PS2$->VCHRZ;
      526    10486    2           WIDTH=B$PS2$->VLP$PLATEN_V.WIDTH;
      527    10487    2           IF WIDTH=255 THEN WIDTH=-1;
      528    10488    2           ELSE IF B$PS2$->VLP$PLATEN_V.EXTWID THEN WIDTH=WIDTH+254;
      529    10489    2           LENGTH=B$PS2$->VLP$PLATEN_V.LENGTH;
      530    10490    2           IF LENGTH=255 THEN LENGTH=-1;
      531    10491    3           IF LENGTH+WIDTH~=-2 THEN DO WHILE ('1'B);
      532    10492    3                CALL NXTDCB ALTRET (CSEND);
      533    10493    3                IF WIDTH~=-1 THEN SDCB$->F$DCB.WIDTH=WIDTH;
      534    10494    3                IF LENGTH~=-1 THEN SDCB$->F$DCB.LINES=LENGTH;
      535    10495    3              END;
      536    10496        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:24   
      537    10497    2        CASE(%C$GPLATEN#);
      538    10498    2           FPTCODE = %C$PLATEN#+%FPT_OFFSET;
      539    10499    2           GOTO GET_CMN;
      540    10500        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:25   
      541    10501    2        CASE (%C$PROMPT#);
      542    10502    2           ADDR(TCTL.M)->VCHRPMT.PFB=PFB;
      543    10503    2           ADDR(TCTL.M)->VCHRPMT.DVBYTE=B$PS0$->FPT$PROMPT_V.DVBYTE;
      544    10504    2           CALL VLPCK;
      545    10505    3           IF VLPSIZ=0 THEN DO;
      546    10506    3                IF PFB>3 THEN PFB = 2;
      547    10507    3                ADDR(TCTL.M)->VCHRPMT.VFC=VFCDP(PFB);
      548    10508    3                VLPSIZ=1;
      549    10509    3                ADDR(TCTL.M)->VCHRPMT.M=DPMT(PFB);
      550    10510    3              END;
      551    10511    3           ELSE IF B$PS0$->FPT$PROMPT_V.DVBYTE.VFC THEN DO;
      552    10512    3                     VLPSIZ=VLPSIZ-1;
      553    10513    3                     ADDR(TCTL.M)->VCHRPMT.VFC=B$PS2$->VCHRV.VFC;
      554    10514    3                     ADDR(TCTL.M)->VCHRPMT.M=B$PS2$->VCHRV.M;
      555    10515    3                   END;
      556    10516    3                ELSE DO;
      557    10517    3                     ADDR(TCTL.M)->VCHRPMT.VFC=%VFC_EXT;
      558    10518    3                     ADDR(TCTL.M)->VCHRPMT.M=B$PS2$->VCHRZ;
      559    10519    3                   END;
      560    10520    2           IF B$JIT$->B$JIT.CPFLAGS1&%CP_DRIBBLE# AND UCFLG=0 THEN
      561    10521    2                CALL UMD$DBPRMT(ADDR(TCTL.M)->VCHRPMT,VLPSIZ);
      562    10522    2           VLPSIZ=VLPSIZ+3;
      563    10523        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:26   
      564    10524    2        CASE (%C$EOM#);
      565    10525    2           ADDR(TCTL.M)->VCHRET.PFB=PFB;
      566    10526    2           ADDR(TCTL.M)->VCHRET.SUPPHALT=B$PS0$->FPT$EOM_V.SUPPHALT;
      567    10527    2           ADDR(TCTL.M)->VCHRET.UNITS=B$PS0$->FPT$EOM_V.UTYPE;
      568    10528    2           ADDR(TCTL.M)->VCHRET.TIMEOUT=B$PS0$->FPT$EOM_V.TIMEOUT;
      569    10529    2           CALL VLPCK ALTRET (NOEOM);
      570    10530    2           ADDR(TCTL.M)->VCHRET.M=B$PS2$->VCHRZ;
      571    10531    2   NOEOM:  ;
      572    10532    2           VLPSIZ=VLPSIZ+4;
      573    10533        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:27   
      574    10534    2        CASE (%C$TRMPRG#);
      575    10535    2           TFCN.FCN=%KV_VDO_FNC_DLT;
      576    10536    2           K$RWPARM = K_RWPARM_CON;
      577    10537    2           K$RWPARM.V$ = ADDR(B$PS0$->FPT$TRMPRG_V);
      578    10538    2           CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));
      579    10539    2           GOTO ERRCHK;
      580    10540        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:28   
      581    10541
      582    10542    2        CASE (%C$SINPUT#);
      583    10543    2           DCB$->F$DCB.UB$=ADDR(B$JIT$);
      584    10544    3           CALL VLPCK WHENRETURN DO;
      585    10545    3                DCB$->F$DCB.UB$=B$PS2$;
      586    10546    3              END;
      587    10547    2           DCB$->F$DCB.UBYTES = VLPSIZ;
      588    10548    2           IF MEDIA ~= ENTADDR(KIA$UCIO)
      589    10549    2           THEN IF FPT$SINPUT_V.POSITION
      590    10550    2                THEN CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SLLP,0);
      591    10551    2                ELSE CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SLL,0);
      592    10552    3           ELSE DO;
      593    10553    3                K$RWPARM = K_RWPARM_CON;
      594    10554    3                K$RWPARM.V$ = ADDR(TCTL);
      595    10555    3                K$RWPARM.VSZ = LENGTHC(VSIN);
      596    10556    3                K$RWPARM.PRMID = %KV_PRMID_SINPUT;
      597    10557    3                K$RWPARM.MSG$ = DCB$->F$DCB.UB$;
      598    10558    3                K$RWPARM.MSGSZ = VLPSIZ;
      599    10559    4                IF SDCB$->F$DCB.ORG=%SE# THEN DO;
      600    10560    4                     K$RWPARM.MSGSZ = 0;
      601    10561    4                     K$RWPARM.KEY$ = K$RWPARM.MSG$;
      602    10562    4                     K$RWPARM.KEYTYPE = SDCB$->F$DCB.KEYTYPE;
      603    10563    4                     K$RWPARM.KEYSZ = VLPSIZ;
      604    10564    4                     K$RWPARM.DVE.DVBYTE = FPT$SINPUT_V.DVBYTE;
      605    10565    4                     IF VLPSIZ~=SDCB$->F$DCB.KEYL OR FPT$SINPUT_V.POSITION
      606    10566    5                     THEN DO;
      607    10567    5                          IF VLPSIZ=0 THEN GOTO NOVEC;
      608    10568    5                          IF VLPSIZ>SDCB$->F$DCB.KEYL
      609    10569    5                          THEN B$JIT$->B$JIT.ERR = TOOBIG;
      610    10570    5                          ELSE B$JIT$->B$JIT.ERR = TOOSMALL;
      611    10571    5                          RETURN;
      612    10572    5                        END;
      613    10573    4                   END;
      614    10574    3                ADDR(TCTL)->VSIN.PFB = PFB;
      615    10575    3                ADDR(TCTL)->VSIN.POS = FPT$SINPUT_V.REREADPOS;
      616    10576    3                ADDR(TCTL)->VSIN.POSL6.T = ADDR(TCTL)->VSIN.POSL66.T;
      617    10577    4                IF FPT$SINPUT_V.POSITION THEN DO;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:29   
      618    10578    4                     K$RWPARM.VSZ = LENGTHV(VSIN);
      619    10579    4                     ADDR(TCTL)->VSIN.POS = 0;
      620    10580    4                   END;
      621    10581    3                TFCN.FCN = %KV_VDO_FNC_PRM_SET;
      622    10582    3                CALL KIA$UCIO (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));
      623    10583    3              END;
      624    10584    2           RETURN;
      625    10585
      626    10586        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:30   
      627    10587    2        CASE (%C$PROFILE#);
      628    10588    2           CALL HFF$NILERASE (2) ALTRET (NOVEC);
      629    10589    2           CALL OPNPRO ALTRET (ERROUT);
      630    10590    2           DCB$->F$DCB.TYC(1)='0'B;
      631    10591    2           CALL FMD$GBUF(BUF$);
      632    10592    2           CALL HFF$TRAPALT ALTRET (ONON);
      633    10593    2           VLPSIZ = 4096;
      634    10594    2           RDPRO=RDPC;
      635    10595    2           RDPRO.V.DCB#=%M$STAR#;
      636    10596    2           ADDR(RDPRO.V_)->VEC.P$=ADDR(RDPRO.V);
      637    10597    2           CALL XLATE (XPNAME.TXT, B$XL_UPPER_UR, B$PS2$->VTXTC.TXT);
      638    10598    2           XPNAME.CNT = B$PS2$->VTXTC.CNT;
      639    10599    2           RDPRO.KEY_ = VECTOR (XPNAME);
      640    10600    2           IF XPNAME.CNT > 11
      641    10601    2           THEN XPNAME.CNT = 11;
      642    10602    2           RDPRO.BUF_=VECTOR(BUF$->PROBUF);
      643    10603    2           CALL M$MREAD (RDPRO) ALTRET (ONON);
      644    10604    2   ONON:   ;
      645    10605    2           TERR=B$JIT.ERR;
      646    10606    2           B$JIT.DCB$=DCB$;
      647    10607    3           IF TERR.CODE~=0 THEN DO;
      648    10608    3                IF TERR.CODE = %E$NOKEY
      649    10609    4                THEN DO;
      650    10610    4                     TERR.FCGMID = '131120'O;
      651    10611    4                   END;
      652    10612        /*E*  ERROR:         KIP-E$NOKEY-E
      653    10613               MESSAGE: The specified PROFILE does not exist!
      654    10614              DESCRIPTION:   We went to M$MREAD to read :PRO using the profile
      655    10615                             name as a key, and FM said no such key.                 */
      656    10616    3   ONON1:       CALL FMD$RBUF(BUF$);
      657    10617    3                B$JIT.DCB$ = B$M$STAR$;
      658    10618    3                CALL FMP$CLSF;
      659    10619    3   ONON2:       B$JIT.ERR=TERR;
      660    10620    3                GOTO ERROUT;
      661    10621    3              END;
      662    10622    2           IF MEDIA=ENTADDR(KIA$UCIO) AND UCFLG=0
      663    10623    3           THEN DO;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:31   
      664    10624    3                IF NK$LDCT$(DCB$->F$DCB.LDCTX)->LDCT.TERMID.TTYP ~= BUF$->KL$PHDR.TTYP
      665    10625    4                THEN DO;
      666    10626    4                     TERR=BPRTY;
      667    10627        /*E*  ERROR:         KIP-E$BPROTYP-C
      668    10628               MESSAGE: That PROFILE is impossible for your terminal!
      669    10629              MESSAGE1: Each PROFILE contains a code describing the types
      670    10630                        of terminals that it describes.  Should an attempt
      671    10631                        be made to (say) assign an IRBT profile to a timesharing
      672    10632                        terminal, the code does not match that of the
      673    10633                        terminal and this error results. */
      674    10634    4                     GOTO ONON1;
      675    10635    4                   END;
      676    10636    3                IF NOT BUF$->KL$PHDR.IO.INPUT
      677    10637    4                THEN DO;
      678    10638    4                     TERR=OUTPUTONLY;
      679    10639                       /*E* ERROR: KIA-E$OUTPUTONLY-C
      680    10640                            MESSAGE: A time sharing profile must allow input.
      681    10641                        */
      682    10642    4                     GOTO ONON1;
      683    10643    4                   END;
      684    10644    3              END;
      685    10645    2           DCB$->F$DCB.UB$=PINCRC(ADDR(BUF$->KL$PHDR),LENGTHC(KL$PHDR));
      686    10646    2           DCB$->F$DCB.UBYTES=B$M$STAR$->F$DCB.ARS-LENGTHC(KL$PHDR);
      687    10647    2           IF MEDIA = ENTADDR (KCI$TCTL) THEN
      688    10648    2                CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SPR,0,BUF$);
      689    10649    2           ELSE
      690    10650    2                CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SPR,0);
      691    10651    2           CALL HFF$DSIZ (3,VLPSIZ) ALTRET(NOPROVEC);
      692    10652    2           CALL HFF$WRITE1(3)
      693    10653    3           WHENALTRETURN DO;
      694    10654    3                TERR=NO_WRT;
      695    10655    3                GOTO ONON1;
      696    10656    3              END;
      697    10657    2           VLPSIZ = MINIMUM(VLPSIZ,4096);
      698    10658    2           B$PS3$->VCHRZ = BUF$->VCHRZ;
      699    10659    2   NOPROVEC: ;
      700    10660    2           IF DCB$->F$DCB.TYC(1)='0'B AND B$JIT.ERR.CODE=0
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:32   
      701    10661    3           THEN DO;
      702    10662    4                DO WHILE('1'B);
      703    10663    4                     CALL NXTDCB ALTRET (DOIMP);
      704    10664    4                     SDCB$->F$DCB.LINES=BUF$->KL$PHDR.LINES;
      705    10665    4                     SDCB$->F$DCB.WIDTH=BUF$->KL$PHDR.WIDTH;
      706    10666    4                     SDCB$->F$DCB.ATTR.TRUOVRPRT=BUF$->KL$PHDR.ATTR.TRUOVRPRT;
      707    10667    4                     SDCB$->F$DCB.ATTR.APL=BUF$->KL$PHDR.ATTR.APL;
      708    10668    4                     SDCB$->F$DCB.ATTR.BIN=BUF$->KL$PHDR.ATTR.BIN;
      709    10669    4                     SDCB$->F$DCB.ATTR.LOWERCASE=BUF$->KL$PHDR.ATTR.LCASE;
      710    10670    4                   END;
      711    10671    3   DOIMP:       ;
      712    10672    3                IMP# = BUF$->KL$PHDR.IMP#;
      713    10673    3                IMPPROKEY.KEYSZ = LENGTHC(IMPPROKEY.KEY);
      714    10674    3                RDPRO.KEY_ = VECTOR(IMPPROKEY);
      715    10675
      716    10676    4                DO IMPPROKEY.KEY.IMP# = 1 TO IMP#;
      717    10677        /* M$* might have got closed to DRIBBLE the profile */
      718    10678    4                     IF NOT B$M$STAR$->F$DCB.FCD
      719    10679    4                     THEN CALL OPNPRO ALTRET(ONON1);
      720    10680
      721    10681    4                     CALL M$MREAD (RDPRO) ALTRET(RTN);
      722    10682    4                     DCB$->F$DCB.UB$ = BUF$;
      723    10683    4                     DCB$->F$DCB.UBYTES = B$M$STAR$->F$DCB.ARS;
      724    10684    4                     B$JIT.DCB$ = DCB$;
      725    10685    4                     CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#|%DVBYTE_TRANS#|%DVBYTE_BP#,%
             10685                              VFC_SLPP,0);
      726    10686    4                   END;
      727    10687    3   RTN:         ;
      728    10688    3              END;
      729    10689    2           TERR = B$JIT.ERR;
      730    10690    2           GOTO ONON1;
      731    10691        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:33   
      732    10692    2        CASE (%C$TRMISC#);
      733    10693    3           IF UCFLG>=0 THEN DO;
      734    10694    3                IF B$PS0$->FPT$TRMISC_V.SEND~='01'B
      735    10695    4                THEN DO;
      736    10696    4                     S$CU$->B$U.FLG.NSND=~B$PS0$->FPT$TRMISC_V.SEND;
      737    10697    4                     B$JIT.ACCEPT_FLAGS.SEND=B$PS0$->FPT$TRMISC_V.SEND;
      738    10698    4                   END;
      739    10699    3                IF B$PS0$->FPT$TRMISC_V.ANNOUNCE~='01'B
      740    10700    4                THEN DO;
      741    10701    4                     S$CU$->B$U.FLG.ANNCE=B$PS0$->FPT$TRMISC_V.ANNOUNCE;
      742    10702    4                     B$JIT.ACCEPT_FLAGS.ANNOUNCE=B$PS0$->FPT$TRMISC_V.ANNOUNCE;
      743    10703    4                   END;
      744    10704    3              END;
      745    10705    2           IF B$PS0$->FPT$TRMISC_V.BROADCAST~='01'B
      746    10706    3           THEN DO;
      747    10707    3                IF UCFLG=0 THEN
      748    10708    3                     B$JIT.ACCEPT_FLAGS.BROADCAST=B$PS0$->FPT$TRMISC_V.BROADCAST;
      749    10709    3                IF MEDIA=ENTADDR(OCU$RWUC) THEN EXIT;
      750    10710    3                TFCN.FCN = 0;
      751    10711    3                K$RWPARM = K_RWPARM_CON;
      752    10712    3                K$RWPARM.VDOFLGS.SEND = B$PS0$->FPT$TRMISC_V.BROADCAST;
      753    10713    3                CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));
      754    10714    3              END;
      755    10715    2           RETURN;
      756    10716        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:34   
      757    10717    2        CASE (ELSE);
      758    10718    2           RETURN;
      759    10719    2        END;
      760    10720
      761    10721
      762    10722
      763    10723    1   CSEND: ;
      764    10724    1        TCTL.T=VLPCTL.PCODE(FPTCODE);
      765    10725    1        TCTL.L=VLPSIZ;
      766    10726    1        DCB$->F$DCB.UB$=ADDR(TCTL);
      767    10727    1        DCB$->F$DCB.UBYTES=VLPSIZ+2;
      768    10728    1        CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SPM,0);
      769    10729    1   ERRCHK: ;
      770    10730    1        IF DCB$->F$DCB.TYC(1)~='0'B THEN
      771    10731    1             CALL FMF$TYC (DCB$->F$DCB.TYC(1),B$JIT$->B$JIT.ERR);
      772    10732    2        IF B$JIT$->B$JIT.ERR.CODE~=0 THEN DO;
      773    10733    2   ERROUT:   ;
      774    10734        /*E*  ERROR:    KIP-E$LDSC-E
      775    10735              MESSAGE:  Terminal control aborted - station disconnected
      776    10736              DESCRIPTION: The station the FPRG was being attached to
      777    10737                           disconnected during the PMME                              */
      778    10738        /*E*  ERROR:    KIP-E$DACTR-E
      779    10739              MESSAGE:  Terminal control aborted - you are deactivated
      780    10740              DESCRIPTION: The AU deactivated him during the pmme or he
      781    10741                           was already deactivated when he did it.                   */
      782    10742        /*E*  ERROR:    KIP-E$CGKEYV-E
      783    10743              MESSAGE:  Terminal control aborted - station not defined
      784    10744              DESCRIPTION: XSTALGL = 0 and this station isn't defined.
      785    10745                           See VLP_CGSTAL.                                           */
      786    10746        /*E*  ERROR:    KIP-E$CGFULL-E
      787    10747              MESSAGE:  Terminal control aborted - comgroup queue full
      788    10748              DESCRIPTION: Comgroup is out of space                                  */
      789    10749        /*E*  ERROR:    KIP-E$CGCRCW-E
      790    10750              MESSAGE:  Terminal control aborted - latch violation
      791    10751              DESCRIPTION: An attempt to read without completing the
      792    10752                           the continued Latched write.                              */
      793    10753    2             IF B$JIT$->B$JIT.ERR.FCG = '0'B
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:35   
      794    10754    3             THEN DO;
      795    10755    3                  B$JIT$->B$JIT.ERR.FCG='1311'O;
      796    10756    3                  B$JIT$->B$JIT.ERR.MID='20'O;
      797    10757    3                END;
      798    10758    2           END;
      799    10759    1        RETURN;
      800    10760        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:36   
      801    10761    1   NOVEC: ;
      802    10762    1        B$JIT$->B$JIT.ERR=MISOPT;
      803    10763        /*E*  ERROR:         KIP-E$NILOPT-C
      804    10764               MESSAGE: Required option missing on terminal control service request.
      805    10765              DESCRIPTION:   This error occurs whenever any of the required
      806    10766                             VLPs are missing on the terminal control pmmes.
      807    10767                             Essentially all of them have required VLPs.
      808    10768                             Watch out for missing BUF on M$PROFILE                  */
      809    10769        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:37   
      810    10770    1   VLPCK: PROC ALTRET;
      811    10771        /**/
      812    10772    2        CALL HFF$DSIZ (2,VLPSIZ) ALTRET (NILE);
      813    10773    3        IF VLPSIZ>VLPCTL.MXVLP(FPTCODE) THEN DO;
      814    10774    3             B$JIT$->B$JIT.ERR=TOOBIG;
      815    10775        /*E*  ERROR:         KIP-E$O2BIG-C
      816    10776               MESSAGE: Option area too large on terminal control service request.
      817    10777              MESSAGE1: The option areas on such terminal control services
      818    10778                        as M$STRMATTR and M$STRMCTL are sent as messages
      819    10779                        to the front end.  Because of this their size must
      820    10780                        be limited to that of the appropriate VLP MACRO.
      821    10781                        Your request specifies an option area exceeding this.
      822    10782                        Use the appropriate VLP when issuing the terminal
      823    10783                        control service requests.
      824    10784              DESCRIPTION:   On the terminal control pmmes that set attributes
      825    10785                             the options are required to be exactly the size of
      826    10786                             the corresponding VLP.  The user no doubt tried to
      827    10787                             invent his own or mis-issued the pmme                   */
      828    10788    3           END;
      829    10789    3        ELSE IF VLPSIZ<VLPCTL.MINVLP(FPTCODE) THEN DO;
      830    10790    3                  B$JIT$->B$JIT.ERR=TOOSMALL;
      831    10791        /*E*  ERROR:         KIP-E$O2SMALL-C
      832    10792               MESSAGE: Option area too small on terminal control service request.
      833    10793              MESSAGE1: On such terminal control requests as M$STRMATTR and
      834    10794                        M$STRMCTL, the option area is required to be exactly
      835    10795                        the size of the corresponding VLP.  On the M$GTRMATTR
      836    10796                        and M$GTRMCTL, etc. services it must be at least as
      837    10797                        large as the corresponding VLP.  Use of the supplied
      838    10798                        VLP MACRO is recommended.
      839    10799              DESCRIPTION:   On attribute  reading pmmes this is essentially lost
      840    10800                             data, although nothing is transferred.  On the setting
      841    10801                             ones, all option values must be specified.              */
      842    10802    3                END;
      843    10803    2             ELSE RETURN;
      844    10804    2        CALL UDB$PMMEXIT;
      845    10805    2   NILE: ;
      846    10806    2        ALTRETURN;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:38   
      847    10807    2   END;
      848    10808        /**/
      849    10809        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:39   
      850    10810    1   NXTDCB: PROC ALTRET;
      851    10811        /**/
      852    10812    3        IF UCFLG<=0 THEN DO;
      853    10813    3             SDCB$=DCB$;
      854    10814    4             IF UCFLG=0 THEN DO;
      855    10815    4                  UCFLG=%M$UC#+1;
      856    10816    4                  TDCB$=B$ROSEG$->B$ROSEG.DCBPTR$;
      857    10817    4                END;
      858    10818    3             ELSE UCFLG=B$ROSEG$->B$ROSEG.NUMDCBS+1;
      859    10819    3             RETURN;
      860    10820    3           END;
      861    10821    3        ELSE DO UCFLG=UCFLG TO B$ROSEG$->B$ROSEG.NUMDCBS;
      862    10822    3             SDCB$=TDCB$->B$RODCB$(UCFLG);
      863    10823    4             IF SDCB$~=ADDR(NIL) THEN IF SDCB$->F$DCB.UCOUT THEN DO;
      864    10824    4                       UCFLG=UCFLG+1;
      865    10825    4                       RETURN;
      866    10826    4                     END;
      867    10827    3           END;
      868    10828    2        ALTRETURN;
      869    10829    2   END;
      870    10830        /**/
      871    10831    1   OPNPRO: PROC ALTRET;
      872    10832        /**/
      873    10833    2        B$JIT.DCB$=B$M$STAR$;
      874    10834    2        IF B$M$STAR$->F$DCB.FCD THEN CALL FMP$CLSF;
      875    10835    2        CALL FMM$SCRUB (B$M$STAR$);
      876    10836    2        B$M$STAR$->F$DCB.NAME=PRO;
      877    10837    2        B$M$STAR$->F$DCB.ACCT=':SYS';
      878    10838    2        B$M$STAR$->F$DCB.SHARE=%ALL#;
      879    10839    2        B$M$STAR$->F$DCB.ACS=%DIRECT#;
      880    10840    2        B$M$STAR$->F$DCB.ASN=%FILE#;
      881    10841    2        CALL FMM$DFLOPN;
      882    10842    2        IF NOT B$M$STAR$->F$DCB.FCD THEN ALTRETURN;
      883    10843    2        RETURN;
      884    10844    2   END OPNPRO;
      885    10845        /**/
      886    10846        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:40   
      887    10847
      888    10848        /* Internal entry point to set platen for user */
      889    10849    1   KIP$PLATEN: ENTRY(PMMECOD);
      890    10850    1        WIDTH=ADDR(PMMECOD)->VLP$PLATEN_V.WIDTH;
      891    10851    2        IF WIDTH~=255 THEN DO;
      892    10852    2             IF ADDR(PMMECOD)->VLP$PLATEN_V.EXTWID THEN WIDTH=WIDTH+254;
      893    10853    2             B$M$UC$->F$DCB.WIDTH=WIDTH;
      894    10854    2           END;
      895    10855    1        LENGTH=ADDR(PMMECOD)->VLP$PLATEN_V.LENGTH;
      896    10856    1        IF LENGTH~=255 THEN B$M$UC$->F$DCB.LINES=LENGTH;
      897    10857    1        RETURN;
      898    10858    1   END KIP$PMME;
      899    10859        /**/
      900    10860        /**/
      901    10861        %EOD;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:41   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   UD_EQU_E.:E05TOU  is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KIP$PMME.

   Procedure KIP$PMME requires 1494 words for executable code.
   Procedure KIP$PMME requires 100 words of local(AUTO) storage.
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:42   

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:43   

 Object Unit name= KIP$PMME                                   File name= KIP$PMME.:E05TOU
 UTS= JUL 30 '97 00:35:43.16 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     53     65  KIP$PMME
    2   Proc  even  none  1494   2726  KIP$PMME
    3  RoData even  none    47     57  KIP$PMME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        1  KIP$PMME
     2   2674                  yes      Std        1  KIP$PLATEN
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:44   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
         yes           Std       1 FMO$GETDOMAIN
 yes     yes           Std       4 OCU$RWUC
 yes     yes           Std       5 KIA$UCIO
         yes           Std       1 FMP$CLSF
 yes     yes           Std       2 HFF$WRITE1
         yes           Std       0 FMM$DFLOPN
 yes     yes           Std       5 KCI$TCTL
 yes     yes           Std       2 HFF$DSIZ
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       2 FMF$TYC
 yes     yes           Std       0 HFF$TRAPALT
         yes           Std       1 FMO$GETPFB
 yes     yes           Std       2 UMD$DBPRMT
 yes     yes           Std       2 KIA$WINDOW
 yes     yes           Std       1 M$MREAD
         yes           Std       1 FMD$GBUF
         yes           Std       1 FMD$RBUF
         yes           Std       0 UDB$PMMEXIT
         yes           Std       1 FMM$SCRUB
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:45   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  S$CU$                            r    K_RWPARM_CON
     N$DCT$$                          r    B$XL_UPPER_UR$                        B$JIT$
r    B$M$STAR$                        r    B$M$UC$                               B$PS2$
     B$PS0$                                B$PS3$                                B$PS4$
     B$ROSEG$                              B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:46   


        1        1        /*M* KIP$PMME Handler for terminal control pmmes */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        /**/
        9        9        /**/
       10       10        KIP$PMME: PROC (PMMECOD);

     10  2 000000   000000 700200 xent  KIP$PMME     TSX0  ! X66_AUTO_1
         2 000001   000144 000001                    ZERO    100,1

       11       11        /**/
       12       12        %INCLUDE B$JIT;
       13      302        %INCLUDE CP_6;
       14      383        %INCLUDE F$DCB;
       15      432        %INCLUDE B$ROSEG;
       16      495        %INCLUDE B$USER;
       17      711        %B$USERREFS;
       18      715        %INCLUDE KL_SUPER_C;
       19     3617        %INCLUDE SS_SCHED_C;
       20     3850        %INCLUDE B_STRINGS_C;
       21     3979        %INCLUDE KV_PRMID_E;
       22     4153        %KV_PRMID_E;
       23     4309        %INCLUDE NK_VFC_C;
       24     4383        %INCLUDE CP_6_SUBS;
       25     4923        %INCLUDE F_FPTCODE_C;
       26     4959        %INCLUDE F_FMTCODE_C;
       27     4993        %INCLUDE KI$CP6V_C;
       28     5432        %INCLUDE F$CP6V_C;
       29     5658        %INCLUDE KI_SUBS_C;
       30     5794        %INCLUDE KI_MACROS_C;
       31     6402        %INCLUDE K_DATA_R;
       32     7113        %INCLUDE KV$VDO;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:47   
       33     8128        %KV_VDO_ALL_E;
       34     8207        %INCLUDE NK$LDCT;
       35     8309             %NK$LDCT;
       36     8355        %INCLUDE NK_LDCT_R;
       37     8364        %INCLUDE NK_SUBS;
       38     8389        %INCLUDE B$TABLES_C;
       39     8497             %B$XL_UPPER_UR;
       40     8501        %INCLUDE UD_EQU_E;
       41     8890        /**/
       42     8891        /**/
       43     8892        %KL_PHDR (NAME=KL$PHDR,STCLASS="BASED DALIGNED");
       44     8933        %FPT$PROMPT_V;
       45     8945        %FPT$EOM_V;
       46     8958        %FPT$TRMCTL_V (BASED="BASED(B$PS0$)");
       47     8969        %FPT$TRMPRG_V;
       48     8981        %FPT$TRMISC_V;
       49     8991        %VLP$FLDATR_V (BASED="BASED(B$PS3$)");
       50     9008        %VLP$TAB_V;
       51     9011        %VLP$TRMCTL_V;
       52     9032        %VLP$EOMTABLE_V;
       53     9046        %VLP$LINEATTR_V;
       54     9059        %VLP$TRMATTR_V;
       55     9081        %VLP$PLATEN_V;
       56     9097        %VLP$WINDOW_V;
       57     9119        %VLP$EDTCTL_V;
       58     9139        %FPT$SINPUT_V (BASED="BASED(B$PS0$)");
       59     9155        %FPT$MDFFLD_V (BASED="BASED(B$PS0$)");
       60     9171        %FPT$DCLFLD_V (BASED="BASED(B$PS0$)");
       61     9191        %FPT$SLCFLD_V (BASED="BASED(B$PS0$)");
       62     9207        %FPT$RLSFLD_V (BASED="BASED(B$PS0$)");
       63     9223        %FPT$ERASE_V (BASED="BASED(B$PS0$)");
       64     9239    1   DCL 1 VEC BASED DALIGNED,
       65     9240    1            2 * UBIN,2 P$ PTR;
       66     9241        %VLP_NAME (FPTN=PRO,STCLASS=CONSTANT,NAME=':PRO');
       67     9268        %FPT_READ (FPTN=RDPC,STCLASS=CONSTANT,KEYS=YES);
       68     9307        %KI_VCHRPMT (NAME=VCHRPMT,SIZE=VLPSIZ);
       69     9315        /**/
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:48   
       70     9316    1   DCL PROBUF CHAR(4096) BASED;
       71     9317    1   DCL VCHRZ CHAR(VLPSIZ) BASED;
       72     9318    1   DCL 1 VTXTC BASED UNAL,
       73     9319    1            2 CNT UBIN BYTE UNAL,
       74     9320    1            2 TXT CHAR(VTXTC.CNT) UNAL;
       75     9321    1   DCL 1 VSIN BASED,
       76     9322    1            2 PFB UBIN BYTE CALIGNED,
       77     9323    1            2 RFU UBIN BYTE CALIGNED,
       78     9324    1            2 POS UBIN(18) CALIGNED,
       79     9325    1            2 POSL6 REDEF POS,
       80     9326    1                 3 T BIT(9), 3 * BIT(9),
       81     9327    1            2 POSL66 REDEF POS,
       82     9328    1                 3 * BIT(1),3 T BIT(9), 3 * BIT(8);
       83     9329    1   DCL 1 L6 BASED,
       84     9330    1            2 T UBIN BYTE CALIGNED;
       85     9331    1   DCL 1 L66 BASED,
       86     9332    1            2 T UBIN(10) CALIGNED;
       87     9333    1   DCL 1 VCHRET BASED,
       88     9334    1            2 PFB UBIN BYTE UNAL,
       89     9335    1            2 RFU BIT(10) UNAL,
       90     9336    1            2 SUPPHALT BIT(1) UNAL,
       91     9337    1            2 RSVD BIT(5) UNAL,
       92     9338    1            2 UNITS UBIN(2) UNAL,
       93     9339    1            2 TIMEOUT UBIN BYTE UNAL,
       94     9340    1            2 M CHAR(VLPSIZ) UNAL;
       95     9341    1   DCL 1 VCHRV BASED,
       96     9342    1            2 VFC CHAR(1) UNAL,
       97     9343    1            2 M CHAR(VLPSIZ) UNAL;
       98     9344        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:49   
       99     9345
      100     9346        /* AUTO and PARAMETER variables */
      101     9347
      102     9348    1   DCL PMMECOD UBIN PARAM;
      103     9349    1   DCL FPTCODE UBIN WORD;
      104     9350    1   DCL VLPSIZ UBIN WORD;
      105     9351    1   DCL 1 VLPSZB REDEF VLPSIZ,
      106     9352    1            2 * BIT(35) UNAL,
      107     9353    1            2 ODD UBIN(1) UNAL;
      108     9354    1   DCL PFB UBIN WORD;
      109     9355    1   DCL 1 TFCN REDEF PFB ALIGNED,
      110     9356    1            2 FCN UBIN(9) UNAL,
      111     9357    1            2 * UBIN(27) UNAL;
      112     9358    1   DCL TDCB$ REDEF PFB PTR;
      113     9359    1   DCL DCB$ PTR;
      114     9360    1   DCL LENGTH SBIN WORD;
      115     9361    1   DCL 1 TERR REDEF LENGTH,
      116     9362    1            2 FCGMID BIT(18) UNAL,
      117     9363    1            2 MON BIT(1) UNAL,
      118     9364    1            2 CODE UBIN(14) UNAL,
      119     9365    1            2 SEV UBIN(3) UNAL;
      120     9366    1   DCL WIDTH SBIN WORD;
      121     9367    1   DCL UCFLG SBIN WORD;
      122     9368    1   DCL MEDIA EPTR;
      123     9369    1   DCL SDCB$ PTR;
      124     9370    1   DCL BUF$ PTR;
      125     9371    1   DCL 1 IMPPROKEY,
      126     9372    1            2 KEYSZ UBIN BYTE UNAL,
      127     9373    1            2 KEY,
      128     9374    1                 3 NAME CHAR(11) UNAL,
      129     9375    1                 3 IMP# UBIN BYTE UNAL;
      130     9376    1   DCL 1 XPNAME REDEF IMPPROKEY,
      131     9377    1            2 CNT UBIN BYTE UNAL,
      132     9378    1            2 TXT CHAR (11),
      133     9379    1            2 * UBIN BYTE UNAL;
      134     9380    1   DCL IMP# UBIN;
      135     9381        %VLP_FLDATR (STCLASS=AUTO);
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:50   
      136     9407    1   DCL 1 TCTL ALIGNED,
      137     9408    1            2 T UBIN(9) UNAL,
      138     9409    1            2 L UBIN(9) UNAL,
      139     9410    1            2 LR REDEF L BIT(9) UNAL,
      140     9411    1            2 M CHAR(58) UNAL;
      141     9412        /* For M$PROMPT, large prompts will overlap into K$RWPARM */
      142     9413        %K$RWPARM (NAME=K$RWPARM,STCLASS=AUTO);
      143     9729        %FPT_READ (FPTN=RDPRO,STCLASS="");
      144     9768        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:51   
      145     9769
      146     9770        /* CONSTANT data */
      147     9771
      148     9772    1   DCL DPMT (0:3) CHAR(1) UNAL CONSTANT INIT('!','!','*','?');
      149     9773    1   DCL VFCDP (0:3) CHAR(1) UNAL CONSTANT INIT(%VFC_HDR0*2,%VFC_EXT*2);
      150     9774        %EQU FPT_OFFSET = 10;
      151     9775    1   DCL 1 VLPCTL(0:22) CONSTANT ALIGNED,
      152     9776    1            2 PCODE UBIN BYTE UNAL INIT(0*6, /* Spares */
      153     9777    1                                         %KV_PRMID_EDTCTL*2,%KV_PRMID_WINDOW*2,
      154     9778    1                                         %KV_PRMID_TRMCTL*2,%KV_PRMID_PROMPT,
      155     9779    1                                         %KV_PRMID_EOM,0,%KV_PRMID_LINEATTR,
      156     9780    1                                         %KV_PRMID_TRMATTR*2,%KV_PRMID_PLATEN,
      157     9781    1                                         %KV_PRMID_TRMTAB*2,%KV_PRMID_SINPUT,0),
      158     9782
      159     9783    1            2 MINVLP UBIN BYTE UNAL INIT       (0*6,
      160     9784    1                                                SIZEC(VLP$EDTCTL_V)*2,
      161     9785    1                                                SIZEC(VLP$WINDOW_V)*2,
      162     9786    1                                                SIZEC(VLP$TRMCTL_V)*2,0,0,
      163     9787    1                                                0,SIZEC(VLP$LINEATTR_V),
      164     9788    1                                                SIZEC(VLP$TRMATTR_V)*2,
      165     9789    1                                                SIZEC(VLP$PLATEN_V),
      166     9790    1                                                SIZEC(VLP$TAB_V)*2,
      167     9791    1                                                0,1),
      168     9792    1            2 MXVLP UBIN HALF UNAL INIT    (262143*6,
      169     9793    1                                            SIZEC(VLP$EDTCTL_V),262143,
      170     9794    1                                            SIZEC(VLP$WINDOW_V),262143,
      171     9795    1                                            SIZEC(VLP$TRMCTL_V),262143,95,
      172     9796    1                                            SIZEC(VLP$EOMTABLE_V),262143*2,
      173     9797    1                                            SIZEC(VLP$TRMATTR_V),262143,
      174     9798    1                                            SIZEC(VLP$PLATEN_V),
      175     9799    1                                            SIZEC(VLP$TAB_V),262143,4096,8);
      176     9800    1   DCL B$JIT$ PTR SYMREF;
      177     9801    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      178     9802    1   DCL B$M$UC$ PTR SYMREF READONLY;
      179     9803    1   DCL B$PS2$ PTR SYMREF;
      180     9804    1   DCL B$PS0$ PTR SYMREF;
      181     9805    1   DCL B$PS1$ PTR SYMREF;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:52   
      182     9806    1   DCL B$PS3$ PTR SYMREF;
      183     9807    1   DCL B$PS4$ PTR SYMREF;
      184     9808    1   DCL B$ROSEG$ PTR SYMREF;
      185     9809    1   DCL S_CUN UBIN WORD SYMREF;
      186     9810    1   DCL SSR$REG ENTRY(3) ALTRET;
      187     9811    1   DCL FMM$DFLOPN ENTRY;
      188     9812    1   DCL FMO$GETDOMAIN ENTRY(1);
      189     9813    1   DCL FMO$GETPFB ENTRY(1);
      190     9814    1   DCL FMP$CLSF ENTRY(1);
      191     9815    1   DCL FMF$TYC ENTRY(2);
      192     9816    1   DCL KIA$WINDOW ENTRY(2) ALTRET;
      193     9817    1   DCL OCU$RWUC ENTRY(4) ALTRET;
      194     9818    1   DCL KIA$UCIO ENTRY(5) ALTRET;
      195     9819    1   DCL KCI$TCTL ENTRY(5) ALTRET;
      196     9820    1   DCL KCI$CKSTAT ENTRY(3) ALTRET;
      197     9821    1   DCL UDB$PMMEXIT ENTRY;
      198     9822    1   DCL UMD$DBPRMT ENTRY(2) ALTRET;
      199     9823    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      200     9824    1   DCL HFF$DSIZ ENTRY(2) ALTRET;
      201     9825    1   DCL M$MREAD ENTRY(1) ALTRET;
      202     9826    1   DCL HFF$WRITE1 ENTRY(2) ALTRET;
      203     9827    1   DCL HFF$TRAPALT ENTRY ALTRET;
      204     9828    1   DCL FMD$GBUF ENTRY(1);
      205     9829    1   DCL FMD$RBUF ENTRY(1);
      206     9830    1   DCL FMM$SCRUB ENTRY(1);
      207     9831        /**/
      208     9832        /**/
      209     9833        %INCLUDE KI_ERRORS_C;
      210     9918        %INCLUDE F_ERRORS_C;
      211    10158        %INCLUDE UD_SEV_C;
      212    10172        /**/
      213    10173    1   DCL 1 NO_WRT CONSTANT ALIGNED,
      214    10174    1            2 FCG BIT(18) UNAL INIT('131120'O),
      215    10175    1            2 ERR UBIN(15) UNAL INIT(%E$NOACC),
      216    10176    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      217    10177    1   DCL 1 NOTTY CONSTANT ALIGNED,
      218    10178    1            2 FCG BIT(18) UNAL INIT('131120'O),
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:53   
      219    10179    1            2 ERR UBIN(15) UNAL INIT(%E$NOTTY),
      220    10180    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      221    10181    1   DCL 1 NOTTS CONSTANT ALIGNED,
      222    10182    1            2 FCG BIT(18) UNAL INIT('131120'O),
      223    10183    1            2 ERR UBIN(15) UNAL INIT(%E$NOTTS),
      224    10184    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      225    10185    1   DCL 1 MISOPT CONSTANT ALIGNED,
      226    10186    1            2 FCG BIT(18) UNAL INIT('131120'O),
      227    10187    1            2 ERR UBIN(15) UNAL INIT(%E$NILOPT),
      228    10188    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      229    10189    1   DCL 1 TOOBIG CONSTANT ALIGNED,
      230    10190    1            2 FCG BIT(18) UNAL INIT('131120'O),
      231    10191    1            2 ERR UBIN(15) UNAL INIT(%E$O2BIG),
      232    10192    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      233    10193    1   DCL 1 TOOSMALL CONSTANT ALIGNED,
      234    10194    1            2 FCG BIT(18) UNAL INIT('131120'O),
      235    10195    1            2 ERR UBIN(15) UNAL INIT(%E$O2SMALL),
      236    10196    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      237    10197    1   DCL 1 BPRTY CONSTANT ALIGNED,
      238    10198    1            2 FCG BIT(18) UNAL INIT('131120'O),
      239    10199    1            2 ERR UBIN(15) UNAL INIT(%E$BPROTYP),
      240    10200    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      241    10201    1   DCL 1 NKFUNC CONSTANT ALIGNED,
      242    10202    1            2 FCG BIT(18) UNAL INIT('131120'O),
      243    10203    1            2 ERR UBIN(15) UNAL INIT(%E$NKFUNC),
      244    10204    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      245    10205    1   DCL 1 ILGLNOTFORM CONSTANT ALIGNED,
      246    10206    1            2 FCG BIT(18) UNAL INIT('131120'O),
      247    10207    1            2 ERR UBIN(15) UNAL INIT(%E$ILGLNOTFORM),
      248    10208    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      249    10209    1   DCL 1 OUTPUTONLY CONSTANT ALIGNED,
      250    10210    1            2 FCG BIT(18) UNAL INIT('131120'O),
      251    10211    1            2 ERR UBIN(15) UNAL INIT(%E$OUTPUTONLY),
      252    10212    1            2 SEV UBIN(3) UNAL INIT(SEV_CONT#);
      253    10213        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:54   
      254    10214        /**/
      255    10215        /**/
      256    10216    1        DCB$=B$JIT$->B$JIT.DCB$;

  10216  2 000002   000000 470400 xsym               LDP0    B$JIT$
         2 000003   000232 236100                    LDQ     154,,PR0
         2 000004   200007 756100                    STQ     DCB$,,AUTO

      257    10217    2        IF NOT DCB$->F$DCB.FCD THEN DO;    /* MUST DO IMPLICIT OPEN              */

  10217  2 000005   200007 471500                    LDP1    DCB$,,AUTO
         2 000006   100031 236100                    LDQ     25,,PR1
         2 000007   020000 316007                    CANQ    8192,DL
         2 000010   000026 601000 2                  TNZ     s:10222

      258    10218    2             CALL FMO$GETDOMAIN(PFB);

  10218  2 000011   200006 633500                    EPPR3   PFB,,AUTO
         2 000012   200136 453500                    STP3    RDPRO+16,,AUTO
         2 000013   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 000014   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000015   000000 701000 xent               TSX1    FMO$GETDOMAIN
         2 000016   000000 011000                    NOP     0

      259    10219    2             DCB$->F$DCB.WSR=PFB;          /* Set current domain                 */

  10219  2 000017   200007 470500                    LDP0    DCB$,,AUTO
         2 000020   200006 236100                    LDQ     PFB,,AUTO
         2 000021   000022 736000                    QLS     18
         2 000022   000040 552120                    STBQ    32,'20'O,PR0

      260    10220    2             CALL FMM$DFLOPN;

  10220  2 000023   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000024   000000 701000 xent               TSX1    FMM$DFLOPN
         2 000025   000000 011000                    NOP     0

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:55   
      261    10221    2           END;

      262    10222    1        IF DCB$->F$DCB.FCD='0'B THEN RETURN;

  10222  2 000026   200007 470500                    LDP0    DCB$,,AUTO
         2 000027   000031 236100                    LDQ     25,,PR0
         2 000030   020000 316007                    CANQ    8192,DL
         2 000031   000033 601000 2                  TNZ     s:10223

  10222  2 000032   000000 702200 xent               TSX2  ! X66_ARET

      263    10223    1        SDCB$ = DCB$;                      /* Save the DCB                       */

  10223  2 000033   200007 236100                    LDQ     DCB$,,AUTO
         2 000034   200014 756100                    STQ     SDCB$,,AUTO

      264    10224    2        IF DCB$->F$DCB.IASN=%STREAM# THEN DO;

  10224  2 000035   000103 236100                    LDQ     67,,PR0
         2 000036   000777 376007                    ANQ     511,DL
         2 000037   000005 116007                    CMPQ    5,DL
         2 000040   000067 601000 2                  TNZ     s:10247

      265    10225    2             IF (DCB$->F$DCB.CFU$=B$M$UC$ AND B$M$UC$->F$DCB.MEDIA=FMTUC#)

  10225  2 000041   000066 236100                    LDQ     54,,PR0
         2 000042   000000 116000 xsym               CMPQ    B$M$UC$
         2 000043   000051 601000 2                  TNZ     s:10225+8
         2 000044   000000 471400 xsym               LDP1    B$M$UC$
         2 000045   100103 236100                    LDQ     67,,PR1
         2 000046   000777 376003                    ANQ     511,DU
         2 000047   000014 116003                    CMPQ    12,DU
         2 000050   000056 600000 2                  TZE     s:10227
         2 000051   000103 236100                    LDQ     67,,PR0
         2 000052   004000 316007                    CANQ    2048,DL
         2 000053   000063 600000 2                  TZE     BDFC
         2 000054   000067 430100                    FSZN    55,,PR0
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:56   
         2 000055   000063 605000 2                  TPL     BDFC

      266    10226    3                  OR (DCB$->F$DCB.CTLCMDIN AND DCB$->F$DCB.UCOUT) THEN DO;

      267    10227    3                  DCB$=B$M$UC$;

  10227  2 000056   000000 236000 xsym               LDQ     B$M$UC$
         2 000057   200007 756100                    STQ     DCB$,,AUTO

      268    10228    3                  B$JIT.DCB$=DCB$;

  10228  2 000060   000000 470400 xsym               LDP0    B$JIT$
         2 000061   000232 756100                    STQ     154,,PR0

      269    10229    3                END;

  10229  2 000062   000067 710000 2                  TRA     s:10247

      270    10230    3             ELSE DO;

      271    10231    3   BDFC:          ;

  10231  2 000063                       BDFC         null
      272    10232    3                  B$JIT$->B$JIT.ERR=NOTTS;

  10232  2 000063   000053 236000 1                  LDQ     NOTTS
         2 000064   000000 470400 xsym               LDP0    B$JIT$
         2 000065   000012 756100                    STQ     10,,PR0

      273    10233        /*E*  ERROR:         KIP-E$NOTTS-C
      274    10234               MESSAGE: You have no terminal to control!
      275    10235              MESSAGE1: The terminal control service requests are only legal
      276    10236                        if the user has a terminal to control.  This is not true
      277    10237                        if the job is BATCH or a system GHOST.  The best
      278    10238                        thing to do is ignore this CONTINUE severity error
      279    10239                        or use it to check mode.
      280    10240              DESCRIPTION:   This CONTINUE severity error is produced mainly
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:57   
      281    10241                             to provide an easy way to check mode by issuing
      282    10242                             an M$PROMPT pmme.  In this way, the JIT need not
      283    10243                             be INCLUDEd                                             */
      284    10244    3                  RETURN;

  10244  2 000066   000000 702200 xent               TSX2  ! X66_ARET

      285    10245    3                END;
      286    10246    2           END;
      287    10247    1        IF DCB$->F$DCB.IASN=0 THEN GOTO BDFC; /*DEVICE NO                     */

  10247  2 000067   200007 470500                    LDP0    DCB$,,AUTO
         2 000070   000103 236100                    LDQ     67,,PR0
         2 000071   000777 316007                    CANQ    511,DL
         2 000072   000063 600000 2                  TZE     BDFC

      288    10248    2        IF DCB$=B$M$UC$ THEN DO;

  10248  2 000073   200007 236100                    LDQ     DCB$,,AUTO
         2 000074   000000 116000 xsym               CMPQ    B$M$UC$
         2 000075   000127 601000 2                  TNZ     s:10264

      289    10249    2             IF B$JIT.MODE~=%M_INT# THEN GOTO BDFC;

  10249  2 000076   000000 471400 xsym               LDP1    B$JIT$
         2 000077   100000 236100                    LDQ     0,,PR1
         2 000100   740000 376003                    ANQ     -16384,DU
         2 000101   140000 116003                    CMPQ    49152,DU
         2 000102   000063 601000 2                  TNZ     BDFC

      290    10250    3             IF DCB$->F$DCB.ASN=%COMGROUP# THEN DO;

  10250  2 000103   000032 236100                    LDQ     26,,PR0
         2 000104   777000 376007                    ANQ     -512,DL
         2 000105   004000 116007                    CMPQ    2048,DL
         2 000106   000123 601000 2                  TNZ     s:10261

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:58   
      291    10251    4                  IF PMMECOD~=%C$PROMPT# AND PMMECOD~=%C$TRMISC# THEN DO;

  10251  2 000107   200003 473500                    LDP3    @PMMECOD,,AUTO
         2 000110   300000 235100                    LDA     0,,PR3
         2 000111   000002 115007                    CMPA    2,DL
         2 000112   000120 600000 2                  TZE     s:10259
         2 000113   000020 115007                    CMPA    16,DL
         2 000114   000120 600000 2                  TZE     s:10259

      292    10252    4                       B$JIT.ERR=NKFUNC;

  10252  2 000115   000060 236000 1                  LDQ     NKFUNC
         2 000116   100012 756100                    STQ     10,,PR1

      293    10253        /*E*  ERROR:    KIP-E$NKFUNC-C
      294    10254               MESSAGE: That terminal control service is not available to console ghosts
      295    10255              DESCRIPTION: KEYIN only process some terminal control PMMEs.
      296    10256                           Other functions must be performed via keyins              */
      297    10257    4                       RETURN;

  10257  2 000117   000000 702200 xent               TSX2  ! X66_ARET

      298    10258    4                     END;
      299    10259    3                  MEDIA=ENTADDR(OCU$RWUC);

  10259  2 000120   000000 636000 xent               EAQ     OCU$RWUC
         2 000121   200013 756100                    STQ     MEDIA,,AUTO

      300    10260    3                END;

  10260  2 000122   000125 710000 2                  TRA     s:10262

      301    10261    2             ELSE MEDIA=ENTADDR(KIA$UCIO);

  10261  2 000123   000000 636000 xent               EAQ     KIA$UCIO
         2 000124   200013 756100                    STQ     MEDIA,,AUTO

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:59   
      302    10262    2             UCFLG=0;

  10262  2 000125   200012 450100                    STZ     UCFLG,,AUTO

      303    10263    2           END;

  10263  2 000126   000151 710000 2                  TRA     s:10273

      304    10264    2        ELSE IF DCB$->F$DCB.ASN=%COMGROUP# THEN DO;

  10264  2 000127   000032 236100                    LDQ     26,,PR0
         2 000130   777000 376007                    ANQ     -512,DL
         2 000131   004000 116007                    CMPQ    2048,DL
         2 000132   000140 601000 2                  TNZ     s:10268

      305    10265    2                  MEDIA=ENTADDR(KCI$TCTL);

  10265  2 000133   000000 636000 xent               EAQ     KCI$TCTL
         2 000134   200013 756100                    STQ     MEDIA,,AUTO

      306    10266    2                  UCFLG=-1;

  10266  2 000135   000001 335007                    LCA     1,DL
         2 000136   200012 755100                    STA     UCFLG,,AUTO

      307    10267    2                END;

  10267  2 000137   000151 710000 2                  TRA     s:10273

      308    10268    2             ELSE IF DCB$->F$DCB.MEDIA=FMTUC# THEN DO;

  10268  2 000140   000103 236100                    LDQ     67,,PR0
         2 000141   000777 376003                    ANQ     511,DU
         2 000142   000014 116003                    CMPQ    12,DU
         2 000143   000063 601000 2                  TNZ     BDFC

      309    10269    2                       MEDIA=ENTADDR(KIA$UCIO);
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:60   

  10269  2 000144   000000 636000 xent               EAQ     KIA$UCIO
         2 000145   200013 756100                    STQ     MEDIA,,AUTO

      310    10270    2                       UCFLG=-1;

  10270  2 000146   000001 335007                    LCA     1,DL
         2 000147   200012 755100                    STA     UCFLG,,AUTO

      311    10271    2                     END;

  10271  2 000150   000151 710000 2                  TRA     s:10273

      312    10272    1                  ELSE GOTO BDFC;
      313    10273    1        DCB$->F$DCB.WAIT=1;

  10273  2 000151   000020 236007                    LDQ     16,DL
         2 000152   000064 256100                    ORSQ    52,,PR0

      314    10274    1        DCB$->F$DCB.TYC(1)='0'B;

  10274  2 000153   000002 450100                    STZ     2,,PR0

      315    10275    1        IF UCFLG < 0

  10275  2 000154   200012 235100                    LDA     UCFLG,,AUTO
         2 000155   000161 605000 2                  TPL     s:10279

      316    10276    1        THEN
      317    10277    1             PFB = KIDM_CP;

  10277  2 000156   000001 235007                    LDA     1,DL
         2 000157   200006 755100                    STA     PFB,,AUTO
         2 000160   000217 710000 2                  TRA     s:10296

      318    10278    2        ELSE DO;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:61   
      319    10279    2             IF SDCB$ = B$M$UC$

  10279  2 000161   200014 236100                    LDQ     SDCB$,,AUTO
         2 000162   000000 116000 xsym               CMPQ    B$M$UC$
         2 000163   000212 601000 2                  TNZ     s:10292

      320    10280    3             THEN DO;

      321    10281    3                  CALL FMO$GETPFB(PFB);

  10281  2 000164   200006 631500                    EPPR1   PFB,,AUTO
         2 000165   200136 451500                    STP1    RDPRO+16,,AUTO
         2 000166   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 000167   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000170   000000 701000 xent               TSX1    FMO$GETPFB
         2 000171   000000 011000                    NOP     0

      322    10282    3                  IF PFB = KIDM_CP

  10282  2 000172   200006 235100                    LDA     PFB,,AUTO
         2 000173   000001 115007                    CMPA    1,DL
         2 000174   000177 601000 2                  TNZ     s:10286

      323    10283    3                  THEN
      324    10284    3                       PFB = 0;

  10284  2 000175   200006 450100                    STZ     PFB,,AUTO
         2 000176   000206 710000 2                  TRA     s:10289

      325    10285    3                  ELSE
      326    10286    3                       IF NOT B$ROSEG$->B$ROSEG.STREAM_VALID(PFB)

  10286  2 000177   000000 470400 xsym               LDP0    B$ROSEG$
         2 000200   000000 066505                    CMPB    filb='0'B
         2 000201   000117 000001                    BDSC    79,A,PR0                 by=0,bit=0,n=1
         2 000202   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         2 000203   000206 601000 2                  TNZ     s:10289
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:62   

      327    10287    3                       THEN
      328    10288    3                            PFB = KIDM_CP;

  10288  2 000204   000001 236007                    LDQ     1,DL
         2 000205   200006 756100                    STQ     PFB,,AUTO

      329    10289    3                  DCB$->F$DCB.STR = PFB;

  10289  2 000206   200007 470500                    LDP0    DCB$,,AUTO
         2 000207   200006 236100                    LDQ     PFB,,AUTO
         2 000210   000077 552104                    STBQ    63,'04'O,PR0

      330    10290    3                END;

  10290  2 000211   000217 710000 2                  TRA     s:10296

      331    10291    3             ELSE DO;

      332    10292    3                  PFB = SDCB$->F$DCB.STR;

  10292  2 000212   200014 471500                    LDP1    SDCB$,,AUTO
         2 000213   100077 236100                    LDQ     63,,PR1
         2 000214   000777 376007                    ANQ     511,DL
         2 000215   200006 756100                    STQ     PFB,,AUTO

      333    10293    3                  DCB$->F$DCB.STR = PFB;

  10293  2 000216   000077 552104                    STBQ    63,'04'O,PR0

      334    10294    3                END;

      335    10295    2           END;

      336    10296    1        FPTCODE = PMMECOD+%FPT_OFFSET;

  10296  2 000217   200003 471500                    LDP1    @PMMECOD,,AUTO
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:63   
         2 000220   100000 235100                    LDA     0,,PR1
         2 000221   000012 035007                    ADLA    10,DL
         2 000222   200004 755100                    STA     FPTCODE,,AUTO

      337    10297        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:64   
      338    10298    2        DO CASE (PMMECOD);

  10298  2 000223   100000 235100                    LDA     0,,PR1
         2 000224   000034 115007                    CMPA    28,DL
         2 000225   000227 602005 2                  TNC     s:10298+4,AL
         2 000226   002427 710000 2                  TRA     s:10718
         2 000227   000715 710000 2                  TRA     s:10406
         2 000230   001172 710000 2                  TRA     s:10470
         2 000231   001315 710000 2                  TRA     s:10502
         2 000232   001424 710000 2                  TRA     s:10525
         2 000233   001456 710000 2                  TRA     s:10535
         2 000234   001207 710000 2                  TRA     GET_CMN
         2 000235   001025 710000 2                  TRA     s:10434
         2 000236   001207 710000 2                  TRA     GET_CMN
         2 000237   001233 710000 2                  TRA     s:10484
         2 000240   000705 710000 2                  TRA     s:10402
         2 000241   001207 710000 2                  TRA     GET_CMN
         2 000242   001507 710000 2                  TRA     s:10543
         2 000243   001673 710000 2                  TRA     s:10588
         2 000244   002427 710000 2                  TRA     s:10718
         2 000245   002427 710000 2                  TRA     s:10718
         2 000246   002427 710000 2                  TRA     s:10718
         2 000247   002303 710000 2                  TRA     s:10693
         2 000250   002427 710000 2                  TRA     s:10718
         2 000251   002427 710000 2                  TRA     s:10718
         2 000252   002427 710000 2                  TRA     s:10718
         2 000253   000263 710000 2                  TRA     s:10301
         2 000254   000353 710000 2                  TRA     s:10326
         2 000255   000370 710000 2                  TRA     s:10334
         2 000256   000565 710000 2                  TRA     s:10371
         2 000257   000607 710000 2                  TRA     s:10382
         2 000260   002427 710000 2                  TRA     s:10718
         2 000261   001111 710000 2                  TRA     s:10450
         2 000262   001312 710000 2                  TRA     s:10498

      339    10299    2        CASE (%C$DCLFLD#);

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:65   
      340    10300                                           /* Check to see if it is the ORG is form   */
      341    10301    2           IF SDCB$->F$DCB.ORG ~= %FORM#

  10301  2 000263   200014 473500                    LDP3    SDCB$,,AUTO
         2 000264   300032 236100                    LDQ     26,,PR3
         2 000265   777000 376003                    ANQ     -512,DU
         2 000266   031000 116003                    CMPQ    12800,DU
         2 000267   000274 600000 2                  TZE     s:10312

      342    10302    3           THEN DO;

  10301  2 000270                       NOTFORM      null
      343    10303    3   NOTFORM:     ;
      344    10304    3                B$JIT.ERR = ILGLNOTFORM;

  10304  2 000270   000061 236000 1                  LDQ     ILGLNOTFORM
         2 000271   000000 470400 xsym               LDP0    B$JIT$
         2 000272   000012 756100                    STQ     10,,PR0

      345    10305                       /*E* ERROR: KIP-E$ILGLNOTFORM
      346    10306                            MESSAGE: That PMME requires DCB% %DC%.ORG=FORM.
      347    10307                            MESSAGE1: M$DCLFLD, M$MDFFLD, M$RLSFLD, and M$SLCFLD
      348    10308                                      require that DCB% %DC%.ORG be FORM.
      349    10309                             */
      350    10310    3                RETURN;

  10310  2 000273   000000 702200 xent               TSX2  ! X66_ARET

      351    10311    3              END;
      352    10312    2           K$RWPARM = K_RWPARM_CON;

  10312  2 000274   000100 100400                    MLR     fill='000'O
         2 000275   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 000276   200046 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      353    10313    2           K$RWPARM.DVE.DVBYTE = FPT$DCLFLD_V.DVBYTE;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:66   
  10313  2 000277   000000 474400 xsym               LDP4    B$PS0$
         2 000300   400000 236100                    LDQ     0,,PR4
         2 000301   000033 736000                    QLS     27
         2 000302   200056 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

      354    10314    2           K$RWPARM.V$ = B$PS0$;

  10314  2 000303   000000 236000 xsym               LDQ     B$PS0$
         2 000304   200111 756100                    STQ     K$RWPARM+35,,AUTO

      355    10315    2           K$RWPARM.MSG$ = B$PS2$;

  10315  2 000305   000000 236000 xsym               LDQ     B$PS2$
         2 000306   200046 756100                    STQ     K$RWPARM,,AUTO

      356    10316    2           VLP_FLDATR = VLP$FLDATR_V;

  10316  2 000307   000000 475400 xsym               LDP5    B$PS3$
         2 000310   500000 237100                    LDAQ    0,,PR5
         2 000311   200024 757100                    STAQ    VLP_FLDATR,,AUTO

      357    10317    2           K$RWPARM.VLP$ = ADDR(VLP_FLDATR);

  10317  2 000312   200024 636500                    EPPR6   VLP_FLDATR,,AUTO
         2 000313   200104 456500                    STP6    K$RWPARM+30,,AUTO

      358    10318    2           CALL HFF$DSIZ(2,K$RWPARM.MSGSZ);

  10318  2 000314   200047 637500                    EPPR7   K$RWPARM+1,,AUTO
         2 000315   200137 457500                    STP7    RDPRO+17,,AUTO
         2 000316   000000 236000 3                  LDQ     0
         2 000317   200136 756100                    STQ     RDPRO+16,,AUTO
         2 000320   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 000321   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000322   000000 701000 xent               TSX1    HFF$DSIZ
         2 000323   000000 011000                    NOP     0

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:67   
      359    10319    2           TFCN.FCN = %KV_VDO_FNC_DCLFLD;

  10319  2 000324   007000 236003                    LDQ     3584,DU
         2 000325   200006 552140                    STBQ    PFB,'40'O,AUTO

      360    10320    2           B$JIT.DCB$=SDCB$;               /* Get FLDID back in the right DCB */

  10320  2 000326   200014 236100                    LDQ     SDCB$,,AUTO
         2 000327   000000 470400 xsym               LDP0    B$JIT$
         2 000330   000232 756100                    STQ     154,,PR0

      361    10321    2           CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));

  10321  2 000331   200046 631500                    EPPR1   K$RWPARM,,AUTO
         2 000332   200136 451500                    STP1    RDPRO+16,,AUTO
         2 000333   200136 633500                    EPPR3   RDPRO+16,,AUTO
         2 000334   200143 453500                    STP3    RDPRO+21,,AUTO
         2 000335   000002 236000 3                  LDQ     2
         2 000336   200142 756100                    STQ     RDPRO+20,,AUTO
         2 000337   000003 236000 3                  LDQ     3
         2 000340   200141 756100                    STQ     RDPRO+19,,AUTO
         2 000341   200006 634500                    EPPR4   PFB,,AUTO
         2 000342   200140 454500                    STP4    RDPRO+18,,AUTO
         2 000343   000004 236000 3                  LDQ     4
         2 000344   200137 756100                    STQ     RDPRO+17,,AUTO
         2 000345   200137 630500                    EPPR0   RDPRO+17,,AUTO
         2 000346   200013 220100                    LDX0    MEDIA,,AUTO
         2 000347   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000350   000000 701010                    TSX1    0,X0
         2 000351   000000 011000                    NOP     0

      362    10322    2           RETURN;

  10322  2 000352   000000 702200 xent               TSX2  ! X66_ARET

      363    10323
      364    10324        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:68   
      365    10325    2        CASE (%C$ERASE#);

      366    10326    2           K$RWPARM = K_RWPARM_CON;

  10326  2 000353   000100 100400                    MLR     fill='000'O
         2 000354   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 000355   200046 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      367    10327    2           K$RWPARM.DVE.DVBYTE = FPT$ERASE_V.DVBYTE;

  10327  2 000356   000000 473400 xsym               LDP3    B$PS0$
         2 000357   300000 236100                    LDQ     0,,PR3
         2 000360   000022 736000                    QLS     18
         2 000361   200056 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

      368    10328    2           K$RWPARM.KEYTYPE = FPT$ERASE_V.KEYTYPE;

  10328  2 000362   300000 236100                    LDQ     0,,PR3
         2 000363   000011 736000                    QLS     9
         2 000364   200114 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      369    10329    2           TFCN.FCN = %KV_VDO_FNC_ERS;

  10329  2 000365   014000 236003                    LDQ     6144,DU
         2 000366   200006 552140                    STBQ    PFB,'40'O,AUTO

      370    10330    2           GOTO CMNFLDSRV;

  10330  2 000367   000630 710000 2                  TRA     CMNFLDSRV

      371    10331
      372    10332        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:69   
      373    10333    2        CASE (%C$MDFFLD#);

      374    10334    2           IF SDCB$->F$DCB.ORG ~= %FORM#

  10334  2 000370   200014 473500                    LDP3    SDCB$,,AUTO
         2 000371   300032 236100                    LDQ     26,,PR3
         2 000372   777000 376003                    ANQ     -512,DU
         2 000373   031000 116003                    CMPQ    12800,DU
         2 000374   000270 601000 2                  TNZ     NOTFORM

      375    10335    2           THEN
      376    10336    2                GOTO NOTFORM;
      377    10337    2           K$RWPARM = K_RWPARM_CON;

  10337  2 000375   000100 100400                    MLR     fill='000'O
         2 000376   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 000377   200046 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      378    10338    2           K$RWPARM.DVE.DVBYTE = FPT$MDFFLD_V.DVBYTE;

  10338  2 000400   000000 474400 xsym               LDP4    B$PS0$
         2 000401   400001 236100                    LDQ     1,,PR4
         2 000402   200056 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

      379    10339    2           K$RWPARM.KEYTYPE = FPT$MDFFLD_V.KEYTYPE;

  10339  2 000403   400001 236100                    LDQ     1,,PR4
         2 000404   000011 772000                    QRL     9
         2 000405   200114 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      380    10340    2           IF K$RWPARM.KEYTYPE = 0

  10340  2 000406   200114 236100                    LDQ     K$RWPARM+38,,AUTO
         2 000407   777000 316007                    CANQ    -512,DL
         2 000410   000414 601000 2                  TNZ     s:10343

      381    10341    2           THEN
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:70   
      382    10342    2                K$RWPARM.KEYTYPE = SDCB$->F$DCB.KEYTYPE;

  10342  2 000411   300056 236100                    LDQ     46,,PR3
         2 000412   000011 772000                    QRL     9
         2 000413   200114 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      383    10343    2           K$RWPARM.V$ = B$PS0$;

  10343  2 000414   000000 236000 xsym               LDQ     B$PS0$
         2 000415   200111 756100                    STQ     K$RWPARM+35,,AUTO

      384    10344    2           VLP_FLDATR = B$PS4$->VLP$FLDATR_V;

  10344  2 000416   000000 475400 xsym               LDP5    B$PS4$
         2 000417   500000 237100                    LDAQ    0,,PR5
         2 000420   200024 757100                    STAQ    VLP_FLDATR,,AUTO

      385    10345    2           K$RWPARM.VLP$ = ADDR(VLP_FLDATR);

  10345  2 000421   200024 636500                    EPPR6   VLP_FLDATR,,AUTO
         2 000422   200104 456500                    STP6    K$RWPARM+30,,AUTO

      386    10346    2           K$RWPARM.MSG$ = B$PS2$;

  10346  2 000423   000000 236000 xsym               LDQ     B$PS2$
         2 000424   200046 756100                    STQ     K$RWPARM,,AUTO

      387    10347    2           CALL HFF$DSIZ(2,K$RWPARM.MSGSZ);

  10347  2 000425   200047 637500                    EPPR7   K$RWPARM+1,,AUTO
         2 000426   200137 457500                    STP7    RDPRO+17,,AUTO
         2 000427   000000 236000 3                  LDQ     0
         2 000430   200136 756100                    STQ     RDPRO+16,,AUTO
         2 000431   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 000432   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000433   000000 701000 xent               TSX1    HFF$DSIZ
         2 000434   000000 011000                    NOP     0
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:71   

      388    10348    2           CALL HFF$DSIZ(3,VLPSIZ);

  10348  2 000435   200005 630500                    EPPR0   VLPSIZ,,AUTO
         2 000436   200137 450500                    STP0    RDPRO+17,,AUTO
         2 000437   000005 236000 3                  LDQ     5
         2 000440   200136 756100                    STQ     RDPRO+16,,AUTO
         2 000441   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 000442   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000443   000000 701000 xent               TSX1    HFF$DSIZ
         2 000444   000000 011000                    NOP     0

      389    10349    2           K$RWPARM.KEYSZ = MINIMUM(VLPSIZ,255);

  10349  2 000445   000377 236007                    LDQ     255,DL
         2 000446   200005 116100                    CMPQ    VLPSIZ,,AUTO
         2 000447   000452 602000 2                  TNC     s:10349+5
         2 000450   000452 600000 2                  TZE     s:10349+5
         2 000451   200005 236100                    LDQ     VLPSIZ,,AUTO
         2 000452   200114 552104                    STBQ    K$RWPARM+38,'04'O,AUTO

      390    10350    2           IF VLPSIZ~=0 THEN K$RWPARM.KEY$ = B$PS3$;

  10350  2 000453   200005 235100                    LDA     VLPSIZ,,AUTO
         2 000454   000457 600000 2                  TZE     s:10351

  10350  2 000455   000000 236000 xsym               LDQ     B$PS3$
         2 000456   200112 756100                    STQ     K$RWPARM+36,,AUTO

      391    10351    2           IF FPT$MDFFLD_V.SETGRPRND

  10351  2 000457   000000 470400 xsym               LDP0    B$PS0$
         2 000460   000001 236100                    LDQ     1,,PR0
         2 000461   400000 316007                    CANQ    -131072,DL
         2 000462   000507 600000 2                  TZE     s:10357

      392    10352    3           THEN DO;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:72   

      393    10353    3                TFCN.FCN = %KV_VDO_FNC_SLCGRPRND;

  10353  2 000463   032000 236003                    LDQ     13312,DU
         2 000464   200006 552140                    STBQ    PFB,'40'O,AUTO

      394    10354    3                CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));

  10354  2 000465   200046 631500                    EPPR1   K$RWPARM,,AUTO
         2 000466   200136 451500                    STP1    RDPRO+16,,AUTO
         2 000467   200136 633500                    EPPR3   RDPRO+16,,AUTO
         2 000470   200143 453500                    STP3    RDPRO+21,,AUTO
         2 000471   000002 236000 3                  LDQ     2
         2 000472   200142 756100                    STQ     RDPRO+20,,AUTO
         2 000473   000003 236000 3                  LDQ     3
         2 000474   200141 756100                    STQ     RDPRO+19,,AUTO
         2 000475   200006 634500                    EPPR4   PFB,,AUTO
         2 000476   200140 454500                    STP4    RDPRO+18,,AUTO
         2 000477   000004 236000 3                  LDQ     4
         2 000500   200137 756100                    STQ     RDPRO+17,,AUTO
         2 000501   200137 630500                    EPPR0   RDPRO+17,,AUTO
         2 000502   200013 220100                    LDX0    MEDIA,,AUTO
         2 000503   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000504   000000 701010                    TSX1    0,X0
         2 000505   000000 011000                    NOP     0

      395    10355    3                K$RWPARM.MSGSZ = 0;        /* Only send the data once.           */

  10355  2 000506   200047 450100                    STZ     K$RWPARM+1,,AUTO

      396    10356    3              END;

      397    10357    2           IF FPT$MDFFLD_V.SETQLF

  10357  2 000507   000000 470400 xsym               LDP0    B$PS0$
         2 000510   000001 236100                    LDQ     1,,PR0
         2 000511   200000 316007                    CANQ    65536,DL
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:73   
         2 000512   000537 600000 2                  TZE     s:10363

      398    10358    3           THEN DO;

      399    10359    3                TFCN.FCN = %KV_VDO_FNC_SLCQLF;

  10359  2 000513   033000 236003                    LDQ     13824,DU
         2 000514   200006 552140                    STBQ    PFB,'40'O,AUTO

      400    10360    3                CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));

  10360  2 000515   200046 631500                    EPPR1   K$RWPARM,,AUTO
         2 000516   200136 451500                    STP1    RDPRO+16,,AUTO
         2 000517   200136 633500                    EPPR3   RDPRO+16,,AUTO
         2 000520   200143 453500                    STP3    RDPRO+21,,AUTO
         2 000521   000002 236000 3                  LDQ     2
         2 000522   200142 756100                    STQ     RDPRO+20,,AUTO
         2 000523   000003 236000 3                  LDQ     3
         2 000524   200141 756100                    STQ     RDPRO+19,,AUTO
         2 000525   200006 634500                    EPPR4   PFB,,AUTO
         2 000526   200140 454500                    STP4    RDPRO+18,,AUTO
         2 000527   000004 236000 3                  LDQ     4
         2 000530   200137 756100                    STQ     RDPRO+17,,AUTO
         2 000531   200137 630500                    EPPR0   RDPRO+17,,AUTO
         2 000532   200013 220100                    LDX0    MEDIA,,AUTO
         2 000533   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000534   000000 701010                    TSX1    0,X0
         2 000535   000000 011000                    NOP     0

      401    10361    3                K$RWPARM.MSGSZ = 0;        /* Only send the data once.           */

  10361  2 000536   200047 450100                    STZ     K$RWPARM+1,,AUTO

      402    10362    3              END;

      403    10363    3           IF K$RWPARM.MSGSZ~=0 THEN DO;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:74   
  10363  2 000537   200047 235100                    LDA     K$RWPARM+1,,AUTO
         2 000540   000564 600000 2                  TZE     s:10367

      404    10364    3                TFCN.FCN = %KV_VDO_FNC_DAT;

  10364  2 000541   005000 236003                    LDQ     2560,DU
         2 000542   200006 552140                    STBQ    PFB,'40'O,AUTO

      405    10365    3                CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));

  10365  2 000543   200046 630500                    EPPR0   K$RWPARM,,AUTO
         2 000544   200136 450500                    STP0    RDPRO+16,,AUTO
         2 000545   200136 631500                    EPPR1   RDPRO+16,,AUTO
         2 000546   200143 451500                    STP1    RDPRO+21,,AUTO
         2 000547   000002 236000 3                  LDQ     2
         2 000550   200142 756100                    STQ     RDPRO+20,,AUTO
         2 000551   000003 236000 3                  LDQ     3
         2 000552   200141 756100                    STQ     RDPRO+19,,AUTO
         2 000553   200006 633500                    EPPR3   PFB,,AUTO
         2 000554   200140 453500                    STP3    RDPRO+18,,AUTO
         2 000555   000004 236000 3                  LDQ     4
         2 000556   200137 756100                    STQ     RDPRO+17,,AUTO
         2 000557   200137 630500                    EPPR0   RDPRO+17,,AUTO
         2 000560   200013 220100                    LDX0    MEDIA,,AUTO
         2 000561   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000562   000000 701010                    TSX1    0,X0
         2 000563   000000 011000                    NOP     0

      406    10366    3              END;

      407    10367    2           RETURN;

  10367  2 000564   000000 702200 xent               TSX2  ! X66_ARET

      408    10368
      409    10369        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:75   
      410    10370    2        CASE (%C$RLSFLD#);

      411    10371    2           IF SDCB$->F$DCB.ORG ~= %FORM#

  10371  2 000565   200014 473500                    LDP3    SDCB$,,AUTO
         2 000566   300032 236100                    LDQ     26,,PR3
         2 000567   777000 376003                    ANQ     -512,DU
         2 000570   031000 116003                    CMPQ    12800,DU
         2 000571   000270 601000 2                  TNZ     NOTFORM

      412    10372    2           THEN
      413    10373    2                GOTO NOTFORM;
      414    10374    2           K$RWPARM = K_RWPARM_CON;

  10374  2 000572   000100 100400                    MLR     fill='000'O
         2 000573   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 000574   200046 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      415    10375    2           K$RWPARM.DVE.DVBYTE = FPT$RLSFLD_V.DVBYTE;

  10375  2 000575   000000 474400 xsym               LDP4    B$PS0$
         2 000576   400000 236100                    LDQ     0,,PR4
         2 000577   000022 736000                    QLS     18
         2 000600   200056 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

      416    10376    2           K$RWPARM.KEYTYPE = FPT$RLSFLD_V.KEYTYPE;

  10376  2 000601   400000 236100                    LDQ     0,,PR4
         2 000602   000011 736000                    QLS     9
         2 000603   200114 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      417    10377    2           TFCN.FCN = %KV_VDO_FNC_RLSFLD;

  10377  2 000604   024000 236003                    LDQ     10240,DU
         2 000605   200006 552140                    STBQ    PFB,'40'O,AUTO

      418    10378    2           GOTO CMNFLDSRV;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:76   

  10378  2 000606   000630 710000 2                  TRA     CMNFLDSRV

      419    10379
      420    10380        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:77   
      421    10381    2        CASE (%C$SCLFLD#);

      422    10382    2           IF SDCB$->F$DCB.ORG ~= %FORM#

  10382  2 000607   200014 473500                    LDP3    SDCB$,,AUTO
         2 000610   300032 236100                    LDQ     26,,PR3
         2 000611   777000 376003                    ANQ     -512,DU
         2 000612   031000 116003                    CMPQ    12800,DU
         2 000613   000270 601000 2                  TNZ     NOTFORM

      423    10383    2           THEN
      424    10384    2                GOTO NOTFORM;
      425    10385    2           K$RWPARM = K_RWPARM_CON;

  10385  2 000614   000100 100400                    MLR     fill='000'O
         2 000615   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 000616   200046 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      426    10386    2           K$RWPARM.DVE.DVBYTE = FPT$SLCFLD_V.DVBYTE;

  10386  2 000617   000000 474400 xsym               LDP4    B$PS0$
         2 000620   400000 236100                    LDQ     0,,PR4
         2 000621   000022 736000                    QLS     18
         2 000622   200056 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

      427    10387    2           K$RWPARM.KEYTYPE = FPT$SLCFLD_V.KEYTYPE;

  10387  2 000623   400000 236100                    LDQ     0,,PR4
         2 000624   000011 736000                    QLS     9
         2 000625   200114 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      428    10388    2           TFCN.FCN = %KV_VDO_FNC_SLCFLD;

  10388  2 000626   031000 236003                    LDQ     12800,DU
         2 000627   200006 552140                    STBQ    PFB,'40'O,AUTO

  10388  2 000630                       CMNFLDSRV    null
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:78   
      429    10389    2   CMNFLDSRV: ;
      430    10390    2           IF K$RWPARM.KEYTYPE = 0

  10390  2 000630   200114 236100                    LDQ     K$RWPARM+38,,AUTO
         2 000631   777000 316007                    CANQ    -512,DL
         2 000632   000637 601000 2                  TNZ     s:10393

      431    10391    2           THEN
      432    10392    2                K$RWPARM.KEYTYPE = SDCB$->F$DCB.KEYTYPE;

  10392  2 000633   200014 473500                    LDP3    SDCB$,,AUTO
         2 000634   300056 236100                    LDQ     46,,PR3
         2 000635   000011 772000                    QRL     9
         2 000636   200114 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      433    10393    2           K$RWPARM.V$ = B$PS0$;

  10393  2 000637   000000 236000 xsym               LDQ     B$PS0$
         2 000640   200111 756100                    STQ     K$RWPARM+35,,AUTO

      434    10394    2           CALL HFF$DSIZ(2,VLPSIZ);

  10394  2 000641   200005 633500                    EPPR3   VLPSIZ,,AUTO
         2 000642   200137 453500                    STP3    RDPRO+17,,AUTO
         2 000643   000000 236000 3                  LDQ     0
         2 000644   200136 756100                    STQ     RDPRO+16,,AUTO
         2 000645   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 000646   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000647   000000 701000 xent               TSX1    HFF$DSIZ
         2 000650   000000 011000                    NOP     0

      435    10395    2           K$RWPARM.KEYSZ = MINIMUM(255,VLPSIZ);

  10395  2 000651   200005 236100                    LDQ     VLPSIZ,,AUTO
         2 000652   000377 116007                    CMPQ    255,DL
         2 000653   000656 602000 2                  TNC     s:10395+5
         2 000654   000656 600000 2                  TZE     s:10395+5
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:79   
         2 000655   000377 236007                    LDQ     255,DL
         2 000656   200114 552104                    STBQ    K$RWPARM+38,'04'O,AUTO

      436    10396    2           IF VLPSIZ~=0 THEN K$RWPARM.KEY$ = B$PS2$;

  10396  2 000657   200005 235100                    LDA     VLPSIZ,,AUTO
         2 000660   000663 600000 2                  TZE     s:10397

  10396  2 000661   000000 236000 xsym               LDQ     B$PS2$
         2 000662   200112 756100                    STQ     K$RWPARM+36,,AUTO

      437    10397    2           CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));

  10397  2 000663   200046 630500                    EPPR0   K$RWPARM,,AUTO
         2 000664   200136 450500                    STP0    RDPRO+16,,AUTO
         2 000665   200136 631500                    EPPR1   RDPRO+16,,AUTO
         2 000666   200143 451500                    STP1    RDPRO+21,,AUTO
         2 000667   000002 236000 3                  LDQ     2
         2 000670   200142 756100                    STQ     RDPRO+20,,AUTO
         2 000671   000003 236000 3                  LDQ     3
         2 000672   200141 756100                    STQ     RDPRO+19,,AUTO
         2 000673   200006 633500                    EPPR3   PFB,,AUTO
         2 000674   200140 453500                    STP3    RDPRO+18,,AUTO
         2 000675   000004 236000 3                  LDQ     4
         2 000676   200137 756100                    STQ     RDPRO+17,,AUTO
         2 000677   200137 630500                    EPPR0   RDPRO+17,,AUTO
         2 000700   200013 220100                    LDX0    MEDIA,,AUTO
         2 000701   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000702   000000 701010                    TSX1    0,X0
         2 000703   000000 011000                    NOP     0

      438    10398    2           RETURN;

  10398  2 000704   000000 702200 xent               TSX2  ! X66_ARET

      439    10399
      440    10400        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:80   
      441    10401    2        CASE(%C$STRMTAB#);

      442    10402    2           CALL VLPCK ALTRET (NOVEC);

  10402  2 000705   002507 701000 2                  TSX1    VLPCK
         2 000706   002503 702000 2                  TSX2    NOVEC

      443    10403    2           ADDR(TCTL.M)->VCHRZ=B$PS2$->VCHRZ;

  10403  2 000707   000000 470400 xsym               LDP0    B$PS2$
         2 000710   200005 720100                    LXL0    VLPSIZ,,AUTO
         2 000711   040140 100540                    MLR     fill='040'O
         2 000712   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 000713   200026 400010                    ADSC9   TCTL,,AUTO               cn=2,n=*X0
         2 000714   002430 710000 2                  TRA     CSEND

      444    10404        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:81   
      445    10405    2        CASE(%C$STRMCTL#);

      446    10406    2           IF FPT$TRMCTL_V.VLPTYPE ~= %TRMCTL_TRMCTL#

  10406  2 000715   000000 473400 xsym               LDP3    B$PS0$
         2 000716   300000 720100                    LXL0    0,,PR3
         2 000717   000731 600000 2                  TZE     s:10409
         2 000720   000006 100003                    CMPX0   6,DU
         2 000721   000731 603000 2                  TRC     s:10409

      447    10407    2                AND FPT$TRMCTL_V.VLPTYPE <= %FPT_OFFSET/2
      448    10408    2           THEN FPTCODE = FPTCODE-2*FPT$TRMCTL_V.VLPTYPE;

  10408  2 000722   300000 236100                    LDQ     0,,PR3
         2 000723   000001 736000                    QLS     1
         2 000724   000006 376000 3                  ANQ     6
         2 000725   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 000726   000001 036007                    ADLQ    1,DL
         2 000727   200004 036100                    ADLQ    FPTCODE,,AUTO
         2 000730   200004 756100                    STQ     FPTCODE,,AUTO

      449    10409    2           CALL VLPCK ALTRET(NOVEC);

  10409  2 000731   002507 701000 2                  TSX1    VLPCK
         2 000732   002503 702000 2                  TSX2    NOVEC

      450    10410    2           ADDR(TCTL.M)->VCHRZ=B$PS2$->VCHRZ;

  10410  2 000733   000000 470400 xsym               LDP0    B$PS2$
         2 000734   200005 720100                    LXL0    VLPSIZ,,AUTO
         2 000735   040140 100540                    MLR     fill='040'O
         2 000736   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 000737   200026 400010                    ADSC9   TCTL,,AUTO               cn=2,n=*X0

      451    10411    3           IF FPTCODE=%C$STRMCTL# +%FPT_OFFSET THEN DO;

  10411  2 000740   200004 235100                    LDA     FPTCODE,,AUTO
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:82   
         2 000741   000012 115007                    CMPA    10,DL
         2 000742   000770 601000 2                  TNZ     s:10421

      452    10412    3                IF UCFLG~=0 THEN EXIT;

  10412  2 000743   200012 236100                    LDQ     UCFLG,,AUTO
         2 000744   000770 601000 2                  TNZ     s:10421

      453    10413    3                IF ADDR(TCTL.M)->VLP$TRMCTL_V.SINPUTSZ~=255

  10413  2 000745   200030 236100                    LDQ     TCTL+2,,AUTO
         2 000746   377000 376003                    ANQ     130560,DU
         2 000747   377000 116003                    CMPQ    130560,DU
         2 000750   000755 600000 2                  TZE     s:10415

      454    10414    3                THEN B$JIT.SINPUTSZ = ADDR(TCTL.M)->VLP$TRMCTL_V.SINPUTSZ;

  10414  2 000751   000000 471400 xsym               LDP1    B$JIT$
         2 000752   200030 236100                    LDQ     TCTL+2,,AUTO
         2 000753   377000 376003                    ANQ     130560,DU
         2 000754   100156 552140                    STBQ    110,'40'O,PR1

      455    10415    3                IF NOT ADDR(TCTL.M)->VLP$TRMCTL_V.OUTPUTDISCARD

  10415  2 000755   200026 236100                    LDQ     TCTL,,AUTO
         2 000756   000003 316007                    CANQ    3,DL
         2 000757   000770 601000 2                  TNZ     s:10421
         2 000760   200007 471500                    LDP1    DCB$,,AUTO
         2 000761   100051 221100                    LDX1    41,,PR1
         2 000762   000000 473400 xsym               LDP3    N$DCT$$
         2 000763   300000 474511                    LDP4    0,X1,PR3
         2 000764   400017 222100                    LDX2    15,,PR4
         2 000765   000770 601000 2                  TNZ     s:10421

      456    10416    3                     AND NK$LDCT$(DCB$->F$DCB.LDCTX)->LDCT.TH.MAXRCRBYTSIZ=0
      457    10417        /* If OUTPUTDISCARD's going off, wait for a response before attempting output,
      458    10418           by simulating an output blocked state. */
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:83   
      459    10419    3                THEN NK$LDCT$(DCB$->F$DCB.LDCTX)->LDCT.TH.MAXNMBRCR=0;

  10419  2 000766   000000 223003                    LDX3    0,DU
         2 000767   400016 443100                    SXL3    14,,PR4

      460    10420    3              END;

      461    10421    3           IF FPTCODE = %C$STRMCTL# +%FPT_OFFSET-2*%TRMCTL_WINDOW# THEN DO;

  10421  2 000770   000010 115007                    CMPA    8,DL
         2 000771   001007 601000 2                  TNZ     s:10426

      462    10422    3                ADDR(TCTL.M)->VLP$WINDOW_V.POSITION = 0;

  10422  2 000772   000000 236003                    LDQ     0,DU
         2 000773   200030 552110                    STBQ    TCTL+2,'10'O,AUTO

      463    10423    3                CALL KIA$WINDOW (PFB,TCTL.M);

  10423  2 000774   200140 452500                    STP2    RDPRO+18,,AUTO
         2 000775   200140 236100                    LDQ     RDPRO+18,,AUTO
         2 000776   000007 036000 3                  ADLQ    7
         2 000777   200137 756100                    STQ     RDPRO+17,,AUTO
         2 001000   200006 631500                    EPPR1   PFB,,AUTO
         2 001001   200136 451500                    STP1    RDPRO+16,,AUTO
         2 001002   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 001003   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001004   000000 701000 xent               TSX1    KIA$WINDOW
         2 001005   000000 011000                    NOP     0

      464    10424    3                RETURN;

  10424  2 001006   000000 702200 xent               TSX2  ! X66_ARET

      465    10425    3              END;
      466    10426    3           ELSE IF FPTCODE = %C$STRMCTL# +%FPT_OFFSET-2*%TRMCTL_EDTCTL# THEN DO;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:84   
  10426  2 001007   000006 115007                    CMPA    6,DL
         2 001010   002430 601000 2                  TNZ     CSEND

      467    10427    3                     IF ADDR(TCTL.M)->VLP$EDTCTL_V.KEYTYPE~=255

  10427  2 001011   200026 236100                    LDQ     TCTL,,AUTO
         2 001012   000777 376007                    ANQ     511,DL
         2 001013   000377 116007                    CMPQ    255,DL
         2 001014   001021 600000 2                  TZE     s:10429

      468    10428    3                     THEN SDCB$->F$DCB.KEYTYPE = ADDR(TCTL.M)->VLP$EDTCTL_V.KEYTYPE;

  10428  2 001015   200014 471500                    LDP1    SDCB$,,AUTO
         2 001016   200026 236100                    LDQ     TCTL,,AUTO
         2 001017   000022 736000                    QLS     18
         2 001020   100056 552120                    STBQ    46,'20'O,PR1

      469    10429    3                     ADDR(ADDR(TCTL.M)->VLP$EDTCTL_V.KEYINCR)->L6.T =

  10429  2 001021   200030 236100                    LDQ     TCTL+2,,AUTO
         2 001022   000001 736000                    QLS     1
         2 001023   200030 552140                    STBQ    TCTL+2,'40'O,AUTO

      470    10430    3                          ADDR(ADDR(TCTL.M)->VLP$EDTCTL_V.KEYINCR)->L66.T;
      471    10431    3                   END;

  10431  2 001024   002430 710000 2                  TRA     CSEND

      472    10432        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:85   
      473    10433    2        CASE(%C$STRMATTR#);

      474    10434    2           CALL VLPCK ALTRET(NOVEC);

  10434  2 001025   002507 701000 2                  TSX1    VLPCK
         2 001026   002503 702000 2                  TSX2    NOVEC

      475    10435    2           IF B$PS2$->VLP$TRMATTR_V.SPEED~=255 AND UCFLG=0 THEN

  10435  2 001027   000000 470400 xsym               LDP0    B$PS2$
         2 001030   000002 236100                    LDQ     2,,PR0
         2 001031   377000 376007                    ANQ     130560,DL
         2 001032   377000 116007                    CMPQ    130560,DL
         2 001033   001043 600000 2                  TZE     s:10437
         2 001034   200012 235100                    LDA     UCFLG,,AUTO
         2 001035   001043 601000 2                  TNZ     s:10437

      476    10436    2                B$JIT$->B$JIT.TSLINE.SPEED=B$PS2$->VLP$TRMATTR_V.SPEED;

  10436  2 001036   000000 471400 xsym               LDP1    B$JIT$
         2 001037   000002 236100                    LDQ     2,,PR0
         2 001040   377000 376007                    ANQ     130560,DL
         2 001041   000011 736000                    QLS     9
         2 001042   100337 552120                    STBQ    223,'20'O,PR1

      477    10437    2           ADDR(TCTL.M)->VCHRZ=B$PS2$->VCHRZ;

  10437  2 001043   200005 720100                    LXL0    VLPSIZ,,AUTO
         2 001044   040140 100540                    MLR     fill='040'O
         2 001045   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 001046   200026 400010                    ADSC9   TCTL,,AUTO               cn=2,n=*X0

      478    10438    3           DO WHILE ('1'B);

      479    10439    3                CALL NXTDCB ALTRET (CSEND);

  10439  2 001047   002552 701000 2                  TSX1    NXTDCB
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:86   
         2 001050   002430 702000 2                  TSX2    CSEND

      480    10440    3                IF B$PS2$->VLP$TRMATTR_V.TRUOVRPRT~='01'B THEN

  10440  2 001051   000000 470400 xsym               LDP0    B$PS2$
         2 001052   000000 236100                    LDQ     0,,PR0
         2 001053   000300 376007                    ANQ     192,DL
         2 001054   000100 116007                    CMPQ    64,DL
         2 001055   001064 600000 2                  TZE     s:10442

      481    10441    3                     SDCB$->F$DCB.ATTR.TRUOVRPRT=B$PS2$->VLP$TRMATTR_V.TRUOVRPRT;

  10441  2 001056   200014 471500                    LDP1    SDCB$,,AUTO
         2 001057   000000 236100                    LDQ     0,,PR0
         2 001060   000004 772000                    QRL     4
         2 001061   100040 676100                    ERQ     32,,PR1
         2 001062   000010 376007                    ANQ     8,DL
         2 001063   100040 656100                    ERSQ    32,,PR1

      482    10442    3                IF B$PS2$->VLP$TRMATTR_V.APL~='01'B THEN

  10442  2 001064   000000 236100                    LDQ     0,,PR0
         2 001065   000060 376007                    ANQ     48,DL
         2 001066   000020 116007                    CMPQ    16,DL
         2 001067   001076 600000 2                  TZE     s:10444

      483    10443    3                     SDCB$->F$DCB.ATTR.APL=B$PS2$->VLP$TRMATTR_V.APL;

  10443  2 001070   200014 471500                    LDP1    SDCB$,,AUTO
         2 001071   000000 236100                    LDQ     0,,PR0
         2 001072   000003 772000                    QRL     3
         2 001073   100040 676100                    ERQ     32,,PR1
         2 001074   000004 376007                    ANQ     4,DL
         2 001075   100040 656100                    ERSQ    32,,PR1

      484    10444    3                IF B$PS2$->VLP$TRMATTR_V.LOWERCASEPRINTS~='01'B THEN

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:87   
  10444  2 001076   000000 236100                    LDQ     0,,PR0
         2 001077   000003 376007                    ANQ     3,DL
         2 001100   000001 116007                    CMPQ    1,DL
         2 001101   001047 600000 2                  TZE     s:10439

      485    10445    3                    SDCB$->F$DCB.ATTR.LOWERCASE=B$PS2$->VLP$TRMATTR_V.LOWERCASEPRINTS;

  10445  2 001102   200014 471500                    LDP1    SDCB$,,AUTO
         2 001103   000000 236100                    LDQ     0,,PR0
         2 001104   000001 772000                    QRL     1
         2 001105   100040 676100                    ERQ     32,,PR1
         2 001106   000001 376007                    ANQ     1,DL
         2 001107   100040 656100                    ERSQ    32,,PR1

      486    10446    3              END;

  10446  2 001110   001047 710000 2                  TRA     s:10439

      487    10447
      488    10448        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:88   
      489    10449    2        CASE (%C$GPROMPT#);

      490    10450    2           FPTCODE = %C$TRMPRG#+%FPT_OFFSET; /* Unused slot in VLPCTL table */

  10450  2 001111   000016 236007                    LDQ     14,DL
         2 001112   200004 756100                    STQ     FPTCODE,,AUTO

      491    10451    2           CALL VLPCK ALTRET(NOVEC);

  10451  2 001113   002507 701000 2                  TSX1    VLPCK
         2 001114   002503 702000 2                  TSX2    NOVEC

      492    10452    2           DCB$->F$DCB.UB$ = B$PS2$;

  10452  2 001115   000000 236000 xsym               LDQ     B$PS2$
         2 001116   200007 470500                    LDP0    DCB$,,AUTO
         2 001117   000075 756100                    STQ     61,,PR0

      493    10453    2           DCB$->F$DCB.UBYTES = VLPSIZ;

  10453  2 001120   200005 235100                    LDA     VLPSIZ,,AUTO
         2 001121   000076 755100                    STA     62,,PR0

      494    10454    2           CALL MEDIA (MFC_RSTAT,0,VLPCTL.PCODE(%C$PROMPT#+%FPT_OFFSET),0)

  10454  2 001122   000010 630400 3                  EPPR0   8
         2 001123   200013 220100                    LDX0    MEDIA,,AUTO
         2 001124   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 001125   000000 701010                    TSX1    0,X0
         2 001126   002451 702000 2                  TSX2    ERRCHK

      495    10455    2                ALTRET(ERRCHK);
      496    10456    2           B$PS0$->FPT$PROMPT_V.DVBYTE = DCB$->F$DCB.UB$->VCHRPMT.DVBYTE;

  10456  2 001127   200007 470500                    LDP0    DCB$,,AUTO
         2 001130   000075 471500                    LDP1    61,,PR0
         2 001131   000000 473400 xsym               LDP3    B$PS0$
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:89   
         2 001132   000100 100500                    MLR     fill='000'O
         2 001133   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         2 001134   300002 000001                    ADSC9   2,,PR3                   cn=0,n=1

      497    10457    2           LENGTH = DCB$->F$DCB.ARS;

  10457  2 001135   000000 235100                    LDA     0,,PR0
         2 001136   200010 755100                    STA     LENGTH,,AUTO

      498    10458    2           IF B$PS0$->FPT$PROMPT_V.DVBYTE.VFC

  10458  2 001137   300002 236100                    LDQ     2,,PR3
         2 001140   100000 316003                    CANQ    32768,DU
         2 001141   001156 600000 2                  TZE     s:10464

      499    10459    3           THEN DO;

      500    10460    3                B$PS2$->VCHRZ = SUBSTR(B$PS2$->VCHRZ,2,VLPSIZ-2);

  10460  2 001142   200005 720100                    LXL0    VLPSIZ,,AUTO
         2 001143   777776 621010                    EAX1    -2,X0
         2 001144   000000 471400 xsym               LDP1    B$PS2$
         2 001145   200005 722100                    LXL2    VLPSIZ,,AUTO
         2 001146   040140 100540                    MLR     fill='040'O
         2 001147   100000 400011                    ADSC9   0,,PR1                   cn=2,n=*X1
         2 001150   100000 000012                    ADSC9   0,,PR1                   cn=0,n=*X2

      501    10461    3                SDCB$->F$DCB.ARS = DCB$->F$DCB.ARS - 2;

  10461  2 001151   200014 471500                    LDP1    SDCB$,,AUTO
         2 001152   000000 235100                    LDA     0,,PR0
         2 001153   000002 135007                    SBLA    2,DL
         2 001154   100000 755100                    STA     0,,PR1

      502    10462    3              END;

  10462  2 001155   001171 710000 2                  TRA     s:10467
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:90   

      503    10463    3           ELSE DO;

      504    10464    3                B$PS2$->VCHRZ = SUBSTR(B$PS2$->VCHRZ,3,VLPSIZ-3);

  10464  2 001156   200005 720100                    LXL0    VLPSIZ,,AUTO
         2 001157   777775 621010                    EAX1    -3,X0
         2 001160   000000 471400 xsym               LDP1    B$PS2$
         2 001161   200005 722100                    LXL2    VLPSIZ,,AUTO
         2 001162   040140 100540                    MLR     fill='040'O
         2 001163   100000 600011                    ADSC9   0,,PR1                   cn=3,n=*X1
         2 001164   100000 000012                    ADSC9   0,,PR1                   cn=0,n=*X2

      505    10465    3                SDCB$->F$DCB.ARS = DCB$->F$DCB.ARS - 3;

  10465  2 001165   200014 471500                    LDP1    SDCB$,,AUTO
         2 001166   000000 235100                    LDA     0,,PR0
         2 001167   000003 135007                    SBLA    3,DL
         2 001170   100000 755100                    STA     0,,PR1

      506    10466    3              END;

      507    10467    2           GOTO ERRCHK;

  10467  2 001171   002451 710000 2                  TRA     ERRCHK

      508    10468        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:91   
      509    10469    2        CASE (%C$GTRMCTL#);

      510    10470    2           IF FPT$TRMCTL_V.VLPTYPE ~= %TRMCTL_TRMCTL#

  10470  2 001172   000000 473400 xsym               LDP3    B$PS0$
         2 001173   300000 720100                    LXL0    0,,PR3
         2 001174   001206 600000 2                  TZE     s:10473
         2 001175   000006 100003                    CMPX0   6,DU
         2 001176   001206 603000 2                  TRC     s:10473

      511    10471    2                AND FPT$TRMCTL_V.VLPTYPE <= %FPT_OFFSET/2
      512    10472    2           THEN FPTCODE = FPTCODE-2*FPT$TRMCTL_V.VLPTYPE;

  10472  2 001177   300000 236100                    LDQ     0,,PR3
         2 001200   000001 736000                    QLS     1
         2 001201   000006 376000 3                  ANQ     6
         2 001202   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 001203   000001 036007                    ADLQ    1,DL
         2 001204   200004 036100                    ADLQ    FPTCODE,,AUTO
         2 001205   200004 756100                    STQ     FPTCODE,,AUTO

      513    10473    2           GOTO GET_CMN;

  10473  2 001206   001207 710000 2                  TRA     GET_CMN

      514    10474        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:92   
      515    10475    2        CASE (%C$GLINEATTR#, %C$GTRMATTR#, %C$GTRMTAB#);

  10473  2 001207                       GET_CMN      null
      516    10476    2   GET_CMN: ;
      517    10477    2           CALL VLPCK ALTRET (NOVEC);

  10477  2 001207   002507 701000 2                  TSX1    VLPCK
         2 001210   002503 702000 2                  TSX2    NOVEC

      518    10478    2           DCB$->F$DCB.UB$=B$PS2$;

  10478  2 001211   000000 236000 xsym               LDQ     B$PS2$
         2 001212   200007 470500                    LDP0    DCB$,,AUTO
         2 001213   000075 756100                    STQ     61,,PR0

      519    10479    2           DCB$->F$DCB.UBYTES=VLPSIZ;

  10479  2 001214   200005 235100                    LDA     VLPSIZ,,AUTO
         2 001215   000076 755100                    STA     62,,PR0

      520    10480    2           CALL MEDIA (MFC_RSTAT,0,VLPCTL.PCODE(FPTCODE),0);

  10480  2 001216   000002 236000 3                  LDQ     2
         2 001217   200141 756100                    STQ     RDPRO+19,,AUTO
         2 001220   200004 720100                    LXL0    FPTCODE,,AUTO
         2 001221   000022 631410 1                  EPPR1   VLPCTL,X0
         2 001222   200140 451500                    STP1    RDPRO+18,,AUTO
         2 001223   000010 237000 3                  LDAQ    8
         2 001224   200136 757100                    STAQ    RDPRO+16,,AUTO
         2 001225   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 001226   200013 221100                    LDX1    MEDIA,,AUTO
         2 001227   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 001230   000000 701011                    TSX1    0,X1
         2 001231   000000 011000                    NOP     0

      521    10481    2           GOTO ERRCHK;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:93   
  10481  2 001232   002451 710000 2                  TRA     ERRCHK

      522    10482        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:94   
      523    10483    2        CASE(%C$PLATEN#);

      524    10484    2           CALL VLPCK ALTRET (NOVEC);

  10484  2 001233   002507 701000 2                  TSX1    VLPCK
         2 001234   002503 702000 2                  TSX2    NOVEC

      525    10485    2           ADDR(TCTL.M)->VCHRZ=B$PS2$->VCHRZ;

  10485  2 001235   000000 470400 xsym               LDP0    B$PS2$
         2 001236   200005 720100                    LXL0    VLPSIZ,,AUTO
         2 001237   040140 100540                    MLR     fill='040'O
         2 001240   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 001241   200026 400010                    ADSC9   TCTL,,AUTO               cn=2,n=*X0

      526    10486    2           WIDTH=B$PS2$->VLP$PLATEN_V.WIDTH;

  10486  2 001242   000000 236100                    LDQ     0,,PR0
         2 001243   000033 772000                    QRL     27
         2 001244   000377 376007                    ANQ     255,DL
         2 001245   200011 756100                    STQ     WIDTH,,AUTO

      527    10487    2           IF WIDTH=255 THEN WIDTH=-1;

  10487  2 001246   000377 116007                    CMPQ    255,DL
         2 001247   001253 601000 2                  TNZ     s:10488

  10487  2 001250   000001 335007                    LCA     1,DL
         2 001251   200011 755100                    STA     WIDTH,,AUTO
         2 001252   001257 710000 2                  TRA     s:10489

      528    10488    2           ELSE IF B$PS2$->VLP$PLATEN_V.EXTWID THEN WIDTH=WIDTH+254;

  10488  2 001253   000001 430100                    FSZN    1,,PR0
         2 001254   001257 605000 2                  TPL     s:10489

  10488  2 001255   000376 236007                    LDQ     254,DL
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:95   
         2 001256   200011 056100                    ASQ     WIDTH,,AUTO

      529    10489    2           LENGTH=B$PS2$->VLP$PLATEN_V.LENGTH;

  10489  2 001257   000000 236100                    LDQ     0,,PR0
         2 001260   000022 772000                    QRL     18
         2 001261   000377 376007                    ANQ     255,DL
         2 001262   200010 756100                    STQ     LENGTH,,AUTO

      530    10490    2           IF LENGTH=255 THEN LENGTH=-1;

  10490  2 001263   000377 116007                    CMPQ    255,DL
         2 001264   001267 601000 2                  TNZ     s:10491

  10490  2 001265   000001 335007                    LCA     1,DL
         2 001266   200010 755100                    STA     LENGTH,,AUTO

      531    10491    3           IF LENGTH+WIDTH~=-2 THEN DO WHILE ('1'B);

  10491  2 001267   200010 236100                    LDQ     LENGTH,,AUTO
         2 001270   200011 036100                    ADLQ    WIDTH,,AUTO
         2 001271   000014 116000 3                  CMPQ    12
         2 001272   002430 600000 2                  TZE     CSEND

      532    10492    3                CALL NXTDCB ALTRET (CSEND);

  10492  2 001273   002552 701000 2                  TSX1    NXTDCB
         2 001274   002430 702000 2                  TSX2    CSEND

      533    10493    3                IF WIDTH~=-1 THEN SDCB$->F$DCB.WIDTH=WIDTH;

  10493  2 001275   200011 235100                    LDA     WIDTH,,AUTO
         2 001276   000027 115000 xsym               CMPA    B_VECTNIL+23
         2 001277   001303 600000 2                  TZE     s:10494

  10493  2 001300   200014 470500                    LDP0    SDCB$,,AUTO
         2 001301   200011 236100                    LDQ     WIDTH,,AUTO
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:96   
         2 001302   000004 552104                    STBQ    4,'04'O,PR0

      534    10494    3                IF LENGTH~=-1 THEN SDCB$->F$DCB.LINES=LENGTH;

  10494  2 001303   200010 236100                    LDQ     LENGTH,,AUTO
         2 001304   000027 116000 xsym               CMPQ    B_VECTNIL+23
         2 001305   001273 600000 2                  TZE     s:10492

  10494  2 001306   000000 620006                    EAX0    0,QL
         2 001307   200014 470500                    LDP0    SDCB$,,AUTO
         2 001310   000044 740100                    STX0    36,,PR0

      535    10495    3              END;

  10495  2 001311   001273 710000 2                  TRA     s:10492

      536    10496        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:97   
      537    10497    2        CASE(%C$GPLATEN#);

      538    10498    2           FPTCODE = %C$PLATEN#+%FPT_OFFSET;

  10498  2 001312   000022 236007                    LDQ     18,DL
         2 001313   200004 756100                    STQ     FPTCODE,,AUTO

      539    10499    2           GOTO GET_CMN;

  10499  2 001314   001207 710000 2                  TRA     GET_CMN

      540    10500        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:98   
      541    10501    2        CASE (%C$PROMPT#);

      542    10502    2           ADDR(TCTL.M)->VCHRPMT.PFB=PFB;

  10502  2 001315   200006 236100                    LDQ     PFB,,AUTO
         2 001316   000011 736000                    QLS     9
         2 001317   200026 552110                    STBQ    TCTL,'10'O,AUTO

      543    10503    2           ADDR(TCTL.M)->VCHRPMT.DVBYTE=B$PS0$->FPT$PROMPT_V.DVBYTE;

  10503  2 001320   000000 473400 xsym               LDP3    B$PS0$
         2 001321   300002 236100                    LDQ     2,,PR3
         2 001322   000033 772000                    QRL     27
         2 001323   200026 552104                    STBQ    TCTL,'04'O,AUTO

      544    10504    2           CALL VLPCK;

  10504  2 001324   002507 701000 2                  TSX1    VLPCK
         2 001325   000000 011000                    NOP     0

      545    10505    3           IF VLPSIZ=0 THEN DO;

  10505  2 001326   200005 235100                    LDA     VLPSIZ,,AUTO
         2 001327   001350 601000 2                  TNZ     s:10511

      546    10506    3                IF PFB>3 THEN PFB = 2;

  10506  2 001330   200006 236100                    LDQ     PFB,,AUTO
         2 001331   000004 116007                    CMPQ    4,DL
         2 001332   001335 602000 2                  TNC     s:10507

  10506  2 001333   000002 235007                    LDA     2,DL
         2 001334   200006 755100                    STA     PFB,,AUTO

      547    10507    3                ADDR(TCTL.M)->VCHRPMT.VFC=VFCDP(PFB);

  10507  2 001335   200006 235100                    LDA     PFB,,AUTO
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:99   
         2 001336   040100 100405                    MLR     fill='040'O
         2 001337   000021 000001 1                  ADSC9   VFCDP,A                  cn=0,n=1
         2 001340   200027 000001                    ADSC9   TCTL+1,,AUTO             cn=0,n=1

      548    10508    3                VLPSIZ=1;

  10508  2 001341   000001 236007                    LDQ     1,DL
         2 001342   200005 756100                    STQ     VLPSIZ,,AUTO

      549    10509    3                ADDR(TCTL.M)->VCHRPMT.M=DPMT(PFB);

  10509  2 001343   000000 620006                    EAX0    0,QL
         2 001344   040140 100405                    MLR     fill='040'O
         2 001345   000020 000001 1                  ADSC9   DPMT,A                   cn=0,n=1
         2 001346   200027 200010                    ADSC9   TCTL+1,,AUTO             cn=1,n=*X0

      550    10510    3              END;

  10510  2 001347   001400 710000 2                  TRA     s:10520

      551    10511    3           ELSE IF B$PS0$->FPT$PROMPT_V.DVBYTE.VFC THEN DO;

  10511  2 001350   000000 470400 xsym               LDP0    B$PS0$
         2 001351   000002 236100                    LDQ     2,,PR0
         2 001352   100000 316003                    CANQ    32768,DU
         2 001353   001370 600000 2                  TZE     s:10517

      552    10512    3                     VLPSIZ=VLPSIZ-1;

  10512  2 001354   000001 135007                    SBLA    1,DL
         2 001355   200005 755100                    STA     VLPSIZ,,AUTO

      553    10513    3                     ADDR(TCTL.M)->VCHRPMT.VFC=B$PS2$->VCHRV.VFC;

  10513  2 001356   000000 471400 xsym               LDP1    B$PS2$
         2 001357   040100 100500                    MLR     fill='040'O
         2 001360   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:100  
         2 001361   200027 000001                    ADSC9   TCTL+1,,AUTO             cn=0,n=1

      554    10514    3                     ADDR(TCTL.M)->VCHRPMT.M=B$PS2$->VCHRV.M;

  10514  2 001362   000000 620005                    EAX0    0,AL
         2 001363   200005 721100                    LXL1    VLPSIZ,,AUTO
         2 001364   040140 100540                    MLR     fill='040'O
         2 001365   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
         2 001366   200027 200011                    ADSC9   TCTL+1,,AUTO             cn=1,n=*X1

      555    10515    3                   END;

  10515  2 001367   001400 710000 2                  TRA     s:10520

      556    10516    3                ELSE DO;

      557    10517    3                     ADDR(TCTL.M)->VCHRPMT.VFC=%VFC_EXT;

  10517  2 001370   100000 236003                    LDQ     32768,DU
         2 001371   200027 552140                    STBQ    TCTL+1,'40'O,AUTO

      558    10518    3                     ADDR(TCTL.M)->VCHRPMT.M=B$PS2$->VCHRZ;

  10518  2 001372   000000 471400 xsym               LDP1    B$PS2$
         2 001373   000000 620005                    EAX0    0,AL
         2 001374   200005 721100                    LXL1    VLPSIZ,,AUTO
         2 001375   040140 100540                    MLR     fill='040'O
         2 001376   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         2 001377   200027 200011                    ADSC9   TCTL+1,,AUTO             cn=1,n=*X1

      559    10519    3                   END;

      560    10520    2           IF B$JIT$->B$JIT.CPFLAGS1&%CP_DRIBBLE# AND UCFLG=0 THEN

  10520  2 001400   000000 470400 xsym               LDP0    B$JIT$
         2 001401   000143 236100                    LDQ     99,,PR0
         2 001402   000063 376000 1                  ANQ     OUTPUTONLY+1
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:101  
         2 001403   001420 600000 2                  TZE     s:10522
         2 001404   200012 235100                    LDA     UCFLG,,AUTO
         2 001405   001420 601000 2                  TNZ     s:10522

      561    10521    2                CALL UMD$DBPRMT(ADDR(TCTL.M)->VCHRPMT,VLPSIZ);

  10521  2 001406   200005 631500                    EPPR1   VLPSIZ,,AUTO
         2 001407   200137 451500                    STP1    RDPRO+17,,AUTO
         2 001410   200140 452500                    STP2    RDPRO+18,,AUTO
         2 001411   200140 236100                    LDQ     RDPRO+18,,AUTO
         2 001412   000007 036000 3                  ADLQ    7
         2 001413   200136 756100                    STQ     RDPRO+16,,AUTO
         2 001414   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 001415   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001416   000000 701000 xent               TSX1    UMD$DBPRMT
         2 001417   000000 011000                    NOP     0

      562    10522    2           VLPSIZ=VLPSIZ+3;

  10522  2 001420   200005 235100                    LDA     VLPSIZ,,AUTO
         2 001421   000003 035007                    ADLA    3,DL
         2 001422   200005 755100                    STA     VLPSIZ,,AUTO
         2 001423   002430 710000 2                  TRA     CSEND

      563    10523        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:102  
      564    10524    2        CASE (%C$EOM#);

      565    10525    2           ADDR(TCTL.M)->VCHRET.PFB=PFB;

  10525  2 001424   200006 236100                    LDQ     PFB,,AUTO
         2 001425   000011 736000                    QLS     9
         2 001426   200026 552110                    STBQ    TCTL,'10'O,AUTO

      566    10526    2           ADDR(TCTL.M)->VCHRET.SUPPHALT=B$PS0$->FPT$EOM_V.SUPPHALT;

  10526  2 001427   000000 473400 xsym               LDP3    B$PS0$
         2 001430   300002 236100                    LDQ     2,,PR3
         2 001431   200027 676100                    ERQ     TCTL+1,,AUTO
         2 001432   200000 376003                    ANQ     65536,DU
         2 001433   200027 656100                    ERSQ    TCTL+1,,AUTO

      567    10527    2           ADDR(TCTL.M)->VCHRET.UNITS=B$PS0$->FPT$EOM_V.UTYPE;

  10527  2 001434   300002 236100                    LDQ     2,,PR3
         2 001435   200027 676100                    ERQ     TCTL+1,,AUTO
         2 001436   003000 376003                    ANQ     1536,DU
         2 001437   200027 656100                    ERSQ    TCTL+1,,AUTO

      568    10528    2           ADDR(TCTL.M)->VCHRET.TIMEOUT=B$PS0$->FPT$EOM_V.TIMEOUT;

  10528  2 001440   300002 236100                    LDQ     2,,PR3
         2 001441   000377 376003                    ANQ     255,DU
         2 001442   200027 552120                    STBQ    TCTL+1,'20'O,AUTO

      569    10529    2           CALL VLPCK ALTRET (NOEOM);

  10529  2 001443   002507 701000 2                  TSX1    VLPCK
         2 001444   001452 702000 2                  TSX2    NOEOM

      570    10530    2           ADDR(TCTL.M)->VCHRET.M=B$PS2$->VCHRZ;

  10530  2 001445   000000 470400 xsym               LDP0    B$PS2$
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:103  
         2 001446   200005 720100                    LXL0    VLPSIZ,,AUTO
         2 001447   040140 100540                    MLR     fill='040'O
         2 001450   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 001451   200027 400010                    ADSC9   TCTL+1,,AUTO             cn=2,n=*X0

  10530  2 001452                       NOEOM        null
      571    10531    2   NOEOM:  ;
      572    10532    2           VLPSIZ=VLPSIZ+4;

  10532  2 001452   200005 235100                    LDA     VLPSIZ,,AUTO
         2 001453   000004 035007                    ADLA    4,DL
         2 001454   200005 755100                    STA     VLPSIZ,,AUTO
         2 001455   002430 710000 2                  TRA     CSEND

      573    10533        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:104  
      574    10534    2        CASE (%C$TRMPRG#);

      575    10535    2           TFCN.FCN=%KV_VDO_FNC_DLT;

  10535  2 001456   011000 236003                    LDQ     4608,DU
         2 001457   200006 552140                    STBQ    PFB,'40'O,AUTO

      576    10536    2           K$RWPARM = K_RWPARM_CON;

  10536  2 001460   000100 100400                    MLR     fill='000'O
         2 001461   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 001462   200046 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      577    10537    2           K$RWPARM.V$ = ADDR(B$PS0$->FPT$TRMPRG_V);

  10537  2 001463   000000 236000 xsym               LDQ     B$PS0$
         2 001464   200111 756100                    STQ     K$RWPARM+35,,AUTO

      578    10538    2           CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));

  10538  2 001465   200046 633500                    EPPR3   K$RWPARM,,AUTO
         2 001466   200136 453500                    STP3    RDPRO+16,,AUTO
         2 001467   200136 634500                    EPPR4   RDPRO+16,,AUTO
         2 001470   200143 454500                    STP4    RDPRO+21,,AUTO
         2 001471   000002 236000 3                  LDQ     2
         2 001472   200142 756100                    STQ     RDPRO+20,,AUTO
         2 001473   000003 236000 3                  LDQ     3
         2 001474   200141 756100                    STQ     RDPRO+19,,AUTO
         2 001475   200006 635500                    EPPR5   PFB,,AUTO
         2 001476   200140 455500                    STP5    RDPRO+18,,AUTO
         2 001477   000004 236000 3                  LDQ     4
         2 001500   200137 756100                    STQ     RDPRO+17,,AUTO
         2 001501   200137 630500                    EPPR0   RDPRO+17,,AUTO
         2 001502   200013 220100                    LDX0    MEDIA,,AUTO
         2 001503   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 001504   000000 701010                    TSX1    0,X0
         2 001505   000000 011000                    NOP     0
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:105  

      579    10539    2           GOTO ERRCHK;

  10539  2 001506   002451 710000 2                  TRA     ERRCHK

      580    10540        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:106  
      581    10541
      582    10542    2        CASE (%C$SINPUT#);

      583    10543    2           DCB$->F$DCB.UB$=ADDR(B$JIT$);

  10543  2 001507   000015 236000 3                  LDQ     13
         2 001510   000075 756100                    STQ     61,,PR0

      584    10544    3           CALL VLPCK WHENRETURN DO;

  10544  2 001511   002507 701000 2                  TSX1    VLPCK
         2 001512   001516 702000 2                  TSX2    s:10547

      585    10545    3                DCB$->F$DCB.UB$=B$PS2$;

  10545  2 001513   000000 236000 xsym               LDQ     B$PS2$
         2 001514   200007 470500                    LDP0    DCB$,,AUTO
         2 001515   000075 756100                    STQ     61,,PR0

      586    10546    3              END;

      587    10547    2           DCB$->F$DCB.UBYTES = VLPSIZ;

  10547  2 001516   200007 470500                    LDP0    DCB$,,AUTO
         2 001517   200005 235100                    LDA     VLPSIZ,,AUTO
         2 001520   000076 755100                    STA     62,,PR0

      588    10548    2           IF MEDIA ~= ENTADDR(KIA$UCIO)

  10548  2 001521   000000 636000 xent               EAQ     KIA$UCIO
         2 001522   200013 116100                    CMPQ    MEDIA,,AUTO
         2 001523   001544 600000 2                  TZE     s:10553

      589    10549    2           THEN IF FPT$SINPUT_V.POSITION

  10549  2 001524   000000 471400 xsym               LDP1    B$PS0$
         2 001525   100000 236100                    LDQ     0,,PR1
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:107  
         2 001526   200000 316007                    CANQ    65536,DL
         2 001527   001536 600000 2                  TZE     s:10551

      590    10550    2                THEN CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SLLP,0);

  10550  2 001530   000020 630400 3                  EPPR0   16
         2 001531   200013 220100                    LDX0    MEDIA,,AUTO
         2 001532   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 001533   000000 701010                    TSX1    0,X0
         2 001534   000000 011000                    NOP     0
         2 001535   001672 710000 2                  TRA     s:10584

      591    10551    2                ELSE CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SLL,0);

  10551  2 001536   000025 630400 3                  EPPR0   21
         2 001537   200013 220100                    LDX0    MEDIA,,AUTO
         2 001540   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 001541   000000 701010                    TSX1    0,X0
         2 001542   000000 011000                    NOP     0
         2 001543   001672 710000 2                  TRA     s:10584

      592    10552    3           ELSE DO;

      593    10553    3                K$RWPARM = K_RWPARM_CON;

  10553  2 001544   000100 100400                    MLR     fill='000'O
         2 001545   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 001546   200046 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      594    10554    3                K$RWPARM.V$ = ADDR(TCTL);

  10554  2 001547   200026 631500                    EPPR1   TCTL,,AUTO
         2 001550   200111 451500                    STP1    K$RWPARM+35,,AUTO

      595    10555    3                K$RWPARM.VSZ = LENGTHC(VSIN);

  10555  2 001551   000004 220003                    LDX0    4,DU
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:108  
         2 001552   200113 740100                    STX0    K$RWPARM+37,,AUTO

      596    10556    3                K$RWPARM.PRMID = %KV_PRMID_SINPUT;

  10556  2 001553   000013 221003                    LDX1    11,DU
         2 001554   200113 441100                    SXL1    K$RWPARM+37,,AUTO

      597    10557    3                K$RWPARM.MSG$ = DCB$->F$DCB.UB$;

  10557  2 001555   000075 236100                    LDQ     61,,PR0
         2 001556   200046 756100                    STQ     K$RWPARM,,AUTO

      598    10558    3                K$RWPARM.MSGSZ = VLPSIZ;

  10558  2 001557   200047 755100                    STA     K$RWPARM+1,,AUTO

      599    10559    4                IF SDCB$->F$DCB.ORG=%SE# THEN DO;

  10559  2 001560   200014 473500                    LDP3    SDCB$,,AUTO
         2 001561   300032 236100                    LDQ     26,,PR3
         2 001562   777000 376003                    ANQ     -512,DU
         2 001563   027000 116003                    CMPQ    11776,DU
         2 001564   001630 601000 2                  TNZ     s:10574

      600    10560    4                     K$RWPARM.MSGSZ = 0;

  10560  2 001565   200047 450100                    STZ     K$RWPARM+1,,AUTO

      601    10561    4                     K$RWPARM.KEY$ = K$RWPARM.MSG$;

  10561  2 001566   200046 236100                    LDQ     K$RWPARM,,AUTO
         2 001567   200112 756100                    STQ     K$RWPARM+36,,AUTO

      602    10562    4                     K$RWPARM.KEYTYPE = SDCB$->F$DCB.KEYTYPE;

  10562  2 001570   300056 236100                    LDQ     46,,PR3
         2 001571   000011 772000                    QRL     9
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:109  
         2 001572   200114 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      603    10563    4                     K$RWPARM.KEYSZ = VLPSIZ;

  10563  2 001573   200005 236100                    LDQ     VLPSIZ,,AUTO
         2 001574   200114 552104                    STBQ    K$RWPARM+38,'04'O,AUTO

      604    10564    4                     K$RWPARM.DVE.DVBYTE = FPT$SINPUT_V.DVBYTE;

  10564  2 001575   000000 474400 xsym               LDP4    B$PS0$
         2 001576   400000 236100                    LDQ     0,,PR4
         2 001577   000033 736000                    QLS     27
         2 001600   200056 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

      605    10565    4                     IF VLPSIZ~=SDCB$->F$DCB.KEYL OR FPT$SINPUT_V.POSITION

  10565  2 001601   300036 236100                    LDQ     30,,PR3
         2 001602   000011 772000                    QRL     9
         2 001603   000777 376007                    ANQ     511,DL
         2 001604   200005 116100                    CMPQ    VLPSIZ,,AUTO
         2 001605   001611 601000 2                  TNZ     s:10567
         2 001606   400000 236100                    LDQ     0,,PR4
         2 001607   200000 316007                    CANQ    65536,DL
         2 001610   001630 600000 2                  TZE     s:10574

      606    10566    5                     THEN DO;

      607    10567    5                          IF VLPSIZ=0 THEN GOTO NOVEC;

  10567  2 001611   000000 115003                    CMPA    0,DU
         2 001612   002503 600000 2                  TZE     NOVEC

      608    10568    5                          IF VLPSIZ>SDCB$->F$DCB.KEYL

  10568  2 001613   300036 236100                    LDQ     30,,PR3
         2 001614   000011 772000                    QRL     9
         2 001615   000777 376007                    ANQ     511,DL
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:110  
         2 001616   200005 116100                    CMPQ    VLPSIZ,,AUTO
         2 001617   001624 603000 2                  TRC     s:10570

      609    10569    5                          THEN B$JIT$->B$JIT.ERR = TOOBIG;

  10569  2 001620   000055 236000 1                  LDQ     TOOBIG
         2 001621   000000 475400 xsym               LDP5    B$JIT$
         2 001622   500012 756100                    STQ     10,,PR5
         2 001623   001627 710000 2                  TRA     s:10571

      610    10570    5                          ELSE B$JIT$->B$JIT.ERR = TOOSMALL;

  10570  2 001624   000056 236000 1                  LDQ     TOOSMALL
         2 001625   000000 475400 xsym               LDP5    B$JIT$
         2 001626   500012 756100                    STQ     10,,PR5

      611    10571    5                          RETURN;

  10571  2 001627   000000 702200 xent               TSX2  ! X66_ARET

      612    10572    5                        END;
      613    10573    4                   END;
      614    10574    3                ADDR(TCTL)->VSIN.PFB = PFB;

  10574  2 001630   200006 236100                    LDQ     PFB,,AUTO
         2 001631   000033 736000                    QLS     27
         2 001632   200026 552140                    STBQ    TCTL,'40'O,AUTO

      615    10575    3                ADDR(TCTL)->VSIN.POS = FPT$SINPUT_V.REREADPOS;

  10575  2 001633   000000 474400 xsym               LDP4    B$PS0$
         2 001634   400001 722100                    LXL2    1,,PR4
         2 001635   200026 442100                    SXL2    TCTL,,AUTO

      616    10576    3                ADDR(TCTL)->VSIN.POSL6.T = ADDR(TCTL)->VSIN.POSL66.T;

  10576  2 001636   200026 236100                    LDQ     TCTL,,AUTO
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:111  
         2 001637   000001 736000                    QLS     1
         2 001640   200026 552110                    STBQ    TCTL,'10'O,AUTO

      617    10577    4                IF FPT$SINPUT_V.POSITION THEN DO;

  10577  2 001641   400000 236100                    LDQ     0,,PR4
         2 001642   200000 316007                    CANQ    65536,DL
         2 001643   001650 600000 2                  TZE     s:10581

      618    10578    4                     K$RWPARM.VSZ = LENGTHV(VSIN);

  10578  2 001644   000003 222003                    LDX2    3,DU
         2 001645   200113 742100                    STX2    K$RWPARM+37,,AUTO

      619    10579    4                     ADDR(TCTL)->VSIN.POS = 0;

  10579  2 001646   000000 223003                    LDX3    0,DU
         2 001647   200026 443100                    SXL3    TCTL,,AUTO

      620    10580    4                   END;

      621    10581    3                TFCN.FCN = %KV_VDO_FNC_PRM_SET;

  10581  2 001650   023000 236003                    LDQ     9728,DU
         2 001651   200006 552140                    STBQ    PFB,'40'O,AUTO

      622    10582    3                CALL KIA$UCIO (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));

  10582  2 001652   200046 635500                    EPPR5   K$RWPARM,,AUTO
         2 001653   200136 455500                    STP5    RDPRO+16,,AUTO
         2 001654   200136 636500                    EPPR6   RDPRO+16,,AUTO
         2 001655   200143 456500                    STP6    RDPRO+21,,AUTO
         2 001656   000002 236000 3                  LDQ     2
         2 001657   200142 756100                    STQ     RDPRO+20,,AUTO
         2 001660   000003 236000 3                  LDQ     3
         2 001661   200141 756100                    STQ     RDPRO+19,,AUTO
         2 001662   200006 637500                    EPPR7   PFB,,AUTO
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:112  
         2 001663   200140 457500                    STP7    RDPRO+18,,AUTO
         2 001664   000004 236000 3                  LDQ     4
         2 001665   200137 756100                    STQ     RDPRO+17,,AUTO
         2 001666   200137 630500                    EPPR0   RDPRO+17,,AUTO
         2 001667   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 001670   000000 701000 xent               TSX1    KIA$UCIO
         2 001671   000000 011000                    NOP     0

      623    10583    3              END;

      624    10584    2           RETURN;

  10584  2 001672   000000 702200 xent               TSX2  ! X66_ARET

      625    10585
      626    10586        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:113  
      627    10587    2        CASE (%C$PROFILE#);

      628    10588    2           CALL HFF$NILERASE (2) ALTRET (NOVEC);

  10588  2 001673   000000 630400 3                  EPPR0   0
         2 001674   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001675   000000 701000 xent               TSX1    HFF$NILERASE
         2 001676   002503 702000 2                  TSX2    NOVEC

      629    10589    2           CALL OPNPRO ALTRET (ERROUT);

  10589  2 001677   002622 701000 2                  TSX1    OPNPRO
         2 001700   002472 702000 2                  TSX2    ERROUT

      630    10590    2           DCB$->F$DCB.TYC(1)='0'B;

  10590  2 001701   200007 470500                    LDP0    DCB$,,AUTO
         2 001702   000002 450100                    STZ     2,,PR0

      631    10591    2           CALL FMD$GBUF(BUF$);

  10591  2 001703   200015 631500                    EPPR1   BUF$,,AUTO
         2 001704   200136 451500                    STP1    RDPRO+16,,AUTO
         2 001705   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 001706   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001707   000000 701000 xent               TSX1    FMD$GBUF
         2 001710   000000 011000                    NOP     0

      632    10592    2           CALL HFF$TRAPALT ALTRET (ONON);

  10592  2 001711   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001712   000000 701000 xent               TSX1    HFF$TRAPALT
         2 001713   001766 702000 2                  TSX2    ONON

      633    10593    2           VLPSIZ = 4096;

  10593  2 001714   010000 235007                    LDA     4096,DL
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:114  
         2 001715   200005 755100                    STA     VLPSIZ,,AUTO

      634    10594    2           RDPRO=RDPC;

  10594  2 001716   000100 100400                    MLR     fill='000'O
         2 001717   000002 000070 1                  ADSC9   RDPC                     cn=0,n=56
         2 001720   200116 000070                    ADSC9   RDPRO,,AUTO              cn=0,n=56

      635    10595    2           RDPRO.V.DCB#=%M$STAR#;

  10595  2 001721   000001 220003                    LDX0    1,DU
         2 001722   200126 740100                    STX0    RDPRO+8,,AUTO

      636    10596    2           ADDR(RDPRO.V_)->VEC.P$=ADDR(RDPRO.V);

  10596  2 001723   200126 630500                    EPPR0   RDPRO+8,,AUTO
         2 001724   200117 450500                    STP0    RDPRO+1,,AUTO

      637    10597    2           CALL XLATE (XPNAME.TXT, B$XL_UPPER_UR, B$PS2$->VTXTC.TXT);

  10597  2 001725   000000 471400 xsym               LDP1    B$PS2$
         2 001726   000100 101500                    MRL     fill='000'O
         2 001727   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         2 001730   200136 000002                    ADSC9   RDPRO+16,,AUTO           cn=0,n=2
         2 001731   200136 221100                    LDX1    RDPRO+16,,AUTO
         2 001732   000000 473400 xsym               LDP3    B$XL_UPPER_UR$
         2 001733   040100 160540                    MVT     fill='040'O
         2 001734   100000 200011                    ADSC9   0,,PR1                   cn=1,n=*X1
         2 001735   200016 200013                    ADSC9   IMPPROKEY,,AUTO          cn=1,n=11
         2 001736   300000 000100                    ARG     0,,PR3

      638    10598    2           XPNAME.CNT = B$PS2$->VTXTC.CNT;

  10598  2 001737   000100 100500                    MLR     fill='000'O
         2 001740   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         2 001741   200016 000001                    ADSC9   IMPPROKEY,,AUTO          cn=0,n=1

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:115  
      639    10599    2           RDPRO.KEY_ = VECTOR (XPNAME);

  10599  2 001742   000031 235000 3                  LDA     25
         2 001743   200136 452500                    STP2    RDPRO+16,,AUTO
         2 001744   200136 236100                    LDQ     RDPRO+16,,AUTO
         2 001745   000016 036003                    ADLQ    14,DU
         2 001746   200120 757100                    STAQ    RDPRO+2,,AUTO

      640    10600    2           IF XPNAME.CNT > 11

  10600  2 001747   200016 236100                    LDQ     IMPPROKEY,,AUTO
         2 001750   777000 376003                    ANQ     -512,DU
         2 001751   014000 116003                    CMPQ    6144,DU
         2 001752   001755 602000 2                  TNC     s:10602

      641    10601    2           THEN XPNAME.CNT = 11;

  10601  2 001753   013000 236003                    LDQ     5632,DU
         2 001754   200016 552140                    STBQ    IMPPROKEY,'40'O,AUTO

      642    10602    2           RDPRO.BUF_=VECTOR(BUF$->PROBUF);

  10602  2 001755   000032 235000 3                  LDA     26
         2 001756   200015 236100                    LDQ     BUF$,,AUTO
         2 001757   200122 757100                    STAQ    RDPRO+4,,AUTO

      643    10603    2           CALL M$MREAD (RDPRO) ALTRET (ONON);

  10603  2 001760   200116 634500                    EPPR4   RDPRO,,AUTO
         2 001761   200136 454500                    STP4    RDPRO+16,,AUTO
         2 001762   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 001763   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001764   000000 701000 xent               TSX1    M$MREAD
         2 001765   001766 702000 2                  TSX2    ONON

  10602  2 001766                       ONON         null
      644    10604    2   ONON:   ;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:116  
      645    10605    2           TERR=B$JIT.ERR;

  10605  2 001766   000000 470400 xsym               LDP0    B$JIT$
         2 001767   000012 236100                    LDQ     10,,PR0
         2 001770   200010 756100                    STQ     LENGTH,,AUTO

      646    10606    2           B$JIT.DCB$=DCB$;

  10606  2 001771   200007 236100                    LDQ     DCB$,,AUTO
         2 001772   000232 756100                    STQ     154,,PR0

      647    10607    3           IF TERR.CODE~=0 THEN DO;

  10607  2 001773   200010 236100                    LDQ     LENGTH,,AUTO
         2 001774   377770 316007                    CANQ    131064,DL
         2 001775   002024 600000 2                  TZE     s:10622

      648    10608    3                IF TERR.CODE = %E$NOKEY

  10608  2 001776   200010 236100                    LDQ     LENGTH,,AUTO
         2 001777   377770 376007                    ANQ     131064,DL
         2 002000   001020 116007                    CMPQ    528,DL
         2 002001   002004 601000 2                  TNZ     ONON1

      649    10609    4                THEN DO;

      650    10610    4                     TERR.FCGMID = '131120'O;

  10610  2 002002   131120 220003                    LDX0    45648,DU
         2 002003   200010 740100                    STX0    LENGTH,,AUTO

      651    10611    4                   END;

      652    10612        /*E*  ERROR:         KIP-E$NOKEY-E
      653    10613               MESSAGE: The specified PROFILE does not exist!
      654    10614              DESCRIPTION:   We went to M$MREAD to read :PRO using the profile
      655    10615                             name as a key, and FM said no such key.                 */
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:117  
      656    10616    3   ONON1:       CALL FMD$RBUF(BUF$);

  10616  2 002004   200015 630500       ONON1        EPPR0   BUF$,,AUTO
         2 002005   200136 450500                    STP0    RDPRO+16,,AUTO
         2 002006   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 002007   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002010   000000 701000 xent               TSX1    FMD$RBUF
         2 002011   000000 011000                    NOP     0

      657    10617    3                B$JIT.DCB$ = B$M$STAR$;

  10617  2 002012   000000 236000 xsym               LDQ     B$M$STAR$
         2 002013   000000 470400 xsym               LDP0    B$JIT$
         2 002014   000232 756100                    STQ     154,,PR0

      658    10618    3                CALL FMP$CLSF;

  10618  2 002015   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002016   000000 701000 xent               TSX1    FMP$CLSF
         2 002017   000000 011000                    NOP     0

      659    10619    3   ONON2:       B$JIT.ERR=TERR;

  10619  2 002020   200010 236100       ONON2        LDQ     LENGTH,,AUTO
         2 002021   000000 470400 xsym               LDP0    B$JIT$
         2 002022   000012 756100                    STQ     10,,PR0

      660    10620    3                GOTO ERROUT;

  10620  2 002023   002472 710000 2                  TRA     ERROUT

      661    10621    3              END;
      662    10622    2           IF MEDIA=ENTADDR(KIA$UCIO) AND UCFLG=0

  10622  2 002024   000000 636000 xent               EAQ     KIA$UCIO
         2 002025   200013 116100                    CMPQ    MEDIA,,AUTO
         2 002026   002057 601000 2                  TNZ     s:10645
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:118  
         2 002027   200012 235100                    LDA     UCFLG,,AUTO
         2 002030   002057 601000 2                  TNZ     s:10645

      663    10623    3           THEN DO;

      664    10624    3                IF NK$LDCT$(DCB$->F$DCB.LDCTX)->LDCT.TERMID.TTYP ~= BUF$->KL$PHDR.TTYP

  10624  2 002031   200007 471500                    LDP1    DCB$,,AUTO
         2 002032   100051 220100                    LDX0    41,,PR1
         2 002033   000000 473400 xsym               LDP3    N$DCT$$
         2 002034   300000 474510                    LDP4    0,X0,PR3
         2 002035   200015 475500                    LDP5    BUF$,,AUTO
         2 002036   500000 236100                    LDQ     0,,PR5
         2 002037   000033 772000                    QRL     27
         2 002040   200136 756100                    STQ     RDPRO+16,,AUTO
         2 002041   400022 236100                    LDQ     18,,PR4
         2 002042   000022 772000                    QRL     18
         2 002043   000777 376007                    ANQ     511,DL
         2 002044   200136 116100                    CMPQ    RDPRO+16,,AUTO
         2 002045   002051 600000 2                  TZE     s:10636

      665    10625    4                THEN DO;

      666    10626    4                     TERR=BPRTY;

  10626  2 002046   000057 236000 1                  LDQ     BPRTY
         2 002047   200010 756100                    STQ     LENGTH,,AUTO

      667    10627        /*E*  ERROR:         KIP-E$BPROTYP-C
      668    10628               MESSAGE: That PROFILE is impossible for your terminal!
      669    10629              MESSAGE1: Each PROFILE contains a code describing the types
      670    10630                        of terminals that it describes.  Should an attempt
      671    10631                        be made to (say) assign an IRBT profile to a timesharing
      672    10632                        terminal, the code does not match that of the
      673    10633                        terminal and this error results. */
      674    10634    4                     GOTO ONON1;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:119  
  10634  2 002050   002004 710000 2                  TRA     ONON1

      675    10635    4                   END;
      676    10636    3                IF NOT BUF$->KL$PHDR.IO.INPUT

  10636  2 002051   500001 236100                    LDQ     1,,PR5
         2 002052   400000 316007                    CANQ    -131072,DL
         2 002053   002057 601000 2                  TNZ     s:10645

      677    10637    4                THEN DO;

      678    10638    4                     TERR=OUTPUTONLY;

  10638  2 002054   000062 236000 1                  LDQ     OUTPUTONLY
         2 002055   200010 756100                    STQ     LENGTH,,AUTO

      679    10639                       /*E* ERROR: KIA-E$OUTPUTONLY-C
      680    10640                            MESSAGE: A time sharing profile must allow input.
      681    10641                        */
      682    10642    4                     GOTO ONON1;

  10642  2 002056   002004 710000 2                  TRA     ONON1

      683    10643    4                   END;
      684    10644    3              END;
      685    10645    2           DCB$->F$DCB.UB$=PINCRC(ADDR(BUF$->KL$PHDR),LENGTHC(KL$PHDR));

  10645  2 002057   200015 236100                    LDQ     BUF$,,AUTO
         2 002060   000024 036003                    ADLQ    20,DU
         2 002061   200007 471500                    LDP1    DCB$,,AUTO
         2 002062   100075 756100                    STQ     61,,PR1

      686    10646    2           DCB$->F$DCB.UBYTES=B$M$STAR$->F$DCB.ARS-LENGTHC(KL$PHDR);

  10646  2 002063   000000 473400 xsym               LDP3    B$M$STAR$
         2 002064   300000 235100                    LDA     0,,PR3
         2 002065   000120 135007                    SBLA    80,DL
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:120  
         2 002066   100076 755100                    STA     62,,PR1

      687    10647    2           IF MEDIA = ENTADDR (KCI$TCTL) THEN

  10647  2 002067   000000 636000 xent               EAQ     KCI$TCTL
         2 002070   200013 116100                    CMPQ    MEDIA,,AUTO
         2 002071   002106 601000 2                  TNZ     s:10650

      688    10648    2                CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SPR,0,BUF$);

  10648  2 002072   200015 634500                    EPPR4   BUF$,,AUTO
         2 002073   200142 454500                    STP4    RDPRO+20,,AUTO
         2 002074   000034 237000 3                  LDAQ    28
         2 002075   200140 757100                    STAQ    RDPRO+18,,AUTO
         2 002076   000020 237000 3                  LDAQ    16
         2 002077   200136 757100                    STAQ    RDPRO+16,,AUTO
         2 002100   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 002101   200013 220100                    LDX0    MEDIA,,AUTO
         2 002102   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 002103   000000 701010                    TSX1    0,X0
         2 002104   000000 011000                    NOP     0
         2 002105   002113 710000 2                  TRA     s:10651

      689    10649    2           ELSE
      690    10650    2                CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SPR,0);

  10650  2 002106   000036 630400 3                  EPPR0   30
         2 002107   200013 220100                    LDX0    MEDIA,,AUTO
         2 002110   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 002111   000000 701010                    TSX1    0,X0
         2 002112   000000 011000                    NOP     0

      691    10651    2           CALL HFF$DSIZ (3,VLPSIZ) ALTRET(NOPROVEC);

  10651  2 002113   200005 630500                    EPPR0   VLPSIZ,,AUTO
         2 002114   200137 450500                    STP0    RDPRO+17,,AUTO
         2 002115   000005 236000 3                  LDQ     5
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:121  
         2 002116   200136 756100                    STQ     RDPRO+16,,AUTO
         2 002117   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 002120   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002121   000000 701000 xent               TSX1    HFF$DSIZ
         2 002122   002150 702000 2                  TSX2    NOPROVEC

      692    10652    2           CALL HFF$WRITE1(3)

  10652  2 002123   000005 630400 3                  EPPR0   5
         2 002124   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002125   000000 701000 xent               TSX1    HFF$WRITE1
         2 002126   002130 702000 2                  TSX2    s:10654
         2 002127   002133 710000 2                  TRA     s:10657

      693    10653    3           WHENALTRETURN DO;

      694    10654    3                TERR=NO_WRT;

  10654  2 002130   000051 236000 1                  LDQ     NO_WRT
         2 002131   200010 756100                    STQ     LENGTH,,AUTO

      695    10655    3                GOTO ONON1;

  10655  2 002132   002004 710000 2                  TRA     ONON1

      696    10656    3              END;
      697    10657    2           VLPSIZ = MINIMUM(VLPSIZ,4096);

  10657  2 002133   010000 236007                    LDQ     4096,DL
         2 002134   200005 116100                    CMPQ    VLPSIZ,,AUTO
         2 002135   002140 602000 2                  TNC     s:10657+5
         2 002136   002140 600000 2                  TZE     s:10657+5
         2 002137   200005 236100                    LDQ     VLPSIZ,,AUTO
         2 002140   200005 756100                    STQ     VLPSIZ,,AUTO

      698    10658    2           B$PS3$->VCHRZ = BUF$->VCHRZ;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:122  
  10658  2 002141   200015 470500                    LDP0    BUF$,,AUTO
         2 002142   000000 620006                    EAX0    0,QL
         2 002143   000000 471400 xsym               LDP1    B$PS3$
         2 002144   200005 721100                    LXL1    VLPSIZ,,AUTO
         2 002145   040140 100540                    MLR     fill='040'O
         2 002146   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 002147   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

  10658  2 002150                       NOPROVEC     null
      699    10659    2   NOPROVEC: ;
      700    10660    2           IF DCB$->F$DCB.TYC(1)='0'B AND B$JIT.ERR.CODE=0

  10660  2 002150   200007 470500                    LDP0    DCB$,,AUTO
         2 002151   000002 235100                    LDA     2,,PR0
         2 002152   002277 601000 2                  TNZ     RTN
         2 002153   000000 471400 xsym               LDP1    B$JIT$
         2 002154   100012 236100                    LDQ     10,,PR1
         2 002155   377770 316007                    CANQ    131064,DL
         2 002156   002277 601000 2                  TNZ     RTN

      701    10661    3           THEN DO;

      702    10662    4                DO WHILE('1'B);

      703    10663    4                     CALL NXTDCB ALTRET (DOIMP);

  10663  2 002157   002552 701000 2                  TSX1    NXTDCB
         2 002160   002216 702000 2                  TSX2    DOIMP

      704    10664    4                     SDCB$->F$DCB.LINES=BUF$->KL$PHDR.LINES;

  10664  2 002161   200015 470500                    LDP0    BUF$,,AUTO
         2 002162   000000 720100                    LXL0    0,,PR0
         2 002163   200014 471500                    LDP1    SDCB$,,AUTO
         2 002164   100044 740100                    STX0    36,,PR1

      705    10665    4                     SDCB$->F$DCB.WIDTH=BUF$->KL$PHDR.WIDTH;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:123  

  10665  2 002165   000000 236100                    LDQ     0,,PR0
         2 002166   000022 772000                    QRL     18
         2 002167   100004 552104                    STBQ    4,'04'O,PR1

      706    10666    4                     SDCB$->F$DCB.ATTR.TRUOVRPRT=BUF$->KL$PHDR.ATTR.TRUOVRPRT;

  10666  2 002170   200015 470500                    LDP0    BUF$,,AUTO
         2 002171   000001 236100                    LDQ     1,,PR0
         2 002172   000022 772000                    QRL     18
         2 002173   100040 676100                    ERQ     32,,PR1
         2 002174   000010 376007                    ANQ     8,DL
         2 002175   100040 656100                    ERSQ    32,,PR1

      707    10667    4                     SDCB$->F$DCB.ATTR.APL=BUF$->KL$PHDR.ATTR.APL;

  10667  2 002176   000001 236100                    LDQ     1,,PR0
         2 002177   000022 772000                    QRL     18
         2 002200   100040 676100                    ERQ     32,,PR1
         2 002201   000004 376007                    ANQ     4,DL
         2 002202   100040 656100                    ERSQ    32,,PR1

      708    10668    4                     SDCB$->F$DCB.ATTR.BIN=BUF$->KL$PHDR.ATTR.BIN;

  10668  2 002203   000001 236100                    LDQ     1,,PR0
         2 002204   000022 772000                    QRL     18
         2 002205   100040 676100                    ERQ     32,,PR1
         2 002206   000002 376007                    ANQ     2,DL
         2 002207   100040 656100                    ERSQ    32,,PR1

      709    10669    4                     SDCB$->F$DCB.ATTR.LOWERCASE=BUF$->KL$PHDR.ATTR.LCASE;

  10669  2 002210   000001 236100                    LDQ     1,,PR0
         2 002211   000022 772000                    QRL     18
         2 002212   100040 676100                    ERQ     32,,PR1
         2 002213   000001 376007                    ANQ     1,DL
         2 002214   100040 656100                    ERSQ    32,,PR1
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:124  

      710    10670    4                   END;

  10670  2 002215   002157 710000 2                  TRA     s:10663

  10669  2 002216                       DOIMP        null
      711    10671    3   DOIMP:       ;
      712    10672    3                IMP# = BUF$->KL$PHDR.IMP#;

  10672  2 002216   200015 470500                    LDP0    BUF$,,AUTO
         2 002217   000001 236100                    LDQ     1,,PR0
         2 002220   000011 772000                    QRL     9
         2 002221   000177 376007                    ANQ     127,DL
         2 002222   200022 756100                    STQ     IMP#,,AUTO

      713    10673    3                IMPPROKEY.KEYSZ = LENGTHC(IMPPROKEY.KEY);

  10673  2 002223   014000 236003                    LDQ     6144,DU
         2 002224   200016 552140                    STBQ    IMPPROKEY,'40'O,AUTO

      714    10674    3                RDPRO.KEY_ = VECTOR(IMPPROKEY);

  10674  2 002225   000031 235000 3                  LDA     25
         2 002226   200136 452500                    STP2    RDPRO+16,,AUTO
         2 002227   200136 236100                    LDQ     RDPRO+16,,AUTO
         2 002230   000016 036003                    ADLQ    14,DU
         2 002231   200120 757100                    STAQ    RDPRO+2,,AUTO

      715    10675
      716    10676    4                DO IMPPROKEY.KEY.IMP# = 1 TO IMP#;

  10676  2 002232   001000 236003                    LDQ     512,DU
         2 002233   200021 552140                    STBQ    IMPPROKEY+3,'40'O,AUTO
         2 002234   002272 710000 2                  TRA     s:10686+3

      717    10677        /* M$* might have got closed to DRIBBLE the profile */
      718    10678    4                     IF NOT B$M$STAR$->F$DCB.FCD
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:125  

  10678  2 002235   000000 470400 xsym               LDP0    B$M$STAR$
         2 002236   000031 236100                    LDQ     25,,PR0
         2 002237   020000 316007                    CANQ    8192,DL
         2 002240   002243 601000 2                  TNZ     s:10681

      719    10679    4                     THEN CALL OPNPRO ALTRET(ONON1);

  10679  2 002241   002622 701000 2                  TSX1    OPNPRO
         2 002242   002004 702000 2                  TSX2    ONON1

      720    10680
      721    10681    4                     CALL M$MREAD (RDPRO) ALTRET(RTN);

  10681  2 002243   200116 630500                    EPPR0   RDPRO,,AUTO
         2 002244   200136 450500                    STP0    RDPRO+16,,AUTO
         2 002245   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 002246   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002247   000000 701000 xent               TSX1    M$MREAD
         2 002250   002277 702000 2                  TSX2    RTN

      722    10682    4                     DCB$->F$DCB.UB$ = BUF$;

  10682  2 002251   200015 236100                    LDQ     BUF$,,AUTO
         2 002252   200007 470500                    LDP0    DCB$,,AUTO
         2 002253   000075 756100                    STQ     61,,PR0

      723    10683    4                     DCB$->F$DCB.UBYTES = B$M$STAR$->F$DCB.ARS;

  10683  2 002254   000000 471400 xsym               LDP1    B$M$STAR$
         2 002255   100000 235100                    LDA     0,,PR1
         2 002256   000076 755100                    STA     62,,PR0

      724    10684    4                     B$JIT.DCB$ = DCB$;

  10684  2 002257   200007 236100                    LDQ     DCB$,,AUTO
         2 002260   000000 473400 xsym               LDP3    B$JIT$
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:126  
         2 002261   300232 756100                    STQ     154,,PR3

      725    10685    4                     CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#|%DVBYTE_TRANS#|%DVBYTE_BP#,%
             10685                              VFC_SLPP,0);

  10685  2 002262   000044 630400 3                  EPPR0   36
         2 002263   200013 220100                    LDX0    MEDIA,,AUTO
         2 002264   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 002265   000000 701010                    TSX1    0,X0
         2 002266   000000 011000                    NOP     0

      726    10686    4                   END;

  10686  2 002267   200021 236100                    LDQ     IMPPROKEY+3,,AUTO
         2 002270   001000 036003                    ADLQ    512,DU
         2 002271   200021 552140                    STBQ    IMPPROKEY+3,'40'O,AUTO
         2 002272   200021 236100                    LDQ     IMPPROKEY+3,,AUTO
         2 002273   000033 772000                    QRL     27
         2 002274   200022 116100                    CMPQ    IMP#,,AUTO
         2 002275   002235 602000 2                  TNC     s:10678
         2 002276   002235 600000 2                  TZE     s:10678

  10684  2 002277                       RTN          null
      727    10687    3   RTN:         ;
      728    10688    3              END;

      729    10689    2           TERR = B$JIT.ERR;

  10689  2 002277   000000 470400 xsym               LDP0    B$JIT$
         2 002300   000012 236100                    LDQ     10,,PR0
         2 002301   200010 756100                    STQ     LENGTH,,AUTO

      730    10690    2           GOTO ONON1;

  10690  2 002302   002004 710000 2                  TRA     ONON1

      731    10691        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:127  
      732    10692    2        CASE (%C$TRMISC#);

      733    10693    3           IF UCFLG>=0 THEN DO;

  10693  2 002303   200012 236100                    LDQ     UCFLG,,AUTO
         2 002304   002353 604000 2                  TMI     s:10705

      734    10694    3                IF B$PS0$->FPT$TRMISC_V.SEND~='01'B

  10694  2 002305   000000 473400 xsym               LDP3    B$PS0$
         2 002306   300001 236100                    LDQ     1,,PR3
         2 002307   600000 376003                    ANQ     -65536,DU
         2 002310   200000 116003                    CMPQ    65536,DU
         2 002311   002331 600000 2                  TZE     s:10699

      735    10695    4                THEN DO;

      736    10696    4                     S$CU$->B$U.FLG.NSND=~B$PS0$->FPT$TRMISC_V.SEND;

  10696  2 002312   300001 236100                    LDQ     1,,PR3
         2 002313   600000 376003                    ANQ     -65536,DU
         2 002314   600000 676003                    ERQ     -65536,DU
         2 002315   000000 474400 xsym               LDP4    S$CU$
         2 002316   000020 772000                    QRL     16
         2 002317   400000 676100                    ERQ     0,,PR4
         2 002320   000002 376003                    ANQ     2,DU
         2 002321   400000 656100                    ERSQ    0,,PR4

      737    10697    4                     B$JIT.ACCEPT_FLAGS.SEND=B$PS0$->FPT$TRMISC_V.SEND;

  10697  2 002322   000000 473400 xsym               LDP3    B$JIT$
         2 002323   000000 474400 xsym               LDP4    B$PS0$
         2 002324   400001 236100                    LDQ     1,,PR4
         2 002325   000023 772000                    QRL     19
         2 002326   300153 676100                    ERQ     107,,PR3
         2 002327   200000 376007                    ANQ     65536,DL
         2 002330   300153 656100                    ERSQ    107,,PR3
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:128  

      738    10698    4                   END;

      739    10699    3                IF B$PS0$->FPT$TRMISC_V.ANNOUNCE~='01'B

  10699  2 002331   000000 473400 xsym               LDP3    B$PS0$
         2 002332   300001 236100                    LDQ     1,,PR3
         2 002333   030000 376003                    ANQ     12288,DU
         2 002334   010000 116003                    CMPQ    4096,DU
         2 002335   002353 600000 2                  TZE     s:10705

      740    10700    4                THEN DO;

      741    10701    4                     S$CU$->B$U.FLG.ANNCE=B$PS0$->FPT$TRMISC_V.ANNOUNCE;

  10701  2 002336   000000 474400 xsym               LDP4    S$CU$
         2 002337   300001 236100                    LDQ     1,,PR3
         2 002340   000021 772000                    QRL     17
         2 002341   400000 676100                    ERQ     0,,PR4
         2 002342   040000 376007                    ANQ     16384,DL
         2 002343   400000 656100                    ERSQ    0,,PR4

      742    10702    4                     B$JIT.ACCEPT_FLAGS.ANNOUNCE=B$PS0$->FPT$TRMISC_V.ANNOUNCE;

  10702  2 002344   000000 473400 xsym               LDP3    B$JIT$
         2 002345   000000 474400 xsym               LDP4    B$PS0$
         2 002346   400001 236100                    LDQ     1,,PR4
         2 002347   000020 772000                    QRL     16
         2 002350   300153 676100                    ERQ     107,,PR3
         2 002351   100000 376007                    ANQ     32768,DL
         2 002352   300153 656100                    ERSQ    107,,PR3

      743    10703    4                   END;

      744    10704    3              END;

      745    10705    2           IF B$PS0$->FPT$TRMISC_V.BROADCAST~='01'B
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:129  

  10705  2 002353   000000 473400 xsym               LDP3    B$PS0$
         2 002354   300001 236100                    LDQ     1,,PR3
         2 002355   140000 376003                    ANQ     49152,DU
         2 002356   040000 116003                    CMPQ    16384,DU
         2 002357   002426 600000 2                  TZE     s:10715

      746    10706    3           THEN DO;

      747    10707    3                IF UCFLG=0 THEN

  10707  2 002360   200012 235100                    LDA     UCFLG,,AUTO
         2 002361   002370 601000 2                  TNZ     s:10709

      748    10708    3                     B$JIT.ACCEPT_FLAGS.BROADCAST=B$PS0$->FPT$TRMISC_V.BROADCAST;

  10708  2 002362   000000 474400 xsym               LDP4    B$JIT$
         2 002363   300001 236100                    LDQ     1,,PR3
         2 002364   000023 772000                    QRL     19
         2 002365   400153 676100                    ERQ     107,,PR4
         2 002366   040000 376007                    ANQ     16384,DL
         2 002367   400153 656100                    ERSQ    107,,PR4

      749    10709    3                IF MEDIA=ENTADDR(OCU$RWUC) THEN EXIT;

  10709  2 002370   000000 636000 xent               EAQ     OCU$RWUC
         2 002371   200013 116100                    CMPQ    MEDIA,,AUTO
         2 002372   002426 600000 2                  TZE     s:10715

      750    10710    3                TFCN.FCN = 0;

  10710  2 002373   000000 236003                    LDQ     0,DU
         2 002374   200006 552140                    STBQ    PFB,'40'O,AUTO

      751    10711    3                K$RWPARM = K_RWPARM_CON;

  10711  2 002375   000100 100400                    MLR     fill='000'O
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:130  
         2 002376   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 002377   200046 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      752    10712    3                K$RWPARM.VDOFLGS.SEND = B$PS0$->FPT$TRMISC_V.BROADCAST;

  10712  2 002400   300001 236100                    LDQ     1,,PR3
         2 002401   000014 772000                    QRL     12
         2 002402   200106 676100                    ERQ     K$RWPARM+32,,AUTO
         2 002403   000010 376003                    ANQ     8,DU
         2 002404   200106 656100                    ERSQ    K$RWPARM+32,,AUTO

      753    10713    3                CALL MEDIA (MFC_TCTL,TFCN,' ',0,ADDR(K$RWPARM));

  10713  2 002405   200046 634500                    EPPR4   K$RWPARM,,AUTO
         2 002406   200136 454500                    STP4    RDPRO+16,,AUTO
         2 002407   200136 635500                    EPPR5   RDPRO+16,,AUTO
         2 002410   200143 455500                    STP5    RDPRO+21,,AUTO
         2 002411   000002 236000 3                  LDQ     2
         2 002412   200142 756100                    STQ     RDPRO+20,,AUTO
         2 002413   000003 236000 3                  LDQ     3
         2 002414   200141 756100                    STQ     RDPRO+19,,AUTO
         2 002415   200006 636500                    EPPR6   PFB,,AUTO
         2 002416   200140 456500                    STP6    RDPRO+18,,AUTO
         2 002417   000004 236000 3                  LDQ     4
         2 002420   200137 756100                    STQ     RDPRO+17,,AUTO
         2 002421   200137 630500                    EPPR0   RDPRO+17,,AUTO
         2 002422   200013 220100                    LDX0    MEDIA,,AUTO
         2 002423   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 002424   000000 701010                    TSX1    0,X0
         2 002425   000000 011000                    NOP     0

      754    10714    3              END;

      755    10715    2           RETURN;

  10715  2 002426   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:131  
      756    10716        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:132  
      757    10717    2        CASE (ELSE);

      758    10718    2           RETURN;

  10718  2 002427   000000 702200 xent               TSX2  ! X66_ARET

      759    10719    2        END;

  10719  2 002430                       CSEND        null
      760    10720
      761    10721
      762    10722
      763    10723    1   CSEND: ;
      764    10724    1        TCTL.T=VLPCTL.PCODE(FPTCODE);

  10724  2 002430   200004 720100                    LXL0    FPTCODE,,AUTO
         2 002431   000022 236010 1                  LDQ     VLPCTL,X0
         2 002432   200026 552140                    STBQ    TCTL,'40'O,AUTO

      765    10725    1        TCTL.L=VLPSIZ;

  10725  2 002433   200005 236100                    LDQ     VLPSIZ,,AUTO
         2 002434   000022 736000                    QLS     18
         2 002435   200026 552120                    STBQ    TCTL,'20'O,AUTO

      766    10726    1        DCB$->F$DCB.UB$=ADDR(TCTL);

  10726  2 002436   200026 630500                    EPPR0   TCTL,,AUTO
         2 002437   200007 471500                    LDP1    DCB$,,AUTO
         2 002440   100075 450500                    STP0    61,,PR1

      767    10727    1        DCB$->F$DCB.UBYTES=VLPSIZ+2;

  10727  2 002441   200005 235100                    LDA     VLPSIZ,,AUTO
         2 002442   000002 035007                    ADLA    2,DL
         2 002443   100076 755100                    STA     62,,PR1

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:133  
      768    10728    1        CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SPM,0);

  10728  2 002444   000051 630400 3                  EPPR0   41
         2 002445   200013 221100                    LDX1    MEDIA,,AUTO
         2 002446   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 002447   000000 701011                    TSX1    0,X1
         2 002450   000000 011000                    NOP     0

  10727  2 002451                       ERRCHK       null
      769    10729    1   ERRCHK: ;
      770    10730    1        IF DCB$->F$DCB.TYC(1)~='0'B THEN

  10730  2 002451   200007 470500                    LDP0    DCB$,,AUTO
         2 002452   000002 235100                    LDA     2,,PR0
         2 002453   002466 600000 2                  TZE     s:10732

      771    10731    1             CALL FMF$TYC (DCB$->F$DCB.TYC(1),B$JIT$->B$JIT.ERR);

  10731  2 002454   000000 236000 xsym               LDQ     B$JIT$
         2 002455   000012 036003                    ADLQ    10,DU
         2 002456   200137 756100                    STQ     RDPRO+17,,AUTO
         2 002457   200007 236100                    LDQ     DCB$,,AUTO
         2 002460   000002 036003                    ADLQ    2,DU
         2 002461   200136 756100                    STQ     RDPRO+16,,AUTO
         2 002462   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 002463   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002464   000000 701000 xent               TSX1    FMF$TYC
         2 002465   000000 011000                    NOP     0

      772    10732    2        IF B$JIT$->B$JIT.ERR.CODE~=0 THEN DO;

  10732  2 002466   000000 470400 xsym               LDP0    B$JIT$
         2 002467   000012 236100                    LDQ     10,,PR0
         2 002470   377770 316007                    CANQ    131064,DL
         2 002471   002502 600000 2                  TZE     s:10759

  10731  2 002472                       ERROUT       null
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:134  
      773    10733    2   ERROUT:   ;
      774    10734        /*E*  ERROR:    KIP-E$LDSC-E
      775    10735              MESSAGE:  Terminal control aborted - station disconnected
      776    10736              DESCRIPTION: The station the FPRG was being attached to
      777    10737                           disconnected during the PMME                              */
      778    10738        /*E*  ERROR:    KIP-E$DACTR-E
      779    10739              MESSAGE:  Terminal control aborted - you are deactivated
      780    10740              DESCRIPTION: The AU deactivated him during the pmme or he
      781    10741                           was already deactivated when he did it.                   */
      782    10742        /*E*  ERROR:    KIP-E$CGKEYV-E
      783    10743              MESSAGE:  Terminal control aborted - station not defined
      784    10744              DESCRIPTION: XSTALGL = 0 and this station isn't defined.
      785    10745                           See VLP_CGSTAL.                                           */
      786    10746        /*E*  ERROR:    KIP-E$CGFULL-E
      787    10747              MESSAGE:  Terminal control aborted - comgroup queue full
      788    10748              DESCRIPTION: Comgroup is out of space                                  */
      789    10749        /*E*  ERROR:    KIP-E$CGCRCW-E
      790    10750              MESSAGE:  Terminal control aborted - latch violation
      791    10751              DESCRIPTION: An attempt to read without completing the
      792    10752                           the continued Latched write.                              */
      793    10753    2             IF B$JIT$->B$JIT.ERR.FCG = '0'B

  10753  2 002472   000000 470400 xsym               LDP0    B$JIT$
         2 002473   000012 236100                    LDQ     10,,PR0
         2 002474   777700 316003                    CANQ    -64,DU
         2 002475   002502 601000 2                  TNZ     s:10759

      794    10754    3             THEN DO;

      795    10755    3                  B$JIT$->B$JIT.ERR.FCG='1311'O;

  10755  2 002476   131100 236003                    LDQ     45632,DU
         2 002477   000012 752160                    STCQ    10,'60'O,PR0

      796    10756    3                  B$JIT$->B$JIT.ERR.MID='20'O;

  10756  2 002500   000020 236003                    LDQ     16,DU
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:135  
         2 002501   000012 752110                    STCQ    10,'10'O,PR0

      797    10757    3                END;

      798    10758    2           END;

      799    10759    1        RETURN;

  10759  2 002502   000000 702200 xent               TSX2  ! X66_ARET

  10758  2 002503                       NOVEC        null
      800    10760        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:136  
      801    10761    1   NOVEC: ;
      802    10762    1        B$JIT$->B$JIT.ERR=MISOPT;

  10762  2 002503   000054 236000 1                  LDQ     MISOPT
         2 002504   000000 470400 xsym               LDP0    B$JIT$
         2 002505   000012 756100                    STQ     10,,PR0
         2 002506   002673 710000 2                  TRA     s:10843+2

      803    10763        /*E*  ERROR:         KIP-E$NILOPT-C
      804    10764               MESSAGE: Required option missing on terminal control service request.
      805    10765              DESCRIPTION:   This error occurs whenever any of the required
      806    10766                             VLPs are missing on the terminal control pmmes.
      807    10767                             Essentially all of them have required VLPs.
      808    10768                             Watch out for missing BUF on M$PROFILE                  */
      809    10769        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:137  
      810    10770    1   VLPCK: PROC ALTRET;

  10770  2 002507   200134 741300       VLPCK        STX1  ! RDPRO+14,,AUTO

      811    10771        /**/
      812    10772    2        CALL HFF$DSIZ (2,VLPSIZ) ALTRET (NILE);

  10772  2 002510   200005 630500                    EPPR0   VLPSIZ,,AUTO
         2 002511   200137 450500                    STP0    RDPRO+17,,AUTO
         2 002512   000000 236000 3                  LDQ     0
         2 002513   200136 756100                    STQ     RDPRO+16,,AUTO
         2 002514   200136 630500                    EPPR0   RDPRO+16,,AUTO
         2 002515   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002516   000000 701000 xent               TSX1    HFF$DSIZ
         2 002517   002550 702000 2                  TSX2    NILE

      813    10773    3        IF VLPSIZ>VLPCTL.MXVLP(FPTCODE) THEN DO;

  10773  2 002520   200004 720100                    LXL0    FPTCODE,,AUTO
         2 002521   000022 236010 1                  LDQ     VLPCTL,X0
         2 002522   777777 376007                    ANQ     -1,DL
         2 002523   200005 116100                    CMPQ    VLPSIZ,,AUTO
         2 002524   002531 603000 2                  TRC     s:10789

      814    10774    3             B$JIT$->B$JIT.ERR=TOOBIG;

  10774  2 002525   000055 236000 1                  LDQ     TOOBIG
         2 002526   000000 470400 xsym               LDP0    B$JIT$
         2 002527   000012 756100                    STQ     10,,PR0

      815    10775        /*E*  ERROR:         KIP-E$O2BIG-C
      816    10776               MESSAGE: Option area too large on terminal control service request.
      817    10777              MESSAGE1: The option areas on such terminal control services
      818    10778                        as M$STRMATTR and M$STRMCTL are sent as messages
      819    10779                        to the front end.  Because of this their size must
      820    10780                        be limited to that of the appropriate VLP MACRO.
      821    10781                        Your request specifies an option area exceeding this.
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:138  
      822    10782                        Use the appropriate VLP when issuing the terminal
      823    10783                        control service requests.
      824    10784              DESCRIPTION:   On the terminal control pmmes that set attributes
      825    10785                             the options are required to be exactly the size of
      826    10786                             the corresponding VLP.  The user no doubt tried to
      827    10787                             invent his own or mis-issued the pmme                   */
      828    10788    3           END;

  10788  2 002530   002545 710000 2                  TRA     s:10804

      829    10789    3        ELSE IF VLPSIZ<VLPCTL.MINVLP(FPTCODE) THEN DO;

  10789  2 002531   000022 236010 1                  LDQ     VLPCTL,X0
         2 002532   000022 772000                    QRL     18
         2 002533   000777 376007                    ANQ     511,DL
         2 002534   200005 116100                    CMPQ    VLPSIZ,,AUTO
         2 002535   002543 602000 2                  TNC     s:10803
         2 002536   002543 600000 2                  TZE     s:10803

      830    10790    3                  B$JIT$->B$JIT.ERR=TOOSMALL;

  10790  2 002537   000056 236000 1                  LDQ     TOOSMALL
         2 002540   000000 470400 xsym               LDP0    B$JIT$
         2 002541   000012 756100                    STQ     10,,PR0

      831    10791        /*E*  ERROR:         KIP-E$O2SMALL-C
      832    10792               MESSAGE: Option area too small on terminal control service request.
      833    10793              MESSAGE1: On such terminal control requests as M$STRMATTR and
      834    10794                        M$STRMCTL, the option area is required to be exactly
      835    10795                        the size of the corresponding VLP.  On the M$GTRMATTR
      836    10796                        and M$GTRMCTL, etc. services it must be at least as
      837    10797                        large as the corresponding VLP.  Use of the supplied
      838    10798                        VLP MACRO is recommended.
      839    10799              DESCRIPTION:   On attribute  reading pmmes this is essentially lost
      840    10800                             data, although nothing is transferred.  On the setting
      841    10801                             ones, all option values must be specified.              */
      842    10802    3                END;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:139  

  10802  2 002542   002545 710000 2                  TRA     s:10804

      843    10803    2             ELSE RETURN;

  10803  2 002543   200134 221300                    LDX1  ! RDPRO+14,,AUTO
         2 002544   000001 702211                    TSX2  ! 1,X1

      844    10804    2        CALL UDB$PMMEXIT;

  10804  2 002545   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002546   000000 701000 xent               TSX1    UDB$PMMEXIT
         2 002547   000000 011000                    NOP     0

      845    10805    2   NILE: ;

  10805  2 002550                       NILE         null
      846    10806    2        ALTRETURN;

  10806  2 002550   200134 221300                    LDX1  ! RDPRO+14,,AUTO
         2 002551   000000 702211                    TSX2  ! 0,X1

      847    10807    2   END;
      848    10808        /**/
      849    10809        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:140  
      850    10810    1   NXTDCB: PROC ALTRET;

  10810  2 002552   200134 741300       NXTDCB       STX1  ! RDPRO+14,,AUTO

      851    10811        /**/
      852    10812    3        IF UCFLG<=0 THEN DO;

  10812  2 002553   200012 235100                    LDA     UCFLG,,AUTO
         2 002554   002575 605400 2                  TPNZ    s:10821

      853    10813    3             SDCB$=DCB$;

  10813  2 002555   200007 236100                    LDQ     DCB$,,AUTO
         2 002556   200014 756100                    STQ     SDCB$,,AUTO

      854    10814    4             IF UCFLG=0 THEN DO;

  10814  2 002557   000000 115003                    CMPA    0,DU
         2 002560   002567 601000 2                  TNZ     s:10818

      855    10815    4                  UCFLG=%M$UC#+1;

  10815  2 002561   000004 235007                    LDA     4,DL
         2 002562   200012 755100                    STA     UCFLG,,AUTO

      856    10816    4                  TDCB$=B$ROSEG$->B$ROSEG.DCBPTR$;

  10816  2 002563   000000 470400 xsym               LDP0    B$ROSEG$
         2 002564   000000 236100                    LDQ     0,,PR0
         2 002565   200006 756100                    STQ     PFB,,AUTO

      857    10817    4                END;

  10817  2 002566   002574 710000 2                  TRA     s:10819

      858    10818    3             ELSE UCFLG=B$ROSEG$->B$ROSEG.NUMDCBS+1;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:141  
  10818  2 002567   000000 470400 xsym               LDP0    B$ROSEG$
         2 002570   000002 236100                    LDQ     2,,PR0
         2 002571   000022 772000                    QRL     18
         2 002572   000001 036007                    ADLQ    1,DL
         2 002573   200012 756100                    STQ     UCFLG,,AUTO

      859    10819    3             RETURN;

  10819  2 002574   000001 702211                    TSX2  ! 1,X1

      860    10820    3           END;
      861    10821    3        ELSE DO UCFLG=UCFLG TO B$ROSEG$->B$ROSEG.NUMDCBS;

  10821  2 002575   002613 710000 2                  TRA     s:10827+1

      862    10822    3             SDCB$=TDCB$->B$RODCB$(UCFLG);

  10822  2 002576   200006 470500                    LDP0    PFB,,AUTO
         2 002577   200012 720100                    LXL0    UCFLG,,AUTO
         2 002600   000000 236110                    LDQ     0,X0,PR0
         2 002601   200014 756100                    STQ     SDCB$,,AUTO

      863    10823    4             IF SDCB$~=ADDR(NIL) THEN IF SDCB$->F$DCB.UCOUT THEN DO;

  10823  2 002602   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002603   002612 600000 2                  TZE     s:10827

  10823  2 002604   200014 471500                    LDP1    SDCB$,,AUTO
         2 002605   100067 430100                    FSZN    55,,PR1
         2 002606   002612 605000 2                  TPL     s:10827

      864    10824    4                       UCFLG=UCFLG+1;

  10824  2 002607   200012 054100                    AOS     UCFLG,,AUTO

      865    10825    4                       RETURN;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:142  
  10825  2 002610   200134 221300                    LDX1  ! RDPRO+14,,AUTO
         2 002611   000001 702211                    TSX2  ! 1,X1

      866    10826    4                     END;
      867    10827    3           END;

  10827  2 002612   200012 054100                    AOS     UCFLG,,AUTO
         2 002613   000000 470400 xsym               LDP0    B$ROSEG$
         2 002614   000002 236100                    LDQ     2,,PR0
         2 002615   000022 772000                    QRL     18
         2 002616   200012 116100                    CMPQ    UCFLG,,AUTO
         2 002617   002576 605000 2                  TPL     s:10822

      868    10828    2        ALTRETURN;

  10828  2 002620   200134 221300                    LDX1  ! RDPRO+14,,AUTO
         2 002621   000000 702211                    TSX2  ! 0,X1

      869    10829    2   END;
      870    10830        /**/
      871    10831    1   OPNPRO: PROC ALTRET;

  10831  2 002622   200134 741300       OPNPRO       STX1  ! RDPRO+14,,AUTO

      872    10832        /**/
      873    10833    2        B$JIT.DCB$=B$M$STAR$;

  10833  2 002623   000000 236000 xsym               LDQ     B$M$STAR$
         2 002624   000000 470400 xsym               LDP0    B$JIT$
         2 002625   000232 756100                    STQ     154,,PR0

      874    10834    2        IF B$M$STAR$->F$DCB.FCD THEN CALL FMP$CLSF;

  10834  2 002626   000000 471400 xsym               LDP1    B$M$STAR$
         2 002627   100031 236100                    LDQ     25,,PR1
         2 002630   020000 316007                    CANQ    8192,DL
         2 002631   002635 600000 2                  TZE     s:10835
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:143  

  10834  2 002632   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002633   000000 701000 xent               TSX1    FMP$CLSF
         2 002634   000000 011000                    NOP     0

      875    10835    2        CALL FMM$SCRUB (B$M$STAR$);

  10835  2 002635   000055 630400 3                  EPPR0   45
         2 002636   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002637   000000 701000 xent               TSX1    FMM$SCRUB
         2 002640   000000 011000                    NOP     0

      876    10836    2        B$M$STAR$->F$DCB.NAME=PRO;

  10836  2 002641   000000 470400 xsym               LDP0    B$M$STAR$
         2 002642   000100 100400                    MLR     fill='000'O
         2 002643   000000 000005 1                  ADSC9   PRO                      cn=0,n=5
         2 002644   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32

      877    10837    2        B$M$STAR$->F$DCB.ACCT=':SYS';

  10837  2 002645   000064 235000 1                  LDA     OUTPUTONLY+2
         2 002646   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 002647   000020 757100                    STAQ    16,,PR0

      878    10838    2        B$M$STAR$->F$DCB.SHARE=%ALL#;

  10838  2 002650   000031 236100                    LDQ     25,,PR0
         2 002651   000056 376000 3                  ANQ     46
         2 002652   000200 276007                    ORQ     128,DL
         2 002653   000031 756100                    STQ     25,,PR0

      879    10839    2        B$M$STAR$->F$DCB.ACS=%DIRECT#;

  10839  2 002654   000002 236007                    LDQ     2,DL
         2 002655   000036 552104                    STBQ    30,'04'O,PR0

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:144  
      880    10840    2        B$M$STAR$->F$DCB.ASN=%FILE#;

  10840  2 002656   001000 236007                    LDQ     512,DL
         2 002657   000032 552110                    STBQ    26,'10'O,PR0

      881    10841    2        CALL FMM$DFLOPN;

  10841  2 002660   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002661   000000 701000 xent               TSX1    FMM$DFLOPN
         2 002662   000000 011000                    NOP     0

      882    10842    2        IF NOT B$M$STAR$->F$DCB.FCD THEN ALTRETURN;

  10842  2 002663   000000 470400 xsym               LDP0    B$M$STAR$
         2 002664   000031 236100                    LDQ     25,,PR0
         2 002665   020000 316007                    CANQ    8192,DL
         2 002666   002671 601000 2                  TNZ     s:10843

  10842  2 002667   200134 221300                    LDX1  ! RDPRO+14,,AUTO
         2 002670   000000 702211                    TSX2  ! 0,X1

      883    10843    2        RETURN;

  10843  2 002671   200134 221300                    LDX1  ! RDPRO+14,,AUTO
         2 002672   000001 702211                    TSX2  ! 1,X1
         2 002673   002676 710000 2                  TRA     s:10850

      884    10844    2   END OPNPRO;
      885    10845        /**/
      886    10846        %EJECT;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:145  
      887    10847
      888    10848        /* Internal entry point to set platen for user */
      889    10849    1   KIP$PLATEN: ENTRY(PMMECOD);

  10849  2 002674   000000 700200 xent  KIP$PLATEN   TSX0  ! X66_AUTO_1
         2 002675   000144 000001                    ZERO    100,1

      890    10850    1        WIDTH=ADDR(PMMECOD)->VLP$PLATEN_V.WIDTH;

  10850  2 002676   200003 470500                    LDP0    @PMMECOD,,AUTO
         2 002677   000000 236100                    LDQ     0,,PR0
         2 002700   000033 772000                    QRL     27
         2 002701   000377 376007                    ANQ     255,DL
         2 002702   200011 756100                    STQ     WIDTH,,AUTO

      891    10851    2        IF WIDTH~=255 THEN DO;

  10851  2 002703   000377 116007                    CMPQ    255,DL
         2 002704   002714 600000 2                  TZE     s:10855

      892    10852    2             IF ADDR(PMMECOD)->VLP$PLATEN_V.EXTWID THEN WIDTH=WIDTH+254;

  10852  2 002705   000001 430100                    FSZN    1,,PR0
         2 002706   002711 605000 2                  TPL     s:10853

  10852  2 002707   000376 236007                    LDQ     254,DL
         2 002710   200011 056100                    ASQ     WIDTH,,AUTO

      893    10853    2             B$M$UC$->F$DCB.WIDTH=WIDTH;

  10853  2 002711   000000 471400 xsym               LDP1    B$M$UC$
         2 002712   200011 236100                    LDQ     WIDTH,,AUTO
         2 002713   100004 552104                    STBQ    4,'04'O,PR1

      894    10854    2           END;

      895    10855    1        LENGTH=ADDR(PMMECOD)->VLP$PLATEN_V.LENGTH;
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:146  

  10855  2 002714   000000 236100                    LDQ     0,,PR0
         2 002715   000022 772000                    QRL     18
         2 002716   000377 376007                    ANQ     255,DL
         2 002717   200010 756100                    STQ     LENGTH,,AUTO

      896    10856    1        IF LENGTH~=255 THEN B$M$UC$->F$DCB.LINES=LENGTH;

  10856  2 002720   000377 116007                    CMPQ    255,DL
         2 002721   002725 600000 2                  TZE     s:10857

  10856  2 002722   000000 620006                    EAX0    0,QL
         2 002723   000000 471400 xsym               LDP1    B$M$UC$
         2 002724   100044 740100                    STX0    36,,PR1

      897    10857    1        RETURN;

  10857  2 002725   000000 702200 xent               TSX2  ! X66_ARET

PRO
 Sect OctLoc
   1     000   004072 120122   117*** ******                                    .:PRO...

RDPC
 Sect OctLoc
   1     002   000005 777640   000012 006000   000000 177640   000000 006014    ................
   1     006   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     012   000000 600000   000000 000000   000000 000000   000000 000000    ................
   1     016   000000 000000   000000 000000                                    ........

DPMT
 Sect OctLoc
   1     020   041041 052077                                                    !!*?

VFCDP
 Sect OctLoc
   1     021   160160 100100                                                    pp@@
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:147  

VLPCTL
 Sect OctLoc
   1     022   000000 777777   000000 777777   000000 777777   000000 777777    ................
   1     026   000000 777777   000000 777777   014020 000020   014020 777777    ................
   1     032   020040 000040   020040 777777   004020 000020   004020 777777    . . . ..........
   1     036   005000 000137   006000 000040   000000 777777   012100 777777    ..._... .....@..
   1     042   007050 000050   007050 777777   010020 000020   011040 000040    .(.(.(....... .
   1     046   011040 777777   013000 010000   000001 000010                    . ..........

NO_WRT
 Sect OctLoc
   1     051   131120 020620                                                    YP..

(unnamed)
 Sect OctLoc
   1     052   131120 020320                                                    YP..

NOTTS
 Sect OctLoc
   1     053   131120 020330                                                    YP..

MISOPT
 Sect OctLoc
   1     054   131120 020350                                                    YP..

TOOBIG
 Sect OctLoc
   1     055   131120 020370                                                    YP..

TOOSMALL
 Sect OctLoc
   1     056   131120 020360                                                    YP..

BPRTY
 Sect OctLoc
   1     057   131120 020440                                                    YP..
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:148  

NKFUNC
 Sect OctLoc
   1     060   131120 013630                                                    YP..

ILGLNOTFORM
 Sect OctLoc
   1     061   131120 021110                                                    YP.H

OUTPUTONLY
 Sect OctLoc
   1     062   131120 021120                                                    YP.P

(unnamed)
 Sect OctLoc
   1     063   000000 100000   072123 131123                                    ..@.:SYS

(unnamed)
 Sect OctLoc
   3     000   000004 006000   000000 000014   000002 006000   000035 006000    ................
   3     004   000001 006000   000005 006000   000001 777776   000026 400000    ................
   3     010   000013 006000   000002 006000   000036 006000   000002 006000    ................
   3     014   777777 777776   000000 006000   100000 000000   027040 040040    ........@....
   3     020   000003 006000   000016 006000   000017 006000   000002 006000    ................
   3     024   026040 040040   000003 006000   000016 006000   000024 006000    .   ............
   3     030   000002 006000   000003 177640   001777 777640   025040 040040    .............
   3     034   000033 006000   000002 006000   000003 006000   000016 006000    ................
   3     040   000033 006000   000002 006000   320000 000000   031040 040040    .............
   3     044   000003 006000   000042 006000   000043 006000   000002 006000    ....."...#......
   3     050   024040 040040   000003 006000   000016 006000   000050 006000    .   .........(..
   3     054   000002 006000   000000 006000   777777 777177                    ............
      898    10858    1   END KIP$PMME;
      899    10859        /**/
      900    10860        /**/
      901    10861        %EOD;

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:149  
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   UD_EQU_E.:E05TOU  is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KIP$PMME.
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:150  

 **** Variables and constants ****

  ****  Section 001 RoData KIP$PMME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    57-0-0/w STRC        r     1 BPRTY                     20-0-0/c CHAR        r     1 DPMT(0:3)
    61-0-0/w STRC        r     1 ILGLNOTFORM               54-0-0/w STRC        r     1 MISOPT
    60-0-0/w STRC        r     1 NKFUNC                    53-0-0/w STRC        r     1 NOTTS
    51-0-0/w STRC        r     1 NO_WRT                    62-0-0/w STRC        r     1 OUTPUTONLY
     0-0-0/c STRC(45)    r     1 PRO                        2-0-0/d STRC(504)   r     1 RDPC
    55-0-0/w STRC        r     1 TOOBIG                    56-0-0/w STRC        r     1 TOOSMALL
    21-0-0/c CHAR        r     1 VFCDP(0:3)                22-0-0/w STRC        r     1 VLPCTL(0:22)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @PMMECOD                  15-0-0/w PTR         r     1 BUF$
     7-0-0/w PTR         r     1 DCB$                       4-0-0/w UBIN        r     1 FPTCODE
    22-0-0/w UBIN        r     1 IMP#                      16-0-0/c STRC(117)   r     1 IMPPROKEY
    46-0-0/d STRC(1404)  r     1 K$RWPARM                  10-0-0/w SBIN        r     1 LENGTH
    13-0-0/w EPTR        r     1 MEDIA                      6-0-0/w UBIN        r     1 PFB
    *0-0-0/w UBIN        r     1 PMMECOD                  116-0-0/d STRC(504)   r     1 RDPRO
    14-0-0/w PTR         r     1 SDCB$                     26-0-0/w STRC(540)   r     1 TCTL
     6-0-0/w PTR         r     1 TDCB$                     10-0-0/w STRC        r     1 TERR
     6-0-0/w STRC        r     1 TFCN                      12-0-0/w SBIN        r     1 UCFLG
     5-0-0/w UBIN        r     1 VLPSIZ                    24-0-0/d STRC(72)    r     1 VLP_FLDATR
    11-0-0/w SBIN        r     1 WIDTH                     16-0-0/c STRC(117)   r     1 XPNAME

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:151  
     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$STAR$
     0-0-0/w PTR         r     1 B$M$UC$                    0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS2$                     0-0-0/w PTR         r     1 B$PS3$
     0-0-0/w PTR         r     1 B$PS4$                     0-0-0/w PTR         r     1 B$ROSEG$
     0-0-0/w PTR         r     1 B$XL_UPPER_UR$             0-0-0/d STRC(1404)  r     1 K_RWPARM_CON
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 S$CU$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w PTR         r     1 B$RODCB$(0:0)
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/d STRC(576)   r     1 B$U
     0-0-0/d STRC(4608)  r     1 B$XL_UPPER_UR              0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d STRC(144)   r     1 FPT$DCLFLD_V               0-0-0/d STRC(144)   r     1 FPT$EOM_V
     0-0-0/d STRC(72)    r     1 FPT$ERASE_V                0-0-0/d STRC(72)    r     1 FPT$MDFFLD_V
     0-0-0/d STRC(144)   r     1 FPT$PROMPT_V               0-0-0/d STRC(72)    r     1 FPT$RLSFLD_V
     0-0-0/d STRC(72)    r     1 FPT$SINPUT_V               0-0-0/d STRC(72)    r     1 FPT$SLCFLD_V
     0-0-0/d STRC(72)    r     1 FPT$TRMCTL_V               0-0-0/d STRC(72)    r     1 FPT$TRMISC_V
     0-0-0/d STRC(144)   r     1 FPT$TRMPRG_V               0-0-0/d STRC(720)   r     1 KL$PHDR
     0-0-0/c STRC(9)     r     1 L6                         0-0-0/c STRC(18)    r     1 L66
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/c CHAR(4096)  r     1 PROBUF                     0-0-0/c ASTR        r     1 VCHRET
     0-0-0/c ASTR(27)    r     1 VCHRPMT                    0-0-0/c ASTR(9)     r     1 VCHRV
     0-0-0/c ACHR        r     1 VCHRZ                      0-0-0/d STRC(72)    r     1 VEC
     0-0-0/d STRC(144)   r     1 VLP$EDTCTL_V               0-0-0/d STRC(288)   r     1 VLP$EOMTABLE_V
     0-0-0/d STRC(72)    r     1 VLP$FLDATR_V               0-0-0/d STRC(576)   r     1 VLP$LINEATTR_V
     0-0-0/d STRC(144)   r     1 VLP$PLATEN_V               0-0-0/w STRC(288)   r     1 VLP$TAB_V
     0-0-0/d STRC(360)   r     1 VLP$TRMATTR_V              0-0-0/d STRC(144)   r     1 VLP$TRMCTL_V
     0-0-0/d STRC(288)   r     1 VLP$WINDOW_V               0-0-0/c STRC        r     1 VSIN
     0-0-0/c ASTR(9)     r     1 VTXTC

PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:152  

   Procedure KIP$PMME requires 1494 words for executable code.
   Procedure KIP$PMME requires 100 words of local(AUTO) storage.
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:153  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:154  
          MINI XREF LISTING

B$DO.ECCINFO
       646**DCL       647--REDEF
B$JIT.ACCEPT_FLAGS.ANNOUNCE
       174**DCL     10702<<ASSIGN
B$JIT.ACCEPT_FLAGS.BROADCAST
       174**DCL     10708<<ASSIGN
B$JIT.ACCEPT_FLAGS.SEND
       174**DCL     10697<<ASSIGN
B$JIT.CPFLAGS1
       115**DCL     10520>>IF
B$JIT.CPFLAGS1.SLEAZE
       120**DCL       120--REDEF
B$JIT.DCB$
       194**DCL     10216>>ASSIGN  10228<<ASSIGN  10320<<ASSIGN  10606<<ASSIGN  10617<<ASSIGN  10684<<ASSIGN
     10833<<ASSIGN
B$JIT.ERR
        26**DCL     10232<<ASSIGN  10252<<ASSIGN  10304<<ASSIGN  10569<<ASSIGN  10570<<ASSIGN  10605>>ASSIGN
     10619<<ASSIGN  10689>>ASSIGN  10731<>CALL    10762<<ASSIGN  10774<<ASSIGN  10790<<ASSIGN
B$JIT.ERR.CODE
        27**DCL     10660>>IF      10732>>IF
B$JIT.ERR.FCG
        26**DCL     10753>>IF      10755<<ASSIGN
B$JIT.ERR.MID
        27**DCL        27--REDEF   10756<<ASSIGN
B$JIT.JRESPEAK
       188**DCL       189--REDEF
B$JIT.MODE
        21**DCL     10249>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
       297**DCL       297--REDEF     298--REDEF
B$JIT.PNR
       201**DCL       201--REDEF
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:155  
B$JIT.SINPUTSZ
       175**DCL     10414<<ASSIGN
B$JIT.TSLINE
       295**DCL       296--REDEF
B$JIT.TSLINE.SPEED
       295**DCL     10436<<ASSIGN
B$JIT$
      9800**DCL        21--IMP-PTR 10216>>ASSIGN  10228>>ASSIGN  10232>>ASSIGN  10249>>IF      10252>>ASSIGN
     10304>>ASSIGN  10320>>ASSIGN  10414>>ASSIGN  10436>>ASSIGN  10520>>IF      10543--ASSIGN  10569>>ASSIGN
     10570>>ASSIGN  10605>>ASSIGN  10606>>ASSIGN  10617>>ASSIGN  10619>>ASSIGN  10660>>IF      10684>>ASSIGN
     10689>>ASSIGN  10697>>ASSIGN  10702>>ASSIGN  10708>>ASSIGN  10731>>CALL    10732>>IF      10753>>IF
     10755>>ASSIGN  10756>>ASSIGN  10762>>ASSIGN  10774>>ASSIGN  10790>>ASSIGN  10833>>ASSIGN
B$M$STAR$
      9801**DCL     10617>>ASSIGN  10646>>ASSIGN  10678>>IF      10683>>ASSIGN  10833>>ASSIGN  10834>>IF
     10835<>CALL    10836>>ASSIGN  10837>>ASSIGN  10838>>ASSIGN  10839>>ASSIGN  10840>>ASSIGN  10842>>IF
B$M$UC$
      9802**DCL     10225>>IF      10225>>IF      10227>>ASSIGN  10248>>IF      10279>>IF      10853>>ASSIGN
     10856>>ASSIGN
B$PS0$
      9804**DCL      8967--IMP-PTR  9148--IMP-PTR  9164--IMP-PTR  9180--IMP-PTR  9200--IMP-PTR  9216--IMP-PTR
      9232--IMP-PTR 10313>>ASSIGN  10314>>ASSIGN  10327>>ASSIGN  10328>>ASSIGN  10338>>ASSIGN  10339>>ASSIGN
     10343>>ASSIGN  10351>>IF      10357>>IF      10375>>ASSIGN  10376>>ASSIGN  10386>>ASSIGN  10387>>ASSIGN
     10393>>ASSIGN  10406>>IF      10406>>IF      10408>>ASSIGN  10456>>ASSIGN  10458>>IF      10470>>IF
     10470>>IF      10472>>ASSIGN  10503>>ASSIGN  10511>>IF      10526>>ASSIGN  10527>>ASSIGN  10528>>ASSIGN
     10537>>ASSIGN  10549>>IF      10564>>ASSIGN  10565>>IF      10575>>ASSIGN  10577>>IF      10694>>IF
     10696>>ASSIGN  10697>>ASSIGN  10699>>IF      10701>>ASSIGN  10702>>ASSIGN  10705>>IF      10708>>ASSIGN
     10712>>ASSIGN
B$PS2$
      9803**DCL     10315>>ASSIGN  10346>>ASSIGN  10396>>ASSIGN  10403>>ASSIGN  10410>>ASSIGN  10435>>IF
     10436>>ASSIGN  10437>>ASSIGN  10440>>IF      10441>>ASSIGN  10442>>IF      10443>>ASSIGN  10444>>IF
     10445>>ASSIGN  10452>>ASSIGN  10460>>ASSIGN  10460>>ASSIGN  10464>>ASSIGN  10464>>ASSIGN  10478>>ASSIGN
     10485>>ASSIGN  10486>>ASSIGN  10488>>IF      10489>>ASSIGN  10513>>ASSIGN  10514>>ASSIGN  10518>>ASSIGN
     10530>>ASSIGN  10545>>ASSIGN  10597>>CALLBLT 10597>>CALLBLT 10598>>ASSIGN
B$PS3$
      9806**DCL      9004--IMP-PTR 10316>>ASSIGN  10350>>ASSIGN  10658>>ASSIGN
B$PS4$
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:156  
      9807**DCL     10344>>ASSIGN
B$RODCB$
       479**DCL     10822>>ASSIGN
B$ROSEG.DCBPTR$
       443**DCL     10816>>ASSIGN
B$ROSEG.NUMDCBS
       445**DCL     10818>>ASSIGN  10821>>DOINDEX
B$ROSEG.STREAM_VALID
       475**DCL     10286>>IF
B$ROSEG$
      9808**DCL     10286>>IF      10816>>ASSIGN  10818>>ASSIGN  10821>>DOINDEX
B$U.FLG.ANNCE
       541**DCL     10701<<ASSIGN
B$U.FLG.NSND
       534**DCL     10696<<ASSIGN
B$U.MISC
       625**DCL       626--REDEF
B$USER.MISC
       701**DCL       702--REDEF
B$XL_UPPER_UR
      8499**DCL     10597>>CALLBLT
B$XL_UPPER_UR$
      8498**DCL      8499--IMP-PTR 10597>>CALLBLT
BDFC
     10231**LABEL   10247--GOTO    10249--GOTO    10272--GOTO
BPRTY
     10197**DCL     10626>>ASSIGN
BUF$
      9370**DCL     10591<>CALL    10602>>ASSIGN  10616<>CALL    10624>>IF      10636>>IF      10645>>ASSIGN
     10648<>CALL    10658>>ASSIGN  10664>>ASSIGN  10665>>ASSIGN  10666>>ASSIGN  10667>>ASSIGN  10668>>ASSIGN
     10669>>ASSIGN  10672>>ASSIGN  10682>>ASSIGN
CMNFLDSRV
     10388**LABEL   10330--GOTO    10378--GOTO
CSEND
     10719**LABEL   10439--CALLALT 10492--CALLALT
DCB$
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:157  
      9359**DCL     10216<<ASSIGN  10217>>IF      10219>>ASSIGN  10222>>IF      10223>>ASSIGN  10224>>IF
     10225>>IF      10225>>IF      10225>>IF      10227<<ASSIGN  10228>>ASSIGN  10247>>IF      10248>>IF
     10250>>IF      10264>>IF      10268>>IF      10273>>ASSIGN  10274>>ASSIGN  10289>>ASSIGN  10293>>ASSIGN
     10415>>IF      10419>>ASSIGN  10452>>ASSIGN  10453>>ASSIGN  10456>>ASSIGN  10457>>ASSIGN  10461>>ASSIGN
     10465>>ASSIGN  10478>>ASSIGN  10479>>ASSIGN  10543>>ASSIGN  10545>>ASSIGN  10547>>ASSIGN  10557>>ASSIGN
     10590>>ASSIGN  10606>>ASSIGN  10624>>IF      10645>>ASSIGN  10646>>ASSIGN  10660>>IF      10682>>ASSIGN
     10683>>ASSIGN  10684>>ASSIGN  10726>>ASSIGN  10727>>ASSIGN  10730>>IF      10731>>CALL    10813>>ASSIGN
DOIMP
     10669**LABEL   10663--CALLALT
DPMT
      9772**DCL     10509>>ASSIGN
ERRCHK
     10727**LABEL   10454--CALLALT 10467--GOTO    10481--GOTO    10539--GOTO
ERROUT
     10731**LABEL   10589--CALLALT 10620--GOTO
F$DCB.ACCT
       394**DCL     10837<<ASSIGN
F$DCB.ACS
       401**DCL     10839<<ASSIGN
F$DCB.ACTPOS
       409**DCL       409--REDEF
F$DCB.ARS
       384**DCL       384--REDEF   10457>>ASSIGN  10461<<ASSIGN  10461>>ASSIGN  10465<<ASSIGN  10465>>ASSIGN
     10646>>ASSIGN  10683>>ASSIGN
F$DCB.ASN
       399**DCL     10250>>IF      10264>>IF      10840<<ASSIGN
F$DCB.ATTR
       402**DCL       403--REDEF
F$DCB.ATTR.APL
       403**DCL     10443<<ASSIGN  10667<<ASSIGN
F$DCB.ATTR.BIN
       403**DCL     10668<<ASSIGN
F$DCB.ATTR.LOWERCASE
       403**DCL     10445<<ASSIGN  10669<<ASSIGN
F$DCB.ATTR.TRUOVRPRT
       402**DCL     10441<<ASSIGN  10666<<ASSIGN
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:158  
F$DCB.BORROW
       417**DCL       417--REDEF     417--REDEF     417--REDEF
F$DCB.CFU$
       418**DCL     10225>>IF
F$DCB.CTLCMDIN
       425**DCL     10225>>IF
F$DCB.DCBNAME.L
       431**DCL       431--IMP-SIZ
F$DCB.EOMCHAR
       388**DCL       388--REDEF
F$DCB.FCD
       397**DCL     10217>>IF      10222>>IF      10678>>IF      10834>>IF      10842>>IF
F$DCB.FLDID
       412**DCL       412--REDEF
F$DCB.FORM$
       406**DCL       406--REDEF
F$DCB.FSECT
       422**DCL       422--REDEF
F$DCB.FSN
       399**DCL       399--REDEF     399--REDEF     400--REDEF
F$DCB.HEADER$
       405**DCL       405--REDEF
F$DCB.IASN
       425**DCL     10224>>IF      10247>>IF
F$DCB.IXTNSIZE
       403**DCL       403--REDEF
F$DCB.KEYL
       401**DCL     10565>>IF      10568>>IF
F$DCB.KEYTYPE
       408**DCL     10342>>ASSIGN  10392>>ASSIGN  10428<<ASSIGN  10562>>ASSIGN
F$DCB.LASTSTA$
       393**DCL       393--REDEF
F$DCB.LDCTX
       406**DCL     10415>>IF      10419>>ASSIGN  10624>>IF
F$DCB.LINES
       405**DCL     10494<<ASSIGN  10664<<ASSIGN  10856<<ASSIGN
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:159  
F$DCB.LVL
       418**DCL       418--REDEF
F$DCB.MEDIA
       424**DCL     10225>>IF      10268>>IF
F$DCB.NAME
       393**DCL     10836<<ASSIGN
F$DCB.NAME.C
       393**DCL       393--REDEF
F$DCB.NOEOF
       414**DCL       414--REDEF
F$DCB.NRECS
       404**DCL       404--REDEF
F$DCB.NRECX
       423**DCL       423--REDEF
F$DCB.OHDR
       415**DCL       415--REDEF
F$DCB.ORG
       398**DCL       398--REDEF   10301>>IF      10334>>IF      10371>>IF      10382>>IF      10559>>IF
F$DCB.PRECNO
       421**DCL       421--REDEF
F$DCB.RCSZ
       426**DCL       426--REDEF
F$DCB.RES
       394**DCL       394--REDEF
F$DCB.SETX
       406**DCL       406--REDEF
F$DCB.SHARE
       397**DCL     10838<<ASSIGN
F$DCB.STR
       422**DCL     10289<<ASSIGN  10292>>ASSIGN  10293<<ASSIGN
F$DCB.TAB$
       405**DCL       406--REDEF
F$DCB.TDA
       420**DCL       420--REDEF
F$DCB.TYC
       384**DCL     10274<<ASSIGN  10590<<ASSIGN  10660>>IF      10730>>IF      10731<>CALL
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:160  
F$DCB.UB$
       422**DCL     10452<<ASSIGN  10456>>ASSIGN  10478<<ASSIGN  10543<<ASSIGN  10545<<ASSIGN  10557>>ASSIGN
     10645<<ASSIGN  10682<<ASSIGN  10726<<ASSIGN
F$DCB.UBYTES
       422**DCL     10453<<ASSIGN  10479<<ASSIGN  10547<<ASSIGN  10646<<ASSIGN  10683<<ASSIGN  10727<<ASSIGN
F$DCB.UCOUT
       419**DCL     10225>>IF      10823>>IF
F$DCB.WAIT
       416**DCL     10273<<ASSIGN
F$DCB.WIDTH
       391**DCL     10493<<ASSIGN  10665<<ASSIGN  10853<<ASSIGN
F$DCB.WSN
       395**DCL       395--REDEF
F$DCB.WSR
       401**DCL     10219<<ASSIGN
FMD$GBUF
      9828**DCL-ENT 10591--CALL
FMD$RBUF
      9829**DCL-ENT 10616--CALL
FMF$TYC
      9815**DCL-ENT 10731--CALL
FMM$DFLOPN
      9811**DCL-ENT 10220--CALL    10841--CALL
FMM$SCRUB
      9830**DCL-ENT 10835--CALL
FMO$GETDOMAIN
      9812**DCL-ENT 10218--CALL
FMO$GETPFB
      9813**DCL-ENT 10281--CALL
FMP$CLSF
      9814**DCL-ENT 10618--CALL    10834--CALL
FPT$DCLFLD_V.DVBYTE
      9184**DCL     10313>>ASSIGN
FPT$EOM_V.SUPPHALT
      8955**DCL     10526>>ASSIGN
FPT$EOM_V.TIMEOUT
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:161  
      8956**DCL     10528>>ASSIGN
FPT$EOM_V.UTYPE
      8955**DCL     10527>>ASSIGN
FPT$ERASE_V.DVBYTE
      9232**DCL     10327>>ASSIGN
FPT$ERASE_V.KEYTYPE
      9236**DCL     10328>>ASSIGN
FPT$MDFFLD_V.DVBYTE
      9164**DCL     10338>>ASSIGN
FPT$MDFFLD_V.KEYTYPE
      9168**DCL     10339>>ASSIGN
FPT$MDFFLD_V.SETGRPRND
      9169**DCL     10351>>IF
FPT$MDFFLD_V.SETQLF
      9169**DCL     10357>>IF
FPT$PROMPT_V.DVBYTE
      8942**DCL     10456<<ASSIGN  10503>>ASSIGN
FPT$PROMPT_V.DVBYTE.VFC
      8942**DCL     10458>>IF      10511>>IF
FPT$RLSFLD_V.DVBYTE
      9216**DCL     10375>>ASSIGN
FPT$RLSFLD_V.KEYTYPE
      9220**DCL     10376>>ASSIGN
FPT$SINPUT_V.DVBYTE
      9150**DCL     10564>>ASSIGN
FPT$SINPUT_V.POSITION
      9148**DCL     10549>>IF      10565>>IF      10577>>IF
FPT$SINPUT_V.REREADPOS
      9153**DCL     10575>>ASSIGN
FPT$SLCFLD_V.DVBYTE
      9200**DCL     10386>>ASSIGN
FPT$SLCFLD_V.KEYTYPE
      9204**DCL     10387>>ASSIGN
FPT$TRMCTL_V.VLPTYPE
      8967**DCL     10406>>IF      10406>>IF      10408>>ASSIGN  10470>>IF      10470>>IF      10472>>ASSIGN
FPT$TRMISC_V.ANNOUNCE
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:162  
      8989**DCL     10699>>IF      10701>>ASSIGN  10702>>ASSIGN
FPT$TRMISC_V.BROADCAST
      8989**DCL     10705>>IF      10708>>ASSIGN  10712>>ASSIGN
FPT$TRMISC_V.SEND
      8989**DCL     10694>>IF      10696>>ASSIGN  10697>>ASSIGN
FPT$TRMPRG_V
      8978**DCL     10537--ASSIGN
FPT$TRMPRG_V.CTLFLG.RSTBRK
      8979**DCL      8979--REDEF
FPTCODE
      9349**DCL     10296<<ASSIGN  10408<<ASSIGN  10408>>ASSIGN  10411>>IF      10421>>IF      10426>>IF
     10450<<ASSIGN  10472<<ASSIGN  10472>>ASSIGN  10480>>CALL    10498<<ASSIGN  10724>>ASSIGN  10773>>IF
     10789>>IF
GET_CMN
     10473**LABEL   10473--GOTO    10499--GOTO
HFF$DSIZ
      9824**DCL-ENT 10318--CALL    10347--CALL    10348--CALL    10394--CALL    10651--CALL    10772--CALL
HFF$NILERASE
      9823**DCL-ENT 10588--CALL
HFF$TRAPALT
      9827**DCL-ENT 10592--CALL
HFF$WRITE1
      9826**DCL-ENT 10652--CALL
ILGLNOTFORM
     10205**DCL     10304>>ASSIGN
IMP#
      9380**DCL     10672<<ASSIGN  10676>>DOINDEX
IMPPROKEY
      9371**DCL      9376--REDEF   10674--ASSIGN
IMPPROKEY.KEY
      9373**DCL     10673--ASSIGN
IMPPROKEY.KEY.IMP#
      9375**DCL     10676<<DOINDEX
IMPPROKEY.KEYSZ
      9372**DCL     10673<<ASSIGN
K$RWPARM
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:163  
      9434**DCL     10312<<ASSIGN  10321--CALL    10326<<ASSIGN  10337<<ASSIGN  10354--CALL    10360--CALL
     10365--CALL    10374<<ASSIGN  10385<<ASSIGN  10397--CALL    10536<<ASSIGN  10538--CALL    10553<<ASSIGN
     10582--CALL    10711<<ASSIGN  10713--CALL
K$RWPARM.BLKREC
      9460**DCL      9485--REDEF
K$RWPARM.BLKREC.BLKU#
      9461**DCL      9463--REDEF
K$RWPARM.BLKREC.RECU#
      9473**DCL      9475--REDEF
K$RWPARM.DVE.DVBYTE
      9492**DCL     10313<<ASSIGN  10327<<ASSIGN  10338<<ASSIGN  10375<<ASSIGN  10386<<ASSIGN  10564<<ASSIGN
K$RWPARM.DVE.DVBYTE.VFC
      9500**DCL      9501--REDEF
K$RWPARM.DVE.EOMCHAR
      9508**DCL      9512--REDEF
K$RWPARM.ERR
      9572**DCL      9577--REDEF
K$RWPARM.FC
      9536**DCL      9537--REDEF
K$RWPARM.FLDID
      9718**DCL      9719--REDEF
K$RWPARM.FPT$
      9599**DCL      9606--REDEF
K$RWPARM.KEY$
      9716**DCL     10350<<ASSIGN  10396<<ASSIGN  10561<<ASSIGN
K$RWPARM.KEYSZ
      9727**DCL     10349<<ASSIGN  10395<<ASSIGN  10563<<ASSIGN
K$RWPARM.KEYTYPE
      9725**DCL      9726--REDEF   10328<<ASSIGN  10339<<ASSIGN  10340>>IF      10342<<ASSIGN  10376<<ASSIGN
     10387<<ASSIGN  10390>>IF      10392<<ASSIGN  10562<<ASSIGN
K$RWPARM.MSG$
      9435**DCL      9441--REDEF   10315<<ASSIGN  10346<<ASSIGN  10557<<ASSIGN  10561>>ASSIGN
K$RWPARM.MSGID
      9547**DCL      9552--REDEF
K$RWPARM.MSGIDXT
      9560**DCL      9564--REDEF
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:164  
K$RWPARM.MSGSZ
      9442**DCL     10318<>CALL    10347<>CALL    10355<<ASSIGN  10361<<ASSIGN  10363>>IF      10558<<ASSIGN
     10560<<ASSIGN
K$RWPARM.ORG
      9696**DCL      9697--REDEF
K$RWPARM.PRMID
      9719**DCL     10556<<ASSIGN
K$RWPARM.THDRSZ
      9640**DCL      9644--REDEF
K$RWPARM.V$
      9715**DCL     10314<<ASSIGN  10343<<ASSIGN  10393<<ASSIGN  10537<<ASSIGN  10554<<ASSIGN
K$RWPARM.VDOFLGS
      9698**DCL      9709--REDEF
K$RWPARM.VDOFLGS.SEND
      9706**DCL     10712<<ASSIGN
K$RWPARM.VLP$
      9690**DCL     10317<<ASSIGN  10345<<ASSIGN
K$RWPARM.VSZ
      9717**DCL     10555<<ASSIGN  10578<<ASSIGN
KCI$TCTL
      9819**DCL-ENT 10265--ASSIGN  10647--IF
KIA$UCIO
      9818**DCL-ENT 10261--ASSIGN  10269--ASSIGN  10548--IF      10582--CALL    10622--IF
KIA$WINDOW
      9816**DCL-ENT 10423--CALL
KL$PHDR
      8905**DCL     10645--ASSIGN  10645--ASSIGN  10646--ASSIGN
KL$PHDR.ATTR.APL
      8917**DCL     10667>>ASSIGN
KL$PHDR.ATTR.BIN
      8918**DCL     10668>>ASSIGN
KL$PHDR.ATTR.LCASE
      8919**DCL     10669>>ASSIGN
KL$PHDR.ATTR.TRUOVRPRT
      8916**DCL     10666>>ASSIGN
KL$PHDR.IMP#
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:165  
      8923**DCL     10672>>ASSIGN
KL$PHDR.IO.INPUT
      8921**DCL     10636>>IF
KL$PHDR.LINES
      8908**DCL     10664>>ASSIGN
KL$PHDR.TTYP
      8906**DCL     10624>>IF
KL$PHDR.WIDTH
      8907**DCL     10665>>ASSIGN
K_RWPARM_CON
      6817**DCL     10312>>ASSIGN  10326>>ASSIGN  10337>>ASSIGN  10374>>ASSIGN  10385>>ASSIGN  10536>>ASSIGN
     10553>>ASSIGN  10711>>ASSIGN
K_RWPARM_CON.BLKREC
      6843**DCL      6868--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      6844**DCL      6846--REDEF
K_RWPARM_CON.BLKREC.RECU#
      6856**DCL      6858--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      6883**DCL      6884--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      6891**DCL      6895--REDEF
K_RWPARM_CON.ERR
      6955**DCL      6960--REDEF
K_RWPARM_CON.FC
      6919**DCL      6920--REDEF
K_RWPARM_CON.FLDID
      7101**DCL      7102--REDEF
K_RWPARM_CON.FPT$
      6982**DCL      6989--REDEF
K_RWPARM_CON.KEYTYPE
      7108**DCL      7109--REDEF
K_RWPARM_CON.MSG$
      6818**DCL      6824--REDEF
K_RWPARM_CON.MSGID
      6930**DCL      6935--REDEF
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:166  
K_RWPARM_CON.MSGIDXT
      6943**DCL      6947--REDEF
K_RWPARM_CON.ORG
      7079**DCL      7080--REDEF
K_RWPARM_CON.THDRSZ
      7023**DCL      7027--REDEF
K_RWPARM_CON.VDOFLGS
      7081**DCL      7092--REDEF
L6.T
      9330**DCL     10429<<ASSIGN
L66.T
      9332**DCL     10429>>ASSIGN
LENGTH
      9360**DCL      9361--REDEF   10457<<ASSIGN  10489<<ASSIGN  10490>>IF      10490<<ASSIGN  10491>>IF
     10494>>IF      10494>>ASSIGN  10855<<ASSIGN  10856>>IF      10856>>ASSIGN
M$MREAD
      9825**DCL-ENT 10603--CALL    10681--CALL
MEDIA
      9368**DCL     10259<<ASSIGN  10261<<ASSIGN  10265<<ASSIGN  10269<<ASSIGN  10321>>CALL    10354>>CALL
     10360>>CALL    10365>>CALL    10397>>CALL    10454>>CALL    10480>>CALL    10538>>CALL    10548>>IF
     10550>>CALL    10551>>CALL    10622>>IF      10647>>IF      10648>>CALL    10650>>CALL    10685>>CALL
     10709>>IF      10713>>CALL    10728>>CALL
MISOPT
     10185**DCL     10762>>ASSIGN
N$DCT$$
      8362**DCL      8362--IMP-PTR 10415>>IF      10419>>ASSIGN  10624>>IF
NILE IN PROCEDURE VLPCK
     10805**LABEL   10772--CALLALT
NK$LDCT.DDT$
      8324**DCL      8324--REDEF
NK$LDCT.IOQ$
      8323**DCL      8324--REDEF
NK$LDCT.LDCTX
      8325**DCL      8325--REDEF
NK$LDCT.LKFLG.ABORTED
      8337**DCL      8338--REDEF
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:167  
NK$LDCT.RLCID.LDCTX
      8347**DCL      8347--REDEF
NK$LDCT.STA$
      8343**DCL      8344--REDEF
NK$LDCT.SYMB$
      8322**DCL      8322--REDEF    8322--REDEF    8323--REDEF
NK$LDCT.TERMID.TTYP
      8350**DCL     10624>>IF
NK$LDCT.TH.MAXNMBRCR
      8348**DCL     10419<<ASSIGN
NK$LDCT.TH.MAXRCRBYTSIZ
      8349**DCL     10415>>IF
NK$LDCT$
      8362**DCL     10415>>IF      10419>>ASSIGN  10624>>IF
NKFUNC
     10201**DCL     10252>>ASSIGN
NOEOM
     10530**LABEL   10529--CALLALT
NOPROVEC
     10658**LABEL   10651--CALLALT
NOTFORM
     10301**LABEL   10336--GOTO    10373--GOTO    10384--GOTO
NOTTS
     10181**DCL     10232>>ASSIGN
NOVEC
     10758**LABEL   10402--CALLALT 10409--CALLALT 10434--CALLALT 10451--CALLALT 10477--CALLALT 10484--CALLALT
     10567--GOTO    10588--CALLALT
NO_WRT
     10173**DCL     10654>>ASSIGN
NXTDCB
     10810**PROC    10439--CALL    10492--CALL    10663--CALL
OCU$RWUC
      9817**DCL-ENT 10259--ASSIGN  10709--IF
ONON
     10602**LABEL   10592--CALLALT 10603--CALLALT
ONON1
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:168  
     10616**LABEL   10634--GOTO    10642--GOTO    10655--GOTO    10679--CALLALT 10690--GOTO
OPNPRO
     10831**PROC    10589--CALL    10679--CALL
OUTPUTONLY
     10209**DCL     10638>>ASSIGN
PFB
      9354**DCL      9355--REDEF    9358--REDEF   10218<>CALL    10219>>ASSIGN  10277<<ASSIGN  10281<>CALL
     10282>>IF      10284<<ASSIGN  10286>>IF      10288<<ASSIGN  10289>>ASSIGN  10292<<ASSIGN  10293>>ASSIGN
     10423<>CALL    10502>>ASSIGN  10506>>IF      10506<<ASSIGN  10507>>ASSIGN  10509>>ASSIGN  10525>>ASSIGN
     10574>>ASSIGN
PMMECOD
      9348**DCL        10--PROC    10251>>IF      10251>>IF      10296>>ASSIGN  10298>>DOCASE  10849--ENTRY
     10850--ASSIGN  10852--IF      10855--ASSIGN
PRO
      9266**DCL     10836>>ASSIGN
PROBUF
      9316**DCL     10602--ASSIGN
RDPC
      9285**DCL     10594>>ASSIGN
RDPC.STATION_
      9288**DCL      9289--REDEF
RDPC.V
      9289**DCL      9285--DCLINIT
RDPC.V.DVBYTE.REREAD#
      9300**DCL      9300--REDEF
RDPC.V.INDX#
      9298**DCL      9298--REDEF
RDPRO
      9746**DCL     10594<<ASSIGN  10603<>CALL    10681<>CALL
RDPRO.BUF_
      9748**DCL     10602<<ASSIGN
RDPRO.KEY_
      9746**DCL     10599<<ASSIGN  10674<<ASSIGN
RDPRO.STATION_
      9749**DCL      9750--REDEF
RDPRO.V
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:169  
      9750**DCL     10596--ASSIGN
RDPRO.V.DCB#
      9750**DCL     10595<<ASSIGN
RDPRO.V.DVBYTE.REREAD#
      9761**DCL      9761--REDEF
RDPRO.V.INDX#
      9759**DCL      9759--REDEF
RDPRO.V_
      9746**DCL     10596--ASSIGN
RTN
     10684**LABEL   10681--CALLALT
S$CU$
       712**DCL     10696>>ASSIGN  10701>>ASSIGN
SDCB$
      9369**DCL     10223<<ASSIGN  10279>>IF      10292>>ASSIGN  10301>>IF      10320>>ASSIGN  10334>>IF
     10342>>ASSIGN  10371>>IF      10382>>IF      10392>>ASSIGN  10428>>ASSIGN  10441>>ASSIGN  10443>>ASSIGN
     10445>>ASSIGN  10461>>ASSIGN  10465>>ASSIGN  10493>>ASSIGN  10494>>ASSIGN  10559>>IF      10562>>ASSIGN
     10565>>IF      10568>>IF      10664>>ASSIGN  10665>>ASSIGN  10666>>ASSIGN  10667>>ASSIGN  10668>>ASSIGN
     10669>>ASSIGN  10813<<ASSIGN  10822<<ASSIGN  10823>>IF      10823>>IF
TCTL
      9407**DCL     10554--ASSIGN  10574--ASSIGN  10575--ASSIGN  10576--ASSIGN  10576--ASSIGN  10579--ASSIGN
     10726--ASSIGN
TCTL.L
      9409**DCL      9410--REDEF   10725<<ASSIGN
TCTL.M
      9411**DCL     10403--ASSIGN  10410--ASSIGN  10413--IF      10414--ASSIGN  10415--IF      10422--ASSIGN
     10423<>CALL    10427--IF      10428--ASSIGN  10429--ASSIGN  10429--ASSIGN  10437--ASSIGN  10485--ASSIGN
     10502--ASSIGN  10503--ASSIGN  10507--ASSIGN  10509--ASSIGN  10513--ASSIGN  10514--ASSIGN  10517--ASSIGN
     10518--ASSIGN  10521--CALL    10525--ASSIGN  10526--ASSIGN  10527--ASSIGN  10528--ASSIGN  10530--ASSIGN
TCTL.T
      9408**DCL     10724<<ASSIGN
TDCB$
      9358**DCL     10816<<ASSIGN  10822>>ASSIGN
TERR
      9361**DCL     10605<<ASSIGN  10619>>ASSIGN  10626<<ASSIGN  10638<<ASSIGN  10654<<ASSIGN  10689<<ASSIGN
TERR.CODE
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:170  
      9364**DCL     10607>>IF      10608>>IF
TERR.FCGMID
      9362**DCL     10610<<ASSIGN
TFCN
      9355**DCL     10321<>CALL    10354<>CALL    10360<>CALL    10365<>CALL    10397<>CALL    10538<>CALL
     10582<>CALL    10713<>CALL
TFCN.FCN
      9356**DCL     10319<<ASSIGN  10329<<ASSIGN  10353<<ASSIGN  10359<<ASSIGN  10364<<ASSIGN  10377<<ASSIGN
     10388<<ASSIGN  10535<<ASSIGN  10581<<ASSIGN  10710<<ASSIGN
TOOBIG
     10189**DCL     10569>>ASSIGN  10774>>ASSIGN
TOOSMALL
     10193**DCL     10570>>ASSIGN  10790>>ASSIGN
UCFLG
      9367**DCL     10262<<ASSIGN  10266<<ASSIGN  10270<<ASSIGN  10275>>IF      10412>>IF      10435>>IF
     10520>>IF      10622>>IF      10693>>IF      10707>>IF      10812>>IF      10814>>IF      10815<<ASSIGN
     10818<<ASSIGN  10821<<DOINDEX 10821>>DOINDEX 10822>>ASSIGN  10824<<ASSIGN  10824>>ASSIGN
UDB$PMMEXIT
      9821**DCL-ENT 10804--CALL
UMD$DBPRMT
      9822**DCL-ENT 10521--CALL
VCHRET.M
      9340**DCL     10530<<ASSIGN
VCHRET.PFB
      9334**DCL     10525<<ASSIGN
VCHRET.SUPPHALT
      9336**DCL     10526<<ASSIGN
VCHRET.TIMEOUT
      9339**DCL     10528<<ASSIGN
VCHRET.UNITS
      9338**DCL     10527<<ASSIGN
VCHRPMT
      9308**DCL     10521<>CALL
VCHRPMT.DVBYTE
      9310**DCL     10456>>ASSIGN  10503<<ASSIGN
VCHRPMT.M
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:171  
      9313**DCL     10509<<ASSIGN  10514<<ASSIGN  10518<<ASSIGN
VCHRPMT.PFB
      9309**DCL     10502<<ASSIGN
VCHRPMT.VFC
      9312**DCL     10507<<ASSIGN  10513<<ASSIGN  10517<<ASSIGN
VCHRV.M
      9343**DCL     10514>>ASSIGN
VCHRV.VFC
      9342**DCL     10513>>ASSIGN
VCHRZ
      9317**DCL     10403<<ASSIGN  10403>>ASSIGN  10410<<ASSIGN  10410>>ASSIGN  10437<<ASSIGN  10437>>ASSIGN
     10460<<ASSIGN  10460>>ASSIGN  10464<<ASSIGN  10464>>ASSIGN  10485<<ASSIGN  10485>>ASSIGN  10518>>ASSIGN
     10530>>ASSIGN  10658<<ASSIGN  10658>>ASSIGN
VEC.P$
      9240**DCL     10596<<ASSIGN
VFCDP
      9773**DCL     10507>>ASSIGN
VLP$EDTCTL_V
      9132**DCL      9784--DCLINIT  9793--DCLINIT
VLP$EDTCTL_V.KEYINCR
      9133**DCL     10429--ASSIGN  10429--ASSIGN
VLP$EDTCTL_V.KEYTYPE
      9132**DCL     10427>>IF      10428>>ASSIGN
VLP$EOMTABLE_V
      9044**DCL      9796--DCLINIT
VLP$FLDATR_V
      9004**DCL     10316>>ASSIGN  10344>>ASSIGN
VLP$LINEATTR_V
      9055**DCL      9787--DCLINIT
VLP$LINEATTR_V.PROFILE
      9056**DCL      9056--REDEF
VLP$PLATEN_V
      9094**DCL      9789--DCLINIT  9798--DCLINIT
VLP$PLATEN_V.EXTWID
      9095**DCL     10488>>IF      10852>>IF
VLP$PLATEN_V.LENGTH
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:172  
      9094**DCL     10489>>ASSIGN  10855>>ASSIGN
VLP$PLATEN_V.WIDTH
      9094**DCL     10486>>ASSIGN  10850>>ASSIGN
VLP$TAB_V
      9009**DCL      9790--DCLINIT  9799--DCLINIT
VLP$TRMATTR_V
      9072**DCL      9788--DCLINIT  9797--DCLINIT
VLP$TRMATTR_V.APL
      9074**DCL     10442>>IF      10443>>ASSIGN
VLP$TRMATTR_V.LOWERCASEPRINTS
      9074**DCL     10444>>IF      10445>>ASSIGN
VLP$TRMATTR_V.SPEED
      9077**DCL     10435>>IF      10436>>ASSIGN
VLP$TRMATTR_V.TRUOVRPRT
      9074**DCL     10440>>IF      10441>>ASSIGN
VLP$TRMCTL_V
      9023**DCL      9786--DCLINIT  9795--DCLINIT
VLP$TRMCTL_V.BREAKCOUNT
      9027**DCL      9027--REDEF
VLP$TRMCTL_V.OUTPUTDISCARD
      9024**DCL     10415>>IF
VLP$TRMCTL_V.SINPUTSZ
      9027**DCL     10413>>IF      10414>>ASSIGN
VLP$WINDOW_V
      9110**DCL      9785--DCLINIT  9794--DCLINIT
VLP$WINDOW_V.FWINDOW
      9110**DCL      9110--REDEF    9110--REDEF
VLP$WINDOW_V.POSITION
      9111**DCL     10422<<ASSIGN
VLPCK
     10770**PROC    10402--CALL    10409--CALL    10434--CALL    10451--CALL    10477--CALL    10484--CALL
     10504--CALL    10529--CALL    10544--CALL
VLPCTL.MINVLP
      9783**DCL     10789>>IF
VLPCTL.MXVLP
      9792**DCL     10773>>IF
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:173  
VLPCTL.PCODE
      9776**DCL     10454<>CALL    10480<>CALL    10724>>ASSIGN
VLPSIZ
      9350**DCL      9313--IMP-SIZ  9317--IMP-SIZ  9340--IMP-SIZ  9343--IMP-SIZ  9351--REDEF   10348<>CALL
     10349>>ASSIGN  10350>>IF      10394<>CALL    10395>>ASSIGN  10396>>IF      10403>>ASSIGN  10403>>ASSIGN
     10410>>ASSIGN  10410>>ASSIGN  10437>>ASSIGN  10437>>ASSIGN  10453>>ASSIGN  10460>>ASSIGN  10460>>ASSIGN
     10460>>ASSIGN  10464>>ASSIGN  10464>>ASSIGN  10464>>ASSIGN  10479>>ASSIGN  10485>>ASSIGN  10485>>ASSIGN
     10505>>IF      10508<<ASSIGN  10509>>ASSIGN  10512<<ASSIGN  10512>>ASSIGN  10514>>ASSIGN  10514>>ASSIGN
     10518>>ASSIGN  10518>>ASSIGN  10521>>CALL    10521<>CALL    10522<<ASSIGN  10522>>ASSIGN  10530>>ASSIGN
     10530>>ASSIGN  10532<<ASSIGN  10532>>ASSIGN  10547>>ASSIGN  10558>>ASSIGN  10563>>ASSIGN  10565>>IF
     10567>>IF      10568>>IF      10593<<ASSIGN  10651<>CALL    10657<<ASSIGN  10657>>ASSIGN  10658>>ASSIGN
     10658>>ASSIGN  10725>>ASSIGN  10727>>ASSIGN  10772<>CALL    10773>>IF      10789>>IF
VLP_FLDATR
      9398**DCL     10316<<ASSIGN  10317--ASSIGN  10344<<ASSIGN  10345--ASSIGN
VSIN
      9321**DCL     10555--ASSIGN  10578--ASSIGN
VSIN.PFB
      9322**DCL     10574<<ASSIGN
VSIN.POS
      9324**DCL      9325--REDEF    9327--REDEF   10575<<ASSIGN  10579<<ASSIGN
VSIN.POSL6.T
      9326**DCL     10576<<ASSIGN
VSIN.POSL66.T
      9328**DCL     10576>>ASSIGN
VTXTC.CNT
      9319**DCL      9320--IMP-SIZ 10597>>CALLBLT 10598>>ASSIGN
VTXTC.TXT
      9320**DCL     10597>>CALLBLT
WIDTH
      9366**DCL     10486<<ASSIGN  10487>>IF      10487<<ASSIGN  10488<<ASSIGN  10488>>ASSIGN  10491>>IF
     10493>>IF      10493>>ASSIGN  10850<<ASSIGN  10851>>IF      10852<<ASSIGN  10852>>ASSIGN  10853>>ASSIGN
XPNAME
      9376**DCL     10599--ASSIGN
XPNAME.CNT
      9377**DCL     10598<<ASSIGN  10600>>IF      10601<<ASSIGN
XPNAME.TXT
PL6.E3A0      #001=KIP$PMME File=KIP$PMME.:E05TSI                                WED 07/30/97 00:35 Page:174  
      9378**DCL     10597<<CALLBLT

PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:175  
      902        1        /*T***********************************************************/
      903        2        /*T*                                                         */
      904        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      905        4        /*T*                                                         */
      906        5        /*T***********************************************************/
      907        6        /**/
      908        7        /**/
      909        8        KIP$RPET: PROC;
      910        9        /**/
      911       10        /**/
      912       11        %INCLUDE F$DCB;
      913       60 S      %INCLUDE B$JIT_C;
      914       61        %B$JIT0;
      915      150        %U$JIT1;
      916      224        %M$JIT2X;
      917      227        %F$JIT3;
      918      232        %A$JIT6X;
      919      235        %INCLUDE NK_VFC_C;
      920      309        %INCLUDE F_FPTCODE_C;
      921      345        %INCLUDE KV_PRMID_E;
      922      519        %KV_PRMID_E;
      923      675        %INCLUDE CP_6_SUBS;
      924     1215        %INCLUDE KI_SUBS_C;
      925     1351        %INCLUDE KI_MACROS_C;
      926     1959        /**/
      927     1960        /**/
      928     1961    1   DCL B$JIT$ PTR SYMREF;
      929     1962    1   DCL B$M$UC$ PTR SYMREF READONLY;
      930     1963    1   DCL DCB$ REDEF B$M$UC$ PTR;
      931     1964    1   DCL MEDIA EPTR;
      932     1965    1   DCL 1 PRMRST CONSTANT ALIGNED,
      933     1966    1            2 PRMT UBIN(9) UNAL INIT(%KV_PRMID_PROMPT),
      934     1967    1            2 PRML UBIN(9) UNAL INIT(4),
      935     1968    1            2 PRMPFB UBIN(9) UNAL INIT(KIDM_USER),
      936     1969    1            2 DVBYTE UBIN(9) UNAL INIT(0),
      937     1970    1            2 VFC CHAR(1) UNAL INIT(%VFC_EXT),
      938     1971    1            2 PROMPT CHAR(1) UNAL INIT('*'),
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:176  
      939     1972    1            2 EOMT UBIN(9) UNAL INIT(%KV_PRMID_EOM),
      940     1973    1            2 EOML UBIN(9) UNAL INIT(36),
      941     1974    1            2 EOMPFB UBIN(9) UNAL INIT(KIDM_USER),
      942     1975    1            2 RSVD UBIN(9) UNAL INIT(0),
      943     1976    1            2 UNITS UBIN(9) UNAL INIT(0),
      944     1977    1            2 TIMEOUT UBIN(9) UNAL INIT(0),
      945     1978    1            2 EOMTABLE(0:31) UBIN(9) UNAL INIT(
      946     1979    1           8,44,0,47,0*12,8,44,0,47,0*12),
      947     1980    1            2 HDRT UBIN(9) UNAL INIT(%KV_PRMID_DCBHDR),
      948     1981    1            2 HDRL UBIN(9) UNAL INIT(0);
      949     1982    1   DCL KIA$UCIO ENTRY(5) ALTRET;
      950     1983    1   DCL OCU$RWUC ENTRY(4) ALTRET;
      951     1984    1   DCL UMD$CLSDRIB ENTRY ALTRET;
      952     1985        /**/
      953     1986        /**/
      954     1987    1        IF B$JIT.MODE~=%M_INT# THEN RETURN;
      955     1988    1        B$JIT$->B$JIT.DCB$=DCB$;
      956     1989    1        IF DCB$->F$DCB.FCD='0'B OR DCB$->F$DCB.LDCTX=0 THEN RETURN;
      957     1990    1        DCB$->F$DCB.WAIT=1;
      958     1991    1        IF DCB$->F$DCB.ASN=%COMGROUP# THEN MEDIA=ENTADDR(OCU$RWUC);
      959     1992    1        ELSE MEDIA=ENTADDR(KIA$UCIO);
      960     1993    1        DCB$->F$DCB.UB$=ADDR(PRMRST);
      961     1994    1        DCB$->F$DCB.UBYTES=LENGTHC(PRMRST);
      962     1995    1        CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SPM,0);
      963     1996    1        IF B$JIT.CPFLAGS1 & %CP_DRIBBLE# THEN
      964     1997    1             CALL UMD$CLSDRIB;
      965     1998    1        RETURN;
      966     1999        /**/
      967     2000    1   END;
      968     2001        /**/
      969     2002        %EOD;

PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:177  
--  Include file information  --

   KI_MACROS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KIP$RPET.

   Procedure KIP$RPET requires 45 words for executable code.
   Procedure KIP$RPET requires 4 words of local(AUTO) storage.

PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:178  

 Object Unit name= KIP$RPET                                   File name= KIP$PMME.:E05TOU
 UTS= JUL 30 '97 00:37:32.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     13     15  KIP$RPET
    1   Proc  even  none    45     55  KIP$RPET
    2  RoData even  none     7      7  KIP$RPET

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  KIP$RPET

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       4 OCU$RWUC
 yes     yes           Std       5 KIA$UCIO
 yes     yes           Std       0 UMD$CLSDRIB
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                           r    B$M$UC$                               B_VECTNIL
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:179  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:180  


      902        1        /*T***********************************************************/
      903        2        /*T*                                                         */
      904        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      905        4        /*T*                                                         */
      906        5        /*T***********************************************************/
      907        6        /**/
      908        7        /**/
      909        8        KIP$RPET: PROC;

      8  1 000000   000000 700200 xent  KIP$RPET     TSX0  ! X66_AUTO_0
         1 000001   000004 000000                    ZERO    4,0

      910        9        /**/
      911       10        /**/
      912       11        %INCLUDE F$DCB;
      913       60 S      %INCLUDE B$JIT_C;
      914       61        %B$JIT0;
      915      150        %U$JIT1;
      916      224        %M$JIT2X;
      917      227        %F$JIT3;
      918      232        %A$JIT6X;
      919      235        %INCLUDE NK_VFC_C;
      920      309        %INCLUDE F_FPTCODE_C;
      921      345        %INCLUDE KV_PRMID_E;
      922      519        %KV_PRMID_E;
      923      675        %INCLUDE CP_6_SUBS;
      924     1215        %INCLUDE KI_SUBS_C;
      925     1351        %INCLUDE KI_MACROS_C;
      926     1959        /**/
      927     1960        /**/
      928     1961    1   DCL B$JIT$ PTR SYMREF;
      929     1962    1   DCL B$M$UC$ PTR SYMREF READONLY;
      930     1963    1   DCL DCB$ REDEF B$M$UC$ PTR;
      931     1964    1   DCL MEDIA EPTR;
      932     1965    1   DCL 1 PRMRST CONSTANT ALIGNED,
      933     1966    1            2 PRMT UBIN(9) UNAL INIT(%KV_PRMID_PROMPT),
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:181  
      934     1967    1            2 PRML UBIN(9) UNAL INIT(4),
      935     1968    1            2 PRMPFB UBIN(9) UNAL INIT(KIDM_USER),
      936     1969    1            2 DVBYTE UBIN(9) UNAL INIT(0),
      937     1970    1            2 VFC CHAR(1) UNAL INIT(%VFC_EXT),
      938     1971    1            2 PROMPT CHAR(1) UNAL INIT('*'),
      939     1972    1            2 EOMT UBIN(9) UNAL INIT(%KV_PRMID_EOM),
      940     1973    1            2 EOML UBIN(9) UNAL INIT(36),
      941     1974    1            2 EOMPFB UBIN(9) UNAL INIT(KIDM_USER),
      942     1975    1            2 RSVD UBIN(9) UNAL INIT(0),
      943     1976    1            2 UNITS UBIN(9) UNAL INIT(0),
      944     1977    1            2 TIMEOUT UBIN(9) UNAL INIT(0),
      945     1978    1            2 EOMTABLE(0:31) UBIN(9) UNAL INIT(
      946     1979    1           8,44,0,47,0*12,8,44,0,47,0*12),
      947     1980    1            2 HDRT UBIN(9) UNAL INIT(%KV_PRMID_DCBHDR),
      948     1981    1            2 HDRL UBIN(9) UNAL INIT(0);
      949     1982    1   DCL KIA$UCIO ENTRY(5) ALTRET;
      950     1983    1   DCL OCU$RWUC ENTRY(4) ALTRET;
      951     1984    1   DCL UMD$CLSDRIB ENTRY ALTRET;
      952     1985        /**/
      953     1986        /**/
      954     1987    1        IF B$JIT.MODE~=%M_INT# THEN RETURN;

   1987  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000000 236100                    LDQ     0,,PR0
         1 000004   740000 376003                    ANQ     -16384,DU
         1 000005   140000 116003                    CMPQ    49152,DU
         1 000006   000010 600000 1                  TZE     s:1988

   1987  1 000007   000000 702200 xent               TSX2  ! X66_ARET

      955     1988    1        B$JIT$->B$JIT.DCB$=DCB$;

   1988  1 000010   000000 236000 xsym               LDQ     B$M$UC$
         1 000011   000232 756100                    STQ     154,,PR0

      956     1989    1        IF DCB$->F$DCB.FCD='0'B OR DCB$->F$DCB.LDCTX=0 THEN RETURN;

PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:182  
   1989  1 000012   000000 471400 xsym               LDP1    B$M$UC$
         1 000013   100031 236100                    LDQ     25,,PR1
         1 000014   020000 316007                    CANQ    8192,DL
         1 000015   000020 600000 1                  TZE     s:1989+6
         1 000016   100051 220100                    LDX0    41,,PR1
         1 000017   000021 601000 1                  TNZ     s:1990

   1989  1 000020   000000 702200 xent               TSX2  ! X66_ARET

      957     1990    1        DCB$->F$DCB.WAIT=1;

   1990  1 000021   000020 236007                    LDQ     16,DL
         1 000022   100064 256100                    ORSQ    52,,PR1

      958     1991    1        IF DCB$->F$DCB.ASN=%COMGROUP# THEN MEDIA=ENTADDR(OCU$RWUC);

   1991  1 000023   100032 236100                    LDQ     26,,PR1
         1 000024   777000 376007                    ANQ     -512,DL
         1 000025   004000 116007                    CMPQ    2048,DL
         1 000026   000032 601000 1                  TNZ     s:1992

   1991  1 000027   000000 636000 xent               EAQ     OCU$RWUC
         1 000030   200003 756100                    STQ     MEDIA,,AUTO
         1 000031   000034 710000 1                  TRA     s:1993

      959     1992    1        ELSE MEDIA=ENTADDR(KIA$UCIO);

   1992  1 000032   000000 636000 xent               EAQ     KIA$UCIO
         1 000033   200003 756100                    STQ     MEDIA,,AUTO

      960     1993    1        DCB$->F$DCB.UB$=ADDR(PRMRST);

   1993  1 000034   000000 236000 2                  LDQ     0
         1 000035   100075 756100                    STQ     61,,PR1

      961     1994    1        DCB$->F$DCB.UBYTES=LENGTHC(PRMRST);

PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:183  
   1994  1 000036   000056 235007                    LDA     46,DL
         1 000037   100076 755100                    STA     62,,PR1

      962     1995    1        CALL MEDIA (MFC_WRITE,%DVBYTE_VFC#,%VFC_SPM,0);

   1995  1 000040   000003 630400 2                  EPPR0   3
         1 000041   200003 221100                    LDX1    MEDIA,,AUTO
         1 000042   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000043   000000 701011                    TSX1    0,X1
         1 000044   000000 011000                    NOP     0

      963     1996    1        IF B$JIT.CPFLAGS1 & %CP_DRIBBLE# THEN

   1996  1 000045   000000 470400 xsym               LDP0    B$JIT$
         1 000046   000143 236100                    LDQ     99,,PR0
         1 000047   000014 376000 0                  ANQ     PRMRST+12
         1 000050   000054 600000 1                  TZE     s:1998

      964     1997    1             CALL UMD$CLSDRIB;

   1997  1 000051   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000052   000000 701000 xent               TSX1    UMD$CLSDRIB
         1 000053   000000 011000                    NOP     0

      965     1998    1        RETURN;

   1998  1 000054   000000 702200 xent               TSX2  ! X66_ARET

PRMRST
 Sect OctLoc
   0     000   005004 002000   100052 006044   002000 000000   010054 000057    ....@*.$.....,./
   0     004   000000 000000   000000 000000   000000 000000   010054 000057    .............,./
   0     010   000000 000000   000000 000000   000000 000000   024000 ******    ................

(unnamed)
 Sect OctLoc
   0     014   000000 100000                                                    ..@.
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:184  

(unnamed)
 Sect OctLoc
   2     000   000000 006000   100000 000000   024040 040040   000003 006000    ....@....   ....
   2     004   000001 006000   000002 006000   000002 006000                    ............
      966     1999        /**/
      967     2000    1   END;
      968     2001        /**/
      969     2002        %EOD;

PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:185  
--  Include file information  --

   KI_MACROS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KIP$RPET.
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:186  

 **** Variables and constants ****

  ****  Section 000 RoData KIP$RPET

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(414)   r     1 PRMRST

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w EPTR        r     1 MEDIA

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$UC$
     0-0-0/w PTR         r     1 DCB$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(7560)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB


   Procedure KIP$RPET requires 45 words for executable code.
   Procedure KIP$RPET requires 4 words of local(AUTO) storage.
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:187  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:188  
          MINI XREF LISTING

B$JIT.CPFLAGS1
       156**DCL      1996>>IF
B$JIT.CPFLAGS1.SLEAZE
       161**DCL       161--REDEF
B$JIT.DCB$
       228**DCL      1988<<ASSIGN
B$JIT.ERR.MID
        68**DCL        68--REDEF
B$JIT.MODE
        62**DCL      1987>>IF
B$JIT$
      1961**DCL        62--IMP-PTR  1987>>IF       1988>>ASSIGN   1996>>IF
B$M$UC$
      1962**DCL      1963--REDEF
DCB$
      1963**DCL      1988>>ASSIGN   1989>>IF       1989>>IF       1990>>ASSIGN   1991>>IF       1993>>ASSIGN
      1994>>ASSIGN
F$DCB.ACTPOS
        37**DCL        37--REDEF
F$DCB.ARS
        12**DCL        12--REDEF
F$DCB.ASN
        27**DCL      1991>>IF
F$DCB.ATTR
        30**DCL        31--REDEF
F$DCB.BORROW
        45**DCL        45--REDEF      45--REDEF      45--REDEF
F$DCB.DCBNAME.L
        59**DCL        59--IMP-SIZ
F$DCB.EOMCHAR
        16**DCL        16--REDEF
F$DCB.FCD
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:189  
        25**DCL      1989>>IF
F$DCB.FLDID
        40**DCL        40--REDEF
F$DCB.FORM$
        34**DCL        34--REDEF
F$DCB.FSECT
        50**DCL        50--REDEF
F$DCB.FSN
        27**DCL        27--REDEF      27--REDEF      28--REDEF
F$DCB.HEADER$
        33**DCL        33--REDEF
F$DCB.IXTNSIZE
        31**DCL        31--REDEF
F$DCB.LASTSTA$
        21**DCL        21--REDEF
F$DCB.LDCTX
        34**DCL      1989>>IF
F$DCB.LVL
        46**DCL        46--REDEF
F$DCB.NAME.C
        21**DCL        21--REDEF
F$DCB.NOEOF
        42**DCL        42--REDEF
F$DCB.NRECS
        32**DCL        32--REDEF
F$DCB.NRECX
        51**DCL        51--REDEF
F$DCB.OHDR
        43**DCL        43--REDEF
F$DCB.ORG
        26**DCL        26--REDEF
F$DCB.PRECNO
        49**DCL        49--REDEF
F$DCB.RCSZ
        54**DCL        54--REDEF
F$DCB.RES
PL6.E3A0      #002=KIP$RPET File=KIP$PMME.:E05TSI                                WED 07/30/97 00:37 Page:190  
        22**DCL        22--REDEF
F$DCB.SETX
        34**DCL        34--REDEF
F$DCB.TAB$
        33**DCL        34--REDEF
F$DCB.TDA
        48**DCL        48--REDEF
F$DCB.UB$
        50**DCL      1993<<ASSIGN
F$DCB.UBYTES
        50**DCL      1994<<ASSIGN
F$DCB.WAIT
        44**DCL      1990<<ASSIGN
F$DCB.WSN
        23**DCL        23--REDEF
KIA$UCIO
      1982**DCL-ENT  1992--ASSIGN
MEDIA
      1964**DCL      1991<<ASSIGN   1992<<ASSIGN   1995>>CALL
OCU$RWUC
      1983**DCL-ENT  1991--ASSIGN
PRMRST
      1965**DCL      1993--ASSIGN   1994--ASSIGN
UMD$CLSDRIB
      1984**DCL-ENT  1997--CALL

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:191  
      970        1        /*T***********************************************************/
      971        2        /*T*                                                         */
      972        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      973        4        /*T*                                                         */
      974        5        /*T***********************************************************/
      975        6        /**/
      976        7        /**/
      977        8        KIP$CPMME: PROC (FPTCODE);
      978        9        /**/
      979       10        /**/
      980       11        %INCLUDE K_DATA_R;
      981      722        %INCLUDE NK$LDCT;
      982      824 S      %INCLUDE B$JIT_C;
      983      825        %B$JIT0;
      984      914        %A$JIT6X;
      985      917        %INCLUDE KI$CP6V_C;
      986     1356        %INCLUDE KI_DATA_R;
      987     1382        %INCLUDE KI_MACROS_C;
      988     1990        %INCLUDE NK_LDCT_R;
      989     1999        %INCLUDE JG_GHOSTS_C;
      990     2089        %INCLUDE SS_SCHED_C;
      991     2322        %INCLUDE NK_SUBS;
      992     2347        %INCLUDE KI_SUBS_C;
      993     2483        %INCLUDE UD_EQU_E;
      994     2872        %INCLUDE KL_MACRO_C;
      995     6224        %INCLUDE KL_AFCN_C;
      996     6325        /**/
      997     6326        %KI$FEI (STCLASS="BASED(FEI$)");
      998     6410        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
      999     6464    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
     1000     6465        %FPT$NODEINFO_V (BASED="BASED(B$PS0$)");
     1001     6468        %VLR$NODEINFO_V (FPTN=VLR$NODEINFO,BASED="BASED(B$PS1$)");
     1002     6473        %NK$LDCT;
     1003     6519        %FPT$FECTL_V (FPTN=FECTL);
     1004     6523        %KL_FEPST (STCLASS="");
     1005     6558        /**/
     1006     6559        /**/
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:192  
     1007     6560    1   DCL FPTCODE UBIN WORD;
     1008     6561    1   DCL FEI UBIN WORD;
     1009     6562    1   DCL FEI$ PTR;
     1010     6563    1   DCL ROUTE$ PTR;
     1011     6564    1   DCL FEX UBIN;
     1012     6565    1   DCL TEMP UBIN WORD;
     1013     6566    1   DCL 1 TEMPE REDEF TEMP,
     1014     6567    1            2 PROB UBIN HALF UNAL,
     1015     6568    1            2 STATE UBIN HALF UNAL;
     1016     6569    1   DCL OCQ$ PTR;
     1017     6570    1   DCL 1 VRSLTS BASED DALIGNED,
     1018     6571    1            2 ERROR UBIN WORD,
     1019     6572    1            2 ARS UBIN WORD;
     1020     6573    1   DCL B$JIT$ PTR SYMREF;
     1021     6574    1   DCL S_CUN UBIN WORD SYMREF;
     1022     6575    1   DCL B$PS1$ PTR SYMREF;
     1023     6576    1   DCL B$PS0$ PTR SYMREF;
     1024     6577    1   DCL B$PS2$ PTR SYMREF;
     1025     6578    1   DCL MMS$WSQMAP ENTRY(1) ALTRET;
     1026     6579    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1027     6580    1   DCL KIN$CONV_NODE ENTRY(3) ALTRET;
     1028     6581    1   DCL KIN$CONV_NODENAME ENTRY(3) ALTRET;
     1029     6582    1   DCL KIQ$FEBOOT ENTRY(2);
     1030     6583    1   DCL KIQ$DUMPGO ENTRY(1);
     1031     6584    1   DCL KIQ$FEABT ENTRY(2);
     1032     6585    1   DCL KIQ$FESTOP ENTRY(2);
     1033     6586    1   DCL KIQ$FESTRT ENTRY(1);
     1034     6587    1   DCL HFF$DSIZ ENTRY(2) ALTRET;
     1035     6588    1   DCL SSS$BLOCK ENTRY;
     1036     6589    1   DCL SSR$REG ENTRY(3) ALTRET;
     1037     6590    1   DCL SSR$RUE ENTRY(4);
     1038     6591    1   DCL MMS$VGET ENTRY(4) ALTRET;
     1039     6592    1   DCL KIS$REMFEP ENTRY(3) ALTRET;
     1040     6593        /**/
     1041     6594        /**/
     1042     6595        %INCLUDE KI_ERRORS_C;
     1043     6680        %INCLUDE UD_ERRORS_C;
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:193  
     1044     6722        %INCLUDE UD_SEV_C;
     1045     6736        /**/
     1046     6737    1   DCL 1 CURBT CONSTANT ALIGNED,
     1047     6738    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1048     6739    1            2 ERR UBIN(15) UNAL INIT(%E$CURBOOT),
     1049     6740    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1050     6741    1   DCL 1 NOOPT CONSTANT ALIGNED,
     1051     6742    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1052     6743    1            2 ERR UBIN(15) UNAL INIT(%E$NILOPT),
     1053     6744    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1054     6745    1   DCL 1 NMAP CONSTANT ALIGNED,
     1055     6746    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1056     6747    1            2 ERR UBIN(15) UNAL INIT(%E$NFEMAP),
     1057     6748    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1058     6749    1   DCL 1 BDFEI CONSTANT ALIGNED,
     1059     6750    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1060     6751    1            2 ERR UBIN(15) UNAL INIT(%E$BADFEX),
     1061     6752    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1062     6753    1   DCL 1 NHLTD CONSTANT ALIGNED,
     1063     6754    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1064     6755    1            2 ERR UBIN(15) UNAL INIT(%E$FEPRUN),
     1065     6756    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1066     6757    1   DCL 1 FEPDN CONSTANT ALIGNED,
     1067     6758    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1068     6759    1            2 ERR UBIN(15) UNAL INIT(%E$FEPDN),
     1069     6760    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1070     6761    1   DCL 1 FEPART CONSTANT ALIGNED,
     1071     6762    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1072     6763    1            2 ERR UBIN(15) UNAL INIT(%E$FEPART),
     1073     6764    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1074     6765    1   DCL 1 BADBD CONSTANT ALIGNED,
     1075     6766    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1076     6767    1            2 ERR UBIN(15) UNAL INIT(%E$NBTDMP),
     1077     6768    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1078     6769        /**/
     1079     6770
     1080     6771    1        IF FPTCODE = %C$NODEINFO#
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:194  
     1081     6772    2        THEN DO;
     1082     6773    2             IF FPT$NODEINFO_V.NODENAME~= ' '
     1083     6774    3             THEN DO;
     1084     6775    3                  CALL KIN$CONV_NODENAME (FPT$NODEINFO_V.NODENAME,FEX)
     1085     6776    4                  WHENALTRETURN DO;
     1086     6777    4                       B$JIT.ERR = BDFEI;
     1087     6778    4                       RETURN;
     1088     6779    4                     END;
     1089     6780    3                  VLR$NODEINFO.NODENAME = FPT$NODEINFO_V.NODENAME;
     1090     6781    3                END;
     1091     6782    3             ELSE DO;
     1092     6783    3                  FEX = FPT$NODEINFO_V.NODENUM;
     1093     6784    3                  CALL KIN$CONV_NODE(VLR$NODEINFO.NODENAME,FEX)
     1094     6785    4                  WHENALTRETURN DO;
     1095     6786    4                       B$JIT.ERR = BDFEI;
     1096     6787    4                       RETURN;
     1097     6788    4                     END;
     1098     6789    3                END;
     1099     6790    2             VLR$NODEINFO.NODENUM = FEX;
     1100     6791    2             ROUTE$ = KI$ROUTE$(FEX);
     1101     6792    2             VLR$NODEINFO.QOS = KI$ROUTE.CURRENT_QOS;
     1102     6793    2             VLR$NODEINFO.ALTQOS = KI$ROUTE.ALT_QOS;
     1103     6794    2             IF VLR$NODEINFO.QOS = 255     /*  Not active                        */
     1104     6795    3             THEN DO;
     1105     6796    3                  VLR$NODEINFO.ACTIVE = '0'B;
     1106     6797    3                  VLR$NODEINFO.LINKNODENAME = ' ';
     1107     6798    3                  VLR$NODEINFO.LINKNODENUM = 0;
     1108     6799    3                END;
     1109     6800    3             ELSE DO;
     1110     6801    3                  VLR$NODEINFO.ACTIVE = '1'B;
     1111     6802    3                  VLR$NODEINFO.LINKNODENUM = KI$FEI$(KI$ROUTE.FEI#)->KI$FEI.FEP#;
     1112     6803    3                  VLR$NODEINFO.LINKNODENAME = KI$ROUTE$(VLR$NODEINFO.LINKNODENUM)->
              6803                           KI$ROUTE.NODE_NAME;
     1113     6804    3                END;
     1114     6805    2             VLR$NODEINFO.HOST = KI$ROUTE.HOST;
     1115     6806    2             VLR$NODEINFO.LINKCONNECTED = KI$ROUTE.LINK_CONNECTED;
     1116     6807    2             IF VLR$NODEINFO.NODENUM = K_NODE# /* This node                    */
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:195  
     1117     6808    3             THEN DO;
     1118     6809    3                  VLR$NODEINFO.HOST = '1'B;
     1119     6810    3                  VLR$NODEINFO.CURRENTNODE = '1'B;
     1120     6811    3                END;
     1121     6812    2             ELSE
     1122     6813    2                  VLR$NODEINFO.CURRENTNODE = '0'B;
     1123     6814    2             RETURN;
     1124     6815    2           END;
     1125     6816        /**/
     1126     6817    2        DO FEI = 1 TO KI_MXFE;
     1127     6818    2             FEI$ = KI$FEI$(FEI);
     1128     6819    2             IF KI$FEI.FEP# = B$PS0$->FECTL.FEP
     1129     6820    2             THEN
     1130     6821    2                  GOTO GOT_FEP;
     1131     6822    2           END;
     1132     6823    1        B$JIT.ERR=BDFEI;
     1133     6824        /*E*  ERROR:         KIP-E$BADFEX-A
     1134     6825               MESSAGE: No such FEP exists!
     1135     6826              MESSAGE1: FEP# in your FPT_FECTL is invalid.
     1136     6827              DESCRIPTION:   Self explanatory - if you can issue this pmme, you
     1137     6828                             probably should not make this mistake.  SLUG uses this
     1138     6829                             error to say THERE IS NO FEP n                          */
     1139     6830    1        RETURN;
     1140     6831    1   GOT_FEP:;
     1141     6832    2        IF KI$FEI.PBST.PROB =KIER_PART THEN DO;
     1142     6833    2             B$JIT.ERR=FEPART;
     1143     6834        /*E*  ERROR:         KIP-E$FEPART-A
     1144     6835               MESSAGE: That FEP is partitioned!
     1145     6836              MESSAGE1: No control operations can be performed on that FEP
     1146     6837                        until it is RETURNed via SYSCON.
     1147     6838              DESCRIPTION:   This is to prevent keyins, etc. on partitioned FEPs     */
     1148     6839    2             RETURN;
     1149     6840    2           END;
     1150     6841    1        CALL SSS$BLOCK;
     1151     6842    2        DO CASE (FPTCODE);
     1152     6843    2        CASE (%C$FECTL#);
     1153     6844    2           IF KI$FEI.BDU# ~=0 THEN B$JIT.ERR=CURBT;
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:196  
     1154     6845        /*E*  ERROR:         KIP-E$CURBOOT-A
     1155     6846               MESSAGE: That FEP is already being rebooted!
     1156     6847              DESCRIPTION:   The FEP being halted on an M$FECTL is currently in
     1157     6848                             the boot or dump process                                */
     1158     6849    3           ELSE IF B$PS0$->FECTL.HALT THEN DO;
     1159     6850    3                     IF KI$FEI.FEST ~= KIST_DN AND
     1160     6851    3                          KI$FEI.FEST ~= KIST_MASKED AND
     1161     6852    3                          KI$FEI.FEST ~= KIST_STOPPING THEN
     1162     6853    3                          CALL KIQ$FEABT ( FEI , KIER_BCMD ) ;
     1163     6854    4                     ELSE IF B$JIT.SYSID=JG_SLUG# THEN DO;
     1164     6855    4                               KL_FEPST.FEP = KI$FEI.FEP#;
     1165     6856    4                               KL_FEPST.FCN = IGA_FEPST;
     1166     6857    4                               KL_FEPST.PROB=KIER_BCMD;
     1167     6858    4                               KL_FEPST.STATE=KIST_DN;
     1168     6859    4                               CALL KUB$WRITE (KL_FEPST,LENGTHC(KL_FEPST),'HLPADMIN');
     1169     6860    4                             END;
     1170     6861    3                   END;
     1171     6862    3                ELSE IF B$PS0$->FECTL.STOP THEN DO;
     1172     6863    3   STOPIT:
     1173     6864    3                          IF KI$FEI.FEST = KIST_MASKED OR
     1174     6865    3                               ( KI$FEI.FEST = KIST_DN AND
     1175     6866    3                               KI$FEI.PBST.PROB ~= KIER_FREQ ) OR
     1176     6867    3                               KI$FEI.FEST = KIST_STOPPING THEN
     1177     6868    3                               B$JIT.ERR = FEPDN ;
     1178     6869        /*E*  ERROR:         KIP-E$FEPDN-A
     1179     6870               MESSAGE: Do nt ot try to STOP a down FEP!
     1180     6871              MESSAGE1: The FEP you tried to STOP is not running.
     1181     6872              DESCRIPTION:   Either someone is trying to stop a stopped FEP or
     1182     6873                             two people are trying to stop the same one.             */
     1183     6874    3                          ELSE CALL KIQ$FESTOP (FEI,KIER_STOP);
     1184     6875    3                        END;
     1185     6876    3                     ELSE IF B$PS0$->FECTL.START THEN DO;
     1186     6877    3                               IF KI$FEI.FEST ~= KIST_MASKED AND
     1187     6878    3                                    KI$FEI.FEST ~= KIST_STOPPING AND
     1188     6879    3                                    NOT ( KI$FEI.FEST = KIST_DN AND
     1189     6880    3                                    KI$FEI.PBST.PROB ~= KIER_FREQ ) THEN
     1190     6881    3                                    B$JIT.ERR = NHLTD ;
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:197  
     1191     6882        /*    ERROR:         KIP-E$FEPRUN-A
     1192     6883              MESSAGE: That FEP is running or booting.
     1193     6884              DESCRIPTION:   In this case a GO was issued on a running FEP           */
     1194     6885    3                               ELSE CALL KIQ$FESTRT (FEI);
     1195     6886    3                             END;
     1196     6887    2           RETURN;
     1197     6888    2        CASE (%C$FEDUMP#);
     1198     6889    2           CALL BDSET;
     1199     6890    2           IF KI$FEI.BDU# ~= S_CUN THEN RETURN;
     1200     6891    2           KI$FEI.DSTAD =B$PS0$->FECTL.DMPSR.DADR; /* L6 byte address        */
     1201     6892    2           CALL KIQ$DUMPGO (FEI);
     1202     6893    2        CASE (%C$FEBOOT#);
     1203     6894    2           CALL BDSET;
     1204     6895    2           IF KI$FEI.BDU# ~= S_CUN THEN RETURN;
     1205     6896    2           KI$FEI.DSTAD  = 0;
     1206     6897    2           CALL KIQ$FEBOOT(FEI,B$PS0$->FECTL.MLCPDUMP);
     1207     6898    2           KI$FEI.NOTIME = B$PS0$->FECTL.NOTIME;
     1208     6899    2        END;
     1209     6900        /**/
     1210     6901        /* User will be REGged for some time here */
     1211     6902        /**/
     1212     6903    1        B$PS2$->VRSLTS.ARS=KI$FEI.BDARS ;
     1213     6904    1        B$PS2$->VRSLTS.ERROR=KI$FEI.PBST.PROB ;
     1214     6905    1        IF B$PS2$->VRSLTS.ERROR~=KIER_OK AND B$PS2$->VRSLTS.ERROR ~= KIER_FREQ
     1215     6906    1        THEN
     1216     6907    1             B$JIT.ERR = BADBD;
     1217     6908        /*E*  ERROR:         KIP-E$NBTDMP-A
     1218     6909               MESSAGE: M$FEDUMP or M$FEBOOT failed.
     1219     6910              MESSAGE1: Your M$FEBOOT or M$FEDUMP request did not run to
     1220     6911                        completion.  The reason for failure was returned in
     1221     6912                        RESULTS.ERR and the size of any partially complete
     1222     6913                        dump in RESULTS.ARS.
     1223     6914              DESCRIPTION:   Standard error to let the booter or dumper know
     1224     6915                             the process did not complete.  The real reason
     1225     6916                             why is in the FPT results area                          */
     1226     6917    1        RETURN;
     1227     6918        /**/
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:198  
     1228     6919        /**/
     1229     6920    1   BDSET: PROC;
     1230     6921        /**/
     1231     6922    3        IF KI$FEI.BDU# ~=0 THEN DO;
     1232     6923    3             B$JIT.ERR=NHLTD;
     1233     6924        /*E*  ERROR:         KIP-E$FEPRUN-A
     1234     6925               MESSAGE: That FEP is not halted!
     1235     6926              MESSAGE1: The FEP that you attempted to BOOT or DUMP is currently
     1236     6927                        booting or dumping.
     1237     6928              DESCRIPTION:   Either someone is trying to boot/dump a running FEP
     1238     6929                             or two people are trying to boot/dump the same one      */
     1239     6930    3             RETURN;
     1240     6931    3           END;
     1241     6932
     1242     6933    2        IF KI$FEI.FEST  ~= KIST_DN AND
     1243     6934    2             KI$FEI.FEST ~= KIST_STOPPING AND
     1244     6935    2             KI$FEI.FEST ~= KIST_MASKED
     1245     6936    2        THEN
     1246     6937    2             CALL KIQ$FEABT(FEI,KIER_BCMD);
     1247     6938    2        CALL HFF$DSIZ (2,TEMP);
     1248     6939    3        IF TEMP<SIZEC(VRSLTS) THEN DO;
     1249     6940    3   MISOPT:   ;
     1250     6941    3             B$JIT.ERR=NOOPT;
     1251     6942        /*    ERROR:         KIP-E$NILOPT-A
     1252     6943              DESCRIPTION:   Messages are in KIP$PMME.  In this case BUF or
     1253     6944                             RESULTS in M$FEBOOT or M$FEDUMP is too small            */
     1254     6945    3             RETURN;
     1255     6946    3           END;
     1256     6947    2        CALL HFF$DSIZ (1,TEMP);
     1257     6948    2        IF TEMP <8 THEN GOTO MISOPT;
     1258     6949    2        CALL MMS$WSQMAP (KI$FEI.PTPPNO#);
     1259     6950    2        CALL MMS$VGET (KI$FEI.FEWSQ ,B$PS1$,TEMP ,KI$FEI.BD$ ) ALTRET (BMAP);
     1260     6951    2        KI$FEI.BDSZ =TEMP/4;
     1261     6952    2        KI$FEI.BDU# =S_CUN;
     1262     6953    2        KI$FEI.BDARS =0;
     1263     6954    2        KI$FEI.PBST.PROB =KIER_OK;
     1264     6955    2        RETURN;
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:199  
     1265     6956    2   BMAP: ;
     1266     6957    2        B$JIT.ERR=NMAP;
     1267     6958        /*E*  ERROR:         KIP-E$NFEMAP-A
     1268     6959               MESSAGE: BUF on M$FEBOOT or M$FEDUMP is too big to map!
     1269     6960              MESSAGE1: The BUF of an M$FEBOOT or M$FEDUMP must be mapped
     1270     6961                        into the FEPs WSQ.  This requires it be no greater
     1271     6962                        than 248K words -- yours is bigger.
     1272     6963              DESCRIPTION:   This is almost certainly a coding error in the
     1273     6964                             calling program or a memory management bug              */
     1274     6965    2        RETURN;
     1275     6966    2   END BDSET;
     1276     6967        /**/
     1277     6968    1   END KIP$CPMME;
     1278     6969        /**/
     1279     6970        %EOD;

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:200  
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   UD_EQU_E.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KIP$CPMME.

   Procedure KIP$CPMME requires 420 words for executable code.
   Procedure KIP$CPMME requires 20 words of local(AUTO) storage.

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:201  

 Object Unit name= KIP$CPMME                                  File name= KIP$PMME.:E05TOU
 UTS= JUL 30 '97 00:37:50.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     10     12  KIP$CPMME
    1   Proc  even  none   420    644  KIP$CPMME
    2  RoData even  none    12     14  KIP$CPMME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KIP$CPMME
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:202  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KIN$CONV_NODENAME
         yes           Std       2 KIQ$FEBOOT
 yes     yes           Std       3 KIN$CONV_NODE
         yes           Std       2 KIQ$FEABT
         yes           Std       0 SSS$BLOCK
 yes     yes           Std       3 KUB$WRITE
         yes           Std       2 KIQ$FESTOP
         yes           Std       1 KIQ$DUMPGO
         yes           Std       1 KIQ$FESTRT
 yes     yes           Std       2 HFF$DSIZ
 yes     yes           Std       4 MMS$VGET
 yes     yes           Std       1 MMS$WSQMAP
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     K_NODE#                               KI_FEI$$                              KI_ROUTE$$
     KI_MXFE                               N$DCT$$                               B$JIT$
     S_CUN                                 B$PS1$                                B$PS0$
     B$PS2$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:203  


      970        1        /*T***********************************************************/
      971        2        /*T*                                                         */
      972        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      973        4        /*T*                                                         */
      974        5        /*T***********************************************************/
      975        6        /**/
      976        7        /**/
      977        8        KIP$CPMME: PROC (FPTCODE);

      8  1 000000   000000 700200 xent  KIP$CPMME    TSX0  ! X66_AUTO_1
         1 000001   000024 000001                    ZERO    20,1

      978        9        /**/
      979       10        /**/
      980       11        %INCLUDE K_DATA_R;
      981      722        %INCLUDE NK$LDCT;
      982      824 S      %INCLUDE B$JIT_C;
      983      825        %B$JIT0;
      984      914        %A$JIT6X;
      985      917        %INCLUDE KI$CP6V_C;
      986     1356        %INCLUDE KI_DATA_R;
      987     1382        %INCLUDE KI_MACROS_C;
      988     1990        %INCLUDE NK_LDCT_R;
      989     1999        %INCLUDE JG_GHOSTS_C;
      990     2089        %INCLUDE SS_SCHED_C;
      991     2322        %INCLUDE NK_SUBS;
      992     2347        %INCLUDE KI_SUBS_C;
      993     2483        %INCLUDE UD_EQU_E;
      994     2872        %INCLUDE KL_MACRO_C;
      995     6224        %INCLUDE KL_AFCN_C;
      996     6325        /**/
      997     6326        %KI$FEI (STCLASS="BASED(FEI$)");
      998     6410        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
      999     6464    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
     1000     6465        %FPT$NODEINFO_V (BASED="BASED(B$PS0$)");
     1001     6468        %VLR$NODEINFO_V (FPTN=VLR$NODEINFO,BASED="BASED(B$PS1$)");
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:204  
     1002     6473        %NK$LDCT;
     1003     6519        %FPT$FECTL_V (FPTN=FECTL);
     1004     6523        %KL_FEPST (STCLASS="");
     1005     6558        /**/
     1006     6559        /**/
     1007     6560    1   DCL FPTCODE UBIN WORD;
     1008     6561    1   DCL FEI UBIN WORD;
     1009     6562    1   DCL FEI$ PTR;
     1010     6563    1   DCL ROUTE$ PTR;
     1011     6564    1   DCL FEX UBIN;
     1012     6565    1   DCL TEMP UBIN WORD;
     1013     6566    1   DCL 1 TEMPE REDEF TEMP,
     1014     6567    1            2 PROB UBIN HALF UNAL,
     1015     6568    1            2 STATE UBIN HALF UNAL;
     1016     6569    1   DCL OCQ$ PTR;
     1017     6570    1   DCL 1 VRSLTS BASED DALIGNED,
     1018     6571    1            2 ERROR UBIN WORD,
     1019     6572    1            2 ARS UBIN WORD;
     1020     6573    1   DCL B$JIT$ PTR SYMREF;
     1021     6574    1   DCL S_CUN UBIN WORD SYMREF;
     1022     6575    1   DCL B$PS1$ PTR SYMREF;
     1023     6576    1   DCL B$PS0$ PTR SYMREF;
     1024     6577    1   DCL B$PS2$ PTR SYMREF;
     1025     6578    1   DCL MMS$WSQMAP ENTRY(1) ALTRET;
     1026     6579    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1027     6580    1   DCL KIN$CONV_NODE ENTRY(3) ALTRET;
     1028     6581    1   DCL KIN$CONV_NODENAME ENTRY(3) ALTRET;
     1029     6582    1   DCL KIQ$FEBOOT ENTRY(2);
     1030     6583    1   DCL KIQ$DUMPGO ENTRY(1);
     1031     6584    1   DCL KIQ$FEABT ENTRY(2);
     1032     6585    1   DCL KIQ$FESTOP ENTRY(2);
     1033     6586    1   DCL KIQ$FESTRT ENTRY(1);
     1034     6587    1   DCL HFF$DSIZ ENTRY(2) ALTRET;
     1035     6588    1   DCL SSS$BLOCK ENTRY;
     1036     6589    1   DCL SSR$REG ENTRY(3) ALTRET;
     1037     6590    1   DCL SSR$RUE ENTRY(4);
     1038     6591    1   DCL MMS$VGET ENTRY(4) ALTRET;
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:205  
     1039     6592    1   DCL KIS$REMFEP ENTRY(3) ALTRET;
     1040     6593        /**/
     1041     6594        /**/
     1042     6595        %INCLUDE KI_ERRORS_C;
     1043     6680        %INCLUDE UD_ERRORS_C;
     1044     6722        %INCLUDE UD_SEV_C;
     1045     6736        /**/
     1046     6737    1   DCL 1 CURBT CONSTANT ALIGNED,
     1047     6738    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1048     6739    1            2 ERR UBIN(15) UNAL INIT(%E$CURBOOT),
     1049     6740    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1050     6741    1   DCL 1 NOOPT CONSTANT ALIGNED,
     1051     6742    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1052     6743    1            2 ERR UBIN(15) UNAL INIT(%E$NILOPT),
     1053     6744    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1054     6745    1   DCL 1 NMAP CONSTANT ALIGNED,
     1055     6746    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1056     6747    1            2 ERR UBIN(15) UNAL INIT(%E$NFEMAP),
     1057     6748    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1058     6749    1   DCL 1 BDFEI CONSTANT ALIGNED,
     1059     6750    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1060     6751    1            2 ERR UBIN(15) UNAL INIT(%E$BADFEX),
     1061     6752    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1062     6753    1   DCL 1 NHLTD CONSTANT ALIGNED,
     1063     6754    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1064     6755    1            2 ERR UBIN(15) UNAL INIT(%E$FEPRUN),
     1065     6756    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1066     6757    1   DCL 1 FEPDN CONSTANT ALIGNED,
     1067     6758    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1068     6759    1            2 ERR UBIN(15) UNAL INIT(%E$FEPDN),
     1069     6760    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1070     6761    1   DCL 1 FEPART CONSTANT ALIGNED,
     1071     6762    1            2 FCG BIT(18) UNAL INIT('131120'O),
     1072     6763    1            2 ERR UBIN(15) UNAL INIT(%E$FEPART),
     1073     6764    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1074     6765    1   DCL 1 BADBD CONSTANT ALIGNED,
     1075     6766    1            2 FCG BIT(18) UNAL INIT('131120'O),
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:206  
     1076     6767    1            2 ERR UBIN(15) UNAL INIT(%E$NBTDMP),
     1077     6768    1            2 SEV UBIN(3) UNAL INIT(SEV_ABORT#);
     1078     6769        /**/
     1079     6770
     1080     6771    1        IF FPTCODE = %C$NODEINFO#

   6771  1 000002   200003 470500                    LDP0    @FPTCODE,,AUTO
         1 000003   000000 235100                    LDA     0,,PR0
         1 000004   000031 115007                    CMPA    25,DL
         1 000005   000157 601000 1                  TNZ     s:6817

     1081     6772    2        THEN DO;

     1082     6773    2             IF FPT$NODEINFO_V.NODENAME~= ' '

   6773  1 000006   000000 471400 xsym               LDP1    B$PS0$
         1 000007   040000 106500                    CMPC    fill='040'O
         1 000010   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000011   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000012   000036 600000 1                  TZE     s:6783

     1083     6774    3             THEN DO;

     1084     6775    3                  CALL KIN$CONV_NODENAME (FPT$NODEINFO_V.NODENAME,FEX)

   6775  1 000013   200013 633500                    EPPR3   FEX,,AUTO
         1 000014   200021 453500                    STP3    TEMP+5,,AUTO
         1 000015   000000 236000 xsym               LDQ     B$PS0$
         1 000016   200020 756100                    STQ     TEMP+4,,AUTO
         1 000017   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000020   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000021   000000 701000 xent               TSX1    KIN$CONV_NODENAME
         1 000022   000024 702000 1                  TSX2    s:6777
         1 000023   000030 710000 1                  TRA     s:6780

     1085     6776    4                  WHENALTRETURN DO;

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:207  
     1086     6777    4                       B$JIT.ERR = BDFEI;

   6777  1 000024   000003 236000 0                  LDQ     BDFEI
         1 000025   000000 470400 xsym               LDP0    B$JIT$
         1 000026   000012 756100                    STQ     10,,PR0

     1087     6778    4                       RETURN;

   6778  1 000027   000000 702200 xent               TSX2  ! X66_ARET

     1088     6779    4                     END;
     1089     6780    3                  VLR$NODEINFO.NODENAME = FPT$NODEINFO_V.NODENAME;

   6780  1 000030   000000 470400 xsym               LDP0    B$PS0$
         1 000031   000000 471400 xsym               LDP1    B$PS1$
         1 000032   040100 100500                    MLR     fill='040'O
         1 000033   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000034   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8

     1090     6781    3                END;

   6781  1 000035   000056 710000 1                  TRA     s:6790

     1091     6782    3             ELSE DO;

     1092     6783    3                  FEX = FPT$NODEINFO_V.NODENUM;

   6783  1 000036   000100 101500                    MRL     fill='000'O
         1 000037   100002 000001                    ADSC9   2,,PR1                   cn=0,n=1
         1 000040   200013 000004                    ADSC9   FEX,,AUTO                cn=0,n=4

     1093     6784    3                  CALL KIN$CONV_NODE(VLR$NODEINFO.NODENAME,FEX)

   6784  1 000041   200013 633500                    EPPR3   FEX,,AUTO
         1 000042   200021 453500                    STP3    TEMP+5,,AUTO
         1 000043   000000 236000 xsym               LDQ     B$PS1$
         1 000044   200020 756100                    STQ     TEMP+4,,AUTO
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:208  
         1 000045   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000046   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000047   000000 701000 xent               TSX1    KIN$CONV_NODE
         1 000050   000052 702000 1                  TSX2    s:6786
         1 000051   000056 710000 1                  TRA     s:6790

     1094     6785    4                  WHENALTRETURN DO;

     1095     6786    4                       B$JIT.ERR = BDFEI;

   6786  1 000052   000003 236000 0                  LDQ     BDFEI
         1 000053   000000 470400 xsym               LDP0    B$JIT$
         1 000054   000012 756100                    STQ     10,,PR0

     1096     6787    4                       RETURN;

   6787  1 000055   000000 702200 xent               TSX2  ! X66_ARET

     1097     6788    4                     END;
     1098     6789    3                END;

     1099     6790    2             VLR$NODEINFO.NODENUM = FEX;

   6790  1 000056   000000 470400 xsym               LDP0    B$PS1$
         1 000057   200013 236100                    LDQ     FEX,,AUTO
         1 000060   000033 736000                    QLS     27
         1 000061   000002 552140                    STBQ    2,'40'O,PR0

     1100     6791    2             ROUTE$ = KI$ROUTE$(FEX);

   6791  1 000062   000000 471400 xsym               LDP1    KI_ROUTE$$
         1 000063   200013 720100                    LXL0    FEX,,AUTO
         1 000064   100000 236110                    LDQ     0,X0,PR1
         1 000065   200012 756100                    STQ     ROUTE$,,AUTO

     1101     6792    2             VLR$NODEINFO.QOS = KI$ROUTE.CURRENT_QOS;

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:209  
   6792  1 000066   200012 473500                    LDP3    ROUTE$,,AUTO
         1 000067   300002 236100                    LDQ     2,,PR3
         1 000070   000011 772000                    QRL     9
         1 000071   000002 552110                    STBQ    2,'10'O,PR0

     1102     6793    2             VLR$NODEINFO.ALTQOS = KI$ROUTE.ALT_QOS;

   6793  1 000072   300002 236100                    LDQ     2,,PR3
         1 000073   000011 772000                    QRL     9
         1 000074   000002 552104                    STBQ    2,'04'O,PR0

     1103     6794    2             IF VLR$NODEINFO.QOS = 255     /*  Not active                        */

   6794  1 000075   000002 236100                    LDQ     2,,PR0
         1 000076   777000 376007                    ANQ     -512,DL
         1 000077   377000 116007                    CMPQ    130560,DL
         1 000100   000112 601000 1                  TNZ     s:6801

     1104     6795    3             THEN DO;

     1105     6796    3                  VLR$NODEINFO.ACTIVE = '0'B;

   6796  1 000101   000000 236000 2                  LDQ     0
         1 000102   000002 356100                    ANSQ    2,,PR0

     1106     6797    3                  VLR$NODEINFO.LINKNODENAME = ' ';

   6797  1 000103   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000104   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000105   000003 755100                    STA     3,,PR0
         1 000106   000004 756100                    STQ     4,,PR0

     1107     6798    3                  VLR$NODEINFO.LINKNODENUM = 0;

   6798  1 000107   000000 236003                    LDQ     0,DU
         1 000110   000005 552140                    STBQ    5,'40'O,PR0

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:210  
     1108     6799    3                END;

   6799  1 000111   000131 710000 1                  TRA     s:6805

     1109     6800    3             ELSE DO;

     1110     6801    3                  VLR$NODEINFO.ACTIVE = '1'B;

   6801  1 000112   000200 236003                    LDQ     128,DU
         1 000113   000002 256100                    ORSQ    2,,PR0

     1111     6802    3                  VLR$NODEINFO.LINKNODENUM = KI$FEI$(KI$ROUTE.FEI#)->KI$FEI.FEP#;

   6802  1 000114   300002 236100                    LDQ     2,,PR3
         1 000115   000033 772000                    QRL     27
         1 000116   000000 474400 xsym               LDP4    KI_FEI$$
         1 000117   400000 475506                    LDP5    0,QL,PR4
         1 000120   500012 236100                    LDQ     10,,PR5
         1 000121   000022 736000                    QLS     18
         1 000122   000005 552140                    STBQ    5,'40'O,PR0

     1112     6803    3                  VLR$NODEINFO.LINKNODENAME = KI$ROUTE$(VLR$NODEINFO.LINKNODENUM)->
              6803                           KI$ROUTE.NODE_NAME;

   6803  1 000123   000005 236100                    LDQ     5,,PR0
         1 000124   000033 772000                    QRL     27
         1 000125   100000 475506                    LDP5    0,QL,PR1
         1 000126   040100 100500                    MLR     fill='040'O
         1 000127   500000 000010                    ADSC9   0,,PR5                   cn=0,n=8
         1 000130   000003 000010                    ADSC9   3,,PR0                   cn=0,n=8

     1113     6804    3                END;

     1114     6805    2             VLR$NODEINFO.HOST = KI$ROUTE.HOST;

   6805  1 000131   300002 236100                    LDQ     2,,PR3
         1 000132   000022 736000                    QLS     18
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:211  
         1 000133   000002 676100                    ERQ     2,,PR0
         1 000134   000400 376003                    ANQ     256,DU
         1 000135   000002 656100                    ERSQ    2,,PR0

     1115     6806    2             VLR$NODEINFO.LINKCONNECTED = KI$ROUTE.LINK_CONNECTED;

   6806  1 000136   300002 236100                    LDQ     2,,PR3
         1 000137   000020 736000                    QLS     16
         1 000140   000002 676100                    ERQ     2,,PR0
         1 000141   000040 376003                    ANQ     32,DU
         1 000142   000002 656100                    ERSQ    2,,PR0

     1116     6807    2             IF VLR$NODEINFO.NODENUM = K_NODE# /* This node                    */

   6807  1 000143   000002 236100                    LDQ     2,,PR0
         1 000144   000033 772000                    QRL     27
         1 000145   000000 116000 xsym               CMPQ    K_NODE#
         1 000146   000154 601000 1                  TNZ     s:6813

     1117     6808    3             THEN DO;

     1118     6809    3                  VLR$NODEINFO.HOST = '1'B;

   6809  1 000147   000400 236003                    LDQ     256,DU
         1 000150   000002 256100                    ORSQ    2,,PR0

     1119     6810    3                  VLR$NODEINFO.CURRENTNODE = '1'B;

   6810  1 000151   000100 236003                    LDQ     64,DU
         1 000152   000002 256100                    ORSQ    2,,PR0

     1120     6811    3                END;

   6811  1 000153   000156 710000 1                  TRA     s:6814

     1121     6812    2             ELSE
     1122     6813    2                  VLR$NODEINFO.CURRENTNODE = '0'B;
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:212  

   6813  1 000154   000001 236000 2                  LDQ     1
         1 000155   000002 356100                    ANSQ    2,,PR0

     1123     6814    2             RETURN;

   6814  1 000156   000000 702200 xent               TSX2  ! X66_ARET

     1124     6815    2           END;
     1125     6816        /**/
     1126     6817    2        DO FEI = 1 TO KI_MXFE;

   6817  1 000157   000001 236007                    LDQ     1,DL
         1 000160   200010 756100                    STQ     FEI,,AUTO
         1 000161   000200 710000 1                  TRA     s:6822+3

     1127     6818    2             FEI$ = KI$FEI$(FEI);

   6818  1 000162   000000 470400 xsym               LDP0    KI_FEI$$
         1 000163   200010 720100                    LXL0    FEI,,AUTO
         1 000164   000000 236110                    LDQ     0,X0,PR0
         1 000165   200011 756100                    STQ     FEI$,,AUTO

     1128     6819    2             IF KI$FEI.FEP# = B$PS0$->FECTL.FEP

   6819  1 000166   000000 471400 xsym               LDP1    B$PS0$
         1 000167   200011 473500                    LDP3    FEI$,,AUTO
         1 000170   300012 236100                    LDQ     10,,PR3
         1 000171   000011 772000                    QRL     9
         1 000172   000777 376007                    ANQ     511,DL
         1 000173   100001 116100                    CMPQ    1,,PR1
         1 000174   000207 600000 1                  TZE     GOT_FEP

     1129     6820    2             THEN
     1130     6821    2                  GOTO GOT_FEP;
     1131     6822    2           END;

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:213  
   6822  1 000175   200010 235100                    LDA     FEI,,AUTO
         1 000176   000001 035007                    ADLA    1,DL
         1 000177   200010 755100                    STA     FEI,,AUTO
         1 000200   000000 236000 xsym               LDQ     KI_MXFE
         1 000201   200010 116100                    CMPQ    FEI,,AUTO
         1 000202   000162 603000 1                  TRC     s:6818

     1132     6823    1        B$JIT.ERR=BDFEI;

   6823  1 000203   000003 236000 0                  LDQ     BDFEI
         1 000204   000000 470400 xsym               LDP0    B$JIT$
         1 000205   000012 756100                    STQ     10,,PR0

     1133     6824        /*E*  ERROR:         KIP-E$BADFEX-A
     1134     6825               MESSAGE: No such FEP exists!
     1135     6826              MESSAGE1: FEP# in your FPT_FECTL is invalid.
     1136     6827              DESCRIPTION:   Self explanatory - if you can issue this pmme, you
     1137     6828                             probably should not make this mistake.  SLUG uses this
     1138     6829                             error to say THERE IS NO FEP n                          */
     1139     6830    1        RETURN;

   6830  1 000206   000000 702200 xent               TSX2  ! X66_ARET

   6823  1 000207                       GOT_FEP      null
     1140     6831    1   GOT_FEP:;
     1141     6832    2        IF KI$FEI.PBST.PROB =KIER_PART THEN DO;

   6832  1 000207   300015 221100                    LDX1    13,,PR3
         1 000210   000016 101003                    CMPX1   14,DU
         1 000211   000216 601000 1                  TNZ     s:6841

     1142     6833    2             B$JIT.ERR=FEPART;

   6833  1 000212   000006 236000 0                  LDQ     FEPART
         1 000213   000000 474400 xsym               LDP4    B$JIT$
         1 000214   400012 756100                    STQ     10,,PR4

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:214  
     1143     6834        /*E*  ERROR:         KIP-E$FEPART-A
     1144     6835               MESSAGE: That FEP is partitioned!
     1145     6836              MESSAGE1: No control operations can be performed on that FEP
     1146     6837                        until it is RETURNed via SYSCON.
     1147     6838              DESCRIPTION:   This is to prevent keyins, etc. on partitioned FEPs     */
     1148     6839    2             RETURN;

   6839  1 000215   000000 702200 xent               TSX2  ! X66_ARET

     1149     6840    2           END;
     1150     6841    1        CALL SSS$BLOCK;

   6841  1 000216   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000217   000000 701000 xent               TSX1    SSS$BLOCK
         1 000220   000000 011000                    NOP     0

     1151     6842    2        DO CASE (FPTCODE);

   6842  1 000221   200003 470500                    LDP0    @FPTCODE,,AUTO
         1 000222   000000 235100                    LDA     0,,PR0
         1 000223   000015 135007                    SBLA    13,DL
         1 000224   000003 115007                    CMPA    3,DL
         1 000225   000227 602005 1                  TNC     s:6842+6,AL
         1 000226   000465 710000 1                  TRA     s:6903
         1 000227   000433 710000 1                  TRA     s:6894
         1 000230   000406 710000 1                  TRA     s:6889
         1 000231   000232 710000 1                  TRA     s:6844

     1152     6843    2        CASE (%C$FECTL#);

     1153     6844    2           IF KI$FEI.BDU# ~=0 THEN B$JIT.ERR=CURBT;

   6844  1 000232   200011 471500                    LDP1    FEI$,,AUTO
         1 000233   100007 236100                    LDQ     7,,PR1
         1 000234   000777 316003                    CANQ    511,DU
         1 000235   000242 600000 1                  TZE     s:6849

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:215  
   6844  1 000236   000000 236000 0                  LDQ     CURBT
         1 000237   000000 473400 xsym               LDP3    B$JIT$
         1 000240   300012 756100                    STQ     10,,PR3
         1 000241   000405 710000 1                  TRA     s:6887

     1154     6845        /*E*  ERROR:         KIP-E$CURBOOT-A
     1155     6846               MESSAGE: That FEP is already being rebooted!
     1156     6847              DESCRIPTION:   The FEP being halted on an M$FECTL is currently in
     1157     6848                             the boot or dump process                                */
     1158     6849    3           ELSE IF B$PS0$->FECTL.HALT THEN DO;

   6849  1 000242   000000 473400 xsym               LDP3    B$PS0$
         1 000243   300002 234100                    SZN     2,,PR3
         1 000244   000317 605000 1                  TPL     s:6862

     1159     6850    3                     IF KI$FEI.FEST ~= KIST_DN AND

   6850  1 000245   100002 236100                    LDQ     2,,PR1
         1 000246   000777 316003                    CANQ    511,DU
         1 000247   000267 600000 1                  TZE     s:6854
         1 000250   100002 236100                    LDQ     2,,PR1
         1 000251   000777 376003                    ANQ     511,DU
         1 000252   000007 116003                    CMPQ    7,DU
         1 000253   000267 600000 1                  TZE     s:6854
         1 000254   000010 116003                    CMPQ    8,DU
         1 000255   000267 600000 1                  TZE     s:6854

     1160     6851    3                          KI$FEI.FEST ~= KIST_MASKED AND
     1161     6852    3                          KI$FEI.FEST ~= KIST_STOPPING THEN
     1162     6853    3                          CALL KIQ$FEABT ( FEI , KIER_BCMD ) ;

   6853  1 000256   000002 236000 2                  LDQ     2
         1 000257   200021 756100                    STQ     TEMP+5,,AUTO
         1 000260   200010 634500                    EPPR4   FEI,,AUTO
         1 000261   200020 454500                    STP4    TEMP+4,,AUTO
         1 000262   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000263   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:216  
         1 000264   000000 701000 xent               TSX1    KIQ$FEABT
         1 000265   000000 011000                    NOP     0
         1 000266   000405 710000 1                  TRA     s:6887

     1163     6854    4                     ELSE IF B$JIT.SYSID=JG_SLUG# THEN DO;

   6854  1 000267   000000 474400 xsym               LDP4    B$JIT$
         1 000270   400000 720100                    LXL0    0,,PR4
         1 000271   000001 100003                    CMPX0   1,DU
         1 000272   000405 601000 1                  TNZ     s:6887

     1164     6855    4                               KL_FEPST.FEP = KI$FEI.FEP#;

   6855  1 000273   100012 236100                    LDQ     10,,PR1
         1 000274   000011 736000                    QLS     9
         1 000275   200004 552120                    STBQ    KL_FEPST,'20'O,AUTO

     1165     6856    4                               KL_FEPST.FCN = IGA_FEPST;

   6856  1 000276   040000 236003                    LDQ     16384,DU
         1 000277   200004 552140                    STBQ    KL_FEPST,'40'O,AUTO

     1166     6857    4                               KL_FEPST.PROB=KIER_BCMD;

   6857  1 000300   000013 220003                    LDX0    11,DU
         1 000301   200004 440100                    SXL0    KL_FEPST,,AUTO

     1167     6858    4                               KL_FEPST.STATE=KIST_DN;

   6858  1 000302   000000 221003                    LDX1    0,DU
         1 000303   200005 741100                    STX1    KL_FEPST+1,,AUTO

     1168     6859    4                               CALL KUB$WRITE (KL_FEPST,LENGTHC(KL_FEPST),'HLPADMIN');

   6859  1 000304   000004 236000 2                  LDQ     4
         1 000305   200022 756100                    STQ     TEMP+6,,AUTO
         1 000306   000005 236000 2                  LDQ     5
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:217  
         1 000307   200021 756100                    STQ     TEMP+5,,AUTO
         1 000310   200004 635500                    EPPR5   KL_FEPST,,AUTO
         1 000311   200020 455500                    STP5    TEMP+4,,AUTO
         1 000312   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000313   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000314   000000 701000 xent               TSX1    KUB$WRITE
         1 000315   000000 011000                    NOP     0

     1169     6860    4                             END;

     1170     6861    3                   END;

   6861  1 000316   000405 710000 1                  TRA     s:6887

     1171     6862    3                ELSE IF B$PS0$->FECTL.STOP THEN DO;

   6862  1 000317   300002 236100                    LDQ     2,,PR3
         1 000320   100000 316003                    CANQ    32768,DU
         1 000321   000355 600000 1                  TZE     s:6876

     1172     6863    3   STOPIT:
     1173     6864    3                          IF KI$FEI.FEST = KIST_MASKED OR

   6864  1 000322   100002 236100       STOPIT       LDQ     2,,PR1
         1 000323   000777 376003                    ANQ     511,DU
         1 000324   000007 116003                    CMPQ    7,DU
         1 000325   000340 600000 1                  TZE     s:6868
         1 000326   100002 236100                    LDQ     2,,PR1
         1 000327   000777 316003                    CANQ    511,DU
         1 000330   000334 601000 1                  TNZ     STOPIT+10
         1 000331   100015 220100                    LDX0    13,,PR1
         1 000332   000020 100003                    CMPX0   16,DU
         1 000333   000340 601000 1                  TNZ     s:6868
         1 000334   100002 236100                    LDQ     2,,PR1
         1 000335   000777 376003                    ANQ     511,DU
         1 000336   000010 116003                    CMPQ    8,DU
         1 000337   000344 601000 1                  TNZ     s:6874
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:218  

     1174     6865    3                               ( KI$FEI.FEST = KIST_DN AND
     1175     6866    3                               KI$FEI.PBST.PROB ~= KIER_FREQ ) OR
     1176     6867    3                               KI$FEI.FEST = KIST_STOPPING THEN
     1177     6868    3                               B$JIT.ERR = FEPDN ;

   6868  1 000340   000005 236000 0                  LDQ     FEPDN
         1 000341   000000 474400 xsym               LDP4    B$JIT$
         1 000342   400012 756100                    STQ     10,,PR4
         1 000343   000405 710000 1                  TRA     s:6887

     1178     6869        /*E*  ERROR:         KIP-E$FEPDN-A
     1179     6870               MESSAGE: Do nt ot try to STOP a down FEP!
     1180     6871              MESSAGE1: The FEP you tried to STOP is not running.
     1181     6872              DESCRIPTION:   Either someone is trying to stop a stopped FEP or
     1182     6873                             two people are trying to stop the same one.             */
     1183     6874    3                          ELSE CALL KIQ$FESTOP (FEI,KIER_STOP);

   6874  1 000344   000007 236000 2                  LDQ     7
         1 000345   200021 756100                    STQ     TEMP+5,,AUTO
         1 000346   200010 634500                    EPPR4   FEI,,AUTO
         1 000347   200020 454500                    STP4    TEMP+4,,AUTO
         1 000350   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000351   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000352   000000 701000 xent               TSX1    KIQ$FESTOP
         1 000353   000000 011000                    NOP     0

     1184     6875    3                        END;

   6875  1 000354   000405 710000 1                  TRA     s:6887

     1185     6876    3                     ELSE IF B$PS0$->FECTL.START THEN DO;

   6876  1 000355   040000 316003                    CANQ    16384,DU
         1 000356   000405 600000 1                  TZE     s:6887

     1186     6877    3                               IF KI$FEI.FEST ~= KIST_MASKED AND
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:219  

   6877  1 000357   100002 236100                    LDQ     2,,PR1
         1 000360   000777 376003                    ANQ     511,DU
         1 000361   000007 116003                    CMPQ    7,DU
         1 000362   000377 600000 1                  TZE     s:6885
         1 000363   000010 116003                    CMPQ    8,DU
         1 000364   000377 600000 1                  TZE     s:6885
         1 000365   100002 236100                    LDQ     2,,PR1
         1 000366   000777 316003                    CANQ    511,DU
         1 000367   000373 601000 1                  TNZ     s:6881
         1 000370   100015 220100                    LDX0    13,,PR1
         1 000371   000020 100003                    CMPX0   16,DU
         1 000372   000377 601000 1                  TNZ     s:6885

     1187     6878    3                                    KI$FEI.FEST ~= KIST_STOPPING AND
     1188     6879    3                                    NOT ( KI$FEI.FEST = KIST_DN AND
     1189     6880    3                                    KI$FEI.PBST.PROB ~= KIER_FREQ ) THEN
     1190     6881    3                                    B$JIT.ERR = NHLTD ;

   6881  1 000373   000004 236000 0                  LDQ     NHLTD
         1 000374   000000 474400 xsym               LDP4    B$JIT$
         1 000375   400012 756100                    STQ     10,,PR4
         1 000376   000405 710000 1                  TRA     s:6887

     1191     6882        /*    ERROR:         KIP-E$FEPRUN-A
     1192     6883              MESSAGE: That FEP is running or booting.
     1193     6884              DESCRIPTION:   In this case a GO was issued on a running FEP           */
     1194     6885    3                               ELSE CALL KIQ$FESTRT (FEI);

   6885  1 000377   200010 634500                    EPPR4   FEI,,AUTO
         1 000400   200020 454500                    STP4    TEMP+4,,AUTO
         1 000401   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000402   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000403   000000 701000 xent               TSX1    KIQ$FESTRT
         1 000404   000000 011000                    NOP     0

     1195     6886    3                             END;
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:220  

     1196     6887    2           RETURN;

   6887  1 000405   000000 702200 xent               TSX2  ! X66_ARET

     1197     6888    2        CASE (%C$FEDUMP#);

     1198     6889    2           CALL BDSET;

   6889  1 000406   000507 701000 1                  TSX1    BDSET
         1 000407   000000 011000                    NOP     0

     1199     6890    2           IF KI$FEI.BDU# ~= S_CUN THEN RETURN;

   6890  1 000410   200011 470500                    LDP0    FEI$,,AUTO
         1 000411   000007 236100                    LDQ     7,,PR0
         1 000412   000022 772000                    QRL     18
         1 000413   000777 376007                    ANQ     511,DL
         1 000414   000000 116000 xsym               CMPQ    S_CUN
         1 000415   000417 600000 1                  TZE     s:6891

   6890  1 000416   000000 702200 xent               TSX2  ! X66_ARET

     1200     6891    2           KI$FEI.DSTAD =B$PS0$->FECTL.DMPSR.DADR; /* L6 byte address        */

   6891  1 000417   000000 471400 xsym               LDP1    B$PS0$
         1 000420   100000 236100                    LDQ     0,,PR1
         1 000421   000011 772000                    QRL     9
         1 000422   077777 376007                    ANQ     32767,DL
         1 000423   000016 756100                    STQ     14,,PR0

     1201     6892    2           CALL KIQ$DUMPGO (FEI);

   6892  1 000424   200010 633500                    EPPR3   FEI,,AUTO
         1 000425   200020 453500                    STP3    TEMP+4,,AUTO
         1 000426   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000427   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:221  
         1 000430   000000 701000 xent               TSX1    KIQ$DUMPGO
         1 000431   000000 011000                    NOP     0
         1 000432   000465 710000 1                  TRA     s:6903

     1202     6893    2        CASE (%C$FEBOOT#);

     1203     6894    2           CALL BDSET;

   6894  1 000433   000507 701000 1                  TSX1    BDSET
         1 000434   000000 011000                    NOP     0

     1204     6895    2           IF KI$FEI.BDU# ~= S_CUN THEN RETURN;

   6895  1 000435   200011 470500                    LDP0    FEI$,,AUTO
         1 000436   000007 236100                    LDQ     7,,PR0
         1 000437   000022 772000                    QRL     18
         1 000440   000777 376007                    ANQ     511,DL
         1 000441   000000 116000 xsym               CMPQ    S_CUN
         1 000442   000444 600000 1                  TZE     s:6896

   6895  1 000443   000000 702200 xent               TSX2  ! X66_ARET

     1205     6896    2           KI$FEI.DSTAD  = 0;

   6896  1 000444   000016 450100                    STZ     14,,PR0

     1206     6897    2           CALL KIQ$FEBOOT(FEI,B$PS0$->FECTL.MLCPDUMP);

   6897  1 000445   000000 236000 xsym               LDQ     B$PS0$
         1 000446   000010 036000 2                  ADLQ    8
         1 000447   200021 756100                    STQ     TEMP+5,,AUTO
         1 000450   200010 631500                    EPPR1   FEI,,AUTO
         1 000451   200020 451500                    STP1    TEMP+4,,AUTO
         1 000452   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000453   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000454   000000 701000 xent               TSX1    KIQ$FEBOOT
         1 000455   000000 011000                    NOP     0
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:222  

     1207     6898    2           KI$FEI.NOTIME = B$PS0$->FECTL.NOTIME;

   6898  1 000456   200011 470500                    LDP0    FEI$,,AUTO
         1 000457   000000 471400 xsym               LDP1    B$PS0$
         1 000460   100002 236100                    LDQ     2,,PR1
         1 000461   000003 736000                    QLS     3
         1 000462   000007 676100                    ERQ     7,,PR0
         1 000463   200000 376003                    ANQ     65536,DU
         1 000464   000007 656100                    ERSQ    7,,PR0

     1208     6899    2        END;

     1209     6900        /**/
     1210     6901        /* User will be REGged for some time here */
     1211     6902        /**/
     1212     6903    1        B$PS2$->VRSLTS.ARS=KI$FEI.BDARS ;

   6903  1 000465   200011 470500                    LDP0    FEI$,,AUTO
         1 000466   000011 236100                    LDQ     9,,PR0
         1 000467   000022 736000                    QLS     18
         1 000470   000022 732000                    QRS     18
         1 000471   000000 471400 xsym               LDP1    B$PS2$
         1 000472   100001 756100                    STQ     1,,PR1

     1213     6904    1        B$PS2$->VRSLTS.ERROR=KI$FEI.PBST.PROB ;

   6904  1 000473   000015 236100                    LDQ     13,,PR0
         1 000474   000022 772000                    QRL     18
         1 000475   100000 756100                    STQ     0,,PR1

     1214     6905    1        IF B$PS2$->VRSLTS.ERROR~=KIER_OK AND B$PS2$->VRSLTS.ERROR ~= KIER_FREQ

   6905  1 000476   000000 471400 xsym               LDP1    B$PS2$
         1 000477   100000 235100                    LDA     0,,PR1
         1 000500   000506 600000 1                  TZE     s:6917
         1 000501   000020 115007                    CMPA    16,DL
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:223  
         1 000502   000506 600000 1                  TZE     s:6917

     1215     6906    1        THEN
     1216     6907    1             B$JIT.ERR = BADBD;

   6907  1 000503   000007 236000 0                  LDQ     BADBD
         1 000504   000000 473400 xsym               LDP3    B$JIT$
         1 000505   300012 756100                    STQ     10,,PR3

     1217     6908        /*E*  ERROR:         KIP-E$NBTDMP-A
     1218     6909               MESSAGE: M$FEDUMP or M$FEBOOT failed.
     1219     6910              MESSAGE1: Your M$FEBOOT or M$FEDUMP request did not run to
     1220     6911                        completion.  The reason for failure was returned in
     1221     6912                        RESULTS.ERR and the size of any partially complete
     1222     6913                        dump in RESULTS.ARS.
     1223     6914              DESCRIPTION:   Standard error to let the booter or dumper know
     1224     6915                             the process did not complete.  The real reason
     1225     6916                             why is in the FPT results area                          */
     1226     6917    1        RETURN;

   6917  1 000506   000000 702200 xent               TSX2  ! X66_ARET

     1227     6918        /**/
     1228     6919        /**/
     1229     6920    1   BDSET: PROC;

   6920  1 000507   200016 741300       BDSET        STX1  ! TEMP+2,,AUTO

     1230     6921        /**/
     1231     6922    3        IF KI$FEI.BDU# ~=0 THEN DO;

   6922  1 000510   200011 470500                    LDP0    FEI$,,AUTO
         1 000511   000007 236100                    LDQ     7,,PR0
         1 000512   000777 316003                    CANQ    511,DU
         1 000513   000521 600000 1                  TZE     s:6933

     1232     6923    3             B$JIT.ERR=NHLTD;
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:224  

   6923  1 000514   000004 236000 0                  LDQ     NHLTD
         1 000515   000000 471400 xsym               LDP1    B$JIT$
         1 000516   100012 756100                    STQ     10,,PR1

     1233     6924        /*E*  ERROR:         KIP-E$FEPRUN-A
     1234     6925               MESSAGE: That FEP is not halted!
     1235     6926              MESSAGE1: The FEP that you attempted to BOOT or DUMP is currently
     1236     6927                        booting or dumping.
     1237     6928              DESCRIPTION:   Either someone is trying to boot/dump a running FEP
     1238     6929                             or two people are trying to boot/dump the same one      */
     1239     6930    3             RETURN;

   6930  1 000517   200016 221300                    LDX1  ! TEMP+2,,AUTO
         1 000520   000001 702211                    TSX2  ! 1,X1

     1240     6931    3           END;
     1241     6932
     1242     6933    2        IF KI$FEI.FEST  ~= KIST_DN AND

   6933  1 000521   000002 236100                    LDQ     2,,PR0
         1 000522   000777 316003                    CANQ    511,DU
         1 000523   000542 600000 1                  TZE     s:6938
         1 000524   000002 236100                    LDQ     2,,PR0
         1 000525   000777 376003                    ANQ     511,DU
         1 000526   000010 116003                    CMPQ    8,DU
         1 000527   000542 600000 1                  TZE     s:6938
         1 000530   000007 116003                    CMPQ    7,DU
         1 000531   000542 600000 1                  TZE     s:6938

     1243     6934    2             KI$FEI.FEST ~= KIST_STOPPING AND
     1244     6935    2             KI$FEI.FEST ~= KIST_MASKED
     1245     6936    2        THEN
     1246     6937    2             CALL KIQ$FEABT(FEI,KIER_BCMD);

   6937  1 000532   000002 236000 2                  LDQ     2
         1 000533   200021 756100                    STQ     TEMP+5,,AUTO
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:225  
         1 000534   200010 631500                    EPPR1   FEI,,AUTO
         1 000535   200020 451500                    STP1    TEMP+4,,AUTO
         1 000536   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000537   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000540   000000 701000 xent               TSX1    KIQ$FEABT
         1 000541   000000 011000                    NOP     0

     1247     6938    2        CALL HFF$DSIZ (2,TEMP);

   6938  1 000542   200014 630500                    EPPR0   TEMP,,AUTO
         1 000543   200021 450500                    STP0    TEMP+5,,AUTO
         1 000544   000011 236000 2                  LDQ     9
         1 000545   200020 756100                    STQ     TEMP+4,,AUTO
         1 000546   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000547   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000550   000000 701000 xent               TSX1    HFF$DSIZ
         1 000551   000000 011000                    NOP     0

     1248     6939    3        IF TEMP<SIZEC(VRSLTS) THEN DO;

   6939  1 000552   200014 235100                    LDA     TEMP,,AUTO
         1 000553   000010 115007                    CMPA    8,DL
         1 000554   000562 603000 1                  TRC     s:6947

   6937  1 000555                       MISOPT       null
     1249     6940    3   MISOPT:   ;
     1250     6941    3             B$JIT.ERR=NOOPT;

   6941  1 000555   000001 236000 0                  LDQ     NOOPT
         1 000556   000000 470400 xsym               LDP0    B$JIT$
         1 000557   000012 756100                    STQ     10,,PR0

     1251     6942        /*    ERROR:         KIP-E$NILOPT-A
     1252     6943              DESCRIPTION:   Messages are in KIP$PMME.  In this case BUF or
     1253     6944                             RESULTS in M$FEBOOT or M$FEDUMP is too small            */
     1254     6945    3             RETURN;

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:226  
   6945  1 000560   200016 221300                    LDX1  ! TEMP+2,,AUTO
         1 000561   000001 702211                    TSX2  ! 1,X1

     1255     6946    3           END;
     1256     6947    2        CALL HFF$DSIZ (1,TEMP);

   6947  1 000562   200014 630500                    EPPR0   TEMP,,AUTO
         1 000563   200021 450500                    STP0    TEMP+5,,AUTO
         1 000564   000012 236000 2                  LDQ     10
         1 000565   200020 756100                    STQ     TEMP+4,,AUTO
         1 000566   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000567   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000570   000000 701000 xent               TSX1    HFF$DSIZ
         1 000571   000000 011000                    NOP     0

     1257     6948    2        IF TEMP <8 THEN GOTO MISOPT;

   6948  1 000572   200014 235100                    LDA     TEMP,,AUTO
         1 000573   000010 115007                    CMPA    8,DL
         1 000574   000555 602000 1                  TNC     MISOPT

     1258     6949    2        CALL MMS$WSQMAP (KI$FEI.PTPPNO#);

   6949  1 000575   200011 236100                    LDQ     FEI$,,AUTO
         1 000576   000014 036003                    ADLQ    12,DU
         1 000577   200020 756100                    STQ     TEMP+4,,AUTO
         1 000600   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000601   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000602   000000 701000 xent               TSX1    MMS$WSQMAP
         1 000603   000000 011000                    NOP     0

     1259     6950    2        CALL MMS$VGET (KI$FEI.FEWSQ ,B$PS1$,TEMP ,KI$FEI.BD$ ) ALTRET (BMAP);

   6950  1 000604   200011 236100                    LDQ     FEI$,,AUTO
         1 000605   000010 036003                    ADLQ    8,DU
         1 000606   200023 756100                    STQ     TEMP+7,,AUTO
         1 000607   200014 630500                    EPPR0   TEMP,,AUTO
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:227  
         1 000610   200022 450500                    STP0    TEMP+6,,AUTO
         1 000611   000013 236000 2                  LDQ     11
         1 000612   200021 756100                    STQ     TEMP+5,,AUTO
         1 000613   200011 236100                    LDQ     FEI$,,AUTO
         1 000614   000005 036003                    ADLQ    5,DU
         1 000615   200020 756100                    STQ     TEMP+4,,AUTO
         1 000616   200020 630500                    EPPR0   TEMP+4,,AUTO
         1 000617   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000620   000000 701000 xent               TSX1    MMS$VGET
         1 000621   000637 702000 1                  TSX2    BMAP

     1260     6951    2        KI$FEI.BDSZ =TEMP/4;

   6951  1 000622   200014 236100                    LDQ     TEMP,,AUTO
         1 000623   000002 772000                    QRL     2
         1 000624   000000 620006                    EAX0    0,QL
         1 000625   200011 470500                    LDP0    FEI$,,AUTO
         1 000626   000011 740100                    STX0    9,,PR0

     1261     6952    2        KI$FEI.BDU# =S_CUN;

   6952  1 000627   000000 236000 xsym               LDQ     S_CUN
         1 000630   000022 736000                    QLS     18
         1 000631   000007 552120                    STBQ    7,'20'O,PR0

     1262     6953    2        KI$FEI.BDARS =0;

   6953  1 000632   000000 221003                    LDX1    0,DU
         1 000633   000011 441100                    SXL1    9,,PR0

     1263     6954    2        KI$FEI.PBST.PROB =KIER_OK;

   6954  1 000634   000015 741100                    STX1    13,,PR0

     1264     6955    2        RETURN;

   6955  1 000635   200016 221300                    LDX1  ! TEMP+2,,AUTO
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:228  
         1 000636   000001 702211                    TSX2  ! 1,X1

   6954  1 000637                       BMAP         null
     1265     6956    2   BMAP: ;
     1266     6957    2        B$JIT.ERR=NMAP;

   6957  1 000637   000002 236000 0                  LDQ     NMAP
         1 000640   000000 470400 xsym               LDP0    B$JIT$
         1 000641   000012 756100                    STQ     10,,PR0

     1267     6958        /*E*  ERROR:         KIP-E$NFEMAP-A
     1268     6959               MESSAGE: BUF on M$FEBOOT or M$FEDUMP is too big to map!
     1269     6960              MESSAGE1: The BUF of an M$FEBOOT or M$FEDUMP must be mapped
     1270     6961                        into the FEPs WSQ.  This requires it be no greater
     1271     6962                        than 248K words -- yours is bigger.
     1272     6963              DESCRIPTION:   This is almost certainly a coding error in the
     1273     6964                             calling program or a memory management bug              */
     1274     6965    2        RETURN;

   6965  1 000642   200016 221300                    LDX1  ! TEMP+2,,AUTO
         1 000643   000001 702211                    TSX2  ! 1,X1

CURBT
 Sect OctLoc
   0     000   131120 020416                                                    YP..

NOOPT
 Sect OctLoc
   0     001   131120 020356                                                    YP..

NMAP
 Sect OctLoc
   0     002   131120 020466                                                    YP..

BDFEI
 Sect OctLoc
   0     003   131120 020426                                                    YP..
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:229  

NHLTD
 Sect OctLoc
   0     004   131120 020456                                                    YP..

FEPDN
 Sect OctLoc
   0     005   131120 020506                                                    YP..

FEPART
 Sect OctLoc
   0     006   131120 020516                                                    YP..

BADBD
 Sect OctLoc
   0     007   131120 020476                                                    YP..

(unnamed)
 Sect OctLoc
   0     010   110114 120101   104115 111116                                    HLPADMIN

(unnamed)
 Sect OctLoc
   2     000   777577 777777   777677 777777   000015 006000   000000 000016    ................
   2     004   000010 006000   000003 006000   000000 000015   000006 006000    ................
   2     010   000002 010000   000004 006000   000003 006000   000000 006000    ................
     1275     6966    2   END BDSET;
     1276     6967        /**/
     1277     6968    1   END KIP$CPMME;
     1278     6969        /**/
     1279     6970        %EOD;

PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:230  
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   UD_EQU_E.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KIP$CPMME.
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:231  

 **** Variables and constants ****

  ****  Section 000 RoData KIP$CPMME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/w STRC        r     1 BADBD                      3-0-0/w STRC        r     1 BDFEI
     0-0-0/w STRC        r     1 CURBT                      6-0-0/w STRC        r     1 FEPART
     5-0-0/w STRC        r     1 FEPDN                      4-0-0/w STRC        r     1 NHLTD
     2-0-0/w STRC        r     1 NMAP                       1-0-0/w STRC        r     1 NOOPT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FPTCODE                  10-0-0/w UBIN        r     1 FEI
    11-0-0/w PTR         r     1 FEI$                      13-0-0/w UBIN        r     1 FEX
    *0-0-0/w UBIN        r     1 FPTCODE                    4-0-0/w STRC(126)   r     1 KL_FEPST
    12-0-0/w PTR         r     1 ROUTE$                    14-0-0/w UBIN        r     1 TEMP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$PS2$
     0-0-0/w PTR         r     1 KI_FEI$$                   0-0-0/w UBIN        r     1 KI_MXFE
     0-0-0/w PTR         r     1 KI_ROUTE$$                 0-0-0/w UBIN        r     1 K_NODE#
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:232  

     0-0-0/d STRC(2088)  r     1 B$JIT                      0-0-0/d STRC(108)   r     1 FECTL
     0-0-0/c STRC(144)   r     1 FPT$NODEINFO_V             0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/w STRC(216)   r     1 KI$ROUTE
     0-0-0/w PTR         r     1 KI$ROUTE$(0:0)
     0-0-0/d STRC(216)   r     1 VLR$NODEINFO               0-0-0/d STRC(72)    r     1 VRSLTS


   Procedure KIP$CPMME requires 420 words for executable code.
   Procedure KIP$CPMME requires 20 words of local(AUTO) storage.
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:233  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:234  
          MINI XREF LISTING

B$JIT.ERR
       831**DCL      6777<<ASSIGN   6786<<ASSIGN   6823<<ASSIGN   6833<<ASSIGN   6844<<ASSIGN   6868<<ASSIGN
      6881<<ASSIGN   6907<<ASSIGN   6923<<ASSIGN   6941<<ASSIGN   6957<<ASSIGN
B$JIT.ERR.MID
       832**DCL       832--REDEF
B$JIT.SYSID
       831**DCL      6854>>IF
B$JIT$
      6573**DCL       826--IMP-PTR  6777>>ASSIGN   6786>>ASSIGN   6823>>ASSIGN   6833>>ASSIGN   6844>>ASSIGN
      6854>>IF       6868>>ASSIGN   6881>>ASSIGN   6907>>ASSIGN   6923>>ASSIGN   6941>>ASSIGN   6957>>ASSIGN
B$PS0$
      6576**DCL      6466--IMP-PTR  6773>>IF       6775>>CALL     6780>>ASSIGN   6783>>ASSIGN   6819>>IF
      6849>>IF       6862>>IF       6876>>IF       6891>>ASSIGN   6897>>CALL     6898>>ASSIGN
B$PS1$
      6575**DCL      6469--IMP-PTR  6780>>ASSIGN   6784>>CALL     6790>>ASSIGN   6792>>ASSIGN   6793>>ASSIGN
      6794>>IF       6796>>ASSIGN   6797>>ASSIGN   6798>>ASSIGN   6801>>ASSIGN   6802>>ASSIGN   6803>>ASSIGN
      6803>>ASSIGN   6805>>ASSIGN   6806>>ASSIGN   6807>>IF       6809>>ASSIGN   6810>>ASSIGN   6813>>ASSIGN
      6950<>CALL
B$PS2$
      6577**DCL      6903>>ASSIGN   6904>>ASSIGN   6905>>IF       6905>>IF
BADBD
      6765**DCL      6907>>ASSIGN
BDFEI
      6749**DCL      6777>>ASSIGN   6786>>ASSIGN   6823>>ASSIGN
BDSET
      6920**PROC     6889--CALL     6894--CALL
BMAP IN PROCEDURE BDSET
      6954**LABEL    6950--CALLALT
CURBT
      6737**DCL      6844>>ASSIGN
FECTL.DMPSR.DADR
      6520**DCL      6891>>ASSIGN
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:235  
FECTL.DMPSTART
      6520**DCL      6520--REDEF
FECTL.FEP
      6520**DCL      6819>>IF
FECTL.HALT
      6520**DCL      6849>>IF
FECTL.MLCPDUMP
      6521**DCL      6897<>CALL
FECTL.NOTIME
      6521**DCL      6898>>ASSIGN
FECTL.START
      6521**DCL      6876>>IF
FECTL.STOP
      6521**DCL      6862>>IF
FEI
      6561**DCL      6817<<DOINDEX  6818>>ASSIGN   6853<>CALL     6874<>CALL     6885<>CALL     6892<>CALL
      6897<>CALL     6937<>CALL
FEI$
      6562**DCL      6339--IMP-PTR  6818<<ASSIGN   6819>>IF       6832>>IF       6844>>IF       6850>>IF
      6850>>IF       6850>>IF       6855>>ASSIGN   6864>>IF       6864>>IF       6864>>IF       6864>>IF
      6877>>IF       6877>>IF       6877>>IF       6877>>IF       6890>>IF       6891>>ASSIGN   6895>>IF
      6896>>ASSIGN   6898>>ASSIGN   6903>>ASSIGN   6904>>ASSIGN   6922>>IF       6933>>IF       6933>>IF
      6933>>IF       6949>>CALL     6950>>CALL     6950>>CALL     6951>>ASSIGN   6952>>ASSIGN   6953>>ASSIGN
      6954>>ASSIGN
FEPART
      6761**DCL      6833>>ASSIGN
FEPDN
      6757**DCL      6868>>ASSIGN
FEX
      6564**DCL      6775<>CALL     6783<<ASSIGN   6784<>CALL     6790>>ASSIGN   6791>>ASSIGN
FPT$NODEINFO_V.NODENAME
      6466**DCL      6773>>IF       6775<>CALL     6780>>ASSIGN
FPT$NODEINFO_V.NODENUM
      6466**DCL      6783>>ASSIGN
FPTCODE
      6560**DCL         8--PROC     6771>>IF       6842>>DOCASE
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:236  
GOT_FEP
      6823**LABEL    6821--GOTO
HFF$DSIZ
      6587**DCL-ENT  6938--CALL     6947--CALL
KI$FEI.BD$
      6374**DCL      6375--REDEF    6950<>CALL
KI$FEI.BDAD.WADDR
      6376**DCL      6377--REDEF
KI$FEI.BDARS
      6382**DCL      6903>>ASSIGN   6953<<ASSIGN
KI$FEI.BDSZ
      6381**DCL      6951<<ASSIGN
KI$FEI.BDU#
      6372**DCL      6844>>IF       6890>>IF       6895>>IF       6922>>IF       6952<<ASSIGN
KI$FEI.DSTAD
      6402**DCL      6891<<ASSIGN   6896<<ASSIGN
KI$FEI.FEP#
      6384**DCL      6802>>ASSIGN   6819>>IF       6855>>ASSIGN
KI$FEI.FEST
      6344**DCL      6850>>IF       6850>>IF       6850>>IF       6864>>IF       6864>>IF       6864>>IF
      6877>>IF       6877>>IF       6877>>IF       6933>>IF       6933>>IF       6933>>IF
KI$FEI.FEWSQ
      6367**DCL      6950<>CALL
KI$FEI.NOTIME
      6370**DCL      6898<<ASSIGN
KI$FEI.PBST.PROB
      6392**DCL      6832>>IF       6864>>IF       6877>>IF       6904>>ASSIGN   6954<<ASSIGN
KI$FEI.PTPPNO#
      6389**DCL      6949<>CALL
KI$FEI.RCVPB
      6390**DCL      6391--REDEF
KI$FEI$
      1368**DCL      6802>>ASSIGN   6818>>ASSIGN
KI$ROUTE.ALT_QOS
      6428**DCL      6793>>ASSIGN
KI$ROUTE.CURRENT_QOS
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:237  
      6427**DCL      6792>>ASSIGN
KI$ROUTE.FEI#
      6422**DCL      6802>>ASSIGN
KI$ROUTE.HOST
      6429**DCL      6805>>ASSIGN
KI$ROUTE.LINK_CONNECTED
      6433**DCL      6806>>ASSIGN
KI$ROUTE.NODE_NAME
      6412**DCL      6803>>ASSIGN
KI$ROUTE$
      6464**DCL      6791>>ASSIGN   6803>>ASSIGN
KIN$CONV_NODE
      6580**DCL-ENT  6784--CALL
KIN$CONV_NODENAME
      6581**DCL-ENT  6775--CALL
KIQ$DUMPGO
      6583**DCL-ENT  6892--CALL
KIQ$FEABT
      6584**DCL-ENT  6853--CALL     6937--CALL
KIQ$FEBOOT
      6582**DCL-ENT  6897--CALL
KIQ$FESTOP
      6585**DCL-ENT  6874--CALL
KIQ$FESTRT
      6586**DCL-ENT  6885--CALL
KI_FEI$$
      1367**DCL      1368--IMP-PTR  6802>>ASSIGN   6818>>ASSIGN
KI_MXFE
      1376**DCL      6817>>DOINDEX
KI_ROUTE$$
      1369**DCL      6464--IMP-PTR  6791>>ASSIGN   6803>>ASSIGN
KL_FEPST
      6536**DCL      6859<>CALL     6859--CALL
KL_FEPST.FCN
      6537**DCL      6856<<ASSIGN
KL_FEPST.FEP
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:238  
      6539**DCL      6855<<ASSIGN
KL_FEPST.PROB
      6550**DCL      6857<<ASSIGN
KL_FEPST.STATE
      6551**DCL      6858<<ASSIGN
KUB$WRITE
      6579**DCL-ENT  6859--CALL
K_NODE#
       721**DCL      6807>>IF
K_RWPARM_CON.BLKREC
       452**DCL       477--REDEF
K_RWPARM_CON.BLKREC.BLKU#
       453**DCL       455--REDEF
K_RWPARM_CON.BLKREC.RECU#
       465**DCL       467--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
       492**DCL       493--REDEF
K_RWPARM_CON.DVE.EOMCHAR
       500**DCL       504--REDEF
K_RWPARM_CON.ERR
       564**DCL       569--REDEF
K_RWPARM_CON.FC
       528**DCL       529--REDEF
K_RWPARM_CON.FLDID
       710**DCL       711--REDEF
K_RWPARM_CON.FPT$
       591**DCL       598--REDEF
K_RWPARM_CON.KEYTYPE
       717**DCL       718--REDEF
K_RWPARM_CON.MSG$
       427**DCL       433--REDEF
K_RWPARM_CON.MSGID
       539**DCL       544--REDEF
K_RWPARM_CON.MSGIDXT
       552**DCL       556--REDEF
K_RWPARM_CON.ORG
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:239  
       688**DCL       689--REDEF
K_RWPARM_CON.THDRSZ
       632**DCL       636--REDEF
K_RWPARM_CON.VDOFLGS
       690**DCL       701--REDEF
MISOPT IN PROCEDURE BDSET
      6937**LABEL    6948--GOTO
MMS$VGET
      6591**DCL-ENT  6950--CALL
MMS$WSQMAP
      6578**DCL-ENT  6949--CALL
N$DCT$$
      1997**DCL      1997--IMP-PTR
NHLTD
      6753**DCL      6881>>ASSIGN   6923>>ASSIGN
NK$LDCT.DDT$
      6488**DCL      6488--REDEF
NK$LDCT.IOQ$
      6487**DCL      6488--REDEF
NK$LDCT.LDCTX
      6489**DCL      6489--REDEF
NK$LDCT.LKFLG.ABORTED
      6501**DCL      6502--REDEF
NK$LDCT.RLCID.LDCTX
      6511**DCL      6511--REDEF
NK$LDCT.STA$
      6507**DCL      6508--REDEF
NK$LDCT.SYMB$
      6486**DCL      6486--REDEF    6486--REDEF    6487--REDEF
NMAP
      6745**DCL      6957>>ASSIGN
NOOPT
      6741**DCL      6941>>ASSIGN
ROUTE$
      6563**DCL      6411--IMP-PTR  6791<<ASSIGN   6792>>ASSIGN   6793>>ASSIGN   6802>>ASSIGN   6805>>ASSIGN
      6806>>ASSIGN
PL6.E3A0      #003=KIP$CPMME File=KIP$PMME.:E05TSI                               WED 07/30/97 00:37 Page:240  
SSS$BLOCK
      6588**DCL-ENT  6841--CALL
S_CUN
      6574**DCL      6890>>IF       6895>>IF       6952>>ASSIGN
TEMP
      6565**DCL      6566--REDEF    6938<>CALL     6939>>IF       6947<>CALL     6948>>IF       6950<>CALL
      6951>>ASSIGN
VLR$NODEINFO.ACTIVE
      6469**DCL      6796<<ASSIGN   6801<<ASSIGN
VLR$NODEINFO.ALTQOS
      6470**DCL      6793<<ASSIGN
VLR$NODEINFO.CURRENTNODE
      6469**DCL      6810<<ASSIGN   6813<<ASSIGN
VLR$NODEINFO.HOST
      6469**DCL      6805<<ASSIGN   6809<<ASSIGN
VLR$NODEINFO.LINKCONNECTED
      6469**DCL      6806<<ASSIGN
VLR$NODEINFO.LINKNODENAME
      6470**DCL      6797<<ASSIGN   6803<<ASSIGN
VLR$NODEINFO.LINKNODENUM
      6470**DCL      6798<<ASSIGN   6802<<ASSIGN   6803>>ASSIGN
VLR$NODEINFO.NODENAME
      6469**DCL      6780<<ASSIGN   6784<>CALL
VLR$NODEINFO.NODENUM
      6469**DCL      6790<<ASSIGN   6807>>IF
VLR$NODEINFO.QOS
      6470**DCL      6792<<ASSIGN   6794>>IF
VRSLTS
      6570**DCL      6939--IF
VRSLTS.ARS
      6572**DCL      6903<<ASSIGN
VRSLTS.ERROR
      6571**DCL      6904<<ASSIGN   6905>>IF       6905>>IF

PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:241  
     1280        1        /*T***********************************************************/
     1281        2        /*T*                                                         */
     1282        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1283        4        /*T*                                                         */
     1284        5        /*T***********************************************************/
     1285        6        /**/
     1286        7        /**/
     1287        8        KIP$KEYIN: PROC (KMSG,SIZE,FEP) ALTRET;
     1288        9        /**/
     1289       10        /**/
     1290       11        %INCLUDE B$USER;
     1291      227        %B$USERREFS;
     1292      231        %INCLUDE NK$LDCT;
     1293      333        %INCLUDE KC$CGBLK;
     1294      381 S      %INCLUDE B$JIT_C;
     1295      382        %B$JIT0;
     1296      471        %A$JIT6X;
     1297      474        %INCLUDE NK_LDCT_R;
     1298      483        %INCLUDE KI_DATA_R;
     1299      509        %INCLUDE KL_SUPER_C;
     1300     3411        %INCLUDE KC_DATA_R;
     1301     3424        %INCLUDE KI_MACROS_C;
     1302     4032        %INCLUDE KV$VDO;
     1303     5047        %KV_VDO_ALL_E;
     1304     5126        %INCLUDE KI_SUBS_C;
     1305     5262        %INCLUDE OC_SUBS_C;
     1306     5993        %INCLUDE NK_SUBS;
     1307     6018        %INCLUDE HF_LOCK_C;
     1308     6032        /**/
     1309     6033        %INCLUDE NK_VFC_C;
     1310     6107        %INCLUDE K_DATA_R;
     1311     6818        %INCLUDE JG_GHOSTS_C;
     1312     6908        %NK$LDCT;
     1313     6954        %KC$CGID (FPTN=KC_CSID,STCLASS=SYMREF);
     1314     6980        /**/
     1315     6981        %SUB COD_NTTS=1;
     1316     6982        %SUB COD_NSND=2;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:242  
     1317     6983        %SUB COD_DNTSND=3;
     1318     6984        /**/
     1319     6985        /**/
     1320     6986        %K$RWPARM (STCLASS=SYMREF,NAME=S_RWPARM);
     1321     7302    1   DCL SIZE UBIN;
     1322     7303    1   DCL FEP UBIN;
     1323     7304    1   DCL 1 KMSG ALIGNED,
     1324     7305    1            2 KIN# UBIN(18) UNAL,
     1325     7306    1            2 CADDR BIT(18) UNAL,
     1326     7307    1            2 WSN CHAR(8),
     1327     7308    1            2 TERM REDEF WSN CHAR(8),
     1328     7309    1            2 SYSID UBIN(18) UNAL,
     1329     7310    1            2 ERR UBIN(9) UNAL,
     1330     7311    1            2 CNT UBIN BYTE UNAL,
     1331     7312    1            2 MSG CHAR(124) UNAL;
     1332     7313    1   DCL 1 KMSGD REDEF KMSG ALIGNED,
     1333     7314    1            2 KIN# UBIN(18) UNAL,
     1334     7315    1            2 CADDR BIT(18) UNAL,
     1335     7316    1            2 DINFO,
     1336     7317    1                 3 FEP UBIN WORD,
     1337     7318    1                 3 STATE UBIN(9) UNAL,
     1338     7319    1                 3 BDU UBIN(9) UNAL,
     1339     7320    1                 3 PROB UBIN(9) UNAL,
     1340     7321    1                 3 NAME CHAR(8) UNAL,
     1341     7322    1                 3 * CHAR(1) UNAL,
     1342     7323    1            2 * CHAR(120) UNAL;
     1343     7324    1   DCL 1 KMSGR REDEF KMSG ALIGNED,
     1344     7325    1            2 KIN# UBIN(18) UNAL,
     1345     7326    1            2 CADDR BIT(18) UNAL,
     1346     7327    1            2 DINFO,
     1347     7328    1                 3 FEP UBIN WORD,
     1348     7329    1                 3 NAME CHAR(8) UNAL,
     1349     7330    1                 3 LINKFEP UBIN BYTE UNAL,
     1350     7331    1                 3 LINKNAME CHAR(8) UNAL,
     1351     7332    1                 3 QOS UBIN BYTE UNAL,
     1352     7333    1                 3 ALT UBIN BYTE UNAL,
     1353     7334    1                 3 * CHAR(1) UNAL,
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:243  
     1354     7335    1            2 * CHAR(112) UNAL;
     1355     7336    1   DCL LDCT$ PTR;
     1356     7337    1   DCL OP$ PTR;
     1357     7338    1   DCL MSIZ UBIN WORD;
     1358     7339    1   DCL UNUM REDEF MSIZ UBIN WORD;
     1359     7340    1   DCL FEI UBIN WORD;
     1360     7341    1   DCL LDX REDEF FEI UBIN WORD;
     1361     7342    1   DCL FEI$ PTR;
     1362     7343    1   DCL MSGBUF CHAR(200);
     1363     7344    1   DCL VCHR CHAR(MSIZ) BASED;
     1364     7345    1   DCL 1 GHNM ALIGNED,
     1365     7346    1            2 GHST CHAR(4),
     1366     7347    1            2 SYSID UBIN(18) UNAL,
     1367     7348    1            2 CADDR BIT(18);
     1368     7349    1   DCL 1 CGNM CONSTANT ALIGNED,
     1369     7350    1            2 GHST CHAR(4) INIT('GHST'),
     1370     7351    1            2 SYSID UBIN(18) UNAL INIT(0),
     1371     7352    1            2 CADDR BIT(18) INIT('0'B);
     1372     7353    1   DCL 1 VGHNM BASED ALIGNED,
     1373     7354    1            2 GHST CHAR(4),
     1374     7355    1            2 SYSID UBIN(18) UNAL,
     1375     7356    1            2 CADDR BIT(18);
     1376     7357        %KI$FEI (STCLASS="BASED(FEI$)");
     1377     7441        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
     1378     7495    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
     1379     7496    1   DCL ROUTE$ PTR;
     1380     7497    1   DCL I SBIN;
     1381     7498    1   DCL LNGS (0:1) UBIN BYTE UNAL CONSTANT INIT(2,1);
     1382     7499    1   DCL DLNGS (0:4) UBIN BYTE UNAL CONSTANT INIT(4,1,1,1,8);
     1383     7500    1   DCL RTELNGS (0:5) UBIN BYTE UNAL CONSTANT INIT(4,8,1,8,1,1);
     1384     7501    1   DCL B$JIT$ PTR SYMREF;
     1385     7502    1   DCL KCO$FINDSTA ENTRY(4) ALTRET;
     1386     7503    1   DCL OCZ$SID_UN ENTRY(4) ALTRET;
     1387     7504    1   DCL KIA$FCNO ENTRY(3) ALTRET;
     1388     7505    1   DCL OCI$MK_WR ENTRY(7);
     1389     7506    1   DCL KIA$FCNOU ENTRY(3) ALTRET;
     1390     7507    1   DCL KIN$CONV_NODENAME ENTRY(3) ALTRET;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:244  
     1391     7508    1   DCL SIZ UBIN;
     1392     7509    1   DCL S_CUN UBIN SYMREF;
     1393     7510        /**/
     1394     7511        /**/
     1395     7512    2        DO CASE (KMSG.KIN#);
     1396     7513    2        CASE (KEY_SEND#);
     1397     7514    2           CALL OCZ$SID_UN (KMSG.SYSID,UNUM,KMSG.CADDR,KMSG.WSN) ALTRET (RET);
     1398     7515    3           IF B$USRT$->B$USER.MODE(UNUM)=%M_INT# THEN DO;
     1399     7516    4                IF B$USRT$->B$USER.FLG(UNUM)&%U_NSND THEN DO;
     1400     7517    4                     KMSG.ERR=COD_DNTSND;
     1401     7518    4                     GOTO ERROUT;
     1402     7519    4                   END;
     1403     7520    4                DO LDX=NK_MXLOCAL+1 TO NK_MXTOTAL;
     1404     7521    4                     LDCT$=NK$LDCT$(LDX);
     1405     7522    4                     IF LDCT$~=ADDR(NIL) THEN IF LDCT$->LDCT.RESCOD=NK_TSTRM AND
     1406     7523    4                               LDCT$->LDCT.USER=UNUM AND
     1407     7524    4                               LDCT$->LDCT.LKFLG.ACTIVE AND LDCT$->LDCT.DFLG.OLDSC='0'B
     1408     7525    4                          THEN GOTO GOTLDCT;
     1409     7526    4                   END;
     1410     7527    3                GHNM=CGNM;
     1411     7528    3                GHNM.SYSID=KMSG.SYSID;
     1412     7529    3                MSIZ=6;
     1413     7530    3                CALL KCO$FINDSTA (LDCT$,KC_CSID,GHNM,MSIZ) ALTRET (NTTS);
     1414     7531    3                CALL OCI$MK_WR (ADDR(LDCT$->LDCT.DEVNM)->VGHNM.CADDR,GSND_MSG#,1,KMSG.
              7531                         CNT,KMSG.MSG);
     1415     7532    3                RETURN;
     1416     7533    3   NTTS:        ;
     1417     7534    3              END;
     1418     7535    2           KMSG.ERR=COD_NTTS;
     1419     7536    2           GOTO ERROUT;
     1420     7537    2   GOTLDCT: ;
     1421     7538    2           MSIZ=KMSG.CNT;
     1422     7539                %LOCK (G = LDCT$->LDCT.LOCK );
     1423     7542    2           S_RWPARM = K_RWPARM_CON;
     1424     7543    2           IF (S_CUN = JG_KEYIN#)
     1425     7544    3           THEN DO;
     1426     7545    3                SIZ = LENGTHC('Operator:');
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:245  
     1427     7546    3                CALL CONCAT(MSGBUF,'Operator:',SUBSTR(KMSG.MSG,0,MSIZ));
     1428     7547    3              END;
     1429     7548    3           ELSE DO;
     1430     7549    3                SIZ = 0;
     1431     7550    3                MSGBUF = SUBSTR(KMSG.MSG,0,MSIZ);
     1432     7551    3              END;
     1433     7552    2           S_RWPARM.MSG$ = ADDR(MSGBUF);
     1434     7553    2           S_RWPARM.MSGSZ = MSIZ + SIZ;
     1435     7554    2           S_RWPARM.DVE.DVBYTE.VFC = '1'B;
     1436     7555    2           S_RWPARM.DVE.VFC = %VFC_TRANSITION1;
     1437     7556    3           CALL KIA$FCNO(LDCT$->LDCT,%KV_VDO_FNC_DAT_IMD,S_RWPARM) WHENALTRETURN DO;
     1438     7557                     %UNLOCK (G = LDCT$->LDCT.LOCK);
     1439     7560    3                GOTO NOSND;
     1440     7561    3              END;
     1441     7562                %UNLOCK (G = LDCT$->LDCT.LOCK );
     1442     7565
     1443     7566    2        CASE (KEY_LINKS#);
     1444     7567    2           IF KMSGR.DINFO.NAME ~= ' '
     1445     7568    2           THEN
     1446     7569    2                CALL KIN$CONV_NODENAME(KMSGR.DINFO.NAME,FEI) ALTRET(NFEP);
     1447     7570    2           FEI=KMSGD.DINFO.FEP;
     1448     7571    2           IF FEI~= 0
     1449     7572    3           THEN DO;
     1450     7573    4                DO FEI = 1 TO KI_MXFE;
     1451     7574    4                     FEI$ = KI$FEI$(FEI);
     1452     7575    4                     IF KMSGD.DINFO.FEP = KI$FEI.FEP#
     1453     7576    5                     THEN DO;
     1454     7577    5                          CALL DFEP ALTRET(NFEP);
     1455     7578    5                          GOTO FOUND_FEP;
     1456     7579    5                        END;
     1457     7580    4                   END;
     1458     7581    3   NFEP:        ;
     1459     7582    3                CALL OCI$MK_WR (KMSG.CADDR,NOFE_MSG#,1,DLNGS,KMSGD.DINFO.FEP);
     1460     7583    3   FOUND_FEP:   ;
     1461     7584    3              END;
     1462     7585    3           ELSE DO FEI=1 TO KI_MXFE;
     1463     7586    3                CALL DFEP;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:246  
     1464     7587    3              END;
     1465     7588
     1466     7589    2        CASE (KEY_ROUTES#);
     1467     7590
     1468     7591    2           IF KMSGD.DINFO.FEP = 0 AND KMSGR.DINFO.NAME = ' '
     1469     7592    2           THEN
     1470     7593    3           DO FEI = 0 TO KI_NODES;
     1471     7594    3                IF FEI ~= K_NODE#
     1472     7595    3                THEN
     1473     7596    3                     CALL DROUTE;
     1474     7597    3              END;
     1475     7598    3           ELSE DO;
     1476     7599    3                IF KMSGR.DINFO.NAME ~= ' '
     1477     7600    3                THEN
     1478     7601    3                     CALL KIN$CONV_NODENAME(KMSGR.DINFO.NAME,FEI) ALTRET (NFEP);
     1479     7602    3                ELSE
     1480     7603    3                     FEI = KMSGR.DINFO.FEP;
     1481     7604    3                IF FEI > KI_NODES THEN GOTO NFEP;
     1482     7605    3                CALL DROUTE;
     1483     7606    3              END;
     1484     7607
     1485     7608        /*N*
     1486     7609                  CASE (KEY_DISCT#);
     1487     7610                    DO INHIBIT;
     1488     7611                      LDCT$=KC_NOCG$;
     1489     7612                      DO WHILE (LDCT$~=ADDR(NIL));
     1490     7613           IF LDCT$->LDCT.DEVNM=KMSG.TERM AND LDCT$->LDCT.RESCOD=NK_TRMPTH THEN GOTO GOTTRM;
     1491     7614                        LDCT$=LDCT$->LDCT.LNK$;
     1492     7615                        END;
     1493     7616                      END;
     1494     7617                    GOTO NOTRM;
     1495     7618        GOTTRM:     ;
     1496     7619                    CALL KIA$FCNOU (LDCT$->LDCT,KX_DREQ) ALTRET (NOTRM);
     1497     7620                    RETURN;
     1498     7621        NOTRM:      ;
     1499     7622                    CALL OCI$MK_WR (KMSG.CADDR,NTRM_MSG#,1,'010'O,KMSG.TERM);
     1500     7623         */
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:247  
     1501     7624    2        CASE (ELSE);
     1502     7625    2           ALTRETURN;
     1503     7626    2   NOSND:  ;
     1504     7627    2           KMSG.ERR=COD_NSND;
     1505     7628    2   ERROUT: ;
     1506     7629    2           CALL OCI$MK_WR (KMSG.CADDR,ESND_MSG#,2,LNGS,KMSG.SYSID);
     1507     7630    2        END;
     1508     7631    1   RET: ;
     1509     7632    1        RETURN;
     1510     7633        /**/
     1511     7634        /**/
     1512     7635        %EJECT;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:248  
     1513     7636    1   KIP$SENDALL: ENTRY(KMSG,SIZE,FEP) ALTRET;
     1514     7637
     1515     7638    1        MSIZ = SIZE;
     1516     7639    1        CALL CONCAT(MSGBUF,'Broadcast:',ADDR(KMSG)->VCHR);
     1517     7640    2        DO LDX=NK_MXLOCAL+1 TO NK_MXTOTAL;
     1518     7641    2             LDCT$=NK$LDCT$(LDX);
     1519     7642    2             IF LDCT$ ~= ADDR(NIL)
     1520     7643    2             THEN
     1521     7644    2                  IF LDCT$->LDCT.RESCOD = NK_TSTRM AND
     1522     7645    2                       NOT LDCT$->LDCT.DFLG.OLDSC
     1523     7646    2                       AND (LDCT$->LDCT.TERMID.TTYP = %KLTY_TTY# OR LDCT$->LDCT.TERMID.
              7646                                TTYP = %KLTY_LINEDEV#)
     1524     7647    2                       AND LDCT$->LDCT.DFLG.OUTPUT
     1525     7648    2                       AND LDCT$->LDCT.RLCID.NODE ~= K_NODE#
     1526     7649    2                       AND NOT LDCT$->LDCT.DFLG.NOSND
     1527     7650    2                       AND (ADDR(FEP)= ADDR(NIL) OR LDCT$->NK$LDCT.RLCID.NODE = FEP)
     1528     7651    3                  THEN DO;
     1529     7652                            %LOCK (G = LDCT$->LDCT.LOCK );
     1530     7655    3                       S_RWPARM = K_RWPARM_CON;
     1531     7656    3                       S_RWPARM.MSG$ = ADDR(MSGBUF);
     1532     7657    3                       S_RWPARM.MSGSZ = SIZE + LENGTHC('Broadcast:');
     1533     7658    3                       S_RWPARM.DVE.DVBYTE.VFC = '1'B;
     1534     7659    3                       S_RWPARM.DVE.VFC = %VFC_TRANSITION1;
     1535     7660    3                       CALL KIA$FCNO(LDCT$->LDCT,%KV_VDO_FNC_DAT_IMD,S_RWPARM);
     1536     7661                            %UNLOCK (G = LDCT$->LDCT.LOCK );
     1537     7664    3                     END;
     1538     7665
     1539     7666    2           END;
     1540     7667
     1541     7668    1        RETURN;
     1542     7669
     1543     7670        %EJECT;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:249  
     1544     7671    1   DFEP: PROC ALTRET;
     1545     7672        /**/
     1546     7673    2        FEI$ = KI$FEI$(FEI);
     1547     7674    2        IF KI$FEI.PBST.PROB = KIER_PART THEN
     1548     7675    2             KMSGD.DINFO.STATE = KIST_DN ;
     1549     7676    2        ELSE
     1550     7677    2             KMSGD.DINFO.STATE = KI$FEI.FEST ;
     1551     7678    2        KMSGD.DINFO.FEP=KI$FEI.FEP#;
     1552     7679    2        KMSGD.DINFO.BDU=KI$FEI.BDU# ;
     1553     7680    2        KMSGD.DINFO.PROB=KI$FEI.PBST.PROB ;
     1554     7681    2        KMSGD.DINFO.NAME = KI$ROUTE$(KI$FEI.FEP#)->KI$ROUTE.NODE_NAME;
     1555     7682    2        IF KMSGD.DINFO.NAME ~= ' '
     1556     7683    2        THEN
     1557     7684    2             CALL OCI$MK_WR (KMSG.CADDR,DFEP_MSG#,5,DLNGS,KMSGD.DINFO);
     1558     7685    2        RETURN;
     1559     7686    2   END;
     1560     7687    1   DROUTE: PROC;
     1561     7688
     1562     7689    2        ROUTE$ = KI$ROUTE$(FEI);
     1563     7690    2        KMSGR.DINFO.FEP = FEI;
     1564     7691    2        KMSGR.DINFO.NAME = KI$ROUTE.NODE_NAME;
     1565     7692    2        IF KI$ROUTE.FEI# ~= 0
     1566     7693    3        THEN DO;
     1567     7694    3             KMSGR.DINFO.LINKFEP = KI$FEI$(KI$ROUTE.FEI#)->KI$FEI.FEP#;
     1568     7695    3             KMSGR.DINFO.LINKNAME = KI$ROUTE$(KI$FEI$(KI$ROUTE.FEI#)->KI$FEI.FEP#)->
              7695                      KI$ROUTE.NODE_NAME;
     1569     7696    3           END;
     1570     7697    3        ELSE DO;
     1571     7698    3             KMSGR.DINFO.LINKFEP = 0;
     1572     7699    3             KMSGR.DINFO.LINKNAME = ' ';
     1573     7700    3           END;
     1574     7701    2        KMSGR.DINFO.QOS = KI$ROUTE.CURRENT_QOS;
     1575     7702    2        KMSGR.DINFO.ALT = KI$ROUTE.ALT_QOS;
     1576     7703    2        IF KI$ROUTE.NODE_NAME ~= ' '
     1577     7704    2        THEN
     1578     7705    2             CALL OCI$MK_WR(KMSG.CADDR,OC_MSG_RTE#,6,RTELNGS,KMSGR.DINFO);
     1579     7706
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:250  
     1580     7707    2        ELSE
     1581     7708    2             CALL OCI$MK_WR (KMSG.CADDR,NOFE_MSG#,1,DLNGS,KMSGD.DINFO.FEP);
     1582     7709    2        RETURN;
     1583     7710
     1584     7711    2   END DROUTE;
     1585     7712        /**/
     1586     7713    1   END KIP$KEYIN;
     1587     7714        /**/
     1588     7715        /**/

PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:251  
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KIP$KEYIN.

   Procedure KIP$KEYIN requires 541 words for executable code.
   Procedure KIP$KEYIN requires 74 words of local(AUTO) storage.

    No errors detected in file KIP$PMME.:E05TSI    .

PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:252  

 Object Unit name= KIP$KEYIN                                  File name= KIP$PMME.:E05TOU
 UTS= JUL 30 '97 00:38:36.20 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     13     15  KIP$KEYIN
    1   Proc  even  none   541   1035  KIP$KEYIN
    2  RoData even  none    24     30  KIP$KEYIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  KIP$KEYIN
     1    470          yes     yes      Std        3  KIP$SENDALL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       4 OCZ$SID_UN
         yes           Std       7 OCI$MK_WR
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 KIN$CONV_NODENAME
 yes     yes           Std       4 KCO$FINDSTA
         yes           Std       1 HFC$LOCK
 yes     yes           Std       3 KIA$FCNO
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:253  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$USRT$                               N$DCT$$                               NK_MXLOCAL
     NK_MXTOTAL                            KI_FEI$$                              KI_ROUTE$$
     KI_NODES                              KI_MXFE                          r    K_RWPARM_CON
     K_NODE#                               KC_CSID                               S_RWPARM
     B$JIT$                                S_CUN                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:254  


     1280        1        /*T***********************************************************/
     1281        2        /*T*                                                         */
     1282        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1283        4        /*T*                                                         */
     1284        5        /*T***********************************************************/
     1285        6        /**/
     1286        7        /**/
     1287        8        KIP$KEYIN: PROC (KMSG,SIZE,FEP) ALTRET;

      8  1 000000   000000 700200 xent  KIP$KEYIN    TSX0  ! X66_AUTO_3
         1 000001   000112 000003                    ZERO    74,3

     1288        9        /**/
     1289       10        /**/
     1290       11        %INCLUDE B$USER;
     1291      227        %B$USERREFS;
     1292      231        %INCLUDE NK$LDCT;
     1293      333        %INCLUDE KC$CGBLK;
     1294      381 S      %INCLUDE B$JIT_C;
     1295      382        %B$JIT0;
     1296      471        %A$JIT6X;
     1297      474        %INCLUDE NK_LDCT_R;
     1298      483        %INCLUDE KI_DATA_R;
     1299      509        %INCLUDE KL_SUPER_C;
     1300     3411        %INCLUDE KC_DATA_R;
     1301     3424        %INCLUDE KI_MACROS_C;
     1302     4032        %INCLUDE KV$VDO;
     1303     5047        %KV_VDO_ALL_E;
     1304     5126        %INCLUDE KI_SUBS_C;
     1305     5262        %INCLUDE OC_SUBS_C;
     1306     5993        %INCLUDE NK_SUBS;
     1307     6018        %INCLUDE HF_LOCK_C;
     1308     6032        /**/
     1309     6033        %INCLUDE NK_VFC_C;
     1310     6107        %INCLUDE K_DATA_R;
     1311     6818        %INCLUDE JG_GHOSTS_C;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:255  
     1312     6908        %NK$LDCT;
     1313     6954        %KC$CGID (FPTN=KC_CSID,STCLASS=SYMREF);
     1314     6980        /**/
     1315     6981        %SUB COD_NTTS=1;
     1316     6982        %SUB COD_NSND=2;
     1317     6983        %SUB COD_DNTSND=3;
     1318     6984        /**/
     1319     6985        /**/
     1320     6986        %K$RWPARM (STCLASS=SYMREF,NAME=S_RWPARM);
     1321     7302    1   DCL SIZE UBIN;
     1322     7303    1   DCL FEP UBIN;
     1323     7304    1   DCL 1 KMSG ALIGNED,
     1324     7305    1            2 KIN# UBIN(18) UNAL,
     1325     7306    1            2 CADDR BIT(18) UNAL,
     1326     7307    1            2 WSN CHAR(8),
     1327     7308    1            2 TERM REDEF WSN CHAR(8),
     1328     7309    1            2 SYSID UBIN(18) UNAL,
     1329     7310    1            2 ERR UBIN(9) UNAL,
     1330     7311    1            2 CNT UBIN BYTE UNAL,
     1331     7312    1            2 MSG CHAR(124) UNAL;
     1332     7313    1   DCL 1 KMSGD REDEF KMSG ALIGNED,
     1333     7314    1            2 KIN# UBIN(18) UNAL,
     1334     7315    1            2 CADDR BIT(18) UNAL,
     1335     7316    1            2 DINFO,
     1336     7317    1                 3 FEP UBIN WORD,
     1337     7318    1                 3 STATE UBIN(9) UNAL,
     1338     7319    1                 3 BDU UBIN(9) UNAL,
     1339     7320    1                 3 PROB UBIN(9) UNAL,
     1340     7321    1                 3 NAME CHAR(8) UNAL,
     1341     7322    1                 3 * CHAR(1) UNAL,
     1342     7323    1            2 * CHAR(120) UNAL;
     1343     7324    1   DCL 1 KMSGR REDEF KMSG ALIGNED,
     1344     7325    1            2 KIN# UBIN(18) UNAL,
     1345     7326    1            2 CADDR BIT(18) UNAL,
     1346     7327    1            2 DINFO,
     1347     7328    1                 3 FEP UBIN WORD,
     1348     7329    1                 3 NAME CHAR(8) UNAL,
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:256  
     1349     7330    1                 3 LINKFEP UBIN BYTE UNAL,
     1350     7331    1                 3 LINKNAME CHAR(8) UNAL,
     1351     7332    1                 3 QOS UBIN BYTE UNAL,
     1352     7333    1                 3 ALT UBIN BYTE UNAL,
     1353     7334    1                 3 * CHAR(1) UNAL,
     1354     7335    1            2 * CHAR(112) UNAL;
     1355     7336    1   DCL LDCT$ PTR;
     1356     7337    1   DCL OP$ PTR;
     1357     7338    1   DCL MSIZ UBIN WORD;
     1358     7339    1   DCL UNUM REDEF MSIZ UBIN WORD;
     1359     7340    1   DCL FEI UBIN WORD;
     1360     7341    1   DCL LDX REDEF FEI UBIN WORD;
     1361     7342    1   DCL FEI$ PTR;
     1362     7343    1   DCL MSGBUF CHAR(200);
     1363     7344    1   DCL VCHR CHAR(MSIZ) BASED;
     1364     7345    1   DCL 1 GHNM ALIGNED,
     1365     7346    1            2 GHST CHAR(4),
     1366     7347    1            2 SYSID UBIN(18) UNAL,
     1367     7348    1            2 CADDR BIT(18);
     1368     7349    1   DCL 1 CGNM CONSTANT ALIGNED,
     1369     7350    1            2 GHST CHAR(4) INIT('GHST'),
     1370     7351    1            2 SYSID UBIN(18) UNAL INIT(0),
     1371     7352    1            2 CADDR BIT(18) INIT('0'B);
     1372     7353    1   DCL 1 VGHNM BASED ALIGNED,
     1373     7354    1            2 GHST CHAR(4),
     1374     7355    1            2 SYSID UBIN(18) UNAL,
     1375     7356    1            2 CADDR BIT(18);
     1376     7357        %KI$FEI (STCLASS="BASED(FEI$)");
     1377     7441        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
     1378     7495    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
     1379     7496    1   DCL ROUTE$ PTR;
     1380     7497    1   DCL I SBIN;
     1381     7498    1   DCL LNGS (0:1) UBIN BYTE UNAL CONSTANT INIT(2,1);
     1382     7499    1   DCL DLNGS (0:4) UBIN BYTE UNAL CONSTANT INIT(4,1,1,1,8);
     1383     7500    1   DCL RTELNGS (0:5) UBIN BYTE UNAL CONSTANT INIT(4,8,1,8,1,1);
     1384     7501    1   DCL B$JIT$ PTR SYMREF;
     1385     7502    1   DCL KCO$FINDSTA ENTRY(4) ALTRET;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:257  
     1386     7503    1   DCL OCZ$SID_UN ENTRY(4) ALTRET;
     1387     7504    1   DCL KIA$FCNO ENTRY(3) ALTRET;
     1388     7505    1   DCL OCI$MK_WR ENTRY(7);
     1389     7506    1   DCL KIA$FCNOU ENTRY(3) ALTRET;
     1390     7507    1   DCL KIN$CONV_NODENAME ENTRY(3) ALTRET;
     1391     7508    1   DCL SIZ UBIN;
     1392     7509    1   DCL S_CUN UBIN SYMREF;
     1393     7510        /**/
     1394     7511        /**/
     1395     7512    2        DO CASE (KMSG.KIN#);

   7512  1 000002   200003 470500                    LDP0    @KMSG,,AUTO
         1 000003   000000 220100                    LDX0    0,,PR0
         1 000004   000007 100003                    CMPX0   7,DU
         1 000005   000007 602010 1                  TNC     s:7512+5,X0
         1 000006   000445 710000 1                  TRA     s:7625
         1 000007   000445 710000 1                  TRA     s:7625
         1 000010   000445 710000 1                  TRA     s:7625
         1 000011   000016 710000 1                  TRA     s:7514
         1 000012   000271 710000 1                  TRA     s:7567
         1 000013   000445 710000 1                  TRA     s:7625
         1 000014   000445 710000 1                  TRA     s:7625
         1 000015   000374 710000 1                  TRA     s:7591

     1396     7513    2        CASE (KEY_SEND#);

     1397     7514    2           CALL OCZ$SID_UN (KMSG.SYSID,UNUM,KMSG.CADDR,KMSG.WSN) ALTRET (RET);

   7514  1 000016   200003 236100                    LDQ     @KMSG,,AUTO
         1 000017   000001 036003                    ADLQ    1,DU
         1 000020   200107 756100                    STQ     SIZ+6,,AUTO
         1 000021   200003 236100                    LDQ     @KMSG,,AUTO
         1 000022   400000 036007                    ADLQ    -131072,DL
         1 000023   200106 756100                    STQ     SIZ+5,,AUTO
         1 000024   200010 631500                    EPPR1   MSIZ,,AUTO
         1 000025   200105 451500                    STP1    SIZ+4,,AUTO
         1 000026   200003 236100                    LDQ     @KMSG,,AUTO
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:258  
         1 000027   000003 036003                    ADLQ    3,DU
         1 000030   200104 756100                    STQ     SIZ+3,,AUTO
         1 000031   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000032   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000033   000000 701000 xent               TSX1    OCZ$SID_UN
         1 000034   000467 702000 1                  TSX2    RET

     1398     7515    3           IF B$USRT$->B$USER.MODE(UNUM)=%M_INT# THEN DO;

   7515  1 000035   200010 235100                    LDA     MSIZ,,AUTO
         1 000036   000004 735000                    ALS     4
         1 000037   000000 470400 xsym               LDP0    B$USRT$
         1 000040   000011 236105                    LDQ     9,AL,PR0
         1 000041   007700 376007                    ANQ     4032,DL
         1 000042   000300 116007                    CMPQ    192,DL
         1 000043   000160 601000 1                  TNZ     NTTS

     1399     7516    4                IF B$USRT$->B$USER.FLG(UNUM)&%U_NSND THEN DO;

   7516  1 000044   000000 236105                    LDQ     0,AL,PR0
         1 000045   000020 376000 xsym               ANQ     B_VECTNIL+16
         1 000046   000053 600000 1                  TZE     s:7520

     1400     7517    4                     KMSG.ERR=COD_DNTSND;

   7517  1 000047   200003 471500                    LDP1    @KMSG,,AUTO
         1 000050   003000 236007                    LDQ     1536,DL
         1 000051   100003 552110                    STBQ    3,'10'O,PR1

     1401     7518    4                     GOTO ERROUT;

   7518  1 000052   000451 710000 1                  TRA     ERROUT

     1402     7519    4                   END;
     1403     7520    4                DO LDX=NK_MXLOCAL+1 TO NK_MXTOTAL;

   7520  1 000053   000000 236000 xsym               LDQ     NK_MXLOCAL
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:259  
         1 000054   000001 036007                    ADLQ    1,DL
         1 000055   200011 756100                    STQ     FEI,,AUTO
         1 000056   000110 710000 1                  TRA     s:7526+3

     1404     7521    4                     LDCT$=NK$LDCT$(LDX);

   7521  1 000057   000000 470400 xsym               LDP0    N$DCT$$
         1 000060   200011 720100                    LXL0    FEI,,AUTO
         1 000061   000000 236110                    LDQ     0,X0,PR0
         1 000062   200006 756100                    STQ     LDCT$,,AUTO

     1405     7522    4                     IF LDCT$~=ADDR(NIL) THEN IF LDCT$->LDCT.RESCOD=NK_TSTRM AND

   7522  1 000063   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000064   000105 600000 1                  TZE     s:7526

   7522  1 000065   200006 471500                    LDP1    LDCT$,,AUTO
         1 000066   100006 236100                    LDQ     6,,PR1
         1 000067   000017 376007                    ANQ     15,DL
         1 000070   000001 116007                    CMPQ    1,DL
         1 000071   000105 601000 1                  TNZ     s:7526
         1 000072   100007 236100                    LDQ     7,,PR1
         1 000073   000022 772000                    QRL     18
         1 000074   000777 376007                    ANQ     511,DL
         1 000075   200010 116100                    CMPQ    MSIZ,,AUTO
         1 000076   000105 601000 1                  TNZ     s:7526
         1 000077   100011 236100                    LDQ     9,,PR1
         1 000100   000040 316003                    CANQ    32,DU
         1 000101   000105 600000 1                  TZE     s:7526
         1 000102   100006 236100                    LDQ     6,,PR1
         1 000103   010000 316007                    CANQ    4096,DL
         1 000104   000164 600000 1                  TZE     GOTLDCT

     1406     7523    4                               LDCT$->LDCT.USER=UNUM AND
     1407     7524    4                              LDCT$->LDCT.LKFLG.ACTIVE AND LDCT$->LDCT.DFLG.OLDSC='0'B
     1408     7525    4                          THEN GOTO GOTLDCT;
     1409     7526    4                   END;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:260  

   7526  1 000105   200011 235100                    LDA     FEI,,AUTO
         1 000106   000001 035007                    ADLA    1,DL
         1 000107   200011 755100                    STA     FEI,,AUTO
         1 000110   000000 236000 xsym               LDQ     NK_MXTOTAL
         1 000111   200011 116100                    CMPQ    FEI,,AUTO
         1 000112   000057 603000 1                  TRC     s:7521

     1410     7527    3                GHNM=CGNM;

   7527  1 000113   000000 237000 0                  LDAQ    CGNM
         1 000114   200075 755100                    STA     GHNM,,AUTO
         1 000115   200076 756100                    STQ     GHNM+1,,AUTO

     1411     7528    3                GHNM.SYSID=KMSG.SYSID;

   7528  1 000116   200003 470500                    LDP0    @KMSG,,AUTO
         1 000117   000003 220100                    LDX0    3,,PR0
         1 000120   200076 740100                    STX0    GHNM+1,,AUTO

     1412     7529    3                MSIZ=6;

   7529  1 000121   000006 236007                    LDQ     6,DL
         1 000122   200010 756100                    STQ     MSIZ,,AUTO

     1413     7530    3                CALL KCO$FINDSTA (LDCT$,KC_CSID,GHNM,MSIZ) ALTRET (NTTS);

   7530  1 000123   200010 631500                    EPPR1   MSIZ,,AUTO
         1 000124   200107 451500                    STP1    SIZ+6,,AUTO
         1 000125   200075 633500                    EPPR3   GHNM,,AUTO
         1 000126   200106 453500                    STP3    SIZ+5,,AUTO
         1 000127   000000 236000 2                  LDQ     0
         1 000130   200105 756100                    STQ     SIZ+4,,AUTO
         1 000131   200006 634500                    EPPR4   LDCT$,,AUTO
         1 000132   200104 454500                    STP4    SIZ+3,,AUTO
         1 000133   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000134   000022 631400 xsym               EPPR1   B_VECTNIL+18
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:261  
         1 000135   000000 701000 xent               TSX1    KCO$FINDSTA
         1 000136   000160 702000 1                  TSX2    NTTS

     1414     7531    3                CALL OCI$MK_WR (ADDR(LDCT$->LDCT.DEVNM)->VGHNM.CADDR,GSND_MSG#,1,KMSG.
              7531                         CNT,KMSG.MSG);

   7531  1 000137   200003 236100                    LDQ     @KMSG,,AUTO
         1 000140   000004 036003                    ADLQ    4,DU
         1 000141   200110 756100                    STQ     SIZ+7,,AUTO
         1 000142   200003 236100                    LDQ     @KMSG,,AUTO
         1 000143   000002 036000 2                  ADLQ    2
         1 000144   000003 235000 2                  LDA     3
         1 000145   200106 757100                    STAQ    SIZ+5,,AUTO
         1 000146   000004 236000 2                  LDQ     4
         1 000147   200105 756100                    STQ     SIZ+4,,AUTO
         1 000150   200006 236100                    LDQ     LDCT$,,AUTO
         1 000151   000005 036000 2                  ADLQ    5
         1 000152   200104 756100                    STQ     SIZ+3,,AUTO
         1 000153   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000154   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000155   000000 701000 xent               TSX1    OCI$MK_WR
         1 000156   000000 011000                    NOP     0

     1415     7532    3                RETURN;

   7532  1 000157   000000 702200 xent               TSX2  ! X66_ARET

     1416     7533    3   NTTS:        ;

   7533  1 000160                       NTTS         null
     1417     7534    3              END;

     1418     7535    2           KMSG.ERR=COD_NTTS;

   7535  1 000160   200003 470500                    LDP0    @KMSG,,AUTO
         1 000161   001000 236007                    LDQ     512,DL
         1 000162   000003 552110                    STBQ    3,'10'O,PR0
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:262  

     1419     7536    2           GOTO ERROUT;

   7536  1 000163   000451 710000 1                  TRA     ERROUT

   7535  1 000164                       GOTLDCT      null
     1420     7537    2   GOTLDCT: ;
     1421     7538    2           MSIZ=KMSG.CNT;

   7538  1 000164   200003 473500                    LDP3    @KMSG,,AUTO
         1 000165   300003 236100                    LDQ     3,,PR3
         1 000166   000777 376007                    ANQ     511,DL
         1 000167   200010 756100                    STQ     MSIZ,,AUTO

     1422     7539                %LOCK (G = LDCT$->LDCT.LOCK );

   7540  1 000170   200006 236100                    LDQ     LDCT$,,AUTO
         1 000171   000020 036003                    ADLQ    16,DU
         1 000172   200104 756100                    STQ     SIZ+3,,AUTO
         1 000173   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000174   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000175   000000 701000 xent               TSX1    HFC$LOCK
         1 000176   000000 011000                    NOP     0

     1423     7542    2           S_RWPARM = K_RWPARM_CON;

   7542  1 000177   000000 100400                    MLR     fill='000'O
         1 000200   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000201   000000 000234 xsym               ADSC9   S_RWPARM                 cn=0,n=156

     1424     7543    2           IF (S_CUN = JG_KEYIN#)

   7543  1 000202   000000 235000 xsym               LDA     S_CUN
         1 000203   000002 115007                    CMPA    2,DL
         1 000204   000220 601000 1                  TNZ     s:7549

     1425     7544    3           THEN DO;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:263  

     1426     7545    3                SIZ = LENGTHC('Operator:');

   7545  1 000205   000011 236007                    LDQ     9,DL
         1 000206   200101 756100                    STQ     SIZ,,AUTO

     1427     7546    3                CALL CONCAT(MSGBUF,'Operator:',SUBSTR(KMSG.MSG,0,MSIZ));

   7546  1 000207   040100 100400                    MLR     fill='040'O
         1 000210   000007 000011 0                  ADSC9   RTELNGS+2                cn=0,n=9
         1 000211   200013 000011                    ADSC9   MSGBUF,,AUTO             cn=0,n=9
         1 000212   200003 470500                    LDP0    @KMSG,,AUTO
         1 000213   200010 720100                    LXL0    MSIZ,,AUTO
         1 000214   040100 100540                    MLR     fill='040'O
         1 000215   000004 000010                    ADSC9   4,,PR0                   cn=0,n=*X0
         1 000216   200015 200277                    ADSC9   MSGBUF+2,,AUTO           cn=1,n=191

     1428     7547    3              END;

   7547  1 000217   000226 710000 1                  TRA     s:7552

     1429     7548    3           ELSE DO;

     1430     7549    3                SIZ = 0;

   7549  1 000220   200101 450100                    STZ     SIZ,,AUTO

     1431     7550    3                MSGBUF = SUBSTR(KMSG.MSG,0,MSIZ);

   7550  1 000221   200003 470500                    LDP0    @KMSG,,AUTO
         1 000222   200010 720100                    LXL0    MSIZ,,AUTO
         1 000223   040100 100540                    MLR     fill='040'O
         1 000224   000004 000010                    ADSC9   4,,PR0                   cn=0,n=*X0
         1 000225   200013 000310                    ADSC9   MSGBUF,,AUTO             cn=0,n=200

     1432     7551    3              END;

PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:264  
     1433     7552    2           S_RWPARM.MSG$ = ADDR(MSGBUF);

   7552  1 000226   200013 630500                    EPPR0   MSGBUF,,AUTO
         1 000227   000000 450400 xsym               STP0    S_RWPARM

     1434     7553    2           S_RWPARM.MSGSZ = MSIZ + SIZ;

   7553  1 000230   200010 236100                    LDQ     MSIZ,,AUTO
         1 000231   200101 036100                    ADLQ    SIZ,,AUTO
         1 000232   000001 756000 xsym               STQ     S_RWPARM+1

     1435     7554    2           S_RWPARM.DVE.DVBYTE.VFC = '1'B;

   7554  1 000233   100000 236003                    LDQ     32768,DU
         1 000234   000010 256000 xsym               ORSQ    S_RWPARM+8

     1436     7555    2           S_RWPARM.DVE.VFC = %VFC_TRANSITION1;

   7555  1 000235   000037 236003                    LDQ     31,DU
         1 000236   000010 552020 xsym               STBQ    S_RWPARM+8,'20'O

     1437     7556    3           CALL KIA$FCNO(LDCT$->LDCT,%KV_VDO_FNC_DAT_IMD,S_RWPARM) WHENALTRETURN DO;

   7556  1 000237   000006 236000 2                  LDQ     6
         1 000240   200106 756100                    STQ     SIZ+5,,AUTO
         1 000241   000007 236000 2                  LDQ     7
         1 000242   200006 235100                    LDA     LDCT$,,AUTO
         1 000243   200104 757100                    STAQ    SIZ+3,,AUTO
         1 000244   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000245   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000246   000000 701000 xent               TSX1    KIA$FCNO
         1 000247   000251 702000 1                  TSX2    s:7558
         1 000250   000261 710000 1                  TRA     s:7563

     1438     7557                     %UNLOCK (G = LDCT$->LDCT.LOCK);

   7558  1 000251   200006 236100                    LDQ     LDCT$,,AUTO
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:265  
         1 000252   000020 036003                    ADLQ    16,DU
         1 000253   200104 756100                    STQ     SIZ+3,,AUTO
         1 000254   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000255   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000256   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000257   000000 011000                    NOP     0

     1439     7560    3                GOTO NOSND;

   7560  1 000260   000446 710000 1                  TRA     NOSND

     1440     7561    3              END;
     1441     7562                %UNLOCK (G = LDCT$->LDCT.LOCK );

   7563  1 000261   200006 236100                    LDQ     LDCT$,,AUTO
         1 000262   000020 036003                    ADLQ    16,DU
         1 000263   200104 756100                    STQ     SIZ+3,,AUTO
         1 000264   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000265   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000266   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000267   000000 011000                    NOP     0
         1 000270   000467 710000 1                  TRA     RET

     1442     7565
     1443     7566    2        CASE (KEY_LINKS#);

     1444     7567    2           IF KMSGR.DINFO.NAME ~= ' '

   7567  1 000271   040000 106500                    CMPC    fill='040'O
         1 000272   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000273   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000274   000306 600000 1                  TZE     s:7570

     1445     7568    2           THEN
     1446     7569    2                CALL KIN$CONV_NODENAME(KMSGR.DINFO.NAME,FEI) ALTRET(NFEP);

   7569  1 000275   200011 631500                    EPPR1   FEI,,AUTO
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:266  
         1 000276   200105 451500                    STP1    SIZ+4,,AUTO
         1 000277   200003 236100                    LDQ     @KMSG,,AUTO
         1 000300   000002 036003                    ADLQ    2,DU
         1 000301   200104 756100                    STQ     SIZ+3,,AUTO
         1 000302   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000303   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000304   000000 701000 xent               TSX1    KIN$CONV_NODENAME
         1 000305   000341 702000 1                  TSX2    NFEP

     1447     7570    2           FEI=KMSGD.DINFO.FEP;

   7570  1 000306   200003 470500                    LDP0    @KMSG,,AUTO
         1 000307   000001 235100                    LDA     1,,PR0
         1 000310   200011 755100                    STA     FEI,,AUTO

     1448     7571    2           IF FEI~= 0

   7571  1 000311   000360 600000 1                  TZE     s:7585

     1449     7572    3           THEN DO;

     1450     7573    4                DO FEI = 1 TO KI_MXFE;

   7573  1 000312   000001 236007                    LDQ     1,DL
         1 000313   200011 756100                    STQ     FEI,,AUTO
         1 000314   000336 710000 1                  TRA     s:7580+3

     1451     7574    4                     FEI$ = KI$FEI$(FEI);

   7574  1 000315   000000 470400 xsym               LDP0    KI_FEI$$
         1 000316   200011 720100                    LXL0    FEI,,AUTO
         1 000317   000000 236110                    LDQ     0,X0,PR0
         1 000320   200012 756100                    STQ     FEI$,,AUTO

     1452     7575    4                     IF KMSGD.DINFO.FEP = KI$FEI.FEP#

   7575  1 000321   200003 471500                    LDP1    @KMSG,,AUTO
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:267  
         1 000322   200012 473500                    LDP3    FEI$,,AUTO
         1 000323   300012 236100                    LDQ     10,,PR3
         1 000324   000011 772000                    QRL     9
         1 000325   000777 376007                    ANQ     511,DL
         1 000326   100001 116100                    CMPQ    1,,PR1
         1 000327   000333 601000 1                  TNZ     s:7580

     1453     7576    5                     THEN DO;

     1454     7577    5                          CALL DFEP ALTRET(NFEP);

   7577  1 000330   000632 701000 1                  TSX1    DFEP
         1 000331   000341 702000 1                  TSX2    NFEP

     1455     7578    5                          GOTO FOUND_FEP;

   7578  1 000332   000357 710000 1                  TRA     FOUND_FEP

     1456     7579    5                        END;
     1457     7580    4                   END;

   7580  1 000333   200011 235100                    LDA     FEI,,AUTO
         1 000334   000001 035007                    ADLA    1,DL
         1 000335   200011 755100                    STA     FEI,,AUTO
         1 000336   000000 236000 xsym               LDQ     KI_MXFE
         1 000337   200011 116100                    CMPQ    FEI,,AUTO
         1 000340   000315 603000 1                  TRC     s:7574

   7573  1 000341                       NFEP         null
     1458     7581    3   NFEP:        ;
     1459     7582    3                CALL OCI$MK_WR (KMSG.CADDR,NOFE_MSG#,1,DLNGS,KMSGD.DINFO.FEP);

   7582  1 000341   200003 236100                    LDQ     @KMSG,,AUTO
         1 000342   000001 036003                    ADLQ    1,DU
         1 000343   200110 756100                    STQ     SIZ+7,,AUTO
         1 000344   000012 237000 2                  LDAQ    10
         1 000345   200106 757100                    STAQ    SIZ+5,,AUTO
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:268  
         1 000346   000011 236000 2                  LDQ     9
         1 000347   200105 756100                    STQ     SIZ+4,,AUTO
         1 000350   200003 236100                    LDQ     @KMSG,,AUTO
         1 000351   400000 036007                    ADLQ    -131072,DL
         1 000352   200104 756100                    STQ     SIZ+3,,AUTO
         1 000353   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000354   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000355   000000 701000 xent               TSX1    OCI$MK_WR
         1 000356   000000 011000                    NOP     0

   7582  1 000357                       FOUND_FEP    null
     1460     7583    3   FOUND_FEP:   ;
     1461     7584    3              END;

   7584  1 000357   000467 710000 1                  TRA     RET

     1462     7585    3           ELSE DO FEI=1 TO KI_MXFE;

   7585  1 000360   000001 236007                    LDQ     1,DL
         1 000361   200011 756100                    STQ     FEI,,AUTO
         1 000362   000370 710000 1                  TRA     s:7587+3

     1463     7586    3                CALL DFEP;

   7586  1 000363   000632 701000 1                  TSX1    DFEP
         1 000364   000000 011000                    NOP     0

     1464     7587    3              END;

   7587  1 000365   200011 235100                    LDA     FEI,,AUTO
         1 000366   000001 035007                    ADLA    1,DL
         1 000367   200011 755100                    STA     FEI,,AUTO
         1 000370   000000 236000 xsym               LDQ     KI_MXFE
         1 000371   200011 116100                    CMPQ    FEI,,AUTO
         1 000372   000363 603000 1                  TRC     s:7586
         1 000373   000467 710000 1                  TRA     RET

PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:269  
     1465     7588
     1466     7589    2        CASE (KEY_ROUTES#);

     1467     7590
     1468     7591    2           IF KMSGD.DINFO.FEP = 0 AND KMSGR.DINFO.NAME = ' '

   7591  1 000374   000001 235100                    LDA     1,,PR0
         1 000375   000420 601000 1                  TNZ     s:7599
         1 000376   040000 106500                    CMPC    fill='040'O
         1 000377   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000400   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000401   000420 601000 1                  TNZ     s:7599

     1469     7592    2           THEN
     1470     7593    3           DO FEI = 0 TO KI_NODES;

   7593  1 000402   200011 450100                    STZ     FEI,,AUTO
         1 000403   000414 710000 1                  TRA     s:7597+3

     1471     7594    3                IF FEI ~= K_NODE#

   7594  1 000404   200011 236100                    LDQ     FEI,,AUTO
         1 000405   000000 116000 xsym               CMPQ    K_NODE#
         1 000406   000411 600000 1                  TZE     s:7597

     1472     7595    3                THEN
     1473     7596    3                     CALL DROUTE;

   7596  1 000407   000720 701000 1                  TSX1    DROUTE
         1 000410   000000 011000                    NOP     0

     1474     7597    3              END;

   7597  1 000411   200011 235100                    LDA     FEI,,AUTO
         1 000412   000001 035007                    ADLA    1,DL
         1 000413   200011 755100                    STA     FEI,,AUTO
         1 000414   000000 236000 xsym               LDQ     KI_NODES
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:270  
         1 000415   200011 116100                    CMPQ    FEI,,AUTO
         1 000416   000404 603000 1                  TRC     s:7594
         1 000417   000467 710000 1                  TRA     RET

     1475     7598    3           ELSE DO;

     1476     7599    3                IF KMSGR.DINFO.NAME ~= ' '

   7599  1 000420   040000 106500                    CMPC    fill='040'O
         1 000421   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000422   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000423   000436 600000 1                  TZE     s:7603

     1477     7600    3                THEN
     1478     7601    3                     CALL KIN$CONV_NODENAME(KMSGR.DINFO.NAME,FEI) ALTRET (NFEP);

   7601  1 000424   200011 631500                    EPPR1   FEI,,AUTO
         1 000425   200105 451500                    STP1    SIZ+4,,AUTO
         1 000426   200003 236100                    LDQ     @KMSG,,AUTO
         1 000427   000002 036003                    ADLQ    2,DU
         1 000430   200104 756100                    STQ     SIZ+3,,AUTO
         1 000431   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000432   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000433   000000 701000 xent               TSX1    KIN$CONV_NODENAME
         1 000434   000341 702000 1                  TSX2    NFEP
         1 000435   000437 710000 1                  TRA     s:7604

     1479     7602    3                ELSE
     1480     7603    3                     FEI = KMSGR.DINFO.FEP;

   7603  1 000436   200011 755100                    STA     FEI,,AUTO

     1481     7604    3                IF FEI > KI_NODES THEN GOTO NFEP;

   7604  1 000437   000000 236000 xsym               LDQ     KI_NODES
         1 000440   200011 116100                    CMPQ    FEI,,AUTO
         1 000441   000341 602000 1                  TNC     NFEP
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:271  

     1482     7605    3                CALL DROUTE;

   7605  1 000442   000720 701000 1                  TSX1    DROUTE
         1 000443   000000 011000                    NOP     0

     1483     7606    3              END;

   7606  1 000444   000467 710000 1                  TRA     RET

     1484     7607
     1485     7608        /*N*
     1486     7609                  CASE (KEY_DISCT#);
     1487     7610                    DO INHIBIT;
     1488     7611                      LDCT$=KC_NOCG$;
     1489     7612                      DO WHILE (LDCT$~=ADDR(NIL));
     1490     7613          IF LDCT$->LDCT.DEVNM=KMSG.TERM AND LDCT$->LDCT.RESCOD=NK_TRMPTH THEN GOTO GOTTRM;
     1491     7614                        LDCT$=LDCT$->LDCT.LNK$;
     1492     7615                        END;
     1493     7616                      END;
     1494     7617                    GOTO NOTRM;
     1495     7618        GOTTRM:     ;
     1496     7619                    CALL KIA$FCNOU (LDCT$->LDCT,KX_DREQ) ALTRET (NOTRM);
     1497     7620                    RETURN;
     1498     7621        NOTRM:      ;
     1499     7622                    CALL OCI$MK_WR (KMSG.CADDR,NTRM_MSG#,1,'010'O,KMSG.TERM);
     1500     7623         */
     1501     7624    2        CASE (ELSE);

     1502     7625    2           ALTRETURN;

   7625  1 000445   000000 702200 xent               TSX2  ! X66_AALT

   7603  1 000446                       NOSND        null
     1503     7626    2   NOSND:  ;
     1504     7627    2           KMSG.ERR=COD_NSND;

PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:272  
   7627  1 000446   200003 470500                    LDP0    @KMSG,,AUTO
         1 000447   002000 236007                    LDQ     1024,DL
         1 000450   000003 552110                    STBQ    3,'10'O,PR0

   7627  1 000451                       ERROUT       null
     1505     7628    2   ERROUT: ;
     1506     7629    2           CALL OCI$MK_WR (KMSG.CADDR,ESND_MSG#,2,LNGS,KMSG.SYSID);

   7629  1 000451   200003 236100                    LDQ     @KMSG,,AUTO
         1 000452   000003 036003                    ADLQ    3,DU
         1 000453   200110 756100                    STQ     SIZ+7,,AUTO
         1 000454   000016 237000 2                  LDAQ    14
         1 000455   200106 757100                    STAQ    SIZ+5,,AUTO
         1 000456   000015 236000 2                  LDQ     13
         1 000457   200105 756100                    STQ     SIZ+4,,AUTO
         1 000460   200003 236100                    LDQ     @KMSG,,AUTO
         1 000461   400000 036007                    ADLQ    -131072,DL
         1 000462   200104 756100                    STQ     SIZ+3,,AUTO
         1 000463   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000464   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000465   000000 701000 xent               TSX1    OCI$MK_WR
         1 000466   000000 011000                    NOP     0

     1507     7630    2        END;

   7629  1 000467                       RET          null
     1508     7631    1   RET: ;
     1509     7632    1        RETURN;

   7632  1 000467   000000 702200 xent               TSX2  ! X66_ARET

     1510     7633        /**/
     1511     7634        /**/
     1512     7635        %EJECT;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:273  
     1513     7636    1   KIP$SENDALL: ENTRY(KMSG,SIZE,FEP) ALTRET;

   7636  1 000470   000000 700200 xent  KIP$SENDALL  TSX0  ! X66_AUTO_3
         1 000471   000112 000003                    ZERO    74,3

     1514     7637
     1515     7638    1        MSIZ = SIZE;

   7638  1 000472   200004 470500                    LDP0    @SIZE,,AUTO
         1 000473   000000 235100                    LDA     0,,PR0
         1 000474   200010 755100                    STA     MSIZ,,AUTO

     1516     7639    1        CALL CONCAT(MSGBUF,'Broadcast:',ADDR(KMSG)->VCHR);

   7639  1 000475   040100 100400                    MLR     fill='040'O
         1 000476   000012 000012 0                  ADSC9   RTELNGS+5                cn=0,n=10
         1 000477   200013 000012                    ADSC9   MSGBUF,,AUTO             cn=0,n=10
         1 000500   200003 471500                    LDP1    @KMSG,,AUTO
         1 000501   000000 620005                    EAX0    0,AL
         1 000502   040100 100540                    MLR     fill='040'O
         1 000503   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 000504   200015 400276                    ADSC9   MSGBUF+2,,AUTO           cn=2,n=190

     1517     7640    2        DO LDX=NK_MXLOCAL+1 TO NK_MXTOTAL;

   7640  1 000505   000000 235000 xsym               LDA     NK_MXLOCAL
         1 000506   000001 035007                    ADLA    1,DL
         1 000507   200011 755100                    STA     FEI,,AUTO
         1 000510   000626 710000 1                  TRA     s:7666+3

     1518     7641    2             LDCT$=NK$LDCT$(LDX);

   7641  1 000511   000000 470400 xsym               LDP0    N$DCT$$
         1 000512   200011 720100                    LXL0    FEI,,AUTO
         1 000513   000000 236110                    LDQ     0,X0,PR0
         1 000514   200006 756100                    STQ     LDCT$,,AUTO

PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:274  
     1519     7642    2             IF LDCT$ ~= ADDR(NIL)

   7642  1 000515   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000516   000623 600000 1                  TZE     s:7666

     1520     7643    2             THEN
     1521     7644    2                  IF LDCT$->LDCT.RESCOD = NK_TSTRM AND

   7644  1 000517   200006 471500                    LDP1    LDCT$,,AUTO
         1 000520   100006 236100                    LDQ     6,,PR1
         1 000521   000017 376007                    ANQ     15,DL
         1 000522   000001 116007                    CMPQ    1,DL
         1 000523   000623 601000 1                  TNZ     s:7666
         1 000524   100006 236100                    LDQ     6,,PR1
         1 000525   010000 316007                    CANQ    4096,DL
         1 000526   000623 601000 1                  TNZ     s:7666
         1 000527   100022 236100                    LDQ     18,,PR1
         1 000530   000777 376003                    ANQ     511,DU
         1 000531   000002 116003                    CMPQ    2,DU
         1 000532   000535 600000 1                  TZE     s:7644+14
         1 000533   000012 116003                    CMPQ    10,DU
         1 000534   000623 601000 1                  TNZ     s:7666
         1 000535   100006 236100                    LDQ     6,,PR1
         1 000536   200000 316007                    CANQ    65536,DL
         1 000537   000623 600000 1                  TZE     s:7666
         1 000540   100015 236100                    LDQ     13,,PR1
         1 000541   000033 772000                    QRL     27
         1 000542   000000 116000 xsym               CMPQ    K_NODE#
         1 000543   000623 600000 1                  TZE     s:7666
         1 000544   100006 236100                    LDQ     6,,PR1
         1 000545   004000 316007                    CANQ    2048,DL
         1 000546   000623 601000 1                  TNZ     s:7666
         1 000547   200005 236100                    LDQ     @FEP,,AUTO
         1 000550   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000551   000557 600000 1                  TZE     s:7653
         1 000552   200005 473500                    LDP3    @FEP,,AUTO
         1 000553   100015 236100                    LDQ     13,,PR1
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:275  
         1 000554   000033 772000                    QRL     27
         1 000555   300000 116100                    CMPQ    0,,PR3
         1 000556   000623 601000 1                  TNZ     s:7666

     1522     7645    2                       NOT LDCT$->LDCT.DFLG.OLDSC
     1523     7646    2                      AND (LDCT$->LDCT.TERMID.TTYP = %KLTY_TTY# OR LDCT$->LDCT.TERMID.
              7646                                TTYP = %KLTY_LINEDEV#)
     1524     7647    2                       AND LDCT$->LDCT.DFLG.OUTPUT
     1525     7648    2                       AND LDCT$->LDCT.RLCID.NODE ~= K_NODE#
     1526     7649    2                       AND NOT LDCT$->LDCT.DFLG.NOSND
     1527     7650    2                       AND (ADDR(FEP)= ADDR(NIL) OR LDCT$->NK$LDCT.RLCID.NODE = FEP)
     1528     7651    3                  THEN DO;

     1529     7652                            %LOCK (G = LDCT$->LDCT.LOCK );

   7653  1 000557   200006 236100                    LDQ     LDCT$,,AUTO
         1 000560   000020 036003                    ADLQ    16,DU
         1 000561   200104 756100                    STQ     SIZ+3,,AUTO
         1 000562   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000563   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000564   000000 701000 xent               TSX1    HFC$LOCK
         1 000565   000000 011000                    NOP     0

     1530     7655    3                       S_RWPARM = K_RWPARM_CON;

   7655  1 000566   000000 100400                    MLR     fill='000'O
         1 000567   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000570   000000 000234 xsym               ADSC9   S_RWPARM                 cn=0,n=156

     1531     7656    3                       S_RWPARM.MSG$ = ADDR(MSGBUF);

   7656  1 000571   200013 630500                    EPPR0   MSGBUF,,AUTO
         1 000572   000000 450400 xsym               STP0    S_RWPARM

     1532     7657    3                       S_RWPARM.MSGSZ = SIZE + LENGTHC('Broadcast:');

   7657  1 000573   200004 471500                    LDP1    @SIZE,,AUTO
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:276  
         1 000574   100000 235100                    LDA     0,,PR1
         1 000575   000012 035007                    ADLA    10,DL
         1 000576   000001 755000 xsym               STA     S_RWPARM+1

     1533     7658    3                       S_RWPARM.DVE.DVBYTE.VFC = '1'B;

   7658  1 000577   100000 236003                    LDQ     32768,DU
         1 000600   000010 256000 xsym               ORSQ    S_RWPARM+8

     1534     7659    3                       S_RWPARM.DVE.VFC = %VFC_TRANSITION1;

   7659  1 000601   000037 236003                    LDQ     31,DU
         1 000602   000010 552020 xsym               STBQ    S_RWPARM+8,'20'O

     1535     7660    3                       CALL KIA$FCNO(LDCT$->LDCT,%KV_VDO_FNC_DAT_IMD,S_RWPARM);

   7660  1 000603   000006 236000 2                  LDQ     6
         1 000604   200106 756100                    STQ     SIZ+5,,AUTO
         1 000605   000007 236000 2                  LDQ     7
         1 000606   200006 235100                    LDA     LDCT$,,AUTO
         1 000607   200104 757100                    STAQ    SIZ+3,,AUTO
         1 000610   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000611   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000612   000000 701000 xent               TSX1    KIA$FCNO
         1 000613   000000 011000                    NOP     0

     1536     7661                            %UNLOCK (G = LDCT$->LDCT.LOCK );

   7662  1 000614   200006 236100                    LDQ     LDCT$,,AUTO
         1 000615   000020 036003                    ADLQ    16,DU
         1 000616   200104 756100                    STQ     SIZ+3,,AUTO
         1 000617   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000620   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000621   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000622   000000 011000                    NOP     0

     1537     7664    3                     END;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:277  

     1538     7665
     1539     7666    2           END;

   7666  1 000623   200011 235100                    LDA     FEI,,AUTO
         1 000624   000001 035007                    ADLA    1,DL
         1 000625   200011 755100                    STA     FEI,,AUTO
         1 000626   000000 236000 xsym               LDQ     NK_MXTOTAL
         1 000627   200011 116100                    CMPQ    FEI,,AUTO
         1 000630   000511 603000 1                  TRC     s:7641

     1540     7667
     1541     7668    1        RETURN;

   7668  1 000631   000000 702200 xent               TSX2  ! X66_ARET

     1542     7669
     1543     7670        %EJECT;
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:278  
     1544     7671    1   DFEP: PROC ALTRET;

   7671  1 000632   200102 741300       DFEP         STX1  ! SIZ+1,,AUTO

     1545     7672        /**/
     1546     7673    2        FEI$ = KI$FEI$(FEI);

   7673  1 000633   000000 470400 xsym               LDP0    KI_FEI$$
         1 000634   200011 720100                    LXL0    FEI,,AUTO
         1 000635   000000 236110                    LDQ     0,X0,PR0
         1 000636   200012 756100                    STQ     FEI$,,AUTO

     1547     7674    2        IF KI$FEI.PBST.PROB = KIER_PART THEN

   7674  1 000637   200012 471500                    LDP1    FEI$,,AUTO
         1 000640   100015 222100                    LDX2    13,,PR1
         1 000641   000016 102003                    CMPX2   14,DU
         1 000642   000647 601000 1                  TNZ     s:7677

     1548     7675    2             KMSGD.DINFO.STATE = KIST_DN ;

   7675  1 000643   200003 473500                    LDP3    @KMSG,,AUTO
         1 000644   000000 236003                    LDQ     0,DU
         1 000645   300002 552140                    STBQ    2,'40'O,PR3
         1 000646   000653 710000 1                  TRA     s:7678

     1549     7676    2        ELSE
     1550     7677    2             KMSGD.DINFO.STATE = KI$FEI.FEST ;

   7677  1 000647   200003 473500                    LDP3    @KMSG,,AUTO
         1 000650   100002 236100                    LDQ     2,,PR1
         1 000651   000011 736000                    QLS     9
         1 000652   300002 552140                    STBQ    2,'40'O,PR3

     1551     7678    2        KMSGD.DINFO.FEP=KI$FEI.FEP#;

   7678  1 000653   100012 236100                    LDQ     10,,PR1
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:279  
         1 000654   000011 772000                    QRL     9
         1 000655   000777 376007                    ANQ     511,DL
         1 000656   300001 756100                    STQ     1,,PR3

     1552     7679    2        KMSGD.DINFO.BDU=KI$FEI.BDU# ;

   7679  1 000657   100007 236100                    LDQ     7,,PR1
         1 000660   300002 552120                    STBQ    2,'20'O,PR3

     1553     7680    2        KMSGD.DINFO.PROB=KI$FEI.PBST.PROB ;

   7680  1 000661   100015 236100                    LDQ     13,,PR1
         1 000662   000011 772000                    QRL     9
         1 000663   300002 552110                    STBQ    2,'10'O,PR3

     1554     7681    2        KMSGD.DINFO.NAME = KI$ROUTE$(KI$FEI.FEP#)->KI$ROUTE.NODE_NAME;

   7681  1 000664   100012 236100                    LDQ     10,,PR1
         1 000665   000011 772000                    QRL     9
         1 000666   000777 376007                    ANQ     511,DL
         1 000667   000000 474400 xsym               LDP4    KI_ROUTE$$
         1 000670   400000 475506                    LDP5    0,QL,PR4
         1 000671   040100 100500                    MLR     fill='040'O
         1 000672   500000 000010                    ADSC9   0,,PR5                   cn=0,n=8
         1 000673   300002 600010                    ADSC9   2,,PR3                   cn=3,n=8

     1555     7682    2        IF KMSGD.DINFO.NAME ~= ' '

   7682  1 000674   040000 106500                    CMPC    fill='040'O
         1 000675   300002 600010                    ADSC9   2,,PR3                   cn=3,n=8
         1 000676   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000677   000716 600000 1                  TZE     s:7685

     1556     7683    2        THEN
     1557     7684    2             CALL OCI$MK_WR (KMSG.CADDR,DFEP_MSG#,5,DLNGS,KMSGD.DINFO);

   7684  1 000700   200003 236100                    LDQ     @KMSG,,AUTO
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:280  
         1 000701   000001 036003                    ADLQ    1,DU
         1 000702   200110 756100                    STQ     SIZ+7,,AUTO
         1 000703   000022 237000 2                  LDAQ    18
         1 000704   200106 757100                    STAQ    SIZ+5,,AUTO
         1 000705   000021 236000 2                  LDQ     17
         1 000706   200105 756100                    STQ     SIZ+4,,AUTO
         1 000707   200003 236100                    LDQ     @KMSG,,AUTO
         1 000710   400000 036007                    ADLQ    -131072,DL
         1 000711   200104 756100                    STQ     SIZ+3,,AUTO
         1 000712   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 000713   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000714   000000 701000 xent               TSX1    OCI$MK_WR
         1 000715   000000 011000                    NOP     0

     1558     7685    2        RETURN;

   7685  1 000716   200102 221300                    LDX1  ! SIZ+1,,AUTO
         1 000717   000001 702211                    TSX2  ! 1,X1

     1559     7686    2   END;
     1560     7687    1   DROUTE: PROC;

   7687  1 000720   200102 741300       DROUTE       STX1  ! SIZ+1,,AUTO

     1561     7688
     1562     7689    2        ROUTE$ = KI$ROUTE$(FEI);

   7689  1 000721   000000 470400 xsym               LDP0    KI_ROUTE$$
         1 000722   200011 720100                    LXL0    FEI,,AUTO
         1 000723   000000 236110                    LDQ     0,X0,PR0
         1 000724   200077 756100                    STQ     ROUTE$,,AUTO

     1563     7690    2        KMSGR.DINFO.FEP = FEI;

   7690  1 000725   200003 471500                    LDP1    @KMSG,,AUTO
         1 000726   200011 235100                    LDA     FEI,,AUTO
         1 000727   100001 755100                    STA     1,,PR1
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:281  

     1564     7691    2        KMSGR.DINFO.NAME = KI$ROUTE.NODE_NAME;

   7691  1 000730   200077 473500                    LDP3    ROUTE$,,AUTO
         1 000731   040100 100500                    MLR     fill='040'O
         1 000732   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         1 000733   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8

     1565     7692    2        IF KI$ROUTE.FEI# ~= 0

   7692  1 000734   300002 236100                    LDQ     2,,PR3
         1 000735   777000 316003                    CANQ    -512,DU
         1 000736   000761 600000 1                  TZE     s:7698

     1566     7693    3        THEN DO;

     1567     7694    3             KMSGR.DINFO.LINKFEP = KI$FEI$(KI$ROUTE.FEI#)->KI$FEI.FEP#;

   7694  1 000737   300002 236100                    LDQ     2,,PR3
         1 000740   000033 772000                    QRL     27
         1 000741   000000 474400 xsym               LDP4    KI_FEI$$
         1 000742   400000 475506                    LDP5    0,QL,PR4
         1 000743   500012 236100                    LDQ     10,,PR5
         1 000744   000022 736000                    QLS     18
         1 000745   100004 552140                    STBQ    4,'40'O,PR1

     1568     7695    3             KMSGR.DINFO.LINKNAME = KI$ROUTE$(KI$FEI$(KI$ROUTE.FEI#)->KI$FEI.FEP#)->
              7695                      KI$ROUTE.NODE_NAME;

   7695  1 000746   300002 236100                    LDQ     2,,PR3
         1 000747   000033 772000                    QRL     27
         1 000750   400000 475506                    LDP5    0,QL,PR4
         1 000751   500012 236100                    LDQ     10,,PR5
         1 000752   000011 772000                    QRL     9
         1 000753   000777 376007                    ANQ     511,DL
         1 000754   000000 475506                    LDP5    0,QL,PR0
         1 000755   040100 100500                    MLR     fill='040'O
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:282  
         1 000756   500000 000010                    ADSC9   0,,PR5                   cn=0,n=8
         1 000757   100004 200010                    ADSC9   4,,PR1                   cn=1,n=8

     1569     7696    3           END;

   7696  1 000760   000766 710000 1                  TRA     s:7701

     1570     7697    3        ELSE DO;

     1571     7698    3             KMSGR.DINFO.LINKFEP = 0;

   7698  1 000761   000000 236003                    LDQ     0,DU
         1 000762   100004 552140                    STBQ    4,'40'O,PR1

     1572     7699    3             KMSGR.DINFO.LINKNAME = ' ';

   7699  1 000763   040100 100400                    MLR     fill='040'O
         1 000764   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000765   100004 200010                    ADSC9   4,,PR1                   cn=1,n=8

     1573     7700    3           END;

     1574     7701    2        KMSGR.DINFO.QOS = KI$ROUTE.CURRENT_QOS;

   7701  1 000766   300002 236100                    LDQ     2,,PR3
         1 000767   100006 552120                    STBQ    6,'20'O,PR1

     1575     7702    2        KMSGR.DINFO.ALT = KI$ROUTE.ALT_QOS;

   7702  1 000770   300002 236100                    LDQ     2,,PR3
         1 000771   100006 552110                    STBQ    6,'10'O,PR1

     1576     7703    2        IF KI$ROUTE.NODE_NAME ~= ' '

   7703  1 000772   040000 106500                    CMPC    fill='040'O
         1 000773   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         1 000774   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:283  
         1 000775   001015 600000 1                  TZE     s:7708

     1577     7704    2        THEN
     1578     7705    2             CALL OCI$MK_WR(KMSG.CADDR,OC_MSG_RTE#,6,RTELNGS,KMSGR.DINFO);

   7705  1 000776   200003 236100                    LDQ     @KMSG,,AUTO
         1 000777   000001 036003                    ADLQ    1,DU
         1 001000   200110 756100                    STQ     SIZ+7,,AUTO
         1 001001   000026 237000 2                  LDAQ    22
         1 001002   200106 757100                    STAQ    SIZ+5,,AUTO
         1 001003   000025 236000 2                  LDQ     21
         1 001004   200105 756100                    STQ     SIZ+4,,AUTO
         1 001005   200003 236100                    LDQ     @KMSG,,AUTO
         1 001006   400000 036007                    ADLQ    -131072,DL
         1 001007   200104 756100                    STQ     SIZ+3,,AUTO
         1 001010   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 001011   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001012   000000 701000 xent               TSX1    OCI$MK_WR
         1 001013   000000 011000                    NOP     0
         1 001014   001033 710000 1                  TRA     s:7709

     1579     7706
     1580     7707    2        ELSE
     1581     7708    2             CALL OCI$MK_WR (KMSG.CADDR,NOFE_MSG#,1,DLNGS,KMSGD.DINFO.FEP);

   7708  1 001015   200003 236100                    LDQ     @KMSG,,AUTO
         1 001016   000001 036003                    ADLQ    1,DU
         1 001017   200110 756100                    STQ     SIZ+7,,AUTO
         1 001020   000012 237000 2                  LDAQ    10
         1 001021   200106 757100                    STAQ    SIZ+5,,AUTO
         1 001022   000011 236000 2                  LDQ     9
         1 001023   200105 756100                    STQ     SIZ+4,,AUTO
         1 001024   200003 236100                    LDQ     @KMSG,,AUTO
         1 001025   400000 036007                    ADLQ    -131072,DL
         1 001026   200104 756100                    STQ     SIZ+3,,AUTO
         1 001027   200104 630500                    EPPR0   SIZ+3,,AUTO
         1 001030   000023 631400 xsym               EPPR1   B_VECTNIL+19
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:284  
         1 001031   000000 701000 xent               TSX1    OCI$MK_WR
         1 001032   000000 011000                    NOP     0

     1582     7709    2        RETURN;

   7709  1 001033   200102 221300                    LDX1  ! SIZ+1,,AUTO
         1 001034   000001 702211                    TSX2  ! 1,X1

CGNM
 Sect OctLoc
   0     000   107110 123124   000000 000000                                    GHST....

LNGS
 Sect OctLoc
   0     002   002001 ******                                                    ....

DLNGS
 Sect OctLoc
   0     003   004001 001001   010*** ******                                    ........

RTELNGS
 Sect OctLoc
   0     005   004010 001010   001001 ******                                    ........

(unnamed)
 Sect OctLoc
   0     007   117160 145162   141164 157162   072040 040040   102162 157141    Operator:   Broa
   0     013   144143 141163   164072 040040                                    dcast:

(unnamed)
 Sect OctLoc
   2     000   000000 006000   000000 000042   000003 600000   000003 006000    ......."........
   2     004   000001 006000   000003 400000   000000 006000   000010 006000    ................
   2     010   000000 000014   000010 006000   000003 006000   000003 006000    ................
   2     014   000000 000044   000014 006000   000004 006000   000002 006000    ...$............
   2     020   000000 000041   000020 006000   000007 006000   000003 006000    ...!............
   2     024   000000 001020   000024 006000   000010 006000   000005 006000    ................
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:285  
     1583     7710
     1584     7711    2   END DROUTE;
     1585     7712        /**/
     1586     7713    1   END KIP$KEYIN;
     1587     7714        /**/
     1588     7715        /**/

PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:286  
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KIP$KEYIN.
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:287  

 **** Variables and constants ****

  ****  Section 000 RoData KIP$KEYIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 CGNM                       3-0-0/b UBIN(9)     r     1 DLNGS(0:4)
     2-0-0/b UBIN(9)     r     1 LNGS(0:1)
     5-0-0/b UBIN(9)     r     1 RTELNGS(0:5)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @FEP                       3-0-0/w PTR         r     1 @KMSG
     4-0-0/w PTR         r     1 @SIZE                     11-0-0/w UBIN        r     1 FEI
    12-0-0/w PTR         r     1 FEI$                      *0-0-0/w UBIN        r     1 FEP
    75-0-0/w STRC(72)    r     1 GHNM                      *0-0-0/w STRC(1260)  r     1 KMSG
    *0-0-0/w STRC(1260)  r     1 KMSGD                     *0-0-0/w STRC(1260)  r     1 KMSGR
     6-0-0/w PTR         r     1 LDCT$                     11-0-0/w UBIN        r     1 LDX
    13-0-0/c CHAR(200)   r     1 MSGBUF                    10-0-0/w UBIN        r     1 MSIZ
    77-0-0/w PTR         r     1 ROUTE$                   101-0-0/w UBIN        r     1 SIZ
    *0-0-0/w UBIN        r     1 SIZE                      10-0-0/w UBIN        r     1 UNUM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$USRT$
     0-0-0/w STRC(432)   r     1 KC_CSID                    0-0-0/w PTR         r     1 KI_FEI$$
     0-0-0/w UBIN        r     1 KI_MXFE                    0-0-0/w UBIN        r     1 KI_NODES
     0-0-0/w PTR         r     1 KI_ROUTE$$                 0-0-0/w UBIN        r     1 K_NODE#
     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON               0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w UBIN        r     1 NK_MXLOCAL                 0-0-0/w UBIN        r     1 NK_MXTOTAL
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:288  
     0-0-0/w UBIN        r     1 S_CUN                      0-0-0/d STRC(1404)  r     1 S_RWPARM

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/w STRC(216)   r     1 KI$ROUTE
     0-0-0/w PTR         r     1 KI$ROUTE$(0:0)
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/c ACHR        r     1 VCHR                       0-0-0/w STRC(72)    r     1 VGHNM


   Procedure KIP$KEYIN requires 541 words for executable code.
   Procedure KIP$KEYIN requires 74 words of local(AUTO) storage.

    No errors detected in file KIP$PMME.:E05TSI    .
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:289  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:290  
          MINI XREF LISTING

B$DO.ECCINFO
       162**DCL       163--REDEF
B$JIT.ERR.MID
       389**DCL       389--REDEF
B$JIT$
      7501**DCL       383--IMP-PTR
B$U.MISC
       141**DCL       142--REDEF
B$USER.FLG
       187**DCL      7516>>IF
B$USER.MISC
       217**DCL       218--REDEF
B$USER.MODE
       208**DCL      7515>>IF
B$USRT$
       229**DCL      7515>>IF       7516>>IF
CGNM
      7349**DCL      7527>>ASSIGN
DFEP
      7671**PROC     7577--CALL     7586--CALL
DLNGS
      7499**DCL      7582<>CALL     7684<>CALL     7708<>CALL
DROUTE
      7687**PROC     7596--CALL     7605--CALL
ERROUT
      7627**LABEL    7518--GOTO     7536--GOTO
FEI
      7340**DCL      7341--REDEF    7569<>CALL     7570<<ASSIGN   7571>>IF       7573<<DOINDEX  7574>>ASSIGN
      7585<<DOINDEX  7593<<DOINDEX  7594>>IF       7601<>CALL     7603<<ASSIGN   7604>>IF       7673>>ASSIGN
      7689>>ASSIGN   7690>>ASSIGN
FEI$
      7342**DCL      7370--IMP-PTR  7574<<ASSIGN   7575>>IF       7673<<ASSIGN   7674>>IF       7677>>ASSIGN
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:291  
      7678>>ASSIGN   7679>>ASSIGN   7680>>ASSIGN   7681>>ASSIGN
FEP
      7303**DCL         8--PROC     7636--ENTRY    7644--IF       7644>>IF
FOUND_FEP
      7582**LABEL    7578--GOTO
GHNM
      7345**DCL      7527<<ASSIGN   7530<>CALL
GHNM.SYSID
      7347**DCL      7528<<ASSIGN
GOTLDCT
      7535**LABEL    7525--GOTO
HFC$LOCK
      6031**DCL-ENT  7540--CALL     7653--CALL
HFC$UNLOCK
      6031**DCL-ENT  7558--CALL     7563--CALL     7662--CALL
KCO$FINDSTA
      7502**DCL-ENT  7530--CALL
KC_CSID
      6969**DCL      7530<>CALL
KI$FEI.BD$
      7405**DCL      7406--REDEF
KI$FEI.BDAD.WADDR
      7407**DCL      7408--REDEF
KI$FEI.BDU#
      7403**DCL      7679>>ASSIGN
KI$FEI.FEP#
      7415**DCL      7575>>IF       7678>>ASSIGN   7681>>ASSIGN   7694>>ASSIGN   7695>>ASSIGN
KI$FEI.FEST
      7375**DCL      7677>>ASSIGN
KI$FEI.PBST.PROB
      7423**DCL      7674>>IF       7680>>ASSIGN
KI$FEI.RCVPB
      7421**DCL      7422--REDEF
KI$FEI$
       495**DCL      7574>>ASSIGN   7673>>ASSIGN   7694>>ASSIGN   7695>>ASSIGN
KI$ROUTE.ALT_QOS
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:292  
      7459**DCL      7702>>ASSIGN
KI$ROUTE.CURRENT_QOS
      7458**DCL      7701>>ASSIGN
KI$ROUTE.FEI#
      7453**DCL      7692>>IF       7694>>ASSIGN   7695>>ASSIGN
KI$ROUTE.NODE_NAME
      7443**DCL      7681>>ASSIGN   7691>>ASSIGN   7695>>ASSIGN   7703>>IF
KI$ROUTE$
      7495**DCL      7681>>ASSIGN   7689>>ASSIGN   7695>>ASSIGN
KIA$FCNO
      7504**DCL-ENT  7556--CALL     7660--CALL
KIN$CONV_NODENAME
      7507**DCL-ENT  7569--CALL     7601--CALL
KI_FEI$$
       494**DCL       495--IMP-PTR  7574>>ASSIGN   7673>>ASSIGN   7694>>ASSIGN   7695>>ASSIGN
KI_MXFE
       503**DCL      7573>>DOINDEX  7585>>DOINDEX
KI_NODES
       502**DCL      7593>>DOINDEX  7604>>IF
KI_ROUTE$$
       496**DCL      7495--IMP-PTR  7681>>ASSIGN   7689>>ASSIGN   7695>>ASSIGN
KMSG
      7304**DCL         8--PROC     7313--REDEF    7324--REDEF    7636--ENTRY    7639--CALLBLT
KMSG.CADDR
      7306**DCL      7514<>CALL     7582<>CALL     7629<>CALL     7684<>CALL     7705<>CALL     7708<>CALL
KMSG.CNT
      7311**DCL      7531<>CALL     7538>>ASSIGN
KMSG.ERR
      7310**DCL      7517<<ASSIGN   7535<<ASSIGN   7627<<ASSIGN
KMSG.KIN#
      7305**DCL      7512>>DOCASE
KMSG.MSG
      7312**DCL      7531<>CALL     7546>>CALLBLT  7550>>ASSIGN
KMSG.SYSID
      7309**DCL      7514<>CALL     7528>>ASSIGN   7629<>CALL
KMSG.WSN
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:293  
      7307**DCL      7308--REDEF    7514<>CALL
KMSGD.DINFO
      7316**DCL      7684<>CALL
KMSGD.DINFO.BDU
      7319**DCL      7679<<ASSIGN
KMSGD.DINFO.FEP
      7317**DCL      7570>>ASSIGN   7575>>IF       7582<>CALL     7591>>IF       7678<<ASSIGN   7708<>CALL
KMSGD.DINFO.NAME
      7321**DCL      7681<<ASSIGN   7682>>IF
KMSGD.DINFO.PROB
      7320**DCL      7680<<ASSIGN
KMSGD.DINFO.STATE
      7318**DCL      7675<<ASSIGN   7677<<ASSIGN
KMSGR.DINFO
      7327**DCL      7705<>CALL
KMSGR.DINFO.ALT
      7333**DCL      7702<<ASSIGN
KMSGR.DINFO.FEP
      7328**DCL      7603>>ASSIGN   7690<<ASSIGN
KMSGR.DINFO.LINKFEP
      7330**DCL      7694<<ASSIGN   7698<<ASSIGN
KMSGR.DINFO.LINKNAME
      7331**DCL      7695<<ASSIGN   7699<<ASSIGN
KMSGR.DINFO.NAME
      7329**DCL      7567>>IF       7569<>CALL     7591>>IF       7599>>IF       7601<>CALL     7691<<ASSIGN
KMSGR.DINFO.QOS
      7332**DCL      7701<<ASSIGN
K_NODE#
      6817**DCL      7594>>IF       7644>>IF
K_RWPARM_CON
      6522**DCL      7542>>ASSIGN   7655>>ASSIGN
K_RWPARM_CON.BLKREC
      6548**DCL      6573--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      6549**DCL      6551--REDEF
K_RWPARM_CON.BLKREC.RECU#
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:294  
      6561**DCL      6563--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      6588**DCL      6589--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      6596**DCL      6600--REDEF
K_RWPARM_CON.ERR
      6660**DCL      6665--REDEF
K_RWPARM_CON.FC
      6624**DCL      6625--REDEF
K_RWPARM_CON.FLDID
      6806**DCL      6807--REDEF
K_RWPARM_CON.FPT$
      6687**DCL      6694--REDEF
K_RWPARM_CON.KEYTYPE
      6813**DCL      6814--REDEF
K_RWPARM_CON.MSG$
      6523**DCL      6529--REDEF
K_RWPARM_CON.MSGID
      6635**DCL      6640--REDEF
K_RWPARM_CON.MSGIDXT
      6648**DCL      6652--REDEF
K_RWPARM_CON.ORG
      6784**DCL      6785--REDEF
K_RWPARM_CON.THDRSZ
      6728**DCL      6732--REDEF
K_RWPARM_CON.VDOFLGS
      6786**DCL      6797--REDEF
LDCT$
      7336**DCL      7521<<ASSIGN   7522>>IF       7522>>IF       7522>>IF       7522>>IF       7522>>IF
      7530<>CALL     7531>>CALL     7540>>CALL     7556>>CALL     7558>>CALL     7563>>CALL     7641<<ASSIGN
      7642>>IF       7644>>IF       7644>>IF       7644>>IF       7644>>IF       7644>>IF       7644>>IF
      7644>>IF       7644>>IF       7653>>CALL     7660>>CALL     7662>>CALL
LDX
      7341**DCL      7520<<DOINDEX  7521>>ASSIGN   7640<<DOINDEX  7641>>ASSIGN
LNGS
      7498**DCL      7629<>CALL
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:295  
MSGBUF
      7343**DCL      7546<<CALLBLT  7550<<ASSIGN   7552--ASSIGN   7639<<CALLBLT  7656--ASSIGN
MSIZ
      7338**DCL      7339--REDEF    7344--IMP-SIZ  7529<<ASSIGN   7530<>CALL     7538<<ASSIGN   7546>>CALLBLT
      7550>>ASSIGN   7553>>ASSIGN   7638<<ASSIGN   7639>>CALLBLT
N$DCT$$
       481**DCL       481--IMP-PTR  7521>>ASSIGN   7641>>ASSIGN
NFEP
      7573**LABEL    7569--CALLALT  7577--CALLALT  7601--CALLALT  7604--GOTO
NK$LDCT
      6921**DCL      7556<>CALL     7660<>CALL
NK$LDCT.DDT$
      6923**DCL      6923--REDEF
NK$LDCT.DEVNM
      6923**DCL      7531--CALL
NK$LDCT.DFLG.NOSND
      6927**DCL      7644>>IF
NK$LDCT.DFLG.OLDSC
      6926**DCL      7522>>IF       7644>>IF
NK$LDCT.DFLG.OUTPUT
      6925**DCL      7644>>IF
NK$LDCT.IOQ$
      6922**DCL      6923--REDEF
NK$LDCT.LDCTX
      6924**DCL      6924--REDEF
NK$LDCT.LKFLG.ABORTED
      6936**DCL      6937--REDEF
NK$LDCT.LKFLG.ACTIVE
      6940**DCL      7522>>IF
NK$LDCT.LOCK
      6949**DCL      7540<>CALL     7558<>CALL     7563<>CALL     7653<>CALL     7662<>CALL
NK$LDCT.RESCOD
      6929**DCL      7522>>IF       7644>>IF
NK$LDCT.RLCID.LDCTX
      6946**DCL      6946--REDEF
NK$LDCT.RLCID.NODE
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:296  
      6945**DCL      7644>>IF       7644>>IF
NK$LDCT.STA$
      6942**DCL      6943--REDEF
NK$LDCT.SYMB$
      6921**DCL      6921--REDEF    6921--REDEF    6922--REDEF
NK$LDCT.TERMID.TTYP
      6949**DCL      7644>>IF       7644>>IF
NK$LDCT.USER
      6931**DCL      7522>>IF
NK$LDCT$
       481**DCL      7521>>ASSIGN   7641>>ASSIGN
NK_MXLOCAL
       481**DCL      7520>>DOINDEX  7640>>DOINDEX
NK_MXTOTAL
       481**DCL      7520>>DOINDEX  7640>>DOINDEX
NOSND
      7603**LABEL    7560--GOTO
NTTS
      7533**LABEL    7530--CALLALT
OCI$MK_WR
      7505**DCL-ENT  7531--CALL     7582--CALL     7629--CALL     7684--CALL     7705--CALL     7708--CALL
OCZ$SID_UN
      7503**DCL-ENT  7514--CALL
RET
      7629**LABEL    7514--CALLALT
ROUTE$
      7496**DCL      7442--IMP-PTR  7689<<ASSIGN   7691>>ASSIGN   7692>>IF       7694>>ASSIGN   7695>>ASSIGN
      7701>>ASSIGN   7702>>ASSIGN   7703>>IF
RTELNGS
      7500**DCL      7705<>CALL
SIZ
      7508**DCL      7545<<ASSIGN   7549<<ASSIGN   7553>>ASSIGN
SIZE
      7302**DCL         8--PROC     7636--ENTRY    7638>>ASSIGN   7657>>ASSIGN
S_CUN
      7509**DCL      7543>>IF
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:297  
S_RWPARM
      7007**DCL      7542<<ASSIGN   7556<>CALL     7655<<ASSIGN   7660<>CALL
S_RWPARM.BLKREC
      7033**DCL      7058--REDEF
S_RWPARM.BLKREC.BLKU#
      7034**DCL      7036--REDEF
S_RWPARM.BLKREC.RECU#
      7046**DCL      7048--REDEF
S_RWPARM.DVE.DVBYTE.VFC
      7073**DCL      7074--REDEF    7554<<ASSIGN   7658<<ASSIGN
S_RWPARM.DVE.EOMCHAR
      7081**DCL      7085--REDEF
S_RWPARM.DVE.VFC
      7085**DCL      7555<<ASSIGN   7659<<ASSIGN
S_RWPARM.ERR
      7145**DCL      7150--REDEF
S_RWPARM.FC
      7109**DCL      7110--REDEF
S_RWPARM.FLDID
      7291**DCL      7292--REDEF
S_RWPARM.FPT$
      7172**DCL      7179--REDEF
S_RWPARM.KEYTYPE
      7298**DCL      7299--REDEF
S_RWPARM.MSG$
      7008**DCL      7014--REDEF    7552<<ASSIGN   7656<<ASSIGN
S_RWPARM.MSGID
      7120**DCL      7125--REDEF
S_RWPARM.MSGIDXT
      7133**DCL      7137--REDEF
S_RWPARM.MSGSZ
      7015**DCL      7553<<ASSIGN   7657<<ASSIGN
S_RWPARM.ORG
      7269**DCL      7270--REDEF
S_RWPARM.THDRSZ
      7213**DCL      7217--REDEF
PL6.E3A0      #004=KIP$KEYIN File=KIP$PMME.:E05TSI                               WED 07/30/97 00:38 Page:298  
S_RWPARM.VDOFLGS
      7271**DCL      7282--REDEF
UNUM
      7339**DCL      7514<>CALL     7515>>IF       7516>>IF       7522>>IF
VCHR
      7344**DCL      7639>>CALLBLT
VGHNM.CADDR
      7356**DCL      7531<>CALL
