VERSION E05

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:1    
        1        1        /*M* FLE$ESTMOD Performs ESTABLISH,MODIFY,ADD,REMOVE functions */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*  NAME: FLE$ESTMOD
        8        8              PURPOSE: Process ESTABLISH,MODIFY,ADD,REMOVE  command
        9        9                       and perform other ARCHIVE function.
       10       10                       :ARCHIVE.$$EFT file contains two records. First
       11       11                       record is one word which keeps the size of next
       12       12                       record. Second record contains all ARCHIVE system
       13       13                       information.
       14       14        ***/
       15       15        FLE$ESTMOD: PROC (COMMAND) ;
       16       16    1   DCL COMMAND UBIN;
       17       17        /***/
       18       18        /** Includes **/
       19       19        /***/
       20       20        %INCLUDE CP_6;
       21     5579        %INCLUDE CP_6_SUBS;
       22     6119        %INCLUDE B_ERRORS_C;
       23     7246        %INCLUDE XU_MACRO_C;
       24    10352        %INCLUDE XU_SUBS_C;
       25    10444        %INCLUDE FLI_DATA_R;
       26    11858        %INCLUDE FLN_DATA_R;
       27    12595        %INCLUDE FM$FIT;
       28    12816        %INCLUDE FLE_DATA_R;
       29    18767        %INCLUDE FLS_DATA_R;
       30    20567        /***/
       31    20568        /** External procedures  **/
       32    20569        /***/
       33    20570    1   DCL FLP$WR_FILE_INFO ENTRY(9) ALTRET;
       34    20571    1   DCL FLI$RPT_ERR ENTRY(5);
       35    20572    1   DCL FLI$ALLOC ENTRY(2) ;
       36    20573    1   DCL FLI$ALLOC_BUF ENTRY(2);
       37    20574    1   DCL FLI$BUILD_$$EFT ENTRY(1) ALTRET;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:2    
       38    20575    1   DCL FLI$CNVRT_ARCHIVE ENTRY(2);
       39    20576        /***/
       40    20577        /*** MACROS  ***/
       41    20578        /***/
       42    20579        %FPT_WRITE(FPTN = WRITE_ARCHIVE_REC,
       43    20580                   DCB = M$ARCHIVE,
       44    20581                   STCLASS = STATIC);
       45    20612
       46    20613        %FPT_CLOSE (FPTN = CLOSE_ARCHIVE );
       47    20655
       48    20656        %FPT_OPEN(FPTN = OPEN_ARCHIVE_FILE);
       49    20765
       50    20766        %FPT_READ(FPTN=READ_ARCHIVE_FILE);
       51    20805        %VLP_SN(STCLASS = BASED);
       52    20818        %B$TCB(STCLASS = "BASED(B$TCB$)");
       53    20821        %B$ALT;
       54    20829        %SNLISTINFO(STCLASS = "BASED(LAST_SNLISTINFO$)");
       55    20832        %B$EXCFR;
       56    20850
       57    20851        %VLP_ERRCODE (FPTN = ERRCODE);
       58    20896
       59    20897        %VLP_SN (FPTN = DPSN,
       60    20898                 N = 1,
       61    20899                 STCLASS = STATIC);
       62    20912
       63    20913    1   DCL BREAK_COUNT SBIN SYMREF;
       64    20914    1   DCL B_VERSION CHAR(1) SYMREF;
       65    20915    1   DCL 1 B$VERSION BASED,
       66    20916    1          2 L# UBIN BYTE CALIGNED,
       67    20917    1          2 NAME# CHAR(B$VERSION.L#) CALIGNED;
       68    20918    1   DCL BLANK(0:0) BASED CHAR(1);
       69    20919    1   DCL DPSIZE UBIN STATIC;
       70    20920    1   DCL I UBIN STATIC;
       71    20921    1   DCL J UBIN STATIC;
       72    20922    1   DCL K UBIN STATIC;
       73    20923    1   DCL TEMP SBIN STATIC;
       74    20924    1   DCL SIZE UBIN STATIC;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:3    
       75    20925    1   DCL CODE SBIN STATIC;
       76    20926    1   DCL AVAIL$ PTR STATIC;
       77    20927    1   DCL DCB# UBIN STATIC;
       78    20928    1   DCL SNSIZE UBIN STATIC;
       79    20929    1   DCL ARCHIVE_REC_SIZE UBIN STATIC SYMDEF;
       80    20930    1   DCL ARCHIVE_TAIL UBIN BASED;
       81    20931    1   DCL START$ PTR STATIC;
       82    20932    1   DCL BUF$ PTR STATIC;
       83    20933    1   DCL TPTR$ PTR STATIC;
       84    20934         %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:4    
       85    20935        /***
       86    20936         *** Calling all routines for ARCHIVE system or ARCHIVE running.
       87    20937         ***/
       88    20938    1           DCB# = DCBNUM(M$ARCHIVE);
       89    20939    1           OPEN_ARCHIVE_FILE = CON_OPEN_ARCHIVE_FILE;
       90    20940    1           OPEN_ARCHIVE_FILE.V_ = VECTOR(OPEN_ARCHIVE_FILE.V);
       91    20941    1           OPEN_ARCHIVE_FILE.SN_ = VECTOR ( DPSN );
       92    20942    1           READ_ARCHIVE_FILE = CON_READ_ARCHIVE_FILE;
       93    20943    1           READ_ARCHIVE_FILE.V_ = VECTOR ( READ_ARCHIVE_FILE.V );
       94    20944    1           CLOSE_ARCHIVE = CON_CLOSE_ARCHIVE;
       95    20945    1           CLOSE_ARCHIVE.V_ = VECTOR ( CLOSE_ARCHIVE.V );
       96    20946    1           OPEN_ARCHIVE_FILE.V.DELETE# = '0'B;
       97    20947    2           DO CASE(COMMAND);
       98    20948    2                CASE(%ESTABLISH);
       99    20949    2                   CALL FLE_ESTABLISH;
      100    20950    2                CASE(%MODIFY);
      101    20951    2                   CALL FLE_MODIFY;
      102    20952    2                 CASE(%ADD);
      103    20953    2                    CALL FLE_ADD;
      104    20954    2                 CASE(%REMOVE);
      105    20955    2                    CALL FLE_REMOVE;
      106    20956    2                 CASE(%ARCHIVE_CMD,%PURGE);
      107    20957    2                    CALL FLE_GET_ARCHIVE_SNLIST;
      108    20958    2                 CASE(%ARCHIVE);
      109    20959    2                    CALL FLE_UPDATE_ARCHIVE;
      110    20960    2                 CASE(%ARCHIVED);
      111    20961    2                    CALL FLE_FINISH_ARCHIVE;
      112    20962    2            END;
      113    20963    1           RETURN;
      114    20964        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:5    
      115    20965    1   FLE_ESTABLISH:PROC;
      116    20966        /*F*  NAME: FLE_ESTABLISH
      117    20967              PURPOSE:  Perform ESTABLISH command for the archive system.
      118    20968                        This command creates the file :ARCHIVE.$$EFT and
      119    20969                        associates a set of packsets with the tapeset or optical
      120    20970                        diskset used during ARCHIVE runs.
      121    20971        ***/
      122    20972
      123    20973
      124    20974        /***
      125    20975         ***  Allocate memory  and fill out all information for ARCHIVE_LIST
      126    20976         ***  record which will be written into :ARCHIVE.$$EFT.
      127    20977         ***/
      128    20978
      129    20979    2           IF NBR_SNLISTS > 1
      130    20980    2            THEN
      131    20981    2              AVAIL$ = SNLISTINFO.PREVINFO$->SNLISTINFO.SNLIST$;
      132    20982    2            ELSE
      133    20983    2              AVAIL$ = SNLISTINFO.SNLIST$;
      134    20984    2           DPSIZE = (LENGTHC(DPLIST.NUM#) + DPLIST.NUM# * LENGTHC(DPLIST.SN#(0))+ 3)/4;
      135    20985    2           SNSIZE =  (LENGTHC(AVAIL$->VLP_SN.NUM#)+ AVAIL$->VLP_SN.NUM#*LENGTHC(VLP_SN.
             20985                    SN#(0))+3)/4;
      136    20986    2           SIZE = DPSIZE + (NBR_SNLISTS * SNSIZE) + SIZEW(ARCHIVE_LIST);
      137    20987
      138    20988    2           CALL FLI$ALLOC(SIZE,START$);
      139    20989    2           START$->ARCHIVE_LIST.OFFSET.DPLIST = SIZEW(ARCHIVE_LIST);
      140    20990    2           START$->ARCHIVE_LIST.OFFSET.SNLIST = SIZEW(ARCHIVE_LIST) + DPSIZE;
      141    20991    2           IF NBR_SNLISTS > 1
      142    20992    2             THEN
      143    20993    2               START$->ARCHIVE_LIST.OFFSET.SNLIST2 = START$->ARCHIVE_LIST.OFFSET.SNLIST
             20993                        + SNSIZE;
      144    20994    2             ELSE
      145    20995    2               START$->ARCHIVE_LIST.OFFSET.SNLIST2 = 0;
      146    20996    2           START$->ARCHIVE_LIST.VOLUME = 0;    /* Unused */
      147    20997    2           START$->ARCHIVE_LIST.VERSION.SIZE = ADDR(B_VERSION)->B$VERSION.L#;
      148    20998    2           START$->ARCHIVE_LIST.VERSION.TEXT = SUBSTR(ADDR(B_VERSION)->B$VERSION.NAME#,
             20998                    0,ADDR(B_VERSION)->B$VERSION.L#);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:6    
      149    20999    2           START$->ARCHIVE_LIST.VERSION.FLAG = BITBIN('777'O); /* Post-D00 */
      150    21000    2           START$->ARCHIVE_LIST.OPTION.DEN = TAPE_OPEN.V.DENSITY#;
      151    21001    2           START$->ARCHIVE_LIST.OPTION.VOLA = TAPE_OPEN.V.VOLACCESS#;
      152    21002    2           START$->ARCHIVE_LIST.OPTION.EXP = TAPE_OPEN.V.EXPIRE#;
      153    21003    2           START$->ARCHIVE_LIST.OPTION.BLOCK = TAPE_OPEN.V.BLKL#;
      154    21004    2           START$->ARCHIVE_LIST.OPTION.CHECK = TAPE_OPTION.CHECK;
      155    21005    2           START$->ARCHIVE_LIST.OPTION.IOERRORC = TAPE_OPTION.IOERRORC;
      156    21006    2           START$->ARCHIVE_LIST.XTEND = %NO#;
      157    21007    2           IF TAPE_OPEN.V.RES# = 'OD'
      158    21008    2             THEN START$->ARCHIVE_LIST.OD = %YES#;       /* Optical disk archive */
      159    21009    2             ELSE START$->ARCHIVE_LIST.OD = %NO#;                /* Tape archive */
      160    21010
      161    21011    2           ARCHIVE_REC_SIZE = SIZE;
      162    21012    2           START$->ARCHIVE_LIST.SIZE = SIZE;
      163    21013
      164    21014    2           AVAIL$ = PINCRW(START$,SIZEW(ARCHIVE_LIST));
      165    21015    3           DO I = 0 TO DPLIST.NUM#-1;
      166    21016    3              AVAIL$->VLP_SN.SN#(I) = DPLIST.SN#(I);
      167    21017    3              END;
      168    21018    2           AVAIL$->VLP_SN.NUM# = DPLIST.NUM#;
      169    21019
      170    21020    2           AVAIL$ = PINCRW(AVAIL$,DPSIZE);
      171    21021    2           IF NBR_SNLISTS > 1
      172    21022    2             THEN
      173    21023    2               TPTR$ = SNLISTINFO.PREVINFO$->SNLISTINFO.SNLIST$;
      174    21024    2             ELSE
      175    21025    2               TPTR$ = SNLISTINFO.SNLIST$;
      176    21026    3           DO I = 0 TO TPTR$->VLP_SN.NUM#-1;
      177    21027    3              AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);
      178    21028    3              END;
      179    21029    2           AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;
      180    21030
      181    21031    2           IF NBR_SNLISTS > 1
      182    21032    2             THEN
      183    21033    3             DO;
      184    21034    3               AVAIL$ = PINCRW(AVAIL$,SNSIZE);
      185    21035    4               DO I = 0 TO SNLISTINFO.SNLIST$->VLP_SN.NUM#-1;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:7    
      186    21036    4                  AVAIL$->VLP_SN.SN#(I) = SNLISTINFO.SNLIST$->VLP_SN.SN#(I);
      187    21037    4                  END;
      188    21038    3               AVAIL$->VLP_SN.NUM# = SNLISTINFO.SNLIST$->VLP_SN.NUM#;
      189    21039    3             END;
      190    21040    2           AVAIL$ = PINCRW(AVAIL$,SNSIZE);
      191    21041
      192    21042        /***
      193    21043         ***  copy of that file also maintained on each member packset.
      194    21044         ***  During creating the :ARCHIVE.$$EFT, if there is any problem
      195    21045         ***  in master packset, the error message will be issued and
      196    21046         ***  return to command level.
      197    21047         ***/
      198    21048
      199    21049    3           DO I = 0 TO DPLIST.NUM#-1;
      200    21050
      201    21051    3              DPSN.SN#(0) = DPLIST.SN#(I);
      202    21052    3              CALL FLI$BUILD_$$EFT ( DPLIST.SN#(I) )
      203    21053    3              WHENALTRETURN
      204    21054    4              DO;
      205    21055    4                 ERRCODE = B$TCB.ALT$->B$EXCFR.ERR;
      206    21056    4                 IF ERRCODE.SEV = 0
      207    21057    4                 THEN;
      208    21058    4                 ELSE
      209    21059    5                 DO;
      210    21060    5                    GOTO ERR1;
      211    21061    5                    END;
      212    21062    4                 END;
      213    21063
      214    21064    3              OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;
      215    21065    3              CALL M$OPEN(OPEN_ARCHIVE_FILE)
      216    21066    3              WHENRETURN
      217    21067    4              DO;
      218    21068
      219    21069    4                 READ_ARCHIVE_FILE.BUF_ = VECTOR(I);
      220    21070    4                 CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ERR);
      221    21071    4                 CALL FLI$ALLOC(I,AVAIL$);
      222    21072    4                 READ_ARCHIVE_FILE.BUF_.BUF$ = AVAIL$;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:8    
      223    21073    4                 READ_ARCHIVE_FILE.BUF_.BOUND = I * 4 - 1;
      224    21074    4                 CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ERR);
      225    21075        /***
      226    21076         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      227    21077         ***/
      228    21078    4                 IF AVAIL$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)
      229    21079    4                 THEN
      230    21080    5                 DO;
      231    21081    5                    CALL FLI$CNVRT_ARCHIVE(AVAIL$,TPTR$);
      232    21082    5                    AVAIL$ = TPTR$;
      233    21083    5                    END;
      234    21084    4                 AVAIL$ = PINCRW(AVAIL$,SIZEW(ARCHIVE_LIST));
      235    21085
      236    21086    4                 IF DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(0)
      237    21087    4                 THEN
      238    21088    4                    CALL FLI$RPT_ERR(E_ALREADY_ESTABLISH,DCB#);
      239    21089    4                 ELSE
      240    21090    4                    CALL FLI$RPT_ERR(E_MEMBER_OF_ARCHIVE,DCB#);
      241    21091    4                 CALL M$CLOSE(CLOSE_ARCHIVE)
      242    21092    5                  WHENALTRETURN DO;
      243    21093    5                    END;
      244    21094    4                 IF I = 0 THEN RETURN;
      245    21095
      246    21096    4                 END;
      247    21097    3              WHENALTRETURN
      248    21098    4              DO;
      249    21099
      250    21100    4                 IF B$TCB.ALT$->B$EXCFR.ERR.ERR# ~= %E$NOFILE
      251    21101    4                 THEN
      252    21102    4                    GOTO ERR;
      253    21103
      254    21104    4                 OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;
      255    21105    4                 OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;
      256    21106    4                 OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;
      257    21107    4                 CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ERR);
      258    21108
      259    21109    4                 WRITE_ARCHIVE_REC.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:9    
      260    21110    4                 CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
      261    21111
      262    21112    4                 WRITE_ARCHIVE_REC.BUF_.BUF$ = START$;
      263    21113    4                 WRITE_ARCHIVE_REC.BUF_.BOUND = SIZE * 4 - 1;
      264    21114    4                 CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
      265    21115    4                  CALL M$CLOSE(CLOSE_ARCHIVE);
      266    21116
      267    21117    4              END;
      268    21118    4              DO WHILE('0'B);
      269    21119    4   ERR:          CALL FLI$RPT_ERR;
      270    21120    4   ERR1:         CALL M$CLOSE(CLOSE_ARCHIVE)
      271    21121    5                 WHENALTRETURN DO;
      272    21122    5                   END;
      273    21123    4                 IF I = 0 THEN RETURN;
      274    21124    4               END;
      275    21125    3              END; /* DO I = 0 TO DPLIST.NUM#            */
      276    21126    2           RETURN;
      277    21127    2   END FLE_ESTABLISH;
      278    21128        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:10   
      279    21129    1   FLE_MODIFY:PROC;
      280    21130        /*F*  NAME:  FLE_MODIFY
      281    21131              PURPOSE: Perform MODIFY command for the archive system.
      282    21132                       This routine updates the :ARCHIVE.$$EFT and thereby
      283    21133                       instructs EFT to start a new tapeset with changed
      284    21134                       attributes at the next ARCHIVE run.
      285    21135        ***/
      286    21136
      287    21137        /***
      288    21138         ***  Open the :ARCHIVE.$$EFT to get the ARCHIVE information.
      289    21139         ***/
      290    21140
      291    21141    2           DPSN.SN#(0) = DPLIST.SN#(0);
      292    21142    2           OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;
      293    21143    2           CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT);
      294    21144
      295    21145    2           READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
      296    21146    2           CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT);
      297    21147
      298    21148    2           CALL FLI$ALLOC(ARCHIVE_REC_SIZE,START$);
      299    21149    2           READ_ARCHIVE_FILE.BUF_.BUF$ = START$;
      300    21150    2           READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;
      301    21151    2           CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT);
      302    21152        /***
      303    21153         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      304    21154         ***/
      305    21155    2           IF START$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)
      306    21156    2           THEN
      307    21157    3           DO;
      308    21158    3              CALL FLI$CNVRT_ARCHIVE(START$,TPTR$);
      309    21159    3              START$ = TPTR$;
      310    21160    3              ARCHIVE_REC_SIZE = START$->ARCHIVE_LIST.SIZE;
      311    21161    3              END;
      312    21162    2           AVAIL$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.DPLIST);
      313    21163
      314    21164        /***
      315    21165         *** Check if the type of archive file being modified(tape or optical disk) is
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:11   
      316    21166         *** the same as specified on the command. Output error if otherwise.
      317    21167         *** Do not permit as the attributes for tapes may not apply to optical disk.
      318    21168         ***/
      319    21169    2           IF NBR_SNLISTS > 0      /* Any serial numbers spec'd on this command? */
      320    21170    2           THEN
      321    21171    3           DO;
      322    21172    3              IF (TAPE_OPEN.V.RES# = 'LT' AND START$->ARCHIVE_LIST.OD)
      323    21173    3              OR (TAPE_OPEN.V.RES# = 'OD' AND NOT START$->ARCHIVE_LIST.OD)
      324    21174    3                THEN
      325    21175    4                DO;
      326    21176    4                  CALL FLI$RPT_ERR(E_TYPE_ARCHIVE_SET);
      327    21177    4                  CALL M$CLOSE(CLOSE_ARCHIVE) ALTRET(ALT);
      328    21178    4                  RETURN;
      329    21179    4                END;
      330    21180    3           END;
      331    21181
      332    21182        /***
      333    21183         *** Check if it is the master packset. If yes, then updates
      334    21184         *** :ARCHIVE.$$EFT. If not, the error message will be issued
      335    21185         *** and return to command level.
      336    21186         ***/
      337    21187
      338    21188    2           IF AVAIL$->VLP_SN.SN#(0) = DPLIST.SN#(0)
      339    21189    2           THEN
      340    21190    3           DO;
      341    21191
      342    21192        /***
      343    21193         ***  Updates the changed attibutes.
      344    21194         ***/
      345    21195
      346    21196    3              IF TAPE_OPTION.DENSITY
      347    21197    3                THEN
      348    21198    4                  DO;
      349    21199    4                     IF (NBR_SNLISTS = 0
      350    21200    4                       AND START$->ARCHIVE_LIST.OD)
      351    21201    4                       THEN
      352    21202    5                       DO;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:12   
      353    21203    5                         CALL FLI$RPT_ERR(E_CANT_SPECIFY_DENSITY);
      354    21204    5                         CALL M$CLOSE(CLOSE_ARCHIVE)  ALTRET(ALT);
      355    21205    5                         RETURN;
      356    21206    5                       END;
      357    21207    4                     START$->ARCHIVE_LIST.OPTION.DEN = TAPE_OPEN.V.DENSITY#;
      358    21208    4                  END;
      359    21209    3              IF TAPE_OPTION.VOLACCESS
      360    21210    3                THEN
      361    21211    3                 START$->ARCHIVE_LIST.OPTION.VOLA = TAPE_OPEN.V.VOLACCESS#;
      362    21212    3              IF TAPE_OPTION.EXPIRE
      363    21213    3                THEN
      364    21214    4                  DO;
      365    21215    4                     IF (NBR_SNLISTS = 0
      366    21216    4                       AND START$->ARCHIVE_LIST.OD)
      367    21217    4                       THEN
      368    21218    5                       DO;
      369    21219    5                         CALL FLI$RPT_ERR(E_CANT_SPECIFY_EXPIRE);
      370    21220    5                         CALL M$CLOSE(CLOSE_ARCHIVE)  ALTRET(ALT);
      371    21221    5                         RETURN;
      372    21222    5                       END;
      373    21223    4                     START$->ARCHIVE_LIST.OPTION.DEN = TAPE_OPEN.V.DENSITY#;
      374    21224    4                  END;
      375    21225    3              IF TAPE_OPTION.BLOCK
      376    21226    3                THEN
      377    21227    3                  START$->ARCHIVE_LIST.OPTION.BLOCK = TAPE_OPEN.V.BLKL#;
      378    21228    3              IF TAPE_OPTION.CHECK_SPECD
      379    21229    3                THEN
      380    21230    3                  START$->ARCHIVE_LIST.OPTION.CHECK = TAPE_OPTION.CHECK;
      381    21231
      382    21232    3              IF TAPE_OPTION.IOERRORC_SPECD
      383    21233    3               THEN
      384    21234    3                 START$->ARCHIVE_LIST.OPTION.IOERRORC = TAPE_OPTION.IOERRORC;
      385    21235
      386    21236    3              IF NBR_SNLISTS = 0
      387    21237    3              THEN;
      388    21238    3              ELSE
      389    21239    4              DO;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:13   
      390    21240        /***
      391    21241         ***   Check that the same number of tapesets was specified as on the
      392    21242         ***   original ESTABLISH command. This is enforced to keep both tapesets
      393    21243         ***   in sync.
      394    21244         ***/
      395    21245    4                IF (START$->ARCHIVE_LIST.OFFSET.SNLIST2 ~= 0
      396    21246    4                  AND NBR_SNLISTS = 1)
      397    21247    4                OR (START$->ARCHIVE_LIST.OFFSET.SNLIST2 = 0
      398    21248    4                  AND NBR_SNLISTS = 2)
      399    21249    4                  THEN
      400    21250    5                  DO;
      401    21251    5                    CALL FLI$RPT_ERR(E_NUM_ARCHIVE_SETS);
      402    21252    5                    CALL M$CLOSE(CLOSE_ARCHIVE)  ALTRET(ALT);
      403    21253    5                    RETURN;
      404    21254    5                  END;
      405    21255
      406    21256        /***
      407    21257         ***   Make sure to allocate enough memory to update the
      408    21258         ***   :ARCHIVE file.
      409    21259         ***/
      410    21260
      411    21261    4                 AVAIL$ = SNLISTINFO.SNLIST$;
      412    21262    4                 SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM#*LENGTHC(
             21262                          VLP_SN.SN#(0))+3)/4;
      413    21263    4                 DPSIZE = START$->ARCHIVE_LIST.OFFSET.SNLIST - START$->ARCHIVE_LIST.
             21263                          OFFSET.DPLIST;
      414    21264    4                 SIZE = DPSIZE + (NBR_SNLISTS * SNSIZE) + SIZEW(ARCHIVE_LIST);
      415    21265    4                 CALL FLI$ALLOC(SIZE,BUF$);
      416    21266
      417    21267        /***
      418    21268         ***   Move ARCHIVE_LIST from old record to new buffer.
      419    21269         ***/
      420    21270
      421    21271    4                  BUF$->ARCHIVE_LIST = START$->ARCHIVE_LIST;
      422    21272    4                  AVAIL$ = PINCRW(BUF$,SIZEW(ARCHIVE_LIST));
      423    21273    4                  TPTR$ = PINCRW(START$,SIZEW(ARCHIVE_LIST));
      424    21274
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:14   
      425    21275        /***
      426    21276         ***   Move disk packsets list to new buffer.
      427    21277         ***/
      428    21278
      429    21279    5                  DO I = 0 TO TPTR$->VLP_SN.NUM# - 1;
      430    21280    5                    AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);
      431    21281    5                  END;
      432    21282    4                  AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;
      433    21283    4                  AVAIL$ = PINCRW(BUF$,BUF$->ARCHIVE_LIST.OFFSET.SNLIST);
      434    21284
      435    21285        /***
      436    21286         ***  Move new tapeset to new buffer.
      437    21287         ***/
      438    21288
      439    21289    4                  IF NBR_SNLISTS > 1
      440    21290    4                    THEN
      441    21291    4                      TPTR$ = SNLISTINFO.PREVINFO$->SNLISTINFO.SNLIST$;
      442    21292    4                    ELSE
      443    21293    4                      TPTR$ = SNLISTINFO.SNLIST$;
      444    21294    5                 DO I = 0 TO SNLISTINFO.SNLIST$->VLP_SN.NUM#-1;
      445    21295    5                   AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);
      446    21296    5                    END;
      447    21297    4                 AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;
      448    21298
      449    21299    4                 IF NBR_SNLISTS > 1
      450    21300    4                   THEN
      451    21301    5                   DO;
      452    21302    5                     AVAIL$ = PINCRW(AVAIL$,SNSIZE);
      453    21303    6                     DO I = 0 TO SNLISTINFO.SNLIST$->VLP_SN.NUM#-1;
      454    21304    6                       AVAIL$->VLP_SN.SN#(I) = SNLISTINFO.SNLIST$->VLP_SN.SN#(I);
      455    21305    6                       END;
      456    21306    5                     AVAIL$->VLP_SN.NUM# = SNLISTINFO.SNLIST$->VLP_SN.NUM#;
      457    21307    5                   END;
      458    21308    4                  IF NBR_SNLISTS > 1
      459    21309    4                    THEN
      460    21310    4                    BUF$->ARCHIVE_LIST.OFFSET.SNLIST2 = BUF$->ARCHIVE_LIST.OFFSET.
             21310                             SNLIST+SNSIZE;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:15   
      461    21311    4                    ELSE
      462    21312    4                    BUF$->ARCHIVE_LIST.OFFSET.SNLIST2 = 0;
      463    21313    4                  BUF$->ARCHIVE_LIST.XTEND = %NO#;
      464    21314    4                  BUF$->ARCHIVE_LIST.SIZE = SIZE;
      465    21315    4                  ARCHIVE_REC_SIZE = SIZE;
      466    21316    4                 END;
      467    21317
      468    21318        /***
      469    21319         *** Write the updated record back to :ARCHIVE.$$EFT for both
      470    21320         *** master packset and member packsets.
      471    21321         ***/
      472    21322
      473    21323    3                  CALL M$CLOSE(CLOSE_ARCHIVE) ALTRET(ALT);
      474    21324    3                  AVAIL$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.DPLIST);
      475    21325    3                    OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;
      476    21326    3                    OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;
      477    21327    3                    OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;
      478    21328    4                  DO I = 0 TO AVAIL$->VLP_SN.NUM# - 1;
      479    21329    4                    DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(I);
      480    21330    4                    CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ERR);
      481    21331    4                    WRITE_ARCHIVE_REC.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
      482    21332    4                    CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
      483    21333    4                    IF NBR_SNLISTS = 0
      484    21334    4                      THEN
      485    21335    4                        WRITE_ARCHIVE_REC.BUF_.BUF$ = START$;
      486    21336    4                      ELSE
      487    21337    4                        WRITE_ARCHIVE_REC.BUF_.BUF$ = BUF$;
      488    21338    4                    WRITE_ARCHIVE_REC.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;
      489    21339    4                    CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
      490    21340    4                    CALL M$CLOSE(CLOSE_ARCHIVE) ALTRET(ERR);
      491    21341    5                    DO WHILE('0'B);
      492    21342    5   ERR:
      493    21343    5                      CALL FLI$RPT_ERR;
      494    21344    5                      CALL M$CLOSE(CLOSE_ARCHIVE)
      495    21345    6                      WHENALTRETURN DO;
      496    21346    6                        END;
      497    21347    5                      IF I = 0 THEN RETURN;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:16   
      498    21348    5                    END;
      499    21349    4                 END; /* I = 0 TO AVAIL$->VLP_SN.NUM# - 1 */
      500    21350    3                END;
      501    21351    2           ELSE
      502    21352    3           DO;
      503    21353    3              CALL FLI$RPT_ERR(E_NOT_ARCHIVE_MASTER,DCB#);
      504    21354    3              CALL M$CLOSE(CLOSE_ARCHIVE) ALTRET(ALT);
      505    21355    3           END;
      506    21356    3           DO WHILE('0'B);
      507    21357    3   ALT:
      508    21358    3              CALL FLI$RPT_ERR;
      509    21359    3              CALL M$CLOSE(CLOSE_ARCHIVE);
      510    21360    3              END;
      511    21361    2           RETURN;
      512    21362    2   END FLE_MODIFY;
      513    21363        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:17   
      514    21364    1   FLE_ADD:PROC;
      515    21365        /*F*  NAME:   FLE_ADD
      516    21366              PURPOSE:  Perform ADD command for the archive system.
      517    21367                        Adds a new packset to an existing group of packsets.
      518    21368        ***/
      519    21369
      520    21370        /***
      521    21371         *** Open the :ARCHIVE file to get the archive information.
      522    21372         ***/
      523    21373
      524    21374    2          DPSN.SN#(0) = DISK_DEST_SN.SN#(0);
      525    21375    2          OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;
      526    21376    2          CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT1);
      527    21377    2          READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
      528    21378    2          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT1);
      529    21379    2          CALL FLI$ALLOC(ARCHIVE_REC_SIZE,START$);
      530    21380    2          READ_ARCHIVE_FILE.BUF_.BUF$ = START$;
      531    21381    2          READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;
      532    21382    2          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT1);
      533    21383        /***
      534    21384         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      535    21385         ***/
      536    21386    2          IF START$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)
      537    21387    2          THEN
      538    21388    3          DO;
      539    21389    3             CALL FLI$CNVRT_ARCHIVE(START$,TPTR$);
      540    21390    3             START$ = TPTR$;
      541    21391    3             ARCHIVE_REC_SIZE = START$->ARCHIVE_LIST.SIZE;
      542    21392    3             END;
      543    21393    2          AVAIL$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.DPLIST);
      544    21394        /***
      545    21395         *** If it is the master packset, then updates the :ARCHIVE file
      546    21396         *** as new packset is added. It also creates the :ARCHIVE file
      547    21397         *** on the new packset.
      548    21398         ***/
      549    21399
      550    21400    2          IF AVAIL$->VLP_SN.SN#(0) = DISK_DEST_SN.SN#(0)
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:18   
      551    21401    2            THEN
      552    21402    3            DO;
      553    21403    3                J = 0;
      554    21404    4                DO I = 0 TO AVAIL$->VLP_SN.NUM# - 1;
      555    21405    4                  IF DPLIST.SN#(0) = AVAIL$->VLP_SN.SN#(I)
      556    21406    4                    THEN
      557    21407    5                    DO;
      558    21408    5                      J = 1;
      559    21409    5                      EXIT;
      560    21410    5                    END;
      561    21411    4                END;
      562    21412    3                IF J = 1
      563    21413    3                  THEN
      564    21414    4                  DO;
      565    21415    4                    CALL FLI$RPT_ERR(E_MEMBER_OF_ARCHIVE,DCB#);
      566    21416    4                    CALL M$CLOSE(CLOSE_ARCHIVE);
      567    21417    4                    RETURN;
      568    21418    4                  END;
      569    21419    3                  ELSE
      570    21420    4                  DO;
      571    21421    4                    CALL M$CLOSE(CLOSE_ARCHIVE);
      572    21422
      573    21423    4                    DPSN.SN#(0) = DPLIST.SN#(0);
      574    21424
      575    21425    4                    CALL FLI$BUILD_$$EFT ( DPLIST.SN#(0) )
      576    21426    4                    WHENALTRETURN
      577    21427    5                    DO;
      578    21428    5                      IF B$TCB.ALT$->B$EXCFR.ERR.SEV = 0
      579    21429    5                        THEN;
      580    21430    5                        ELSE
      581    21431    6                        DO;
      582    21432    6                          CALL FLI$RPT_ERR;
      583    21433    6                          CALL M$CLOSE(CLOSE_ARCHIVE);
      584    21434    6                          RETURN;
      585    21435    6                        END;
      586    21436    5                    END;
      587    21437
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:19   
      588    21438    4                    OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;
      589    21439    4                    CALL M$OPEN(OPEN_ARCHIVE_FILE)
      590    21440    4                    WHENRETURN
      591    21441    5                    DO;
      592    21442    5                      READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
      593    21443    5                      CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT1);
      594    21444
      595    21445    5                      CALL FLI$ALLOC(ARCHIVE_REC_SIZE,START$);
      596    21446    5                      READ_ARCHIVE_FILE.BUF_.BUF$ = START$;
      597    21447    5                      READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;
      598    21448    5                      CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT1);
      599    21449        /***
      600    21450         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      601    21451         ***/
      602    21452    5                      IF START$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)
      603    21453    5                      THEN
      604    21454    6                      DO;
      605    21455    6                         CALL FLI$CNVRT_ARCHIVE(START$,TPTR$);
      606    21456    6                         START$ = TPTR$;
      607    21457    6                         ARCHIVE_REC_SIZE = START$->ARCHIVE_LIST.SIZE;
      608    21458    6                         END;
      609    21459    5                      AVAIL$ = PINCRW(START$,SIZEW(ARCHIVE_LIST));
      610    21460
      611    21461    5                      IF DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(0)
      612    21462    5                        THEN
      613    21463    5                          CALL FLI$RPT_ERR(E_ALREADY_ESTABLISH,DCB#);
      614    21464    5                        ELSE
      615    21465    5                          CALL FLI$RPT_ERR(E_MEMBER_OF_ARCHIVE,DCB#);
      616    21466    5                      CALL M$CLOSE(CLOSE_ARCHIVE);
      617    21467    5                      RETURN;
      618    21468    5                    END;
      619    21469
      620    21470    4                    WHENALTRETURN
      621    21471    5                    DO;
      622    21472    5                      IF B$TCB.ALT$->B$EXCFR.ERR.ERR# ~= %E$NOFILE
      623    21473    5                        THEN  GOTO ALT1;
      624    21474
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:20   
      625    21475        /***
      626    21476         *** What the following codes do are
      627    21477         *** a. Allocate the memory for new buffer.
      628    21478         *** b. move and update the new buffer
      629    21479         *** c. Write the updated record back to the maste packsets
      630    21480         ***    and the member packsets.
      631    21481         ***/
      632    21482
      633    21483    5                      SIZE = ARCHIVE_REC_SIZE + (LENGTHC(VLP_SN.SN#(0))+3)/4;
      634    21484    5                      CALL FLI$ALLOC(SIZE,BUF$);
      635    21485
      636    21486    5                      BUF$->ARCHIVE_LIST = START$->ARCHIVE_LIST;
      637    21487    5                      AVAIL$ = PINCRW(BUF$,BUF$->ARCHIVE_LIST.OFFSET.DPLIST);
      638    21488    5                      TPTR$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.DPLIST);
      639    21489
      640    21490    6                      DO I = 0 TO TPTR$->VLP_SN.NUM# - 1;
      641    21491    6                        AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);
      642    21492    6                      END;
      643    21493    5                      AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM# + 1;
      644    21494    5                      AVAIL$->VLP_SN.SN#(AVAIL$->VLP_SN.NUM#-1) = DPLIST.SN#(0);
      645    21495    5                      DPSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM# *
             21495                               LENGTHC(VLP_SN.SN#(0))+3)/4;
      646    21496
      647    21497    5                      AVAIL$ = PINCRW(AVAIL$,DPSIZE);
      648    21498    5                      BUF$->ARCHIVE_LIST.OFFSET.SNLIST = BUF$->ARCHIVE_LIST.OFFSET.
             21498                               DPLIST + DPSIZE;
      649    21499    5                      TPTR$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.SNLIST);
      650    21500    6                      DO I = 0 TO TPTR$->VLP_SN.NUM#;
      651    21501    6                        AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);
      652    21502    6                      END;
      653    21503    5                      AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;
      654    21504    5                      SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM# *
             21504                               LENGTHC(VLP_SN.SN#(0)) + 3)/4;
      655    21505    5                      AVAIL$ = PINCRW(AVAIL$,SNSIZE);
      656    21506
      657    21507    5                      IF BUF$->ARCHIVE_LIST.OFFSET.SNLIST2 ~= 0
      658    21508    5                        THEN
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:21   
      659    21509    6                        DO;
      660    21510    6                          BUF$->ARCHIVE_LIST.OFFSET.SNLIST2 = BUF$->ARCHIVE_LIST.OFFSET
             21510                                   .SNLIST + SNSIZE;
      661    21511    6                          TPTR$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.SNLIST2);
      662    21512    7                          DO I = 0 TO TPTR$->VLP_SN.NUM#;
      663    21513    7                            AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);
      664    21514    7                          END;
      665    21515    6                          AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;
      666    21516    6                          SNSIZE = SNSIZE * 2;
      667    21517    6                        END;
      668    21518
      669    21519    5                      SIZE = SIZEW(ARCHIVE_LIST) + DPSIZE + SNSIZE;
      670    21520    5                      BUF$->ARCHIVE_LIST.SIZE = SIZE;
      671    21521    5                      AVAIL$ = PINCRW(BUF$,BUF$->ARCHIVE_LIST.OFFSET.DPLIST);
      672    21522    5                      OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;
      673    21523    5                      OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;
      674    21524    5                      OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;
      675    21525    6                      DO I = 0 TO AVAIL$->VLP_SN.NUM#-1;
      676    21526    6                        DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(I);
      677    21527    6                        CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ERR);
      678    21528
      679    21529    6                        WRITE_ARCHIVE_REC.BUF_ = VECTOR(SIZE);
      680    21530    6                        CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
      681    21531
      682    21532    6                        WRITE_ARCHIVE_REC.BUF_.BUF$ = BUF$;
      683    21533    6                        WRITE_ARCHIVE_REC.BUF_.BOUND = SIZE * 4 - 1;
      684    21534    6                        CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
      685    21535
      686    21536    6                        CALL M$CLOSE(CLOSE_ARCHIVE);
      687    21537    7                        DO WHILE('0'B);
      688    21538    7   ERR:
      689    21539    7                          CALL FLI$RPT_ERR;
      690    21540    7                          CALL M$CLOSE(CLOSE_ARCHIVE);
      691    21541    7                          IF I = 0 THEN RETURN;
      692    21542    7                        END;
      693    21543    6                      END; /* I = 0 to AVAIL$->VLP_SN.NUM# */
      694    21544    5                    END;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:22   
      695    21545    4                END;
      696    21546    3            END;
      697    21547    2            ELSE
      698    21548    3            DO;
      699    21549    3                CALL FLI$RPT_ERR(E_NOT_ARCHIVE_MASTER,DCB#);
      700    21550    3                CALL M$CLOSE(CLOSE_ARCHIVE);
      701    21551    3            END;
      702    21552    3          DO WHILE('0'B);
      703    21553    3   ALT1:
      704    21554    3            CALL FLI$RPT_ERR;
      705    21555    3            CALL M$CLOSE(CLOSE_ARCHIVE);
      706    21556    3          END;
      707    21557    2          RETURN;
      708    21558    2   END FLE_ADD;
      709    21559        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:23   
      710    21560    1   FLE_REMOVE:PROC;
      711    21561        /*F*   NAME: FLE_REMOVE
      712    21562               PURPOSE: Perform REMOVE command for the archive system.
      713    21563                         This command removes a packset from the existing
      714    21564                         group of packsets. If the master packset is removed,
      715    21565                         The members of the packset group also are taken
      716    21566                         away.
      717    21567        ***/
      718    21568
      719    21569        /***
      720    21570         ***  Open :ARCHIVE file from master packset to get archive
      721    21571         ***  information.
      722    21572         ***/
      723    21573
      724    21574    2          DPSN.SN#(0) = DISK_DEST_SN.SN#(0);
      725    21575    2          OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;
      726    21576    2          CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT2);
      727    21577
      728    21578    2          READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
      729    21579    2          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT2);
      730    21580
      731    21581    2          CALL FLI$ALLOC(ARCHIVE_REC_SIZE,START$);
      732    21582    2          READ_ARCHIVE_FILE.BUF_.BUF$ = START$;
      733    21583    2          READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;
      734    21584    2          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT2);
      735    21585        /***
      736    21586         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      737    21587         ***/
      738    21588    2          IF START$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)
      739    21589    2          THEN
      740    21590    3          DO;
      741    21591    3             CALL FLI$CNVRT_ARCHIVE(START$,TPTR$);
      742    21592    3             START$ = TPTR$;
      743    21593    3             ARCHIVE_REC_SIZE = START$->ARCHIVE_LIST.SIZE;
      744    21594    3             END;
      745    21595
      746    21596    2          AVAIL$ = PINCRW(START$,SIZEW(ARCHIVE_LIST));
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:24   
      747    21597    2          CALL M$CLOSE(CLOSE_ARCHIVE);
      748    21598
      749    21599    2          IF AVAIL$->VLP_SN.SN#(0) = DISK_DEST_SN.SN#(0)
      750    21600    2            THEN
      751    21601    3            DO;
      752    21602        /***
      753    21603         *** If the master packset is removed, then :ARCHIVE file is
      754    21604         *** deleted from both master packsets and member packsets.
      755    21605         ***/
      756    21606
      757    21607    3                IF DPLIST.SN#(0) = DISK_DEST_SN.SN#(0)
      758    21608    3                  THEN
      759    21609    4                  DO;
      760    21610    4                    OPEN_ARCHIVE_FILE.V.DELETE# = '1'B;
      761    21611    4                    OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;
      762    21612        /***
      763    21613         *** Remove :ARCHIVE file from member packsets.
      764    21614         ***/
      765    21615
      766    21616    5                    DO I = 1 TO AVAIL$->VLP_SN.NUM#-1;
      767    21617    5                        DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(I);
      768    21618    5                        CALL M$OPEN(OPEN_ARCHIVE_FILE)
      769    21619    5                        WHENRETURN
      770    21620    6                        DO;
      771    21621    6                          CALL FLI$RPT_ERR(E_REMOVE_FROM_ARCHIVE,DCB#);
      772    21622    6                        END;
      773    21623    5                        WHENALTRETURN
      774    21624    6                        DO;
      775    21625    6                          CALL FLI$RPT_ERR;
      776    21626                               /** The :ARCHIVE file of this packset has to be
      777    21627                                    deleted somehow **/
      778    21628    6                        END;
      779    21629    5                    END;
      780    21630        /***
      781    21631         *** Delete :ARCHIVE from master packset.
      782    21632         ***/
      783    21633
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:25   
      784    21634    4                    DPSN.SN#(0) = DISK_DEST_SN.SN#(0);
      785    21635    4                    CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT2);
      786    21636    4                    CALL FLI$RPT_ERR(E_REMOVE_MASTER_PACKSET,DCB#);
      787    21637
      788    21638    4                  END;
      789    21639    3                  ELSE
      790    21640    4                  DO;
      791    21641        /***
      792    21642         *** If it is the member packset, then delete :ARCHIVE from the
      793    21643         *** member packset and updates :ARCHIVE file of master packset.
      794    21644         ***/
      795    21645
      796    21646    4                    J = 0;
      797    21647    5                    DO I = 1 TO AVAIL$->VLP_SN.NUM#-1;
      798    21648    5                      IF AVAIL$->VLP_SN.SN#(I) = DPLIST.SN#(0)
      799    21649    5                        THEN
      800    21650    6                        DO;
      801    21651    6                          K = I;
      802    21652    6                          J = 1;
      803    21653    6                          EXIT;
      804    21654    6                        END;
      805    21655    5                    END;
      806    21656    4                    IF J = 1
      807    21657    4                      THEN
      808    21658    5                      DO;
      809    21659    5                        CALL M$CLOSE(CLOSE_ARCHIVE);
      810    21660    5                        DPSN.SN#(0) = DPLIST.SN#(0);
      811    21661    5                        OPEN_ARCHIVE_FILE.V.DELETE# = '1'B;
      812    21662    5                        OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;
      813    21663    5                        CALL M$OPEN ( OPEN_ARCHIVE_FILE )
      814    21664    5                             WHENRETURN
      815    21665    6                             DO;
      816    21666    6                                CALL FLI$RPT_ERR ( E_ARCFILE_REMOVED );
      817    21667    6                               END;
      818    21668    5                             WHENALTRETURN
      819    21669    6                             DO;
      820    21670    6                                IF B$TCB.ALT$ -> B$EXCFR.ERR.ERR# = %E$NOFILE
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:26   
      821    21671    6                                THEN CALL FLI$RPT_ERR ( E_NO_ARCFILE, DCB# );
      822    21672    7                                ELSE DO;
      823    21673    7                                     CALL FLI$RPT_ERR;
      824    21674    7                                     CALL M$CLOSE ( CLOSE_ARCHIVE );
      825    21675    7                                     RETURN;
      826    21676    7                                   END;
      827    21677    6                               END;
      828    21678
      829    21679        /***
      830    21680         ***  Updates packset list.
      831    21681         ***/
      832    21682
      833    21683    6                        DO I = K+1 TO AVAIL$->VLP_SN.NUM#-1;
      834    21684    6                          AVAIL$->VLP_SN.SN#(I-1) = AVAIL$->VLP_SN.SN#(I);
      835    21685    6                        END;
      836    21686
      837    21687    5                        AVAIL$->VLP_SN.SN#(AVAIL$->VLP_SN.NUM#-1) = '      ';
      838    21688    5                        AVAIL$->VLP_SN.NUM# = AVAIL$->VLP_SN.NUM#-1;
      839    21689        /***
      840    21690         ***  Write the updated :ARCHIVE file back to the master packset.
      841    21691         ***/
      842    21692
      843    21693    5                        OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;
      844    21694    5                        OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;
      845    21695    5                        OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;
      846    21696    5                        OPEN_ARCHIVE_FILE.V.DELETE# = '0'B;
      847    21697    5                        DPSN.SN#(0) = DISK_DEST_SN.SN#(0);
      848    21698    5                        CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT2);
      849    21699    5                        CALL FLI$RPT_ERR ( E_REMOVE_FROM_ARCHIVE );
      850    21700
      851    21701    5                        WRITE_ARCHIVE_REC.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
      852    21702    5                        CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ALT2);
      853    21703
      854    21704    5                        WRITE_ARCHIVE_REC.BUF_.BUF$ = START$;
      855    21705    5                        WRITE_ARCHIVE_REC.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;
      856    21706    5                        CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ALT2);
      857    21707    5                        CALL M$CLOSE(CLOSE_ARCHIVE);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:27   
      858    21708    5                      END;
      859    21709    4                      ELSE
      860    21710    5                      DO;
      861    21711    5                        CALL FLI$RPT_ERR(E_NOT_MEMBER_OF_ARCHIVE,DCB#);
      862    21712    5                        CALL M$CLOSE(CLOSE_ARCHIVE);
      863    21713    5                      END;
      864    21714    4                  END;
      865    21715    3            END;
      866    21716    2            ELSE
      867    21717    3            DO;
      868    21718    3                CALL FLI$RPT_ERR(E_NOT_ARCHIVE_MASTER,DCB#);
      869    21719    3                CALL M$CLOSE(CLOSE_ARCHIVE);
      870    21720    3            END;
      871    21721    3          DO WHILE('0'B);
      872    21722    3   ALT2:
      873    21723    3            CALL FLI$RPT_ERR;
      874    21724    3            CALL M$CLOSE(CLOSE_ARCHIVE);
      875    21725    3          END;
      876    21726    2          RETURN;
      877    21727    2   END FLE_REMOVE;
      878    21728        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:28   
      879    21729    1   FLE_GET_ARCHIVE_SNLIST: PROC ALTRET;
      880    21730        /*F*  NAME: FLE_GET_ARCHIVE_SNLIST
      881    21731              PURPOSE: Get SNLIST from :ARCHIVE.$$EFT file.
      882    21732        ***/
      883    21733    2          DPSN.SN#(0) = DPLIST.SN#(0);
      884    21734    2          OPEN_ARCHIVE_FILE.V.RES# = DPRESLIST.NAME(0);
      885    21735    3         DO WHILE ('1'B);
      886    21736    3          OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;
      887    21737    3          CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT3);
      888    21738
      889    21739    3          READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
      890    21740    3          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT3);
      891    21741
      892    21742    3          CALL FLI$ALLOC(ARCHIVE_REC_SIZE,ARCHIVE$);
      893    21743    3          READ_ARCHIVE_FILE.BUF_.BUF$ = ARCHIVE$;
      894    21744    3          READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;
      895    21745    3          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT3);
      896    21746        /***
      897    21747         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      898    21748         ***/
      899    21749    3          IF ARCHIVE$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)
      900    21750    3          THEN
      901    21751    4          DO;
      902    21752    4             CALL FLI$CNVRT_ARCHIVE(ARCHIVE$,TPTR$);
      903    21753    4             ARCHIVE$ = TPTR$;
      904    21754    4             ARCHIVE_REC_SIZE = ARCHIVE$->ARCHIVE_LIST.SIZE;
      905    21755    4             END;
      906    21756
      907    21757    3          AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.DPLIST);
      908    21758        /***
      909    21759         ***  Check if it is the master packset. Because  the master
      910    21760         ***  packset always contains the most current archiving information.
      911    21761         ***/
      912    21762
      913    21763    3          IF AVAIL$->VLP_SN.SN#(0) ~= DPSN.SN#(0)
      914    21764    3            THEN
      915    21765    4            DO;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:29   
      916    21766    4                CALL M$CLOSE(CLOSE_ARCHIVE);
      917    21767    4                DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(0);
      918    21768        /***
      919    21769         *** Set RES equal command line value, if specified.
      920    21770         ***/
      921    21771    4                OPEN_ARCHIVE_FILE.V.RES# = ' ';
      922    21772    4   RES_LOOP:
      923    21773    5                DO I = 0 TO DPLIST.NUM# -1;
      924    21774    5                  IF DPSN.SN#(0) = DPLIST.SN#(I)
      925    21775    6                   THEN DO;
      926    21776    6                     OPEN_ARCHIVE_FILE.V.RES# = DPRESLIST.NAME(I);
      927    21777    6                     EXIT RES_LOOP;
      928    21778    6                     END;
      929    21779    5                   END;
      930    21780    4            END;
      931    21781    3            ELSE
      932    21782    3                EXIT;
      933    21783    3         END;
      934    21784
      935    21785    2          AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST);
      936    21786    2          IF AVAIL$->VLP_SN.NUM# = 0
      937    21787    2            THEN
      938    21788    3            DO;
      939    21789    3                CALL FLI$RPT_ERR(E_ARCHIVE_OUT_TAPESET,);
      940    21790
      941    21791    3                COMMAND_ERROR = '1'B;
      942    21792    3                RETURN;
      943    21793    3            END;
      944    21794        /***
      945    21795         ***  Get the tape open information from :ARCHIVE.
      946    21796         ***/
      947    21797
      948    21798    2          TAPE_OPEN.V.DENSITY# = ARCHIVE$->ARCHIVE_LIST.OPTION.DEN;
      949    21799    2          TAPE_OPEN.V.VOLACCESS# = ARCHIVE$->ARCHIVE_LIST.OPTION.VOLA;
      950    21800    2          TAPE_OPEN.V.EXPIRE# = ARCHIVE$->ARCHIVE_LIST.OPTION.EXP;
      951    21801    2          TAPE_OPEN.V.BLKL# = ARCHIVE$->ARCHIVE_LIST.OPTION.BLOCK;
      952    21802    2          TAPE_OPEN.V.OPER.MNTONLY# = %NO#;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:30   
      953    21803    2          IF NOT TAPE_OPTION.CHECK_SPECD    /* Use default if not spec'd on cmnd */
      954    21804    2            THEN TAPE_OPTION.CHECK = ARCHIVE$->ARCHIVE_LIST.OPTION.CHECK;
      955    21805    2          IF NOT TAPE_OPTION.IOERRORC_SPECD /* Use default if not spec'd on cmnd */
      956    21806    2            THEN TAPE_OPEN.V.IOERROK# = ARCHIVE$->ARCHIVE_LIST.OPTION.IOERRORC;
      957    21807    2            ELSE TAPE_OPEN.V.IOERROK# = TAPE_OPTION.IOERRORC;
      958    21808    2          TAPE_OPEN.V.XTEND# = ARCHIVE$->ARCHIVE_LIST.XTEND;
      959    21809    2          TAPE_OPEN.V.FSN# = 0;
      960    21810    2          IF NOT ARCHIVE$->ARCHIVE_LIST.OD  /* Optical disk or tape archive file? */
      961    21811    2            THEN LAST_TAPE_FSN = 9999;
      962    21812    2            ELSE LAST_TAPE_FSN = 262143;
      963    21813    2          TAPE_OPEN.NAME_ = VECTOR(ERASE);
      964    21814    2          TAPE_OPEN.V.INITZ.SCRUB# = %YES#;
      965    21815    2          TAPE_OPEN.V.VOL# = 0;
      966    21816    2          TAPE_OPEN.V.FUN# = %CREATE#;
      967    21817    2          IF NOT ARCHIVE$->ARCHIVE_LIST.OD /* Optical disk or tape archive file? */
      968    21818    2            THEN
      969    21819    3              DO;
      970    21820    3                  TAPE_OPEN.V.CVOL# = %YES#;
      971    21821    3                  TAPE_OPEN.V.RES# = 'LT';
      972    21822    3              END;
      973    21823    2            ELSE
      974    21824    3              DO;
      975    21825    3                  TAPE_OPEN.V.CVOL# = %NO#;
      976    21826    3                  TAPE_OPEN.V.RES# = 'OD';
      977    21827    3                  TAPE_OPEN.V.ASN# = %FILE#;
      978    21828    3              END;
      979    21829    2          TAPE_OPEN.IFPARAM_ = VECTOR(NIL);
      980    21830    2          TAPE_OPEN.FPARAM_ = VECTOR(NIL);
      981    21831
      982    21832    2          NBR_GRANS_PER_TAPE_BUF = ARCHIVE$->ARCHIVE_LIST.OPTION.BLOCK/4096;
      983    21833        /***
      984    21834         ***  Allocate the memory for the tapeset which will be used
      985    21835         ***  for the tape open routine.
      986    21836         ***/
      987    21837    2          SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM# *
      988    21838    2                    LENGTHC(VLP_SN.SN#(0)) + 3) / 4;
      989    21839    2          NBR_SNLISTS = 0;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:31   
      990    21840    2          CALL FLE_BUILD_SNLIST;
      991    21841    2          IF ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST2 ~= 0
      992    21842    2            THEN
      993    21843    3            DO;
      994    21844    3                AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST2);
      995    21845    3                CALL FLE_BUILD_SNLIST;
      996    21846    3            END;
      997    21847
      998    21848        /***
      999    21849         *** Leave the archive file for the master packset open so that multiple
     1000    21850         *** archives are prevented from running simultaneously.
     1001    21851         ***/
     1002    21852
     1003    21853    3          DO WHILE('0'B);
     1004    21854    3   ALT3:
     1005    21855    3            CALL FLI$RPT_ERR;
     1006    21856    3            CALL M$CLOSE(CLOSE_ARCHIVE);
     1007    21857    3            COMMAND_ERROR = '1'B;
     1008    21858    3          END;
     1009    21859    2          RETURN;
     1010    21860    2   END FLE_GET_ARCHIVE_SNLIST;
     1011    21861        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:32   
     1012    21862    1   FLE_BUILD_SNLIST: PROC;
     1013    21863        /*F*  NAME: FLE_BUILD_SNLIST
     1014    21864              PURPOSE: Build SNLIST from :ARCHIVE.$$EFT file.
     1015    21865         ***/
     1016    21866    2          CALL FLI$ALLOC(SNSIZE,TPTR$);
     1017    21867    3          DO I = 0 TO AVAIL$->VLP_SN.NUM# - 1;
     1018    21868    3            TPTR$->VLP_SN.SN#(I) = AVAIL$->VLP_SN.SN#(I);
     1019    21869    3          END;
     1020    21870    2          TPTR$->VLP_SN.NUM# = AVAIL$->VLP_SN.NUM#;
     1021    21871    2          NBR_SNLISTS = NBR_SNLISTS + 1;
     1022    21872
     1023    21873    2          CALL FLI$ALLOC(SIZEW(SNLISTINFO),BUF$);
     1024    21874    2          BUF$->SNLISTINFO.SNLIST$ = TPTR$;
     1025    21875    2          BUF$->SNLISTINFO.PREVINFO$ = LAST_SNLISTINFO$;
     1026    21876    2          LAST_SNLISTINFO$ = BUF$;
     1027    21877    2          RETURN;
     1028    21878    2   END FLE_BUILD_SNLIST;
     1029    21879        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:33   
     1030    21880    1   FLE_UPDATE_ARCHIVE:PROC ;
     1031    21881        /*F*   NAME: FLE_UPDATE_ARCHIVE
     1032    21882               PURPOSE: Update ARCHIVE_LIST record when there is new reel
     1033    21883                        for ARCHIVE command
     1034    21884        ***/
     1035    21885
     1036    21886    2          AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST);
     1037    21887    2          SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM#*LENGTHC(VLP_SN.
             21887                   SN#(0))+3)/4;
     1038    21888    2          TPTR$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST+SNSIZE);
     1039    21889
     1040    21890    2          K = AVAIL$->VLP_SN.NUM#;
     1041    21891    3          DO J = 0 TO K-1;
     1042    21892    3            AVAIL$->VLP_SN.SN#(J) = AVAIL$->VLP_SN.SN#(J+1);
     1043    21893    3          END;
     1044    21894    2          AVAIL$->VLP_SN.NUM# = K - 1;
     1045    21895    2          AVAIL$->VLP_SN.SN#(K-1) = ' ';
     1046    21896
     1047    21897    2          IF ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST2 ~= 0
     1048    21898    2            THEN
     1049    21899    3            DO;
     1050    21900    3                SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM#*LENGTHC(
             21900                         VLP_SN.SN#(0))+3)/4;
     1051    21901    3                AVAIL$ = PINCRW(AVAIL$,SNSIZE);
     1052    21902    4                DO J = 0 TO PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST)->
             21902                         VLP_SN.NUM# - 1;
     1053    21903    4                    AVAIL$->VLP_SN.SN#(J) = TPTR$->VLP_SN.SN#(J+1);
     1054    21904    4                END;
     1055    21905
     1056    21906    3                TPTR$ = ADDR(AVAIL$->VLP_SN.SN#(J));  /* Clean up archive record */
     1057    21907    3                TEMP = ARCHIVE$->ARCHIVE_LIST.SIZE * 4 - POFFC(TPTR$ , ARCHIVE$);
     1058    21908    4                DO J = 0 TO TEMP - 1;
     1059    21909    4                  TPTR$->BLANK(J) = ' ';
     1060    21910    4                END;
     1061    21911
     1062    21912    3                AVAIL$->VLP_SN.NUM# = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.
             21912                         SNLIST)->VLP_SN.NUM#;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:34   
     1063    21913    3                ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST2 = ARCHIVE$->ARCHIVE_LIST.OFFSET.
             21913                         SNLIST+SNSIZE;
     1064    21914    3            END;
     1065    21915    2   RETURN;
     1066    21916    2   END FLE_UPDATE_ARCHIVE;
     1067    21917        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:35   
     1068    21918    1   FLE_FINISH_ARCHIVE:PROC;
     1069    21919        /*F*  NAME: FLE_FINISH_ARCHIVE
     1070    21920              PURPOSE: Write the updated ARCHIVE_LIST record to
     1071    21921                       all ARCHIVE packsets after ARCHIVE command
     1072    21922                       performed.
     1073    21923        ***/
     1074    21924
     1075    21925    2          CALL M$CLOSE(CLOSE_ARCHIVE);
     1076    21926    2          ARCHIVE$->ARCHIVE_LIST.XTEND = %YES#;
     1077    21927    2          AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.DPLIST);
     1078    21928    2          OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;
     1079    21929    2          OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;
     1080    21930    2          OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;
     1081    21931    3          DO I = 0 TO AVAIL$->VLP_SN.NUM# - 1;
     1082    21932    3            DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(I);
     1083    21933    3            CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ERR);
     1084    21934    3            WRITE_ARCHIVE_REC.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
     1085    21935    3            CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
     1086    21936    3            WRITE_ARCHIVE_REC.BUF_.BUF$ = ARCHIVE$;
     1087    21937    3            WRITE_ARCHIVE_REC.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;
     1088    21938    3            CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
     1089    21939    3            CALL M$CLOSE(CLOSE_ARCHIVE);
     1090    21940    4            DO WHILE('0'B);
     1091    21941    4   ERR:
     1092    21942    4                CALL FLI$RPT_ERR;
     1093    21943    4                CALL M$CLOSE(CLOSE_ARCHIVE);
     1094    21944    4                IF I = 0 THEN RETURN;
     1095    21945    4            END;
     1096    21946    3          END;
     1097    21947    2   RETURN;
     1098    21948    2   END FLE_FINISH_ARCHIVE;
     1099    21949    1   END FLE$ESTMOD;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:36   
--  Include file information  --

   FLS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FL_PERR_C.:E05TOU  is referenced.
   FLE_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$FIT.:E05TOU  is referenced.
   FLN_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   XU_SUBS_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLE$ESTMOD.

   Procedure FLE$ESTMOD requires 1972 words for executable code.
   Procedure FLE$ESTMOD requires 10 words of local(AUTO) storage.

    No errors detected in file FLE$ESTMOD.:E05TSI    .

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:37   

 Object Unit name= FLE$ESTMOD                                 File name= FLE$ESTMOD.:E05TOU
 UTS= JUL 29 '97 15:45:10.36 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$PRE_RET
    2   Data  even  none   242    362  FLE$ESTMOD
    3   DCB   even  none     0      0  M$DISK_IN
    4   DCB   even  none     0      0  M$DISK00
    5   DCB   even  none     0      0  M$DISK01
    6   DCB   even  none     0      0  M$DISK02
    7   DCB   even  none     0      0  M$DISK03
    8   DCB   even  none     0      0  M$TSN_USED
    9   DCB   even  none     0      0  M$STATUS
   10   DCB   even  none     0      0  M$REBUILD
   11   DCB   even  none     0      0  M$ARCHIVE
   12   DCB   even  none     0      0  M$NODATA_LIST
   13  RoData even  UTS      4      4  FLE$ESTMOD
   14   Proc  even  none  1972   3664  FLE$ESTMOD
   15  RoData even  none    64    100  FLE$ESTMOD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    14      0   yes            yes      Std        1  FLE$ESTMOD

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    2    356  ARCHIVE_REC_SIZE
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:38   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 FLI$ALLOC
 yes     yes           Std       1 FLI$BUILD_$$EFT
         yes           Std       2 FLI$CNVRT_ARCHIVE
         yes           Std       5 FLI$RPT_ERR
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  LAST_SNLISTINFO$                      NBR_SNLISTS
     TAPE_DCBLIST$                         TAPE_OPEN                             SNVECLIST$
     B$TCB$                                COMMAND_ERROR                         NBR_GRANS_PER_TAPE_BUF
     DPLIST$                               DPRESLIST$                            DISK_FILE_SPEC$
     SPECCHARS                             DISK_DEST_SN                          LAST_TAPE_FSN
     EFTWORD                               TAPE_OPTION                           M$PRE_RET
     RET_CMDS_NAME                         M$DISK_IN                             ARCHIVE$
     M$DISK00                              M$DISK01                              M$DISK02
     M$DISK03                              FROM_DISK_NAME                        FROM_DISK_ACCT
     FROM_DISK_SN                     r    E_ALREADY_ESTABLISH              r    E_NOT_ARCHIVE_MASTER
r    E_NOT_MEMBER_OF_ARCHIVE          r    E_MEMBER_OF_ARCHIVE              r    E_ARCFILE_REMOVED
r    E_REMOVE_FROM_ARCHIVE            r    E_NO_ARCFILE                     r    E_NUM_ARCHIVE_SETS
r    E_REMOVE_MASTER_PACKSET          r    E_TYPE_ARCHIVE_SET               r    E_CANT_SPECIFY_DENSITY
r    E_CANT_SPECIFY_EXPIRE            r    E_ARCHIVE_OUT_TAPESET                 M$TSN_USED
     M$STATUS                              M$REBUILD                             M$ARCHIVE
     M$NODATA_LIST                         BLK_TAG$                              BLK_TAG0$
     NBR_BYTES_TO_MOVE                     DISK_GRAN$                            BLOCK_GRAN$
r    EFT_CVOL_FILE                    r    EFT_RESTRICT_FILE                     TSN_USED_NAME
     BACKUP_NAME                      r    CON_CLOSE_ARCHIVE                r    CON_OPEN_ARCHIVE_FILE
r    CON_READ_ARCHIVE_FILE            r    ARCHIVE_NAME                     r    PRIME_FILE
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:39   
r    DUAL_FILE                             REBUILD_NAME                          REBUILD_DIR_KEY
     REBUILD_KEY                           NODATA_FILE_NAME                      NODATA_KEY
     B_VERSION                             B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:40   


        1        1        /*M* FLE$ESTMOD Performs ESTABLISH,MODIFY,ADD,REMOVE functions */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*  NAME: FLE$ESTMOD
        8        8              PURPOSE: Process ESTABLISH,MODIFY,ADD,REMOVE  command
        9        9                       and perform other ARCHIVE function.
       10       10                       :ARCHIVE.$$EFT file contains two records. First
       11       11                       record is one word which keeps the size of next
       12       12                       record. Second record contains all ARCHIVE system
       13       13                       information.
       14       14        ***/
       15       15        FLE$ESTMOD: PROC (COMMAND) ;

     15 14 000000   000000 700200 xent  FLE$ESTMOD   TSX0  ! X66_AUTO_1
        14 000001   000012 000001                    ZERO    10,1

       16       16    1   DCL COMMAND UBIN;
       17       17        /***/
       18       18        /** Includes **/
       19       19        /***/
       20       20        %INCLUDE CP_6;
       21     5579        %INCLUDE CP_6_SUBS;
       22     6119        %INCLUDE B_ERRORS_C;
       23     7246        %INCLUDE XU_MACRO_C;
       24    10352        %INCLUDE XU_SUBS_C;
       25    10444        %INCLUDE FLI_DATA_R;
       26    11858        %INCLUDE FLN_DATA_R;
       27    12595        %INCLUDE FM$FIT;
       28    12816        %INCLUDE FLE_DATA_R;
       29    18767        %INCLUDE FLS_DATA_R;
       30    20567        /***/
       31    20568        /** External procedures  **/
       32    20569        /***/
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:41   
       33    20570    1   DCL FLP$WR_FILE_INFO ENTRY(9) ALTRET;
       34    20571    1   DCL FLI$RPT_ERR ENTRY(5);
       35    20572    1   DCL FLI$ALLOC ENTRY(2) ;
       36    20573    1   DCL FLI$ALLOC_BUF ENTRY(2);
       37    20574    1   DCL FLI$BUILD_$$EFT ENTRY(1) ALTRET;
       38    20575    1   DCL FLI$CNVRT_ARCHIVE ENTRY(2);
       39    20576        /***/
       40    20577        /*** MACROS  ***/
       41    20578        /***/
       42    20579        %FPT_WRITE(FPTN = WRITE_ARCHIVE_REC,
       43    20580                   DCB = M$ARCHIVE,
       44    20581                   STCLASS = STATIC);
       45    20612
       46    20613        %FPT_CLOSE (FPTN = CLOSE_ARCHIVE );
       47    20655
       48    20656        %FPT_OPEN(FPTN = OPEN_ARCHIVE_FILE);
       49    20765
       50    20766        %FPT_READ(FPTN=READ_ARCHIVE_FILE);
       51    20805        %VLP_SN(STCLASS = BASED);
       52    20818        %B$TCB(STCLASS = "BASED(B$TCB$)");
       53    20821        %B$ALT;
       54    20829        %SNLISTINFO(STCLASS = "BASED(LAST_SNLISTINFO$)");
       55    20832        %B$EXCFR;
       56    20850
       57    20851        %VLP_ERRCODE (FPTN = ERRCODE);
       58    20896
       59    20897        %VLP_SN (FPTN = DPSN,
       60    20898                 N = 1,
       61    20899                 STCLASS = STATIC);
       62    20912
       63    20913    1   DCL BREAK_COUNT SBIN SYMREF;
       64    20914    1   DCL B_VERSION CHAR(1) SYMREF;
       65    20915    1   DCL 1 B$VERSION BASED,
       66    20916    1          2 L# UBIN BYTE CALIGNED,
       67    20917    1          2 NAME# CHAR(B$VERSION.L#) CALIGNED;
       68    20918    1   DCL BLANK(0:0) BASED CHAR(1);
       69    20919    1   DCL DPSIZE UBIN STATIC;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:42   
       70    20920    1   DCL I UBIN STATIC;
       71    20921    1   DCL J UBIN STATIC;
       72    20922    1   DCL K UBIN STATIC;
       73    20923    1   DCL TEMP SBIN STATIC;
       74    20924    1   DCL SIZE UBIN STATIC;
       75    20925    1   DCL CODE SBIN STATIC;
       76    20926    1   DCL AVAIL$ PTR STATIC;
       77    20927    1   DCL DCB# UBIN STATIC;
       78    20928    1   DCL SNSIZE UBIN STATIC;
       79    20929    1   DCL ARCHIVE_REC_SIZE UBIN STATIC SYMDEF;
       80    20930    1   DCL ARCHIVE_TAIL UBIN BASED;
       81    20931    1   DCL START$ PTR STATIC;
       82    20932    1   DCL BUF$ PTR STATIC;
       83    20933    1   DCL TPTR$ PTR STATIC;
       84    20934         %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:43   
       85    20935        /***
       86    20936         *** Calling all routines for ARCHIVE system or ARCHIVE running.
       87    20937         ***/
       88    20938    1           DCB# = DCBNUM(M$ARCHIVE);

  20938 14 000002   000000 236007 xsym               LDQ     M$ARCHIVE,DL
        14 000003   000354 756000 2                  STQ     DCB#

       89    20939    1           OPEN_ARCHIVE_FILE = CON_OPEN_ARCHIVE_FILE;

  20939 14 000004   000000 100400                    MLR     fill='000'O
        14 000005   000000 000350 xsym               ADSC9   CON_OPEN_ARCHIVE_FILE    cn=0,n=232
        14 000006   000226 000350 2                  ADSC9   OPEN_ARCHIVE_FILE        cn=0,n=232

       90    20940    1           OPEN_ARCHIVE_FILE.V_ = VECTOR(OPEN_ARCHIVE_FILE.V);

  20940 14 000007   000000 237000 15                 LDAQ    0
        14 000010   000226 757000 2                  STAQ    OPEN_ARCHIVE_FILE

       91    20941    1           OPEN_ARCHIVE_FILE.SN_ = VECTOR ( DPSN );

  20941 14 000011   000002 237000 15                 LDAQ    2
        14 000012   000230 757000 2                  STAQ    OPEN_ARCHIVE_FILE+2

       92    20942    1           READ_ARCHIVE_FILE = CON_READ_ARCHIVE_FILE;

  20942 14 000013   000000 100400                    MLR     fill='000'O
        14 000014   000000 000070 xsym               ADSC9   CON_READ_ARCHIVE_FILE    cn=0,n=56
        14 000015   000320 000070 2                  ADSC9   READ_ARCHIVE_FILE        cn=0,n=56

       93    20943    1           READ_ARCHIVE_FILE.V_ = VECTOR ( READ_ARCHIVE_FILE.V );

  20943 14 000016   000004 237000 15                 LDAQ    4
        14 000017   000320 757000 2                  STAQ    READ_ARCHIVE_FILE

       94    20944    1           CLOSE_ARCHIVE = CON_CLOSE_ARCHIVE;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:44   
  20944 14 000020   000000 100400                    MLR     fill='000'O
        14 000021   000000 000170 xsym               ADSC9   CON_CLOSE_ARCHIVE        cn=0,n=120
        14 000022   000170 000170 2                  ADSC9   CLOSE_ARCHIVE            cn=0,n=120

       95    20945    1           CLOSE_ARCHIVE.V_ = VECTOR ( CLOSE_ARCHIVE.V );

  20945 14 000023   000006 237000 15                 LDAQ    6
        14 000024   000170 757000 2                  STAQ    CLOSE_ARCHIVE

       96    20946    1           OPEN_ARCHIVE_FILE.V.DELETE# = '0'B;

  20946 14 000025   000010 236000 15                 LDQ     8
        14 000026   000272 356000 2                  ANSQ    OPEN_ARCHIVE_FILE+36

       97    20947    2           DO CASE(COMMAND);

  20947 14 000027   200003 470500                    LDP0    @COMMAND,,AUTO
        14 000030   000000 235100                    LDA     0,,PR0
        14 000031   000004 135007                    SBLA    4,DL
        14 000032   000034 115007                    CMPA    28,DL
        14 000033   000035 602005 14                 TNC     s:20947+6,AL
        14 000034   000115 710000 14                 TRA     s:20963
        14 000035   000113 710000 14                 TRA     s:20961
        14 000036   000115 710000 14                 TRA     s:20963
        14 000037   000115 710000 14                 TRA     s:20963
        14 000040   000115 710000 14                 TRA     s:20963
        14 000041   000115 710000 14                 TRA     s:20963
        14 000042   000110 710000 14                 TRA     s:20959
        14 000043   000115 710000 14                 TRA     s:20963
        14 000044   000115 710000 14                 TRA     s:20963
        14 000045   000115 710000 14                 TRA     s:20963
        14 000046   000102 710000 14                 TRA     s:20955
        14 000047   000115 710000 14                 TRA     s:20963
        14 000050   000115 710000 14                 TRA     s:20963
        14 000051   000115 710000 14                 TRA     s:20963
        14 000052   000115 710000 14                 TRA     s:20963
        14 000053   000115 710000 14                 TRA     s:20963
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:45   
        14 000054   000115 710000 14                 TRA     s:20963
        14 000055   000115 710000 14                 TRA     s:20963
        14 000056   000115 710000 14                 TRA     s:20963
        14 000057   000115 710000 14                 TRA     s:20963
        14 000060   000105 710000 14                 TRA     s:20957
        14 000061   000105 710000 14                 TRA     s:20957
        14 000062   000115 710000 14                 TRA     s:20963
        14 000063   000115 710000 14                 TRA     s:20963
        14 000064   000115 710000 14                 TRA     s:20963
        14 000065   000115 710000 14                 TRA     s:20963
        14 000066   000071 710000 14                 TRA     s:20949
        14 000067   000074 710000 14                 TRA     s:20951
        14 000070   000077 710000 14                 TRA     s:20953

       98    20948    2                CASE(%ESTABLISH);

       99    20949    2                   CALL FLE_ESTABLISH;

  20949 14 000071   000116 701000 14                 TSX1    FLE_ESTABLISH
        14 000072   000000 011000                    NOP     0
        14 000073   000115 710000 14                 TRA     s:20963

      100    20950    2                CASE(%MODIFY);

      101    20951    2                   CALL FLE_MODIFY;

  20951 14 000074   000662 701000 14                 TSX1    FLE_MODIFY
        14 000075   000000 011000                    NOP     0
        14 000076   000115 710000 14                 TRA     s:20963

      102    20952    2                 CASE(%ADD);

      103    20953    2                    CALL FLE_ADD;

  20953 14 000077   001516 701000 14                 TSX1    FLE_ADD
        14 000100   000000 011000                    NOP     0
        14 000101   000115 710000 14                 TRA     s:20963
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:46   

      104    20954    2                 CASE(%REMOVE);

      105    20955    2                    CALL FLE_REMOVE;

  20955 14 000102   002345 701000 14                 TSX1    FLE_REMOVE
        14 000103   000000 011000                    NOP     0
        14 000104   000115 710000 14                 TRA     s:20963

      106    20956    2                 CASE(%ARCHIVE_CMD,%PURGE);

      107    20957    2                    CALL FLE_GET_ARCHIVE_SNLIST;

  20957 14 000105   002760 701000 14                 TSX1    FLE_GET_ARCHIVE_SNLIST
        14 000106   000000 011000                    NOP     0
        14 000107   000115 710000 14                 TRA     s:20963

      108    20958    2                 CASE(%ARCHIVE);

      109    20959    2                    CALL FLE_UPDATE_ARCHIVE;

  20959 14 000110   003371 701000 14                 TSX1    FLE_UPDATE_ARCHIVE
        14 000111   000000 011000                    NOP     0
        14 000112   000115 710000 14                 TRA     s:20963

      110    20960    2                 CASE(%ARCHIVED);

      111    20961    2                    CALL FLE_FINISH_ARCHIVE;

  20961 14 000113   003554 701000 14                 TSX1    FLE_FINISH_ARCHIVE
        14 000114   000000 011000                    NOP     0

      112    20962    2            END;

      113    20963    1           RETURN;

  20963 14 000115   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:47   

      114    20964        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:48   
      115    20965    1   FLE_ESTABLISH:PROC;

  20965 14 000116   200004 741300       FLE_ESTABLI* STX1  ! @COMMAND+1,,AUTO

      116    20966        /*F*  NAME: FLE_ESTABLISH
      117    20967              PURPOSE:  Perform ESTABLISH command for the archive system.
      118    20968                        This command creates the file :ARCHIVE.$$EFT and
      119    20969                        associates a set of packsets with the tapeset or optical
      120    20970                        diskset used during ARCHIVE runs.
      121    20971        ***/
      122    20972
      123    20973
      124    20974        /***
      125    20975         ***  Allocate memory  and fill out all information for ARCHIVE_LIST
      126    20976         ***  record which will be written into :ARCHIVE.$$EFT.
      127    20977         ***/
      128    20978
      129    20979    2           IF NBR_SNLISTS > 1

  20979 14 000117   000000 235000 xsym               LDA     NBR_SNLISTS
        14 000120   000001 115007                    CMPA    1,DL
        14 000121   000127 604400 14                 TMOZ    s:20983

      130    20980    2            THEN
      131    20981    2              AVAIL$ = SNLISTINFO.PREVINFO$->SNLISTINFO.SNLIST$;

  20981 14 000122   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 000123   000001 471500                    LDP1    1,,PR0
        14 000124   100000 236100                    LDQ     0,,PR1
        14 000125   000353 756000 2                  STQ     AVAIL$
        14 000126   000132 710000 14                 TRA     s:20984

      132    20982    2            ELSE
      133    20983    2              AVAIL$ = SNLISTINFO.SNLIST$;

  20983 14 000127   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 000130   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:49   
        14 000131   000353 756000 2                  STQ     AVAIL$

      134    20984    2          DPSIZE = (LENGTHC(DPLIST.NUM#) + DPLIST.NUM# * LENGTHC(DPLIST.SN#(0))+ 3)/4;

  20984 14 000132   000000 471400 xsym               LDP1    DPLIST$
        14 000133   100000 236100                    LDQ     0,,PR1
        14 000134   000006 402007                    MPY     6,DL
        14 000135   000007 036007                    ADLQ    7,DL
        14 000136   000004 506007                    DIV     4,DL
        14 000137   000344 756000 2                  STQ     DPSIZE

      135    20985    2           SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#)+ AVAIL$->VLP_SN.NUM#*LENGTHC(VLP_SN.
             20985                    SN#(0))+3)/4;

  20985 14 000140   000353 473400 2                  LDP3    AVAIL$
        14 000141   300000 236100                    LDQ     0,,PR3
        14 000142   000006 402007                    MPY     6,DL
        14 000143   000007 036007                    ADLQ    7,DL
        14 000144   000004 506007                    DIV     4,DL
        14 000145   000355 756000 2                  STQ     SNSIZE

      136    20986    2           SIZE = DPSIZE + (NBR_SNLISTS * SNSIZE) + SIZEW(ARCHIVE_LIST);

  20986 14 000146   000000 402000 xsym               MPY     NBR_SNLISTS
        14 000147   000344 036000 2                  ADLQ    DPSIZE
        14 000150   000011 036007                    ADLQ    9,DL
        14 000151   000351 756000 2                  STQ     SIZE

      137    20987
      138    20988    2           CALL FLI$ALLOC(SIZE,START$);

  20988 14 000152   000011 630400 15                 EPPR0   9
        14 000153   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000154   000000 701000 xent               TSX1    FLI$ALLOC
        14 000155   000000 011000                    NOP     0

      139    20989    2           START$->ARCHIVE_LIST.OFFSET.DPLIST = SIZEW(ARCHIVE_LIST);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:50   

  20989 14 000156   000011 235007                    LDA     9,DL
        14 000157   000357 470400 2                  LDP0    START$
        14 000160   000003 755100                    STA     3,,PR0

      140    20990    2           START$->ARCHIVE_LIST.OFFSET.SNLIST = SIZEW(ARCHIVE_LIST) + DPSIZE;

  20990 14 000161   000357 470400 2                  LDP0    START$
        14 000162   000344 236000 2                  LDQ     DPSIZE
        14 000163   000011 036007                    ADLQ    9,DL
        14 000164   000004 756100                    STQ     4,,PR0

      141    20991    2           IF NBR_SNLISTS > 1

  20991 14 000165   000000 235000 xsym               LDA     NBR_SNLISTS
        14 000166   000001 115007                    CMPA    1,DL
        14 000167   000175 604400 14                 TMOZ    s:20995

      142    20992    2             THEN
      143    20993    2              START$->ARCHIVE_LIST.OFFSET.SNLIST2 = START$->ARCHIVE_LIST.OFFSET.SNLIST
             20993                        + SNSIZE;

  20993 14 000170   000357 470400 2                  LDP0    START$
        14 000171   000004 236100                    LDQ     4,,PR0
        14 000172   000355 036000 2                  ADLQ    SNSIZE
        14 000173   000005 756100                    STQ     5,,PR0
        14 000174   000177 710000 14                 TRA     s:20996

      144    20994    2             ELSE
      145    20995    2               START$->ARCHIVE_LIST.OFFSET.SNLIST2 = 0;

  20995 14 000175   000357 470400 2                  LDP0    START$
        14 000176   000005 450100                    STZ     5,,PR0

      146    20996    2           START$->ARCHIVE_LIST.VOLUME = 0;    /* Unused */

  20996 14 000177   000357 470400 2                  LDP0    START$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:51   
        14 000200   000000 236003                    LDQ     0,DU
        14 000201   000006 552140                    STBQ    6,'40'O,PR0

      147    20997    2           START$->ARCHIVE_LIST.VERSION.SIZE = ADDR(B_VERSION)->B$VERSION.L#;

  20997 14 000202   000357 470400 2                  LDP0    START$
        14 000203   000000 236000 xsym               LDQ     B_VERSION
        14 000204   000011 772000                    QRL     9
        14 000205   000000 552120                    STBQ    0,'20'O,PR0

      148    20998    2          START$->ARCHIVE_LIST.VERSION.TEXT = SUBSTR(ADDR(B_VERSION)->B$VERSION.NAME#,
             20998                    0,ADDR(B_VERSION)->B$VERSION.L#);

  20998 14 000206   000000 236000 xsym               LDQ     B_VERSION
        14 000207   000033 772000                    QRL     27
        14 000210   000000 620006                    EAX0    0,QL
        14 000211   000357 470400 2                  LDP0    START$
        14 000212   040100 100440                    MLR     fill='040'O
        14 000213   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
        14 000214   000000 400006                    ADSC9   0,,PR0                   cn=2,n=6

      149    20999    2           START$->ARCHIVE_LIST.VERSION.FLAG = BITBIN('777'O); /* Post-D00 */

  20999 14 000215   000357 470400 2                  LDP0    START$
        14 000216   777000 236003                    LDQ     -512,DU
        14 000217   000000 552140                    STBQ    0,'40'O,PR0

      150    21000    2           START$->ARCHIVE_LIST.OPTION.DEN = TAPE_OPEN.V.DENSITY#;

  21000 14 000220   000357 470400 2                  LDP0    START$
        14 000221   000066 236000 xsym               LDQ     TAPE_OPEN+54
        14 000222   000036 736000                    QLS     30
        14 000223   000007 752140                    STCQ    7,'40'O,PR0

      151    21001    2           START$->ARCHIVE_LIST.OPTION.VOLA = TAPE_OPEN.V.VOLACCESS#;

  21001 14 000224   000357 470400 2                  LDP0    START$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:52   
        14 000225   000063 236000 xsym               LDQ     TAPE_OPEN+51
        14 000226   000011 736000                    QLS     9
        14 000227   000007 676100                    ERQ     7,,PR0
        14 000230   007000 376003                    ANQ     3584,DU
        14 000231   000007 656100                    ERSQ    7,,PR0

      152    21002    2           START$->ARCHIVE_LIST.OPTION.EXP = TAPE_OPEN.V.EXPIRE#;

  21002 14 000232   000357 470400 2                  LDP0    START$
        14 000233   000057 235000 xsym               LDA     TAPE_OPEN+47
        14 000234   000010 755100                    STA     8,,PR0

      153    21003    2           START$->ARCHIVE_LIST.OPTION.BLOCK = TAPE_OPEN.V.BLKL#;

  21003 14 000235   000052 220000 xsym               LDX0    TAPE_OPEN+42
        14 000236   000357 470400 2                  LDP0    START$
        14 000237   000007 440100                    SXL0    7,,PR0

      154    21004    2           START$->ARCHIVE_LIST.OPTION.CHECK = TAPE_OPTION.CHECK;

  21004 14 000240   000357 470400 2                  LDP0    START$
        14 000241   000000 236000 xsym               LDQ     TAPE_OPTION
        14 000242   000011 772000                    QRL     9
        14 000243   000007 676100                    ERQ     7,,PR0
        14 000244   000400 376003                    ANQ     256,DU
        14 000245   000007 656100                    ERSQ    7,,PR0

      155    21005    2           START$->ARCHIVE_LIST.OPTION.IOERRORC = TAPE_OPTION.IOERRORC;

  21005 14 000246   000357 470400 2                  LDP0    START$
        14 000247   000002 236000 xsym               LDQ     TAPE_OPTION+2
        14 000250   000005 772000                    QRL     5
        14 000251   000007 676100                    ERQ     7,,PR0
        14 000252   000200 376003                    ANQ     128,DU
        14 000253   000007 656100                    ERSQ    7,,PR0

      156    21006    2           START$->ARCHIVE_LIST.XTEND = %NO#;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:53   

  21006 14 000254   000357 470400 2                  LDP0    START$
        14 000255   000013 236000 15                 LDQ     11
        14 000256   000006 356100                    ANSQ    6,,PR0

      157    21007    2           IF TAPE_OPEN.V.RES# = 'OD'

  21007 14 000257   040000 106400                    CMPC    fill='040'O
        14 000260   000050 000004 xsym               ADSC9   TAPE_OPEN+40             cn=0,n=4
        14 000261   000000 000002 13                 ADSC9   0                        cn=0,n=2
        14 000262   000267 601000 14                 TNZ     s:21009

      158    21008    2             THEN START$->ARCHIVE_LIST.OD = %YES#;       /* Optical disk archive */

  21008 14 000263   000357 470400 2                  LDP0    START$
        14 000264   000200 236003                    LDQ     128,DU
        14 000265   000006 256100                    ORSQ    6,,PR0
        14 000266   000272 710000 14                 TRA     s:21011

      159    21009    2             ELSE START$->ARCHIVE_LIST.OD = %NO#;                /* Tape archive */

  21009 14 000267   000357 470400 2                  LDP0    START$
        14 000270   000014 236000 15                 LDQ     12
        14 000271   000006 356100                    ANSQ    6,,PR0

      160    21010
      161    21011    2           ARCHIVE_REC_SIZE = SIZE;

  21011 14 000272   000351 235000 2                  LDA     SIZE
        14 000273   000356 755000 2                  STA     ARCHIVE_REC_SIZE

      162    21012    2           START$->ARCHIVE_LIST.SIZE = SIZE;

  21012 14 000274   000357 470400 2                  LDP0    START$
        14 000275   000002 755100                    STA     2,,PR0

      163    21013
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:54   
      164    21014    2           AVAIL$ = PINCRW(START$,SIZEW(ARCHIVE_LIST));

  21014 14 000276   000357 236000 2                  LDQ     START$
        14 000277   000011 036003                    ADLQ    9,DU
        14 000300   000353 756000 2                  STQ     AVAIL$

      165    21015    3           DO I = 0 TO DPLIST.NUM#-1;

  21015 14 000301   000345 450000 2                  STZ     I
        14 000302   000315 710000 14                 TRA     s:21017+3

      166    21016    3              AVAIL$->VLP_SN.SN#(I) = DPLIST.SN#(I);

  21016 14 000303   000345 236000 2                  LDQ     I
        14 000304   000006 402007                    MPY     6,DL
        14 000305   000000 470400 xsym               LDP0    DPLIST$
        14 000306   000353 471400 2                  LDP1    AVAIL$
        14 000307   040106 100506                    MLR     fill='040'O
        14 000310   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 000311   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      167    21017    3              END;

  21017 14 000312   000345 235000 2                  LDA     I
        14 000313   000001 035007                    ADLA    1,DL
        14 000314   000345 755000 2                  STA     I
        14 000315   000000 470400 xsym               LDP0    DPLIST$
        14 000316   000345 236000 2                  LDQ     I
        14 000317   000322 604000 14                 TMI     s:21018
        14 000320   000000 116100                    CMPQ    0,,PR0
        14 000321   000303 604000 14                 TMI     s:21016

      168    21018    2           AVAIL$->VLP_SN.NUM# = DPLIST.NUM#;

  21018 14 000322   000353 471400 2                  LDP1    AVAIL$
        14 000323   000000 235100                    LDA     0,,PR0
        14 000324   100000 755100                    STA     0,,PR1
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:55   

      169    21019
      170    21020    2           AVAIL$ = PINCRW(AVAIL$,DPSIZE);

  21020 14 000325   000344 236000 2                  LDQ     DPSIZE
        14 000326   000022 736000                    QLS     18
        14 000327   000353 036000 2                  ADLQ    AVAIL$
        14 000330   000353 756000 2                  STQ     AVAIL$

      171    21021    2           IF NBR_SNLISTS > 1

  21021 14 000331   000000 235000 xsym               LDA     NBR_SNLISTS
        14 000332   000001 115007                    CMPA    1,DL
        14 000333   000341 604400 14                 TMOZ    s:21025

      172    21022    2             THEN
      173    21023    2               TPTR$ = SNLISTINFO.PREVINFO$->SNLISTINFO.SNLIST$;

  21023 14 000334   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 000335   000001 471500                    LDP1    1,,PR0
        14 000336   100000 236100                    LDQ     0,,PR1
        14 000337   000361 756000 2                  STQ     TPTR$
        14 000340   000344 710000 14                 TRA     s:21026

      174    21024    2             ELSE
      175    21025    2               TPTR$ = SNLISTINFO.SNLIST$;

  21025 14 000341   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 000342   000000 236100                    LDQ     0,,PR0
        14 000343   000361 756000 2                  STQ     TPTR$

      176    21026    3           DO I = 0 TO TPTR$->VLP_SN.NUM#-1;

  21026 14 000344   000345 450000 2                  STZ     I
        14 000345   000360 710000 14                 TRA     s:21028+3

      177    21027    3              AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:56   

  21027 14 000346   000345 236000 2                  LDQ     I
        14 000347   000006 402007                    MPY     6,DL
        14 000350   000361 470400 2                  LDP0    TPTR$
        14 000351   000353 471400 2                  LDP1    AVAIL$
        14 000352   040106 100506                    MLR     fill='040'O
        14 000353   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 000354   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      178    21028    3              END;

  21028 14 000355   000345 235000 2                  LDA     I
        14 000356   000001 035007                    ADLA    1,DL
        14 000357   000345 755000 2                  STA     I
        14 000360   000361 470400 2                  LDP0    TPTR$
        14 000361   000345 236000 2                  LDQ     I
        14 000362   000365 604000 14                 TMI     s:21029
        14 000363   000000 116100                    CMPQ    0,,PR0
        14 000364   000346 604000 14                 TMI     s:21027

      179    21029    2           AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;

  21029 14 000365   000353 471400 2                  LDP1    AVAIL$
        14 000366   000000 235100                    LDA     0,,PR0
        14 000367   100000 755100                    STA     0,,PR1

      180    21030
      181    21031    2           IF NBR_SNLISTS > 1

  21031 14 000370   000000 235000 xsym               LDA     NBR_SNLISTS
        14 000371   000001 115007                    CMPA    1,DL
        14 000372   000425 604400 14                 TMOZ    s:21040

      182    21032    2             THEN
      183    21033    3             DO;

      184    21034    3               AVAIL$ = PINCRW(AVAIL$,SNSIZE);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:57   

  21034 14 000373   000355 236000 2                  LDQ     SNSIZE
        14 000374   000022 736000                    QLS     18
        14 000375   000353 036000 2                  ADLQ    AVAIL$
        14 000376   000353 756000 2                  STQ     AVAIL$

      185    21035    4               DO I = 0 TO SNLISTINFO.SNLIST$->VLP_SN.NUM#-1;

  21035 14 000377   000345 450000 2                  STZ     I
        14 000400   000414 710000 14                 TRA     s:21037+3

      186    21036    4                  AVAIL$->VLP_SN.SN#(I) = SNLISTINFO.SNLIST$->VLP_SN.SN#(I);

  21036 14 000401   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 000402   000000 471500                    LDP1    0,,PR0
        14 000403   000345 236000 2                  LDQ     I
        14 000404   000006 402007                    MPY     6,DL
        14 000405   000353 473400 2                  LDP3    AVAIL$
        14 000406   040106 100506                    MLR     fill='040'O
        14 000407   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6
        14 000410   300001 000006                    ADSC9   1,Q,PR3                  cn=0,n=6

      187    21037    4                  END;

  21037 14 000411   000345 235000 2                  LDA     I
        14 000412   000001 035007                    ADLA    1,DL
        14 000413   000345 755000 2                  STA     I
        14 000414   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 000415   000000 471500                    LDP1    0,,PR0
        14 000416   000345 236000 2                  LDQ     I
        14 000417   000422 604000 14                 TMI     s:21038
        14 000420   100000 116100                    CMPQ    0,,PR1
        14 000421   000401 604000 14                 TMI     s:21036

      188    21038    3               AVAIL$->VLP_SN.NUM# = SNLISTINFO.SNLIST$->VLP_SN.NUM#;

  21038 14 000422   000353 473400 2                  LDP3    AVAIL$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:58   
        14 000423   100000 235100                    LDA     0,,PR1
        14 000424   300000 755100                    STA     0,,PR3

      189    21039    3             END;

      190    21040    2           AVAIL$ = PINCRW(AVAIL$,SNSIZE);

  21040 14 000425   000355 236000 2                  LDQ     SNSIZE
        14 000426   000022 736000                    QLS     18
        14 000427   000353 036000 2                  ADLQ    AVAIL$
        14 000430   000353 756000 2                  STQ     AVAIL$

      191    21041
      192    21042        /***
      193    21043         ***  copy of that file also maintained on each member packset.
      194    21044         ***  During creating the :ARCHIVE.$$EFT, if there is any problem
      195    21045         ***  in master packset, the error message will be issued and
      196    21046         ***  return to command level.
      197    21047         ***/
      198    21048
      199    21049    3           DO I = 0 TO DPLIST.NUM#-1;

  21049 14 000431   000345 450000 2                  STZ     I
        14 000432   000653 710000 14                 TRA     s:21125+3

      200    21050
      201    21051    3              DPSN.SN#(0) = DPLIST.SN#(I);

  21051 14 000433   000345 236000 2                  LDQ     I
        14 000434   000006 402007                    MPY     6,DL
        14 000435   000000 470400 xsym               LDP0    DPLIST$
        14 000436   040000 100506                    MLR     fill='040'O
        14 000437   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 000440   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      202    21052    3              CALL FLI$BUILD_$$EFT ( DPLIST.SN#(I) )

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:59   
  21052 14 000441   000345 236000 2                  LDQ     I
        14 000442   000015 402000 15                 MPY     13
        14 000443   000001 036003                    ADLQ    1,DU
        14 000444   000000 036000 xsym               ADLQ    DPLIST$
        14 000445   200010 756100                    STQ     @COMMAND+5,,AUTO
        14 000446   200010 630500                    EPPR0   @COMMAND+5,,AUTO
        14 000447   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000450   000000 701000 xent               TSX1    FLI$BUILD_$$EFT
        14 000451   000453 702000 14                 TSX2    s:21055
        14 000452   000462 710000 14                 TRA     s:21064

      203    21053    3              WHENALTRETURN
      204    21054    4              DO;

      205    21055    4                 ERRCODE = B$TCB.ALT$->B$EXCFR.ERR;

  21055 14 000453   000000 470400 xsym               LDP0    B$TCB$
        14 000454   000000 471500                    LDP1    0,,PR0
        14 000455   100102 236100                    LDQ     66,,PR1
        14 000456   000336 756000 2                  STQ     ERRCODE

      206    21056    4                 IF ERRCODE.SEV = 0

  21056 14 000457   000007 316007                    CANQ    7,DL
        14 000460   000462 600000 14                 TZE     s:21064

      207    21057    4                 THEN;
      208    21058    4                 ELSE
      209    21059    5                 DO;

      210    21060    5                    GOTO ERR1;

  21060 14 000461   000637 710000 14                 TRA     ERR1

      211    21061    5                    END;
      212    21062    4                 END;
      213    21063
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:60   
      214    21064    3              OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;

  21064 14 000462   001000 236007                    LDQ     512,DL
        14 000463   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      215    21065    3              CALL M$OPEN(OPEN_ARCHIVE_FILE)

  21065 14 000464   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 000465   450000 713400                    CLIMB   alt,open
        14 000466   410400 401760                    pmme    nvectors=18
        14 000467   000565 702000 14                 TSX2    s:21100

      216    21066    3              WHENRETURN
      217    21067    4              DO;

      218    21068
      219    21069    4                 READ_ARCHIVE_FILE.BUF_ = VECTOR(I);

  21069 14 000470   000016 237000 15                 LDAQ    14
        14 000471   000324 757000 2                  STAQ    READ_ARCHIVE_FILE+4

      220    21070    4                 CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ERR);

  21070 14 000472   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 000473   440000 713400                    CLIMB   alt,read
        14 000474   401400 401760                    pmme    nvectors=4
        14 000475   000634 702000 14                 TSX2    ERR

      221    21071    4                 CALL FLI$ALLOC(I,AVAIL$);

  21071 14 000476   000020 630400 15                 EPPR0   16
        14 000477   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000500   000000 701000 xent               TSX1    FLI$ALLOC
        14 000501   000000 011000                    NOP     0

      222    21072    4                 READ_ARCHIVE_FILE.BUF_.BUF$ = AVAIL$;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:61   
  21072 14 000502   000353 236000 2                  LDQ     AVAIL$
        14 000503   000325 756000 2                  STQ     READ_ARCHIVE_FILE+5

      223    21073    4                 READ_ARCHIVE_FILE.BUF_.BOUND = I * 4 - 1;

  21073 14 000504   000345 236000 2                  LDQ     I
        14 000505   000002 736000                    QLS     2
        14 000506   000001 136007                    SBLQ    1,DL
        14 000507   000020 736000                    QLS     16
        14 000510   000324 676000 2                  ERQ     READ_ARCHIVE_FILE+4
        14 000511   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 000512   000324 656000 2                  ERSQ    READ_ARCHIVE_FILE+4

      224    21074    4                 CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ERR);

  21074 14 000513   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 000514   440000 713400                    CLIMB   alt,read
        14 000515   401400 401760                    pmme    nvectors=4
        14 000516   000634 702000 14                 TSX2    ERR

      225    21075        /***
      226    21076         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      227    21077         ***/
      228    21078    4                 IF AVAIL$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)

  21078 14 000517   000353 470400 2                  LDP0    AVAIL$
        14 000520   000000 236100                    LDQ     0,,PR0
        14 000521   777000 376003                    ANQ     -512,DU
        14 000522   777000 116003                    CMPQ    -512,DU
        14 000523   000532 600000 14                 TZE     s:21084

      229    21079    4                 THEN
      230    21080    5                 DO;

      231    21081    5                    CALL FLI$CNVRT_ARCHIVE(AVAIL$,TPTR$);

  21081 14 000524   000022 630400 15                 EPPR0   18
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:62   
        14 000525   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000526   000000 701000 xent               TSX1    FLI$CNVRT_ARCHIVE
        14 000527   000000 011000                    NOP     0

      232    21082    5                    AVAIL$ = TPTR$;

  21082 14 000530   000361 236000 2                  LDQ     TPTR$
        14 000531   000353 756000 2                  STQ     AVAIL$

      233    21083    5                    END;

      234    21084    4                 AVAIL$ = PINCRW(AVAIL$,SIZEW(ARCHIVE_LIST));

  21084 14 000532   000353 236000 2                  LDQ     AVAIL$
        14 000533   000011 036003                    ADLQ    9,DU
        14 000534   000353 756000 2                  STQ     AVAIL$

      235    21085
      236    21086    4                 IF DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(0)

  21086 14 000535   000353 470400 2                  LDP0    AVAIL$
        14 000536   040100 106400                    CMPC    fill='040'O
        14 000537   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6
        14 000540   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
        14 000541   000547 601000 14                 TNZ     s:21090

      237    21087    4                 THEN
      238    21088    4                    CALL FLI$RPT_ERR(E_ALREADY_ESTABLISH,DCB#);

  21088 14 000542   000024 630400 15                 EPPR0   20
        14 000543   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000544   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 000545   000000 011000                    NOP     0
        14 000546   000553 710000 14                 TRA     s:21091

      239    21089    4                 ELSE
      240    21090    4                    CALL FLI$RPT_ERR(E_MEMBER_OF_ARCHIVE,DCB#);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:63   

  21090 14 000547   000026 630400 15                 EPPR0   22
        14 000550   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000551   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 000552   000000 011000                    NOP     0

      241    21091    4                 CALL M$CLOSE(CLOSE_ARCHIVE)

  21091 14 000553   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 000554   450001 713400                    CLIMB   alt,close
        14 000555   406000 401760                    pmme    nvectors=13
        14 000556   000560 702000 14                 TSX2    s:21094
        14 000557   000560 710000 14                 TRA     s:21094

      242    21092    5                  WHENALTRETURN DO;

      243    21093    5                    END;

      244    21094    4                 IF I = 0 THEN RETURN;

  21094 14 000560   000345 235000 2                  LDA     I
        14 000561   000564 601000 14                 TNZ     s:21094+4

  21094 14 000562   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 000563   000001 702211                    TSX2  ! 1,X1
        14 000564   000633 710000 14                 TRA     s:21118

      245    21095
      246    21096    4                 END;
      247    21097    3              WHENALTRETURN
      248    21098    4              DO;

      249    21099
      250    21100    4                 IF B$TCB.ALT$->B$EXCFR.ERR.ERR# ~= %E$NOFILE

  21100 14 000565   000000 470400 xsym               LDP0    B$TCB$
        14 000566   000000 471500                    LDP1    0,,PR0
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:64   
        14 000567   100102 236100                    LDQ     66,,PR1
        14 000570   377770 376007                    ANQ     131064,DL
        14 000571   001610 116007                    CMPQ    904,DL
        14 000572   000634 601000 14                 TNZ     ERR

      251    21101    4                 THEN
      252    21102    4                    GOTO ERR;
      253    21103
      254    21104    4                 OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;

  21104 14 000573   003000 236007                    LDQ     1536,DL
        14 000574   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      255    21105    4                 OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;

  21105 14 000575   000600 236007                    LDQ     384,DL
        14 000576   000272 256000 2                  ORSQ    OPEN_ARCHIVE_FILE+36

      256    21106    4                 OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;

  21106 14 000577   000001 335007                    LCA     1,DL
        14 000600   000305 755000 2                  STA     OPEN_ARCHIVE_FILE+47

      257    21107    4                 CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ERR);

  21107 14 000601   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 000602   450000 713400                    CLIMB   alt,open
        14 000603   410400 401760                    pmme    nvectors=18
        14 000604   000634 702000 14                 TSX2    ERR

      258    21108
      259    21109    4                 WRITE_ARCHIVE_REC.BUF_ = VECTOR(ARCHIVE_REC_SIZE);

  21109 14 000605   000030 237000 15                 LDAQ    24
        14 000606   000160 757000 2                  STAQ    WRITE_ARCHIVE_REC+4

      260    21110    4                 CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:65   

  21110 14 000607   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 000610   440001 713400                    CLIMB   alt,write
        14 000611   401400 401760                    pmme    nvectors=4
        14 000612   000634 702000 14                 TSX2    ERR

      261    21111
      262    21112    4                 WRITE_ARCHIVE_REC.BUF_.BUF$ = START$;

  21112 14 000613   000357 236000 2                  LDQ     START$
        14 000614   000161 756000 2                  STQ     WRITE_ARCHIVE_REC+5

      263    21113    4                 WRITE_ARCHIVE_REC.BUF_.BOUND = SIZE * 4 - 1;

  21113 14 000615   000351 236000 2                  LDQ     SIZE
        14 000616   000002 736000                    QLS     2
        14 000617   000001 136007                    SBLQ    1,DL
        14 000620   000020 736000                    QLS     16
        14 000621   000160 676000 2                  ERQ     WRITE_ARCHIVE_REC+4
        14 000622   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 000623   000160 656000 2                  ERSQ    WRITE_ARCHIVE_REC+4

      264    21114    4                 CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);

  21114 14 000624   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 000625   440001 713400                    CLIMB   alt,write
        14 000626   401400 401760                    pmme    nvectors=4
        14 000627   000634 702000 14                 TSX2    ERR

      265    21115    4                  CALL M$CLOSE(CLOSE_ARCHIVE);

  21115 14 000630   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 000631   050001 713400                    CLIMB   close
        14 000632   406000 401760                    pmme    nvectors=13

      266    21116
      267    21117    4              END;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:66   

      268    21118    4              DO WHILE('0'B);

  21118 14 000633   000650 710000 14                 TRA     s:21125

      269    21119    4   ERR:          CALL FLI$RPT_ERR;

  21119 14 000634   000002 631400 xsym  ERR          EPPR1   B_VECTNIL+2
        14 000635   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 000636   000000 011000                    NOP     0

      270    21120    4   ERR1:         CALL M$CLOSE(CLOSE_ARCHIVE)

  21120 14 000637   000170 630400 2     ERR1         EPPR0   CLOSE_ARCHIVE
        14 000640   450001 713400                    CLIMB   alt,close
        14 000641   406000 401760                    pmme    nvectors=13
        14 000642   000644 702000 14                 TSX2    s:21123
        14 000643   000644 710000 14                 TRA     s:21123

      271    21121    5                 WHENALTRETURN DO;

      272    21122    5                   END;

      273    21123    4                 IF I = 0 THEN RETURN;

  21123 14 000644   000345 235000 2                  LDA     I
        14 000645   000650 601000 14                 TNZ     s:21125

  21123 14 000646   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 000647   000001 702211                    TSX2  ! 1,X1

      274    21124    4               END;

      275    21125    3              END; /* DO I = 0 TO DPLIST.NUM#            */

  21125 14 000650   000345 235000 2                  LDA     I
        14 000651   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:67   
        14 000652   000345 755000 2                  STA     I
        14 000653   000000 470400 xsym               LDP0    DPLIST$
        14 000654   000345 236000 2                  LDQ     I
        14 000655   000660 604000 14                 TMI     s:21126
        14 000656   000000 116100                    CMPQ    0,,PR0
        14 000657   000433 604000 14                 TMI     s:21051

      276    21126    2           RETURN;

  21126 14 000660   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 000661   000001 702211                    TSX2  ! 1,X1

      277    21127    2   END FLE_ESTABLISH;
      278    21128        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:68   
      279    21129    1   FLE_MODIFY:PROC;

  21129 14 000662   200004 741300       FLE_MODIFY   STX1  ! @COMMAND+1,,AUTO

      280    21130        /*F*  NAME:  FLE_MODIFY
      281    21131              PURPOSE: Perform MODIFY command for the archive system.
      282    21132                       This routine updates the :ARCHIVE.$$EFT and thereby
      283    21133                       instructs EFT to start a new tapeset with changed
      284    21134                       attributes at the next ARCHIVE run.
      285    21135        ***/
      286    21136
      287    21137        /***
      288    21138         ***  Open the :ARCHIVE.$$EFT to get the ARCHIVE information.
      289    21139         ***/
      290    21140
      291    21141    2           DPSN.SN#(0) = DPLIST.SN#(0);

  21141 14 000663   000000 470400 xsym               LDP0    DPLIST$
        14 000664   040000 100500                    MLR     fill='040'O
        14 000665   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
        14 000666   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      292    21142    2           OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;

  21142 14 000667   001000 236007                    LDQ     512,DL
        14 000670   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      293    21143    2           CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT);

  21143 14 000671   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 000672   450000 713400                    CLIMB   alt,open
        14 000673   410400 401760                    pmme    nvectors=18
        14 000674   001506 702000 14                 TSX2    ALT

      294    21144
      295    21145    2           READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:69   
  21145 14 000675   000030 237000 15                 LDAQ    24
        14 000676   000324 757000 2                  STAQ    READ_ARCHIVE_FILE+4

      296    21146    2           CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT);

  21146 14 000677   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 000700   440000 713400                    CLIMB   alt,read
        14 000701   401400 401760                    pmme    nvectors=4
        14 000702   001506 702000 14                 TSX2    ALT

      297    21147
      298    21148    2           CALL FLI$ALLOC(ARCHIVE_REC_SIZE,START$);

  21148 14 000703   000032 630400 15                 EPPR0   26
        14 000704   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000705   000000 701000 xent               TSX1    FLI$ALLOC
        14 000706   000000 011000                    NOP     0

      299    21149    2           READ_ARCHIVE_FILE.BUF_.BUF$ = START$;

  21149 14 000707   000357 236000 2                  LDQ     START$
        14 000710   000325 756000 2                  STQ     READ_ARCHIVE_FILE+5

      300    21150    2           READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;

  21150 14 000711   000356 236000 2                  LDQ     ARCHIVE_REC_SIZE
        14 000712   000002 736000                    QLS     2
        14 000713   000001 136007                    SBLQ    1,DL
        14 000714   000020 736000                    QLS     16
        14 000715   000324 676000 2                  ERQ     READ_ARCHIVE_FILE+4
        14 000716   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 000717   000324 656000 2                  ERSQ    READ_ARCHIVE_FILE+4

      301    21151    2           CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT);

  21151 14 000720   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 000721   440000 713400                    CLIMB   alt,read
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:70   
        14 000722   401400 401760                    pmme    nvectors=4
        14 000723   001506 702000 14                 TSX2    ALT

      302    21152        /***
      303    21153         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      304    21154         ***/
      305    21155    2           IF START$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)

  21155 14 000724   000357 470400 2                  LDP0    START$
        14 000725   000000 236100                    LDQ     0,,PR0
        14 000726   777000 376003                    ANQ     -512,DU
        14 000727   777000 116003                    CMPQ    -512,DU
        14 000730   000742 600000 14                 TZE     s:21162

      306    21156    2           THEN
      307    21157    3           DO;

      308    21158    3              CALL FLI$CNVRT_ARCHIVE(START$,TPTR$);

  21158 14 000731   000034 630400 15                 EPPR0   28
        14 000732   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000733   000000 701000 xent               TSX1    FLI$CNVRT_ARCHIVE
        14 000734   000000 011000                    NOP     0

      309    21159    3              START$ = TPTR$;

  21159 14 000735   000361 236000 2                  LDQ     TPTR$
        14 000736   000357 756000 2                  STQ     START$

      310    21160    3              ARCHIVE_REC_SIZE = START$->ARCHIVE_LIST.SIZE;

  21160 14 000737   000357 470400 2                  LDP0    START$
        14 000740   000002 235100                    LDA     2,,PR0
        14 000741   000356 755000 2                  STA     ARCHIVE_REC_SIZE

      311    21161    3              END;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:71   
      312    21162    2           AVAIL$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.DPLIST);

  21162 14 000742   000003 720100                    LXL0    3,,PR0
        14 000743   000000 636010                    EAQ     0,X0
        14 000744   000357 036000 2                  ADLQ    START$
        14 000745   000353 756000 2                  STQ     AVAIL$

      313    21163
      314    21164        /***
      315    21165         *** Check if the type of archive file being modified(tape or optical disk) is
      316    21166         *** the same as specified on the command. Output error if otherwise.
      317    21167         *** Do not permit as the attributes for tapes may not apply to optical disk.
      318    21168         ***/
      319    21169    2           IF NBR_SNLISTS > 0      /* Any serial numbers spec'd on this command? */

  21169 14 000746   000000 235000 xsym               LDA     NBR_SNLISTS
        14 000747   001000 604400 14                 TMOZ    s:21188

      320    21170    2           THEN
      321    21171    3           DO;

      322    21172    3              IF (TAPE_OPEN.V.RES# = 'LT' AND START$->ARCHIVE_LIST.OD)

  21172 14 000750   040000 106400                    CMPC    fill='040'O
        14 000751   000050 000004 xsym               ADSC9   TAPE_OPEN+40             cn=0,n=4
        14 000752   000001 000002 13                 ADSC9   1                        cn=0,n=2
        14 000753   000757 601000 14                 TNZ     s:21172+7
        14 000754   000006 236100                    LDQ     6,,PR0
        14 000755   000200 316003                    CANQ    128,DU
        14 000756   000766 601000 14                 TNZ     s:21176
        14 000757   040000 106400                    CMPC    fill='040'O
        14 000760   000050 000004 xsym               ADSC9   TAPE_OPEN+40             cn=0,n=4
        14 000761   000000 000002 13                 ADSC9   0                        cn=0,n=2
        14 000762   001000 601000 14                 TNZ     s:21188
        14 000763   000006 236100                    LDQ     6,,PR0
        14 000764   000200 316003                    CANQ    128,DU
        14 000765   001000 601000 14                 TNZ     s:21188
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:72   

      323    21173    3              OR (TAPE_OPEN.V.RES# = 'OD' AND NOT START$->ARCHIVE_LIST.OD)
      324    21174    3                THEN
      325    21175    4                DO;

      326    21176    4                  CALL FLI$RPT_ERR(E_TYPE_ARCHIVE_SET);

  21176 14 000766   000036 630400 15                 EPPR0   30
        14 000767   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000770   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 000771   000000 011000                    NOP     0

      327    21177    4                  CALL M$CLOSE(CLOSE_ARCHIVE) ALTRET(ALT);

  21177 14 000772   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 000773   450001 713400                    CLIMB   alt,close
        14 000774   406000 401760                    pmme    nvectors=13
        14 000775   001506 702000 14                 TSX2    ALT

      328    21178    4                  RETURN;

  21178 14 000776   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 000777   000001 702211                    TSX2  ! 1,X1

      329    21179    4                END;
      330    21180    3           END;
      331    21181
      332    21182        /***
      333    21183         *** Check if it is the master packset. If yes, then updates
      334    21184         *** :ARCHIVE.$$EFT. If not, the error message will be issued
      335    21185         *** and return to command level.
      336    21186         ***/
      337    21187
      338    21188    2           IF AVAIL$->VLP_SN.SN#(0) = DPLIST.SN#(0)

  21188 14 001000   000353 471400 2                  LDP1    AVAIL$
        14 001001   000000 473400 xsym               LDP3    DPLIST$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:73   
        14 001002   040100 106500                    CMPC    fill='040'O
        14 001003   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6
        14 001004   300001 000006                    ADSC9   1,,PR3                   cn=0,n=6
        14 001005   001475 601000 14                 TNZ     s:21353

      339    21189    2           THEN
      340    21190    3           DO;

      341    21191
      342    21192        /***
      343    21193         ***  Updates the changed attibutes.
      344    21194         ***/
      345    21195
      346    21196    3              IF TAPE_OPTION.DENSITY

  21196 14 001006   000002 234000 xsym               SZN     TAPE_OPTION+2
        14 001007   001032 605000 14                 TPL     s:21209

      347    21197    3                THEN
      348    21198    4                  DO;

      349    21199    4                     IF (NBR_SNLISTS = 0

  21199 14 001010   000000 115003                    CMPA    0,DU
        14 001011   001027 601000 14                 TNZ     s:21207
        14 001012   000006 236100                    LDQ     6,,PR0
        14 001013   000200 316003                    CANQ    128,DU
        14 001014   001027 600000 14                 TZE     s:21207

      350    21200    4                       AND START$->ARCHIVE_LIST.OD)
      351    21201    4                       THEN
      352    21202    5                       DO;

      353    21203    5                         CALL FLI$RPT_ERR(E_CANT_SPECIFY_DENSITY);

  21203 14 001015   000037 630400 15                 EPPR0   31
        14 001016   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:74   
        14 001017   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001020   000000 011000                    NOP     0

      354    21204    5                         CALL M$CLOSE(CLOSE_ARCHIVE)  ALTRET(ALT);

  21204 14 001021   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001022   450001 713400                    CLIMB   alt,close
        14 001023   406000 401760                    pmme    nvectors=13
        14 001024   001506 702000 14                 TSX2    ALT

      355    21205    5                         RETURN;

  21205 14 001025   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 001026   000001 702211                    TSX2  ! 1,X1

      356    21206    5                       END;
      357    21207    4                     START$->ARCHIVE_LIST.OPTION.DEN = TAPE_OPEN.V.DENSITY#;

  21207 14 001027   000066 236000 xsym               LDQ     TAPE_OPEN+54
        14 001030   000036 736000                    QLS     30
        14 001031   000007 752140                    STCQ    7,'40'O,PR0

      358    21208    4                  END;

      359    21209    3              IF TAPE_OPTION.VOLACCESS

  21209 14 001032   000002 236000 xsym               LDQ     TAPE_OPTION+2
        14 001033   200000 316003                    CANQ    65536,DU
        14 001034   001043 600000 14                 TZE     s:21212

      360    21210    3                THEN
      361    21211    3                 START$->ARCHIVE_LIST.OPTION.VOLA = TAPE_OPEN.V.VOLACCESS#;

  21211 14 001035   000357 470400 2                  LDP0    START$
        14 001036   000063 236000 xsym               LDQ     TAPE_OPEN+51
        14 001037   000011 736000                    QLS     9
        14 001040   000007 676100                    ERQ     7,,PR0
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:75   
        14 001041   007000 376003                    ANQ     3584,DU
        14 001042   000007 656100                    ERSQ    7,,PR0

      362    21212    3              IF TAPE_OPTION.EXPIRE

  21212 14 001043   000002 236000 xsym               LDQ     TAPE_OPTION+2
        14 001044   100000 316003                    CANQ    32768,DU
        14 001045   001072 600000 14                 TZE     s:21225

      363    21213    3                THEN
      364    21214    4                  DO;

      365    21215    4                     IF (NBR_SNLISTS = 0

  21215 14 001046   000000 115003                    CMPA    0,DU
        14 001047   001066 601000 14                 TNZ     s:21223
        14 001050   000357 470400 2                  LDP0    START$
        14 001051   000006 236100                    LDQ     6,,PR0
        14 001052   000200 316003                    CANQ    128,DU
        14 001053   001066 600000 14                 TZE     s:21223

      366    21216    4                       AND START$->ARCHIVE_LIST.OD)
      367    21217    4                       THEN
      368    21218    5                       DO;

      369    21219    5                         CALL FLI$RPT_ERR(E_CANT_SPECIFY_EXPIRE);

  21219 14 001054   000040 630400 15                 EPPR0   32
        14 001055   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 001056   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001057   000000 011000                    NOP     0

      370    21220    5                         CALL M$CLOSE(CLOSE_ARCHIVE)  ALTRET(ALT);

  21220 14 001060   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001061   450001 713400                    CLIMB   alt,close
        14 001062   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:76   
        14 001063   001506 702000 14                 TSX2    ALT

      371    21221    5                         RETURN;

  21221 14 001064   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 001065   000001 702211                    TSX2  ! 1,X1

      372    21222    5                       END;
      373    21223    4                     START$->ARCHIVE_LIST.OPTION.DEN = TAPE_OPEN.V.DENSITY#;

  21223 14 001066   000357 470400 2                  LDP0    START$
        14 001067   000066 236000 xsym               LDQ     TAPE_OPEN+54
        14 001070   000036 736000                    QLS     30
        14 001071   000007 752140                    STCQ    7,'40'O,PR0

      374    21224    4                  END;

      375    21225    3              IF TAPE_OPTION.BLOCK

  21225 14 001072   000002 236000 xsym               LDQ     TAPE_OPTION+2
        14 001073   040000 316003                    CANQ    16384,DU
        14 001074   001100 600000 14                 TZE     s:21228

      376    21226    3                THEN
      377    21227    3                  START$->ARCHIVE_LIST.OPTION.BLOCK = TAPE_OPEN.V.BLKL#;

  21227 14 001075   000052 220000 xsym               LDX0    TAPE_OPEN+42
        14 001076   000357 470400 2                  LDP0    START$
        14 001077   000007 440100                    SXL0    7,,PR0

      378    21228    3              IF TAPE_OPTION.CHECK_SPECD

  21228 14 001100   000000 236000 xsym               LDQ     TAPE_OPTION
        14 001101   200000 316003                    CANQ    65536,DU
        14 001102   001110 600000 14                 TZE     s:21232

      379    21229    3                THEN
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:77   
      380    21230    3                  START$->ARCHIVE_LIST.OPTION.CHECK = TAPE_OPTION.CHECK;

  21230 14 001103   000357 470400 2                  LDP0    START$
        14 001104   000011 772000                    QRL     9
        14 001105   000007 676100                    ERQ     7,,PR0
        14 001106   000400 376003                    ANQ     256,DU
        14 001107   000007 656100                    ERSQ    7,,PR0

      381    21231
      382    21232    3              IF TAPE_OPTION.IOERRORC_SPECD

  21232 14 001110   000002 236000 xsym               LDQ     TAPE_OPTION+2
        14 001111   004000 316003                    CANQ    2048,DU
        14 001112   001120 600000 14                 TZE     s:21236

      383    21233    3               THEN
      384    21234    3                 START$->ARCHIVE_LIST.OPTION.IOERRORC = TAPE_OPTION.IOERRORC;

  21234 14 001113   000357 470400 2                  LDP0    START$
        14 001114   000005 772000                    QRL     5
        14 001115   000007 676100                    ERQ     7,,PR0
        14 001116   000200 376003                    ANQ     128,DU
        14 001117   000007 656100                    ERSQ    7,,PR0

      385    21235
      386    21236    3              IF NBR_SNLISTS = 0

  21236 14 001120   000000 115003                    CMPA    0,DU
        14 001121   001360 600000 14                 TZE     s:21323

      387    21237    3              THEN;
      388    21238    3              ELSE
      389    21239    4              DO;

      390    21240        /***
      391    21241         ***   Check that the same number of tapesets was specified as on the
      392    21242         ***   original ESTABLISH command. This is enforced to keep both tapesets
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:78   
      393    21243         ***   in sync.
      394    21244         ***/
      395    21245    4                IF (START$->ARCHIVE_LIST.OFFSET.SNLIST2 ~= 0

  21245 14 001122   000357 470400 2                  LDP0    START$
        14 001123   000005 235100                    LDA     5,,PR0
        14 001124   001130 600000 14                 TZE     s:21245+6
        14 001125   000000 236000 xsym               LDQ     NBR_SNLISTS
        14 001126   000001 116007                    CMPQ    1,DL
        14 001127   001135 600000 14                 TZE     s:21251
        14 001130   000000 115003                    CMPA    0,DU
        14 001131   001147 601000 14                 TNZ     s:21261
        14 001132   000000 236000 xsym               LDQ     NBR_SNLISTS
        14 001133   000002 116007                    CMPQ    2,DL
        14 001134   001147 601000 14                 TNZ     s:21261

      396    21246    4                  AND NBR_SNLISTS = 1)
      397    21247    4                OR (START$->ARCHIVE_LIST.OFFSET.SNLIST2 = 0
      398    21248    4                  AND NBR_SNLISTS = 2)
      399    21249    4                  THEN
      400    21250    5                  DO;

      401    21251    5                    CALL FLI$RPT_ERR(E_NUM_ARCHIVE_SETS);

  21251 14 001135   000041 630400 15                 EPPR0   33
        14 001136   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 001137   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001140   000000 011000                    NOP     0

      402    21252    5                    CALL M$CLOSE(CLOSE_ARCHIVE)  ALTRET(ALT);

  21252 14 001141   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001142   450001 713400                    CLIMB   alt,close
        14 001143   406000 401760                    pmme    nvectors=13
        14 001144   001506 702000 14                 TSX2    ALT

      403    21253    5                    RETURN;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:79   

  21253 14 001145   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 001146   000001 702211                    TSX2  ! 1,X1

      404    21254    5                  END;
      405    21255
      406    21256        /***
      407    21257         ***   Make sure to allocate enough memory to update the
      408    21258         ***   :ARCHIVE file.
      409    21259         ***/
      410    21260
      411    21261    4                 AVAIL$ = SNLISTINFO.SNLIST$;

  21261 14 001147   000000 471400 xsym               LDP1    LAST_SNLISTINFO$
        14 001150   100000 236100                    LDQ     0,,PR1
        14 001151   000353 756000 2                  STQ     AVAIL$

      412    21262    4                 SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM#*LENGTHC(
             21262                          VLP_SN.SN#(0))+3)/4;

  21262 14 001152   000353 474400 2                  LDP4    AVAIL$
        14 001153   400000 236100                    LDQ     0,,PR4
        14 001154   000006 402007                    MPY     6,DL
        14 001155   000007 036007                    ADLQ    7,DL
        14 001156   000004 506007                    DIV     4,DL
        14 001157   000355 756000 2                  STQ     SNSIZE

      413    21263    4                 DPSIZE = START$->ARCHIVE_LIST.OFFSET.SNLIST - START$->ARCHIVE_LIST.
             21263                          OFFSET.DPLIST;

  21263 14 001160   000004 236100                    LDQ     4,,PR0
        14 001161   000003 136100                    SBLQ    3,,PR0
        14 001162   000344 756000 2                  STQ     DPSIZE

      414    21264    4                 SIZE = DPSIZE + (NBR_SNLISTS * SNSIZE) + SIZEW(ARCHIVE_LIST);

  21264 14 001163   000000 236000 xsym               LDQ     NBR_SNLISTS
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:80   
        14 001164   000355 402000 2                  MPY     SNSIZE
        14 001165   000344 036000 2                  ADLQ    DPSIZE
        14 001166   000011 036007                    ADLQ    9,DL
        14 001167   000351 756000 2                  STQ     SIZE

      415    21265    4                 CALL FLI$ALLOC(SIZE,BUF$);

  21265 14 001170   000042 630400 15                 EPPR0   34
        14 001171   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001172   000000 701000 xent               TSX1    FLI$ALLOC
        14 001173   000000 011000                    NOP     0

      416    21266
      417    21267        /***
      418    21268         ***   Move ARCHIVE_LIST from old record to new buffer.
      419    21269         ***/
      420    21270
      421    21271    4                  BUF$->ARCHIVE_LIST = START$->ARCHIVE_LIST;

  21271 14 001174   000357 470400 2                  LDP0    START$
        14 001175   000360 471400 2                  LDP1    BUF$
        14 001176   000100 100500                    MLR     fill='000'O
        14 001177   000000 000044                    ADSC9   0,,PR0                   cn=0,n=36
        14 001200   100000 000044                    ADSC9   0,,PR1                   cn=0,n=36

      422    21272    4                  AVAIL$ = PINCRW(BUF$,SIZEW(ARCHIVE_LIST));

  21272 14 001201   000360 236000 2                  LDQ     BUF$
        14 001202   000011 036003                    ADLQ    9,DU
        14 001203   000353 756000 2                  STQ     AVAIL$

      423    21273    4                  TPTR$ = PINCRW(START$,SIZEW(ARCHIVE_LIST));

  21273 14 001204   000357 236000 2                  LDQ     START$
        14 001205   000011 036003                    ADLQ    9,DU
        14 001206   000361 756000 2                  STQ     TPTR$

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:81   
      424    21274
      425    21275        /***
      426    21276         ***   Move disk packsets list to new buffer.
      427    21277         ***/
      428    21278
      429    21279    5                  DO I = 0 TO TPTR$->VLP_SN.NUM# - 1;

  21279 14 001207   000345 450000 2                  STZ     I
        14 001210   001223 710000 14                 TRA     s:21281+3

      430    21280    5                    AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);

  21280 14 001211   000345 236000 2                  LDQ     I
        14 001212   000006 402007                    MPY     6,DL
        14 001213   000361 470400 2                  LDP0    TPTR$
        14 001214   000353 471400 2                  LDP1    AVAIL$
        14 001215   040106 100506                    MLR     fill='040'O
        14 001216   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 001217   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      431    21281    5                  END;

  21281 14 001220   000345 235000 2                  LDA     I
        14 001221   000001 035007                    ADLA    1,DL
        14 001222   000345 755000 2                  STA     I
        14 001223   000361 470400 2                  LDP0    TPTR$
        14 001224   000345 236000 2                  LDQ     I
        14 001225   001230 604000 14                 TMI     s:21282
        14 001226   000000 116100                    CMPQ    0,,PR0
        14 001227   001211 604000 14                 TMI     s:21280

      432    21282    4                  AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;

  21282 14 001230   000353 471400 2                  LDP1    AVAIL$
        14 001231   000000 235100                    LDA     0,,PR0
        14 001232   100000 755100                    STA     0,,PR1

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:82   
      433    21283    4                  AVAIL$ = PINCRW(BUF$,BUF$->ARCHIVE_LIST.OFFSET.SNLIST);

  21283 14 001233   000360 470400 2                  LDP0    BUF$
        14 001234   000004 720100                    LXL0    4,,PR0
        14 001235   000000 636010                    EAQ     0,X0
        14 001236   000360 036000 2                  ADLQ    BUF$
        14 001237   000353 756000 2                  STQ     AVAIL$

      434    21284
      435    21285        /***
      436    21286         ***  Move new tapeset to new buffer.
      437    21287         ***/
      438    21288
      439    21289    4                  IF NBR_SNLISTS > 1

  21289 14 001240   000000 235000 xsym               LDA     NBR_SNLISTS
        14 001241   000001 115007                    CMPA    1,DL
        14 001242   001250 604400 14                 TMOZ    s:21293

      440    21290    4                    THEN
      441    21291    4                      TPTR$ = SNLISTINFO.PREVINFO$->SNLISTINFO.SNLIST$;

  21291 14 001243   000000 471400 xsym               LDP1    LAST_SNLISTINFO$
        14 001244   100001 473500                    LDP3    1,,PR1
        14 001245   300000 236100                    LDQ     0,,PR3
        14 001246   000361 756000 2                  STQ     TPTR$
        14 001247   001253 710000 14                 TRA     s:21294

      442    21292    4                    ELSE
      443    21293    4                      TPTR$ = SNLISTINFO.SNLIST$;

  21293 14 001250   000000 471400 xsym               LDP1    LAST_SNLISTINFO$
        14 001251   100000 236100                    LDQ     0,,PR1
        14 001252   000361 756000 2                  STQ     TPTR$

      444    21294    5                 DO I = 0 TO SNLISTINFO.SNLIST$->VLP_SN.NUM#-1;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:83   
  21294 14 001253   000345 450000 2                  STZ     I
        14 001254   001267 710000 14                 TRA     s:21296+3

      445    21295    5                   AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);

  21295 14 001255   000345 236000 2                  LDQ     I
        14 001256   000006 402007                    MPY     6,DL
        14 001257   000361 470400 2                  LDP0    TPTR$
        14 001260   000353 471400 2                  LDP1    AVAIL$
        14 001261   040106 100506                    MLR     fill='040'O
        14 001262   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 001263   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      446    21296    5                    END;

  21296 14 001264   000345 235000 2                  LDA     I
        14 001265   000001 035007                    ADLA    1,DL
        14 001266   000345 755000 2                  STA     I
        14 001267   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 001270   000000 471500                    LDP1    0,,PR0
        14 001271   000345 236000 2                  LDQ     I
        14 001272   001275 604000 14                 TMI     s:21297
        14 001273   100000 116100                    CMPQ    0,,PR1
        14 001274   001255 604000 14                 TMI     s:21295

      447    21297    4                 AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;

  21297 14 001275   000361 473400 2                  LDP3    TPTR$
        14 001276   000353 474400 2                  LDP4    AVAIL$
        14 001277   300000 235100                    LDA     0,,PR3
        14 001300   400000 755100                    STA     0,,PR4

      448    21298
      449    21299    4                 IF NBR_SNLISTS > 1

  21299 14 001301   000000 235000 xsym               LDA     NBR_SNLISTS
        14 001302   000001 115007                    CMPA    1,DL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:84   
        14 001303   001336 604400 14                 TMOZ    s:21308

      450    21300    4                   THEN
      451    21301    5                   DO;

      452    21302    5                     AVAIL$ = PINCRW(AVAIL$,SNSIZE);

  21302 14 001304   000355 236000 2                  LDQ     SNSIZE
        14 001305   000022 736000                    QLS     18
        14 001306   000353 036000 2                  ADLQ    AVAIL$
        14 001307   000353 756000 2                  STQ     AVAIL$

      453    21303    6                     DO I = 0 TO SNLISTINFO.SNLIST$->VLP_SN.NUM#-1;

  21303 14 001310   000345 450000 2                  STZ     I
        14 001311   001325 710000 14                 TRA     s:21305+3

      454    21304    6                       AVAIL$->VLP_SN.SN#(I) = SNLISTINFO.SNLIST$->VLP_SN.SN#(I);

  21304 14 001312   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 001313   000000 471500                    LDP1    0,,PR0
        14 001314   000345 236000 2                  LDQ     I
        14 001315   000006 402007                    MPY     6,DL
        14 001316   000353 473400 2                  LDP3    AVAIL$
        14 001317   040106 100506                    MLR     fill='040'O
        14 001320   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6
        14 001321   300001 000006                    ADSC9   1,Q,PR3                  cn=0,n=6

      455    21305    6                       END;

  21305 14 001322   000345 235000 2                  LDA     I
        14 001323   000001 035007                    ADLA    1,DL
        14 001324   000345 755000 2                  STA     I
        14 001325   000000 470400 xsym               LDP0    LAST_SNLISTINFO$
        14 001326   000000 471500                    LDP1    0,,PR0
        14 001327   000345 236000 2                  LDQ     I
        14 001330   001333 604000 14                 TMI     s:21306
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:85   
        14 001331   100000 116100                    CMPQ    0,,PR1
        14 001332   001312 604000 14                 TMI     s:21304

      456    21306    5                     AVAIL$->VLP_SN.NUM# = SNLISTINFO.SNLIST$->VLP_SN.NUM#;

  21306 14 001333   000353 473400 2                  LDP3    AVAIL$
        14 001334   100000 235100                    LDA     0,,PR1
        14 001335   300000 755100                    STA     0,,PR3

      457    21307    5                   END;

      458    21308    4                  IF NBR_SNLISTS > 1

  21308 14 001336   000000 235000 xsym               LDA     NBR_SNLISTS
        14 001337   000001 115007                    CMPA    1,DL
        14 001340   001346 604400 14                 TMOZ    s:21312

      459    21309    4                    THEN
      460    21310    4                    BUF$->ARCHIVE_LIST.OFFSET.SNLIST2 = BUF$->ARCHIVE_LIST.OFFSET.
             21310                             SNLIST+SNSIZE;

  21310 14 001341   000360 470400 2                  LDP0    BUF$
        14 001342   000004 236100                    LDQ     4,,PR0
        14 001343   000355 036000 2                  ADLQ    SNSIZE
        14 001344   000005 756100                    STQ     5,,PR0
        14 001345   001350 710000 14                 TRA     s:21313

      461    21311    4                    ELSE
      462    21312    4                    BUF$->ARCHIVE_LIST.OFFSET.SNLIST2 = 0;

  21312 14 001346   000360 470400 2                  LDP0    BUF$
        14 001347   000005 450100                    STZ     5,,PR0

      463    21313    4                  BUF$->ARCHIVE_LIST.XTEND = %NO#;

  21313 14 001350   000360 470400 2                  LDP0    BUF$
        14 001351   000013 236000 15                 LDQ     11
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:86   
        14 001352   000006 356100                    ANSQ    6,,PR0

      464    21314    4                  BUF$->ARCHIVE_LIST.SIZE = SIZE;

  21314 14 001353   000360 470400 2                  LDP0    BUF$
        14 001354   000351 235000 2                  LDA     SIZE
        14 001355   000002 755100                    STA     2,,PR0

      465    21315    4                  ARCHIVE_REC_SIZE = SIZE;

  21315 14 001356   000351 235000 2                  LDA     SIZE
        14 001357   000356 755000 2                  STA     ARCHIVE_REC_SIZE

      466    21316    4                 END;

      467    21317
      468    21318        /***
      469    21319         *** Write the updated record back to :ARCHIVE.$$EFT for both
      470    21320         *** master packset and member packsets.
      471    21321         ***/
      472    21322
      473    21323    3                  CALL M$CLOSE(CLOSE_ARCHIVE) ALTRET(ALT);

  21323 14 001360   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001361   450001 713400                    CLIMB   alt,close
        14 001362   406000 401760                    pmme    nvectors=13
        14 001363   001506 702000 14                 TSX2    ALT

      474    21324    3                  AVAIL$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.DPLIST);

  21324 14 001364   000357 470400 2                  LDP0    START$
        14 001365   000003 720100                    LXL0    3,,PR0
        14 001366   000000 636010                    EAQ     0,X0
        14 001367   000357 036000 2                  ADLQ    START$
        14 001370   000353 756000 2                  STQ     AVAIL$

      475    21325    3                    OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:87   

  21325 14 001371   003000 236007                    LDQ     1536,DL
        14 001372   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      476    21326    3                    OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;

  21326 14 001373   000600 236007                    LDQ     384,DL
        14 001374   000272 256000 2                  ORSQ    OPEN_ARCHIVE_FILE+36

      477    21327    3                    OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;

  21327 14 001375   000001 335007                    LCA     1,DL
        14 001376   000305 755000 2                  STA     OPEN_ARCHIVE_FILE+47

      478    21328    4                  DO I = 0 TO AVAIL$->VLP_SN.NUM# - 1;

  21328 14 001377   000345 450000 2                  STZ     I
        14 001400   001467 710000 14                 TRA     s:21349+3

      479    21329    4                    DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(I);

  21329 14 001401   000345 236000 2                  LDQ     I
        14 001402   000006 402007                    MPY     6,DL
        14 001403   000353 470400 2                  LDP0    AVAIL$
        14 001404   040000 100506                    MLR     fill='040'O
        14 001405   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 001406   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      480    21330    4                    CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ERR);

  21330 14 001407   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 001410   450000 713400                    CLIMB   alt,open
        14 001411   410400 401760                    pmme    nvectors=18
        14 001412   001450 702000 14                 TSX2    ERR

      481    21331    4                    WRITE_ARCHIVE_REC.BUF_ = VECTOR(ARCHIVE_REC_SIZE);

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:88   
  21331 14 001413   000030 237000 15                 LDAQ    24
        14 001414   000160 757000 2                  STAQ    WRITE_ARCHIVE_REC+4

      482    21332    4                    CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);

  21332 14 001415   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 001416   440001 713400                    CLIMB   alt,write
        14 001417   401400 401760                    pmme    nvectors=4
        14 001420   001450 702000 14                 TSX2    ERR

      483    21333    4                    IF NBR_SNLISTS = 0

  21333 14 001421   000000 235000 xsym               LDA     NBR_SNLISTS
        14 001422   001426 601000 14                 TNZ     s:21337

      484    21334    4                      THEN
      485    21335    4                        WRITE_ARCHIVE_REC.BUF_.BUF$ = START$;

  21335 14 001423   000357 236000 2                  LDQ     START$
        14 001424   000161 756000 2                  STQ     WRITE_ARCHIVE_REC+5
        14 001425   001430 710000 14                 TRA     s:21338

      486    21336    4                      ELSE
      487    21337    4                        WRITE_ARCHIVE_REC.BUF_.BUF$ = BUF$;

  21337 14 001426   000360 236000 2                  LDQ     BUF$
        14 001427   000161 756000 2                  STQ     WRITE_ARCHIVE_REC+5

      488    21338    4                    WRITE_ARCHIVE_REC.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;

  21338 14 001430   000356 236000 2                  LDQ     ARCHIVE_REC_SIZE
        14 001431   000002 736000                    QLS     2
        14 001432   000001 136007                    SBLQ    1,DL
        14 001433   000020 736000                    QLS     16
        14 001434   000160 676000 2                  ERQ     WRITE_ARCHIVE_REC+4
        14 001435   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 001436   000160 656000 2                  ERSQ    WRITE_ARCHIVE_REC+4
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:89   

      489    21339    4                    CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);

  21339 14 001437   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 001440   440001 713400                    CLIMB   alt,write
        14 001441   401400 401760                    pmme    nvectors=4
        14 001442   001450 702000 14                 TSX2    ERR

      490    21340    4                    CALL M$CLOSE(CLOSE_ARCHIVE) ALTRET(ERR);

  21340 14 001443   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001444   450001 713400                    CLIMB   alt,close
        14 001445   406000 401760                    pmme    nvectors=13
        14 001446   001450 702000 14                 TSX2    ERR

      491    21341    5                    DO WHILE('0'B);

  21341 14 001447   001464 710000 14                 TRA     s:21349

      492    21342    5   ERR:
      493    21343    5                      CALL FLI$RPT_ERR;

  21343 14 001450   000002 631400 xsym  ERR          EPPR1   B_VECTNIL+2
        14 001451   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001452   000000 011000                    NOP     0

      494    21344    5                      CALL M$CLOSE(CLOSE_ARCHIVE)

  21344 14 001453   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001454   450001 713400                    CLIMB   alt,close
        14 001455   406000 401760                    pmme    nvectors=13
        14 001456   001460 702000 14                 TSX2    s:21347
        14 001457   001460 710000 14                 TRA     s:21347

      495    21345    6                      WHENALTRETURN DO;

      496    21346    6                        END;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:90   

      497    21347    5                      IF I = 0 THEN RETURN;

  21347 14 001460   000345 235000 2                  LDA     I
        14 001461   001464 601000 14                 TNZ     s:21349

  21347 14 001462   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 001463   000001 702211                    TSX2  ! 1,X1

      498    21348    5                    END;

      499    21349    4                 END; /* I = 0 TO AVAIL$->VLP_SN.NUM# - 1 */

  21349 14 001464   000345 235000 2                  LDA     I
        14 001465   000001 035007                    ADLA    1,DL
        14 001466   000345 755000 2                  STA     I
        14 001467   000353 470400 2                  LDP0    AVAIL$
        14 001470   000345 236000 2                  LDQ     I
        14 001471   001474 604000 14                 TMI     s:21350
        14 001472   000000 116100                    CMPQ    0,,PR0
        14 001473   001401 604000 14                 TMI     s:21329

      500    21350    3                END;

  21350 14 001474   001505 710000 14                 TRA     s:21356

      501    21351    2           ELSE
      502    21352    3           DO;

      503    21353    3              CALL FLI$RPT_ERR(E_NOT_ARCHIVE_MASTER,DCB#);

  21353 14 001475   000044 630400 15                 EPPR0   36
        14 001476   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001477   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001500   000000 011000                    NOP     0

      504    21354    3              CALL M$CLOSE(CLOSE_ARCHIVE) ALTRET(ALT);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:91   

  21354 14 001501   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001502   450001 713400                    CLIMB   alt,close
        14 001503   406000 401760                    pmme    nvectors=13
        14 001504   001506 702000 14                 TSX2    ALT

      505    21355    3           END;

      506    21356    3           DO WHILE('0'B);

  21356 14 001505   001514 710000 14                 TRA     s:21361

      507    21357    3   ALT:
      508    21358    3              CALL FLI$RPT_ERR;

  21358 14 001506   000002 631400 xsym  ALT          EPPR1   B_VECTNIL+2
        14 001507   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001510   000000 011000                    NOP     0

      509    21359    3              CALL M$CLOSE(CLOSE_ARCHIVE);

  21359 14 001511   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001512   050001 713400                    CLIMB   close
        14 001513   406000 401760                    pmme    nvectors=13

      510    21360    3              END;

      511    21361    2           RETURN;

  21361 14 001514   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 001515   000001 702211                    TSX2  ! 1,X1

      512    21362    2   END FLE_MODIFY;
      513    21363        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:92   
      514    21364    1   FLE_ADD:PROC;

  21364 14 001516   200004 741300       FLE_ADD      STX1  ! @COMMAND+1,,AUTO

      515    21365        /*F*  NAME:   FLE_ADD
      516    21366              PURPOSE:  Perform ADD command for the archive system.
      517    21367                        Adds a new packset to an existing group of packsets.
      518    21368        ***/
      519    21369
      520    21370        /***
      521    21371         *** Open the :ARCHIVE file to get the archive information.
      522    21372         ***/
      523    21373
      524    21374    2          DPSN.SN#(0) = DISK_DEST_SN.SN#(0);

  21374 14 001517   040000 100400                    MLR     fill='040'O
        14 001520   000001 000006 xsym               ADSC9   DISK_DEST_SN+1           cn=0,n=6
        14 001521   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      525    21375    2          OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;

  21375 14 001522   001000 236007                    LDQ     512,DL
        14 001523   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      526    21376    2          CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT1);

  21376 14 001524   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 001525   450000 713400                    CLIMB   alt,open
        14 001526   410400 401760                    pmme    nvectors=18
        14 001527   002335 702000 14                 TSX2    ALT1

      527    21377    2          READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);

  21377 14 001530   000030 237000 15                 LDAQ    24
        14 001531   000324 757000 2                  STAQ    READ_ARCHIVE_FILE+4

      528    21378    2          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT1);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:93   

  21378 14 001532   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 001533   440000 713400                    CLIMB   alt,read
        14 001534   401400 401760                    pmme    nvectors=4
        14 001535   002335 702000 14                 TSX2    ALT1

      529    21379    2          CALL FLI$ALLOC(ARCHIVE_REC_SIZE,START$);

  21379 14 001536   000032 630400 15                 EPPR0   26
        14 001537   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001540   000000 701000 xent               TSX1    FLI$ALLOC
        14 001541   000000 011000                    NOP     0

      530    21380    2          READ_ARCHIVE_FILE.BUF_.BUF$ = START$;

  21380 14 001542   000357 236000 2                  LDQ     START$
        14 001543   000325 756000 2                  STQ     READ_ARCHIVE_FILE+5

      531    21381    2          READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;

  21381 14 001544   000356 236000 2                  LDQ     ARCHIVE_REC_SIZE
        14 001545   000002 736000                    QLS     2
        14 001546   000001 136007                    SBLQ    1,DL
        14 001547   000020 736000                    QLS     16
        14 001550   000324 676000 2                  ERQ     READ_ARCHIVE_FILE+4
        14 001551   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 001552   000324 656000 2                  ERSQ    READ_ARCHIVE_FILE+4

      532    21382    2          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT1);

  21382 14 001553   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 001554   440000 713400                    CLIMB   alt,read
        14 001555   401400 401760                    pmme    nvectors=4
        14 001556   002335 702000 14                 TSX2    ALT1

      533    21383        /***
      534    21384         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:94   
      535    21385         ***/
      536    21386    2          IF START$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)

  21386 14 001557   000357 470400 2                  LDP0    START$
        14 001560   000000 236100                    LDQ     0,,PR0
        14 001561   777000 376003                    ANQ     -512,DU
        14 001562   777000 116003                    CMPQ    -512,DU
        14 001563   001575 600000 14                 TZE     s:21393

      537    21387    2          THEN
      538    21388    3          DO;

      539    21389    3             CALL FLI$CNVRT_ARCHIVE(START$,TPTR$);

  21389 14 001564   000034 630400 15                 EPPR0   28
        14 001565   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001566   000000 701000 xent               TSX1    FLI$CNVRT_ARCHIVE
        14 001567   000000 011000                    NOP     0

      540    21390    3             START$ = TPTR$;

  21390 14 001570   000361 236000 2                  LDQ     TPTR$
        14 001571   000357 756000 2                  STQ     START$

      541    21391    3             ARCHIVE_REC_SIZE = START$->ARCHIVE_LIST.SIZE;

  21391 14 001572   000357 470400 2                  LDP0    START$
        14 001573   000002 235100                    LDA     2,,PR0
        14 001574   000356 755000 2                  STA     ARCHIVE_REC_SIZE

      542    21392    3             END;

      543    21393    2          AVAIL$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.DPLIST);

  21393 14 001575   000003 720100                    LXL0    3,,PR0
        14 001576   000000 636010                    EAQ     0,X0
        14 001577   000357 036000 2                  ADLQ    START$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:95   
        14 001600   000353 756000 2                  STQ     AVAIL$

      544    21394        /***
      545    21395         *** If it is the master packset, then updates the :ARCHIVE file
      546    21396         *** as new packset is added. It also creates the :ARCHIVE file
      547    21397         *** on the new packset.
      548    21398         ***/
      549    21399
      550    21400    2          IF AVAIL$->VLP_SN.SN#(0) = DISK_DEST_SN.SN#(0)

  21400 14 001601   000353 471400 2                  LDP1    AVAIL$
        14 001602   040000 106500                    CMPC    fill='040'O
        14 001603   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6
        14 001604   000001 000006 xsym               ADSC9   DISK_DEST_SN+1           cn=0,n=6
        14 001605   002325 601000 14                 TNZ     s:21549

      551    21401    2            THEN
      552    21402    3            DO;

      553    21403    3                J = 0;

  21403 14 001606   000346 450000 2                  STZ     J

      554    21404    4                DO I = 0 TO AVAIL$->VLP_SN.NUM# - 1;

  21404 14 001607   000345 450000 2                  STZ     I
        14 001610   001627 710000 14                 TRA     s:21411+3

      555    21405    4                  IF DPLIST.SN#(0) = AVAIL$->VLP_SN.SN#(I)

  21405 14 001611   000345 236000 2                  LDQ     I
        14 001612   000006 402007                    MPY     6,DL
        14 001613   000000 470400 xsym               LDP0    DPLIST$
        14 001614   000353 471400 2                  LDP1    AVAIL$
        14 001615   040106 106500                    CMPC    fill='040'O
        14 001616   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
        14 001617   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:96   
        14 001620   001624 601000 14                 TNZ     s:21411

      556    21406    4                    THEN
      557    21407    5                    DO;

      558    21408    5                      J = 1;

  21408 14 001621   000001 235007                    LDA     1,DL
        14 001622   000346 755000 2                  STA     J

      559    21409    5                      EXIT;

  21409 14 001623   001624 710000 14                 TRA     s:21411

      560    21410    5                    END;
      561    21411    4                END;

  21411 14 001624   000345 235000 2                  LDA     I
        14 001625   000001 035007                    ADLA    1,DL
        14 001626   000345 755000 2                  STA     I
        14 001627   000345 236000 2                  LDQ     I
        14 001630   001633 604000 14                 TMI     s:21412
        14 001631   100000 116100                    CMPQ    0,,PR1
        14 001632   001611 604000 14                 TMI     s:21405

      562    21412    3                IF J = 1

  21412 14 001633   000346 235000 2                  LDA     J
        14 001634   000001 115007                    CMPA    1,DL
        14 001635   001647 601000 14                 TNZ     s:21421

      563    21413    3                  THEN
      564    21414    4                  DO;

      565    21415    4                    CALL FLI$RPT_ERR(E_MEMBER_OF_ARCHIVE,DCB#);

  21415 14 001636   000026 630400 15                 EPPR0   22
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:97   
        14 001637   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001640   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001641   000000 011000                    NOP     0

      566    21416    4                    CALL M$CLOSE(CLOSE_ARCHIVE);

  21416 14 001642   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001643   050001 713400                    CLIMB   close
        14 001644   406000 401760                    pmme    nvectors=13

      567    21417    4                    RETURN;

  21417 14 001645   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 001646   000001 702211                    TSX2  ! 1,X1

      568    21418    4                  END;
      569    21419    3                  ELSE
      570    21420    4                  DO;

      571    21421    4                    CALL M$CLOSE(CLOSE_ARCHIVE);

  21421 14 001647   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001650   050001 713400                    CLIMB   close
        14 001651   406000 401760                    pmme    nvectors=13

      572    21422
      573    21423    4                    DPSN.SN#(0) = DPLIST.SN#(0);

  21423 14 001652   000000 470400 xsym               LDP0    DPLIST$
        14 001653   040000 100500                    MLR     fill='040'O
        14 001654   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
        14 001655   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      574    21424
      575    21425    4                    CALL FLI$BUILD_$$EFT ( DPLIST.SN#(0) )

  21425 14 001656   000000 236000 xsym               LDQ     DPLIST$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:98   
        14 001657   000001 036003                    ADLQ    1,DU
        14 001660   200010 756100                    STQ     @COMMAND+5,,AUTO
        14 001661   200010 630500                    EPPR0   @COMMAND+5,,AUTO
        14 001662   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 001663   000000 701000 xent               TSX1    FLI$BUILD_$$EFT
        14 001664   001666 702000 14                 TSX2    s:21428
        14 001665   001703 710000 14                 TRA     s:21438

      576    21426    4                    WHENALTRETURN
      577    21427    5                    DO;

      578    21428    5                      IF B$TCB.ALT$->B$EXCFR.ERR.SEV = 0

  21428 14 001666   000000 470400 xsym               LDP0    B$TCB$
        14 001667   000000 471500                    LDP1    0,,PR0
        14 001670   100102 236100                    LDQ     66,,PR1
        14 001671   000007 316007                    CANQ    7,DL
        14 001672   001703 600000 14                 TZE     s:21438

      579    21429    5                        THEN;
      580    21430    5                        ELSE
      581    21431    6                        DO;

      582    21432    6                          CALL FLI$RPT_ERR;

  21432 14 001673   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 001674   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001675   000000 011000                    NOP     0

      583    21433    6                          CALL M$CLOSE(CLOSE_ARCHIVE);

  21433 14 001676   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 001677   050001 713400                    CLIMB   close
        14 001700   406000 401760                    pmme    nvectors=13

      584    21434    6                          RETURN;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:99   
  21434 14 001701   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 001702   000001 702211                    TSX2  ! 1,X1

      585    21435    6                        END;
      586    21436    5                    END;
      587    21437
      588    21438    4                    OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;

  21438 14 001703   001000 236007                    LDQ     512,DL
        14 001704   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      589    21439    4                    CALL M$OPEN(OPEN_ARCHIVE_FILE)

  21439 14 001705   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 001706   450000 713400                    CLIMB   alt,open
        14 001707   410400 401760                    pmme    nvectors=18
        14 001710   002004 702000 14                 TSX2    s:21472

      590    21440    4                    WHENRETURN
      591    21441    5                    DO;

      592    21442    5                      READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);

  21442 14 001711   000030 237000 15                 LDAQ    24
        14 001712   000324 757000 2                  STAQ    READ_ARCHIVE_FILE+4

      593    21443    5                      CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT1);

  21443 14 001713   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 001714   440000 713400                    CLIMB   alt,read
        14 001715   401400 401760                    pmme    nvectors=4
        14 001716   002335 702000 14                 TSX2    ALT1

      594    21444
      595    21445    5                      CALL FLI$ALLOC(ARCHIVE_REC_SIZE,START$);

  21445 14 001717   000032 630400 15                 EPPR0   26
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:100  
        14 001720   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001721   000000 701000 xent               TSX1    FLI$ALLOC
        14 001722   000000 011000                    NOP     0

      596    21446    5                      READ_ARCHIVE_FILE.BUF_.BUF$ = START$;

  21446 14 001723   000357 236000 2                  LDQ     START$
        14 001724   000325 756000 2                  STQ     READ_ARCHIVE_FILE+5

      597    21447    5                      READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;

  21447 14 001725   000356 236000 2                  LDQ     ARCHIVE_REC_SIZE
        14 001726   000002 736000                    QLS     2
        14 001727   000001 136007                    SBLQ    1,DL
        14 001730   000020 736000                    QLS     16
        14 001731   000324 676000 2                  ERQ     READ_ARCHIVE_FILE+4
        14 001732   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 001733   000324 656000 2                  ERSQ    READ_ARCHIVE_FILE+4

      598    21448    5                      CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT1);

  21448 14 001734   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 001735   440000 713400                    CLIMB   alt,read
        14 001736   401400 401760                    pmme    nvectors=4
        14 001737   002335 702000 14                 TSX2    ALT1

      599    21449        /***
      600    21450         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      601    21451         ***/
      602    21452    5                      IF START$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)

  21452 14 001740   000357 470400 2                  LDP0    START$
        14 001741   000000 236100                    LDQ     0,,PR0
        14 001742   777000 376003                    ANQ     -512,DU
        14 001743   777000 116003                    CMPQ    -512,DU
        14 001744   001756 600000 14                 TZE     s:21459

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:101  
      603    21453    5                      THEN
      604    21454    6                      DO;

      605    21455    6                         CALL FLI$CNVRT_ARCHIVE(START$,TPTR$);

  21455 14 001745   000034 630400 15                 EPPR0   28
        14 001746   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001747   000000 701000 xent               TSX1    FLI$CNVRT_ARCHIVE
        14 001750   000000 011000                    NOP     0

      606    21456    6                         START$ = TPTR$;

  21456 14 001751   000361 236000 2                  LDQ     TPTR$
        14 001752   000357 756000 2                  STQ     START$

      607    21457    6                         ARCHIVE_REC_SIZE = START$->ARCHIVE_LIST.SIZE;

  21457 14 001753   000357 470400 2                  LDP0    START$
        14 001754   000002 235100                    LDA     2,,PR0
        14 001755   000356 755000 2                  STA     ARCHIVE_REC_SIZE

      608    21458    6                         END;

      609    21459    5                      AVAIL$ = PINCRW(START$,SIZEW(ARCHIVE_LIST));

  21459 14 001756   000357 236000 2                  LDQ     START$
        14 001757   000011 036003                    ADLQ    9,DU
        14 001760   000353 756000 2                  STQ     AVAIL$

      610    21460
      611    21461    5                      IF DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(0)

  21461 14 001761   000353 471400 2                  LDP1    AVAIL$
        14 001762   040100 106400                    CMPC    fill='040'O
        14 001763   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6
        14 001764   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6
        14 001765   001773 601000 14                 TNZ     s:21465
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:102  

      612    21462    5                        THEN
      613    21463    5                          CALL FLI$RPT_ERR(E_ALREADY_ESTABLISH,DCB#);

  21463 14 001766   000024 630400 15                 EPPR0   20
        14 001767   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001770   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001771   000000 011000                    NOP     0
        14 001772   001777 710000 14                 TRA     s:21466

      614    21464    5                        ELSE
      615    21465    5                          CALL FLI$RPT_ERR(E_MEMBER_OF_ARCHIVE,DCB#);

  21465 14 001773   000026 630400 15                 EPPR0   22
        14 001774   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001775   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001776   000000 011000                    NOP     0

      616    21466    5                      CALL M$CLOSE(CLOSE_ARCHIVE);

  21466 14 001777   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002000   050001 713400                    CLIMB   close
        14 002001   406000 401760                    pmme    nvectors=13

      617    21467    5                      RETURN;

  21467 14 002002   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 002003   000001 702211                    TSX2  ! 1,X1

      618    21468    5                    END;
      619    21469
      620    21470    4                    WHENALTRETURN
      621    21471    5                    DO;

      622    21472    5                      IF B$TCB.ALT$->B$EXCFR.ERR.ERR# ~= %E$NOFILE

  21472 14 002004   000000 470400 xsym               LDP0    B$TCB$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:103  
        14 002005   000000 471500                    LDP1    0,,PR0
        14 002006   100102 236100                    LDQ     66,,PR1
        14 002007   377770 376007                    ANQ     131064,DL
        14 002010   001610 116007                    CMPQ    904,DL
        14 002011   002335 601000 14                 TNZ     ALT1

      623    21473    5                        THEN  GOTO ALT1;
      624    21474
      625    21475        /***
      626    21476         *** What the following codes do are
      627    21477         *** a. Allocate the memory for new buffer.
      628    21478         *** b. move and update the new buffer
      629    21479         *** c. Write the updated record back to the maste packsets
      630    21480         ***    and the member packsets.
      631    21481         ***/
      632    21482
      633    21483    5                      SIZE = ARCHIVE_REC_SIZE + (LENGTHC(VLP_SN.SN#(0))+3)/4;

  21483 14 002012   000356 235000 2                  LDA     ARCHIVE_REC_SIZE
        14 002013   000002 035007                    ADLA    2,DL
        14 002014   000351 755000 2                  STA     SIZE

      634    21484    5                      CALL FLI$ALLOC(SIZE,BUF$);

  21484 14 002015   000042 630400 15                 EPPR0   34
        14 002016   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002017   000000 701000 xent               TSX1    FLI$ALLOC
        14 002020   000000 011000                    NOP     0

      635    21485
      636    21486    5                      BUF$->ARCHIVE_LIST = START$->ARCHIVE_LIST;

  21486 14 002021   000357 470400 2                  LDP0    START$
        14 002022   000360 471400 2                  LDP1    BUF$
        14 002023   000100 100500                    MLR     fill='000'O
        14 002024   000000 000044                    ADSC9   0,,PR0                   cn=0,n=36
        14 002025   100000 000044                    ADSC9   0,,PR1                   cn=0,n=36
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:104  

      637    21487    5                      AVAIL$ = PINCRW(BUF$,BUF$->ARCHIVE_LIST.OFFSET.DPLIST);

  21487 14 002026   000360 470400 2                  LDP0    BUF$
        14 002027   000003 720100                    LXL0    3,,PR0
        14 002030   000000 636010                    EAQ     0,X0
        14 002031   000360 036000 2                  ADLQ    BUF$
        14 002032   000353 756000 2                  STQ     AVAIL$

      638    21488    5                      TPTR$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.DPLIST);

  21488 14 002033   000357 471400 2                  LDP1    START$
        14 002034   100003 720100                    LXL0    3,,PR1
        14 002035   000000 636010                    EAQ     0,X0
        14 002036   000357 036000 2                  ADLQ    START$
        14 002037   000361 756000 2                  STQ     TPTR$

      639    21489
      640    21490    6                      DO I = 0 TO TPTR$->VLP_SN.NUM# - 1;

  21490 14 002040   000345 450000 2                  STZ     I
        14 002041   002054 710000 14                 TRA     s:21492+3

      641    21491    6                        AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);

  21491 14 002042   000345 236000 2                  LDQ     I
        14 002043   000006 402007                    MPY     6,DL
        14 002044   000361 470400 2                  LDP0    TPTR$
        14 002045   000353 471400 2                  LDP1    AVAIL$
        14 002046   040106 100506                    MLR     fill='040'O
        14 002047   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 002050   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      642    21492    6                      END;

  21492 14 002051   000345 235000 2                  LDA     I
        14 002052   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:105  
        14 002053   000345 755000 2                  STA     I
        14 002054   000361 470400 2                  LDP0    TPTR$
        14 002055   000345 236000 2                  LDQ     I
        14 002056   002061 604000 14                 TMI     s:21493
        14 002057   000000 116100                    CMPQ    0,,PR0
        14 002060   002042 604000 14                 TMI     s:21491

      643    21493    5                      AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM# + 1;

  21493 14 002061   000353 471400 2                  LDP1    AVAIL$
        14 002062   000000 235100                    LDA     0,,PR0
        14 002063   000001 035007                    ADLA    1,DL
        14 002064   100000 755100                    STA     0,,PR1

      644    21494    5                      AVAIL$->VLP_SN.SN#(AVAIL$->VLP_SN.NUM#-1) = DPLIST.SN#(0);

  21494 14 002065   000353 470400 2                  LDP0    AVAIL$
        14 002066   000000 235100                    LDA     0,,PR0
        14 002067   000044 733000                    LRS     36
        14 002070   000006 402007                    MPY     6,DL
        14 002071   000000 471400 xsym               LDP1    DPLIST$
        14 002072   040106 100500                    MLR     fill='040'O
        14 002073   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6
        14 002074   077777 400006                    ADSC9   -1,Q,PR0                 cn=2,n=6

      645    21495    5                      DPSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM# *
             21495                               LENGTHC(VLP_SN.SN#(0))+3)/4;

  21495 14 002075   000353 470400 2                  LDP0    AVAIL$
        14 002076   000000 236100                    LDQ     0,,PR0
        14 002077   000006 402007                    MPY     6,DL
        14 002100   000007 036007                    ADLQ    7,DL
        14 002101   000004 506007                    DIV     4,DL
        14 002102   000344 756000 2                  STQ     DPSIZE

      646    21496
      647    21497    5                      AVAIL$ = PINCRW(AVAIL$,DPSIZE);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:106  

  21497 14 002103   000022 736000                    QLS     18
        14 002104   000353 036000 2                  ADLQ    AVAIL$
        14 002105   000353 756000 2                  STQ     AVAIL$

      648    21498    5                      BUF$->ARCHIVE_LIST.OFFSET.SNLIST = BUF$->ARCHIVE_LIST.OFFSET.
             21498                               DPLIST + DPSIZE;

  21498 14 002106   000360 470400 2                  LDP0    BUF$
        14 002107   000003 236100                    LDQ     3,,PR0
        14 002110   000344 036000 2                  ADLQ    DPSIZE
        14 002111   000004 756100                    STQ     4,,PR0

      649    21499    5                      TPTR$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.SNLIST);

  21499 14 002112   000357 470400 2                  LDP0    START$
        14 002113   000004 720100                    LXL0    4,,PR0
        14 002114   000000 636010                    EAQ     0,X0
        14 002115   000357 036000 2                  ADLQ    START$
        14 002116   000361 756000 2                  STQ     TPTR$

      650    21500    6                      DO I = 0 TO TPTR$->VLP_SN.NUM#;

  21500 14 002117   000345 450000 2                  STZ     I
        14 002120   002133 710000 14                 TRA     s:21502+3

      651    21501    6                        AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);

  21501 14 002121   000345 236000 2                  LDQ     I
        14 002122   000006 402007                    MPY     6,DL
        14 002123   000361 470400 2                  LDP0    TPTR$
        14 002124   000353 471400 2                  LDP1    AVAIL$
        14 002125   040106 100506                    MLR     fill='040'O
        14 002126   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 002127   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      652    21502    6                      END;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:107  

  21502 14 002130   000345 235000 2                  LDA     I
        14 002131   000001 035007                    ADLA    1,DL
        14 002132   000345 755000 2                  STA     I
        14 002133   000361 470400 2                  LDP0    TPTR$
        14 002134   000345 236000 2                  LDQ     I
        14 002135   002140 604000 14                 TMI     s:21503
        14 002136   000000 116100                    CMPQ    0,,PR0
        14 002137   002121 604400 14                 TMOZ    s:21501

      653    21503    5                      AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;

  21503 14 002140   000353 471400 2                  LDP1    AVAIL$
        14 002141   000000 235100                    LDA     0,,PR0
        14 002142   100000 755100                    STA     0,,PR1

      654    21504    5                      SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM# *
             21504                               LENGTHC(VLP_SN.SN#(0)) + 3)/4;

  21504 14 002143   000353 470400 2                  LDP0    AVAIL$
        14 002144   000000 236100                    LDQ     0,,PR0
        14 002145   000006 402007                    MPY     6,DL
        14 002146   000007 036007                    ADLQ    7,DL
        14 002147   000004 506007                    DIV     4,DL
        14 002150   000355 756000 2                  STQ     SNSIZE

      655    21505    5                      AVAIL$ = PINCRW(AVAIL$,SNSIZE);

  21505 14 002151   000022 736000                    QLS     18
        14 002152   000353 036000 2                  ADLQ    AVAIL$
        14 002153   000353 756000 2                  STQ     AVAIL$

      656    21506
      657    21507    5                      IF BUF$->ARCHIVE_LIST.OFFSET.SNLIST2 ~= 0

  21507 14 002154   000360 470400 2                  LDP0    BUF$
        14 002155   000005 235100                    LDA     5,,PR0
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:108  
        14 002156   002216 600000 14                 TZE     s:21519

      658    21508    5                        THEN
      659    21509    6                        DO;

      660    21510    6                         BUF$->ARCHIVE_LIST.OFFSET.SNLIST2 = BUF$->ARCHIVE_LIST.OFFSET
             21510                                   .SNLIST + SNSIZE;

  21510 14 002157   000004 236100                    LDQ     4,,PR0
        14 002160   000355 036000 2                  ADLQ    SNSIZE
        14 002161   000005 756100                    STQ     5,,PR0

      661    21511    6                          TPTR$ = PINCRW(START$,START$->ARCHIVE_LIST.OFFSET.SNLIST2);

  21511 14 002162   000357 470400 2                  LDP0    START$
        14 002163   000005 720100                    LXL0    5,,PR0
        14 002164   000000 636010                    EAQ     0,X0
        14 002165   000357 036000 2                  ADLQ    START$
        14 002166   000361 756000 2                  STQ     TPTR$

      662    21512    7                          DO I = 0 TO TPTR$->VLP_SN.NUM#;

  21512 14 002167   000345 450000 2                  STZ     I
        14 002170   002203 710000 14                 TRA     s:21514+3

      663    21513    7                            AVAIL$->VLP_SN.SN#(I) = TPTR$->VLP_SN.SN#(I);

  21513 14 002171   000345 236000 2                  LDQ     I
        14 002172   000006 402007                    MPY     6,DL
        14 002173   000361 470400 2                  LDP0    TPTR$
        14 002174   000353 471400 2                  LDP1    AVAIL$
        14 002175   040106 100506                    MLR     fill='040'O
        14 002176   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 002177   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

      664    21514    7                          END;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:109  
  21514 14 002200   000345 235000 2                  LDA     I
        14 002201   000001 035007                    ADLA    1,DL
        14 002202   000345 755000 2                  STA     I
        14 002203   000361 470400 2                  LDP0    TPTR$
        14 002204   000345 236000 2                  LDQ     I
        14 002205   002210 604000 14                 TMI     s:21515
        14 002206   000000 116100                    CMPQ    0,,PR0
        14 002207   002171 604400 14                 TMOZ    s:21513

      665    21515    6                          AVAIL$->VLP_SN.NUM# = TPTR$->VLP_SN.NUM#;

  21515 14 002210   000353 471400 2                  LDP1    AVAIL$
        14 002211   000000 235100                    LDA     0,,PR0
        14 002212   100000 755100                    STA     0,,PR1

      666    21516    6                          SNSIZE = SNSIZE * 2;

  21516 14 002213   000355 235000 2                  LDA     SNSIZE
        14 002214   000001 735000                    ALS     1
        14 002215   000355 755000 2                  STA     SNSIZE

      667    21517    6                        END;

      668    21518
      669    21519    5                      SIZE = SIZEW(ARCHIVE_LIST) + DPSIZE + SNSIZE;

  21519 14 002216   000344 236000 2                  LDQ     DPSIZE
        14 002217   000355 036000 2                  ADLQ    SNSIZE
        14 002220   000011 036007                    ADLQ    9,DL
        14 002221   000351 756000 2                  STQ     SIZE

      670    21520    5                      BUF$->ARCHIVE_LIST.SIZE = SIZE;

  21520 14 002222   000360 470400 2                  LDP0    BUF$
        14 002223   000002 756100                    STQ     2,,PR0

      671    21521    5                      AVAIL$ = PINCRW(BUF$,BUF$->ARCHIVE_LIST.OFFSET.DPLIST);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:110  

  21521 14 002224   000360 470400 2                  LDP0    BUF$
        14 002225   000003 720100                    LXL0    3,,PR0
        14 002226   000000 636010                    EAQ     0,X0
        14 002227   000360 036000 2                  ADLQ    BUF$
        14 002230   000353 756000 2                  STQ     AVAIL$

      672    21522    5                      OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;

  21522 14 002231   003000 236007                    LDQ     1536,DL
        14 002232   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      673    21523    5                      OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;

  21523 14 002233   000600 236007                    LDQ     384,DL
        14 002234   000272 256000 2                  ORSQ    OPEN_ARCHIVE_FILE+36

      674    21524    5                      OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;

  21524 14 002235   000001 335007                    LCA     1,DL
        14 002236   000305 755000 2                  STA     OPEN_ARCHIVE_FILE+47

      675    21525    6                      DO I = 0 TO AVAIL$->VLP_SN.NUM#-1;

  21525 14 002237   000345 450000 2                  STZ     I
        14 002240   002317 710000 14                 TRA     s:21543+3

      676    21526    6                        DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(I);

  21526 14 002241   000345 236000 2                  LDQ     I
        14 002242   000006 402007                    MPY     6,DL
        14 002243   000353 470400 2                  LDP0    AVAIL$
        14 002244   040000 100506                    MLR     fill='040'O
        14 002245   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 002246   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      677    21527    6                        CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ERR);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:111  

  21527 14 002247   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 002250   450000 713400                    CLIMB   alt,open
        14 002251   410400 401760                    pmme    nvectors=18
        14 002252   002302 702000 14                 TSX2    ERR

      678    21528
      679    21529    6                        WRITE_ARCHIVE_REC.BUF_ = VECTOR(SIZE);

  21529 14 002253   000046 237000 15                 LDAQ    38
        14 002254   000160 757000 2                  STAQ    WRITE_ARCHIVE_REC+4

      680    21530    6                        CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);

  21530 14 002255   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 002256   440001 713400                    CLIMB   alt,write
        14 002257   401400 401760                    pmme    nvectors=4
        14 002260   002302 702000 14                 TSX2    ERR

      681    21531
      682    21532    6                        WRITE_ARCHIVE_REC.BUF_.BUF$ = BUF$;

  21532 14 002261   000360 236000 2                  LDQ     BUF$
        14 002262   000161 756000 2                  STQ     WRITE_ARCHIVE_REC+5

      683    21533    6                        WRITE_ARCHIVE_REC.BUF_.BOUND = SIZE * 4 - 1;

  21533 14 002263   000351 236000 2                  LDQ     SIZE
        14 002264   000002 736000                    QLS     2
        14 002265   000001 136007                    SBLQ    1,DL
        14 002266   000020 736000                    QLS     16
        14 002267   000160 676000 2                  ERQ     WRITE_ARCHIVE_REC+4
        14 002270   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 002271   000160 656000 2                  ERSQ    WRITE_ARCHIVE_REC+4

      684    21534    6                        CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:112  
  21534 14 002272   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 002273   440001 713400                    CLIMB   alt,write
        14 002274   401400 401760                    pmme    nvectors=4
        14 002275   002302 702000 14                 TSX2    ERR

      685    21535
      686    21536    6                        CALL M$CLOSE(CLOSE_ARCHIVE);

  21536 14 002276   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002277   050001 713400                    CLIMB   close
        14 002300   406000 401760                    pmme    nvectors=13

      687    21537    7                        DO WHILE('0'B);

  21537 14 002301   002314 710000 14                 TRA     s:21543

      688    21538    7   ERR:
      689    21539    7                          CALL FLI$RPT_ERR;

  21539 14 002302   000002 631400 xsym  ERR          EPPR1   B_VECTNIL+2
        14 002303   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002304   000000 011000                    NOP     0

      690    21540    7                          CALL M$CLOSE(CLOSE_ARCHIVE);

  21540 14 002305   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002306   050001 713400                    CLIMB   close
        14 002307   406000 401760                    pmme    nvectors=13

      691    21541    7                          IF I = 0 THEN RETURN;

  21541 14 002310   000345 235000 2                  LDA     I
        14 002311   002314 601000 14                 TNZ     s:21543

  21541 14 002312   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 002313   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:113  
      692    21542    7                        END;

      693    21543    6                      END; /* I = 0 to AVAIL$->VLP_SN.NUM# */

  21543 14 002314   000345 235000 2                  LDA     I
        14 002315   000001 035007                    ADLA    1,DL
        14 002316   000345 755000 2                  STA     I
        14 002317   000353 470400 2                  LDP0    AVAIL$
        14 002320   000345 236000 2                  LDQ     I
        14 002321   002324 604000 14                 TMI     s:21546
        14 002322   000000 116100                    CMPQ    0,,PR0
        14 002323   002241 604000 14                 TMI     s:21526

      694    21544    5                    END;

      695    21545    4                END;

      696    21546    3            END;

  21546 14 002324   002334 710000 14                 TRA     s:21552

      697    21547    2            ELSE
      698    21548    3            DO;

      699    21549    3                CALL FLI$RPT_ERR(E_NOT_ARCHIVE_MASTER,DCB#);

  21549 14 002325   000044 630400 15                 EPPR0   36
        14 002326   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002327   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002330   000000 011000                    NOP     0

      700    21550    3                CALL M$CLOSE(CLOSE_ARCHIVE);

  21550 14 002331   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002332   050001 713400                    CLIMB   close
        14 002333   406000 401760                    pmme    nvectors=13

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:114  
      701    21551    3            END;

      702    21552    3          DO WHILE('0'B);

  21552 14 002334   002343 710000 14                 TRA     s:21557

      703    21553    3   ALT1:
      704    21554    3            CALL FLI$RPT_ERR;

  21554 14 002335   000002 631400 xsym  ALT1         EPPR1   B_VECTNIL+2
        14 002336   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002337   000000 011000                    NOP     0

      705    21555    3            CALL M$CLOSE(CLOSE_ARCHIVE);

  21555 14 002340   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002341   050001 713400                    CLIMB   close
        14 002342   406000 401760                    pmme    nvectors=13

      706    21556    3          END;

      707    21557    2          RETURN;

  21557 14 002343   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 002344   000001 702211                    TSX2  ! 1,X1

      708    21558    2   END FLE_ADD;
      709    21559        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:115  
      710    21560    1   FLE_REMOVE:PROC;

  21560 14 002345   200004 741300       FLE_REMOVE   STX1  ! @COMMAND+1,,AUTO

      711    21561        /*F*   NAME: FLE_REMOVE
      712    21562               PURPOSE: Perform REMOVE command for the archive system.
      713    21563                         This command removes a packset from the existing
      714    21564                         group of packsets. If the master packset is removed,
      715    21565                         The members of the packset group also are taken
      716    21566                         away.
      717    21567        ***/
      718    21568
      719    21569        /***
      720    21570         ***  Open :ARCHIVE file from master packset to get archive
      721    21571         ***  information.
      722    21572         ***/
      723    21573
      724    21574    2          DPSN.SN#(0) = DISK_DEST_SN.SN#(0);

  21574 14 002346   040000 100400                    MLR     fill='040'O
        14 002347   000001 000006 xsym               ADSC9   DISK_DEST_SN+1           cn=0,n=6
        14 002350   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      725    21575    2          OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;

  21575 14 002351   001000 236007                    LDQ     512,DL
        14 002352   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      726    21576    2          CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT2);

  21576 14 002353   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 002354   450000 713400                    CLIMB   alt,open
        14 002355   410400 401760                    pmme    nvectors=18
        14 002356   002750 702000 14                 TSX2    ALT2

      727    21577
      728    21578    2          READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:116  

  21578 14 002357   000030 237000 15                 LDAQ    24
        14 002360   000324 757000 2                  STAQ    READ_ARCHIVE_FILE+4

      729    21579    2          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT2);

  21579 14 002361   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 002362   440000 713400                    CLIMB   alt,read
        14 002363   401400 401760                    pmme    nvectors=4
        14 002364   002750 702000 14                 TSX2    ALT2

      730    21580
      731    21581    2          CALL FLI$ALLOC(ARCHIVE_REC_SIZE,START$);

  21581 14 002365   000032 630400 15                 EPPR0   26
        14 002366   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002367   000000 701000 xent               TSX1    FLI$ALLOC
        14 002370   000000 011000                    NOP     0

      732    21582    2          READ_ARCHIVE_FILE.BUF_.BUF$ = START$;

  21582 14 002371   000357 236000 2                  LDQ     START$
        14 002372   000325 756000 2                  STQ     READ_ARCHIVE_FILE+5

      733    21583    2          READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;

  21583 14 002373   000356 236000 2                  LDQ     ARCHIVE_REC_SIZE
        14 002374   000002 736000                    QLS     2
        14 002375   000001 136007                    SBLQ    1,DL
        14 002376   000020 736000                    QLS     16
        14 002377   000324 676000 2                  ERQ     READ_ARCHIVE_FILE+4
        14 002400   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 002401   000324 656000 2                  ERSQ    READ_ARCHIVE_FILE+4

      734    21584    2          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT2);

  21584 14 002402   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:117  
        14 002403   440000 713400                    CLIMB   alt,read
        14 002404   401400 401760                    pmme    nvectors=4
        14 002405   002750 702000 14                 TSX2    ALT2

      735    21585        /***
      736    21586         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      737    21587         ***/
      738    21588    2          IF START$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)

  21588 14 002406   000357 470400 2                  LDP0    START$
        14 002407   000000 236100                    LDQ     0,,PR0
        14 002410   777000 376003                    ANQ     -512,DU
        14 002411   777000 116003                    CMPQ    -512,DU
        14 002412   002424 600000 14                 TZE     s:21596

      739    21589    2          THEN
      740    21590    3          DO;

      741    21591    3             CALL FLI$CNVRT_ARCHIVE(START$,TPTR$);

  21591 14 002413   000034 630400 15                 EPPR0   28
        14 002414   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002415   000000 701000 xent               TSX1    FLI$CNVRT_ARCHIVE
        14 002416   000000 011000                    NOP     0

      742    21592    3             START$ = TPTR$;

  21592 14 002417   000361 236000 2                  LDQ     TPTR$
        14 002420   000357 756000 2                  STQ     START$

      743    21593    3             ARCHIVE_REC_SIZE = START$->ARCHIVE_LIST.SIZE;

  21593 14 002421   000357 470400 2                  LDP0    START$
        14 002422   000002 235100                    LDA     2,,PR0
        14 002423   000356 755000 2                  STA     ARCHIVE_REC_SIZE

      744    21594    3             END;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:118  

      745    21595
      746    21596    2          AVAIL$ = PINCRW(START$,SIZEW(ARCHIVE_LIST));

  21596 14 002424   000357 236000 2                  LDQ     START$
        14 002425   000011 036003                    ADLQ    9,DU
        14 002426   000353 756000 2                  STQ     AVAIL$

      747    21597    2          CALL M$CLOSE(CLOSE_ARCHIVE);

  21597 14 002427   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002430   050001 713400                    CLIMB   close
        14 002431   406000 401760                    pmme    nvectors=13

      748    21598
      749    21599    2          IF AVAIL$->VLP_SN.SN#(0) = DISK_DEST_SN.SN#(0)

  21599 14 002432   000353 470400 2                  LDP0    AVAIL$
        14 002433   040000 106500                    CMPC    fill='040'O
        14 002434   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
        14 002435   000001 000006 xsym               ADSC9   DISK_DEST_SN+1           cn=0,n=6
        14 002436   002740 601000 14                 TNZ     s:21718

      750    21600    2            THEN
      751    21601    3            DO;

      752    21602        /***
      753    21603         *** If the master packset is removed, then :ARCHIVE file is
      754    21604         *** deleted from both master packsets and member packsets.
      755    21605         ***/
      756    21606
      757    21607    3                IF DPLIST.SN#(0) = DISK_DEST_SN.SN#(0)

  21607 14 002437   000000 471400 xsym               LDP1    DPLIST$
        14 002440   040000 106500                    CMPC    fill='040'O
        14 002441   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6
        14 002442   000001 000006 xsym               ADSC9   DISK_DEST_SN+1           cn=0,n=6
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:119  
        14 002443   002521 601000 14                 TNZ     s:21646

      758    21608    3                  THEN
      759    21609    4                  DO;

      760    21610    4                    OPEN_ARCHIVE_FILE.V.DELETE# = '1'B;

  21610 14 002444   040000 236007                    LDQ     16384,DL
        14 002445   000272 256000 2                  ORSQ    OPEN_ARCHIVE_FILE+36

      761    21611    4                    OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;

  21611 14 002446   001000 236007                    LDQ     512,DL
        14 002447   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      762    21612        /***
      763    21613         *** Remove :ARCHIVE file from member packsets.
      764    21614         ***/
      765    21615
      766    21616    5                    DO I = 1 TO AVAIL$->VLP_SN.NUM#-1;

  21616 14 002450   000001 235007                    LDA     1,DL
        14 002451   000345 755000 2                  STA     I
        14 002452   002500 710000 14                 TRA     s:21629+3

      767    21617    5                        DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(I);

  21617 14 002453   000345 236000 2                  LDQ     I
        14 002454   000006 402007                    MPY     6,DL
        14 002455   000353 470400 2                  LDP0    AVAIL$
        14 002456   040000 100506                    MLR     fill='040'O
        14 002457   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 002460   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      768    21618    5                        CALL M$OPEN(OPEN_ARCHIVE_FILE)

  21618 14 002461   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:120  
        14 002462   450000 713400                    CLIMB   alt,open
        14 002463   410400 401760                    pmme    nvectors=18
        14 002464   002472 702000 14                 TSX2    s:21625

      769    21619    5                        WHENRETURN
      770    21620    6                        DO;

      771    21621    6                          CALL FLI$RPT_ERR(E_REMOVE_FROM_ARCHIVE,DCB#);

  21621 14 002465   000050 630400 15                 EPPR0   40
        14 002466   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002467   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002470   000000 011000                    NOP     0

      772    21622    6                        END;

  21622 14 002471   002475 710000 14                 TRA     s:21629

      773    21623    5                        WHENALTRETURN
      774    21624    6                        DO;

      775    21625    6                          CALL FLI$RPT_ERR;

  21625 14 002472   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 002473   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002474   000000 011000                    NOP     0

      776    21626                               /** The :ARCHIVE file of this packset has to be
      777    21627                                    deleted somehow **/
      778    21628    6                        END;

      779    21629    5                    END;

  21629 14 002475   000345 235000 2                  LDA     I
        14 002476   000001 035007                    ADLA    1,DL
        14 002477   000345 755000 2                  STA     I
        14 002500   000353 470400 2                  LDP0    AVAIL$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:121  
        14 002501   000345 236000 2                  LDQ     I
        14 002502   002505 604000 14                 TMI     s:21634
        14 002503   000000 116100                    CMPQ    0,,PR0
        14 002504   002453 604000 14                 TMI     s:21617

      780    21630        /***
      781    21631         *** Delete :ARCHIVE from master packset.
      782    21632         ***/
      783    21633
      784    21634    4                    DPSN.SN#(0) = DISK_DEST_SN.SN#(0);

  21634 14 002505   040000 100400                    MLR     fill='040'O
        14 002506   000001 000006 xsym               ADSC9   DISK_DEST_SN+1           cn=0,n=6
        14 002507   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      785    21635    4                    CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT2);

  21635 14 002510   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 002511   450000 713400                    CLIMB   alt,open
        14 002512   410400 401760                    pmme    nvectors=18
        14 002513   002750 702000 14                 TSX2    ALT2

      786    21636    4                    CALL FLI$RPT_ERR(E_REMOVE_MASTER_PACKSET,DCB#);

  21636 14 002514   000052 630400 15                 EPPR0   42
        14 002515   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002516   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002517   000000 011000                    NOP     0

      787    21637
      788    21638    4                  END;

  21638 14 002520   002747 710000 14                 TRA     s:21721

      789    21639    3                  ELSE
      790    21640    4                  DO;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:122  
      791    21641        /***
      792    21642         *** If it is the member packset, then delete :ARCHIVE from the
      793    21643         *** member packset and updates :ARCHIVE file of master packset.
      794    21644         ***/
      795    21645
      796    21646    4                    J = 0;

  21646 14 002521   000346 450000 2                  STZ     J

      797    21647    5                    DO I = 1 TO AVAIL$->VLP_SN.NUM#-1;

  21647 14 002522   000001 235007                    LDA     1,DL
        14 002523   000345 755000 2                  STA     I
        14 002524   002545 710000 14                 TRA     s:21655+3

      798    21648    5                      IF AVAIL$->VLP_SN.SN#(I) = DPLIST.SN#(0)

  21648 14 002525   000345 236000 2                  LDQ     I
        14 002526   000006 402007                    MPY     6,DL
        14 002527   000353 470400 2                  LDP0    AVAIL$
        14 002530   000000 471400 xsym               LDP1    DPLIST$
        14 002531   040100 106506                    CMPC    fill='040'O
        14 002532   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 002533   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6
        14 002534   002542 601000 14                 TNZ     s:21655

      799    21649    5                        THEN
      800    21650    6                        DO;

      801    21651    6                          K = I;

  21651 14 002535   000345 235000 2                  LDA     I
        14 002536   000347 755000 2                  STA     K

      802    21652    6                          J = 1;

  21652 14 002537   000001 235007                    LDA     1,DL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:123  
        14 002540   000346 755000 2                  STA     J

      803    21653    6                          EXIT;

  21653 14 002541   002542 710000 14                 TRA     s:21655

      804    21654    6                        END;
      805    21655    5                    END;

  21655 14 002542   000345 235000 2                  LDA     I
        14 002543   000001 035007                    ADLA    1,DL
        14 002544   000345 755000 2                  STA     I
        14 002545   000345 236000 2                  LDQ     I
        14 002546   002551 604000 14                 TMI     s:21656
        14 002547   000000 116100                    CMPQ    0,,PR0
        14 002550   002525 604000 14                 TMI     s:21648

      806    21656    4                    IF J = 1

  21656 14 002551   000346 235000 2                  LDA     J
        14 002552   000001 115007                    CMPA    1,DL
        14 002553   002730 601000 14                 TNZ     s:21711

      807    21657    4                      THEN
      808    21658    5                      DO;

      809    21659    5                        CALL M$CLOSE(CLOSE_ARCHIVE);

  21659 14 002554   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002555   050001 713400                    CLIMB   close
        14 002556   406000 401760                    pmme    nvectors=13

      810    21660    5                        DPSN.SN#(0) = DPLIST.SN#(0);

  21660 14 002557   000000 470400 xsym               LDP0    DPLIST$
        14 002560   040000 100500                    MLR     fill='040'O
        14 002561   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:124  
        14 002562   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      811    21661    5                        OPEN_ARCHIVE_FILE.V.DELETE# = '1'B;

  21661 14 002563   040000 236007                    LDQ     16384,DL
        14 002564   000272 256000 2                  ORSQ    OPEN_ARCHIVE_FILE+36

      812    21662    5                        OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;

  21662 14 002565   001000 236007                    LDQ     512,DL
        14 002566   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      813    21663    5                        CALL M$OPEN ( OPEN_ARCHIVE_FILE )

  21663 14 002567   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 002570   450000 713400                    CLIMB   alt,open
        14 002571   410400 401760                    pmme    nvectors=18
        14 002572   002600 702000 14                 TSX2    s:21670

      814    21664    5                             WHENRETURN
      815    21665    6                             DO;

      816    21666    6                                CALL FLI$RPT_ERR ( E_ARCFILE_REMOVED );

  21666 14 002573   000054 630400 15                 EPPR0   44
        14 002574   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 002575   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002576   000000 011000                    NOP     0

      817    21667    6                               END;

  21667 14 002577   002623 710000 14                 TRA     s:21683

      818    21668    5                             WHENALTRETURN
      819    21669    6                             DO;

      820    21670    6                                IF B$TCB.ALT$ -> B$EXCFR.ERR.ERR# = %E$NOFILE
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:125  

  21670 14 002600   000000 470400 xsym               LDP0    B$TCB$
        14 002601   000000 471500                    LDP1    0,,PR0
        14 002602   100102 236100                    LDQ     66,,PR1
        14 002603   377770 376007                    ANQ     131064,DL
        14 002604   001610 116007                    CMPQ    904,DL
        14 002605   002613 601000 14                 TNZ     s:21673

      821    21671    6                                THEN CALL FLI$RPT_ERR ( E_NO_ARCFILE, DCB# );

  21671 14 002606   000055 630400 15                 EPPR0   45
        14 002607   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002610   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002611   000000 011000                    NOP     0
        14 002612   002623 710000 14                 TRA     s:21683

      822    21672    7                                ELSE DO;

      823    21673    7                                     CALL FLI$RPT_ERR;

  21673 14 002613   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 002614   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002615   000000 011000                    NOP     0

      824    21674    7                                     CALL M$CLOSE ( CLOSE_ARCHIVE );

  21674 14 002616   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002617   050001 713400                    CLIMB   close
        14 002620   406000 401760                    pmme    nvectors=13

      825    21675    7                                     RETURN;

  21675 14 002621   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 002622   000001 702211                    TSX2  ! 1,X1

      826    21676    7                                   END;
      827    21677    6                               END;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:126  
      828    21678
      829    21679        /***
      830    21680         ***  Updates packset list.
      831    21681         ***/
      832    21682
      833    21683    6                        DO I = K+1 TO AVAIL$->VLP_SN.NUM#-1;

  21683 14 002623   000347 235000 2                  LDA     K
        14 002624   000001 035007                    ADLA    1,DL
        14 002625   000345 755000 2                  STA     I
        14 002626   002640 710000 14                 TRA     s:21685+3

      834    21684    6                          AVAIL$->VLP_SN.SN#(I-1) = AVAIL$->VLP_SN.SN#(I);

  21684 14 002627   000345 236000 2                  LDQ     I
        14 002630   000006 402007                    MPY     6,DL
        14 002631   000353 470400 2                  LDP0    AVAIL$
        14 002632   040106 100506                    MLR     fill='040'O
        14 002633   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 002634   077777 400006                    ADSC9   -1,Q,PR0                 cn=2,n=6

      835    21685    6                        END;

  21685 14 002635   000345 235000 2                  LDA     I
        14 002636   000001 035007                    ADLA    1,DL
        14 002637   000345 755000 2                  STA     I
        14 002640   000353 470400 2                  LDP0    AVAIL$
        14 002641   000345 236000 2                  LDQ     I
        14 002642   002645 604000 14                 TMI     s:21687
        14 002643   000000 116100                    CMPQ    0,,PR0
        14 002644   002627 604000 14                 TMI     s:21684

      836    21686
      837    21687    5                        AVAIL$->VLP_SN.SN#(AVAIL$->VLP_SN.NUM#-1) = '      ';

  21687 14 002645   000000 235100                    LDA     0,,PR0
        14 002646   000044 733000                    LRS     36
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:127  
        14 002647   000006 402007                    MPY     6,DL
        14 002650   040106 100400                    MLR     fill='040'O
        14 002651   000002 000006 13                 ADSC9   2                        cn=0,n=6
        14 002652   077777 400006                    ADSC9   -1,Q,PR0                 cn=2,n=6

      838    21688    5                        AVAIL$->VLP_SN.NUM# = AVAIL$->VLP_SN.NUM#-1;

  21688 14 002653   000353 470400 2                  LDP0    AVAIL$
        14 002654   000001 336007                    LCQ     1,DL
        14 002655   000000 056100                    ASQ     0,,PR0

      839    21689        /***
      840    21690         ***  Write the updated :ARCHIVE file back to the master packset.
      841    21691         ***/
      842    21692
      843    21693    5                        OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;

  21693 14 002656   003000 236007                    LDQ     1536,DL
        14 002657   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      844    21694    5                        OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;

  21694 14 002660   000600 236007                    LDQ     384,DL
        14 002661   000272 256000 2                  ORSQ    OPEN_ARCHIVE_FILE+36

      845    21695    5                        OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;

  21695 14 002662   000001 335007                    LCA     1,DL
        14 002663   000305 755000 2                  STA     OPEN_ARCHIVE_FILE+47

      846    21696    5                        OPEN_ARCHIVE_FILE.V.DELETE# = '0'B;

  21696 14 002664   000010 236000 15                 LDQ     8
        14 002665   000272 356000 2                  ANSQ    OPEN_ARCHIVE_FILE+36

      847    21697    5                        DPSN.SN#(0) = DISK_DEST_SN.SN#(0);

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:128  
  21697 14 002666   040000 100400                    MLR     fill='040'O
        14 002667   000001 000006 xsym               ADSC9   DISK_DEST_SN+1           cn=0,n=6
        14 002670   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      848    21698    5                        CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT2);

  21698 14 002671   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 002672   450000 713400                    CLIMB   alt,open
        14 002673   410400 401760                    pmme    nvectors=18
        14 002674   002750 702000 14                 TSX2    ALT2

      849    21699    5                        CALL FLI$RPT_ERR ( E_REMOVE_FROM_ARCHIVE );

  21699 14 002675   000050 630400 15                 EPPR0   40
        14 002676   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 002677   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002700   000000 011000                    NOP     0

      850    21700
      851    21701    5                        WRITE_ARCHIVE_REC.BUF_ = VECTOR(ARCHIVE_REC_SIZE);

  21701 14 002701   000030 237000 15                 LDAQ    24
        14 002702   000160 757000 2                  STAQ    WRITE_ARCHIVE_REC+4

      852    21702    5                        CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ALT2);

  21702 14 002703   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 002704   440001 713400                    CLIMB   alt,write
        14 002705   401400 401760                    pmme    nvectors=4
        14 002706   002750 702000 14                 TSX2    ALT2

      853    21703
      854    21704    5                        WRITE_ARCHIVE_REC.BUF_.BUF$ = START$;

  21704 14 002707   000357 236000 2                  LDQ     START$
        14 002710   000161 756000 2                  STQ     WRITE_ARCHIVE_REC+5

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:129  
      855    21705    5                        WRITE_ARCHIVE_REC.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;

  21705 14 002711   000356 236000 2                  LDQ     ARCHIVE_REC_SIZE
        14 002712   000002 736000                    QLS     2
        14 002713   000001 136007                    SBLQ    1,DL
        14 002714   000020 736000                    QLS     16
        14 002715   000160 676000 2                  ERQ     WRITE_ARCHIVE_REC+4
        14 002716   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 002717   000160 656000 2                  ERSQ    WRITE_ARCHIVE_REC+4

      856    21706    5                        CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ALT2);

  21706 14 002720   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 002721   440001 713400                    CLIMB   alt,write
        14 002722   401400 401760                    pmme    nvectors=4
        14 002723   002750 702000 14                 TSX2    ALT2

      857    21707    5                        CALL M$CLOSE(CLOSE_ARCHIVE);

  21707 14 002724   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002725   050001 713400                    CLIMB   close
        14 002726   406000 401760                    pmme    nvectors=13

      858    21708    5                      END;

  21708 14 002727   002747 710000 14                 TRA     s:21721

      859    21709    4                      ELSE
      860    21710    5                      DO;

      861    21711    5                        CALL FLI$RPT_ERR(E_NOT_MEMBER_OF_ARCHIVE,DCB#);

  21711 14 002730   000057 630400 15                 EPPR0   47
        14 002731   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002732   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002733   000000 011000                    NOP     0

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:130  
      862    21712    5                        CALL M$CLOSE(CLOSE_ARCHIVE);

  21712 14 002734   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002735   050001 713400                    CLIMB   close
        14 002736   406000 401760                    pmme    nvectors=13

      863    21713    5                      END;

      864    21714    4                  END;

      865    21715    3            END;

  21715 14 002737   002747 710000 14                 TRA     s:21721

      866    21716    2            ELSE
      867    21717    3            DO;

      868    21718    3                CALL FLI$RPT_ERR(E_NOT_ARCHIVE_MASTER,DCB#);

  21718 14 002740   000044 630400 15                 EPPR0   36
        14 002741   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 002742   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002743   000000 011000                    NOP     0

      869    21719    3                CALL M$CLOSE(CLOSE_ARCHIVE);

  21719 14 002744   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002745   050001 713400                    CLIMB   close
        14 002746   406000 401760                    pmme    nvectors=13

      870    21720    3            END;

      871    21721    3          DO WHILE('0'B);

  21721 14 002747   002756 710000 14                 TRA     s:21726

      872    21722    3   ALT2:
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:131  
      873    21723    3            CALL FLI$RPT_ERR;

  21723 14 002750   000002 631400 xsym  ALT2         EPPR1   B_VECTNIL+2
        14 002751   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 002752   000000 011000                    NOP     0

      874    21724    3            CALL M$CLOSE(CLOSE_ARCHIVE);

  21724 14 002753   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 002754   050001 713400                    CLIMB   close
        14 002755   406000 401760                    pmme    nvectors=13

      875    21725    3          END;

      876    21726    2          RETURN;

  21726 14 002756   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 002757   000001 702211                    TSX2  ! 1,X1

      877    21727    2   END FLE_REMOVE;
      878    21728        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:132  
      879    21729    1   FLE_GET_ARCHIVE_SNLIST: PROC ALTRET;

  21729 14 002760   200004 741300       FLE_GET_ARC* STX1  ! @COMMAND+1,,AUTO

      880    21730        /*F*  NAME: FLE_GET_ARCHIVE_SNLIST
      881    21731              PURPOSE: Get SNLIST from :ARCHIVE.$$EFT file.
      882    21732        ***/
      883    21733    2          DPSN.SN#(0) = DPLIST.SN#(0);

  21733 14 002761   000000 470400 xsym               LDP0    DPLIST$
        14 002762   040000 100500                    MLR     fill='040'O
        14 002763   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
        14 002764   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

      884    21734    2          OPEN_ARCHIVE_FILE.V.RES# = DPRESLIST.NAME(0);

  21734 14 002765   000000 471400 xsym               LDP1    DPRESLIST$
        14 002766   100001 236100                    LDQ     1,,PR1
        14 002767   000276 756000 2                  STQ     OPEN_ARCHIVE_FILE+40

      885    21735    3         DO WHILE ('1'B);

      886    21736    3          OPEN_ARCHIVE_FILE.V.FUN# = %UPDATE#;

  21736 14 002770   001000 236007                    LDQ     512,DL
        14 002771   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

      887    21737    3          CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ALT3);

  21737 14 002772   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 002773   450000 713400                    CLIMB   alt,open
        14 002774   410400 401760                    pmme    nvectors=18
        14 002775   003307 702000 14                 TSX2    ALT3

      888    21738
      889    21739    3          READ_ARCHIVE_FILE.BUF_ = VECTOR(ARCHIVE_REC_SIZE);

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:133  
  21739 14 002776   000030 237000 15                 LDAQ    24
        14 002777   000324 757000 2                  STAQ    READ_ARCHIVE_FILE+4

      890    21740    3          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT3);

  21740 14 003000   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 003001   440000 713400                    CLIMB   alt,read
        14 003002   401400 401760                    pmme    nvectors=4
        14 003003   003307 702000 14                 TSX2    ALT3

      891    21741
      892    21742    3          CALL FLI$ALLOC(ARCHIVE_REC_SIZE,ARCHIVE$);

  21742 14 003004   000061 630400 15                 EPPR0   49
        14 003005   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 003006   000000 701000 xent               TSX1    FLI$ALLOC
        14 003007   000000 011000                    NOP     0

      893    21743    3          READ_ARCHIVE_FILE.BUF_.BUF$ = ARCHIVE$;

  21743 14 003010   000000 236000 xsym               LDQ     ARCHIVE$
        14 003011   000325 756000 2                  STQ     READ_ARCHIVE_FILE+5

      894    21744    3          READ_ARCHIVE_FILE.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;

  21744 14 003012   000356 236000 2                  LDQ     ARCHIVE_REC_SIZE
        14 003013   000002 736000                    QLS     2
        14 003014   000001 136007                    SBLQ    1,DL
        14 003015   000020 736000                    QLS     16
        14 003016   000324 676000 2                  ERQ     READ_ARCHIVE_FILE+4
        14 003017   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 003020   000324 656000 2                  ERSQ    READ_ARCHIVE_FILE+4

      895    21745    3          CALL M$READ(READ_ARCHIVE_FILE) ALTRET(ALT3);

  21745 14 003021   000320 630400 2                  EPPR0   READ_ARCHIVE_FILE
        14 003022   440000 713400                    CLIMB   alt,read
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:134  
        14 003023   401400 401760                    pmme    nvectors=4
        14 003024   003307 702000 14                 TSX2    ALT3

      896    21746        /***
      897    21747         ***  If :ARCHIVE record is pre-D00, convert to D00 format.
      898    21748         ***/
      899    21749    3          IF ARCHIVE$->ARCHIVE_LIST.VERSION.FLAG ~= BITBIN('777'O)

  21749 14 003025   000000 470400 xsym               LDP0    ARCHIVE$
        14 003026   000000 236100                    LDQ     0,,PR0
        14 003027   777000 376003                    ANQ     -512,DU
        14 003030   777000 116003                    CMPQ    -512,DU
        14 003031   003043 600000 14                 TZE     s:21757

      900    21750    3          THEN
      901    21751    4          DO;

      902    21752    4             CALL FLI$CNVRT_ARCHIVE(ARCHIVE$,TPTR$);

  21752 14 003032   000063 630400 15                 EPPR0   51
        14 003033   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 003034   000000 701000 xent               TSX1    FLI$CNVRT_ARCHIVE
        14 003035   000000 011000                    NOP     0

      903    21753    4             ARCHIVE$ = TPTR$;

  21753 14 003036   000361 236000 2                  LDQ     TPTR$
        14 003037   000000 756000 xsym               STQ     ARCHIVE$

      904    21754    4             ARCHIVE_REC_SIZE = ARCHIVE$->ARCHIVE_LIST.SIZE;

  21754 14 003040   000000 470400 xsym               LDP0    ARCHIVE$
        14 003041   000002 235100                    LDA     2,,PR0
        14 003042   000356 755000 2                  STA     ARCHIVE_REC_SIZE

      905    21755    4             END;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:135  
      906    21756
      907    21757    3          AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.DPLIST);

  21757 14 003043   000003 720100                    LXL0    3,,PR0
        14 003044   000000 636010                    EAQ     0,X0
        14 003045   000000 036000 xsym               ADLQ    ARCHIVE$
        14 003046   000353 756000 2                  STQ     AVAIL$

      908    21758        /***
      909    21759         ***  Check if it is the master packset. Because  the master
      910    21760         ***  packset always contains the most current archiving information.
      911    21761         ***/
      912    21762
      913    21763    3          IF AVAIL$->VLP_SN.SN#(0) ~= DPSN.SN#(0)

  21763 14 003047   000353 471400 2                  LDP1    AVAIL$
        14 003050   040000 106500                    CMPC    fill='040'O
        14 003051   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6
        14 003052   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6
        14 003053   003114 600000 14                 TZE     s:21785

      914    21764    3            THEN
      915    21765    4            DO;

      916    21766    4                CALL M$CLOSE(CLOSE_ARCHIVE);

  21766 14 003054   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 003055   050001 713400                    CLIMB   close
        14 003056   406000 401760                    pmme    nvectors=13

      917    21767    4                DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(0);

  21767 14 003057   000353 470400 2                  LDP0    AVAIL$
        14 003060   040000 100500                    MLR     fill='040'O
        14 003061   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6
        14 003062   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:136  
      918    21768        /***
      919    21769         *** Set RES equal command line value, if specified.
      920    21770         ***/
      921    21771    4                OPEN_ARCHIVE_FILE.V.RES# = ' ';

  21771 14 003063   000035 236000 xsym               LDQ     B_VECTNIL+29
        14 003064   000276 756000 2                  STQ     OPEN_ARCHIVE_FILE+40

      922    21772    4   RES_LOOP:
      923    21773    5                DO I = 0 TO DPLIST.NUM# -1;

  21773 14 003065   000345 450000 2     RES_LOOP     STZ     I
        14 003066   003106 710000 14                 TRA     s:21779+3

      924    21774    5                  IF DPSN.SN#(0) = DPLIST.SN#(I)

  21774 14 003067   000345 236000 2                  LDQ     I
        14 003070   000006 402007                    MPY     6,DL
        14 003071   000000 470400 xsym               LDP0    DPLIST$
        14 003072   040106 106400                    CMPC    fill='040'O
        14 003073   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6
        14 003074   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 003075   003103 601000 14                 TNZ     s:21779

      925    21775    6                   THEN DO;

      926    21776    6                     OPEN_ARCHIVE_FILE.V.RES# = DPRESLIST.NAME(I);

  21776 14 003076   000000 471400 xsym               LDP1    DPRESLIST$
        14 003077   000345 720000 2                  LXL0    I
        14 003100   100001 236110                    LDQ     1,X0,PR1
        14 003101   000276 756000 2                  STQ     OPEN_ARCHIVE_FILE+40

      927    21777    6                     EXIT RES_LOOP;

  21777 14 003102   003113 710000 14                 TRA     s:21780

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:137  
      928    21778    6                     END;
      929    21779    5                   END;

  21779 14 003103   000345 235000 2                  LDA     I
        14 003104   000001 035007                    ADLA    1,DL
        14 003105   000345 755000 2                  STA     I
        14 003106   000000 470400 xsym               LDP0    DPLIST$
        14 003107   000345 236000 2                  LDQ     I
        14 003110   003113 604000 14                 TMI     s:21780
        14 003111   000000 116100                    CMPQ    0,,PR0
        14 003112   003067 604000 14                 TMI     s:21774

      930    21780    4            END;

  21780 14 003113   002770 710000 14                 TRA     s:21736

      931    21781    3            ELSE
      932    21782    3                EXIT;
      933    21783    3         END;

      934    21784
      935    21785    2          AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST);

  21785 14 003114   000004 720100                    LXL0    4,,PR0
        14 003115   000000 636010                    EAQ     0,X0
        14 003116   000000 036000 xsym               ADLQ    ARCHIVE$
        14 003117   000353 756000 2                  STQ     AVAIL$

      936    21786    2          IF AVAIL$->VLP_SN.NUM# = 0

  21786 14 003120   000353 471400 2                  LDP1    AVAIL$
        14 003121   100000 235100                    LDA     0,,PR1
        14 003122   003133 601000 14                 TNZ     s:21798

      937    21787    2            THEN
      938    21788    3            DO;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:138  
      939    21789    3                CALL FLI$RPT_ERR(E_ARCHIVE_OUT_TAPESET,);

  21789 14 003123   000065 630400 15                 EPPR0   53
        14 003124   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 003125   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 003126   000000 011000                    NOP     0

      940    21790
      941    21791    3                COMMAND_ERROR = '1'B;

  21791 14 003127   400000 236003                    LDQ     -131072,DU
        14 003130   000000 756000 xsym               STQ     COMMAND_ERROR

      942    21792    3                RETURN;

  21792 14 003131   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 003132   000001 702211                    TSX2  ! 1,X1

      943    21793    3            END;
      944    21794        /***
      945    21795         ***  Get the tape open information from :ARCHIVE.
      946    21796         ***/
      947    21797
      948    21798    2          TAPE_OPEN.V.DENSITY# = ARCHIVE$->ARCHIVE_LIST.OPTION.DEN;

  21798 14 003133   000007 236100                    LDQ     7,,PR0
        14 003134   770000 376003                    ANQ     -4096,DU
        14 003135   000036 772000                    QRL     30
        14 003136   000066 552004 xsym               STBQ    TAPE_OPEN+54,'04'O

      949    21799    2          TAPE_OPEN.V.VOLACCESS# = ARCHIVE$->ARCHIVE_LIST.OPTION.VOLA;

  21799 14 003137   000007 236100                    LDQ     7,,PR0
        14 003140   000011 772000                    QRL     9
        14 003141   000063 676000 xsym               ERQ     TAPE_OPEN+51
        14 003142   000007 376003                    ANQ     7,DU
        14 003143   000063 656000 xsym               ERSQ    TAPE_OPEN+51
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:139  

      950    21800    2          TAPE_OPEN.V.EXPIRE# = ARCHIVE$->ARCHIVE_LIST.OPTION.EXP;

  21800 14 003144   000010 235100                    LDA     8,,PR0
        14 003145   000057 755000 xsym               STA     TAPE_OPEN+47

      951    21801    2          TAPE_OPEN.V.BLKL# = ARCHIVE$->ARCHIVE_LIST.OPTION.BLOCK;

  21801 14 003146   000007 720100                    LXL0    7,,PR0
        14 003147   000052 740000 xsym               STX0    TAPE_OPEN+42

      952    21802    2          TAPE_OPEN.V.OPER.MNTONLY# = %NO#;

  21802 14 003150   000066 236000 15                 LDQ     54
        14 003151   000044 356000 xsym               ANSQ    TAPE_OPEN+36

      953    21803    2          IF NOT TAPE_OPTION.CHECK_SPECD    /* Use default if not spec'd on cmnd */

  21803 14 003152   000000 236000 xsym               LDQ     TAPE_OPTION
        14 003153   200000 316003                    CANQ    65536,DU
        14 003154   003162 601000 14                 TNZ     s:21805

      954    21804    2            THEN TAPE_OPTION.CHECK = ARCHIVE$->ARCHIVE_LIST.OPTION.CHECK;

  21804 14 003155   000007 236100                    LDQ     7,,PR0
        14 003156   000011 736000                    QLS     9
        14 003157   000000 676000 xsym               ERQ     TAPE_OPTION
        14 003160   400000 376003                    ANQ     -131072,DU
        14 003161   000000 656000 xsym               ERSQ    TAPE_OPTION

      955    21805    2          IF NOT TAPE_OPTION.IOERRORC_SPECD /* Use default if not spec'd on cmnd */

  21805 14 003162   000002 236000 xsym               LDQ     TAPE_OPTION+2
        14 003163   004000 316003                    CANQ    2048,DU
        14 003164   003174 601000 14                 TNZ     s:21807

      956    21806    2            THEN TAPE_OPEN.V.IOERROK# = ARCHIVE$->ARCHIVE_LIST.OPTION.IOERRORC;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:140  

  21806 14 003165   000007 236100                    LDQ     7,,PR0
        14 003166   000200 376003                    ANQ     128,DU
        14 003167   000003 736000                    QLS     3
        14 003170   000060 676000 xsym               ERQ     TAPE_OPEN+48
        14 003171   003000 376003                    ANQ     1536,DU
        14 003172   000060 656000 xsym               ERSQ    TAPE_OPEN+48
        14 003173   003201 710000 14                 TRA     s:21808

      957    21807    2            ELSE TAPE_OPEN.V.IOERROK# = TAPE_OPTION.IOERRORC;

  21807 14 003174   010000 376003                    ANQ     4096,DU
        14 003175   000002 772000                    QRL     2
        14 003176   000060 676000 xsym               ERQ     TAPE_OPEN+48
        14 003177   003000 376003                    ANQ     1536,DU
        14 003200   000060 656000 xsym               ERSQ    TAPE_OPEN+48

      958    21808    2          TAPE_OPEN.V.XTEND# = ARCHIVE$->ARCHIVE_LIST.XTEND;

  21808 14 003201   000006 236100                    LDQ     6,,PR0
        14 003202   000400 376003                    ANQ     256,DU
        14 003203   000005 736000                    QLS     5
        14 003204   000060 676000 xsym               ERQ     TAPE_OPEN+48
        14 003205   030000 376003                    ANQ     12288,DU
        14 003206   000060 656000 xsym               ERSQ    TAPE_OPEN+48

      959    21809    2          TAPE_OPEN.V.FSN# = 0;

  21809 14 003207   000000 221003                    LDX1    0,DU
        14 003210   000066 741000 xsym               STX1    TAPE_OPEN+54

      960    21810    2          IF NOT ARCHIVE$->ARCHIVE_LIST.OD  /* Optical disk or tape archive file? */

  21810 14 003211   000006 236100                    LDQ     6,,PR0
        14 003212   000200 316003                    CANQ    128,DU
        14 003213   003217 601000 14                 TNZ     s:21812

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:141  
      961    21811    2            THEN LAST_TAPE_FSN = 9999;

  21811 14 003214   023417 235007                    LDA     9999,DL
        14 003215   000000 755000 xsym               STA     LAST_TAPE_FSN
        14 003216   003221 710000 14                 TRA     s:21813

      962    21812    2            ELSE LAST_TAPE_FSN = 262143;

  21812 14 003217   777777 235007                    LDA     -1,DL
        14 003220   000000 755000 xsym               STA     LAST_TAPE_FSN

      963    21813    2          TAPE_OPEN.NAME_ = VECTOR(ERASE);

  21813 14 003221   000070 237000 15                 LDAQ    56
        14 003222   000006 757000 xsym               STAQ    TAPE_OPEN+6

      964    21814    2          TAPE_OPEN.V.INITZ.SCRUB# = %YES#;

  21814 14 003223   400000 236007                    LDQ     -131072,DL
        14 003224   000044 256000 xsym               ORSQ    TAPE_OPEN+36

      965    21815    2          TAPE_OPEN.V.VOL# = 0;

  21815 14 003225   000000 236003                    LDQ     0,DU
        14 003226   000061 552040 xsym               STBQ    TAPE_OPEN+49,'40'O

      966    21816    2          TAPE_OPEN.V.FUN# = %CREATE#;

  21816 14 003227   003000 236007                    LDQ     1536,DL
        14 003230   000045 552010 xsym               STBQ    TAPE_OPEN+37,'10'O

      967    21817    2          IF NOT ARCHIVE$->ARCHIVE_LIST.OD /* Optical disk or tape archive file? */

  21817 14 003231   000006 236100                    LDQ     6,,PR0
        14 003232   000200 316003                    CANQ    128,DU
        14 003233   003245 601000 14                 TNZ     s:21825

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:142  
      968    21818    2            THEN
      969    21819    3              DO;

      970    21820    3                  TAPE_OPEN.V.CVOL# = %YES#;

  21820 14 003234   000044 236000 xsym               LDQ     TAPE_OPEN+36
        14 003235   000067 376000 15                 ANQ     55
        14 003236   000004 276007                    ORQ     4,DL
        14 003237   000044 756000 xsym               STQ     TAPE_OPEN+36

      971    21821    3                  TAPE_OPEN.V.RES# = 'LT';

  21821 14 003240   000001 236000 13                 LDQ     1
        14 003241   777777 376003                    ANQ     -1,DU
        14 003242   040040 276007                    ORQ     16416,DL
        14 003243   000050 756000 xsym               STQ     TAPE_OPEN+40

      972    21822    3              END;

  21822 14 003244   003255 710000 14                 TRA     s:21829

      973    21823    2            ELSE
      974    21824    3              DO;

      975    21825    3                  TAPE_OPEN.V.CVOL# = %NO#;

  21825 14 003245   000067 236000 15                 LDQ     55
        14 003246   000044 356000 xsym               ANSQ    TAPE_OPEN+36

      976    21826    3                  TAPE_OPEN.V.RES# = 'OD';

  21826 14 003247   000000 236000 13                 LDQ     0
        14 003250   777777 376003                    ANQ     -1,DU
        14 003251   040040 276007                    ORQ     16416,DL
        14 003252   000050 756000 xsym               STQ     TAPE_OPEN+40

      977    21827    3                  TAPE_OPEN.V.ASN# = %FILE#;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:143  

  21827 14 003253   000001 236007                    LDQ     1,DL
        14 003254   000045 552004 xsym               STBQ    TAPE_OPEN+37,'04'O

      978    21828    3              END;

      979    21829    2          TAPE_OPEN.IFPARAM_ = VECTOR(NIL);

  21829 14 003255   000072 237000 15                 LDAQ    58
        14 003256   000026 757000 xsym               STAQ    TAPE_OPEN+22

      980    21830    2          TAPE_OPEN.FPARAM_ = VECTOR(NIL);

  21830 14 003257   000072 237000 15                 LDAQ    58
        14 003260   000030 757000 xsym               STAQ    TAPE_OPEN+24

      981    21831
      982    21832    2          NBR_GRANS_PER_TAPE_BUF = ARCHIVE$->ARCHIVE_LIST.OPTION.BLOCK/4096;

  21832 14 003261   000007 236100                    LDQ     7,,PR0
        14 003262   777777 376007                    ANQ     -1,DL
        14 003263   000014 772000                    QRL     12
        14 003264   000000 756000 xsym               STQ     NBR_GRANS_PER_TAPE_BUF

      983    21833        /***
      984    21834         ***  Allocate the memory for the tapeset which will be used
      985    21835         ***  for the tape open routine.
      986    21836         ***/
      987    21837    2          SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM# *

  21837 14 003265   100000 236100                    LDQ     0,,PR1
        14 003266   000006 402007                    MPY     6,DL
        14 003267   000007 036007                    ADLQ    7,DL
        14 003270   000004 506007                    DIV     4,DL
        14 003271   000355 756000 2                  STQ     SNSIZE

      988    21838    2                    LENGTHC(VLP_SN.SN#(0)) + 3) / 4;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:144  
      989    21839    2          NBR_SNLISTS = 0;

  21839 14 003272   000000 450000 xsym               STZ     NBR_SNLISTS

      990    21840    2          CALL FLE_BUILD_SNLIST;

  21840 14 003273   003321 701000 14                 TSX1    FLE_BUILD_SNLIST
        14 003274   000000 011000                    NOP     0

      991    21841    2          IF ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST2 ~= 0

  21841 14 003275   000000 470400 xsym               LDP0    ARCHIVE$
        14 003276   000005 235100                    LDA     5,,PR0
        14 003277   003306 600000 14                 TZE     s:21853

      992    21842    2            THEN
      993    21843    3            DO;

      994    21844    3                AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST2);

  21844 14 003300   000005 720100                    LXL0    5,,PR0
        14 003301   000000 636010                    EAQ     0,X0
        14 003302   000000 036000 xsym               ADLQ    ARCHIVE$
        14 003303   000353 756000 2                  STQ     AVAIL$

      995    21845    3                CALL FLE_BUILD_SNLIST;

  21845 14 003304   003321 701000 14                 TSX1    FLE_BUILD_SNLIST
        14 003305   000000 011000                    NOP     0

      996    21846    3            END;

      997    21847
      998    21848        /***
      999    21849         *** Leave the archive file for the master packset open so that multiple
     1000    21850         *** archives are prevented from running simultaneously.
     1001    21851         ***/
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:145  
     1002    21852
     1003    21853    3          DO WHILE('0'B);

  21853 14 003306   003317 710000 14                 TRA     s:21859

     1004    21854    3   ALT3:
     1005    21855    3            CALL FLI$RPT_ERR;

  21855 14 003307   000002 631400 xsym  ALT3         EPPR1   B_VECTNIL+2
        14 003310   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 003311   000000 011000                    NOP     0

     1006    21856    3            CALL M$CLOSE(CLOSE_ARCHIVE);

  21856 14 003312   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 003313   050001 713400                    CLIMB   close
        14 003314   406000 401760                    pmme    nvectors=13

     1007    21857    3            COMMAND_ERROR = '1'B;

  21857 14 003315   400000 236003                    LDQ     -131072,DU
        14 003316   000000 756000 xsym               STQ     COMMAND_ERROR

     1008    21858    3          END;

     1009    21859    2          RETURN;

  21859 14 003317   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 003320   000001 702211                    TSX2  ! 1,X1

     1010    21860    2   END FLE_GET_ARCHIVE_SNLIST;
     1011    21861        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:146  
     1012    21862    1   FLE_BUILD_SNLIST: PROC;

  21862 14 003321   200006 741300       FLE_BUILD_S* STX1  ! @COMMAND+3,,AUTO

     1013    21863        /*F*  NAME: FLE_BUILD_SNLIST
     1014    21864              PURPOSE: Build SNLIST from :ARCHIVE.$$EFT file.
     1015    21865         ***/
     1016    21866    2          CALL FLI$ALLOC(SNSIZE,TPTR$);

  21866 14 003322   000074 630400 15                 EPPR0   60
        14 003323   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 003324   000000 701000 xent               TSX1    FLI$ALLOC
        14 003325   000000 011000                    NOP     0

     1017    21867    3          DO I = 0 TO AVAIL$->VLP_SN.NUM# - 1;

  21867 14 003326   000345 450000 2                  STZ     I
        14 003327   003342 710000 14                 TRA     s:21869+3

     1018    21868    3            TPTR$->VLP_SN.SN#(I) = AVAIL$->VLP_SN.SN#(I);

  21868 14 003330   000345 236000 2                  LDQ     I
        14 003331   000006 402007                    MPY     6,DL
        14 003332   000353 470400 2                  LDP0    AVAIL$
        14 003333   000361 471400 2                  LDP1    TPTR$
        14 003334   040106 100506                    MLR     fill='040'O
        14 003335   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 003336   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

     1019    21869    3          END;

  21869 14 003337   000345 235000 2                  LDA     I
        14 003340   000001 035007                    ADLA    1,DL
        14 003341   000345 755000 2                  STA     I
        14 003342   000353 470400 2                  LDP0    AVAIL$
        14 003343   000345 236000 2                  LDQ     I
        14 003344   003347 604000 14                 TMI     s:21870
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:147  
        14 003345   000000 116100                    CMPQ    0,,PR0
        14 003346   003330 604000 14                 TMI     s:21868

     1020    21870    2          TPTR$->VLP_SN.NUM# = AVAIL$->VLP_SN.NUM#;

  21870 14 003347   000361 471400 2                  LDP1    TPTR$
        14 003350   000000 235100                    LDA     0,,PR0
        14 003351   100000 755100                    STA     0,,PR1

     1021    21871    2          NBR_SNLISTS = NBR_SNLISTS + 1;

  21871 14 003352   000000 054000 xsym               AOS     NBR_SNLISTS

     1022    21872
     1023    21873    2          CALL FLI$ALLOC(SIZEW(SNLISTINFO),BUF$);

  21873 14 003353   000076 630400 15                 EPPR0   62
        14 003354   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 003355   000000 701000 xent               TSX1    FLI$ALLOC
        14 003356   000000 011000                    NOP     0

     1024    21874    2          BUF$->SNLISTINFO.SNLIST$ = TPTR$;

  21874 14 003357   000361 236000 2                  LDQ     TPTR$
        14 003360   000360 470400 2                  LDP0    BUF$
        14 003361   000000 756100                    STQ     0,,PR0

     1025    21875    2          BUF$->SNLISTINFO.PREVINFO$ = LAST_SNLISTINFO$;

  21875 14 003362   000000 236000 xsym               LDQ     LAST_SNLISTINFO$
        14 003363   000360 470400 2                  LDP0    BUF$
        14 003364   000001 756100                    STQ     1,,PR0

     1026    21876    2          LAST_SNLISTINFO$ = BUF$;

  21876 14 003365   000360 236000 2                  LDQ     BUF$
        14 003366   000000 756000 xsym               STQ     LAST_SNLISTINFO$
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:148  

     1027    21877    2          RETURN;

  21877 14 003367   200006 221300                    LDX1  ! @COMMAND+3,,AUTO
        14 003370   000001 702211                    TSX2  ! 1,X1

     1028    21878    2   END FLE_BUILD_SNLIST;
     1029    21879        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:149  
     1030    21880    1   FLE_UPDATE_ARCHIVE:PROC ;

  21880 14 003371   200004 741300       FLE_UPDATE_* STX1  ! @COMMAND+1,,AUTO

     1031    21881        /*F*   NAME: FLE_UPDATE_ARCHIVE
     1032    21882               PURPOSE: Update ARCHIVE_LIST record when there is new reel
     1033    21883                        for ARCHIVE command
     1034    21884        ***/
     1035    21885
     1036    21886    2          AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST);

  21886 14 003372   000000 470400 xsym               LDP0    ARCHIVE$
        14 003373   000004 720100                    LXL0    4,,PR0
        14 003374   000000 636010                    EAQ     0,X0
        14 003375   000000 036000 xsym               ADLQ    ARCHIVE$
        14 003376   000353 756000 2                  STQ     AVAIL$

     1037    21887    2          SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM#*LENGTHC(VLP_SN.
             21887                   SN#(0))+3)/4;

  21887 14 003377   000353 471400 2                  LDP1    AVAIL$
        14 003400   100000 236100                    LDQ     0,,PR1
        14 003401   000006 402007                    MPY     6,DL
        14 003402   000007 036007                    ADLQ    7,DL
        14 003403   000004 506007                    DIV     4,DL
        14 003404   000355 756000 2                  STQ     SNSIZE

     1038    21888    2          TPTR$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST+SNSIZE);

  21888 14 003405   000004 036100                    ADLQ    4,,PR0
        14 003406   000022 736000                    QLS     18
        14 003407   000000 036000 xsym               ADLQ    ARCHIVE$
        14 003410   000361 756000 2                  STQ     TPTR$

     1039    21889
     1040    21890    2          K = AVAIL$->VLP_SN.NUM#;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:150  
  21890 14 003411   100000 235100                    LDA     0,,PR1
        14 003412   000347 755000 2                  STA     K

     1041    21891    3          DO J = 0 TO K-1;

  21891 14 003413   000346 450000 2                  STZ     J
        14 003414   003426 710000 14                 TRA     s:21893+3

     1042    21892    3            AVAIL$->VLP_SN.SN#(J) = AVAIL$->VLP_SN.SN#(J+1);

  21892 14 003415   000346 236000 2                  LDQ     J
        14 003416   000006 402007                    MPY     6,DL
        14 003417   000353 470400 2                  LDP0    AVAIL$
        14 003420   040106 100506                    MLR     fill='040'O
        14 003421   000002 400006                    ADSC9   2,Q,PR0                  cn=2,n=6
        14 003422   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6

     1043    21893    3          END;

  21893 14 003423   000346 235000 2                  LDA     J
        14 003424   000001 035007                    ADLA    1,DL
        14 003425   000346 755000 2                  STA     J
        14 003426   000346 236000 2                  LDQ     J
        14 003427   000347 116000 2                  CMPQ    K
        14 003430   003415 602000 14                 TNC     s:21892

     1044    21894    2          AVAIL$->VLP_SN.NUM# = K - 1;

  21894 14 003431   000347 235000 2                  LDA     K
        14 003432   000001 135007                    SBLA    1,DL
        14 003433   000353 470400 2                  LDP0    AVAIL$
        14 003434   000000 755100                    STA     0,,PR0

     1045    21895    2          AVAIL$->VLP_SN.SN#(K-1) = ' ';

  21895 14 003435   000347 236000 2                  LDQ     K
        14 003436   000006 402007                    MPY     6,DL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:151  
        14 003437   000353 470400 2                  LDP0    AVAIL$
        14 003440   040106 100400                    MLR     fill='040'O
        14 003441   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 003442   077777 400006                    ADSC9   -1,Q,PR0                 cn=2,n=6

     1046    21896
     1047    21897    2          IF ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST2 ~= 0

  21897 14 003443   000000 470400 xsym               LDP0    ARCHIVE$
        14 003444   000005 235100                    LDA     5,,PR0
        14 003445   003552 600000 14                 TZE     s:21915

     1048    21898    2            THEN
     1049    21899    3            DO;

     1050    21900    3                SNSIZE = (LENGTHC(AVAIL$->VLP_SN.NUM#) + AVAIL$->VLP_SN.NUM#*LENGTHC(
             21900                         VLP_SN.SN#(0))+3)/4;

  21900 14 003446   000353 471400 2                  LDP1    AVAIL$
        14 003447   100000 236100                    LDQ     0,,PR1
        14 003450   000006 402007                    MPY     6,DL
        14 003451   000007 036007                    ADLQ    7,DL
        14 003452   000004 506007                    DIV     4,DL
        14 003453   000355 756000 2                  STQ     SNSIZE

     1051    21901    3                AVAIL$ = PINCRW(AVAIL$,SNSIZE);

  21901 14 003454   000022 736000                    QLS     18
        14 003455   000353 036000 2                  ADLQ    AVAIL$
        14 003456   000353 756000 2                  STQ     AVAIL$

     1052    21902    4                DO J = 0 TO PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST)->
             21902                         VLP_SN.NUM# - 1;

  21902 14 003457   000346 450000 2                  STZ     J
        14 003460   003473 710000 14                 TRA     s:21904+3

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:152  
     1053    21903    4                    AVAIL$->VLP_SN.SN#(J) = TPTR$->VLP_SN.SN#(J+1);

  21903 14 003461   000346 236000 2                  LDQ     J
        14 003462   000006 402007                    MPY     6,DL
        14 003463   000361 470400 2                  LDP0    TPTR$
        14 003464   000353 471400 2                  LDP1    AVAIL$
        14 003465   040106 100506                    MLR     fill='040'O
        14 003466   000002 400006                    ADSC9   2,Q,PR0                  cn=2,n=6
        14 003467   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

     1054    21904    4                END;

  21904 14 003470   000346 235000 2                  LDA     J
        14 003471   000001 035007                    ADLA    1,DL
        14 003472   000346 755000 2                  STA     J
        14 003473   000000 470400 xsym               LDP0    ARCHIVE$
        14 003474   000004 720100                    LXL0    4,,PR0
        14 003475   000346 236000 2                  LDQ     J
        14 003476   003501 604000 14                 TMI     s:21906
        14 003477   000000 116110                    CMPQ    0,X0,PR0
        14 003500   003461 604000 14                 TMI     s:21903

     1055    21905
     1056    21906    3                TPTR$ = ADDR(AVAIL$->VLP_SN.SN#(J));  /* Clean up archive record */

  21906 14 003501   000015 402000 15                 MPY     13
        14 003502   000001 036003                    ADLQ    1,DU
        14 003503   000353 036000 2                  ADLQ    AVAIL$
        14 003504   000361 756000 2                  STQ     TPTR$

     1057    21907    3                TEMP = ARCHIVE$->ARCHIVE_LIST.SIZE * 4 - POFFC(TPTR$ , ARCHIVE$);

  21907 14 003505   000000 236000 xsym               LDQ     ARCHIVE$
        14 003506   000020 772000                    QRL     16
        14 003507   200010 756100                    STQ     @COMMAND+5,,AUTO
        14 003510   000361 236000 2                  LDQ     TPTR$
        14 003511   000020 772000                    QRL     16
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:153  
        14 003512   200010 136100                    SBLQ    @COMMAND+5,,AUTO
        14 003513   200011 756100                    STQ     @COMMAND+6,,AUTO
        14 003514   000002 236100                    LDQ     2,,PR0
        14 003515   000002 736000                    QLS     2
        14 003516   000027 676000 xsym               ERQ     B_VECTNIL+23
        14 003517   000001 036007                    ADLQ    1,DL
        14 003520   200011 036100                    ADLQ    @COMMAND+6,,AUTO
        14 003521   000027 676000 xsym               ERQ     B_VECTNIL+23
        14 003522   000001 036007                    ADLQ    1,DL
        14 003523   000350 756000 2                  STQ     TEMP

     1058    21908    4                DO J = 0 TO TEMP - 1;

  21908 14 003524   000346 450000 2                  STZ     J
        14 003525   003535 710000 14                 TRA     s:21910+2

     1059    21909    4                  TPTR$->BLANK(J) = ' ';

  21909 14 003526   000361 470400 2                  LDP0    TPTR$
        14 003527   000346 235000 2                  LDA     J
        14 003530   040105 100400                    MLR     fill='040'O
        14 003531   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 003532   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1

     1060    21910    4                END;

  21910 14 003533   000001 035007                    ADLA    1,DL
        14 003534   000346 755000 2                  STA     J
        14 003535   000346 236000 2                  LDQ     J
        14 003536   003541 604000 14                 TMI     s:21912
        14 003537   000350 116000 2                  CMPQ    TEMP
        14 003540   003526 604000 14                 TMI     s:21909

     1061    21911
     1062    21912    3                AVAIL$->VLP_SN.NUM# = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.
             21912                         SNLIST)->VLP_SN.NUM#;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:154  
  21912 14 003541   000000 470400 xsym               LDP0    ARCHIVE$
        14 003542   000004 720100                    LXL0    4,,PR0
        14 003543   000353 471400 2                  LDP1    AVAIL$
        14 003544   000000 235110                    LDA     0,X0,PR0
        14 003545   100000 755100                    STA     0,,PR1

     1063    21913    3                ARCHIVE$->ARCHIVE_LIST.OFFSET.SNLIST2 = ARCHIVE$->ARCHIVE_LIST.OFFSET.
             21913                         SNLIST+SNSIZE;

  21913 14 003546   000000 470400 xsym               LDP0    ARCHIVE$
        14 003547   000004 236100                    LDQ     4,,PR0
        14 003550   000355 036000 2                  ADLQ    SNSIZE
        14 003551   000005 756100                    STQ     5,,PR0

     1064    21914    3            END;

     1065    21915    2   RETURN;

  21915 14 003552   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 003553   000001 702211                    TSX2  ! 1,X1

     1066    21916    2   END FLE_UPDATE_ARCHIVE;
     1067    21917        %EJECT;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:155  
     1068    21918    1   FLE_FINISH_ARCHIVE:PROC;

  21918 14 003554   200004 741300       FLE_FINISH_* STX1  ! @COMMAND+1,,AUTO

     1069    21919        /*F*  NAME: FLE_FINISH_ARCHIVE
     1070    21920              PURPOSE: Write the updated ARCHIVE_LIST record to
     1071    21921                       all ARCHIVE packsets after ARCHIVE command
     1072    21922                       performed.
     1073    21923        ***/
     1074    21924
     1075    21925    2          CALL M$CLOSE(CLOSE_ARCHIVE);

  21925 14 003555   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 003556   050001 713400                    CLIMB   close
        14 003557   406000 401760                    pmme    nvectors=13

     1076    21926    2          ARCHIVE$->ARCHIVE_LIST.XTEND = %YES#;

  21926 14 003560   000000 470400 xsym               LDP0    ARCHIVE$
        14 003561   000400 236003                    LDQ     256,DU
        14 003562   000006 256100                    ORSQ    6,,PR0

     1077    21927    2          AVAIL$ = PINCRW(ARCHIVE$,ARCHIVE$->ARCHIVE_LIST.OFFSET.DPLIST);

  21927 14 003563   000003 720100                    LXL0    3,,PR0
        14 003564   000000 636010                    EAQ     0,X0
        14 003565   000000 036000 xsym               ADLQ    ARCHIVE$
        14 003566   000353 756000 2                  STQ     AVAIL$

     1078    21928    2          OPEN_ARCHIVE_FILE.V.FUN# = %CREATE#;

  21928 14 003567   003000 236007                    LDQ     1536,DL
        14 003570   000273 552010 2                  STBQ    OPEN_ARCHIVE_FILE+37,'10'O

     1079    21929    2          OPEN_ARCHIVE_FILE.V.EXIST# = %NEWFILE#;

  21929 14 003571   000600 236007                    LDQ     384,DL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:156  
        14 003572   000272 256000 2                  ORSQ    OPEN_ARCHIVE_FILE+36

     1080    21930    2          OPEN_ARCHIVE_FILE.V.EXPIRE# = %NEVER#;

  21930 14 003573   000001 335007                    LCA     1,DL
        14 003574   000305 755000 2                  STA     OPEN_ARCHIVE_FILE+47

     1081    21931    3          DO I = 0 TO AVAIL$->VLP_SN.NUM# - 1;

  21931 14 003575   000345 450000 2                  STZ     I
        14 003576   003655 710000 14                 TRA     s:21946+3

     1082    21932    3            DPSN.SN#(0) = AVAIL$->VLP_SN.SN#(I);

  21932 14 003577   000345 236000 2                  LDQ     I
        14 003600   000006 402007                    MPY     6,DL
        14 003601   000353 470400 2                  LDP0    AVAIL$
        14 003602   040000 100506                    MLR     fill='040'O
        14 003603   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
        14 003604   000341 000006 2                  ADSC9   DPSN+1                   cn=0,n=6

     1083    21933    3            CALL M$OPEN(OPEN_ARCHIVE_FILE) ALTRET(ERR);

  21933 14 003605   000226 630400 2                  EPPR0   OPEN_ARCHIVE_FILE
        14 003606   450000 713400                    CLIMB   alt,open
        14 003607   410400 401760                    pmme    nvectors=18
        14 003610   003640 702000 14                 TSX2    ERR

     1084    21934    3            WRITE_ARCHIVE_REC.BUF_ = VECTOR(ARCHIVE_REC_SIZE);

  21934 14 003611   000030 237000 15                 LDAQ    24
        14 003612   000160 757000 2                  STAQ    WRITE_ARCHIVE_REC+4

     1085    21935    3            CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);

  21935 14 003613   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 003614   440001 713400                    CLIMB   alt,write
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:157  
        14 003615   401400 401760                    pmme    nvectors=4
        14 003616   003640 702000 14                 TSX2    ERR

     1086    21936    3            WRITE_ARCHIVE_REC.BUF_.BUF$ = ARCHIVE$;

  21936 14 003617   000000 236000 xsym               LDQ     ARCHIVE$
        14 003620   000161 756000 2                  STQ     WRITE_ARCHIVE_REC+5

     1087    21937    3            WRITE_ARCHIVE_REC.BUF_.BOUND = ARCHIVE_REC_SIZE * 4 - 1;

  21937 14 003621   000356 236000 2                  LDQ     ARCHIVE_REC_SIZE
        14 003622   000002 736000                    QLS     2
        14 003623   000001 136007                    SBLQ    1,DL
        14 003624   000020 736000                    QLS     16
        14 003625   000160 676000 2                  ERQ     WRITE_ARCHIVE_REC+4
        14 003626   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 003627   000160 656000 2                  ERSQ    WRITE_ARCHIVE_REC+4

     1088    21938    3            CALL M$WRITE(WRITE_ARCHIVE_REC) ALTRET(ERR);

  21938 14 003630   000154 630400 2                  EPPR0   WRITE_ARCHIVE_REC
        14 003631   440001 713400                    CLIMB   alt,write
        14 003632   401400 401760                    pmme    nvectors=4
        14 003633   003640 702000 14                 TSX2    ERR

     1089    21939    3            CALL M$CLOSE(CLOSE_ARCHIVE);

  21939 14 003634   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 003635   050001 713400                    CLIMB   close
        14 003636   406000 401760                    pmme    nvectors=13

     1090    21940    4            DO WHILE('0'B);

  21940 14 003637   003652 710000 14                 TRA     s:21946

     1091    21941    4   ERR:
     1092    21942    4                CALL FLI$RPT_ERR;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:158  

  21942 14 003640   000002 631400 xsym  ERR          EPPR1   B_VECTNIL+2
        14 003641   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 003642   000000 011000                    NOP     0

     1093    21943    4                CALL M$CLOSE(CLOSE_ARCHIVE);

  21943 14 003643   000170 630400 2                  EPPR0   CLOSE_ARCHIVE
        14 003644   050001 713400                    CLIMB   close
        14 003645   406000 401760                    pmme    nvectors=13

     1094    21944    4                IF I = 0 THEN RETURN;

  21944 14 003646   000345 235000 2                  LDA     I
        14 003647   003652 601000 14                 TNZ     s:21946

  21944 14 003650   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 003651   000001 702211                    TSX2  ! 1,X1

     1095    21945    4            END;

     1096    21946    3          END;

  21946 14 003652   000345 235000 2                  LDA     I
        14 003653   000001 035007                    ADLA    1,DL
        14 003654   000345 755000 2                  STA     I
        14 003655   000353 470400 2                  LDP0    AVAIL$
        14 003656   000345 236000 2                  LDQ     I
        14 003657   003662 604000 14                 TMI     s:21947
        14 003660   000000 116100                    CMPQ    0,,PR0
        14 003661   003577 604000 14                 TMI     s:21932

     1097    21947    2   RETURN;

  21947 14 003662   200004 221300                    LDX1  ! @COMMAND+1,,AUTO
        14 003663   000001 702211                    TSX2  ! 1,X1
     1098    21948    2   END FLE_FINISH_ARCHIVE;
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:159  
     1099    21949    1   END FLE$ESTMOD;

PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:160  
--  Include file information  --

   FLS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FL_PERR_C.:E05TOU  is referenced.
   FLE_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$FIT.:E05TOU  is referenced.
   FLN_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   XU_SUBS_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLE$ESTMOD.
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:161  

 **** Variables and constants ****

  ****  Section 002  Data  FLE$ESTMOD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   356-0-0/w UBIN        r     1 ARCHIVE_REC_SIZE         353-0-0/w PTR         r     1 AVAIL$
   360-0-0/w PTR         r     1 BUF$                     170-0-0/d STRC(1080)  r     1 CLOSE_ARCHIVE
   100-0-0/d STRC(1080)  r     1 CLOSE_BLOCK_FILE         354-0-0/w UBIN        r     1 DCB#
   142-0-0/d STRC(360)   r     1 DEL_NODATA_REC           344-0-0/w UBIN        r     1 DPSIZE
   340-0-0/d STRC(90)    r     1 DPSN                     336-0-0/w STRC        r     1 ERRCODE
   345-0-0/w UBIN        r     1 I                        346-0-0/w UBIN        r     1 J
   347-0-0/w UBIN        r     1 K                        226-0-0/d STRC(2088)  r     1 OPEN_ARCHIVE_FILE
     6-0-0/d STRC(2088)  r     1 OPEN_BLOCK_FILE          320-0-0/d STRC(504)   r     1 READ_ARCHIVE_FILE
   351-0-0/w UBIN        r     1 SIZE                     355-0-0/w UBIN        r     1 SNSIZE
   357-0-0/w PTR         r     1 START$                   350-0-0/w SBIN        r     1 TEMP
   361-0-0/w PTR         r     1 TPTR$                    154-0-0/d STRC(432)   r     1 WRITE_ARCHIVE_REC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @COMMAND                  *0-0-0/w UBIN        r     1 COMMAND

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 ARCHIVE$                   0-0-0/c ASTR(9)     r     1 ARCHIVE_NAME
     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/c ASTR(9)     r     1 BACKUP_NAME
     0-0-0/w PTR         r     1 BLK_TAG$                   0-0-0/w PTR         r     1 BLK_TAG0$
     0-0-0/w PTR         r     1 BLOCK_GRAN$                0-0-0/c CHAR        r     1 B_VERSION
     0-0-0/b BIT         r     1 COMMAND_ERROR              0-0-0/d STRC(1080)  r     1 CON_CLOSE_ARCHIVE
     0-0-0/d STRC(2088)  r     1 CON_OPEN_ARCHIVE_FILE
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:162  
     0-0-0/d STRC(504)   r     1 CON_READ_ARCHIVE_FILE
     0-0-0/d STRC(90)    r     1 DISK_DEST_SN               0-0-0/w PTR         r     1 DISK_FILE_SPEC$
     0-0-0/w PTR         r     1 DISK_GRAN$                 0-0-0/w PTR         r     1 DPLIST$
     0-0-0/w PTR         r     1 DPRESLIST$                 0-0-0/c ASTR(9)     r     1 DUAL_FILE
     0-0-0/c ASTR(9)     r     1 EFT_CVOL_FILE              0-0-0/c ASTR(9)     r     1 EFT_RESTRICT_FILE
     0-0-0/w STRC        r     1 E_ALREADY_ESTABLISH        0-0-0/w STRC        r     1 E_ARCFILE_REMOVED
     0-0-0/w STRC        r     1 E_ARCHIVE_OUT_TAPESET
     0-0-0/w STRC        r     1 E_CANT_SPECIFY_DENSITY
     0-0-0/w STRC        r     1 E_CANT_SPECIFY_EXPIRE
     0-0-0/w STRC        r     1 E_MEMBER_OF_ARCHIVE        0-0-0/w STRC        r     1 E_NOT_ARCHIVE_MASTER
     0-0-0/w STRC        r     1 E_NOT_MEMBER_OF_ARCHIVE
     0-0-0/w STRC        r     1 E_NO_ARCFILE               0-0-0/w STRC        r     1 E_NUM_ARCHIVE_SETS
     0-0-0/w STRC        r     1 E_REMOVE_FROM_ARCHIVE
     0-0-0/w STRC        r     1 E_REMOVE_MASTER_PACKSET
     0-0-0/w STRC        r     1 E_TYPE_ARCHIVE_SET         0-0-0/c STRC(72)    r     1 FROM_DISK_ACCT
     0-0-0/c STRC(288)   r     1 FROM_DISK_NAME             0-0-0/d STRC(90)    r     1 FROM_DISK_SN
     0-0-0/w PTR         r     1 LAST_SNLISTINFO$           0-0-0/w SBIN        r     1 LAST_TAPE_FSN
     0-0-0/w SBIN        r     1 NBR_BYTES_TO_MOVE
     0-0-0/w SBIN        r     1 NBR_GRANS_PER_TAPE_BUF
     0-0-0/w SBIN        r     1 NBR_SNLISTS                0-0-0/c ASTR(9)     r     1 NODATA_FILE_NAME
     0-0-0/c STRC(369)   r     1 NODATA_KEY                 0-0-0/c ASTR(9)     r     1 PRIME_FILE
     0-0-0/c ASTR(9)     r     1 REBUILD_DIR_KEY            0-0-0/c ASTR(9)     r     1 REBUILD_KEY
     0-0-0/c ASTR(9)     r     1 REBUILD_NAME               0-0-0/c ASTR(9)     r     1 RET_CMDS_NAME
     0-0-0/w PTR         r     1 SNVECLIST$                 0-0-0/w PTR         r     1 TAPE_DCBLIST$
     0-0-0/d STRC(2088)  r     1 TAPE_OPEN                  0-0-0/w STRC(144)   r     1 TAPE_OPTION
     0-0-0/c ASTR(9)     r     1 TSN_USED_NAME

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(324)   r     1 ARCHIVE_LIST               0-0-0/w STRC(2448)  r     1 B$EXCFR
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/c ASTR(9)     r     1 B$VERSION
     0-0-0/c CHAR        r     1 BLANK(0:0)                 0-0-0/d STRC(90)    r     1 DPLIST
     0-0-0/w STRC(72)    r     1 DPRESLIST                  0-0-0N  NULL        r     1 M$ARCHIVE
     0-0-0N  NULL        r     1 M$DISK_IN                  0-0-0N  NULL        r     1 M$NODATA_LIST
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:163  
     0-0-0/w STRC(72)    r     1 SNLISTINFO                 0-0-0/d STRC(90)    r     1 VLP_SN


   Procedure FLE$ESTMOD requires 1972 words for executable code.
   Procedure FLE$ESTMOD requires 10 words of local(AUTO) storage.

    No errors detected in file FLE$ESTMOD.:E05TSI    .
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:164  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:165  
          MINI XREF LISTING

ALT IN PROCEDURE FLE_MODIFY
     21358**LABEL   21143--CALLALT 21146--CALLALT 21151--CALLALT 21177--CALLALT 21204--CALLALT 21220--CALLALT
     21252--CALLALT 21323--CALLALT 21354--CALLALT
ALT1 IN PROCEDURE FLE_ADD
     21554**LABEL   21376--CALLALT 21378--CALLALT 21382--CALLALT 21443--CALLALT 21448--CALLALT 21473--GOTO
ALT2 IN PROCEDURE FLE_REMOVE
     21723**LABEL   21576--CALLALT 21579--CALLALT 21584--CALLALT 21635--CALLALT 21698--CALLALT 21702--CALLALT
     21706--CALLALT
ALT3 IN PROCEDURE FLE_GET_ARCHIVE_SNLIST
     21855**LABEL   21737--CALLALT 21740--CALLALT 21745--CALLALT
ARCHIVE$
     11868**DCL     21742<>CALL    21743>>ASSIGN  21749>>IF      21752<>CALL    21753<<ASSIGN  21754>>ASSIGN
     21757>>ASSIGN  21757>>ASSIGN  21785>>ASSIGN  21785>>ASSIGN  21798>>ASSIGN  21799>>ASSIGN  21800>>ASSIGN
     21801>>ASSIGN  21804>>ASSIGN  21806>>ASSIGN  21808>>ASSIGN  21810>>IF      21817>>IF      21832>>ASSIGN
     21841>>IF      21844>>ASSIGN  21844>>ASSIGN  21886>>ASSIGN  21886>>ASSIGN  21888>>ASSIGN  21888>>ASSIGN
     21897>>IF      21902>>DOINDEX 21902>>DOINDEX 21907>>ASSIGN  21907>>ASSIGN  21912>>ASSIGN  21912>>ASSIGN
     21913>>ASSIGN  21913>>ASSIGN  21926>>ASSIGN  21927>>ASSIGN  21927>>ASSIGN  21936>>ASSIGN
ARCHIVE_LIST
     19674**DCL     20986--ASSIGN  20989--ASSIGN  20990--ASSIGN  21014--ASSIGN  21084--ASSIGN  21264--ASSIGN
     21271<<ASSIGN  21271>>ASSIGN  21272--ASSIGN  21273--ASSIGN  21459--ASSIGN  21486<<ASSIGN  21486>>ASSIGN
     21519--ASSIGN  21596--ASSIGN
ARCHIVE_LIST.OD
     19675**DCL     21008<<ASSIGN  21009<<ASSIGN  21172>>IF      21172>>IF      21199>>IF      21215>>IF
     21810>>IF      21817>>IF
ARCHIVE_LIST.OFFSET.DPLIST
     19675**DCL     20989<<ASSIGN  21162>>ASSIGN  21263>>ASSIGN  21324>>ASSIGN  21393>>ASSIGN  21487>>ASSIGN
     21488>>ASSIGN  21498>>ASSIGN  21521>>ASSIGN  21757>>ASSIGN  21927>>ASSIGN
ARCHIVE_LIST.OFFSET.SNLIST
     19675**DCL     20990<<ASSIGN  20993>>ASSIGN  21263>>ASSIGN  21283>>ASSIGN  21310>>ASSIGN  21498<<ASSIGN
     21499>>ASSIGN  21510>>ASSIGN  21785>>ASSIGN  21886>>ASSIGN  21888>>ASSIGN  21902>>DOINDEX 21912>>ASSIGN
     21913>>ASSIGN
ARCHIVE_LIST.OFFSET.SNLIST2
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:166  
     19675**DCL     20993<<ASSIGN  20995<<ASSIGN  21245>>IF      21245>>IF      21310<<ASSIGN  21312<<ASSIGN
     21507>>IF      21510<<ASSIGN  21511>>ASSIGN  21841>>IF      21844>>ASSIGN  21897>>IF      21913<<ASSIGN
ARCHIVE_LIST.OPTION.BLOCK
     19676**DCL     21003<<ASSIGN  21227<<ASSIGN  21801>>ASSIGN  21832>>ASSIGN
ARCHIVE_LIST.OPTION.CHECK
     19676**DCL     21004<<ASSIGN  21230<<ASSIGN  21804>>ASSIGN
ARCHIVE_LIST.OPTION.DEN
     19675**DCL     21000<<ASSIGN  21207<<ASSIGN  21223<<ASSIGN  21798>>ASSIGN
ARCHIVE_LIST.OPTION.EXP
     19676**DCL     21002<<ASSIGN  21800>>ASSIGN
ARCHIVE_LIST.OPTION.IOERRORC
     19676**DCL     21005<<ASSIGN  21234<<ASSIGN  21806>>ASSIGN
ARCHIVE_LIST.OPTION.VOLA
     19676**DCL     21001<<ASSIGN  21211<<ASSIGN  21799>>ASSIGN
ARCHIVE_LIST.SIZE
     19674**DCL     21012<<ASSIGN  21160>>ASSIGN  21314<<ASSIGN  21391>>ASSIGN  21457>>ASSIGN  21520<<ASSIGN
     21593>>ASSIGN  21754>>ASSIGN  21907>>ASSIGN
ARCHIVE_LIST.VERSION.FLAG
     19674**DCL     20999<<ASSIGN  21078>>IF      21155>>IF      21386>>IF      21452>>IF      21588>>IF
     21749>>IF
ARCHIVE_LIST.VERSION.SIZE
     19674**DCL     20997<<ASSIGN
ARCHIVE_LIST.VERSION.TEXT
     19674**DCL     20998<<ASSIGN
ARCHIVE_LIST.VOLUME
     19675**DCL     20996<<ASSIGN
ARCHIVE_LIST.XTEND
     19675**DCL     21006<<ASSIGN  21313<<ASSIGN  21808>>ASSIGN  21926<<ASSIGN
ARCHIVE_NAME.L#
     19659**DCL     19659--IMP-SIZ
ARCHIVE_REC_SIZE
     20929**DCL     21011<<ASSIGN  21109--ASSIGN  21145--ASSIGN  21148<>CALL    21150>>ASSIGN  21160<<ASSIGN
     21315<<ASSIGN  21331--ASSIGN  21338>>ASSIGN  21377--ASSIGN  21379<>CALL    21381>>ASSIGN  21391<<ASSIGN
     21442--ASSIGN  21445<>CALL    21447>>ASSIGN  21457<<ASSIGN  21483>>ASSIGN  21578--ASSIGN  21581<>CALL
     21583>>ASSIGN  21593<<ASSIGN  21701--ASSIGN  21705>>ASSIGN  21739--ASSIGN  21742<>CALL    21744>>ASSIGN
     21754<<ASSIGN  21934--ASSIGN  21937>>ASSIGN
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:167  
AVAIL$
     20926**DCL     20981<<ASSIGN  20983<<ASSIGN  20985>>ASSIGN  20985>>ASSIGN  21014<<ASSIGN  21016>>ASSIGN
     21018>>ASSIGN  21020<<ASSIGN  21020>>ASSIGN  21027>>ASSIGN  21029>>ASSIGN  21034<<ASSIGN  21034>>ASSIGN
     21036>>ASSIGN  21038>>ASSIGN  21040<<ASSIGN  21040>>ASSIGN  21071<>CALL    21072>>ASSIGN  21078>>IF
     21081<>CALL    21082<<ASSIGN  21084<<ASSIGN  21084>>ASSIGN  21086>>IF      21162<<ASSIGN  21188>>IF
     21261<<ASSIGN  21262>>ASSIGN  21262>>ASSIGN  21272<<ASSIGN  21280>>ASSIGN  21282>>ASSIGN  21283<<ASSIGN
     21295>>ASSIGN  21297>>ASSIGN  21302<<ASSIGN  21302>>ASSIGN  21304>>ASSIGN  21306>>ASSIGN  21324<<ASSIGN
     21328>>DOINDEX 21329>>ASSIGN  21393<<ASSIGN  21400>>IF      21404>>DOINDEX 21405>>IF      21459<<ASSIGN
     21461>>IF      21487<<ASSIGN  21491>>ASSIGN  21493>>ASSIGN  21494>>ASSIGN  21494>>ASSIGN  21495>>ASSIGN
     21495>>ASSIGN  21497<<ASSIGN  21497>>ASSIGN  21501>>ASSIGN  21503>>ASSIGN  21504>>ASSIGN  21504>>ASSIGN
     21505<<ASSIGN  21505>>ASSIGN  21513>>ASSIGN  21515>>ASSIGN  21521<<ASSIGN  21525>>DOINDEX 21526>>ASSIGN
     21596<<ASSIGN  21599>>IF      21616>>DOINDEX 21617>>ASSIGN  21647>>DOINDEX 21648>>IF      21683>>DOINDEX
     21684>>ASSIGN  21684>>ASSIGN  21687>>ASSIGN  21687>>ASSIGN  21688>>ASSIGN  21688>>ASSIGN  21757<<ASSIGN
     21763>>IF      21767>>ASSIGN  21785<<ASSIGN  21786>>IF      21837>>ASSIGN  21837>>ASSIGN  21844<<ASSIGN
     21867>>DOINDEX 21868>>ASSIGN  21870>>ASSIGN  21886<<ASSIGN  21887>>ASSIGN  21887>>ASSIGN  21890>>ASSIGN
     21892>>ASSIGN  21892>>ASSIGN  21894>>ASSIGN  21895>>ASSIGN  21900>>ASSIGN  21900>>ASSIGN  21901<<ASSIGN
     21901>>ASSIGN  21903>>ASSIGN  21906>>ASSIGN  21912>>ASSIGN  21927<<ASSIGN  21931>>DOINDEX 21932>>ASSIGN
B$ALT.CODE
     20823**DCL     20823--REDEF   20824--REDEF   20824--REDEF
B$ALT.ERR.ERR#
     20825**DCL     20825--REDEF
B$ALT.EVID
     20824**DCL     20824--REDEF   20824--REDEF
B$EXCFR.ASL
     20833**DCL     20833--REDEF
B$EXCFR.ERR
     20847**DCL     21055>>ASSIGN
B$EXCFR.ERR.ERR#
     20847**DCL     20847--REDEF   21100>>IF      21472>>IF      21670>>IF
B$EXCFR.ERR.SEV
     20848**DCL     21428>>IF
B$EXCFR.EVID
     20846**DCL     20846--REDEF   20847--REDEF
B$EXCFR.IR
     20834**DCL     20834--REDEF
B$EXCFR.PREVSZ
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:168  
     20833**DCL     20833--REDEF
B$EXCFR.SUBC
     20845**DCL     20845--REDEF   20846--REDEF   20846--REDEF
B$TCB.ALT$
     20819**DCL     21055>>ASSIGN  21100>>IF      21428>>IF      21472>>IF      21670>>IF
B$TCB$
     11375**DCL     20819--IMP-PTR 21055>>ASSIGN  21100>>IF      21428>>IF      21472>>IF      21670>>IF
B$VERSION.L#
     20916**DCL     20917--IMP-SIZ 20997>>ASSIGN  20998>>ASSIGN  20998>>ASSIGN
B$VERSION.NAME#
     20917**DCL     20998>>ASSIGN
BACKUP_NAME.L#
     19303**DCL     19303--IMP-SIZ
BLANK
     20918**DCL     21909<<ASSIGN
BLK_TAG.NAME
     18795**DCL     18795--REDEF
BLK_TAG$
     18792**DCL     18792--IMP-PTR
BLK_TAG0.NAME
     18801**DCL     18801--REDEF
BLK_TAG0$
     18798**DCL     18798--IMP-PTR
BLOCK_GRAN$
     18805**DCL     18806--IMP-PTR
BUF$
     20932**DCL     21265<>CALL    21271>>ASSIGN  21272>>ASSIGN  21283>>ASSIGN  21283>>ASSIGN  21310>>ASSIGN
     21310>>ASSIGN  21312>>ASSIGN  21313>>ASSIGN  21314>>ASSIGN  21337>>ASSIGN  21484<>CALL    21486>>ASSIGN
     21487>>ASSIGN  21487>>ASSIGN  21498>>ASSIGN  21498>>ASSIGN  21507>>IF      21510>>ASSIGN  21510>>ASSIGN
     21520>>ASSIGN  21521>>ASSIGN  21521>>ASSIGN  21532>>ASSIGN  21873<>CALL    21874>>ASSIGN  21875>>ASSIGN
     21876>>ASSIGN
B_VERSION
     20914**DCL     20997--ASSIGN  20998--ASSIGN  20998--ASSIGN  20998--ASSIGN
CLOSE_ARCHIVE
     20636**DCL     20944<<ASSIGN  21091<>CALL    21115<>CALL    21120<>CALL    21177<>CALL    21204<>CALL
     21220<>CALL    21252<>CALL    21323<>CALL    21340<>CALL    21344<>CALL    21354<>CALL    21359<>CALL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:169  
     21416<>CALL    21421<>CALL    21433<>CALL    21466<>CALL    21536<>CALL    21540<>CALL    21550<>CALL
     21555<>CALL    21597<>CALL    21659<>CALL    21674<>CALL    21707<>CALL    21712<>CALL    21719<>CALL
     21724<>CALL    21766<>CALL    21856<>CALL    21925<>CALL    21939<>CALL    21943<>CALL
CLOSE_ARCHIVE.SN_
     20636**DCL     20636--REDEF
CLOSE_ARCHIVE.UTL_
     20637**DCL     20637--REDEF
CLOSE_ARCHIVE.V
     20641**DCL     20636--DCLINIT 20945--ASSIGN
CLOSE_ARCHIVE.V.EXPIRE#
     20651**DCL     20651--REDEF
CLOSE_ARCHIVE.V.TYPE#
     20649**DCL     20649--REDEF
CLOSE_ARCHIVE.V.XTNSIZE#
     20646**DCL     20646--REDEF   20648--REDEF
CLOSE_ARCHIVE.V_
     20636**DCL     20945<<ASSIGN
CLOSE_BLOCK_FILE.SN_
     12537**DCL     12537--REDEF
CLOSE_BLOCK_FILE.UTL_
     12538**DCL     12538--REDEF
CLOSE_BLOCK_FILE.V
     12542**DCL     12537--DCLINIT
CLOSE_BLOCK_FILE.V.EXPIRE#
     12552**DCL     12552--REDEF
CLOSE_BLOCK_FILE.V.TYPE#
     12550**DCL     12550--REDEF
CLOSE_BLOCK_FILE.V.XTNSIZE#
     12547**DCL     12547--REDEF   12549--REDEF
CLOSE_NODATA_LIST.SN_
     20457**DCL     20457--REDEF
CLOSE_NODATA_LIST.UTL_
     20458**DCL     20458--REDEF
CLOSE_NODATA_LIST.V.EXPIRE#
     20472**DCL     20472--REDEF
CLOSE_NODATA_LIST.V.TYPE#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:170  
     20470**DCL     20470--REDEF
CLOSE_NODATA_LIST.V.XTNSIZE#
     20467**DCL     20467--REDEF   20469--REDEF
CLOSE_PRIME_DUAL.SN_
     19934**DCL     19934--REDEF
CLOSE_PRIME_DUAL.UTL_
     19935**DCL     19935--REDEF
CLOSE_PRIME_DUAL.V.EXPIRE#
     19949**DCL     19949--REDEF
CLOSE_PRIME_DUAL.V.TYPE#
     19947**DCL     19947--REDEF
CLOSE_PRIME_DUAL.V.XTNSIZE#
     19944**DCL     19944--REDEF   19946--REDEF
CLOSE_REBUILD.SN_
     20209**DCL     20209--REDEF
CLOSE_REBUILD.UTL_
     20210**DCL     20210--REDEF
CLOSE_REBUILD.V.EXPIRE#
     20224**DCL     20224--REDEF
CLOSE_REBUILD.V.TYPE#
     20222**DCL     20222--REDEF
CLOSE_REBUILD.V.XTNSIZE#
     20219**DCL     20219--REDEF   20221--REDEF
CLOSE_STATUS.SN_
     19424**DCL     19424--REDEF
CLOSE_STATUS.UTL_
     19425**DCL     19425--REDEF
CLOSE_STATUS.V.EXPIRE#
     19439**DCL     19439--REDEF
CLOSE_STATUS.V.TYPE#
     19437**DCL     19437--REDEF
CLOSE_STATUS.V.XTNSIZE#
     19434**DCL     19434--REDEF   19436--REDEF
CLOSE_TSN_USED.SN_
     19134**DCL     19134--REDEF
CLOSE_TSN_USED.UTL_
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:171  
     19135**DCL     19135--REDEF
CLOSE_TSN_USED.V.EXPIRE#
     19149**DCL     19149--REDEF
CLOSE_TSN_USED.V.TYPE#
     19147**DCL     19147--REDEF
CLOSE_TSN_USED.V.XTNSIZE#
     19144**DCL     19144--REDEF   19146--REDEF
COMMAND
        16**DCL        15--PROC    20947>>DOCASE
COMMAND_ERROR
     11375**DCL     21791<<ASSIGN  21857<<ASSIGN
CON_CLOSE_ARCHIVE
     19466**DCL     20944>>ASSIGN
CON_CLOSE_ARCHIVE.SN_
     19466**DCL     19466--REDEF
CON_CLOSE_ARCHIVE.UTL_
     19467**DCL     19467--REDEF
CON_CLOSE_ARCHIVE.V.EXPIRE#
     19481**DCL     19481--REDEF
CON_CLOSE_ARCHIVE.V.TYPE#
     19479**DCL     19479--REDEF
CON_CLOSE_ARCHIVE.V.XTNSIZE#
     19476**DCL     19476--REDEF   19478--REDEF
CON_OPEN_ARCHIVE_FILE
     19551**DCL     20939>>ASSIGN
CON_OPEN_ARCHIVE_FILE.ACSVEH_
     19553**DCL     19554--REDEF
CON_OPEN_ARCHIVE_FILE.ALTKEYS_
     19559**DCL     19560--REDEF   19560--REDEF
CON_OPEN_ARCHIVE_FILE.HDR_
     19558**DCL     19559--REDEF
CON_OPEN_ARCHIVE_FILE.TAB_
     19557**DCL     19558--REDEF
CON_OPEN_ARCHIVE_FILE.UHL_
     19551**DCL     19552--REDEF   19552--REDEF
CON_OPEN_ARCHIVE_FILE.V.FSN#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:172  
     19591**DCL     19591--REDEF   19591--REDEF
CON_OPEN_ARCHIVE_FILE.WSN_
     19557**DCL     19557--REDEF
CON_READ_ARCHIVE_FILE
     19612**DCL     20942>>ASSIGN
CON_READ_ARCHIVE_FILE.STATION_
     19615**DCL     19616--REDEF
CON_READ_ARCHIVE_FILE.V.DVBYTE.REREAD#
     19627**DCL     19627--REDEF
CON_READ_ARCHIVE_FILE.V.INDX#
     19625**DCL     19625--REDEF
CVOL_UTL.ULBL#
     18894**DCL     18894--REDEF
DCB#
     20927**DCL     20938<<ASSIGN  21088<>CALL    21090<>CALL    21353<>CALL    21415<>CALL    21463<>CALL
     21465<>CALL    21549<>CALL    21621<>CALL    21636<>CALL    21671<>CALL    21711<>CALL    21718<>CALL
DEL_NODATA_REC.V
     20560**DCL     20557--DCLINIT
DISK_CLOSE.SN_
     11055**DCL     11055--REDEF
DISK_CLOSE.UTL_
     11056**DCL     11056--REDEF
DISK_CLOSE.V.EXPIRE#
     11070**DCL     11070--REDEF
DISK_CLOSE.V.TYPE#
     11068**DCL     11068--REDEF
DISK_CLOSE.V.XTNSIZE#
     11065**DCL     11065--REDEF   11067--REDEF
DISK_CLOSE_NEXT.SN_
     12234**DCL     12234--REDEF
DISK_CLOSE_NEXT.UTL_
     12235**DCL     12235--REDEF
DISK_CLOSE_NEXT.V.EXPIRE#
     12249**DCL     12249--REDEF
DISK_CLOSE_NEXT.V.TYPE#
     12247**DCL     12247--REDEF
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:173  
DISK_CLOSE_NEXT.V.XTNSIZE#
     12244**DCL     12244--REDEF   12246--REDEF
DISK_CLOSE_ORDINARY.SN_
     12276**DCL     12276--REDEF
DISK_CLOSE_ORDINARY.UTL_
     12277**DCL     12277--REDEF
DISK_CLOSE_ORDINARY.V.EXPIRE#
     12291**DCL     12291--REDEF
DISK_CLOSE_ORDINARY.V.TYPE#
     12289**DCL     12289--REDEF
DISK_CLOSE_ORDINARY.V.XTNSIZE#
     12286**DCL     12286--REDEF   12288--REDEF
DISK_DEST_SN.SN#
     11524**DCL     21374>>ASSIGN  21400>>IF      21574>>ASSIGN  21599>>IF      21607>>IF      21634>>ASSIGN
     21697>>ASSIGN
DISK_FILE_SPEC.SPEC
     11420**DCL     11422--REDEF
DISK_FILE_SPEC.SPEC.START
     11421**DCL     11421--REDEF
DISK_FILE_SPEC.SPEC.STOP
     11422**DCL     11422--REDEF
DISK_FILE_SPEC$
     11419**DCL     11420--IMP-PTR
DISK_GRAN$
     18805**DCL     18805--IMP-PTR
DISK_OPEN.ACSVEH_
     10920**DCL     10921--REDEF
DISK_OPEN.ALTKEYS_
     10926**DCL     10927--REDEF   10927--REDEF
DISK_OPEN.HDR_
     10925**DCL     10926--REDEF
DISK_OPEN.TAB_
     10924**DCL     10925--REDEF
DISK_OPEN.UHL_
     10918**DCL     10919--REDEF   10919--REDEF
DISK_OPEN.V.FSN#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:174  
     10958**DCL     10958--REDEF   10958--REDEF
DISK_OPEN.WSN_
     10924**DCL     10924--REDEF
DISK_OPEN_NEXT.ACSVEH_
     12060**DCL     12061--REDEF
DISK_OPEN_NEXT.ALTKEYS_
     12066**DCL     12067--REDEF   12067--REDEF
DISK_OPEN_NEXT.HDR_
     12065**DCL     12066--REDEF
DISK_OPEN_NEXT.TAB_
     12064**DCL     12065--REDEF
DISK_OPEN_NEXT.UHL_
     12058**DCL     12059--REDEF   12059--REDEF
DISK_OPEN_NEXT.V.FSN#
     12098**DCL     12098--REDEF   12098--REDEF
DISK_OPEN_NEXT.WSN_
     12064**DCL     12064--REDEF
DISK_OPEN_ORDINARY.ACSVEH_
     12169**DCL     12170--REDEF
DISK_OPEN_ORDINARY.ALTKEYS_
     12175**DCL     12176--REDEF   12176--REDEF
DISK_OPEN_ORDINARY.HDR_
     12174**DCL     12175--REDEF
DISK_OPEN_ORDINARY.TAB_
     12173**DCL     12174--REDEF
DISK_OPEN_ORDINARY.UHL_
     12167**DCL     12168--REDEF   12168--REDEF
DISK_OPEN_ORDINARY.V.FSN#
     12207**DCL     12207--REDEF   12207--REDEF
DISK_OPEN_ORDINARY.WSN_
     12173**DCL     12173--REDEF
DISK_READ.STATION_
     10982**DCL     10983--REDEF
DISK_READ.V.DVBYTE.REREAD#
     10994**DCL     10994--REDEF
DISK_READ.V.INDX#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:175  
     10992**DCL     10992--REDEF
DISK_WRITE.STATION_
     11020**DCL     11020--REDEF
DISK_WRITE.V.DVBYTE.VFC#
     11027**DCL     11027--REDEF
DPLIST.NUM#
     11417**DCL     20984>>ASSIGN  20984--ASSIGN  21015>>DOINDEX 21018>>ASSIGN  21049>>DOINDEX 21773>>DOINDEX
DPLIST.SN#
     11417**DCL     20984--ASSIGN  21016>>ASSIGN  21051>>ASSIGN  21052<>CALL    21141>>ASSIGN  21188>>IF
     21405>>IF      21423>>ASSIGN  21425<>CALL    21494>>ASSIGN  21607>>IF      21648>>IF      21660>>ASSIGN
     21733>>ASSIGN  21774>>IF
DPLIST$
     11405**DCL     11417--IMP-PTR 20984>>ASSIGN  21015>>DOINDEX 21016>>ASSIGN  21018>>ASSIGN  21049>>DOINDEX
     21051>>ASSIGN  21052>>CALL    21141>>ASSIGN  21188>>IF      21405>>IF      21423>>ASSIGN  21425>>CALL
     21494>>ASSIGN  21607>>IF      21648>>IF      21660>>ASSIGN  21733>>ASSIGN  21773>>DOINDEX 21774>>IF
DPRESLIST.NAME
     11419**DCL     21734>>ASSIGN  21776>>ASSIGN
DPRESLIST$
     11419**DCL     11419--IMP-PTR 21734>>ASSIGN  21776>>ASSIGN
DPSIZE
     20919**DCL     20984<<ASSIGN  20986>>ASSIGN  20990>>ASSIGN  21020>>ASSIGN  21263<<ASSIGN  21264>>ASSIGN
     21495<<ASSIGN  21497>>ASSIGN  21498>>ASSIGN  21519>>ASSIGN
DPSN
     20910**DCL     20941--ASSIGN
DPSN.SN#
     20910**DCL     21051<<ASSIGN  21086>>IF      21141<<ASSIGN  21329<<ASSIGN  21374<<ASSIGN  21423<<ASSIGN
     21461>>IF      21526<<ASSIGN  21574<<ASSIGN  21617<<ASSIGN  21634<<ASSIGN  21660<<ASSIGN  21697<<ASSIGN
     21733<<ASSIGN  21763>>IF      21767<<ASSIGN  21774>>IF      21932<<ASSIGN
DUAL_FILE.L#
     19730**DCL     19730--IMP-SIZ
EFTWORD
     11540**DCL     11540--REDEF
EFT_CVOL_FILE.L#
     18854**DCL     18854--IMP-SIZ
EFT_RESTRICT_FILE.L#
     18881**DCL     18881--IMP-SIZ
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:176  
ERR IN PROCEDURE FLE_ADD
     21539**LABEL   21527--CALLALT 21530--CALLALT 21534--CALLALT
ERR IN PROCEDURE FLE_ESTABLISH
     21119**LABEL   21070--CALLALT 21074--CALLALT 21102--GOTO    21107--CALLALT 21110--CALLALT 21114--CALLALT
ERR IN PROCEDURE FLE_FINISH_ARCHIVE
     21942**LABEL   21933--CALLALT 21935--CALLALT 21938--CALLALT
ERR IN PROCEDURE FLE_MODIFY
     21343**LABEL   21330--CALLALT 21332--CALLALT 21339--CALLALT 21340--CALLALT
ERR1 IN PROCEDURE FLE_ESTABLISH
     21120**LABEL   21060--GOTO
ERRCODE
     20863**DCL     21055<<ASSIGN
ERRCODE.SEV
     20893**DCL     21056>>IF
E_ALREADY_ESTABLISH
     16213**DCL     21088<>CALL    21463<>CALL
E_ARCFILE_REMOVED
     16393**DCL     21666<>CALL
E_ARCHIVE_OUT_TAPESET
     17384**DCL     21789<>CALL
E_CANT_SPECIFY_DENSITY
     17204**DCL     21203<>CALL
E_CANT_SPECIFY_EXPIRE
     17249**DCL     21219<>CALL
E_MEMBER_OF_ARCHIVE
     16348**DCL     21090<>CALL    21415<>CALL    21465<>CALL
E_NOT_ARCHIVE_MASTER
     16258**DCL     21353<>CALL    21549<>CALL    21718<>CALL
E_NOT_MEMBER_OF_ARCHIVE
     16303**DCL     21711<>CALL
E_NO_ARCFILE
     16483**DCL     21671<>CALL
E_NUM_ARCHIVE_SETS
     16528**DCL     21251<>CALL
E_REMOVE_FROM_ARCHIVE
     16438**DCL     21621<>CALL    21699<>CALL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:177  
E_REMOVE_MASTER_PACKSET
     16664**DCL     21636<>CALL
E_TYPE_ARCHIVE_SET
     16709**DCL     21176<>CALL
FIT_AREA.W2
     19165**DCL     19166--REDEF
FLE_ADD
     21364**PROC    20953--CALL
FLE_BUILD_SNLIST
     21862**PROC    21840--CALL    21845--CALL
FLE_ESTABLISH
     20965**PROC    20949--CALL
FLE_FINISH_ARCHIVE
     21918**PROC    20961--CALL
FLE_GET_ARCHIVE_SNLIST
     21729**PROC    20957--CALL
FLE_MODIFY
     21129**PROC    20951--CALL
FLE_REMOVE
     21560**PROC    20955--CALL
FLE_UPDATE_ARCHIVE
     21880**PROC    20959--CALL
FLI$ALLOC
     20572**DCL-ENT 20988--CALL    21071--CALL    21148--CALL    21265--CALL    21379--CALL    21445--CALL
     21484--CALL    21581--CALL    21742--CALL    21866--CALL    21873--CALL
FLI$BUILD_$$EFT
     20574**DCL-ENT 21052--CALL    21425--CALL
FLI$CNVRT_ARCHIVE
     20575**DCL-ENT 21081--CALL    21158--CALL    21389--CALL    21455--CALL    21591--CALL    21752--CALL
FLI$RPT_ERR
     20571**DCL-ENT 21088--CALL    21090--CALL    21119--CALL    21176--CALL    21203--CALL    21219--CALL
     21251--CALL    21343--CALL    21353--CALL    21358--CALL    21415--CALL    21432--CALL    21463--CALL
     21465--CALL    21539--CALL    21549--CALL    21554--CALL    21621--CALL    21625--CALL    21636--CALL
     21666--CALL    21671--CALL    21673--CALL    21699--CALL    21711--CALL    21718--CALL    21723--CALL
     21789--CALL    21855--CALL    21942--CALL
FPT_EXIT.V.STEPCC#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:178  
     10845**DCL     10845--REDEF
FROM_DISK_ACCT
     11951**DCL     12475--DCLINIT
FROM_DISK_NAME
     11925**DCL     12471--DCLINIT
FROM_DISK_SN
     11977**DCL     12470--DCLINIT
I
     20920**DCL     21015<<DOINDEX 21016>>ASSIGN  21016>>ASSIGN  21026<<DOINDEX 21027>>ASSIGN  21027>>ASSIGN
     21035<<DOINDEX 21036>>ASSIGN  21036>>ASSIGN  21049<<DOINDEX 21051>>ASSIGN  21052>>CALL    21069--ASSIGN
     21071<>CALL    21073>>ASSIGN  21094>>IF      21123>>IF      21279<<DOINDEX 21280>>ASSIGN  21280>>ASSIGN
     21294<<DOINDEX 21295>>ASSIGN  21295>>ASSIGN  21303<<DOINDEX 21304>>ASSIGN  21304>>ASSIGN  21328<<DOINDEX
     21329>>ASSIGN  21347>>IF      21404<<DOINDEX 21405>>IF      21490<<DOINDEX 21491>>ASSIGN  21491>>ASSIGN
     21500<<DOINDEX 21501>>ASSIGN  21501>>ASSIGN  21512<<DOINDEX 21513>>ASSIGN  21513>>ASSIGN  21525<<DOINDEX
     21526>>ASSIGN  21541>>IF      21616<<DOINDEX 21617>>ASSIGN  21647<<DOINDEX 21648>>IF      21651>>ASSIGN
     21683<<DOINDEX 21684>>ASSIGN  21684>>ASSIGN  21773<<DOINDEX 21774>>IF      21776>>ASSIGN  21867<<DOINDEX
     21868>>ASSIGN  21868>>ASSIGN  21931<<DOINDEX 21932>>ASSIGN  21944>>IF
J
     20921**DCL     21403<<ASSIGN  21408<<ASSIGN  21412>>IF      21646<<ASSIGN  21652<<ASSIGN  21656>>IF
     21891<<DOINDEX 21892>>ASSIGN  21892>>ASSIGN  21902<<DOINDEX 21903>>ASSIGN  21903>>ASSIGN  21906>>ASSIGN
     21908<<DOINDEX 21909>>ASSIGN
K
     20922**DCL     21651<<ASSIGN  21683>>DOINDEX 21890<<ASSIGN  21891>>DOINDEX 21894>>ASSIGN  21895>>ASSIGN
LAST_SNLISTINFO$
     10828**DCL     20830--IMP-PTR 20981>>ASSIGN  20983>>ASSIGN  21023>>ASSIGN  21025>>ASSIGN  21035>>DOINDEX
     21036>>ASSIGN  21038>>ASSIGN  21261>>ASSIGN  21291>>ASSIGN  21293>>ASSIGN  21294>>DOINDEX 21303>>DOINDEX
     21304>>ASSIGN  21306>>ASSIGN  21875>>ASSIGN  21876<<ASSIGN
LAST_TAPE_FSN
     11539**DCL     21811<<ASSIGN  21812<<ASSIGN
M$ARCHIVE
     18775**DCL     20938>>ASSIGN
M$CLOSE
      5507**DCL-ENT 21091--CALL    21115--CALL    21120--CALL    21177--CALL    21204--CALL    21220--CALL
     21252--CALL    21323--CALL    21340--CALL    21344--CALL    21354--CALL    21359--CALL    21416--CALL
     21421--CALL    21433--CALL    21466--CALL    21536--CALL    21540--CALL    21550--CALL    21555--CALL
     21597--CALL    21659--CALL    21674--CALL    21707--CALL    21712--CALL    21719--CALL    21724--CALL
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:179  
     21766--CALL    21856--CALL    21925--CALL    21939--CALL    21943--CALL
M$OPEN
      5507**DCL-ENT 21065--CALL    21107--CALL    21143--CALL    21330--CALL    21376--CALL    21439--CALL
     21527--CALL    21576--CALL    21618--CALL    21635--CALL    21663--CALL    21698--CALL    21737--CALL
     21933--CALL
M$READ
      5508**DCL-ENT 21070--CALL    21074--CALL    21146--CALL    21151--CALL    21378--CALL    21382--CALL
     21443--CALL    21448--CALL    21579--CALL    21584--CALL    21740--CALL    21745--CALL
M$WRITE
      5508**DCL-ENT 21110--CALL    21114--CALL    21332--CALL    21339--CALL    21530--CALL    21534--CALL
     21702--CALL    21706--CALL    21935--CALL    21938--CALL
NBR_BYTES_TO_MOVE
     18804**DCL     18805--IMP-SIZ 18806--IMP-SIZ
NBR_GRANS_PER_TAPE_BUF
     11378**DCL     21832<<ASSIGN
NBR_SNLISTS
     10832**DCL     20979>>IF      20986>>ASSIGN  20991>>IF      21021>>IF      21031>>IF      21169>>IF
     21199>>IF      21215>>IF      21236>>IF      21245>>IF      21245>>IF      21264>>ASSIGN  21289>>IF
     21299>>IF      21308>>IF      21333>>IF      21839<<ASSIGN  21871<<ASSIGN  21871>>ASSIGN
NODATA_FILE_NAME.L#
     20419**DCL     20419--IMP-SIZ
NODATA_KEY
     20565**DCL     20557--DCLINIT 20558--DCLINIT
OPEN_ARCHIVE_FILE
     20721**DCL     20939<<ASSIGN  21065<>CALL    21107<>CALL    21143<>CALL    21330<>CALL    21376<>CALL
     21439<>CALL    21527<>CALL    21576<>CALL    21618<>CALL    21635<>CALL    21663<>CALL    21698<>CALL
     21737<>CALL    21933<>CALL
OPEN_ARCHIVE_FILE.ACSVEH_
     20723**DCL     20724--REDEF
OPEN_ARCHIVE_FILE.ALTKEYS_
     20729**DCL     20730--REDEF   20730--REDEF
OPEN_ARCHIVE_FILE.HDR_
     20728**DCL     20729--REDEF
OPEN_ARCHIVE_FILE.SN_
     20721**DCL     20941<<ASSIGN
OPEN_ARCHIVE_FILE.TAB_
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:180  
     20727**DCL     20728--REDEF
OPEN_ARCHIVE_FILE.UHL_
     20721**DCL     20722--REDEF   20722--REDEF
OPEN_ARCHIVE_FILE.V
     20730**DCL     20721--DCLINIT 20940--ASSIGN
OPEN_ARCHIVE_FILE.V.DELETE#
     20732**DCL     20946<<ASSIGN  21610<<ASSIGN  21661<<ASSIGN  21696<<ASSIGN
OPEN_ARCHIVE_FILE.V.EXIST#
     20734**DCL     21105<<ASSIGN  21326<<ASSIGN  21523<<ASSIGN  21694<<ASSIGN  21929<<ASSIGN
OPEN_ARCHIVE_FILE.V.EXPIRE#
     20750**DCL     21106<<ASSIGN  21327<<ASSIGN  21524<<ASSIGN  21695<<ASSIGN  21930<<ASSIGN
OPEN_ARCHIVE_FILE.V.FSN#
     20761**DCL     20761--REDEF   20761--REDEF
OPEN_ARCHIVE_FILE.V.FUN#
     20740**DCL     21064<<ASSIGN  21104<<ASSIGN  21142<<ASSIGN  21325<<ASSIGN  21375<<ASSIGN  21438<<ASSIGN
     21522<<ASSIGN  21575<<ASSIGN  21611<<ASSIGN  21662<<ASSIGN  21693<<ASSIGN  21736<<ASSIGN  21928<<ASSIGN
OPEN_ARCHIVE_FILE.V.RES#
     20745**DCL     21734<<ASSIGN  21771<<ASSIGN  21776<<ASSIGN
OPEN_ARCHIVE_FILE.V_
     20721**DCL     20940<<ASSIGN
OPEN_ARCHIVE_FILE.WSN_
     20727**DCL     20727--REDEF
OPEN_BLOCK_FILE.ACSVEH_
     12472**DCL     12473--REDEF
OPEN_BLOCK_FILE.ALTKEYS_
     12478**DCL     12479--REDEF   12479--REDEF
OPEN_BLOCK_FILE.HDR_
     12477**DCL     12478--REDEF
OPEN_BLOCK_FILE.TAB_
     12476**DCL     12477--REDEF
OPEN_BLOCK_FILE.UHL_
     12470**DCL     12471--REDEF   12471--REDEF
OPEN_BLOCK_FILE.V
     12479**DCL     12470--DCLINIT
OPEN_BLOCK_FILE.V.FSN#
     12510**DCL     12510--REDEF   12510--REDEF
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:181  
OPEN_BLOCK_FILE.WSN_
     12476**DCL     12476--REDEF
OPEN_NODATA_LIST.ACSVEH_
     20352**DCL     20353--REDEF
OPEN_NODATA_LIST.ALTKEYS_
     20358**DCL     20359--REDEF   20359--REDEF
OPEN_NODATA_LIST.HDR_
     20357**DCL     20358--REDEF
OPEN_NODATA_LIST.TAB_
     20356**DCL     20357--REDEF
OPEN_NODATA_LIST.UHL_
     20350**DCL     20351--REDEF   20351--REDEF
OPEN_NODATA_LIST.V.FSN#
     20390**DCL     20390--REDEF   20390--REDEF
OPEN_NODATA_LIST.WSN_
     20356**DCL     20356--REDEF
OPEN_PRIME_DUAL.ACSVEH_
     19799**DCL     19800--REDEF
OPEN_PRIME_DUAL.ALTKEYS_
     19805**DCL     19806--REDEF   19806--REDEF
OPEN_PRIME_DUAL.HDR_
     19804**DCL     19805--REDEF
OPEN_PRIME_DUAL.TAB_
     19803**DCL     19804--REDEF
OPEN_PRIME_DUAL.UHL_
     19797**DCL     19798--REDEF   19798--REDEF
OPEN_PRIME_DUAL.V.FSN#
     19837**DCL     19837--REDEF   19837--REDEF
OPEN_PRIME_DUAL.WSN_
     19803**DCL     19803--REDEF
OPEN_REBUILD.ACSVEH_
     20034**DCL     20035--REDEF
OPEN_REBUILD.ALTKEYS_
     20040**DCL     20041--REDEF   20041--REDEF
OPEN_REBUILD.HDR_
     20039**DCL     20040--REDEF
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:182  
OPEN_REBUILD.TAB_
     20038**DCL     20039--REDEF
OPEN_REBUILD.UHL_
     20032**DCL     20033--REDEF   20033--REDEF
OPEN_REBUILD.V.FSN#
     20072**DCL     20072--REDEF   20072--REDEF
OPEN_REBUILD.WSN_
     20038**DCL     20038--REDEF
OPEN_STATUS.ACSVEH_
     19236**DCL     19237--REDEF
OPEN_STATUS.ALTKEYS_
     19242**DCL     19243--REDEF   19243--REDEF
OPEN_STATUS.HDR_
     19241**DCL     19242--REDEF
OPEN_STATUS.TAB_
     19240**DCL     19241--REDEF
OPEN_STATUS.UHL_
     19234**DCL     19235--REDEF   19235--REDEF
OPEN_STATUS.V.FSN#
     19274**DCL     19274--REDEF   19274--REDEF
OPEN_STATUS.WSN_
     19240**DCL     19240--REDEF
OPEN_TSN_USED.ACSVEH_
     18972**DCL     18973--REDEF
OPEN_TSN_USED.ALTKEYS_
     18978**DCL     18979--REDEF   18979--REDEF
OPEN_TSN_USED.HDR_
     18977**DCL     18978--REDEF
OPEN_TSN_USED.TAB_
     18976**DCL     18977--REDEF
OPEN_TSN_USED.UHL_
     18970**DCL     18971--REDEF   18971--REDEF
OPEN_TSN_USED.V.FSN#
     19010**DCL     19010--REDEF   19010--REDEF
OPEN_TSN_USED.WSN_
     18976**DCL     18976--REDEF
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:183  
PRE_RET_CLOSE.SN_
     11783**DCL     11783--REDEF
PRE_RET_CLOSE.UTL_
     11784**DCL     11784--REDEF
PRE_RET_CLOSE.V.EXPIRE#
     11798**DCL     11798--REDEF
PRE_RET_CLOSE.V.TYPE#
     11796**DCL     11796--REDEF
PRE_RET_CLOSE.V.XTNSIZE#
     11793**DCL     11793--REDEF   11795--REDEF
PRE_RET_OPEN.ACSVEH_
     11718**DCL     11719--REDEF
PRE_RET_OPEN.ALTKEYS_
     11724**DCL     11725--REDEF   11725--REDEF
PRE_RET_OPEN.HDR_
     11723**DCL     11724--REDEF
PRE_RET_OPEN.TAB_
     11722**DCL     11723--REDEF
PRE_RET_OPEN.UHL_
     11716**DCL     11717--REDEF   11717--REDEF
PRE_RET_OPEN.V.FSN#
     11756**DCL     11756--REDEF   11756--REDEF
PRE_RET_OPEN.WSN_
     11722**DCL     11722--REDEF
PRE_RET_READ.STATION_
     11573**DCL     11574--REDEF
PRE_RET_READ.V.DVBYTE.REREAD#
     11585**DCL     11585--REDEF
PRE_RET_READ.V.INDX#
     11583**DCL     11583--REDEF
PRE_RET_WRITE.STATION_
     11611**DCL     11611--REDEF
PRE_RET_WRITE.V.DVBYTE.VFC#
     11618**DCL     11618--REDEF
PRIME_FILE.L#
     19703**DCL     19703--IMP-SIZ
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:184  
READ_AD_OR_FD.ACSVEH_
     12362**DCL     12363--REDEF
READ_AD_OR_FD.ALTKEYS_
     12368**DCL     12369--REDEF   12369--REDEF
READ_AD_OR_FD.HDR_
     12367**DCL     12368--REDEF
READ_AD_OR_FD.TAB_
     12366**DCL     12367--REDEF
READ_AD_OR_FD.UHL_
     12360**DCL     12361--REDEF   12361--REDEF
READ_AD_OR_FD.V.FSN#
     12400**DCL     12400--REDEF   12400--REDEF
READ_AD_OR_FD.WSN_
     12366**DCL     12366--REDEF
READ_ARCHIVE_FILE
     20783**DCL     20942<<ASSIGN  21070<>CALL    21074<>CALL    21146<>CALL    21151<>CALL    21378<>CALL
     21382<>CALL    21443<>CALL    21448<>CALL    21579<>CALL    21584<>CALL    21740<>CALL    21745<>CALL
READ_ARCHIVE_FILE.BUF_
     20785**DCL     21069<<ASSIGN  21145<<ASSIGN  21377<<ASSIGN  21442<<ASSIGN  21578<<ASSIGN  21739<<ASSIGN
READ_ARCHIVE_FILE.BUF_.BOUND
     20785**DCL     21073<<ASSIGN  21150<<ASSIGN  21381<<ASSIGN  21447<<ASSIGN  21583<<ASSIGN  21744<<ASSIGN
READ_ARCHIVE_FILE.BUF_.BUF$
     20786**DCL     21072<<ASSIGN  21149<<ASSIGN  21380<<ASSIGN  21446<<ASSIGN  21582<<ASSIGN  21743<<ASSIGN
READ_ARCHIVE_FILE.STATION_
     20786**DCL     20787--REDEF
READ_ARCHIVE_FILE.V
     20787**DCL     20783--DCLINIT 20943--ASSIGN
READ_ARCHIVE_FILE.V.DVBYTE.REREAD#
     20798**DCL     20798--REDEF
READ_ARCHIVE_FILE.V.INDX#
     20796**DCL     20796--REDEF
READ_ARCHIVE_FILE.V_
     20783**DCL     20943<<ASSIGN
READ_NODATA_LIST.STATION_
     20496**DCL     20497--REDEF
READ_NODATA_LIST.V.DVBYTE.REREAD#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:185  
     20508**DCL     20508--REDEF
READ_NODATA_LIST.V.INDX#
     20506**DCL     20506--REDEF
READ_PRIME_DUAL.STATION_
     19861**DCL     19862--REDEF
READ_PRIME_DUAL.V.DVBYTE.REREAD#
     19873**DCL     19873--REDEF
READ_PRIME_DUAL.V.INDX#
     19871**DCL     19871--REDEF
READ_REBUILD.STATION_
     20167**DCL     20168--REDEF
READ_REBUILD.V.DVBYTE.REREAD#
     20179**DCL     20179--REDEF
READ_REBUILD.V.INDX#
     20177**DCL     20177--REDEF
READ_STATUS.STATION_
     19382**DCL     19383--REDEF
READ_STATUS.V.DVBYTE.REREAD#
     19394**DCL     19394--REDEF
READ_STATUS.V.INDX#
     19392**DCL     19392--REDEF
READ_TSN_USED.STATION_
     19092**DCL     19093--REDEF
READ_TSN_USED.V.DVBYTE.REREAD#
     19104**DCL     19104--REDEF
READ_TSN_USED.V.INDX#
     19102**DCL     19102--REDEF
REBUILD_DIR_KEY.L#
     20253**DCL     20253--IMP-SIZ
REBUILD_KEY.L#
     20280**DCL     20280--IMP-SIZ
REBUILD_NAME.L#
     20101**DCL     20101--IMP-SIZ
RES_LOOP IN PROCEDURE FLE_GET_ARCHIVE_SNLIST
     21773**LABEL   21777--EXIT
RET_CMDS_NAME.L#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:186  
     11827**DCL     11827--IMP-SIZ
SIZE
     20924**DCL     20986<<ASSIGN  20988<>CALL    21011>>ASSIGN  21012>>ASSIGN  21113>>ASSIGN  21264<<ASSIGN
     21265<>CALL    21314>>ASSIGN  21315>>ASSIGN  21483<<ASSIGN  21484<>CALL    21519<<ASSIGN  21520>>ASSIGN
     21529--ASSIGN  21533>>ASSIGN
SNLISTINFO
     20830**DCL     21873--CALL
SNLISTINFO.PREVINFO$
     20830**DCL     20981>>ASSIGN  21023>>ASSIGN  21291>>ASSIGN  21875<<ASSIGN
SNLISTINFO.SNLIST$
     20830**DCL     20981>>ASSIGN  20983>>ASSIGN  21023>>ASSIGN  21025>>ASSIGN  21035>>DOINDEX 21036>>ASSIGN
     21038>>ASSIGN  21261>>ASSIGN  21291>>ASSIGN  21293>>ASSIGN  21294>>DOINDEX 21303>>DOINDEX 21304>>ASSIGN
     21306>>ASSIGN  21874<<ASSIGN
SNSIZE
     20928**DCL     20985<<ASSIGN  20986>>ASSIGN  20993>>ASSIGN  21034>>ASSIGN  21040>>ASSIGN  21262<<ASSIGN
     21264>>ASSIGN  21302>>ASSIGN  21310>>ASSIGN  21504<<ASSIGN  21505>>ASSIGN  21510>>ASSIGN  21516<<ASSIGN
     21516>>ASSIGN  21519>>ASSIGN  21837<<ASSIGN  21866<>CALL    21887<<ASSIGN  21888>>ASSIGN  21900<<ASSIGN
     21901>>ASSIGN  21913>>ASSIGN
SNVECLIST$
     11359**DCL     11359--IMP-PTR
SPEC.START
     11423**DCL     11424--REDEF
SPEC.STOP
     11424**DCL     11425--REDEF
SPECCHARS
     11423**DCL     11423--REDEF
START$
     20931**DCL     20988<>CALL    20989>>ASSIGN  20990>>ASSIGN  20993>>ASSIGN  20993>>ASSIGN  20995>>ASSIGN
     20996>>ASSIGN  20997>>ASSIGN  20998>>ASSIGN  20999>>ASSIGN  21000>>ASSIGN  21001>>ASSIGN  21002>>ASSIGN
     21003>>ASSIGN  21004>>ASSIGN  21005>>ASSIGN  21006>>ASSIGN  21008>>ASSIGN  21009>>ASSIGN  21012>>ASSIGN
     21014>>ASSIGN  21112>>ASSIGN  21148<>CALL    21149>>ASSIGN  21155>>IF      21158<>CALL    21159<<ASSIGN
     21160>>ASSIGN  21162>>ASSIGN  21162>>ASSIGN  21172>>IF      21172>>IF      21199>>IF      21207>>ASSIGN
     21211>>ASSIGN  21215>>IF      21223>>ASSIGN  21227>>ASSIGN  21230>>ASSIGN  21234>>ASSIGN  21245>>IF
     21245>>IF      21263>>ASSIGN  21263>>ASSIGN  21271>>ASSIGN  21273>>ASSIGN  21324>>ASSIGN  21324>>ASSIGN
     21335>>ASSIGN  21379<>CALL    21380>>ASSIGN  21386>>IF      21389<>CALL    21390<<ASSIGN  21391>>ASSIGN
     21393>>ASSIGN  21393>>ASSIGN  21445<>CALL    21446>>ASSIGN  21452>>IF      21455<>CALL    21456<<ASSIGN
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:187  
     21457>>ASSIGN  21459>>ASSIGN  21486>>ASSIGN  21488>>ASSIGN  21488>>ASSIGN  21499>>ASSIGN  21499>>ASSIGN
     21511>>ASSIGN  21511>>ASSIGN  21581<>CALL    21582>>ASSIGN  21588>>IF      21591<>CALL    21592<<ASSIGN
     21593>>ASSIGN  21596>>ASSIGN  21704>>ASSIGN
TAPE_BLOCK_.W2
     18820**DCL     18821--REDEF
TAPE_CLOSE.SN_
     11276**DCL     11276--REDEF
TAPE_CLOSE.UTL_
     11277**DCL     11277--REDEF
TAPE_CLOSE.V.EXPIRE#
     11291**DCL     11291--REDEF
TAPE_CLOSE.V.TYPE#
     11289**DCL     11289--REDEF
TAPE_CLOSE.V.XTNSIZE#
     11286**DCL     11286--REDEF   11288--REDEF
TAPE_DCBLIST$
     10832**DCL     10832--IMP-PTR
TAPE_OPEN.ACSVEH_
     11141**DCL     11142--REDEF
TAPE_OPEN.ALTKEYS_
     11147**DCL     11148--REDEF   11148--REDEF
TAPE_OPEN.FPARAM_
     11144**DCL     21830<<ASSIGN
TAPE_OPEN.HDR_
     11146**DCL     11147--REDEF
TAPE_OPEN.IFPARAM_
     11144**DCL     21829<<ASSIGN
TAPE_OPEN.NAME_
     11140**DCL     21813<<ASSIGN
TAPE_OPEN.TAB_
     11145**DCL     11146--REDEF
TAPE_OPEN.UHL_
     11139**DCL     11140--REDEF   11140--REDEF
TAPE_OPEN.V.ASN#
     11158**DCL     21827<<ASSIGN
TAPE_OPEN.V.BLKL#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:188  
     11165**DCL     21003>>ASSIGN  21227>>ASSIGN  21801<<ASSIGN
TAPE_OPEN.V.CVOL#
     11153**DCL     21820<<ASSIGN  21825<<ASSIGN
TAPE_OPEN.V.DENSITY#
     11180**DCL     21000>>ASSIGN  21207>>ASSIGN  21223>>ASSIGN  21798<<ASSIGN
TAPE_OPEN.V.EXPIRE#
     11168**DCL     21002>>ASSIGN  21800<<ASSIGN
TAPE_OPEN.V.FSN#
     11179**DCL     11179--REDEF   11179--REDEF   21809<<ASSIGN
TAPE_OPEN.V.FUN#
     11158**DCL     21816<<ASSIGN
TAPE_OPEN.V.INITZ.SCRUB#
     11149**DCL     21814<<ASSIGN
TAPE_OPEN.V.IOERROK#
     11170**DCL     21806<<ASSIGN  21807<<ASSIGN
TAPE_OPEN.V.OPER.MNTONLY#
     11152**DCL     21802<<ASSIGN
TAPE_OPEN.V.RES#
     11163**DCL     21007>>IF      21172>>IF      21172>>IF      21821<<ASSIGN  21826<<ASSIGN
TAPE_OPEN.V.VOL#
     11173**DCL     21815<<ASSIGN
TAPE_OPEN.V.VOLACCESS#
     11177**DCL     21001>>ASSIGN  21211>>ASSIGN  21799<<ASSIGN
TAPE_OPEN.V.XTEND#
     11169**DCL     21808<<ASSIGN
TAPE_OPEN.WSN_
     11145**DCL     11145--REDEF
TAPE_OPTION.BLOCK
     11544**DCL     21225>>IF
TAPE_OPTION.CHECK
     11543**DCL     21004>>ASSIGN  21230>>ASSIGN  21804<<ASSIGN
TAPE_OPTION.CHECK_SPECD
     11543**DCL     21228>>IF      21803>>IF
TAPE_OPTION.DENSITY
     11543**DCL     21196>>IF
TAPE_OPTION.EXPIRE
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:189  
     11543**DCL     21212>>IF
TAPE_OPTION.IOERRORC
     11544**DCL     21005>>ASSIGN  21234>>ASSIGN  21807>>ASSIGN
TAPE_OPTION.IOERRORC_SPECD
     11544**DCL     21232>>IF      21805>>IF
TAPE_OPTION.VOLACCESS
     11543**DCL     21209>>IF
TAPE_READ.STATION_
     11203**DCL     11204--REDEF
TAPE_READ.V.DVBYTE.REREAD#
     11215**DCL     11215--REDEF
TAPE_READ.V.INDX#
     11213**DCL     11213--REDEF
TAPE_WRITE.STATION_
     11241**DCL     11241--REDEF
TAPE_WRITE.V.DVBYTE.VFC#
     11248**DCL     11248--REDEF
TEMP
     20923**DCL     21907<<ASSIGN  21908>>DOINDEX
TPTR$
     20933**DCL     21023<<ASSIGN  21025<<ASSIGN  21026>>DOINDEX 21027>>ASSIGN  21029>>ASSIGN  21081<>CALL
     21082>>ASSIGN  21158<>CALL    21159>>ASSIGN  21273<<ASSIGN  21279>>DOINDEX 21280>>ASSIGN  21282>>ASSIGN
     21291<<ASSIGN  21293<<ASSIGN  21295>>ASSIGN  21297>>ASSIGN  21389<>CALL    21390>>ASSIGN  21455<>CALL
     21456>>ASSIGN  21488<<ASSIGN  21490>>DOINDEX 21491>>ASSIGN  21493>>ASSIGN  21499<<ASSIGN  21500>>DOINDEX
     21501>>ASSIGN  21503>>ASSIGN  21511<<ASSIGN  21512>>DOINDEX 21513>>ASSIGN  21515>>ASSIGN  21591<>CALL
     21592>>ASSIGN  21752<>CALL    21753>>ASSIGN  21866<>CALL    21868>>ASSIGN  21870>>ASSIGN  21874>>ASSIGN
     21888<<ASSIGN  21903>>ASSIGN  21906<<ASSIGN  21907>>ASSIGN  21909>>ASSIGN
TSN_USED_NAME.L#
     19039**DCL     19039--IMP-SIZ
TVECTOR.W2
     11372**DCL     11373--REDEF
VLP_SN.NUM#
     20816**DCL     20985>>ASSIGN  20985--ASSIGN  21018<<ASSIGN  21026>>DOINDEX 21029<<ASSIGN  21029>>ASSIGN
     21035>>DOINDEX 21038<<ASSIGN  21038>>ASSIGN  21262>>ASSIGN  21262--ASSIGN  21279>>DOINDEX 21282<<ASSIGN
     21282>>ASSIGN  21294>>DOINDEX 21297<<ASSIGN  21297>>ASSIGN  21303>>DOINDEX 21306<<ASSIGN  21306>>ASSIGN
     21328>>DOINDEX 21404>>DOINDEX 21490>>DOINDEX 21493<<ASSIGN  21493>>ASSIGN  21494>>ASSIGN  21495>>ASSIGN
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:190  
     21495--ASSIGN  21500>>DOINDEX 21503<<ASSIGN  21503>>ASSIGN  21504>>ASSIGN  21504--ASSIGN  21512>>DOINDEX
     21515<<ASSIGN  21515>>ASSIGN  21525>>DOINDEX 21616>>DOINDEX 21647>>DOINDEX 21683>>DOINDEX 21687>>ASSIGN
     21688<<ASSIGN  21688>>ASSIGN  21786>>IF      21837>>ASSIGN  21837--ASSIGN  21867>>DOINDEX 21870<<ASSIGN
     21870>>ASSIGN  21887>>ASSIGN  21887--ASSIGN  21890>>ASSIGN  21894<<ASSIGN  21900>>ASSIGN  21900--ASSIGN
     21902>>DOINDEX 21912<<ASSIGN  21912>>ASSIGN  21931>>DOINDEX
VLP_SN.SN#
     20816**DCL     20985--ASSIGN  21016<<ASSIGN  21027<<ASSIGN  21027>>ASSIGN  21036<<ASSIGN  21036>>ASSIGN
     21086>>IF      21188>>IF      21262--ASSIGN  21280<<ASSIGN  21280>>ASSIGN  21295<<ASSIGN  21295>>ASSIGN
     21304<<ASSIGN  21304>>ASSIGN  21329>>ASSIGN  21400>>IF      21405>>IF      21461>>IF      21483--ASSIGN
     21491<<ASSIGN  21491>>ASSIGN  21494<<ASSIGN  21495--ASSIGN  21501<<ASSIGN  21501>>ASSIGN  21504--ASSIGN
     21513<<ASSIGN  21513>>ASSIGN  21526>>ASSIGN  21599>>IF      21617>>ASSIGN  21648>>IF      21684<<ASSIGN
     21684>>ASSIGN  21687<<ASSIGN  21763>>IF      21767>>ASSIGN  21837--ASSIGN  21868<<ASSIGN  21868>>ASSIGN
     21887--ASSIGN  21892<<ASSIGN  21892>>ASSIGN  21895<<ASSIGN  21900--ASSIGN  21903<<ASSIGN  21903>>ASSIGN
     21906--ASSIGN  21932>>ASSIGN
WRITE_ARCHIVE_REC
     20598**DCL     21110<>CALL    21114<>CALL    21332<>CALL    21339<>CALL    21530<>CALL    21534<>CALL
     21702<>CALL    21706<>CALL    21935<>CALL    21938<>CALL
WRITE_ARCHIVE_REC.BUF_
     20598**DCL     21109<<ASSIGN  21331<<ASSIGN  21529<<ASSIGN  21701<<ASSIGN  21934<<ASSIGN
WRITE_ARCHIVE_REC.BUF_.BOUND
     20598**DCL     21113<<ASSIGN  21338<<ASSIGN  21533<<ASSIGN  21705<<ASSIGN  21937<<ASSIGN
WRITE_ARCHIVE_REC.BUF_.BUF$
     20600**DCL     21112<<ASSIGN  21335<<ASSIGN  21337<<ASSIGN  21532<<ASSIGN  21704<<ASSIGN  21936<<ASSIGN
WRITE_ARCHIVE_REC.STATION_
     20600**DCL     20600--REDEF
WRITE_ARCHIVE_REC.V
     20601**DCL     20598--DCLINIT
WRITE_ARCHIVE_REC.V.DVBYTE.VFC#
     20607**DCL     20607--REDEF
WRITE_NODATA_LIST.STATION_
     20534**DCL     20534--REDEF
WRITE_NODATA_LIST.V.DVBYTE.VFC#
     20541**DCL     20541--REDEF
WRITE_PRIME_DUAL.STATION_
     19899**DCL     19899--REDEF
WRITE_PRIME_DUAL.V.DVBYTE.VFC#
PL6.E3A0      #001=FLE$ESTMOD File=FLE$ESTMOD.:E05TSI                            TUE 07/29/97 15:45 Page:191  
     19906**DCL     19906--REDEF
WRITE_REBUILD.STATION_
     20135**DCL     20135--REDEF
WRITE_REBUILD.V.DVBYTE.VFC#
     20142**DCL     20142--REDEF
WRITE_STATUS.STATION_
     19350**DCL     19350--REDEF
WRITE_STATUS.V.DVBYTE.VFC#
     19357**DCL     19357--REDEF
WRITE_TSN_USED.STATION_
     19060**DCL     19060--REDEF
WRITE_TSN_USED.V.DVBYTE.VFC#
     19067**DCL     19067--REDEF
