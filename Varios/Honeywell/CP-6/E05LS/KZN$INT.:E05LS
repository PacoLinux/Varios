VERSION E05

PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:1    
        1        1        /*M*     KZN$INT - Interrupt entry module                          */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC */
        8        8        /*P*     NAME:     KZN$INT
        9        9                 PURPOSE:  KZN$INT contains the interrupt entry points.
       10       10                           Its function is to process synchronous I/O device
       11       11                           interrupts.                                     */
       12       12        %EJECT;
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:2    
       13       13
       14       14        /*F*     NAME:     KZN$ACTVTY
       15       15                 PURPOSE:  KZN$ACTVTY is called from the line activity
       16       16                           interrupt level.  Upon entry, a connect path is
       17       17                           started and a profile is requested if a logon
       18       18                           is present in the channel table.                */
       19       19
       20       20        KZN$ACTVTY: PROC ASYNC;
       21       21
       22       22        %INCLUDE LCP_6;
       23     4301        %INCLUDE GH_HARDWARE_M;
       24     4399        %INCLUDE G_HJIT_M;
       25     4544        %INCLUDE KH_CHN;
       26     4584        %INCLUDE KHA_FNC_E;
       27     4684        %INCLUDE KH$CHN;
       28     4806        %INCLUDE KZ$LINCTX;
       29     5426        %INCLUDE KZ_INIT_C;
       30     5762        %INCLUDE KZ_PERR_C;
       31     5844        %INCLUDE KZ_CLM_E;
       32     6016        %FPT_WRSYSLOG (FPTN=MMERR,
       33     6017                       FCG='KZ',
       34     6018                       MID='N',
       35     6019                       SEV=%G_WRSYSLOG_SEV_LINE_ABORT#,
       36     6020                       STCLASS=CONSTANT);
       37     6115
       38     6116        %FPT_WRSYSLOG (STCLASS="");
       39     6211
       40     6212           %KH$CHN        ( STCLASS = "BASED(CHN$)" );
       41     6336           %KH_CHNDAT;
       42     6354           %G$UHJIT       ( STCLASS = "BASED(G$UHJIT$)" );
       43     9328           %FPT_INTRET (WAKEME=YES,STCLASS=CONSTANT);
       44     9348           %KZ$LINCTX (STCLASS="BASED(CTX$)");
       45     9779
       46     9780           %KZ$LINCTX ( NAME = KZ@LINCTX,
       47     9781                        STCLASS = CONSTANT );
       48    10212
       49    10213
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:3    
       50    10214           %KZ$EVENT ( FPTN = KZ$EVENT,
       51    10215                       STCLASS = AUTO );
       52    10297
       53    10298    1   DCL KZP$CNCDSC ENTRY (1) ALTRET;
       54    10299    1   DCL KVB$GETSYS ENTRY (2) ALTRET;
       55    10300    1   DCL KVB$RLSSYS ENTRY (2) ALTRET;
       56    10301    1   DCL KHA$DVCADM ENTRY(6) ALTRET;
       57    10302    1   DCL KHA$ERRLOG ENTRY(2) ALTRET;
       58    10303    1   DCL KZC$SCREECH ENTRY(1);
       59    10304    1   DCL X6A_INTRET ENTRY(1);
       60    10305    1   DCL KZ_INT_LEV UBIN SYMREF;
       61    10306    1   DCL G$UHJIT$ PTR SYMREF;
       62    10307
       63    10308    1   DCL CHN$ PTR;
       64    10309    1   DCL CTX$ PTR;
       65    10310    1   DCL CHAN UBIN WORD;
       66    10311    1   DCL CHANS REDEF CHAN SBIN WORD;
       67    10312    1   DCL SZ UBIN;
       68    10313        %VLP_ERRCODE (FPTN=ERRORWORD, STCLASS="" );
       69    10359
       70    10360        /**/
       71    10361    1         IF BITBIN(G$UHJIT.ISA_USR.DEV) < KH_CHNLOW  OR
       72    10362    1            BITBIN(G$UHJIT.ISA_USR.DEV) > KH_CHNHI THEN
       73    10363    1            GOTO ERRXIT;
       74    10364
       75    10365    1         CHAN = BITBIN(BINBIT(BITBIN(G$UHJIT.ISA_USR.DEV) - KH_CHNLOW, 16)) / 128;
       76    10366
       77    10367    1         CHN$ = PINCRW (KH_CHNLOW$, SIZEW(KH$CHN)*CHANS );
       78    10368
       79    10369
       80    10370    1         SZ = SIZEW(KZ$LINCTX);
       81    10371    1         CALL KVB$GETSYS (SZ, CTX$)
       82    10372    1         WHENALTRETURN
       83    10373    2         DO;
       84    10374                  /*    Log "Out of MEMory" error and kill the line.    */
       85    10375
       86    10376    2            FPT_WRSYSLOG=MMERR;
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:4    
       87    10377    2            FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$NOBFR;
       88    10378    2            FPT_WRSYSLOG.V.VALUES (0) = SZ;
       89    10379    2            GOTO ERRXIT;
       90    10380        /*E*  ERROR:        KZN-E$NOBFR-6
       91    10381              MESSAGE:      Insufficient BISYNC MEMory (a NETCON parameter).
       92    10382              DESCRIPTION:  A KVB call ALTRETed to indicate that BISYNC is out of
       93    10383                            MEMory.  Since a necessary I/O buffer or device context
       94    10384                            could not be allocated, the HASP/2780/3780 TERMinal
       95    10385                            associated with the request has been disconnected.
       96    10386                            V0 = Size of buffer, in words, which could not be allocated.
       97    10387        */
       98    10388    2            END;
       99    10389
      100    10390    1         KZ$LINCTX = KZ@LINCTX;
      101    10391    1         KZ$LINCTX.LINID = CHN$->KH$CHN.TERMID;
      102    10392    1         KZ$LINCTX.CHN$ = CHN$;
      103    10393    1         KZ$LINCTX.CHAN = CHAN * 128;
      104    10394    1         CALL KHA$DVCADM ( %KHA_FNC_CONNECT,
      105    10395    1            ERRORWORD,
      106    10396    1            CHN$ -> KH$CHN.TERMID,, )
      107    10397    2         WHENALTRETURN DO;
      108    10398
      109    10399        /*
      110    10400         Handler-common said no to connection.
      111    10401         We need to release the context that we allocated.
      112    10402        */
      113    10403    2            CALL KVB$RLSSYS ( SIZEW(KZ$LINCTX), CTX$ );
      114    10404    2            FPT_WRSYSLOG=MMERR;
      115    10405    2            FPT_WRSYSLOG.V.ERRCODE.ERR#=%E$MMERR;
      116    10406    2   ERRXIT:
      117    10407    2            FPT_WRSYSLOG.V.TERMID=CHN$->KH$CHN.TERMID;
      118    10408    2            CALL KHA$ERRLOG (FPT_WRSYSLOG) ALTRET(IGNORE_WRSYSLOG_ALTRET);
      119    10409    2   IGNORE_WRSYSLOG_ALTRET:
      120    10410
      121    10411        /*E*       ERROR: KZN-E$MMERR-0
      122    10412                   MESSAGE: Unable to initialize/connect line.
      123    10413                   DESCRIPTION: Line remains disconnected and enabled.
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:5    
      124    10414        */
      125    10415    2            CALL X6A_INTRET (FPT_INTRET);
      126    10416    2            END;
      127    10417
      128    10418    1         KH$CHN.CTX$ = CTX$;
      129    10419    2         IF KH$CHN.AUTLGN = '0'B THEN DO;
      130    10420    2            KZ$LINCTX.PTHSTT = %KZ#CLM_STATE_INTNUL;
      131    10421    2            END;
      132    10422    2         ELSE DO;
      133    10423    2            KZ$LINCTX.PTHSTT = %KZ#CLM_STATE_INTPRO;
      134    10424    2            END;
      135    10425    1         KZ$EVENT.EVENT = %KZ#CLM_EVENT_LISTEN;
      136    10426    1         KZ$EVENT.LINCTX$ = CTX$;
      137    10427    1         CALL KZP$CNCDSC ( KZ$EVENT );
      138    10428
      139    10429
      140    10430    1         CALL X6A_INTRET (FPT_INTRET);
      141    10431
      142    10432    1   END KZN$ACTVTY;
      143    10433        %EOD;

PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:6    
--  Include file information  --

   KZ_CLM_E.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KZ_INIT_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   G_HJIT_M.:E05TOU  is referenced.
   GH_HARDWARE_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KZN$ACTVTY.

   Procedure KZN$ACTVTY requires 246 words for executable code.
   Procedure KZN$ACTVTY requires 58 words of local(AUTO) storage.

PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:7    

 Object Unit name= KZN$ACTVTY                                 File name= KZN$INT.:E05TOU
 UTS= JUL 30 '97 02:56:41.24 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    165     A5  KZN$ACTVTY
    1   Proc  even  none   246     F6  KZN$ACTVTY
    2  RoData even  none     2      2  KZN$ACTVTY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes     Async       0  KZN$ACTVTY

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KVB$GETSYS
 yes     yes           Std       6 KHA$DVCADM
 yes     yes           Std       1 KZP$CNCDSC
 yes     yes           Std       2 KVB$RLSSYS
 yes     yes           Std       2 KHA$ERRLOG
         yes           Std       1 X6A_INTRET
                       nStd      0 X6A_AAUTO
                       nStd      0 X6A_AARET
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:8    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNLOW$                       r    KH_CHNHI                         r    KH_CHNLOW
     G$UHJIT$                         r    G$ROS$
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:9    


        1        1        /*M*     KZN$INT - Interrupt entry module                          */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC */
        8        8        /*P*     NAME:     KZN$INT
        9        9                 PURPOSE:  KZN$INT contains the interrupt entry points.
       10       10                           Its function is to process synchronous I/O device
       11       11                           interrupts.                                     */
       12       12        %EJECT;
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:10   
       13       13
       14       14        /*F*     NAME:     KZN$ACTVTY
       15       15                 PURPOSE:  KZN$ACTVTY is called from the line activity
       16       16                           interrupt level.  Upon entry, a connect path is
       17       17                           started and a profile is requested if a logon
       18       18                           is present in the channel table.                */
       19       19
       20       20        KZN$ACTVTY: PROC ASYNC;

     20   1 000000  D380 0000 0000  xent KZN$ACTVTY      LNJ,B5   X6A_AAUTO
          1 000003       003A 0000                       DC       58,0

       21       21
       22       22        %INCLUDE LCP_6;
       23     4301        %INCLUDE GH_HARDWARE_M;
       24     4399        %INCLUDE G_HJIT_M;
       25     4544        %INCLUDE KH_CHN;
       26     4584        %INCLUDE KHA_FNC_E;
       27     4684        %INCLUDE KH$CHN;
       28     4806        %INCLUDE KZ$LINCTX;
       29     5426        %INCLUDE KZ_INIT_C;
       30     5762        %INCLUDE KZ_PERR_C;
       31     5844        %INCLUDE KZ_CLM_E;
       32     6016        %FPT_WRSYSLOG (FPTN=MMERR,
       33     6017                       FCG='KZ',
       34     6018                       MID='N',
       35     6019                       SEV=%G_WRSYSLOG_SEV_LINE_ABORT#,
       36     6020                       STCLASS=CONSTANT);
       37     6115
       38     6116        %FPT_WRSYSLOG (STCLASS="");
       39     6211
       40     6212           %KH$CHN        ( STCLASS = "BASED(CHN$)" );
       41     6336           %KH_CHNDAT;
       42     6354           %G$UHJIT       ( STCLASS = "BASED(G$UHJIT$)" );
       43     9328           %FPT_INTRET (WAKEME=YES,STCLASS=CONSTANT);
       44     9348           %KZ$LINCTX (STCLASS="BASED(CTX$)");
       45     9779
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:11   
       46     9780           %KZ$LINCTX ( NAME = KZ@LINCTX,
       47     9781                        STCLASS = CONSTANT );
       48    10212
       49    10213
       50    10214           %KZ$EVENT ( FPTN = KZ$EVENT,
       51    10215                       STCLASS = AUTO );
       52    10297
       53    10298    1   DCL KZP$CNCDSC ENTRY (1) ALTRET;
       54    10299    1   DCL KVB$GETSYS ENTRY (2) ALTRET;
       55    10300    1   DCL KVB$RLSSYS ENTRY (2) ALTRET;
       56    10301    1   DCL KHA$DVCADM ENTRY(6) ALTRET;
       57    10302    1   DCL KHA$ERRLOG ENTRY(2) ALTRET;
       58    10303    1   DCL KZC$SCREECH ENTRY(1);
       59    10304    1   DCL X6A_INTRET ENTRY(1);
       60    10305    1   DCL KZ_INT_LEV UBIN SYMREF;
       61    10306    1   DCL G$UHJIT$ PTR SYMREF;
       62    10307
       63    10308    1   DCL CHN$ PTR;
       64    10309    1   DCL CTX$ PTR;
       65    10310    1   DCL CHAN UBIN WORD;
       66    10311    1   DCL CHANS REDEF CHAN SBIN WORD;
       67    10312    1   DCL SZ UBIN;
       68    10313        %VLP_ERRCODE (FPTN=ERRORWORD, STCLASS="" );
       69    10359
       70    10360        /**/
       71    10361    1         IF BITBIN(G$UHJIT.ISA_USR.DEV) < KH_CHNLOW  OR

  10361   1 000005  EC80 0000 0000  xsym                 LDB,B6   G$UHJIT$
          1 000008  E846 0081                            LDR,R6   129,B6
          1 00000A  E900 0000 0000  xsym                 CMR,R6   KH_CHNLOW
          1 00000D  0201 0099                            BL       s:10407,PREL
          1 00000F  E900 0000 0000  xsym                 CMR,R6   KH_CHNHI
          1 000012  0301 0094                            BG       s:10407,PREL

       72    10362    1            BITBIN(G$UHJIT.ISA_USR.DEV) > KH_CHNHI THEN
       73    10363    1            GOTO ERRXIT;
       74    10364
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:12   
       75    10365    1         CHAN = BITBIN(BINBIT(BITBIN(G$UHJIT.ISA_USR.DEV) - KH_CHNLOW, 16)) / 128;

  10365   1 000014  E200 0000 0000  xsym                 SUB,R6   KH_CHNLOW
          1 000017  6047                                 SOR,R6   7
          1 000018  EF47 002B                            STR,R6   CHAN,AUTO

       76    10366
       77    10367    1         CHN$ = PINCRW (KH_CHNLOW$, SIZEW(KH$CHN)*CHANS );

  10367   1 00001A  E847 002B                            LDR,R6   CHAN,AUTO
          1 00001C  70F0                                 DAR,R7   16
          1 00001D  7085                                 DOL,R7   5
          1 00001E  8400 0000 0000  xsym                 AID      KH_CHNLOW$
          1 000021  8D47 0027                            SDI      CHN$,AUTO

       78    10368
       79    10369
       80    10370    1         SZ = SIZEW(KZ$LINCTX);

  10370   1 000023  D870 0089                            LDR,R5   137,IMO
          1 000025  DF47 002C                            STR,R5   SZ,AUTO

       81    10371    1         CALL KVB$GETSYS (SZ, CTX$)

  10371   1 000027  DBC7 0029                            LAB,B5   CTX$,AUTO
          1 000029  DFC7 0032                            STB,B5   ERRORWORD+5,AUTO
          1 00002B  CBC7 002C                            LAB,B4   SZ,AUTO
          1 00002D  CFC7 0030                            STB,B4   ERRORWORD+3,AUTO
          1 00002F  BBC7 0030                            LAB,B3   ERRORWORD+3,AUTO
          1 000031  CBF0 0200                            LAB,B4   512,IMO
          1 000033  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 000036       0003                            DC       s:10376,PREL
          1 000037  0F81 0014                            B        s:10390,PREL

       82    10372    1         WHENALTRETURN
       83    10373    2         DO;

PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:13   
       84    10374                  /*    Log "Out of MEMory" error and kill the line.    */
       85    10375
       86    10376    2            FPT_WRSYSLOG=MMERR;

  10376   1 000039  AB80 0000 0000  00                   LAB,B2   MMERR
          1 00003C  2C00                                 LDV,R2   0
          1 00003D  6C2A                                 LDV,R6   42
          1 00003E  BB87                                 LAB,B3   ,AUTO
          1 00003F  3C08                                 LDV,R3   8
          1 000040  0008                                 MMM

       87    10377    2            FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$NOBFR;

  10377   1 000041  E870 0380                            LDR,R6   896,IMO
          1 000043  EAC7 000B                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          1 000045       FFF8

       88    10378    2            FPT_WRSYSLOG.V.VALUES (0) = SZ;

  10378   1 000046  D847 002C                            LDR,R5   SZ,AUTO
          1 000048  DF47 0014                            STR,R5   FPT_WRSYSLOG+16,AUTO

       89    10379    2            GOTO ERRXIT;

  10379   1 00004A  0F81 005C                            B        s:10407,PREL

       90    10380        /*E*  ERROR:        KZN-E$NOBFR-6
       91    10381              MESSAGE:      Insufficient BISYNC MEMory (a NETCON parameter).
       92    10382              DESCRIPTION:  A KVB call ALTRETed to indicate that BISYNC is out of
       93    10383                            MEMory.  Since a necessary I/O buffer or device context
       94    10384                            could not be allocated, the HASP/2780/3780 TERMinal
       95    10385                            associated with the request has been disconnected.
       96    10386                            V0 = Size of buffer, in words, which could not be allocated.
       97    10387        */
       98    10388    2            END;
       99    10389
      100    10390    1         KZ$LINCTX = KZ@LINCTX;
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:14   

  10390   1 00004C  AB80 0000 0000  00                   LAB,B2   MMERR
          1 00004F  2C38                                 LDV,R2   56
          1 000050  E870 0112                            LDR,R6   274,IMO
          1 000052  BCC7 0029                            LDB,B3   CTX$,AUTO
          1 000054  3C00                                 LDV,R3   0
          1 000055  0008                                 MMM

      101    10391    1         KZ$LINCTX.LINID = CHN$->KH$CHN.TERMID;

  10391   1 000056  ACC7 0027                            LDB,B2   CHN$,AUTO
          1 000058  2C24                                 LDV,R2   36
          1 000059  6C10                                 LDV,R6   16
          1 00005A  BCC7 0029                            LDB,B3   CTX$,AUTO
          1 00005C  3C08                                 LDV,R3   8
          1 00005D  0008                                 MMM

      102    10392    1         KZ$LINCTX.CHN$ = CHN$;

  10392   1 00005E  ECC7 0027                            LDB,B6   CHN$,AUTO
          1 000060  DCC7 0029                            LDB,B5   CTX$,AUTO
          1 000062  EFC5 0002                            STB,B6   2,B5

      103    10393    1         KZ$LINCTX.CHAN = CHAN * 128;

  10393   1 000064  DCC7 0029                            LDB,B5   CTX$,AUTO
          1 000066  E847 002B                            LDR,R6   CHAN,AUTO
          1 000068  6007                                 SOL,R6   7
          1 000069  EF45 0033                            STR,R6   51,B5

      104    10394    1         CALL KHA$DVCADM ( %KHA_FNC_CONNECT,

  10394   1 00006B  CBF0 000E                            LAB,B4   14,IMO
          1 00006D  BB80 0000 0000                       LAB,B3   0
          1 000070  BFC7 0038                            STB,B3   ERRORWORD+11,AUTO
          1 000072  AB80 0000 0000                       LAB,B2   0
          1 000075  AFC7 0036                            STB,B2   ERRORWORD+9,AUTO
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:15   
          1 000077  9BC6 0012                            LAB,B1   18,B6
          1 000079  9FC7 0034                            STB,B1   ERRORWORD+7,AUTO
          1 00007B  EBC7 002D                            LAB,B6   ERRORWORD,AUTO
          1 00007D  EFC7 0032                            STB,B6   ERRORWORD+5,AUTO
          1 00007F  CFC7 0030                            STB,B4   ERRORWORD+3,AUTO
          1 000081  BBC7 0030                            LAB,B3   ERRORWORD+3,AUTO
          1 000083  CBF0 0500                            LAB,B4   1280,IMO
          1 000085  E380 0000 0000  xent                 LNJ,B6   KHA$DVCADM
          1 000088       0003                            DC       s:10403,PREL
          1 000089  0F81 0039                            B        s:10418,PREL

      105    10395    1            ERRORWORD,
      106    10396    1            CHN$ -> KH$CHN.TERMID,, )
      107    10397    2         WHENALTRETURN DO;

      108    10398
      109    10399        /*
      110    10400         Handler-common said no to connection.
      111    10401         We need to release the context that we allocated.
      112    10402        */
      113    10403    2            CALL KVB$RLSSYS ( SIZEW(KZ$LINCTX), CTX$ );

  10403   1 00008B  EBF0 0089                            LAB,B6   137,IMO
          1 00008D  DBC7 0029                            LAB,B5   CTX$,AUTO
          1 00008F  DFC7 0032                            STB,B5   ERRORWORD+5,AUTO
          1 000091  EFC7 0030                            STB,B6   ERRORWORD+3,AUTO
          1 000093  BBC7 0030                            LAB,B3   ERRORWORD+3,AUTO
          1 000095  CBF0 0200                            LAB,B4   512,IMO
          1 000097  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 00009A       0001                            DC       s:10404,PREL

      114    10404    2            FPT_WRSYSLOG=MMERR;

  10404   1 00009B  AB80 0000 0000  00                   LAB,B2   MMERR
          1 00009E  2C00                                 LDV,R2   0
          1 00009F  6C2A                                 LDV,R6   42
          1 0000A0  BB87                                 LAB,B3   ,AUTO
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:16   
          1 0000A1  3C08                                 LDV,R3   8
          1 0000A2  0008                                 MMM

      115    10405    2            FPT_WRSYSLOG.V.ERRCODE.ERR#=%E$MMERR;

  10405   1 0000A3  6C30                                 LDV,R6   48
          1 0000A4  EAC7 000B                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          1 0000A6       FFF8

      116    10406    2   ERRXIT:
      117    10407    2            FPT_WRSYSLOG.V.TERMID=CHN$->KH$CHN.TERMID;

  10407   1 0000A7  ACC7 0027            ERRXIT          LDB,B2   CHN$,AUTO
          1 0000A9  2C24                                 LDV,R2   36
          1 0000AA  6C10                                 LDV,R6   16
          1 0000AB  BB87                                 LAB,B3   ,AUTO
          1 0000AC  3C18                                 LDV,R3   24
          1 0000AD  0008                                 MMM

      118    10408    2            CALL KHA$ERRLOG (FPT_WRSYSLOG) ALTRET(IGNORE_WRSYSLOG_ALTRET);

  10408   1 0000AE  EBC7 0004                            LAB,B6   FPT_WRSYSLOG,AUTO
          1 0000B0  EFC7 0030                            STB,B6   ERRORWORD+3,AUTO
          1 0000B2  BBC7 0030                            LAB,B3   ERRORWORD+3,AUTO
          1 0000B4  CBF0 0100                            LAB,B4   256,IMO
          1 0000B6  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          1 0000B9       0001                            DC       s:10415,PREL

      119    10409    2   IGNORE_WRSYSLOG_ALTRET:
      120    10410
      121    10411        /*E*       ERROR: KZN-E$MMERR-0
      122    10412                   MESSAGE: Unable to initialize/connect line.
      123    10413                   DESCRIPTION: Line remains disconnected and enabled.
      124    10414        */
      125    10415    2            CALL X6A_INTRET (FPT_INTRET);

  10415   1 0000BA  BB80 0000 0000  02   IGNORE_WRSYSLOG*LAB,B3   0
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:17   
          1 0000BD  CBF0 0100                            LAB,B4   256,IMO
          1 0000BF  E380 0000 0000  xent                 LNJ,B6   X6A_INTRET
          1 0000C2       0001                            DC       s:10418,PREL

      126    10416    2            END;

      127    10417
      128    10418    1         KH$CHN.CTX$ = CTX$;

  10418   1 0000C3  ECC7 0029                            LDB,B6   CTX$,AUTO
          1 0000C5  DCC7 0027                            LDB,B5   CHN$,AUTO
          1 0000C7  EFC5 000C                            STB,B6   12,B5

      129    10419    2         IF KH$CHN.AUTLGN = '0'B THEN DO;

  10419   1 0000C9  8285                                 LB,'0004'X        ,B5
  10419   1 0000CA       0004
          1 0000CB  0501 0007                            BBT      s:10423,PREL

      130    10420    2            KZ$LINCTX.PTHSTT = %KZ#CLM_STATE_INTNUL;

  10420   1 0000CD  CCC7 0029                            LDB,B4   CTX$,AUTO
          1 0000CF  8744 000D                            CL       13,B4

      131    10421    2            END;

  10421   1 0000D1  0F81 0006                            B        s:10425,PREL

      132    10422    2         ELSE DO;

      133    10423    2            KZ$LINCTX.PTHSTT = %KZ#CLM_STATE_INTPRO;

  10423   1 0000D3  CCC7 0029                            LDB,B4   CTX$,AUTO
          1 0000D5  6C05                                 LDV,R6   5
          1 0000D6  EF44 000D                            STR,R6   13,B4

      134    10424    2            END;
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:18   

      135    10425    1         KZ$EVENT.EVENT = %KZ#CLM_EVENT_LISTEN;

  10425   1 0000D8  8747 0019                            CL       KZ$EVENT,AUTO

      136    10426    1         KZ$EVENT.LINCTX$ = CTX$;

  10426   1 0000DA  ECC7 0029                            LDB,B6   CTX$,AUTO
          1 0000DC  EFC7 001C                            STB,B6   KZ$EVENT+3,AUTO

      137    10427    1         CALL KZP$CNCDSC ( KZ$EVENT );

  10427   1 0000DE  CBC7 0019                            LAB,B4   KZ$EVENT,AUTO
          1 0000E0  CFC7 0030                            STB,B4   ERRORWORD+3,AUTO
          1 0000E2  BBC7 0030                            LAB,B3   ERRORWORD+3,AUTO
          1 0000E4  CBF0 0100                            LAB,B4   256,IMO
          1 0000E6  E380 0000 0000  xent                 LNJ,B6   KZP$CNCDSC
          1 0000E9       0001                            DC       s:10430,PREL

      138    10428
      139    10429
      140    10430    1         CALL X6A_INTRET (FPT_INTRET);

  10430   1 0000EA  BB80 0000 0000  02                   LAB,B3   0
          1 0000ED  CBF0 0100                            LAB,B4   256,IMO
          1 0000EF  E380 0000 0000  xent                 LNJ,B6   X6A_INTRET
          1 0000F2       0001                            DC       s:10432,PREL

      141    10431
      142    10432    1   END KZN$ACTVTY;

  10432   1 0000F3  C380 0000 0000  xent                 LNJ,B4   X6A_AARET
      143    10433        %EOD;

PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:19   
--  Include file information  --

   KZ_CLM_E.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KZ_INIT_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   G_HJIT_M.:E05TOU  is referenced.
   GH_HARDWARE_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KZN$ACTVTY.
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:20   

 **** Variables and constants ****

  ****  Section 000 RoData KZN$ACTVTY

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    15-0-0/w STRC(112)   r     1 FPT_INTRET                1C-0-0/w STRC(2192)  r     1 KZ@LINCTX
     0-0-0/w STRC(336)   r     1 MMERR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    2B-0-0/w UBIN(16)    r     1 CHAN                      2B-0-0/w SBIN(16)    r     1 CHANS
    27-0-0/w PTR         r     1 CHN$                      29-0-0/w PTR         r     1 CTX$
    2D-0-0/w STRC(32)    r     1 ERRORWORD                  4-0-0/w STRC(336)   r     1 FPT_WRSYSLOG
    19-0-0/w STRC(224)   r     1 KZ$EVENT                  2C-0-0/w UBIN(16)    r     1 SZ

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$UHJIT$                   0-0-0/w UBIN(16)    r     1 KH_CHNHI
     0-0-0/w UBIN(16)    r     1 KH_CHNLOW                  0-0-0/w PTR         r     1 KH_CHNLOW$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(6480)  r     1 G$UHJIT                    0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w STRC(2192)  r     1 KZ$LINCTX

PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:21   

   Procedure KZN$ACTVTY requires 246 words for executable code.
   Procedure KZN$ACTVTY requires 58 words of local(AUTO) storage.
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:22   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:23   
          MINI XREF LISTING

CHAN
     10310**DCL     10311--REDEF   10365<<ASSIGN  10393>>ASSIGN
CHANS
     10311**DCL     10367>>ASSIGN
CHN$
     10308**DCL      6227--IMP-PTR 10367<<ASSIGN  10391>>ASSIGN  10392>>ASSIGN  10394>>CALL    10407>>ASSIGN
     10418>>ASSIGN  10419>>IF
CTX$
     10309**DCL      9359--IMP-PTR 10371<>CALL    10390>>ASSIGN  10391>>ASSIGN  10392>>ASSIGN  10393>>ASSIGN
     10403<>CALL    10418>>ASSIGN  10420>>ASSIGN  10423>>ASSIGN  10426>>ASSIGN
ERRORWORD
     10327**DCL     10394<>CALL
ERRXIT
     10407**LABEL   10363--GOTO    10379--GOTO
FPT_INTRET
      9341**DCL     10415<>CALL    10430<>CALL
FPT_INTRET.V
      9345**DCL      9343--DCLINIT
FPT_WRSYSLOG
      6129**DCL     10376<<ASSIGN  10404<<ASSIGN  10408<>CALL
FPT_WRSYSLOG.V.ERRCODE.ERR#
      6177**DCL     10377<<ASSIGN  10405<<ASSIGN
FPT_WRSYSLOG.V.TERMID
      6196**DCL     10407<<ASSIGN
FPT_WRSYSLOG.V.TERMID.TERM
      6198**DCL      6207--REDEF
FPT_WRSYSLOG.V.VALUES
      6209**DCL     10378<<ASSIGN
G$UHJIT.ISA_USR
      7794**DCL      8089--REDEF
G$UHJIT.ISA_USR.DEV
      7816**DCL     10361>>IF      10361>>IF      10365>>ASSIGN
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:24   
G$UHJIT.ISA_USR.P$$
      7869**DCL      7869--REDEF
G$UHJIT.TSA_CP.ISA.P$$
      9076**DCL      9076--REDEF
G$UHJIT.TSA_CP.P$$
      8947**DCL      8947--REDEF    8948--REDEF
G$UHJIT.TSA_DB.ISA.P$$
      8688**DCL      8688--REDEF
G$UHJIT.TSA_DB.P$$
      8559**DCL      8559--REDEF    8560--REDEF
G$UHJIT.TSA_RTT.P$$
      9322**DCL      9322--REDEF    9323--REDEF
G$UHJIT.TSA_USR.ISA.P$$
      8278**DCL      8278--REDEF
G$UHJIT.TSA_USR.P$$
      8149**DCL      8149--REDEF    8150--REDEF
G$UHJIT$
     10306**DCL      6371--IMP-PTR 10361>>IF      10361>>IF      10365>>ASSIGN
IGNORE_WRSYSLOG_ALTRET
     10415**LABEL   10408--CALLALT
KH$CHN
      6227**DCL     10367--ASSIGN
KH$CHN.AUTLGN
      6238**DCL     10419>>IF
KH$CHN.CTX$
      6297**DCL     10418<<ASSIGN
KH$CHN.TERMID
      6321**DCL     10391>>ASSIGN  10394<>CALL    10407>>ASSIGN
KH$CHN.TERMID.TERM
      6323**DCL      6332--REDEF
KHA$DVCADM
     10301**DCL-ENT 10394--CALL
KHA$ERRLOG
     10302**DCL-ENT 10408--CALL
KH_CHNHI
      6349**DCL      6350--REDEF   10361>>IF
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:25   
KH_CHNLOW
      6350**DCL      6351--REDEF   10361>>IF      10365>>ASSIGN
KH_CHNLOW$
      6349**DCL     10367>>ASSIGN
KVB$GETSYS
     10299**DCL-ENT 10371--CALL
KVB$RLSSYS
     10300**DCL-ENT 10403--CALL
KZ$EVENT
     10229**DCL     10427<>CALL
KZ$EVENT.EVENT
     10230**DCL     10425<<ASSIGN
KZ$EVENT.LINCTX$
     10236**DCL     10426<<ASSIGN
KZ$LINCTX
      9359**DCL     10370--ASSIGN  10390<<ASSIGN  10403--CALL
KZ$LINCTX.CHAN
      9450**DCL     10393<<ASSIGN
KZ$LINCTX.CHN$
      9362**DCL     10392<<ASSIGN
KZ$LINCTX.LINID
      9380**DCL     10391<<ASSIGN
KZ$LINCTX.LINID.TERM
      9382**DCL      9391--REDEF
KZ$LINCTX.OTPCNT
      9647**DCL      9650--REDEF
KZ$LINCTX.POLSIZ
      9693**DCL      9695--REDEF
KZ$LINCTX.PTHSTT
      9397**DCL     10420<<ASSIGN  10423<<ASSIGN
KZ@LINCTX
      9792**DCL     10390>>ASSIGN
KZ@LINCTX.LINID.TERM
      9815**DCL      9824--REDEF
KZ@LINCTX.OTPCNT
     10080**DCL     10083--REDEF
PL6.E3A0      #001=KZN$ACTVTY File=KZN$INT.:E05TSI                               WED 07/30/97 02:56 Page:26   
KZ@LINCTX.POLSIZ
     10126**DCL     10128--REDEF
KZP$CNCDSC
     10298**DCL-ENT 10427--CALL
MMERR
      6033**DCL     10376>>ASSIGN  10404>>ASSIGN
MMERR.V
      6037**DCL      6035--DCLINIT
MMERR.V.TERMID.TERM
      6102**DCL      6111--REDEF
SZ
     10312**DCL     10370<<ASSIGN  10371<>CALL    10378>>ASSIGN
X6A_INTRET
     10304**DCL-ENT 10415--CALL    10430--CALL

PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:27   
      144        1        /*T***********************************************************/
      145        2        /*T*                                                         */
      146        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      147        4        /*T*                                                         */
      148        5        /*T***********************************************************/
      149        6        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC */
      150        7        /*F*     NAME:     KZN$OTPCMP
      151        8                 PURPOSE:  KZN$OTPCMP fields output complete interrupts. It
      152        9                           cancels any in-progress timeout clock. If
      153       10                           the output interrupt occurs first and clocks are
      154       11                           being used, it starts a receive-timeout clock.
      155       12                           If the output interrupt occurs after the input
      156       13                           interrupt, it calls KZO$EVENT to figure out what
      157       14                           was received and then calls KZP$DRIVER to report
      158       15                           that event.                                     */
      159       16
      160       17        KZN$OTPCMP: PROC ASYNC;
      161       18
      162       19        %INCLUDE LCP_6;
      163     4298        %INCLUDE KL_MACRO_C;
      164     7650        %INCLUDE KL_AFCN_C;
      165     7751        %INCLUDE K_ID_E;
      166     7801        %K#ENTID_E;
      167     7820        %K#LYRID_E;
      168     7827        %INCLUDE GH_HARDWARE_M;
      169     7925        %INCLUDE G_HJIT_M;
      170     8070        %INCLUDE G_JIT_M;
      171     8335        %INCLUDE KH$CHN;
      172     8457        %INCLUDE KH_CHN;
      173     8497        %INCLUDE KZ$LINCTX;
      174     9117        %INCLUDE KZ_CLM_E;
      175     9289        %INCLUDE KZ_CLMEVT_C;
      176     9331        %INCLUDE KZ$BSCSTT;
      177     9437        %INCLUDE KH$STT;
      178     9467        %INCLUDE KZ_INIT_C;
      179     9803        %INCLUDE KH$CLK;
      180    10173        %INCLUDE KH_CLKFNC_E;
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:28   
      181    10218
      182    10219           %KH$CHN         ( STCLASS = "BASED(CHN$)" );
      183    10343           %KH_CHNDAT;
      184    10361           %G$JIT(STCLASS="BASED(G$JIT$)");
      185    10775    1   DCL G$JIT$ PTR SYMREF;
      186    10776    1   DCL G$UHJIT$ PTR SYMREF;
      187    10777           %G$UHJIT        ( STCLASS = "BASED(G$UHJIT$)" );
      188    13751           %FPT_INTRET (WAKEME=YES,STCLASS=CONSTANT);
      189    13771    1   DCL G$LOW_MEM$ PTR SYMREF;
      190    13772           %G$LOW_MEM  (STCLASS = "BASED(G$LOW_MEM$)");
      191    13821           %KH$CLK         ( FPTN = KH_SETCLK,
      192    13822                             FNC = %KH#CLK_SETCLK,
      193    13823                             PRDUNT = %KH#C_SEC,
      194    13824                             ACCURACY = 0,
      195    13825                             STCLASS = CONSTANT );
      196    13974           %KH$CLK         ( FPTN = KH_CANCELCLK,
      197    13975                             FNC = %KH#CLK_CANCEL,
      198    13976                             STCLASS = CONSTANT );
      199    14125           %KZ$BSCSTT     ( STCLASS = "BASED(STT$)" );
      200    14506           %KZ_INIT_HDR    ( NAME = KZ$HDR,
      201    14507                             STCLASS = BASED );
      202    14531            %KZ$LINCTX;
      203    14962
      204    14963
      205    14964
      206    14965    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
      207    14966    1   DCL KHC$XEQ2 ENTRY(1) ALTRET;
      208    14967    1   DCL KHC$DLTXEQ2 ENTRY(1) ALTRET;
      209    14968    1   DCL KZC$INPCLK ENTRY(1);
      210    14969    1   DCL KZO$EVENT ENTRY(3);
      211    14970    1   DCL KZP$DRIVER ENTRY(3);
      212    14971    1   DCL X6A_INTRET ENTRY (1);
      213    14972    1   DCL KZ_HDR$(0:0) PTR SYMREF;
      214    14973
      215    14974    1   DCL CHN$ PTR;
      216    14975    1   DCL CTX$ PTR;
      217    14976    1   DCL CHAN UBIN WORD;
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:29   
      218    14977    1   DCL CHANS REDEF CHAN SBIN WORD;
      219    14978    1   DCL SIZE UBIN WORD;
      220    14979    1   DCL EVENT UBIN WORD;
      221    14980    1   DCL PROTYP UBIN WORD;
      222    14981    1   DCL OTIME UBIN(32);
      223    14982    1   DCL ITIME UBIN(32);
      224    14983    1   DCL STT$ PTR;
      225    14984           %KH$CLK         ( FPTN = KH$SETCLK,
      226    14985                             FNC = %KH#CLK_SETCLK,
      227    14986                             STCLASS = AUTO );
      228    15135           %KH$CLK         ( FPTN = KH$CANCELCLK,
      229    15136                             FNC = %KH#CLK_CANCEL,
      230    15137                             STCLASS = AUTO );
      231    15286
      232    15287        /**/
      233    15288    1         CALL KHC$XEQ2 (OTIME);
      234    15289    1         IF BITBIN(G$UHJIT.ISA_USR.DEV) < KH_CHNLOW  OR
      235    15290    1            BITBIN(G$UHJIT.ISA_USR.DEV) > KH_CHNHI THEN
      236    15291    1            GOTO RETURN_;
      237    15292
      238    15293    1         CHAN = BITBIN(BINBIT(BITBIN(G$UHJIT.ISA_USR.DEV), 16)) / 128;
      239    15294
      240    15295    1         CHN$ = PINCRW (KH_CHNLOW$, SIZEW(KH$CHN)*CHANS );
      241    15296
      242    15297    1         CTX$ = CHN$ -> KH$CHN.CTX$;
      243    15298    1         IF ( G$JIT.SYSID ~= CHN$ -> KH$CHN.SYSID ) THEN
      244    15299        /* This channel does not belong to BISYNC  */
      245    15300    1            GOTO RETURN_;
      246    15301    1         IF CTX$ = ADDR(NIL) THEN GOTO RETURN_; /* LINE IS GONE; IGNORE              */
      247    15302        /**/
      248    15303    1         PROTYP = CTX$ -> KZ$LINCTX.PRO.PROTYP * 2 + BITBIN(CTX$ -> KZ$LINCTX.PRO.SLAVE
             15303                  );
      249    15304    1         STT$ = KZ_HDR$(PROTYP) -> KZ$HDR.STTBFR$;
      250    15305        /**/
      251    15306    1         IF CTX$->KZ$LINCTX.PRMCTBTYP~=0 AND
      252    15307    2            CTX$->KZ$LINCTX.CTB.PRM$~=ADDR(NIL) THEN DO;
      253    15308    2            KH$CANCELCLK = KH_CANCELCLK;
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:30   
      254    15309    2            KH$CANCELCLK.CTBCTX$ = CTX$ -> KZ$LINCTX.CTB.PRM$;
      255    15310    2            CTX$ -> KZ$LINCTX.CTB.PRM$ = ADDR(NIL);
      256    15311    2            CALL KHC$CLOCK (KH$CANCELCLK);
      257    15312    2            END;
      258    15313        /**/
      259    15314    2         IF CTX$ -> KZ$LINCTX.FLAGS.DFRINP THEN DO;
      260    15315    2            CALL KZO$EVENT ( CTX$ -> KZ$LINCTX, EVENT, SIZE );
      261    15316    2            CALL KZP$DRIVER ( CTX$ -> KZ$LINCTX, EVENT, SIZE );
      262    15317    2            END;
      263    15318    2         ELSE DO;
      264    15319    2            CTX$ -> KZ$LINCTX.FLAGS.DFRINP = '1'B;
      265    15320    3            IF CTX$ -> KZ$LINCTX.FLAGS.SETCLK THEN DO;
      266    15321    3               KH$SETCLK = KH_SETCLK;
      267    15322    3               IF CTX$ -> KZ$LINCTX.TIMOUT.USESEC THEN
      268    15323    3                  KH$SETCLK.PRD = CTX$ -> KZ$LINCTX.TIMOUT.SECONDARY;
      269    15324    3               ELSE
      270    15325    3                  KH$SETCLK.PRD = CTX$ -> KZ$LINCTX.TIMOUT.PRIMARY;
      271    15326    3               KH$SETCLK.UID$ = CTX$;
      272    15327    3               KH$SETCLK.SBR$ = ENTADDR(KZC$INPCLK);
      273    15328    3               KH$SETCLK.CTBCTX$ = ADDR(NIL);
      274    15329    3               CALL KHC$CLOCK (KH$SETCLK);
      275    15330    3               CTX$ -> KZ$LINCTX.CTB.PRM$ = KH$SETCLK.CTBCTX$;
      276    15331    3               CTX$ -> KZ$LINCTX.PRMCTBTYP = %KZ#CTBTYP_INP;
      277    15332    3               END;
      278    15333    2            END;
      279    15334        /**/
      280    15335        /*
      281    15336           Each interrupt causes the Common Interrupt Handler to zero the
      282    15337           Watch Dog Timer.  If the current interrupt is interrupted by a
      283    15338           higher priority interrupt, the low priority interrupt's WDT value
      284    15339           is saved in the ISA and re-stored upon re-entry (hence it is a
      285    15340           valid execution time).  Since the WDT is 16 bits, and thus turns
      286    15341           over about every 9 minutes, we are assuming here that our inter-
      287    15342           rupts will be processed in < 9 minutes.  Remember to subtract the
      288    15343           WDT value because it counts down from 0.
      289    15344                                                                          */
      290    15345    2         IF STT$ ~= ADDR(NIL) THEN DO;
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:31   
      291    15346    2            CALL KHC$DLTXEQ2 (OTIME);
      292    15347    2            KZ$BSCSTT.KHSTT.OTPINTISATIM = KZ$BSCSTT.KHSTT.OTPINTISATIM + OTIME;
      293    15348    2            KZ$BSCSTT.KHSTT.OTPINTCNT = KZ$BSCSTT.KHSTT.OTPINTCNT + 1;
      294    15349    2            END;
      295    15350    1   RETURN_:;
      296    15351    1         CALL X6A_INTRET ( FPT_INTRET );
      297    15352        %EJECT;
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:32   
      298    15353        /*F*     NAME:     KZN$INPCMP
      299    15354                 PURPOSE:  KZN$INPCMP fields input complete interrupts.  If
      300    15355                           the input interrupt occurs after the output one,
      301    15356                           it cancels any in-progress tinmeout clock, calls
      302    15357                           KZO$EVENT to figure out what was received, and then
      303    15358                           calls KZP$DRIVER to report that event.          */
      304    15359
      305    15360    1   KZN$INPCMP: ENTRY ASYNC;
      306    15361    1         CALL KHC$XEQ2 (ITIME);
      307    15362        /**/
      308    15363    1         IF BITBIN(G$UHJIT.ISA_USR.DEV) < KH_CHNLOW  OR
      309    15364    1            BITBIN(G$UHJIT.ISA_USR.DEV) > KH_CHNHI THEN
      310    15365    1            GOTO RETURN_;
      311    15366
      312    15367    1         CHAN = BITBIN(BINBIT(BITBIN(G$UHJIT.ISA_USR.DEV), 16)) / 128;
      313    15368
      314    15369    1         CHN$ = PINCRW (KH_CHNLOW$, SIZEW(KH$CHN)*CHANS );
      315    15370
      316    15371    1         CTX$ = CHN$ -> KH$CHN.CTX$;
      317    15372    1         IF ( G$JIT.SYSID ~= CHN$ -> KH$CHN.SYSID ) THEN
      318    15373        /* This channel does not belong to BISYNC */
      319    15374    1            GOTO RETURN_;
      320    15375    1         IF CTX$ = ADDR(NIL) THEN GOTO RETURN_; /* LINE IS GONE; IGNORE              */
      321    15376
      322    15377    1         PROTYP = CTX$ -> KZ$LINCTX.PRO.PROTYP * 2 + BITBIN(CTX$ -> KZ$LINCTX.PRO.SLAVE
             15377                  );
      323    15378    1         STT$ = KZ_HDR$(PROTYP) -> KZ$HDR.STTBFR$;
      324    15379
      325    15380        /**/
      326    15381    2         IF CTX$ -> KZ$LINCTX.FLAGS.DFRINP = '0'B THEN DO;
      327    15382        /**/
      328    15383        /*
      329    15384            Need to wait on output complete.. Let's just suspend for now.
      330    15385        */
      331    15386        /**/
      332    15387    2            CTX$ -> KZ$LINCTX.FLAGS.DFRINP = '1'B;
      333    15388    2            END;
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:33   
      334    15389    2         ELSE DO;
      335    15390
      336    15391
      337    15392        /**/
      338    15393        /*
      339    15394            Time to call the line driver if we get this far.
      340    15395        */
      341    15396        /**/
      342    15397
      343    15398    3            IF CTX$ -> KZ$LINCTX.CTB.PRM$ ~= ADDR(NIL) THEN DO;
      344    15399    3               KH$CANCELCLK = KH_CANCELCLK;
      345    15400    3               KH$CANCELCLK.CTBCTX$ = CTX$ -> KZ$LINCTX.CTB.PRM$;
      346    15401    3               CTX$ -> KZ$LINCTX.CTB.PRM$ = ADDR(NIL);
      347    15402    3               CALL KHC$CLOCK (KH$CANCELCLK);
      348    15403    3               END;
      349    15404    2            CALL KZO$EVENT ( CTX$ -> KZ$LINCTX, EVENT, SIZE );
      350    15405    2            CALL KZP$DRIVER ( CTX$ -> KZ$LINCTX, EVENT, SIZE );
      351    15406    2            END;
      352    15407
      353    15408    2         IF STT$ ~= ADDR(NIL) THEN DO;
      354    15409    2            CALL KHC$DLTXEQ2 (ITIME);
      355    15410    2            KZ$BSCSTT.TRNSCT = KZ$BSCSTT.TRNSCT + 1;
      356    15411    2            KZ$BSCSTT.KHSTT.INPINTISATIM = KZ$BSCSTT.KHSTT.INPINTISATIM + ITIME;
      357    15412    2            KZ$BSCSTT.KHSTT.INPINTCNT = KZ$BSCSTT.KHSTT.INPINTCNT + 1;
      358    15413    2            END;
      359    15414    1         CALL X6A_INTRET ( FPT_INTRET );
      360    15415
      361    15416    1   END KZN$OTPCMP;

PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:34   
--  Include file information  --

   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KZ_INIT_C.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   KZ_CLMEVT_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   G_HJIT_M.:E05TOU  is referenced.
   GH_HARDWARE_M.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KZN$OTPCMP.

   Procedure KZN$OTPCMP requires 477 words for executable code.
   Procedure KZN$OTPCMP requires 44 words of local(AUTO) storage.

    No errors detected in file KZN$INT.:E05TSI    .
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:35   

PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:36   

 Object Unit name= KZN$OTPCMP                                 File name= KZN$INT.:E05TOU
 UTS= JUL 30 '97 02:57:50.40 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     26     1A  KZN$OTPCMP
    1   Proc  even  none   477    1DD  KZN$OTPCMP
    2  RoData even  none     2      2  KZN$OTPCMP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes     Async       0  KZN$OTPCMP
     1    10F                  yes     Async       0  KZN$INPCMP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KHC$XEQ2
 yes     yes           Std       1 KHC$CLOCK
         yes           Std       3 KZP$DRIVER
         yes           Std       1 KZC$INPCLK
 yes     yes           Std       1 KHC$DLTXEQ2
         yes           Std       3 KZO$EVENT
         yes           Std       1 X6A_INTRET
                       nStd      0 X6A_AAUTO
                       nStd      0 X6A_AARET
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:37   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNLOW$                       r    KH_CHNHI                         r    KH_CHNLOW
     G$JIT$                                G$UHJIT$                              G$LOW_MEM$
     KZ_HDR$                          r    G$ROS$
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:38   


      144        1        /*T***********************************************************/
      145        2        /*T*                                                         */
      146        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      147        4        /*T*                                                         */
      148        5        /*T***********************************************************/
      149        6        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC */
      150        7        /*F*     NAME:     KZN$OTPCMP
      151        8                 PURPOSE:  KZN$OTPCMP fields output complete interrupts. It
      152        9                           cancels any in-progress timeout clock. If
      153       10                           the output interrupt occurs first and clocks are
      154       11                           being used, it starts a receive-timeout clock.
      155       12                           If the output interrupt occurs after the input
      156       13                           interrupt, it calls KZO$EVENT to figure out what
      157       14                           was received and then calls KZP$DRIVER to report
      158       15                           that event.                                     */
      159       16
      160       17        KZN$OTPCMP: PROC ASYNC;

     17   1 000000  D380 0000 0000  xent KZN$OTPCMP      LNJ,B5   X6A_AAUTO
          1 000003       002C 0000                       DC       44,0

      161       18
      162       19        %INCLUDE LCP_6;
      163     4298        %INCLUDE KL_MACRO_C;
      164     7650        %INCLUDE KL_AFCN_C;
      165     7751        %INCLUDE K_ID_E;
      166     7801        %K#ENTID_E;
      167     7820        %K#LYRID_E;
      168     7827        %INCLUDE GH_HARDWARE_M;
      169     7925        %INCLUDE G_HJIT_M;
      170     8070        %INCLUDE G_JIT_M;
      171     8335        %INCLUDE KH$CHN;
      172     8457        %INCLUDE KH_CHN;
      173     8497        %INCLUDE KZ$LINCTX;
      174     9117        %INCLUDE KZ_CLM_E;
      175     9289        %INCLUDE KZ_CLMEVT_C;
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:39   
      176     9331        %INCLUDE KZ$BSCSTT;
      177     9437        %INCLUDE KH$STT;
      178     9467        %INCLUDE KZ_INIT_C;
      179     9803        %INCLUDE KH$CLK;
      180    10173        %INCLUDE KH_CLKFNC_E;
      181    10218
      182    10219           %KH$CHN         ( STCLASS = "BASED(CHN$)" );
      183    10343           %KH_CHNDAT;
      184    10361           %G$JIT(STCLASS="BASED(G$JIT$)");
      185    10775    1   DCL G$JIT$ PTR SYMREF;
      186    10776    1   DCL G$UHJIT$ PTR SYMREF;
      187    10777           %G$UHJIT        ( STCLASS = "BASED(G$UHJIT$)" );
      188    13751           %FPT_INTRET (WAKEME=YES,STCLASS=CONSTANT);
      189    13771    1   DCL G$LOW_MEM$ PTR SYMREF;
      190    13772           %G$LOW_MEM  (STCLASS = "BASED(G$LOW_MEM$)");
      191    13821           %KH$CLK         ( FPTN = KH_SETCLK,
      192    13822                             FNC = %KH#CLK_SETCLK,
      193    13823                             PRDUNT = %KH#C_SEC,
      194    13824                             ACCURACY = 0,
      195    13825                             STCLASS = CONSTANT );
      196    13974           %KH$CLK         ( FPTN = KH_CANCELCLK,
      197    13975                             FNC = %KH#CLK_CANCEL,
      198    13976                             STCLASS = CONSTANT );
      199    14125           %KZ$BSCSTT     ( STCLASS = "BASED(STT$)" );
      200    14506           %KZ_INIT_HDR    ( NAME = KZ$HDR,
      201    14507                             STCLASS = BASED );
      202    14531            %KZ$LINCTX;
      203    14962
      204    14963
      205    14964
      206    14965    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
      207    14966    1   DCL KHC$XEQ2 ENTRY(1) ALTRET;
      208    14967    1   DCL KHC$DLTXEQ2 ENTRY(1) ALTRET;
      209    14968    1   DCL KZC$INPCLK ENTRY(1);
      210    14969    1   DCL KZO$EVENT ENTRY(3);
      211    14970    1   DCL KZP$DRIVER ENTRY(3);
      212    14971    1   DCL X6A_INTRET ENTRY (1);
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:40   
      213    14972    1   DCL KZ_HDR$(0:0) PTR SYMREF;
      214    14973
      215    14974    1   DCL CHN$ PTR;
      216    14975    1   DCL CTX$ PTR;
      217    14976    1   DCL CHAN UBIN WORD;
      218    14977    1   DCL CHANS REDEF CHAN SBIN WORD;
      219    14978    1   DCL SIZE UBIN WORD;
      220    14979    1   DCL EVENT UBIN WORD;
      221    14980    1   DCL PROTYP UBIN WORD;
      222    14981    1   DCL OTIME UBIN(32);
      223    14982    1   DCL ITIME UBIN(32);
      224    14983    1   DCL STT$ PTR;
      225    14984           %KH$CLK         ( FPTN = KH$SETCLK,
      226    14985                             FNC = %KH#CLK_SETCLK,
      227    14986                             STCLASS = AUTO );
      228    15135           %KH$CLK         ( FPTN = KH$CANCELCLK,
      229    15136                             FNC = %KH#CLK_CANCEL,
      230    15137                             STCLASS = AUTO );
      231    15286
      232    15287        /**/
      233    15288    1         CALL KHC$XEQ2 (OTIME);

  15288   1 000005  EBC7 000C                            LAB,B6   OTIME,AUTO
          1 000007  EFC7 0026                            STB,B6   KH$CANCELCLK+9,AUTO
          1 000009  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 00000B  CBF0 0100                            LAB,B4   256,IMO
          1 00000D  E380 0000 0000  xent                 LNJ,B6   KHC$XEQ2
          1 000010       0001                            DC       s:15289,PREL

      234    15289    1         IF BITBIN(G$UHJIT.ISA_USR.DEV) < KH_CHNLOW  OR

  15289   1 000011  EC80 0000 0000  xsym                 LDB,B6   G$UHJIT$
          1 000014  E846 0081                            LDR,R6   129,B6
          1 000016  E900 0000 0000  xsym                 CMR,R6   KH_CHNLOW
          1 000019  0201 00EA                            BL       s:15349,PREL
          1 00001B  E900 0000 0000  xsym                 CMR,R6   KH_CHNHI
          1 00001E  0301 00E5                            BG       s:15349,PREL
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:41   

      235    15290    1            BITBIN(G$UHJIT.ISA_USR.DEV) > KH_CHNHI THEN
      236    15291    1            GOTO RETURN_;
      237    15292
      238    15293    1         CHAN = BITBIN(BINBIT(BITBIN(G$UHJIT.ISA_USR.DEV), 16)) / 128;

  15293   1 000020  6047                                 SOR,R6   7
          1 000021  EF47 0008                            STR,R6   CHAN,AUTO

      239    15294
      240    15295    1         CHN$ = PINCRW (KH_CHNLOW$, SIZEW(KH$CHN)*CHANS );

  15295   1 000023  E847 0008                            LDR,R6   CHAN,AUTO
          1 000025  70F0                                 DAR,R7   16
          1 000026  7085                                 DOL,R7   5
          1 000027  8400 0000 0000  xsym                 AID      KH_CHNLOW$
          1 00002A  8D47 0004                            SDI      CHN$,AUTO

      241    15296
      242    15297    1         CTX$ = CHN$ -> KH$CHN.CTX$;

  15297   1 00002C  DCC7 0004                            LDB,B5   CHN$,AUTO
          1 00002E  CCC5 000C                            LDB,B4   12,B5
          1 000030  CFC7 0006                            STB,B4   CTX$,AUTO

      243    15298    1         IF ( G$JIT.SYSID ~= CHN$ -> KH$CHN.SYSID ) THEN

  15298   1 000032  BC80 0000 0000  xsym                 LDB,B3   G$JIT$
          1 000035  D843 0005                            LDR,R5   5,B3
          1 000037  D945 0006                            CMR,R5   6,B5
          1 000039  0981 00CA                            BNE      s:15349,PREL

      244    15299        /* This channel does not belong to BISYNC  */
      245    15300    1            GOTO RETURN_;
      246    15301    1         IF CTX$ = ADDR(NIL) THEN GOTO RETURN_; /* LINE IS GONE; IGNORE             */

  15301   1 00003B  8DC7 0006                            CMN      CTX$,AUTO
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:42   
          1 00003D  0901 00C6                            BE       s:15349,PREL

      247    15302        /**/
      248    15303    1        PROTYP = CTX$ -> KZ$LINCTX.PRO.PROTYP * 2 + BITBIN(CTX$ -> KZ$LINCTX.PRO.SLAVE
             15303                  );

  15303   1 00003F  C844 004B                            LDR,R4   75,B4
          1 000041  404F                                 SOR,R4   15
          1 000042  B844 003A                            LDR,R3   58,B4
          1 000044  3001                                 SOL,R3   1
          1 000045  BA54                                 ADD,R3   R4
          1 000046  BF47 000B                            STR,R3   PROTYP,AUTO

      249    15304    1         STT$ = KZ_HDR$(PROTYP) -> KZ$HDR.STTBFR$;

  15304   1 000048  ACB0 0000 0000  xsym                 LDB,B2   KZ_HDR$,R3
          1 00004B  9CC2 0006                            LDB,B1   6,B2
          1 00004D  9FC7 0010                            STB,B1   STT$,AUTO

      250    15305        /**/
      251    15306    1         IF CTX$->KZ$LINCTX.PRMCTBTYP~=0 AND

  15306   1 00004F  82C4 000C                            LB,'00FF'X        12,B4
  15306   1 000051       00FF
          1 000052  0581 0024                            BBF      s:15314,PREL
          1 000054  8DC4 0031                            CMN      49,B4
          1 000056  0901 0020                            BE       s:15314,PREL

      252    15307    2            CTX$->KZ$LINCTX.CTB.PRM$~=ADDR(NIL) THEN DO;

      253    15308    2            KH$CANCELCLK = KH_CANCELCLK;

  15308   1 000058  AB80 0000 0000  00                   LAB,B2   FPT_INTRET
          1 00005B  2C24                                 LDV,R2   36
          1 00005C  6C10                                 LDV,R6   16
          1 00005D  BB87                                 LAB,B3   ,AUTO
          1 00005E  3C3A                                 LDV,R3   58
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:43   
          1 00005F  0008                                 MMM

      254    15309    2            KH$CANCELCLK.CTBCTX$ = CTX$ -> KZ$LINCTX.CTB.PRM$;

  15309   1 000060  ECC7 0006                            LDB,B6   CTX$,AUTO
          1 000062  DCC6 0031                            LDB,B5   49,B6
          1 000064  DFC7 001D                            STB,B5   KH$CANCELCLK,AUTO

      255    15310    2            CTX$ -> KZ$LINCTX.CTB.PRM$ = ADDR(NIL);

  15310   1 000066  CB80 0000 0000                       LAB,B4   0
          1 000069  CFC6 0031                            STB,B4   49,B6

      256    15311    2            CALL KHC$CLOCK (KH$CANCELCLK);

  15311   1 00006B  ABC7 001D                            LAB,B2   KH$CANCELCLK,AUTO
          1 00006D  AFC7 0026                            STB,B2   KH$CANCELCLK+9,AUTO
          1 00006F  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 000071  CBF0 0100                            LAB,B4   256,IMO
          1 000073  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 000076       0001                            DC       s:15314,PREL

      257    15312    2            END;

      258    15313        /**/
      259    15314    2         IF CTX$ -> KZ$LINCTX.FLAGS.DFRINP THEN DO;

  15314   1 000077  ECC7 0006                            LDB,B6   CTX$,AUTO
          1 000079  82C6 0034                            LB,'0200'X        52,B6
          1 00007B       0200
          1 00007C  0581 0029                            BBF      s:15319,PREL

      260    15315    2            CALL KZO$EVENT ( CTX$ -> KZ$LINCTX, EVENT, SIZE );

  15315   1 00007E  DBC7 0009                            LAB,B5   SIZE,AUTO
          1 000080  DFC7 002A                            STB,B5   KH$CANCELCLK+13,AUTO
          1 000082  CBC7 000A                            LAB,B4   EVENT,AUTO
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:44   
          1 000084  CFC7 0028                            STB,B4   KH$CANCELCLK+11,AUTO
          1 000086  EFC7 0026                            STB,B6   KH$CANCELCLK+9,AUTO
          1 000088  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 00008A  CBF0 0300                            LAB,B4   768,IMO
          1 00008C  E380 0000 0000  xent                 LNJ,B6   KZO$EVENT
          1 00008F       0001                            DC       s:15316,PREL

      261    15316    2            CALL KZP$DRIVER ( CTX$ -> KZ$LINCTX, EVENT, SIZE );

  15316   1 000090  EBC7 0009                            LAB,B6   SIZE,AUTO
          1 000092  EFC7 002A                            STB,B6   KH$CANCELCLK+13,AUTO
          1 000094  DBC7 000A                            LAB,B5   EVENT,AUTO
          1 000096  DFC7 0028                            STB,B5   KH$CANCELCLK+11,AUTO
          1 000098  CCC7 0006                            LDB,B4   CTX$,AUTO
          1 00009A  CFC7 0026                            STB,B4   KH$CANCELCLK+9,AUTO
          1 00009C  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 00009E  CBF0 0300                            LAB,B4   768,IMO
          1 0000A0  E380 0000 0000  xent                 LNJ,B6   KZP$DRIVER
          1 0000A3       0001                            DC       s:15317,PREL

      262    15317    2            END;

  15317   1 0000A4  0F81 0043                            B        s:15345,PREL

      263    15318    2         ELSE DO;

      264    15319    2            CTX$ -> KZ$LINCTX.FLAGS.DFRINP = '1'B;

  15319   1 0000A6  8946 0034                            LBT,'0200'X       52,B6
  15319   1 0000A8       0200

      265    15320    3            IF CTX$ -> KZ$LINCTX.FLAGS.SETCLK THEN DO;

  15320   1 0000A9  82C6 0034                            LB,'0020'X        52,B6
  15320   1 0000AB       0020
          1 0000AC  0581 003B                            BBF      s:15345,PREL

PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:45   
      266    15321    3               KH$SETCLK = KH_SETCLK;

  15321   1 0000AE  AB80 0000 0000  00                   LAB,B2   FPT_INTRET
          1 0000B1  2C0E                                 LDV,R2   14
          1 0000B2  6C16                                 LDV,R6   22
          1 0000B3  BB87                                 LAB,B3   ,AUTO
          1 0000B4  3C24                                 LDV,R3   36
          1 0000B5  0008                                 MMM

      267    15322    3               IF CTX$ -> KZ$LINCTX.TIMOUT.USESEC THEN

  15322   1 0000B6  ECC7 0006                            LDB,B6   CTX$,AUTO
          1 0000B8  89C6 0088                            CMZ      136,B6
          1 0000BA  0881 0007                            BAGE     s:15325,PREL

      268    15323    3                  KH$SETCLK.PRD = CTX$ -> KZ$LINCTX.TIMOUT.SECONDARY;

  15323   1 0000BC  E846 0087                            LDR,R6   135,B6
          1 0000BE  EF47 001C                            STR,R6   KH$SETCLK+10,AUTO
          1 0000C0  0F81 0005                            B        s:15326,PREL

      269    15324    3               ELSE
      270    15325    3                  KH$SETCLK.PRD = CTX$ -> KZ$LINCTX.TIMOUT.PRIMARY;

  15325   1 0000C2  E846 0086                            LDR,R6   134,B6
          1 0000C4  EF47 001C                            STR,R6   KH$SETCLK+10,AUTO

      271    15326    3               KH$SETCLK.UID$ = CTX$;

  15326   1 0000C6  EFC7 0014                            STB,B6   KH$SETCLK+2,AUTO

      272    15327    3               KH$SETCLK.SBR$ = ENTADDR(KZC$INPCLK);

  15327   1 0000C8  DB80 0000 0000  xent                 LAB,B5   KZC$INPCLK
          1 0000CB  DFC7 001A                            STB,B5   KH$SETCLK+8,AUTO

      273    15328    3               KH$SETCLK.CTBCTX$ = ADDR(NIL);
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:46   

  15328   1 0000CD  CB80 0000 0000                       LAB,B4   0
          1 0000D0  CFC7 0012                            STB,B4   KH$SETCLK,AUTO

      274    15329    3               CALL KHC$CLOCK (KH$SETCLK);

  15329   1 0000D2  ABC7 0012                            LAB,B2   KH$SETCLK,AUTO
          1 0000D4  AFC7 0026                            STB,B2   KH$CANCELCLK+9,AUTO
          1 0000D6  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 0000D8  CBF0 0100                            LAB,B4   256,IMO
          1 0000DA  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 0000DD       0001                            DC       s:15330,PREL

      275    15330    3               CTX$ -> KZ$LINCTX.CTB.PRM$ = KH$SETCLK.CTBCTX$;

  15330   1 0000DE  ECC7 0012                            LDB,B6   KH$SETCLK,AUTO
          1 0000E0  DCC7 0006                            LDB,B5   CTX$,AUTO
          1 0000E2  EFC5 0031                            STB,B6   49,B5

      276    15331    3               CTX$ -> KZ$LINCTX.PRMCTBTYP = %KZ#CTBTYP_INP;

  15331   1 0000E4  6C01                                 LDV,R6   1
          1 0000E5  EAC5 000C                            SRM,R6,'00FF'X    12,B5
          1 0000E7       00FF

      277    15332    3               END;

      278    15333    2            END;

      279    15334        /**/
      280    15335        /*
      281    15336           Each interrupt causes the Common Interrupt Handler to zero the
      282    15337           Watch Dog Timer.  If the current interrupt is interrupted by a
      283    15338           higher priority interrupt, the low priority interrupt's WDT value
      284    15339           is saved in the ISA and re-stored upon re-entry (hence it is a
      285    15340           valid execution time).  Since the WDT is 16 bits, and thus turns
      286    15341           over about every 9 minutes, we are assuming here that our inter-
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:47   
      287    15342           rupts will be processed in < 9 minutes.  Remember to subtract the
      288    15343           WDT value because it counts down from 0.
      289    15344                                                                          */
      290    15345    2         IF STT$ ~= ADDR(NIL) THEN DO;

  15345   1 0000E8  8DC7 0010                            CMN      STT$,AUTO
          1 0000EA  0901 0019                            BE       s:15349,PREL

      291    15346    2            CALL KHC$DLTXEQ2 (OTIME);

  15346   1 0000EC  EBC7 000C                            LAB,B6   OTIME,AUTO
          1 0000EE  EFC7 0026                            STB,B6   KH$CANCELCLK+9,AUTO
          1 0000F0  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 0000F2  CBF0 0100                            LAB,B4   256,IMO
          1 0000F4  E380 0000 0000  xent                 LNJ,B6   KHC$DLTXEQ2
          1 0000F7       0001                            DC       s:15347,PREL

      292    15347    2            KZ$BSCSTT.KHSTT.OTPINTISATIM = KZ$BSCSTT.KHSTT.OTPINTISATIM + OTIME;

  15347   1 0000F8  ECC7 0010                            LDB,B6   STT$,AUTO
          1 0000FA  8CC6 001A                            LDI      26,B6
          1 0000FC  8447 000C                            AID      OTIME,AUTO
          1 0000FE  8D46 001A                            SDI      26,B6

      293    15348    2            KZ$BSCSTT.KHSTT.OTPINTCNT = KZ$BSCSTT.KHSTT.OTPINTCNT + 1;

  15348   1 000100  8AC6 0017                            INC      23,B6
          1 000102  8EC6 0016                            CAD      22,B6

      294    15349    2            END;

  15345   1                              RETURN_         null
      295    15350    1   RETURN_:;
      296    15351    1         CALL X6A_INTRET ( FPT_INTRET );

  15351   1 000104  BB80 0000 0000  02   RETURN_         LAB,B3   0
          1 000107  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:48   
          1 000109  E380 0000 0000  xent                 LNJ,B6   X6A_INTRET
          1 00010C       0001                            DC       s:15349+9,PREL
          1 00010D  0F81 0006                            B        s:15361,PREL

      297    15352        %EJECT;
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:49   
      298    15353        /*F*     NAME:     KZN$INPCMP
      299    15354                 PURPOSE:  KZN$INPCMP fields input complete interrupts.  If
      300    15355                           the input interrupt occurs after the output one,
      301    15356                           it cancels any in-progress tinmeout clock, calls
      302    15357                           KZO$EVENT to figure out what was received, and then
      303    15358                           calls KZP$DRIVER to report that event.          */
      304    15359
      305    15360    1   KZN$INPCMP: ENTRY ASYNC;

  15360   1 00010F  D380 0000 0000  xent KZN$INPCMP      LNJ,B5   X6A_AAUTO
          1 000112       002C 0000                       DC       44,0

      306    15361    1         CALL KHC$XEQ2 (ITIME);

  15361   1 000114  EBC7 000E                            LAB,B6   ITIME,AUTO
          1 000116  EFC7 0026                            STB,B6   KH$CANCELCLK+9,AUTO
          1 000118  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 00011A  CBF0 0100                            LAB,B4   256,IMO
          1 00011C  E380 0000 0000  xent                 LNJ,B6   KHC$XEQ2
          1 00011F       0001                            DC       s:15363,PREL

      307    15362        /**/
      308    15363    1         IF BITBIN(G$UHJIT.ISA_USR.DEV) < KH_CHNLOW  OR

  15363   1 000120  EC80 0000 0000  xsym                 LDB,B6   G$UHJIT$
          1 000123  E846 0081                            LDR,R6   129,B6
          1 000125  E900 0000 0000  xsym                 CMR,R6   KH_CHNLOW
          1 000128  025C                                 BL       s:15349,SPREL
          1 000129  E900 0000 0000  xsym                 CMR,R6   KH_CHNHI
          1 00012C  0358                                 BG       s:15349,SPREL

      309    15364    1            BITBIN(G$UHJIT.ISA_USR.DEV) > KH_CHNHI THEN
      310    15365    1            GOTO RETURN_;
      311    15366
      312    15367    1         CHAN = BITBIN(BINBIT(BITBIN(G$UHJIT.ISA_USR.DEV), 16)) / 128;

  15367   1 00012D  6047                                 SOR,R6   7
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:50   
          1 00012E  EF47 0008                            STR,R6   CHAN,AUTO

      313    15368
      314    15369    1         CHN$ = PINCRW (KH_CHNLOW$, SIZEW(KH$CHN)*CHANS );

  15369   1 000130  E847 0008                            LDR,R6   CHAN,AUTO
          1 000132  70F0                                 DAR,R7   16
          1 000133  7085                                 DOL,R7   5
          1 000134  8400 0000 0000  xsym                 AID      KH_CHNLOW$
          1 000137  8D47 0004                            SDI      CHN$,AUTO

      315    15370
      316    15371    1         CTX$ = CHN$ -> KH$CHN.CTX$;

  15371   1 000139  DCC7 0004                            LDB,B5   CHN$,AUTO
          1 00013B  CCC5 000C                            LDB,B4   12,B5
          1 00013D  CFC7 0006                            STB,B4   CTX$,AUTO

      317    15372    1         IF ( G$JIT.SYSID ~= CHN$ -> KH$CHN.SYSID ) THEN

  15372   1 00013F  BC80 0000 0000  xsym                 LDB,B3   G$JIT$
          1 000142  D843 0005                            LDR,R5   5,B3
          1 000144  D945 0006                            CMR,R5   6,B5
          1 000146  0981 FFBD                            BNE      s:15349,PREL

      318    15373        /* This channel does not belong to BISYNC */
      319    15374    1            GOTO RETURN_;
      320    15375    1         IF CTX$ = ADDR(NIL) THEN GOTO RETURN_; /* LINE IS GONE; IGNORE             */

  15375   1 000148  8DC7 0006                            CMN      CTX$,AUTO
          1 00014A  0901 FFB9                            BE       s:15349,PREL

      321    15376
      322    15377    1        PROTYP = CTX$ -> KZ$LINCTX.PRO.PROTYP * 2 + BITBIN(CTX$ -> KZ$LINCTX.PRO.SLAVE
             15377                  );

  15377   1 00014C  C844 004B                            LDR,R4   75,B4
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:51   
          1 00014E  404F                                 SOR,R4   15
          1 00014F  B844 003A                            LDR,R3   58,B4
          1 000151  3001                                 SOL,R3   1
          1 000152  BA54                                 ADD,R3   R4
          1 000153  BF47 000B                            STR,R3   PROTYP,AUTO

      323    15378    1         STT$ = KZ_HDR$(PROTYP) -> KZ$HDR.STTBFR$;

  15378   1 000155  ACB0 0000 0000  xsym                 LDB,B2   KZ_HDR$,R3
          1 000158  9CC2 0006                            LDB,B1   6,B2
          1 00015A  9FC7 0010                            STB,B1   STT$,AUTO

      324    15379
      325    15380        /**/
      326    15381    2         IF CTX$ -> KZ$LINCTX.FLAGS.DFRINP = '0'B THEN DO;

  15381   1 00015C  82C4 0034                            LB,'0200'X        52,B4
  15381   1 00015E       0200
          1 00015F  0501 0006                            BBT      s:15398,PREL

      327    15382        /**/
      328    15383        /*
      329    15384            Need to wait on output complete.. Let's just suspend for now.
      330    15385        */
      331    15386        /**/
      332    15387    2            CTX$ -> KZ$LINCTX.FLAGS.DFRINP = '1'B;

  15387   1 000161  8944 0034                            LBT,'0200'X       52,B4
  15387   1 000163       0200

      333    15388    2            END;

  15388   1 000164  0F81 004C                            B        s:15408,PREL

      334    15389    2         ELSE DO;

      335    15390
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:52   
      336    15391
      337    15392        /**/
      338    15393        /*
      339    15394            Time to call the line driver if we get this far.
      340    15395        */
      341    15396        /**/
      342    15397
      343    15398    3            IF CTX$ -> KZ$LINCTX.CTB.PRM$ ~= ADDR(NIL) THEN DO;

  15398   1 000166  8DC4 0031                            CMN      49,B4
          1 000168  0901 0020                            BE       s:15404,PREL

      344    15399    3               KH$CANCELCLK = KH_CANCELCLK;

  15399   1 00016A  AB80 0000 0000  00                   LAB,B2   FPT_INTRET
          1 00016D  2C24                                 LDV,R2   36
          1 00016E  6C10                                 LDV,R6   16
          1 00016F  BB87                                 LAB,B3   ,AUTO
          1 000170  3C3A                                 LDV,R3   58
          1 000171  0008                                 MMM

      345    15400    3               KH$CANCELCLK.CTBCTX$ = CTX$ -> KZ$LINCTX.CTB.PRM$;

  15400   1 000172  ECC7 0006                            LDB,B6   CTX$,AUTO
          1 000174  DCC6 0031                            LDB,B5   49,B6
          1 000176  DFC7 001D                            STB,B5   KH$CANCELCLK,AUTO

      346    15401    3               CTX$ -> KZ$LINCTX.CTB.PRM$ = ADDR(NIL);

  15401   1 000178  CB80 0000 0000                       LAB,B4   0
          1 00017B  CFC6 0031                            STB,B4   49,B6

      347    15402    3               CALL KHC$CLOCK (KH$CANCELCLK);

  15402   1 00017D  ABC7 001D                            LAB,B2   KH$CANCELCLK,AUTO
          1 00017F  AFC7 0026                            STB,B2   KH$CANCELCLK+9,AUTO
          1 000181  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:53   
          1 000183  CBF0 0100                            LAB,B4   256,IMO
          1 000185  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 000188       0001                            DC       s:15404,PREL

      348    15403    3               END;

      349    15404    2            CALL KZO$EVENT ( CTX$ -> KZ$LINCTX, EVENT, SIZE );

  15404   1 000189  EBC7 0009                            LAB,B6   SIZE,AUTO
          1 00018B  EFC7 002A                            STB,B6   KH$CANCELCLK+13,AUTO
          1 00018D  DBC7 000A                            LAB,B5   EVENT,AUTO
          1 00018F  DFC7 0028                            STB,B5   KH$CANCELCLK+11,AUTO
          1 000191  CCC7 0006                            LDB,B4   CTX$,AUTO
          1 000193  CFC7 0026                            STB,B4   KH$CANCELCLK+9,AUTO
          1 000195  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 000197  CBF0 0300                            LAB,B4   768,IMO
          1 000199  E380 0000 0000  xent                 LNJ,B6   KZO$EVENT
          1 00019C       0001                            DC       s:15405,PREL

      350    15405    2            CALL KZP$DRIVER ( CTX$ -> KZ$LINCTX, EVENT, SIZE );

  15405   1 00019D  EBC7 0009                            LAB,B6   SIZE,AUTO
          1 00019F  EFC7 002A                            STB,B6   KH$CANCELCLK+13,AUTO
          1 0001A1  DBC7 000A                            LAB,B5   EVENT,AUTO
          1 0001A3  DFC7 0028                            STB,B5   KH$CANCELCLK+11,AUTO
          1 0001A5  CCC7 0006                            LDB,B4   CTX$,AUTO
          1 0001A7  CFC7 0026                            STB,B4   KH$CANCELCLK+9,AUTO
          1 0001A9  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 0001AB  CBF0 0300                            LAB,B4   768,IMO
          1 0001AD  E380 0000 0000  xent                 LNJ,B6   KZP$DRIVER
          1 0001B0       0001                            DC       s:15408,PREL

      351    15406    2            END;

      352    15407
      353    15408    2         IF STT$ ~= ADDR(NIL) THEN DO;

PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:54   
  15408   1 0001B1  8DC7 0010                            CMN      STT$,AUTO
          1 0001B3  0901 001D                            BE       s:15414,PREL

      354    15409    2            CALL KHC$DLTXEQ2 (ITIME);

  15409   1 0001B5  EBC7 000E                            LAB,B6   ITIME,AUTO
          1 0001B7  EFC7 0026                            STB,B6   KH$CANCELCLK+9,AUTO
          1 0001B9  BBC7 0026                            LAB,B3   KH$CANCELCLK+9,AUTO
          1 0001BB  CBF0 0100                            LAB,B4   256,IMO
          1 0001BD  E380 0000 0000  xent                 LNJ,B6   KHC$DLTXEQ2
          1 0001C0       0001                            DC       s:15410,PREL

      355    15410    2            KZ$BSCSTT.TRNSCT = KZ$BSCSTT.TRNSCT + 1;

  15410   1 0001C1  ECC7 0010                            LDB,B6   STT$,AUTO
          1 0001C3  8AC6 002B                            INC      43,B6
          1 0001C5  8EC6 002A                            CAD      42,B6

      356    15411    2            KZ$BSCSTT.KHSTT.INPINTISATIM = KZ$BSCSTT.KHSTT.INPINTISATIM + ITIME;

  15411   1 0001C7  8CC6 0018                            LDI      24,B6
          1 0001C9  8447 000E                            AID      ITIME,AUTO
          1 0001CB  8D46 0018                            SDI      24,B6

      357    15412    2            KZ$BSCSTT.KHSTT.INPINTCNT = KZ$BSCSTT.KHSTT.INPINTCNT + 1;

  15412   1 0001CD  8AC6 0015                            INC      21,B6
          1 0001CF  8EC6 0014                            CAD      20,B6

      358    15413    2            END;

      359    15414    1         CALL X6A_INTRET ( FPT_INTRET );

  15414   1 0001D1  BB80 0000 0000  02                   LAB,B3   0
          1 0001D4  CBF0 0100                            LAB,B4   256,IMO
          1 0001D6  E380 0000 0000  xent                 LNJ,B6   X6A_INTRET
          1 0001D9       0001                            DC       s:15416,PREL
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:55   

      360    15415
      361    15416    1   END KZN$OTPCMP;

  15416   1 0001DA  C380 0000 0000  xent                 LNJ,B4   X6A_AARET

PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:56   
--  Include file information  --

   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KZ_INIT_C.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   KZ_CLMEVT_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   G_HJIT_M.:E05TOU  is referenced.
   GH_HARDWARE_M.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KZN$OTPCMP.
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:57   

 **** Variables and constants ****

  ****  Section 000 RoData KZN$OTPCMP

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(112)   r     1 FPT_INTRET                12-0-0/w STRC(128)   r     1 KH_CANCELCLK
     7-0-0/w STRC(176)   r     1 KH_SETCLK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     8-0-0/w UBIN(16)    r     1 CHAN                       8-0-0/w SBIN(16)    r     1 CHANS
     4-0-0/w PTR         r     1 CHN$                       6-0-0/w PTR         r     1 CTX$
     A-0-0/w UBIN(16)    r     1 EVENT                      E-0-0/w UBIN(32)    r     1 ITIME
    1D-0-0/w STRC(128)   r     1 KH$CANCELCLK              12-0-0/w STRC(176)   r     1 KH$SETCLK
     C-0-0/w UBIN(32)    r     1 OTIME                      B-0-0/w UBIN(16)    r     1 PROTYP
     9-0-0/w UBIN(16)    r     1 SIZE                      10-0-0/w PTR         r     1 STT$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$JIT$                     0-0-0/w PTR         r     1 G$LOW_MEM$
     0-0-0/w PTR         r     1 G$UHJIT$                   0-0-0/w UBIN(16)    r     1 KH_CHNHI
     0-0-0/w UBIN(16)    r     1 KH_CHNLOW                  0-0-0/w PTR         r     1 KH_CHNLOW$
     0-0-0/w PTR         r     1 KZ_HDR$(0:0)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:58   
     0-0-0/w STRC(5616)  r     1 G$JIT                      0-0-0/w STRC(6480)  r     1 G$UHJIT
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(2080)  r     1 KZ$BSCSTT
     0-0-0/w STRC(272)   r     1 KZ$HDR                     0-0-0/w STRC(2192)  r     1 KZ$LINCTX


   Procedure KZN$OTPCMP requires 477 words for executable code.
   Procedure KZN$OTPCMP requires 44 words of local(AUTO) storage.

    No errors detected in file KZN$INT.:E05TSI    .
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:59   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:60   
          MINI XREF LISTING

CHAN
     14976**DCL     14977--REDEF   15293<<ASSIGN  15367<<ASSIGN
CHANS
     14977**DCL     15295>>ASSIGN  15369>>ASSIGN
CHN$
     14974**DCL     10234--IMP-PTR 15295<<ASSIGN  15297>>ASSIGN  15298>>IF      15369<<ASSIGN  15371>>ASSIGN
     15372>>IF
CTX$
     14975**DCL     15297<<ASSIGN  15301>>IF      15303>>ASSIGN  15303>>ASSIGN  15306>>IF      15306>>IF
     15309>>ASSIGN  15310>>ASSIGN  15314>>IF      15315>>CALL    15316>>CALL    15319>>ASSIGN  15320>>IF
     15322>>IF      15323>>ASSIGN  15325>>ASSIGN  15326>>ASSIGN  15330>>ASSIGN  15331>>ASSIGN  15371<<ASSIGN
     15375>>IF      15377>>ASSIGN  15377>>ASSIGN  15381>>IF      15387>>ASSIGN  15398>>IF      15400>>ASSIGN
     15401>>ASSIGN  15404>>CALL    15405>>CALL
EVENT
     14979**DCL     15315<>CALL    15316<>CALL    15404<>CALL    15405<>CALL
FPT_INTRET
     13764**DCL     15351<>CALL    15414<>CALL
FPT_INTRET.V
     13768**DCL     13766--DCLINIT
G$JIT.ERRLOG
     10705**DCL     10708--REDEF
G$JIT.JSUNIT
     10444**DCL     10445--REDEF
G$JIT.MCLS
     10443**DCL     10443--REDEF
G$JIT.SYSID
     10433**DCL     15298>>IF      15372>>IF
G$JIT.TMRZ
     10712**DCL     10713--REDEF
G$JIT.USER_EXTIME
     10436**DCL     10437--REDEF
G$JIT.USER_MEMTIME
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:61   
     10439**DCL     10439--REDEF
G$JIT.USER_SVTIME
     10438**DCL     10438--REDEF
G$JIT$
     10775**DCL     10375--IMP-PTR 15298>>IF      15372>>IF
G$LOW_MEM.IV.IL$
     13814**DCL     13814--REDEF
G$LOW_MEM.IV.INT.I#00$
     13814**DCL     13814--REDEF
G$LOW_MEM.IV.INT.I#01$
     13814**DCL     13814--REDEF
G$LOW_MEM.IV.INT.I#02$
     13815**DCL     13815--REDEF
G$LOW_MEM.IV.INT.I#03$
     13815**DCL     13815--REDEF
G$LOW_MEM.IV.INT.I#04$
     13815**DCL     13816--REDEF
G$LOW_MEM.IV.INT.I#05$
     13816**DCL     13816--REDEF
G$LOW_MEM.IV.INT.I#61$
     13817**DCL     13817--REDEF
G$LOW_MEM.IV.INT.I#62$
     13817**DCL     13817--REDEF
G$LOW_MEM.IV.INT.I#63$
     13817**DCL     13817--REDEF
G$LOW_MEM.TV.T#01$
     13802**DCL     13802--REDEF
G$LOW_MEM.TV.T#02$
     13802**DCL     13802--REDEF
G$LOW_MEM.TV.T#03$
     13801**DCL     13801--REDEF
G$LOW_MEM.TV.T#05$
     13801**DCL     13801--REDEF
G$LOW_MEM.TV.T#06$
     13800**DCL     13800--REDEF
G$LOW_MEM.TV.T#07$
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:62   
     13800**DCL     13800--REDEF
G$LOW_MEM.TV.T#08$
     13799**DCL     13800--REDEF
G$LOW_MEM.TV.T#09$
     13799**DCL     13799--REDEF
G$LOW_MEM.TV.T#10$
     13799**DCL     13799--REDEF
G$LOW_MEM.TV.T#12$
     13798**DCL     13798--REDEF
G$LOW_MEM.TV.T#13$
     13798**DCL     13798--REDEF
G$LOW_MEM.TV.T#14$
     13797**DCL     13797--REDEF
G$LOW_MEM.TV.T#15$
     13797**DCL     13797--REDEF
G$LOW_MEM.TV.T#16$
     13796**DCL     13797--REDEF
G$LOW_MEM.TV.T#17$
     13796**DCL     13796--REDEF
G$LOW_MEM.TV.T#19$
     13795**DCL     13796--REDEF
G$LOW_MEM.TV.T#20$
     13795**DCL     13795--REDEF
G$LOW_MEM.TV.T#21$
     13795**DCL     13795--REDEF
G$LOW_MEM.TV.T#22$
     13794**DCL     13794--REDEF
G$LOW_MEM.TV.T#23$
     13794**DCL     13794--REDEF
G$LOW_MEM.TV.T#24$
     13793**DCL     13794--REDEF
G$LOW_MEM.TV.T#25$
     13793**DCL     13793--REDEF
G$LOW_MEM.TV.T#26$
     13793**DCL     13793--REDEF
G$LOW_MEM.TV.T#27$
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:63   
     13792**DCL     13792--REDEF
G$LOW_MEM.TV.T#28$
     13792**DCL     13792--REDEF
G$LOW_MEM.TV.T#29$
     13791**DCL     13792--REDEF
G$LOW_MEM.TV.T#30$
     13791**DCL     13791--REDEF
G$LOW_MEM.TV.T#31$
     13791**DCL     13791--REDEF
G$LOW_MEM.TV.T#32$
     13790**DCL     13790--REDEF
G$LOW_MEM.TV.T#33$
     13790**DCL     13790--REDEF
G$LOW_MEM$
     13771**DCL     13777--IMP-PTR
G$UHJIT.ISA_USR
     12217**DCL     12512--REDEF
G$UHJIT.ISA_USR.DEV
     12239**DCL     15289>>IF      15289>>IF      15293>>ASSIGN  15363>>IF      15363>>IF      15367>>ASSIGN
G$UHJIT.ISA_USR.P$$
     12292**DCL     12292--REDEF
G$UHJIT.TSA_CP.ISA.P$$
     13499**DCL     13499--REDEF
G$UHJIT.TSA_CP.P$$
     13370**DCL     13370--REDEF   13371--REDEF
G$UHJIT.TSA_DB.ISA.P$$
     13111**DCL     13111--REDEF
G$UHJIT.TSA_DB.P$$
     12982**DCL     12982--REDEF   12983--REDEF
G$UHJIT.TSA_RTT.P$$
     13745**DCL     13745--REDEF   13746--REDEF
G$UHJIT.TSA_USR.ISA.P$$
     12701**DCL     12701--REDEF
G$UHJIT.TSA_USR.P$$
     12572**DCL     12572--REDEF   12573--REDEF
G$UHJIT$
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:64   
     10776**DCL     10794--IMP-PTR 15289>>IF      15289>>IF      15293>>ASSIGN  15363>>IF      15363>>IF
     15367>>ASSIGN
ITIME
     14982**DCL     15361<>CALL    15409<>CALL    15411>>ASSIGN
KH$CANCELCLK
     15151**DCL     15308<<ASSIGN  15311<>CALL    15399<<ASSIGN  15402<>CALL
KH$CANCELCLK.CTBCTX$
     15157**DCL     15309<<ASSIGN  15400<<ASSIGN
KH$CANCELCLK.UID
     15167**DCL     15168--REDEF   15169--REDEF
KH$CHN
     10234**DCL     15295--ASSIGN  15369--ASSIGN
KH$CHN.CTX$
     10304**DCL     15297>>ASSIGN  15371>>ASSIGN
KH$CHN.SYSID
     10267**DCL     15298>>IF      15372>>IF
KH$CHN.TERMID.TERM
     10330**DCL     10339--REDEF
KH$SETCLK
     15000**DCL     15321<<ASSIGN  15329<>CALL
KH$SETCLK.CTBCTX$
     15006**DCL     15328<<ASSIGN  15330>>ASSIGN
KH$SETCLK.PRD
     15121**DCL     15323<<ASSIGN  15325<<ASSIGN
KH$SETCLK.SBR$
     15117**DCL     15327<<ASSIGN
KH$SETCLK.UID
     15016**DCL     15017--REDEF   15018--REDEF
KH$SETCLK.UID$
     15017**DCL     15326<<ASSIGN
KHC$CLOCK
     14965**DCL-ENT 15311--CALL    15329--CALL    15402--CALL
KHC$DLTXEQ2
     14967**DCL-ENT 15346--CALL    15409--CALL
KHC$XEQ2
     14966**DCL-ENT 15288--CALL    15361--CALL
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:65   
KH_CANCELCLK
     13990**DCL     15308>>ASSIGN  15399>>ASSIGN
KH_CANCELCLK.UID
     14006**DCL     14007--REDEF   14008--REDEF
KH_CHNHI
     10356**DCL     10357--REDEF   15289>>IF      15363>>IF
KH_CHNLOW
     10357**DCL     10358--REDEF   15289>>IF      15363>>IF
KH_CHNLOW$
     10356**DCL     15295>>ASSIGN  15369>>ASSIGN
KH_SETCLK
     13839**DCL     15321>>ASSIGN
KH_SETCLK.UID
     13855**DCL     13856--REDEF   13857--REDEF
KZ$BSCSTT.KHSTT.INPINTCNT
     14462**DCL     15412<<ASSIGN  15412>>ASSIGN
KZ$BSCSTT.KHSTT.INPINTISATIM
     14463**DCL     15411<<ASSIGN  15411>>ASSIGN
KZ$BSCSTT.KHSTT.OTPINTCNT
     14462**DCL     15348<<ASSIGN  15348>>ASSIGN
KZ$BSCSTT.KHSTT.OTPINTISATIM
     14463**DCL     15347<<ASSIGN  15347>>ASSIGN
KZ$BSCSTT.REQSTATS.DSPMSK
     14392**DCL     14398--REDEF
KZ$BSCSTT.REQSTATS.SLCMSK
     14433**DCL     14440--REDEF
KZ$BSCSTT.TRNSCT
     14475**DCL     15410<<ASSIGN  15410>>ASSIGN
KZ$HDR.STTBFR$
     14523**DCL     15304>>ASSIGN  15378>>ASSIGN
KZ$LINCTX
     14542**DCL     15315<>CALL    15316<>CALL    15404<>CALL    15405<>CALL
KZ$LINCTX.CTB.PRM$
     14631**DCL     15306>>IF      15309>>ASSIGN  15310<<ASSIGN  15330<<ASSIGN  15398>>IF      15400>>ASSIGN
     15401<<ASSIGN
KZ$LINCTX.FLAGS.DFRINP
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:66   
     14659**DCL     15314>>IF      15319<<ASSIGN  15381>>IF      15387<<ASSIGN
KZ$LINCTX.FLAGS.SETCLK
     14684**DCL     15320>>IF
KZ$LINCTX.LINID.TERM
     14565**DCL     14574--REDEF
KZ$LINCTX.OTPCNT
     14830**DCL     14833--REDEF
KZ$LINCTX.POLSIZ
     14876**DCL     14878--REDEF
KZ$LINCTX.PRMCTBTYP
     14578**DCL     15306>>IF      15331<<ASSIGN
KZ$LINCTX.PRO.PROTYP
     14726**DCL     15303>>ASSIGN  15377>>ASSIGN
KZ$LINCTX.PRO.SLAVE
     14781**DCL     15303>>ASSIGN  15377>>ASSIGN
KZ$LINCTX.TIMOUT.PRIMARY
     14942**DCL     15325>>ASSIGN
KZ$LINCTX.TIMOUT.SECONDARY
     14946**DCL     15323>>ASSIGN
KZ$LINCTX.TIMOUT.USESEC
     14954**DCL     15322>>IF
KZC$INPCLK
     14968**DCL-ENT 15327--ASSIGN
KZO$EVENT
     14969**DCL-ENT 15315--CALL    15404--CALL
KZP$DRIVER
     14970**DCL-ENT 15316--CALL    15405--CALL
KZ_HDR$
     14972**DCL     15304>>ASSIGN  15378>>ASSIGN
OTIME
     14981**DCL     15288<>CALL    15346<>CALL    15347>>ASSIGN
PROTYP
     14980**DCL     15303<<ASSIGN  15304>>ASSIGN  15377<<ASSIGN  15378>>ASSIGN
RETURN_
     15345**LABEL   15291--GOTO    15300--GOTO    15301--GOTO    15365--GOTO    15374--GOTO    15375--GOTO
SIZE
PL6.E3A0      #002=KZN$OTPCMP File=KZN$INT.:E05TSI                               WED 07/30/97 02:57 Page:67   
     14978**DCL     15315<>CALL    15316<>CALL    15404<>CALL    15405<>CALL
STT$
     14983**DCL     14143--IMP-PTR 15304<<ASSIGN  15345>>IF      15347>>ASSIGN  15347>>ASSIGN  15348>>ASSIGN
     15348>>ASSIGN  15378<<ASSIGN  15408>>IF      15410>>ASSIGN  15410>>ASSIGN  15411>>ASSIGN  15411>>ASSIGN
     15412>>ASSIGN  15412>>ASSIGN
X6A_INTRET
     14971**DCL-ENT 15351--CALL    15414--CALL
