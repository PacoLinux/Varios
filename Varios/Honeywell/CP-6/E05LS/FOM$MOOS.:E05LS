VERSION E05

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:1    
        1        1        /*M* FOM$MOOS Monitor part of the output symbiont */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME: FOM$MOOS
       10       10             PURPOSE: To provide those output symbiont functions which,
       11       11                      for reasons of efficiency and/or nescessity,
       12       12                      must reside in the monitor
       13       13             DESCRIPTION:
       14       14                      MOOS is activated as the receiver of the M$SYMBIO
       15       15                      PMME, which currently may only be issued by the
       16       16                      OUTSYM ghost, but may be expanded in future to
       17       17                      other tasks.  MOOS bears essentially the same
       18       18                      relationship to the OUTSYM ghost as CP-V OUTSYM
       19       19                      did to RBBAT, that is, it reads symbiont files
       20       20                      passed to it by the ghost and prints them on
       21       21                      the appropriate device.
       22       22
       23       23                      In particular, when OUTSYM wants to print a file,
       24       24                      it issues an M$SYMBIO OPEN PMME, passing the
       25       25                      device name, a page for MOOS to use as disk buffer,
       26       26                      and the disk address & len of the file's first
       27       27                      extent.  MOOS then ACTIVATEs the device, obtains
       28       28                      an LDCT entry for symbiont context (linking it
       29       29                      to the device LDCT), maps OUTSYM's page into
       30       30                      its own FE page table, and commences reading
       31       31                      disk and writing granules to the appropriate place.
       32       32                      Note that granules, not records, are written, for
       33       33                      IOQ handles whole granules (on local devices), and
       34       34                      FEP handles them if the device is remote.
       35       35
       36       36                      When MOOS exhausts an extent, it events OUTSYM for
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:2    
       37       37                      another extent (actually MOOS maintains
       38       38                      a 1-deep stack of extents to eliminate latency),
       39       39                      and OUTSYM responds with a here's-the-next-extent
       40       40                      flavour of M$SYMBIO.
       41       41
       42       42        */
       43       43        /**/
       44       44        /*F* NAME:         FOM$PMME
       45       45             PURPOSE:      To service the M$SYMBIO PMME
       46       46             DESCRIPTION:  FOM$PMME is the service routine for the M$SYMBIO
       47       47                           PMME, issued by the OUTSYM ghost.
       48       48
       49       49                           The various flavours of M$SYMBIO are:
       50       50
       51       51                 OPEN      Begin printing a file on a given device.
       52       52
       53       53                 CONTINUE  Restart a halted device
       54       54
       55       55                 NXEXTENT  Provide next disk extent
       56       56
       57       57                 HALT      Suspend a device
       58       58
       59       59                 CLOSE     Shut down a halted or completed device
       60       60
       61       61                 SPACE     Start spacing operation
       62       62
       63       63                 TOKEN     Send token to remote device
       64       64
       65       65                 CHEXT     Check a disk extent
       66       66
       67       67                 WRITE     Write one record
       68       68
       69       69                 FMNT      Do forms mount
       70       70
       71       71                 INFO      Get blk#-rec# info
       72       72
       73       73                 CHORG     Check origin (local or remote)
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:3    
       74       74
       75       75
       76       76        */
       77       77        /**/
       78       78        FOM$PMME: PROC (FPTCODE);
       79       79
       80       80
       81       81
       82       82
       83       83
       84       84        /**/
       85       85        /* INCLUDES */
       86       86        /**/
       87       87        %INCLUDE NK$LDCT;
       88      189        %INCLUDE FOM$STRUCT;
       89      250        %INCLUDE UM$CP6V_C;
       90      437        %INCLUDE B$JIT_C;
       91      751        %INCLUDE NK_LDCT_R;
       92      760        %INCLUDE KC_DATA_R;
       93      773        %INCLUDE JG_GHOSTS_C;
       94      863        %INCLUDE KC_SUBS_C;
       95      879        %INCLUDE NK_SUBS;
       96      904        %INCLUDE FOM_SUBS_C;
       97      967        %INCLUDE UD_ERRORS_C;
       98     1009        %INCLUDE KC_ERRORS_C;
       99     1056        %INCLUDE FO_ERRORS_C;
      100     1088        %INCLUDE FOM_DATA_R;
      101     1337        %INCLUDE UD_SEV_C;
      102     1351        %INCLUDE HF_LOCK_C;
      103     1365        %INCLUDE KQ_MAC_C;
      104     3915        %INCLUDE KQ_SUBS_C;
      105     4215        %INCLUDE KC_CP6;
      106     4775        %INCLUDE KC$CP6V_C;
      107     4895        %INCLUDE N$REQ;
      108     4969        %INCLUDE F$DCB;
      109     5018        %INCLUDE K_DATA_R;
      110     5729        %INCLUDE KV$VDO;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:4    
      111     6744        %INCLUDE NI$TABLES;
      112     6960        %INCLUDE FR$RAT;
      113     7013        %INCLUDE TD_CP6;
      114     7191        %INCLUDE CP_6_SUBS;
      115     7731
      116     7732
      117     7733        /**/
      118     7734        /* MACROS */
      119     7735        /**/
      120     7736        %MACRO $ERROR (NAME=GORGO,CODE=0,SEV=SEV_ERROR#);
      121     7737        DCL 1 NAME CONSTANT ALIGNED,
      122     7738              2 * BIT(18) UNAL INIT('061715'O),
      123     7739              2 * UBIN(15) UNAL INIT(CODE),
      124     7740              2 * UBIN(3) UNAL INIT(SEV);
      125     7741        %MEND;
      126     7742
      127     7743
      128     7744        /**/
      129     7745        /* PARAMETERS */
      130     7746        /**/
      131     7747    1   DCL FPTCODE UBIN WORD;
      132     7748
      133     7749
      134     7750        /**/
      135     7751        /* BASED STRUCTURES */
      136     7752        /**/
      137     7753        %KV_VDO_ALL_E;
      138     7832        %NK$LDCT;
      139     7878        %KQ_CG (FPTN=KQ$CG,STCLASS=BASED);
      140     8617        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      141     8956        %FOM$SYMB (NAME=FO$SYMB);
      142     8988        %FPT$SYMBIO_V (FPTN=FPT$SYMBIO_V,BASED="BASED(B$PS0$)");
      143     8993        %VLP$SYMBEXTENT_V (FPTN=VLP$EXTENT,BASED="BASED(B$PS1$)");
      144     8996        %B$JIT0;
      145     9085        %U$JIT1X;
      146     9088        %M$JIT2X;
      147     9091        %F$JIT3;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:5    
      148     9096        %A$JIT6X;
      149     9099        %N$REQ;
      150     9157        %FOM$TABS;
      151     9160    1   DCL VLP$STATION CHAR(8) BASED(B$PS3$);
      152     9161    1   DCL VLP$FORM CHAR(6) BASED(B$PS5$);
      153     9162        /**/
      154     9163        %FR$RAT;
      155     9203        %NI$DCT (NAME=DCT,STCLASS="BASED(DCT$)");
      156     9251    1   DCL N$DCT$(0:0) PTR BASED;
      157     9252
      158     9253
      159     9254        /**/
      160     9255        /* AUTO */
      161     9256        /**/
      162     9257    1   DCL ORDER UBIN WORD;
      163     9258    1   DCL LDCT$ PTR;
      164     9259    1   DCL SYMB$ PTR;
      165     9260    1   DCL DAD UBIN WORD;
      166     9261    1   DCL SETX UBIN HALF;
      167     9262    1   DCL TEMP UBIN WORD;
      168     9263    1   DCL CG$ PTR;
      169     9264    1   DCL STA$ PTR;
      170     9265    1   DCL STALOCK UBIN;
      171     9266        %K$RWPARM (NAME=K$RWPARM,STCLASS="");
      172     9582        %FPT_SYSCON (FPTN=FPT_SYSCON,STCLASS=AUTO);
      173     9599    1   DCL RESULT SBIN;
      174     9600    1   DCL ERR SBIN;
      175     9601    1   DCL SAVEPRIV BIT(36);
      176     9602    1   DCL DCTX UBIN(36);
      177     9603    1   DCL DCT$ PTR;
      178     9604
      179     9605
      180     9606        /**/
      181     9607        /* CONSTANT */
      182     9608        /**/
      183     9609        %$ERROR (NAME=E_NAUTH,CODE=%E$NOTAUTH);
      184     9615        %$ERROR (NAME=E_NOSTA,CODE=%E$NOSTA);
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:6    
      185     9621        %$ERROR (NAME=E_BSYSY,CODE=%E$BSYSY);
      186     9627        %$ERROR (NAME=E_NHLTD,CODE=%E$NHLTD);
      187     9633        %$ERROR (NAME=E_XTEXT,CODE=%E$XTEXT);
      188     9639        %$ERROR (NAME=E_NSBLK,CODE=%E$NSBLK);
      189     9645        %$ERROR (NAME=E_NVMEM,CODE=%E$NVMEM);
      190     9651        %$ERROR (NAME=E_NSCLS,CODE=%E$NSCLS);
      191     9657        %$ERROR (NAME=E_NOHLT,CODE=%E$NOHLT);
      192     9663        %$ERROR (NAME=E_BADFC,CODE=%E$BADFC);
      193     9669        %$ERROR (NAME=E_LOCAL,CODE=%E$LOCAL);
      194     9675        %$ERROR (NAME=E_BADEXT,CODE=%E$BADEXT);
      195     9681        %$ERROR (NAME=E_ALGNDSC,CODE=%E$ALGNDSC);
      196     9687        %$ERROR (NAME=E_FPABRT,CODE=%E$FPABRT);
      197     9693        %FOM$SYMB (NAME=INITSBLK,STCLASS=CONSTANT);
      198     9725
      199     9726
      200     9727        /**/
      201     9728        /* REFS */
      202     9729        /**/
      203     9730    1   DCL B$JIT$ PTR SYMREF;
      204     9731    1   DCL B$PS0$ PTR SYMREF;
      205     9732    1   DCL B$PS1$ PTR SYMREF;
      206     9733    1   DCL B$PS2$ PTR SYMREF;
      207     9734    1   DCL B$PS3$ PTR SYMREF;
      208     9735    1   DCL B$PS4$ PTR SYMREF;
      209     9736    1   DCL B$PS5$ PTR SYMREF;
      210     9737    1   DCL S_CUN UBIN WORD SYMREF;
      211     9738    1   DCL FAF$SRTODR         ENTRY(2) ALTRET;
      212     9739    1   DCL FOM$DISKQ          ENTRY(1) ALTRET;
      213     9740    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
      214     9741    1   DCL FOM$REL            ENTRY(1) ALTRET;
      215     9742    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
      216     9743    1   DCL FOM$WRITE          ENTRY(1);
      217     9744    1   DCL KCD$ACTRM          ENTRY(1);
      218     9745    1   DCL KCD$DACTRM         ENTRY(1);
      219     9746    1   DCL KIA$FCNOU          ENTRY(3) ALTRET;
      220     9747    1   DCL KQB$SRCH           ENTRY(3) ALTRET;
      221     9748    1   DCL KQP$UNLOCK         ENTRY(1) ALTRET;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:7    
      222     9749    1   DCL KQX$LDASR          ENTRY(1);
      223     9750    1   DCL MMS$VGET           ENTRY(4) ALTRET;
      224     9751    1   DCL MMS$VREL           ENTRY(2) ALTRET;
      225     9752    1   DCL NIQ$GET            ENTRY(1) ALTRET;
      226     9753    1   DCL NKF$FORM           ENTRY(2) ALTRET;
      227     9754    1   DCL NKL$GETDCT         ENTRY(1) ALTRET;
      228     9755    1   DCL NKL$RELDCT         ENTRY(1) ALTRET;
      229     9756    1   DCL SSS$BLOCK          ENTRY;
      230     9757    1   DCL TDP$SYSCON         ENTRY(3) ALTRET;
      231     9758
      232     9759
      233     9760        /**/
      234     9761        /* SUBS */
      235     9762        /**/
      236     9763        %EQU_CG;
      237     9811        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      238     9812        %EJECT;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:8    
      239     9813    2         IF S_CUN~=JG_OUTSYM# THEN DO;
      240     9814    2           B$JIT.ERR=E_NAUTH;
      241     9815        /*E* ERROR:        FOM-E$NOTAUTH-E
      242     9816             MESSAGE:      You are not permitted to use this service
      243     9817             MESSAGE1:     Only the system ghost OUTSYM may use M$SYMBIO. */
      244     9818    2           RETURN;
      245     9819    2           END;
      246     9820        /**/
      247     9821        /*       CHKEXT order here */
      248     9822        /**/
      249     9823                                      /* Validate beginning and ending
      250     9824                                         addresses of extent */
      251     9825    1         ORDER=FPT$SYMBIO_V.ORDER;
      252     9826    1         IF ORDER = FOMO_CHEXT# THEN
      253     9827    2           DO;
      254     9828    2           SETX=FPT$SYMBIO_V.SETX;
      255     9829    2           DAD=VLP$EXTENT.DAD;
      256     9830    2           CALL FAF$SRTODR (DAD,SETX) ALTRET(BAD_EXT);
      257     9831    2           DAD=VLP$EXTENT.DAD+VLP$EXTENT.GRANS-1;
      258     9832    2           CALL FAF$SRTODR (DAD,SETX) ALTRET(BAD_EXT);
      259     9833    2           RETURN;
      260     9834    2           END;
      261     9835        /**/
      262     9836        /*       FMNT order here */
      263     9837        /**/
      264     9838
      265     9839                                /* Now block to master */
      266     9840    1         CALL SSS$BLOCK;
      267     9841    1         IF ORDER = FOMO_FMNT# THEN
      268     9842    2           DO;
      269     9843    2           CALL NKF$FORM (VLP$STATION,VLP$FORM);
      270     9844    2           RETURN;
      271     9845    2           END;
      272     9846        /**/
      273     9847
      274     9848        /**/
      275     9849        /**/     /* Normal orders here */
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:9    
      276     9850    1         STALOCK=0;
      277     9851                                      /* Get pointer to device table entry
      278     9852                                         where write is destined */
      279     9853    1         LDCT$=NK$LDCT$(B$JIT$->B$JIT.DCB$->F$DCB.LDCTX);
      280     9854    1         CG$=LDCT$->NK$LDCT.CG$;
      281     9855    1         CALL KQX$LDASR (CG$->KQ$CG);
      282     9856              %LOCK (G=KQ$STREE.GATE);
      283     9859                                      /* Locate station and make sure it's
      284     9860                                         active */
      285     9861    1         CALL KQB$SRCH (KQ$STREE,VLP$STATION,STA$) ALTRET(NOSTA);
      286     9862                                      /* Lock station, thus preventing it
      287     9863                                         from disconnecting from COMGROUP */
      288     9864              %LOCK (G=STA$->KQ$STA.GATE);
      289     9867                                      /* Get device table entry pointer from
      290     9868                                         COMGROUP station (STA$ was aquired
      291     9869                                         from call to KQB$SRCH) */
      292     9870    1         LDCT$=STA$->KQ$STA.LDCT$;
      293     9871                                      /* Is destination a valid logical device? */
      294     9872    1         IF LDCT$ = ADDR(NIL) THEN
      295     9873    2           DO;
      296     9874    2   NOSTA1: ;
      297     9875                %UNLOCK (G=STA$->KQ$STA.GATE);
      298     9878    2   NOSTA:  ;
      299     9879                %UNLOCK (G=KQ$STREE.GATE);
      300     9882    2           GOTO BAD_NAME;
      301     9883    2           END;
      302     9884    1         ELSE
      303     9885    1          IF (LDCT$->NK$LDCT.RESCOD ~= NK_CGTRM   AND
      304     9886    1          LDCT$->NK$LDCT.RESCOD ~= NK_CGFPRG) THEN
      305     9887    1           GOTO NOSTA1;
      306     9888                                      /* COMGROUP stations were locked (above)
      307     9889                                         so they cannot be disconnected until
      308     9890                                         we allow it.  LOCKCNT tells if we
      309     9891                                         will allow disconnect. */
      310     9892    1         STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
      311     9893                                      /* STALOCK=1 means stations are unlocked */
      312     9894    1         STALOCK=1;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:10   
      313     9895              %UNLOCK (G=STA$->KQ$STA.GATE);
      314     9898              %UNLOCK (G=KQ$STREE.GATE);
      315     9901        /**/
      316     9902        /*       CHORG order here */
      317     9903        /**/
      318     9904    1         IF ORDER = FOMO_CHORG# THEN
      319     9905    2           DO;
      320     9906    2           IF LDCT$->NK$LDCT.DFLG.LOCAL THEN GOTO NOTREMOTE;
      321     9907                                      /* Unlock if necessary (shouldn't be
      322     9908                                         at this point) and return */
      323     9909    2           GOTO GETOUT;
      324     9910    2           END;
      325     9911                                /* IF WE FIND IT AND IT'S MARKED SYMBIONT
      326     9912                                   (I.E. HE'S ALREADY OPENED IT VIA M$SYMBIO),
      327     9913                                   THEN PICK UP THE POINTER TO THE SYMBIONT
      328     9914                                   CONTEXT BLK. */
      329     9915    1         IF LDCT$->NK$LDCT.DFLG.SYMBIONT THEN
      330     9916    1          SYMB$=LDCT$->NK$LDCT.SYMB$;
      331     9917    1         ELSE              /* ELSE THIS BETTER BE AN OPEN PMME */
      332     9918    1          IF (ORDER ~= FOMO_SOPEN# AND ORDER ~= FOMO_LOAD#) THEN
      333     9919    2            DO;
      334     9920    2   BAD_NAME:;
      335     9921    2            B$JIT.ERR=E_NOSTA;
      336     9922        /*E* ERROR:        FOM-E$NOSTA-E
      337     9923             MESSAGE:      M$SYMBIO can't find that device
      338     9924             DESCRIPTION:  The STATION specified on M$SYMBIO was either not
      339     9925                           found on the OSCG, or was found but was not
      340     9926                           symbiont. */
      341     9927    2   GETOUT:  ;
      342     9928    2            IF STALOCK ~= 0 THEN CALL KQP$UNLOCK (STA$->KQ$STA);
      343     9929    2            RETURN;
      344     9930    2            END;
      345     9931        /* NOW WE'RE STATISFIED THAT ALL IS COOL.  WE HAVE THE POINTER TO
      346     9932           THE DEVICE'S LDCT, AND THE POINTER TO THE SYMB CONTEXT BLK IF
      347     9933           THERE IS ONE (I.E. IF THE THING IS ALREADY OPEN AS SYMBIONT). */
      348     9934    1         CALL PROCIT ALTRET(BAD_NAME);
      349     9935    1         GOTO GETOUT;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:11   
      350     9936    1   PROCIT: PROC ALTRET;
      351     9937        /***
      352     9938         ***
      353     9939         ***
      354     9940         ***     DO CASE FOR M$SYMBIO FUNCTION CODE
      355     9941         ***
      356     9942         ***
      357     9943         ***/
      358     9944
      359     9945    3           DO CASE (ORDER);
      360     9946        /**
      361     9947         **
      362     9948         **
      363     9949         **      SYMBIONT OPEN
      364     9950         **
      365     9951         **
      366     9952         **/
      367     9953    3             CASE (FOMO_SOPEN#,FOMO_LOAD#);
      368     9954
      369     9955                                     /* LDCT$ is device table entry pointer
      370     9956                                        (for COMGROUP station) */
      371     9957    3               IF LDCT$->NK$LDCT.DFLG.SYMBIONT
      372     9958    3               OR (LDCT$->NK$LDCT.LKFLG.ACTIVE AND (ORDER = FOMO_SOPEN#))
      373     9959    3               THEN
      374     9960    4                 DO;      /* ALREADY ACTIVE ON THIS DEVICE */
      375     9961    4                 B$JIT.ERR=E_BSYSY;
      376     9962        /*E* ERROR:        FOM-E$BSYSY-E
      377     9963             MESSAGE:      M$SYMBIO can't open a busy symbiont
      378     9964             DESCRIPTION:  The symbiont that the user is trying to open
      379     9965                           is already open.  */
      380     9966    4                 RETURN;
      381     9967    4                 END;
      382     9968                           /* ELSE GET A SYMB CONTEXT BLK */
      383     9969    3               CALL NKL$GETDCT (SYMB$) ALTRET(NODCTS);
      384     9970                                /* PICK UP LDCTX OF NEW ENTRY */
      385     9971    3               TEMP=SYMB$->NK$LDCT.LDCTX;
      386     9972                                /* BLAST OUT THE TABLE POINTER TO IT */
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:12   
      387     9973    3               NK$LDCT$(TEMP)=ADDR(NIL);
      388     9974                                /* INITIALIZE IT W/ SYMB CONTEXT INIT */
      389     9975    3               SYMB$->FO$SYMB=INITSBLK;
      390     9976                                /* REMEMBER ITS OWN LDCTX */
      391     9977                                      /* Save LDCTX for restoration (later) */
      392     9978    3               SYMB$->FO$SYMB.LDCTX=TEMP;
      393     9979                                /* REMEMBER DEVICE LDCT INDEX */
      394     9980    3               SYMB$->FO$SYMB.DEVLDCTX=LDCT$->NK$LDCT.LDCTX;
      395     9981                                      /* B$PS2$ is the 2nd parameter and contains
      396     9982                                         the pointer to OUTSYMs granule. I think
      397     9983                                         this call maps the OUTSYM granule into
      398     9984                                         the FEP page table.  This table refer-
      399     9985                                         ences areas of the FEP Working Storage
      400     9986                                         Quarter, which gets accessed by the
      401     9987                                         FEP deblocker */
      402     9988    3               CALL MMS$VGET (FOM_WSQ,B$PS2$,4096,
      403     9989    3               SYMB$->FO$SYMB.BUF$) ALTRET(NOMEM1);
      404     9990                                /* IF THE TERMINAL DISCONNECTED, REL THE
      405     9991                                   SYMB CNTXT BLK AND ERROR THE USER */
      406     9992                    %LOCK (G=STA$->KQ$STA.GATE);
      407     9995                                      /* IDSC means initiate disconnect */
      408     9996    3               IF STA$->KQ$STA.IDSC THEN
      409     9997    4                 DO;
      410     9998    4                 CALL MMS$VREL(FOM_WSQ,SYMB$->FO$SYMB.BUF$);
      411     9999    4                 CALL RELSYMB;
      412    10000                      %UNLOCK (G=STA$->KQ$STA.GATE);
      413    10003    4   ALTRT:        ;
      414    10004    4                 ALTRETURN;
      415    10005    4                 END;
      416    10006                                /* OTHERWISE, POINT THE TERMINAL LDCT AT
      417    10007                                  THE SYMB CNTXT BLK, AND MARK IT AS
      418    10008                                  OPENED-SYMBIONT */
      419    10009    3               ELSE
      420    10010    4                 DO;
      421    10011                                      /* At this stage, LDCT$ points to the
      422    10012                                         COMGROUP station's LDCT.  Assign the
      423    10013                                         the symbiont context block pointer
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:13   
      424    10014                                         to SYMB$ in the output device's LDCT,
      425    10015                                         make the device a symbiont device, and
      426    10016                                         allow this symbiont device to discon-
      427    10017                                         nect from the COMGROUP.
      428    10018                                         NOTE: MOOS participates in COMGROUP
      429    10019                                         disconnects of symbiont devices. The
      430    10020                                         reason for the gate lock (above) is
      431    10021                                         so the device cannot disconnect until
      432    10022                                         all of the proper flags are set (these
      433    10023                                         flags inform the   COMGROUP that MOOS
      434    10024                                         must be called upon disconnect). */
      435    10025    4                 LDCT$->NK$LDCT.SYMB$=SYMB$;
      436    10026    4                 LDCT$->NK$LDCT.DFLG.SYMBIONT='1'B;
      437    10027                      %UNLOCK (G=STA$->KQ$STA.GATE);
      438    10030    4                 END;
      439    10031                                /* ACTIVATE THE DEVICE */
      440    10032    3               IF ORDER = FOMO_SOPEN#
      441    10033    3               THEN
      442    10034    3                CALL KCD$ACTRM (LDCT$->NK$LDCT);
      443    10035                                /* MERGE IN DISK SETX */
      444    10036                                      /* Assign packset where symbiont granule
      445    10037                                         resides */
      446    10038    3               SYMB$->FO$SYMB.SETX=FPT$SYMBIO_V.SETX;
      447    10039                                /* FROM NOW ON, IT'S JUST LIKE A CONTINUE
      448    10040                                   OF A HALTED SYMBIONT */
      449    10041    3               GOTO CONTINUE;
      450    10042    3   NOMEM1:     ;
      451    10043    3               SYMB$->NK$LDCT.LDCTX=SYMB$->FO$SYMB.LDCTX;
      452    10044    3               CALL NKL$RELDCT (SYMB$);
      453    10045    3               GOTO NOMEM2;
      454    10046        /**
      455    10047         **
      456    10048         **
      457    10049         **      START SPACING SYMBIONT (FROM HALT)
      458    10050         **
      459    10051         **
      460    10052         **/
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:14   
      461    10053    3             CASE (FOMO_SSPAC#);
      462    10054
      463    10055    3               SYMB$->FO$SYMB.SPACETYPE=0;
      464    10056    3   DOSPACE:    ;
      465    10057    3               IF SYMB$->FO$SYMB.TAB$ = ADDR(NIL) THEN
      466    10058    4                 DO;
      467    10059    4                 CALL NKL$GETDCT(SYMB$->FO$SYMB.TAB$) ALTRET(NODCTS);
      468    10060    4                 TEMP=SYMB$->FO$SYMB.TAB$->NK$LDCT.LDCTX;
      469    10061    4                 NK$LDCT$(TEMP)=ADDR(NIL);
      470    10062    4                 SYMB$->FO$SYMB.TAB$->FO$TABS.LDCTX=TEMP;
      471    10063    4                 END;
      472    10064                                      /* Go reactivate the device and map the
      473    10065                                         OUTSYM granule in the FEP WSQ.  If
      474    10066                                         ORDER = write, then start writing */
      475    10067    3               GOTO DOCONT;
      476    10068
      477    10069    3             CASE (FOMO_SSBLK#);
      478    10070
      479    10071    3               SYMB$->FO$SYMB.SPACETYPE=1;
      480    10072    3               GOTO DOSPACE;
      481    10073        /**
      482    10074         **
      483    10075         **
      484    10076         **      SYMBIONT CONTINUE (FROM HALT)
      485    10077         **
      486    10078         **
      487    10079         **/
      488    10080
      489    10081                                /* THE SYMBIONT CONTEXT BLOCK IS STILL
      490    10082                                   THERE BUT ALL OTHER STUFF WAS RELEASED
      491    10083                                   WHEN WE HALTED, SO IT MUST BE
      492    10084                                   RE-ACQUIRED. */
      493    10085
      494    10086    3             CASE (FOMO_SCONT#);
      495    10087
      496    10088    3   DOCONT:     ;
      497    10089                                /* MAKE SURE IT'S HALTED, AND IF SO, SET IT
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:15   
      498    10090                                   BUSY */
      499    10091                                      /* Reactivate the device and map the
      500    10092                                         OUTSYM granule into the FEP WSQ.  If
      501    10093                                         ORDER = write, then commence writing */
      502    10094    4                 DO INHIBIT;
      503    10095    4                 IF SYMB$->FO$SYMB.STATE~=FOMS_HELD# THEN GOTO BADCNT;
      504    10096    4                 SYMB$->FO$SYMB.STATE=FOMS_ACTV#;
      505    10097    4                 END;
      506    10098    3               CALL MMS$VGET (FOM_WSQ,B$PS2$,4096,
      507    10099    3               SYMB$->FO$SYMB.BUF$) ALTRET(NOMEM);
      508    10100
      509    10101        /* COME HERE TO CONTINUE */
      510    10102    3   CONTINUE:   ;
      511    10103
      512    10104                                      /* A number of IOQ packets are assigned
      513    10105                                         in TIGR. This call pulls the 1st one
      514    10106                                         off the free list and returns a pointer
      515    10107                                         to it. */
      516    10108    3               CALL NIQ$GET (SYMB$->FO$SYMB.IOQ$);
      517    10109
      518    10110    3               SYMB$->FO$SYMB.IOQ$->N$REQ.NOALT='1'B;
      519    10111                                      /* Assign pointer to symbiont context blk */
      520    10112    3               SYMB$->FO$SYMB.IOQ$->N$REQ.EAINFOP$=SYMB$;
      521    10113                                      /* Assign pointer to OUTSYMs granule,
      522    10114                                         which was mapped into the FEP WSQ
      523    10115                                         (above). */
      524    10116    3               SYMB$->FO$SYMB.IOQ$->N$REQ.BUF$=SYMB$->FO$SYMB.BUF$;
      525    10117                                /* PICK UP USER-PASSED BLK-REC */
      526    10118                                      /* Assign the block-rec where we are
      527    10119                                         to commence printing */
      528    10120    3               SYMB$->FO$SYMB.BR=FPT$SYMBIO_V.BLKREC;
      529    10121    3               IF FPT$SYMBIO_V.BLKREC.BLK = 0 AND
      530    10122    3               FPT$SYMBIO_V.BLKREC.REC = 1 THEN
      531    10123    3                SYMB$ -> FO$SYMB.PGDONE = 0;
      532    10124                                      /* Allow for "Q"ing of next extent */
      533    10125    3               SYMB$->FO$SYMB.NXTEXT='0'B;
      534    10126                                /* BREAK OUT IF WRITE ORDER */
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:16   
      535    10127    3               IF ORDER = FOMO_WRITE# THEN GOTO DOWRITE;
      536    10128    3               SYMB$->FO$SYMB.CUREXT=VLP$EXTENT;
      537    10129                                /* ASK FOR NEXT EXTENT */
      538    10130    3               IF SYMB$->FO$SYMB.CUREXT THEN
      539    10131                                      /* Ask OUTSYM for next extent */
      540    10132    3                CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_SFEXT#,0);
      541    10133                                /* QUEUE THE NEXT DISK READ */
      542    10134    3               IF  ORDER = FOMO_SSPAC#
      543    10135    3               OR ORDER = FOMO_SSBLK# THEN
      544    10136    4                 DO;
      545    10137    4                 IF SYMB$->FO$SYMB.BR='0'B
      546    10138    4                 THEN
      547    10139    5                   DO;
      548    10140    5                   SYMB$->FO$SYMB.XMVFU='1'B;
      549    10141    5                   END;
      550    10142    4                 SYMB$->FO$SYMB.SPACING='1'B;
      551    10143    4                 SYMB$->FO$SYMB.SPACEPAGES=FPT$SYMBIO_V.SPACEPAGES;
      552    10144    4                 SYMB$->FO$SYMB.SPACEREC#=FPT$SYMBIO_V.SPACEREC;
      553    10145    4                 SYMB$->FO$SYMB.PAGES=FPT$SYMBIO_V.PAGES;
      554    10146    4                 SYMB$->FO$SYMB.CPVFC=FPT$SYMBIO_V.CPVFC;
      555    10147    4                 SYMB$->FO$SYMB.FIRSTSPACE='1'B;
      556    10148    4                 END;
      557    10149                                      /* Put next extent on disk queue */
      558    10150    3               CALL FOM$DISKQ (SYMB$->FO$SYMB);
      559    10151    3               RETURN;
      560    10152                                /* NO VIRTUAL MEMORY TO MAP BUFFER */
      561    10153    3   NOMEM:      ;
      562    10154                                /* CHANGE STATE TO HELD, AND OUTSYM WILL
      563    10155                                   TRY LATER */
      564    10156    3               CALL FOM$EVENT(SYMB$->FO$SYMB,FOSE_HLTR,FOHR_NMEM#)
      565    10157    3               ALTRET (BADCNT);
      566    10158    3   NOMEM2:     ;
      567    10159    3               B$JIT.ERR=E_NVMEM;
      568    10160        /*E* ERROR:        FOM-E$NVMEM-E
      569    10161             MESSAGE:      No virtual map space for output symbiont
      570    10162             DESCRIPTION:  Each OPEN or CONTINUE M$SYMBIO requires a page
      571    10163                           in the appropriate FEWSQ map, for the symbiont
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:17   
      572    10164                           disc buffer.  This error occurs when the space
      573    10165                           is not available.  On an OPEN, the error results
      574    10166                           in a failed open; on a CONTINUE (or SPACE) the
      575    10167                           error results in the symbiont being left in state
      576    10168                           HELD.   */
      577    10169        /**
      578    10170         **
      579    10171         **
      580    10172         **      PASSING NEXT EXTENT
      581    10173         **
      582    10174         **
      583    10175         **/
      584    10176
      585    10177    3             CASE (FOMO_NXEXT#);
      586    10178
      587    10179                                      /* Get the output devices pointer to
      588    10180                                         the symbiont context block */
      589    10181    3               SYMB$=LDCT$->NK$LDCT.SYMB$;
      590    10182    3               IF SYMB$->FO$SYMB.NXTEXT~='0'B THEN GOTO BADNXTEXT;
      591    10183
      592    10184    4                 DO INHIBIT;
      593    10185                                      /* Are we currently processing an extent? */
      594    10186    4                 IF SYMB$->FO$SYMB.CUREXT THEN
      595    10187    5                   DO;
      596    10188    5                   SYMB$->FO$SYMB.NXTEXT=VLP$EXTENT;
      597    10189                                /* PRE-ADJUST FOR INCR/DECR IN FOM$NXDISK */
      598    10190                                      /* Adjust the file relative disk address */
      599    10191    5                   IF SYMB$->FO$SYMB.SPACING AND SYMB$->FO$SYMB.SPACEPAGES < 0
      600    10192    5                   THEN SYMB$->FO$SYMB.NXTEXT.STAMP.FRDAD=SYMB$->FO$SYMB.NXTEXT.STAMP.
             10192                            FRDAD+1;
      601    10193    5                   ELSE SYMB$->FO$SYMB.NXTEXT.STAMP.FRDAD=SYMB$->FO$SYMB.NXTEXT.STAMP.
             10193                            FRDAD-1;
      602    10194    5                   END;
      603    10195    4                 ELSE
      604    10196                                      /* Otherwise we don't have an extent, grab
      605    10197                                         this one and put it in CUREXT */
      606    10198    5                   DO;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:18   
      607    10199    5                   SYMB$->FO$SYMB.CUREXT=VLP$EXTENT;
      608    10200                                /* IF WE'RE IDLE WAITING FOR GRANULES,
      609    10201                                   CRANK UP THE NEXT READ */
      610    10202    5                   IF SYMB$->FO$SYMB.STATE=FOMS_IDLE# THEN
      611    10203    6                     DO;
      612    10204    6                     SYMB$->FO$SYMB.STATE=FOMS_ACTV#;
      613    10205    6                     CALL FOM$DISKQ (SYMB$->FO$SYMB);
      614    10206    6                     END;
      615    10207    5                   ELSE
      616    10208    6                     DO;
      617    10209                                /* PRE-ADJUST FOR INCR/DECR IN FOM$NXDISK */
      618    10210    6                     IF SYMB$->FO$SYMB.SPACING AND SYMB$->FO$SYMB.SPACEPAGES < 0
      619    10211    6                     THEN SYMB$->FO$SYMB.CUREXT.STAMP.FRDAD=SYMB$->FO$SYMB.CUREXT.STAMP
             10211                              .FRDAD+1;
      620    10212    6                     ELSE SYMB$->FO$SYMB.CUREXT.STAMP.FRDAD=SYMB$->FO$SYMB.CUREXT.STAMP
             10212                              .FRDAD-1;
      621    10213    6                     END;
      622    10214    5                   END;
      623    10215    4                 END;
      624    10216        /**
      625    10217         **
      626    10218         **
      627    10219         **      SEND SYMBIONT TOKEN
      628    10220         **
      629    10221         **
      630    10222         **/
      631    10223    3             CASE (FOMO_STOKN#);
      632    10224
      633    10225                                      /* FEX = 0 means not remote */
      634    10226    4                 DO INHIBIT;
      635    10227    4                 IF SYMB$ -> FO$SYMB.EFLGB.IDSC
      636    10228    4                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
      637    10229    4                 THEN
      638    10230    4                  GOTO BAD_ALDSC;
      639    10231
      640    10232    4                 IF SYMB$ -> FO$SYMB.FPABRT = '1'B
      641    10233    4                 THEN
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:19   
      642    10234    4                  GOTO BAD_ALFPRG;
      643    10235    4                 IF LDCT$->NK$LDCT.DFLG.LOCAL THEN
      644    10236    4                  CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STOKN#,0);
      645    10237    5                 ELSE DO;
      646    10238    5                   K$RWPARM = K_RWPARM_CON;
      647    10239    5                   K$RWPARM.MRKTYP = %KV_VDOMRKTYP_MRK;
      648    10240                        %LOCK(G=LDCT$->NK$LDCT.LOCK);
      649    10243    5                   CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSMRK,K$RWPARM)
      650    10244    6                   WHENALTRETURN DO;
      651    10245                          %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      652    10248    6                     ALTRETURN;
      653    10249    6                     END;
      654    10250                        %UNLOCK(G=LDCT$->NK$LDCT.LOCK);
      655    10253    5                   END;
      656    10254    4                 IF SYMB$ -> FO$SYMB.EFLGB.IDSC
      657    10255    4                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
      658    10256    4                 THEN
      659    10257    4                  GOTO BAD_ALDSC;
      660    10258
      661    10259    4                 IF SYMB$ -> FO$SYMB.FPABRT = '1'B
      662    10260    4                 THEN
      663    10261    4                  GOTO BAD_ALFPRG;
      664    10262    4                 END;
      665    10263        /**
      666    10264         **
      667    10265         **
      668    10266         **      SYMBIONT HALT
      669    10267         **
      670    10268         **
      671    10269         **/
      672    10270
      673    10271    3             CASE (FOMO_SHALT#);
      674    10272
      675    10273    3               CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_HLTR,FOHR_OUTS#) ALTRET(BADHLT);
      676    10274        /**
      677    10275         **
      678    10276         **
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:20   
      679    10277         **      WRITE ONE RECORD OR GRANULE
      680    10278         **
      681    10279         **
      682    10280         **/
      683    10281
      684    10282                      /* THE INFORMATION TO BE WRITTEN IS EITHER A RECORD
      685    10283                         DESCRIBED BY THE RECORD_ VECTOR WHICH FRAMES
      686    10284                         A VLP_SYMBWRITE VLP, OR, IF RECORD_ IS NILERASE,
      687    10285                         A WHOLE GRANULE, LIVING IN THE SYMBIONT BUFFER. */
      688    10286    3             CASE (FOMO_WRITE#);
      689    10287
      690    10288    4                 DO INHIBIT;
      691    10289    4                 IF SYMB$->FO$SYMB.STATE = FOMS_IDLE# THEN
      692    10290    5                   DO;
      693    10291    5   DOWRITE:        ;
      694    10292                                      /* Set device state in symbiont cntxt blk */
      695    10293    5                   SYMB$->FO$SYMB.STATE=FOMS_DKIO#;
      696    10294                                      /* Acknowledgement requested? */
      697    10295    5                   IF FPT$SYMBIO_V.ACK THEN SYMB$->FO$SYMB.ACK='1'B;
      698    10296    5                   ELSE IF FPT$SYMBIO_V.TOKEN THEN
      699    10297    6                      DO;
      700    10298                                      /* If it's not a remote write, let token
      701    10299                                         be assigned */
      702    10300    6                      IF LDCT$->NK$LDCT.DFLG.LOCAL THEN SYMB$->FO$SYMB.TOKEN='1'B;
      703    10301    6                      END;
      704    10302                                /* ZAP CUREXT */
      705    10303                                      /* MOOS no longer has a current extent */
      706    10304    5                   SYMB$->FO$SYMB.CUREXT='0'B;
      707    10305    5                   CALL FOM$WRITE (SYMB$->FO$SYMB.IOQ$->N$REQ);
      708    10306    5                   RETURN;
      709    10307    5                   END;
      710    10308    4                 IF SYMB$->FO$SYMB.STATE = FOMS_HELD# THEN GOTO DOCONT;
      711    10309                                                     /**/
      712    10310                                      /* If device disconnected it could
      713    10311                                         mess up an alignment sequence,
      714    10312                                         don't let it. */
      715    10313                                                     /**/
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:21   
      716    10314    4                 IF SYMB$ -> FO$SYMB.EFLGB.IDSC
      717    10315    4                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
      718    10316    4                 THEN
      719    10317    4                  GOTO BAD_ALDSC;
      720    10318
      721    10319    4                 IF SYMB$ -> FO$SYMB.FPABRT = '1'B
      722    10320    4                 THEN
      723    10321    4                  GOTO BAD_ALFPRG;
      724    10322                                                     /**/
      725    10323    4                 END;
      726    10324    3               GOTO BADCLS;
      727    10325        /**
      728    10326         **
      729    10327         **
      730    10328         **      GET SYMBIONT BLKREC INFO
      731    10329         **
      732    10330         **
      733    10331         **/
      734    10332    3             CASE (FOMO_INFO#);
      735    10333
      736    10334    3               FPT$SYMBIO_V.BLKREC=SYMB$->FO$SYMB.BR;
      737    10335    3               FPT$SYMBIO_V.PGDONE=SYMB$ -> FO$SYMB.PGDONE;
      738    10336    3               FPT$SYMBIO_V.THROTTLE_TIME=SYMB$ -> FO$SYMB.THROTTLE_TIME;
      739    10337    3               FPT$SYMBIO_V.THROTTLE_CNT=SYMB$ -> FO$SYMB.THROTTLE_CNT;
      740    10338        /**
      741    10339         **
      742    10340         **
      743    10341         **      SYMBIONT CLOSE
      744    10342         **
      745    10343         **
      746    10344         **/
      747    10345
      748    10346    3             CASE (FOMO_SCLOS#);
      749    10347
      750    10348    4                 DO INHIBIT;
      751    10349    4                 IF SYMB$ -> FO$SYMB.EFLGB.IDSC
      752    10350    4                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:22   
      753    10351    4                 THEN
      754    10352    4                  GOTO BAD_ALDSC;
      755    10353    4                 IF  SYMB$->FO$SYMB.STATE~=FOMS_IDLE#
      756    10354    4                 AND SYMB$->FO$SYMB.STATE~=FOMS_HELD# THEN GOTO BADCLS;
      757    10355    4                 LDCT$->NK$LDCT.DFLG.SYMBIONT='0'B;
      758    10356    4                 END;
      759    10357    3               CALL FOM$REL (SYMB$->FO$SYMB);
      760    10358    3               CALL RELSYMB;
      761    10359    3               CALL KCD$DACTRM (LDCT$->NK$LDCT);
      762    10360        /**
      763    10361           Lets see if the device needs some delayed partitioning done for it.
      764    10362           We assume that the LDCT was changed, and that there is a valid RAT$
      765    10363           pointer in it now.  This will get us back to the DCT so we can see
      766    10364           if this particular device should be delayed partitioned.
      767    10365        **/
      768    10366    3               IF LDCT$->NK$LDCT.RAT$ ~= ADDR(NIL) THEN
      769    10367    4                 DO;
      770    10368    4                 DCTX = LDCT$->NK$LDCT.RAT$->FR$RAT.DCTX;
      771    10369    4                 DCT$ = N$DCT$$->N$DCT$(DCTX);
      772    10370    4                 IF DCT$ ~= ADDR(NIL) THEN
      773    10371    4                  IF DCT.STATUS.SYSCON_PART OR DCT.STATUS.MSOS_PART THEN
      774    10372    5                    DO;
      775    10373    5                    FPT_SYSCON.V.FUNCTION# = %PARTITION#;
      776    10374    5                    FPT_SYSCON.V.COMPONENT# = %DVC#;
      777    10375    5                    FPT_SYSCON.V.DEVNM# = DCT.DEVNM;
      778    10376    5                    SAVEPRIV = B$JIT.PRIV.ACTIVE;
      779    10377    5                    B$JIT.PRIV.ACTIVE = %PR_SYSCON#;
      780    10378    5                    CALL TDP$SYSCON (FPT_SYSCON.V,RESULT,ERR);
      781    10379    5                    B$JIT.PRIV.ACTIVE = SAVEPRIV;
      782    10380    5                    END;
      783    10381    4                 END;
      784    10382        /**
      785    10383         **
      786    10384         **
      787    10385         **      UNKNOWN FUNCTION CODE
      788    10386         **
      789    10387         **
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:23   
      790    10388         **/
      791    10389    3             CASE (ELSE);
      792    10390    3               B$JIT.ERR=E_BADFC;
      793    10391        /*E* ERROR:        FOM-E$BADFC-E
      794    10392             MESSAGE:      Unknown M$SYMBIO function code
      795    10393             DESCRIPTION:  The function code (order) passed with M$SYMBIO
      796    10394                           was unknown. */
      797    10395
      798    10396    3           END; /*CASE ORDER*/
      799    10397    2         RETURN;
      800    10398        /**/
      801    10399    2   RELSYMB: PROC;
      802    10400                                /* MAKE SURE LDCTX IS IN RIGHT PLACE */
      803    10401    3         SYMB$->NK$LDCT.LDCTX=SYMB$->FO$SYMB.LDCTX;
      804    10402    3         CALL NKL$RELDCT (SYMB$);
      805    10403    3         RETURN;
      806    10404    3   END RELSYMB;
      807    10405        /**/
      808    10406        /* VARIOUS ERRORS */
      809    10407        /**/
      810    10408    2   NODCTS:
      811    10409    2         B$JIT.ERR=E_NSBLK;
      812    10410        /*E* ERROR:        FOM-E$NSBLK-E
      813    10411             MESSAGE:      No LDCTs available for M$SYMBIO OPEN or SPACE
      814    10412             DESCRIPTION:  Opening a symbiont output device requires an LDCT
      815    10413                           for the symbiont context block.  This error occurs
      816    10414                           when there are none.  It also occurs if no LDCT
      817    10415                           (used as a tabs buffer) is available when commencing
      818    10416                           a spacing operation.   */
      819    10417    2         RETURN;
      820    10418    2   BADCNT:
      821    10419    2         B$JIT.ERR=E_NHLTD;
      822    10420        /*E* ERROR:        FOM-E$NHLTD-E
      823    10421             MESSAGE:      M$SYMBIO can't continue or space a busy symbiont
      824    10422             DESCRIPTION:  A CONTINUE or SPACE M$SYMBIO PMME was issued
      825    10423                           against a symbiont which was not halted.  */
      826    10424    2         RETURN;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:24   
      827    10425    2   BADNXTEXT:;
      828    10426    2         B$JIT.ERR=E_XTEXT;
      829    10427        /*E* ERROR:        FOM-E$XTEXT-E
      830    10428             MESSAGE:      M$SYMBIO - symbiont doesn't need another extent
      831    10429             DESCRIPTION:  Another extent was passed to a symbiont which did
      832    10430                           not need one yet. */
      833    10431    2         RETURN;
      834    10432    2   BADHLT:;
      835    10433    2         B$JIT.ERR=E_NOHLT;
      836    10434        /*E* ERROR:        FOM-E$NOHLT-E
      837    10435             MESSAGE:      M$SYMBIO can't halt a non-busy symbiont
      838    10436             DESCRIPTION:  The symbiont that the user is trying to halt is
      839    10437                           in the process of being halted (for some other
      840    10438                           reason) or disconnected.  */
      841    10439    2         RETURN;
      842    10440    2   BADCLS:;
      843    10441    2         B$JIT.ERR=E_NSCLS;
      844    10442        /*E* ERROR:        FOM-E$NSCLS-E
      845    10443             MESSAGE:      M$SYMBIO can't close or write a busy symbiont
      846    10444             DESCRIPTION:  The symbiont that the user is closing or writing
      847    10445                           is neither idle nor halted.  */
      848    10446    2         RETURN;
      849    10447    2   BAD_ALDSC:;
      850    10448    2         B$JIT.ERR = E_ALGNDSC;
      851    10449        /*E* ERROR:          FOM-E$ALGNDSC-E
      852    10450             MESSAGE:        M$SYMBIO - inopportune disconnect
      853    10451             DESCRIPTION:    The device started disconnecting.  OUTSYM won't
      854    10452                             find out about this if we are in the middle of
      855    10453                             an alignment sequence until it's too late.  This
      856    10454                             is a way to let OUTSYM know immediately. */
      857    10455    2         RETURN;
      858    10456    2   BAD_ALFPRG:;
      859    10457    2         B$JIT.ERR = E_FPABRT;
      860    10458        /*E* ERROR:          FOM-E$FPABRT-E
      861    10459             MESSAGE:        M$SYMBIO - Alignment FPRG abort
      862    10460             DESCRIPTION:    The graphics FPRG aborted.  OUTSYM won't find
      863    10461                             out about this if we are in the middle of an
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:25   
      864    10462                             alignment sequence until it's too late.  This
      865    10463                             is a way to let OUTSYM know immediately. */
      866    10464    2   END PROCIT;
      867    10465    1   BAD_EXT:;
      868    10466    1         B$JIT.ERR=E_BADEXT;
      869    10467        /*E* ERROR:        FOM-E$BADEXT-E
      870    10468             MESSAGE:      M$SYMBIO - Bad extent passed
      871    10469             DESCRIPTION:  Either the first or last granule in the passed
      872    10470                           extent did not pass FAF$SRTODR check.  */
      873    10471    1         RETURN;
      874    10472    1   NOTREMOTE:;
      875    10473    1         B$JIT.ERR=E_LOCAL;
      876    10474        /*E* ERROR:        FOM-E$LOCAL-E
      877    10475             MESSAGE:      M$SYMBIO - illegal function on local device
      878    10476             DESCRIPTION:  The function code issued with M$SYMBIO is
      879    10477                           not appropriate for a local device. */
      880    10478    1         GOTO GETOUT;
      881    10479        /**/
      882    10480    1   END FOM$PMME;
      883    10481        /**/
      884    10482        /**/
      885    10483        %EOD;

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:26   
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   TD_CP6.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FO_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   UM$CP6V_C.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$PMME.

   Procedure FOM$PMME requires 797 words for executable code.
   Procedure FOM$PMME requires 76 words of local(AUTO) storage.
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:27   

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:28   

 Object Unit name= FOM$PMME                                   File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:09:07.96 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     34     42  FOM$PMME
    1   Proc  even  none   797   1435  FOM$PMME
    2  RoData even  none    16     20  FOM$PMME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  FOM$PMME
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:29   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 FAF$SRTODR
         yes           Std       1 KQX$LDASR
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 KQP$UNLOCK
 yes     yes           Std       3 KQB$SRCH
         yes           Std       0 SSS$BLOCK
         yes           Std       1 HFC$LOCK
 yes     yes           Std       2 NKF$FORM
 yes     yes           Std       1 NKL$GETDCT
 yes     yes           Std       4 MMS$VGET
 yes     yes           Std       1 FOM$DISKQ
 yes     yes           Std       3 FOM$EVENT
 yes     yes           Std       2 MMS$VREL
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       3 FOM$TELLAU
         yes           Std       1 KCD$DACTRM
 yes     yes           Std       3 KIA$FCNOU
         yes           Std       1 FOM$WRITE
         yes           Std       1 KCD$ACTRM
 yes     yes           Std       1 NKL$RELDCT
 yes     yes           Std       1 FOM$REL
 yes     yes           Std       3 TDP$SYSCON
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:30   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               FOM_WSQ                          r    FOSE_HLTR
r    K_RWPARM_CON                          B$JIT$                                B$PS0$
     B$PS1$                                B$PS2$                                B$PS3$
     B$PS5$                                S_CUN                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:31   


        1        1        /*M* FOM$MOOS Monitor part of the output symbiont */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME: FOM$MOOS
       10       10             PURPOSE: To provide those output symbiont functions which,
       11       11                      for reasons of efficiency and/or nescessity,
       12       12                      must reside in the monitor
       13       13             DESCRIPTION:
       14       14                      MOOS is activated as the receiver of the M$SYMBIO
       15       15                      PMME, which currently may only be issued by the
       16       16                      OUTSYM ghost, but may be expanded in future to
       17       17                      other tasks.  MOOS bears essentially the same
       18       18                      relationship to the OUTSYM ghost as CP-V OUTSYM
       19       19                      did to RBBAT, that is, it reads symbiont files
       20       20                      passed to it by the ghost and prints them on
       21       21                      the appropriate device.
       22       22
       23       23                      In particular, when OUTSYM wants to print a file,
       24       24                      it issues an M$SYMBIO OPEN PMME, passing the
       25       25                      device name, a page for MOOS to use as disk buffer,
       26       26                      and the disk address & len of the file's first
       27       27                      extent.  MOOS then ACTIVATEs the device, obtains
       28       28                      an LDCT entry for symbiont context (linking it
       29       29                      to the device LDCT), maps OUTSYM's page into
       30       30                      its own FE page table, and commences reading
       31       31                      disk and writing granules to the appropriate place.
       32       32                      Note that granules, not records, are written, for
       33       33                      IOQ handles whole granules (on local devices), and
       34       34                      FEP handles them if the device is remote.
       35       35
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:32   
       36       36                      When MOOS exhausts an extent, it events OUTSYM for
       37       37                      another extent (actually MOOS maintains
       38       38                      a 1-deep stack of extents to eliminate latency),
       39       39                      and OUTSYM responds with a here's-the-next-extent
       40       40                      flavour of M$SYMBIO.
       41       41
       42       42        */
       43       43        /**/
       44       44        /*F* NAME:         FOM$PMME
       45       45             PURPOSE:      To service the M$SYMBIO PMME
       46       46             DESCRIPTION:  FOM$PMME is the service routine for the M$SYMBIO
       47       47                           PMME, issued by the OUTSYM ghost.
       48       48
       49       49                           The various flavours of M$SYMBIO are:
       50       50
       51       51                 OPEN      Begin printing a file on a given device.
       52       52
       53       53                 CONTINUE  Restart a halted device
       54       54
       55       55                 NXEXTENT  Provide next disk extent
       56       56
       57       57                 HALT      Suspend a device
       58       58
       59       59                 CLOSE     Shut down a halted or completed device
       60       60
       61       61                 SPACE     Start spacing operation
       62       62
       63       63                 TOKEN     Send token to remote device
       64       64
       65       65                 CHEXT     Check a disk extent
       66       66
       67       67                 WRITE     Write one record
       68       68
       69       69                 FMNT      Do forms mount
       70       70
       71       71                 INFO      Get blk#-rec# info
       72       72
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:33   
       73       73                 CHORG     Check origin (local or remote)
       74       74
       75       75
       76       76        */
       77       77        /**/
       78       78        FOM$PMME: PROC (FPTCODE);

     78  1 000000   000000 700200 xent  FOM$PMME     TSX0  ! X66_AUTO_1
         1 000001   000114 000001                    ZERO    76,1

       79       79
       80       80
       81       81
       82       82
       83       83
       84       84        /**/
       85       85        /* INCLUDES */
       86       86        /**/
       87       87        %INCLUDE NK$LDCT;
       88      189        %INCLUDE FOM$STRUCT;
       89      250        %INCLUDE UM$CP6V_C;
       90      437        %INCLUDE B$JIT_C;
       91      751        %INCLUDE NK_LDCT_R;
       92      760        %INCLUDE KC_DATA_R;
       93      773        %INCLUDE JG_GHOSTS_C;
       94      863        %INCLUDE KC_SUBS_C;
       95      879        %INCLUDE NK_SUBS;
       96      904        %INCLUDE FOM_SUBS_C;
       97      967        %INCLUDE UD_ERRORS_C;
       98     1009        %INCLUDE KC_ERRORS_C;
       99     1056        %INCLUDE FO_ERRORS_C;
      100     1088        %INCLUDE FOM_DATA_R;
      101     1337        %INCLUDE UD_SEV_C;
      102     1351        %INCLUDE HF_LOCK_C;
      103     1365        %INCLUDE KQ_MAC_C;
      104     3915        %INCLUDE KQ_SUBS_C;
      105     4215        %INCLUDE KC_CP6;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:34   
      106     4775        %INCLUDE KC$CP6V_C;
      107     4895        %INCLUDE N$REQ;
      108     4969        %INCLUDE F$DCB;
      109     5018        %INCLUDE K_DATA_R;
      110     5729        %INCLUDE KV$VDO;
      111     6744        %INCLUDE NI$TABLES;
      112     6960        %INCLUDE FR$RAT;
      113     7013        %INCLUDE TD_CP6;
      114     7191        %INCLUDE CP_6_SUBS;
      115     7731
      116     7732
      117     7733        /**/
      118     7734        /* MACROS */
      119     7735        /**/
      120     7736        %MACRO $ERROR (NAME=GORGO,CODE=0,SEV=SEV_ERROR#);
      121     7737        DCL 1 NAME CONSTANT ALIGNED,
      122     7738              2 * BIT(18) UNAL INIT('061715'O),
      123     7739              2 * UBIN(15) UNAL INIT(CODE),
      124     7740              2 * UBIN(3) UNAL INIT(SEV);
      125     7741        %MEND;
      126     7742
      127     7743
      128     7744        /**/
      129     7745        /* PARAMETERS */
      130     7746        /**/
      131     7747    1   DCL FPTCODE UBIN WORD;
      132     7748
      133     7749
      134     7750        /**/
      135     7751        /* BASED STRUCTURES */
      136     7752        /**/
      137     7753        %KV_VDO_ALL_E;
      138     7832        %NK$LDCT;
      139     7878        %KQ_CG (FPTN=KQ$CG,STCLASS=BASED);
      140     8617        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      141     8956        %FOM$SYMB (NAME=FO$SYMB);
      142     8988        %FPT$SYMBIO_V (FPTN=FPT$SYMBIO_V,BASED="BASED(B$PS0$)");
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:35   
      143     8993        %VLP$SYMBEXTENT_V (FPTN=VLP$EXTENT,BASED="BASED(B$PS1$)");
      144     8996        %B$JIT0;
      145     9085        %U$JIT1X;
      146     9088        %M$JIT2X;
      147     9091        %F$JIT3;
      148     9096        %A$JIT6X;
      149     9099        %N$REQ;
      150     9157        %FOM$TABS;
      151     9160    1   DCL VLP$STATION CHAR(8) BASED(B$PS3$);
      152     9161    1   DCL VLP$FORM CHAR(6) BASED(B$PS5$);
      153     9162        /**/
      154     9163        %FR$RAT;
      155     9203        %NI$DCT (NAME=DCT,STCLASS="BASED(DCT$)");
      156     9251    1   DCL N$DCT$(0:0) PTR BASED;
      157     9252
      158     9253
      159     9254        /**/
      160     9255        /* AUTO */
      161     9256        /**/
      162     9257    1   DCL ORDER UBIN WORD;
      163     9258    1   DCL LDCT$ PTR;
      164     9259    1   DCL SYMB$ PTR;
      165     9260    1   DCL DAD UBIN WORD;
      166     9261    1   DCL SETX UBIN HALF;
      167     9262    1   DCL TEMP UBIN WORD;
      168     9263    1   DCL CG$ PTR;
      169     9264    1   DCL STA$ PTR;
      170     9265    1   DCL STALOCK UBIN;
      171     9266        %K$RWPARM (NAME=K$RWPARM,STCLASS="");
      172     9582        %FPT_SYSCON (FPTN=FPT_SYSCON,STCLASS=AUTO);
      173     9599    1   DCL RESULT SBIN;
      174     9600    1   DCL ERR SBIN;
      175     9601    1   DCL SAVEPRIV BIT(36);
      176     9602    1   DCL DCTX UBIN(36);
      177     9603    1   DCL DCT$ PTR;
      178     9604
      179     9605
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:36   
      180     9606        /**/
      181     9607        /* CONSTANT */
      182     9608        /**/
      183     9609        %$ERROR (NAME=E_NAUTH,CODE=%E$NOTAUTH);
      184     9615        %$ERROR (NAME=E_NOSTA,CODE=%E$NOSTA);
      185     9621        %$ERROR (NAME=E_BSYSY,CODE=%E$BSYSY);
      186     9627        %$ERROR (NAME=E_NHLTD,CODE=%E$NHLTD);
      187     9633        %$ERROR (NAME=E_XTEXT,CODE=%E$XTEXT);
      188     9639        %$ERROR (NAME=E_NSBLK,CODE=%E$NSBLK);
      189     9645        %$ERROR (NAME=E_NVMEM,CODE=%E$NVMEM);
      190     9651        %$ERROR (NAME=E_NSCLS,CODE=%E$NSCLS);
      191     9657        %$ERROR (NAME=E_NOHLT,CODE=%E$NOHLT);
      192     9663        %$ERROR (NAME=E_BADFC,CODE=%E$BADFC);
      193     9669        %$ERROR (NAME=E_LOCAL,CODE=%E$LOCAL);
      194     9675        %$ERROR (NAME=E_BADEXT,CODE=%E$BADEXT);
      195     9681        %$ERROR (NAME=E_ALGNDSC,CODE=%E$ALGNDSC);
      196     9687        %$ERROR (NAME=E_FPABRT,CODE=%E$FPABRT);
      197     9693        %FOM$SYMB (NAME=INITSBLK,STCLASS=CONSTANT);
      198     9725
      199     9726
      200     9727        /**/
      201     9728        /* REFS */
      202     9729        /**/
      203     9730    1   DCL B$JIT$ PTR SYMREF;
      204     9731    1   DCL B$PS0$ PTR SYMREF;
      205     9732    1   DCL B$PS1$ PTR SYMREF;
      206     9733    1   DCL B$PS2$ PTR SYMREF;
      207     9734    1   DCL B$PS3$ PTR SYMREF;
      208     9735    1   DCL B$PS4$ PTR SYMREF;
      209     9736    1   DCL B$PS5$ PTR SYMREF;
      210     9737    1   DCL S_CUN UBIN WORD SYMREF;
      211     9738    1   DCL FAF$SRTODR         ENTRY(2) ALTRET;
      212     9739    1   DCL FOM$DISKQ          ENTRY(1) ALTRET;
      213     9740    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
      214     9741    1   DCL FOM$REL            ENTRY(1) ALTRET;
      215     9742    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
      216     9743    1   DCL FOM$WRITE          ENTRY(1);
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:37   
      217     9744    1   DCL KCD$ACTRM          ENTRY(1);
      218     9745    1   DCL KCD$DACTRM         ENTRY(1);
      219     9746    1   DCL KIA$FCNOU          ENTRY(3) ALTRET;
      220     9747    1   DCL KQB$SRCH           ENTRY(3) ALTRET;
      221     9748    1   DCL KQP$UNLOCK         ENTRY(1) ALTRET;
      222     9749    1   DCL KQX$LDASR          ENTRY(1);
      223     9750    1   DCL MMS$VGET           ENTRY(4) ALTRET;
      224     9751    1   DCL MMS$VREL           ENTRY(2) ALTRET;
      225     9752    1   DCL NIQ$GET            ENTRY(1) ALTRET;
      226     9753    1   DCL NKF$FORM           ENTRY(2) ALTRET;
      227     9754    1   DCL NKL$GETDCT         ENTRY(1) ALTRET;
      228     9755    1   DCL NKL$RELDCT         ENTRY(1) ALTRET;
      229     9756    1   DCL SSS$BLOCK          ENTRY;
      230     9757    1   DCL TDP$SYSCON         ENTRY(3) ALTRET;
      231     9758
      232     9759
      233     9760        /**/
      234     9761        /* SUBS */
      235     9762        /**/
      236     9763        %EQU_CG;
      237     9811        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      238     9812        %EJECT;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:38   
      239     9813    2         IF S_CUN~=JG_OUTSYM# THEN DO;

   9813  1 000002   000000 235000 xsym               LDA     S_CUN
         1 000003   000003 115007                    CMPA    3,DL
         1 000004   000011 600000 1                  TZE     s:9825

      240     9814    2           B$JIT.ERR=E_NAUTH;

   9814  1 000005   000000 236000 0                  LDQ     E_NAUTH
         1 000006   000000 470400 xsym               LDP0    B$JIT$
         1 000007   000012 756100                    STQ     10,,PR0

      241     9815        /*E* ERROR:        FOM-E$NOTAUTH-E
      242     9816             MESSAGE:      You are not permitted to use this service
      243     9817             MESSAGE1:     Only the system ghost OUTSYM may use M$SYMBIO. */
      244     9818    2           RETURN;

   9818  1 000010   000000 702200 xent               TSX2  ! X66_ARET

      245     9819    2           END;
      246     9820        /**/
      247     9821        /*       CHKEXT order here */
      248     9822        /**/
      249     9823                                      /* Validate beginning and ending
      250     9824                                         addresses of extent */
      251     9825    1         ORDER=FPT$SYMBIO_V.ORDER;

   9825  1 000011   000000 470400 xsym               LDP0    B$PS0$
         1 000012   000003 236100                    LDQ     3,,PR0
         1 000013   000022 772000                    QRL     18
         1 000014   200004 756100                    STQ     ORDER,,AUTO

      252     9826    1         IF ORDER = FOMO_CHEXT# THEN

   9826  1 000015   000007 116007                    CMPQ    7,DL
         1 000016   000057 601000 1                  TNZ     s:9840

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:39   
      253     9827    2           DO;

      254     9828    2           SETX=FPT$SYMBIO_V.SETX;

   9828  1 000017   000003 720100                    LXL0    3,,PR0
         1 000020   200010 740100                    STX0    SETX,,AUTO

      255     9829    2           DAD=VLP$EXTENT.DAD;

   9829  1 000021   000000 471400 xsym               LDP1    B$PS1$
         1 000022   100000 236100                    LDQ     0,,PR1
         1 000023   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000024   200007 756100                    STQ     DAD,,AUTO

      256     9830    2           CALL FAF$SRTODR (DAD,SETX) ALTRET(BAD_EXT);

   9830  1 000025   200010 633500                    EPPR3   SETX,,AUTO
         1 000026   200111 453500                    STP3    DCT$+7,,AUTO
         1 000027   200007 634500                    EPPR4   DAD,,AUTO
         1 000030   200110 454500                    STP4    DCT$+6,,AUTO
         1 000031   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000032   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000033   000000 701000 xent               TSX1    FAF$SRTODR
         1 000034   001425 702000 1                  TSX2    BAD_EXT

      257     9831    2           DAD=VLP$EXTENT.DAD+VLP$EXTENT.GRANS-1;

   9831  1 000035   000000 470400 xsym               LDP0    B$PS1$
         1 000036   000000 236100                    LDQ     0,,PR0
         1 000037   000033 772000                    QRL     27
         1 000040   200110 756100                    STQ     DCT$+6,,AUTO
         1 000041   000000 236100                    LDQ     0,,PR0
         1 000042   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000043   200110 036100                    ADLQ    DCT$+6,,AUTO
         1 000044   000001 136007                    SBLQ    1,DL
         1 000045   200007 756100                    STQ     DAD,,AUTO

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:40   
      258     9832    2           CALL FAF$SRTODR (DAD,SETX) ALTRET(BAD_EXT);

   9832  1 000046   200010 631500                    EPPR1   SETX,,AUTO
         1 000047   200111 451500                    STP1    DCT$+7,,AUTO
         1 000050   200007 633500                    EPPR3   DAD,,AUTO
         1 000051   200110 453500                    STP3    DCT$+6,,AUTO
         1 000052   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000053   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000054   000000 701000 xent               TSX1    FAF$SRTODR
         1 000055   001425 702000 1                  TSX2    BAD_EXT

      259     9833    2           RETURN;

   9833  1 000056   000000 702200 xent               TSX2  ! X66_ARET

      260     9834    2           END;
      261     9835        /**/
      262     9836        /*       FMNT order here */
      263     9837        /**/
      264     9838
      265     9839                                /* Now block to master */
      266     9840    1         CALL SSS$BLOCK;

   9840  1 000057   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000060   000000 701000 xent               TSX1    SSS$BLOCK
         1 000061   000000 011000                    NOP     0

      267     9841    1         IF ORDER = FOMO_FMNT# THEN

   9841  1 000062   200004 235100                    LDA     ORDER,,AUTO
         1 000063   000012 115007                    CMPA    10,DL
         1 000064   000075 601000 1                  TNZ     s:9850

      268     9842    2           DO;

      269     9843    2           CALL NKF$FORM (VLP$STATION,VLP$FORM);

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:41   
   9843  1 000065   000000 236000 xsym               LDQ     B$PS5$
         1 000066   000000 235000 xsym               LDA     B$PS3$
         1 000067   200110 757100                    STAQ    DCT$+6,,AUTO
         1 000070   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000071   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000072   000000 701000 xent               TSX1    NKF$FORM
         1 000073   000000 011000                    NOP     0

      270     9844    2           RETURN;

   9844  1 000074   000000 702200 xent               TSX2  ! X66_ARET

      271     9845    2           END;
      272     9846        /**/
      273     9847
      274     9848        /**/
      275     9849        /**/     /* Normal orders here */
      276     9850    1         STALOCK=0;

   9850  1 000075   200014 450100                    STZ     STALOCK,,AUTO

      277     9851                                      /* Get pointer to device table entry
      278     9852                                         where write is destined */
      279     9853    1         LDCT$=NK$LDCT$(B$JIT$->B$JIT.DCB$->F$DCB.LDCTX);

   9853  1 000076   000000 470400 xsym               LDP0    B$JIT$
         1 000077   000232 471500                    LDP1    154,,PR0
         1 000100   100051 220100                    LDX0    41,,PR1
         1 000101   000000 473400 xsym               LDP3    N$DCT$$
         1 000102   300000 236110                    LDQ     0,X0,PR3
         1 000103   200005 756100                    STQ     LDCT$,,AUTO

      280     9854    1         CG$=LDCT$->NK$LDCT.CG$;

   9854  1 000104   200005 474500                    LDP4    LDCT$,,AUTO
         1 000105   400027 236100                    LDQ     23,,PR4
         1 000106   200012 756100                    STQ     CG$,,AUTO
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:42   

      281     9855    1         CALL KQX$LDASR (CG$->KQ$CG);

   9855  1 000107   200012 630500                    EPPR0   CG$,,AUTO
         1 000110   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000111   000000 701000 xent               TSX1    KQX$LDASR
         1 000112   000000 011000                    NOP     0

      282     9856              %LOCK (G=KQ$STREE.GATE);

   9857  1 000113   200012 236100                    LDQ     CG$,,AUTO
         1 000114   000075 036003                    ADLQ    61,DU
         1 000115   200110 756100                    STQ     DCT$+6,,AUTO
         1 000116   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000117   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000120   000000 701000 xent               TSX1    HFC$LOCK
         1 000121   000000 011000                    NOP     0

      283     9859                                      /* Locate station and make sure it's
      284     9860                                         active */
      285     9861    1         CALL KQB$SRCH (KQ$STREE,VLP$STATION,STA$) ALTRET(NOSTA);

   9861  1 000122   200013 630500                    EPPR0   STA$,,AUTO
         1 000123   200112 450500                    STP0    DCT$+8,,AUTO
         1 000124   000000 236000 xsym               LDQ     B$PS3$
         1 000125   200111 756100                    STQ     DCT$+7,,AUTO
         1 000126   200012 236100                    LDQ     CG$,,AUTO
         1 000127   000075 036003                    ADLQ    61,DU
         1 000130   200110 756100                    STQ     DCT$+6,,AUTO
         1 000131   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000132   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000133   000000 701000 xent               TSX1    KQB$SRCH
         1 000134   000160 702000 1                  TSX2    NOSTA

      286     9862                                      /* Lock station, thus preventing it
      287     9863                                         from disconnecting from COMGROUP */
      288     9864              %LOCK (G=STA$->KQ$STA.GATE);
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:43   

   9865  1 000135   200013 236100                    LDQ     STA$,,AUTO
         1 000136   000016 036003                    ADLQ    14,DU
         1 000137   200110 756100                    STQ     DCT$+6,,AUTO
         1 000140   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000141   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000142   000000 701000 xent               TSX1    HFC$LOCK
         1 000143   000000 011000                    NOP     0

      289     9867                                      /* Get device table entry pointer from
      290     9868                                         COMGROUP station (STA$ was aquired
      291     9869                                         from call to KQB$SRCH) */
      292     9870    1         LDCT$=STA$->KQ$STA.LDCT$;

   9870  1 000144   200013 470500                    LDP0    STA$,,AUTO
         1 000145   000010 236100                    LDQ     8,,PR0
         1 000146   200005 756100                    STQ     LDCT$,,AUTO

      293     9871                                      /* Is destination a valid logical device? */
      294     9872    1         IF LDCT$ = ADDR(NIL) THEN

   9872  1 000147   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000150   000170 601000 1                  TNZ     s:9885

      295     9873    2           DO;

   9861  1 000151                       NOSTA1       null
      296     9874    2   NOSTA1: ;
      297     9875                %UNLOCK (G=STA$->KQ$STA.GATE);

   9876  1 000151   200013 236100                    LDQ     STA$,,AUTO
         1 000152   000016 036003                    ADLQ    14,DU
         1 000153   200110 756100                    STQ     DCT$+6,,AUTO
         1 000154   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000156   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000157   000000 011000                    NOP     0
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:44   

   9876  1 000160                       NOSTA        null
      298     9878    2   NOSTA:  ;
      299     9879                %UNLOCK (G=KQ$STREE.GATE);

   9880  1 000160   200012 236100                    LDQ     CG$,,AUTO
         1 000161   000075 036003                    ADLQ    61,DU
         1 000162   200110 756100                    STQ     DCT$+6,,AUTO
         1 000163   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000164   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000165   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000166   000000 011000                    NOP     0

      300     9882    2           GOTO BAD_NAME;

   9882  1 000167   000245 710000 1                  TRA     BAD_NAME

      301     9883    2           END;
      302     9884    1         ELSE
      303     9885    1          IF (LDCT$->NK$LDCT.RESCOD ~= NK_CGTRM   AND

   9885  1 000170   200005 471500                    LDP1    LDCT$,,AUTO
         1 000171   100006 236100                    LDQ     6,,PR1
         1 000172   000017 376007                    ANQ     15,DL
         1 000173   000002 116007                    CMPQ    2,DL
         1 000174   000177 600000 1                  TZE     s:9892
         1 000175   000011 116007                    CMPQ    9,DL
         1 000176   000151 601000 1                  TNZ     NOSTA1

      304     9886    1          LDCT$->NK$LDCT.RESCOD ~= NK_CGFPRG) THEN
      305     9887    1           GOTO NOSTA1;
      306     9888                                      /* COMGROUP stations were locked (above)
      307     9889                                         so they cannot be disconnected until
      308     9890                                         we allow it.  LOCKCNT tells if we
      309     9891                                         will allow disconnect. */
      310     9892    1         STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:45   
   9892  1 000177   000020 236100                    LDQ     16,,PR0
         1 000200   000001 036007                    ADLQ    1,DL
         1 000201   000020 552104                    STBQ    16,'04'O,PR0

      311     9893                                      /* STALOCK=1 means stations are unlocked */
      312     9894    1         STALOCK=1;

   9894  1 000202   000001 235007                    LDA     1,DL
         1 000203   200014 755100                    STA     STALOCK,,AUTO

      313     9895              %UNLOCK (G=STA$->KQ$STA.GATE);

   9896  1 000204   200013 236100                    LDQ     STA$,,AUTO
         1 000205   000016 036003                    ADLQ    14,DU
         1 000206   200110 756100                    STQ     DCT$+6,,AUTO
         1 000207   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000211   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000212   000000 011000                    NOP     0

      314     9898              %UNLOCK (G=KQ$STREE.GATE);

   9899  1 000213   200012 236100                    LDQ     CG$,,AUTO
         1 000214   000075 036003                    ADLQ    61,DU
         1 000215   200110 756100                    STQ     DCT$+6,,AUTO
         1 000216   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000217   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000220   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000221   000000 011000                    NOP     0

      315     9901        /**/
      316     9902        /*       CHORG order here */
      317     9903        /**/
      318     9904    1         IF ORDER = FOMO_CHORG# THEN

   9904  1 000222   200004 235100                    LDA     ORDER,,AUTO
         1 000223   000014 115007                    CMPA    12,DL
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:46   
         1 000224   000232 601000 1                  TNZ     s:9915

      319     9905    2           DO;

      320     9906    2           IF LDCT$->NK$LDCT.DFLG.LOCAL THEN GOTO NOTREMOTE;

   9906  1 000225   200005 470500                    LDP0    LDCT$,,AUTO
         1 000226   000006 236100                    LDQ     6,,PR0
         1 000227   002000 316007                    CANQ    1024,DL
         1 000230   001431 601000 1                  TNZ     NOTREMOTE

      321     9907                                      /* Unlock if necessary (shouldn't be
      322     9908                                         at this point) and return */
      323     9909    2           GOTO GETOUT;

   9909  1 000231   000250 710000 1                  TRA     GETOUT

      324     9910    2           END;
      325     9911                                /* IF WE FIND IT AND IT'S MARKED SYMBIONT
      326     9912                                   (I.E. HE'S ALREADY OPENED IT VIA M$SYMBIO),
      327     9913                                   THEN PICK UP THE POINTER TO THE SYMBIONT
      328     9914                                   CONTEXT BLK. */
      329     9915    1         IF LDCT$->NK$LDCT.DFLG.SYMBIONT THEN

   9915  1 000232   200005 470500                    LDP0    LDCT$,,AUTO
         1 000233   000006 236100                    LDQ     6,,PR0
         1 000234   020000 316007                    CANQ    8192,DL
         1 000235   000241 600000 1                  TZE     s:9918

      330     9916    1          SYMB$=LDCT$->NK$LDCT.SYMB$;

   9916  1 000236   000000 236100                    LDQ     0,,PR0
         1 000237   200006 756100                    STQ     SYMB$,,AUTO
         1 000240   000257 710000 1                  TRA     s:9934

      331     9917    1         ELSE              /* ELSE THIS BETTER BE AN OPEN PMME */
      332     9918    1          IF (ORDER ~= FOMO_SOPEN# AND ORDER ~= FOMO_LOAD#) THEN
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:47   

   9918  1 000241   000000 115003                    CMPA    0,DU
         1 000242   000257 600000 1                  TZE     s:9934
         1 000243   000015 115007                    CMPA    13,DL
         1 000244   000257 600000 1                  TZE     s:9934

      333     9919    2            DO;

      334     9920    2   BAD_NAME:;

   9920  1 000245                       BAD_NAME     null
      335     9921    2            B$JIT.ERR=E_NOSTA;

   9921  1 000245   000001 236000 0                  LDQ     E_NOSTA
         1 000246   000000 470400 xsym               LDP0    B$JIT$
         1 000247   000012 756100                    STQ     10,,PR0

   9921  1 000250                       GETOUT       null
      336     9922        /*E* ERROR:        FOM-E$NOSTA-E
      337     9923             MESSAGE:      M$SYMBIO can't find that device
      338     9924             DESCRIPTION:  The STATION specified on M$SYMBIO was either not
      339     9925                           found on the OSCG, or was found but was not
      340     9926                           symbiont. */
      341     9927    2   GETOUT:  ;
      342     9928    2            IF STALOCK ~= 0 THEN CALL KQP$UNLOCK (STA$->KQ$STA);

   9928  1 000250   200014 235100                    LDA     STALOCK,,AUTO
         1 000251   000256 600000 1                  TZE     s:9929

   9928  1 000252   200013 630500                    EPPR0   STA$,,AUTO
         1 000253   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000254   000000 701000 xent               TSX1    KQP$UNLOCK
         1 000255   000000 011000                    NOP     0

      343     9929    2            RETURN;

   9929  1 000256   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:48   

      344     9930    2            END;
      345     9931        /* NOW WE'RE STATISFIED THAT ALL IS COOL.  WE HAVE THE POINTER TO
      346     9932           THE DEVICE'S LDCT, AND THE POINTER TO THE SYMB CONTEXT BLK IF
      347     9933           THERE IS ONE (I.E. IF THE THING IS ALREADY OPEN AS SYMBIONT). */
      348     9934    1         CALL PROCIT ALTRET(BAD_NAME);

   9934  1 000257   000262 701000 1                  TSX1    PROCIT
         1 000260   000245 702000 1                  TSX2    BAD_NAME

      349     9935    1         GOTO GETOUT;

   9935  1 000261   000250 710000 1                  TRA     GETOUT

      350     9936    1   PROCIT: PROC ALTRET;

   9936  1 000262   200104 741300       PROCIT       STX1  ! DCT$+2,,AUTO

      351     9937        /***
      352     9938         ***
      353     9939         ***
      354     9940         ***     DO CASE FOR M$SYMBIO FUNCTION CODE
      355     9941         ***
      356     9942         ***
      357     9943         ***/
      358     9944
      359     9945    3           DO CASE (ORDER);

   9945  1 000263   200004 235100                    LDA     ORDER,,AUTO
         1 000264   000016 115007                    CMPA    14,DL
         1 000265   000267 602005 1                  TNC     s:9945+4,AL
         1 000266   001340 710000 1                  TRA     s:10390
         1 000267   000305 710000 1                  TRA     s:9957
         1 000270   000715 710000 1                  TRA     s:10181
         1 000271   000523 710000 1                  TRA     DOCONT
         1 000272   001120 710000 1                  TRA     s:10273
         1 000273   001227 710000 1                  TRA     s:10349
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:49   
         1 000274   000467 710000 1                  TRA     s:10055
         1 000275   001007 710000 1                  TRA     s:10227
         1 000276   001340 710000 1                  TRA     s:10390
         1 000277   000517 710000 1                  TRA     s:10071
         1 000300   001132 710000 1                  TRA     s:10289
         1 000301   001340 710000 1                  TRA     s:10390
         1 000302   001213 710000 1                  TRA     s:10334
         1 000303   001340 710000 1                  TRA     s:10390
         1 000304   000305 710000 1                  TRA     s:9957

      360     9946        /**
      361     9947         **
      362     9948         **
      363     9949         **      SYMBIONT OPEN
      364     9950         **
      365     9951         **
      366     9952         **/
      367     9953    3             CASE (FOMO_SOPEN#,FOMO_LOAD#);

      368     9954
      369     9955                                     /* LDCT$ is device table entry pointer
      370     9956                                        (for COMGROUP station) */
      371     9957    3               IF LDCT$->NK$LDCT.DFLG.SYMBIONT

   9957  1 000305   200005 470500                    LDP0    LDCT$,,AUTO
         1 000306   000006 236100                    LDQ     6,,PR0
         1 000307   020000 316007                    CANQ    8192,DL
         1 000310   000316 601000 1                  TNZ     s:9961
         1 000311   000011 236100                    LDQ     9,,PR0
         1 000312   000040 316003                    CANQ    32,DU
         1 000313   000323 600000 1                  TZE     s:9969
         1 000314   000000 115003                    CMPA    0,DU
         1 000315   000323 601000 1                  TNZ     s:9969

      372     9958    3               OR (LDCT$->NK$LDCT.LKFLG.ACTIVE AND (ORDER = FOMO_SOPEN#))
      373     9959    3               THEN
      374     9960    4                 DO;      /* ALREADY ACTIVE ON THIS DEVICE */
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:50   

      375     9961    4                 B$JIT.ERR=E_BSYSY;

   9961  1 000316   000002 236000 0                  LDQ     E_BSYSY
         1 000317   000000 471400 xsym               LDP1    B$JIT$
         1 000320   100012 756100                    STQ     10,,PR1

      376     9962        /*E* ERROR:        FOM-E$BSYSY-E
      377     9963             MESSAGE:      M$SYMBIO can't open a busy symbiont
      378     9964             DESCRIPTION:  The symbiont that the user is trying to open
      379     9965                           is already open.  */
      380     9966    4                 RETURN;

   9966  1 000321   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 000322   000001 702211                    TSX2  ! 1,X1

      381     9967    4                 END;
      382     9968                           /* ELSE GET A SYMB CONTEXT BLK */
      383     9969    3               CALL NKL$GETDCT (SYMB$) ALTRET(NODCTS);

   9969  1 000323   200006 631500                    EPPR1   SYMB$,,AUTO
         1 000324   200110 451500                    STP1    DCT$+6,,AUTO
         1 000325   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000326   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000327   000000 701000 xent               TSX1    NKL$GETDCT
         1 000330   001362 702000 1                  TSX2    NODCTS

      384     9970                                /* PICK UP LDCTX OF NEW ENTRY */
      385     9971    3               TEMP=SYMB$->NK$LDCT.LDCTX;

   9971  1 000331   200006 470500                    LDP0    SYMB$,,AUTO
         1 000332   000006 236100                    LDQ     6,,PR0
         1 000333   000022 772000                    QRL     18
         1 000334   200011 756100                    STQ     TEMP,,AUTO

      386     9972                                /* BLAST OUT THE TABLE POINTER TO IT */
      387     9973    3               NK$LDCT$(TEMP)=ADDR(NIL);
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:51   

   9973  1 000335   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000336   000000 471400 xsym               LDP1    N$DCT$$
         1 000337   200011 720100                    LXL0    TEMP,,AUTO
         1 000340   100000 756110                    STQ     0,X0,PR1

      388     9974                                /* INITIALIZE IT W/ SYMB CONTEXT INIT */
      389     9975    3               SYMB$->FO$SYMB=INITSBLK;

   9975  1 000341   200006 470500                    LDP0    SYMB$,,AUTO
         1 000342   000100 100400                    MLR     fill='000'O
         1 000343   000016 000120 0                  ADSC9   INITSBLK                 cn=0,n=80
         1 000344   000000 000120                    ADSC9   0,,PR0                   cn=0,n=80

      390     9976                                /* REMEMBER ITS OWN LDCTX */
      391     9977                                      /* Save LDCTX for restoration (later) */
      392     9978    3               SYMB$->FO$SYMB.LDCTX=TEMP;

   9978  1 000345   200006 470500                    LDP0    SYMB$,,AUTO
         1 000346   200011 236100                    LDQ     TEMP,,AUTO
         1 000347   000022 736000                    QLS     18
         1 000350   000010 676100                    ERQ     8,,PR0
         1 000351   077777 376003                    ANQ     32767,DU
         1 000352   000010 656100                    ERSQ    8,,PR0

      393     9979                                /* REMEMBER DEVICE LDCT INDEX */
      394     9980    3               SYMB$->FO$SYMB.DEVLDCTX=LDCT$->NK$LDCT.LDCTX;

   9980  1 000353   200005 471500                    LDP1    LDCT$,,AUTO
         1 000354   100006 221100                    LDX1    6,,PR1
         1 000355   000010 441100                    SXL1    8,,PR0

      395     9981                                      /* B$PS2$ is the 2nd parameter and contains
      396     9982                                         the pointer to OUTSYMs granule. I think
      397     9983                                         this call maps the OUTSYM granule into
      398     9984                                         the FEP page table.  This table refer-
      399     9985                                         ences areas of the FEP Working Storage
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:52   
      400     9986                                         Quarter, which gets accessed by the
      401     9987                                         FEP deblocker */
      402     9988    3               CALL MMS$VGET (FOM_WSQ,B$PS2$,4096,

   9988  1 000356   200006 236100                    LDQ     SYMB$,,AUTO
         1 000357   000002 036003                    ADLQ    2,DU
         1 000360   000001 235000 2                  LDA     1
         1 000361   200112 757100                    STAQ    DCT$+8,,AUTO
         1 000362   000002 237000 2                  LDAQ    2
         1 000363   200110 757100                    STAQ    DCT$+6,,AUTO
         1 000364   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000365   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000366   000000 701000 xent               TSX1    MMS$VGET
         1 000367   000454 702000 1                  TSX2    NOMEM1

      403     9989    3               SYMB$->FO$SYMB.BUF$) ALTRET(NOMEM1);
      404     9990                                /* IF THE TERMINAL DISCONNECTED, REL THE
      405     9991                                   SYMB CNTXT BLK AND ERROR THE USER */
      406     9992                    %LOCK (G=STA$->KQ$STA.GATE);

   9993  1 000370   200013 236100                    LDQ     STA$,,AUTO
         1 000371   000016 036003                    ADLQ    14,DU
         1 000372   200110 756100                    STQ     DCT$+6,,AUTO
         1 000373   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000374   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000375   000000 701000 xent               TSX1    HFC$LOCK
         1 000376   000000 011000                    NOP     0

      407     9995                                      /* IDSC means initiate disconnect */
      408     9996    3               IF STA$->KQ$STA.IDSC THEN

   9996  1 000377   200013 470500                    LDP0    STA$,,AUTO
         1 000400   000020 234100                    SZN     16,,PR0
         1 000401   000425 605000 1                  TPL     s:10025

      409     9997    4                 DO;

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:53   
      410     9998    4                 CALL MMS$VREL(FOM_WSQ,SYMB$->FO$SYMB.BUF$);

   9998  1 000402   200006 236100                    LDQ     SYMB$,,AUTO
         1 000403   000002 036003                    ADLQ    2,DU
         1 000404   000002 235000 2                  LDA     2
         1 000405   200110 757100                    STAQ    DCT$+6,,AUTO
         1 000406   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000407   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000410   000000 701000 xent               TSX1    MMS$VREL
         1 000411   000000 011000                    NOP     0

      411     9999    4                 CALL RELSYMB;

   9999  1 000412   001345 701000 1                  TSX1    RELSYMB
         1 000413   000000 011000                    NOP     0

      412    10000                      %UNLOCK (G=STA$->KQ$STA.GATE);

  10001  1 000414   200013 236100                    LDQ     STA$,,AUTO
         1 000415   000016 036003                    ADLQ    14,DU
         1 000416   200110 756100                    STQ     DCT$+6,,AUTO
         1 000417   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000420   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000421   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000422   000000 011000                    NOP     0

   9998  1 000423                       ALTRT        null
      413    10003    4   ALTRT:        ;
      414    10004    4                 ALTRETURN;

  10004  1 000423   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 000424   000000 702211                    TSX2  ! 0,X1

      415    10005    4                 END;
      416    10006                                /* OTHERWISE, POINT THE TERMINAL LDCT AT
      417    10007                                  THE SYMB CNTXT BLK, AND MARK IT AS
      418    10008                                  OPENED-SYMBIONT */
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:54   
      419    10009    3               ELSE
      420    10010    4                 DO;

      421    10011                                      /* At this stage, LDCT$ points to the
      422    10012                                         COMGROUP station's LDCT.  Assign the
      423    10013                                         the symbiont context block pointer
      424    10014                                         to SYMB$ in the output device's LDCT,
      425    10015                                         make the device a symbiont device, and
      426    10016                                         allow this symbiont device to discon-
      427    10017                                         nect from the COMGROUP.
      428    10018                                         NOTE: MOOS participates in COMGROUP
      429    10019                                         disconnects of symbiont devices. The
      430    10020                                         reason for the gate lock (above) is
      431    10021                                         so the device cannot disconnect until
      432    10022                                         all of the proper flags are set (these
      433    10023                                         flags inform the   COMGROUP that MOOS
      434    10024                                         must be called upon disconnect). */
      435    10025    4                 LDCT$->NK$LDCT.SYMB$=SYMB$;

  10025  1 000425   200006 236100                    LDQ     SYMB$,,AUTO
         1 000426   200005 471500                    LDP1    LDCT$,,AUTO
         1 000427   100000 756100                    STQ     0,,PR1

      436    10026    4                 LDCT$->NK$LDCT.DFLG.SYMBIONT='1'B;

  10026  1 000430   020000 236007                    LDQ     8192,DL
         1 000431   100006 256100                    ORSQ    6,,PR1

      437    10027                      %UNLOCK (G=STA$->KQ$STA.GATE);

  10028  1 000432   200013 236100                    LDQ     STA$,,AUTO
         1 000433   000016 036003                    ADLQ    14,DU
         1 000434   200110 756100                    STQ     DCT$+6,,AUTO
         1 000435   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000436   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000437   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000440   000000 011000                    NOP     0
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:55   

      438    10030    4                 END;

      439    10031                                /* ACTIVATE THE DEVICE */
      440    10032    3               IF ORDER = FOMO_SOPEN#

  10032  1 000441   200004 235100                    LDA     ORDER,,AUTO
         1 000442   000447 601000 1                  TNZ     s:10038

      441    10033    3               THEN
      442    10034    3                CALL KCD$ACTRM (LDCT$->NK$LDCT);

  10034  1 000443   200005 630500                    EPPR0   LDCT$,,AUTO
         1 000444   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000445   000000 701000 xent               TSX1    KCD$ACTRM
         1 000446   000000 011000                    NOP     0

      443    10035                                /* MERGE IN DISK SETX */
      444    10036                                      /* Assign packset where symbiont granule
      445    10037                                         resides */
      446    10038    3               SYMB$->FO$SYMB.SETX=FPT$SYMBIO_V.SETX;

  10038  1 000447   000000 470400 xsym               LDP0    B$PS0$
         1 000450   000003 720100                    LXL0    3,,PR0
         1 000451   200006 471500                    LDP1    SYMB$,,AUTO
         1 000452   100012 740100                    STX0    10,,PR1

      447    10039                                /* FROM NOW ON, IT'S JUST LIKE A CONTINUE
      448    10040                                   OF A HALTED SYMBIONT */
      449    10041    3               GOTO CONTINUE;

  10041  1 000453   000546 710000 1                  TRA     CONTINUE

  10038  1 000454                       NOMEM1       null
      450    10042    3   NOMEM1:     ;
      451    10043    3               SYMB$->NK$LDCT.LDCTX=SYMB$->FO$SYMB.LDCTX;

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:56   
  10043  1 000454   200006 470500                    LDP0    SYMB$,,AUTO
         1 000455   000010 220100                    LDX0    8,,PR0
         1 000456   077777 360003                    ANX0    32767,DU
         1 000457   000006 740100                    STX0    6,,PR0

      452    10044    3               CALL NKL$RELDCT (SYMB$);

  10044  1 000460   200006 630500                    EPPR0   SYMB$,,AUTO
         1 000461   200110 450500                    STP0    DCT$+6,,AUTO
         1 000462   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000463   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000464   000000 701000 xent               TSX1    NKL$RELDCT
         1 000465   000000 011000                    NOP     0

      453    10045    3               GOTO NOMEM2;

  10045  1 000466   000711 710000 1                  TRA     NOMEM2

      454    10046        /**
      455    10047         **
      456    10048         **
      457    10049         **      START SPACING SYMBIONT (FROM HALT)
      458    10050         **
      459    10051         **
      460    10052         **/
      461    10053    3             CASE (FOMO_SSPAC#);

      462    10054
      463    10055    3               SYMB$->FO$SYMB.SPACETYPE=0;

  10055  1 000467   200006 470500                    LDP0    SYMB$,,AUTO
         1 000470   000004 236000 2                  LDQ     4
         1 000471   000012 356100                    ANSQ    10,,PR0

  10055  1 000472                       DOSPACE      null
      464    10056    3   DOSPACE:    ;
      465    10057    3               IF SYMB$->FO$SYMB.TAB$ = ADDR(NIL) THEN
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:57   

  10057  1 000472   200006 470500                    LDP0    SYMB$,,AUTO
         1 000473   000000 236100                    LDQ     0,,PR0
         1 000474   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000475   000516 601000 1                  TNZ     s:10067

      466    10058    4                 DO;

      467    10059    4                 CALL NKL$GETDCT(SYMB$->FO$SYMB.TAB$) ALTRET(NODCTS);

  10059  1 000476   200006 630500                    EPPR0   SYMB$,,AUTO
         1 000477   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000500   000000 701000 xent               TSX1    NKL$GETDCT
         1 000501   001362 702000 1                  TSX2    NODCTS

      468    10060    4                 TEMP=SYMB$->FO$SYMB.TAB$->NK$LDCT.LDCTX;

  10060  1 000502   200006 470500                    LDP0    SYMB$,,AUTO
         1 000503   000000 471500                    LDP1    0,,PR0
         1 000504   100006 236100                    LDQ     6,,PR1
         1 000505   000022 772000                    QRL     18
         1 000506   200011 756100                    STQ     TEMP,,AUTO

      469    10061    4                 NK$LDCT$(TEMP)=ADDR(NIL);

  10061  1 000507   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000510   000000 473400 xsym               LDP3    N$DCT$$
         1 000511   200011 720100                    LXL0    TEMP,,AUTO
         1 000512   300000 756110                    STQ     0,X0,PR3

      470    10062    4                 SYMB$->FO$SYMB.TAB$->FO$TABS.LDCTX=TEMP;

  10062  1 000513   200006 470500                    LDP0    SYMB$,,AUTO
         1 000514   000000 471500                    LDP1    0,,PR0
         1 000515   100000 740100                    STX0    0,,PR1

      471    10063    4                 END;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:58   

      472    10064                                      /* Go reactivate the device and map the
      473    10065                                         OUTSYM granule in the FEP WSQ.  If
      474    10066                                         ORDER = write, then start writing */
      475    10067    3               GOTO DOCONT;

  10067  1 000516   000523 710000 1                  TRA     DOCONT

      476    10068
      477    10069    3             CASE (FOMO_SSBLK#);

      478    10070
      479    10071    3               SYMB$->FO$SYMB.SPACETYPE=1;

  10071  1 000517   200006 470500                    LDP0    SYMB$,,AUTO
         1 000520   020000 236007                    LDQ     8192,DL
         1 000521   000012 256100                    ORSQ    10,,PR0

      480    10072    3               GOTO DOSPACE;

  10072  1 000522   000472 710000 1                  TRA     DOSPACE

      481    10073        /**
      482    10074         **
      483    10075         **
      484    10076         **      SYMBIONT CONTINUE (FROM HALT)
      485    10077         **
      486    10078         **
      487    10079         **/
      488    10080
      489    10081                                /* THE SYMBIONT CONTEXT BLOCK IS STILL
      490    10082                                   THERE BUT ALL OTHER STUFF WAS RELEASED
      491    10083                                   WHEN WE HALTED, SO IT MUST BE
      492    10084                                   RE-ACQUIRED. */
      493    10085
      494    10086    3             CASE (FOMO_SCONT#);

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:59   
  10072  1 000523                       DOCONT       null
      495    10087
      496    10088    3   DOCONT:     ;
      497    10089                                /* MAKE SURE IT'S HALTED, AND IF SO, SET IT
      498    10090                                   BUSY */
      499    10091                                      /* Reactivate the device and map the
      500    10092                                         OUTSYM granule into the FEP WSQ.  If
      501    10093                                         ORDER = write, then commence writing */
      502    10094    4                 DO INHIBIT;

      503    10095    4                 IF SYMB$->FO$SYMB.STATE~=FOMS_HELD# THEN GOTO BADCNT;

  10095  1 000523   200006 470700                    LDP0  ! SYMB$,,AUTO
         1 000524   000012 236300                    LDQ   ! 10,,PR0
         1 000525   000017 376207                    ANQ   ! 15,DL
         1 000526   000005 116207                    CMPQ  ! 5,DL
         1 000527   001367 601200 1                  TNZ   ! BADCNT

      504    10096    4                 SYMB$->FO$SYMB.STATE=FOMS_ACTV#;

  10096  1 000530   000012 236300                    LDQ   ! 10,,PR0
         1 000531   000005 376200 2                  ANQ   ! 5
         1 000532   000006 276207                    ORQ   ! 6,DL
         1 000533   000012 756300                    STQ   ! 10,,PR0

      505    10097    4                 END;

      506    10098    3               CALL MMS$VGET (FOM_WSQ,B$PS2$,4096,

  10098  1 000534   200006 236100                    LDQ     SYMB$,,AUTO
         1 000535   000002 036003                    ADLQ    2,DU
         1 000536   000001 235000 2                  LDA     1
         1 000537   200112 757100                    STAQ    DCT$+8,,AUTO
         1 000540   000002 237000 2                  LDAQ    2
         1 000541   200110 757100                    STAQ    DCT$+6,,AUTO
         1 000542   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000543   000022 631400 xsym               EPPR1   B_VECTNIL+18
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:60   
         1 000544   000000 701000 xent               TSX1    MMS$VGET
         1 000545   000700 702000 1                  TSX2    NOMEM

      507    10099    3               SYMB$->FO$SYMB.BUF$) ALTRET(NOMEM);

  10099  1 000546                       CONTINUE     null
      508    10100
      509    10101        /* COME HERE TO CONTINUE */
      510    10102    3   CONTINUE:   ;
      511    10103
      512    10104                                      /* A number of IOQ packets are assigned
      513    10105                                         in TIGR. This call pulls the 1st one
      514    10106                                         off the free list and returns a pointer
      515    10107                                         to it. */
      516    10108    3               CALL NIQ$GET (SYMB$->FO$SYMB.IOQ$);

  10108  1 000546   200006 236100                    LDQ     SYMB$,,AUTO
         1 000547   000001 036003                    ADLQ    1,DU
         1 000550   200110 756100                    STQ     DCT$+6,,AUTO
         1 000551   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000552   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000553   000000 701000 xent               TSX1    NIQ$GET
         1 000554   000000 011000                    NOP     0

      517    10109
      518    10110    3               SYMB$->FO$SYMB.IOQ$->N$REQ.NOALT='1'B;

  10110  1 000555   200006 470500                    LDP0    SYMB$,,AUTO
         1 000556   000001 471500                    LDP1    1,,PR0
         1 000557   100000 236007                    LDQ     32768,DL
         1 000560   100004 256100                    ORSQ    4,,PR1

      519    10111                                      /* Assign pointer to symbiont context blk */
      520    10112    3               SYMB$->FO$SYMB.IOQ$->N$REQ.EAINFOP$=SYMB$;

  10112  1 000561   200006 470500                    LDP0    SYMB$,,AUTO
         1 000562   000001 471500                    LDP1    1,,PR0
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:61   
         1 000563   200006 236100                    LDQ     SYMB$,,AUTO
         1 000564   100024 756100                    STQ     20,,PR1

      521    10113                                      /* Assign pointer to OUTSYMs granule,
      522    10114                                         which was mapped into the FEP WSQ
      523    10115                                         (above). */
      524    10116    3               SYMB$->FO$SYMB.IOQ$->N$REQ.BUF$=SYMB$->FO$SYMB.BUF$;

  10116  1 000565   000001 471500                    LDP1    1,,PR0
         1 000566   000002 236100                    LDQ     2,,PR0
         1 000567   100005 756100                    STQ     5,,PR1

      525    10117                                /* PICK UP USER-PASSED BLK-REC */
      526    10118                                      /* Assign the block-rec where we are
      527    10119                                         to commence printing */
      528    10120    3               SYMB$->FO$SYMB.BR=FPT$SYMBIO_V.BLKREC;

  10120  1 000570   000000 470400 xsym               LDP0    B$PS0$
         1 000571   000006 236100                    LDQ     6,,PR0
         1 000572   200006 471500                    LDP1    SYMB$,,AUTO
         1 000573   100003 756100                    STQ     3,,PR1

      529    10121    3               IF FPT$SYMBIO_V.BLKREC.BLK = 0 AND

  10121  1 000574   000006 220100                    LDX0    6,,PR0
         1 000575   000603 601000 1                  TNZ     s:10125
         1 000576   000006 721100                    LXL1    6,,PR0
         1 000577   000001 101003                    CMPX1   1,DU
         1 000600   000603 601000 1                  TNZ     s:10125

      530    10122    3               FPT$SYMBIO_V.BLKREC.REC = 1 THEN
      531    10123    3                SYMB$ -> FO$SYMB.PGDONE = 0;

  10123  1 000601   200006 471500                    LDP1    SYMB$,,AUTO
         1 000602   100013 450100                    STZ     11,,PR1

      532    10124                                      /* Allow for "Q"ing of next extent */
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:62   
      533    10125    3               SYMB$->FO$SYMB.NXTEXT='0'B;

  10125  1 000603   200006 471500                    LDP1    SYMB$,,AUTO
         1 000604   100006 450100                    STZ     6,,PR1
         1 000605   100007 450100                    STZ     7,,PR1

      534    10126                                /* BREAK OUT IF WRITE ORDER */
      535    10127    3               IF ORDER = FOMO_WRITE# THEN GOTO DOWRITE;

  10127  1 000606   200004 235100                    LDA     ORDER,,AUTO
         1 000607   000011 115007                    CMPA    9,DL
         1 000610   001136 600000 1                  TZE     DOWRITE

      536    10128    3               SYMB$->FO$SYMB.CUREXT=VLP$EXTENT;

  10128  1 000611   200006 471500                    LDP1    SYMB$,,AUTO
         1 000612   000000 473400 xsym               LDP3    B$PS1$
         1 000613   300000 237100                    LDAQ    0,,PR3
         1 000614   100004 755100                    STA     4,,PR1
         1 000615   100005 756100                    STQ     5,,PR1

      537    10129                                /* ASK FOR NEXT EXTENT */
      538    10130    3               IF SYMB$->FO$SYMB.CUREXT THEN

  10130  1 000616   200006 471500                    LDP1    SYMB$,,AUTO
         1 000617   000000 106500                    CMPC    fill='000'O
         1 000620   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         1 000621   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         1 000622   000634 600000 1                  TZE     s:10134

      539    10131                                      /* Ask OUTSYM for next extent */
      540    10132    3                CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_SFEXT#,0);

  10132  1 000623   000007 236000 2                  LDQ     7
         1 000624   200112 756100                    STQ     DCT$+8,,AUTO
         1 000625   000010 236000 2                  LDQ     8
         1 000626   200006 235100                    LDA     SYMB$,,AUTO
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:63   
         1 000627   200110 757100                    STAQ    DCT$+6,,AUTO
         1 000630   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000631   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000632   000000 701000 xent               TSX1    FOM$TELLAU
         1 000633   000000 011000                    NOP     0

      541    10133                                /* QUEUE THE NEXT DISK READ */
      542    10134    3               IF  ORDER = FOMO_SSPAC#

  10134  1 000634   200004 235100                    LDA     ORDER,,AUTO
         1 000635   000005 115007                    CMPA    5,DL
         1 000636   000641 600000 1                  TZE     s:10137
         1 000637   000010 115007                    CMPA    8,DL
         1 000640   000672 601000 1                  TNZ     s:10150

      543    10135    3               OR ORDER = FOMO_SSBLK# THEN
      544    10136    4                 DO;

      545    10137    4                 IF SYMB$->FO$SYMB.BR='0'B

  10137  1 000641   200006 470500                    LDP0    SYMB$,,AUTO
         1 000642   000003 235100                    LDA     3,,PR0
         1 000643   000646 601000 1                  TNZ     s:10142

      546    10138    4                 THEN
      547    10139    5                   DO;

      548    10140    5                   SYMB$->FO$SYMB.XMVFU='1'B;

  10140  1 000644   000020 236007                    LDQ     16,DL
         1 000645   000012 256100                    ORSQ    10,,PR0

      549    10141    5                   END;

      550    10142    4                 SYMB$->FO$SYMB.SPACING='1'B;

  10142  1 000646   040000 236007                    LDQ     16384,DL
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:64   
         1 000647   000012 256100                    ORSQ    10,,PR0

      551    10143    4                 SYMB$->FO$SYMB.SPACEPAGES=FPT$SYMBIO_V.SPACEPAGES;

  10143  1 000650   000000 471400 xsym               LDP1    B$PS0$
         1 000651   100005 720100                    LXL0    5,,PR1
         1 000652   000011 740100                    STX0    9,,PR0

      552    10144    4                 SYMB$->FO$SYMB.SPACEREC#=FPT$SYMBIO_V.SPACEREC;

  10144  1 000653   100012 236100                    LDQ     10,,PR1
         1 000654   000011 736000                    QLS     9
         1 000655   000011 552110                    STBQ    9,'10'O,PR0

      553    10145    4                 SYMB$->FO$SYMB.PAGES=FPT$SYMBIO_V.PAGES;

  10145  1 000656   100004 236100                    LDQ     4,,PR1
         1 000657   000014 736000                    QLS     12
         1 000660   000012 676100                    ERQ     10,,PR0
         1 000661   010000 376007                    ANQ     4096,DL
         1 000662   000012 656100                    ERSQ    10,,PR0

      554    10146    4                 SYMB$->FO$SYMB.CPVFC=FPT$SYMBIO_V.CPVFC;

  10146  1 000663   100004 236100                    LDQ     4,,PR1
         1 000664   000004 736000                    QLS     4
         1 000665   000012 676100                    ERQ     10,,PR0
         1 000666   000040 376007                    ANQ     32,DL
         1 000667   000012 656100                    ERSQ    10,,PR0

      555    10147    4                 SYMB$->FO$SYMB.FIRSTSPACE='1'B;

  10147  1 000670   000200 236007                    LDQ     128,DL
         1 000671   000012 256100                    ORSQ    10,,PR0

      556    10148    4                 END;

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:65   
      557    10149                                      /* Put next extent on disk queue */
      558    10150    3               CALL FOM$DISKQ (SYMB$->FO$SYMB);

  10150  1 000672   200006 630500                    EPPR0   SYMB$,,AUTO
         1 000673   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000674   000000 701000 xent               TSX1    FOM$DISKQ
         1 000675   000000 011000                    NOP     0

      559    10151    3               RETURN;

  10151  1 000676   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 000677   000001 702211                    TSX2  ! 1,X1

  10144  1 000700                       NOMEM        null
      560    10152                                /* NO VIRTUAL MEMORY TO MAP BUFFER */
      561    10153    3   NOMEM:      ;
      562    10154                                /* CHANGE STATE TO HELD, AND OUTSYM WILL
      563    10155                                   TRY LATER */
      564    10156    3               CALL FOM$EVENT(SYMB$->FO$SYMB,FOSE_HLTR,FOHR_NMEM#)

  10156  1 000700   000011 236000 2                  LDQ     9
         1 000701   200112 756100                    STQ     DCT$+8,,AUTO
         1 000702   000012 236000 2                  LDQ     10
         1 000703   200006 235100                    LDA     SYMB$,,AUTO
         1 000704   200110 757100                    STAQ    DCT$+6,,AUTO
         1 000705   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 000706   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000707   000000 701000 xent               TSX1    FOM$EVENT
         1 000710   001367 702000 1                  TSX2    BADCNT

  10156  1 000711                       NOMEM2       null
      565    10157    3               ALTRET (BADCNT);
      566    10158    3   NOMEM2:     ;
      567    10159    3               B$JIT.ERR=E_NVMEM;

  10159  1 000711   000006 236000 0                  LDQ     E_NVMEM
         1 000712   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:66   
         1 000713   000012 756100                    STQ     10,,PR0
         1 000714   001343 710000 1                  TRA     s:10397

      568    10160        /*E* ERROR:        FOM-E$NVMEM-E
      569    10161             MESSAGE:      No virtual map space for output symbiont
      570    10162             DESCRIPTION:  Each OPEN or CONTINUE M$SYMBIO requires a page
      571    10163                           in the appropriate FEWSQ map, for the symbiont
      572    10164                           disc buffer.  This error occurs when the space
      573    10165                           is not available.  On an OPEN, the error results
      574    10166                           in a failed open; on a CONTINUE (or SPACE) the
      575    10167                           error results in the symbiont being left in state
      576    10168                           HELD.   */
      577    10169        /**
      578    10170         **
      579    10171         **
      580    10172         **      PASSING NEXT EXTENT
      581    10173         **
      582    10174         **
      583    10175         **/
      584    10176
      585    10177    3             CASE (FOMO_NXEXT#);

      586    10178
      587    10179                                      /* Get the output devices pointer to
      588    10180                                         the symbiont context block */
      589    10181    3               SYMB$=LDCT$->NK$LDCT.SYMB$;

  10181  1 000715   200005 470500                    LDP0    LDCT$,,AUTO
         1 000716   000000 236100                    LDQ     0,,PR0
         1 000717   200006 756100                    STQ     SYMB$,,AUTO

      590    10182    3               IF SYMB$->FO$SYMB.NXTEXT~='0'B THEN GOTO BADNXTEXT;

  10182  1 000720   200006 471500                    LDP1    SYMB$,,AUTO
         1 000721   000000 106500                    CMPC    fill='000'O
         1 000722   100006 000010                    ADSC9   6,,PR1                   cn=0,n=8
         1 000723   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:67   
         1 000724   001374 601000 1                  TNZ     BADNXTEXT

      591    10183
      592    10184    4                 DO INHIBIT;

      593    10185                                      /* Are we currently processing an extent? */
      594    10186    4                 IF SYMB$->FO$SYMB.CUREXT THEN

  10186  1 000725   000000 106700                    CMPC  ! fill='000'O
         1 000726   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         1 000727   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         1 000730   000753 600200 1                  TZE   ! s:10199

      595    10187    5                   DO;

      596    10188    5                   SYMB$->FO$SYMB.NXTEXT=VLP$EXTENT;

  10188  1 000731   000000 473600 xsym               LDP3  ! B$PS1$
         1 000732   300000 237300                    LDAQ  ! 0,,PR3
         1 000733   100006 755300                    STA   ! 6,,PR1
         1 000734   100007 756300                    STQ   ! 7,,PR1

      597    10189                                /* PRE-ADJUST FOR INCR/DECR IN FOM$NXDISK */
      598    10190                                      /* Adjust the file relative disk address */
      599    10191    5                   IF SYMB$->FO$SYMB.SPACING AND SYMB$->FO$SYMB.SPACEPAGES < 0

  10191  1 000735   200006 471700                    LDP1  ! SYMB$,,AUTO
         1 000736   100012 236300                    LDQ   ! 10,,PR1
         1 000737   040000 316207                    CANQ  ! 16384,DL
         1 000740   000747 600200 1                  TZE   ! s:10193
         1 000741   100011 220300                    LDX0  ! 9,,PR1
         1 000742   000747 605200 1                  TPL   ! s:10193

      600    10192    5                   THEN SYMB$->FO$SYMB.NXTEXT.STAMP.FRDAD=SYMB$->FO$SYMB.NXTEXT.STAMP.
             10192                            FRDAD+1;

  10192  1 000743   100007 236300                    LDQ   ! 7,,PR1
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:68   
         1 000744   000001 036207                    ADLQ  ! 1,DL
         1 000745   100007 552304                    STBQ  ! 7,'04'O,PR1
         1 000746   001006 710200 1                  TRA   ! s:10215

      601    10193    5                   ELSE SYMB$->FO$SYMB.NXTEXT.STAMP.FRDAD=SYMB$->FO$SYMB.NXTEXT.STAMP.
             10193                            FRDAD-1;

  10193  1 000747   100007 236300                    LDQ   ! 7,,PR1
         1 000750   000777 036207                    ADLQ  ! 511,DL
         1 000751   100007 552304                    STBQ  ! 7,'04'O,PR1

      602    10194    5                   END;

  10194  1 000752   001006 710200 1                  TRA   ! s:10215

      603    10195    4                 ELSE
      604    10196                                      /* Otherwise we don't have an extent, grab
      605    10197                                         this one and put it in CUREXT */
      606    10198    5                   DO;

      607    10199    5                   SYMB$->FO$SYMB.CUREXT=VLP$EXTENT;

  10199  1 000753   000000 473600 xsym               LDP3  ! B$PS1$
         1 000754   300000 237300                    LDAQ  ! 0,,PR3
         1 000755   100004 755300                    STA   ! 4,,PR1
         1 000756   100005 756300                    STQ   ! 5,,PR1

      608    10200                                /* IF WE'RE IDLE WAITING FOR GRANULES,
      609    10201                                   CRANK UP THE NEXT READ */
      610    10202    5                   IF SYMB$->FO$SYMB.STATE=FOMS_IDLE# THEN

  10202  1 000757   200006 471700                    LDP1  ! SYMB$,,AUTO
         1 000760   100012 236300                    LDQ   ! 10,,PR1
         1 000761   000017 316207                    CANQ  ! 15,DL
         1 000762   000773 601200 1                  TNZ   ! s:10210

      611    10203    6                     DO;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:69   

      612    10204    6                     SYMB$->FO$SYMB.STATE=FOMS_ACTV#;

  10204  1 000763   000005 376200 2                  ANQ   ! 5
         1 000764   000006 276207                    ORQ   ! 6,DL
         1 000765   100012 756300                    STQ   ! 10,,PR1

      613    10205    6                     CALL FOM$DISKQ (SYMB$->FO$SYMB);

  10205  1 000766   200006 630700                    EPPR0 ! SYMB$,,AUTO
         1 000767   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000770   000000 701200 xent               TSX1  ! FOM$DISKQ
         1 000771   000000 011200                    NOP   ! 0

      614    10206    6                     END;

  10206  1 000772   001006 710200 1                  TRA   ! s:10215

      615    10207    5                   ELSE
      616    10208    6                     DO;

      617    10209                                /* PRE-ADJUST FOR INCR/DECR IN FOM$NXDISK */
      618    10210    6                     IF SYMB$->FO$SYMB.SPACING AND SYMB$->FO$SYMB.SPACEPAGES < 0

  10210  1 000773   040000 316207                    CANQ  ! 16384,DL
         1 000774   001003 600200 1                  TZE   ! s:10212
         1 000775   100011 220300                    LDX0  ! 9,,PR1
         1 000776   001003 605200 1                  TPL   ! s:10212

      619    10211    6                    THEN SYMB$->FO$SYMB.CUREXT.STAMP.FRDAD=SYMB$->FO$SYMB.CUREXT.STAMP
             10211                              .FRDAD+1;

  10211  1 000777   100005 236300                    LDQ   ! 5,,PR1
         1 001000   000001 036207                    ADLQ  ! 1,DL
         1 001001   100005 552304                    STBQ  ! 5,'04'O,PR1
         1 001002   001006 710200 1                  TRA   ! s:10215

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:70   
      620    10212    6                    ELSE SYMB$->FO$SYMB.CUREXT.STAMP.FRDAD=SYMB$->FO$SYMB.CUREXT.STAMP
             10212                              .FRDAD-1;

  10212  1 001003   100005 236300                    LDQ   ! 5,,PR1
         1 001004   000777 036207                    ADLQ  ! 511,DL
         1 001005   100005 552304                    STBQ  ! 5,'04'O,PR1

      621    10213    6                     END;

      622    10214    5                   END;

      623    10215    4                 END;

  10215  1 001006   001343 710000 1                  TRA     s:10397

      624    10216        /**
      625    10217         **
      626    10218         **
      627    10219         **      SEND SYMBIONT TOKEN
      628    10220         **
      629    10221         **
      630    10222         **/
      631    10223    3             CASE (FOMO_STOKN#);

      632    10224
      633    10225                                      /* FEX = 0 means not remote */
      634    10226    4                 DO INHIBIT;

      635    10227    4                 IF SYMB$ -> FO$SYMB.EFLGB.IDSC

  10227  1 001007   200006 470700                    LDP0  ! SYMB$,,AUTO
         1 001010   000012 236300                    LDQ   ! 10,,PR0
         1 001011   000400 316207                    CANQ  ! 256,DL
         1 001012   001413 601200 1                  TNZ   ! BAD_ALDSC
         1 001013   000012 236300                    LDQ   ! 10,,PR0
         1 001014   000017 376207                    ANQ   ! 15,DL
         1 001015   000004 116207                    CMPQ  ! 4,DL
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:71   
         1 001016   001413 600200 1                  TZE   ! BAD_ALDSC

      636    10228    4                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
      637    10229    4                 THEN
      638    10230    4                  GOTO BAD_ALDSC;
      639    10231
      640    10232    4                 IF SYMB$ -> FO$SYMB.FPABRT = '1'B

  10232  1 001017   000021 430300                    FSZN  ! 17,,PR0
         1 001020   001420 604200 1                  TMI   ! BAD_ALFPRG

      641    10233    4                 THEN
      642    10234    4                  GOTO BAD_ALFPRG;
      643    10235    4                 IF LDCT$->NK$LDCT.DFLG.LOCAL THEN

  10235  1 001021   200005 471700                    LDP1  ! LDCT$,,AUTO
         1 001022   100006 236300                    LDQ   ! 6,,PR1
         1 001023   002000 316207                    CANQ  ! 1024,DL
         1 001024   001037 600200 1                  TZE   ! s:10238

      644    10236    4                  CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STOKN#,0);

  10236  1 001025   000007 236200 2                  LDQ   ! 7
         1 001026   200112 756300                    STQ   ! DCT$+8,,AUTO
         1 001027   000014 236200 2                  LDQ   ! 12
         1 001030   200006 235300                    LDA   ! SYMB$,,AUTO
         1 001031   200110 757300                    STAQ  ! DCT$+6,,AUTO
         1 001032   200110 630700                    EPPR0 ! DCT$+6,,AUTO
         1 001033   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         1 001034   000000 701200 xent               TSX1  ! FOM$TELLAU
         1 001035   000000 011200                    NOP   ! 0
         1 001036   001105 710200 1                  TRA   ! s:10254

      645    10237    5                 ELSE DO;

      646    10238    5                   K$RWPARM = K_RWPARM_CON;

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:72   
  10238  1 001037   000100 100600                    MLR   ! fill='000'O
         1 001040   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 001041   200016 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      647    10239    5                   K$RWPARM.MRKTYP = %KV_VDOMRKTYP_MRK;

  10239  1 001042   003000 236207                    LDQ   ! 1536,DL
         1 001043   200056 552310                    STBQ  ! K$RWPARM+32,'10'O,AUTO

      648    10240                        %LOCK(G=LDCT$->NK$LDCT.LOCK);

  10241  1 001044   200005 236300                    LDQ   ! LDCT$,,AUTO
         1 001045   000020 036203                    ADLQ  ! 16,DU
         1 001046   200110 756300                    STQ   ! DCT$+6,,AUTO
         1 001047   200110 630700                    EPPR0 ! DCT$+6,,AUTO
         1 001050   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001051   000000 701200 xent               TSX1  ! HFC$LOCK
         1 001052   000000 011200                    NOP   ! 0

      649    10243    5                   CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSMRK,K$RWPARM)

  10243  1 001053   200016 630700                    EPPR0 ! K$RWPARM,,AUTO
         1 001054   200112 450700                    STP0  ! DCT$+8,,AUTO
         1 001055   000016 236200 2                  LDQ   ! 14
         1 001056   200005 235300                    LDA   ! LDCT$,,AUTO
         1 001057   200110 757300                    STAQ  ! DCT$+6,,AUTO
         1 001060   200110 630700                    EPPR0 ! DCT$+6,,AUTO
         1 001061   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         1 001062   000000 701200 xent               TSX1  ! KIA$FCNOU
         1 001063   001065 702200 1                  TSX2  ! s:10246
         1 001064   001076 710200 1                  TRA   ! s:10251

      650    10244    6                   WHENALTRETURN DO;

      651    10245                          %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

  10246  1 001065   200005 236300                    LDQ   ! LDCT$,,AUTO
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:73   
         1 001066   000020 036203                    ADLQ  ! 16,DU
         1 001067   200110 756300                    STQ   ! DCT$+6,,AUTO
         1 001070   200110 630700                    EPPR0 ! DCT$+6,,AUTO
         1 001071   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001072   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 001073   000000 011200                    NOP   ! 0

      652    10248    6                     ALTRETURN;

  10248  1 001074   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001075   000000 702211                    TSX2  ! 0,X1

      653    10249    6                     END;
      654    10250                        %UNLOCK(G=LDCT$->NK$LDCT.LOCK);

  10251  1 001076   200005 236300                    LDQ   ! LDCT$,,AUTO
         1 001077   000020 036203                    ADLQ  ! 16,DU
         1 001100   200110 756300                    STQ   ! DCT$+6,,AUTO
         1 001101   200110 630700                    EPPR0 ! DCT$+6,,AUTO
         1 001102   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001103   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 001104   000000 011200                    NOP   ! 0

      655    10253    5                   END;

      656    10254    4                 IF SYMB$ -> FO$SYMB.EFLGB.IDSC

  10254  1 001105   200006 470700                    LDP0  ! SYMB$,,AUTO
         1 001106   000012 236300                    LDQ   ! 10,,PR0
         1 001107   000400 316207                    CANQ  ! 256,DL
         1 001110   001413 601200 1                  TNZ   ! BAD_ALDSC
         1 001111   000012 236300                    LDQ   ! 10,,PR0
         1 001112   000017 376207                    ANQ   ! 15,DL
         1 001113   000004 116207                    CMPQ  ! 4,DL
         1 001114   001413 600200 1                  TZE   ! BAD_ALDSC

      657    10255    4                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:74   
      658    10256    4                 THEN
      659    10257    4                  GOTO BAD_ALDSC;
      660    10258
      661    10259    4                 IF SYMB$ -> FO$SYMB.FPABRT = '1'B

  10259  1 001115   000021 430300                    FSZN  ! 17,,PR0
         1 001116   001420 604200 1                  TMI   ! BAD_ALFPRG

      662    10260    4                 THEN
      663    10261    4                  GOTO BAD_ALFPRG;
      664    10262    4                 END;

  10262  1 001117   001343 710000 1                  TRA     s:10397

      665    10263        /**
      666    10264         **
      667    10265         **
      668    10266         **      SYMBIONT HALT
      669    10267         **
      670    10268         **
      671    10269         **/
      672    10270
      673    10271    3             CASE (FOMO_SHALT#);

      674    10272
      675    10273    3               CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_HLTR,FOHR_OUTS#) ALTRET(BADHLT);

  10273  1 001120   000017 236000 2                  LDQ     15
         1 001121   200112 756100                    STQ     DCT$+8,,AUTO
         1 001122   000012 236000 2                  LDQ     10
         1 001123   200006 235100                    LDA     SYMB$,,AUTO
         1 001124   200110 757100                    STAQ    DCT$+6,,AUTO
         1 001125   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 001126   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001127   000000 701000 xent               TSX1    FOM$EVENT
         1 001130   001401 702000 1                  TSX2    BADHLT
         1 001131   001343 710000 1                  TRA     s:10397
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:75   

      676    10274        /**
      677    10275         **
      678    10276         **
      679    10277         **      WRITE ONE RECORD OR GRANULE
      680    10278         **
      681    10279         **
      682    10280         **/
      683    10281
      684    10282                      /* THE INFORMATION TO BE WRITTEN IS EITHER A RECORD
      685    10283                         DESCRIBED BY THE RECORD_ VECTOR WHICH FRAMES
      686    10284                         A VLP_SYMBWRITE VLP, OR, IF RECORD_ IS NILERASE,
      687    10285                         A WHOLE GRANULE, LIVING IN THE SYMBIONT BUFFER. */
      688    10286    3             CASE (FOMO_WRITE#);

      689    10287
      690    10288    4                 DO INHIBIT;

      691    10289    4                 IF SYMB$->FO$SYMB.STATE = FOMS_IDLE# THEN

  10289  1 001132   200006 470700                    LDP0  ! SYMB$,,AUTO
         1 001133   000012 236300                    LDQ   ! 10,,PR0
         1 001134   000017 316207                    CANQ  ! 15,DL
         1 001135   001175 601200 1                  TNZ   ! s:10308

      692    10290    5                   DO;

  10261  1 001136                       DOWRITE      null
      693    10291    5   DOWRITE:        ;
      694    10292                                      /* Set device state in symbiont cntxt blk */
      695    10293    5                   SYMB$->FO$SYMB.STATE=FOMS_DKIO#;

  10293  1 001136   200006 470700                    LDP0  ! SYMB$,,AUTO
         1 001137   000012 236300                    LDQ   ! 10,,PR0
         1 001140   000005 376200 2                  ANQ   ! 5
         1 001141   000002 276207                    ORQ   ! 2,DL
         1 001142   000012 756300                    STQ   ! 10,,PR0
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:76   

      696    10294                                      /* Acknowledgement requested? */
      697    10295    5                   IF FPT$SYMBIO_V.ACK THEN SYMB$->FO$SYMB.ACK='1'B;

  10295  1 001143   000000 471600 xsym               LDP1  ! B$PS0$
         1 001144   100004 236300                    LDQ   ! 4,,PR1
         1 001145   000004 316207                    CANQ  ! 4,DL
         1 001146   001152 600200 1                  TZE   ! s:10296

  10295  1 001147   100000 236203                    LDQ   ! 32768,DU
         1 001150   000010 256300                    ORSQ  ! 8,,PR0
         1 001151   001162 710200 1                  TRA   ! s:10304

      698    10296    5                   ELSE IF FPT$SYMBIO_V.TOKEN THEN

  10296  1 001152   000010 316207                    CANQ  ! 8,DL
         1 001153   001162 600200 1                  TZE   ! s:10304

      699    10297    6                      DO;

      700    10298                                      /* If it's not a remote write, let token
      701    10299                                         be assigned */
      702    10300    6                      IF LDCT$->NK$LDCT.DFLG.LOCAL THEN SYMB$->FO$SYMB.TOKEN='1'B;

  10300  1 001154   200005 473700                    LDP3  ! LDCT$,,AUTO
         1 001155   300006 236300                    LDQ   ! 6,,PR3
         1 001156   002000 316207                    CANQ  ! 1024,DL
         1 001157   001162 600200 1                  TZE   ! s:10304

  10300  1 001160   200000 236203                    LDQ   ! 65536,DU
         1 001161   000010 256300                    ORSQ  ! 8,,PR0

      703    10301    6                      END;

      704    10302                                /* ZAP CUREXT */
      705    10303                                      /* MOOS no longer has a current extent */
      706    10304    5                   SYMB$->FO$SYMB.CUREXT='0'B;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:77   

  10304  1 001162   000004 450300                    STZ   ! 4,,PR0
         1 001163   000005 450300                    STZ   ! 5,,PR0

      707    10305    5                   CALL FOM$WRITE (SYMB$->FO$SYMB.IOQ$->N$REQ);

  10305  1 001164   200006 470700                    LDP0  ! SYMB$,,AUTO
         1 001165   000001 473700                    LDP3  ! 1,,PR0
         1 001166   200110 453700                    STP3  ! DCT$+6,,AUTO
         1 001167   200110 630700                    EPPR0 ! DCT$+6,,AUTO
         1 001170   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001171   000000 701200 xent               TSX1  ! FOM$WRITE
         1 001172   000000 011200                    NOP   ! 0

      708    10306    5                   RETURN;

  10306  1 001173   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001174   000001 702211                    TSX2  ! 1,X1

      709    10307    5                   END;
      710    10308    4                 IF SYMB$->FO$SYMB.STATE = FOMS_HELD# THEN GOTO DOCONT;

  10308  1 001175   000012 236300                    LDQ   ! 10,,PR0
         1 001176   000017 376207                    ANQ   ! 15,DL
         1 001177   000005 116207                    CMPQ  ! 5,DL
         1 001200   000523 600200 1                  TZE   ! DOCONT

      711    10309                                                     /**/
      712    10310                                      /* If device disconnected it could
      713    10311                                         mess up an alignment sequence,
      714    10312                                         don't let it. */
      715    10313                                                     /**/
      716    10314    4                 IF SYMB$ -> FO$SYMB.EFLGB.IDSC

  10314  1 001201   000012 236300                    LDQ   ! 10,,PR0
         1 001202   000400 316207                    CANQ  ! 256,DL
         1 001203   001413 601200 1                  TNZ   ! BAD_ALDSC
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:78   
         1 001204   000012 236300                    LDQ   ! 10,,PR0
         1 001205   000017 376207                    ANQ   ! 15,DL
         1 001206   000004 116207                    CMPQ  ! 4,DL
         1 001207   001413 600200 1                  TZE   ! BAD_ALDSC

      717    10315    4                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
      718    10316    4                 THEN
      719    10317    4                  GOTO BAD_ALDSC;
      720    10318
      721    10319    4                 IF SYMB$ -> FO$SYMB.FPABRT = '1'B

  10319  1 001210   000021 430300                    FSZN  ! 17,,PR0
         1 001211   001420 604200 1                  TMI   ! BAD_ALFPRG

      722    10320    4                 THEN
      723    10321    4                  GOTO BAD_ALFPRG;
      724    10322                                                     /**/
      725    10323    4                 END;

      726    10324    3               GOTO BADCLS;

  10324  1 001212   001406 710000 1                  TRA     BADCLS

      727    10325        /**
      728    10326         **
      729    10327         **
      730    10328         **      GET SYMBIONT BLKREC INFO
      731    10329         **
      732    10330         **
      733    10331         **/
      734    10332    3             CASE (FOMO_INFO#);

      735    10333
      736    10334    3               FPT$SYMBIO_V.BLKREC=SYMB$->FO$SYMB.BR;

  10334  1 001213   200006 470500                    LDP0    SYMB$,,AUTO
         1 001214   000003 236100                    LDQ     3,,PR0
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:79   
         1 001215   000000 471400 xsym               LDP1    B$PS0$
         1 001216   100006 756100                    STQ     6,,PR1

      737    10335    3               FPT$SYMBIO_V.PGDONE=SYMB$ -> FO$SYMB.PGDONE;

  10335  1 001217   200006 470500                    LDP0    SYMB$,,AUTO
         1 001220   000013 235100                    LDA     11,,PR0
         1 001221   100007 755100                    STA     7,,PR1

      738    10336    3               FPT$SYMBIO_V.THROTTLE_TIME=SYMB$ -> FO$SYMB.THROTTLE_TIME;

  10336  1 001222   000016 235100                    LDA     14,,PR0
         1 001223   100010 755100                    STA     8,,PR1

      739    10337    3               FPT$SYMBIO_V.THROTTLE_CNT=SYMB$ -> FO$SYMB.THROTTLE_CNT;

  10337  1 001224   000017 235100                    LDA     15,,PR0
         1 001225   100011 755100                    STA     9,,PR1
         1 001226   001343 710000 1                  TRA     s:10397

      740    10338        /**
      741    10339         **
      742    10340         **
      743    10341         **      SYMBIONT CLOSE
      744    10342         **
      745    10343         **
      746    10344         **/
      747    10345
      748    10346    3             CASE (FOMO_SCLOS#);

      749    10347
      750    10348    4                 DO INHIBIT;

      751    10349    4                 IF SYMB$ -> FO$SYMB.EFLGB.IDSC

  10349  1 001227   200006 470700                    LDP0  ! SYMB$,,AUTO
         1 001230   000012 236300                    LDQ   ! 10,,PR0
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:80   
         1 001231   000400 316207                    CANQ  ! 256,DL
         1 001232   001413 601200 1                  TNZ   ! BAD_ALDSC
         1 001233   000012 236300                    LDQ   ! 10,,PR0
         1 001234   000017 376207                    ANQ   ! 15,DL
         1 001235   000004 116207                    CMPQ  ! 4,DL
         1 001236   001413 600200 1                  TZE   ! BAD_ALDSC

      752    10350    4                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
      753    10351    4                 THEN
      754    10352    4                  GOTO BAD_ALDSC;
      755    10353    4                 IF  SYMB$->FO$SYMB.STATE~=FOMS_IDLE#

  10353  1 001237   000012 236300                    LDQ   ! 10,,PR0
         1 001240   000017 316207                    CANQ  ! 15,DL
         1 001241   001246 600200 1                  TZE   ! s:10355
         1 001242   000012 236300                    LDQ   ! 10,,PR0
         1 001243   000017 376207                    ANQ   ! 15,DL
         1 001244   000005 116207                    CMPQ  ! 5,DL
         1 001245   001406 601200 1                  TNZ   ! BADCLS

      756    10354    4                 AND SYMB$->FO$SYMB.STATE~=FOMS_HELD# THEN GOTO BADCLS;
      757    10355    4                 LDCT$->NK$LDCT.DFLG.SYMBIONT='0'B;

  10355  1 001246   200005 471700                    LDP1  ! LDCT$,,AUTO
         1 001247   000004 236200 2                  LDQ   ! 4
         1 001250   100006 356300                    ANSQ  ! 6,,PR1

      758    10356    4                 END;

      759    10357    3               CALL FOM$REL (SYMB$->FO$SYMB);

  10357  1 001251   200006 630500                    EPPR0   SYMB$,,AUTO
         1 001252   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001253   000000 701000 xent               TSX1    FOM$REL
         1 001254   000000 011000                    NOP     0

      760    10358    3               CALL RELSYMB;
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:81   

  10358  1 001255   001345 701000 1                  TSX1    RELSYMB
         1 001256   000000 011000                    NOP     0

      761    10359    3               CALL KCD$DACTRM (LDCT$->NK$LDCT);

  10359  1 001257   200005 630500                    EPPR0   LDCT$,,AUTO
         1 001260   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001261   000000 701000 xent               TSX1    KCD$DACTRM
         1 001262   000000 011000                    NOP     0

      762    10360        /**
      763    10361           Lets see if the device needs some delayed partitioning done for it.
      764    10362           We assume that the LDCT was changed, and that there is a valid RAT$
      765    10363           pointer in it now.  This will get us back to the DCT so we can see
      766    10364           if this particular device should be delayed partitioned.
      767    10365        **/
      768    10366    3               IF LDCT$->NK$LDCT.RAT$ ~= ADDR(NIL) THEN

  10366  1 001263   200005 470500                    LDP0    LDCT$,,AUTO
         1 001264   000005 236100                    LDQ     5,,PR0
         1 001265   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001266   001343 600000 1                  TZE     s:10397

      769    10367    4                 DO;

      770    10368    4                 DCTX = LDCT$->NK$LDCT.RAT$->FR$RAT.DCTX;

  10368  1 001267   000005 471500                    LDP1    5,,PR0
         1 001270   100003 236100                    LDQ     3,,PR1
         1 001271   777777 376007                    ANQ     -1,DL
         1 001272   200101 756100                    STQ     DCTX,,AUTO

      771    10369    4                 DCT$ = N$DCT$$->N$DCT$(DCTX);

  10369  1 001273   000000 473400 xsym               LDP3    N$DCT$$
         1 001274   300000 236106                    LDQ     0,QL,PR3
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:82   
         1 001275   200102 756100                    STQ     DCT$,,AUTO

      772    10370    4                 IF DCT$ ~= ADDR(NIL) THEN

  10370  1 001276   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001277   001343 600000 1                  TZE     s:10397

      773    10371    4                  IF DCT.STATUS.SYSCON_PART OR DCT.STATUS.MSOS_PART THEN

  10371  1 001300   200102 474500                    LDP4    DCT$,,AUTO
         1 001301   400027 236100                    LDQ     23,,PR4
         1 001302   004000 316003                    CANQ    2048,DU
         1 001303   001306 601000 1                  TNZ     s:10373
         1 001304   002000 316003                    CANQ    1024,DU
         1 001305   001343 600000 1                  TZE     s:10397

      774    10372    5                    DO;

      775    10373    5                    FPT_SYSCON.V.FUNCTION# = %PARTITION#;

  10373  1 001306   001000 236003                    LDQ     512,DU
         1 001307   200072 552140                    STBQ    FPT_SYSCON+4,'40'O,AUTO

      776    10374    5                    FPT_SYSCON.V.COMPONENT# = %DVC#;

  10374  1 001310   000002 236003                    LDQ     2,DU
         1 001311   200072 552120                    STBQ    FPT_SYSCON+4,'20'O,AUTO

      777    10375    5                    FPT_SYSCON.V.DEVNM# = DCT.DEVNM;

  10375  1 001312   040100 100500                    MLR     fill='040'O
         1 001313   400002 000010                    ADSC9   2,,PR4                   cn=0,n=8
         1 001314   200073 000010                    ADSC9   FPT_SYSCON+5,,AUTO       cn=0,n=8

      778    10376    5                    SAVEPRIV = B$JIT.PRIV.ACTIVE;

  10376  1 001315   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:83   
         1 001316   100013 236100                    LDQ     11,,PR1
         1 001317   200100 756100                    STQ     SAVEPRIV,,AUTO

      779    10377    5                    B$JIT.PRIV.ACTIVE = %PR_SYSCON#;

  10377  1 001320   000020 236000 xsym               LDQ     B_VECTNIL+16
         1 001321   100013 756100                    STQ     11,,PR1

      780    10378    5                    CALL TDP$SYSCON (FPT_SYSCON.V,RESULT,ERR);

  10378  1 001322   200077 635500                    EPPR5   ERR,,AUTO
         1 001323   200112 455500                    STP5    DCT$+8,,AUTO
         1 001324   200076 636500                    EPPR6   RESULT,,AUTO
         1 001325   200111 456500                    STP6    DCT$+7,,AUTO
         1 001326   200072 637500                    EPPR7   FPT_SYSCON+4,,AUTO
         1 001327   200110 457500                    STP7    DCT$+6,,AUTO
         1 001330   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 001331   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001332   000000 701000 xent               TSX1    TDP$SYSCON
         1 001333   000000 011000                    NOP     0

      781    10379    5                    B$JIT.PRIV.ACTIVE = SAVEPRIV;

  10379  1 001334   200100 236100                    LDQ     SAVEPRIV,,AUTO
         1 001335   000000 470400 xsym               LDP0    B$JIT$
         1 001336   000013 756100                    STQ     11,,PR0

      782    10380    5                    END;

      783    10381    4                 END;

  10381  1 001337   001343 710000 1                  TRA     s:10397

      784    10382        /**
      785    10383         **
      786    10384         **
      787    10385         **      UNKNOWN FUNCTION CODE
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:84   
      788    10386         **
      789    10387         **
      790    10388         **/
      791    10389    3             CASE (ELSE);

      792    10390    3               B$JIT.ERR=E_BADFC;

  10390  1 001340   000011 236000 0                  LDQ     E_BADFC
         1 001341   000000 470400 xsym               LDP0    B$JIT$
         1 001342   000012 756100                    STQ     10,,PR0

      793    10391        /*E* ERROR:        FOM-E$BADFC-E
      794    10392             MESSAGE:      Unknown M$SYMBIO function code
      795    10393             DESCRIPTION:  The function code (order) passed with M$SYMBIO
      796    10394                           was unknown. */
      797    10395
      798    10396    3           END; /*CASE ORDER*/

      799    10397    2         RETURN;

  10397  1 001343   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001344   000001 702211                    TSX2  ! 1,X1

      800    10398        /**/
      801    10399    2   RELSYMB: PROC;

  10399  1 001345   200106 741300       RELSYMB      STX1  ! DCT$+4,,AUTO

      802    10400                                /* MAKE SURE LDCTX IS IN RIGHT PLACE */
      803    10401    3         SYMB$->NK$LDCT.LDCTX=SYMB$->FO$SYMB.LDCTX;

  10401  1 001346   200006 470500                    LDP0    SYMB$,,AUTO
         1 001347   000010 220100                    LDX0    8,,PR0
         1 001350   077777 360003                    ANX0    32767,DU
         1 001351   000006 740100                    STX0    6,,PR0

      804    10402    3         CALL NKL$RELDCT (SYMB$);
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:85   

  10402  1 001352   200006 630500                    EPPR0   SYMB$,,AUTO
         1 001353   200110 450500                    STP0    DCT$+6,,AUTO
         1 001354   200110 630500                    EPPR0   DCT$+6,,AUTO
         1 001355   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001356   000000 701000 xent               TSX1    NKL$RELDCT
         1 001357   000000 011000                    NOP     0

      805    10403    3         RETURN;

  10403  1 001360   200106 221300                    LDX1  ! DCT$+4,,AUTO
         1 001361   000001 702211                    TSX2  ! 1,X1

      806    10404    3   END RELSYMB;
      807    10405        /**/
      808    10406        /* VARIOUS ERRORS */
      809    10407        /**/
      810    10408    2   NODCTS:
      811    10409    2         B$JIT.ERR=E_NSBLK;

  10409  1 001362   000005 236000 0     NODCTS       LDQ     E_NSBLK
         1 001363   000000 470400 xsym               LDP0    B$JIT$
         1 001364   000012 756100                    STQ     10,,PR0

      812    10410        /*E* ERROR:        FOM-E$NSBLK-E
      813    10411             MESSAGE:      No LDCTs available for M$SYMBIO OPEN or SPACE
      814    10412             DESCRIPTION:  Opening a symbiont output device requires an LDCT
      815    10413                           for the symbiont context block.  This error occurs
      816    10414                           when there are none.  It also occurs if no LDCT
      817    10415                           (used as a tabs buffer) is available when commencing
      818    10416                           a spacing operation.   */
      819    10417    2         RETURN;

  10417  1 001365   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001366   000001 702211                    TSX2  ! 1,X1

      820    10418    2   BADCNT:
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:86   
      821    10419    2         B$JIT.ERR=E_NHLTD;

  10419  1 001367   000003 236000 0     BADCNT       LDQ     E_NHLTD
         1 001370   000000 470400 xsym               LDP0    B$JIT$
         1 001371   000012 756100                    STQ     10,,PR0

      822    10420        /*E* ERROR:        FOM-E$NHLTD-E
      823    10421             MESSAGE:      M$SYMBIO can't continue or space a busy symbiont
      824    10422             DESCRIPTION:  A CONTINUE or SPACE M$SYMBIO PMME was issued
      825    10423                           against a symbiont which was not halted.  */
      826    10424    2         RETURN;

  10424  1 001372   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001373   000001 702211                    TSX2  ! 1,X1

  10403  1 001374                       BADNXTEXT    null
      827    10425    2   BADNXTEXT:;
      828    10426    2         B$JIT.ERR=E_XTEXT;

  10426  1 001374   000004 236000 0                  LDQ     E_XTEXT
         1 001375   000000 473400 xsym               LDP3    B$JIT$
         1 001376   300012 756100                    STQ     10,,PR3

      829    10427        /*E* ERROR:        FOM-E$XTEXT-E
      830    10428             MESSAGE:      M$SYMBIO - symbiont doesn't need another extent
      831    10429             DESCRIPTION:  Another extent was passed to a symbiont which did
      832    10430                           not need one yet. */
      833    10431    2         RETURN;

  10431  1 001377   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001400   000001 702211                    TSX2  ! 1,X1

  10426  1 001401                       BADHLT       null
      834    10432    2   BADHLT:;
      835    10433    2         B$JIT.ERR=E_NOHLT;

  10433  1 001401   000010 236000 0                  LDQ     E_NOHLT
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:87   
         1 001402   000000 470400 xsym               LDP0    B$JIT$
         1 001403   000012 756100                    STQ     10,,PR0

      836    10434        /*E* ERROR:        FOM-E$NOHLT-E
      837    10435             MESSAGE:      M$SYMBIO can't halt a non-busy symbiont
      838    10436             DESCRIPTION:  The symbiont that the user is trying to halt is
      839    10437                           in the process of being halted (for some other
      840    10438                           reason) or disconnected.  */
      841    10439    2         RETURN;

  10439  1 001404   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001405   000001 702211                    TSX2  ! 1,X1

  10433  1 001406                       BADCLS       null
      842    10440    2   BADCLS:;
      843    10441    2         B$JIT.ERR=E_NSCLS;

  10441  1 001406   000007 236000 0                  LDQ     E_NSCLS
         1 001407   000000 471400 xsym               LDP1    B$JIT$
         1 001410   100012 756100                    STQ     10,,PR1

      844    10442        /*E* ERROR:        FOM-E$NSCLS-E
      845    10443             MESSAGE:      M$SYMBIO can't close or write a busy symbiont
      846    10444             DESCRIPTION:  The symbiont that the user is closing or writing
      847    10445                           is neither idle nor halted.  */
      848    10446    2         RETURN;

  10446  1 001411   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001412   000001 702211                    TSX2  ! 1,X1

  10441  1 001413                       BAD_ALDSC    null
      849    10447    2   BAD_ALDSC:;
      850    10448    2         B$JIT.ERR = E_ALGNDSC;

  10448  1 001413   000014 236000 0                  LDQ     E_ALGNDSC
         1 001414   000000 471400 xsym               LDP1    B$JIT$
         1 001415   100012 756100                    STQ     10,,PR1
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:88   

      851    10449        /*E* ERROR:          FOM-E$ALGNDSC-E
      852    10450             MESSAGE:        M$SYMBIO - inopportune disconnect
      853    10451             DESCRIPTION:    The device started disconnecting.  OUTSYM won't
      854    10452                             find out about this if we are in the middle of
      855    10453                             an alignment sequence until it's too late.  This
      856    10454                             is a way to let OUTSYM know immediately. */
      857    10455    2         RETURN;

  10455  1 001416   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001417   000001 702211                    TSX2  ! 1,X1

  10448  1 001420                       BAD_ALFPRG   null
      858    10456    2   BAD_ALFPRG:;
      859    10457    2         B$JIT.ERR = E_FPABRT;

  10457  1 001420   000015 236000 0                  LDQ     E_FPABRT
         1 001421   000000 471400 xsym               LDP1    B$JIT$
         1 001422   100012 756100                    STQ     10,,PR1

      860    10458        /*E* ERROR:          FOM-E$FPABRT-E
      861    10459             MESSAGE:        M$SYMBIO - Alignment FPRG abort
      862    10460             DESCRIPTION:    The graphics FPRG aborted.  OUTSYM won't find
      863    10461                             out about this if we are in the middle of an
      864    10462                             alignment sequence until it's too late.  This
      865    10463                             is a way to let OUTSYM know immediately. */
      866    10464    2   END PROCIT;

  10464  1 001423   200104 221300                    LDX1  ! DCT$+2,,AUTO
         1 001424   000001 702211                    TSX2  ! 1,X1

  10457  1 001425                       BAD_EXT      null
      867    10465    1   BAD_EXT:;
      868    10466    1         B$JIT.ERR=E_BADEXT;

  10466  1 001425   000013 236000 0                  LDQ     E_BADEXT
         1 001426   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:89   
         1 001427   000012 756100                    STQ     10,,PR0

      869    10467        /*E* ERROR:        FOM-E$BADEXT-E
      870    10468             MESSAGE:      M$SYMBIO - Bad extent passed
      871    10469             DESCRIPTION:  Either the first or last granule in the passed
      872    10470                           extent did not pass FAF$SRTODR check.  */
      873    10471    1         RETURN;

  10471  1 001430   000000 702200 xent               TSX2  ! X66_ARET

  10466  1 001431                       NOTREMOTE    null
      874    10472    1   NOTREMOTE:;
      875    10473    1         B$JIT.ERR=E_LOCAL;

  10473  1 001431   000012 236000 0                  LDQ     E_LOCAL
         1 001432   000000 471400 xsym               LDP1    B$JIT$
         1 001433   100012 756100                    STQ     10,,PR1

      876    10474        /*E* ERROR:        FOM-E$LOCAL-E
      877    10475             MESSAGE:      M$SYMBIO - illegal function on local device
      878    10476             DESCRIPTION:  The function code issued with M$SYMBIO is
      879    10477                           not appropriate for a local device. */
      880    10478    1         GOTO GETOUT;

  10478  1 001434   000250 710000 1                  TRA     GETOUT

E_NAUTH
 Sect OctLoc
   0     000   061715 006254                                                    1...

E_NOSTA
 Sect OctLoc
   0     001   061715 015344                                                    1...

E_BSYSY
 Sect OctLoc
   0     002   061715 021144                                                    1..d
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:90   

E_NHLTD
 Sect OctLoc
   0     003   061715 021154                                                    1..l

E_XTEXT
 Sect OctLoc
   0     004   061715 021164                                                    1..t

E_NSBLK
 Sect OctLoc
   0     005   061715 021174                                                    1..|

E_NVMEM
 Sect OctLoc
   0     006   061715 021204                                                    1...

E_NSCLS
 Sect OctLoc
   0     007   061715 021214                                                    1...

E_NOHLT
 Sect OctLoc
   0     010   061715 021224                                                    1...

E_BADFC
 Sect OctLoc
   0     011   061715 021234                                                    1...

E_LOCAL
 Sect OctLoc
   0     012   061715 021244                                                    1...

E_BADEXT
 Sect OctLoc
   0     013   061715 021304                                                    1...

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:91   
E_ALGNDSC
 Sect OctLoc
   0     014   061715 021414                                                    1...

E_FPABRT
 Sect OctLoc
   0     015   061715 021444                                                    1...

INITSBLK
 Sect OctLoc
   0     016   000000 006014   000000 006014   000000 006014   000000 000000    ................
   0     022   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0     026   000000 000000   000000 000000   000000 000006   000000 000000    ................
   0     032   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0     036   000000 000000   000040 040040   040040 040040   040040 040040    .....

(unnamed)
 Sect OctLoc
   2     000   000000 010000   000000 006000   000000 006000   000000 006000    ................
   2     004   777777 757777   777777 777760   000000 000016   000002 006000    ................
   2     010   000006 006000   000004 006000   000000 006000   000000 000020    ................
   2     014   000013 006000   000000 000040   000015 006000   000003 006000    ....... ........
      881    10479        /**/
      882    10480    1   END FOM$PMME;
      883    10481        /**/
      884    10482        /**/
      885    10483        %EOD;

PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:92   
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   TD_CP6.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FO_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   UM$CP6V_C.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$PMME.
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:93   

 **** Variables and constants ****

  ****  Section 000 RoData FOM$PMME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    14-0-0/w STRC        r     1 E_ALGNDSC                 13-0-0/w STRC        r     1 E_BADEXT
    11-0-0/w STRC        r     1 E_BADFC                    2-0-0/w STRC        r     1 E_BSYSY
    15-0-0/w STRC        r     1 E_FPABRT                  12-0-0/w STRC        r     1 E_LOCAL
     0-0-0/w STRC        r     1 E_NAUTH                    3-0-0/w STRC        r     1 E_NHLTD
    10-0-0/w STRC        r     1 E_NOHLT                    1-0-0/w STRC        r     1 E_NOSTA
     5-0-0/w STRC        r     1 E_NSBLK                    7-0-0/w STRC        r     1 E_NSCLS
     6-0-0/w STRC        r     1 E_NVMEM                    4-0-0/w STRC        r     1 E_XTEXT
    16-0-0/w STRC(720)   r     1 INITSBLK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FPTCODE                  12-0-0/w PTR         r     1 CG$
     7-0-0/w UBIN        r     1 DAD                      102-0-0/w PTR         r     1 DCT$
   101-0-0/w UBIN        r     1 DCTX                      77-0-0/w SBIN        r     1 ERR
    *0-0-0/w UBIN        r     1 FPTCODE                   66-0-0/d STRC(288)   r     1 FPT_SYSCON
    16-0-0/d STRC(1404)  r     1 K$RWPARM                   5-0-0/w PTR         r     1 LDCT$
     4-0-0/w UBIN        r     1 ORDER                     76-0-0/w SBIN        r     1 RESULT
   100-0-0/b BIT         r     1 SAVEPRIV                  10-0-0/w UBIN(18)    r     1 SETX
    13-0-0/w PTR         r     1 STA$                      14-0-0/w UBIN        r     1 STALOCK
     6-0-0/w PTR         r     1 SYMB$                     11-0-0/w UBIN        r     1 TEMP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:94   
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$PS2$
     0-0-0/w PTR         r     1 B$PS3$                     0-0-0/w PTR         r     1 B$PS5$
     0-0-0/w UBIN        r     1 FOM_WSQ                    0-0-0/w STRC        r     1 FOSE_HLTR
     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON               0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(7560)  r     1 B$JIT                      0-0-0/w STRC(1332)  r     1 DCT
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(720)   r     1 FO$SYMB
     0-0-0/w STRC(360)   r     1 FO$TABS                    0-0-0/d STRC(396)   r     1 FPT$SYMBIO_V
     0-0-0/w STRC(324)   r     1 FR$RAT                     0-0-0/d STRC(6516)  r     1 KQ$CG
     0-0-0/d STRC(1296)  r     1 KQ$STA                     0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/d STRC(1080)  r     1 N$REQ                      0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/d STRC(72)    r     1 VLP$EXTENT                 0-0-0/c CHAR(6)     r     1 VLP$FORM
     0-0-0/c CHAR(8)     r     1 VLP$STATION


   Procedure FOM$PMME requires 797 words for executable code.
   Procedure FOM$PMME requires 76 words of local(AUTO) storage.
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:95   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:96   
          MINI XREF LISTING

B$JIT.DCB$
      9092**DCL      9853>>ASSIGN
B$JIT.ERR
      9002**DCL      9814<<ASSIGN   9921<<ASSIGN   9961<<ASSIGN  10159<<ASSIGN  10390<<ASSIGN  10409<<ASSIGN
     10419<<ASSIGN  10426<<ASSIGN  10433<<ASSIGN  10441<<ASSIGN  10448<<ASSIGN  10457<<ASSIGN  10466<<ASSIGN
     10473<<ASSIGN
B$JIT.ERR.MID
      9003**DCL      9003--REDEF
B$JIT.PRIV.ACTIVE
      9003**DCL     10376>>ASSIGN  10377<<ASSIGN  10379<<ASSIGN
B$JIT$
      9730**DCL      8997--IMP-PTR  9814>>ASSIGN   9853>>ASSIGN   9921>>ASSIGN   9961>>ASSIGN  10159>>ASSIGN
     10376>>ASSIGN  10377>>ASSIGN  10379>>ASSIGN  10390>>ASSIGN  10409>>ASSIGN  10419>>ASSIGN  10426>>ASSIGN
     10433>>ASSIGN  10441>>ASSIGN  10448>>ASSIGN  10457>>ASSIGN  10466>>ASSIGN  10473>>ASSIGN
B$PS0$
      9731**DCL      8989--IMP-PTR  9825>>ASSIGN   9828>>ASSIGN  10038>>ASSIGN  10120>>ASSIGN  10121>>IF
     10121>>IF      10143>>ASSIGN  10144>>ASSIGN  10145>>ASSIGN  10146>>ASSIGN  10295>>IF      10296>>IF
     10334>>ASSIGN  10335>>ASSIGN  10336>>ASSIGN  10337>>ASSIGN
B$PS1$
      9732**DCL      8994--IMP-PTR  9829>>ASSIGN   9831>>ASSIGN   9831>>ASSIGN  10128>>ASSIGN  10188>>ASSIGN
     10199>>ASSIGN
B$PS2$
      9733**DCL      9988<>CALL    10098<>CALL
B$PS3$
      9734**DCL      9160--IMP-PTR  9843>>CALL     9861>>CALL
B$PS5$
      9736**DCL      9161--IMP-PTR  9843>>CALL
BADCLS IN PROCEDURE PROCIT
     10433**LABEL   10324--GOTO    10354--GOTO
BADCNT IN PROCEDURE PROCIT
     10419**LABEL   10095--GOTO    10156--CALLALT
BADHLT IN PROCEDURE PROCIT
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:97   
     10426**LABEL   10273--CALLALT
BADNXTEXT IN PROCEDURE PROCIT
     10403**LABEL   10182--GOTO
BAD_ALDSC IN PROCEDURE PROCIT
     10441**LABEL   10230--GOTO    10257--GOTO    10317--GOTO    10352--GOTO
BAD_ALFPRG IN PROCEDURE PROCIT
     10448**LABEL   10234--GOTO    10261--GOTO    10321--GOTO
BAD_EXT
     10457**LABEL    9830--CALLALT  9832--CALLALT
BAD_NAME
      9920**LABEL    9882--GOTO     9934--CALLALT
CG$
      9263**DCL      9854<<ASSIGN   9855>>CALL     9857>>CALL     9861>>CALL     9880>>CALL     9899>>CALL
CONTINUE IN PROCEDURE PROCIT
     10099**LABEL   10041--GOTO
DAD
      9260**DCL      9829<<ASSIGN   9830<>CALL     9831<<ASSIGN   9832<>CALL
DCT.DEVNM
      9212**DCL     10375>>ASSIGN
DCT.DP
      9232**DCL      9239--REDEF    9242--REDEF    9243--REDEF    9245--REDEF    9245--REDEF    9246--REDEF
      9247--REDEF    9247--REDEF
DCT.MPC.IOCHANX
      9240**DCL      9240--REDEF
DCT.STATUS.MSOS_PART
      9231**DCL     10371>>IF
DCT.STATUS.SYSCON_PART
      9230**DCL     10371>>IF
DCT$
      9603**DCL      9212--IMP-PTR 10369<<ASSIGN  10370>>IF      10371>>IF      10371>>IF      10375>>ASSIGN
DCTX
      9602**DCL     10368<<ASSIGN  10369>>ASSIGN
DOCONT IN PROCEDURE PROCIT
     10072**LABEL   10067--GOTO    10308--GOTO
DOSPACE IN PROCEDURE PROCIT
     10055**LABEL   10072--GOTO
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:98   
DOWRITE IN PROCEDURE PROCIT
     10261**LABEL   10127--GOTO
ERR
      9600**DCL     10378<>CALL
E_ALGNDSC
      9682**DCL     10448>>ASSIGN
E_BADEXT
      9676**DCL     10466>>ASSIGN
E_BADFC
      9664**DCL     10390>>ASSIGN
E_BSYSY
      9622**DCL      9961>>ASSIGN
E_FPABRT
      9688**DCL     10457>>ASSIGN
E_LOCAL
      9670**DCL     10473>>ASSIGN
E_NAUTH
      9610**DCL      9814>>ASSIGN
E_NHLTD
      9628**DCL     10419>>ASSIGN
E_NOHLT
      9658**DCL     10433>>ASSIGN
E_NOSTA
      9616**DCL      9921>>ASSIGN
E_NSBLK
      9640**DCL     10409>>ASSIGN
E_NSCLS
      9652**DCL     10441>>ASSIGN
E_NVMEM
      9646**DCL     10159>>ASSIGN
E_XTEXT
      9634**DCL     10426>>ASSIGN
F$DCB.ACTPOS
      4995**DCL      4995--REDEF
F$DCB.ARS
      4970**DCL      4970--REDEF
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:99   
F$DCB.ATTR
      4988**DCL      4989--REDEF
F$DCB.BORROW
      5003**DCL      5003--REDEF    5003--REDEF    5003--REDEF
F$DCB.DCBNAME.L
      5017**DCL      5017--IMP-SIZ
F$DCB.EOMCHAR
      4974**DCL      4974--REDEF
F$DCB.FLDID
      4998**DCL      4998--REDEF
F$DCB.FORM$
      4992**DCL      4992--REDEF
F$DCB.FSECT
      5008**DCL      5008--REDEF
F$DCB.FSN
      4985**DCL      4985--REDEF    4985--REDEF    4986--REDEF
F$DCB.HEADER$
      4991**DCL      4991--REDEF
F$DCB.IXTNSIZE
      4989**DCL      4989--REDEF
F$DCB.LASTSTA$
      4979**DCL      4979--REDEF
F$DCB.LDCTX
      4992**DCL      9853>>ASSIGN
F$DCB.LVL
      5004**DCL      5004--REDEF
F$DCB.NAME.C
      4979**DCL      4979--REDEF
F$DCB.NOEOF
      5000**DCL      5000--REDEF
F$DCB.NRECS
      4990**DCL      4990--REDEF
F$DCB.NRECX
      5009**DCL      5009--REDEF
F$DCB.OHDR
      5001**DCL      5001--REDEF
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:100  
F$DCB.ORG
      4984**DCL      4984--REDEF
F$DCB.PRECNO
      5007**DCL      5007--REDEF
F$DCB.RCSZ
      5012**DCL      5012--REDEF
F$DCB.RES
      4980**DCL      4980--REDEF
F$DCB.SETX
      4992**DCL      4992--REDEF
F$DCB.TAB$
      4991**DCL      4992--REDEF
F$DCB.TDA
      5006**DCL      5006--REDEF
F$DCB.WSN
      4981**DCL      4981--REDEF
FAF$SRTODR
      9738**DCL-ENT  9830--CALL     9832--CALL
FO$SYMB
      8967**DCL      9975<<ASSIGN  10132<>CALL    10150<>CALL    10156<>CALL    10205<>CALL    10236<>CALL
     10273<>CALL    10357<>CALL
FO$SYMB.ACK
      8974**DCL     10295<<ASSIGN
FO$SYMB.BR
      8968**DCL     10120<<ASSIGN  10137>>IF      10334>>ASSIGN
FO$SYMB.BR.BLK#
      8968**DCL      8969--REDEF
FO$SYMB.BR.REC#
      8969**DCL      8970--REDEF
FO$SYMB.BUF$
      8967**DCL      8968--REDEF    9988<>CALL     9998<>CALL    10098<>CALL    10116>>ASSIGN
FO$SYMB.CPVFC
      8982**DCL     10146<<ASSIGN
FO$SYMB.CUREXT
      8970**DCL     10128<<ASSIGN  10130>>IF      10186>>IF      10199<<ASSIGN  10304<<ASSIGN
FO$SYMB.CUREXT.STAMP
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:101  
      8971**DCL      8972--REDEF
FO$SYMB.CUREXT.STAMP.FRDAD
      8971**DCL     10211<<ASSIGN  10211>>ASSIGN  10212<<ASSIGN  10212>>ASSIGN
FO$SYMB.DEVLDCTX
      8975**DCL      9980<<ASSIGN
FO$SYMB.EFLGB.IDSC
      8981**DCL     10227>>IF      10254>>IF      10314>>IF      10349>>IF
FO$SYMB.FIRSTSPACE
      8981**DCL     10147<<ASSIGN
FO$SYMB.FPABRT
      8985**DCL     10232>>IF      10259>>IF      10319>>IF
FO$SYMB.IOQ$
      8967**DCL     10108<>CALL    10110>>ASSIGN  10112>>ASSIGN  10116>>ASSIGN  10305>>CALL
FO$SYMB.LDCTX
      8975**DCL      9978<<ASSIGN  10043>>ASSIGN  10401>>ASSIGN
FO$SYMB.NXTEXT
      8972**DCL     10125<<ASSIGN  10182>>IF      10188<<ASSIGN
FO$SYMB.NXTEXT.STAMP.FRDAD
      8973**DCL     10192<<ASSIGN  10192>>ASSIGN  10193<<ASSIGN  10193>>ASSIGN
FO$SYMB.PAGES
      8979**DCL     10145<<ASSIGN
FO$SYMB.PGDONE
      8983**DCL     10123<<ASSIGN  10335>>ASSIGN
FO$SYMB.SETX
      8977**DCL     10038<<ASSIGN
FO$SYMB.SPACEPAGES
      8975**DCL      8976--REDEF   10143<<ASSIGN  10191>>IF      10210>>IF
FO$SYMB.SPACEREC#
      8976**DCL     10144<<ASSIGN
FO$SYMB.SPACETYPE
      8979**DCL     10055<<ASSIGN  10071<<ASSIGN
FO$SYMB.SPACING
      8978**DCL     10142<<ASSIGN  10191>>IF      10210>>IF
FO$SYMB.STATE
      8982**DCL     10095>>IF      10096<<ASSIGN  10202>>IF      10204<<ASSIGN  10227>>IF      10254>>IF
     10289>>IF      10293<<ASSIGN  10308>>IF      10314>>IF      10349>>IF      10353>>IF      10353>>IF
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:102  
FO$SYMB.TAB$
      8967**DCL     10057>>IF      10059<>CALL    10060>>ASSIGN  10062>>ASSIGN
FO$SYMB.THROTTLE_CNT
      8984**DCL     10337>>ASSIGN
FO$SYMB.THROTTLE_TIME
      8984**DCL     10336>>ASSIGN
FO$SYMB.TOKEN
      8974**DCL     10300<<ASSIGN
FO$SYMB.XMVFU
      8982**DCL     10140<<ASSIGN
FO$TABS.LDCTX
      9158**DCL     10062<<ASSIGN
FO$TABS.TABS
      9158**DCL      9158--REDEF
FOM$DISKQ
      9739**DCL-ENT 10150--CALL    10205--CALL
FOM$EVENT
      9740**DCL-ENT 10156--CALL    10273--CALL
FOM$REL
      9741**DCL-ENT 10357--CALL
FOM$TELLAU
      9742**DCL-ENT 10132--CALL    10236--CALL
FOM$WRITE
      9743**DCL-ENT 10305--CALL
FOM_WSQ
      1096**DCL      9988<>CALL     9998<>CALL    10098<>CALL
FOSE_HLTR
      1273**DCL     10156<>CALL    10273<>CALL
FPT$SYMBIO_V.ACK
      8990**DCL     10295>>IF
FPT$SYMBIO_V.BLKREC
      8990**DCL     10120>>ASSIGN  10334<<ASSIGN
FPT$SYMBIO_V.BLKREC.BLK
      8990**DCL     10121>>IF
FPT$SYMBIO_V.BLKREC.REC
      8991**DCL     10121>>IF
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:103  
FPT$SYMBIO_V.CPVFC
      8990**DCL     10146>>ASSIGN
FPT$SYMBIO_V.ORDER
      8989**DCL      9825>>ASSIGN
FPT$SYMBIO_V.PAGES
      8990**DCL     10145>>ASSIGN
FPT$SYMBIO_V.PGDONE
      8991**DCL     10335<<ASSIGN
FPT$SYMBIO_V.SETX
      8989**DCL      9828>>ASSIGN  10038>>ASSIGN
FPT$SYMBIO_V.SPACEPAGES
      8990**DCL     10143>>ASSIGN
FPT$SYMBIO_V.SPACEREC
      8991**DCL     10144>>ASSIGN
FPT$SYMBIO_V.THROTTLE_CNT
      8991**DCL     10337<<ASSIGN
FPT$SYMBIO_V.THROTTLE_TIME
      8991**DCL     10336<<ASSIGN
FPT$SYMBIO_V.TOKEN
      8990**DCL     10296>>IF
FPTCODE
      7747**DCL        78--PROC
FPT_SYSCON.V
      9593**DCL     10378<>CALL
FPT_SYSCON.V.COMPONENT#
      9594**DCL     10374<<ASSIGN
FPT_SYSCON.V.DEVNM#
      9596**DCL     10375<<ASSIGN
FPT_SYSCON.V.FUNCTION#
      9594**DCL     10373<<ASSIGN
FPT_SYSCON.V.IOM#
      9594**DCL      9595--REDEF    9595--REDEF
FR$RAT.DCTX
      9183**DCL     10368>>ASSIGN
GETOUT
      9921**LABEL    9909--GOTO     9935--GOTO    10478--GOTO
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:104  
HFC$LOCK
      1364**DCL-ENT  9857--CALL     9865--CALL     9993--CALL    10241--CALL
HFC$UNLOCK
      1364**DCL-ENT  9876--CALL     9880--CALL     9896--CALL     9899--CALL    10001--CALL    10028--CALL
     10246--CALL    10251--CALL
INITSBLK
      9704**DCL      9975>>ASSIGN
INITSBLK.BR.BLK#
      9705**DCL      9706--REDEF
INITSBLK.BR.REC#
      9706**DCL      9707--REDEF
INITSBLK.BUF$
      9704**DCL      9705--REDEF
INITSBLK.CUREXT.STAMP
      9708**DCL      9709--REDEF
INITSBLK.SPACEPAGES
      9712**DCL      9713--REDEF
K$RWPARM
      9287**DCL     10238<<ASSIGN  10243<>CALL
K$RWPARM.BLKREC
      9313**DCL      9338--REDEF
K$RWPARM.BLKREC.BLKU#
      9314**DCL      9316--REDEF
K$RWPARM.BLKREC.RECU#
      9326**DCL      9328--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      9353**DCL      9354--REDEF
K$RWPARM.DVE.EOMCHAR
      9361**DCL      9365--REDEF
K$RWPARM.ERR
      9425**DCL      9430--REDEF
K$RWPARM.FC
      9389**DCL      9390--REDEF
K$RWPARM.FLDID
      9571**DCL      9572--REDEF
K$RWPARM.FPT$
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:105  
      9452**DCL      9459--REDEF
K$RWPARM.KEYTYPE
      9578**DCL      9579--REDEF
K$RWPARM.MRKTYP
      9563**DCL     10239<<ASSIGN
K$RWPARM.MSG$
      9288**DCL      9294--REDEF
K$RWPARM.MSGID
      9400**DCL      9405--REDEF
K$RWPARM.MSGIDXT
      9413**DCL      9417--REDEF
K$RWPARM.ORG
      9549**DCL      9550--REDEF
K$RWPARM.THDRSZ
      9493**DCL      9497--REDEF
K$RWPARM.VDOFLGS
      9551**DCL      9562--REDEF
KCD$ACTRM
      9744**DCL-ENT 10034--CALL
KCD$DACTRM
      9745**DCL-ENT 10359--CALL
KIA$FCNOU
      9746**DCL-ENT 10243--CALL
KQ$CG
      7893**DCL      9855<>CALL
KQ$CG.AUCTL.DVBYTE.REREAD
      8336**DCL      8337--REDEF
KQ$CG.STREE
      8225**DCL      9861<>CALL
KQ$CG.STREE.GATE
      8227**DCL      9857<>CALL     9880<>CALL     9899<>CALL
KQ$STA
      8631**DCL      9928<>CALL
KQ$STA.ACTTYC
      8683**DCL      8687--REDEF
KQ$STA.DCBLNK$
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:106  
      8690**DCL      8693--REDEF    8697--REDEF
KQ$STA.EVCNT
      8776**DCL      8779--REDEF
KQ$STA.EVNT
      8742**DCL      8746--REDEF    8749--REDEF
KQ$STA.GATE
      8709**DCL      9865<>CALL     9876<>CALL     9896<>CALL     9993<>CALL    10001<>CALL    10028<>CALL
KQ$STA.IDSC
      8711**DCL      9996>>IF
KQ$STA.LDCT$
      8672**DCL      9870>>ASSIGN
KQ$STA.LOCKCNT
      8765**DCL      9892<<ASSIGN   9892>>ASSIGN
KQ$STA.OPNBLKED
      8803**DCL      8806--REDEF
KQ$STA.OPNREJ
      8809**DCL      8811--REDEF
KQ$STA.SUCCREAD
      8732**DCL      8736--REDEF
KQ$STA.TCOUNT
      8861**DCL      8867--REDEF
KQ$STA.VGOT$
      8846**DCL      8850--REDEF    8854--REDEF
KQB$SRCH
      9747**DCL-ENT  9861--CALL
KQP$UNLOCK
      9748**DCL-ENT  9928--CALL
KQX$LDASR
      9749**DCL-ENT  9855--CALL
K_RWPARM_CON
      5433**DCL     10238>>ASSIGN
K_RWPARM_CON.BLKREC
      5459**DCL      5484--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      5460**DCL      5462--REDEF
K_RWPARM_CON.BLKREC.RECU#
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:107  
      5472**DCL      5474--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      5499**DCL      5500--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      5507**DCL      5511--REDEF
K_RWPARM_CON.ERR
      5571**DCL      5576--REDEF
K_RWPARM_CON.FC
      5535**DCL      5536--REDEF
K_RWPARM_CON.FLDID
      5717**DCL      5718--REDEF
K_RWPARM_CON.FPT$
      5598**DCL      5605--REDEF
K_RWPARM_CON.KEYTYPE
      5724**DCL      5725--REDEF
K_RWPARM_CON.MSG$
      5434**DCL      5440--REDEF
K_RWPARM_CON.MSGID
      5546**DCL      5551--REDEF
K_RWPARM_CON.MSGIDXT
      5559**DCL      5563--REDEF
K_RWPARM_CON.ORG
      5695**DCL      5696--REDEF
K_RWPARM_CON.THDRSZ
      5639**DCL      5643--REDEF
K_RWPARM_CON.VDOFLGS
      5697**DCL      5708--REDEF
LDCT$
      9258**DCL      9853<<ASSIGN   9854>>ASSIGN   9870<<ASSIGN   9872>>IF       9885>>IF       9885>>IF
      9906>>IF       9915>>IF       9916>>ASSIGN   9957>>IF       9957>>IF       9980>>ASSIGN  10025>>ASSIGN
     10026>>ASSIGN  10034>>CALL    10181>>ASSIGN  10235>>IF      10241>>CALL    10243>>CALL    10246>>CALL
     10251>>CALL    10300>>IF      10355>>ASSIGN  10359>>CALL    10366>>IF      10368>>ASSIGN
MMS$VGET
      9750**DCL-ENT  9988--CALL    10098--CALL
MMS$VREL
      9751**DCL-ENT  9998--CALL
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:108  
N$DCT$
      9251**DCL     10369>>ASSIGN
N$DCT$$
       758**DCL       758--IMP-PTR  9853>>ASSIGN   9973>>ASSIGN  10061>>ASSIGN  10369>>ASSIGN
N$REQ
      9108**DCL     10305<>CALL
N$REQ.BUF$
      9117**DCL     10116<<ASSIGN
N$REQ.BUFADDR
      9117**DCL      9118--REDEF    9118--REDEF
N$REQ.DLA.DRELADDR
      9109**DCL      9109--REDEF
N$REQ.DVE.EOMCHAR
      9146**DCL      9147--REDEF
N$REQ.EAINFO
      9140**DCL      9140--REDEF
N$REQ.EAINFOP$
      9140**DCL     10112<<ASSIGN
N$REQ.EAINFOX
      9140**DCL      9141--REDEF
N$REQ.EVNTINFO
      9141**DCL      9141--REDEF
N$REQ.NOALT
      9111**DCL     10110<<ASSIGN
N$REQ.STATUS
      9122**DCL      9128--REDEF
NIQ$GET
      9752**DCL-ENT 10108--CALL
NK$LDCT
      7845**DCL     10034<>CALL    10243<>CALL    10359<>CALL
NK$LDCT.CG$
      7876**DCL      9854>>ASSIGN
NK$LDCT.DDT$
      7847**DCL      7847--REDEF
NK$LDCT.DFLG.LOCAL
      7851**DCL      9906>>IF      10235>>IF      10300>>IF
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:109  
NK$LDCT.DFLG.SYMBIONT
      7850**DCL      9915>>IF       9957>>IF      10026<<ASSIGN  10355<<ASSIGN
NK$LDCT.IOQ$
      7846**DCL      7847--REDEF
NK$LDCT.LDCTX
      7848**DCL      7848--REDEF    9971>>ASSIGN   9980>>ASSIGN  10043<<ASSIGN  10060>>ASSIGN  10401<<ASSIGN
NK$LDCT.LKFLG.ABORTED
      7860**DCL      7861--REDEF
NK$LDCT.LKFLG.ACTIVE
      7864**DCL      9957>>IF
NK$LDCT.LOCK
      7873**DCL     10241<>CALL    10246<>CALL    10251<>CALL
NK$LDCT.RAT$
      7848**DCL     10366>>IF      10368>>ASSIGN
NK$LDCT.RESCOD
      7853**DCL      9885>>IF       9885>>IF
NK$LDCT.RLCID.LDCTX
      7870**DCL      7870--REDEF
NK$LDCT.STA$
      7866**DCL      7867--REDEF
NK$LDCT.SYMB$
      7845**DCL      7845--REDEF    7845--REDEF    7846--REDEF    9916>>ASSIGN  10025<<ASSIGN  10181>>ASSIGN
NK$LDCT$
       758**DCL      9853>>ASSIGN   9973<<ASSIGN  10061<<ASSIGN
NKF$FORM
      9753**DCL-ENT  9843--CALL
NKL$GETDCT
      9754**DCL-ENT  9969--CALL    10059--CALL
NKL$RELDCT
      9755**DCL-ENT 10044--CALL    10402--CALL
NODCTS IN PROCEDURE PROCIT
     10409**LABEL    9969--CALLALT 10059--CALLALT
NOMEM IN PROCEDURE PROCIT
     10144**LABEL   10098--CALLALT
NOMEM1 IN PROCEDURE PROCIT
     10038**LABEL    9988--CALLALT
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:110  
NOMEM2 IN PROCEDURE PROCIT
     10156**LABEL   10045--GOTO
NOSTA
      9876**LABEL    9861--CALLALT
NOSTA1
      9861**LABEL    9887--GOTO
NOTREMOTE
     10466**LABEL    9906--GOTO
ORDER
      9257**DCL      9825<<ASSIGN   9826>>IF       9841>>IF       9904>>IF       9918>>IF       9918>>IF
      9945>>DOCASE   9957>>IF      10032>>IF      10127>>IF      10134>>IF      10134>>IF
PROCIT
      9936**PROC     9934--CALL
RELSYMB IN PROCEDURE PROCIT
     10399**PROC     9999--CALL    10358--CALL
RESULT
      9599**DCL     10378<>CALL
SAVEPRIV
      9601**DCL     10376<<ASSIGN  10379>>ASSIGN
SETX
      9261**DCL      9828<<ASSIGN   9830<>CALL     9832<>CALL
SSS$BLOCK
      9756**DCL-ENT  9840--CALL
STA$
      9264**DCL      9861<>CALL     9865>>CALL     9870>>ASSIGN   9876>>CALL     9892>>ASSIGN   9892>>ASSIGN
      9896>>CALL     9928>>CALL     9993>>CALL     9996>>IF      10001>>CALL    10028>>CALL
STALOCK
      9265**DCL      9850<<ASSIGN   9894<<ASSIGN   9928>>IF
SYMB$
      9259**DCL      9916<<ASSIGN   9969<>CALL     9971>>ASSIGN   9975>>ASSIGN   9978>>ASSIGN   9980>>ASSIGN
      9988>>CALL     9998>>CALL    10025>>ASSIGN  10038>>ASSIGN  10043>>ASSIGN  10043>>ASSIGN  10044<>CALL
     10055>>ASSIGN  10057>>IF      10059>>CALL    10060>>ASSIGN  10062>>ASSIGN  10071>>ASSIGN  10095>>IF
     10096>>ASSIGN  10098>>CALL    10108>>CALL    10110>>ASSIGN  10112>>ASSIGN  10112>>ASSIGN  10116>>ASSIGN
     10116>>ASSIGN  10120>>ASSIGN  10123>>ASSIGN  10125>>ASSIGN  10128>>ASSIGN  10130>>IF      10132>>CALL
     10137>>IF      10140>>ASSIGN  10142>>ASSIGN  10143>>ASSIGN  10144>>ASSIGN  10145>>ASSIGN  10146>>ASSIGN
     10147>>ASSIGN  10150>>CALL    10156>>CALL    10181<<ASSIGN  10182>>IF      10186>>IF      10188>>ASSIGN
PL6.E3A0      #001=FOM$PMME File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:111  
     10191>>IF      10191>>IF      10192>>ASSIGN  10192>>ASSIGN  10193>>ASSIGN  10193>>ASSIGN  10199>>ASSIGN
     10202>>IF      10204>>ASSIGN  10205>>CALL    10210>>IF      10210>>IF      10211>>ASSIGN  10211>>ASSIGN
     10212>>ASSIGN  10212>>ASSIGN  10227>>IF      10227>>IF      10232>>IF      10236>>CALL    10254>>IF
     10254>>IF      10259>>IF      10273>>CALL    10289>>IF      10293>>ASSIGN  10295>>ASSIGN  10300>>ASSIGN
     10304>>ASSIGN  10305>>CALL    10308>>IF      10314>>IF      10314>>IF      10319>>IF      10334>>ASSIGN
     10335>>ASSIGN  10336>>ASSIGN  10337>>ASSIGN  10349>>IF      10349>>IF      10353>>IF      10353>>IF
     10357>>CALL    10401>>ASSIGN  10401>>ASSIGN  10402<>CALL
S_CUN
      9737**DCL      9813>>IF
TDP$SYSCON
      9757**DCL-ENT 10378--CALL
TEMP
      9262**DCL      9971<<ASSIGN   9973>>ASSIGN   9978>>ASSIGN  10060<<ASSIGN  10061>>ASSIGN  10062>>ASSIGN
VLP$EXTENT
      8994**DCL     10128>>ASSIGN  10188>>ASSIGN  10199>>ASSIGN
VLP$EXTENT.DAD
      8994**DCL      9829>>ASSIGN   9831>>ASSIGN
VLP$EXTENT.GRANS
      8994**DCL      9831>>ASSIGN
VLP$FORM
      9161**DCL      9843<>CALL
VLP$STATION
      9160**DCL      9843<>CALL     9861<>CALL

PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:112  
      886        1        /*T***********************************************************/
      887        2        /*T*                                                         */
      888        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      889        4        /*T*                                                         */
      890        5        /*T***********************************************************/
      891        6        /**/
      892        7        /**/
      893        8        FOM$NXDISK: PROC (FO$SYMB) ALTRET;
      894        9        /**/
      895       10        /**/
      896       11        /*F* NAME:         FOM$NXDISK
      897       12             PURPOSE:      To queue the next disk read for MOOS
      898       13             DESCRIPTION:  The blk-rec pointers in the symb cntxt blk
      899       14                           are updated, and we fall thru to FOM$DISKQ.
      900       15
      901       16                           Called after the last-read disk gran has been
      902       17                           successfully sent to its destination,
      903       18                           i.e. from FOM$DEVEA for local devices */
      904       19        /**/
      905       20
      906       21
      907       22        /**/
      908       23        /*  INCLUDES */
      909       24        /**/
      910       25        %INCLUDE FOM$STRUCT;
      911       86        %INCLUDE N$REQ;
      912      160        %INCLUDE NK$LDCT;
      913      262        %INCLUDE KC_SUBS_C;
      914      278        %INCLUDE N_FC_C;
      915      315        %INCLUDE FOM_SUBS_C;
      916      378        %INCLUDE FOM_DATA_R;
      917      627        %INCLUDE NK_LDCT_R;
      918      636        %INCLUDE FM$GRAN;
      919      705        %INCLUDE KC_CP6;
      920     1265
      921     1266
      922     1267        /**/
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:113  
      923     1268        /* PARAMETERS */
      924     1269        /**/
      925     1270        %FOM$SYMB (STCLASS="",NAME=FO$SYMB);
      926     1302
      927     1303
      928     1304        /**/
      929     1305        /* BASED STRUCTURES */
      930     1306        /**/
      931     1307        %N$REQ;
      932     1365        %NK$LDCT;
      933     1411        %FM$GRAN;
      934     1415        %FOM$SBUF;
      935     1419
      936     1420
      937     1421        /**/
      938     1422        /* AUTO */
      939     1423        /**/
      940     1424    1   DCL IOQ$ PTR;
      941     1425    1   DCL LDCT$ PTR;
      942     1426    1   DCL ON_ENDAC UBIN WORD;
      943     1427
      944     1428
      945     1429        /**/
      946     1430        /*  REFS */
      947     1431        /**/
      948     1432    1   DCL FAF$SRTODR         ENTRY(2) ALTRET;
      949     1433    1   DCL FOM$DISKEA         ENTRY(1);
      950     1434    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
      951     1435    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
      952     1436    1   DCL NIO$QUE            ENTRY(1) ALTRET;
      953     1437    1   DCL SC_BADSYMBDA ENTRY CONV(2,0);
      954     1438
      955     1439
      956     1440        /**/
      957     1441        /* SUBS */
      958     1442        /**/
      959     1443        %EQU_CG;
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:114  
      960     1491        /**/
      961     1492        /**/
      962     1493        /* START HERE */
      963     1494        /**/
      964     1495    1         ON_ENDAC=1;
      965     1496    1         GOTO NXDISK0;
      966     1497
      967     1498        /**/
      968     1499        /**/
      969     1500    1   FOM$RNXDISK: ENTRY(FO$SYMB) ALTRET;
      970     1501        /**/
      971     1502        /*F* NAME:         FOM$RNXDISK
      972     1503             PURPOSE:      To queue the next disk read for MOOS
      973     1504             DESCRIPTION:  Same as FOM$NXDISK but for remote devices.
      974     1505                           Called from FOM$SYMBIN. */
      975     1506        /**/
      976     1507    1         ON_ENDAC=0;
      977     1508    1   NXDISK0:;
      978     1509                                /* MAKE SURE STATE IS OK FIRST */
      979     1510                                      /* Device ENDAC */
      980     1511    1         CALL FOM$EVENT (FO$SYMB,FOSE_SWDN) ALTRET(ALTRT);
      981     1512    2           DO INHIBIT;
      982     1513    2           IF FO$SYMB.XMTABS THEN
      983     1514    3             DO;
      984     1515    3             FO$SYMB.XMTABS='0'B;
      985     1516    3             GOTO DISKQ;
      986     1517    3             END;
      987     1518                                                     /**/
      988     1519    2           IF FO$SYMB.XMVFU
      989     1520    2           THEN
      990     1521    3             DO;
      991     1522    3             FO$SYMB.XMVFU='0'B;
      992     1523    3             GOTO DISKQ;
      993     1524    3             END;
      994     1525                                                     /**/
      995     1526    2           GOTO NXDISK;
      996     1527    2           END;
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:115  
      997     1528        /**/
      998     1529        /**/
      999     1530    1   FOM$SNXDISK: ENTRY (FO$SYMB) ALTRET;
     1000     1531        /**/
     1001     1532        /*F* NAME:         FOM$SNXDISK
     1002     1533             PURPOSE:      To queue the next disk read for MOOS during spacing
     1003     1534                           or when a granule has no records.
     1004     1535             DESCRIPTION:  Same as FOM$NXDISK but a different event must
     1005     1536                           be reported to FOM$EVENT because we're coming
     1006     1537                           off disk endaction instead of device endac. */
     1007     1538        /**/
     1008     1539                                      /* Disk ENDAC */
     1009     1540    1         CALL FOM$EVENT (FO$SYMB,FOSE_DGDN) ALTRET(ALTRT);
     1010     1541    1         ON_ENDAC=1;
     1011     1542                                /* UPDATE BLKREC */
     1012     1543    2           DO INHIBIT;
     1013     1544    2   NXDISK:
     1014     1545                                      /* Position ourselves in extent to next
     1015     1546                                         (or previous) block */
     1016     1547    2           IF FO$SYMB.SPACING AND FO$SYMB.SPACEPAGES<0 THEN
     1017     1548    3             DO;
     1018     1549    3             FO$SYMB.PGDONE = FO$SYMB.PGDONE - FO$SYMB.BUF$->FM$GRAN.KEYCNT;
     1019     1550    3             IF FO$SYMB.BR.BLK# = 0 THEN FO$SYMB.BR.REC#=0;
     1020     1551    3             ELSE
     1021     1552    4               DO;
     1022     1553    4               FO$SYMB.BR.BLK#=FO$SYMB.BR.BLK#-1;
     1023     1554    4               FO$SYMB.BR.REC#=9999;
     1024     1555    4               IF FO$SYMB.CUREXT THEN
     1025     1556    4                FO$SYMB.CUREXT.STAMP.FRDAD=FO$SYMB.CUREXT.STAMP.FRDAD-1;
     1026     1557    4               END;
     1027     1558    3             END;
     1028     1559    2           ELSE
     1029     1560    3             DO;
     1030     1561    3             FO$SYMB.PGDONE = FO$SYMB.PGDONE + FO$SYMB.BUF$->FM$GRAN.KEYCNT;
     1031     1562    3             FO$SYMB.BR.BLK#=FO$SYMB.BR.BLK#+1;
     1032     1563    3             FO$SYMB.BR.REC#=0;
     1033     1564    3             IF FO$SYMB.CUREXT THEN
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:116  
     1034     1565    3              FO$SYMB.CUREXT.STAMP.FRDAD=FO$SYMB.CUREXT.STAMP.FRDAD+1;
     1035     1566    3             END;
     1036     1567    2           END; /* DO INHIBIT */
     1037     1568    1         GOTO DISKQ;
     1038     1569        /**/
     1039     1570        /**/
     1040     1571    1   FOM$DISKQ: ENTRY (FO$SYMB) ALTRET;
     1041     1572        /**/
     1042     1573        /**/
     1043     1574        /*F* NAME:         FOM$DISKQ
     1044     1575             PURPOSE:      To queue a disk read for MOOS
     1045     1576             DESCRIPTION:
     1046     1577                           This routine is called from FOM$PMME, to start
     1047     1578                           MOOS on a halted or just-opened symbiont.
     1048     1579
     1049     1580                           For all of the entry points to this routine,
     1050     1581                           the disk read parameters are set into the request
     1051     1582                           packet; in particular, the endaction routine
     1052     1583                           is FOM$DISKEA.  Then, if running on endaction
     1053     1584                           (i.e. entered at FOM$NXDISK from FOM$DEVEA, or
     1054     1585                           FOM$SNXDISK from FOM$DISKEA), the re-queue bit
     1055     1586                           in the request packet is set and we return.
     1056     1587                           Otherwise (i.e. entered at FOM$DISKQ from FOM$PMME
     1057     1588                           or FOM$RNXDISK from FOM$SYMBIN), NIO$QUE is
     1058     1589                           called and we return. */
     1059     1590        /**/
     1060     1591        /**/
     1061     1592    1         ON_ENDAC=0;
     1062     1593    1   DISKQ:;
     1063     1594                                      /* DEVLDCTX is the LDCTX if the device
     1064     1595                                         LDCT */
     1065     1596    1         LDCT$=NK$LDCT$(FO$SYMB.DEVLDCTX);
     1066     1597                                /* IF THERE ARE NO GRANS LEFT, GO IDLE */
     1067     1598    1         IF FO$SYMB.CUREXT.NGRAN=0 THEN
     1068     1599    2           DO;
     1069     1600    2           IF FO$SYMB.CUREXT.DAD~=0 THEN
     1070     1601    2            IF FO$SYMB.SPACING THEN
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:117  
     1071     1602    3              DO;
     1072     1603    3              CALL FOM$EVENT (FO$SYMB,FOSE_SPEF)   ALTRET(ALTRT);
     1073     1604    3              RETURN;
     1074     1605    3              END;
     1075     1606    2            ELSE
     1076     1607    2             CALL FOM$TELLAU (FO$SYMB,%CG_SFEXT#,1);
     1077     1608    2           IF FO$SYMB.SETX = 0
     1078     1609    2           THEN
     1079     1610    2            CALL FOM$EVENT (FO$SYMB,FOSE_IALN) ALTRET(ALTRT);
     1080     1611    2           ELSE
     1081     1612    2            CALL FOM$EVENT (FO$SYMB,FOSE_NDSK) ALTRET(ALTRT);
     1082     1613    2           RETURN;
     1083     1614    2           END;
     1084     1615    1         IOQ$=FO$SYMB.IOQ$;
     1085     1616    1         IOQ$->N$REQ.BUFSIZE=4096;
     1086     1617    1         IOQ$->N$REQ.FC=%N_RDBIN;
     1087     1618    1         IOQ$->N$REQ.OPFLG=OP_EA|OP_BPF|OP_HOLD;
     1088     1619                                /* NOTE THAT WE ALWAYS USE THE SAME REQ PACKET */
     1089     1620    1         IOQ$->N$REQ.EAENTRY=ENTADDR(FOM$DISKEA);
     1090     1621    1         IOQ$->N$REQ.DLA=BINBIT(FO$SYMB.CUREXT.DAD,36);
     1091     1622    1         CALL FAF$SRTODR (IOQ$->N$REQ.DLA,FO$SYMB.SETX) ALTRET(BAD_DA);
     1092     1623                                /* CHANGE STATE TO DKIO */
     1093     1624    1         CALL FOM$EVENT (FO$SYMB,FOSE_DKIO) ALTRET(ALTRT);
     1094     1625
     1095     1626                                      /* Set request flag, else send granule */
     1096     1627    1         IF ON_ENDAC = 1 THEN
     1097     1628    1          IOQ$->N$REQ.OPFLG.REQ='1'B;
     1098     1629    1         ELSE CALL NIO$QUE (IOQ$->N$REQ);
     1099     1630    1         RETURN;
     1100     1631    1   ALTRT:;
     1101     1632    1         ALTRETURN;
     1102     1633    1   BAD_DA:;
     1103     1634    1         CALL SC_BADSYMBDA;
     1104     1635        /*S* SCREECH_CODE: FOM-S$BADSYMBDA
     1105     1636             TYPE:         SNAP
     1106     1637             MESSAGE:      Bad disk address in MOOS
     1107     1638             DESCRIPTION:  The disk address of the disk granule about to
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:118  
     1108     1639                           be read does not pass FAF$SRTODR check.  This
     1109     1640                           may be because the SETX in the context block is
     1110     1641                           clobbered, or because the disk address itself is
     1111     1642                           illegal, or because the data bases used by
     1112     1643                           FAF$SRTODR are smashed.  Note that all disk ext-
     1113     1644                           ents are checked (via FAF$SRTODR) when OUTSYM
     1114     1645                           gets them, hence something has definitely been
     1115     1646                           smashed since OUTSYM constructed this extent.
     1116     1647                           A SNAP dump is taken and the file jerked off
     1117     1648                           the device & removed from OUTSYM's tables,
     1118     1649                           to be printed next time the system is booted. */
     1119     1650    1         FO$SYMB.BUF$->FO$SBUF.FERR.CODE=FOME_DSKADD#;
     1120     1651    1         FO$SYMB.BUF$->FO$SBUF.FERR.BLK#=FO$SYMB.BR.BLK#;
     1121     1652    1         CALL FOM$EVENT (FO$SYMB,FOSE_HLTR,FOHR_FERR#);
     1122     1653    1         RETURN;
     1123     1654
     1124     1655        /**/
     1125     1656    1   END FOM$NXDISK;
     1126     1657        /**/
     1127     1658        /**/
     1128     1659        %EOD;

PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:119  
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$NXDISK.

   Procedure FOM$NXDISK requires 206 words for executable code.
   Procedure FOM$NXDISK requires 12 words of local(AUTO) storage.

PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:120  

 Object Unit name= FOM$NXDISK                                 File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:09:43.12 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   206    316  FOM$NXDISK
    1  RoData even  none    13     15  FOM$NXDISK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  FOM$NXDISK
     0      5          yes     yes      Std        1  FOM$RNXDISK
     0     35          yes     yes      Std        1  FOM$SNXDISK
     0    130          yes     yes      Std        1  FOM$DISKQ

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 FOM$EVENT
 yes     yes           Std       1 NIO$QUE
 yes     yes           Std       3 FOM$TELLAU
         yes           Std       1 FOM$DISKEA
 yes     yes           Std       2 FAF$SRTODR
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:121  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BADSYMBDA                     r    FOSE_SWDN                        r    FOSE_NDSK
r    FOSE_IALN                        r    FOSE_DKIO                        r    FOSE_HLTR
r    FOSE_DGDN                        r    FOSE_SPEF                             N$DCT$$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:122  


      886        1        /*T***********************************************************/
      887        2        /*T*                                                         */
      888        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      889        4        /*T*                                                         */
      890        5        /*T***********************************************************/
      891        6        /**/
      892        7        /**/
      893        8        FOM$NXDISK: PROC (FO$SYMB) ALTRET;

      8  0 000000   000000 700200 xent  FOM$NXDISK   TSX0  ! X66_AUTO_1
         0 000001   000014 000001                    ZERO    12,1

      894        9        /**/
      895       10        /**/
      896       11        /*F* NAME:         FOM$NXDISK
      897       12             PURPOSE:      To queue the next disk read for MOOS
      898       13             DESCRIPTION:  The blk-rec pointers in the symb cntxt blk
      899       14                           are updated, and we fall thru to FOM$DISKQ.
      900       15
      901       16                           Called after the last-read disk gran has been
      902       17                           successfully sent to its destination,
      903       18                           i.e. from FOM$DEVEA for local devices */
      904       19        /**/
      905       20
      906       21
      907       22        /**/
      908       23        /*  INCLUDES */
      909       24        /**/
      910       25        %INCLUDE FOM$STRUCT;
      911       86        %INCLUDE N$REQ;
      912      160        %INCLUDE NK$LDCT;
      913      262        %INCLUDE KC_SUBS_C;
      914      278        %INCLUDE N_FC_C;
      915      315        %INCLUDE FOM_SUBS_C;
      916      378        %INCLUDE FOM_DATA_R;
      917      627        %INCLUDE NK_LDCT_R;
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:123  
      918      636        %INCLUDE FM$GRAN;
      919      705        %INCLUDE KC_CP6;
      920     1265
      921     1266
      922     1267        /**/
      923     1268        /* PARAMETERS */
      924     1269        /**/
      925     1270        %FOM$SYMB (STCLASS="",NAME=FO$SYMB);
      926     1302
      927     1303
      928     1304        /**/
      929     1305        /* BASED STRUCTURES */
      930     1306        /**/
      931     1307        %N$REQ;
      932     1365        %NK$LDCT;
      933     1411        %FM$GRAN;
      934     1415        %FOM$SBUF;
      935     1419
      936     1420
      937     1421        /**/
      938     1422        /* AUTO */
      939     1423        /**/
      940     1424    1   DCL IOQ$ PTR;
      941     1425    1   DCL LDCT$ PTR;
      942     1426    1   DCL ON_ENDAC UBIN WORD;
      943     1427
      944     1428
      945     1429        /**/
      946     1430        /*  REFS */
      947     1431        /**/
      948     1432    1   DCL FAF$SRTODR         ENTRY(2) ALTRET;
      949     1433    1   DCL FOM$DISKEA         ENTRY(1);
      950     1434    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
      951     1435    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
      952     1436    1   DCL NIO$QUE            ENTRY(1) ALTRET;
      953     1437    1   DCL SC_BADSYMBDA ENTRY CONV(2,0);
      954     1438
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:124  
      955     1439
      956     1440        /**/
      957     1441        /* SUBS */
      958     1442        /**/
      959     1443        %EQU_CG;
      960     1491        /**/
      961     1492        /**/
      962     1493        /* START HERE */
      963     1494        /**/
      964     1495    1         ON_ENDAC=1;

   1495  0 000002   000001 235007                    LDA     1,DL
         0 000003   200006 755100                    STA     ON_ENDAC,,AUTO

      965     1496    1         GOTO NXDISK0;

   1496  0 000004   000010 710000 0                  TRA     NXDISK0

      966     1497
      967     1498        /**/
      968     1499        /**/
      969     1500    1   FOM$RNXDISK: ENTRY(FO$SYMB) ALTRET;

   1500  0 000005   000000 700200 xent  FOM$RNXDISK  TSX0  ! X66_AUTO_1
         0 000006   000014 000001                    ZERO    12,1

      970     1501        /**/
      971     1502        /*F* NAME:         FOM$RNXDISK
      972     1503             PURPOSE:      To queue the next disk read for MOOS
      973     1504             DESCRIPTION:  Same as FOM$NXDISK but for remote devices.
      974     1505                           Called from FOM$SYMBIN. */
      975     1506        /**/
      976     1507    1         ON_ENDAC=0;

   1507  0 000007   200006 450100                    STZ     ON_ENDAC,,AUTO

   1507  0 000010                       NXDISK0      null
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:125  
      977     1508    1   NXDISK0:;
      978     1509                                /* MAKE SURE STATE IS OK FIRST */
      979     1510                                      /* Device ENDAC */
      980     1511    1         CALL FOM$EVENT (FO$SYMB,FOSE_SWDN) ALTRET(ALTRT);

   1511  0 000010   000000 236000 1                  LDQ     0
         0 000011   200003 235100                    LDA     @FO$SYMB,,AUTO
         0 000012   200010 757100                    STAQ    ON_ENDAC+2,,AUTO
         0 000013   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000014   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000015   000000 701000 xent               TSX1    FOM$EVENT
         0 000016   000271 702000 0                  TSX2    ALTRT

      981     1512    2           DO INHIBIT;

      982     1513    2           IF FO$SYMB.XMTABS THEN

   1513  0 000017   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000020   000012 236300                    LDQ   ! 10,,PR0
         0 000021   000100 316207                    CANQ  ! 64,DL
         0 000022   000026 600200 0                  TZE   ! s:1519

      983     1514    3             DO;

      984     1515    3             FO$SYMB.XMTABS='0'B;

   1515  0 000023   000001 236200 1                  LDQ   ! 1
         0 000024   000012 356300                    ANSQ  ! 10,,PR0

      985     1516    3             GOTO DISKQ;

   1516  0 000025   000133 710200 0                  TRA   ! DISKQ

      986     1517    3             END;
      987     1518                                                     /**/
      988     1519    2           IF FO$SYMB.XMVFU

PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:126  
   1519  0 000026   000020 316207                    CANQ  ! 16,DL
         0 000027   000033 600200 0                  TZE   ! s:1526

      989     1520    2           THEN
      990     1521    3             DO;

      991     1522    3             FO$SYMB.XMVFU='0'B;

   1522  0 000030   000002 236200 1                  LDQ   ! 2
         0 000031   000012 356300                    ANSQ  ! 10,,PR0

      992     1523    3             GOTO DISKQ;

   1523  0 000032   000133 710200 0                  TRA   ! DISKQ

      993     1524    3             END;
      994     1525                                                     /**/
      995     1526    2           GOTO NXDISK;

   1526  0 000033   000050 710200 0                  TRA   ! NXDISK

      996     1527    2           END;

   1527  0 000034   000037 710000 0                  TRA     s:1540

      997     1528        /**/
      998     1529        /**/
      999     1530    1   FOM$SNXDISK: ENTRY (FO$SYMB) ALTRET;

   1530  0 000035   000000 700200 xent  FOM$SNXDISK  TSX0  ! X66_AUTO_1
         0 000036   000014 000001                    ZERO    12,1

     1000     1531        /**/
     1001     1532        /*F* NAME:         FOM$SNXDISK
     1002     1533             PURPOSE:      To queue the next disk read for MOOS during spacing
     1003     1534                           or when a granule has no records.
     1004     1535             DESCRIPTION:  Same as FOM$NXDISK but a different event must
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:127  
     1005     1536                           be reported to FOM$EVENT because we're coming
     1006     1537                           off disk endaction instead of device endac. */
     1007     1538        /**/
     1008     1539                                      /* Disk ENDAC */
     1009     1540    1         CALL FOM$EVENT (FO$SYMB,FOSE_DGDN) ALTRET(ALTRT);

   1540  0 000037   000003 236000 1                  LDQ     3
         0 000040   200003 235100                    LDA     @FO$SYMB,,AUTO
         0 000041   200010 757100                    STAQ    ON_ENDAC+2,,AUTO
         0 000042   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000043   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000044   000000 701000 xent               TSX1    FOM$EVENT
         0 000045   000271 702000 0                  TSX2    ALTRT

     1010     1541    1         ON_ENDAC=1;

   1541  0 000046   000001 235007                    LDA     1,DL
         0 000047   200006 755100                    STA     ON_ENDAC,,AUTO

     1011     1542                                /* UPDATE BLKREC */
     1012     1543    2           DO INHIBIT;

     1013     1544    2   NXDISK:
     1014     1545                                      /* Position ourselves in extent to next
     1015     1546                                         (or previous) block */
     1016     1547    2           IF FO$SYMB.SPACING AND FO$SYMB.SPACEPAGES<0 THEN

   1547  0 000050   200003 470700       NXDISK       LDP0  ! @FO$SYMB,,AUTO
         0 000051   000012 236300                    LDQ   ! 10,,PR0
         0 000052   040000 316207                    CANQ  ! 16384,DL
         0 000053   000106 600200 0                  TZE   ! s:1561
         0 000054   000011 220300                    LDX0  ! 9,,PR0
         0 000055   000106 605200 0                  TPL   ! s:1561

     1017     1548    3             DO;

     1018     1549    3             FO$SYMB.PGDONE = FO$SYMB.PGDONE - FO$SYMB.BUF$->FM$GRAN.KEYCNT;
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:128  

   1549  0 000056   000002 471700                    LDP1  ! 2,,PR0
         0 000057   100002 236300                    LDQ   ! 2,,PR1
         0 000060   000777 376207                    ANQ   ! 511,DL
         0 000061   200010 756300                    STQ   ! ON_ENDAC+2,,AUTO
         0 000062   000013 236300                    LDQ   ! 11,,PR0
         0 000063   200010 136300                    SBLQ  ! ON_ENDAC+2,,AUTO
         0 000064   000013 756300                    STQ   ! 11,,PR0

     1019     1550    3             IF FO$SYMB.BR.BLK# = 0 THEN FO$SYMB.BR.REC#=0;

   1550  0 000065   000003 221300                    LDX1  ! 3,,PR0
         0 000066   000072 601200 0                  TNZ   ! s:1553

   1550  0 000067   000000 222203                    LDX2  ! 0,DU
         0 000070   000003 442300                    SXL2  ! 3,,PR0
         0 000071   000127 710200 0                  TRA   ! s:1568

     1020     1551    3             ELSE
     1021     1552    4               DO;

     1022     1553    4               FO$SYMB.BR.BLK#=FO$SYMB.BR.BLK#-1;

   1553  0 000072   777777 622211                    EAX2  ! -1,X1
         0 000073   000003 742300                    STX2  ! 3,,PR0

     1023     1554    4               FO$SYMB.BR.REC#=9999;

   1554  0 000074   023417 221203                    LDX1  ! 9999,DU
         0 000075   000003 441300                    SXL1  ! 3,,PR0

     1024     1555    4               IF FO$SYMB.CUREXT THEN

   1555  0 000076   000000 106700                    CMPC  ! fill='000'O
         0 000077   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8
         0 000100   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         0 000101   000127 600200 0                  TZE   ! s:1568
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:129  

     1025     1556    4                FO$SYMB.CUREXT.STAMP.FRDAD=FO$SYMB.CUREXT.STAMP.FRDAD-1;

   1556  0 000102   000005 236300                    LDQ   ! 5,,PR0
         0 000103   000777 036207                    ADLQ  ! 511,DL
         0 000104   000005 552304                    STBQ  ! 5,'04'O,PR0

     1026     1557    4               END;

     1027     1558    3             END;

   1558  0 000105   000127 710200 0                  TRA   ! s:1568

     1028     1559    2           ELSE
     1029     1560    3             DO;

     1030     1561    3             FO$SYMB.PGDONE = FO$SYMB.PGDONE + FO$SYMB.BUF$->FM$GRAN.KEYCNT;

   1561  0 000106   000002 471700                    LDP1  ! 2,,PR0
         0 000107   100002 236300                    LDQ   ! 2,,PR1
         0 000110   000777 376207                    ANQ   ! 511,DL
         0 000111   000013 036300                    ADLQ  ! 11,,PR0
         0 000112   000013 756300                    STQ   ! 11,,PR0

     1031     1562    3             FO$SYMB.BR.BLK#=FO$SYMB.BR.BLK#+1;

   1562  0 000113   000003 220300                    LDX0  ! 3,,PR0
         0 000114   000001 621210                    EAX1  ! 1,X0
         0 000115   000003 741300                    STX1  ! 3,,PR0

     1032     1563    3             FO$SYMB.BR.REC#=0;

   1563  0 000116   000000 220203                    LDX0  ! 0,DU
         0 000117   000003 440300                    SXL0  ! 3,,PR0

     1033     1564    3             IF FO$SYMB.CUREXT THEN

PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:130  
   1564  0 000120   000000 106700                    CMPC  ! fill='000'O
         0 000121   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8
         0 000122   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         0 000123   000127 600200 0                  TZE   ! s:1568

     1034     1565    3              FO$SYMB.CUREXT.STAMP.FRDAD=FO$SYMB.CUREXT.STAMP.FRDAD+1;

   1565  0 000124   000005 236300                    LDQ   ! 5,,PR0
         0 000125   000001 036207                    ADLQ  ! 1,DL
         0 000126   000005 552304                    STBQ  ! 5,'04'O,PR0

     1035     1566    3             END;

     1036     1567    2           END; /* DO INHIBIT */

     1037     1568    1         GOTO DISKQ;

   1568  0 000127   000133 710000 0                  TRA     DISKQ

     1038     1569        /**/
     1039     1570        /**/
     1040     1571    1   FOM$DISKQ: ENTRY (FO$SYMB) ALTRET;

   1571  0 000130   000000 700200 xent  FOM$DISKQ    TSX0  ! X66_AUTO_1
         0 000131   000014 000001                    ZERO    12,1

     1041     1572        /**/
     1042     1573        /**/
     1043     1574        /*F* NAME:         FOM$DISKQ
     1044     1575             PURPOSE:      To queue a disk read for MOOS
     1045     1576             DESCRIPTION:
     1046     1577                           This routine is called from FOM$PMME, to start
     1047     1578                           MOOS on a halted or just-opened symbiont.
     1048     1579
     1049     1580                           For all of the entry points to this routine,
     1050     1581                           the disk read parameters are set into the request
     1051     1582                           packet; in particular, the endaction routine
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:131  
     1052     1583                           is FOM$DISKEA.  Then, if running on endaction
     1053     1584                           (i.e. entered at FOM$NXDISK from FOM$DEVEA, or
     1054     1585                           FOM$SNXDISK from FOM$DISKEA), the re-queue bit
     1055     1586                           in the request packet is set and we return.
     1056     1587                           Otherwise (i.e. entered at FOM$DISKQ from FOM$PMME
     1057     1588                           or FOM$RNXDISK from FOM$SYMBIN), NIO$QUE is
     1058     1589                           called and we return. */
     1059     1590        /**/
     1060     1591        /**/
     1061     1592    1         ON_ENDAC=0;

   1592  0 000132   200006 450100                    STZ     ON_ENDAC,,AUTO

   1592  0 000133                       DISKQ        null
     1062     1593    1   DISKQ:;
     1063     1594                                      /* DEVLDCTX is the LDCTX if the device
     1064     1595                                         LDCT */
     1065     1596    1         LDCT$=NK$LDCT$(FO$SYMB.DEVLDCTX);

   1596  0 000133   200003 470500                    LDP0    @FO$SYMB,,AUTO
         0 000134   000010 720100                    LXL0    8,,PR0
         0 000135   000000 471400 xsym               LDP1    N$DCT$$
         0 000136   100000 236110                    LDQ     0,X0,PR1
         0 000137   200005 756100                    STQ     LDCT$,,AUTO

     1066     1597                                /* IF THERE ARE NO GRANS LEFT, GO IDLE */
     1067     1598    1         IF FO$SYMB.CUREXT.NGRAN=0 THEN

   1598  0 000140   000004 236100                    LDQ     4,,PR0
         0 000141   777000 316003                    CANQ    -512,DU
         0 000142   000214 601000 0                  TNZ     s:1615

     1068     1599    2           DO;

     1069     1600    2           IF FO$SYMB.CUREXT.DAD~=0 THEN

   1600  0 000143   000032 316000 xsym               CANQ    B_VECTNIL+26
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:132  
         0 000144   000171 600000 0                  TZE     s:1608

     1070     1601    2            IF FO$SYMB.SPACING THEN

   1601  0 000145   000012 236100                    LDQ     10,,PR0
         0 000146   040000 316007                    CANQ    16384,DL
         0 000147   000160 600000 0                  TZE     s:1607

     1071     1602    3              DO;

     1072     1603    3              CALL FOM$EVENT (FO$SYMB,FOSE_SPEF)   ALTRET(ALTRT);

   1603  0 000150   000004 236000 1                  LDQ     4
         0 000151   200003 235100                    LDA     @FO$SYMB,,AUTO
         0 000152   200010 757100                    STAQ    ON_ENDAC+2,,AUTO
         0 000153   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000154   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000155   000000 701000 xent               TSX1    FOM$EVENT
         0 000156   000271 702000 0                  TSX2    ALTRT

     1073     1604    3              RETURN;

   1604  0 000157   000000 702200 xent               TSX2  ! X66_ARET

     1074     1605    3              END;
     1075     1606    2            ELSE
     1076     1607    2             CALL FOM$TELLAU (FO$SYMB,%CG_SFEXT#,1);

   1607  0 000160   000006 236000 1                  LDQ     6
         0 000161   200012 756100                    STQ     ON_ENDAC+4,,AUTO
         0 000162   000007 236000 1                  LDQ     7
         0 000163   200003 235100                    LDA     @FO$SYMB,,AUTO
         0 000164   200010 757100                    STAQ    ON_ENDAC+2,,AUTO
         0 000165   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000166   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000167   000000 701000 xent               TSX1    FOM$TELLAU
         0 000170   000000 011000                    NOP     0
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:133  

     1077     1608    2           IF FO$SYMB.SETX = 0

   1608  0 000171   200003 470500                    LDP0    @FO$SYMB,,AUTO
         0 000172   000012 220100                    LDX0    10,,PR0
         0 000173   000204 601000 0                  TNZ     s:1612

     1078     1609    2           THEN
     1079     1610    2            CALL FOM$EVENT (FO$SYMB,FOSE_IALN) ALTRET(ALTRT);

   1610  0 000174   000010 236000 1                  LDQ     8
         0 000175   200003 235100                    LDA     @FO$SYMB,,AUTO
         0 000176   200010 757100                    STAQ    ON_ENDAC+2,,AUTO
         0 000177   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000200   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000201   000000 701000 xent               TSX1    FOM$EVENT
         0 000202   000271 702000 0                  TSX2    ALTRT
         0 000203   000213 710000 0                  TRA     s:1613

     1080     1611    2           ELSE
     1081     1612    2            CALL FOM$EVENT (FO$SYMB,FOSE_NDSK) ALTRET(ALTRT);

   1612  0 000204   000011 236000 1                  LDQ     9
         0 000205   200003 235100                    LDA     @FO$SYMB,,AUTO
         0 000206   200010 757100                    STAQ    ON_ENDAC+2,,AUTO
         0 000207   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000210   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000211   000000 701000 xent               TSX1    FOM$EVENT
         0 000212   000271 702000 0                  TSX2    ALTRT

     1082     1613    2           RETURN;

   1613  0 000213   000000 702200 xent               TSX2  ! X66_ARET

     1083     1614    2           END;
     1084     1615    1         IOQ$=FO$SYMB.IOQ$;

PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:134  
   1615  0 000214   000001 236100                    LDQ     1,,PR0
         0 000215   200004 756100                    STQ     IOQ$,,AUTO

     1085     1616    1         IOQ$->N$REQ.BUFSIZE=4096;

   1616  0 000216   200004 473500                    LDP3    IOQ$,,AUTO
         0 000217   300004 236100                    LDQ     4,,PR3
         0 000220   177777 376007                    ANQ     65535,DL
         0 000221   002000 276003                    ORQ     1024,DU
         0 000222   300004 756100                    STQ     4,,PR3

     1086     1617    1         IOQ$->N$REQ.FC=%N_RDBIN;

   1617  0 000223   000002 236007                    LDQ     2,DL
         0 000224   300003 552104                    STBQ    3,'04'O,PR3

     1087     1618    1         IOQ$->N$REQ.OPFLG=OP_EA|OP_BPF|OP_HOLD;

   1618  0 000225   000054 236007                    LDQ     44,DL
         0 000226   300004 552104                    STBQ    4,'04'O,PR3

     1088     1619                                /* NOTE THAT WE ALWAYS USE THE SAME REQ PACKET */
     1089     1620    1         IOQ$->N$REQ.EAENTRY=ENTADDR(FOM$DISKEA);

   1620  0 000227   000000 636000 xent               EAQ     FOM$DISKEA
         0 000230   300023 756100                    STQ     19,,PR3

     1090     1621    1         IOQ$->N$REQ.DLA=BINBIT(FO$SYMB.CUREXT.DAD,36);

   1621  0 000231   000004 236100                    LDQ     4,,PR0
         0 000232   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 000233   300001 756100                    STQ     1,,PR3

     1091     1622    1         CALL FAF$SRTODR (IOQ$->N$REQ.DLA,FO$SYMB.SETX) ALTRET(BAD_DA);

   1622  0 000234   200003 236100                    LDQ     @FO$SYMB,,AUTO
         0 000235   000012 036003                    ADLQ    10,DU
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:135  
         0 000236   200011 756100                    STQ     ON_ENDAC+3,,AUTO
         0 000237   200004 236100                    LDQ     IOQ$,,AUTO
         0 000240   000001 036003                    ADLQ    1,DU
         0 000241   200010 756100                    STQ     ON_ENDAC+2,,AUTO
         0 000242   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000243   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000244   000000 701000 xent               TSX1    FAF$SRTODR
         0 000245   000272 702000 0                  TSX2    BAD_DA

     1092     1623                                /* CHANGE STATE TO DKIO */
     1093     1624    1         CALL FOM$EVENT (FO$SYMB,FOSE_DKIO) ALTRET(ALTRT);

   1624  0 000246   000012 236000 1                  LDQ     10
         0 000247   200003 235100                    LDA     @FO$SYMB,,AUTO
         0 000250   200010 757100                    STAQ    ON_ENDAC+2,,AUTO
         0 000251   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000252   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000253   000000 701000 xent               TSX1    FOM$EVENT
         0 000254   000271 702000 0                  TSX2    ALTRT

     1094     1625
     1095     1626                                      /* Set request flag, else send granule */
     1096     1627    1         IF ON_ENDAC = 1 THEN

   1627  0 000255   200006 235100                    LDA     ON_ENDAC,,AUTO
         0 000256   000001 115007                    CMPA    1,DL
         0 000257   000264 601000 0                  TNZ     s:1629

     1097     1628    1          IOQ$->N$REQ.OPFLG.REQ='1'B;

   1628  0 000260   200004 470500                    LDP0    IOQ$,,AUTO
         0 000261   000002 236007                    LDQ     2,DL
         0 000262   000004 256100                    ORSQ    4,,PR0
         0 000263   000270 710000 0                  TRA     s:1630

     1098     1629    1         ELSE CALL NIO$QUE (IOQ$->N$REQ);

PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:136  
   1629  0 000264   200004 630500                    EPPR0   IOQ$,,AUTO
         0 000265   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000266   000000 701000 xent               TSX1    NIO$QUE
         0 000267   000000 011000                    NOP     0

     1099     1630    1         RETURN;

   1630  0 000270   000000 702200 xent               TSX2  ! X66_ARET

   1627  0 000271                       ALTRT        null
     1100     1631    1   ALTRT:;
     1101     1632    1         ALTRETURN;

   1632  0 000271   000000 702200 xent               TSX2  ! X66_AALT

   1627  0 000272                       BAD_DA       null
     1102     1633    1   BAD_DA:;
     1103     1634    1         CALL SC_BADSYMBDA;

   1634  0 000272   000000 713400 xsym               CLIMB   SC_BADSYMBDA
         0 000273   000000 600000 xsid               climb   nvectors=         0

     1104     1635        /*S* SCREECH_CODE: FOM-S$BADSYMBDA
     1105     1636             TYPE:         SNAP
     1106     1637             MESSAGE:      Bad disk address in MOOS
     1107     1638             DESCRIPTION:  The disk address of the disk granule about to
     1108     1639                           be read does not pass FAF$SRTODR check.  This
     1109     1640                           may be because the SETX in the context block is
     1110     1641                           clobbered, or because the disk address itself is
     1111     1642                           illegal, or because the data bases used by
     1112     1643                           FAF$SRTODR are smashed.  Note that all disk ext-
     1113     1644                           ents are checked (via FAF$SRTODR) when OUTSYM
     1114     1645                           gets them, hence something has definitely been
     1115     1646                           smashed since OUTSYM constructed this extent.
     1116     1647                           A SNAP dump is taken and the file jerked off
     1117     1648                           the device & removed from OUTSYM's tables,
     1118     1649                           to be printed next time the system is booted. */
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:137  
     1119     1650    1         FO$SYMB.BUF$->FO$SBUF.FERR.CODE=FOME_DSKADD#;

   1650  0 000274   200003 470500                    LDP0    @FO$SYMB,,AUTO
         0 000275   000002 471500                    LDP1    2,,PR0
         0 000276   000001 235007                    LDA     1,DL
         0 000277   100010 755100                    STA     8,,PR1

     1120     1651    1         FO$SYMB.BUF$->FO$SBUF.FERR.BLK#=FO$SYMB.BR.BLK#;

   1651  0 000300   000002 471500                    LDP1    2,,PR0
         0 000301   000003 236100                    LDQ     3,,PR0
         0 000302   000022 772000                    QRL     18
         0 000303   100012 756100                    STQ     10,,PR1

     1121     1652    1         CALL FOM$EVENT (FO$SYMB,FOSE_HLTR,FOHR_FERR#);

   1652  0 000304   000013 236000 1                  LDQ     11
         0 000305   200012 756100                    STQ     ON_ENDAC+4,,AUTO
         0 000306   000014 236000 1                  LDQ     12
         0 000307   200003 235100                    LDA     @FO$SYMB,,AUTO
         0 000310   200010 757100                    STAQ    ON_ENDAC+2,,AUTO
         0 000311   200010 630500                    EPPR0   ON_ENDAC+2,,AUTO
         0 000312   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000313   000000 701000 xent               TSX1    FOM$EVENT
         0 000314   000000 011000                    NOP     0

     1122     1653    1         RETURN;

   1653  0 000315   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000000 006000   777777 777677   777777 777757   000000 006000    ................
   1     004   000000 006000   000000 000016   000003 006000   000005 006000    ................
   1     010   000000 006000   000000 006000   000000 006000   000005 006000    ................
   1     014   000000 006000                                                    ....
     1123     1654
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:138  
     1124     1655        /**/
     1125     1656    1   END FOM$NXDISK;
     1126     1657        /**/
     1127     1658        /**/
     1128     1659        %EOD;

PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:139  
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$NXDISK.
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:140  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FO$SYMB                  *0-0-0/w STRC(720)   r     1 FO$SYMB
     4-0-0/w PTR         r     1 IOQ$                       5-0-0/w PTR         r     1 LDCT$
     6-0-0/w UBIN        r     1 ON_ENDAC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 FOSE_DGDN                  0-0-0/w STRC        r     1 FOSE_DKIO
     0-0-0/w STRC        r     1 FOSE_HLTR                  0-0-0/w STRC        r     1 FOSE_IALN
     0-0-0/w STRC        r     1 FOSE_NDSK                  0-0-0/w STRC        r     1 FOSE_SPEF
     0-0-0/w STRC        r     1 FOSE_SWDN                  0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w STRC(468)   r     1 FO$SBUF
     0-0-0/d STRC(1080)  r     1 N$REQ
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)


   Procedure FOM$NXDISK requires 206 words for executable code.
   Procedure FOM$NXDISK requires 12 words of local(AUTO) storage.
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:141  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:142  
          MINI XREF LISTING

ALTRT
      1627**LABEL    1511--CALLALT  1540--CALLALT  1603--CALLALT  1610--CALLALT  1612--CALLALT  1624--CALLALT
BAD_DA
      1627**LABEL    1622--CALLALT
DISKQ
      1592**LABEL    1516--GOTO     1523--GOTO     1568--GOTO
FAF$SRTODR
      1432**DCL-ENT  1622--CALL
FM$GRAN.KEYCNT
      1413**DCL      1549>>ASSIGN   1561>>ASSIGN
FO$SBUF.FERR.BLK#
      1416**DCL      1651<<ASSIGN
FO$SBUF.FERR.CODE
      1416**DCL      1650<<ASSIGN
FO$SYMB
      1281**DCL         8--PROC     1500--ENTRY    1511<>CALL     1530--ENTRY    1540<>CALL     1571--ENTRY
      1603<>CALL     1607<>CALL     1610<>CALL     1612<>CALL     1624<>CALL     1652<>CALL
FO$SYMB.BR.BLK#
      1282**DCL      1283--REDEF    1550>>IF       1553<<ASSIGN   1553>>ASSIGN   1562<<ASSIGN   1562>>ASSIGN
      1651>>ASSIGN
FO$SYMB.BR.REC#
      1283**DCL      1284--REDEF    1550<<ASSIGN   1554<<ASSIGN   1563<<ASSIGN
FO$SYMB.BUF$
      1281**DCL      1282--REDEF    1549>>ASSIGN   1561>>ASSIGN   1650>>ASSIGN   1651>>ASSIGN
FO$SYMB.CUREXT
      1284**DCL      1555>>IF       1564>>IF
FO$SYMB.CUREXT.DAD
      1285**DCL      1600>>IF       1621>>ASSIGN
FO$SYMB.CUREXT.NGRAN
      1284**DCL      1598>>IF
FO$SYMB.CUREXT.STAMP
      1285**DCL      1286--REDEF
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:143  
FO$SYMB.CUREXT.STAMP.FRDAD
      1285**DCL      1556<<ASSIGN   1556>>ASSIGN   1565<<ASSIGN   1565>>ASSIGN
FO$SYMB.DEVLDCTX
      1289**DCL      1596>>ASSIGN
FO$SYMB.IOQ$
      1281**DCL      1615>>ASSIGN
FO$SYMB.PGDONE
      1297**DCL      1549<<ASSIGN   1549>>ASSIGN   1561<<ASSIGN   1561>>ASSIGN
FO$SYMB.SETX
      1291**DCL      1608>>IF       1622<>CALL
FO$SYMB.SPACEPAGES
      1289**DCL      1290--REDEF    1547>>IF
FO$SYMB.SPACING
      1292**DCL      1547>>IF       1601>>IF
FO$SYMB.XMTABS
      1295**DCL      1513>>IF       1515<<ASSIGN
FO$SYMB.XMVFU
      1296**DCL      1519>>IF       1522<<ASSIGN
FOM$DISKEA
      1433**DCL-ENT  1620--ASSIGN
FOM$EVENT
      1434**DCL-ENT  1511--CALL     1540--CALL     1603--CALL     1610--CALL     1612--CALL     1624--CALL
      1652--CALL
FOM$TELLAU
      1435**DCL-ENT  1607--CALL
FOSE_DGDN
       593**DCL      1540<>CALL
FOSE_DKIO
       443**DCL      1624<>CALL
FOSE_HLTR
       563**DCL      1652<>CALL
FOSE_IALN
       428**DCL      1610<>CALL
FOSE_NDSK
       413**DCL      1612<>CALL
FOSE_SPEF
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:144  
       623**DCL      1603<>CALL
FOSE_SWDN
       398**DCL      1511<>CALL
IOQ$
      1424**DCL      1615<<ASSIGN   1616>>ASSIGN   1617>>ASSIGN   1618>>ASSIGN   1620>>ASSIGN   1621>>ASSIGN
      1622>>CALL     1628>>ASSIGN   1629>>CALL
LDCT$
      1425**DCL      1596<<ASSIGN
N$DCT$$
       634**DCL       634--IMP-PTR  1596>>ASSIGN
N$REQ
      1316**DCL      1629<>CALL
N$REQ.BUFADDR
      1325**DCL      1326--REDEF    1326--REDEF
N$REQ.BUFSIZE
      1319**DCL      1616<<ASSIGN
N$REQ.DLA
      1316**DCL      1621<<ASSIGN   1622<>CALL
N$REQ.DLA.DRELADDR
      1317**DCL      1317--REDEF
N$REQ.DVE.EOMCHAR
      1354**DCL      1355--REDEF
N$REQ.EAENTRY
      1347**DCL      1620<<ASSIGN
N$REQ.EAINFO
      1348**DCL      1348--REDEF
N$REQ.EAINFOX
      1348**DCL      1349--REDEF
N$REQ.EVNTINFO
      1349**DCL      1349--REDEF
N$REQ.FC
      1319**DCL      1617<<ASSIGN
N$REQ.OPFLG
      1322**DCL      1618<<ASSIGN
N$REQ.OPFLG.REQ
      1324**DCL      1628<<ASSIGN
PL6.E3A0      #002=FOM$NXDISK File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:145  
N$REQ.STATUS
      1330**DCL      1336--REDEF
NIO$QUE
      1436**DCL-ENT  1629--CALL
NK$LDCT.DDT$
      1380**DCL      1380--REDEF
NK$LDCT.IOQ$
      1379**DCL      1380--REDEF
NK$LDCT.LDCTX
      1381**DCL      1381--REDEF
NK$LDCT.LKFLG.ABORTED
      1393**DCL      1394--REDEF
NK$LDCT.RLCID.LDCTX
      1403**DCL      1403--REDEF
NK$LDCT.STA$
      1399**DCL      1400--REDEF
NK$LDCT.SYMB$
      1378**DCL      1378--REDEF    1378--REDEF    1379--REDEF
NK$LDCT$
       634**DCL      1596>>ASSIGN
NXDISK
      1547**LABEL    1526--GOTO
NXDISK0
      1507**LABEL    1496--GOTO
ON_ENDAC
      1426**DCL      1495<<ASSIGN   1507<<ASSIGN   1541<<ASSIGN   1592<<ASSIGN   1627>>IF
SC_BADSYMBDA
      1437**DCL-ENT  1634--CALL

PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:146  
     1129        1        /*T***********************************************************/
     1130        2        /*T*                                                         */
     1131        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1132        4        /*T*                                                         */
     1133        5        /*T***********************************************************/
     1134        6        /**/
     1135        7        /**/
     1136        8        FOM$TIMR: PROC (SYMB$);
     1137        9        /**/
     1138       10        /**/
     1139       11        /*F* NAME:         FOM$TIMR
     1140       12             PURPOSE:      To re-awaken MOOS for some reason.
     1141       13             DESCRIPTION:  This routine is called as a result of a
     1142       14                           previous call to SSC$MONTIMR, when MOOS
     1143       15                           must temporarily defer itself.  This
     1144       16                           need arises when:
     1145       17
     1146       18                           1) An FEP output queue request (for symb gran
     1147       19                              or symb halt req) was refused.
     1148       20
     1149       21                           Various flags in the symb context blk
     1150       22                           tell FOM$TIMR what was deferred and hence
     1151       23                           what must be done next.       */
     1152       24
     1153       25        /**/
     1154       26        /*  INCLUDES */
     1155       27        /**/
     1156       28        %INCLUDE FOM$STRUCT;
     1157       89        %INCLUDE N$REQ;
     1158      163        %INCLUDE FOM_DATA_R;
     1159      412
     1160      413
     1161      414        /**/
     1162      415        /* PARAMETERS */
     1163      416        /**/
     1164      417    1   DCL SYMB$ PTR;
     1165      418
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:147  
     1166      419
     1167      420        /**/
     1168      421        /* BASED STRUCTURES */
     1169      422        /**/
     1170      423        %FOM$SYMB (NAME=FO$SYMB);
     1171      455        %N$REQ;
     1172      513
     1173      514
     1174      515        /**/
     1175      516        /*  REFS */
     1176      517        /**/
     1177      518    1   DCL FOM$DISKEAR        ENTRY(1);
     1178      519    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     1179      520        /**/
     1180      521        /**/
     1181      522    2           DO INHIBIT;
     1182      523                                /* REQ FEP SYMB HALT REQ IF DEFERRED */
     1183      524    2           IF SYMB$->FO$SYMB.HRQWAIT THEN
     1184      525    3             DO;
     1185      526                                /* ZAP DEFERRED FLAG */
     1186      527    3             SYMB$->FO$SYMB.HRQWAIT='0'B;
     1187      528                                      /* Halt request */
     1188      529    3             CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_HRQR);
     1189      530    3             RETURN;
     1190      531    3             END;
     1191      532    2           END;
     1192      533        /**/
     1193      534    1   END FOM$TIMR;
     1194      535        /**/
     1195      536        /**/
     1196      537        %EOD;

PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:148  
--  Include file information  --

   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$TIMR.

   Procedure FOM$TIMR requires 19 words for executable code.
   Procedure FOM$TIMR requires 6 words of local(AUTO) storage.

PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:149  

 Object Unit name= FOM$TIMR                                   File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:09:52.56 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    19     23  FOM$TIMR
    1  RoData even  none     2      2  FOM$TIMR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  FOM$TIMR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 FOM$EVENT
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    FOSE_HRQR                             B_VECTNIL
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:150  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:151  


     1129        1        /*T***********************************************************/
     1130        2        /*T*                                                         */
     1131        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1132        4        /*T*                                                         */
     1133        5        /*T***********************************************************/
     1134        6        /**/
     1135        7        /**/
     1136        8        FOM$TIMR: PROC (SYMB$);

      8  0 000000   000000 700200 xent  FOM$TIMR     TSX0  ! X66_AUTO_1
         0 000001   000006 000001                    ZERO    6,1

     1137        9        /**/
     1138       10        /**/
     1139       11        /*F* NAME:         FOM$TIMR
     1140       12             PURPOSE:      To re-awaken MOOS for some reason.
     1141       13             DESCRIPTION:  This routine is called as a result of a
     1142       14                           previous call to SSC$MONTIMR, when MOOS
     1143       15                           must temporarily defer itself.  This
     1144       16                           need arises when:
     1145       17
     1146       18                           1) An FEP output queue request (for symb gran
     1147       19                              or symb halt req) was refused.
     1148       20
     1149       21                           Various flags in the symb context blk
     1150       22                           tell FOM$TIMR what was deferred and hence
     1151       23                           what must be done next.       */
     1152       24
     1153       25        /**/
     1154       26        /*  INCLUDES */
     1155       27        /**/
     1156       28        %INCLUDE FOM$STRUCT;
     1157       89        %INCLUDE N$REQ;
     1158      163        %INCLUDE FOM_DATA_R;
     1159      412
     1160      413
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:152  
     1161      414        /**/
     1162      415        /* PARAMETERS */
     1163      416        /**/
     1164      417    1   DCL SYMB$ PTR;
     1165      418
     1166      419
     1167      420        /**/
     1168      421        /* BASED STRUCTURES */
     1169      422        /**/
     1170      423        %FOM$SYMB (NAME=FO$SYMB);
     1171      455        %N$REQ;
     1172      513
     1173      514
     1174      515        /**/
     1175      516        /*  REFS */
     1176      517        /**/
     1177      518    1   DCL FOM$DISKEAR        ENTRY(1);
     1178      519    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     1179      520        /**/
     1180      521        /**/
     1181      522    2           DO INHIBIT;

     1182      523                                /* REQ FEP SYMB HALT REQ IF DEFERRED */
     1183      524    2           IF SYMB$->FO$SYMB.HRQWAIT THEN

    524  0 000002   200003 470700                    LDP0  ! @SYMB$,,AUTO
         0 000003   000000 471700                    LDP1  ! 0,,PR0
         0 000004   100012 236300                    LDQ   ! 10,,PR1
         0 000005   200000 316207                    CANQ  ! 65536,DL
         0 000006   000022 600200 0                  TZE   ! s:534

     1184      525    3             DO;

     1185      526                                /* ZAP DEFERRED FLAG */
     1186      527    3             SYMB$->FO$SYMB.HRQWAIT='0'B;

    527  0 000007   000000 236200 1                  LDQ   ! 0
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:153  
         0 000010   100012 356300                    ANSQ  ! 10,,PR1

     1187      528                                      /* Halt request */
     1188      529    3             CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_HRQR);

    529  0 000011   000000 471700                    LDP1  ! 0,,PR0
         0 000012   000001 236200 1                  LDQ   ! 1
         0 000013   200005 756300                    STQ   ! @SYMB$+2,,AUTO
         0 000014   200004 451700                    STP1  ! @SYMB$+1,,AUTO
         0 000015   200004 630700                    EPPR0 ! @SYMB$+1,,AUTO
         0 000016   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         0 000017   000000 701200 xent               TSX1  ! FOM$EVENT
         0 000020   000000 011200                    NOP   ! 0

     1189      530    3             RETURN;

    530  0 000021   000000 702200 xent               TSX2  ! X66_ARET

     1190      531    3             END;
     1191      532    2           END;

     1192      533        /**/
     1193      534    1   END FOM$TIMR;

    534  0 000022   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   777777 577777   000000 006000                                    ........
     1194      535        /**/
     1195      536        /**/
     1196      537        %EOD;

PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:154  
--  Include file information  --

   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$TIMR.
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:155  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @SYMB$                    *0-0-0/w PTR         r     1 SYMB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 FOSE_HRQR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(720)   r     1 FO$SYMB


   Procedure FOM$TIMR requires 19 words for executable code.
   Procedure FOM$TIMR requires 6 words of local(AUTO) storage.
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:156  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:157  
          MINI XREF LISTING

FO$SYMB
       434**DCL       529<>CALL
FO$SYMB.BR.BLK#
       435**DCL       436--REDEF
FO$SYMB.BR.REC#
       436**DCL       437--REDEF
FO$SYMB.BUF$
       434**DCL       435--REDEF
FO$SYMB.CUREXT.STAMP
       438**DCL       439--REDEF
FO$SYMB.HRQWAIT
       445**DCL       524>>IF        527<<ASSIGN
FO$SYMB.SPACEPAGES
       442**DCL       443--REDEF
FOM$EVENT
       519**DCL-ENT   529--CALL
FOSE_HRQR
       363**DCL       529<>CALL
N$REQ.BUFADDR
       473**DCL       474--REDEF     474--REDEF
N$REQ.DLA.DRELADDR
       465**DCL       465--REDEF
N$REQ.DVE.EOMCHAR
       502**DCL       503--REDEF
N$REQ.EAINFO
       496**DCL       496--REDEF
N$REQ.EAINFOX
       496**DCL       497--REDEF
N$REQ.EVNTINFO
       497**DCL       497--REDEF
N$REQ.STATUS
       478**DCL       484--REDEF
PL6.E3A0      #003=FOM$TIMR File=FOM$MOOS.:E05TSI                                TUE 07/29/97 17:09 Page:158  
SYMB$
       417**DCL         8--PROC      524>>IF        527>>ASSIGN    529>>CALL

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:159  
     1197        1        /*T***********************************************************/
     1198        2        /*T*                                                         */
     1199        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1200        4        /*T*                                                         */
     1201        5        /*T***********************************************************/
     1202        6        /**/
     1203        7        /**/
     1204        8        FOM$DISKEA: PROC (N$REQ);
     1205        9        /**/
     1206       10        /**/
     1207       11        /*F* NAME:         FOM$DISKEA
     1208       12             PURPOSE:      To propagate MOOS after a disk read
     1209       13             DESCRIPTION:
     1210       14                           First, if the disk read did not succeed, the
     1211       15                           symbiont's state is set to HELD and OUTSYM
     1212       16                           is told, and we exit.
     1213       17                           Otherwise, the pointers for the current disk
     1214       18                           extent are adjusted, and OUTSYM is asked
     1215       19                           for another extent if we need one.
     1216       20                           Finally, the granule just read is dispatched
     1217       21                           to its destination.                     */
     1218       22        /**/
     1219       23        /*  INCLUDES */
     1220       24        /**/
     1221       25        %INCLUDE FOM$STRUCT;
     1222       86        %INCLUDE FS_SUPER_C;
     1223      849        %INCLUDE KV$VDO;
     1224     1864        %INCLUDE N$REQ;
     1225     1938        %INCLUDE NK$LDCT;
     1226     2040        %INCLUDE NI_DATA_C ;
     1227     2153        %INCLUDE N_FC_C;
     1228     2190        %INCLUDE FOM_SUBS_C;
     1229     2253        %INCLUDE KC_SUBS_C;
     1230     2269        %INCLUDE FOM_DATA_R;
     1231     2518        %INCLUDE FM$GRAN;
     1232     2587        %INCLUDE NK_LDCT_R;
     1233     2596        %INCLUDE NK_VFC_C;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:160  
     1234     2670        %INCLUDE CP_6_SUBS;
     1235     3210        %INCLUDE FOO_MAC_C;
     1236     3958        %INCLUDE UM$CP6V_C;
     1237     4145        %INCLUDE KC_CP6;
     1238     4705        %INCLUDE K_DATA_R;
     1239     5416
     1240     5417
     1241     5418        /**/
     1242     5419        /* PARAMETERS */
     1243     5420        /**/
     1244     5421        %N$REQ (STCLASS="");
     1245     5479
     1246     5480
     1247     5481        /**/
     1248     5482        /* BASED STRUCTURES */
     1249     5483        /**/
     1250     5484        %FOM$SYMB (NAME=FO$SYMB);
     1251     5516        %FS$SVFU (NAME=FS$SOFT_VFU,STCLASS=BASED);
     1252     5536        %NK$LDCT;
     1253     5582        %FOM$TABS;
     1254     5585        %FM$GRAN;
     1255     5589        %NK$VFC;
     1256     5607        %FM$CON;
     1257     5611    1   DCL B$TABS CHAR(RECL) BASED CALIGNED;
     1258     5612    1   DCL B$BYTE UBIN BYTE BASED CALIGNED;
     1259     5613    1   DCL B$REC CHAR(RECL) BASED CALIGNED;
     1260     5614        %VLP$SYMBWRITE_V (FPTN=VLP$WRITE);
     1261     5617        %FOM$SBUF;
     1262     5621
     1263     5622
     1264     5623        /**/
     1265     5624        /* AUTO */
     1266     5625        /**/
     1267     5626    1   DCL SYMB$ PTR;
     1268     5627    1   DCL RECL UBIN WORD;
     1269     5628    1   DCL DOIOQ UBIN WORD;
     1270     5629    1   DCL VFCFCN UBIN WORD ;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:161  
     1271     5630    1   DCL RECLEN UBIN WORD ;
     1272     5631    1   DCL REC$ PTR;
     1273     5632    1   DCL TAB$ PTR;
     1274     5633    1   DCL LDCT$ PTR;
     1275     5634    1   DCL OP$ PTR;
     1276     5635    1   DCL GRAN$ PTR;
     1277     5636    1   DCL REC# SBIN WORD;
     1278     5637    1   DCL RECX SBIN WORD;
     1279     5638    1   DCL NAVX SBIN WORD;
     1280     5639    1   DCL AVAIL SBIN WORD;
     1281     5640    1   DCL RCT UBIN WORD;
     1282     5641    1   DCL 1 RCTR REDEF RCT,
     1283     5642    1         2 TOP UBIN(28) UNAL,
     1284     5643    1         2 BOTTOM UBIN(8) UNAL;
     1285     5644    1   DCL J UBIN WORD;
     1286     5645    1   DCL RCTZERO BIT (1);
     1287     5646    1   DCL I UBIN WORD;
     1288     5647    1   DCL CTL$ PTR;
     1289     5648        %FO_GPARM (FPTN=FO_GPARM,STCLASS=AUTO);
     1290     5670
     1291     5671
     1292     5672        /**/
     1293     5673        /* CONSTANT */
     1294     5674        /**/
     1295     5675        %NK$VFC (NAME=TABVFC,STCLASS=CONSTANT,IFCN=%VFCF_SPC,ICOUNT=%VFCS_OTAB);
     1296     5693        %NK$VFC (NAME=TOFVFC,STCLASS=CONSTANT,IFCN=%VFCF_HDR,ICOUNT=1);
     1297     5711    1   DCL BLANKS CHAR(3) CONSTANT ALIGNED INIT(' ');
     1298     5712
     1299     5713
     1300     5714        /**/
     1301     5715        /*  REFS */
     1302     5716        /**/
     1303     5717    1   DCL B$PS4$ PTR SYMREF;
     1304     5718    1   DCL FOG$ADD            ENTRY(1) ALTRET;
     1305     5719    1   DCL FOG$BLD            ENTRY(1) ALTRET;
     1306     5720    1   DCL FOG$GRAN           ENTRY(1) ALTRET;
     1307     5721    1   DCL FOM$DEVEA          ENTRY(1);
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:162  
     1308     5722    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     1309     5723    1   DCL FOM$SNXDISK        ENTRY(1) ALTRET;
     1310     5724    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
     1311     5725    1   DCL FOM$TIMR           ENTRY(1);
     1312     5726    1   DCL HFF$NILERASE       ENTRY(1) ALTRET;
     1313     5727    1   DCL FOM$DEBLOCK        ENTRY(1);
     1314     5728    1   DCL NIO$QUE            ENTRY(1) ALTRET;
     1315     5729    1   DCL SSC$MONTIMR        ENTRY(3);
     1316     5730
     1317     5731
     1318     5732        /**/
     1319     5733        /* SUBS */
     1320     5734        /**/
     1321     5735        %EQU_CG;
     1322     5783        %SUB FOREVER="WHILE ('1'B)";
     1323     5784        /**/
     1324     5785        /**/
     1325     5786
     1326     5787                                /* EA INFO IS SYMB CONTEXT BLK POINTER */
     1327     5788    1         SYMB$=N$REQ.EAINFOP$;
     1328     5789    1         GRAN$=N$REQ.BUF$;
     1329     5790    1         NAVX=GRAN$->FM$GRAN.NAVX;
     1330     5791    1         AVAIL=GRAN$->FM$GRAN.AVAIL;
     1331     5792    1         DOIOQ=0;
     1332     5793    1         TAB$=SYMB$->FO$SYMB.TAB$;
     1333     5794    1         LDCT$=NK$LDCT$(SYMB$->FO$SYMB.DEVLDCTX);
     1334     5795
     1335     5796                                /* CHECK THE TYC */
     1336     5797
     1337     5798                                      /* Did disk read succeed? */
     1338     5799    1         IF N$REQ.TYC&'377777777777'O THEN
     1339     5800                                /* BAD TYC */
     1340     5801    2           DO;
     1341     5802    2           GRAN$->FO$SBUF.FERR.CODE=FOME_DSKERR#;
     1342     5803    2   DKERR:  ;
     1343     5804    2           GRAN$->FO$SBUF.FERR.BLK#=SYMB$->FO$SYMB.BR.BLK#;
     1344     5805    2           GRAN$->FO$SBUF.FERR.STAMP=GRAN$->FM$GRAN.STAMP;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:163  
     1345     5806    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_HLTR,FOHR_FERR#);
     1346     5807    2           RETURN;
     1347     5808    2           END;
     1348     5809
     1349     5810                                /* TYC IS AOK */
     1350     5811
     1351     5812    1         IF SYMB$->FO$SYMB.CUREXT.STAMP~=GRAN$->FM$GRAN.STAMP THEN
     1352     5813    2           DO;
     1353     5814    2           GRAN$->FO$SBUF.FERR.CODE=FOME_STAMP#;
     1354     5815    2           GRAN$->FO$SBUF.FERR.EXPSTAMP=SYMB$->FO$SYMB.CUREXT.STAMP;
     1355     5816    2           GOTO DKERR;
     1356     5817    2           END;
     1357     5818                                      /* Is record index into granule + remaining
     1358     5819                                         space in granule > 1024 (page)? */
     1359     5820    1         IF NAVX+AVAIL > 1024 THEN
     1360     5821    2           DO;
     1361     5822    2           GRAN$->FO$SBUF.FERR.CODE=FOME_GRNFMT#;
     1362     5823    2           GRAN$->FO$SBUF.FERR.NAVX=NAVX;
     1363     5824    2           GRAN$->FO$SBUF.FERR.AVAIL=AVAIL;
     1364     5825    2           GOTO DKERR;
     1365     5826    2           END;
     1366     5827        %EJECT;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:164  
     1367     5828                                                     /**/
     1368     5829    1         IF SYMB$->FO$SYMB.XMVFU = '1'B
     1369     5830    1         THEN
     1370     5831    2           DO;
     1371     5832    2           REC$ = PINCRW (GRAN$, PINCRW (GRAN$,1023) -> FM$CON.GX);
     1372     5833    2           FO_GPARM.BUF$ = GRAN$;
     1373     5834    2           FO_GPARM.REC$ = PINCRC (REC$, 1);
     1374     5835    2           FO_GPARM.VFC = %VFC_VFU;
     1375     5836    2           FO_GPARM.REPEATS = 1;
     1376     5837    2           FO_GPARM.RECL = LENGTHC (FS$SOFT_VFU);
     1377     5838    2           FO_GPARM.DVBYTE = %DVBYTE_VFC# | %DVBYTE_TRANS#;
     1378     5839    2           CALL FOG$BLD (FO_GPARM);
     1379     5840                                                     /**/
     1380     5841    2           SYMB$ -> FO$SYMB.RCTZERO = '1'B;
     1381     5842    2           GOTO DISPATCH;
     1382     5843    2           END;
     1383     5844                                                     /**/
     1384     5845                                /* IF XMITTING TABS AFTER A SPACING OPERATION,
     1385     5846                                   THEN BUILD A GRANULE WITH THE TABS ONLY,
     1386     5847                                   AND SEND IT OFF.  THE XMTABS FLAG WILL
     1387     5848                                   CAUSE FOM$NXDISK TO NOT UPDATE BLKREC. */
     1388     5849    1         IF (NOT SYMB$->FO$SYMB.SPACING) AND SYMB$->FO$SYMB.XMTABS THEN
     1389     5850    2           DO;
     1390     5851                                      /* GRAN$ = N$REC.BUF */
     1391     5852    2           FO_GPARM.BUF$=GRAN$;
     1392     5853    2           FO_GPARM.REC$=ADDR(TAB$->FO$TABS.TABS);
     1393     5854    2           FO_GPARM.VFCR=TABVFC;
     1394     5855    2           FO_GPARM.REPEATS=1;
     1395     5856    2           FO_GPARM.RECL=LENGTHC(FO$TABS.TABS);
     1396     5857    2           FO_GPARM.DVBYTE=%DVBYTE_VFC#|%DVBYTE_TRANS#;
     1397     5858    2           CALL FOG$BLD (FO_GPARM);
     1398     5859                                /* DISPATCH WITHOUT UPDATING EXTENT INFO.
     1399     5860                                   THUS WE'LL READ THE CURRENT GRAN AGAIN
     1400     5861                                   AFTER SENDING THIS ONE. */
     1401     5862    2           SYMB$->FO$SYMB.RCTZERO='1'B;
     1402     5863    2           GOTO DISPATCH;
     1403     5864    2           END;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:165  
     1404     5865                                /* IF NOT XMITTING TABS, SET THE RECORD
     1405     5866                                   NUMBER OF THE FIRST REC TO BE PRINTED
     1406     5867                                   IN THIS GRAN, FROM FO$SYMB.BR.REC# */
     1407     5868    1         ELSE RCT=SYMB$->FO$SYMB.BR.REC#;
     1408     5869                                /* ADJUST EXTENT POINTERS */
     1409     5870
     1410     5871    1         SYMB$->FO$SYMB.CUREXT.NGRAN=SYMB$->FO$SYMB.CUREXT.NGRAN-1;
     1411     5872    1         IF SYMB$->FO$SYMB.CUREXT.NGRAN~=0 THEN
     1412     5873    2           DO;
     1413     5874    2           IF SYMB$->FO$SYMB.SPACING AND SYMB$->FO$SYMB.SPACEPAGES<0 THEN
     1414     5875    2            SYMB$->FO$SYMB.CUREXT.DAD=SYMB$->FO$SYMB.CUREXT.DAD-1;
     1415     5876    2           ELSE
     1416     5877                                      /* Advance disk address */
     1417     5878    2            SYMB$->FO$SYMB.CUREXT.DAD=SYMB$->FO$SYMB.CUREXT.DAD+1;
     1418     5879    2           END;
     1419     5880    1         ELSE
     1420     5881    2           DO;
     1421     5882                                /* PICK UP NEXT EXTENT & ASK FOR MORE */
     1422     5883    2           SYMB$->FO$SYMB.CUREXT=SYMB$->FO$SYMB.NXTEXT;
     1423     5884    2           SYMB$->FO$SYMB.NXTEXT='0'B;
     1424     5885    2           IF SYMB$->FO$SYMB.CUREXT.NGRAN~=0 OR SYMB$->FO$SYMB.CUREXT.DAD=0 THEN
     1425     5886    2            CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_SFEXT#,0);
     1426     5887    2           END;
     1427     5888    1         IF NAVX+AVAIL = 1024 THEN GOTO NXTGRAN;
     1428     5889
     1429     5890        %EJECT;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:166  
     1430     5891        /*
     1431     5892           A note about spacing:
     1432     5893             Get an extent and read the first granule into the scratch granule
     1433     5894             (i.e. the one OUTSYM gives to MOOS on the open of each file).
     1434     5895             When the read completes, enter FOM$DISKEA.  Here, if we are
     1435     5896             spacing from BOF, send the VFU image (always the first record in
     1436     5897             in a symbiont file) to the device and await device endaction.
     1437     5898             Upon device endaction, we requeue the granule and end up in
     1438     5899             FOM$DISKEA.  Now we begin spacing until we locate the page/record
     1439     5900             for which we are searching.  If the current granule is exausted
     1440     5901             and we have not yet reached our goal, we issue a call to
     1441     5902             FOM$SNXDISK.  This routine changes the symbiont context block
     1442     5903             state to "disk granule done", updates the file relative disk
     1443     5904             address pointers to the next granule in the current extent, sets
     1444     5905             the state to "DKIO", and gives control to the I/O system in order
     1445     5906             to read the next granule.  On disk endaction we again end up in
     1446     5907             FOM$DISKEA and continue spacing.  Upon being called, FOM$SNXDISK
     1447     5908             determines whether or not we are out of granules in the current
     1448     5909             extent, and if we are it replaces the current extent with the
     1449     5910             queued next extent, requests a new extent from OUTSYM, sets the
     1450     5911             state to "DKIO", and gives control to the I/O system in order
     1451     5912             to read the first granule of the new current extent.
     1452     5913
     1453     5914             When we get disk endaction in order to continue printing a
     1454     5915             spaced/suspended file, we check if tabs were encountered during
     1455     5916             the spacing operation.  If they were, write the tabs and await
     1456     5917             device endaction.  Upon device endaction we enter FOM$DEVEA,
     1457     5918             change the state to "symbiont write done", make sure that we
     1458     5919             don't update the BLK#=REC#, and call FOM$NXDISK which in this
     1459     5920             case requeues this granule for actual printing.
     1460     5921
     1461     5922             It is important to note that devices are never aware that there
     1462     5923             is a spacing operation in progress.  Only MOOS and OUTSYM are
     1463     5924             aware of it.
     1464     5925        */
     1465     5926        %EJECT;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:167  
     1466     5927        /**
     1467     5928         **
     1468     5929         **      SPACING (REMOTE OR LOCAL)
     1469     5930         **
     1470     5931         **/
     1471     5932    1         IF SYMB$->FO$SYMB.SPACING THEN
     1472     5933    2           DO;
     1473     5934    2           REC#=SYMB$->FO$SYMB.BR.REC#;
     1474     5935    2           IF SYMB$->FO$SYMB.SPACEPAGES>0 THEN
     1475     5936    3   SFWD:     DO FOREVER;
     1476     5937                                      /* Set record number at beginning of page */
     1477     5938    3             IF REC#=0 THEN REC#=1;
     1478     5939    3             RECX=1024-REC#;
     1479     5940                                      /* Is record index in the current extent? */
     1480     5941    3             IF RECX < NAVX+AVAIL THEN
     1481     5942    4               DO;
     1482     5943                                      /* SPACETYPE = 1 means block spacing */
     1483     5944    4               IF SYMB$->FO$SYMB.SPACETYPE = 1 THEN
     1484     5945    5                 DO;
     1485     5946    5                 SYMB$->FO$SYMB.SPACEBLKS=SYMB$->FO$SYMB.SPACEBLKS-1;
     1486     5947    5                 IF SYMB$->FO$SYMB.SPACEBLKS = 0 THEN GOTO GOTPAGE;
     1487     5948    5                 END;
     1488     5949    4               GOTO NXTGRAN;
     1489     5950    4               END;
     1490     5951                                      /* Here - record index is not in the current
     1491     5952                                         extent */
     1492     5953    3             REC$=PINCRW(GRAN$,PINCRW(GRAN$,RECX)->FM$CON.GX);
     1493     5954    3             VFCFCN=REC$->NK$VFC.FCN;
     1494     5955                                /* SAVE TABS AS WE FIND 'EM */
     1495     5956    3             IF VFCFCN=%VFCF_SPC AND REC$->NK$VFC.COUNT=%VFCS_OTAB THEN
     1496     5957    4               DO;
     1497     5958    4               TAB$->FO$TABS.TABSR='0'B;
     1498     5959    4               RECL=PINCRW(GRAN$,RECX)->FM$CON.GACTB;
     1499     5960    4               IF RECL > 1 THEN
     1500     5961    5                 DO;
     1501     5962                                      /* Remove tab character from length,
     1502     5963                                         and save tab character */
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:168  
     1503     5964    5                 RECL=RECL-1;
     1504     5965    5                 TAB$->FO$TABS.TABS=PINCRC(REC$,1)->B$TABS;
     1505     5966    5                 END;
     1506     5967    4               SYMB$->FO$SYMB.XMTABS='1'B;
     1507     5968    4               END;
     1508     5969                                      /* SPACETYPE = 0 means record spacing */
     1509     5970    3             IF SYMB$->FO$SYMB.SPACETYPE = 0 THEN
     1510     5971    4               DO;
     1511     5972    4               IF (NOT SYMB$->FO$SYMB.PAGES       /* Not paged output            */
     1512     5973    4               AND (SYMB$->FO$SYMB.CPVFC      /* Card Punch VFC              */
     1513     5974    4               OR VFCFCN >= %VFCF_SPB))  /* TOF VFC or SBP VFC          */
     1514     5975    4               OR (SYMB$->FO$SYMB.PAGES           /* Paged output                */
     1515     5976    4               AND NOT SYMB$->FO$SYMB.FIRSTSPACE /* Not 1st time thru code   */
     1516     5977    4               AND VFCFCN = %VFCF_HDR)        /* TOF VFC                     */
     1517     5978    4               THEN                               /* We're at new logical "PAGE" */
     1518     5979    5                 DO;
     1519     5980    5                 SYMB$->FO$SYMB.SPACEPAGES=SYMB$->FO$SYMB.SPACEPAGES-1;
     1520     5981    5                 IF SYMB$->FO$SYMB.SPACEPAGES=0 THEN GOTO GOTPAGE;
     1521     5982    5                 END;
     1522     5983    4               SYMB$->FO$SYMB.FIRSTSPACE='0'B;
     1523     5984    4               END;
     1524     5985    3             ELSE
     1525     5986    4               DO;
     1526     5987                                      /* Else, block spacing */
     1527     5988    4               IF  SYMB$->FO$SYMB.SPACEBLKS = 1
     1528     5989    4               AND SYMB$->FO$SYMB.SPACEREC# <= REC# THEN GOTO GOTPAGE;
     1529     5990    4               END;
     1530     5991    3             REC#=REC#+1;
     1531     5992                                      /* END space forward forever */
     1532     5993    3             END SFWD;
     1533     5994                                      /* Begin space backward forever */
     1534     5995    3   SBKWD:    DO FOREVER;
     1535     5996    3             RECX=1024-REC#;
     1536     5997    3             IF RECX < NAVX+AVAIL THEN
     1537     5998    4               DO;
     1538     5999    4               RECX=NAVX+AVAIL;
     1539     6000                                      /* Set record number to beginning of page */
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:169  
     1540     6001    4               REC#=1024-RECX;
     1541     6002    4               END;
     1542     6003    3             ELSE IF REC# = 0 THEN
     1543     6004    4                DO;
     1544     6005                                      /* SPACETYPE means block spacing */
     1545     6006    4                IF SYMB$->FO$SYMB.SPACETYPE = 1 THEN
     1546     6007    5                  DO;
     1547     6008                                      /* Add 1 to the number of blocks we
     1548     6009                                         must space backwards */
     1549     6010    5                  SYMB$->FO$SYMB.SPACEBLKS=SYMB$->FO$SYMB.SPACEBLKS+1;
     1550     6011    5                  IF SYMB$->FO$SYMB.SPACEBLKS = 0 THEN GOTO GOTPAGE;
     1551     6012    5                  END;
     1552     6013                                      /* We have spaced beyond the limits of
     1553     6014                                         this granule, get a new one */
     1554     6015    4                GOTO NXTGRAN;
     1555     6016    4                END;
     1556     6017    3             REC$=PINCRW(GRAN$,PINCRW(GRAN$,RECX)->FM$CON.GX);
     1557     6018                                      /* Get VFC character of this record */
     1558     6019    3             VFCFCN=REC$->NK$VFC.FCN;
     1559     6020                                /* SAVE PREVIOUS TABS IF WE FIND A SET
     1560     6021                                   TABS RECORD WHILE GOING BACKWARD */
     1561     6022    3             IF VFCFCN=%VFCF_SPC AND REC$->NK$VFC.COUNT=%VFCS_OTAB THEN
     1562     6023    4               DO;
     1563     6024    4               TAB$->FO$TABS.TABSR='0'B;
     1564     6025    4               RECL=PINCRW(GRAN$,RECX)->FM$CON.GACTB;
     1565     6026                                      /* TAB records are at least 33 bytes */
     1566     6027    4               IF RECL > 33 THEN
     1567     6028    5                 DO;
     1568     6029    5                 RECL=RECL-33;
     1569     6030    5                 TAB$->FO$TABS.TABS=PINCRC(REC$,33)->B$TABS;
     1570     6031    5                 END;
     1571     6032    4               SYMB$->FO$SYMB.XMTABS='1'B;
     1572     6033    4               END;
     1573     6034                                      /* SPACETYPE = 0 means record spacing */
     1574     6035    3             IF SYMB$->FO$SYMB.SPACETYPE = 0 THEN
     1575     6036    4               DO;
     1576     6037    4               IF (NOT SYMB$->FO$SYMB.PAGES       /* Not paged output            */
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:170  
     1577     6038    4               AND (SYMB$->FO$SYMB.CPVFC      /* Card Punch VFC              */
     1578     6039    4               OR VFCFCN >= %VFCF_SPB))  /* TOF VFC or SBP VFC          */
     1579     6040    4               OR (SYMB$->FO$SYMB.PAGES           /* Paged output                */
     1580     6041    4               AND NOT SYMB$->FO$SYMB.FIRSTSPACE /* Not 1st time thru code   */
     1581     6042    4               AND VFCFCN = %VFCF_HDR)        /* TOF VFC                     */
     1582     6043    4               THEN                               /* We're at new logical "PAGE" */
     1583     6044    5                 DO;
     1584     6045                                      /* ADD 1 to the number of pages we must
     1585     6046                                         space back */
     1586     6047    5                 SYMB$->FO$SYMB.SPACEPAGES=SYMB$->FO$SYMB.SPACEPAGES+1;
     1587     6048    5                 IF SYMB$->FO$SYMB.SPACEPAGES=0 THEN GOTO GOTPAGE;
     1588     6049    5                 END;
     1589     6050    4               SYMB$->FO$SYMB.FIRSTSPACE='0'B;
     1590     6051    4               END;
     1591     6052    3             ELSE
     1592     6053    4               DO;
     1593     6054    4               IF  SYMB$->FO$SYMB.SPACEBLKS = -1
     1594     6055    4               AND SYMB$->FO$SYMB.SPACEREC# >= REC# THEN GOTO GOTPAGE;
     1595     6056    4               END;
     1596     6057    3             REC#=REC#-1;
     1597     6058    3             END SBKWD;
     1598     6059    2   NXTGRAN:
     1599     6060    2           CALL FOM$SNXDISK (SYMB$->FO$SYMB);
     1600     6061    2           RETURN;
     1601     6062    2   GOTPAGE:
     1602     6063    2           SYMB$->FO$SYMB.BR.REC#=REC#;
     1603     6064    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_FSPA);
     1604     6065    2           RETURN;
     1605     6066    2           END;
     1606     6067        %EJECT;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:171  
     1607     6068    1   DISPATCH:;
     1608     6069        /**
     1609     6070         **
     1610     6071         **      REMOTE DEVICE
     1611     6072         **
     1612     6073         **/
     1613     6074    1         RCTZERO=SYMB$->FO$SYMB.RCTZERO;
     1614     6075    1         SYMB$->FO$SYMB.RCTZERO='0'B;
     1615     6076                                      /* FEX ~= 0 means remote */
     1616     6077    1         IF ~LDCT$->NK$LDCT.DFLG.LOCAL THEN
     1617     6078    2           DO;
     1618     6079                                      /* Do state check */
     1619     6080    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_RDII) ALTRET(RTN);
     1620     6081
     1621     6082    2           CALL FOM$DEBLOCK (LDCT$->NK$LDCT);
     1622     6083                                      /* Do a state check */
     1623     6084    2   RTN:    RETURN;
     1624     6085    2           END;
     1625     6086        /**
     1626     6087         **
     1627     6088         **      LOCAL DEVICE
     1628     6089         **
     1629     6090         **/
     1630     6091    1         N$REQ.DLA.DCTX=LDCT$->NK$LDCT.RLCID.LDCTX; /* DEV DCTX */
     1631     6092    1         N$REQ.FC=%N_SYMB;
     1632     6093    1         N$REQ.COMP = %COMP_REG ;
     1633     6094    1         N$REQ.EAENTRY=ENTADDR(FOM$DEVEA);
     1634     6095    1         N$REQ.OPFLG=OP_EA|OP_HOLD|OP_BPF;
     1635     6096    1         CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_LDIO) ALTRET(RTN);
     1636     6097                                      /* Tab granule? */
     1637     6098    1         IF RCTZERO THEN N$REQ.RCT=0;
     1638     6099                                      /* Not a tab granule */
     1639     6100    1         ELSE N$REQ.RCT=RCT;
     1640     6101    1         N$REQ.EAINFOX=0;
     1641     6102    1         IF DOIOQ = 1 THEN CALL NIO$QUE (N$REQ);
     1642     6103    1         ELSE N$REQ.OPFLG.REQ='1'B;
     1643     6104    1         RETURN;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:172  
     1644     6105        /**/
     1645     6106        /**/
     1646     6107
     1647     6108        /* CODE REMOVED IN M:MON PURGE CYCLE
     1648     6109        !FOM$DISKEAR: ENTRY (N$REQ);
     1649     6110        !:*F* NAME:         FOM$DISKEAR
     1650     6111        !     PURPOSE:      To retry queueing the next fep output request
     1651     6112        !                   after deferral.
     1652     6113        !     DESCRIPTION:
     1653     6114        !                   FOM$TIMR calls here if we had to defer sending
     1654     6115        !                   the just-read granule to FEP because the output
     1655     6116        !                   queue was full.  We simply re-enter the
     1656     6117        !                   appropriate part of FOM$DISKEA        *:
     1657     6118        !
     1658     6119        !      SYMB$=N$REQ.EAINFOP$;
     1659     6120        !      LDCT$=NK$LDCT$(SYMB$->FO$SYMB.DEVLDCTX);
     1660     6121        !      RCT=SYMB$->FO$SYMB.BR.REC#;
     1661     6122        !      GOTO DISPATCH;
     1662     6123        !
     1663     6124              END OF CODE REMOVED IN M:MON PURGE CYCLE */
     1664     6125        /**/
     1665     6126        /**/
     1666     6127    1   FOM$WRITE: ENTRY (N$REQ);
     1667     6128        /**/
     1668     6129        /*F* NAME:         FOM$WRITE
     1669     6130             PURPOSE:      To write a single record or granule to a
     1670     6131                           symbiont device.
     1671     6132             DESCRIPTION:  If RECORD_ in the FPT is NILERASE, then an
     1672     6133                           entire granule is being supplied, framed by
     1673     6134                           BUF_.  Otherwise, a record is to be built into
     1674     6135                           the symbiont buffer, and sent.  The description
     1675     6136                           of the record is a VLP_SYMBWRITE framed by
     1676     6137                           RECORD_.  After the write completes, OUTSYM
     1677     6138                           may receive a symbiont ack if he requested it,
     1678     6139                           or, if requested and the device is local, a
     1679     6140                           symbiont token (for remote devices, an ack
     1680     6141                           is generated when the FEP acks the write,
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:173  
     1681     6142                           whereas a token is generated after the data
     1682     6143                           is printed).  */
     1683     6144
     1684     6145    1         SYMB$=N$REQ.EAINFOP$;
     1685     6146    1         LDCT$=NK$LDCT$(SYMB$->FO$SYMB.DEVLDCTX);
     1686     6147    1         GRAN$=N$REQ.BUF$;
     1687     6148                                      /* Was there a single record passed?
     1688     6149                                         If not, write an entire granule */
     1689     6150    1         CALL HFF$NILERASE (4) ALTRET(GOWRITE);
     1690     6151    1         FO_GPARM.BUF$=GRAN$;
     1691     6152    1         CALL FOG$GRAN (FO_GPARM);
     1692     6153    1         FO_GPARM.DVBYTE=%DVBYTE_VFC#|%DVBYTE_BP#;
     1693     6154    1         IF B$PS4$->VLP$WRITE.TOF THEN
     1694     6155    2           DO;
     1695     6156    2           FO_GPARM.REPEATS=1;
     1696     6157    2           FO_GPARM.REC$=ADDR(BLANKS);
     1697     6158    2           FO_GPARM.VFCR=TOFVFC;
     1698     6159    2           FO_GPARM.RECL=3;
     1699     6160    2           CALL FOG$ADD (FO_GPARM);
     1700     6161    2           END;
     1701     6162    1         FO_GPARM.REPEATS=B$PS4$->VLP$WRITE.REPEATS;
     1702     6163    1         FO_GPARM.RECL   =B$PS4$->VLP$WRITE.RECL;
     1703     6164    1         FO_GPARM.REC$   =ADDR(B$PS4$->VLP$WRITE.REC);
     1704     6165    1         FO_GPARM.VFCR   ='0'B;
     1705     6166    1         CALL FOG$ADD (FO_GPARM);
     1706     6167    1   GOWRITE:;
     1707     6168    1         SYMB$->FO$SYMB.RCTZERO='1'B;
     1708     6169    1         DOIOQ=1;
     1709     6170    1         GOTO DISPATCH;
     1710     6171        /**/
     1711     6172        /**/
     1712     6173    1   END FOM$DISKEA;
     1713     6174        /**/
     1714     6175        /**/
     1715     6176        %EOD;

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:174  
--  Include file information  --

   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   UM$CP6V_C.:E05TOU  is referenced.
   FOO_MAC_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$GRAN.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   FS_SUPER_C.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$DISKEA.

   Procedure FOM$DISKEA requires 517 words for executable code.
   Procedure FOM$DISKEA requires 30 words of local(AUTO) storage.

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:175  

 Object Unit name= FOM$DISKEA                                 File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:09:56.80 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      3      3  FOM$DISKEA
    1   Proc  even  none   517   1005  FOM$DISKEA
    2  RoData even  none    13     15  FOM$DISKEA

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  FOM$DISKEA
     1    702                  yes      Std        1  FOM$WRITE
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:176  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 FOM$EVENT
 yes     yes           Std       1 NIO$QUE
 yes     yes           Std       1 FOG$BLD
 yes     yes           Std       3 FOM$TELLAU
 yes     yes           Std       1 FOM$SNXDISK
 yes     yes           Std       1 HFF$NILERASE
 yes     yes           Std       1 FOG$ADD
         yes           Std       1 FOM$DEBLOCK
 yes     yes           Std       1 FOG$GRAN
         yes           Std       1 FOM$DEVEA
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    FOSE_LDIO                        r    FOSE_RDII                        r    FOSE_HLTR
r    FOSE_FSPA                             N$DCT$$                               B$PS4$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:177  


     1197        1        /*T***********************************************************/
     1198        2        /*T*                                                         */
     1199        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1200        4        /*T*                                                         */
     1201        5        /*T***********************************************************/
     1202        6        /**/
     1203        7        /**/
     1204        8        FOM$DISKEA: PROC (N$REQ);

      8  1 000000   000000 700200 xent  FOM$DISKEA   TSX0  ! X66_AUTO_1
         1 000001   000036 000001                    ZERO    30,1

     1205        9        /**/
     1206       10        /**/
     1207       11        /*F* NAME:         FOM$DISKEA
     1208       12             PURPOSE:      To propagate MOOS after a disk read
     1209       13             DESCRIPTION:
     1210       14                           First, if the disk read did not succeed, the
     1211       15                           symbiont's state is set to HELD and OUTSYM
     1212       16                           is told, and we exit.
     1213       17                           Otherwise, the pointers for the current disk
     1214       18                           extent are adjusted, and OUTSYM is asked
     1215       19                           for another extent if we need one.
     1216       20                           Finally, the granule just read is dispatched
     1217       21                           to its destination.                     */
     1218       22        /**/
     1219       23        /*  INCLUDES */
     1220       24        /**/
     1221       25        %INCLUDE FOM$STRUCT;
     1222       86        %INCLUDE FS_SUPER_C;
     1223      849        %INCLUDE KV$VDO;
     1224     1864        %INCLUDE N$REQ;
     1225     1938        %INCLUDE NK$LDCT;
     1226     2040        %INCLUDE NI_DATA_C ;
     1227     2153        %INCLUDE N_FC_C;
     1228     2190        %INCLUDE FOM_SUBS_C;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:178  
     1229     2253        %INCLUDE KC_SUBS_C;
     1230     2269        %INCLUDE FOM_DATA_R;
     1231     2518        %INCLUDE FM$GRAN;
     1232     2587        %INCLUDE NK_LDCT_R;
     1233     2596        %INCLUDE NK_VFC_C;
     1234     2670        %INCLUDE CP_6_SUBS;
     1235     3210        %INCLUDE FOO_MAC_C;
     1236     3958        %INCLUDE UM$CP6V_C;
     1237     4145        %INCLUDE KC_CP6;
     1238     4705        %INCLUDE K_DATA_R;
     1239     5416
     1240     5417
     1241     5418        /**/
     1242     5419        /* PARAMETERS */
     1243     5420        /**/
     1244     5421        %N$REQ (STCLASS="");
     1245     5479
     1246     5480
     1247     5481        /**/
     1248     5482        /* BASED STRUCTURES */
     1249     5483        /**/
     1250     5484        %FOM$SYMB (NAME=FO$SYMB);
     1251     5516        %FS$SVFU (NAME=FS$SOFT_VFU,STCLASS=BASED);
     1252     5536        %NK$LDCT;
     1253     5582        %FOM$TABS;
     1254     5585        %FM$GRAN;
     1255     5589        %NK$VFC;
     1256     5607        %FM$CON;
     1257     5611    1   DCL B$TABS CHAR(RECL) BASED CALIGNED;
     1258     5612    1   DCL B$BYTE UBIN BYTE BASED CALIGNED;
     1259     5613    1   DCL B$REC CHAR(RECL) BASED CALIGNED;
     1260     5614        %VLP$SYMBWRITE_V (FPTN=VLP$WRITE);
     1261     5617        %FOM$SBUF;
     1262     5621
     1263     5622
     1264     5623        /**/
     1265     5624        /* AUTO */
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:179  
     1266     5625        /**/
     1267     5626    1   DCL SYMB$ PTR;
     1268     5627    1   DCL RECL UBIN WORD;
     1269     5628    1   DCL DOIOQ UBIN WORD;
     1270     5629    1   DCL VFCFCN UBIN WORD ;
     1271     5630    1   DCL RECLEN UBIN WORD ;
     1272     5631    1   DCL REC$ PTR;
     1273     5632    1   DCL TAB$ PTR;
     1274     5633    1   DCL LDCT$ PTR;
     1275     5634    1   DCL OP$ PTR;
     1276     5635    1   DCL GRAN$ PTR;
     1277     5636    1   DCL REC# SBIN WORD;
     1278     5637    1   DCL RECX SBIN WORD;
     1279     5638    1   DCL NAVX SBIN WORD;
     1280     5639    1   DCL AVAIL SBIN WORD;
     1281     5640    1   DCL RCT UBIN WORD;
     1282     5641    1   DCL 1 RCTR REDEF RCT,
     1283     5642    1         2 TOP UBIN(28) UNAL,
     1284     5643    1         2 BOTTOM UBIN(8) UNAL;
     1285     5644    1   DCL J UBIN WORD;
     1286     5645    1   DCL RCTZERO BIT (1);
     1287     5646    1   DCL I UBIN WORD;
     1288     5647    1   DCL CTL$ PTR;
     1289     5648        %FO_GPARM (FPTN=FO_GPARM,STCLASS=AUTO);
     1290     5670
     1291     5671
     1292     5672        /**/
     1293     5673        /* CONSTANT */
     1294     5674        /**/
     1295     5675        %NK$VFC (NAME=TABVFC,STCLASS=CONSTANT,IFCN=%VFCF_SPC,ICOUNT=%VFCS_OTAB);
     1296     5693        %NK$VFC (NAME=TOFVFC,STCLASS=CONSTANT,IFCN=%VFCF_HDR,ICOUNT=1);
     1297     5711    1   DCL BLANKS CHAR(3) CONSTANT ALIGNED INIT(' ');
     1298     5712
     1299     5713
     1300     5714        /**/
     1301     5715        /*  REFS */
     1302     5716        /**/
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:180  
     1303     5717    1   DCL B$PS4$ PTR SYMREF;
     1304     5718    1   DCL FOG$ADD            ENTRY(1) ALTRET;
     1305     5719    1   DCL FOG$BLD            ENTRY(1) ALTRET;
     1306     5720    1   DCL FOG$GRAN           ENTRY(1) ALTRET;
     1307     5721    1   DCL FOM$DEVEA          ENTRY(1);
     1308     5722    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     1309     5723    1   DCL FOM$SNXDISK        ENTRY(1) ALTRET;
     1310     5724    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
     1311     5725    1   DCL FOM$TIMR           ENTRY(1);
     1312     5726    1   DCL HFF$NILERASE       ENTRY(1) ALTRET;
     1313     5727    1   DCL FOM$DEBLOCK        ENTRY(1);
     1314     5728    1   DCL NIO$QUE            ENTRY(1) ALTRET;
     1315     5729    1   DCL SSC$MONTIMR        ENTRY(3);
     1316     5730
     1317     5731
     1318     5732        /**/
     1319     5733        /* SUBS */
     1320     5734        /**/
     1321     5735        %EQU_CG;
     1322     5783        %SUB FOREVER="WHILE ('1'B)";
     1323     5784        /**/
     1324     5785        /**/
     1325     5786
     1326     5787                                /* EA INFO IS SYMB CONTEXT BLK POINTER */
     1327     5788    1         SYMB$=N$REQ.EAINFOP$;

   5788  1 000002   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000003   000024 236100                    LDQ     20,,PR0
         1 000004   200004 756100                    STQ     SYMB$,,AUTO

     1328     5789    1         GRAN$=N$REQ.BUF$;

   5789  1 000005   000005 236100                    LDQ     5,,PR0
         1 000006   200015 756100                    STQ     GRAN$,,AUTO

     1329     5790    1         NAVX=GRAN$->FM$GRAN.NAVX;

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:181  
   5790  1 000007   200015 471500                    LDP1    GRAN$,,AUTO
         1 000010   100001 236100                    LDQ     1,,PR1
         1 000011   000022 772000                    QRL     18
         1 000012   200020 756100                    STQ     NAVX,,AUTO

     1330     5791    1         AVAIL=GRAN$->FM$GRAN.AVAIL;

   5791  1 000013   100001 236100                    LDQ     1,,PR1
         1 000014   001777 376007                    ANQ     1023,DL
         1 000015   200021 756100                    STQ     AVAIL,,AUTO

     1331     5792    1         DOIOQ=0;

   5792  1 000016   200006 450100                    STZ     DOIOQ,,AUTO

     1332     5793    1         TAB$=SYMB$->FO$SYMB.TAB$;

   5793  1 000017   200004 473500                    LDP3    SYMB$,,AUTO
         1 000020   300000 236100                    LDQ     0,,PR3
         1 000021   200012 756100                    STQ     TAB$,,AUTO

     1333     5794    1         LDCT$=NK$LDCT$(SYMB$->FO$SYMB.DEVLDCTX);

   5794  1 000022   300010 720100                    LXL0    8,,PR3
         1 000023   000000 474400 xsym               LDP4    N$DCT$$
         1 000024   400000 236110                    LDQ     0,X0,PR4
         1 000025   200013 756100                    STQ     LDCT$,,AUTO

     1334     5795
     1335     5796                                /* CHECK THE TYC */
     1336     5797
     1337     5798                                      /* Did disk read succeed? */
     1338     5799    1         IF N$REQ.TYC&'377777777777'O THEN

   5799  1 000026   000021 236100                    LDQ     17,,PR0
         1 000027   000031 376000 xsym               ANQ     B_VECTNIL+25
         1 000030   000054 600000 1                  TZE     s:5812
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:182  

     1339     5800                                /* BAD TYC */
     1340     5801    2           DO;

     1341     5802    2           GRAN$->FO$SBUF.FERR.CODE=FOME_DSKERR#;

   5802  1 000031   000002 235007                    LDA     2,DL
         1 000032   100010 755100                    STA     8,,PR1

   5802  1 000033                       DKERR        null
     1342     5803    2   DKERR:  ;
     1343     5804    2           GRAN$->FO$SBUF.FERR.BLK#=SYMB$->FO$SYMB.BR.BLK#;

   5804  1 000033   200004 470500                    LDP0    SYMB$,,AUTO
         1 000034   000003 236100                    LDQ     3,,PR0
         1 000035   000022 772000                    QRL     18
         1 000036   200015 471500                    LDP1    GRAN$,,AUTO
         1 000037   100012 756100                    STQ     10,,PR1

     1344     5805    2           GRAN$->FO$SBUF.FERR.STAMP=GRAN$->FM$GRAN.STAMP;

   5805  1 000040   100000 236100                    LDQ     0,,PR1
         1 000041   100014 756100                    STQ     12,,PR1

     1345     5806    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_HLTR,FOHR_FERR#);

   5806  1 000042   000000 236000 2                  LDQ     0
         1 000043   200034 756100                    STQ     FO_GPARM+5,,AUTO
         1 000044   000001 236000 2                  LDQ     1
         1 000045   200004 235100                    LDA     SYMB$,,AUTO
         1 000046   200032 757100                    STAQ    FO_GPARM+3,,AUTO
         1 000047   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000050   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000051   000000 701000 xent               TSX1    FOM$EVENT
         1 000052   000000 011000                    NOP     0

     1346     5807    2           RETURN;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:183  

   5807  1 000053   000000 702200 xent               TSX2  ! X66_ARET

     1347     5808    2           END;
     1348     5809
     1349     5810                                /* TYC IS AOK */
     1350     5811
     1351     5812    1         IF SYMB$->FO$SYMB.CUREXT.STAMP~=GRAN$->FM$GRAN.STAMP THEN

   5812  1 000054   300005 236100                    LDQ     5,,PR3
         1 000055   100000 116100                    CMPQ    0,,PR1
         1 000056   000063 600000 1                  TZE     s:5820

     1352     5813    2           DO;

     1353     5814    2           GRAN$->FO$SBUF.FERR.CODE=FOME_STAMP#;

   5814  1 000057   100010 450100                    STZ     8,,PR1

     1354     5815    2           GRAN$->FO$SBUF.FERR.EXPSTAMP=SYMB$->FO$SYMB.CUREXT.STAMP;

   5815  1 000060   300005 236100                    LDQ     5,,PR3
         1 000061   100011 756100                    STQ     9,,PR1

     1355     5816    2           GOTO DKERR;

   5816  1 000062   000033 710000 1                  TRA     DKERR

     1356     5817    2           END;
     1357     5818                                      /* Is record index into granule + remaining
     1358     5819                                         space in granule > 1024 (page)? */
     1359     5820    1         IF NAVX+AVAIL > 1024 THEN

   5820  1 000063   200020 236100                    LDQ     NAVX,,AUTO
         1 000064   200021 036100                    ADLQ    AVAIL,,AUTO
         1 000065   002000 116007                    CMPQ    1024,DL
         1 000066   000076 604400 1                  TMOZ    s:5829
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:184  

     1360     5821    2           DO;

     1361     5822    2           GRAN$->FO$SBUF.FERR.CODE=FOME_GRNFMT#;

   5822  1 000067   000003 235007                    LDA     3,DL
         1 000070   100010 755100                    STA     8,,PR1

     1362     5823    2           GRAN$->FO$SBUF.FERR.NAVX=NAVX;

   5823  1 000071   200020 720100                    LXL0    NAVX,,AUTO
         1 000072   100013 740100                    STX0    11,,PR1

     1363     5824    2           GRAN$->FO$SBUF.FERR.AVAIL=AVAIL;

   5824  1 000073   200021 721100                    LXL1    AVAIL,,AUTO
         1 000074   100013 441100                    SXL1    11,,PR1

     1364     5825    2           GOTO DKERR;

   5825  1 000075   000033 710000 1                  TRA     DKERR

     1365     5826    2           END;
     1366     5827        %EJECT;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:185  
     1367     5828                                                     /**/
     1368     5829    1         IF SYMB$->FO$SYMB.XMVFU = '1'B

   5829  1 000076   300012 236100                    LDQ     10,,PR3
         1 000077   000020 316007                    CANQ    16,DL
         1 000100   000136 600000 1                  TZE     s:5849

     1369     5830    1         THEN
     1370     5831    2           DO;

     1371     5832    2           REC$ = PINCRW (GRAN$, PINCRW (GRAN$,1023) -> FM$CON.GX);

   5832  1 000101   101777 236100                    LDQ     1023,,PR1
         1 000102   000014 772000                    QRL     12
         1 000103   001777 376007                    ANQ     1023,DL
         1 000104   000022 736000                    QLS     18
         1 000105   200015 036100                    ADLQ    GRAN$,,AUTO
         1 000106   200011 756100                    STQ     REC$,,AUTO

     1372     5833    2           FO_GPARM.BUF$ = GRAN$;

   5833  1 000107   200015 236100                    LDQ     GRAN$,,AUTO
         1 000110   200027 756100                    STQ     FO_GPARM,,AUTO

     1373     5834    2           FO_GPARM.REC$ = PINCRC (REC$, 1);

   5834  1 000111   200011 236100                    LDQ     REC$,,AUTO
         1 000112   200000 036007                    ADLQ    65536,DL
         1 000113   200030 756100                    STQ     FO_GPARM+1,,AUTO

     1374     5835    2           FO_GPARM.VFC = %VFC_VFU;

   5835  1 000114   033000 236003                    LDQ     13824,DU
         1 000115   200031 552140                    STBQ    FO_GPARM+2,'40'O,AUTO

     1375     5836    2           FO_GPARM.REPEATS = 1;

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:186  
   5836  1 000116   000001 236007                    LDQ     1,DL
         1 000117   200031 552104                    STBQ    FO_GPARM+2,'04'O,AUTO

     1376     5837    2           FO_GPARM.RECL = LENGTHC (FS$SOFT_VFU);

   5837  1 000120   124000 236007                    LDQ     43008,DL
         1 000121   200031 552110                    STBQ    FO_GPARM+2,'10'O,AUTO

     1377     5838    2           FO_GPARM.DVBYTE = %DVBYTE_VFC# | %DVBYTE_TRANS#;

   5838  1 000122   000120 236003                    LDQ     80,DU
         1 000123   200031 552120                    STBQ    FO_GPARM+2,'20'O,AUTO

     1378     5839    2           CALL FOG$BLD (FO_GPARM);

   5839  1 000124   200027 635500                    EPPR5   FO_GPARM,,AUTO
         1 000125   200032 455500                    STP5    FO_GPARM+3,,AUTO
         1 000126   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000127   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000130   000000 701000 xent               TSX1    FOG$BLD
         1 000131   000000 011000                    NOP     0

     1379     5840                                                     /**/
     1380     5841    2           SYMB$ -> FO$SYMB.RCTZERO = '1'B;

   5841  1 000132   200004 470500                    LDP0    SYMB$,,AUTO
         1 000133   100000 236007                    LDQ     32768,DL
         1 000134   000012 256100                    ORSQ    10,,PR0

     1381     5842    2           GOTO DISPATCH;

   5842  1 000135   000577 710000 1                  TRA     DISPATCH

     1382     5843    2           END;
     1383     5844                                                     /**/
     1384     5845                                /* IF XMITTING TABS AFTER A SPACING OPERATION,
     1385     5846                                   THEN BUILD A GRANULE WITH THE TABS ONLY,
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:187  
     1386     5847                                   AND SEND IT OFF.  THE XMTABS FLAG WILL
     1387     5848                                   CAUSE FOM$NXDISK TO NOT UPDATE BLKREC. */
     1388     5849    1         IF (NOT SYMB$->FO$SYMB.SPACING) AND SYMB$->FO$SYMB.XMTABS THEN

   5849  1 000136   040000 316007                    CANQ    16384,DL
         1 000137   000171 601000 1                  TNZ     s:5868
         1 000140   000100 316007                    CANQ    64,DL
         1 000141   000171 600000 1                  TZE     s:5868

     1389     5850    2           DO;

     1390     5851                                      /* GRAN$ = N$REC.BUF */
     1391     5852    2           FO_GPARM.BUF$=GRAN$;

   5852  1 000142   200015 236100                    LDQ     GRAN$,,AUTO
         1 000143   200027 756100                    STQ     FO_GPARM,,AUTO

     1392     5853    2           FO_GPARM.REC$=ADDR(TAB$->FO$TABS.TABS);

   5853  1 000144   200012 236100                    LDQ     TAB$,,AUTO
         1 000145   000001 036003                    ADLQ    1,DU
         1 000146   200030 756100                    STQ     FO_GPARM+1,,AUTO

     1393     5854    2           FO_GPARM.VFCR=TABVFC;

   5854  1 000147   000000 236000 0                  LDQ     TABVFC
         1 000150   200031 552140                    STBQ    FO_GPARM+2,'40'O,AUTO

     1394     5855    2           FO_GPARM.REPEATS=1;

   5855  1 000151   000001 236007                    LDQ     1,DL
         1 000152   200031 552104                    STBQ    FO_GPARM+2,'04'O,AUTO

     1395     5856    2           FO_GPARM.RECL=LENGTHC(FO$TABS.TABS);

   5856  1 000153   040000 236007                    LDQ     16384,DL
         1 000154   200031 552110                    STBQ    FO_GPARM+2,'10'O,AUTO
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:188  

     1396     5857    2           FO_GPARM.DVBYTE=%DVBYTE_VFC#|%DVBYTE_TRANS#;

   5857  1 000155   000120 236003                    LDQ     80,DU
         1 000156   200031 552120                    STBQ    FO_GPARM+2,'20'O,AUTO

     1397     5858    2           CALL FOG$BLD (FO_GPARM);

   5858  1 000157   200027 635500                    EPPR5   FO_GPARM,,AUTO
         1 000160   200032 455500                    STP5    FO_GPARM+3,,AUTO
         1 000161   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000162   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000163   000000 701000 xent               TSX1    FOG$BLD
         1 000164   000000 011000                    NOP     0

     1398     5859                                /* DISPATCH WITHOUT UPDATING EXTENT INFO.
     1399     5860                                   THUS WE'LL READ THE CURRENT GRAN AGAIN
     1400     5861                                   AFTER SENDING THIS ONE. */
     1401     5862    2           SYMB$->FO$SYMB.RCTZERO='1'B;

   5862  1 000165   200004 470500                    LDP0    SYMB$,,AUTO
         1 000166   100000 236007                    LDQ     32768,DL
         1 000167   000012 256100                    ORSQ    10,,PR0

     1402     5863    2           GOTO DISPATCH;

   5863  1 000170   000577 710000 1                  TRA     DISPATCH

     1403     5864    2           END;
     1404     5865                                /* IF NOT XMITTING TABS, SET THE RECORD
     1405     5866                                   NUMBER OF THE FIRST REC TO BE PRINTED
     1406     5867                                   IN THIS GRAN, FROM FO$SYMB.BR.REC# */
     1407     5868    1         ELSE RCT=SYMB$->FO$SYMB.BR.REC#;

   5868  1 000171   300003 236100                    LDQ     3,,PR3
         1 000172   777777 376007                    ANQ     -1,DL
         1 000173   200022 756100                    STQ     RCT,,AUTO
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:189  

     1408     5869                                /* ADJUST EXTENT POINTERS */
     1409     5870
     1410     5871    1         SYMB$->FO$SYMB.CUREXT.NGRAN=SYMB$->FO$SYMB.CUREXT.NGRAN-1;

   5871  1 000174   300004 236100                    LDQ     4,,PR3
         1 000175   777000 036003                    ADLQ    -512,DU
         1 000176   300004 552140                    STBQ    4,'40'O,PR3

     1411     5872    1         IF SYMB$->FO$SYMB.CUREXT.NGRAN~=0 THEN

   5872  1 000177   300004 236100                    LDQ     4,,PR3
         1 000200   777000 316003                    CANQ    -512,DU
         1 000201   000217 600000 1                  TZE     s:5883

     1412     5873    2           DO;

     1413     5874    2           IF SYMB$->FO$SYMB.SPACING AND SYMB$->FO$SYMB.SPACEPAGES<0 THEN

   5874  1 000202   300012 236100                    LDQ     10,,PR3
         1 000203   040000 316007                    CANQ    16384,DL
         1 000204   000213 600000 1                  TZE     s:5878
         1 000205   300011 221100                    LDX1    9,,PR3
         1 000206   000213 605000 1                  TPL     s:5878

     1414     5875    2            SYMB$->FO$SYMB.CUREXT.DAD=SYMB$->FO$SYMB.CUREXT.DAD-1;

   5875  1 000207   300004 236100                    LDQ     4,,PR3
         1 000210   000032 036000 xsym               ADLQ    B_VECTNIL+26
         1 000211   300004 552134                    STBQ    4,'34'O,PR3
         1 000212   000242 710000 1                  TRA     s:5888

     1415     5876    2           ELSE
     1416     5877                                      /* Advance disk address */
     1417     5878    2            SYMB$->FO$SYMB.CUREXT.DAD=SYMB$->FO$SYMB.CUREXT.DAD+1;

   5878  1 000213   300004 236100                    LDQ     4,,PR3
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:190  
         1 000214   000001 036007                    ADLQ    1,DL
         1 000215   300004 552134                    STBQ    4,'34'O,PR3

     1418     5879    2           END;

   5879  1 000216   000242 710000 1                  TRA     s:5888

     1419     5880    1         ELSE
     1420     5881    2           DO;

     1421     5882                                /* PICK UP NEXT EXTENT & ASK FOR MORE */
     1422     5883    2           SYMB$->FO$SYMB.CUREXT=SYMB$->FO$SYMB.NXTEXT;

   5883  1 000217   000100 100500                    MLR     fill='000'O
         1 000220   300006 000010                    ADSC9   6,,PR3                   cn=0,n=8
         1 000221   300004 000010                    ADSC9   4,,PR3                   cn=0,n=8

     1423     5884    2           SYMB$->FO$SYMB.NXTEXT='0'B;

   5884  1 000222   300006 450100                    STZ     6,,PR3
         1 000223   300007 450100                    STZ     7,,PR3

     1424     5885    2           IF SYMB$->FO$SYMB.CUREXT.NGRAN~=0 OR SYMB$->FO$SYMB.CUREXT.DAD=0 THEN

   5885  1 000224   300004 236100                    LDQ     4,,PR3
         1 000225   777000 316003                    CANQ    -512,DU
         1 000226   000231 601000 1                  TNZ     s:5886
         1 000227   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 000230   000242 601000 1                  TNZ     s:5888

     1425     5886    2            CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_SFEXT#,0);

   5886  1 000231   000003 236000 2                  LDQ     3
         1 000232   200034 756100                    STQ     FO_GPARM+5,,AUTO
         1 000233   000004 236000 2                  LDQ     4
         1 000234   200004 235100                    LDA     SYMB$,,AUTO
         1 000235   200032 757100                    STAQ    FO_GPARM+3,,AUTO
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:191  
         1 000236   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000237   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000240   000000 701000 xent               TSX1    FOM$TELLAU
         1 000241   000000 011000                    NOP     0

     1426     5887    2           END;

     1427     5888    1         IF NAVX+AVAIL = 1024 THEN GOTO NXTGRAN;

   5888  1 000242   200020 236100                    LDQ     NAVX,,AUTO
         1 000243   200021 036100                    ADLQ    AVAIL,,AUTO
         1 000244   002000 116007                    CMPQ    1024,DL
         1 000245   000557 600000 1                  TZE     NXTGRAN

     1428     5889
     1429     5890        %EJECT;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:192  
     1430     5891        /*
     1431     5892           A note about spacing:
     1432     5893             Get an extent and read the first granule into the scratch granule
     1433     5894             (i.e. the one OUTSYM gives to MOOS on the open of each file).
     1434     5895             When the read completes, enter FOM$DISKEA.  Here, if we are
     1435     5896             spacing from BOF, send the VFU image (always the first record in
     1436     5897             in a symbiont file) to the device and await device endaction.
     1437     5898             Upon device endaction, we requeue the granule and end up in
     1438     5899             FOM$DISKEA.  Now we begin spacing until we locate the page/record
     1439     5900             for which we are searching.  If the current granule is exausted
     1440     5901             and we have not yet reached our goal, we issue a call to
     1441     5902             FOM$SNXDISK.  This routine changes the symbiont context block
     1442     5903             state to "disk granule done", updates the file relative disk
     1443     5904             address pointers to the next granule in the current extent, sets
     1444     5905             the state to "DKIO", and gives control to the I/O system in order
     1445     5906             to read the next granule.  On disk endaction we again end up in
     1446     5907             FOM$DISKEA and continue spacing.  Upon being called, FOM$SNXDISK
     1447     5908             determines whether or not we are out of granules in the current
     1448     5909             extent, and if we are it replaces the current extent with the
     1449     5910             queued next extent, requests a new extent from OUTSYM, sets the
     1450     5911             state to "DKIO", and gives control to the I/O system in order
     1451     5912             to read the first granule of the new current extent.
     1452     5913
     1453     5914             When we get disk endaction in order to continue printing a
     1454     5915             spaced/suspended file, we check if tabs were encountered during
     1455     5916             the spacing operation.  If they were, write the tabs and await
     1456     5917             device endaction.  Upon device endaction we enter FOM$DEVEA,
     1457     5918             change the state to "symbiont write done", make sure that we
     1458     5919             don't update the BLK#=REC#, and call FOM$NXDISK which in this
     1459     5920             case requeues this granule for actual printing.
     1460     5921
     1461     5922             It is important to note that devices are never aware that there
     1462     5923             is a spacing operation in progress.  Only MOOS and OUTSYM are
     1463     5924             aware of it.
     1464     5925        */
     1465     5926        %EJECT;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:193  
     1466     5927        /**
     1467     5928         **
     1468     5929         **      SPACING (REMOTE OR LOCAL)
     1469     5930         **
     1470     5931         **/
     1471     5932    1         IF SYMB$->FO$SYMB.SPACING THEN

   5932  1 000246   200004 470500                    LDP0    SYMB$,,AUTO
         1 000247   000012 236100                    LDQ     10,,PR0
         1 000250   040000 316007                    CANQ    16384,DL
         1 000251   000577 600000 1                  TZE     DISPATCH

     1472     5933    2           DO;

     1473     5934    2           REC#=SYMB$->FO$SYMB.BR.REC#;

   5934  1 000252   000003 236100                    LDQ     3,,PR0
         1 000253   777777 376007                    ANQ     -1,DL
         1 000254   200016 756100                    STQ     REC#,,AUTO

     1474     5935    2           IF SYMB$->FO$SYMB.SPACEPAGES>0 THEN

   5935  1 000255   000011 220100                    LDX0    9,,PR0
         1 000256   000414 604400 1                  TMOZ    SBKWD

     1475     5936    3   SFWD:     DO FOREVER;

   5936  1 000257                       SFWD         null
     1476     5937                                      /* Set record number at beginning of page */
     1477     5938    3             IF REC#=0 THEN REC#=1;

   5938  1 000257   200016 235100                    LDA     REC#,,AUTO
         1 000260   000263 601000 1                  TNZ     s:5939

   5938  1 000261   000001 236007                    LDQ     1,DL
         1 000262   200016 756100                    STQ     REC#,,AUTO

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:194  
     1478     5939    3             RECX=1024-REC#;

   5939  1 000263   002000 235007                    LDA     1024,DL
         1 000264   200016 135100                    SBLA    REC#,,AUTO
         1 000265   200017 755100                    STA     RECX,,AUTO

     1479     5940                                      /* Is record index in the current extent? */
     1480     5941    3             IF RECX < NAVX+AVAIL THEN

   5941  1 000266   200020 236100                    LDQ     NAVX,,AUTO
         1 000267   200021 036100                    ADLQ    AVAIL,,AUTO
         1 000270   200017 116100                    CMPQ    RECX,,AUTO
         1 000271   000304 604400 1                  TMOZ    s:5953

     1481     5942    4               DO;

     1482     5943                                      /* SPACETYPE = 1 means block spacing */
     1483     5944    4               IF SYMB$->FO$SYMB.SPACETYPE = 1 THEN

   5944  1 000272   200004 470500                    LDP0    SYMB$,,AUTO
         1 000273   000012 236100                    LDQ     10,,PR0
         1 000274   020000 376007                    ANQ     8192,DL
         1 000275   020000 116007                    CMPQ    8192,DL
         1 000276   000303 601000 1                  TNZ     s:5949

     1484     5945    5                 DO;

     1485     5946    5                 SYMB$->FO$SYMB.SPACEBLKS=SYMB$->FO$SYMB.SPACEBLKS-1;

   5946  1 000277   000011 220100                    LDX0    9,,PR0
         1 000300   777777 621010                    EAX1    -1,X0
         1 000301   000011 741100                    STX1    9,,PR0

     1486     5947    5                 IF SYMB$->FO$SYMB.SPACEBLKS = 0 THEN GOTO GOTPAGE;

   5947  1 000302   000564 600000 1                  TZE     GOTPAGE

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:195  
     1487     5948    5                 END;

     1488     5949    4               GOTO NXTGRAN;

   5949  1 000303   000557 710000 1                  TRA     NXTGRAN

     1489     5950    4               END;
     1490     5951                                      /* Here - record index is not in the current
     1491     5952                                         extent */
     1492     5953    3             REC$=PINCRW(GRAN$,PINCRW(GRAN$,RECX)->FM$CON.GX);

   5953  1 000304   200015 470500                    LDP0    GRAN$,,AUTO
         1 000305   000000 236105                    LDQ     0,AL,PR0
         1 000306   000014 772000                    QRL     12
         1 000307   001777 376007                    ANQ     1023,DL
         1 000310   000022 736000                    QLS     18
         1 000311   200015 036100                    ADLQ    GRAN$,,AUTO
         1 000312   200011 756100                    STQ     REC$,,AUTO

     1493     5954    3             VFCFCN=REC$->NK$VFC.FCN;

   5954  1 000313   200011 471500                    LDP1    REC$,,AUTO
         1 000314   003100 061500                    CSR     bolr='003'O
         1 000315   100000 020003                    BDSC    0,,PR1                   by=0,bit=2,n=3
         1 000316   200007 000044                    BDSC    VFCFCN,,AUTO             by=0,bit=0,n=36

     1494     5955                                /* SAVE TABS AS WE FIND 'EM */
     1495     5956    3             IF VFCFCN=%VFCF_SPC AND REC$->NK$VFC.COUNT=%VFCS_OTAB THEN

   5956  1 000317   200007 235100                    LDA     VFCFCN,,AUTO
         1 000320   000001 115007                    CMPA    1,DL
         1 000321   000353 601000 1                  TNZ     s:5970
         1 000322   003100 061500                    CSR     bolr='003'O
         1 000323   100000 050004                    BDSC    0,,PR1                   by=0,bit=5,n=4
         1 000324   200032 000044                    BDSC    FO_GPARM+3,,AUTO         by=0,bit=0,n=36
         1 000325   200032 236100                    LDQ     FO_GPARM+3,,AUTO
         1 000326   000001 116007                    CMPQ    1,DL
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:196  
         1 000327   000353 601000 1                  TNZ     s:5970

     1496     5957    4               DO;

     1497     5958    4               TAB$->FO$TABS.TABSR='0'B;

   5958  1 000330   200012 473500                    LDP3    TAB$,,AUTO
         1 000331   000100 100400                    MLR     fill='000'O
         1 000332   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000333   300001 000040                    ADSC9   1,,PR3                   cn=0,n=32

     1498     5959    4               RECL=PINCRW(GRAN$,RECX)->FM$CON.GACTB;

   5959  1 000334   200017 720100                    LXL0    RECX,,AUTO
         1 000335   000000 236110                    LDQ     0,X0,PR0
         1 000336   007777 376007                    ANQ     4095,DL
         1 000337   200005 756100                    STQ     RECL,,AUTO

     1499     5960    4               IF RECL > 1 THEN

   5960  1 000340   000002 116007                    CMPQ    2,DL
         1 000341   000350 602000 1                  TNC     s:5967

     1500     5961    5                 DO;

     1501     5962                                      /* Remove tab character from length,
     1502     5963                                         and save tab character */
     1503     5964    5                 RECL=RECL-1;

   5964  1 000342   000001 136007                    SBLQ    1,DL
         1 000343   200005 756100                    STQ     RECL,,AUTO

     1504     5965    5                 TAB$->FO$TABS.TABS=PINCRC(REC$,1)->B$TABS;

   5965  1 000344   000000 621006                    EAX1    0,QL
         1 000345   040100 100540                    MLR     fill='040'O
         1 000346   100000 200011                    ADSC9   0,,PR1                   cn=1,n=*X1
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:197  
         1 000347   300001 000040                    ADSC9   1,,PR3                   cn=0,n=32

     1505     5966    5                 END;

     1506     5967    4               SYMB$->FO$SYMB.XMTABS='1'B;

   5967  1 000350   200004 474500                    LDP4    SYMB$,,AUTO
         1 000351   000100 236007                    LDQ     64,DL
         1 000352   400012 256100                    ORSQ    10,,PR4

     1507     5968    4               END;

     1508     5969                                      /* SPACETYPE = 0 means record spacing */
     1509     5970    3             IF SYMB$->FO$SYMB.SPACETYPE = 0 THEN

   5970  1 000353   200004 473500                    LDP3    SYMB$,,AUTO
         1 000354   300012 236100                    LDQ     10,,PR3
         1 000355   020000 316007                    CANQ    8192,DL
         1 000356   000402 601000 1                  TNZ     s:5988

     1510     5971    4               DO;

     1511     5972    4               IF (NOT SYMB$->FO$SYMB.PAGES       /* Not paged output            */

   5972  1 000357   010000 316007                    CANQ    4096,DL
         1 000360   000365 601000 1                  TNZ     s:5972+6
         1 000361   000040 316007                    CANQ    32,DL
         1 000362   000373 601000 1                  TNZ     s:5980
         1 000363   000006 115007                    CMPA    6,DL
         1 000364   000373 603000 1                  TRC     s:5980
         1 000365   010000 316007                    CANQ    4096,DL
         1 000366   000377 600000 1                  TZE     s:5983
         1 000367   000200 316007                    CANQ    128,DL
         1 000370   000377 601000 1                  TNZ     s:5983
         1 000371   000007 115007                    CMPA    7,DL
         1 000372   000377 601000 1                  TNZ     s:5983

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:198  
     1512     5973    4               AND (SYMB$->FO$SYMB.CPVFC      /* Card Punch VFC              */
     1513     5974    4               OR VFCFCN >= %VFCF_SPB))  /* TOF VFC or SBP VFC          */
     1514     5975    4               OR (SYMB$->FO$SYMB.PAGES           /* Paged output                */
     1515     5976    4               AND NOT SYMB$->FO$SYMB.FIRSTSPACE /* Not 1st time thru code   */
     1516     5977    4               AND VFCFCN = %VFCF_HDR)        /* TOF VFC                     */
     1517     5978    4               THEN                               /* We're at new logical "PAGE" */
     1518     5979    5                 DO;

     1519     5980    5                 SYMB$->FO$SYMB.SPACEPAGES=SYMB$->FO$SYMB.SPACEPAGES-1;

   5980  1 000373   300011 220100                    LDX0    9,,PR3
         1 000374   777777 621010                    EAX1    -1,X0
         1 000375   300011 741100                    STX1    9,,PR3

     1520     5981    5                 IF SYMB$->FO$SYMB.SPACEPAGES=0 THEN GOTO GOTPAGE;

   5981  1 000376   000564 600000 1                  TZE     GOTPAGE

     1521     5982    5                 END;

     1522     5983    4               SYMB$->FO$SYMB.FIRSTSPACE='0'B;

   5983  1 000377   000005 236000 2                  LDQ     5
         1 000400   300012 356100                    ANSQ    10,,PR3

     1523     5984    4               END;

   5984  1 000401   000412 710000 1                  TRA     s:5991

     1524     5985    3             ELSE
     1525     5986    4               DO;

     1526     5987                                      /* Else, block spacing */
     1527     5988    4               IF  SYMB$->FO$SYMB.SPACEBLKS = 1

   5988  1 000402   300011 220100                    LDX0    9,,PR3
         1 000403   000001 100003                    CMPX0   1,DU
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:199  
         1 000404   000412 601000 1                  TNZ     s:5991
         1 000405   300011 236100                    LDQ     9,,PR3
         1 000406   000011 772000                    QRL     9
         1 000407   000777 376007                    ANQ     511,DL
         1 000410   200016 116100                    CMPQ    REC#,,AUTO
         1 000411   000564 604400 1                  TMOZ    GOTPAGE

     1528     5989    4               AND SYMB$->FO$SYMB.SPACEREC# <= REC# THEN GOTO GOTPAGE;
     1529     5990    4               END;

     1530     5991    3             REC#=REC#+1;

   5991  1 000412   200016 054100                    AOS     REC#,,AUTO

     1531     5992                                      /* END space forward forever */
     1532     5993    3             END SFWD;

   5993  1 000413   000257 710000 1                  TRA     SFWD

     1533     5994                                      /* Begin space backward forever */
     1534     5995    3   SBKWD:    DO FOREVER;

   5995  1 000414                       SBKWD        null
     1535     5996    3             RECX=1024-REC#;

   5996  1 000414   002000 235007                    LDA     1024,DL
         1 000415   200016 135100                    SBLA    REC#,,AUTO
         1 000416   200017 755100                    STA     RECX,,AUTO

     1536     5997    3             IF RECX < NAVX+AVAIL THEN

   5997  1 000417   200020 236100                    LDQ     NAVX,,AUTO
         1 000420   200021 036100                    ADLQ    AVAIL,,AUTO
         1 000421   200017 116100                    CMPQ    RECX,,AUTO
         1 000422   000432 604400 1                  TMOZ    s:6003

     1537     5998    4               DO;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:200  

     1538     5999    4               RECX=NAVX+AVAIL;

   5999  1 000423   200020 236100                    LDQ     NAVX,,AUTO
         1 000424   200021 036100                    ADLQ    AVAIL,,AUTO
         1 000425   200017 756100                    STQ     RECX,,AUTO

     1539     6000                                      /* Set record number to beginning of page */
     1540     6001    4               REC#=1024-RECX;

   6001  1 000426   002000 235007                    LDA     1024,DL
         1 000427   200017 135100                    SBLA    RECX,,AUTO
         1 000430   200016 755100                    STA     REC#,,AUTO

     1541     6002    4               END;

   6002  1 000431   000446 710000 1                  TRA     s:6017

     1542     6003    3             ELSE IF REC# = 0 THEN

   6003  1 000432   200016 236100                    LDQ     REC#,,AUTO
         1 000433   000446 601000 1                  TNZ     s:6017

     1543     6004    4                DO;

     1544     6005                                      /* SPACETYPE means block spacing */
     1545     6006    4                IF SYMB$->FO$SYMB.SPACETYPE = 1 THEN

   6006  1 000434   200004 470500                    LDP0    SYMB$,,AUTO
         1 000435   000012 236100                    LDQ     10,,PR0
         1 000436   020000 376007                    ANQ     8192,DL
         1 000437   020000 116007                    CMPQ    8192,DL
         1 000440   000445 601000 1                  TNZ     s:6015

     1546     6007    5                  DO;

     1547     6008                                      /* Add 1 to the number of blocks we
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:201  
     1548     6009                                         must space backwards */
     1549     6010    5                  SYMB$->FO$SYMB.SPACEBLKS=SYMB$->FO$SYMB.SPACEBLKS+1;

   6010  1 000441   000011 220100                    LDX0    9,,PR0
         1 000442   000001 621010                    EAX1    1,X0
         1 000443   000011 741100                    STX1    9,,PR0

     1550     6011    5                  IF SYMB$->FO$SYMB.SPACEBLKS = 0 THEN GOTO GOTPAGE;

   6011  1 000444   000564 600000 1                  TZE     GOTPAGE

     1551     6012    5                  END;

     1552     6013                                      /* We have spaced beyond the limits of
     1553     6014                                         this granule, get a new one */
     1554     6015    4                GOTO NXTGRAN;

   6015  1 000445   000557 710000 1                  TRA     NXTGRAN

     1555     6016    4                END;
     1556     6017    3             REC$=PINCRW(GRAN$,PINCRW(GRAN$,RECX)->FM$CON.GX);

   6017  1 000446   200015 470500                    LDP0    GRAN$,,AUTO
         1 000447   200017 720100                    LXL0    RECX,,AUTO
         1 000450   000000 236110                    LDQ     0,X0,PR0
         1 000451   000014 772000                    QRL     12
         1 000452   001777 376007                    ANQ     1023,DL
         1 000453   000022 736000                    QLS     18
         1 000454   200015 036100                    ADLQ    GRAN$,,AUTO
         1 000455   200011 756100                    STQ     REC$,,AUTO

     1557     6018                                      /* Get VFC character of this record */
     1558     6019    3             VFCFCN=REC$->NK$VFC.FCN;

   6019  1 000456   200011 471500                    LDP1    REC$,,AUTO
         1 000457   003100 061500                    CSR     bolr='003'O
         1 000460   100000 020003                    BDSC    0,,PR1                   by=0,bit=2,n=3
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:202  
         1 000461   200007 000044                    BDSC    VFCFCN,,AUTO             by=0,bit=0,n=36

     1559     6020                                /* SAVE PREVIOUS TABS IF WE FIND A SET
     1560     6021                                   TABS RECORD WHILE GOING BACKWARD */
     1561     6022    3             IF VFCFCN=%VFCF_SPC AND REC$->NK$VFC.COUNT=%VFCS_OTAB THEN

   6022  1 000462   200007 235100                    LDA     VFCFCN,,AUTO
         1 000463   000001 115007                    CMPA    1,DL
         1 000464   000515 601000 1                  TNZ     s:6035
         1 000465   003100 061500                    CSR     bolr='003'O
         1 000466   100000 050004                    BDSC    0,,PR1                   by=0,bit=5,n=4
         1 000467   200032 000044                    BDSC    FO_GPARM+3,,AUTO         by=0,bit=0,n=36
         1 000470   200032 236100                    LDQ     FO_GPARM+3,,AUTO
         1 000471   000001 116007                    CMPQ    1,DL
         1 000472   000515 601000 1                  TNZ     s:6035

     1562     6023    4               DO;

     1563     6024    4               TAB$->FO$TABS.TABSR='0'B;

   6024  1 000473   200012 473500                    LDP3    TAB$,,AUTO
         1 000474   000100 100400                    MLR     fill='000'O
         1 000475   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000476   300001 000040                    ADSC9   1,,PR3                   cn=0,n=32

     1564     6025    4               RECL=PINCRW(GRAN$,RECX)->FM$CON.GACTB;

   6025  1 000477   000000 236110                    LDQ     0,X0,PR0
         1 000500   007777 376007                    ANQ     4095,DL
         1 000501   200005 756100                    STQ     RECL,,AUTO

     1565     6026                                      /* TAB records are at least 33 bytes */
     1566     6027    4               IF RECL > 33 THEN

   6027  1 000502   000042 116007                    CMPQ    34,DL
         1 000503   000512 602000 1                  TNC     s:6032

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:203  
     1567     6028    5                 DO;

     1568     6029    5                 RECL=RECL-33;

   6029  1 000504   000041 136007                    SBLQ    33,DL
         1 000505   200005 756100                    STQ     RECL,,AUTO

     1569     6030    5                 TAB$->FO$TABS.TABS=PINCRC(REC$,33)->B$TABS;

   6030  1 000506   000000 621006                    EAX1    0,QL
         1 000507   040100 100540                    MLR     fill='040'O
         1 000510   100010 200011                    ADSC9   8,,PR1                   cn=1,n=*X1
         1 000511   300001 000040                    ADSC9   1,,PR3                   cn=0,n=32

     1570     6031    5                 END;

     1571     6032    4               SYMB$->FO$SYMB.XMTABS='1'B;

   6032  1 000512   200004 474500                    LDP4    SYMB$,,AUTO
         1 000513   000100 236007                    LDQ     64,DL
         1 000514   400012 256100                    ORSQ    10,,PR4

     1572     6033    4               END;

     1573     6034                                      /* SPACETYPE = 0 means record spacing */
     1574     6035    3             IF SYMB$->FO$SYMB.SPACETYPE = 0 THEN

   6035  1 000515   200004 473500                    LDP3    SYMB$,,AUTO
         1 000516   300012 236100                    LDQ     10,,PR3
         1 000517   020000 316007                    CANQ    8192,DL
         1 000520   000544 601000 1                  TNZ     s:6054

     1575     6036    4               DO;

     1576     6037    4               IF (NOT SYMB$->FO$SYMB.PAGES       /* Not paged output            */

   6037  1 000521   010000 316007                    CANQ    4096,DL
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:204  
         1 000522   000527 601000 1                  TNZ     s:6037+6
         1 000523   000040 316007                    CANQ    32,DL
         1 000524   000535 601000 1                  TNZ     s:6047
         1 000525   000006 115007                    CMPA    6,DL
         1 000526   000535 603000 1                  TRC     s:6047
         1 000527   010000 316007                    CANQ    4096,DL
         1 000530   000541 600000 1                  TZE     s:6050
         1 000531   000200 316007                    CANQ    128,DL
         1 000532   000541 601000 1                  TNZ     s:6050
         1 000533   000007 115007                    CMPA    7,DL
         1 000534   000541 601000 1                  TNZ     s:6050

     1577     6038    4               AND (SYMB$->FO$SYMB.CPVFC      /* Card Punch VFC              */
     1578     6039    4               OR VFCFCN >= %VFCF_SPB))  /* TOF VFC or SBP VFC          */
     1579     6040    4               OR (SYMB$->FO$SYMB.PAGES           /* Paged output                */
     1580     6041    4               AND NOT SYMB$->FO$SYMB.FIRSTSPACE /* Not 1st time thru code   */
     1581     6042    4               AND VFCFCN = %VFCF_HDR)        /* TOF VFC                     */
     1582     6043    4               THEN                               /* We're at new logical "PAGE" */
     1583     6044    5                 DO;

     1584     6045                                      /* ADD 1 to the number of pages we must
     1585     6046                                         space back */
     1586     6047    5                 SYMB$->FO$SYMB.SPACEPAGES=SYMB$->FO$SYMB.SPACEPAGES+1;

   6047  1 000535   300011 221100                    LDX1    9,,PR3
         1 000536   000001 622011                    EAX2    1,X1
         1 000537   300011 742100                    STX2    9,,PR3

     1587     6048    5                 IF SYMB$->FO$SYMB.SPACEPAGES=0 THEN GOTO GOTPAGE;

   6048  1 000540   000564 600000 1                  TZE     GOTPAGE

     1588     6049    5                 END;

     1589     6050    4               SYMB$->FO$SYMB.FIRSTSPACE='0'B;

   6050  1 000541   000005 236000 2                  LDQ     5
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:205  
         1 000542   300012 356100                    ANSQ    10,,PR3

     1590     6051    4               END;

   6051  1 000543   000554 710000 1                  TRA     s:6057

     1591     6052    3             ELSE
     1592     6053    4               DO;

     1593     6054    4               IF  SYMB$->FO$SYMB.SPACEBLKS = -1

   6054  1 000544   300011 221100                    LDX1    9,,PR3
         1 000545   777777 101003                    CMPX1   -1,DU
         1 000546   000554 601000 1                  TNZ     s:6057
         1 000547   300011 236100                    LDQ     9,,PR3
         1 000550   000011 772000                    QRL     9
         1 000551   000777 376007                    ANQ     511,DL
         1 000552   200016 116100                    CMPQ    REC#,,AUTO
         1 000553   000564 605000 1                  TPL     GOTPAGE

     1594     6055    4               AND SYMB$->FO$SYMB.SPACEREC# >= REC# THEN GOTO GOTPAGE;
     1595     6056    4               END;

     1596     6057    3             REC#=REC#-1;

   6057  1 000554   000001 336007                    LCQ     1,DL
         1 000555   200016 056100                    ASQ     REC#,,AUTO

     1597     6058    3             END SBKWD;

   6058  1 000556   000414 710000 1                  TRA     SBKWD

     1598     6059    2   NXTGRAN:
     1599     6060    2           CALL FOM$SNXDISK (SYMB$->FO$SYMB);

   6060  1 000557   200004 630500       NXTGRAN      EPPR0   SYMB$,,AUTO
         1 000560   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:206  
         1 000561   000000 701000 xent               TSX1    FOM$SNXDISK
         1 000562   000000 011000                    NOP     0

     1600     6061    2           RETURN;

   6061  1 000563   000000 702200 xent               TSX2  ! X66_ARET

     1601     6062    2   GOTPAGE:
     1602     6063    2           SYMB$->FO$SYMB.BR.REC#=REC#;

   6063  1 000564   200016 720100       GOTPAGE      LXL0    REC#,,AUTO
         1 000565   200004 470500                    LDP0    SYMB$,,AUTO
         1 000566   000003 440100                    SXL0    3,,PR0

     1603     6064    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_FSPA);

   6064  1 000567   000006 236000 2                  LDQ     6
         1 000570   200004 235100                    LDA     SYMB$,,AUTO
         1 000571   200032 757100                    STAQ    FO_GPARM+3,,AUTO
         1 000572   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000573   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000574   000000 701000 xent               TSX1    FOM$EVENT
         1 000575   000000 011000                    NOP     0

     1604     6065    2           RETURN;

   6065  1 000576   000000 702200 xent               TSX2  ! X66_ARET

   6063  1 000577                       DISPATCH     null
     1605     6066    2           END;
     1606     6067        %EJECT;
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:207  
     1607     6068    1   DISPATCH:;
     1608     6069        /**
     1609     6070         **
     1610     6071         **      REMOTE DEVICE
     1611     6072         **
     1612     6073         **/
     1613     6074    1         RCTZERO=SYMB$->FO$SYMB.RCTZERO;

   6074  1 000577   200004 470500                    LDP0    SYMB$,,AUTO
         1 000600   000012 236100                    LDQ     10,,PR0
         1 000601   000024 736000                    QLS     20
         1 000602   400000 376003                    ANQ     -131072,DU
         1 000603   200024 756100                    STQ     RCTZERO,,AUTO

     1614     6075    1         SYMB$->FO$SYMB.RCTZERO='0'B;

   6075  1 000604   000007 236000 2                  LDQ     7
         1 000605   000012 356100                    ANSQ    10,,PR0

     1615     6076                                      /* FEX ~= 0 means remote */
     1616     6077    1         IF ~LDCT$->NK$LDCT.DFLG.LOCAL THEN

   6077  1 000606   200013 471500                    LDP1    LDCT$,,AUTO
         1 000607   100006 236100                    LDQ     6,,PR1
         1 000610   000031 736000                    QLS     25
         1 000611   400000 376003                    ANQ     -131072,DU
         1 000612   400000 676003                    ERQ     -131072,DU
         1 000613   000630 600000 1                  TZE     s:6091

     1617     6078    2           DO;

     1618     6079                                      /* Do state check */
     1619     6080    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_RDII) ALTRET(RTN);

   6080  1 000614   000010 236000 2                  LDQ     8
         1 000615   200004 235100                    LDA     SYMB$,,AUTO
         1 000616   200032 757100                    STAQ    FO_GPARM+3,,AUTO
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:208  
         1 000617   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000620   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000621   000000 701000 xent               TSX1    FOM$EVENT
         1 000622   000627 702000 1                  TSX2    RTN

     1620     6081
     1621     6082    2           CALL FOM$DEBLOCK (LDCT$->NK$LDCT);

   6082  1 000623   200013 630500                    EPPR0   LDCT$,,AUTO
         1 000624   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000625   000000 701000 xent               TSX1    FOM$DEBLOCK
         1 000626   000000 011000                    NOP     0

     1622     6083                                      /* Do a state check */
     1623     6084    2   RTN:    RETURN;

   6084  1 000627   000000 702200 xent  RTN          TSX2  ! X66_ARET

     1624     6085    2           END;
     1625     6086        /**
     1626     6087         **
     1627     6088         **      LOCAL DEVICE
     1628     6089         **
     1629     6090         **/
     1630     6091    1         N$REQ.DLA.DCTX=LDCT$->NK$LDCT.RLCID.LDCTX; /* DEV DCTX */

   6091  1 000630   200003 473500                    LDP3    @N$REQ,,AUTO
         1 000631   100015 236100                    LDQ     13,,PR1
         1 000632   000025 736000                    QLS     21
         1 000633   300001 676100                    ERQ     1,,PR3
         1 000634   777770 376003                    ANQ     -8,DU
         1 000635   300001 656100                    ERSQ    1,,PR3

     1631     6092    1         N$REQ.FC=%N_SYMB;

   6092  1 000636   000032 236007                    LDQ     26,DL
         1 000637   300003 552104                    STBQ    3,'04'O,PR3
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:209  

     1632     6093    1         N$REQ.COMP = %COMP_REG ;

   6093  1 000640   000011 236000 2                  LDQ     9
         1 000641   300027 356100                    ANSQ    23,,PR3

     1633     6094    1         N$REQ.EAENTRY=ENTADDR(FOM$DEVEA);

   6094  1 000642   000000 636000 xent               EAQ     FOM$DEVEA
         1 000643   300023 756100                    STQ     19,,PR3

     1634     6095    1         N$REQ.OPFLG=OP_EA|OP_HOLD|OP_BPF;

   6095  1 000644   000054 236007                    LDQ     44,DL
         1 000645   300004 552104                    STBQ    4,'04'O,PR3

     1635     6096    1         CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_LDIO) ALTRET(RTN);

   6096  1 000646   000012 236000 2                  LDQ     10
         1 000647   200004 235100                    LDA     SYMB$,,AUTO
         1 000650   200032 757100                    STAQ    FO_GPARM+3,,AUTO
         1 000651   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000652   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000653   000000 701000 xent               TSX1    FOM$EVENT
         1 000654   000627 702000 1                  TSX2    RTN

     1636     6097                                      /* Tab granule? */
     1637     6098    1         IF RCTZERO THEN N$REQ.RCT=0;

   6098  1 000655   200024 234100                    SZN     RCTZERO,,AUTO
         1 000656   000663 605000 1                  TPL     s:6100

   6098  1 000657   000000 220003                    LDX0    0,DU
         1 000660   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000661   000030 440100                    SXL0    24,,PR0
         1 000662   000666 710000 1                  TRA     s:6101

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:210  
     1638     6099                                      /* Not a tab granule */
     1639     6100    1         ELSE N$REQ.RCT=RCT;

   6100  1 000663   200022 720100                    LXL0    RCT,,AUTO
         1 000664   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000665   000030 440100                    SXL0    24,,PR0

     1640     6101    1         N$REQ.EAINFOX=0;

   6101  1 000666   000025 450100                    STZ     21,,PR0

     1641     6102    1         IF DOIOQ = 1 THEN CALL NIO$QUE (N$REQ);

   6102  1 000667   200006 235100                    LDA     DOIOQ,,AUTO
         1 000670   000001 115007                    CMPA    1,DL
         1 000671   000677 601000 1                  TNZ     s:6103

   6102  1 000672   200003 630500                    EPPR0   @N$REQ,,AUTO
         1 000673   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000674   000000 701000 xent               TSX1    NIO$QUE
         1 000675   000000 011000                    NOP     0
         1 000676   000701 710000 1                  TRA     s:6104

     1642     6103    1         ELSE N$REQ.OPFLG.REQ='1'B;

   6103  1 000677   000002 236007                    LDQ     2,DL
         1 000700   000004 256100                    ORSQ    4,,PR0

     1643     6104    1         RETURN;

   6104  1 000701   000000 702200 xent               TSX2  ! X66_ARET

     1644     6105        /**/
     1645     6106        /**/
     1646     6107
     1647     6108        /* CODE REMOVED IN M:MON PURGE CYCLE
     1648     6109        !FOM$DISKEAR: ENTRY (N$REQ);
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:211  
     1649     6110        !:*F* NAME:         FOM$DISKEAR
     1650     6111        !     PURPOSE:      To retry queueing the next fep output request
     1651     6112        !                   after deferral.
     1652     6113        !     DESCRIPTION:
     1653     6114        !                   FOM$TIMR calls here if we had to defer sending
     1654     6115        !                   the just-read granule to FEP because the output
     1655     6116        !                   queue was full.  We simply re-enter the
     1656     6117        !                   appropriate part of FOM$DISKEA        *:
     1657     6118        !
     1658     6119        !      SYMB$=N$REQ.EAINFOP$;
     1659     6120        !      LDCT$=NK$LDCT$(SYMB$->FO$SYMB.DEVLDCTX);
     1660     6121        !      RCT=SYMB$->FO$SYMB.BR.REC#;
     1661     6122        !      GOTO DISPATCH;
     1662     6123        !
     1663     6124              END OF CODE REMOVED IN M:MON PURGE CYCLE */
     1664     6125        /**/
     1665     6126        /**/
     1666     6127    1   FOM$WRITE: ENTRY (N$REQ);

   6127  1 000702   000000 700200 xent  FOM$WRITE    TSX0  ! X66_AUTO_1
         1 000703   000036 000001                    ZERO    30,1

     1667     6128        /**/
     1668     6129        /*F* NAME:         FOM$WRITE
     1669     6130             PURPOSE:      To write a single record or granule to a
     1670     6131                           symbiont device.
     1671     6132             DESCRIPTION:  If RECORD_ in the FPT is NILERASE, then an
     1672     6133                           entire granule is being supplied, framed by
     1673     6134                           BUF_.  Otherwise, a record is to be built into
     1674     6135                           the symbiont buffer, and sent.  The description
     1675     6136                           of the record is a VLP_SYMBWRITE framed by
     1676     6137                           RECORD_.  After the write completes, OUTSYM
     1677     6138                           may receive a symbiont ack if he requested it,
     1678     6139                           or, if requested and the device is local, a
     1679     6140                           symbiont token (for remote devices, an ack
     1680     6141                           is generated when the FEP acks the write,
     1681     6142                           whereas a token is generated after the data
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:212  
     1682     6143                           is printed).  */
     1683     6144
     1684     6145    1         SYMB$=N$REQ.EAINFOP$;

   6145  1 000704   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000705   000024 236100                    LDQ     20,,PR0
         1 000706   200004 756100                    STQ     SYMB$,,AUTO

     1685     6146    1         LDCT$=NK$LDCT$(SYMB$->FO$SYMB.DEVLDCTX);

   6146  1 000707   200004 471500                    LDP1    SYMB$,,AUTO
         1 000710   100010 720100                    LXL0    8,,PR1
         1 000711   000000 473400 xsym               LDP3    N$DCT$$
         1 000712   300000 236110                    LDQ     0,X0,PR3
         1 000713   200013 756100                    STQ     LDCT$,,AUTO

     1686     6147    1         GRAN$=N$REQ.BUF$;

   6147  1 000714   000005 236100                    LDQ     5,,PR0
         1 000715   200015 756100                    STQ     GRAN$,,AUTO

     1687     6148                                      /* Was there a single record passed?
     1688     6149                                         If not, write an entire granule */
     1689     6150    1         CALL HFF$NILERASE (4) ALTRET(GOWRITE);

   6150  1 000716   000013 630400 2                  EPPR0   11
         1 000717   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000720   000000 701000 xent               TSX1    HFF$NILERASE
         1 000721   000777 702000 1                  TSX2    GOWRITE

     1690     6151    1         FO_GPARM.BUF$=GRAN$;

   6151  1 000722   200015 236100                    LDQ     GRAN$,,AUTO
         1 000723   200027 756100                    STQ     FO_GPARM,,AUTO

     1691     6152    1         CALL FOG$GRAN (FO_GPARM);

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:213  
   6152  1 000724   200027 630500                    EPPR0   FO_GPARM,,AUTO
         1 000725   200032 450500                    STP0    FO_GPARM+3,,AUTO
         1 000726   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000727   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000730   000000 701000 xent               TSX1    FOG$GRAN
         1 000731   000000 011000                    NOP     0

     1692     6153    1         FO_GPARM.DVBYTE=%DVBYTE_VFC#|%DVBYTE_BP#;

   6153  1 000732   000300 236003                    LDQ     192,DU
         1 000733   200031 552120                    STBQ    FO_GPARM+2,'20'O,AUTO

     1693     6154    1         IF B$PS4$->VLP$WRITE.TOF THEN

   6154  1 000734   000000 470400 xsym               LDP0    B$PS4$
         1 000735   000000 234100                    SZN     0,,PR0
         1 000736   000755 605000 1                  TPL     s:6162

     1694     6155    2           DO;

     1695     6156    2           FO_GPARM.REPEATS=1;

   6156  1 000737   000001 236007                    LDQ     1,DL
         1 000740   200031 552104                    STBQ    FO_GPARM+2,'04'O,AUTO

     1696     6157    2           FO_GPARM.REC$=ADDR(BLANKS);

   6157  1 000741   000014 236000 2                  LDQ     12
         1 000742   200030 756100                    STQ     FO_GPARM+1,,AUTO

     1697     6158    2           FO_GPARM.VFCR=TOFVFC;

   6158  1 000743   000001 236000 0                  LDQ     TOFVFC
         1 000744   200031 552140                    STBQ    FO_GPARM+2,'40'O,AUTO

     1698     6159    2           FO_GPARM.RECL=3;

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:214  
   6159  1 000745   003000 236007                    LDQ     1536,DL
         1 000746   200031 552110                    STBQ    FO_GPARM+2,'10'O,AUTO

     1699     6160    2           CALL FOG$ADD (FO_GPARM);

   6160  1 000747   200027 631500                    EPPR1   FO_GPARM,,AUTO
         1 000750   200032 451500                    STP1    FO_GPARM+3,,AUTO
         1 000751   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000752   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000753   000000 701000 xent               TSX1    FOG$ADD
         1 000754   000000 011000                    NOP     0

     1700     6161    2           END;

     1701     6162    1         FO_GPARM.REPEATS=B$PS4$->VLP$WRITE.REPEATS;

   6162  1 000755   000000 470400 xsym               LDP0    B$PS4$
         1 000756   000000 236100                    LDQ     0,,PR0
         1 000757   000011 772000                    QRL     9
         1 000760   200031 552104                    STBQ    FO_GPARM+2,'04'O,AUTO

     1702     6163    1         FO_GPARM.RECL   =B$PS4$->VLP$WRITE.RECL;

   6163  1 000761   000000 236100                    LDQ     0,,PR0
         1 000762   000011 736000                    QLS     9
         1 000763   200031 552110                    STBQ    FO_GPARM+2,'10'O,AUTO

     1703     6164    1         FO_GPARM.REC$   =ADDR(B$PS4$->VLP$WRITE.REC);

   6164  1 000764   000000 236000 xsym               LDQ     B$PS4$
         1 000765   000001 036003                    ADLQ    1,DU
         1 000766   200030 756100                    STQ     FO_GPARM+1,,AUTO

     1704     6165    1         FO_GPARM.VFCR   ='0'B;

   6165  1 000767   000000 236003                    LDQ     0,DU
         1 000770   200031 552140                    STBQ    FO_GPARM+2,'40'O,AUTO
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:215  

     1705     6166    1         CALL FOG$ADD (FO_GPARM);

   6166  1 000771   200027 631500                    EPPR1   FO_GPARM,,AUTO
         1 000772   200032 451500                    STP1    FO_GPARM+3,,AUTO
         1 000773   200032 630500                    EPPR0   FO_GPARM+3,,AUTO
         1 000774   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000775   000000 701000 xent               TSX1    FOG$ADD
         1 000776   000000 011000                    NOP     0

   6165  1 000777                       GOWRITE      null
     1706     6167    1   GOWRITE:;
     1707     6168    1         SYMB$->FO$SYMB.RCTZERO='1'B;

   6168  1 000777   200004 470500                    LDP0    SYMB$,,AUTO
         1 001000   100000 236007                    LDQ     32768,DL
         1 001001   000012 256100                    ORSQ    10,,PR0

     1708     6169    1         DOIOQ=1;

   6169  1 001002   000001 235007                    LDA     1,DL
         1 001003   200006 755100                    STA     DOIOQ,,AUTO

     1709     6170    1         GOTO DISPATCH;

   6170  1 001004   000577 710000 1                  TRA     DISPATCH

TABVFC
 Sect OctLoc
   0     000   0210** ******                                                    ....

TOFVFC
 Sect OctLoc
   0     001   1610** ******                                                    q...

BLANKS
 Sect OctLoc
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:216  
   0     002   040040 040***                                                       .

(unnamed)
 Sect OctLoc
   2     000   000005 006000   000000 006000   000000 000016   000002 006000    ................
   2     004   000002 006000   777777 777577   000000 006000   777777 677777    ................
   2     010   000000 006000   777777 600777   000000 006000   000006 006000    ................
   2     014   000002 006000                                                    ....
     1710     6171        /**/
     1711     6172        /**/
     1712     6173    1   END FOM$DISKEA;
     1713     6174        /**/
     1714     6175        /**/
     1715     6176        %EOD;

PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:217  
--  Include file information  --

   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   UM$CP6V_C.:E05TOU  is referenced.
   FOO_MAC_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$GRAN.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   FS_SUPER_C.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$DISKEA.
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:218  

 **** Variables and constants ****

  ****  Section 000 RoData FOM$DISKEA

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w CHAR(3)     r     1 BLANKS                     0-0-0/c STRC(9)     r     1 TABVFC
     1-0-0/c STRC(9)     r     1 TOFVFC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @N$REQ                    21-0-0/w SBIN        r     1 AVAIL
     6-0-0/w UBIN        r     1 DOIOQ                     27-0-0/w STRC(108)   r     1 FO_GPARM
    15-0-0/w PTR         r     1 GRAN$                     13-0-0/w PTR         r     1 LDCT$
    *0-0-0/d STRC(1080)  r     1 N$REQ                     20-0-0/w SBIN        r     1 NAVX
    22-0-0/w UBIN        r     1 RCT                       24-0-0/b BIT         r     1 RCTZERO
    16-0-0/w SBIN        r     1 REC#                      11-0-0/w PTR         r     1 REC$
     5-0-0/w UBIN        r     1 RECL                      17-0-0/w SBIN        r     1 RECX
     4-0-0/w PTR         r     1 SYMB$                     12-0-0/w PTR         r     1 TAB$
     7-0-0/w UBIN        r     1 VFCFCN

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$PS4$                     0-0-0/w STRC        r     1 FOSE_FSPA
     0-0-0/w STRC        r     1 FOSE_HLTR                  0-0-0/w STRC        r     1 FOSE_LDIO
     0-0-0/w STRC        r     1 FOSE_RDII                  0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:219  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 B$TABS                     0-0-0/w STRC        r     1 FM$CON
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w STRC(468)   r     1 FO$SBUF
     0-0-0/w STRC(720)   r     1 FO$SYMB                    0-0-0/w STRC(360)   r     1 FO$TABS
     0-0-0/b STRC(756)   r     1 FS$SOFT_VFU                0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/c STRC(9)     r     1 NK$VFC                     0-0-0/d STRC(1296)  r     1 VLP$WRITE


   Procedure FOM$DISKEA requires 517 words for executable code.
   Procedure FOM$DISKEA requires 30 words of local(AUTO) storage.
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:220  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:221  
          MINI XREF LISTING

AVAIL
      5639**DCL      5791<<ASSIGN   5820>>IF       5824>>ASSIGN   5888>>IF       5941>>IF       5997>>IF
      5999>>ASSIGN
B$PS4$
      5717**DCL      6154>>IF       6162>>ASSIGN   6163>>ASSIGN   6164>>ASSIGN
B$TABS
      5611**DCL      5965>>ASSIGN   6030>>ASSIGN
BLANKS
      5711**DCL      6157--ASSIGN
DISPATCH
      6063**LABEL    5842--GOTO     5863--GOTO     6170--GOTO
DKERR
      5802**LABEL    5816--GOTO     5825--GOTO
DOIOQ
      5628**DCL      5792<<ASSIGN   6102>>IF       6169<<ASSIGN
FM$CON.GACTB
      5608**DCL      5959>>ASSIGN   6025>>ASSIGN
FM$CON.GX
      5608**DCL      5832>>ASSIGN   5953>>ASSIGN   6017>>ASSIGN
FM$GRAN.AVAIL
      5587**DCL      5791>>ASSIGN
FM$GRAN.NAVX
      5586**DCL      5790>>ASSIGN
FM$GRAN.STAMP
      5586**DCL      5805>>ASSIGN   5812>>IF
FO$SBUF.FERR.AVAIL
      5619**DCL      5824<<ASSIGN
FO$SBUF.FERR.BLK#
      5618**DCL      5804<<ASSIGN
FO$SBUF.FERR.CODE
      5618**DCL      5802<<ASSIGN   5814<<ASSIGN   5822<<ASSIGN
FO$SBUF.FERR.EXPSTAMP
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:222  
      5618**DCL      5815<<ASSIGN
FO$SBUF.FERR.NAVX
      5618**DCL      5823<<ASSIGN
FO$SBUF.FERR.STAMP
      5619**DCL      5805<<ASSIGN
FO$SYMB
      5495**DCL      5806<>CALL     5886<>CALL     6060<>CALL     6064<>CALL     6080<>CALL     6096<>CALL
FO$SYMB.BR.BLK#
      5496**DCL      5497--REDEF    5804>>ASSIGN
FO$SYMB.BR.REC#
      5497**DCL      5498--REDEF    5868>>ASSIGN   5934>>ASSIGN   6063<<ASSIGN
FO$SYMB.BUF$
      5495**DCL      5496--REDEF
FO$SYMB.CPVFC
      5510**DCL      5972>>IF       6037>>IF
FO$SYMB.CUREXT
      5498**DCL      5883<<ASSIGN
FO$SYMB.CUREXT.DAD
      5499**DCL      5875<<ASSIGN   5875>>ASSIGN   5878<<ASSIGN   5878>>ASSIGN   5885>>IF
FO$SYMB.CUREXT.NGRAN
      5498**DCL      5871<<ASSIGN   5871>>ASSIGN   5872>>IF       5885>>IF
FO$SYMB.CUREXT.STAMP
      5499**DCL      5500--REDEF    5812>>IF       5815>>ASSIGN
FO$SYMB.DEVLDCTX
      5503**DCL      5794>>ASSIGN   6146>>ASSIGN
FO$SYMB.FIRSTSPACE
      5509**DCL      5972>>IF       5983<<ASSIGN   6037>>IF       6050<<ASSIGN
FO$SYMB.NXTEXT
      5500**DCL      5883>>ASSIGN   5884<<ASSIGN
FO$SYMB.PAGES
      5507**DCL      5972>>IF       5972>>IF       6037>>IF       6037>>IF
FO$SYMB.RCTZERO
      5506**DCL      5841<<ASSIGN   5862<<ASSIGN   6074>>ASSIGN   6075<<ASSIGN   6168<<ASSIGN
FO$SYMB.SPACEBLKS
      5504**DCL      5946<<ASSIGN   5946>>ASSIGN   5947>>IF       5988>>IF       6010<<ASSIGN   6010>>ASSIGN
      6011>>IF       6054>>IF
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:223  
FO$SYMB.SPACEPAGES
      5503**DCL      5504--REDEF    5874>>IF       5935>>IF       5980<<ASSIGN   5980>>ASSIGN   5981>>IF
      6047<<ASSIGN   6047>>ASSIGN   6048>>IF
FO$SYMB.SPACEREC#
      5504**DCL      5988>>IF       6054>>IF
FO$SYMB.SPACETYPE
      5507**DCL      5944>>IF       5970>>IF       6006>>IF       6035>>IF
FO$SYMB.SPACING
      5506**DCL      5849>>IF       5874>>IF       5932>>IF
FO$SYMB.TAB$
      5495**DCL      5793>>ASSIGN
FO$SYMB.XMTABS
      5509**DCL      5849>>IF       5967<<ASSIGN   6032<<ASSIGN
FO$SYMB.XMVFU
      5510**DCL      5829>>IF
FO$TABS.TABS
      5583**DCL      5583--REDEF    5853--ASSIGN   5856--ASSIGN   5965<<ASSIGN   6030<<ASSIGN
FO$TABS.TABSR
      5583**DCL      5958<<ASSIGN   6024<<ASSIGN
FOG$ADD
      5718**DCL-ENT  6160--CALL     6166--CALL
FOG$BLD
      5719**DCL-ENT  5839--CALL     5858--CALL
FOG$GRAN
      5720**DCL-ENT  6152--CALL
FOM$DEBLOCK
      5727**DCL-ENT  6082--CALL
FOM$DEVEA
      5721**DCL-ENT  6094--ASSIGN
FOM$EVENT
      5722**DCL-ENT  5806--CALL     6064--CALL     6080--CALL     6096--CALL
FOM$SNXDISK
      5723**DCL-ENT  6060--CALL
FOM$TELLAU
      5724**DCL-ENT  5886--CALL
FOSE_FSPA
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:224  
      2499**DCL      6064<>CALL
FOSE_HLTR
      2454**DCL      5806<>CALL
FOSE_LDIO
      2349**DCL      6096<>CALL
FOSE_RDII
      2364**DCL      6080<>CALL
FO_GPARM
      5661**DCL      5839<>CALL     5858<>CALL     6152<>CALL     6160<>CALL     6166<>CALL
FO_GPARM.BUF$
      5662**DCL      5833<<ASSIGN   5852<<ASSIGN   6151<<ASSIGN
FO_GPARM.DVBYTE
      5666**DCL      5838<<ASSIGN   5857<<ASSIGN   6153<<ASSIGN
FO_GPARM.REC$
      5663**DCL      5834<<ASSIGN   5853<<ASSIGN   6157<<ASSIGN   6164<<ASSIGN
FO_GPARM.RECL
      5667**DCL      5837<<ASSIGN   5856<<ASSIGN   6159<<ASSIGN   6163<<ASSIGN
FO_GPARM.REPEATS
      5668**DCL      5836<<ASSIGN   5855<<ASSIGN   6156<<ASSIGN   6162<<ASSIGN
FO_GPARM.VFC
      5664**DCL      5665--REDEF    5835<<ASSIGN
FO_GPARM.VFCR
      5665**DCL      5854<<ASSIGN   6158<<ASSIGN   6165<<ASSIGN
FS$SOFT_VFU
      5517**DCL      5837--ASSIGN
GOTPAGE
      6063**LABEL    5947--GOTO     5981--GOTO     5989--GOTO     6011--GOTO     6048--GOTO     6055--GOTO
GOWRITE
      6165**LABEL    6150--CALLALT
GRAN$
      5635**DCL      5789<<ASSIGN   5790>>ASSIGN   5791>>ASSIGN   5802>>ASSIGN   5804>>ASSIGN   5805>>ASSIGN
      5805>>ASSIGN   5812>>IF       5814>>ASSIGN   5815>>ASSIGN   5822>>ASSIGN   5823>>ASSIGN   5824>>ASSIGN
      5832>>ASSIGN   5832>>ASSIGN   5833>>ASSIGN   5852>>ASSIGN   5953>>ASSIGN   5953>>ASSIGN   5959>>ASSIGN
      6017>>ASSIGN   6017>>ASSIGN   6025>>ASSIGN   6147<<ASSIGN   6151>>ASSIGN
HFF$NILERASE
      5726**DCL-ENT  6150--CALL
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:225  
K_RWPARM_CON.BLKREC
      5146**DCL      5171--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      5147**DCL      5149--REDEF
K_RWPARM_CON.BLKREC.RECU#
      5159**DCL      5161--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      5186**DCL      5187--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      5194**DCL      5198--REDEF
K_RWPARM_CON.ERR
      5258**DCL      5263--REDEF
K_RWPARM_CON.FC
      5222**DCL      5223--REDEF
K_RWPARM_CON.FLDID
      5404**DCL      5405--REDEF
K_RWPARM_CON.FPT$
      5285**DCL      5292--REDEF
K_RWPARM_CON.KEYTYPE
      5411**DCL      5412--REDEF
K_RWPARM_CON.MSG$
      5121**DCL      5127--REDEF
K_RWPARM_CON.MSGID
      5233**DCL      5238--REDEF
K_RWPARM_CON.MSGIDXT
      5246**DCL      5250--REDEF
K_RWPARM_CON.ORG
      5382**DCL      5383--REDEF
K_RWPARM_CON.THDRSZ
      5326**DCL      5330--REDEF
K_RWPARM_CON.VDOFLGS
      5384**DCL      5395--REDEF
LDCT$
      5633**DCL      5794<<ASSIGN   6077>>IF       6082>>CALL     6091>>ASSIGN   6146<<ASSIGN
N$DCT$$
      2594**DCL      2594--IMP-PTR  5794>>ASSIGN   6146>>ASSIGN
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:226  
N$REQ
      5430**DCL         8--PROC     6102<>CALL     6127--ENTRY
N$REQ.BUF$
      5439**DCL      5789>>ASSIGN   6147>>ASSIGN
N$REQ.BUFADDR
      5439**DCL      5440--REDEF    5440--REDEF
N$REQ.COMP
      5464**DCL      6093<<ASSIGN
N$REQ.DLA.DCTX
      5430**DCL      6091<<ASSIGN
N$REQ.DLA.DRELADDR
      5431**DCL      5431--REDEF
N$REQ.DVE.EOMCHAR
      5468**DCL      5469--REDEF
N$REQ.EAENTRY
      5461**DCL      6094<<ASSIGN
N$REQ.EAINFO
      5462**DCL      5462--REDEF
N$REQ.EAINFOP$
      5462**DCL      5788>>ASSIGN   6145>>ASSIGN
N$REQ.EAINFOX
      5462**DCL      5463--REDEF    6101<<ASSIGN
N$REQ.EVNTINFO
      5463**DCL      5463--REDEF
N$REQ.FC
      5433**DCL      6092<<ASSIGN
N$REQ.OPFLG
      5436**DCL      6095<<ASSIGN
N$REQ.OPFLG.REQ
      5438**DCL      6103<<ASSIGN
N$REQ.RCT
      5465**DCL      6098<<ASSIGN   6100<<ASSIGN
N$REQ.STATUS
      5444**DCL      5450--REDEF
N$REQ.TYC
      5452**DCL      5799>>IF
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:227  
NAVX
      5638**DCL      5790<<ASSIGN   5820>>IF       5823>>ASSIGN   5888>>IF       5941>>IF       5997>>IF
      5999>>ASSIGN
NIO$QUE
      5728**DCL-ENT  6102--CALL
NK$LDCT
      5549**DCL      6082<>CALL
NK$LDCT.DDT$
      5551**DCL      5551--REDEF
NK$LDCT.DFLG.LOCAL
      5555**DCL      6077>>IF
NK$LDCT.IOQ$
      5550**DCL      5551--REDEF
NK$LDCT.LDCTX
      5552**DCL      5552--REDEF
NK$LDCT.LKFLG.ABORTED
      5564**DCL      5565--REDEF
NK$LDCT.RLCID.LDCTX
      5574**DCL      5574--REDEF    6091>>ASSIGN
NK$LDCT.STA$
      5570**DCL      5571--REDEF
NK$LDCT.SYMB$
      5549**DCL      5549--REDEF    5549--REDEF    5550--REDEF
NK$LDCT$
      2594**DCL      5794>>ASSIGN   6146>>ASSIGN
NK$VFC.COUNT
      5604**DCL      5956>>IF       6022>>IF
NK$VFC.FCN
      5604**DCL      5954>>ASSIGN   6019>>ASSIGN
NXTGRAN
      6060**LABEL    5888--GOTO     5949--GOTO     6015--GOTO
RCT
      5640**DCL      5641--REDEF    5868<<ASSIGN   6100>>ASSIGN
RCTZERO
      5645**DCL      6074<<ASSIGN   6098>>IF
REC#
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:228  
      5636**DCL      5934<<ASSIGN   5938>>IF       5938<<ASSIGN   5939>>ASSIGN   5988>>IF       5991<<ASSIGN
      5991>>ASSIGN   5996>>ASSIGN   6001<<ASSIGN   6003>>IF       6054>>IF       6057<<ASSIGN   6057>>ASSIGN
      6063>>ASSIGN
REC$
      5631**DCL      5832<<ASSIGN   5834>>ASSIGN   5953<<ASSIGN   5954>>ASSIGN   5956>>IF       5965>>ASSIGN
      6017<<ASSIGN   6019>>ASSIGN   6022>>IF       6030>>ASSIGN
RECL
      5627**DCL      5611--IMP-SIZ  5613--IMP-SIZ  5959<<ASSIGN   5960>>IF       5964<<ASSIGN   5964>>ASSIGN
      5965>>ASSIGN   6025<<ASSIGN   6027>>IF       6029<<ASSIGN   6029>>ASSIGN   6030>>ASSIGN
RECX
      5637**DCL      5939<<ASSIGN   5941>>IF       5953>>ASSIGN   5959>>ASSIGN   5996<<ASSIGN   5997>>IF
      5999<<ASSIGN   6001>>ASSIGN   6017>>ASSIGN   6025>>ASSIGN
RTN
      6084**LABEL    6080--CALLALT  6096--CALLALT
SYMB$
      5626**DCL      5788<<ASSIGN   5793>>ASSIGN   5794>>ASSIGN   5804>>ASSIGN   5806>>CALL     5812>>IF
      5815>>ASSIGN   5829>>IF       5841>>ASSIGN   5849>>IF       5849>>IF       5862>>ASSIGN   5868>>ASSIGN
      5871>>ASSIGN   5871>>ASSIGN   5872>>IF       5874>>IF       5874>>IF       5875>>ASSIGN   5875>>ASSIGN
      5878>>ASSIGN   5878>>ASSIGN   5883>>ASSIGN   5883>>ASSIGN   5884>>ASSIGN   5885>>IF       5885>>IF
      5886>>CALL     5932>>IF       5934>>ASSIGN   5935>>IF       5944>>IF       5946>>ASSIGN   5946>>ASSIGN
      5947>>IF       5967>>ASSIGN   5970>>IF       5972>>IF       5972>>IF       5972>>IF       5972>>IF
      5980>>ASSIGN   5980>>ASSIGN   5981>>IF       5983>>ASSIGN   5988>>IF       5988>>IF       6006>>IF
      6010>>ASSIGN   6010>>ASSIGN   6011>>IF       6032>>ASSIGN   6035>>IF       6037>>IF       6037>>IF
      6037>>IF       6037>>IF       6047>>ASSIGN   6047>>ASSIGN   6048>>IF       6050>>ASSIGN   6054>>IF
      6054>>IF       6060>>CALL     6063>>ASSIGN   6064>>CALL     6074>>ASSIGN   6075>>ASSIGN   6080>>CALL
      6096>>CALL     6145<<ASSIGN   6146>>ASSIGN   6168>>ASSIGN
TAB$
      5632**DCL      5793<<ASSIGN   5853>>ASSIGN   5958>>ASSIGN   5965>>ASSIGN   6024>>ASSIGN   6030>>ASSIGN
TABVFC
      5686**DCL      5854>>ASSIGN
TOFVFC
      5704**DCL      6158>>ASSIGN
VFCFCN
      5629**DCL      5954<<ASSIGN   5956>>IF       5972>>IF       5972>>IF       6019<<ASSIGN   6022>>IF
      6037>>IF       6037>>IF
VLP$WRITE.REC
PL6.E3A0      #004=FOM$DISKEA File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:09 Page:229  
      5615**DCL      6164--ASSIGN
VLP$WRITE.RECL
      5615**DCL      6163>>ASSIGN
VLP$WRITE.REPEATS
      5615**DCL      6162>>ASSIGN
VLP$WRITE.TOF
      5615**DCL      6154>>IF

PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:230  
     1716        1        /*T***********************************************************/
     1717        2        /*T*                                                         */
     1718        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1719        4        /*T*                                                         */
     1720        5        /*T***********************************************************/
     1721        6        /**/
     1722        7        /**/
     1723        8        FOM$DEVEA: PROC (N$REQ);
     1724        9        /**/
     1725       10        /**/
     1726       11        /*F* NAME:         FOM$DEVEA
     1727       12             PURPOSE:      Device I/O end action for MOOS
     1728       13             DESCRIPTION:  Come here as end action for local device I/O,
     1729       14                           to propagate MOOS.
     1730       15
     1731       16
     1732       17                           Note that this routine is entered as end-action
     1733       18                           (either from disk or device I/O) and thus can
     1734       19                           queue more I/O just by setting the re-queue bit
     1735       20                           in the request packet.  Thus all disk and local
     1736       21                           device I/O (until we have to stop for some
     1737       22                           reason) is done from a single external call to
     1738       23                           IOQ.                                    */
     1739       24        /**/
     1740       25        /*  INCLUDES */
     1741       26        /**/
     1742       27        %INCLUDE FOM$STRUCT;
     1743       88        %INCLUDE N$REQ;
     1744      162        %INCLUDE FOM_SUBS_C;
     1745      225        %INCLUDE FOM_DATA_R;
     1746      474        %INCLUDE KC_SUBS_C;
     1747      490        %INCLUDE KC_CP6;
     1748     1050
     1749     1051
     1750     1052        /**/
     1751     1053        /* PARAMETERS */
     1752     1054        /**/
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:231  
     1753     1055        %N$REQ (STCLASS="");
     1754     1113
     1755     1114
     1756     1115        /**/
     1757     1116        /* BASED STRUCTURES */
     1758     1117        /**/
     1759     1118        %FOM$SYMB;
     1760     1150
     1761     1151
     1762     1152        /**/
     1763     1153        /* AUTO */
     1764     1154        /**/
     1765     1155    1   DCL SYMB$ PTR;
     1766     1156
     1767     1157
     1768     1158        /**/
     1769     1159        /*  REFS */
     1770     1160        /**/
     1771     1161    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     1772     1162    1   DCL FOM$NXDISK         ENTRY(1) ALTRET;
     1773     1163    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
     1774     1164
     1775     1165
     1776     1166        /**/
     1777     1167        /* SUBS */
     1778     1168        /**/
     1779     1169        %EQU_CG;
     1780     1217        /**/
     1781     1218        /**/
     1782     1219    1         SYMB$=N$REQ.EAINFOP$;
     1783     1220                                                     /**/
     1784     1221                                      /* If we just wrote a tab granule or
     1785     1222                                         VFU granule, don't update REC# */
     1786     1223                                                     /**/
     1787     1224    1         IF NOT SYMB$ -> FO$SYMB.XMTABS
     1788     1225    1         AND NOT SYMB$ -> FO$SYMB.XMVFU
     1789     1226    1         THEN
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:232  
     1790     1227    2           DO;
     1791     1228    2           SYMB$ -> FO$SYMB.BR.REC# = N$REQ.ARCT;
     1792     1229    2           END;
     1793     1230                                                     /**/
     1794     1231    1         IF (N$REQ.TYC&'377777777777'O) THEN
     1795     1232    2           DO;
     1796     1233    2           SYMB$->FO$SYMB.TOKEN='0'B;
     1797     1234    2           SYMB$->FO$SYMB.ACK='0'B;
     1798     1235    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_HLTR,FOHR_TERR#);
     1799     1236    2           RETURN;
     1800     1237    2           END;
     1801     1238    1         IF SYMB$->FO$SYMB.TOKEN THEN
     1802     1239    2           DO;
     1803     1240                                /* ON COMPLETION OF SPECIAL WRITE FUNCTION,
     1804     1241                                   SEND TOKEN TO OUTSYM */
     1805     1242    2           SYMB$->FO$SYMB.TOKEN='0'B;
     1806     1243    2           CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STOKN#,0);
     1807     1244    2           END;
     1808     1245    1         IF SYMB$->FO$SYMB.ACK THEN
     1809     1246    2           DO;
     1810     1247                                /* ON COMPLETION OF SPECIAL WRITE FUNCTION,
     1811     1248                                   SEND ACK TO OUTSYM */
     1812     1249    2           SYMB$->FO$SYMB.ACK='0'B;
     1813     1250    2           CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STACK#,0);
     1814     1251    2           END;
     1815     1252    1         CALL FOM$NXDISK (SYMB$->FO$SYMB);
     1816     1253    1         RETURN;
     1817     1254        /**/
     1818     1255        /**/
     1819     1256    1   END FOM$DEVEA;
     1820     1257        /**/
     1821     1258        /**/
     1822     1259        %EOD;

PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:233  
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$DEVEA.

   Procedure FOM$DEVEA requires 64 words for executable code.
   Procedure FOM$DEVEA requires 10 words of local(AUTO) storage.

PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:234  

 Object Unit name= FOM$DEVEA                                  File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:10:20.56 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    64    100  FOM$DEVEA
    1  RoData even  none     9     11  FOM$DEVEA

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  FOM$DEVEA

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 FOM$EVENT
 yes     yes           Std       3 FOM$TELLAU
 yes     yes           Std       1 FOM$NXDISK
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    FOSE_HLTR                             B_VECTNIL
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:235  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:236  


     1716        1        /*T***********************************************************/
     1717        2        /*T*                                                         */
     1718        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1719        4        /*T*                                                         */
     1720        5        /*T***********************************************************/
     1721        6        /**/
     1722        7        /**/
     1723        8        FOM$DEVEA: PROC (N$REQ);

      8  0 000000   000000 700200 xent  FOM$DEVEA    TSX0  ! X66_AUTO_1
         0 000001   000012 000001                    ZERO    10,1

     1724        9        /**/
     1725       10        /**/
     1726       11        /*F* NAME:         FOM$DEVEA
     1727       12             PURPOSE:      Device I/O end action for MOOS
     1728       13             DESCRIPTION:  Come here as end action for local device I/O,
     1729       14                           to propagate MOOS.
     1730       15
     1731       16
     1732       17                           Note that this routine is entered as end-action
     1733       18                           (either from disk or device I/O) and thus can
     1734       19                           queue more I/O just by setting the re-queue bit
     1735       20                           in the request packet.  Thus all disk and local
     1736       21                           device I/O (until we have to stop for some
     1737       22                           reason) is done from a single external call to
     1738       23                           IOQ.                                    */
     1739       24        /**/
     1740       25        /*  INCLUDES */
     1741       26        /**/
     1742       27        %INCLUDE FOM$STRUCT;
     1743       88        %INCLUDE N$REQ;
     1744      162        %INCLUDE FOM_SUBS_C;
     1745      225        %INCLUDE FOM_DATA_R;
     1746      474        %INCLUDE KC_SUBS_C;
     1747      490        %INCLUDE KC_CP6;
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:237  
     1748     1050
     1749     1051
     1750     1052        /**/
     1751     1053        /* PARAMETERS */
     1752     1054        /**/
     1753     1055        %N$REQ (STCLASS="");
     1754     1113
     1755     1114
     1756     1115        /**/
     1757     1116        /* BASED STRUCTURES */
     1758     1117        /**/
     1759     1118        %FOM$SYMB;
     1760     1150
     1761     1151
     1762     1152        /**/
     1763     1153        /* AUTO */
     1764     1154        /**/
     1765     1155    1   DCL SYMB$ PTR;
     1766     1156
     1767     1157
     1768     1158        /**/
     1769     1159        /*  REFS */
     1770     1160        /**/
     1771     1161    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     1772     1162    1   DCL FOM$NXDISK         ENTRY(1) ALTRET;
     1773     1163    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
     1774     1164
     1775     1165
     1776     1166        /**/
     1777     1167        /* SUBS */
     1778     1168        /**/
     1779     1169        %EQU_CG;
     1780     1217        /**/
     1781     1218        /**/
     1782     1219    1         SYMB$=N$REQ.EAINFOP$;

   1219  0 000002   200003 470500                    LDP0    @N$REQ,,AUTO
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:238  
         0 000003   000024 236100                    LDQ     20,,PR0
         0 000004   200004 756100                    STQ     SYMB$,,AUTO

     1783     1220                                                     /**/
     1784     1221                                      /* If we just wrote a tab granule or
     1785     1222                                         VFU granule, don't update REC# */
     1786     1223                                                     /**/
     1787     1224    1         IF NOT SYMB$ -> FO$SYMB.XMTABS

   1224  0 000005   200004 471500                    LDP1    SYMB$,,AUTO
         0 000006   100012 236100                    LDQ     10,,PR1
         0 000007   000100 316007                    CANQ    64,DL
         0 000010   000015 601000 0                  TNZ     s:1231
         0 000011   000020 316007                    CANQ    16,DL
         0 000012   000015 601000 0                  TNZ     s:1231

     1788     1225    1         AND NOT SYMB$ -> FO$SYMB.XMVFU
     1789     1226    1         THEN
     1790     1227    2           DO;

     1791     1228    2           SYMB$ -> FO$SYMB.BR.REC# = N$REQ.ARCT;

   1228  0 000013   000030 220100                    LDX0    24,,PR0
         0 000014   100003 440100                    SXL0    3,,PR1

     1792     1229    2           END;

     1793     1230                                                     /**/
     1794     1231    1         IF (N$REQ.TYC&'377777777777'O) THEN

   1231  0 000015   000021 236100                    LDQ     17,,PR0
         0 000016   000031 376000 xsym               ANQ     B_VECTNIL+25
         0 000017   000036 600000 0                  TZE     s:1238

     1795     1232    2           DO;

     1796     1233    2           SYMB$->FO$SYMB.TOKEN='0'B;
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:239  

   1233  0 000020   000000 236000 1                  LDQ     0
         0 000021   100010 356100                    ANSQ    8,,PR1

     1797     1234    2           SYMB$->FO$SYMB.ACK='0'B;

   1234  0 000022   000001 236000 1                  LDQ     1
         0 000023   100010 356100                    ANSQ    8,,PR1

     1798     1235    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_HLTR,FOHR_TERR#);

   1235  0 000024   000002 236000 1                  LDQ     2
         0 000025   200010 756100                    STQ     SYMB$+4,,AUTO
         0 000026   000003 236000 1                  LDQ     3
         0 000027   200004 235100                    LDA     SYMB$,,AUTO
         0 000030   200006 757100                    STAQ    SYMB$+2,,AUTO
         0 000031   200006 630500                    EPPR0   SYMB$+2,,AUTO
         0 000032   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000033   000000 701000 xent               TSX1    FOM$EVENT
         0 000034   000000 011000                    NOP     0

     1799     1236    2           RETURN;

   1236  0 000035   000000 702200 xent               TSX2  ! X66_ARET

     1800     1237    2           END;
     1801     1238    1         IF SYMB$->FO$SYMB.TOKEN THEN

   1238  0 000036   100010 236100                    LDQ     8,,PR1
         0 000037   200000 316003                    CANQ    65536,DU
         0 000040   000054 600000 0                  TZE     s:1245

     1802     1239    2           DO;

     1803     1240                                /* ON COMPLETION OF SPECIAL WRITE FUNCTION,
     1804     1241                                   SEND TOKEN TO OUTSYM */
     1805     1242    2           SYMB$->FO$SYMB.TOKEN='0'B;
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:240  

   1242  0 000041   000000 236000 1                  LDQ     0
         0 000042   100010 356100                    ANSQ    8,,PR1

     1806     1243    2           CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STOKN#,0);

   1243  0 000043   000005 236000 1                  LDQ     5
         0 000044   200010 756100                    STQ     SYMB$+4,,AUTO
         0 000045   000006 236000 1                  LDQ     6
         0 000046   200004 235100                    LDA     SYMB$,,AUTO
         0 000047   200006 757100                    STAQ    SYMB$+2,,AUTO
         0 000050   200006 630500                    EPPR0   SYMB$+2,,AUTO
         0 000051   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000052   000000 701000 xent               TSX1    FOM$TELLAU
         0 000053   000000 011000                    NOP     0

     1807     1244    2           END;

     1808     1245    1         IF SYMB$->FO$SYMB.ACK THEN

   1245  0 000054   200004 470500                    LDP0    SYMB$,,AUTO
         0 000055   000010 236100                    LDQ     8,,PR0
         0 000056   100000 316003                    CANQ    32768,DU
         0 000057   000073 600000 0                  TZE     s:1252

     1809     1246    2           DO;

     1810     1247                                /* ON COMPLETION OF SPECIAL WRITE FUNCTION,
     1811     1248                                   SEND ACK TO OUTSYM */
     1812     1249    2           SYMB$->FO$SYMB.ACK='0'B;

   1249  0 000060   000001 236000 1                  LDQ     1
         0 000061   000010 356100                    ANSQ    8,,PR0

     1813     1250    2           CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STACK#,0);

   1250  0 000062   000005 236000 1                  LDQ     5
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:241  
         0 000063   200010 756100                    STQ     SYMB$+4,,AUTO
         0 000064   000010 236000 1                  LDQ     8
         0 000065   200004 235100                    LDA     SYMB$,,AUTO
         0 000066   200006 757100                    STAQ    SYMB$+2,,AUTO
         0 000067   200006 630500                    EPPR0   SYMB$+2,,AUTO
         0 000070   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000071   000000 701000 xent               TSX1    FOM$TELLAU
         0 000072   000000 011000                    NOP     0

     1814     1251    2           END;

     1815     1252    1         CALL FOM$NXDISK (SYMB$->FO$SYMB);

   1252  0 000073   200004 630500                    EPPR0   SYMB$,,AUTO
         0 000074   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000075   000000 701000 xent               TSX1    FOM$NXDISK
         0 000076   000000 011000                    NOP     0

     1816     1253    1         RETURN;

   1253  0 000077   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   577777 777777   677777 777777   000006 006000   000000 006000    ................
   1     004   000000 000020   000002 006000   000004 006000   000000 000021    ................
   1     010   000007 006000                                                    ....
     1817     1254        /**/
     1818     1255        /**/
     1819     1256    1   END FOM$DEVEA;
     1820     1257        /**/
     1821     1258        /**/
     1822     1259        %EOD;

PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:242  
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$DEVEA.
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:243  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @N$REQ                    *0-0-0/d STRC(1080)  r     1 N$REQ
     4-0-0/w PTR         r     1 SYMB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 FOSE_HLTR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(720)   r     1 FO$SYMB


   Procedure FOM$DEVEA requires 64 words for executable code.
   Procedure FOM$DEVEA requires 10 words of local(AUTO) storage.
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:244  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:245  
          MINI XREF LISTING

FO$SYMB
      1129**DCL      1235<>CALL     1243<>CALL     1250<>CALL     1252<>CALL
FO$SYMB.ACK
      1136**DCL      1234<<ASSIGN   1245>>IF       1249<<ASSIGN
FO$SYMB.BR.BLK#
      1130**DCL      1131--REDEF
FO$SYMB.BR.REC#
      1131**DCL      1132--REDEF    1228<<ASSIGN
FO$SYMB.BUF$
      1129**DCL      1130--REDEF
FO$SYMB.CUREXT.STAMP
      1133**DCL      1134--REDEF
FO$SYMB.SPACEPAGES
      1137**DCL      1138--REDEF
FO$SYMB.TOKEN
      1136**DCL      1233<<ASSIGN   1238>>IF       1242<<ASSIGN
FO$SYMB.XMTABS
      1143**DCL      1224>>IF
FO$SYMB.XMVFU
      1144**DCL      1224>>IF
FOM$EVENT
      1161**DCL-ENT  1235--CALL
FOM$NXDISK
      1162**DCL-ENT  1252--CALL
FOM$TELLAU
      1163**DCL-ENT  1243--CALL     1250--CALL
FOSE_HLTR
       410**DCL      1235<>CALL
N$REQ
      1064**DCL         8--PROC
N$REQ.ARCT
      1099**DCL      1228>>ASSIGN
PL6.E3A0      #005=FOM$DEVEA File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:246  
N$REQ.BUFADDR
      1073**DCL      1074--REDEF    1074--REDEF
N$REQ.DLA.DRELADDR
      1065**DCL      1065--REDEF
N$REQ.DVE.EOMCHAR
      1102**DCL      1103--REDEF
N$REQ.EAINFO
      1096**DCL      1096--REDEF
N$REQ.EAINFOP$
      1096**DCL      1219>>ASSIGN
N$REQ.EAINFOX
      1096**DCL      1097--REDEF
N$REQ.EVNTINFO
      1097**DCL      1097--REDEF
N$REQ.STATUS
      1078**DCL      1084--REDEF
N$REQ.TYC
      1086**DCL      1231>>IF
SYMB$
      1155**DCL      1219<<ASSIGN   1224>>IF       1224>>IF       1228>>ASSIGN   1233>>ASSIGN   1234>>ASSIGN
      1235>>CALL     1238>>IF       1242>>ASSIGN   1243>>CALL     1245>>IF       1249>>ASSIGN   1250>>CALL
      1252>>CALL

PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:247  
     1823        1        /*T***********************************************************/
     1824        2        /*T*                                                         */
     1825        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1826        4        /*T*                                                         */
     1827        5        /*T***********************************************************/
     1828        6        /**/
     1829        7        /**/
     1830        8        FOM$SYMBIN: PROC (NK$LDCT,K$RWPARM,FCN) ALTRET;
     1831        9        /**/
     1832       10        /**/
     1833       11        /*F* NAME:         FOM$SYMBIN
     1834       12             PURPOSE:      To provide an entry to MOOS from the monitor for
     1835       13                           notifying him of external events.
     1836       14
     1837       15            DESCRIPTION:   FOM$SYMBIN   is called for the following reasons:
     1838       16
     1839       17                           1) An LDCT is marked symbiont and its associated
     1840       18                              FEP went down
     1841       19
     1842       20                           2) A message for an output symbiont LDCT was found
     1843       21                              in an FEP input queue.
     1844       22
     1845       23                           */
     1846       24        /**/
     1847       25        /*  INCLUDES */
     1848       26        /**/
     1849       27        /**/
     1850       28        %INCLUDE FOM$STRUCT;
     1851       89        %INCLUDE NK$LDCT;
     1852      191        %INCLUDE KV$VDO;
     1853     1206        %INCLUDE K_DATA_R;
     1854     1917        %INCLUDE JG_GHOSTS_C;
     1855     2007        %INCLUDE FOM_SUBS_C;
     1856     2070        %INCLUDE KC_SUBS_C;
     1857     2086        %INCLUDE FOM_DATA_R;
     1858     2335        %INCLUDE KC_CP6;
     1859     2895
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:248  
     1860     2896
     1861     2897        /**/
     1862     2898        /* PARAMETERS */
     1863     2899        /**/
     1864     2900        %NK$LDCT (STCLASS="");
     1865     2946        %K$RWPARM (NAME=K$RWPARM);
     1866     3262    1   DCL FCN UBIN;
     1867     3263
     1868     3264
     1869     3265        /* Equates */
     1870     3266        %KV_VDO_ALL_E;
     1871     3345
     1872     3346
     1873     3347        /**/
     1874     3348        /* BASED STRUCTURES */
     1875     3349        /**/
     1876     3350        %FOM$SYMB (NAME=FO$SYMB);
     1877     3382
     1878     3383        /* Constant */
     1879     3384    1   DCL OUTSYM_USR UBIN BYTE CONSTANT INIT(JG_OUTSYM#);
     1880     3385
     1881     3386
     1882     3387        /**/
     1883     3388        /* AUTO */
     1884     3389        /**/
     1885     3390    1   DCL SYMB$ PTR;
     1886     3391    1   DCL TSTATE UBIN WORD;
     1887     3392    1   DCL 1 BR ALIGNED,
     1888     3393    1         2 BT UBIN(10) UNAL,
     1889     3394    1         2 BB UBIN(8) UNAL,
     1890     3395    1         2 RT UBIN(10) UNAL,
     1891     3396    1         2 RB UBIN(8) UNAL;
     1892     3397
     1893     3398
     1894     3399        /**/
     1895     3400        /*  REFS */
     1896     3401        /**/
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:249  
     1897     3402    1   DCL SC_BADSYMBINFCN ENTRY CONV(2,0);
     1898     3403    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     1899     3404    1   DCL FOM$RNXDISK        ENTRY(1) ALTRET;
     1900     3405    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
     1901     3406    1   DCL FOM$DEBEV ENTRY(1) ALTRET;
     1902     3407    1   DCL SSV$EVENT ENTRY(7);
     1903     3408
     1904     3409
     1905     3410        /**/
     1906     3411        /* SUBS */
     1907     3412        /**/
     1908     3413        %EQU_CG;
     1909     3461        /**/
     1910     3462        /**/
     1911     3463                                /* IF WE DON'T LIKE THE MESSAGE, ALTRET.
     1912     3464                                   THIS WILL RE-BOOT THE FEP */
     1913     3465
     1914     3466    1         IF NK$LDCT.DFLG.SYMBIONT='0'B THEN
     1915     3467    2           DO CASE (FCN);
     1916     3468    2             CASE (FOMI_FNC_MRK#,FOMI_FNC_RQSDAT#);
     1917     3469    2               RETURN;
     1918     3470    2             CASE (ELSE);
     1919     3471    2               CALL SC_BADSYMBINFCN;
     1920     3472    2           END;
     1921     3473    1         SYMB$=NK$LDCT.SYMB$;
     1922     3474                                /* NO MESSAGE MEANS FEP DOWN */
     1923     3475                                /* GOT MESSAGE */
     1924     3476
     1925     3477    2           DO CASE (FCN);
     1926     3478        /**
     1927     3479         **
     1928     3480         **
     1929     3481         **      SYMBIONT TERMINAL HELD (RESPONSE FROM HOLD REQUEST,
     1930     3482         **                              OR UNILATERAL HOLD FROM HANDLER )
     1931     3483         **
     1932     3484         **
     1933     3485         **/
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:250  
     1934     3486        /*
     1935     3487           KV_VDO_FNC_MRK = Virtual Device Operation Function Mark
     1936     3488           KV_VDOMRKTYP_LSTRCRID = Last Rec ID (BLK#-REC# of the last rec sent)
     1937     3489        */
     1938     3490
     1939     3491    2             CASE (FOMI_FNC_MRK#);
     1940     3492    2               IF SYMB$->FO$SYMB.EFLGB.IDSC THEN RETURN;
     1941     3493    2               IF K$RWPARM.MRKTYP = %KV_VDOMRKTYP_LSTRCRID
     1942     3494    3               THEN DO;
     1943     3495
     1944     3496
     1945     3497    3                 IF SYMB$->FO$SYMB.SPACING
     1946     3498    3                 OR SYMB$->FO$SYMB.EFLGB.SHTD
     1947     3499    3                 OR SYMB$->FO$SYMB.STATE=FOMS_HELD#
     1948     3500    3                 THEN ALTRETURN;
     1949     3501    3                 BR = K$RWPARM.BLKREC; /* PICK UP BLKREC FROM IP MESSAGE */
     1950     3502    3                 CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_SHTD,BR);
     1951     3503    3                 END;
     1952     3504    2               ELSE
     1953     3505    2                CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STOKN#,0);
     1954     3506        /**
     1955     3507         **
     1956     3508        **
     1957     3509         **  RQSDAT
     1958     3510         **
     1959     3511         **
     1960     3512         **/
     1961     3513        /*
     1962     3514          This is the means by which the network nodes request more data from
     1963     3515        MOOS (throddling).  Here we are running on behalf of the monitor, so
     1964     3516        we'll wait until the user OUTSYM is scheduled to run and event MOOS
     1965     3517        at FOM$DEBEV.  Since we saved the last BLK#-REC# when we altreturned
     1966     3518        from KIA$WRITE in FOM$DEBLOCK (this altreturn means the network node
     1967     3519        cannot currently handle any more symbiont data), we can easily
     1968     3520        continue where we left off in the current block.
     1969     3521        */
     1970     3522
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:251  
     1971     3523    2             CASE (FOMI_FNC_RQSDAT#);
     1972     3524    2               IF SYMB$ -> FO$SYMB.STATE ~= FOMS_DVIO#
     1973     3525    2               OR SYMB$ -> FO$SYMB.THROTTLING = '0'B
     1974     3526    2               THEN
     1975     3527    2                RETURN;
     1976     3528    2               SYMB$ -> FO$SYMB.THROTTLING = '0'B;
     1977     3529    2               CALL SSV$EVENT(OUTSYM_USR,7,0,ADDR(NK$LDCT),0,,ENTADDR(FOM$DEBEV));
     1978     3530    2               SYMB$->FO$SYMB.STATE = %FOMS_ACTV#;
     1979     3531        /**
     1980     3532         **
     1981     3533         **
     1982     3534         **      SYMBIONT TERMINAL DISCONNECT
     1983     3535         **
     1984     3536         **
     1985     3537         **/
     1986     3538
     1987     3539    2             CASE (FOMI_FNC_DSC_RQS#);
     1988     3540
     1989     3541
     1990     3542    2               BR = K$RWPARM.BLKREC;  /* PICK UP BLKREC FROM FEP IP MESSAGE */
     1991     3543    2   DISCONNECT: ;
     1992     3544    2               CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_IDSC,BR);
     1993     3545        /**
     1994     3546         **
     1995     3547         **
     1996     3548         **      FORMS PROGRAM ABORT
     1997     3549         **
     1998     3550         **
     1999     3551         **/
     2000     3552    2             CASE (FOMI_FNC_FPRG_ABORT#);
     2001     3553
     2002     3554    3                 DO INHIBIT;
     2003     3555    3                 IF SYMB$ -> FO$SYMB.FPABRT = '1'B
     2004     3556    3                 OR SYMB$ -> FO$SYMB.EFLGB.IDSC = '1'B
     2005     3557    3                 OR SYMB$ -> FO$SYMB.EFLGB.FDSC = '1'B
     2006     3558    3                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
     2007     3559    3                 THEN
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:252  
     2008     3560    3                  RETURN;
     2009     3561
     2010     3562    3                 SYMB$ -> FO$SYMB.FPABRT = '1'B;
     2011     3563    3                 CALL FOM$TELLAU (SYMB$ -> FO$SYMB,%CG_FPABORT#,0);
     2012     3564    3                 END;
     2013     3565        /**
     2014     3566         **
     2015     3567         **
     2016     3568         **      OTHER CASES
     2017     3569         **
     2018     3570         **
     2019     3571         **/
     2020     3572
     2021     3573    2             CASE (ELSE);
     2022     3574    2               CALL SC_BADSYMBINFCN;
     2023     3575
     2024     3576        /*S* SCREECH_CODE:      FOM-S$BADSYMBINFCN
     2025     3577             TYPE:         SNAP
     2026     3578             MESSAGE:           Bad FCN passed to FOM$SYMBIN
     2027     3579             REMARKS:           Input circular FEP queue management has
     2028     3580                                decided that this message belongs to
     2029     3581                                FOM$SYMBIN,   who does not know the function
     2030     3582                           code. */
     2031     3583
     2032     3584    2           END; /*CASE FCN*/
     2033     3585    1         RETURN;
     2034     3586        /**/
     2035     3587        /**/
     2036     3588    1   END FOM$SYMBIN;
     2037     3589        /**/
     2038     3590        /**/
     2039     3591        %EOD;

PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:253  
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$SYMBIN.

   Procedure FOM$SYMBIN requires 151 words for executable code.
   Procedure FOM$SYMBIN requires 20 words of local(AUTO) storage.

PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:254  

 Object Unit name= FOM$SYMBIN                                 File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:10:27.80 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  FOM$SYMBIN
    1   Proc  even  none   151    227  FOM$SYMBIN
    2  RoData even  none    11     13  FOM$SYMBIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  FOM$SYMBIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 FOM$EVENT
 yes     yes           Std       3 FOM$TELLAU
 yes     yes           Std       1 FOM$DEBEV
         yes           Std       7 SSV$EVENT
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:255  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BADSYMBINFCN                  r    FOSE_SHTD                        r    FOSE_IDSC
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:256  


     1823        1        /*T***********************************************************/
     1824        2        /*T*                                                         */
     1825        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1826        4        /*T*                                                         */
     1827        5        /*T***********************************************************/
     1828        6        /**/
     1829        7        /**/
     1830        8        FOM$SYMBIN: PROC (NK$LDCT,K$RWPARM,FCN) ALTRET;

      8  1 000000   000000 700200 xent  FOM$SYMBIN   TSX0  ! X66_AUTO_3
         1 000001   000024 000003                    ZERO    20,3

     1831        9        /**/
     1832       10        /**/
     1833       11        /*F* NAME:         FOM$SYMBIN
     1834       12             PURPOSE:      To provide an entry to MOOS from the monitor for
     1835       13                           notifying him of external events.
     1836       14
     1837       15            DESCRIPTION:   FOM$SYMBIN   is called for the following reasons:
     1838       16
     1839       17                           1) An LDCT is marked symbiont and its associated
     1840       18                              FEP went down
     1841       19
     1842       20                           2) A message for an output symbiont LDCT was found
     1843       21                              in an FEP input queue.
     1844       22
     1845       23                           */
     1846       24        /**/
     1847       25        /*  INCLUDES */
     1848       26        /**/
     1849       27        /**/
     1850       28        %INCLUDE FOM$STRUCT;
     1851       89        %INCLUDE NK$LDCT;
     1852      191        %INCLUDE KV$VDO;
     1853     1206        %INCLUDE K_DATA_R;
     1854     1917        %INCLUDE JG_GHOSTS_C;
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:257  
     1855     2007        %INCLUDE FOM_SUBS_C;
     1856     2070        %INCLUDE KC_SUBS_C;
     1857     2086        %INCLUDE FOM_DATA_R;
     1858     2335        %INCLUDE KC_CP6;
     1859     2895
     1860     2896
     1861     2897        /**/
     1862     2898        /* PARAMETERS */
     1863     2899        /**/
     1864     2900        %NK$LDCT (STCLASS="");
     1865     2946        %K$RWPARM (NAME=K$RWPARM);
     1866     3262    1   DCL FCN UBIN;
     1867     3263
     1868     3264
     1869     3265        /* Equates */
     1870     3266        %KV_VDO_ALL_E;
     1871     3345
     1872     3346
     1873     3347        /**/
     1874     3348        /* BASED STRUCTURES */
     1875     3349        /**/
     1876     3350        %FOM$SYMB (NAME=FO$SYMB);
     1877     3382
     1878     3383        /* Constant */
     1879     3384    1   DCL OUTSYM_USR UBIN BYTE CONSTANT INIT(JG_OUTSYM#);
     1880     3385
     1881     3386
     1882     3387        /**/
     1883     3388        /* AUTO */
     1884     3389        /**/
     1885     3390    1   DCL SYMB$ PTR;
     1886     3391    1   DCL TSTATE UBIN WORD;
     1887     3392    1   DCL 1 BR ALIGNED,
     1888     3393    1         2 BT UBIN(10) UNAL,
     1889     3394    1         2 BB UBIN(8) UNAL,
     1890     3395    1         2 RT UBIN(10) UNAL,
     1891     3396    1         2 RB UBIN(8) UNAL;
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:258  
     1892     3397
     1893     3398
     1894     3399        /**/
     1895     3400        /*  REFS */
     1896     3401        /**/
     1897     3402    1   DCL SC_BADSYMBINFCN ENTRY CONV(2,0);
     1898     3403    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     1899     3404    1   DCL FOM$RNXDISK        ENTRY(1) ALTRET;
     1900     3405    1   DCL FOM$TELLAU         ENTRY(3) ALTRET;
     1901     3406    1   DCL FOM$DEBEV ENTRY(1) ALTRET;
     1902     3407    1   DCL SSV$EVENT ENTRY(7);
     1903     3408
     1904     3409
     1905     3410        /**/
     1906     3411        /* SUBS */
     1907     3412        /**/
     1908     3413        %EQU_CG;
     1909     3461        /**/
     1910     3462        /**/
     1911     3463                                /* IF WE DON'T LIKE THE MESSAGE, ALTRET.
     1912     3464                                   THIS WILL RE-BOOT THE FEP */
     1913     3465
     1914     3466    1         IF NK$LDCT.DFLG.SYMBIONT='0'B THEN

   3466  1 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000003   000006 236100                    LDQ     6,,PR0
         1 000004   020000 316007                    CANQ    8192,DL
         1 000005   000021 601000 1                  TNZ     s:3473

     1915     3467    2           DO CASE (FCN);

   3467  1 000006   200005 471500                    LDP1    @FCN,,AUTO
         1 000007   100000 235100                    LDA     0,,PR1
         1 000010   000003 115007                    CMPA    3,DL
         1 000011   000013 602005 1                  TNC     s:3467+5,AL
         1 000012   000017 710000 1                  TRA     s:3471
         1 000013   000017 710000 1                  TRA     s:3471
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:259  
         1 000014   000016 710000 1                  TRA     s:3469
         1 000015   000016 710000 1                  TRA     s:3469

     1916     3468    2             CASE (FOMI_FNC_MRK#,FOMI_FNC_RQSDAT#);

     1917     3469    2               RETURN;

   3469  1 000016   000000 702200 xent               TSX2  ! X66_ARET

     1918     3470    2             CASE (ELSE);

     1919     3471    2               CALL SC_BADSYMBINFCN;

   3471  1 000017   000000 713400 xsym               CLIMB   SC_BADSYMBINFCN
         1 000020   000000 600000 xsid               climb   nvectors=         0

     1920     3472    2           END;

     1921     3473    1         SYMB$=NK$LDCT.SYMB$;

   3473  1 000021   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000022   000000 236100                    LDQ     0,,PR0
         1 000023   200006 756100                    STQ     SYMB$,,AUTO

     1922     3474                                /* NO MESSAGE MEANS FEP DOWN */
     1923     3475                                /* GOT MESSAGE */
     1924     3476
     1925     3477    2           DO CASE (FCN);

   3477  1 000024   200005 471500                    LDP1    @FCN,,AUTO
         1 000025   100000 235100                    LDA     0,,PR1
         1 000026   000005 115007                    CMPA    5,DL
         1 000027   000031 602005 1                  TNC     s:3477+5,AL
         1 000030   000224 710000 1                  TRA     s:3574
         1 000031   000224 710000 1                  TRA     s:3574
         1 000032   000036 710000 1                  TRA     s:3492
         1 000033   000110 710000 1                  TRA     s:3524
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:260  
         1 000034   000156 710000 1                  TRA     s:3542
         1 000035   000173 710000 1                  TRA     s:3555

     1926     3478        /**
     1927     3479         **
     1928     3480         **
     1929     3481         **      SYMBIONT TERMINAL HELD (RESPONSE FROM HOLD REQUEST,
     1930     3482         **                              OR UNILATERAL HOLD FROM HANDLER )
     1931     3483         **
     1932     3484         **
     1933     3485         **/
     1934     3486        /*
     1935     3487           KV_VDO_FNC_MRK = Virtual Device Operation Function Mark
     1936     3488           KV_VDOMRKTYP_LSTRCRID = Last Rec ID (BLK#-REC# of the last rec sent)
     1937     3489        */
     1938     3490
     1939     3491    2             CASE (FOMI_FNC_MRK#);

     1940     3492    2               IF SYMB$->FO$SYMB.EFLGB.IDSC THEN RETURN;

   3492  1 000036   200006 473500                    LDP3    SYMB$,,AUTO
         1 000037   300012 236100                    LDQ     10,,PR3
         1 000040   000400 316007                    CANQ    256,DL
         1 000041   000043 600000 1                  TZE     s:3493

   3492  1 000042   000000 702200 xent               TSX2  ! X66_ARET

     1941     3493    2               IF K$RWPARM.MRKTYP = %KV_VDOMRKTYP_LSTRCRID

   3493  1 000043   200004 474500                    LDP4    @K$RWPARM,,AUTO
         1 000044   400040 236100                    LDQ     32,,PR4
         1 000045   777000 376007                    ANQ     -512,DL
         1 000046   002000 116007                    CMPQ    1024,DL
         1 000047   000076 601000 1                  TNZ     s:3505

     1942     3494    3               THEN DO;

PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:261  
     1943     3495
     1944     3496
     1945     3497    3                 IF SYMB$->FO$SYMB.SPACING

   3497  1 000050   300012 236100                    LDQ     10,,PR3
         1 000051   040000 316007                    CANQ    16384,DL
         1 000052   000061 601000 1                  TNZ     s:3500
         1 000053   002000 316007                    CANQ    1024,DL
         1 000054   000061 601000 1                  TNZ     s:3500
         1 000055   300012 236100                    LDQ     10,,PR3
         1 000056   000017 376007                    ANQ     15,DL
         1 000057   000005 116007                    CMPQ    5,DL
         1 000060   000062 601000 1                  TNZ     s:3501

     1946     3498    3                 OR SYMB$->FO$SYMB.EFLGB.SHTD
     1947     3499    3                 OR SYMB$->FO$SYMB.STATE=FOMS_HELD#
     1948     3500    3                 THEN ALTRETURN;

   3500  1 000061   000000 702200 xent               TSX2  ! X66_AALT

     1949     3501    3                 BR = K$RWPARM.BLKREC; /* PICK UP BLKREC FROM IP MESSAGE */

   3501  1 000062   400007 236100                    LDQ     7,,PR4
         1 000063   200010 756100                    STQ     BR,,AUTO

     1950     3502    3                 CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_SHTD,BR);

   3502  1 000064   200010 635500                    EPPR5   BR,,AUTO
         1 000065   200014 455500                    STP5    BR+4,,AUTO
         1 000066   000000 236000 2                  LDQ     0
         1 000067   200006 235100                    LDA     SYMB$,,AUTO
         1 000070   200012 757100                    STAQ    BR+2,,AUTO
         1 000071   200012 630500                    EPPR0   BR+2,,AUTO
         1 000072   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000073   000000 701000 xent               TSX1    FOM$EVENT
         1 000074   000000 011000                    NOP     0

PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:262  
     1951     3503    3                 END;

   3503  1 000075   000226 710000 1                  TRA     s:3585

     1952     3504    2               ELSE
     1953     3505    2                CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STOKN#,0);

   3505  1 000076   000002 236000 2                  LDQ     2
         1 000077   200014 756100                    STQ     BR+4,,AUTO
         1 000100   000003 236000 2                  LDQ     3
         1 000101   200006 235100                    LDA     SYMB$,,AUTO
         1 000102   200012 757100                    STAQ    BR+2,,AUTO
         1 000103   200012 630500                    EPPR0   BR+2,,AUTO
         1 000104   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000105   000000 701000 xent               TSX1    FOM$TELLAU
         1 000106   000000 011000                    NOP     0
         1 000107   000226 710000 1                  TRA     s:3585

     1954     3506        /**
     1955     3507         **
     1956     3508        **
     1957     3509         **  RQSDAT
     1958     3510         **
     1959     3511         **
     1960     3512         **/
     1961     3513        /*
     1962     3514          This is the means by which the network nodes request more data from
     1963     3515        MOOS (throddling).  Here we are running on behalf of the monitor, so
     1964     3516        we'll wait until the user OUTSYM is scheduled to run and event MOOS
     1965     3517        at FOM$DEBEV.  Since we saved the last BLK#-REC# when we altreturned
     1966     3518        from KIA$WRITE in FOM$DEBLOCK (this altreturn means the network node
     1967     3519        cannot currently handle any more symbiont data), we can easily
     1968     3520        continue where we left off in the current block.
     1969     3521        */
     1970     3522
     1971     3523    2             CASE (FOMI_FNC_RQSDAT#);

PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:263  
     1972     3524    2               IF SYMB$ -> FO$SYMB.STATE ~= FOMS_DVIO#

   3524  1 000110   200006 473500                    LDP3    SYMB$,,AUTO
         1 000111   300012 236100                    LDQ     10,,PR3
         1 000112   000017 376007                    ANQ     15,DL
         1 000113   000003 116007                    CMPQ    3,DL
         1 000114   000117 601000 1                  TNZ     s:3527
         1 000115   300010 234100                    SZN     8,,PR3
         1 000116   000120 604000 1                  TMI     s:3528

     1973     3525    2               OR SYMB$ -> FO$SYMB.THROTTLING = '0'B
     1974     3526    2               THEN
     1975     3527    2                RETURN;

   3527  1 000117   000000 702200 xent               TSX2  ! X66_ARET

     1976     3528    2               SYMB$ -> FO$SYMB.THROTTLING = '0'B;

   3528  1 000120   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000121   300010 356100                    ANSQ    8,,PR3

     1977     3529    2               CALL SSV$EVENT(OUTSYM_USR,7,0,ADDR(NK$LDCT),0,,ENTADDR(FOM$DEBEV));

   3529  1 000122   000000 636000 xent               EAQ     FOM$DEBEV
         1 000123   200013 756100                    STQ     BR+3,,AUTO
         1 000124   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000125   200012 756100                    STQ     BR+2,,AUTO
         1 000126   200013 236100                    LDQ     BR+3,,AUTO
         1 000127   200014 756100                    STQ     BR+4,,AUTO
         1 000130   200014 634500                    EPPR4   BR+4,,AUTO
         1 000131   200023 454500                    STP4    BR+11,,AUTO
         1 000132   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000133   200022 756100                    STQ     BR+10,,AUTO
         1 000134   000002 236000 2                  LDQ     2
         1 000135   200021 756100                    STQ     BR+9,,AUTO
         1 000136   200012 635500                    EPPR5   BR+2,,AUTO
         1 000137   200020 455500                    STP5    BR+8,,AUTO
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:264  
         1 000140   000004 237000 2                  LDAQ    4
         1 000141   200016 757100                    STAQ    BR+6,,AUTO
         1 000142   000006 236000 2                  LDQ     6
         1 000143   200015 756100                    STQ     BR+5,,AUTO
         1 000144   200015 630500                    EPPR0   BR+5,,AUTO
         1 000145   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 000146   000000 701000 xent               TSX1    SSV$EVENT
         1 000147   000000 011000                    NOP     0

     1978     3530    2               SYMB$->FO$SYMB.STATE = %FOMS_ACTV#;

   3530  1 000150   200006 470500                    LDP0    SYMB$,,AUTO
         1 000151   000012 236100                    LDQ     10,,PR0
         1 000152   000007 376000 2                  ANQ     7
         1 000153   000006 276007                    ORQ     6,DL
         1 000154   000012 756100                    STQ     10,,PR0
         1 000155   000226 710000 1                  TRA     s:3585

     1979     3531        /**
     1980     3532         **
     1981     3533         **
     1982     3534         **      SYMBIONT TERMINAL DISCONNECT
     1983     3535         **
     1984     3536         **
     1985     3537         **/
     1986     3538
     1987     3539    2             CASE (FOMI_FNC_DSC_RQS#);

     1988     3540
     1989     3541
     1990     3542    2               BR = K$RWPARM.BLKREC;  /* PICK UP BLKREC FROM FEP IP MESSAGE */

   3542  1 000156   200004 473500                    LDP3    @K$RWPARM,,AUTO
         1 000157   300007 236100                    LDQ     7,,PR3
         1 000160   200010 756100                    STQ     BR,,AUTO

   3542  1 000161                       DISCONNECT   null
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:265  
     1991     3543    2   DISCONNECT: ;
     1992     3544    2               CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_IDSC,BR);

   3544  1 000161   200010 634500                    EPPR4   BR,,AUTO
         1 000162   200014 454500                    STP4    BR+4,,AUTO
         1 000163   000010 236000 2                  LDQ     8
         1 000164   200006 235100                    LDA     SYMB$,,AUTO
         1 000165   200012 757100                    STAQ    BR+2,,AUTO
         1 000166   200012 630500                    EPPR0   BR+2,,AUTO
         1 000167   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000170   000000 701000 xent               TSX1    FOM$EVENT
         1 000171   000000 011000                    NOP     0
         1 000172   000226 710000 1                  TRA     s:3585

     1993     3545        /**
     1994     3546         **
     1995     3547         **
     1996     3548         **      FORMS PROGRAM ABORT
     1997     3549         **
     1998     3550         **
     1999     3551         **/
     2000     3552    2             CASE (FOMI_FNC_FPRG_ABORT#);

     2001     3553
     2002     3554    3                 DO INHIBIT;

     2003     3555    3                 IF SYMB$ -> FO$SYMB.FPABRT = '1'B

   3555  1 000173   200006 473700                    LDP3  ! SYMB$,,AUTO
         1 000174   300021 430300                    FSZN  ! 17,,PR3
         1 000175   000207 604200 1                  TMI   ! s:3560
         1 000176   300012 236300                    LDQ   ! 10,,PR3
         1 000177   000400 316207                    CANQ  ! 256,DL
         1 000200   000207 601200 1                  TNZ   ! s:3560
         1 000201   001000 316207                    CANQ  ! 512,DL
         1 000202   000207 601200 1                  TNZ   ! s:3560
         1 000203   300012 236300                    LDQ   ! 10,,PR3
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:266  
         1 000204   000017 376207                    ANQ   ! 15,DL
         1 000205   000004 116207                    CMPQ  ! 4,DL
         1 000206   000210 601200 1                  TNZ   ! s:3562

     2004     3556    3                 OR SYMB$ -> FO$SYMB.EFLGB.IDSC = '1'B
     2005     3557    3                 OR SYMB$ -> FO$SYMB.EFLGB.FDSC = '1'B
     2006     3558    3                 OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
     2007     3559    3                 THEN
     2008     3560    3                  RETURN;

   3560  1 000207   000000 702200 xent               TSX2  ! X66_ARET

     2009     3561
     2010     3562    3                 SYMB$ -> FO$SYMB.FPABRT = '1'B;

   3562  1 000210   001000 236203                    LDQ   ! 512,DU
         1 000211   300021 256300                    ORSQ  ! 17,,PR3

     2011     3563    3                 CALL FOM$TELLAU (SYMB$ -> FO$SYMB,%CG_FPABORT#,0);

   3563  1 000212   000002 236200 2                  LDQ   ! 2
         1 000213   200014 756300                    STQ   ! BR+4,,AUTO
         1 000214   000012 236200 2                  LDQ   ! 10
         1 000215   200006 235300                    LDA   ! SYMB$,,AUTO
         1 000216   200012 757300                    STAQ  ! BR+2,,AUTO
         1 000217   200012 630700                    EPPR0 ! BR+2,,AUTO
         1 000220   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         1 000221   000000 701200 xent               TSX1  ! FOM$TELLAU
         1 000222   000000 011200                    NOP   ! 0

     2012     3564    3                 END;

   3564  1 000223   000226 710000 1                  TRA     s:3585

     2013     3565        /**
     2014     3566         **
     2015     3567         **
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:267  
     2016     3568         **      OTHER CASES
     2017     3569         **
     2018     3570         **
     2019     3571         **/
     2020     3572
     2021     3573    2             CASE (ELSE);

     2022     3574    2               CALL SC_BADSYMBINFCN;

   3574  1 000224   000000 713400 xsym               CLIMB   SC_BADSYMBINFCN
         1 000225   000000 600000 xsid               climb   nvectors=         0

     2023     3575
     2024     3576        /*S* SCREECH_CODE:      FOM-S$BADSYMBINFCN
     2025     3577             TYPE:         SNAP
     2026     3578             MESSAGE:           Bad FCN passed to FOM$SYMBIN
     2027     3579             REMARKS:           Input circular FEP queue management has
     2028     3580                                decided that this message belongs to
     2029     3581                                FOM$SYMBIN,   who does not know the function
     2030     3582                           code. */
     2031     3583
     2032     3584    2           END; /*CASE FCN*/

     2033     3585    1         RETURN;

   3585  1 000226   000000 702200 xent               TSX2  ! X66_ARET

OUTSYM_USR
 Sect OctLoc
   0     000   003*** ******                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000000 006000   000000 000020   000002 006000   000001 006000    ................
   2     004   000011 006000   000002 006000   000000 006000   777777 777760    ................
   2     010   000000 006000   000000 000031   000011 006000                    ............
     2034     3586        /**/
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:268  
     2035     3587        /**/
     2036     3588    1   END FOM$SYMBIN;
     2037     3589        /**/
     2038     3590        /**/
     2039     3591        %EOD;

PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:269  
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$SYMBIN.
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:270  

 **** Variables and constants ****

  ****  Section 000 RoData FOM$SYMBIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(9)     r     1 OUTSYM_USR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @FCN                       4-0-0/w PTR         r     1 @K$RWPARM
     3-0-0/w PTR         r     1 @NK$LDCT                  10-0-0/w STRC        r     1 BR
    *0-0-0/w UBIN        r     1 FCN                       *0-0-0/d STRC(1404)  r     1 K$RWPARM
    *0-0-0/d STRC(864)   r     1 NK$LDCT                    6-0-0/w PTR         r     1 SYMB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 FOSE_IDSC                  0-0-0/w STRC        r     1 FOSE_SHTD

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(720)   r     1 FO$SYMB


   Procedure FOM$SYMBIN requires 151 words for executable code.
   Procedure FOM$SYMBIN requires 20 words of local(AUTO) storage.
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:271  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:272  
          MINI XREF LISTING

BR
      3392**DCL      3501<<ASSIGN   3502<>CALL     3542<<ASSIGN   3544<>CALL
FCN
      3262**DCL         8--PROC     3467>>DOCASE   3477>>DOCASE
FO$SYMB
      3361**DCL      3502<>CALL     3505<>CALL     3544<>CALL     3563<>CALL
FO$SYMB.BR.BLK#
      3362**DCL      3363--REDEF
FO$SYMB.BR.REC#
      3363**DCL      3364--REDEF
FO$SYMB.BUF$
      3361**DCL      3362--REDEF
FO$SYMB.CUREXT.STAMP
      3365**DCL      3366--REDEF
FO$SYMB.EFLGB.FDSC
      3374**DCL      3555>>IF
FO$SYMB.EFLGB.IDSC
      3375**DCL      3492>>IF       3555>>IF
FO$SYMB.EFLGB.SHTD
      3374**DCL      3497>>IF
FO$SYMB.FPABRT
      3379**DCL      3555>>IF       3562<<ASSIGN
FO$SYMB.SPACEPAGES
      3369**DCL      3370--REDEF
FO$SYMB.SPACING
      3372**DCL      3497>>IF
FO$SYMB.STATE
      3376**DCL      3497>>IF       3524>>IF       3530<<ASSIGN   3555>>IF
FO$SYMB.THROTTLING
      3368**DCL      3524>>IF       3528<<ASSIGN
FOM$DEBEV
      3406**DCL-ENT  3529--CALL
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:273  
FOM$EVENT
      3403**DCL-ENT  3502--CALL     3544--CALL
FOM$TELLAU
      3405**DCL-ENT  3505--CALL     3563--CALL
FOSE_IDSC
      2241**DCL      3544<>CALL
FOSE_SHTD
      2226**DCL      3502<>CALL
K$RWPARM
      2967**DCL         8--PROC
K$RWPARM.BLKREC
      2993**DCL      3018--REDEF    3501>>ASSIGN   3542>>ASSIGN
K$RWPARM.BLKREC.BLKU#
      2994**DCL      2996--REDEF
K$RWPARM.BLKREC.RECU#
      3006**DCL      3008--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      3033**DCL      3034--REDEF
K$RWPARM.DVE.EOMCHAR
      3041**DCL      3045--REDEF
K$RWPARM.ERR
      3105**DCL      3110--REDEF
K$RWPARM.FC
      3069**DCL      3070--REDEF
K$RWPARM.FLDID
      3251**DCL      3252--REDEF
K$RWPARM.FPT$
      3132**DCL      3139--REDEF
K$RWPARM.KEYTYPE
      3258**DCL      3259--REDEF
K$RWPARM.MRKTYP
      3243**DCL      3493>>IF
K$RWPARM.MSG$
      2968**DCL      2974--REDEF
K$RWPARM.MSGID
      3080**DCL      3085--REDEF
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:274  
K$RWPARM.MSGIDXT
      3093**DCL      3097--REDEF
K$RWPARM.ORG
      3229**DCL      3230--REDEF
K$RWPARM.THDRSZ
      3173**DCL      3177--REDEF
K$RWPARM.VDOFLGS
      3231**DCL      3242--REDEF
K_RWPARM_CON.BLKREC
      1647**DCL      1672--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      1648**DCL      1650--REDEF
K_RWPARM_CON.BLKREC.RECU#
      1660**DCL      1662--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      1687**DCL      1688--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      1695**DCL      1699--REDEF
K_RWPARM_CON.ERR
      1759**DCL      1764--REDEF
K_RWPARM_CON.FC
      1723**DCL      1724--REDEF
K_RWPARM_CON.FLDID
      1905**DCL      1906--REDEF
K_RWPARM_CON.FPT$
      1786**DCL      1793--REDEF
K_RWPARM_CON.KEYTYPE
      1912**DCL      1913--REDEF
K_RWPARM_CON.MSG$
      1622**DCL      1628--REDEF
K_RWPARM_CON.MSGID
      1734**DCL      1739--REDEF
K_RWPARM_CON.MSGIDXT
      1747**DCL      1751--REDEF
K_RWPARM_CON.ORG
      1883**DCL      1884--REDEF
PL6.E3A0      #006=FOM$SYMBIN File=FOM$MOOS.:E05TSI                              TUE 07/29/97 17:10 Page:275  
K_RWPARM_CON.THDRSZ
      1827**DCL      1831--REDEF
K_RWPARM_CON.VDOFLGS
      1885**DCL      1896--REDEF
NK$LDCT
      2913**DCL         8--PROC     3529--CALL
NK$LDCT.DDT$
      2915**DCL      2915--REDEF
NK$LDCT.DFLG.SYMBIONT
      2918**DCL      3466>>IF
NK$LDCT.IOQ$
      2914**DCL      2915--REDEF
NK$LDCT.LDCTX
      2916**DCL      2916--REDEF
NK$LDCT.LKFLG.ABORTED
      2928**DCL      2929--REDEF
NK$LDCT.RLCID.LDCTX
      2938**DCL      2938--REDEF
NK$LDCT.STA$
      2934**DCL      2935--REDEF
NK$LDCT.SYMB$
      2913**DCL      2913--REDEF    2913--REDEF    2914--REDEF    3473>>ASSIGN
OUTSYM_USR
      3384**DCL      3529<>CALL
SC_BADSYMBINFCN
      3402**DCL-ENT  3471--CALL     3574--CALL
SSV$EVENT
      3407**DCL-ENT  3529--CALL
SYMB$
      3390**DCL      3473<<ASSIGN   3492>>IF       3497>>IF       3497>>IF       3497>>IF       3502>>CALL
      3505>>CALL     3524>>IF       3524>>IF       3528>>ASSIGN   3530>>ASSIGN   3544>>CALL     3555>>IF
      3555>>IF       3555>>IF       3555>>IF       3562>>ASSIGN   3563>>CALL

PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:276  
     2040        1        /*T***********************************************************/
     2041        2        /*T*                                                         */
     2042        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2043        4        /*T*                                                         */
     2044        5        /*T***********************************************************/
     2045        6        /**/
     2046        7        /**/
     2047        8        FOM$REL: PROC (FO$SYMB) ALTRET; /* !!Doesn't ALTRET!! */
     2048        9        /**/
     2049       10        /**/
     2050       11        /*F* NAME:         FOM$REL
     2051       12             PURPOSE:      To release certain symbiont context
     2052       13             DESCRIPTION:
     2053       14                           The items released here are:
     2054       15
     2055       16                           - The IOQ packet
     2056       17                           - The virtual page mapping entry for the disk
     2057       18                              buffer
     2058       19                           - The TABS buffer used for storing tabs during
     2059       20                              spacing (unless we just finished spacing, in
     2060       21                              which case we want to save them.)
     2061       22
     2062       23                           This routine is called from within MOOS when it
     2063       24                           is determined that the context needed for symbiont
     2064       25                           I/O is no longer required.  This happens when
     2065       26                           the symbiont close function is executed, or
     2066       27                           when the terminal disconnects, or when symbiont
     2067       28                           I/O is to be temporarily discontinued (e.g. when
     2068       29                           a symbiont file error occurs, or when a suspend
     2069       30                           is executed).  */
     2070       31        /**/
     2071       32        /*  INCLUDES */
     2072       33        /**/
     2073       34        %INCLUDE B$USER;
     2074      250        %B$USERREFS;
     2075      254        %INCLUDE FOM$STRUCT;
     2076      315        %INCLUDE FOM_DATA_R;
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:277  
     2077      564        %INCLUDE NK$LDCT;
     2078      666        %INCLUDE KC_SUBS_C;
     2079      682        %INCLUDE JG_GHOSTS_C;
     2080      772        %INCLUDE NK_LDCT_R;
     2081      781        %INCLUDE KC_CP6;
     2082     1341
     2083     1342
     2084     1343        /**/
     2085     1344        /* PARAMETERS */
     2086     1345        /**/
     2087     1346        %FOM$SYMB (NAME=FO$SYMB,STCLASS="");
     2088     1378
     2089     1379
     2090     1380        /**/
     2091     1381        /* BASED STRUCTURES */
     2092     1382        /**/
     2093     1383        %NK$LDCT;
     2094     1429        %FOM$TABS;
     2095     1432    1   DCL B$$PTR PTR BASED ALIGNED;
     2096     1433
     2097     1434
     2098     1435        /**/
     2099     1436        /* AUTO */
     2100     1437        /**/
     2101     1438    1   DCL FEX UBIN WORD;
     2102     1439    1   DCL GORGO UBIN WORD;
     2103     1440    1   DCL IOQ$ REDEF GORGO PTR;
     2104     1441    1   DCL LDCT$ PTR;
     2105     1442    1   DCL TAB$ PTR;
     2106     1443    1   DCL BUF$ PTR;
     2107     1444
     2108     1445
     2109     1446        /**/
     2110     1447        /* CONSTANT */
     2111     1448        /**/
     2112     1449    1   DCL OUTSYM_USER UBIN(9) CONSTANT INIT(JG_OUTSYM#);
     2113     1450
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:278  
     2114     1451
     2115     1452        /**/
     2116     1453        /*  REFS */
     2117     1454        /**/
     2118     1455    1   DCL MMS$VREL           ENTRY(2) ALTRET;
     2119     1456    1   DCL NIQ$REL            ENTRY(1) ALTRET;
     2120     1457    1   DCL NKL$RELDCT         ENTRY(1) ALTRET;
     2121     1458    1   DCL SSV$EVENT          ENTRY(7);
     2122     1459
     2123     1460
     2124     1461        /**/
     2125     1462        /* SUBS */
     2126     1463        /**/
     2127     1464        %EQU_CG;
     2128     1512        /**/
     2129     1513        /**/
     2130     1514    1         LDCT$=NK$LDCT$(FO$SYMB.DEVLDCTX);
     2131     1515    1         FEX=LDCT$->NK$LDCT.RLCID.NODE;
     2132     1516    1         GOTO REL;
     2133     1517        /**/
     2134     1518        /**/
     2135     1519    1   FOM$IOQREL: ENTRY (FO$SYMB) ALTRET;
     2136     1520        /**/
     2137     1521        /**/
     2138     1522        /*F* NAME:         FOM$IOQREL
     2139     1523             PURPOSE:      To release a symbiont IOQ packet
     2140     1524             DESCRIPTION:  In order to ensure that the IOQ packet for a
     2141     1525                           symbiont does not get released during end-
     2142     1526                           action (which might cause interesting problems),
     2143     1527                           FOM$REL does not actually release the packet.
     2144     1528                           Instead, it passes a garbage event to OUTSYM,
     2145     1529                           with one of the parameters being the address of
     2146     1530                           the packet.  FOM$IOQREL is thus called just
     2147     1531                           before going to the user, and is thus guaranteed
     2148     1532                           that endac has completed.  FOM$IOQREL simply
     2149     1533                           releases the IOQ packet and then ALTRETs to pre-
     2150     1534                           vent the event from actually getting to the user */
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:279  
     2151     1535        /**/
     2152     1536    1         GORGO=ADDR(FO$SYMB)->B$$PTR->B$DO.EVID;
     2153     1537    1         CALL NIQ$REL (IOQ$);
     2154     1538    1         ALTRETURN;
     2155     1539        /**/
     2156     1540    1   REL:
     2157     1541    2           DO INHIBIT;
     2158     1542    2           IOQ$=FO$SYMB.IOQ$;
     2159     1543    2           BUF$=FO$SYMB.BUF$;
     2160     1544    2           FO$SYMB.IOQ$=ADDR(NIL);
     2161     1545    2           FO$SYMB.BUF$=ADDR(NIL);
     2162     1546    2           IF FO$SYMB.XMTABS = '0'B THEN
     2163     1547    3             DO;
     2164     1548    3             TAB$=FO$SYMB.TAB$;
     2165     1549    3             FO$SYMB.TAB$=ADDR(NIL);
     2166     1550    3             END;
     2167     1551    2           ELSE TAB$=ADDR(NIL);
     2168     1552    2           END;
     2169     1553    1         IF IOQ$~=ADDR(NIL) THEN
     2170     1554                                      /* SSV$EVENT passes async event to user */
     2171     1555    1          CALL SSV$EVENT (OUTSYM_USER,7,0,IOQ$,0,,ENTADDR(FOM$IOQREL));
     2172     1556    1         IF BUF$~=ADDR(NIL) THEN CALL MMS$VREL(FOM_WSQ,BUF$);
     2173     1557    1         IF TAB$ ~= ADDR(NIL) THEN
     2174     1558    2           DO;
     2175     1559    2           TAB$->NK$LDCT.LDCTX=TAB$->FO$TABS.LDCTX;
     2176     1560    2           CALL NKL$RELDCT(TAB$);
     2177     1561    2           END;
     2178     1562    1         RETURN;
     2179     1563    1   END FOM$REL;
     2180     1564        /**/
     2181     1565        /**/
     2182     1566        %EOD;

PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:280  
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FOM$REL.

   Procedure FOM$REL requires 88 words for executable code.
   Procedure FOM$REL requires 18 words of local(AUTO) storage.

PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:281  

 Object Unit name= FOM$REL                                    File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:10:37.76 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  FOM$REL
    1   Proc  even  none    88    130  FOM$REL
    2  RoData even  none     6      6  FOM$REL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  FOM$REL
     1     14          yes     yes      Std        1  FOM$IOQREL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 NIQ$REL
         yes           Std       7 SSV$EVENT
 yes     yes           Std       2 MMS$VREL
 yes     yes           Std       1 NKL$RELDCT
 yes     yes           Std       1 FOM$IOQREL
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:282  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     FOM_WSQ                               N$DCT$$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:283  


     2040        1        /*T***********************************************************/
     2041        2        /*T*                                                         */
     2042        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2043        4        /*T*                                                         */
     2044        5        /*T***********************************************************/
     2045        6        /**/
     2046        7        /**/
     2047        8        FOM$REL: PROC (FO$SYMB) ALTRET; /* !!Doesn't ALTRET!! */

      8  1 000000   000000 700200 xent  FOM$REL      TSX0  ! X66_AUTO_1
         1 000001   000022 000001                    ZERO    18,1

     2048        9        /**/
     2049       10        /**/
     2050       11        /*F* NAME:         FOM$REL
     2051       12             PURPOSE:      To release certain symbiont context
     2052       13             DESCRIPTION:
     2053       14                           The items released here are:
     2054       15
     2055       16                           - The IOQ packet
     2056       17                           - The virtual page mapping entry for the disk
     2057       18                              buffer
     2058       19                           - The TABS buffer used for storing tabs during
     2059       20                              spacing (unless we just finished spacing, in
     2060       21                              which case we want to save them.)
     2061       22
     2062       23                           This routine is called from within MOOS when it
     2063       24                           is determined that the context needed for symbiont
     2064       25                           I/O is no longer required.  This happens when
     2065       26                           the symbiont close function is executed, or
     2066       27                           when the terminal disconnects, or when symbiont
     2067       28                           I/O is to be temporarily discontinued (e.g. when
     2068       29                           a symbiont file error occurs, or when a suspend
     2069       30                           is executed).  */
     2070       31        /**/
     2071       32        /*  INCLUDES */
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:284  
     2072       33        /**/
     2073       34        %INCLUDE B$USER;
     2074      250        %B$USERREFS;
     2075      254        %INCLUDE FOM$STRUCT;
     2076      315        %INCLUDE FOM_DATA_R;
     2077      564        %INCLUDE NK$LDCT;
     2078      666        %INCLUDE KC_SUBS_C;
     2079      682        %INCLUDE JG_GHOSTS_C;
     2080      772        %INCLUDE NK_LDCT_R;
     2081      781        %INCLUDE KC_CP6;
     2082     1341
     2083     1342
     2084     1343        /**/
     2085     1344        /* PARAMETERS */
     2086     1345        /**/
     2087     1346        %FOM$SYMB (NAME=FO$SYMB,STCLASS="");
     2088     1378
     2089     1379
     2090     1380        /**/
     2091     1381        /* BASED STRUCTURES */
     2092     1382        /**/
     2093     1383        %NK$LDCT;
     2094     1429        %FOM$TABS;
     2095     1432    1   DCL B$$PTR PTR BASED ALIGNED;
     2096     1433
     2097     1434
     2098     1435        /**/
     2099     1436        /* AUTO */
     2100     1437        /**/
     2101     1438    1   DCL FEX UBIN WORD;
     2102     1439    1   DCL GORGO UBIN WORD;
     2103     1440    1   DCL IOQ$ REDEF GORGO PTR;
     2104     1441    1   DCL LDCT$ PTR;
     2105     1442    1   DCL TAB$ PTR;
     2106     1443    1   DCL BUF$ PTR;
     2107     1444
     2108     1445
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:285  
     2109     1446        /**/
     2110     1447        /* CONSTANT */
     2111     1448        /**/
     2112     1449    1   DCL OUTSYM_USER UBIN(9) CONSTANT INIT(JG_OUTSYM#);
     2113     1450
     2114     1451
     2115     1452        /**/
     2116     1453        /*  REFS */
     2117     1454        /**/
     2118     1455    1   DCL MMS$VREL           ENTRY(2) ALTRET;
     2119     1456    1   DCL NIQ$REL            ENTRY(1) ALTRET;
     2120     1457    1   DCL NKL$RELDCT         ENTRY(1) ALTRET;
     2121     1458    1   DCL SSV$EVENT          ENTRY(7);
     2122     1459
     2123     1460
     2124     1461        /**/
     2125     1462        /* SUBS */
     2126     1463        /**/
     2127     1464        %EQU_CG;
     2128     1512        /**/
     2129     1513        /**/
     2130     1514    1         LDCT$=NK$LDCT$(FO$SYMB.DEVLDCTX);

   1514  1 000002   200003 470500                    LDP0    @FO$SYMB,,AUTO
         1 000003   000010 720100                    LXL0    8,,PR0
         1 000004   000000 471400 xsym               LDP1    N$DCT$$
         1 000005   100000 236110                    LDQ     0,X0,PR1
         1 000006   200006 756100                    STQ     LDCT$,,AUTO

     2131     1515    1         FEX=LDCT$->NK$LDCT.RLCID.NODE;

   1515  1 000007   200006 473500                    LDP3    LDCT$,,AUTO
         1 000010   300015 236100                    LDQ     13,,PR3
         1 000011   000033 772000                    QRL     27
         1 000012   200004 756100                    STQ     FEX,,AUTO

     2132     1516    1         GOTO REL;
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:286  

   1516  1 000013   000031 710000 1                  TRA     REL

     2133     1517        /**/
     2134     1518        /**/
     2135     1519    1   FOM$IOQREL: ENTRY (FO$SYMB) ALTRET;

   1519  1 000014   000000 700200 xent  FOM$IOQREL   TSX0  ! X66_AUTO_1
         1 000015   000022 000001                    ZERO    18,1

     2136     1520        /**/
     2137     1521        /**/
     2138     1522        /*F* NAME:         FOM$IOQREL
     2139     1523             PURPOSE:      To release a symbiont IOQ packet
     2140     1524             DESCRIPTION:  In order to ensure that the IOQ packet for a
     2141     1525                           symbiont does not get released during end-
     2142     1526                           action (which might cause interesting problems),
     2143     1527                           FOM$REL does not actually release the packet.
     2144     1528                           Instead, it passes a garbage event to OUTSYM,
     2145     1529                           with one of the parameters being the address of
     2146     1530                           the packet.  FOM$IOQREL is thus called just
     2147     1531                           before going to the user, and is thus guaranteed
     2148     1532                           that endac has completed.  FOM$IOQREL simply
     2149     1533                           releases the IOQ packet and then ALTRETs to pre-
     2150     1534                           vent the event from actually getting to the user */
     2151     1535        /**/
     2152     1536    1         GORGO=ADDR(FO$SYMB)->B$$PTR->B$DO.EVID;

   1536  1 000016   200003 470500                    LDP0    @FO$SYMB,,AUTO
         1 000017   000000 471500                    LDP1    0,,PR0
         1 000020   100003 235100                    LDA     3,,PR1
         1 000021   200005 755100                    STA     GORGO,,AUTO

     2153     1537    1         CALL NIQ$REL (IOQ$);

   1537  1 000022   200005 631500                    EPPR1   GORGO,,AUTO
         1 000023   200012 451500                    STP1    BUF$+2,,AUTO
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:287  
         1 000024   200012 630500                    EPPR0   BUF$+2,,AUTO
         1 000025   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000026   000000 701000 xent               TSX1    NIQ$REL
         1 000027   000000 011000                    NOP     0

     2154     1538    1         ALTRETURN;

   1538  1 000030   000000 702200 xent               TSX2  ! X66_AALT

     2155     1539        /**/
     2156     1540    1   REL:
     2157     1541    2           DO INHIBIT;

   1541  1 000031                       REL          null
     2158     1542    2           IOQ$=FO$SYMB.IOQ$;

   1542  1 000031   000001 236300                    LDQ   ! 1,,PR0
         1 000032   200005 756300                    STQ   ! GORGO,,AUTO

     2159     1543    2           BUF$=FO$SYMB.BUF$;

   1543  1 000033   000002 236300                    LDQ   ! 2,,PR0
         1 000034   200010 756300                    STQ   ! BUF$,,AUTO

     2160     1544    2           FO$SYMB.IOQ$=ADDR(NIL);

   1544  1 000035   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 000036   000001 756300                    STQ   ! 1,,PR0

     2161     1545    2           FO$SYMB.BUF$=ADDR(NIL);

   1545  1 000037   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 000040   000002 756300                    STQ   ! 2,,PR0

     2162     1546    2           IF FO$SYMB.XMTABS = '0'B THEN

   1546  1 000041   000012 236300                    LDQ   ! 10,,PR0
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:288  
         1 000042   000100 316207                    CANQ  ! 64,DL
         1 000043   000051 601200 1                  TNZ   ! s:1551

     2163     1547    3             DO;

     2164     1548    3             TAB$=FO$SYMB.TAB$;

   1548  1 000044   000000 236300                    LDQ   ! 0,,PR0
         1 000045   200007 756300                    STQ   ! TAB$,,AUTO

     2165     1549    3             FO$SYMB.TAB$=ADDR(NIL);

   1549  1 000046   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 000047   000000 756300                    STQ   ! 0,,PR0

     2166     1550    3             END;

   1550  1 000050   000053 710200 1                  TRA   ! s:1553

     2167     1551    2           ELSE TAB$=ADDR(NIL);

   1551  1 000051   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 000052   200007 756300                    STQ   ! TAB$,,AUTO

     2168     1552    2           END;

     2169     1553    1         IF IOQ$~=ADDR(NIL) THEN

   1553  1 000053   200005 236100                    LDQ     GORGO,,AUTO
         1 000054   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000055   000100 600000 1                  TZE     s:1556

     2170     1554                                      /* SSV$EVENT passes async event to user */
     2171     1555    1          CALL SSV$EVENT (OUTSYM_USER,7,0,IOQ$,0,,ENTADDR(FOM$IOQREL));

   1555  1 000056   000014 636000 1                  EAQ     s:1519
         1 000057   200012 756100                    STQ     BUF$+2,,AUTO
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:289  
         1 000060   200012 631500                    EPPR1   BUF$+2,,AUTO
         1 000061   200021 451500                    STP1    BUF$+9,,AUTO
         1 000062   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000063   200020 756100                    STQ     BUF$+8,,AUTO
         1 000064   000000 236000 2                  LDQ     0
         1 000065   200017 756100                    STQ     BUF$+7,,AUTO
         1 000066   200005 634500                    EPPR4   GORGO,,AUTO
         1 000067   200016 454500                    STP4    BUF$+6,,AUTO
         1 000070   000002 237000 2                  LDAQ    2
         1 000071   200014 757100                    STAQ    BUF$+4,,AUTO
         1 000072   000004 236000 2                  LDQ     4
         1 000073   200013 756100                    STQ     BUF$+3,,AUTO
         1 000074   200013 630500                    EPPR0   BUF$+3,,AUTO
         1 000075   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 000076   000000 701000 xent               TSX1    SSV$EVENT
         1 000077   000000 011000                    NOP     0

     2172     1556    1         IF BUF$~=ADDR(NIL) THEN CALL MMS$VREL(FOM_WSQ,BUF$);

   1556  1 000100   200010 236100                    LDQ     BUF$,,AUTO
         1 000101   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000102   000113 600000 1                  TZE     s:1557

   1556  1 000103   200010 630500                    EPPR0   BUF$,,AUTO
         1 000104   200013 450500                    STP0    BUF$+3,,AUTO
         1 000105   000005 236000 2                  LDQ     5
         1 000106   200012 756100                    STQ     BUF$+2,,AUTO
         1 000107   200012 630500                    EPPR0   BUF$+2,,AUTO
         1 000110   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000111   000000 701000 xent               TSX1    MMS$VREL
         1 000112   000000 011000                    NOP     0

     2173     1557    1         IF TAB$ ~= ADDR(NIL) THEN

   1557  1 000113   200007 236100                    LDQ     TAB$,,AUTO
         1 000114   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000115   000127 600000 1                  TZE     s:1562
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:290  

     2174     1558    2           DO;

     2175     1559    2           TAB$->NK$LDCT.LDCTX=TAB$->FO$TABS.LDCTX;

   1559  1 000116   200007 470500                    LDP0    TAB$,,AUTO
         1 000117   000000 220100                    LDX0    0,,PR0
         1 000120   000006 740100                    STX0    6,,PR0

     2176     1560    2           CALL NKL$RELDCT(TAB$);

   1560  1 000121   200007 630500                    EPPR0   TAB$,,AUTO
         1 000122   200012 450500                    STP0    BUF$+2,,AUTO
         1 000123   200012 630500                    EPPR0   BUF$+2,,AUTO
         1 000124   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000125   000000 701000 xent               TSX1    NKL$RELDCT
         1 000126   000000 011000                    NOP     0

     2177     1561    2           END;

     2178     1562    1         RETURN;

   1562  1 000127   000000 702200 xent               TSX2  ! X66_ARET

OUTSYM_USER
 Sect OctLoc
   0     000   003*** ******                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000002 006000   000000 000000   000011 006000   000002 006000    ................
   2     004   000000 006000   000000 006000                                    ........
     2179     1563    1   END FOM$REL;
     2180     1564        /**/
     2181     1565        /**/
     2182     1566        %EOD;

PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:291  
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FOM$REL.
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:292  

 **** Variables and constants ****

  ****  Section 000 RoData FOM$REL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(9)     r     1 OUTSYM_USER

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FO$SYMB                  10-0-0/w PTR         r     1 BUF$
     4-0-0/w UBIN        r     1 FEX                       *0-0-0/w STRC(720)   r     1 FO$SYMB
     5-0-0/w UBIN        r     1 GORGO                      5-0-0/w PTR         r     1 IOQ$
     6-0-0/w PTR         r     1 LDCT$                      7-0-0/w PTR         r     1 TAB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 FOM_WSQ                    0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$$PTR                     0-0-0/d STRC(396)   r     1 B$DO
     0-0-0/w STRC(360)   r     1 FO$TABS                    0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)

PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:293  

   Procedure FOM$REL requires 88 words for executable code.
   Procedure FOM$REL requires 18 words of local(AUTO) storage.
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:294  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:295  
          MINI XREF LISTING

B$$PTR
      1432**DCL      1536>>ASSIGN
B$DO.ECCINFO
       185**DCL       186--REDEF
B$DO.EVID
       179**DCL      1536>>ASSIGN
B$U.MISC
       164**DCL       165--REDEF
B$USER.MISC
       240**DCL       241--REDEF
BUF$
      1443**DCL      1543<<ASSIGN   1556>>IF       1556<>CALL
FEX
      1438**DCL      1515<<ASSIGN
FO$SYMB
      1357**DCL         8--PROC     1519--ENTRY    1536--ASSIGN
FO$SYMB.BR.BLK#
      1358**DCL      1359--REDEF
FO$SYMB.BR.REC#
      1359**DCL      1360--REDEF
FO$SYMB.BUF$
      1357**DCL      1358--REDEF    1543>>ASSIGN   1545<<ASSIGN
FO$SYMB.CUREXT.STAMP
      1361**DCL      1362--REDEF
FO$SYMB.DEVLDCTX
      1365**DCL      1514>>ASSIGN
FO$SYMB.IOQ$
      1357**DCL      1542>>ASSIGN   1544<<ASSIGN
FO$SYMB.SPACEPAGES
      1365**DCL      1366--REDEF
FO$SYMB.TAB$
      1357**DCL      1548>>ASSIGN   1549<<ASSIGN
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:296  
FO$SYMB.XMTABS
      1371**DCL      1546>>IF
FO$TABS.LDCTX
      1430**DCL      1559>>ASSIGN
FO$TABS.TABS
      1430**DCL      1430--REDEF
FOM$IOQREL
      1519**ENTRY    1555--CALL
FOM_WSQ
       323**DCL      1556<>CALL
GORGO
      1439**DCL      1440--REDEF    1536<<ASSIGN
IOQ$
      1440**DCL      1537<>CALL     1542<<ASSIGN   1553>>IF       1555<>CALL
LDCT$
      1441**DCL      1514<<ASSIGN   1515>>ASSIGN
MMS$VREL
      1455**DCL-ENT  1556--CALL
N$DCT$$
       779**DCL       779--IMP-PTR  1514>>ASSIGN
NIQ$REL
      1456**DCL-ENT  1537--CALL
NK$LDCT.DDT$
      1398**DCL      1398--REDEF
NK$LDCT.IOQ$
      1397**DCL      1398--REDEF
NK$LDCT.LDCTX
      1399**DCL      1399--REDEF    1559<<ASSIGN
NK$LDCT.LKFLG.ABORTED
      1411**DCL      1412--REDEF
NK$LDCT.RLCID.LDCTX
      1421**DCL      1421--REDEF
NK$LDCT.RLCID.NODE
      1420**DCL      1515>>ASSIGN
NK$LDCT.STA$
      1417**DCL      1418--REDEF
PL6.E3A0      #007=FOM$REL File=FOM$MOOS.:E05TSI                                 TUE 07/29/97 17:10 Page:297  
NK$LDCT.SYMB$
      1396**DCL      1396--REDEF    1396--REDEF    1397--REDEF
NK$LDCT$
       779**DCL      1514>>ASSIGN
NKL$RELDCT
      1457**DCL-ENT  1560--CALL
OUTSYM_USER
      1449**DCL      1555<>CALL
REL
      1541**LABEL    1516--GOTO
SSV$EVENT
      1458**DCL-ENT  1555--CALL
TAB$
      1442**DCL      1548<<ASSIGN   1551<<ASSIGN   1557>>IF       1559>>ASSIGN   1559>>ASSIGN   1560<>CALL

PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:298  
     2183        1        /*T***********************************************************/
     2184        2        /*T*                                                         */
     2185        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2186        4        /*T*                                                         */
     2187        5        /*T***********************************************************/
     2188        6        /**/
     2189        7        /**/
     2190        8        FOM$SBREL: PROC (NK$LDCT);
     2191        9        /**/
     2192       10        /**/
     2193       11        /*F* NAME:         FOM$SBREL
     2194       12             PURPOSE:      To release context for a symbiont comgroup terminal
     2195       13             DESCRIPTION:  Called from KDC$PREL when the path is finally
     2196       14                           being released.  KCD$PREL is called from KCO$DSCTRM
     2197       15                           (which is called from KQP$DISC),
     2198       16                           as part of final disconnect.  Note that KQP$DISC
     2199       17                           is called at MOOS's discretion (from FOM$EVENT),
     2200       18                           and thus we only get here after KQP$DISC has been
     2201       19                           called.
     2202       20        */
     2203       21        /**/
     2204       22        /**/
     2205       23        /**/
     2206       24        /*  INCLUDES */
     2207       25        /**/
     2208       26        %INCLUDE NK$LDCT;
     2209      128        %INCLUDE FOM$STRUCT;
     2210      189        %INCLUDE FOM_DATA_R;
     2211      438
     2212      439
     2213      440        /**/
     2214      441        /* PARAMETERS */
     2215      442        /**/
     2216      443        %NK$LDCT (STCLASS="");
     2217      489
     2218      490
     2219      491        /**/
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:299  
     2220      492        /* BASED STRUCTURES */
     2221      493        /**/
     2222      494        %FOM$SYMB (NAME=FO$SYMB);
     2223      526        %NK$LDCT (NAME=LDCT,STCLASS=BASED);
     2224      572
     2225      573
     2226      574        /**/
     2227      575        /* AUTO */
     2228      576        /**/
     2229      577    1   DCL SYMB$ PTR;
     2230      578
     2231      579
     2232      580        /**/
     2233      581        /*  REFS */
     2234      582        /**/
     2235      583    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     2236      584    1   DCL NKL$RELDCT         ENTRY(1) ALTRET;
     2237      585    1   DCL NKL$RELDCTL        ENTRY(1) ALTRET;
     2238      586        /**/
     2239      587        /**/
     2240      588    1         SYMB$=NK$LDCT.SYMB$;
     2241      589    2           DO INHIBIT;
     2242      590    2           NK$LDCT.DFLG.SYMBIONT='0'B;
     2243      591    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_FDSC);
     2244      592    2           END;
     2245      593    1         CALL NKL$RELDCTL (ADDR(NK$LDCT));
     2246      594    1         SYMB$->LDCT.LDCTX=SYMB$->FO$SYMB.LDCTX; /* MAKE SURE LDCTX IS IN RIGHT SPOT */
     2247      595    1         CALL NKL$RELDCT (SYMB$);
     2248      596    1         RETURN;
     2249      597        /**/
     2250      598        /**/
     2251      599    1   END FOM$SBREL;
     2252      600        /**/
     2253      601        %EOD;

PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:300  
--  Include file information  --

   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$SBREL.

   Procedure FOM$SBREL requires 33 words for executable code.
   Procedure FOM$SBREL requires 8 words of local(AUTO) storage.

PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:301  

 Object Unit name= FOM$SBREL                                  File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:10:44.68 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    33     41  FOM$SBREL
    1  RoData even  none     2      2  FOM$SBREL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  FOM$SBREL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 FOM$EVENT
 yes     yes           Std       1 NKL$RELDCTL
 yes     yes           Std       1 NKL$RELDCT
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    FOSE_FDSC                             B_VECTNIL
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:302  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:303  


     2183        1        /*T***********************************************************/
     2184        2        /*T*                                                         */
     2185        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2186        4        /*T*                                                         */
     2187        5        /*T***********************************************************/
     2188        6        /**/
     2189        7        /**/
     2190        8        FOM$SBREL: PROC (NK$LDCT);

      8  0 000000   000000 700200 xent  FOM$SBREL    TSX0  ! X66_AUTO_1
         0 000001   000010 000001                    ZERO    8,1

     2191        9        /**/
     2192       10        /**/
     2193       11        /*F* NAME:         FOM$SBREL
     2194       12             PURPOSE:      To release context for a symbiont comgroup terminal
     2195       13             DESCRIPTION:  Called from KDC$PREL when the path is finally
     2196       14                           being released.  KCD$PREL is called from KCO$DSCTRM
     2197       15                           (which is called from KQP$DISC),
     2198       16                           as part of final disconnect.  Note that KQP$DISC
     2199       17                           is called at MOOS's discretion (from FOM$EVENT),
     2200       18                           and thus we only get here after KQP$DISC has been
     2201       19                           called.
     2202       20        */
     2203       21        /**/
     2204       22        /**/
     2205       23        /**/
     2206       24        /*  INCLUDES */
     2207       25        /**/
     2208       26        %INCLUDE NK$LDCT;
     2209      128        %INCLUDE FOM$STRUCT;
     2210      189        %INCLUDE FOM_DATA_R;
     2211      438
     2212      439
     2213      440        /**/
     2214      441        /* PARAMETERS */
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:304  
     2215      442        /**/
     2216      443        %NK$LDCT (STCLASS="");
     2217      489
     2218      490
     2219      491        /**/
     2220      492        /* BASED STRUCTURES */
     2221      493        /**/
     2222      494        %FOM$SYMB (NAME=FO$SYMB);
     2223      526        %NK$LDCT (NAME=LDCT,STCLASS=BASED);
     2224      572
     2225      573
     2226      574        /**/
     2227      575        /* AUTO */
     2228      576        /**/
     2229      577    1   DCL SYMB$ PTR;
     2230      578
     2231      579
     2232      580        /**/
     2233      581        /*  REFS */
     2234      582        /**/
     2235      583    1   DCL FOM$EVENT          ENTRY(3) ALTRET;
     2236      584    1   DCL NKL$RELDCT         ENTRY(1) ALTRET;
     2237      585    1   DCL NKL$RELDCTL        ENTRY(1) ALTRET;
     2238      586        /**/
     2239      587        /**/
     2240      588    1         SYMB$=NK$LDCT.SYMB$;

    588  0 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000003   000000 236100                    LDQ     0,,PR0
         0 000004   200004 756100                    STQ     SYMB$,,AUTO

     2241      589    2           DO INHIBIT;

     2242      590    2           NK$LDCT.DFLG.SYMBIONT='0'B;

    590  0 000005   000000 236200 1                  LDQ   ! 0
         0 000006   000006 356300                    ANSQ  ! 6,,PR0
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:305  

     2243      591    2           CALL FOM$EVENT (SYMB$->FO$SYMB,FOSE_FDSC);

    591  0 000007   000001 236200 1                  LDQ   ! 1
         0 000010   200004 235300                    LDA   ! SYMB$,,AUTO
         0 000011   200006 757300                    STAQ  ! SYMB$+2,,AUTO
         0 000012   200006 630700                    EPPR0 ! SYMB$+2,,AUTO
         0 000013   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         0 000014   000000 701200 xent               TSX1  ! FOM$EVENT
         0 000015   000000 011200                    NOP   ! 0

     2244      592    2           END;

     2245      593    1         CALL NKL$RELDCTL (ADDR(NK$LDCT));

    593  0 000016   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000017   200006 756100                    STQ     SYMB$+2,,AUTO
         0 000020   200006 630500                    EPPR0   SYMB$+2,,AUTO
         0 000021   200007 450500                    STP0    SYMB$+3,,AUTO
         0 000022   200007 630500                    EPPR0   SYMB$+3,,AUTO
         0 000023   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000024   000000 701000 xent               TSX1    NKL$RELDCTL
         0 000025   000000 011000                    NOP     0

     2246      594    1        SYMB$->LDCT.LDCTX=SYMB$->FO$SYMB.LDCTX; /* MAKE SURE LDCTX IS IN RIGHT SPOT */

    594  0 000026   200004 470500                    LDP0    SYMB$,,AUTO
         0 000027   000010 220100                    LDX0    8,,PR0
         0 000030   077777 360003                    ANX0    32767,DU
         0 000031   000006 740100                    STX0    6,,PR0

     2247      595    1         CALL NKL$RELDCT (SYMB$);

    595  0 000032   200004 631500                    EPPR1   SYMB$,,AUTO
         0 000033   200006 451500                    STP1    SYMB$+2,,AUTO
         0 000034   200006 630500                    EPPR0   SYMB$+2,,AUTO
         0 000035   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:306  
         0 000036   000000 701000 xent               TSX1    NKL$RELDCT
         0 000037   000000 011000                    NOP     0

     2248      596    1         RETURN;

    596  0 000040   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   777777 757777   000000 006000                                    ........
     2249      597        /**/
     2250      598        /**/
     2251      599    1   END FOM$SBREL;
     2252      600        /**/
     2253      601        %EOD;

PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:307  
--  Include file information  --

   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$SBREL.
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:308  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NK$LDCT                  *0-0-0/d STRC(864)   r     1 NK$LDCT
     4-0-0/w PTR         r     1 SYMB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 FOSE_FDSC

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(720)   r     1 FO$SYMB                    0-0-0/d STRC(864)   r     1 LDCT


   Procedure FOM$SBREL requires 33 words for executable code.
   Procedure FOM$SBREL requires 8 words of local(AUTO) storage.
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:309  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:310  
          MINI XREF LISTING

FO$SYMB
       505**DCL       591<>CALL
FO$SYMB.BR.BLK#
       506**DCL       507--REDEF
FO$SYMB.BR.REC#
       507**DCL       508--REDEF
FO$SYMB.BUF$
       505**DCL       506--REDEF
FO$SYMB.CUREXT.STAMP
       509**DCL       510--REDEF
FO$SYMB.LDCTX
       513**DCL       594>>ASSIGN
FO$SYMB.SPACEPAGES
       513**DCL       514--REDEF
FOM$EVENT
       583**DCL-ENT   591--CALL
FOSE_FDSC
       359**DCL       591<>CALL
LDCT.DDT$
       541**DCL       541--REDEF
LDCT.IOQ$
       540**DCL       541--REDEF
LDCT.LDCTX
       542**DCL       542--REDEF     594<<ASSIGN
LDCT.LKFLG.ABORTED
       554**DCL       555--REDEF
LDCT.RLCID.LDCTX
       564**DCL       564--REDEF
LDCT.STA$
       560**DCL       561--REDEF
LDCT.SYMB$
       539**DCL       539--REDEF     539--REDEF     540--REDEF
PL6.E3A0      #008=FOM$SBREL File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:311  
NK$LDCT
       456**DCL         8--PROC      593--CALL
NK$LDCT.DDT$
       458**DCL       458--REDEF
NK$LDCT.DFLG.SYMBIONT
       461**DCL       590<<ASSIGN
NK$LDCT.IOQ$
       457**DCL       458--REDEF
NK$LDCT.LDCTX
       459**DCL       459--REDEF
NK$LDCT.LKFLG.ABORTED
       471**DCL       472--REDEF
NK$LDCT.RLCID.LDCTX
       481**DCL       481--REDEF
NK$LDCT.STA$
       477**DCL       478--REDEF
NK$LDCT.SYMB$
       456**DCL       456--REDEF     456--REDEF     457--REDEF     588>>ASSIGN
NKL$RELDCT
       584**DCL-ENT   595--CALL
NKL$RELDCTL
       585**DCL-ENT   593--CALL
SYMB$
       577**DCL       588<<ASSIGN    591>>CALL      594>>ASSIGN    594>>ASSIGN    595<>CALL

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:312  
     2254        1        /*T***********************************************************/
     2255        2        /*T*                                                         */
     2256        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2257        4        /*T*                                                         */
     2258        5        /*T***********************************************************/
     2259        6        /**/
     2260        7        /**/
     2261        8        FOM$EVENT: PROC (FO$SYMB,FO$SEVNT,INFO) ALTRET;
     2262        9        /**/
     2263       10        /*F* NAME:         FOM$EVENT
     2264       11             PURPOSE:      To co-ordinate MOOS symbiont events
     2265       12             DESCRIPTION:  MOOS can receive events such has disconnect
     2266       13                           or symbiont-terminal-held asynchronously with
     2267       14                           respect to his normal activities of reading
     2268       15                           disk and writing to device.  These events
     2269       16                           are reported to FOM$EVENT, who, if MOOS is
     2270       17                           busy with something else, just records them.
     2271       18
     2272       19                           The main parts of MOOS (disk reader, and device
     2273       20                           writer) report in to FOM$EVENT whenever something
     2274       21                           significant like disk I/O complete or device I/O
     2275       22                           complete happens.  If nothing has occurred to
     2276       23                           prevent normal continuation of the sequence,
     2277       24                           FOM$EVENT just returns to these callers.  Otherwise
     2278       25                           he takes appropriate action, and then ALTRETs to
     2279       26                           tell the caller to just get out.
     2280       27        */
     2281       28        /**/
     2282       29        /**/
     2283       30        /*  INCLUDES */
     2284       31        /**/
     2285       32        %INCLUDE FOM$STRUCT;
     2286       93        %INCLUDE NK$LDCT;
     2287      195        %INCLUDE FOM_SUBS_C;
     2288      258        %INCLUDE KC_SUBS_C;
     2289      274        %INCLUDE KV$VDO;
     2290     1289        %INCLUDE K_DATA_R;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:313  
     2291     2000        %INCLUDE NK_LDCT_R;
     2292     2009        %INCLUDE KQ_MAC_C;
     2293     4559        %INCLUDE KC_CP6;
     2294     5119        %INCLUDE KC$CP6V_C;
     2295     5239        %INCLUDE KQ_SUBS_C;
     2296     5539
     2297     5540
     2298     5541        /**/
     2299     5542        /* PARAMETERS */
     2300     5543        /**/
     2301     5544        %FOM$SYMB (NAME=FO$SYMB,STCLASS="");
     2302     5576        %FOM$SEVNT (STCLASS="");
     2303     5591    1   DCL INFO UBIN WORD;
     2304     5592    1   DCL HLTRSN REDEF INFO UBIN WORD;
     2305     5593    1   DCL BLKREC REDEF INFO BIT(36);
     2306     5594
     2307     5595
     2308     5596        /**/
     2309     5597        /* BASED STRUCTURES */
     2310     5598        /**/
     2311     5599    1   DCL B$$WORD UBIN WORD BASED ALIGNED;
     2312     5600        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
     2313     5939        %KQ_CG  (FPTN=KQ$CG ,STCLASS=BASED);
     2314     6678        %NK$LDCT;
     2315     6724
     2316     6725
     2317     6726        /**/
     2318     6727        /* AUTO */
     2319     6728        /**/
     2320     6729        %K$RWPARM (NAME=K$RWPARM);
     2321     7045    1   DCL STA$ PTR;
     2322     7046    1   DCL CG$ PTR;
     2323     7047    1   DCL STATE UBIN WORD;
     2324     7048    1   DCL ECCSC UBIN WORD;
     2325     7049    1   DCL LDCT$ PTR;
     2326     7050    1   DCL OP$ PTR;
     2327     7051
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:314  
     2328     7052
     2329     7053        /**/
     2330     7054        /*  REFS */
     2331     7055        /**/
     2332     7056        %KV_VDO_ALL_E;
     2333     7135    1   DCL SC_BADSYMBEVST ENTRY CONV(2,0);
     2334     7136    1   DCL SC_BADSYMBEVENT ENTRY CONV(2,0);
     2335     7137    1   DCL SC_BADSYMBSTATE ENTRY CONV(2,0);
     2336     7138    1   DCL FOM$REL            ENTRY(1) ALTRET;
     2337     7139    1   DCL FOM$TIMR           ENTRY(1);
     2338     7140    1   DCL KCA$TELLAU         ENTRY(3) ALTRET;
     2339     7141    1   DCL KIA$FCNO ENTRY (3) ALTRET;
     2340     7142    1   DCL KQP$DISC           ENTRY(1) ALTRET;
     2341     7143    1   DCL KQX$LDASR          ENTRY(1);
     2342     7144    1   DCL SSC$MONTIMR        ENTRY(3);
     2343     7145
     2344     7146
     2345     7147        /**/
     2346     7148        /* SUBS */
     2347     7149        /**/
     2348     7150        %EQU_CG;
     2349     7198        /**/
     2350     7199        /**/
     2351     7200                                /* RUN THE WHOLE THING INHIBITED */
     2352     7201    2           DO INHIBIT;
     2353     7202                                /* GET THE CURRENT STATE */
     2354     7203    2           STATE=FO$SYMB.STATE;
     2355     7204    2           LDCT$=NK$LDCT$(FO$SYMB.DEVLDCTX);
     2356     7205                                /* IF EVENT DEMANDS A SPECIFIC OLD STATE,
     2357     7206                                   THEN VERIFY IT */
     2358     7207    2           IF FO$SEVNT.OLDSTATE~=0
     2359     7208    2           AND FO$SEVNT.OLDSTATE~=STATE THEN CALL BADEVST;
     2360     7209                                /* CHECK FOR BAD FLAGS */
     2361     7210    2           IF (FO$SEVNT.BADFLG&FO$SYMB.EFLGB) THEN CALL BADEVST;
     2362     7211                                /* DECIDE WHAT SORT OF EVENT IT IS */
     2363     7212    2           IF FO$SEVNT.SPECIAL='0'B THEN
     2364     7213    3   NOSPC:    DO;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:315  
     2365     7214                                /* SIMPLE STATE-CHANGE EVENT.  IF ALL
     2366     7215                                   ASYNC EVENT FLAGS ARE CLEAR, THEN JUST
     2367     7216                                   CHANGE STATE AND RETURN */
     2368     7217    3             IF FO$SYMB.EFLGB='0'B THEN
     2369     7218    4               DO;
     2370     7219    4               FO$SYMB.STATE=FO$SEVNT.NEWSTATE;
     2371     7220    4               RETURN;
     2372     7221    4               END;
     2373     7222                                /* ASYNC EVENT FLAGS NOT CLEAR.  EXAMINE
     2374     7223                                   THEM AND DO THAT WHICH IS INDICATED.
     2375     7224                                   IN ANY CASE, ALTRET SO THE CALLER KNOWS
     2376     7225                                   HE'S BEEN INTERRUPTED.  HE WILL TYPICALLY
     2377     7226                                   JUST EXIT, KNOWING THAT WE'VE DONE
     2378     7227                                   WHAT'S REQUIRED */
     2379     7228    3             ELSE GOTO REPORT_IN;
     2380     7229    3             END;
     2381     7230                                /* SPECIAL EVENT */
     2382     7231    2           ELSE
     2383     7232    3             DO;
     2384     7233        /**
     2385     7234         **
     2386     7235         **
     2387     7236         **      VECTOR ON SPECIAL EVENT CODE
     2388     7237         **
     2389     7238         **
     2390     7239         **/
     2391     7240    4               DO CASE (FO$SEVNT.EVENT);
     2392     7241        /**
     2393     7242         **
     2394     7243         **      SYMBIONT GRANULE WRITTEN
     2395     7244         **
     2396     7245         **/
     2397     7246                                      /* Symbiont write done event */
     2398     7247    4                 CASE (FOSE_SWDN#);
     2399     7248    4                   IF LDCT$->NK$LDCT.DFLG.LOCAL THEN
     2400     7249    4                    IF STATE = FOMS_DVIO# THEN
     2401     7250    4                     GOTO NOSPC;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:316  
     2402     7251    4                    ELSE
     2403     7252    4                     CALL BADEVST;
     2404     7253    4                   IF NOT FO$SYMB.EFLGB.HLTR THEN GOTO NOSPC;
     2405     7254    4                   ALTRETURN;
     2406     7255        /**
     2407     7256         **
     2408     7257         **      FINISHED SPACING
     2409     7258         **
     2410     7259         **/
     2411     7260    4                 CASE (FOSE_FSPA#,FOSE_SPEF#);
     2412     7261    4                   IF FO$SYMB.EFLGB THEN GOTO REPORT_IN;
     2413     7262    4                   FO$SYMB.STATE=FOMS_ACTV#;
     2414     7263    4                   CALL FOM$REL (FO$SYMB);
     2415     7264    4                   IF FO$SYMB.EFLGB THEN GOTO REPORT_IN;
     2416     7265    4                   FO$SYMB.SPACING='0'B;
     2417     7266    4                   FO$SYMB.STATE=FOMS_HELD#;
     2418     7267    4                   CALL TELLAU (%CG_SFSPA#,FO$SYMB.BR);
     2419     7268    4                   RETURN;
     2420     7269        /**
     2421     7270         **
     2422     7271         **      HALT SYMBIONT REQUEST
     2423     7272         **
     2424     7273         **/
     2425     7274    4                 CASE (FOSE_HLTR#);
     2426     7275    5                     DO CASE (HLTRSN);
     2427     7276    5                       CASE (FOHR_OUTS#);
     2428     7277    5                         IF (FO$SYMB.EFLGB) THEN ALTRETURN;
     2429     7278    5                         IF FO$SYMB.STATE=FOMS_HELD# THEN RETURN;
     2430     7279    5                         FO$SYMB.EFLGB.HLTR='1'B;
     2431     7280    5                         FO$SYMB.HLTRSN=FOHR_OUTS#;
     2432     7281    5                         IF FO$SYMB.STATE=FOMS_IDLE# THEN GOTO START_HALT;
     2433     7282    5                         IF  FO$SYMB.STATE = FOMS_DVIO#
     2434     7283    5                         AND ~LDCT$->NK$LDCT.DFLG.LOCAL THEN
     2435     7284    5                          GOTO START_HALT;
     2436     7285    5                         RETURN;
     2437     7286    5                       CASE (FOHR_NMEM#);
     2438     7287    5                         IF FO$SYMB.EFLGB='0'B THEN
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:317  
     2439     7288    6                           DO;
     2440     7289    6                           FO$SYMB.STATE=FOMS_HELD#;
     2441     7290    6                           RETURN;
     2442     7291    6                           END;
     2443     7292    5                         ELSE GOTO REPORT_IN;
     2444     7293    5                       CASE (FOHR_FERR#,FOHR_TERR#);
     2445     7294    5                         IF FO$SYMB.EFLGB.IDSC THEN GOTO REPORT_IN;
     2446     7295    5                         FO$SYMB.EFLGB.HLTR='1'B;
     2447     7296    5                         FO$SYMB.HLTRSN=HLTRSN;
     2448     7297    5                         IF FO$SYMB.EFLGB.SHTD THEN
     2449     7298    6                           DO;
     2450     7299    6   TELL_HALT:              ;
     2451     7300    6                           CALL DO_TELLHLT ALTRET(REPORT_IN);
     2452     7301    6                           RETURN;
     2453     7302    6                           END;
     2454     7303    5   START_HALT:           ;
     2455     7304    5                         CALL DO_STARTHLT ALTRET(REPORT_IN);
     2456     7305    5                         RETURN;
     2457     7306    5                       CASE (ELSE);
     2458     7307    5                         CALL BADEVENT;
     2459     7308
     2460     7309                  /* END OF HLTRSN DOCASE */
     2461     7310    5                     END;
     2462     7311        /**
     2463     7312         **
     2464     7313         **      SYMBIONT HALTED MESSAGE FROM FEP
     2465     7314         **
     2466     7315         **/
     2467     7316    4                 CASE (FOSE_SHTD#);
     2468     7317    4                   FO$SYMB.BR=BLKREC;
     2469     7318    4                   FO$SYMB.EFLGB.SHTD='1'B;
     2470     7319    5                     DO CASE (STATE);
     2471     7320    5                       CASE (FOMS_HOLD#);
     2472     7321    5                         GOTO TELL_HALT;
     2473     7322    5                       CASE (FOMS_IDLE#,FOMS_DVIO#);
     2474     7323    5                         FO$SYMB.HLTRSN=FOHR_HAND#;
     2475     7324    5                         GOTO TELL_HALT;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:318  
     2476     7325    5                       CASE (FOMS_DKIO#,FOMS_ACTV#);
     2477     7326    5                         IF FO$SYMB.EFLGB.HLTR = '0'B THEN
     2478     7327    5                          FO$SYMB.HLTRSN=FOHR_HAND#;
     2479     7328    5                         RETURN;
     2480     7329    5                       CASE (FOMS_HRQW#);
     2481     7330    5                         RETURN;
     2482     7331    5                       CASE (ELSE);
     2483     7332    5                         CALL BADSTATE;
     2484     7333                    /* END OF STATE DOCASE */
     2485     7334    5                     END;
     2486     7335        /**
     2487     7336         **
     2488     7337         **      INITIAL DISCONNECT EVENT
     2489     7338         **
     2490     7339         **/
     2491     7340    4                 CASE (FOSE_IDSC#);
     2492     7341    4                   FO$SYMB.BR=BLKREC;
     2493     7342    4                   FO$SYMB.EFLGB.IDSC='1'B;
     2494     7343    5                     DO CASE (STATE);
     2495     7344    5                       CASE (FOMS_IDLE#,FOMS_HOLD#,FOMS_HELD#,FOMS_DVIO#);
     2496     7345    5                         CALL DO_IDSC;
     2497     7346    5                         RETURN;
     2498     7347    5                       CASE (FOMS_DKIO#,FOMS_ACTV#,FOMS_HRQW#);
     2499     7348    5                         RETURN;
     2500     7349    5                       CASE (ELSE);
     2501     7350    5                         CALL BADSTATE;
     2502     7351                    /* END OF STATE DOCASE */
     2503     7352    5                     END;
     2504     7353        /**
     2505     7354         **
     2506     7355         **      FINAL DISCONNECT EVENT
     2507     7356         **
     2508     7357         **/
     2509     7358    4                 CASE (FOSE_FDSC#);
     2510     7359
     2511     7360    4                   FO$SYMB.EFLGB.FDSC='1'B;
     2512     7361    4                   RETURN;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:319  
     2513     7362        /**
     2514     7363         **
     2515     7364         **      HALT REQUEST RETRY EVENT
     2516     7365         **
     2517     7366         **/
     2518     7367    4                 CASE (FOSE_HRQR#);
     2519     7368    4                   GOTO REPORT_IN;
     2520     7369        /**
     2521     7370         **
     2522     7371         **      UNKNOWN EVENT
     2523     7372         **
     2524     7373         **/
     2525     7374    4                 CASE (ELSE);
     2526     7375    4                   CALL BADEVENT;
     2527     7376        /**
     2528     7377         **      END OF SPECIAL EVENT DOCASE AND DO
     2529     7378         **/
     2530     7379    4               END;
     2531     7380    3             END;
     2532     7381        /***
     2533     7382         ***
     2534     7383         ***
     2535     7384         ***          WRAP UP PREVIOUS EVENTS
     2536     7385         ***
     2537     7386         ***
     2538     7387         ***/
     2539     7388    2   REPORT_IN:;
     2540     7389    2           IF FO$SYMB.EFLGB.IDSC THEN
     2541     7390    3             DO;
     2542     7391    3             CALL DO_IDSC;
     2543     7392    3   ALTRT:    ;
     2544     7393    3             ALTRETURN;
     2545     7394    3             END;
     2546     7395    2           IF FO$SYMB.EFLGB.SHTD THEN
     2547     7396    3             DO;
     2548     7397    3             CALL DO_TELLHLT ALTRET(REPORT_IN);
     2549     7398    3             ALTRETURN;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:320  
     2550     7399    3             END;
     2551     7400    2           IF FO$SYMB.EFLGB.HLTR THEN
     2552     7401    3             DO;
     2553     7402    3             CALL DO_STARTHLT ALTRET(REPORT_IN);
     2554     7403    3             ALTRETURN;
     2555     7404    3             END;
     2556     7405    2           END; /*DO INHIBIT*/
     2557     7406        /**/
     2558     7407        /**/
     2559     7408    1   DO_STARTHLT: PROC ALTRET;
     2560     7409    3           DO INHIBIT;
     2561     7410        /* RLCID = Remote Logical Connection ID */
     2562     7411    3           IF LDCT$->NK$LDCT.DFLG.LOCAL
     2563     7412    3           OR FO$SYMB.SPACING THEN
     2564     7413    4             DO;
     2565     7414    4             CALL DO_TELLHLT ALTRET(ALTRT);
     2566     7415    4             RETURN;
     2567     7416    4   ALTRT:    ALTRETURN;
     2568     7417    4             END;
     2569     7418    3           FO$SYMB.STATE=FOMS_ACTV#;
     2570     7419    3           K$RWPARM = K_RWPARM_CON;
     2571     7420        /* LSTRCRID = (request) Last Record ID */
     2572     7421    3           K$RWPARM.MRKTYP = %KV_VDOMRKTYP_SNDLSTRCRID;
     2573     7422    3           CALL KIA$FCNO (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSMRK,K$RWPARM) ALTRET (WAIT);
     2574     7423    3           IF FO$SYMB.EFLGB.IDSC OR FO$SYMB.EFLGB.SHTD THEN ALTRETURN;
     2575     7424    3           ELSE FO$SYMB.STATE=FOMS_HOLD#;
     2576     7425    3           RETURN;
     2577     7426    3   WAIT:   ;
     2578     7427    3           FO$SYMB.STATE=FOMS_HRQW#;
     2579     7428    3           FO$SYMB.HRQWAIT='1'B;
     2580     7429    3           CALL SSC$MONTIMR (FOM_DLY#,ENTADDR(FOM$TIMR),ADDR(FO$SYMB));
     2581     7430    3           RETURN;
     2582     7431    3           END; /*DO INHIBIT*/
     2583     7432    2   END DO_STARTHLT;
     2584     7433        /**/
     2585     7434    1   DO_TELLHLT: PROC ALTRET;
     2586     7435    3           DO INHIBIT;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:321  
     2587     7436    3           ECCSC=%CG_STHLD#;
     2588     7437    3           IF FO$SYMB.HLTRSN = FOHR_FERR# THEN
     2589     7438    3            ECCSC = %CG_SFERR#;
     2590     7439    3           ELSE
     2591     7440    3            IF FO$SYMB.HLTRSN = FOHR_TERR# THEN
     2592     7441    3             ECCSC = %CG_STERR#;
     2593     7442    3           FO$SYMB.STATE=FOMS_ACTV#;
     2594     7443    3           CALL FOM$REL (FO$SYMB);
     2595     7444    3           IF FO$SYMB.EFLGB.IDSC THEN ALTRETURN;
     2596     7445    3           FO$SYMB.STATE=FOMS_HELD#;
     2597     7446    3           FO$SYMB.EFLGB.SHTD='0'B;
     2598     7447    3           FO$SYMB.EFLGB.HLTR='0'B;
     2599     7448    3           FO$SYMB.SPACING='0'B;
     2600     7449    3           CALL TELLAU (ECCSC,FO$SYMB.BR);
     2601     7450    3           RETURN;
     2602     7451    3           END; /*DO INHIBIT*/
     2603     7452    2   END DO_TELLHLT;
     2604     7453        /**/
     2605     7454    1   DO_IDSC: PROC;
     2606     7455    3           DO INHIBIT;
     2607     7456    3           FO$SYMB.STATE=FOMS_ACTV#;
     2608     7457    3           CALL FOM$REL (FO$SYMB);
     2609     7458    3           FO$SYMB.STATE=FOMS_DCMP#;
     2610     7459    3           CALL KQP$DISC (LDCT$->NK$LDCT);
     2611     7460    3           RETURN;
     2612     7461    3           END; /*DO INHIBIT*/
     2613     7462    2   END DO_IDSC;
     2614     7463        /**/
     2615     7464    1   BADEVENT: PROC;
     2616     7465    2         CALL SC_BADSYMBEVENT;
     2617     7466        /*S* SCREECH_CODE: FOM-S$BADSYMBEVENT
     2618     7467             TYPE:         SCREECH
     2619     7468             MESSAGE:      Bad event passed to FOM$EVENT
     2620     7469             REMARKS:      Either the event code passed to FOM$EVENT,
     2621     7470                           or the qualifier (e.g. HLTRSN) thereof,
     2622     7471                           was unknown.  Monitor auto being clobbered
     2623     7472                           is a possible culprit, but essentially this
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:322  
     2624     7473                           screech should never occur. */
     2625     7474    2   END BADEVENT;
     2626     7475        /**/
     2627     7476    1   BADSTATE: PROC;
     2628     7477    2         CALL SC_BADSYMBSTATE;
     2629     7478        /*S* SCREECH_CODE: FOM-S$BADSYMBSTATE
     2630     7479             TYPE:         SCREECH
     2631     7480             MESSAGE:      FOM$EVENT found a symbiont in an unknown state
     2632     7481             REMARKS:      This screech occurs when FOM$EVENT finds a
     2633     7482                           symbiont in an unknown state.  This probably
     2634     7483                           is due to the LDCT containing the symbiont's
     2635     7484                           context having been clobbered.  */
     2636     7485    2   END BADSTATE;
     2637     7486        /**/
     2638     7487    1   BADEVST: PROC;
     2639     7488    2         CALL SC_BADSYMBEVST;
     2640     7489        /*S* SCREECH_CODE: FOM-S$BADSYMBEVST
     2641     7490             TYPE:         SCREECH
     2642     7491             MESSAGE:      Bad event-state combination in FOM$EVENT
     2643     7492             REMARKS:      The event being reported to FOM$EVENT, and
     2644     7493                           the current state/flag-settings of the
     2645     7494                           symbiont involved, should never occur sim-
     2646     7495                           ultaneously.  The cause can be elicited by
     2647     7496                           determining the recent history of the symbiont
     2648     7497                           involved.                     */
     2649     7498    2   END BADEVST;
     2650     7499        /**/
     2651     7500        /**/
     2652     7501        /*F* NAME:         FOM$TELLAU
     2653     7502             PURPOSE:      To pass a special event to the OSCG AU
     2654     7503             DESCRIPTION:  Passes the symb context block, the event code,
     2655     7504                           and one word of info.  OUTSYM is passed the
     2656     7505                           appropriate special event message.
     2657     7506        */
     2658     7507    1   FOM$TELLAU: ENTRY (FO$SYMB,FO$SEVNT,INFO) ALTRET; /* !!Doesn't ALTRET!! */
     2659     7508        /**/
     2660     7509    1         CALL TELLAU (ADDR(FO$SEVNT)->B$$WORD,INFO);
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:323  
     2661     7510    1         RETURN;
     2662     7511        /**/
     2663     7512        /*D* NAME:         TELLAU
     2664     7513             PURPOSE:      To event OUTSYM */
     2665     7514    1   TELLAU: PROC (EVENT,INFOWORD);
     2666     7515        /**/
     2667     7516    2   DCL EVENT UBIN WORD;
     2668     7517    2   DCL INFOWORD UBIN WORD;
     2669     7518        /**/
     2670     7519    3           DO INHIBIT;
     2671     7520    3           LDCT$=NK$LDCT$(FO$SYMB.DEVLDCTX);
     2672     7521    3           CG$=LDCT$->NK$LDCT.CG$;
     2673     7522    3           CALL KQX$LDASR (CG$->KQ$CG);
     2674     7523    3           STA$=LDCT$->NK$LDCT.STA$;
     2675     7524    3           CALL KCA$TELLAU (STA$->KQ$STA,EVENT,INFOWORD);
     2676     7525    3           RETURN;
     2677     7526    3           END;
     2678     7527    2   END TELLAU;
     2679     7528        /**/
     2680     7529        /**/
     2681     7530    1   END FOM$EVENT;
     2682     7531        /**/
     2683     7532        %EOD;

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:324  
--  Include file information  --

   KQ_SUBS_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$EVENT.

   Procedure FOM$EVENT requires 449 words for executable code.
   Procedure FOM$EVENT requires 66 words of local(AUTO) storage.

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:325  

 Object Unit name= FOM$EVENT                                  File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:10:49.36 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   449    701  FOM$EVENT
    1  RoData even  none    10     12  FOM$EVENT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        3  FOM$EVENT
     0    634          yes     yes      Std        3  FOM$TELLAU

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 FOM$REL
         yes           Std       1 FOM$TIMR
         yes           Std       3 SSC$MONTIMR
 yes     yes           Std       3 KIA$FCNO
 yes     yes           Std       1 KQP$DISC
         yes           Std       1 KQX$LDASR
 yes     yes           Std       3 KCA$TELLAU
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:326  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BADSYMBEVENT                       SC_BADSYMBSTATE                       SC_BADSYMBEVST
r    K_RWPARM_CON                          N$DCT$$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:327  


     2254        1        /*T***********************************************************/
     2255        2        /*T*                                                         */
     2256        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2257        4        /*T*                                                         */
     2258        5        /*T***********************************************************/
     2259        6        /**/
     2260        7        /**/
     2261        8        FOM$EVENT: PROC (FO$SYMB,FO$SEVNT,INFO) ALTRET;

      8  0 000000   000000 700200 xent  FOM$EVENT    TSX0  ! X66_AUTO_3
         0 000001   000102 000003                    ZERO    66,3

     2262        9        /**/
     2263       10        /*F* NAME:         FOM$EVENT
     2264       11             PURPOSE:      To co-ordinate MOOS symbiont events
     2265       12             DESCRIPTION:  MOOS can receive events such has disconnect
     2266       13                           or symbiont-terminal-held asynchronously with
     2267       14                           respect to his normal activities of reading
     2268       15                           disk and writing to device.  These events
     2269       16                           are reported to FOM$EVENT, who, if MOOS is
     2270       17                           busy with something else, just records them.
     2271       18
     2272       19                           The main parts of MOOS (disk reader, and device
     2273       20                           writer) report in to FOM$EVENT whenever something
     2274       21                           significant like disk I/O complete or device I/O
     2275       22                           complete happens.  If nothing has occurred to
     2276       23                           prevent normal continuation of the sequence,
     2277       24                           FOM$EVENT just returns to these callers.  Otherwise
     2278       25                           he takes appropriate action, and then ALTRETs to
     2279       26                           tell the caller to just get out.
     2280       27        */
     2281       28        /**/
     2282       29        /**/
     2283       30        /*  INCLUDES */
     2284       31        /**/
     2285       32        %INCLUDE FOM$STRUCT;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:328  
     2286       93        %INCLUDE NK$LDCT;
     2287      195        %INCLUDE FOM_SUBS_C;
     2288      258        %INCLUDE KC_SUBS_C;
     2289      274        %INCLUDE KV$VDO;
     2290     1289        %INCLUDE K_DATA_R;
     2291     2000        %INCLUDE NK_LDCT_R;
     2292     2009        %INCLUDE KQ_MAC_C;
     2293     4559        %INCLUDE KC_CP6;
     2294     5119        %INCLUDE KC$CP6V_C;
     2295     5239        %INCLUDE KQ_SUBS_C;
     2296     5539
     2297     5540
     2298     5541        /**/
     2299     5542        /* PARAMETERS */
     2300     5543        /**/
     2301     5544        %FOM$SYMB (NAME=FO$SYMB,STCLASS="");
     2302     5576        %FOM$SEVNT (STCLASS="");
     2303     5591    1   DCL INFO UBIN WORD;
     2304     5592    1   DCL HLTRSN REDEF INFO UBIN WORD;
     2305     5593    1   DCL BLKREC REDEF INFO BIT(36);
     2306     5594
     2307     5595
     2308     5596        /**/
     2309     5597        /* BASED STRUCTURES */
     2310     5598        /**/
     2311     5599    1   DCL B$$WORD UBIN WORD BASED ALIGNED;
     2312     5600        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
     2313     5939        %KQ_CG  (FPTN=KQ$CG ,STCLASS=BASED);
     2314     6678        %NK$LDCT;
     2315     6724
     2316     6725
     2317     6726        /**/
     2318     6727        /* AUTO */
     2319     6728        /**/
     2320     6729        %K$RWPARM (NAME=K$RWPARM);
     2321     7045    1   DCL STA$ PTR;
     2322     7046    1   DCL CG$ PTR;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:329  
     2323     7047    1   DCL STATE UBIN WORD;
     2324     7048    1   DCL ECCSC UBIN WORD;
     2325     7049    1   DCL LDCT$ PTR;
     2326     7050    1   DCL OP$ PTR;
     2327     7051
     2328     7052
     2329     7053        /**/
     2330     7054        /*  REFS */
     2331     7055        /**/
     2332     7056        %KV_VDO_ALL_E;
     2333     7135    1   DCL SC_BADSYMBEVST ENTRY CONV(2,0);
     2334     7136    1   DCL SC_BADSYMBEVENT ENTRY CONV(2,0);
     2335     7137    1   DCL SC_BADSYMBSTATE ENTRY CONV(2,0);
     2336     7138    1   DCL FOM$REL            ENTRY(1) ALTRET;
     2337     7139    1   DCL FOM$TIMR           ENTRY(1);
     2338     7140    1   DCL KCA$TELLAU         ENTRY(3) ALTRET;
     2339     7141    1   DCL KIA$FCNO ENTRY (3) ALTRET;
     2340     7142    1   DCL KQP$DISC           ENTRY(1) ALTRET;
     2341     7143    1   DCL KQX$LDASR          ENTRY(1);
     2342     7144    1   DCL SSC$MONTIMR        ENTRY(3);
     2343     7145
     2344     7146
     2345     7147        /**/
     2346     7148        /* SUBS */
     2347     7149        /**/
     2348     7150        %EQU_CG;
     2349     7198        /**/
     2350     7199        /**/
     2351     7200                                /* RUN THE WHOLE THING INHIBITED */
     2352     7201    2           DO INHIBIT;

     2353     7202                                /* GET THE CURRENT STATE */
     2354     7203    2           STATE=FO$SYMB.STATE;

   7203  0 000002   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000003   000012 236300                    LDQ   ! 10,,PR0
         0 000004   000017 376207                    ANQ   ! 15,DL
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:330  
         0 000005   200060 756300                    STQ   ! STATE,,AUTO

     2355     7204    2           LDCT$=NK$LDCT$(FO$SYMB.DEVLDCTX);

   7204  0 000006   000010 720300                    LXL0  ! 8,,PR0
         0 000007   000000 471600 xsym               LDP1  ! N$DCT$$
         0 000010   100000 236310                    LDQ   ! 0,X0,PR1
         0 000011   200062 756300                    STQ   ! LDCT$,,AUTO

     2356     7205                                /* IF EVENT DEMANDS A SPECIFIC OLD STATE,
     2357     7206                                   THEN VERIFY IT */
     2358     7207    2           IF FO$SEVNT.OLDSTATE~=0

   7207  0 000012   200004 473700                    LDP3  ! @FO$SEVNT,,AUTO
         0 000013   300000 236300                    LDQ   ! 0,,PR3
         0 000014   000777 316203                    CANQ  ! 511,DU
         0 000015   000025 600200 0                  TZE   ! s:7210
         0 000016   300000 236300                    LDQ   ! 0,,PR3
         0 000017   000022 772200                    QRL   ! 18
         0 000020   000777 376207                    ANQ   ! 511,DL
         0 000021   200060 116300                    CMPQ  ! STATE,,AUTO
         0 000022   000025 600200 0                  TZE   ! s:7210

     2359     7208    2           AND FO$SEVNT.OLDSTATE~=STATE THEN CALL BADEVST;

   7208  0 000023   000626 701200 0                  TSX1  ! BADEVST
         0 000024   000000 011200                    NOP   ! 0

     2360     7209                                /* CHECK FOR BAD FLAGS */
     2361     7210    2           IF (FO$SEVNT.BADFLG&FO$SYMB.EFLGB) THEN CALL BADEVST;

   7210  0 000025   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000026   000012 236300                    LDQ   ! 10,,PR0
         0 000027   000030 736200                    QLS   ! 24
         0 000030   740000 376203                    ANQ   ! -16384,DU
         0 000031   200074 756300                    STQ   ! @INFOWORD+2,,AUTO
         0 000032   200004 471700                    LDP1  ! @FO$SEVNT,,AUTO
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:331  
         0 000033   100000 236300                    LDQ   ! 0,,PR1
         0 000034   000027 736200                    QLS   ! 23
         0 000035   740000 376203                    ANQ   ! -16384,DU
         0 000036   200074 376300                    ANQ   ! @INFOWORD+2,,AUTO
         0 000037   000042 600200 0                  TZE   ! s:7212

   7210  0 000040   000626 701200 0                  TSX1  ! BADEVST
         0 000041   000000 011200                    NOP   ! 0

     2362     7211                                /* DECIDE WHAT SORT OF EVENT IT IS */
     2363     7212    2           IF FO$SEVNT.SPECIAL='0'B THEN

   7212  0 000042   200004 470700                    LDP0  ! @FO$SEVNT,,AUTO
         0 000043   000000 236300                    LDQ   ! 0,,PR0
         0 000044   400000 316207                    CANQ  ! -131072,DL
         0 000045   000060 601200 0                  TNZ   ! s:7240

     2364     7213    3   NOSPC:    DO;

   7213  0 000046                       NOSPC        null
     2365     7214                                /* SIMPLE STATE-CHANGE EVENT.  IF ALL
     2366     7215                                   ASYNC EVENT FLAGS ARE CLEAR, THEN JUST
     2367     7216                                   CHANGE STATE AND RETURN */
     2368     7217    3             IF FO$SYMB.EFLGB='0'B THEN

   7217  0 000046   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000047   000012 236300                    LDQ   ! 10,,PR0
         0 000050   007400 316207                    CANQ  ! 3840,DL
         0 000051   000357 601200 0                  TNZ   ! REPORT_IN

     2369     7218    4               DO;

     2370     7219    4               FO$SYMB.STATE=FO$SEVNT.NEWSTATE;

   7219  0 000052   200004 471700                    LDP1  ! @FO$SEVNT,,AUTO
         0 000053   100000 236300                    LDQ   ! 0,,PR1
         0 000054   000012 676300                    ERQ   ! 10,,PR0
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:332  
         0 000055   000017 376207                    ANQ   ! 15,DL
         0 000056   000012 656300                    ERSQ  ! 10,,PR0

     2371     7220    4               RETURN;

   7220  0 000057   000000 702200 xent               TSX2  ! X66_ARET

     2372     7221    4               END;
     2373     7222                                /* ASYNC EVENT FLAGS NOT CLEAR.  EXAMINE
     2374     7223                                   THEM AND DO THAT WHICH IS INDICATED.
     2375     7224                                   IN ANY CASE, ALTRET SO THE CALLER KNOWS
     2376     7225                                   HE'S BEEN INTERRUPTED.  HE WILL TYPICALLY
     2377     7226                                   JUST EXIT, KNOWING THAT WE'VE DONE
     2378     7227                                   WHAT'S REQUIRED */
     2379     7228    3             ELSE GOTO REPORT_IN;
     2380     7229    3             END;
     2381     7230                                /* SPECIAL EVENT */
     2382     7231    2           ELSE
     2383     7232    3             DO;

     2384     7233        /**
     2385     7234         **
     2386     7235         **
     2387     7236         **      VECTOR ON SPECIAL EVENT CODE
     2388     7237         **
     2389     7238         **
     2390     7239         **/
     2391     7240    4               DO CASE (FO$SEVNT.EVENT);

   7240  0 000060   000000 236300                    LDQ   ! 0,,PR0
         0 000061   000033 772200                    QRL   ! 27
         0 000062   000015 116207                    CMPQ  ! 13,DL
         0 000063   000065 602206 0                  TNC   ! s:7240+5,QL
         0 000064   000355 710200 0                  TRA   ! s:7375
         0 000065   000355 710200 0                  TRA   ! s:7375
         0 000066   000102 710200 0                  TRA   ! s:7248
         0 000067   000355 710200 0                  TRA   ! s:7375
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:333  
         0 000070   000355 710200 0                  TRA   ! s:7375
         0 000071   000355 710200 0                  TRA   ! s:7375
         0 000072   000257 710200 0                  TRA   ! s:7317
         0 000073   000317 710200 0                  TRA   ! s:7341
         0 000074   000350 710200 0                  TRA   ! s:7360
         0 000075   000155 710200 0                  TRA   ! s:7275
         0 000076   000354 710200 0                  TRA   ! s:7368
         0 000077   000355 710200 0                  TRA   ! s:7375
         0 000100   000120 710200 0                  TRA   ! s:7261
         0 000101   000120 710200 0                  TRA   ! s:7261

     2392     7241        /**
     2393     7242         **
     2394     7243         **      SYMBIONT GRANULE WRITTEN
     2395     7244         **
     2396     7245         **/
     2397     7246                                      /* Symbiont write done event */
     2398     7247    4                 CASE (FOSE_SWDN#);

     2399     7248    4                   IF LDCT$->NK$LDCT.DFLG.LOCAL THEN

   7248  0 000102   200062 471700                    LDP1  ! LDCT$,,AUTO
         0 000103   100006 236300                    LDQ   ! 6,,PR1
         0 000104   002000 316207                    CANQ  ! 1024,DL
         0 000105   000113 600200 0                  TZE   ! s:7253

     2400     7249    4                    IF STATE = FOMS_DVIO# THEN

   7249  0 000106   200060 235300                    LDA   ! STATE,,AUTO
         0 000107   000003 115207                    CMPA  ! 3,DL
         0 000110   000046 600200 0                  TZE   ! NOSPC

     2401     7250    4                     GOTO NOSPC;
     2402     7251    4                    ELSE
     2403     7252    4                     CALL BADEVST;

   7252  0 000111   000626 701200 0                  TSX1  ! BADEVST
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:334  
         0 000112   000000 011200                    NOP   ! 0

     2404     7253    4                   IF NOT FO$SYMB.EFLGB.HLTR THEN GOTO NOSPC;

   7253  0 000113   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000114   000012 236300                    LDQ   ! 10,,PR0
         0 000115   004000 316207                    CANQ  ! 2048,DL
         0 000116   000046 600200 0                  TZE   ! NOSPC

     2405     7254    4                   ALTRETURN;

   7254  0 000117   000000 702200 xent               TSX2  ! X66_AALT

     2406     7255        /**
     2407     7256         **
     2408     7257         **      FINISHED SPACING
     2409     7258         **
     2410     7259         **/
     2411     7260    4                 CASE (FOSE_FSPA#,FOSE_SPEF#);

     2412     7261    4                   IF FO$SYMB.EFLGB THEN GOTO REPORT_IN;

   7261  0 000120   200003 471700                    LDP1  ! @FO$SYMB,,AUTO
         0 000121   100012 236300                    LDQ   ! 10,,PR1
         0 000122   007400 316207                    CANQ  ! 3840,DL
         0 000123   000357 601200 0                  TNZ   ! REPORT_IN

     2413     7262    4                   FO$SYMB.STATE=FOMS_ACTV#;

   7262  0 000124   000000 376200 1                  ANQ   ! 0
         0 000125   000006 276207                    ORQ   ! 6,DL
         0 000126   100012 756300                    STQ   ! 10,,PR1

     2414     7263    4                   CALL FOM$REL (FO$SYMB);

   7263  0 000127   200003 630700                    EPPR0 ! @FO$SYMB,,AUTO
         0 000130   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:335  
         0 000131   000000 701200 xent               TSX1  ! FOM$REL
         0 000132   000000 011200                    NOP   ! 0

     2415     7264    4                   IF FO$SYMB.EFLGB THEN GOTO REPORT_IN;

   7264  0 000133   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000134   000012 236300                    LDQ   ! 10,,PR0
         0 000135   007400 316207                    CANQ  ! 3840,DL
         0 000136   000357 601200 0                  TNZ   ! REPORT_IN

     2416     7265    4                   FO$SYMB.SPACING='0'B;

   7265  0 000137   000001 236200 1                  LDQ   ! 1
         0 000140   000012 356300                    ANSQ  ! 10,,PR0

     2417     7266    4                   FO$SYMB.STATE=FOMS_HELD#;

   7266  0 000141   000012 236300                    LDQ   ! 10,,PR0
         0 000142   000000 376200 1                  ANQ   ! 0
         0 000143   000005 276207                    ORQ   ! 5,DL
         0 000144   000012 756300                    STQ   ! 10,,PR0

     2418     7267    4                   CALL TELLAU (%CG_SFSPA#,FO$SYMB.BR);

   7267  0 000145   200003 236300                    LDQ   ! @FO$SYMB,,AUTO
         0 000146   000003 036203                    ADLQ  ! 3,DU
         0 000147   200072 756300                    STQ   ! @EVENT+1,,AUTO
         0 000150   000003 236200 1                  LDQ   ! 3
         0 000151   200071 756300                    STQ   ! LDCT$+7,,AUTO
         0 000152   000645 701200 0                  TSX1  ! TELLAU
         0 000153   000000 011200                    NOP   ! 0

     2419     7268    4                   RETURN;

   7268  0 000154   000000 702200 xent               TSX2  ! X66_ARET

     2420     7269        /**
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:336  
     2421     7270         **
     2422     7271         **      HALT SYMBIONT REQUEST
     2423     7272         **
     2424     7273         **/
     2425     7274    4                 CASE (FOSE_HLTR#);

     2426     7275    5                     DO CASE (HLTRSN);

   7275  0 000155   200005 471700                    LDP1  ! @INFO,,AUTO
         0 000156   100000 235300                    LDA   ! 0,,PR1
         0 000157   000005 115207                    CMPA  ! 5,DL
         0 000160   000162 602205 0                  TNC   ! s:7275+5,AL
         0 000161   000254 710200 0                  TRA   ! s:7307
         0 000162   000254 710200 0                  TRA   ! s:7307
         0 000163   000167 710200 0                  TRA   ! s:7277
         0 000164   000223 710200 0                  TRA   ! s:7287
         0 000165   000233 710200 0                  TRA   ! s:7294
         0 000166   000233 710200 0                  TRA   ! s:7294

     2427     7276    5                       CASE (FOHR_OUTS#);

     2428     7277    5                         IF (FO$SYMB.EFLGB) THEN ALTRETURN;

   7277  0 000167   200003 473700                    LDP3  ! @FO$SYMB,,AUTO
         0 000170   300012 236300                    LDQ   ! 10,,PR3
         0 000171   007400 316207                    CANQ  ! 3840,DL
         0 000172   000174 600200 0                  TZE   ! s:7278

   7277  0 000173   000000 702200 xent               TSX2  ! X66_AALT

     2429     7278    5                         IF FO$SYMB.STATE=FOMS_HELD# THEN RETURN;

   7278  0 000174   300012 236300                    LDQ   ! 10,,PR3
         0 000175   000017 376207                    ANQ   ! 15,DL
         0 000176   000005 116207                    CMPQ  ! 5,DL
         0 000177   000201 601200 0                  TNZ   ! s:7279

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:337  
   7278  0 000200   000000 702200 xent               TSX2  ! X66_ARET

     2430     7279    5                         FO$SYMB.EFLGB.HLTR='1'B;

   7279  0 000201   004000 236207                    LDQ   ! 2048,DL
         0 000202   300012 256300                    ORSQ  ! 10,,PR3

     2431     7280    5                         FO$SYMB.HLTRSN=FOHR_OUTS#;

   7280  0 000203   000001 236207                    LDQ   ! 1,DL
         0 000204   300011 552304                    STBQ  ! 9,'04'O,PR3

     2432     7281    5                         IF FO$SYMB.STATE=FOMS_IDLE# THEN GOTO START_HALT;

   7281  0 000205   300012 236300                    LDQ   ! 10,,PR3
         0 000206   000017 316207                    CANQ  ! 15,DL
         0 000207   000251 600200 0                  TZE   ! START_HALT

     2433     7282    5                         IF  FO$SYMB.STATE = FOMS_DVIO#

   7282  0 000210   300012 236300                    LDQ   ! 10,,PR3
         0 000211   000017 376207                    ANQ   ! 15,DL
         0 000212   000003 116207                    CMPQ  ! 3,DL
         0 000213   000222 601200 0                  TNZ   ! s:7285
         0 000214   200062 474700                    LDP4  ! LDCT$,,AUTO
         0 000215   400006 236300                    LDQ   ! 6,,PR4
         0 000216   000031 736200                    QLS   ! 25
         0 000217   400000 376203                    ANQ   ! -131072,DU
         0 000220   400000 676203                    ERQ   ! -131072,DU
         0 000221   000251 601200 0                  TNZ   ! START_HALT

     2434     7283    5                         AND ~LDCT$->NK$LDCT.DFLG.LOCAL THEN
     2435     7284    5                          GOTO START_HALT;
     2436     7285    5                         RETURN;

   7285  0 000222   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:338  
     2437     7286    5                       CASE (FOHR_NMEM#);

     2438     7287    5                         IF FO$SYMB.EFLGB='0'B THEN

   7287  0 000223   200003 473700                    LDP3  ! @FO$SYMB,,AUTO
         0 000224   300012 236300                    LDQ   ! 10,,PR3
         0 000225   007400 316207                    CANQ  ! 3840,DL
         0 000226   000357 601200 0                  TNZ   ! REPORT_IN

     2439     7288    6                           DO;

     2440     7289    6                           FO$SYMB.STATE=FOMS_HELD#;

   7289  0 000227   000000 376200 1                  ANQ   ! 0
         0 000230   000005 276207                    ORQ   ! 5,DL
         0 000231   300012 756300                    STQ   ! 10,,PR3

     2441     7290    6                           RETURN;

   7290  0 000232   000000 702200 xent               TSX2  ! X66_ARET

     2442     7291    6                           END;
     2443     7292    5                         ELSE GOTO REPORT_IN;
     2444     7293    5                       CASE (FOHR_FERR#,FOHR_TERR#);

     2445     7294    5                         IF FO$SYMB.EFLGB.IDSC THEN GOTO REPORT_IN;

   7294  0 000233   200003 473700                    LDP3  ! @FO$SYMB,,AUTO
         0 000234   300012 236300                    LDQ   ! 10,,PR3
         0 000235   000400 316207                    CANQ  ! 256,DL
         0 000236   000357 601200 0                  TNZ   ! REPORT_IN

     2446     7295    5                         FO$SYMB.EFLGB.HLTR='1'B;

   7295  0 000237   004000 236207                    LDQ   ! 2048,DL
         0 000240   300012 256300                    ORSQ  ! 10,,PR3

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:339  
     2447     7296    5                         FO$SYMB.HLTRSN=HLTRSN;

   7296  0 000241   100000 236300                    LDQ   ! 0,,PR1
         0 000242   300011 552304                    STBQ  ! 9,'04'O,PR3

     2448     7297    5                         IF FO$SYMB.EFLGB.SHTD THEN

   7297  0 000243   300012 236300                    LDQ   ! 10,,PR3
         0 000244   002000 316207                    CANQ  ! 1024,DL
         0 000245   000251 600200 0                  TZE   ! START_HALT

     2449     7298    6                           DO;

     2450     7299    6   TELL_HALT:              ;

   7299  0 000246                       TELL_HALT    null
     2451     7300    6                           CALL DO_TELLHLT ALTRET(REPORT_IN);

   7300  0 000246   000506 701200 0                  TSX1  ! DO_TELLHLT
         0 000247   000357 702200 0                  TSX2  ! REPORT_IN

     2452     7301    6                           RETURN;

   7301  0 000250   000000 702200 xent               TSX2  ! X66_ARET

   7297  0 000251                       START_HALT   null
     2453     7302    6                           END;
     2454     7303    5   START_HALT:           ;
     2455     7304    5                         CALL DO_STARTHLT ALTRET(REPORT_IN);

   7304  0 000251   000401 701200 0                  TSX1  ! DO_STARTHLT
         0 000252   000357 702200 0                  TSX2  ! REPORT_IN

     2456     7305    5                         RETURN;

   7305  0 000253   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:340  
     2457     7306    5                       CASE (ELSE);

     2458     7307    5                         CALL BADEVENT;

   7307  0 000254   000614 701200 0                  TSX1  ! BADEVENT
         0 000255   000000 011200                    NOP   ! 0

     2459     7308
     2460     7309                  /* END OF HLTRSN DOCASE */
     2461     7310    5                     END;

   7310  0 000256   000357 710200 0                  TRA   ! REPORT_IN

     2462     7311        /**
     2463     7312         **
     2464     7313         **      SYMBIONT HALTED MESSAGE FROM FEP
     2465     7314         **
     2466     7315         **/
     2467     7316    4                 CASE (FOSE_SHTD#);

     2468     7317    4                   FO$SYMB.BR=BLKREC;

   7317  0 000257   200005 471700                    LDP1  ! @INFO,,AUTO
         0 000260   100000 236300                    LDQ   ! 0,,PR1
         0 000261   200003 473700                    LDP3  ! @FO$SYMB,,AUTO
         0 000262   300003 756300                    STQ   ! 3,,PR3

     2469     7318    4                   FO$SYMB.EFLGB.SHTD='1'B;

   7318  0 000263   002000 236207                    LDQ   ! 1024,DL
         0 000264   300012 256300                    ORSQ  ! 10,,PR3

     2470     7319    5                     DO CASE (STATE);

   7319  0 000265   200060 235300                    LDA   ! STATE,,AUTO
         0 000266   000010 115207                    CMPA  ! 8,DL
         0 000267   000271 602205 0                  TNC   ! s:7319+4,AL
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:341  
         0 000270   000314 710200 0                  TRA   ! s:7332
         0 000271   000302 710200 0                  TRA   ! s:7323
         0 000272   000301 710200 0                  TRA   ! s:7321
         0 000273   000305 710200 0                  TRA   ! s:7326
         0 000274   000302 710200 0                  TRA   ! s:7323
         0 000275   000314 710200 0                  TRA   ! s:7332
         0 000276   000314 710200 0                  TRA   ! s:7332
         0 000277   000305 710200 0                  TRA   ! s:7326
         0 000300   000313 710200 0                  TRA   ! s:7330

     2471     7320    5                       CASE (FOMS_HOLD#);

     2472     7321    5                         GOTO TELL_HALT;

   7321  0 000301   000246 710200 0                  TRA   ! TELL_HALT

     2473     7322    5                       CASE (FOMS_IDLE#,FOMS_DVIO#);

     2474     7323    5                         FO$SYMB.HLTRSN=FOHR_HAND#;

   7323  0 000302   000005 236207                    LDQ   ! 5,DL
         0 000303   300011 552304                    STBQ  ! 9,'04'O,PR3

     2475     7324    5                         GOTO TELL_HALT;

   7324  0 000304   000246 710200 0                  TRA   ! TELL_HALT

     2476     7325    5                       CASE (FOMS_DKIO#,FOMS_ACTV#);

     2477     7326    5                         IF FO$SYMB.EFLGB.HLTR = '0'B THEN

   7326  0 000305   300012 236300                    LDQ   ! 10,,PR3
         0 000306   004000 316207                    CANQ  ! 2048,DL
         0 000307   000312 601200 0                  TNZ   ! s:7328

     2478     7327    5                          FO$SYMB.HLTRSN=FOHR_HAND#;

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:342  
   7327  0 000310   000005 236207                    LDQ   ! 5,DL
         0 000311   300011 552304                    STBQ  ! 9,'04'O,PR3

     2479     7328    5                         RETURN;

   7328  0 000312   000000 702200 xent               TSX2  ! X66_ARET

     2480     7329    5                       CASE (FOMS_HRQW#);

     2481     7330    5                         RETURN;

   7330  0 000313   000000 702200 xent               TSX2  ! X66_ARET

     2482     7331    5                       CASE (ELSE);

     2483     7332    5                         CALL BADSTATE;

   7332  0 000314   000621 701200 0                  TSX1  ! BADSTATE
         0 000315   000000 011200                    NOP   ! 0

     2484     7333                    /* END OF STATE DOCASE */
     2485     7334    5                     END;

   7334  0 000316   000357 710200 0                  TRA   ! REPORT_IN

     2486     7335        /**
     2487     7336         **
     2488     7337         **      INITIAL DISCONNECT EVENT
     2489     7338         **
     2490     7339         **/
     2491     7340    4                 CASE (FOSE_IDSC#);

     2492     7341    4                   FO$SYMB.BR=BLKREC;

   7341  0 000317   200005 471700                    LDP1  ! @INFO,,AUTO
         0 000320   100000 236300                    LDQ   ! 0,,PR1
         0 000321   200003 473700                    LDP3  ! @FO$SYMB,,AUTO
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:343  
         0 000322   300003 756300                    STQ   ! 3,,PR3

     2493     7342    4                   FO$SYMB.EFLGB.IDSC='1'B;

   7342  0 000323   000400 236207                    LDQ   ! 256,DL
         0 000324   300012 256300                    ORSQ  ! 10,,PR3

     2494     7343    5                     DO CASE (STATE);

   7343  0 000325   200060 235300                    LDA   ! STATE,,AUTO
         0 000326   000010 115207                    CMPA  ! 8,DL
         0 000327   000331 602205 0                  TNC   ! s:7343+4,AL
         0 000330   000345 710200 0                  TRA   ! s:7350
         0 000331   000341 710200 0                  TRA   ! s:7345
         0 000332   000341 710200 0                  TRA   ! s:7345
         0 000333   000344 710200 0                  TRA   ! s:7348
         0 000334   000341 710200 0                  TRA   ! s:7345
         0 000335   000345 710200 0                  TRA   ! s:7350
         0 000336   000341 710200 0                  TRA   ! s:7345
         0 000337   000344 710200 0                  TRA   ! s:7348
         0 000340   000344 710200 0                  TRA   ! s:7348

     2495     7344    5                       CASE (FOMS_IDLE#,FOMS_HOLD#,FOMS_HELD#,FOMS_DVIO#);

     2496     7345    5                         CALL DO_IDSC;

   7345  0 000341   000566 701200 0                  TSX1  ! DO_IDSC
         0 000342   000000 011200                    NOP   ! 0

     2497     7346    5                         RETURN;

   7346  0 000343   000000 702200 xent               TSX2  ! X66_ARET

     2498     7347    5                       CASE (FOMS_DKIO#,FOMS_ACTV#,FOMS_HRQW#);

     2499     7348    5                         RETURN;

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:344  
   7348  0 000344   000000 702200 xent               TSX2  ! X66_ARET

     2500     7349    5                       CASE (ELSE);

     2501     7350    5                         CALL BADSTATE;

   7350  0 000345   000621 701200 0                  TSX1  ! BADSTATE
         0 000346   000000 011200                    NOP   ! 0

     2502     7351                    /* END OF STATE DOCASE */
     2503     7352    5                     END;

   7352  0 000347   000357 710200 0                  TRA   ! REPORT_IN

     2504     7353        /**
     2505     7354         **
     2506     7355         **      FINAL DISCONNECT EVENT
     2507     7356         **
     2508     7357         **/
     2509     7358    4                 CASE (FOSE_FDSC#);

     2510     7359
     2511     7360    4                   FO$SYMB.EFLGB.FDSC='1'B;

   7360  0 000350   200003 471700                    LDP1  ! @FO$SYMB,,AUTO
         0 000351   001000 236207                    LDQ   ! 512,DL
         0 000352   100012 256300                    ORSQ  ! 10,,PR1

     2512     7361    4                   RETURN;

   7361  0 000353   000000 702200 xent               TSX2  ! X66_ARET

     2513     7362        /**
     2514     7363         **
     2515     7364         **      HALT REQUEST RETRY EVENT
     2516     7365         **
     2517     7366         **/
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:345  
     2518     7367    4                 CASE (FOSE_HRQR#);

     2519     7368    4                   GOTO REPORT_IN;

   7368  0 000354   000357 710200 0                  TRA   ! REPORT_IN

     2520     7369        /**
     2521     7370         **
     2522     7371         **      UNKNOWN EVENT
     2523     7372         **
     2524     7373         **/
     2525     7374    4                 CASE (ELSE);

     2526     7375    4                   CALL BADEVENT;

   7375  0 000355   000614 701200 0                  TSX1  ! BADEVENT
         0 000356   000000 011200                    NOP   ! 0

     2527     7376        /**
     2528     7377         **      END OF SPECIAL EVENT DOCASE AND DO
     2529     7378         **/
     2530     7379    4               END;

     2531     7380    3             END;

   7375  0 000357                       REPORT_IN    null
     2532     7381        /***
     2533     7382         ***
     2534     7383         ***
     2535     7384         ***          WRAP UP PREVIOUS EVENTS
     2536     7385         ***
     2537     7386         ***
     2538     7387         ***/
     2539     7388    2   REPORT_IN:;
     2540     7389    2           IF FO$SYMB.EFLGB.IDSC THEN

   7389  0 000357   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:346  
         0 000360   000012 236300                    LDQ   ! 10,,PR0
         0 000361   000400 316207                    CANQ  ! 256,DL
         0 000362   000366 600200 0                  TZE   ! s:7395

     2541     7390    3             DO;

     2542     7391    3             CALL DO_IDSC;

   7391  0 000363   000566 701200 0                  TSX1  ! DO_IDSC
         0 000364   000000 011200                    NOP   ! 0

   7391  0 000365                       ALTRT        null
     2543     7392    3   ALTRT:    ;
     2544     7393    3             ALTRETURN;

   7393  0 000365   000000 702200 xent               TSX2  ! X66_AALT

     2545     7394    3             END;
     2546     7395    2           IF FO$SYMB.EFLGB.SHTD THEN

   7395  0 000366   002000 316207                    CANQ  ! 1024,DL
         0 000367   000373 600200 0                  TZE   ! s:7400

     2547     7396    3             DO;

     2548     7397    3             CALL DO_TELLHLT ALTRET(REPORT_IN);

   7397  0 000370   000506 701200 0                  TSX1  ! DO_TELLHLT
         0 000371   000357 702200 0                  TSX2  ! REPORT_IN

     2549     7398    3             ALTRETURN;

   7398  0 000372   000000 702200 xent               TSX2  ! X66_AALT

     2550     7399    3             END;
     2551     7400    2           IF FO$SYMB.EFLGB.HLTR THEN

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:347  
   7400  0 000373   004000 316207                    CANQ  ! 2048,DL
         0 000374   000400 600200 0                  TZE   ! s:7405

     2552     7401    3             DO;

     2553     7402    3             CALL DO_STARTHLT ALTRET(REPORT_IN);

   7402  0 000375   000401 701200 0                  TSX1  ! DO_STARTHLT
         0 000376   000357 702200 0                  TSX2  ! REPORT_IN

     2554     7403    3             ALTRETURN;

   7403  0 000377   000000 702200 xent               TSX2  ! X66_AALT

     2555     7404    3             END;
     2556     7405    2           END; /*DO INHIBIT*/

   7405  0 000400   000633 710000 0                  TRA     s:7498+2

     2557     7406        /**/
     2558     7407        /**/
     2559     7408    1   DO_STARTHLT: PROC ALTRET;

   7408  0 000401   200064 741300       DO_STARTHLT  STX1  ! LDCT$+2,,AUTO

     2560     7409    3           DO INHIBIT;

     2561     7410        /* RLCID = Remote Logical Connection ID */
     2562     7411    3           IF LDCT$->NK$LDCT.DFLG.LOCAL

   7411  0 000402   200062 470700                    LDP0  ! LDCT$,,AUTO
         0 000403   000006 236300                    LDQ   ! 6,,PR0
         0 000404   002000 316207                    CANQ  ! 1024,DL
         0 000405   000412 601200 0                  TNZ   ! s:7414
         0 000406   200003 471700                    LDP1  ! @FO$SYMB,,AUTO
         0 000407   100012 236300                    LDQ   ! 10,,PR1
         0 000410   040000 316207                    CANQ  ! 16384,DL
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:348  
         0 000411   000420 600200 0                  TZE   ! s:7418

     2563     7412    3           OR FO$SYMB.SPACING THEN
     2564     7413    4             DO;

     2565     7414    4             CALL DO_TELLHLT ALTRET(ALTRT);

   7414  0 000412   000506 701200 0                  TSX1  ! DO_TELLHLT
         0 000413   000416 702200 0                  TSX2  ! ALTRT

     2566     7415    4             RETURN;

   7415  0 000414   200064 221300                    LDX1  ! LDCT$+2,,AUTO
         0 000415   000001 702211                    TSX2  ! 1,X1

     2567     7416    4   ALTRT:    ALTRETURN;

   7416  0 000416   200064 221300       ALTRT        LDX1  ! LDCT$+2,,AUTO
         0 000417   000000 702211                    TSX2  ! 0,X1

     2568     7417    4             END;
     2569     7418    3           FO$SYMB.STATE=FOMS_ACTV#;

   7418  0 000420   000000 376200 1                  ANQ   ! 0
         0 000421   000006 276207                    ORQ   ! 6,DL
         0 000422   100012 756300                    STQ   ! 10,,PR1

     2570     7419    3           K$RWPARM = K_RWPARM_CON;

   7419  0 000423   000100 100600                    MLR   ! fill='000'O
         0 000424   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         0 000425   200006 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

     2571     7420        /* LSTRCRID = (request) Last Record ID */
     2572     7421    3           K$RWPARM.MRKTYP = %KV_VDOMRKTYP_SNDLSTRCRID;

   7421  0 000426   004000 236207                    LDQ   ! 2048,DL
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:349  
         0 000427   200046 552310                    STBQ  ! K$RWPARM+32,'10'O,AUTO

     2573     7422    3           CALL KIA$FCNO (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSMRK,K$RWPARM) ALTRET (WAIT);

   7422  0 000430   200006 633700                    EPPR3 ! K$RWPARM,,AUTO
         0 000431   200076 453700                    STP3  ! @INFOWORD+4,,AUTO
         0 000432   000005 236200 1                  LDQ   ! 5
         0 000433   200062 235300                    LDA   ! LDCT$,,AUTO
         0 000434   200074 757300                    STAQ  ! @INFOWORD+2,,AUTO
         0 000435   200074 630700                    EPPR0 ! @INFOWORD+2,,AUTO
         0 000436   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         0 000437   000000 701200 xent               TSX1  ! KIA$FCNO
         0 000440   000456 702200 0                  TSX2  ! WAIT

     2574     7423    3           IF FO$SYMB.EFLGB.IDSC OR FO$SYMB.EFLGB.SHTD THEN ALTRETURN;

   7423  0 000441   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000442   000012 236300                    LDQ   ! 10,,PR0
         0 000443   000400 316207                    CANQ  ! 256,DL
         0 000444   000447 601200 0                  TNZ   ! s:7423+6
         0 000445   002000 316207                    CANQ  ! 1024,DL
         0 000446   000451 600200 0                  TZE   ! s:7424

   7423  0 000447   200064 221300                    LDX1  ! LDCT$+2,,AUTO
         0 000450   000000 702211                    TSX2  ! 0,X1

     2575     7424    3           ELSE FO$SYMB.STATE=FOMS_HOLD#;

   7424  0 000451   000000 376200 1                  ANQ   ! 0
         0 000452   000001 276207                    ORQ   ! 1,DL
         0 000453   000012 756300                    STQ   ! 10,,PR0

     2576     7425    3           RETURN;

   7425  0 000454   200064 221300                    LDX1  ! LDCT$+2,,AUTO
         0 000455   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:350  
   7423  0 000456                       WAIT         null
     2577     7426    3   WAIT:   ;
     2578     7427    3           FO$SYMB.STATE=FOMS_HRQW#;

   7427  0 000456   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000457   000012 236300                    LDQ   ! 10,,PR0
         0 000460   000000 376200 1                  ANQ   ! 0
         0 000461   000007 276207                    ORQ   ! 7,DL
         0 000462   000012 756300                    STQ   ! 10,,PR0

     2579     7428    3           FO$SYMB.HRQWAIT='1'B;

   7428  0 000463   200000 236207                    LDQ   ! 65536,DL
         0 000464   000012 256300                    ORSQ  ! 10,,PR0

     2580     7429    3           CALL SSC$MONTIMR (FOM_DLY#,ENTADDR(FOM$TIMR),ADDR(FO$SYMB));

   7429  0 000465   000000 636200 xent               EAQ   ! FOM$TIMR
         0 000466   200074 756300                    STQ   ! @INFOWORD+2,,AUTO
         0 000467   200003 236300                    LDQ   ! @FO$SYMB,,AUTO
         0 000470   200075 756300                    STQ   ! @INFOWORD+3,,AUTO
         0 000471   200075 631700                    EPPR1 ! @INFOWORD+3,,AUTO
         0 000472   200100 451700                    STP1  ! @INFOWORD+6,,AUTO
         0 000473   200074 633700                    EPPR3 ! @INFOWORD+2,,AUTO
         0 000474   200077 453700                    STP3  ! @INFOWORD+5,,AUTO
         0 000475   000007 236200 1                  LDQ   ! 7
         0 000476   200076 756300                    STQ   ! @INFOWORD+4,,AUTO
         0 000477   200076 630700                    EPPR0 ! @INFOWORD+4,,AUTO
         0 000500   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         0 000501   000000 701200 xent               TSX1  ! SSC$MONTIMR
         0 000502   000000 011200                    NOP   ! 0

     2581     7430    3           RETURN;

   7430  0 000503   200064 221300                    LDX1  ! LDCT$+2,,AUTO
         0 000504   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:351  
     2582     7431    3           END; /*DO INHIBIT*/

     2583     7432    2   END DO_STARTHLT;

   7432  0 000505   000001 702211                    TSX2  ! 1,X1

     2584     7433        /**/
     2585     7434    1   DO_TELLHLT: PROC ALTRET;

   7434  0 000506   200066 741300       DO_TELLHLT   STX1  ! LDCT$+4,,AUTO

     2586     7435    3           DO INHIBIT;

     2587     7436    3           ECCSC=%CG_STHLD#;

   7436  0 000507   000013 235207                    LDA   ! 11,DL
         0 000510   200061 755300                    STA   ! ECCSC,,AUTO

     2588     7437    3           IF FO$SYMB.HLTRSN = FOHR_FERR# THEN

   7437  0 000511   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000512   000011 236300                    LDQ   ! 9,,PR0
         0 000513   000777 376207                    ANQ   ! 511,DL
         0 000514   000003 116207                    CMPQ  ! 3,DL
         0 000515   000521 601200 0                  TNZ   ! s:7440

     2589     7438    3            ECCSC = %CG_SFERR#;

   7438  0 000516   000014 235207                    LDA   ! 12,DL
         0 000517   200061 755300                    STA   ! ECCSC,,AUTO
         0 000520   000525 710200 0                  TRA   ! s:7442

     2590     7439    3           ELSE
     2591     7440    3            IF FO$SYMB.HLTRSN = FOHR_TERR# THEN

   7440  0 000521   000004 116207                    CMPQ  ! 4,DL
         0 000522   000525 601200 0                  TNZ   ! s:7442
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:352  

     2592     7441    3             ECCSC = %CG_STERR#;

   7441  0 000523   000015 235207                    LDA   ! 13,DL
         0 000524   200061 755300                    STA   ! ECCSC,,AUTO

     2593     7442    3           FO$SYMB.STATE=FOMS_ACTV#;

   7442  0 000525   000012 236300                    LDQ   ! 10,,PR0
         0 000526   000000 376200 1                  ANQ   ! 0
         0 000527   000006 276207                    ORQ   ! 6,DL
         0 000530   000012 756300                    STQ   ! 10,,PR0

     2594     7443    3           CALL FOM$REL (FO$SYMB);

   7443  0 000531   200003 630700                    EPPR0 ! @FO$SYMB,,AUTO
         0 000532   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         0 000533   000000 701200 xent               TSX1  ! FOM$REL
         0 000534   000000 011200                    NOP   ! 0

     2595     7444    3           IF FO$SYMB.EFLGB.IDSC THEN ALTRETURN;

   7444  0 000535   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000536   000012 236300                    LDQ   ! 10,,PR0
         0 000537   000400 316207                    CANQ  ! 256,DL
         0 000540   000543 600200 0                  TZE   ! s:7445

   7444  0 000541   200066 221300                    LDX1  ! LDCT$+4,,AUTO
         0 000542   000000 702211                    TSX2  ! 0,X1

     2596     7445    3           FO$SYMB.STATE=FOMS_HELD#;

   7445  0 000543   000000 376200 1                  ANQ   ! 0
         0 000544   000005 276207                    ORQ   ! 5,DL
         0 000545   000012 756300                    STQ   ! 10,,PR0

     2597     7446    3           FO$SYMB.EFLGB.SHTD='0'B;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:353  

   7446  0 000546   000010 236200 1                  LDQ   ! 8
         0 000547   000012 356300                    ANSQ  ! 10,,PR0

     2598     7447    3           FO$SYMB.EFLGB.HLTR='0'B;

   7447  0 000550   000011 236200 1                  LDQ   ! 9
         0 000551   000012 356300                    ANSQ  ! 10,,PR0

     2599     7448    3           FO$SYMB.SPACING='0'B;

   7448  0 000552   000001 236200 1                  LDQ   ! 1
         0 000553   000012 356300                    ANSQ  ! 10,,PR0

     2600     7449    3           CALL TELLAU (ECCSC,FO$SYMB.BR);

   7449  0 000554   200003 236300                    LDQ   ! @FO$SYMB,,AUTO
         0 000555   000003 036203                    ADLQ  ! 3,DU
         0 000556   200072 756300                    STQ   ! @EVENT+1,,AUTO
         0 000557   200061 631700                    EPPR1 ! ECCSC,,AUTO
         0 000560   200071 451700                    STP1  ! LDCT$+7,,AUTO
         0 000561   000645 701200 0                  TSX1  ! TELLAU
         0 000562   000000 011200                    NOP   ! 0

     2601     7450    3           RETURN;

   7450  0 000563   200066 221300                    LDX1  ! LDCT$+4,,AUTO
         0 000564   000001 702211                    TSX2  ! 1,X1

     2602     7451    3           END; /*DO INHIBIT*/

     2603     7452    2   END DO_TELLHLT;

   7452  0 000565   000001 702211                    TSX2  ! 1,X1

     2604     7453        /**/
     2605     7454    1   DO_IDSC: PROC;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:354  

   7454  0 000566   200064 741300       DO_IDSC      STX1  ! LDCT$+2,,AUTO

     2606     7455    3           DO INHIBIT;

     2607     7456    3           FO$SYMB.STATE=FOMS_ACTV#;

   7456  0 000567   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000570   000012 236300                    LDQ   ! 10,,PR0
         0 000571   000000 376200 1                  ANQ   ! 0
         0 000572   000006 276207                    ORQ   ! 6,DL
         0 000573   000012 756300                    STQ   ! 10,,PR0

     2608     7457    3           CALL FOM$REL (FO$SYMB);

   7457  0 000574   200003 630700                    EPPR0 ! @FO$SYMB,,AUTO
         0 000575   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         0 000576   000000 701200 xent               TSX1  ! FOM$REL
         0 000577   000000 011200                    NOP   ! 0

     2609     7458    3           FO$SYMB.STATE=FOMS_DCMP#;

   7458  0 000600   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000601   000012 236300                    LDQ   ! 10,,PR0
         0 000602   000000 376200 1                  ANQ   ! 0
         0 000603   000004 276207                    ORQ   ! 4,DL
         0 000604   000012 756300                    STQ   ! 10,,PR0

     2610     7459    3           CALL KQP$DISC (LDCT$->NK$LDCT);

   7459  0 000605   200062 630700                    EPPR0 ! LDCT$,,AUTO
         0 000606   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         0 000607   000000 701200 xent               TSX1  ! KQP$DISC
         0 000610   000000 011200                    NOP   ! 0

     2611     7460    3           RETURN;

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:355  
   7460  0 000611   200064 221300                    LDX1  ! LDCT$+2,,AUTO
         0 000612   000001 702211                    TSX2  ! 1,X1

     2612     7461    3           END; /*DO INHIBIT*/

     2613     7462    2   END DO_IDSC;

   7462  0 000613   000001 702211                    TSX2  ! 1,X1

     2614     7463        /**/
     2615     7464    1   BADEVENT: PROC;

   7464  0 000614   200064 741300       BADEVENT     STX1  ! LDCT$+2,,AUTO

     2616     7465    2         CALL SC_BADSYMBEVENT;

   7465  0 000615   000000 713400 xsym               CLIMB   SC_BADSYMBEVENT
         0 000616   000000 600000 xsid               climb   nvectors=         0

     2617     7466        /*S* SCREECH_CODE: FOM-S$BADSYMBEVENT
     2618     7467             TYPE:         SCREECH
     2619     7468             MESSAGE:      Bad event passed to FOM$EVENT
     2620     7469             REMARKS:      Either the event code passed to FOM$EVENT,
     2621     7470                           or the qualifier (e.g. HLTRSN) thereof,
     2622     7471                           was unknown.  Monitor auto being clobbered
     2623     7472                           is a possible culprit, but essentially this
     2624     7473                           screech should never occur. */
     2625     7474    2   END BADEVENT;

   7474  0 000617   200064 221300                    LDX1  ! LDCT$+2,,AUTO
         0 000620   000001 702211                    TSX2  ! 1,X1

     2626     7475        /**/
     2627     7476    1   BADSTATE: PROC;

   7476  0 000621   200064 741300       BADSTATE     STX1  ! LDCT$+2,,AUTO

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:356  
     2628     7477    2         CALL SC_BADSYMBSTATE;

   7477  0 000622   000000 713400 xsym               CLIMB   SC_BADSYMBSTATE
         0 000623   000000 600000 xsid               climb   nvectors=         0

     2629     7478        /*S* SCREECH_CODE: FOM-S$BADSYMBSTATE
     2630     7479             TYPE:         SCREECH
     2631     7480             MESSAGE:      FOM$EVENT found a symbiont in an unknown state
     2632     7481             REMARKS:      This screech occurs when FOM$EVENT finds a
     2633     7482                           symbiont in an unknown state.  This probably
     2634     7483                           is due to the LDCT containing the symbiont's
     2635     7484                           context having been clobbered.  */
     2636     7485    2   END BADSTATE;

   7485  0 000624   200064 221300                    LDX1  ! LDCT$+2,,AUTO
         0 000625   000001 702211                    TSX2  ! 1,X1

     2637     7486        /**/
     2638     7487    1   BADEVST: PROC;

   7487  0 000626   200064 741300       BADEVST      STX1  ! LDCT$+2,,AUTO

     2639     7488    2         CALL SC_BADSYMBEVST;

   7488  0 000627   000000 713400 xsym               CLIMB   SC_BADSYMBEVST
         0 000630   000000 600000 xsid               climb   nvectors=         0

     2640     7489        /*S* SCREECH_CODE: FOM-S$BADSYMBEVST
     2641     7490             TYPE:         SCREECH
     2642     7491             MESSAGE:      Bad event-state combination in FOM$EVENT
     2643     7492             REMARKS:      The event being reported to FOM$EVENT, and
     2644     7493                           the current state/flag-settings of the
     2645     7494                           symbiont involved, should never occur sim-
     2646     7495                           ultaneously.  The cause can be elicited by
     2647     7496                           determining the recent history of the symbiont
     2648     7497                           involved.                     */
     2649     7498    2   END BADEVST;
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:357  

   7498  0 000631   200064 221300                    LDX1  ! LDCT$+2,,AUTO
         0 000632   000001 702211                    TSX2  ! 1,X1
         0 000633   000636 710000 0                  TRA     s:7509

     2650     7499        /**/
     2651     7500        /**/
     2652     7501        /*F* NAME:         FOM$TELLAU
     2653     7502             PURPOSE:      To pass a special event to the OSCG AU
     2654     7503             DESCRIPTION:  Passes the symb context block, the event code,
     2655     7504                           and one word of info.  OUTSYM is passed the
     2656     7505                           appropriate special event message.
     2657     7506        */
     2658     7507    1   FOM$TELLAU: ENTRY (FO$SYMB,FO$SEVNT,INFO) ALTRET; /* !!Doesn't ALTRET!! */

   7507  0 000634   000000 700200 xent  FOM$TELLAU   TSX0  ! X66_AUTO_3
         0 000635   000102 000003                    ZERO    66,3

     2659     7508        /**/
     2660     7509    1         CALL TELLAU (ADDR(FO$SEVNT)->B$$WORD,INFO);

   7509  0 000636   200005 236100                    LDQ     @INFO,,AUTO
         0 000637   200072 756100                    STQ     @EVENT+1,,AUTO
         0 000640   200004 236100                    LDQ     @FO$SEVNT,,AUTO
         0 000641   200071 756100                    STQ     LDCT$+7,,AUTO
         0 000642   000645 701000 0                  TSX1    TELLAU
         0 000643   000000 011000                    NOP     0

     2661     7510    1         RETURN;

   7510  0 000644   000000 702200 xent               TSX2  ! X66_ARET

     2662     7511        /**/
     2663     7512        /*D* NAME:         TELLAU
     2664     7513             PURPOSE:      To event OUTSYM */
     2665     7514    1   TELLAU: PROC (EVENT,INFOWORD);

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:358  
   7514  0 000645   200070 741300       TELLAU       STX1  ! LDCT$+6,,AUTO

     2666     7515        /**/
     2667     7516    2   DCL EVENT UBIN WORD;
     2668     7517    2   DCL INFOWORD UBIN WORD;
     2669     7518        /**/
     2670     7519    3           DO INHIBIT;

     2671     7520    3           LDCT$=NK$LDCT$(FO$SYMB.DEVLDCTX);

   7520  0 000646   200003 470700                    LDP0  ! @FO$SYMB,,AUTO
         0 000647   000010 720300                    LXL0  ! 8,,PR0
         0 000650   000000 471600 xsym               LDP1  ! N$DCT$$
         0 000651   100000 236310                    LDQ   ! 0,X0,PR1
         0 000652   200062 756300                    STQ   ! LDCT$,,AUTO

     2672     7521    3           CG$=LDCT$->NK$LDCT.CG$;

   7521  0 000653   200062 473700                    LDP3  ! LDCT$,,AUTO
         0 000654   300027 236300                    LDQ   ! 23,,PR3
         0 000655   200057 756300                    STQ   ! CG$,,AUTO

     2673     7522    3           CALL KQX$LDASR (CG$->KQ$CG);

   7522  0 000656   200057 630700                    EPPR0 ! CG$,,AUTO
         0 000657   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         0 000660   000000 701200 xent               TSX1  ! KQX$LDASR
         0 000661   000000 011200                    NOP   ! 0

     2674     7523    3           STA$=LDCT$->NK$LDCT.STA$;

   7523  0 000662   200062 470700                    LDP0  ! LDCT$,,AUTO
         0 000663   000012 236300                    LDQ   ! 10,,PR0
         0 000664   200056 756300                    STQ   ! STA$,,AUTO

     2675     7524    3           CALL KCA$TELLAU (STA$->KQ$STA,EVENT,INFOWORD);

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:359  
   7524  0 000665   200072 236300                    LDQ   ! @INFOWORD,,AUTO
         0 000666   200076 756300                    STQ   ! @INFOWORD+4,,AUTO
         0 000667   200071 236300                    LDQ   ! @EVENT,,AUTO
         0 000670   200056 235300                    LDA   ! STA$,,AUTO
         0 000671   200074 757300                    STAQ  ! @INFOWORD+2,,AUTO
         0 000672   200074 630700                    EPPR0 ! @INFOWORD+2,,AUTO
         0 000673   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         0 000674   000000 701200 xent               TSX1  ! KCA$TELLAU
         0 000675   000000 011200                    NOP   ! 0

     2676     7525    3           RETURN;

   7525  0 000676   200070 221300                    LDX1  ! LDCT$+6,,AUTO
         0 000677   000001 702211                    TSX2  ! 1,X1

     2677     7526    3           END;

     2678     7527    2   END TELLAU;

   7527  0 000700   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   1     000   777777 777760   777777 737777   000000 000017   000002 006000    ................
   1     004   000000 000040   000004 006000   000000 000062   000006 006000    ... .......2....
   1     010   777777 775777   777777 773777                                    ........
     2679     7528        /**/
     2680     7529        /**/
     2681     7530    1   END FOM$EVENT;
     2682     7531        /**/
     2683     7532        %EOD;

PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:360  
--  Include file information  --

   KQ_SUBS_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
      No diagnostics issued in procedure FOM$EVENT.
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:361  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    71-0-0/w PTR         r     1 @EVENT                     4-0-0/w PTR         r     1 @FO$SEVNT
     3-0-0/w PTR         r     1 @FO$SYMB                   5-0-0/w PTR         r     1 @INFO
    72-0-0/w PTR         r     1 @INFOWORD                 *0-0-0/w BIT         r     1 BLKREC
    57-0-0/w PTR         r     1 CG$                       61-0-0/w UBIN        r     1 ECCSC
    *0-0-0/w UBIN        r     1 EVENT                     *0-0-0/w STRC        r     1 FO$SEVNT
    *0-0-0/w STRC(720)   r     1 FO$SYMB                   *0-0-0/w UBIN        r     1 HLTRSN
    *0-0-0/w UBIN        r     1 INFO                      *0-0-0/w UBIN        r     1 INFOWORD
     6-0-0/d STRC(1404)  r     1 K$RWPARM                  62-0-0/w PTR         r     1 LDCT$
    56-0-0/w PTR         r     1 STA$                      60-0-0/w UBIN        r     1 STATE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON               0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 B$$WORD                    0-0-0/d STRC(6516)  r     1 KQ$CG
     0-0-0/d STRC(1296)  r     1 KQ$STA                     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)


   Procedure FOM$EVENT requires 449 words for executable code.
   Procedure FOM$EVENT requires 66 words of local(AUTO) storage.
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:362  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:363  
          MINI XREF LISTING

ALTRT IN PROCEDURE DO_STARTHLT
      7416**LABEL    7414--CALLALT
B$$WORD
      5599**DCL      7509<>CALL
BADEVENT
      7464**PROC     7307--CALL     7375--CALL
BADEVST
      7487**PROC     7208--CALL     7210--CALL     7252--CALL
BADSTATE
      7476**PROC     7332--CALL     7350--CALL
BLKREC
      5593**DCL      7317>>ASSIGN   7341>>ASSIGN
CG$
      7046**DCL      7521<<ASSIGN   7522>>CALL
DO_IDSC
      7454**PROC     7345--CALL     7391--CALL
DO_STARTHLT
      7408**PROC     7304--CALL     7402--CALL
DO_TELLHLT
      7434**PROC     7300--CALL     7397--CALL     7414--CALL
ECCSC
      7048**DCL      7436<<ASSIGN   7438<<ASSIGN   7441<<ASSIGN   7449<>CALL
EVENT IN PROCEDURE TELLAU
      7516**DCL      7514--PROC     7524<>CALL
FO$SEVNT
      5587**DCL         8--PROC     7507--ENTRY    7509--CALL
FO$SEVNT.BADFLG
      5588**DCL      7210>>IF
FO$SEVNT.EVENT
      5587**DCL      7240>>DOCASE
FO$SEVNT.NEWSTATE
      5589**DCL      7219>>ASSIGN
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:364  
FO$SEVNT.OLDSTATE
      5587**DCL      7207>>IF       7207>>IF
FO$SEVNT.SPECIAL
      5588**DCL      7212>>IF
FO$SYMB
      5555**DCL         8--PROC     7263<>CALL     7429--CALL     7443<>CALL     7457<>CALL     7507--ENTRY
FO$SYMB.BR
      5556**DCL      7267<>CALL     7317<<ASSIGN   7341<<ASSIGN   7449<>CALL
FO$SYMB.BR.BLK#
      5556**DCL      5557--REDEF
FO$SYMB.BR.REC#
      5557**DCL      5558--REDEF
FO$SYMB.BUF$
      5555**DCL      5556--REDEF
FO$SYMB.CUREXT.STAMP
      5559**DCL      5560--REDEF
FO$SYMB.DEVLDCTX
      5563**DCL      7204>>ASSIGN   7520>>ASSIGN
FO$SYMB.EFLGB
      5567**DCL      7210>>IF       7217>>IF       7261>>IF       7264>>IF       7277>>IF       7287>>IF
FO$SYMB.EFLGB.FDSC
      5568**DCL      7360<<ASSIGN
FO$SYMB.EFLGB.HLTR
      5568**DCL      7253>>IF       7279<<ASSIGN   7295<<ASSIGN   7326>>IF       7400>>IF       7447<<ASSIGN
FO$SYMB.EFLGB.IDSC
      5569**DCL      7294>>IF       7342<<ASSIGN   7389>>IF       7423>>IF       7444>>IF
FO$SYMB.EFLGB.SHTD
      5568**DCL      7297>>IF       7318<<ASSIGN   7395>>IF       7423>>IF       7446<<ASSIGN
FO$SYMB.HLTRSN
      5565**DCL      7280<<ASSIGN   7296<<ASSIGN   7323<<ASSIGN   7327<<ASSIGN   7437>>IF       7440>>IF
FO$SYMB.HRQWAIT
      5566**DCL      7428<<ASSIGN
FO$SYMB.SPACEPAGES
      5563**DCL      5564--REDEF
FO$SYMB.SPACING
      5566**DCL      7265<<ASSIGN   7411>>IF       7448<<ASSIGN
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:365  
FO$SYMB.STATE
      5570**DCL      7203>>ASSIGN   7219<<ASSIGN   7262<<ASSIGN   7266<<ASSIGN   7278>>IF       7281>>IF
      7282>>IF       7289<<ASSIGN   7418<<ASSIGN   7424<<ASSIGN   7427<<ASSIGN   7442<<ASSIGN   7445<<ASSIGN
      7456<<ASSIGN   7458<<ASSIGN
FOM$REL
      7138**DCL-ENT  7263--CALL     7443--CALL     7457--CALL
FOM$TIMR
      7139**DCL-ENT  7429--CALL
HLTRSN
      5592**DCL      7275>>DOCASE   7296>>ASSIGN
INFO
      5591**DCL         8--PROC     5592--REDEF    5593--REDEF    7507--ENTRY    7509<>CALL
INFOWORD IN PROCEDURE TELLAU
      7517**DCL      7514--PROC     7524<>CALL
K$RWPARM
      6750**DCL      7419<<ASSIGN   7422<>CALL
K$RWPARM.BLKREC
      6776**DCL      6801--REDEF
K$RWPARM.BLKREC.BLKU#
      6777**DCL      6779--REDEF
K$RWPARM.BLKREC.RECU#
      6789**DCL      6791--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      6816**DCL      6817--REDEF
K$RWPARM.DVE.EOMCHAR
      6824**DCL      6828--REDEF
K$RWPARM.ERR
      6888**DCL      6893--REDEF
K$RWPARM.FC
      6852**DCL      6853--REDEF
K$RWPARM.FLDID
      7034**DCL      7035--REDEF
K$RWPARM.FPT$
      6915**DCL      6922--REDEF
K$RWPARM.KEYTYPE
      7041**DCL      7042--REDEF
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:366  
K$RWPARM.MRKTYP
      7026**DCL      7421<<ASSIGN
K$RWPARM.MSG$
      6751**DCL      6757--REDEF
K$RWPARM.MSGID
      6863**DCL      6868--REDEF
K$RWPARM.MSGIDXT
      6876**DCL      6880--REDEF
K$RWPARM.ORG
      7012**DCL      7013--REDEF
K$RWPARM.THDRSZ
      6956**DCL      6960--REDEF
K$RWPARM.VDOFLGS
      7014**DCL      7025--REDEF
KCA$TELLAU
      7140**DCL-ENT  7524--CALL
KIA$FCNO
      7141**DCL-ENT  7422--CALL
KQ$CG
      5954**DCL      7522<>CALL
KQ$CG.AUCTL.DVBYTE.REREAD
      6397**DCL      6398--REDEF
KQ$STA
      5614**DCL      7524<>CALL
KQ$STA.ACTTYC
      5666**DCL      5670--REDEF
KQ$STA.DCBLNK$
      5673**DCL      5676--REDEF    5680--REDEF
KQ$STA.EVCNT
      5759**DCL      5762--REDEF
KQ$STA.EVNT
      5725**DCL      5729--REDEF    5732--REDEF
KQ$STA.OPNBLKED
      5786**DCL      5789--REDEF
KQ$STA.OPNREJ
      5792**DCL      5794--REDEF
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:367  
KQ$STA.SUCCREAD
      5715**DCL      5719--REDEF
KQ$STA.TCOUNT
      5844**DCL      5850--REDEF
KQ$STA.VGOT$
      5829**DCL      5833--REDEF    5837--REDEF
KQP$DISC
      7142**DCL-ENT  7459--CALL
KQX$LDASR
      7143**DCL-ENT  7522--CALL
K_RWPARM_CON
      1704**DCL      7419>>ASSIGN
K_RWPARM_CON.BLKREC
      1730**DCL      1755--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      1731**DCL      1733--REDEF
K_RWPARM_CON.BLKREC.RECU#
      1743**DCL      1745--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      1770**DCL      1771--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      1778**DCL      1782--REDEF
K_RWPARM_CON.ERR
      1842**DCL      1847--REDEF
K_RWPARM_CON.FC
      1806**DCL      1807--REDEF
K_RWPARM_CON.FLDID
      1988**DCL      1989--REDEF
K_RWPARM_CON.FPT$
      1869**DCL      1876--REDEF
K_RWPARM_CON.KEYTYPE
      1995**DCL      1996--REDEF
K_RWPARM_CON.MSG$
      1705**DCL      1711--REDEF
K_RWPARM_CON.MSGID
      1817**DCL      1822--REDEF
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:368  
K_RWPARM_CON.MSGIDXT
      1830**DCL      1834--REDEF
K_RWPARM_CON.ORG
      1966**DCL      1967--REDEF
K_RWPARM_CON.THDRSZ
      1910**DCL      1914--REDEF
K_RWPARM_CON.VDOFLGS
      1968**DCL      1979--REDEF
LDCT$
      7049**DCL      7204<<ASSIGN   7248>>IF       7282>>IF       7411>>IF       7422>>CALL     7459>>CALL
      7520<<ASSIGN   7521>>ASSIGN   7523>>ASSIGN
N$DCT$$
      2007**DCL      2007--IMP-PTR  7204>>ASSIGN   7520>>ASSIGN
NK$LDCT
      6691**DCL      7422<>CALL     7459<>CALL
NK$LDCT.CG$
      6722**DCL      7521>>ASSIGN
NK$LDCT.DDT$
      6693**DCL      6693--REDEF
NK$LDCT.DFLG.LOCAL
      6697**DCL      7248>>IF       7282>>IF       7411>>IF
NK$LDCT.IOQ$
      6692**DCL      6693--REDEF
NK$LDCT.LDCTX
      6694**DCL      6694--REDEF
NK$LDCT.LKFLG.ABORTED
      6706**DCL      6707--REDEF
NK$LDCT.RLCID.LDCTX
      6716**DCL      6716--REDEF
NK$LDCT.STA$
      6712**DCL      6713--REDEF    7523>>ASSIGN
NK$LDCT.SYMB$
      6691**DCL      6691--REDEF    6691--REDEF    6692--REDEF
NK$LDCT$
      2007**DCL      7204>>ASSIGN   7520>>ASSIGN
NOSPC
PL6.E3A0      #009=FOM$EVENT File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:10 Page:369  
      7213**LABEL    7250--GOTO     7253--GOTO
REPORT_IN
      7375**LABEL    7228--GOTO     7261--GOTO     7264--GOTO     7292--GOTO     7294--GOTO     7300--CALLALT
      7304--CALLALT  7368--GOTO     7397--CALLALT  7402--CALLALT
SC_BADSYMBEVENT
      7136**DCL-ENT  7465--CALL
SC_BADSYMBEVST
      7135**DCL-ENT  7488--CALL
SC_BADSYMBSTATE
      7137**DCL-ENT  7477--CALL
SSC$MONTIMR
      7144**DCL-ENT  7429--CALL
STA$
      7045**DCL      7523<<ASSIGN   7524>>CALL
START_HALT
      7297**LABEL    7281--GOTO     7284--GOTO
STATE
      7047**DCL      7203<<ASSIGN   7207>>IF       7249>>IF       7319>>DOCASE   7343>>DOCASE
TELLAU
      7514**PROC     7267--CALL     7449--CALL     7509--CALL
TELL_HALT
      7299**LABEL    7321--GOTO     7324--GOTO
WAIT IN PROCEDURE DO_STARTHLT
      7423**LABEL    7422--CALLALT

PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:370  
     2684        1        /*T***********************************************************/
     2685        2        /*T*                                                         */
     2686        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2687        4        /*T*                                                         */
     2688        5        /*T***********************************************************/
     2689        6
     2690        7
     2691        8        FOM$DEBLOCK: PROC (NK$LDCT);
     2692        9
     2693       10        /*F* NAME:     FOM$DEBLOCK
     2694       11             PURPOSE:  Deblocking for remote devices
     2695       12             DESCRIPTION: This routine deblocks the current symb granule for
     2696       13                          a FEP connect device.  It will get enter either by
     2697       14                          a PMME from OUTSYM or from an SSV$EVENT when throtlling
     2698       15                          is available.  It sends as much as it can and then
     2699       16                           waits for more throttling.
     2700       17         */
     2701       18
     2702       19        /* Includes */
     2703       20        %INCLUDE HF_LOCK_C;
     2704       34        %INCLUDE K_DATA_R;
     2705      745        %INCLUDE NK$LDCT;
     2706      847        %INCLUDE K_SUBS_C;
     2707      880        %INCLUDE KV$VDO;
     2708     1895        %INCLUDE FOM$STRUCT;
     2709     1956        %INCLUDE FOM_DATA_R;
     2710     2205        %INCLUDE FOM_SUBS_C;
     2711     2268        %INCLUDE FM$GRAN;
     2712     2337        %INCLUDE CP_6;
     2713     7896
     2714     7897
     2715     7898        /* Parameters */
     2716     7899              %NK$LDCT (STCLASS="");
     2717     7945
     2718     7946        /* Based */
     2719     7947              %FOM$SYMB (NAME=FO$SYMB);
     2720     7979              %FM$GRAN;
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:371  
     2721     7983              %FM$CON;
     2722     7987    1   DCL VFC CHAR(1) BASED;
     2723     7988
     2724     7989        /* Auto */
     2725     7990    1   DCL RECX UBIN;
     2726     7991    1   DCL RECX$ PTR;
     2727     7992    1   DCL REC# UBIN;
     2728     7993    1   DCL LAST UBIN;
     2729     7994    1   DCL AVAIL UBIN;
     2730     7995    1   DCL GRAN$ PTR;
     2731     7996    1   DCL SYMB$ PTR;
     2732     7997        %K$RWPARM (NAME=K$RWPARM);
     2733     8313
     2734     8314        /* Equates */
     2735     8315        %EQU_CG;
     2736     8363        %KV_VDO_ALL_E;
     2737     8442
     2738     8443        /* Refs */
     2739     8444    1   DCL KIA$WRITE ENTRY(2) ALTRET;
     2740     8445    1   DCL FOM$RNXDISK ENTRY(1) ALTRET;
     2741     8446    1   DCL FOM$TELLAU ENTRY(3) ALTRET;
     2742     8447    1   DCL FOM$EVENT ENTRY(3) ALTRET;
     2743     8448    1   DCL SSS$SYSTIME ENTRY(1);
     2744     8449
     2745     8450        %EJECT;
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:372  
     2746     8451              %LOCK (G=NK$LDCT.LOCK);
     2747     8454    1         SYMB$ = NK$LDCT.SYMB$;
     2748     8455    1         GRAN$ = SYMB$->FO$SYMB.BUF$;
     2749     8456    1         IF GRAN$ = ADDR(NIL)     /* No more */
     2750     8457    1         THEN
     2751     8458    1          GOTO UNLOCK;
     2752     8459    1         LAST = GRAN$->FM$GRAN.NAVX + GRAN$->FM$GRAN.AVAIL;
     2753     8460    1         REC# = SYMB$->FO$SYMB.BR.REC#;
     2754     8461    1         IF REC# = 0
     2755     8462    1         THEN
     2756     8463    1          REC# = 1;
     2757     8464    1         RECX = 1024 - REC#;
     2758     8465    1         RECX$ = PINCRW(GRAN$,RECX);
     2759     8466    1         K$RWPARM = K_RWPARM_CON;
     2760     8467              %UNLOCK (G=NK$LDCT.LOCK);
     2761     8470
     2762     8471    2           DO WHILE (RECX >= LAST);
     2763     8472
     2764     8473                %LOCK (G=NK$LDCT.LOCK);
     2765     8476    2           IF SYMB$ -> FO$SYMB.EFLGB.IDSC
     2766     8477    2           OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
     2767     8478    2           OR SYMB$ -> FO$SYMB.FPABRT
     2768     8479    3           THEN DO;
     2769     8480    3             CALL FOM$EVENT (SYMB$ -> FO$SYMB, FOSE_RDIC);
     2770     8481    3             GOTO UNLOCK;
     2771     8482    3             END;
     2772     8483
     2773     8484    2           K$RWPARM.MSG$ = PINCRW (GRAN$,RECX$->FM$CON.GX);
     2774     8485    2           K$RWPARM.MSGSZ = RECX$->FM$CON.GACTB;
     2775     8486    2           K$RWPARM.MRKTYP = %KV_VDOMRKTYP_LSTRCRID;
     2776     8487    2           K$RWPARM.BLKREC = SYMB$->FO$SYMB.BR;
     2777     8488    2           K$RWPARM.DVE.DVBYTE = RECX$->FM$CON.CTL;
     2778     8489    2           IF K$RWPARM.DVE.DVBYTE.VFC
     2779     8490    3           THEN DO;
     2780     8491    3             K$RWPARM.DVE.VFC = K$RWPARM.MSG$->VFC;
     2781     8492    3             K$RWPARM.MSG$ = PINCRC(K$RWPARM.MSG$,1);
     2782     8493    3             K$RWPARM.MSGSZ = K$RWPARM.MSGSZ - 1;
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:373  
     2783     8494    3             END;
     2784     8495
     2785     8496        /* KIA$WRITE places messages in the output circular queue.  It can
     2786     8497        altreturn for two reasons.  The first is the queue full condition
     2787     8498        which means nothing else can be placed in the OCQ at this time.
     2788     8499        The second condition is throddling.  Here we return and await an
     2789     8500        RQSDAT marker from the FEP. */
     2790     8501    2           CALL KIA$WRITE (NK$LDCT,K$RWPARM)
     2791     8502    3           WHENALTRETURN DO;
     2792     8503    3             CALL SSS$SYSTIME (SYMB$ -> FO$SYMB.THROTTLE_ON_UTS);
     2793     8504    3             SYMB$ -> FO$SYMB.BR.REC# = REC#;
     2794     8505    3             SYMB$ -> FO$SYMB.THROTTLING = '1'B;
     2795     8506    3             IF K$RWPARM.ERR = %K$QFULL
     2796     8507    4             THEN DO;
     2797     8508    4               NK$LDCT.LKFLG.QFL = '1'B;
     2798     8509    4               NK$LDCT.QFL.WRT = '1'B;
     2799     8510    4               END;
     2800     8511    3             IF SYMB$ -> FO$SYMB.STATE ~= FOMS_DVIO#
     2801     8512    3             THEN
     2802     8513    3              CALL FOM$EVENT (SYMB$ -> FO$SYMB, FOSE_RDIC);
     2803     8514    3             GOTO UNLOCK;
     2804     8515    3             END;
     2805     8516    2           SYMB$->FO$SYMB.BR.REC# = REC#;
     2806     8517                %UNLOCK (G=NK$LDCT.LOCK);
     2807     8520
     2808     8521    2           RECX = RECX - 1;
     2809     8522    2           RECX$ = PINCRW(RECX$,-1);
     2810     8523    2           REC# = REC# + 1;
     2811     8524    2           END;
     2812     8525
     2813     8526        /* Done with the block */
     2814     8527              %LOCK (G=NK$LDCT.LOCK);
     2815     8530    1         IF NOT SYMB$->FO$SYMB.EFLGB.IDSC
     2816     8531    1         AND NOT SYMB$->FO$SYMB.EFLGB.HLTR
     2817     8532    1         AND NOT SYMB$->FO$SYMB.FPABRT
     2818     8533    2         THEN DO;
     2819     8534                                /* THIS GRANULE DONE.  READ THE NEXT */
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:374  
     2820     8535    2           IF SYMB$->FO$SYMB.ACK THEN
     2821     8536    3             DO;
     2822     8537                                /* ON COMPLETION OF SPECIAL WRITE FUNCTION,
     2823     8538                                   SEND ACK TO OUTSYM */
     2824     8539    3             SYMB$->FO$SYMB.ACK='0'B;
     2825     8540    3             CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STACK#,0);
     2826     8541    3             END;
     2827     8542    2           IF SYMB$ -> FO$SYMB.STATE ~= FOMS_DVIO#
     2828     8543    2           THEN
     2829     8544    2            CALL FOM$EVENT (SYMB$ -> FO$SYMB, FOSE_RDIC) ALTRET (UNLOCK);
     2830     8545                %UNLOCK (G=NK$LDCT.LOCK);
     2831     8548    2           CALL FOM$RNXDISK (SYMB$->FO$SYMB);
     2832     8549    2           GOTO RTN;
     2833     8550    2           END;
     2834     8551
     2835     8552    1   UNLOCK:;
     2836     8553              %UNLOCK (G=NK$LDCT.LOCK);
     2837     8556    1   RTN:  ;
     2838     8557    1         RETURN;
     2839     8558
     2840     8559    1   END FOM$DEBLOCK;
     2841     8560        %EOD;

PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:375  
--  Include file information  --

   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   FM$GRAN.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FOM$DEBLOCK.

   Procedure FOM$DEBLOCK requires 230 words for executable code.
   Procedure FOM$DEBLOCK requires 56 words of local(AUTO) storage.

PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:376  

 Object Unit name= FOM$DEBLOCK                                File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:11:07.88 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   230    346  FOM$DEBLOCK
    2  RoData even  none     5      5  FOM$DEBLOCK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  FOM$DEBLOCK

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 FOM$EVENT
 yes     yes           Std       2 KIA$WRITE
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       3 FOM$TELLAU
 yes     yes           Std       1 FOM$RNXDISK
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:377  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    K_RWPARM_CON                     r    FOSE_RDIC                             M$UC
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:378  


     2684        1        /*T***********************************************************/
     2685        2        /*T*                                                         */
     2686        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2687        4        /*T*                                                         */
     2688        5        /*T***********************************************************/
     2689        6
     2690        7
     2691        8        FOM$DEBLOCK: PROC (NK$LDCT);

      8  1 000000   000000 700200 xent  FOM$DEBLOCK  TSX0  ! X66_AUTO_1
         1 000001   000070 000001                    ZERO    56,1

     2692        9
     2693       10        /*F* NAME:     FOM$DEBLOCK
     2694       11             PURPOSE:  Deblocking for remote devices
     2695       12             DESCRIPTION: This routine deblocks the current symb granule for
     2696       13                          a FEP connect device.  It will get enter either by
     2697       14                          a PMME from OUTSYM or from an SSV$EVENT when throtlling
     2698       15                          is available.  It sends as much as it can and then
     2699       16                           waits for more throttling.
     2700       17         */
     2701       18
     2702       19        /* Includes */
     2703       20        %INCLUDE HF_LOCK_C;
     2704       34        %INCLUDE K_DATA_R;
     2705      745        %INCLUDE NK$LDCT;
     2706      847        %INCLUDE K_SUBS_C;
     2707      880        %INCLUDE KV$VDO;
     2708     1895        %INCLUDE FOM$STRUCT;
     2709     1956        %INCLUDE FOM_DATA_R;
     2710     2205        %INCLUDE FOM_SUBS_C;
     2711     2268        %INCLUDE FM$GRAN;
     2712     2337        %INCLUDE CP_6;
     2713     7896
     2714     7897
     2715     7898        /* Parameters */
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:379  
     2716     7899              %NK$LDCT (STCLASS="");
     2717     7945
     2718     7946        /* Based */
     2719     7947              %FOM$SYMB (NAME=FO$SYMB);
     2720     7979              %FM$GRAN;
     2721     7983              %FM$CON;
     2722     7987    1   DCL VFC CHAR(1) BASED;
     2723     7988
     2724     7989        /* Auto */
     2725     7990    1   DCL RECX UBIN;
     2726     7991    1   DCL RECX$ PTR;
     2727     7992    1   DCL REC# UBIN;
     2728     7993    1   DCL LAST UBIN;
     2729     7994    1   DCL AVAIL UBIN;
     2730     7995    1   DCL GRAN$ PTR;
     2731     7996    1   DCL SYMB$ PTR;
     2732     7997        %K$RWPARM (NAME=K$RWPARM);
     2733     8313
     2734     8314        /* Equates */
     2735     8315        %EQU_CG;
     2736     8363        %KV_VDO_ALL_E;
     2737     8442
     2738     8443        /* Refs */
     2739     8444    1   DCL KIA$WRITE ENTRY(2) ALTRET;
     2740     8445    1   DCL FOM$RNXDISK ENTRY(1) ALTRET;
     2741     8446    1   DCL FOM$TELLAU ENTRY(3) ALTRET;
     2742     8447    1   DCL FOM$EVENT ENTRY(3) ALTRET;
     2743     8448    1   DCL SSS$SYSTIME ENTRY(1);
     2744     8449
     2745     8450        %EJECT;
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:380  
     2746     8451              %LOCK (G=NK$LDCT.LOCK);

   8452  1 000002   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000003   000020 036003                    ADLQ    16,DU
         1 000004   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000005   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000006   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000007   000000 701000 xent               TSX1    HFC$LOCK
         1 000010   000000 011000                    NOP     0

     2747     8454    1         SYMB$ = NK$LDCT.SYMB$;

   8454  1 000011   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000012   000000 236100                    LDQ     0,,PR0
         1 000013   200012 756100                    STQ     SYMB$,,AUTO

     2748     8455    1         GRAN$ = SYMB$->FO$SYMB.BUF$;

   8455  1 000014   200012 471500                    LDP1    SYMB$,,AUTO
         1 000015   100002 236100                    LDQ     2,,PR1
         1 000016   200011 756100                    STQ     GRAN$,,AUTO

     2749     8456    1         IF GRAN$ = ADDR(NIL)     /* No more */

   8456  1 000017   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000020   000336 600000 1                  TZE     UNLOCK

     2750     8457    1         THEN
     2751     8458    1          GOTO UNLOCK;
     2752     8459    1         LAST = GRAN$->FM$GRAN.NAVX + GRAN$->FM$GRAN.AVAIL;

   8459  1 000021   200011 473500                    LDP3    GRAN$,,AUTO
         1 000022   300001 236100                    LDQ     1,,PR3
         1 000023   001777 376007                    ANQ     1023,DL
         1 000024   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000025   300001 236100                    LDQ     1,,PR3
         1 000026   000022 772000                    QRL     18
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:381  
         1 000027   200064 036100                    ADLQ    K$RWPARM+40,,AUTO
         1 000030   200007 756100                    STQ     LAST,,AUTO

     2753     8460    1         REC# = SYMB$->FO$SYMB.BR.REC#;

   8460  1 000031   100003 236100                    LDQ     3,,PR1
         1 000032   777777 376007                    ANQ     -1,DL
         1 000033   200006 756100                    STQ     REC#,,AUTO

     2754     8461    1         IF REC# = 0

   8461  1 000034   000037 601000 1                  TNZ     s:8464

     2755     8462    1         THEN
     2756     8463    1          REC# = 1;

   8463  1 000035   000001 235007                    LDA     1,DL
         1 000036   200006 755100                    STA     REC#,,AUTO

     2757     8464    1         RECX = 1024 - REC#;

   8464  1 000037   002000 235007                    LDA     1024,DL
         1 000040   200006 135100                    SBLA    REC#,,AUTO
         1 000041   200004 755100                    STA     RECX,,AUTO

     2758     8465    1         RECX$ = PINCRW(GRAN$,RECX);

   8465  1 000042   200004 236100                    LDQ     RECX,,AUTO
         1 000043   000022 736000                    QLS     18
         1 000044   200011 036100                    ADLQ    GRAN$,,AUTO
         1 000045   200005 756100                    STQ     RECX$,,AUTO

     2759     8466    1         K$RWPARM = K_RWPARM_CON;

   8466  1 000046   000100 100400                    MLR     fill='000'O
         1 000047   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000050   200014 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:382  

     2760     8467              %UNLOCK (G=NK$LDCT.LOCK);

   8468  1 000051   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000052   000020 036003                    ADLQ    16,DU
         1 000053   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000054   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000055   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000056   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000057   000000 011000                    NOP     0

     2761     8470
     2762     8471    2           DO WHILE (RECX >= LAST);

   8471  1 000060   200004 236100                    LDQ     RECX,,AUTO
         1 000061   200007 116100                    CMPQ    LAST,,AUTO
         1 000062   000251 602000 1                  TNC     s:8528

     2763     8472
     2764     8473                %LOCK (G=NK$LDCT.LOCK);

   8474  1 000063   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000064   000020 036003                    ADLQ    16,DU
         1 000065   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000066   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000067   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000070   000000 701000 xent               TSX1    HFC$LOCK
         1 000071   000000 011000                    NOP     0

     2765     8476    2           IF SYMB$ -> FO$SYMB.EFLGB.IDSC

   8476  1 000072   200012 470500                    LDP0    SYMB$,,AUTO
         1 000073   000012 236100                    LDQ     10,,PR0
         1 000074   000400 316007                    CANQ    256,DL
         1 000075   000104 601000 1                  TNZ     s:8480
         1 000076   000012 236100                    LDQ     10,,PR0
         1 000077   000017 376007                    ANQ     15,DL
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:383  
         1 000100   000004 116007                    CMPQ    4,DL
         1 000101   000104 600000 1                  TZE     s:8480
         1 000102   000021 430100                    FSZN    17,,PR0
         1 000103   000114 605000 1                  TPL     s:8484

     2766     8477    2           OR SYMB$ -> FO$SYMB.STATE = FOMS_DCMP#
     2767     8478    2           OR SYMB$ -> FO$SYMB.FPABRT
     2768     8479    3           THEN DO;

     2769     8480    3             CALL FOM$EVENT (SYMB$ -> FO$SYMB, FOSE_RDIC);

   8480  1 000104   000000 236000 2                  LDQ     0
         1 000105   200012 235100                    LDA     SYMB$,,AUTO
         1 000106   200064 757100                    STAQ    K$RWPARM+40,,AUTO
         1 000107   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000110   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000111   000000 701000 xent               TSX1    FOM$EVENT
         1 000112   000000 011000                    NOP     0

     2770     8481    3             GOTO UNLOCK;

   8481  1 000113   000336 710000 1                  TRA     UNLOCK

     2771     8482    3             END;
     2772     8483
     2773     8484    2           K$RWPARM.MSG$ = PINCRW (GRAN$,RECX$->FM$CON.GX);

   8484  1 000114   200005 471500                    LDP1    RECX$,,AUTO
         1 000115   100000 236100                    LDQ     0,,PR1
         1 000116   000014 772000                    QRL     12
         1 000117   001777 376007                    ANQ     1023,DL
         1 000120   000022 736000                    QLS     18
         1 000121   200011 036100                    ADLQ    GRAN$,,AUTO
         1 000122   200014 756100                    STQ     K$RWPARM,,AUTO

     2774     8485    2           K$RWPARM.MSGSZ = RECX$->FM$CON.GACTB;

PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:384  
   8485  1 000123   100000 236100                    LDQ     0,,PR1
         1 000124   007777 376007                    ANQ     4095,DL
         1 000125   200015 756100                    STQ     K$RWPARM+1,,AUTO

     2775     8486    2           K$RWPARM.MRKTYP = %KV_VDOMRKTYP_LSTRCRID;

   8486  1 000126   002000 236007                    LDQ     1024,DL
         1 000127   200054 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

     2776     8487    2           K$RWPARM.BLKREC = SYMB$->FO$SYMB.BR;

   8487  1 000130   000003 236100                    LDQ     3,,PR0
         1 000131   200023 756100                    STQ     K$RWPARM+7,,AUTO

     2777     8488    2           K$RWPARM.DVE.DVBYTE = RECX$->FM$CON.CTL;

   8488  1 000132   100000 236100                    LDQ     0,,PR1
         1 000133   037700 376003                    ANQ     16320,DU
         1 000134   000004 736000                    QLS     4
         1 000135   200024 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

     2778     8489    2           IF K$RWPARM.DVE.DVBYTE.VFC

   8489  1 000136   200024 236100                    LDQ     K$RWPARM+8,,AUTO
         1 000137   100000 316003                    CANQ    32768,DU
         1 000140   000152 600000 1                  TZE     s:8501

     2779     8490    3           THEN DO;

     2780     8491    3             K$RWPARM.DVE.VFC = K$RWPARM.MSG$->VFC;

   8491  1 000141   200014 473500                    LDP3    K$RWPARM,,AUTO
         1 000142   040100 100500                    MLR     fill='040'O
         1 000143   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 000144   200024 200001                    ADSC9   K$RWPARM+8,,AUTO         cn=1,n=1

     2781     8492    3             K$RWPARM.MSG$ = PINCRC(K$RWPARM.MSG$,1);
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:385  

   8492  1 000145   200014 236100                    LDQ     K$RWPARM,,AUTO
         1 000146   200000 036007                    ADLQ    65536,DL
         1 000147   200014 756100                    STQ     K$RWPARM,,AUTO

     2782     8493    3             K$RWPARM.MSGSZ = K$RWPARM.MSGSZ - 1;

   8493  1 000150   000001 336007                    LCQ     1,DL
         1 000151   200015 056100                    ASQ     K$RWPARM+1,,AUTO

     2783     8494    3             END;

     2784     8495
     2785     8496        /* KIA$WRITE places messages in the output circular queue.  It can
     2786     8497        altreturn for two reasons.  The first is the queue full condition
     2787     8498        which means nothing else can be placed in the OCQ at this time.
     2788     8499        The second condition is throddling.  Here we return and await an
     2789     8500        RQSDAT marker from the FEP. */
     2790     8501    2           CALL KIA$WRITE (NK$LDCT,K$RWPARM)

   8501  1 000152   200014 633500                    EPPR3   K$RWPARM,,AUTO
         1 000153   200065 453500                    STP3    K$RWPARM+41,,AUTO
         1 000154   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000155   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000156   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000157   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000160   000000 701000 xent               TSX1    KIA$WRITE
         1 000161   000163 702000 1                  TSX2    s:8503
         1 000162   000223 710000 1                  TRA     s:8516

     2791     8502    3           WHENALTRETURN DO;

     2792     8503    3             CALL SSS$SYSTIME (SYMB$ -> FO$SYMB.THROTTLE_ON_UTS);

   8503  1 000163   200012 236100                    LDQ     SYMB$,,AUTO
         1 000164   000014 036003                    ADLQ    12,DU
         1 000165   200064 756100                    STQ     K$RWPARM+40,,AUTO
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:386  
         1 000166   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000167   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000170   000000 701000 xent               TSX1    SSS$SYSTIME
         1 000171   000000 011000                    NOP     0

     2793     8504    3             SYMB$ -> FO$SYMB.BR.REC# = REC#;

   8504  1 000172   200006 720100                    LXL0    REC#,,AUTO
         1 000173   200012 470500                    LDP0    SYMB$,,AUTO
         1 000174   000003 440100                    SXL0    3,,PR0

     2794     8505    3             SYMB$ -> FO$SYMB.THROTTLING = '1'B;

   8505  1 000175   400000 236003                    LDQ     -131072,DU
         1 000176   000010 256100                    ORSQ    8,,PR0

     2795     8506    3             IF K$RWPARM.ERR = %K$QFULL

   8506  1 000177   200027 235100                    LDA     K$RWPARM+11,,AUTO
         1 000200   000001 115007                    CMPA    1,DL
         1 000201   000207 601000 1                  TNZ     s:8511

     2796     8507    4             THEN DO;

     2797     8508    4               NK$LDCT.LKFLG.QFL = '1'B;

   8508  1 000202   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000203   000100 236003                    LDQ     64,DU
         1 000204   100011 256100                    ORSQ    9,,PR1

     2798     8509    4               NK$LDCT.QFL.WRT = '1'B;

   8509  1 000205   000400 236007                    LDQ     256,DL
         1 000206   100010 256100                    ORSQ    8,,PR1

     2799     8510    4               END;

PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:387  
     2800     8511    3             IF SYMB$ -> FO$SYMB.STATE ~= FOMS_DVIO#

   8511  1 000207   000012 236100                    LDQ     10,,PR0
         1 000210   000017 376007                    ANQ     15,DL
         1 000211   000003 116007                    CMPQ    3,DL
         1 000212   000222 600000 1                  TZE     s:8514

     2801     8512    3             THEN
     2802     8513    3              CALL FOM$EVENT (SYMB$ -> FO$SYMB, FOSE_RDIC);

   8513  1 000213   000000 236000 2                  LDQ     0
         1 000214   200012 235100                    LDA     SYMB$,,AUTO
         1 000215   200064 757100                    STAQ    K$RWPARM+40,,AUTO
         1 000216   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000217   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000220   000000 701000 xent               TSX1    FOM$EVENT
         1 000221   000000 011000                    NOP     0

     2803     8514    3             GOTO UNLOCK;

   8514  1 000222   000336 710000 1                  TRA     UNLOCK

     2804     8515    3             END;
     2805     8516    2           SYMB$->FO$SYMB.BR.REC# = REC#;

   8516  1 000223   200006 720100                    LXL0    REC#,,AUTO
         1 000224   200012 470500                    LDP0    SYMB$,,AUTO
         1 000225   000003 440100                    SXL0    3,,PR0

     2806     8517                %UNLOCK (G=NK$LDCT.LOCK);

   8518  1 000226   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000227   000020 036003                    ADLQ    16,DU
         1 000230   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000231   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000232   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000233   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:388  
         1 000234   000000 011000                    NOP     0

     2807     8520
     2808     8521    2           RECX = RECX - 1;

   8521  1 000235   200004 235100                    LDA     RECX,,AUTO
         1 000236   000001 135007                    SBLA    1,DL
         1 000237   200004 755100                    STA     RECX,,AUTO

     2809     8522    2           RECX$ = PINCRW(RECX$,-1);

   8522  1 000240   200005 236100                    LDQ     RECX$,,AUTO
         1 000241   777777 036003                    ADLQ    -1,DU
         1 000242   200005 756100                    STQ     RECX$,,AUTO

     2810     8523    2           REC# = REC# + 1;

   8523  1 000243   200006 235100                    LDA     REC#,,AUTO
         1 000244   000001 035007                    ADLA    1,DL
         1 000245   200006 755100                    STA     REC#,,AUTO

     2811     8524    2           END;

   8524  1 000246   200004 236100                    LDQ     RECX,,AUTO
         1 000247   200007 116100                    CMPQ    LAST,,AUTO
         1 000250   000063 603000 1                  TRC     s:8474

     2812     8525
     2813     8526        /* Done with the block */
     2814     8527              %LOCK (G=NK$LDCT.LOCK);

   8528  1 000251   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000252   000020 036003                    ADLQ    16,DU
         1 000253   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000254   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000255   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000256   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:389  
         1 000257   000000 011000                    NOP     0

     2815     8530    1         IF NOT SYMB$->FO$SYMB.EFLGB.IDSC

   8530  1 000260   200012 470500                    LDP0    SYMB$,,AUTO
         1 000261   000012 236100                    LDQ     10,,PR0
         1 000262   000400 316007                    CANQ    256,DL
         1 000263   000336 601000 1                  TNZ     UNLOCK
         1 000264   004000 316007                    CANQ    2048,DL
         1 000265   000336 601000 1                  TNZ     UNLOCK
         1 000266   000021 430100                    FSZN    17,,PR0
         1 000267   000336 604000 1                  TMI     UNLOCK

     2816     8531    1         AND NOT SYMB$->FO$SYMB.EFLGB.HLTR
     2817     8532    1         AND NOT SYMB$->FO$SYMB.FPABRT
     2818     8533    2         THEN DO;

     2819     8534                                /* THIS GRANULE DONE.  READ THE NEXT */
     2820     8535    2           IF SYMB$->FO$SYMB.ACK THEN

   8535  1 000270   000010 236100                    LDQ     8,,PR0
         1 000271   100000 316003                    CANQ    32768,DU
         1 000272   000306 600000 1                  TZE     s:8542

     2821     8536    3             DO;

     2822     8537                                /* ON COMPLETION OF SPECIAL WRITE FUNCTION,
     2823     8538                                   SEND ACK TO OUTSYM */
     2824     8539    3             SYMB$->FO$SYMB.ACK='0'B;

   8539  1 000273   000001 236000 2                  LDQ     1
         1 000274   000010 356100                    ANSQ    8,,PR0

     2825     8540    3             CALL FOM$TELLAU (SYMB$->FO$SYMB,%CG_STACK#,0);

   8540  1 000275   000003 236000 2                  LDQ     3
         1 000276   200066 756100                    STQ     K$RWPARM+42,,AUTO
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:390  
         1 000277   000004 236000 2                  LDQ     4
         1 000300   200012 235100                    LDA     SYMB$,,AUTO
         1 000301   200064 757100                    STAQ    K$RWPARM+40,,AUTO
         1 000302   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000303   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000304   000000 701000 xent               TSX1    FOM$TELLAU
         1 000305   000000 011000                    NOP     0

     2826     8541    3             END;

     2827     8542    2           IF SYMB$ -> FO$SYMB.STATE ~= FOMS_DVIO#

   8542  1 000306   200012 470500                    LDP0    SYMB$,,AUTO
         1 000307   000012 236100                    LDQ     10,,PR0
         1 000310   000017 376007                    ANQ     15,DL
         1 000311   000003 116007                    CMPQ    3,DL
         1 000312   000322 600000 1                  TZE     s:8546

     2828     8543    2           THEN
     2829     8544    2            CALL FOM$EVENT (SYMB$ -> FO$SYMB, FOSE_RDIC) ALTRET (UNLOCK);

   8544  1 000313   000000 236000 2                  LDQ     0
         1 000314   200012 235100                    LDA     SYMB$,,AUTO
         1 000315   200064 757100                    STAQ    K$RWPARM+40,,AUTO
         1 000316   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000317   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000320   000000 701000 xent               TSX1    FOM$EVENT
         1 000321   000336 702000 1                  TSX2    UNLOCK

     2830     8545                %UNLOCK (G=NK$LDCT.LOCK);

   8546  1 000322   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000323   000020 036003                    ADLQ    16,DU
         1 000324   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000325   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000326   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000327   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:391  
         1 000330   000000 011000                    NOP     0

     2831     8548    2           CALL FOM$RNXDISK (SYMB$->FO$SYMB);

   8548  1 000331   200012 630500                    EPPR0   SYMB$,,AUTO
         1 000332   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000333   000000 701000 xent               TSX1    FOM$RNXDISK
         1 000334   000000 011000                    NOP     0

     2832     8549    2           GOTO RTN;

   8549  1 000335   000345 710000 1                  TRA     RTN

     2833     8550    2           END;
     2834     8551
     2835     8552    1   UNLOCK:;

   8552  1 000336                       UNLOCK       null
     2836     8553              %UNLOCK (G=NK$LDCT.LOCK);

   8554  1 000336   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000337   000020 036003                    ADLQ    16,DU
         1 000340   200064 756100                    STQ     K$RWPARM+40,,AUTO
         1 000341   200064 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000342   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000343   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000344   000000 011000                    NOP     0

   8552  1 000345                       RTN          null
     2837     8556    1   RTN:  ;
     2838     8557    1         RETURN;

   8557  1 000345   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   2     000   000000 006000   677777 777777   000000 000021   000002 006000    ................
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:392  
   2     004   000002 006000                                                    ....
     2839     8558
     2840     8559    1   END FOM$DEBLOCK;
     2841     8560        %EOD;

PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:393  
--  Include file information  --

   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   FM$GRAN.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FOM$DEBLOCK.
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:394  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NK$LDCT                  11-0-0/w PTR         r     1 GRAN$
    14-0-0/d STRC(1404)  r     1 K$RWPARM                   7-0-0/w UBIN        r     1 LAST
    *0-0-0/d STRC(864)   r     1 NK$LDCT                    6-0-0/w UBIN        r     1 REC#
     4-0-0/w UBIN        r     1 RECX                       5-0-0/w PTR         r     1 RECX$
    12-0-0/w PTR         r     1 SYMB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 FOSE_RDIC                  0-0-0/d STRC(1404)  r     1 K_RWPARM_CON

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 FM$CON                     0-0-0/w STRC(180)   r     1 FM$GRAN
     0-0-0/w STRC(720)   r     1 FO$SYMB                    0-0-0/c CHAR        r     1 VFC


   Procedure FOM$DEBLOCK requires 230 words for executable code.
   Procedure FOM$DEBLOCK requires 56 words of local(AUTO) storage.
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:395  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:396  
          MINI XREF LISTING

FM$CON.CTL
      7984**DCL      8488>>ASSIGN
FM$CON.GACTB
      7984**DCL      8485>>ASSIGN
FM$CON.GX
      7984**DCL      8484>>ASSIGN
FM$GRAN.AVAIL
      7981**DCL      8459>>ASSIGN
FM$GRAN.NAVX
      7980**DCL      8459>>ASSIGN
FO$SYMB
      7958**DCL      8480<>CALL     8513<>CALL     8540<>CALL     8544<>CALL     8548<>CALL
FO$SYMB.ACK
      7965**DCL      8535>>IF       8539<<ASSIGN
FO$SYMB.BR
      7959**DCL      8487>>ASSIGN
FO$SYMB.BR.BLK#
      7959**DCL      7960--REDEF
FO$SYMB.BR.REC#
      7960**DCL      7961--REDEF    8460>>ASSIGN   8504<<ASSIGN   8516<<ASSIGN
FO$SYMB.BUF$
      7958**DCL      7959--REDEF    8455>>ASSIGN
FO$SYMB.CUREXT.STAMP
      7962**DCL      7963--REDEF
FO$SYMB.EFLGB.HLTR
      7971**DCL      8530>>IF
FO$SYMB.EFLGB.IDSC
      7972**DCL      8476>>IF       8530>>IF
FO$SYMB.FPABRT
      7976**DCL      8476>>IF       8530>>IF
FO$SYMB.SPACEPAGES
      7966**DCL      7967--REDEF
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:397  
FO$SYMB.STATE
      7973**DCL      8476>>IF       8511>>IF       8542>>IF
FO$SYMB.THROTTLE_ON_UTS
      7974**DCL      8503<>CALL
FO$SYMB.THROTTLING
      7965**DCL      8505<<ASSIGN
FOM$EVENT
      8447**DCL-ENT  8480--CALL     8513--CALL     8544--CALL
FOM$RNXDISK
      8445**DCL-ENT  8548--CALL
FOM$TELLAU
      8446**DCL-ENT  8540--CALL
FOSE_RDIC
      2066**DCL      8480<>CALL     8513<>CALL     8544<>CALL
GRAN$
      7995**DCL      8455<<ASSIGN   8456>>IF       8459>>ASSIGN   8459>>ASSIGN   8465>>ASSIGN   8484>>ASSIGN
HFC$LOCK
        33**DCL-ENT  8452--CALL     8474--CALL     8528--CALL
HFC$UNLOCK
        33**DCL-ENT  8468--CALL     8518--CALL     8546--CALL     8554--CALL
K$RWPARM
      8018**DCL      8466<<ASSIGN   8501<>CALL
K$RWPARM.BLKREC
      8044**DCL      8069--REDEF    8487<<ASSIGN
K$RWPARM.BLKREC.BLKU#
      8045**DCL      8047--REDEF
K$RWPARM.BLKREC.RECU#
      8057**DCL      8059--REDEF
K$RWPARM.DVE.DVBYTE
      8076**DCL      8488<<ASSIGN
K$RWPARM.DVE.DVBYTE.VFC
      8084**DCL      8085--REDEF    8489>>IF
K$RWPARM.DVE.EOMCHAR
      8092**DCL      8096--REDEF
K$RWPARM.DVE.VFC
      8096**DCL      8491<<ASSIGN
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:398  
K$RWPARM.ERR
      8156**DCL      8161--REDEF    8506>>IF
K$RWPARM.FC
      8120**DCL      8121--REDEF
K$RWPARM.FLDID
      8302**DCL      8303--REDEF
K$RWPARM.FPT$
      8183**DCL      8190--REDEF
K$RWPARM.KEYTYPE
      8309**DCL      8310--REDEF
K$RWPARM.MRKTYP
      8294**DCL      8486<<ASSIGN
K$RWPARM.MSG$
      8019**DCL      8025--REDEF    8484<<ASSIGN   8491>>ASSIGN   8492<<ASSIGN   8492>>ASSIGN
K$RWPARM.MSGID
      8131**DCL      8136--REDEF
K$RWPARM.MSGIDXT
      8144**DCL      8148--REDEF
K$RWPARM.MSGSZ
      8026**DCL      8485<<ASSIGN   8493<<ASSIGN   8493>>ASSIGN
K$RWPARM.ORG
      8280**DCL      8281--REDEF
K$RWPARM.THDRSZ
      8224**DCL      8228--REDEF
K$RWPARM.VDOFLGS
      8282**DCL      8293--REDEF
KIA$WRITE
      8444**DCL-ENT  8501--CALL
K_RWPARM_CON
       449**DCL      8466>>ASSIGN
K_RWPARM_CON.BLKREC
       475**DCL       500--REDEF
K_RWPARM_CON.BLKREC.BLKU#
       476**DCL       478--REDEF
K_RWPARM_CON.BLKREC.RECU#
       488**DCL       490--REDEF
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:399  
K_RWPARM_CON.DVE.DVBYTE.VFC
       515**DCL       516--REDEF
K_RWPARM_CON.DVE.EOMCHAR
       523**DCL       527--REDEF
K_RWPARM_CON.ERR
       587**DCL       592--REDEF
K_RWPARM_CON.FC
       551**DCL       552--REDEF
K_RWPARM_CON.FLDID
       733**DCL       734--REDEF
K_RWPARM_CON.FPT$
       614**DCL       621--REDEF
K_RWPARM_CON.KEYTYPE
       740**DCL       741--REDEF
K_RWPARM_CON.MSG$
       450**DCL       456--REDEF
K_RWPARM_CON.MSGID
       562**DCL       567--REDEF
K_RWPARM_CON.MSGIDXT
       575**DCL       579--REDEF
K_RWPARM_CON.ORG
       711**DCL       712--REDEF
K_RWPARM_CON.THDRSZ
       655**DCL       659--REDEF
K_RWPARM_CON.VDOFLGS
       713**DCL       724--REDEF
LAST
      7993**DCL      8459<<ASSIGN   8471>>DOWHILE
NK$LDCT
      7912**DCL         8--PROC     8501<>CALL
NK$LDCT.DDT$
      7914**DCL      7914--REDEF
NK$LDCT.IOQ$
      7913**DCL      7914--REDEF
NK$LDCT.LDCTX
      7915**DCL      7915--REDEF
PL6.E3A0      #010=FOM$DEBLOCK File=FOM$MOOS.:E05TSI                             TUE 07/29/97 17:11 Page:400  
NK$LDCT.LKFLG.ABORTED
      7927**DCL      7928--REDEF
NK$LDCT.LKFLG.QFL
      7931**DCL      8508<<ASSIGN
NK$LDCT.LOCK
      7940**DCL      8452<>CALL     8468<>CALL     8474<>CALL     8518<>CALL     8528<>CALL     8546<>CALL
      8554<>CALL
NK$LDCT.QFL.WRT
      7924**DCL      8509<<ASSIGN
NK$LDCT.RLCID.LDCTX
      7937**DCL      7937--REDEF
NK$LDCT.STA$
      7933**DCL      7934--REDEF
NK$LDCT.SYMB$
      7912**DCL      7912--REDEF    7912--REDEF    7913--REDEF    8454>>ASSIGN
REC#
      7992**DCL      8460<<ASSIGN   8461>>IF       8463<<ASSIGN   8464>>ASSIGN   8504>>ASSIGN   8516>>ASSIGN
      8523<<ASSIGN   8523>>ASSIGN
RECX
      7990**DCL      8464<<ASSIGN   8465>>ASSIGN   8471>>DOWHILE  8521<<ASSIGN   8521>>ASSIGN
RECX$
      7991**DCL      8465<<ASSIGN   8484>>ASSIGN   8485>>ASSIGN   8488>>ASSIGN   8522<<ASSIGN   8522>>ASSIGN
RTN
      8552**LABEL    8549--GOTO
SSS$SYSTIME
      8448**DCL-ENT  8503--CALL
SYMB$
      7996**DCL      8454<<ASSIGN   8455>>ASSIGN   8460>>ASSIGN   8476>>IF       8476>>IF       8476>>IF
      8480>>CALL     8487>>ASSIGN   8503>>CALL     8504>>ASSIGN   8505>>ASSIGN   8511>>IF       8513>>CALL
      8516>>ASSIGN   8530>>IF       8530>>IF       8530>>IF       8535>>IF       8539>>ASSIGN   8540>>CALL
      8542>>IF       8544>>CALL     8548>>CALL
UNLOCK
      8552**LABEL    8458--GOTO     8481--GOTO     8514--GOTO     8544--CALLALT
VFC
      7987**DCL      8491>>ASSIGN

PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:401  
     2842        1        /*T***********************************************************/
     2843        2        /*T*                                                         */
     2844        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2845        4        /*T*                                                         */
     2846        5        /*T***********************************************************/
     2847        6        FOM$DEBEV: PROC (DOLIST$) ALTRET;
     2848        7
     2849        8        /* Includes */
     2850        9        %INCLUDE B$USER;
     2851      225        %INCLUDE NK$LDCT;
     2852      327        %INCLUDE FOM$STRUCT;
     2853      388        %INCLUDE FOM_DATA_R;
     2854      637        %INCLUDE XUD_UTS_M;
     2855      719
     2856      720        %XUD$UTS_ENTRIES;                       /* expand routine dcls */
     2857      752        %XUD_UTS_EQU;                           /* expand constant EQUates */
     2858      763
     2859      764
     2860      765        /* Parameters */
     2861      766    1   DCL DOLIST$ PTR;
     2862      767    1   DCL SYMB$ PTR;
     2863      768
     2864      769        /* Entry refs */
     2865      770    1   DCL FOM$DEBLOCK ENTRY(1);
     2866      771    1   DCL SSS$SYSTIME ENTRY(1);
     2867      772
     2868      773        /* Auto */
     2869      774    1   DCL LDCT$ PTR;
     2870      775    1   DCL LDCT$U REDEF LDCT$ UBIN;
     2871      776    1   DCL CSEC SBIN AUTO;
     2872      777
     2873      778        /* Based */
     2874      779        %NK$LDCT;
     2875      825
     2876      826        %FOM$SYMB (NAME=FO$SYMB);
     2877      858
     2878      859    1         LDCT$U = DOLIST$->B$DO.EVID;
PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:402  
     2879      860    1         SYMB$ = LDCT$ -> NK$LDCT.SYMB$;
     2880      861    1         SYMB$ -> FO$SYMB.THROTTLE_CNT = SYMB$ -> FO$SYMB.THROTTLE_CNT + 1;
     2881      862    1         CALL SSS$SYSTIME (SYMB$ -> FO$SYMB.THROTTLE_OFF_UTS);
     2882      863    1         CALL XUD$UTS_DIFF (cSEC, SYMB$->FO$SYMB.THROTTLE_OFF_UTS, SYMB$->FO$SYMB.
               863                  THROTTLE_ON_UTS);
     2883      864    1         SYMB$ -> FO$SYMB.THROTTLE_TIME = SYMB$ -> FO$SYMB.THROTTLE_TIME + CSEC;
     2884      865    1         CALL FOM$DEBLOCK (LDCT$->NK$LDCT);
     2885      866    1         ALTRETURN;
     2886      867
     2887      868    1   END FOM$DEBEV;

PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:403  
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FOM$DEBEV.

   Procedure FOM$DEBEV requires 40 words for executable code.
   Procedure FOM$DEBEV requires 12 words of local(AUTO) storage.

    No errors detected in file FOM$MOOS.:E05TSI    .

PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:404  

 Object Unit name= FOM$DEBEV                                  File name= FOM$MOOS.:E05TOU
 UTS= JUL 29 '97 17:11:24.68 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    40     50  FOM$DEBEV

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  FOM$DEBEV

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       3 XUD$UTS_DIFF
         yes           Std       1 FOM$DEBLOCK
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B_VECTNIL
PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:405  


     2842        1        /*T***********************************************************/
     2843        2        /*T*                                                         */
     2844        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2845        4        /*T*                                                         */
     2846        5        /*T***********************************************************/
     2847        6        FOM$DEBEV: PROC (DOLIST$) ALTRET;

      6  0 000000   000000 700200 xent  FOM$DEBEV    TSX0  ! X66_AUTO_1
         0 000001   000014 000001                    ZERO    12,1

     2848        7
     2849        8        /* Includes */
     2850        9        %INCLUDE B$USER;
     2851      225        %INCLUDE NK$LDCT;
     2852      327        %INCLUDE FOM$STRUCT;
     2853      388        %INCLUDE FOM_DATA_R;
     2854      637        %INCLUDE XUD_UTS_M;
     2855      719
     2856      720        %XUD$UTS_ENTRIES;                       /* expand routine dcls */
     2857      752        %XUD_UTS_EQU;                           /* expand constant EQUates */
     2858      763
     2859      764
     2860      765        /* Parameters */
     2861      766    1   DCL DOLIST$ PTR;
     2862      767    1   DCL SYMB$ PTR;
     2863      768
     2864      769        /* Entry refs */
     2865      770    1   DCL FOM$DEBLOCK ENTRY(1);
     2866      771    1   DCL SSS$SYSTIME ENTRY(1);
     2867      772
     2868      773        /* Auto */
     2869      774    1   DCL LDCT$ PTR;
     2870      775    1   DCL LDCT$U REDEF LDCT$ UBIN;
     2871      776    1   DCL CSEC SBIN AUTO;
     2872      777
     2873      778        /* Based */
PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:406  
     2874      779        %NK$LDCT;
     2875      825
     2876      826        %FOM$SYMB (NAME=FO$SYMB);
     2877      858
     2878      859    1         LDCT$U = DOLIST$->B$DO.EVID;

    859  0 000002   200003 470500                    LDP0    @DOLIST$,,AUTO
         0 000003   000000 471500                    LDP1    0,,PR0
         0 000004   100003 235100                    LDA     3,,PR1
         0 000005   200005 755100                    STA     LDCT$,,AUTO

     2879      860    1         SYMB$ = LDCT$ -> NK$LDCT.SYMB$;

    860  0 000006   200005 473500                    LDP3    LDCT$,,AUTO
         0 000007   300000 236100                    LDQ     0,,PR3
         0 000010   200004 756100                    STQ     SYMB$,,AUTO

     2880      861    1         SYMB$ -> FO$SYMB.THROTTLE_CNT = SYMB$ -> FO$SYMB.THROTTLE_CNT + 1;

    861  0 000011   200004 474500                    LDP4    SYMB$,,AUTO
         0 000012   400017 235100                    LDA     15,,PR4
         0 000013   000001 035007                    ADLA    1,DL
         0 000014   400017 755100                    STA     15,,PR4

     2881      862    1         CALL SSS$SYSTIME (SYMB$ -> FO$SYMB.THROTTLE_OFF_UTS);

    862  0 000015   000015 036003                    ADLQ    13,DU
         0 000016   200010 756100                    STQ     CSEC+2,,AUTO
         0 000017   200010 630500                    EPPR0   CSEC+2,,AUTO
         0 000020   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000021   000000 701000 xent               TSX1    SSS$SYSTIME
         0 000022   000000 011000                    NOP     0

     2882      863    1         CALL XUD$UTS_DIFF (cSEC, SYMB$->FO$SYMB.THROTTLE_OFF_UTS, SYMB$->FO$SYMB.
               863                  THROTTLE_ON_UTS);

    863  0 000023   200004 236100                    LDQ     SYMB$,,AUTO
PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:407  
         0 000024   000014 036003                    ADLQ    12,DU
         0 000025   200012 756100                    STQ     CSEC+4,,AUTO
         0 000026   200004 236100                    LDQ     SYMB$,,AUTO
         0 000027   000015 036003                    ADLQ    13,DU
         0 000030   200011 756100                    STQ     CSEC+3,,AUTO
         0 000031   200006 630500                    EPPR0   CSEC,,AUTO
         0 000032   200010 450500                    STP0    CSEC+2,,AUTO
         0 000033   200010 630500                    EPPR0   CSEC+2,,AUTO
         0 000034   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000035   000000 701000 xent               TSX1    XUD$UTS_DIFF
         0 000036   000000 011000                    NOP     0

     2883      864    1         SYMB$ -> FO$SYMB.THROTTLE_TIME = SYMB$ -> FO$SYMB.THROTTLE_TIME + CSEC;

    864  0 000037   200004 470500                    LDP0    SYMB$,,AUTO
         0 000040   000016 236100                    LDQ     14,,PR0
         0 000041   200006 036100                    ADLQ    CSEC,,AUTO
         0 000042   000016 756100                    STQ     14,,PR0

     2884      865    1         CALL FOM$DEBLOCK (LDCT$->NK$LDCT);

    865  0 000043   200005 630500                    EPPR0   LDCT$,,AUTO
         0 000044   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000045   000000 701000 xent               TSX1    FOM$DEBLOCK
         0 000046   000000 011000                    NOP     0

     2885      866    1         ALTRETURN;

    866  0 000047   000000 702200 xent               TSX2  ! X66_AALT
     2886      867
     2887      868    1   END FOM$DEBEV;

PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:408  
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   FOM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FOM$STRUCT.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FOM$DEBEV.
PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:409  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DOLIST$                   6-0-0/w SBIN        r     1 CSEC
    *0-0-0/w PTR         r     1 DOLIST$                    5-0-0/w PTR         r     1 LDCT$
     5-0-0/w UBIN        r     1 LDCT$U                     4-0-0/w PTR         r     1 SYMB$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(396)   r     1 B$DO                       0-0-0/w STRC(720)   r     1 FO$SYMB
     0-0-0/d STRC(864)   r     1 NK$LDCT


   Procedure FOM$DEBEV requires 40 words for executable code.
   Procedure FOM$DEBEV requires 12 words of local(AUTO) storage.

    No errors detected in file FOM$MOOS.:E05TSI    .
PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:410  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:411  
          MINI XREF LISTING

B$DO.ECCINFO
       160**DCL       161--REDEF
B$DO.EVID
       154**DCL       859>>ASSIGN
B$U.MISC
       139**DCL       140--REDEF
B$USER.MISC
       215**DCL       216--REDEF
CSEC
       776**DCL       863<>CALL      864>>ASSIGN
DOLIST$
       766**DCL         6--PROC      859>>ASSIGN
FO$SYMB.BR.BLK#
       838**DCL       839--REDEF
FO$SYMB.BR.REC#
       839**DCL       840--REDEF
FO$SYMB.BUF$
       837**DCL       838--REDEF
FO$SYMB.CUREXT.STAMP
       841**DCL       842--REDEF
FO$SYMB.SPACEPAGES
       845**DCL       846--REDEF
FO$SYMB.THROTTLE_CNT
       854**DCL       861<<ASSIGN    861>>ASSIGN
FO$SYMB.THROTTLE_OFF_UTS
       853**DCL       862<>CALL      863<>CALL
FO$SYMB.THROTTLE_ON_UTS
       853**DCL       863<>CALL
FO$SYMB.THROTTLE_TIME
       854**DCL       864<<ASSIGN    864>>ASSIGN
FOM$DEBLOCK
       770**DCL-ENT   865--CALL
PL6.E3A0      #011=FOM$DEBEV File=FOM$MOOS.:E05TSI                               TUE 07/29/97 17:11 Page:412  
LDCT$
       774**DCL       775--REDEF     860>>ASSIGN    865>>CALL
LDCT$U
       775**DCL       859<<ASSIGN
NK$LDCT
       792**DCL       865<>CALL
NK$LDCT.DDT$
       794**DCL       794--REDEF
NK$LDCT.IOQ$
       793**DCL       794--REDEF
NK$LDCT.LDCTX
       795**DCL       795--REDEF
NK$LDCT.LKFLG.ABORTED
       807**DCL       808--REDEF
NK$LDCT.RLCID.LDCTX
       817**DCL       817--REDEF
NK$LDCT.STA$
       813**DCL       814--REDEF
NK$LDCT.SYMB$
       792**DCL       792--REDEF     792--REDEF     793--REDEF     860>>ASSIGN
SSS$SYSTIME
       771**DCL-ENT   862--CALL
SYMB$
       767**DCL       860<<ASSIGN    861>>ASSIGN    861>>ASSIGN    862>>CALL      863>>CALL      863>>CALL
       864>>ASSIGN    864>>ASSIGN
XUD$UTS_DIFF
       721**DCL-ENT   863--CALL
