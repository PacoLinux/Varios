VERSION E05

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:1    
        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        7        7        /*X* CLM=0,PLM=3,CSU=3,ECU=3,IAD=3,IND=0 */
        8        8        /*M* KVO$OTPLCL VDH XLATE AND BUFFER OUTPUT STRING ROUTINE */
        9        9        /*X* CLM=0,PLM=3,CSU=3,ECU=3,IAD=3,IND=0 */
       10       10        KVO$OTPLCL: PROC(KV$VDH_OTPLCL);
       11       11
       12       12        %INCLUDE KL_AFCN_C;
       13      113        %INCLUDE KL_MACRO_C;
       14     3465        %INCLUDE K_ID_E;
       15     3515        %K#ENTID_E;
       16     3534        %K#LYRID_E;
       17     3541
       18     3542 S      %INCLUDE KV$GLB; /* VDH PROCS                                                 */
       19     3543 S      %INCLUDE KV_GLBCNS_E; /* VDH CONSTANTS                                        */
       20     3544 S      %INCLUDE KV$GLBCTX;
       21     3545 S      %INCLUDE KV$USR;
       22     3546 S      %INCLUDE KV$VDH;
       23     3547 S      %INCLUDE KV$INT;
       24     3548 S      %INCLUDE KV_PRMID_E;
       25     3549        %KV_USR_FNC_E;
       26     3565        %KV#VD_ORG_E;
       27     3573         /**/
       28     3574    1   DCL KV_VDH_PST_0_VRT UBIN SYMREF;
       29     3575    1   DCL KV_VDH_PST_LF UBIN SYMREF;
       30     3576    1   DCL KV_VDH_PST_LF_VRT UBIN SYMREF;
       31     3577    1   DCL KV_VDH_PST_VRT UBIN SYMREF;
       32     3578    1   DCL KV_VDH_PST_WRAP UBIN SYMREF;
       33     3579        %KV$USR_GETOTPBFR(NAME=KV_USR_GETOTPBFR, STCLASS=SYMREF);
       34     3614        %KV$MRD (STCLASS="BASED(SRD$)"); /* REAL DEVICE CONTEXT BLOCK                 */
       35     3661        %EQU KV_MRD=CHARTEXT('KV$SRD.MRD$->KV$MRD');
       36     3662        %KV$MVD; /* VIRTUAL DEVICE CONTEXT BLOCK                                      */
       37     3706        %KV_OTPFNC_E; /* VDH OUTPUT FUNCTIONS DEFFINITIONS                            */
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:2    
       38     3714        %KV_PHSPSTMOD_E;
       39     3721        %KV$EXTOTPTRN;
       40     3774        %EQU KV_EXTTRN=CHARTEXT('ADDR(FPT)->KV$USR_EXTOTPTRN.EXTTRN$->KV$EXTOTPTRN');
       41     3775        %KV$SCNOTPTRN(STCLASS="BASED(B4)"); /* Secondary output translate  table      */
       42     3786        %KV$PTR; /* VDH POINTER BLOCK                                                 */
       43     3829        %KV$SHRBFR; /* VDH SHARED BUFFER TEMPLATE                                     */
       44     3861    1   DCL KV$SHRBFR_BYT(0:0) UBIN BYTE BASED CALIGNED;
       45     3862        %KV$SRD (STCLASS="BASED(SRD$)"); /* SUBORDINATE REAL DEVICE CONTEXT           */
       46     4137        %EQU KV_SRD=CHARTEXT('KV$SRD');
       47     4138        %KV$SSN; /* SESSION CONTEXT                                                   */
       48     4217        %KV$STR; /* STREAM CONTEXT                                                    */
       49     4304        %KV$STT; /* Statistics                                                        */
       50     4698        %KV$TRNTBL(STCLASS="BASED(TRNTBL$)"); /* TRANSLATE TABLE                      */
       51     4756        %KV$USRPRM; /* User parameters                                                */
       52     4807        %KV$USR_GETOTPBFR; /* REQUEST SPACE FROM THE RDH                              */
       53     4842        %KV$USR_EXTOTPTRN; /* PASSED TO THE RDH FOR OUTPUT TOK TRNS                   */
       54     4878        %KV$USR_PST; /* POSITIONING REQUEST TO RDH                                    */
       55     4948        %KV$VDH_OTPLCL(STCLASS=); /* ARGUMENT STRUCTURE                               */
       56     5021        %KV$VDH_OTPLCL(NAME=VDH_OTPLCL, STCLASS=);
       57     5094        %KV$VDH_OTPLCL (NAME=Y@VDH_OTPLCL);
       58     5167        %KV$VDH_PST; /* POSITIONING REQUEST TO VDH                                    */
       59     5241        %KV$VDI(STCLASS="BASED(VDI$)"); /* VDI CONTEXT                                */
       60     5312        %EQU KV_VDI=CHARTEXT('KV$VDI');
       61     5313        %EQU KV_USR_GETOTPBFR=CHARTEXT('ADDR(FPT)->KV$USR_GETOTPBFR');
       62     5314        %EQU KV_USR_EXTOTPTRN=CHARTEXT('ADDR(FPT)->KV$USR_EXTOTPTRN');
       63     5315        %EQU KV_USR_PST=CHARTEXT('ADDR(FPT)->KV$USR_PST');
       64     5316        %EQU KV_VDH_PST=CHARTEXT('ADDR(FPT)->KV$VDH_PST');
       65     5317        %EQU EXTOTPLCL=CHARTEXT('ADDR(FPT)->Y@VDH_OTPLCL');
       66     5318        %EQU EXTTXT=CHARTEXT('ADDR(FPT(6))->CHARS');
       67     5319    1   DCL 1 BITS BASED ALIGNED, 2 ARY(0:0) BIT(1);
       68     5320    1   DCL CHARS CHAR(255) BASED;
       69     5321                    /*
       70     5322                    * ENTREFS
       71     5323                    */
       72     5324    1   DCL KVO$PST ENTRY(1);
       73     5325    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
       74     5326    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:3    
       75     5327                    /*
       76     5328                    * KVO$OTPLCL LOCAL DATA
       77     5329                    */
       78     5330                    /*
       79     5331                    * TEMP PTR
       80     5332                    */
       81     5333    1   DCL B4 PTR;
       82     5334                    /*
       83     5335                    * TRNTBL POINTER
       84     5336                    */
       85     5337    1   DCL TRNTBL$ PTR;
       86     5338                    /*
       87     5339                    * VDI POINTER - TO SAVE A FEW INSTRUCTIONS
       88     5340                    */
       89     5341    1   DCL VDI$ PTR;
       90     5342                    /*
       91     5343                    * SRD pointer - same reason
       92     5344                    */
       93     5345    1   DCL SRD$ PTR;
       94     5346                    /*
       95     5347                    * COLUMN TO WRAP AND TRUNCATE AFTER
       96     5348                    */
       97     5349    1   DCL ENDCLM UBIN;
       98     5350    1   DCL ENDCLM_S REDEF ENDCLM SBIN;
       99     5351                    /*
      100     5352                    * NUMBER OF CHARACTERS PROCESSED IN THE LOOP
      101     5353                    */
      102     5354    1   DCL CHRCNT UBIN;
      103     5355    1   DCL CHRCNTS REDEF CHRCNT SBIN;
      104     5356    1   DCL 1 CHR REDEF CHRCNT,
      105     5357    1         2 * BIT(8), 2 CNT UBIN BYTE UNAL;
      106     5358                    /*
      107     5359                    * ABBNORMAL CHARACTER (NEEDING SPECIAL PROCESSING)
      108     5360                    */
      109     5361    1   DCL ORGCHR CHAR(1);
      110     5362                    /*
      111     5363                    * NUMBER OF CHARACTERS LEFT IN THE OUTPUT BUFFER
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:4    
      112     5364                    */
      113     5365    1   DCL OTPSPCLFT UBIN;
      114     5366                    /*
      115     5367                    * LOCAL STORAGE FOR OUTPUT ESCAPE CHARACTER
      116     5368                    */
      117     5369    1   DCL OTPESCCHR CHAR(1);
      118     5370                    /*
      119     5371                    * BIT TO INDICATE TRUNCATION ON NEXT CHARACTERS
      120     5372                    */
      121     5373    1   DCL TRUNC BIT(1);
      122     5374                    /*
      123     5375                    * SET TO INDICATE THIS LINE IS ONE SHORT AS TYPING IN THE LAST PST
      124     5376                    * WOULD SCROLL WHEN WE DONT WANT TO
      125     5377                    */
      126     5378    1   DCL AUTONL BIT(1);
      127     5379                    /*
      128     5380                    * BLANK CHARACTERS
      129     5381                    */
      130     5382    1   DCL BLANKS CHAR(32) CONSTANT INIT(' ');
      131     5383        %EQU INPCHR=CHARTEXT('SUBSTR(VDH_OTPLCL.BFR_.ADR$->CHARS, VDH_OTPLCL.BFR_.BYTX, 1)')
              5383            ;
      132     5384        %EQU INPBFR=CHARTEXT(
              5384            'SUBSTR(VDH_OTPLCL.BFR_.ADR$->CHARS, VDH_OTPLCL.BFR_.BYTX, CHR.CNT)');
      133     5385        %EQU OTPCHR=CHARTEXT('SUBSTR(KV$VDI.OTPBFR_.ADR$->CHARS, KV$VDI.OTPBFR_.BYTX, 1)');
      134     5386        %EQU OTPBFR=CHARTEXT(
              5386            'SUBSTR(KV$VDI.OTPBFR_.ADR$->CHARS, KV$VDI.OTPBFR_.BYTX, CHR.CNT)');
      135     5387    1   DCL FPT(0:9) UBIN; /* SPACE FOR FPTS                                          */
      136     5388    1   DCL I UBIN;
      137     5389    1   DCL IS REDEF I SBIN;
      138     5390    1   DCL J UBIN;
      139     5391    1   DCL JS REDEF J SBIN;
      140     5392                    /*
      141     5393                    * THE PURPOSE OF THIS ROUTINE IS TO TRANSLATE AN OUTPUT STRING
      142     5394                    * CONTAINED IN THE CALLERS BUFFER, AND PLACE THIS STRING IN THE
      143     5395                    * RDH'S BUFFER FOR OUTPUT TO THE REAL DEVICE.  THIS ROUTINE IS
      144     5396                    * CALLED WITH A STRUCTURE CONTAINING A VECTOR WHICH FRAMES THE STRING
      145     5397                    * TO BE TRANSLATED AS WELL AS OTHER ASSORTED INFORMATION
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:5    
      146     5398                    * NECESSARY TO TRANSLATE AND BUFFER THE STRING.  THE
      147     5399                    * VDI CONTEXT BLOCK CONTAINS A VECTOR FRAMING THE RDH OUTPUT
      148     5400                    * BUFFER.  MOST TRANSLATION CAN BE DONE USING THE TRANSLATE TABLES
      149     5401                    * POINTED TO BY THE MVD CONTEXT BLOCK.  TRANSLATION FOR OUTPUT
      150     5402                    * FUNCTIONS SUCH AS SP, LF, HT, CR AND BS CAN BE DONE BY THE VDH.  ALL
      151     5403                    * OTHER OUTPUT FUNCTIONS REQUIRE SPECIAL PROCESSING BY THE RDH AND
      152     5404                    * THE TRANSLATE TABLES MARK THESE FUNCTIONS FOR EXTENDED TRANSLATION.
      153     5405                    * THE RDH IS CALLED TO DO THE TRANSLATION IN THESE CASES, AND WE
      154     5406                    * THEN MARCH ON.
      155     5407                    */
      156     5408    1      VDH_OTPLCL=KV$VDH_OTPLCL;
      157     5409    1   THE_BEGINNING:;
      158     5410    1      TRUNC='0'B;
      159     5411    1      TRNTBL$=%KV_MVD.TRNTBL$;
      160     5412    1      VDI$=KV$PTR.VDI$;
      161     5413    1      SRD$=KV$PTR.SRD$;
      162     5414    1      IF %KV_SRD.FLDEND.CLM~=0 AND %KV_SRD.CRT.LIN=%KV_SRD.FLDEND.LIN
      163     5415    1      THEN ENDCLM=%KV_SRD.FLDEND.CLM;
      164     5416    1      ELSE ENDCLM=%KV_SRD.BTMRHT.CLM;
      165     5417                    /*
      166     5418                    * MAKE SURE THIS IS NOT TRANSPARENT OUTPUT
      167     5419                    */
      168     5420    2      IF NOT VDH_OTPLCL.TRN AND KV$TRNTBL.OTPTRN1$~=ADDR(NIL) THEN DO;
      169     5421    2         IF NOT %KV_SRD.VRTPSTOK AND NOT VDH_OTPLCL.NONVRT
      170     5422                    /*
      171     5423                    * Currently, the virtual-to-physical positioning correspondence
      172     5424                    * isn't linear (we did something without updating virtual),
      173     5425                    * and the current request is being done in the virtual mode.
      174     5426                    * Force the physical position to conform with the virtual before
      175     5427                    * processing the text.
      176     5428                    */
      177     5429    2         THEN CALL KVO$PST(KV_VDH_PST_VRT);
      178     5430                    /*
      179     5431                    * LOOP THROUGH THE ENTIRE READ BUFFER
      180     5432                    */
      181     5433    3         DO WHILE(VDH_OTPLCL.BFR_.BYTSIZ~=0);
      182     5434                    /*
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:6    
      183     5435                    * FINISH POSITIONING AND/OR WRAP THE LINE
      184     5436                    */
      185     5437                    /*
      186     5438                    * DETERMINE THE NUMBER OF CHARACTER POSITIONS LEFT BEFORE WE
      187     5439                    * HIT THE RIGHT MARGIN
      188     5440                    */
      189     5441    3            CHRCNT=ENDCLM-%KV_SRD.CRT.CLM;
      190     5442    3            IF NOT %KV_MRD.AUTONL
      191     5443    3              OR %KV_SRD.SCROLL AND NOT %KV_SRD.BRDEXS AND %KV_MRD.USRCNT=1
      192     5444    3              OR %KV_SRD.CRT.LIN+%KV_SRD.DVCLINBIS<%KV_MRD.LNG
      193     5445    3              OR ENDCLM~=%KV_MRD.WDT
      194     5446    4              OR NOT %KV_MRD.DEVSCROLL THEN DO;
      195     5447    4               CHRCNT=CHRCNT+1;
      196     5448    4               AUTONL='0'B;
      197     5449    4               END;
      198     5450    3            ELSE AUTONL='1'B;
      199     5451    4            IF CHRCNTS<=0 THEN DO;
      200     5452         /* WE NEED TO WRAP                                                           */
      201     5453    4               CHRCNT = 0;
      202     5454    4               IF %KV_SRD.WDT=0 OR %KV_SRD.LNG=0 THEN GOTO GOBACK;
      203     5455    4               TRUNC=%KV_SRD.TRUNCATE;
      204     5456    5               IF NOT TRUNC THEN DO;
      205     5457    5                  IF %KV_VDI.OTPCNDPND.PST~=0
      206     5458    5                    AND %KV_VDI.OTPCNDPND.PST~=%KV_PHSPSTMOD_BLN
      207     5459    5                  THEN CALL KVV$CALUSR_PST;
      208     5460    6                  CALL Y$WRAP WHENALTRETURN DO; GOTO GOBACK; END;
      209     5461    5                  END;
      210     5462    4               ELSE CHRCNT=255;
      211     5463    4               END;
      212     5464         /**/
      213     5465                    /*
      214     5466                    *
      215     5467                    * CHRCNT HAS COLUMNS TILL RIGHT MRG
      216     5468                    */
      217     5469         /**/
      218     5470    3            CHRCNT=MINIMUM(CHRCNT, VDH_OTPLCL.BFR_.BYTSIZ, 255);
      219     5471    3            I=CHRCNT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:7    
      220     5472         /**/
      221     5473    4            IF %KV_MRD.MINSP_FORPST>1 AND CHRCNT>0 THEN DO;
      222     5474    4               CALL INDEX(CHRCNT, SUBSTR(BLANKS, 0, %KV_MRD.MINSP_FORPST),
      223     5475    4                 %INPBFR);
      224     5476                   /*N* LAST LINE SHOULD BE:  SUBSTR(%INPBFR, 0, VDH_OTPLCL.BFR_.BYTSIZ));*/
      225     5477    4               IF I<CHRCNT THEN CHRCNT=I;
      226     5478    4               END;
      227     5479    4            IF CHRCNT~=0 THEN DO;
      228     5480    4               IF %KV_VDI.OTPCNDPND.PST~=0
      229     5481                    /*
      230     5482                    * The physical and desired cursor positions don't
      231     5483                    * MATCH, AND WE ARE ABOUT TO OUTPUT TEXT, SO WE
      232     5484                    * HAVE TO GENERATE WHATEVER IS REQUIRED TO MOVE
      233     5485                    * THE CURSOR TO THE DESIRED POSITION.
      234     5486                    */
      235     5487    4               THEN CALL KVV$CALUSR_PST;
      236     5488                    /*
      237     5489                    * DETERMINE HOW MUCH SPACE IS LEFT IN THE RDH OUTPUT BUFFER
      238     5490                    */
      239     5491    5               IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN DO;
      240     5492                    /*
      241     5493                    * IF THE BUFFER IS EMPTY, CALL THE RDH TO GET MORE SPACE AND
      242     5494                    * SEE HOW MUCH WE GET.
      243     5495                    */
      244     5496    5                  %KV_USR_GETOTPBFR=KV_USR_GETOTPBFR;
      245     5497    5                  %KV_USR_GETOTPBFR.ESTBYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ;
      246     5498    5                  CALL KVV$CALUSR(FPT);
      247     5499    5                  IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN RETURN;
      248     5500    5                  END;
      249     5501    5               IF CHRCNT>%KV_VDI.OTPBFR_.BYTSIZ THEN DO;
      250     5502    5                  CHRCNT=%KV_VDI.OTPBFR_.BYTSIZ;
      251     5503    5                  IF I>CHRCNT THEN I=CHRCNT;
      252     5504    5                  END;
      253     5505    4               CALL XLATE(%OTPBFR, KV$TRNTBL.OTPTRN1$->CHARS, %INPBFR);
      254     5506    4               IF NOT KV$TRNTBL.OTPESC.NONE
      255     5507    4               THEN CALL INDEX(CHRCNT, KV$TRNTBL.OTPESC.CHR, %OTPBFR);
      256     5508                    /*
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:8    
      257     5509                    * ACCOUNT FOR THE POSITIONING OF CHARACTERS WE STUFFED INTO THE BUFFER
      258     5510                    */
      259     5511    4   NRMTRNPST:  IF NOT VDH_OTPLCL.NONVRT
      260     5512                    /*
      261     5513                    * WE HAVE BEEN REQUESTED TO INCREMENT THE VIRTUAL
      262     5514                    * POSITION WHEN UPDATING THE PHYSICAL POSITION.
      263     5515                    */
      264     5516    4               THEN %KV_MVD.VRTCLM=%KV_MVD.VRTCLM+CHRCNT;
      265     5517                    /*
      266     5518                    * WE ARE NOT TO UPDATE THE VIRTUAL POSITION, SO THE VIRTUAL POSITION
      267     5519                    * IS PROBABLY NO LONGER VALID.
      268     5520                    */
      269     5521    5               ELSE DO;
      270     5522        /* This is non-virtual output.  Make sure any pending retyp gets enough data. */
      271     5523
      272     5524    5                  %KV_SRD.VRTPSTOK='0'B;
      273     5525    5                  IF %KV_VDI.RE_DSPLOWX>%KV_SSN.REDBFR.EDTLOWX
      274     5526    5                  THEN %KV_VDI.RE_DSPLOWX=%KV_SSN.REDBFR.EDTLOWX;
      275     5527    5                  END;
      276     5528    5               IF NOT TRUNC AND CHRCNT~=0 THEN DO;
      277     5529    5                  %KV_MRD.DVCCLM=CHRCNT+%KV_MRD.DVCCLM;
      278     5530    5                  %KV_SRD.CRT.CLM=%KV_MRD.DVCCLM;
      279     5531    6                  IF %KV_SRD.HI_NONBLN_PST<%KV_SRD.CRT_PST THEN DO;
      280     5532                    /*
      281     5533                    * The characters we're writing are farther down the page than
      282     5534                    * the previous farthest.
      283     5535                    */
      284     5536    6                     JS=VDH_OTPLCL.BFR_.BYTX+CHRCNT-1;
      285     5537        /* First check for trailing blanks.                */
      286     5538    7                     DO WHILE SUBSTR(VDH_OTPLCL.BFR_.ADR$->CHARS,JS,1)=' ';
      287     5539    7                        JS=JS-1;
      288     5540    7                        END;
      289     5541    6                     IF JS<VDH_OTPLCL.BFR_.BYTX THEN EXIT;
      290     5542    6                     JS=JS-VDH_OTPLCL.BFR_.BYTX-CHRCNT;
      291     5543    6                     %KV_SRD.HI_NONBLN=%KV_SRD.CRT;
      292     5544    6                     %KV_SRD.HI_NONBLN.CLM=%KV_SRD.HI_NONBLN.CLM+JS;
      293     5545    6                     %KV_SRD.HI_NONBLNVRT=%KV_SRD.VRTPSTOK;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:9    
      294     5546    6                     END;
      295     5547    6                  IF VDH_OTPLCL.HDN THEN DO J=0 TO CHRCNT-1;
      296     5548                    /*
      297     5549                    * HIDDEN SIMULATION - SEND BLANKS INSTEAD OF THE CHARACTERS.
      298     5550                    */
      299     5551    6                     %OTPCHR=KV$TRNTBL.SP_CHR;
      300     5552    6                     %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+1;
      301     5553    6                     END;
      302     5554    5                  ELSE /* !! NOTE THIS IS PART OF THE NEXT STATEMENT !!          */
      303     5555                    /*
      304     5556                    * UPDATE VECTOR BYTE INDEXES
      305     5557                    */
      306     5558    5   NRMTRNNO_PST:  %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+CHRCNT;
      307     5559    5                  %KV_VDI.OTPBFR_.BYTSIZ=%KV_VDI.OTPBFR_.BYTSIZ-CHRCNT;
      308     5560    5                  %KV_SSN.OTPCHRCNT=%KV_SSN.OTPCHRCNT+CHRCNT;
      309     5561    5                  %KV_STT.OTPCHRCNT=%KV_STT.OTPCHRCNT+CHRCNT;
      310     5562    5                  %KV_VDI.TMPOTPCHRCNT=%KV_VDI.TMPOTPCHRCNT+CHRCNT;
      311     5563    5                  IF %KV_SRD.CRT.CLM>ENDCLM_S
      312     5564    5                    AND NOT %KV_SRD.TRUNCATE
      313     5565    5                    AND %KV_VDI.USRRQSDAT.RED
      314     5566    5                    AND %KV_MVD.RETYPOVR
      315     5567    5                  THEN IF %KV_SRD.CRT.LIN~=%KV_SRD.FLDEND.LIN
      316     5568    6                    OR %KV_SRD.CRT.LIN=0 THEN DO;
      317     5569    6                     I=%KV_SRD.BTMRHT.LIN-%KV_SRD.DVCLINBIS;
      318     5570    6                     IF %KV_SRD.PAGEHALT AND %KV_SRD.PRINTHALT
      319     5571    6                       AND %KV_SRD.DVCLINBIS=0 THEN I=I-1;
      320     5572    7                     IF IS>%KV_SRD.CRT.LIN THEN DO;
      321     5573                    /*
      322     5574                    *WERE PAST THE RIGHT MARGIN AND THERE'S MORE TEXT BELOW
      323     5575                    *POSITION TO THE PROPER CHARACTER
      324     5576                    */
      325     5577    7                        CALL Y$WRAP;
      326     5578    7                        END;
      327     5579    6                     I=CHRCNT; /* No special char here                           */
      328     5580    6                     END;
      329     5581    5                  ELSE %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;
      330     5582    5                  END;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:10   
      331     5583    4   NRMTRNTRUNC: VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+CHRCNT;
      332     5584    4               VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-CHRCNT;
      333     5585    4               END; /* IF CHRCNT~=0                                              */
      334     5586        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:11   
      335     5587                    /*
      336     5588                    * SEE IF WE EXITED DUE TO DETECTING A SPECIAL CHARCTER OR NORMALLY
      337     5589                    * ON LOOP TERMINATION
      338     5590                    */
      339     5591    4            IF I~=CHRCNT THEN DO;
      340     5592         /* we found either a string of MINSPFORPST blanks or a special char          */
      341     5593    4               ORGCHR=%INPCHR;
      342     5594    4               IF KV$TRNTBL.OTPTRN2$=ADDR(NIL) THEN GOTO BLANKS;
      343     5595    4               B4=KV$TRNTBL.OTPTRN2$;
      344     5596    4   NXTTBL:     CALL INDEX(I, ORGCHR, KV$SCNOTPTRN.CHR) ALTRET(BLANKS);
      345     5597    4               J=I+KV$SCNOTPTRN.CNT;
      346     5598    4               OTPESCCHR = KV$SCNOTPTRN.CHRA(JS);
      347     5599    5               IF PINCRW(B4, KV$SCNOTPTRN.CNT)->BITS.ARY(I) THEN DO;
      348     5600         /* Normal translation (positioning or not)                                   */
      349     5601    5                  I=1;
      350     5602    5                  %OTPCHR=OTPESCCHR;
      351     5603    5                  CHRCNT=1;
      352     5604    5                  IF TRUNC THEN GOTO NRMTRNTRUNC;
      353     5605    5                  IF PINCRW(B4, KV$SCNOTPTRN.CNT)->BITS.ARY(JS)
      354     5606         /* Positioning                                                               */
      355     5607    5                  THEN GOTO NRMTRNPST;
      356     5608    5                  GOTO NRMTRNNO_PST;
      357     5609    5                  END;
      358     5610        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:12   
      359     5611    4               IF PINCRW(B4, KV$SCNOTPTRN.CNT)->BITS.ARY(JS)
      360     5612         /* If we get here, OTPESCCHR is a function code.                             */
      361     5613    5               THEN DO CASE(ASCBIN(OTPESCCHR));
      362     5614    5               CASE(%KV_OTPFNC_NXTTBL);
      363     5615         /* NXTTBL entry                                                              */
      364     5616    6                  IF B4=KV$TRNTBL.OTPTRN2$ THEN DO;
      365     5617    6                     B4=KV$TRNTBL.OTPTRN3$;
      366     5618    6                     GOTO NXTTBL;
      367     5619    6                     END;
      368     5620        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:13   
      369     5621    5               CASE(%KV_OTPFNC_BS);
      370     5622                    /*
      371     5623                    * OUTPUT FUNCTION: BS (BACKSPACE)
      372     5624                    */
      373     5625    6                  DO WHILE VDH_OTPLCL.BFR_.BYTSIZ > 0 AND ORGCHR=%INPCHR;
      374     5626    7                     IF NOT VDH_OTPLCL.NONVRT THEN DO;
      375     5627                    /*
      376     5628                    * WE ARE TO UPDATE THE VIRTUAL POSITION, SO CONSIDER
      377     5629                    * IT IN BOUNDARY CASES.
      378     5630                    */
      379     5631    8                        IF %KV_MVD.VRTCLM>1 THEN DO;
      380     5632                    /*
      381     5633                    * WE'RE NOT AT THE VIRTUAL (ABSOLUTE) LEFT MARGIN,
      382     5634                    * SO HONOR THE BS.
      383     5635                    */
      384     5636    8                           %KV_MVD.VRTCLM=%KV_MVD.VRTCLM-1;
      385     5637    9                           IF %KV_SRD.CRT.CLM<=%KV_SRD.TOPLFT.CLM THEN DO;
      386     5638                    /*
      387     5639                    * WE'RE ALREADY AT THE LEFT MARGIN; 'UNFOLD' THE LINE.
      388     5640                    */
      389     5641    9                              %KV_SRD.CRT.CLM=%KV_SRD.BTMRHT.CLM;
      390     5642    9                              %KV_SRD.CRT.LIN=%KV_SRD.CRT.LIN-1;
      391     5643    9                              END;
      392     5644    8                           ELSE IF NOT TRUNC
      393     5645                    /*
      394     5646                    * WE'RE NOT AT THE LEFT MARGIN; DO A 'NORMAL' BACKSPACE.
      395     5647                    */
      396     5648    8                           THEN %KV_SRD.CRT.CLM=%KV_SRD.CRT.CLM-1;
      397     5649    9                           ELSE IF %KV_MVD.VRTCLM<=%KV_SRD.WDT THEN DO;
      398     5650                    /*
      399     5651                    * WE'RE BACKSPACING BACK ONTO THE SCREEN, STOP TRUNCATING
      400     5652                    */
      401     5653    9                              TRUNC='0'B;
      402     5654    9                              %KV_SRD.CRT.CLM=%KV_MVD.VRTCLM;
      403     5655    9                              END;
      404     5656    8                           END;
      405     5657    7                        END;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:14   
      406     5658                    /*
      407     5659                    * WE AREN'T TO UPDATE THE VIRTUAL POSITION, SO IGNORE IT.
      408     5660                    */
      409     5661    6                     ELSE IF %KV_SRD.CRT.CLM>%KV_SRD.TOPLFT.CLM
      410     5662                    /*
      411     5663                    * WE'RE NOT AT THE LEFT MARGIN, SO DO THE BS.
      412     5664                    */
      413     5665    6                     THEN %KV_SRD.CRT.CLM=%KV_SRD.CRT.CLM-1;
      414     5666    6                     VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;
      415     5667    6                     VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;
      416     5668    6                     END;
      417     5669    5                  %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;
      418     5670        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:15   
      419     5671    5               CASE(%KV_OTPFNC_CR);
      420     5672                    /*
      421     5673                    * OUTPUT FUNCTION: CR (CARRIAGE RETURN)
      422     5674                    */
      423     5675                    /*
      424     5676                    * RESET THE TRUNCATION FLAG SINCE WE ARE GOING TO THE LEFT MARGIN;
      425     5677                    */
      426     5678    5                  TRUNC='0'B;
      427     5679    5                  %KV_SRD.CRT.CLM=%KV_SRD.TOPLFT.CLM;
      428     5680    5                  %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;
      429     5681    6                  IF NOT VDH_OTPLCL.NONVRT THEN DO;
      430     5682                    /*
      431     5683                    * WE'RE TO UPDATE THE VIRTUAL POSITION; GO TO
      432     5684                    * VIRTUAL COLUMN 1.
      433     5685                    */
      434     5686    6                     %KV_MVD.VRTCLM=1;
      435     5687    6                     %KV_SRD.CRT.LIN=%KV_SRD.CRTVRTLINPHSLIN;
      436     5688    6                     END;
      437     5689    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;
      438     5690    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;
      439     5691        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:16   
      440     5692    5               CASE(%KV_OTPFNC_HT);
      441     5693                    /*
      442     5694                    * OUTPUT FUNCTION: HT (HORIZONTAL TAB)
      443     5695                    */
      444     5696    5                  J = %KV_MVD.VRTCLM+1; /* DEFAULT TAB IS ONE SPACE              */
      445     5697    5                  %KV_MVD.VRTCLM = J;
      446     5698    5                  B4=%KV_STR.OTPTAB$;
      447     5699    5                  IF B4~=ADDR(NIL) THEN
      448     5700    6   TABLOOP:       DO I=SIZEC(KV$SHRBFR)+1 TO B4->KV$SHRBFR.BYTSIZ-1;
      449     5701                    /*
      450     5702                    * THE TAB BUFFER EXISTS.
      451     5703                    */
      452     5704                    /*
      453     5705                    * THIS LOOP IS TRAVERSED FOR EACH POSITION IN THE TAB BUFFER
      454     5706                    * SCANNED, UNTIL THE CORRECT TAB IS FOUND OR THE END IS ENCOUNTERED.
      455     5707                    */
      456     5708    7                     IF B4->KV$SHRBFR_BYT(IS)>=J THEN DO;
      457     5709                    /*
      458     5710                    * THE CURRENT TAB STOP IS GREATER THAN THE ONE WE'RE LOOKING FOR;
      459     5711                    * WE'VE FOUND IT.
      460     5712                    */
      461     5713    7                        %KV_MVD.VRTCLM = B4->KV$SHRBFR_BYT(IS);
      462     5714    7                        EXIT TABLOOP;
      463     5715    7                        END;
      464     5716    6                     END;
      465     5717    6                  IF NOT TRUNC THEN DO;
      466     5718    6                     IF NOT VDH_OTPLCL.NONVRT AND %KV_MVD.TABSIM
      467     5719                    /*
      468     5720                    * WE'RE IN TAB SIMULATION MODE; SEND SPACES, ETC., TO
      469     5721                    * MOVE THE CARRIAGE.
      470     5722                    */
      471     5723    6                     THEN CALL KVO$PST(KV_VDH_PST_0_VRT);
      472     5724    7                     ELSE DO;
      473     5725                    /*
      474     5726                    * WE'RE NOT TO SIMULATE TABS; SEND A HORIZONTAL TAB CHARACTER.
      475     5727                    */
      476     5728    7                        %OTPCHR=KV$TRNTBL.HT_CHR;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:17   
      477     5729    7                        CHRCNT=1;
      478     5730    7                        I=1;
      479     5731    7                        GOTO NRMTRNNO_PST;
      480     5732    7                        END;
      481     5733    6                     END;
      482     5734    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;
      483     5735    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;
      484     5736        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:18   
      485     5737    5               CASE(%KV_OTPFNC_LF);
      486     5738                    /*
      487     5739                    * OUTPUT FUNCTION: LF (LINE FEED)
      488     5740                    */
      489     5741    5                  IF NOT TRUNC
      490     5742    5                  THEN IF NOT VDH_OTPLCL.NO_WRAP
      491     5743    5                  THEN IF VDH_OTPLCL.NONVRT
      492     5744    5                  THEN CALL KVO$PST(KV_VDH_PST_LF);
      493     5745    5                  ELSE CALL KVO$PST(KV_VDH_PST_LF_VRT);
      494     5746    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;
      495     5747    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;
      496     5748        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:19   
      497     5749    5               CASE(ELSE);
      498     5750                    /*
      499     5751                    * OUTPUT FUNCTION: SP (SPACE)
      500     5752                    */
      501     5753    5   BLANKS:        ;
      502     5754    5                  CHRCNT=%KV_MRD.MINSP_FORPST;
      503     5755    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+CHRCNT;
      504     5756    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-CHRCNT;
      505     5757    6                  DO WHILE VDH_OTPLCL.BFR_.BYTSIZ>0;
      506     5758    7                     IF %INPCHR=' ' THEN DO;
      507     5759    7                        VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;
      508     5760    7                        VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;
      509     5761    7                        CHRCNT=CHRCNT+1;
      510     5762    7                        END;
      511     5763    6                     ELSE EXIT;
      512     5764    6                     END;
      513     5765    6                  IF NOT TRUNC THEN DO;
      514     5766    6                     IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP
      515     5767    6                     THEN CALL KVV$CALUSR_PST;
      516     5768    6                     ELSE %KV_VDI.OTPCNDPND.PST = 0;
      517     5769    6                     %KV_SRD.CRT.CLM=%KV_SRD.CRT.CLM+CHRCNT;
      518     5770    6                     IS = %KV_SRD.CRT.CLM-ENDCLM;
      519     5771    7                     IF IS>0 THEN DO;
      520     5772    8                        IF %KV_SRD.TRUNCATE THEN DO;
      521     5773    8                           %KV_SRD.CRT.CLM=ENDCLM;
      522     5774                    /*
      523     5775                    * WE'RE TRUNCATING, POSITION TO THE RIGHT MARGIN,
      524     5776                    * THEN SEND ONE MORE BLANK.
      525     5777                    */
      526     5778    8                           VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX-1;
      527     5779    8                           VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ+1;
      528     5780    8                           CHRCNT=CHRCNT-1;
      529     5781    8                           END;
      530     5782    8                        ELSE DO WHILE IS>0;
      531     5783    8                           JS = %KV_SRD.DVCLINBIS+%KV_SRD.CRT.LIN+1
      532     5784    8                             -%KV_SRD.BTMRHT.LIN;
      533     5785    8                           IF IS=1 AND (VDH_OTPLCL.BFR_.BYTX~=
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:20   
      534     5786    8                             KV$VDH_OTPLCL.BFR_.BYTX OR NOT AUTONL
      535     5787    8                             AND NOT (%KV_VDI.USRRQSDAT.RED AND %KV_MVD.RETYPOVR
      536     5788    8                             AND (JS<=0 AND NOT (%KV_SRD.DVCLINBIS~=0
      537     5789    8                             AND %KV_SRD.PAGEHALT AND %KV_SRD.PRINTHALT)
      538     5790    8                             OR JS<0))) THEN I=0;
      539     5791    9                           ELSE DO;
      540     5792                    /*
      541     5793                    * WE ARE PAST THE RIGHT EDGE;
      542     5794                    * OR AT IT, READING, AND NOT ON THE BOTTOM LINE;
      543     5795                    * WE'LL HAVE TO FOLD THE LINE OVER.
      544     5796                    */
      545     5797    9                              I=%KV_SRD.CRT.CLM-%KV_SRD.WDT;
      546     5798   10                              CALL Y$WRAP WHENALTRETURN DO;
      547     5799   10                                 I=I-%KV_SRD.TOPLFT.CLM;
      548     5800   10                                 VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX-I;
      549     5801   10                                 VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ+I;
      550     5802   10                                 CHRCNT=CHRCNT-I;
      551     5803   10                                 I=%KV_SRD.BTMRHT.CLM+1;
      552     5804   10                                 END;
      553     5805    9                              %KV_SRD.CRT.CLM=I;
      554     5806    9                              I=I-%KV_SRD.BTMRHT.CLM;
      555     5807    9                              END;
      556     5808    8                           END;
      557     5809    7                        END;
      558     5810    6                     IF %KV_VDI.OTPCNDPND.PST=0
      559     5811    6                     THEN %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN;
      560     5812    6                     END;
      561     5813    6                  IF NOT VDH_OTPLCL.NONVRT THEN DO;
      562     5814                    /*
      563     5815                    * WE HAVE BEEN REQUESTED TO UPDATE THE VIRTUAL POSITION
      564     5816                    * WHEN UPDATING THE PHYSICAL POSITION.
      565     5817                    */
      566     5818    6                     %KV_MVD.VRTCLM=%KV_MVD.VRTCLM+CHRCNT;
      567     5819    6                     %KV_SRD.VRTPSTOK='1'B;
      568     5820    6                     END;
      569     5821    5               END; /* DO CASE                                                   */
      570     5822    5               ELSE DO;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:21   
      571     5823                    /*
      572     5824                    * EXTTRN (EXTENDED TRANSLATION) ENTRY IN SECONDARY TABLE.
      573     5825                    */
      574     5826    5                  %KV_USR_EXTOTPTRN.FNC=%KV_USR_FNC_EXTOTPTRN;
      575     5827    5                  %KV_USR_EXTOTPTRN.ORGCHR=ORGCHR;
      576     5828    5                  %KV_USR_EXTOTPTRN.ID=ASCBIN(OTPESCCHR);
      577     5829    5                  %KV_USR_EXTOTPTRN.OTPLCLFLGS=
      578     5830    5                    ADDR(VDH_OTPLCL)->KV$USR_EXTOTPTRN.OTPLCLFLGS;
      579     5831    5                  %EXTOTPLCL.EXTOTPTRN='1'B;
      580     5832    5                  %KV_USR_EXTOTPTRN.EXTTRN$=KV$TRNTBL.EXTOTPTRN$;
      581     5833    6                  DO WHILE %KV_USR_EXTOTPTRN.EXTTRN$~=ADDR(NIL) AND FPT(0)~=0;
      582     5834        /* Search for the proper table. */
      583     5835    7                     IF %KV_USR_EXTOTPTRN.ID>=%KV_EXTTRN.CNT THEN DO;
      584     5836    7                        %KV_USR_EXTOTPTRN.ID=%KV_USR_EXTOTPTRN.ID-%KV_EXTTRN.CNT;
      585     5837    7                        %KV_USR_EXTOTPTRN.EXTTRN$=%KV_EXTTRN.LNK$;
      586     5838    7                        END;
      587     5839    6                     ELSE IF %KV_EXTTRN.TXTSIZ=0 OR %KV_EXTTRN.TXTSIZ>7
      588     5840    6                       OR %KV_EXTTRN.TMPLATSIZ>7 THEN EXIT;
      589     5841    7                     ELSE IF %KV_EXTTRN.TMPLATSIZ~=0 THEN DO;
      590     5842    7                        JS=%KV_EXTTRN.TMPLATSIZ;
      591     5843    7                        SUBSTR(%EXTTXT,0,JS)=SUBSTR(%KV_EXTTRN.TXT,0,JS);
      592     5844    7                        IS=(%KV_USR_EXTOTPTRN.ID+1)*%KV_EXTTRN.TXTSIZ+JS;
      593     5845    7                        %EXTOTPLCL.BFR_.BYTSIZ=JS;
      594     5846    8                        DO WHILE JS>0;
      595     5847    8                           JS=JS-1;
      596     5848    8                           IF SUBSTR(%EXTTXT,JS,1)=KV$TRNTBL.OTPESC.CHR
      597     5849    9                           THEN DO;
      598     5850    9                              IS=IS-1;
      599     5851    9                              SUBSTR(%EXTTXT,JS,1)=SUBSTR(%KV_EXTTRN.TXT,IS,1);
      600     5852    9                              END;
      601     5853    8                           END;
      602     5854    7                        GOTO EXTOTPLCL;
      603     5855    7                        END;
      604     5856    7                     ELSE IF %KV_EXTTRN.TXTSIZ>1 OR NOT %KV_EXTTRN.TRN THEN DO;
      605     5857    7                        JS=%KV_EXTTRN.TXTSIZ;
      606     5858    7                        %EXTOTPLCL.BFR_.BYTSIZ=JS;
      607     5859    7                        SUBSTR(%EXTTXT,0,JS)=SUBSTR(%KV_EXTTRN.TXT,
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:22   
      608     5860    7                          %KV_USR_EXTOTPTRN.ID*JS,JS);
      609     5861    7   EXTOTPLCL:           ;
      610     5862    7                        IF %KV_EXTTRN.TRN AND NOT %EXTOTPLCL.HDN
      611     5863    8                          AND %KV_EXTTRN.WDT=1 AND NOT TRUNC THEN DO;
      612     5864    8                           %EXTOTPLCL.TRN='1'B;
      613     5865    8                           %KV_MRD.DVCCLM=%KV_MRD.DVCCLM+1;
      614     5866    8                           %KV_SRD.CRT.CLM=%KV_MRD.DVCCLM;
      615     5867    8                           %KV_SRD.HI_NONBLN_PST=%KV_SRD.CRT_PST-1;
      616     5868    8                           IF NOT VDH_OTPLCL.NONVRT
      617     5869    8                           THEN %KV_MVD.VRTCLM=%KV_MVD.VRTCLM+1;
      618     5870    9                           ELSE DO;
      619     5871    9                              %KV_SRD.VRTPSTOK='0'B;
      620     5872    9                              IF %KV_VDI.RE_DSPLOWX>%KV_SSN.REDBFR.EDTLOWX
      621     5873    9                              THEN %KV_VDI.RE_DSPLOWX=%KV_SSN.REDBFR.EDTLOWX;
      622     5874    9                              END;
      623     5875    8                           END;
      624     5876    7                        %EXTOTPLCL.BFR_.ADR$=ADDR(%EXTTXT);
      625     5877    7                        %EXTOTPLCL.BFR_.BYTX=0;
      626     5878    7                        CALL KVO$OTPLCL(FPT);
      627     5879    7                        FPT(0)=0; /* SAY WERE DONE                               */
      628     5880    7                        END;
      629     5881    7                     ELSE DO;
      630     5882    7                        %OTPCHR=SUBSTR(%KV_EXTTRN.TXT,%KV_USR_EXTOTPTRN.ID,1);
      631     5883    7                        I=1;
      632     5884    7                        CHRCNT=1;
      633     5885    7                        IF TRUNC THEN GOTO NRMTRNTRUNC;
      634     5886    7                        IF %KV_EXTTRN.WDT=1 THEN GOTO NRMTRNPST;
      635     5887    7                        GOTO NRMTRNNO_PST;
      636     5888    7                        END;
      637     5889    6                     END;
      638     5890    5                  IF FPT(0)~=0 THEN CALL KVV$CALUSR(FPT);
      639     5891    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;
      640     5892    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;
      641     5893    5                  END; /* IF EXTTRN                                              */
      642     5894    4               END; /* IF I~=CHRCNT                                              */
      643     5895    3            END; /* DO WHILE VDH_OTPLCL.BYTSIZ                                   */
      644     5896    2         END; /* IF NOT TRN                                                      */
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:23   
      645     5897        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:24   
      646     5898    2      ELSE DO;
      647     5899                    /*
      648     5900                    * TRANSPARENT OUTPUT - JUST LOOK FOR OTPESCCHRS AND SEND THE SUBSTITUTE
      649     5901                    */
      650     5902    2         IF %KV_VDI.OTPCNDPND.PST~=0 THEN CALL KVV$CALUSR_PST;
      651     5903    3         DO WHILE VDH_OTPLCL.BFR_.BYTSIZ~=0;
      652     5904                    /*
      653     5905                    * DETERMINE HOW MUCH SPACE IS LEFT IN THE RDH OUTPUT BUFFER
      654     5906                    */
      655     5907    4            IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN DO;
      656     5908                    /*
      657     5909                    * IF THE BUFFER IS EMPTY, CALL THE RDH TO GET MORE SPACE AND
      658     5910                    * SEE HOW MUCH WE GET.
      659     5911                    */
      660     5912    4               %KV_USR_GETOTPBFR=KV_USR_GETOTPBFR;
      661     5913    4               %KV_USR_GETOTPBFR.ESTBYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ;
      662     5914    4               CALL KVV$CALUSR(FPT);
      663     5915    4               IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN RETURN;
      664     5916    4               END;
      665     5917    3            CHRCNT=MINIMUM(VDH_OTPLCL.BFR_.BYTSIZ, %KV_VDI.OTPBFR_.BYTSIZ, 255);
      666     5918        /*N* When PL6 can compile without next line, remove it. */
      667     5919    3            IF CHRCNT=0 THEN CALL KVV$CALUSR_PST;
      668     5920    3            %OTPBFR=%INPBFR;
      669     5921    3            IF NOT KV$TRNTBL.OTPESC.NONE
      670     5922    3            THEN CALL INDEX(I, KV$TRNTBL.OTPESC.CHR, %OTPBFR);
      671     5923    3            ELSE I=CHRCNT;
      672     5924    3            %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+I;
      673     5925    3            %KV_VDI.OTPBFR_.BYTSIZ=%KV_VDI.OTPBFR_.BYTSIZ-I;
      674     5926    3            IF I~=CHRCNT THEN IF %KV_VDI.OTPBFR_.BYTSIZ<2
      675     5927    3            THEN %KV_VDI.OTPBFR_.BYTSIZ = 0;
      676     5928    4            ELSE DO;
      677     5929    4               %OTPCHR=KV$TRNTBL.OTPESCCHRBFR1;
      678     5930    4               %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+1;
      679     5931    4               %KV_VDI.OTPBFR_.BYTSIZ=%KV_VDI.OTPBFR_.BYTSIZ-1;
      680     5932    5               IF KV$TRNTBL.OTPESCCHRBFR2~=BINASC(0) THEN DO;
      681     5933    5                  %OTPCHR=KV$TRNTBL.OTPESCCHRBFR2;
      682     5934    5                  %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+1;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:25   
      683     5935    5                  %KV_VDI.OTPBFR_.BYTSIZ=%KV_VDI.OTPBFR_.BYTSIZ-1;
      684     5936    5                  END;
      685     5937    4               I=I+1;
      686     5938    4               END;
      687     5939    3            %KV_STT.OTPCHRCNT=%KV_STT.OTPCHRCNT+I;
      688     5940    3            %KV_SSN.OTPCHRCNT=%KV_SSN.OTPCHRCNT+I;
      689     5941    3            %KV_VDI.TMPOTPCHRCNT=%KV_VDI.TMPOTPCHRCNT+I;
      690     5942    3            VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+I;
      691     5943    3            VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-I;
      692     5944    3            END;
      693     5945    2         END;
      694     5946    1   GOBACK: RETURN;
      695     5947        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:26   
      696     5948        /*I* NAME: Y$WRAP.
      697     5949             DESCRIPTION: Wraps the line if that is permitted. Otherwise ALTRERTs
      698     5950             after adjusting the callers FPT if so requested.
      699     5951        */
      700     5952    1   Y$WRAP: PROC ALTRET;
      701     5953
      702     5954    3      IF VDH_OTPLCL.NO_WRAP THEN DO;
      703     5955    3         IF %KV_SRD.CRT.LIN<%KV_SRD.FLDEND.LIN AND NOT %KV_MVD.HRZSCR THEN EXIT;
      704     5956    4         IF CHRCNT<=0 THEN DO;
      705     5957    4            KV$VDH_OTPLCL.BFR_.BYTX = VDH_OTPLCL.BFR_.BYTX;
      706     5958    4            KV$VDH_OTPLCL.BFR_.BYTSIZ = VDH_OTPLCL.BFR_.BYTSIZ;
      707     5959    4            END;
      708     5960    3         ALTRETURN;
      709     5961    3         END;
      710     5962    2      IF VDH_OTPLCL.NONVRT AND %KV_MVD.ORG>=%KV#VD_ORG_X364 THEN ALTRETURN;
      711     5963    2      CALL KVO$PST (KV_VDH_PST_WRAP);
      712     5964    2      IF NOT VDH_OTPLCL.NONVRT THEN %KV_SRD.VRTPSTOK = '1'B;
      713     5965    2      RETURN;
      714     5966    2   END Y$WRAP;
      715     5967        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:27   
      716     5968    1   KVO$OTP1_VRT: ENTRY(KV$VDH_OTPLCL);
      717     5969                    /*F*   NAME: KVO$OTP1_VRT
      718     5970                    *      PURPOSE: puts a single character on the output stream.
      719     5971                    *      DESCRIPTION: The parameter is the character. It may be left-
      720     5972                    *                   or right-adjusted in a word. If right, the left
      721     5973                    *                   byte must be zero. (Zero must be right adjusted).
      722     5974                    *      ENTRY: KVO$OTP1_NONVRT  (for non-virtual output).
      723     5975                    *      ENTRY: KVO$OTP1_HDN  (for simulated-hidden virtual).
      724     5976                    */
      725     5977    1      VDH_OTPLCL.NONVRT='0'B;
      726     5978    1      VDH_OTPLCL.HDN='0'B;
      727     5979    1      GOTO WRT1_CHR;
      728     5980    1   KVO$OTP1_NONVRT: ENTRY(KV$VDH_OTPLCL);
      729     5981    1      VDH_OTPLCL.NONVRT='1'B;
      730     5982    1      VDH_OTPLCL.HDN='0'B;
      731     5983    1      GOTO WRT1_CHR;
      732     5984    1   KVO$OTP1_HDN: ENTRY(KV$VDH_OTPLCL);
      733     5985    1      VDH_OTPLCL.NONVRT='0'B;
      734     5986    1      VDH_OTPLCL.HDN='1'B;
      735     5987    1   WRT1_CHR:;
      736     5988    1      VDH_OTPLCL.TRN='0'B;
      737     5989    1      VDH_OTPLCL.NO_WRAP='0'B;
      738     5990    1      VDH_OTPLCL.BFR_.ADR$=ADDR(KV$VDH_OTPLCL);
      739     5991    1      VDH_OTPLCL.BFR_.BYTSIZ=1;
      740     5992    1      VDH_OTPLCL.BFR_.BYTX=0;
      741     5993    1      IF %INPCHR=BINASC(0) THEN VDH_OTPLCL.BFR_.BYTX=1;
      742     5994    1      GOTO THE_BEGINNING;
      743     5995    1   END KVO$OTPLCL;

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:28   
--  Include file information  --

   K_ID_E.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVO$OTPLCL.

   Procedure KVO$OTPLCL requires 2021 words for executable code.
   Procedure KVO$OTPLCL requires 44 words of local(AUTO) storage.

    No errors detected in file KVO$OTPLCL.:E05TSI    .

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:29   

 Object Unit name= KVO$OTPLCL                                 File name= KVO$OTPLCL.:E05TOU
 UTS= JUL 30 '97 02:10:20.44 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     16     10  KVO$OTPLCL
    1   Proc  even  none  2021    7E5  KVO$OTPLCL
    2  RoData even  none    10      A  KVO$OTPLCL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KVO$OTPLCL
     1    7A6                  yes      Std        1  KVO$OTP1_VRT
     1    7B3                  yes      Std        1  KVO$OTP1_NONVRT
     1    7C0                  yes      Std        1  KVO$OTP1_HDN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KVO$PST
 yes     yes           Std       0 KVV$CALUSR_PST
 yes     yes           Std       1 KVV$CALUSR
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:30   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV_VDH_PST_0_VRT                      KV_VDH_PST_LF                         KV_VDH_PST_LF_VRT
     KV_VDH_PST_VRT                        KV_VDH_PST_WRAP                       KV_USR_GETOTPBFR
     KV$PTR$                          r    G$ROS$
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:31   


        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        7        7        /*X* CLM=0,PLM=3,CSU=3,ECU=3,IAD=3,IND=0 */
        8        8        /*M* KVO$OTPLCL VDH XLATE AND BUFFER OUTPUT STRING ROUTINE */
        9        9        /*X* CLM=0,PLM=3,CSU=3,ECU=3,IAD=3,IND=0 */
       10       10        KVO$OTPLCL: PROC(KV$VDH_OTPLCL);

     10   1 000000  D380 0000 0000  xent KVO$OTPLCL      LNJ,B5   X6A_AUTO_1
          1 000003       002C 0001                       DC       44,1

       11       11
       12       12        %INCLUDE KL_AFCN_C;
       13      113        %INCLUDE KL_MACRO_C;
       14     3465        %INCLUDE K_ID_E;
       15     3515        %K#ENTID_E;
       16     3534        %K#LYRID_E;
       17     3541
       18     3542 S      %INCLUDE KV$GLB; /* VDH PROCS                                                 */
       19     3543 S      %INCLUDE KV_GLBCNS_E; /* VDH CONSTANTS                                        */
       20     3544 S      %INCLUDE KV$GLBCTX;
       21     3545 S      %INCLUDE KV$USR;
       22     3546 S      %INCLUDE KV$VDH;
       23     3547 S      %INCLUDE KV$INT;
       24     3548 S      %INCLUDE KV_PRMID_E;
       25     3549        %KV_USR_FNC_E;
       26     3565        %KV#VD_ORG_E;
       27     3573         /**/
       28     3574    1   DCL KV_VDH_PST_0_VRT UBIN SYMREF;
       29     3575    1   DCL KV_VDH_PST_LF UBIN SYMREF;
       30     3576    1   DCL KV_VDH_PST_LF_VRT UBIN SYMREF;
       31     3577    1   DCL KV_VDH_PST_VRT UBIN SYMREF;
       32     3578    1   DCL KV_VDH_PST_WRAP UBIN SYMREF;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:32   
       33     3579        %KV$USR_GETOTPBFR(NAME=KV_USR_GETOTPBFR, STCLASS=SYMREF);
       34     3614        %KV$MRD (STCLASS="BASED(SRD$)"); /* REAL DEVICE CONTEXT BLOCK                 */
       35     3661        %EQU KV_MRD=CHARTEXT('KV$SRD.MRD$->KV$MRD');
       36     3662        %KV$MVD; /* VIRTUAL DEVICE CONTEXT BLOCK                                      */
       37     3706        %KV_OTPFNC_E; /* VDH OUTPUT FUNCTIONS DEFFINITIONS                            */
       38     3714        %KV_PHSPSTMOD_E;
       39     3721        %KV$EXTOTPTRN;
       40     3774        %EQU KV_EXTTRN=CHARTEXT('ADDR(FPT)->KV$USR_EXTOTPTRN.EXTTRN$->KV$EXTOTPTRN');
       41     3775        %KV$SCNOTPTRN(STCLASS="BASED(B4)"); /* Secondary output translate  table      */
       42     3786        %KV$PTR; /* VDH POINTER BLOCK                                                 */
       43     3829        %KV$SHRBFR; /* VDH SHARED BUFFER TEMPLATE                                     */
       44     3861    1   DCL KV$SHRBFR_BYT(0:0) UBIN BYTE BASED CALIGNED;
       45     3862        %KV$SRD (STCLASS="BASED(SRD$)"); /* SUBORDINATE REAL DEVICE CONTEXT           */
       46     4137        %EQU KV_SRD=CHARTEXT('KV$SRD');
       47     4138        %KV$SSN; /* SESSION CONTEXT                                                   */
       48     4217        %KV$STR; /* STREAM CONTEXT                                                    */
       49     4304        %KV$STT; /* Statistics                                                        */
       50     4698        %KV$TRNTBL(STCLASS="BASED(TRNTBL$)"); /* TRANSLATE TABLE                      */
       51     4756        %KV$USRPRM; /* User parameters                                                */
       52     4807        %KV$USR_GETOTPBFR; /* REQUEST SPACE FROM THE RDH                              */
       53     4842        %KV$USR_EXTOTPTRN; /* PASSED TO THE RDH FOR OUTPUT TOK TRNS                   */
       54     4878        %KV$USR_PST; /* POSITIONING REQUEST TO RDH                                    */
       55     4948        %KV$VDH_OTPLCL(STCLASS=); /* ARGUMENT STRUCTURE                               */
       56     5021        %KV$VDH_OTPLCL(NAME=VDH_OTPLCL, STCLASS=);
       57     5094        %KV$VDH_OTPLCL (NAME=Y@VDH_OTPLCL);
       58     5167        %KV$VDH_PST; /* POSITIONING REQUEST TO VDH                                    */
       59     5241        %KV$VDI(STCLASS="BASED(VDI$)"); /* VDI CONTEXT                                */
       60     5312        %EQU KV_VDI=CHARTEXT('KV$VDI');
       61     5313        %EQU KV_USR_GETOTPBFR=CHARTEXT('ADDR(FPT)->KV$USR_GETOTPBFR');
       62     5314        %EQU KV_USR_EXTOTPTRN=CHARTEXT('ADDR(FPT)->KV$USR_EXTOTPTRN');
       63     5315        %EQU KV_USR_PST=CHARTEXT('ADDR(FPT)->KV$USR_PST');
       64     5316        %EQU KV_VDH_PST=CHARTEXT('ADDR(FPT)->KV$VDH_PST');
       65     5317        %EQU EXTOTPLCL=CHARTEXT('ADDR(FPT)->Y@VDH_OTPLCL');
       66     5318        %EQU EXTTXT=CHARTEXT('ADDR(FPT(6))->CHARS');
       67     5319    1   DCL 1 BITS BASED ALIGNED, 2 ARY(0:0) BIT(1);
       68     5320    1   DCL CHARS CHAR(255) BASED;
       69     5321                    /*
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:33   
       70     5322                    * ENTREFS
       71     5323                    */
       72     5324    1   DCL KVO$PST ENTRY(1);
       73     5325    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
       74     5326    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
       75     5327                    /*
       76     5328                    * KVO$OTPLCL LOCAL DATA
       77     5329                    */
       78     5330                    /*
       79     5331                    * TEMP PTR
       80     5332                    */
       81     5333    1   DCL B4 PTR;
       82     5334                    /*
       83     5335                    * TRNTBL POINTER
       84     5336                    */
       85     5337    1   DCL TRNTBL$ PTR;
       86     5338                    /*
       87     5339                    * VDI POINTER - TO SAVE A FEW INSTRUCTIONS
       88     5340                    */
       89     5341    1   DCL VDI$ PTR;
       90     5342                    /*
       91     5343                    * SRD pointer - same reason
       92     5344                    */
       93     5345    1   DCL SRD$ PTR;
       94     5346                    /*
       95     5347                    * COLUMN TO WRAP AND TRUNCATE AFTER
       96     5348                    */
       97     5349    1   DCL ENDCLM UBIN;
       98     5350    1   DCL ENDCLM_S REDEF ENDCLM SBIN;
       99     5351                    /*
      100     5352                    * NUMBER OF CHARACTERS PROCESSED IN THE LOOP
      101     5353                    */
      102     5354    1   DCL CHRCNT UBIN;
      103     5355    1   DCL CHRCNTS REDEF CHRCNT SBIN;
      104     5356    1   DCL 1 CHR REDEF CHRCNT,
      105     5357    1         2 * BIT(8), 2 CNT UBIN BYTE UNAL;
      106     5358                    /*
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:34   
      107     5359                    * ABBNORMAL CHARACTER (NEEDING SPECIAL PROCESSING)
      108     5360                    */
      109     5361    1   DCL ORGCHR CHAR(1);
      110     5362                    /*
      111     5363                    * NUMBER OF CHARACTERS LEFT IN THE OUTPUT BUFFER
      112     5364                    */
      113     5365    1   DCL OTPSPCLFT UBIN;
      114     5366                    /*
      115     5367                    * LOCAL STORAGE FOR OUTPUT ESCAPE CHARACTER
      116     5368                    */
      117     5369    1   DCL OTPESCCHR CHAR(1);
      118     5370                    /*
      119     5371                    * BIT TO INDICATE TRUNCATION ON NEXT CHARACTERS
      120     5372                    */
      121     5373    1   DCL TRUNC BIT(1);
      122     5374                    /*
      123     5375                    * SET TO INDICATE THIS LINE IS ONE SHORT AS TYPING IN THE LAST PST
      124     5376                    * WOULD SCROLL WHEN WE DONT WANT TO
      125     5377                    */
      126     5378    1   DCL AUTONL BIT(1);
      127     5379                    /*
      128     5380                    * BLANK CHARACTERS
      129     5381                    */
      130     5382    1   DCL BLANKS CHAR(32) CONSTANT INIT(' ');
      131     5383       %EQU INPCHR=CHARTEXT('SUBSTR(VDH_OTPLCL.BFR_.ADR$->CHARS, VDH_OTPLCL.BFR_.BYTX, 1)')
              5383            ;
      132     5384        %EQU INPBFR=CHARTEXT(
              5384            'SUBSTR(VDH_OTPLCL.BFR_.ADR$->CHARS, VDH_OTPLCL.BFR_.BYTX, CHR.CNT)');
      133     5385        %EQU OTPCHR=CHARTEXT('SUBSTR(KV$VDI.OTPBFR_.ADR$->CHARS, KV$VDI.OTPBFR_.BYTX, 1)');
      134     5386        %EQU OTPBFR=CHARTEXT(
              5386            'SUBSTR(KV$VDI.OTPBFR_.ADR$->CHARS, KV$VDI.OTPBFR_.BYTX, CHR.CNT)');
      135     5387    1   DCL FPT(0:9) UBIN; /* SPACE FOR FPTS                                          */
      136     5388    1   DCL I UBIN;
      137     5389    1   DCL IS REDEF I SBIN;
      138     5390    1   DCL J UBIN;
      139     5391    1   DCL JS REDEF J SBIN;
      140     5392                    /*
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:35   
      141     5393                    * THE PURPOSE OF THIS ROUTINE IS TO TRANSLATE AN OUTPUT STRING
      142     5394                    * CONTAINED IN THE CALLERS BUFFER, AND PLACE THIS STRING IN THE
      143     5395                    * RDH'S BUFFER FOR OUTPUT TO THE REAL DEVICE.  THIS ROUTINE IS
      144     5396                    * CALLED WITH A STRUCTURE CONTAINING A VECTOR WHICH FRAMES THE STRING
      145     5397                    * TO BE TRANSLATED AS WELL AS OTHER ASSORTED INFORMATION
      146     5398                    * NECESSARY TO TRANSLATE AND BUFFER THE STRING.  THE
      147     5399                    * VDI CONTEXT BLOCK CONTAINS A VECTOR FRAMING THE RDH OUTPUT
      148     5400                    * BUFFER.  MOST TRANSLATION CAN BE DONE USING THE TRANSLATE TABLES
      149     5401                    * POINTED TO BY THE MVD CONTEXT BLOCK.  TRANSLATION FOR OUTPUT
      150     5402                    * FUNCTIONS SUCH AS SP, LF, HT, CR AND BS CAN BE DONE BY THE VDH.  ALL
      151     5403                    * OTHER OUTPUT FUNCTIONS REQUIRE SPECIAL PROCESSING BY THE RDH AND
      152     5404                    * THE TRANSLATE TABLES MARK THESE FUNCTIONS FOR EXTENDED TRANSLATION.
      153     5405                    * THE RDH IS CALLED TO DO THE TRANSLATION IN THESE CASES, AND WE
      154     5406                    * THEN MARCH ON.
      155     5407                    */
      156     5408    1      VDH_OTPLCL=KV$VDH_OTPLCL;

   5408   1 000005  ACC7 0004                            LDB,B2   @KV$VDH_OTPLCL,AUTO
          1 000007  2C00                                 LDV,R2   0
          1 000008  6C0A                                 LDV,R6   10
          1 000009  BB87                                 LAB,B3   ,AUTO
          1 00000A  3C0C                                 LDV,R3   12
          1 00000B  0008                                 MMM

   5408   1                              THE_BEGINNING   null
      157     5409    1   THE_BEGINNING:;
      158     5410    1      TRUNC='0'B;

   5410   1 00000C  8747 0018            THE_BEGINNING   CL       TRUNC,AUTO

      159     5411    1      TRNTBL$=%KV_MVD.TRNTBL$;

   5411   1 00000E  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000011  DCC6 0006                            LDB,B5   6,B6
          1 000013  CCC5 000E                            LDB,B4   14,B5
          1 000015  CFC7 000D                            STB,B4   TRNTBL$,AUTO

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:36   
      160     5412    1      VDI$=KV$PTR.VDI$;

   5412   1 000017  BC86                                 LDB,B3   ,B6
          1 000018  BFC7 000F                            STB,B3   VDI$,AUTO

      161     5413    1      SRD$=KV$PTR.SRD$;

   5413   1 00001A  ACC6 000A                            LDB,B2   10,B6
          1 00001C  AFC7 0011                            STB,B2   SRD$,AUTO

      162     5414    1      IF %KV_SRD.FLDEND.CLM~=0 AND %KV_SRD.CRT.LIN=%KV_SRD.FLDEND.LIN

   5414   1 00001E  E842 0011                            LDR,R6   17,B2
          1 000020  6901 000B                            BEZ,R6   s:5416,PREL
          1 000022  D842 0015                            LDR,R5   21,B2
          1 000024  D942 0010                            CMR,R5   16,B2
          1 000026  0981 0005                            BNE      s:5416,PREL

      163     5415    1      THEN ENDCLM=%KV_SRD.FLDEND.CLM;

   5415   1 000028  EF47 0013                            STR,R6   ENDCLM,AUTO
          1 00002A  0F81 0005                            B        s:5420,PREL

      164     5416    1      ELSE ENDCLM=%KV_SRD.BTMRHT.CLM;

   5416   1 00002C  D842 000C                            LDR,R5   12,B2
          1 00002E  DF47 0013                            STR,R5   ENDCLM,AUTO

      165     5417                    /*
      166     5418                    * MAKE SURE THIS IS NOT TRANSPARENT OUTPUT
      167     5419                    */
      168     5420    2      IF NOT VDH_OTPLCL.TRN AND KV$TRNTBL.OTPTRN1$~=ADDR(NIL) THEN DO;

   5420   1 000030  82C7 0006                            LB,'0040'X        VDH_OTPLCL,AUTO
   5420   1 000032       0040
          1 000033  0501 062E                            BBT      s:5902,PREL
          1 000035  8DC4 000C                            CMN      12,B4
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:37   
          1 000037  0901 062A                            BE       s:5902,PREL

      169     5421    2         IF NOT %KV_SRD.VRTPSTOK AND NOT VDH_OTPLCL.NONVRT

   5421   1 000039  82C2 000E                            LB,'0010'X        14,B2
   5421   1 00003B       0010
          1 00003C  0501 000F                            BBT      s:5433,PREL
          1 00003E  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
          1 000040       0080
          1 000041  0501 000A                            BBT      s:5433,PREL

      170     5422                    /*
      171     5423                    * Currently, the virtual-to-physical positioning correspondence
      172     5424                    * isn't linear (we did something without updating virtual),
      173     5425                    * and the current request is being done in the virtual mode.
      174     5426                    * Force the physical position to conform with the virtual before
      175     5427                    * processing the text.
      176     5428                    */
      177     5429    2         THEN CALL KVO$PST(KV_VDH_PST_VRT);

   5429   1 000043  BB80 0000 0000  02                   LAB,B3   0
          1 000046  CBF0 0100                            LAB,B4   256,IMO
          1 000048  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 00004B       0001                            DC       s:5433,PREL

      178     5430                    /*
      179     5431                    * LOOP THROUGH THE ENTIRE READ BUFFER
      180     5432                    */
      181     5433    3         DO WHILE(VDH_OTPLCL.BFR_.BYTSIZ~=0);

   5433   1 00004C  E847 000A                            LDR,R6   VDH_OTPLCL+4,AUTO
          1 00004E  6901 06FF                            BEZ,R6   s:5945,PREL

      182     5434                    /*
      183     5435                    * FINISH POSITIONING AND/OR WRAP THE LINE
      184     5436                    */
      185     5437                    /*
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:38   
      186     5438                    * DETERMINE THE NUMBER OF CHARACTER POSITIONS LEFT BEFORE WE
      187     5439                    * HIT THE RIGHT MARGIN
      188     5440                    */
      189     5441    3            CHRCNT=ENDCLM-%KV_SRD.CRT.CLM;

   5441   1 000050  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 000052  E847 0013                            LDR,R6   ENDCLM,AUTO
          1 000054  E246 0016                            SUB,R6   22,B6
          1 000056  EF47 0014                            STR,R6   CHRCNT,AUTO

      190     5442    3            IF NOT %KV_MRD.AUTONL

   5442   1 000058  DC86                                 LDB,B5   ,B6
          1 000059  82C5 0017                            LB,'1000'X        23,B5
          1 00005B       1000
          1 00005C  0581 0026                            BBF      s:5447,PREL
          1 00005E  82C6 000E                            LB,'0008'X        14,B6
          1 000060       0008
          1 000061  0581 000D                            BBF      s:5442+23,PREL
          1 000063  82C6 000F                            LB,'0020'X        15,B6
          1 000065       0020
          1 000066  0501 0008                            BBT      s:5442+23,PREL
          1 000068  D845 000A                            LDR,R5   10,B5
          1 00006A  D570 00FF                            AND,R5   255,IMO
          1 00006C  5D01                                 CMV,R5   1
          1 00006D  0901 0015                            BE       s:5447,PREL
          1 00006F  D846 0015                            LDR,R5   21,B6
          1 000071  DA46 0019                            ADD,R5   25,B6
          1 000073  C2C5 0015                            LLH,R4   21,B5
          1 000075  C955                                 CMR,R4   R5
          1 000076  0A01 000C                            BAG      s:5447,PREL
          1 000078  D847 0013                            LDR,R5   ENDCLM,AUTO
          1 00007A  D945 000B                            CMR,R5   11,B5
          1 00007C  0981 0006                            BNE      s:5447,PREL
          1 00007E  82C5 0017                            LB,'0200'X        23,B5
          1 000080       0200
          1 000081  0501 0007                            BBT      s:5450,PREL
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:39   

      191     5443    3              OR %KV_SRD.SCROLL AND NOT %KV_SRD.BRDEXS AND %KV_MRD.USRCNT=1
      192     5444    3              OR %KV_SRD.CRT.LIN+%KV_SRD.DVCLINBIS<%KV_MRD.LNG
      193     5445    3              OR ENDCLM~=%KV_MRD.WDT
      194     5446    4              OR NOT %KV_MRD.DEVSCROLL THEN DO;

      195     5447    4               CHRCNT=CHRCNT+1;

   5447   1 000083  8AC7 0014                            INC      CHRCNT,AUTO

      196     5448    4               AUTONL='0'B;

   5448   1 000085  8747 0019                            CL       AUTONL,AUTO

      197     5449    4               END;

   5449   1 000087  0F81 0004                            B        s:5451,PREL

      198     5450    3            ELSE AUTONL='1'B;

   5450   1 000089  8947 0019                            LBT,'8000'X       AUTONL,AUTO
   5450   1 00008B       8000

      199     5451    4            IF CHRCNTS<=0 THEN DO;

   5451   1 00008C  E847 0014                            LDR,R6   CHRCNT,AUTO
          1 00008E  6A01 0032                            BGZ,R6   s:5470,PREL

      200     5452         /* WE NEED TO WRAP                                                           */
      201     5453    4               CHRCNT = 0;

   5453   1 000090  8747 0014                            CL       CHRCNT,AUTO

      202     5454    4               IF %KV_SRD.WDT=0 OR %KV_SRD.LNG=0 THEN GOTO GOBACK;

   5454   1 000092  E846 000D                            LDR,R6   13,B6
          1 000094  6901 06B9                            BEZ,R6   s:5945,PREL
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:40   
          1 000096  D2C6 000E                            LLH,R5   14,B6
          1 000098  5901 06B5                            BEZ,R5   s:5945,PREL

      203     5455    4               TRUNC=%KV_SRD.TRUNCATE;

   5455   1 00009A  C846 000E                            LDR,R4   14,B6
          1 00009C  400D                                 SOL,R4   13
          1 00009D  C570 8000                            AND,R4   -32768,IMO
          1 00009F  CF47 0018                            STR,R4   TRUNC,AUTO

      204     5456    5               IF NOT TRUNC THEN DO;

   5456   1 0000A1  89C7 0018                            CMZ      TRUNC,AUTO
          1 0000A3  0801 0019                            BAL      s:5462,PREL

      205     5457    5                  IF %KV_VDI.OTPCNDPND.PST~=0

   5457   1 0000A5  CCC7 000F                            LDB,B4   VDI$,AUTO
          1 0000A7  B844 001A                            LDR,R3   26,B4
          1 0000A9  3901 000A                            BEZ,R3   s:5460,PREL
          1 0000AB  3D02                                 CMV,R3   2
          1 0000AC  0901 0007                            BE       s:5460,PREL

      206     5458    5                    AND %KV_VDI.OTPCNDPND.PST~=%KV_PHSPSTMOD_BLN
      207     5459    5                  THEN CALL KVV$CALUSR_PST;

   5459   1 0000AE  CBF0 0000                            LAB,B4   0,IMO
          1 0000B0  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 0000B3       0001                            DC       s:5460,PREL

      208     5460    6                  CALL Y$WRAP WHENALTRETURN DO; GOTO GOBACK; END;

   5460   1 0000B4  E3C0 069C                            LNJ,B6   s:0,PREL
          1 0000B6       0003                            DC       s:5460+5,PREL
          1 0000B7  0F81 0003                            B        s:5461,PREL

   5460   1 0000B9  0F81 0694                            B        s:5945,PREL
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:41   

      209     5461    5                  END;

   5461   1 0000BB  0F81 0005                            B        s:5470,PREL

      210     5462    4               ELSE CHRCNT=255;

   5462   1 0000BD  B870 00FF                            LDR,R3   255,IMO
          1 0000BF  BF47 0014                            STR,R3   CHRCNT,AUTO

      211     5463    4               END;

      212     5464         /**/
      213     5465                    /*
      214     5466                    *
      215     5467                    * CHRCNT HAS COLUMNS TILL RIGHT MRG
      216     5468                    */
      217     5469         /**/
      218     5470    3            CHRCNT=MINIMUM(CHRCNT, VDH_OTPLCL.BFR_.BYTSIZ, 255);

   5470   1 0000C1  E870 00FF                            LDR,R6   255,IMO
          1 0000C3  E947 000A                            CMR,R6   VDH_OTPLCL+4,AUTO
          1 0000C5  0381 0003                            BLE      s:5470+8,PREL
          1 0000C7  E847 000A                            LDR,R6   VDH_OTPLCL+4,AUTO
          1 0000C9  E947 0014                            CMR,R6   CHRCNT,AUTO
          1 0000CB  0381 0003                            BLE      s:5470+14,PREL
          1 0000CD  E847 0014                            LDR,R6   CHRCNT,AUTO
          1 0000CF  EF47 0014                            STR,R6   CHRCNT,AUTO

      219     5471    3            I=CHRCNT;

   5471   1 0000D1  EF47 0024                            STR,R6   I,AUTO

      220     5472         /**/
      221     5473    4            IF %KV_MRD.MINSP_FORPST>1 AND CHRCNT>0 THEN DO;

   5473   1 0000D3  ECC7 0011                            LDB,B6   SRD$,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:42   
          1 0000D5  DC86                                 LDB,B5   ,B6
          1 0000D6  D2C5 000C                            LLH,R5   12,B5
          1 0000D8  5D01                                 CMV,R5   1
          1 0000D9  0381 0036                            BLE      s:5479,PREL
          1 0000DB  6901 0034                            BEZ,R6   s:5479,PREL

      222     5474    4               CALL INDEX(CHRCNT, SUBSTR(BLANKS, 0, %KV_MRD.MINSP_FORPST),

   5474   1 0000DD  C847 0014                            LDR,R4   CHRCNT,AUTO
          1 0000DF  C570 00FF                            AND,R4   255,IMO
          1 0000E1  CB80 0000 0000  00                   LAB,B4   BLANKS
          1 0000E4  DF47 002A                            STR,R5   J+5,AUTO
          1 0000E6  5008                                 SOL,R5   8
          1 0000E7  B847 002A                            LDR,R3   J+5,AUTO
          1 0000E9  DA53                                 ADD,R5   R3
          1 0000EA  CF47 002B                            STR,R4   J+6,AUTO
          1 0000EC  C855                                 LDR,R4   R5
          1 0000ED  DCC7 0007                            LDB,B5   VDH_OTPLCL+1,AUTO
          1 0000EF  A847 0009                            LDR,R2   VDH_OTPLCL+3,AUTO
          1 0000F1  E847 002B                            LDR,R6   J+6,AUTO
          1 0000F3  EA70 0100                            ADD,R6   256,IMO
          1 0000F5  0028                                 SRH      ;
          1 0000F6       4004 0000                                ALPHANUM(0,B4,,R4),;
          1 0000F8       4407 0028                                BINARY(J+3,AUTO,,4),;
          1 0000FA       4025 0000                                ALPHANUM(0,B5,R2,,R6)
          1 0000FC  5381 0007                            CBE      s:5474+39,PREL
          1 0000FE  D847 002B                            LDR,R5   J+6,AUTO
          1 000100  DF47 0014                            STR,R5   CHRCNT,AUTO
          1 000102  0F81 0005                            B        s:5477,PREL
          1 000104  D847 0029                            LDR,R5   J+4,AUTO
          1 000106  DF47 0014                            STR,R5   CHRCNT,AUTO

      223     5475    4                 %INPBFR);
      224     5476                   /*N* LAST LINE SHOULD BE: SUBSTR(%INPBFR, 0, VDH_OTPLCL.BFR_.BYTSIZ));*/
      225     5477    4               IF I<CHRCNT THEN CHRCNT=I;

   5477   1 000108  D947 0024                            CMR,R5   I,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:43   
          1 00010A  0381 0005                            BLE      s:5479,PREL

   5477   1 00010C  D847 0024                            LDR,R5   I,AUTO
          1 00010E  DF47 0014                            STR,R5   CHRCNT,AUTO

      226     5478    4               END;

      227     5479    4            IF CHRCNT~=0 THEN DO;

   5479   1 000110  E847 0014                            LDR,R6   CHRCNT,AUTO
          1 000112  6901 0191                            BEZ,R6   s:5591,PREL

      228     5480    4               IF %KV_VDI.OTPCNDPND.PST~=0

   5480   1 000114  DCC7 000F                            LDB,B5   VDI$,AUTO
          1 000116  D845 001A                            LDR,R5   26,B5
          1 000118  5901 0007                            BEZ,R5   s:5491,PREL

      229     5481                    /*
      230     5482                    * The physical and desired cursor positions don't
      231     5483                    * MATCH, AND WE ARE ABOUT TO OUTPUT TEXT, SO WE
      232     5484                    * HAVE TO GENERATE WHATEVER IS REQUIRED TO MOVE
      233     5485                    * THE CURSOR TO THE DESIRED POSITION.
      234     5486                    */
      235     5487    4               THEN CALL KVV$CALUSR_PST;

   5487   1 00011A  CBF0 0000                            LAB,B4   0,IMO
          1 00011C  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 00011F       0001                            DC       s:5491,PREL

      236     5488                    /*
      237     5489                    * DETERMINE HOW MUCH SPACE IS LEFT IN THE RDH OUTPUT BUFFER
      238     5490                    */
      239     5491    5               IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN DO;

   5491   1 000120  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 000122  E846 000D                            LDR,R6   13,B6
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:44   
          1 000124  6981 001F                            BNEZ,R6  s:5501,PREL

      240     5492                    /*
      241     5493                    * IF THE BUFFER IS EMPTY, CALL THE RDH TO GET MORE SPACE AND
      242     5494                    * SEE HOW MUCH WE GET.
      243     5495                    */
      244     5496    5                  %KV_USR_GETOTPBFR=KV_USR_GETOTPBFR;

   5496   1 000126  8C80 0000 0000  xsym                 LDI      KV_USR_GETOTPBFR
          1 000129  8D47 001A                            SDI      FPT,AUTO

      245     5497    5                  %KV_USR_GETOTPBFR.ESTBYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ;

   5497   1 00012B  D847 000A                            LDR,R5   VDH_OTPLCL+4,AUTO
          1 00012D  DF47 001B                            STR,R5   FPT+1,AUTO

      246     5498    5                  CALL KVV$CALUSR(FPT);

   5498   1 00012F  DBC7 001A                            LAB,B5   FPT,AUTO
          1 000131  DFC7 0028                            STB,B5   J+3,AUTO
          1 000133  BBC7 0028                            LAB,B3   J+3,AUTO
          1 000135  CBF0 0100                            LAB,B4   256,IMO
          1 000137  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 00013A       0001                            DC       s:5499,PREL

      247     5499    5                  IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN RETURN;

   5499   1 00013B  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 00013D  E846 000D                            LDR,R6   13,B6
          1 00013F  6981 0004                            BNEZ,R6  s:5501,PREL

   5499   1 000141  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      248     5500    5                  END;
      249     5501    5               IF CHRCNT>%KV_VDI.OTPBFR_.BYTSIZ THEN DO;

   5501   1 000144  E947 0014                            CMR,R6   CHRCNT,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:45   
          1 000146  0281 0009                            BGE      s:5505,PREL

      250     5502    5                  CHRCNT=%KV_VDI.OTPBFR_.BYTSIZ;

   5502   1 000148  EF47 0014                            STR,R6   CHRCNT,AUTO

      251     5503    5                  IF I>CHRCNT THEN I=CHRCNT;

   5503   1 00014A  E947 0024                            CMR,R6   I,AUTO
          1 00014C  0281 0003                            BGE      s:5505,PREL

   5503   1 00014E  EF47 0024                            STR,R6   I,AUTO

      252     5504    5                  END;

      253     5505    4               CALL XLATE(%OTPBFR, KV$TRNTBL.OTPTRN1$->CHARS, %INPBFR);

   5505   1 000150  DCC6 000A                            LDB,B5   10,B6
          1 000152  D846 000C                            LDR,R5   12,B6
          1 000154  C847 0014                            LDR,R4   CHRCNT,AUTO
          1 000156  C570 00FF                            AND,R4   255,IMO
          1 000158  CCC7 000D                            LDB,B4   TRNTBL$,AUTO
          1 00015A  BCC4 000C                            LDB,B3   12,B4
          1 00015C  ACC7 0007                            LDB,B2   VDH_OTPLCL+1,AUTO
          1 00015E  B847 0009                            LDR,R3   VDH_OTPLCL+3,AUTO
          1 000160  A855                                 LDR,R2   R5
          1 000161  D854                                 LDR,R5   R4
          1 000162  E870 00FF                            LDR,R6   255,IMO
          1 000164  0023                                 MAT      ;
          1 000165       4032 0000                                ALPHANUM(0,B2,R3,,R4),;
          1 000167       4025 0000                                ALPHANUM(0,B5,R2,,R5,FILL),;
          1 000169       4003 0000                                ALPHANUM(0,B3,,256)

      254     5506    4               IF NOT KV$TRNTBL.OTPESC.NONE

   5506   1 00016B  437F                                 CSYNC    s:5505+26,SPREL
          1 00016C  ECC7 000D                            LDB,B6   TRNTBL$,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:46   
          1 00016E  B2C6 001B                            LLH,R3   27,B6
          1 000170  3008                                 SOL,R3   8
          1 000171  3981 001F                            BNEZ,R3  s:5511,PREL

      255     5507    4               THEN CALL INDEX(CHRCNT, KV$TRNTBL.OTPESC.CHR, %OTPBFR);

   5507   1 000173  DCC7 000F                            LDB,B5   VDI$,AUTO
          1 000175  CCC5 000A                            LDB,B4   10,B5
          1 000177  A845 000C                            LDR,R2   12,B5
          1 000179  9847 0014                            LDR,R1   CHRCNT,AUTO
          1 00017B  9570 00FF                            AND,R1   255,IMO
          1 00017D  E851                                 LDR,R6   R1
          1 00017E  EA70 0100                            ADD,R6   256,IMO
          1 000180  0028                                 SRH      ;
          1 000181       C106 001B                                ALPHANUM(27,B6,1,1),;
          1 000183       4407 0028                                BINARY(J+3,AUTO,,4),;
          1 000185       4024 0000                                ALPHANUM(0,B4,R2,,R6)
          1 000187  5381 0005                            CBE      s:5507+26,PREL
          1 000189  9F47 0014                            STR,R1   CHRCNT,AUTO
          1 00018B  0F81 0005                            B        s:5511,PREL
          1 00018D  B847 0029                            LDR,R3   J+4,AUTO
          1 00018F  BF47 0014                            STR,R3   CHRCNT,AUTO

      256     5508                    /*
      257     5509                    * ACCOUNT FOR THE POSITIONING OF CHARACTERS WE STUFFED INTO THE BUFFER
      258     5510                    */
      259     5511    4   NRMTRNPST:  IF NOT VDH_OTPLCL.NONVRT

   5511   1 000191  82C7 0006            NRMTRNPST       LB,'0080'X        VDH_OTPLCL,AUTO
   5511   1 000193       0080
          1 000194  0501 000E                            BBT      s:5524,PREL

      260     5512                    /*
      261     5513                    * WE HAVE BEEN REQUESTED TO INCREMENT THE VIRTUAL
      262     5514                    * POSITION WHEN UPDATING THE PHYSICAL POSITION.
      263     5515                    */
      264     5516    4               THEN %KV_MVD.VRTCLM=%KV_MVD.VRTCLM+CHRCNT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:47   

   5516   1 000196  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000199  DCC6 0006                            LDB,B5   6,B6
          1 00019B  E845 001B                            LDR,R6   27,B5
          1 00019D  EA47 0014                            ADD,R6   CHRCNT,AUTO
          1 00019F  EF45 001B                            STR,R6   27,B5
          1 0001A1  0F81 0019                            B        s:5528,PREL

      265     5517                    /*
      266     5518                    * WE ARE NOT TO UPDATE THE VIRTUAL POSITION, SO THE VIRTUAL POSITION
      267     5519                    * IS PROBABLY NO LONGER VALID.
      268     5520                    */
      269     5521    5               ELSE DO;

      270     5522        /* This is non-virtual output.  Make sure any pending retyp gets enough data. */
      271     5523
      272     5524    5                  %KV_SRD.VRTPSTOK='0'B;

   5524   1 0001A3  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 0001A5  8846 000E                            LBF,'0010'X       14,B6
          1 0001A7       0010

      273     5525    5                  IF %KV_VDI.RE_DSPLOWX>%KV_SSN.REDBFR.EDTLOWX

   5525   1 0001A8  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0001AB  CCC5 0002                            LDB,B4   2,B5
          1 0001AD  BCC7 000F                            LDB,B3   VDI$,AUTO
          1 0001AF  E843 0016                            LDR,R6   22,B3
          1 0001B1  6801 0005                            BLZ,R6   s:5526,PREL
          1 0001B3  E944 002B                            CMR,R6   43,B4
          1 0001B5  0A81 0005                            BALE     s:5528,PREL

      274     5526    5                  THEN %KV_VDI.RE_DSPLOWX=%KV_SSN.REDBFR.EDTLOWX;

   5526   1 0001B7  E844 002B                            LDR,R6   43,B4
          1 0001B9  EF43 0016                            STR,R6   22,B3

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:48   
      275     5527    5                  END;

      276     5528    5               IF NOT TRUNC AND CHRCNT~=0 THEN DO;

   5528   1 0001BB  89C7 0018                            CMZ      TRUNC,AUTO
          1 0001BD  0801 00DA                            BAL      s:5582,PREL
          1 0001BF  E847 0014                            LDR,R6   CHRCNT,AUTO
          1 0001C1  6901 00D6                            BEZ,R6   s:5582,PREL

      277     5529    5                  %KV_MRD.DVCCLM=CHRCNT+%KV_MRD.DVCCLM;

   5529   1 0001C3  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 0001C5  DC86                                 LDB,B5   ,B6
          1 0001C6  EA45 001E                            ADD,R6   30,B5
          1 0001C8  EF45 001E                            STR,R6   30,B5

      278     5530    5                  %KV_SRD.CRT.CLM=%KV_MRD.DVCCLM;

   5530   1 0001CA  DC86                                 LDB,B5   ,B6
          1 0001CB  E845 001E                            LDR,R6   30,B5
          1 0001CD  EF46 0016                            STR,R6   22,B6

      279     5531    6                  IF %KV_SRD.HI_NONBLN_PST<%KV_SRD.CRT_PST THEN DO;

   5531   1 0001CF  8CC6 0017                            LDI      23,B6
          1 0001D1  84C6 0015                            SID      21,B6
          1 0001D3  6881 002D                            BGEZ,R6  s:5547,PREL

      280     5532                    /*
      281     5533                    * The characters we're writing are farther down the page than
      282     5534                    * the previous farthest.
      283     5535                    */
      284     5536    6                     JS=VDH_OTPLCL.BFR_.BYTX+CHRCNT-1;

   5536   1 0001D5  E847 0009                            LDR,R6   VDH_OTPLCL+3,AUTO
          1 0001D7  EA47 0014                            ADD,R6   CHRCNT,AUTO
          1 0001D9  6EFF                                 ADV,R6   -1
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:49   
          1 0001DA  EF47 0025                            STR,R6   J,AUTO

      285     5537        /* First check for trailing blanks.                */
      286     5538    7                     DO WHILE SUBSTR(VDH_OTPLCL.BFR_.ADR$->CHARS,JS,1)=' ';

   5538   1 0001DC  0F81 0003                            B        s:5540,PREL

      287     5539    7                        JS=JS-1;

   5539   1 0001DE  88C7 0025                            DEC      J,AUTO

      288     5540    7                        END;

   5540   1 0001E0  ECC7 0007                            LDB,B6   VDH_OTPLCL+1,AUTO
          1 0001E2  B847 0025                            LDR,R3   J,AUTO
          1 0001E4  E0B6                                 LDH,R6   ,B6,R3
          1 0001E5  6D20                                 CMV,R6   32
          1 0001E6  0978                                 BE       s:5539,SPREL

      289     5541    6                     IF JS<VDH_OTPLCL.BFR_.BYTX THEN EXIT;

   5541   1 0001E7  B947 0009                            CMR,R3   VDH_OTPLCL+3,AUTO
          1 0001E9  0801 0017                            BAL      s:5547,PREL

      290     5542    6                     JS=JS-VDH_OTPLCL.BFR_.BYTX-CHRCNT;

   5542   1 0001EB  B247 0009                            SUB,R3   VDH_OTPLCL+3,AUTO
          1 0001ED  B247 0014                            SUB,R3   CHRCNT,AUTO
          1 0001EF  BF47 0025                            STR,R3   J,AUTO

      291     5543    6                     %KV_SRD.HI_NONBLN=%KV_SRD.CRT;

   5543   1 0001F1  DCC7 0011                            LDB,B5   SRD$,AUTO
          1 0001F3  8CC5 0015                            LDI      21,B5
          1 0001F5  8D45 0017                            SDI      23,B5

      292     5544    6                     %KV_SRD.HI_NONBLN.CLM=%KV_SRD.HI_NONBLN.CLM+JS;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:50   

   5544   1 0001F7  BA45 0018                            ADD,R3   24,B5
          1 0001F9  BF45 0018                            STR,R3   24,B5

      293     5545    6                     %KV_SRD.HI_NONBLNVRT=%KV_SRD.VRTPSTOK;

   5545   1 0001FB  D845 000E                            LDR,R5   14,B5
          1 0001FD  5043                                 SOR,R5   3
          1 0001FE  DAC5 000E                            SRM,R5,'0002'X    14,B5
          1 000200       0002

      294     5546    6                     END;

      295     5547    6                  IF VDH_OTPLCL.HDN THEN DO J=0 TO CHRCNT-1;

   5547   1 000201  82C7 0006                            LB,'0020'X        VDH_OTPLCL,AUTO
   5547   1 000203       0020
          1 000204  0581 001E                            BBF      s:5558,PREL

   5547   1 000206  8747 0025                            CL       J,AUTO
          1 000208  0F81 0013                            B        s:5553+2,PREL

      296     5548                    /*
      297     5549                    * HIDDEN SIMULATION - SEND BLANKS INSTEAD OF THE CHARACTERS.
      298     5550                    */
      299     5551    6                     %OTPCHR=KV$TRNTBL.SP_CHR;

   5551   1 00020A  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 00020C  DCC6 000A                            LDB,B5   10,B6
          1 00020E  E846 000C                            LDR,R6   12,B6
          1 000210  CCC7 000D                            LDB,B4   TRNTBL$,AUTO
          1 000212  D844 001D                            LDR,R5   29,B4
          1 000214  5008                                 SOL,R5   8
          1 000215  5068                                 SAR,R5   8
          1 000216  B856                                 LDR,R3   R6
          1 000217  D7B5                                 STH,R5   ,B5,R3

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:51   
      300     5552    6                     %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+1;

   5552   1 000218  8AC6 000C                            INC      12,B6

      301     5553    6                     END;

   5553   1 00021A  8AC7 0025                            INC      J,AUTO
          1 00021C  E847 0025                            LDR,R6   J,AUTO
          1 00021E  E947 0014                            CMR,R6   CHRCNT,AUTO
          1 000220  026A                                 BL       s:5551,SPREL
          1 000221  0F81 0009                            B        s:5559,PREL

      302     5554    5                  ELSE /* !! NOTE THIS IS PART OF THE NEXT STATEMENT !!          */
      303     5555                    /*
      304     5556                    * UPDATE VECTOR BYTE INDEXES
      305     5557                    */
      306     5558    5   NRMTRNNO_PST:  %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+CHRCNT;

   5558   1 000223  ECC7 000F            NRMTRNNO_PST    LDB,B6   VDI$,AUTO
          1 000225  E846 000C                            LDR,R6   12,B6
          1 000227  EA47 0014                            ADD,R6   CHRCNT,AUTO
          1 000229  EF46 000C                            STR,R6   12,B6

      307     5559    5                  %KV_VDI.OTPBFR_.BYTSIZ=%KV_VDI.OTPBFR_.BYTSIZ-CHRCNT;

   5559   1 00022B  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 00022D  E846 000D                            LDR,R6   13,B6
          1 00022F  E247 0014                            SUB,R6   CHRCNT,AUTO
          1 000231  EF46 000D                            STR,R6   13,B6

      308     5560    5                  %KV_SSN.OTPCHRCNT=%KV_SSN.OTPCHRCNT+CHRCNT;

   5560   1 000233  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000236  CCC5 0002                            LDB,B4   2,B5
          1 000238  F847 0014                            LDR,R7   CHRCNT,AUTO
          1 00023A  6C00                                 LDV,R6   0
          1 00023B  8444 0018                            AID      24,B4
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:52   
          1 00023D  8D44 0018                            SDI      24,B4

      309     5561    5                  %KV_STT.OTPCHRCNT=%KV_STT.OTPCHRCNT+CHRCNT;

   5561   1 00023F  CC85                                 LDB,B4   ,B5
          1 000240  BCC4 0008                            LDB,B3   8,B4
          1 000242  ACC3 0033                            LDB,B2   51,B3
          1 000244  F847 0014                            LDR,R7   CHRCNT,AUTO
          1 000246  6C00                                 LDV,R6   0
          1 000247  8442 0034                            AID      52,B2
          1 000249  8D42 0034                            SDI      52,B2

      310     5562    5                  %KV_VDI.TMPOTPCHRCNT=%KV_VDI.TMPOTPCHRCNT+CHRCNT;

   5562   1 00024B  E846 0015                            LDR,R6   21,B6
          1 00024D  EA47 0014                            ADD,R6   CHRCNT,AUTO
          1 00024F  EF46 0015                            STR,R6   21,B6

      311     5563    5                  IF %KV_SRD.CRT.CLM>ENDCLM_S

   5563   1 000251  CCC7 0011                            LDB,B4   SRD$,AUTO
          1 000253  D844 0016                            LDR,R5   22,B4
          1 000255  D947 0013                            CMR,R5   ENDCLM,AUTO
          1 000257  0A81 0040                            BALE     s:5582,PREL
          1 000259  82C4 000E                            LB,'0004'X        14,B4
          1 00025B       0004
          1 00025C  0501 003B                            BBT      s:5582,PREL
          1 00025E  82C6 001D                            LB,'0010'X        29,B6
          1 000260       0010
          1 000261  0581 0036                            BBF      s:5582,PREL
          1 000263  BCC5 0006                            LDB,B3   6,B5
          1 000265  82C3 0016                            LB,'0080'X        22,B3
          1 000267       0080
          1 000268  0581 002F                            BBF      s:5582,PREL

      312     5564    5                    AND NOT %KV_SRD.TRUNCATE
      313     5565    5                    AND %KV_VDI.USRRQSDAT.RED
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:53   
      314     5566    5                    AND %KV_MVD.RETYPOVR
      315     5567    5                  THEN IF %KV_SRD.CRT.LIN~=%KV_SRD.FLDEND.LIN

   5567   1 00026A  C844 0015                            LDR,R4   21,B4
          1 00026C  C944 0010                            CMR,R4   16,B4
          1 00026E  0981 0003                            BNE      s:5569,PREL
          1 000270  4981 0024                            BNEZ,R4  s:5581,PREL

      316     5568    6                    OR %KV_SRD.CRT.LIN=0 THEN DO;

      317     5569    6                     I=%KV_SRD.BTMRHT.LIN-%KV_SRD.DVCLINBIS;

   5569   1 000272  B844 000B                            LDR,R3   11,B4
          1 000274  B244 0019                            SUB,R3   25,B4
          1 000276  BF47 0024                            STR,R3   I,AUTO

      318     5570    6                     IF %KV_SRD.PAGEHALT AND %KV_SRD.PRINTHALT

   5570   1 000278  82C4 000E                            LB,'0020'X        14,B4
   5570   1 00027A       0020
          1 00027B  0581 000C                            BBF      s:5572,PREL
          1 00027D  82C4 000E                            LB,'0080'X        14,B4
          1 00027F       0080
          1 000280  0581 0007                            BBF      s:5572,PREL
          1 000282  A844 0019                            LDR,R2   25,B4
          1 000284  2981 0003                            BNEZ,R2  s:5572,PREL

      319     5571    6                       AND %KV_SRD.DVCLINBIS=0 THEN I=I-1;

   5571   1 000286  88C7 0024                            DEC      I,AUTO

      320     5572    7                     IF IS>%KV_SRD.CRT.LIN THEN DO;

   5572   1 000288  C947 0024                            CMR,R4   I,AUTO
          1 00028A  0881 0004                            BAGE     s:5579,PREL

      321     5573                    /*
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:54   
      322     5574                    *WERE PAST THE RIGHT MARGIN AND THERE'S MORE TEXT BELOW
      323     5575                    *POSITION TO THE PROPER CHARACTER
      324     5576                    */
      325     5577    7                        CALL Y$WRAP;

   5577   1 00028C  E3C0 04C4                            LNJ,B6   s:0,PREL
          1 00028E       0001                            DC       s:5579,PREL

      326     5578    7                        END;

      327     5579    6                     I=CHRCNT; /* No special char here                           */

   5579   1 00028F  E847 0014                            LDR,R6   CHRCNT,AUTO
          1 000291  EF47 0024                            STR,R6   I,AUTO

      328     5580    6                     END;

   5580   1 000293  0F81 0004                            B        s:5582,PREL

      329     5581    5                  ELSE %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;

   5581   1 000295  3C01                                 LDV,R3   1
          1 000296  BF46 001A                            STR,R3   26,B6

      330     5582    5                  END;

      331     5583    4   NRMTRNTRUNC: VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+CHRCNT;

   5583   1 000298  E847 0009            NRMTRNTRUNC     LDR,R6   VDH_OTPLCL+3,AUTO
          1 00029A  EA47 0014                            ADD,R6   CHRCNT,AUTO
          1 00029C  EF47 0009                            STR,R6   VDH_OTPLCL+3,AUTO

      332     5584    4               VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-CHRCNT;

   5584   1 00029E  D847 000A                            LDR,R5   VDH_OTPLCL+4,AUTO
          1 0002A0  D247 0014                            SUB,R5   CHRCNT,AUTO
          1 0002A2  DF47 000A                            STR,R5   VDH_OTPLCL+4,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:55   

      333     5585    4               END; /* IF CHRCNT~=0                                              */

      334     5586        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:56   
      335     5587                    /*
      336     5588                    * SEE IF WE EXITED DUE TO DETECTING A SPECIAL CHARCTER OR NORMALLY
      337     5589                    * ON LOOP TERMINATION
      338     5590                    */
      339     5591    4            IF I~=CHRCNT THEN DO;

   5591   1 0002A4  E847 0024                            LDR,R6   I,AUTO
          1 0002A6  E947 0014                            CMR,R6   CHRCNT,AUTO
          1 0002A8  0901 03B3                            BE       s:5895,PREL

      340     5592         /* we found either a string of MINSPFORPST blanks or a special char          */
      341     5593    4               ORGCHR=%INPCHR;

   5593   1 0002AA  ECC7 0007                            LDB,B6   VDH_OTPLCL+1,AUTO
          1 0002AC  B847 0009                            LDR,R3   VDH_OTPLCL+3,AUTO
          1 0002AE  D0B6                                 LDH,R5   ,B6,R3
          1 0002AF  D7C7 0015                            STH,R5   ORGCHR,AUTO

      342     5594    4               IF KV$TRNTBL.OTPTRN2$=ADDR(NIL) THEN GOTO BLANKS;

   5594   1 0002B1  DCC7 000D                            LDB,B5   TRNTBL$,AUTO
          1 0002B3  8DC5 000E                            CMN      14,B5
          1 0002B5  0901 0184                            BE       s:5749,PREL

      343     5595    4               B4=KV$TRNTBL.OTPTRN2$;

   5595   1 0002B7  CCC5 000E                            LDB,B4   14,B5
          1 0002B9  CFC7 000B                            STB,B4   B4,AUTO

      344     5596    4   NXTTBL:     CALL INDEX(I, ORGCHR, KV$SCNOTPTRN.CHR) ALTRET(BLANKS);

   5596   1 0002BB  ECC7 000B            NXTTBL          LDB,B6   B4,AUTO
          1 0002BD  E286                                 LLH,R6   ,B6
          1 0002BE  EF47 002A                            STR,R6   J+5,AUTO
          1 0002C0  EA70 0100                            ADD,R6   256,IMO
          1 0002C2  0028                                 SRH      ;
          1 0002C3       4107 0015                                ALPHANUM(ORGCHR,AUTO,,1),;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:57   
          1 0002C5       4407 0028                                BINARY(J+3,AUTO,,4),;
          1 0002C7       C006 0000                                ALPHANUM(0,B6,1,R6)
          1 0002C9  5381 0007                            CBE      s:5596+22,PREL
          1 0002CB  E847 002A                            LDR,R6   J+5,AUTO
          1 0002CD  EF47 0024                            STR,R6   I,AUTO
          1 0002CF  0F81 016A                            B        s:5749,PREL
          1 0002D1  E847 0029                            LDR,R6   J+4,AUTO
          1 0002D3  EF47 0024                            STR,R6   I,AUTO

      345     5597    4               J=I+KV$SCNOTPTRN.CNT;

   5597   1 0002D5  D286                                 LLH,R5   ,B6
          1 0002D6  DA56                                 ADD,R5   R6
          1 0002D7  DF47 0025                            STR,R5   J,AUTO

      346     5598    4               OTPESCCHR = KV$SCNOTPTRN.CHRA(JS);

   5598   1 0002D9  B847 0025                            LDR,R3   J,AUTO
          1 0002DB  3E01                                 ADV,R3   1
          1 0002DC  C0B6                                 LDH,R4   ,B6,R3
          1 0002DD  C7C7 0017                            STH,R4   OTPESCCHR,AUTO

      347     5599    5               IF PINCRW(B4, KV$SCNOTPTRN.CNT)->BITS.ARY(I) THEN DO;

   5599   1 0002DF  A286                                 LLH,R2   ,B6
          1 0002E0  2004                                 SOL,R2   4
          1 0002E1  AA56                                 ADD,R2   R6
          1 0002E2  82A6                                 LB       ,B6,R2
          1 0002E3  0581 001A                            BBF      s:5611,PREL

      348     5600         /* Normal translation (positioning or not)                                   */
      349     5601    5                  I=1;

   5601   1 0002E5  6C01                                 LDV,R6   1
          1 0002E6  EF47 0024                            STR,R6   I,AUTO

      350     5602    5                  %OTPCHR=OTPESCCHR;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:58   

   5602   1 0002E8  DCC7 000F                            LDB,B5   VDI$,AUTO
          1 0002EA  CCC5 000A                            LDB,B4   10,B5
          1 0002EC  A845 000C                            LDR,R2   12,B5
          1 0002EE  C7A4                                 STH,R4   ,B4,R2

      351     5603    5                  CHRCNT=1;

   5603   1 0002EF  EF47 0014                            STR,R6   CHRCNT,AUTO

      352     5604    5                  IF TRUNC THEN GOTO NRMTRNTRUNC;

   5604   1 0002F1  89C7 0018                            CMZ      TRUNC,AUTO
          1 0002F3  0801 FFA4                            BAL      s:5582,PREL

      353     5605    5                  IF PINCRW(B4, KV$SCNOTPTRN.CNT)->BITS.ARY(JS)

   5605   1 0002F5  A286                                 LLH,R2   ,B6
          1 0002F6  2004                                 SOL,R2   4
          1 0002F7  AA47 0025                            ADD,R2   J,AUTO
          1 0002F9  82A6                                 LB       ,B6,R2
          1 0002FA  0501 FE96                            BBT      s:5511,PREL

      354     5606         /* Positioning                                                               */
      355     5607    5                  THEN GOTO NRMTRNPST;
      356     5608    5                  GOTO NRMTRNNO_PST;

   5608   1 0002FC  0F81 FF26                            B        s:5558,PREL

      357     5609    5                  END;
      358     5610        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:59   
      359     5611    4               IF PINCRW(B4, KV$SCNOTPTRN.CNT)->BITS.ARY(JS)

   5611   1 0002FE  A286                                 LLH,R2   ,B6
          1 0002FF  2004                                 SOL,R2   4
          1 000300  AA47 0025                            ADD,R2   J,AUTO
          1 000302  82A6                                 LB       ,B6,R2
          1 000303  0581 022C                            BBF      s:5826,PREL

      360     5612         /* If we get here, OTPESCCHR is a function code.                             */
      361     5613    5               THEN DO CASE(ASCBIN(OTPESCCHR));

   5613   1 000305  A2C7 0017                            LLH,R2   OTPESCCHR,AUTO
          1 000307  2D08                                 CMV,R2   8
          1 000308  0281 0131                            BGE      s:5749,PREL
          1 00030A  9820 0000 0310  01                   LDR,R1   s:5613+11,R2
          1 00030D  8390 0000 0318  01                   JMP      s:5616,R1
          1 000310       0122                            DC       s:5749,PREL
          1 000311       000C                            DC       s:5625,PREL
          1 000312       008D                            DC       s:5696,PREL
          1 000313       00FA                            DC       s:5741,PREL
          1 000314       006A                            DC       s:5678,PREL
          1 000315       0122                            DC       s:5749,PREL
          1 000316       0122                            DC       s:5749,PREL
          1 000317       0000                            DC       s:5616,PREL

      362     5614    5               CASE(%KV_OTPFNC_NXTTBL);

      363     5615         /* NXTTBL entry                                                              */
      364     5616    6                  IF B4=KV$TRNTBL.OTPTRN2$ THEN DO;

   5616   1 000318  DCC7 000D                            LDB,B5   TRNTBL$,AUTO
          1 00031A  EDC5 000E                            CMB,B6   14,B5
          1 00031C  0981 033F                            BNE      s:5895,PREL

      365     5617    6                     B4=KV$TRNTBL.OTPTRN3$;

   5617   1 00031E  CCC5 0010                            LDB,B4   16,B5
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:60   
          1 000320  CFC7 000B                            STB,B4   B4,AUTO

      366     5618    6                     GOTO NXTTBL;

   5618   1 000322  0F81 FF98                            B        s:5596,PREL

      367     5619    6                     END;
      368     5620        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:61   
      369     5621    5               CASE(%KV_OTPFNC_BS);

      370     5622                    /*
      371     5623                    * OUTPUT FUNCTION: BS (BACKSPACE)
      372     5624                    */
      373     5625    6                  DO WHILE VDH_OTPLCL.BFR_.BYTSIZ > 0 AND ORGCHR=%INPCHR;

   5625   1 000324  0F81 0049                            B        s:5668,PREL

      374     5626    7                     IF NOT VDH_OTPLCL.NONVRT THEN DO;

   5626   1 000326  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
   5626   1 000328       0080
          1 000329  0501 0036                            BBT      s:5661,PREL

      375     5627                    /*
      376     5628                    * WE ARE TO UPDATE THE VIRTUAL POSITION, SO CONSIDER
      377     5629                    * IT IN BOUNDARY CASES.
      378     5630                    */
      379     5631    8                        IF %KV_MVD.VRTCLM>1 THEN DO;

   5631   1 00032B  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00032E  DCC6 0006                            LDB,B5   6,B6
          1 000330  E845 001B                            LDR,R6   27,B5
          1 000332  6D01                                 CMV,R6   1
          1 000333  0A81 0036                            BALE     s:5666,PREL

      380     5632                    /*
      381     5633                    * WE'RE NOT AT THE VIRTUAL (ABSOLUTE) LEFT MARGIN,
      382     5634                    * SO HONOR THE BS.
      383     5635                    */
      384     5636    8                           %KV_MVD.VRTCLM=%KV_MVD.VRTCLM-1;

   5636   1 000335  88C5 001B                            DEC      27,B5

      385     5637    9                           IF %KV_SRD.CRT.CLM<=%KV_SRD.TOPLFT.CLM THEN DO;

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:62   
   5637   1 000337  DCC7 0011                            LDB,B5   SRD$,AUTO
          1 000339  E845 0016                            LDR,R6   22,B5
          1 00033B  E945 000A                            CMR,R6   10,B5
          1 00033D  0A01 0009                            BAG      s:5644,PREL

      386     5638                    /*
      387     5639                    * WE'RE ALREADY AT THE LEFT MARGIN; 'UNFOLD' THE LINE.
      388     5640                    */
      389     5641    9                              %KV_SRD.CRT.CLM=%KV_SRD.BTMRHT.CLM;

   5641   1 00033F  E845 000C                            LDR,R6   12,B5
          1 000341  EF45 0016                            STR,R6   22,B5

      390     5642    9                              %KV_SRD.CRT.LIN=%KV_SRD.CRT.LIN-1;

   5642   1 000343  88C5 0015                            DEC      21,B5

      391     5643    9                              END;

   5643   1 000345  0F81 0024                            B        s:5666,PREL

      392     5644    8                           ELSE IF NOT TRUNC

   5644   1 000347  89C7 0018                            CMZ      TRUNC,AUTO
          1 000349  0801 0005                            BAL      s:5649,PREL

      393     5645                    /*
      394     5646                    * WE'RE NOT AT THE LEFT MARGIN; DO A 'NORMAL' BACKSPACE.
      395     5647                    */
      396     5648    8                           THEN %KV_SRD.CRT.CLM=%KV_SRD.CRT.CLM-1;

   5648   1 00034B  88C5 0016                            DEC      22,B5
          1 00034D  0F81 001C                            B        s:5666,PREL

      397     5649    9                           ELSE IF %KV_MVD.VRTCLM<=%KV_SRD.WDT THEN DO;

   5649   1 00034F  CCC6 0006                            LDB,B4   6,B6
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:63   
          1 000351  D844 001B                            LDR,R5   27,B4
          1 000353  5801 0005                            BLZ,R5   s:5653,PREL
          1 000355  D945 000D                            CMR,R5   13,B5
          1 000357  0301 0012                            BG       s:5666,PREL

      398     5650                    /*
      399     5651                    * WE'RE BACKSPACING BACK ONTO THE SCREEN, STOP TRUNCATING
      400     5652                    */
      401     5653    9                              TRUNC='0'B;

   5653   1 000359  8747 0018                            CL       TRUNC,AUTO

      402     5654    9                              %KV_SRD.CRT.CLM=%KV_MVD.VRTCLM;

   5654   1 00035B  E855                                 LDR,R6   R5
          1 00035C  EF45 0016                            STR,R6   22,B5

      403     5655    9                              END;

      404     5656    8                           END;

      405     5657    7                        END;

   5657   1 00035E  0F81 000B                            B        s:5666,PREL

      406     5658                    /*
      407     5659                    * WE AREN'T TO UPDATE THE VIRTUAL POSITION, SO IGNORE IT.
      408     5660                    */
      409     5661    6                     ELSE IF %KV_SRD.CRT.CLM>%KV_SRD.TOPLFT.CLM

   5661   1 000360  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 000362  E846 0016                            LDR,R6   22,B6
          1 000364  E946 000A                            CMR,R6   10,B6
          1 000366  0A81 0003                            BALE     s:5666,PREL

      410     5662                    /*
      411     5663                    * WE'RE NOT AT THE LEFT MARGIN, SO DO THE BS.
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:64   
      412     5664                    */
      413     5665    6                     THEN %KV_SRD.CRT.CLM=%KV_SRD.CRT.CLM-1;

   5665   1 000368  88C6 0016                            DEC      22,B6

      414     5666    6                     VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;

   5666   1 00036A  8AC7 0009                            INC      VDH_OTPLCL+3,AUTO

      415     5667    6                     VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;

   5667   1 00036C  88C7 000A                            DEC      VDH_OTPLCL+4,AUTO

      416     5668    6                     END;

   5668   1 00036E  E847 000A                            LDR,R6   VDH_OTPLCL+4,AUTO
          1 000370  6901 000A                            BEZ,R6   s:5669,PREL
          1 000372  D0C7 0015                            LDH,R5   ORGCHR,AUTO
          1 000374  ECC7 0007                            LDB,B6   VDH_OTPLCL+1,AUTO
          1 000376  B847 0009                            LDR,R3   VDH_OTPLCL+3,AUTO
          1 000378  D1B6                                 CMH,R5   ,B6,R3
          1 000379  0901 FFAC                            BE       s:5626,PREL

      417     5669    5                  %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;

   5669   1 00037B  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 00037D  5C01                                 LDV,R5   1
          1 00037E  DF46 001A                            STR,R5   26,B6
          1 000380  0F81 02DB                            B        s:5895,PREL

      418     5670        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:65   
      419     5671    5               CASE(%KV_OTPFNC_CR);

      420     5672                    /*
      421     5673                    * OUTPUT FUNCTION: CR (CARRIAGE RETURN)
      422     5674                    */
      423     5675                    /*
      424     5676                    * RESET THE TRUNCATION FLAG SINCE WE ARE GOING TO THE LEFT MARGIN;
      425     5677                    */
      426     5678    5                  TRUNC='0'B;

   5678   1 000382  8747 0018                            CL       TRUNC,AUTO

      427     5679    5                  %KV_SRD.CRT.CLM=%KV_SRD.TOPLFT.CLM;

   5679   1 000384  DCC7 0011                            LDB,B5   SRD$,AUTO
          1 000386  E845 000A                            LDR,R6   10,B5
          1 000388  EF45 0016                            STR,R6   22,B5

      428     5680    5                  %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;

   5680   1 00038A  CCC7 000F                            LDB,B4   VDI$,AUTO
          1 00038C  1C01                                 LDV,R1   1
          1 00038D  9F44 001A                            STR,R1   26,B4

      429     5681    6                  IF NOT VDH_OTPLCL.NONVRT THEN DO;

   5681   1 00038F  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
   5681   1 000391       0080
          1 000392  0501 000C                            BBT      s:5689,PREL

      430     5682                    /*
      431     5683                    * WE'RE TO UPDATE THE VIRTUAL POSITION; GO TO
      432     5684                    * VIRTUAL COLUMN 1.
      433     5685                    */
      434     5686    6                     %KV_MVD.VRTCLM=1;

   5686   1 000394  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:66   
          1 000397  ACC3 0006                            LDB,B2   6,B3
          1 000399  9F42 001B                            STR,R1   27,B2

      435     5687    6                     %KV_SRD.CRT.LIN=%KV_SRD.CRTVRTLINPHSLIN;

   5687   1 00039B  E845 0013                            LDR,R6   19,B5
          1 00039D  EF45 0015                            STR,R6   21,B5

      436     5688    6                     END;

      437     5689    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;

   5689   1 00039F  8AC7 0009                            INC      VDH_OTPLCL+3,AUTO

      438     5690    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;

   5690   1 0003A1  88C7 000A                            DEC      VDH_OTPLCL+4,AUTO
          1 0003A3  0F81 02B8                            B        s:5895,PREL

      439     5691        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:67   
      440     5692    5               CASE(%KV_OTPFNC_HT);

      441     5693                    /*
      442     5694                    * OUTPUT FUNCTION: HT (HORIZONTAL TAB)
      443     5695                    */
      444     5696    5                  J = %KV_MVD.VRTCLM+1; /* DEFAULT TAB IS ONE SPACE              */

   5696   1 0003A5  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0003A8  CCC5 0006                            LDB,B4   6,B5
          1 0003AA  D844 001B                            LDR,R5   27,B4
          1 0003AC  5E01                                 ADV,R5   1
          1 0003AD  DF47 0025                            STR,R5   J,AUTO

      445     5697    5                  %KV_MVD.VRTCLM = J;

   5697   1 0003AF  DF44 001B                            STR,R5   27,B4

      446     5698    5                  B4=%KV_STR.OTPTAB$;

   5698   1 0003B1  CCC5 0004                            LDB,B4   4,B5
          1 0003B3  BCC4 0006                            LDB,B3   6,B4
          1 0003B5  BFC7 000B                            STB,B3   B4,AUTO

      447     5699    5                  IF B4~=ADDR(NIL) THEN

   5699   1 0003B7  8DC7 000B                            CMN      B4,AUTO
          1 0003B9  0901 0021                            BE       s:5717,PREL

      448     5700    6   TABLOOP:       DO I=SIZEC(KV$SHRBFR)+1 TO B4->KV$SHRBFR.BYTSIZ-1;

   5700   1 0003BB  6C09                 TABLOOP         LDV,R6   9
          1 0003BC  EF47 0024                            STR,R6   I,AUTO
          1 0003BE  0F81 0015                            B        s:5716+2,PREL

      449     5701                    /*
      450     5702                    * THE TAB BUFFER EXISTS.
      451     5703                    */
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:68   
      452     5704                    /*
      453     5705                    * THIS LOOP IS TRAVERSED FOR EACH POSITION IN THE TAB BUFFER
      454     5706                    * SCANNED, UNTIL THE CORRECT TAB IS FOUND OR THE END IS ENCOUNTERED.
      455     5707                    */
      456     5708    7                     IF B4->KV$SHRBFR_BYT(IS)>=J THEN DO;

   5708   1 0003C0  ECC7 000B                            LDB,B6   B4,AUTO
          1 0003C2  B847 0024                            LDR,R3   I,AUTO
          1 0003C4  E2B6                                 LLH,R6   ,B6,R3
          1 0003C5  E947 0025                            CMR,R6   J,AUTO
          1 0003C7  0201 000A                            BL       s:5716,PREL

      457     5709                    /*
      458     5710                    * THE CURRENT TAB STOP IS GREATER THAN THE ONE WE'RE LOOKING FOR;
      459     5711                    * WE'VE FOUND IT.
      460     5712                    */
      461     5713    7                        %KV_MVD.VRTCLM = B4->KV$SHRBFR_BYT(IS);

   5713   1 0003C9  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0003CC  CCC5 0006                            LDB,B4   6,B5
          1 0003CE  EF44 001B                            STR,R6   27,B4

      462     5714    7                        EXIT TABLOOP;

   5714   1 0003D0  0F81 000A                            B        s:5717,PREL

      463     5715    7                        END;
      464     5716    6                     END;

   5716   1 0003D2  8AC7 0024                            INC      I,AUTO
          1 0003D4  ECC7 000B                            LDB,B6   B4,AUTO
          1 0003D6  E847 0024                            LDR,R6   I,AUTO
          1 0003D8  E946 0002                            CMR,R6   2,B6
          1 0003DA  0266                                 BL       s:5708,SPREL

      465     5717    6                  IF NOT TRUNC THEN DO;

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:69   
   5717   1 0003DB  89C7 0018                            CMZ      TRUNC,AUTO
          1 0003DD  0801 002E                            BAL      s:5734,PREL

      466     5718    6                     IF NOT VDH_OTPLCL.NONVRT AND %KV_MVD.TABSIM

   5718   1 0003DF  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
   5718   1 0003E1       0080
          1 0003E2  0501 0016                            BBT      s:5728,PREL
          1 0003E4  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0003E7  DCC6 0006                            LDB,B5   6,B6
          1 0003E9  82C5 0015                            LB,'0002'X        21,B5
          1 0003EB       0002
          1 0003EC  0581 000C                            BBF      s:5728,PREL

      467     5719                    /*
      468     5720                    * WE'RE IN TAB SIMULATION MODE; SEND SPACES, ETC., TO
      469     5721                    * MOVE THE CARRIAGE.
      470     5722                    */
      471     5723    6                     THEN CALL KVO$PST(KV_VDH_PST_0_VRT);

   5723   1 0003EE  BB80 0000 0002  02                   LAB,B3   +2
          1 0003F1  CBF0 0100                            LAB,B4   256,IMO
          1 0003F3  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0003F6       0001                            DC       s:5723+9,PREL
          1 0003F7  0F81 0014                            B        s:5734,PREL

      472     5724    7                     ELSE DO;

      473     5725                    /*
      474     5726                    * WE'RE NOT TO SIMULATE TABS; SEND A HORIZONTAL TAB CHARACTER.
      475     5727                    */
      476     5728    7                        %OTPCHR=KV$TRNTBL.HT_CHR;

   5728   1 0003F9  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 0003FB  DCC6 000A                            LDB,B5   10,B6
          1 0003FD  E846 000C                            LDR,R6   12,B6
          1 0003FF  CCC7 000D                            LDB,B4   TRNTBL$,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:70   
          1 000401  D0C4 001E                            LDH,R5   30,B4
          1 000403  B856                                 LDR,R3   R6
          1 000404  D7B5                                 STH,R5   ,B5,R3

      477     5729    7                        CHRCNT=1;

   5729   1 000405  5C01                                 LDV,R5   1
          1 000406  DF47 0014                            STR,R5   CHRCNT,AUTO

      478     5730    7                        I=1;

   5730   1 000408  DF47 0024                            STR,R5   I,AUTO

      479     5731    7                        GOTO NRMTRNNO_PST;

   5731   1 00040A  0F81 FE18                            B        s:5558,PREL

      480     5732    7                        END;
      481     5733    6                     END;
      482     5734    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;

   5734   1 00040C  8AC7 0009                            INC      VDH_OTPLCL+3,AUTO

      483     5735    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;

   5735   1 00040E  88C7 000A                            DEC      VDH_OTPLCL+4,AUTO
          1 000410  0F81 024B                            B        s:5895,PREL

      484     5736        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:71   
      485     5737    5               CASE(%KV_OTPFNC_LF);

      486     5738                    /*
      487     5739                    * OUTPUT FUNCTION: LF (LINE FEED)
      488     5740                    */
      489     5741    5                  IF NOT TRUNC

   5741   1 000412  89C7 0018                            CMZ      TRUNC,AUTO
          1 000414  0801 001F                            BAL      s:5746,PREL

      490     5742    5                  THEN IF NOT VDH_OTPLCL.NO_WRAP

   5742   1 000416  82C7 0006                            LB,'0010'X        VDH_OTPLCL,AUTO
   5742   1 000418       0010
          1 000419  0501 001A                            BBT      s:5746,PREL

      491     5743    5                  THEN IF VDH_OTPLCL.NONVRT

   5743   1 00041B  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
   5743   1 00041D       0080
          1 00041E  0581 000C                            BBF      s:5745,PREL

      492     5744    5                  THEN CALL KVO$PST(KV_VDH_PST_LF);

   5744   1 000420  BB80 0000 0004  02                   LAB,B3   +4
          1 000423  CBF0 0100                            LAB,B4   256,IMO
          1 000425  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000428       0001                            DC       s:5744+9,PREL
          1 000429  0F81 000A                            B        s:5746,PREL

      493     5745    5                  ELSE CALL KVO$PST(KV_VDH_PST_LF_VRT);

   5745   1 00042B  BB80 0000 0006  02                   LAB,B3   +6
          1 00042E  CBF0 0100                            LAB,B4   256,IMO
          1 000430  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000433       0001                            DC       s:5746,PREL

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:72   
      494     5746    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;

   5746   1 000434  8AC7 0009                            INC      VDH_OTPLCL+3,AUTO

      495     5747    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;

   5747   1 000436  88C7 000A                            DEC      VDH_OTPLCL+4,AUTO
          1 000438  0F81 0223                            B        s:5895,PREL

      496     5748        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:73   
      497     5749    5               CASE(ELSE);

   5747   1                              BLANKS          null
      498     5750                    /*
      499     5751                    * OUTPUT FUNCTION: SP (SPACE)
      500     5752                    */
      501     5753    5   BLANKS:        ;
      502     5754    5                  CHRCNT=%KV_MRD.MINSP_FORPST;

   5754   1 00043A  ECC7 0011            BLANKS          LDB,B6   SRD$,AUTO
          1 00043C  DC86                                 LDB,B5   ,B6
          1 00043D  E2C5 000C                            LLH,R6   12,B5
          1 00043F  EF47 0014                            STR,R6   CHRCNT,AUTO

      503     5755    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+CHRCNT;

   5755   1 000441  EA47 0009                            ADD,R6   VDH_OTPLCL+3,AUTO
          1 000443  EF47 0009                            STR,R6   VDH_OTPLCL+3,AUTO

      504     5756    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-CHRCNT;

   5756   1 000445  D847 000A                            LDR,R5   VDH_OTPLCL+4,AUTO
          1 000447  D247 0014                            SUB,R5   CHRCNT,AUTO
          1 000449  DF47 000A                            STR,R5   VDH_OTPLCL+4,AUTO

      505     5757    6                  DO WHILE VDH_OTPLCL.BFR_.BYTSIZ>0;

   5757   1 00044B  5901 0014                            BEZ,R5   s:5765,PREL

      506     5758    7                     IF %INPCHR=' ' THEN DO;

   5758   1 00044D  ECC7 0007                            LDB,B6   VDH_OTPLCL+1,AUTO
          1 00044F  B847 0009                            LDR,R3   VDH_OTPLCL+3,AUTO
          1 000451  E0B6                                 LDH,R6   ,B6,R3
          1 000452  6D20                                 CMV,R6   32
          1 000453  0981 000C                            BNE      s:5765,PREL

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:74   
      507     5759    7                        VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;

   5759   1 000455  8AC7 0009                            INC      VDH_OTPLCL+3,AUTO

      508     5760    7                        VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;

   5760   1 000457  88C7 000A                            DEC      VDH_OTPLCL+4,AUTO

      509     5761    7                        CHRCNT=CHRCNT+1;

   5761   1 000459  8AC7 0014                            INC      CHRCNT,AUTO

      510     5762    7                        END;

   5762   1 00045B  0F81 0001                            B        s:5764,PREL

      511     5763    6                     ELSE EXIT;
      512     5764    6                     END;

   5764   1 00045D  E847 000A                            LDR,R6   VDH_OTPLCL+4,AUTO
          1 00045F  69EE                                 BNEZ,R6  s:5758,SPREL

      513     5765    6                  IF NOT TRUNC THEN DO;

   5765   1 000460  89C7 0018                            CMZ      TRUNC,AUTO
          1 000462  0801 00B6                            BAL      s:5813,PREL

      514     5766    6                     IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP

   5766   1 000464  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 000466  E846 001A                            LDR,R6   26,B6
          1 000468  6D01                                 CMV,R6   1
          1 000469  0981 0009                            BNE      s:5768,PREL

      515     5767    6                     THEN CALL KVV$CALUSR_PST;

   5767   1 00046B  CBF0 0000                            LAB,B4   0,IMO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:75   
          1 00046D  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 000470       0001                            DC       s:5767+6,PREL
          1 000471  0F81 0003                            B        s:5769,PREL

      516     5768    6                     ELSE %KV_VDI.OTPCNDPND.PST = 0;

   5768   1 000473  8746 001A                            CL       26,B6

      517     5769    6                     %KV_SRD.CRT.CLM=%KV_SRD.CRT.CLM+CHRCNT;

   5769   1 000475  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 000477  E846 0016                            LDR,R6   22,B6
          1 000479  EA47 0014                            ADD,R6   CHRCNT,AUTO
          1 00047B  EF46 0016                            STR,R6   22,B6

      518     5770    6                     IS = %KV_SRD.CRT.CLM-ENDCLM;

   5770   1 00047D  E247 0013                            SUB,R6   ENDCLM,AUTO
          1 00047F  EF47 0024                            STR,R6   I,AUTO

      519     5771    7                     IF IS>0 THEN DO;

   5771   1 000481  6A81 008E                            BLEZ,R6  s:5810,PREL

      520     5772    8                        IF %KV_SRD.TRUNCATE THEN DO;

   5772   1 000483  82C6 000E                            LB,'0004'X        14,B6
   5772   1 000485       0004
          1 000486  0581 000D                            BBF      s:5782,PREL

      521     5773    8                           %KV_SRD.CRT.CLM=ENDCLM;

   5773   1 000488  D847 0013                            LDR,R5   ENDCLM,AUTO
          1 00048A  DF46 0016                            STR,R5   22,B6

      522     5774                    /*
      523     5775                    * WE'RE TRUNCATING, POSITION TO THE RIGHT MARGIN,
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:76   
      524     5776                    * THEN SEND ONE MORE BLANK.
      525     5777                    */
      526     5778    8                           VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX-1;

   5778   1 00048C  88C7 0009                            DEC      VDH_OTPLCL+3,AUTO

      527     5779    8                           VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ+1;

   5779   1 00048E  8AC7 000A                            INC      VDH_OTPLCL+4,AUTO

      528     5780    8                           CHRCNT=CHRCNT-1;

   5780   1 000490  88C7 0014                            DEC      CHRCNT,AUTO

      529     5781    8                           END;

   5781   1 000492  0F81 007D                            B        s:5810,PREL

      530     5782    8                        ELSE DO WHILE IS>0;

   5782   1 000494  6A81 007B                            BLEZ,R6  s:5810,PREL

      531     5783    8                           JS = %KV_SRD.DVCLINBIS+%KV_SRD.CRT.LIN+1

   5783   1 000496  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 000498  E846 0019                            LDR,R6   25,B6
          1 00049A  EA46 0015                            ADD,R6   21,B6
          1 00049C  E246 000B                            SUB,R6   11,B6
          1 00049E  6E01                                 ADV,R6   1
          1 00049F  EF47 0025                            STR,R6   J,AUTO

      532     5784    8                             -%KV_SRD.BTMRHT.LIN;
      533     5785    8                           IF IS=1 AND (VDH_OTPLCL.BFR_.BYTX~=

   5785   1 0004A1  D847 0024                            LDR,R5   I,AUTO
          1 0004A3  5D01                                 CMV,R5   1
          1 0004A4  0981 0034                            BNE      s:5797,PREL
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:77   
          1 0004A6  DCC7 0004                            LDB,B5   @KV$VDH_OTPLCL,AUTO
          1 0004A8  C847 0009                            LDR,R4   VDH_OTPLCL+3,AUTO
          1 0004AA  C945 0003                            CMR,R4   3,B5
          1 0004AC  0981 0028                            BNE      s:5790,PREL
          1 0004AE  89C7 0019                            CMZ      AUTONL,AUTO
          1 0004B0  0801 0028                            BAL      s:5797,PREL
          1 0004B2  CCC7 000F                            LDB,B4   VDI$,AUTO
          1 0004B4  82C4 001D                            LB,'0010'X        29,B4
          1 0004B6       0010
          1 0004B7  0581 001D                            BBF      s:5790,PREL
          1 0004B9  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0004BC  ACC3 0006                            LDB,B2   6,B3
          1 0004BE  82C2 0016                            LB,'0080'X        22,B2
          1 0004C0       0080
          1 0004C1  0581 0013                            BBF      s:5790,PREL
          1 0004C3  6A01 000F                            BGZ,R6   s:5785+50,PREL
          1 0004C5  B846 0019                            LDR,R3   25,B6
          1 0004C7  3901 0011                            BEZ,R3   s:5797,PREL
          1 0004C9  82C6 000E                            LB,'0020'X        14,B6
          1 0004CB       0020
          1 0004CC  0581 000C                            BBF      s:5797,PREL
          1 0004CE  82C6 000E                            LB,'0080'X        14,B6
          1 0004D0       0080
          1 0004D1  0581 0007                            BBF      s:5797,PREL
          1 0004D3  6801 0005                            BLZ,R6   s:5797,PREL

      534     5786    8                             KV$VDH_OTPLCL.BFR_.BYTX OR NOT AUTONL
      535     5787    8                             AND NOT (%KV_VDI.USRRQSDAT.RED AND %KV_MVD.RETYPOVR
      536     5788    8                             AND (JS<=0 AND NOT (%KV_SRD.DVCLINBIS~=0
      537     5789    8                             AND %KV_SRD.PAGEHALT AND %KV_SRD.PRINTHALT)
      538     5790    8                             OR JS<0))) THEN I=0;

   5790   1 0004D5  8747 0024                            CL       I,AUTO
          1 0004D7  0F81 0034                            B        s:5808,PREL

      539     5791    9                           ELSE DO;

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:78   
      540     5792                    /*
      541     5793                    * WE ARE PAST THE RIGHT EDGE;
      542     5794                    * OR AT IT, READING, AND NOT ON THE BOTTOM LINE;
      543     5795                    * WE'LL HAVE TO FOLD THE LINE OVER.
      544     5796                    */
      545     5797    9                              I=%KV_SRD.CRT.CLM-%KV_SRD.WDT;

   5797   1 0004D9  C846 0016                            LDR,R4   22,B6
          1 0004DB  C246 000D                            SUB,R4   13,B6
          1 0004DD  CF47 0024                            STR,R4   I,AUTO

      546     5798   10                              CALL Y$WRAP WHENALTRETURN DO;

   5798   1 0004DF  E3C0 0271                            LNJ,B6   s:0,PREL
          1 0004E1       0003                            DC       s:5799,PREL
          1 0004E2  0F81 001F                            B        s:5805,PREL

      547     5799   10                                 I=I-%KV_SRD.TOPLFT.CLM;

   5799   1 0004E4  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 0004E6  E847 0024                            LDR,R6   I,AUTO
          1 0004E8  E246 000A                            SUB,R6   10,B6
          1 0004EA  EF47 0024                            STR,R6   I,AUTO

      548     5800   10                                 VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX-I;

   5800   1 0004EC  E247 0009                            SUB,R6   VDH_OTPLCL+3,AUTO
          1 0004EE  8256                                 NEG      R6
          1 0004EF  EF47 0009                            STR,R6   VDH_OTPLCL+3,AUTO

      549     5801   10                                 VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ+I;

   5801   1 0004F1  D847 000A                            LDR,R5   VDH_OTPLCL+4,AUTO
          1 0004F3  DA47 0024                            ADD,R5   I,AUTO
          1 0004F5  DF47 000A                            STR,R5   VDH_OTPLCL+4,AUTO

      550     5802   10                                 CHRCNT=CHRCNT-I;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:79   

   5802   1 0004F7  C847 0014                            LDR,R4   CHRCNT,AUTO
          1 0004F9  C247 0024                            SUB,R4   I,AUTO
          1 0004FB  CF47 0014                            STR,R4   CHRCNT,AUTO

      551     5803   10                                 I=%KV_SRD.BTMRHT.CLM+1;

   5803   1 0004FD  B846 000C                            LDR,R3   12,B6
          1 0004FF  3E01                                 ADV,R3   1
          1 000500  BF47 0024                            STR,R3   I,AUTO

      552     5804   10                                 END;

      553     5805    9                              %KV_SRD.CRT.CLM=I;

   5805   1 000502  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 000504  E847 0024                            LDR,R6   I,AUTO
          1 000506  EF46 0016                            STR,R6   22,B6

      554     5806    9                              I=I-%KV_SRD.BTMRHT.CLM;

   5806   1 000508  E246 000C                            SUB,R6   12,B6
          1 00050A  EF47 0024                            STR,R6   I,AUTO

      555     5807    9                              END;

      556     5808    8                           END;

   5808   1 00050C  E847 0024                            LDR,R6   I,AUTO
          1 00050E  6A01 FF87                            BGZ,R6   s:5783,PREL

      557     5809    7                        END;

      558     5810    6                     IF %KV_VDI.OTPCNDPND.PST=0

   5810   1 000510  DCC7 000F                            LDB,B5   VDI$,AUTO
          1 000512  D845 001A                            LDR,R5   26,B5
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:80   
          1 000514  5981 0004                            BNEZ,R5  s:5813,PREL

      559     5811    6                     THEN %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN;

   5811   1 000516  5C02                                 LDV,R5   2
          1 000517  DF45 001A                            STR,R5   26,B5

      560     5812    6                     END;

      561     5813    6                  IF NOT VDH_OTPLCL.NONVRT THEN DO;

   5813   1 000519  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
   5813   1 00051B       0080
          1 00051C  0501 013F                            BBT      s:5895,PREL

      562     5814                    /*
      563     5815                    * WE HAVE BEEN REQUESTED TO UPDATE THE VIRTUAL POSITION
      564     5816                    * WHEN UPDATING THE PHYSICAL POSITION.
      565     5817                    */
      566     5818    6                     %KV_MVD.VRTCLM=%KV_MVD.VRTCLM+CHRCNT;

   5818   1 00051E  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000521  DCC6 0006                            LDB,B5   6,B6
          1 000523  E845 001B                            LDR,R6   27,B5
          1 000525  EA47 0014                            ADD,R6   CHRCNT,AUTO
          1 000527  EF45 001B                            STR,R6   27,B5

      567     5819    6                     %KV_SRD.VRTPSTOK='1'B;

   5819   1 000529  DCC7 0011                            LDB,B5   SRD$,AUTO
          1 00052B  8945 000E                            LBT,'0010'X       14,B5
          1 00052D       0010

      568     5820    6                     END;

      569     5821    5               END; /* DO CASE                                                   */

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:81   
   5821   1 00052E  0F81 012D                            B        s:5895,PREL

      570     5822    5               ELSE DO;

      571     5823                    /*
      572     5824                    * EXTTRN (EXTENDED TRANSLATION) ENTRY IN SECONDARY TABLE.
      573     5825                    */
      574     5826    5                  %KV_USR_EXTOTPTRN.FNC=%KV_USR_FNC_EXTOTPTRN;

   5826   1 000530  2C06                                 LDV,R2   6
          1 000531  A7C7 001A                            STH,R2   FPT,AUTO

      575     5827    5                  %KV_USR_EXTOTPTRN.ORGCHR=ORGCHR;

   5827   1 000533  90C7 0015                            LDH,R1   ORGCHR,AUTO
          1 000535  9AC7 001B                            SRM,R1,'00FF'X    FPT+1,AUTO
          1 000537       00FF

      576     5828    5                  %KV_USR_EXTOTPTRN.ID=ASCBIN(OTPESCCHR);

   5828   1 000538  E2C7 0017                            LLH,R6   OTPESCCHR,AUTO
          1 00053A  E7C7 001B                            STH,R6   FPT+1,AUTO

      577     5829    5                  %KV_USR_EXTOTPTRN.OTPLCLFLGS=

   5829   1 00053C  E847 0006                            LDR,R6   VDH_OTPLCL,AUTO
          1 00053E  EAC7 001A                            SRM,R6,'00FF'X    FPT,AUTO
          1 000540       00FF

      578     5830    5                    ADDR(VDH_OTPLCL)->KV$USR_EXTOTPTRN.OTPLCLFLGS;
      579     5831    5                  %EXTOTPLCL.EXTOTPTRN='1'B;

   5831   1 000541  8947 001A                            LBT,'0008'X       FPT,AUTO
   5831   1 000543       0008

      580     5832    5                  %KV_USR_EXTOTPTRN.EXTTRN$=KV$TRNTBL.EXTOTPTRN$;

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:82   
   5832   1 000544  DCC7 000D                            LDB,B5   TRNTBL$,AUTO
          1 000546  CCC5 0014                            LDB,B4   20,B5
          1 000548  CFC7 001C                            STB,B4   FPT+2,AUTO

      581     5833    6                  DO WHILE %KV_USR_EXTOTPTRN.EXTTRN$~=ADDR(NIL) AND FPT(0)~=0;

   5833   1 00054A  0F81 00F5                            B        s:5889,PREL

      582     5834        /* Search for the proper table. */
      583     5835    7                     IF %KV_USR_EXTOTPTRN.ID>=%KV_EXTTRN.CNT THEN DO;

   5835   1 00054C  E2C7 001B                            LLH,R6   FPT+1,AUTO
          1 00054E  ECC7 001C                            LDB,B6   FPT+2,AUTO
          1 000550  D2C6 0002                            LLH,R5   2,B6
          1 000552  E955                                 CMR,R6   R5
          1 000553  0801 0009                            BAL      s:5839,PREL

      584     5836    7                        %KV_USR_EXTOTPTRN.ID=%KV_USR_EXTOTPTRN.ID-%KV_EXTTRN.CNT;

   5836   1 000555  E255                                 SUB,R6   R5
          1 000556  E7C7 001B                            STH,R6   FPT+1,AUTO

      585     5837    7                        %KV_USR_EXTOTPTRN.EXTTRN$=%KV_EXTTRN.LNK$;

   5837   1 000558  DC86                                 LDB,B5   ,B6
          1 000559  DFC7 001C                            STB,B5   FPT+2,AUTO

      586     5838    7                        END;

   5838   1 00055B  0F81 00E4                            B        s:5889,PREL

      587     5839    6                     ELSE IF %KV_EXTTRN.TXTSIZ=0 OR %KV_EXTTRN.TXTSIZ>7

   5839   1 00055D  82C6 0002                            LB,'007F'X        2,B6
   5839   1 00055F       007F
          1 000560  0581 00E7                            BBF      s:5890,PREL
          1 000562  C846 0002                            LDR,R4   2,B6
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:83   
          1 000564  C570 007F                            AND,R4   127,IMO
          1 000566  4D07                                 CMV,R4   7
          1 000567  0301 00E0                            BG       s:5890,PREL
          1 000569  B846 0003                            LDR,R3   3,B6
          1 00056B  B570 00FF                            AND,R3   255,IMO
          1 00056D  3D07                                 CMV,R3   7
          1 00056E  0301 00D9                            BG       s:5890,PREL

      588     5840    6                       OR %KV_EXTTRN.TMPLATSIZ>7 THEN EXIT;
      589     5841    7                     ELSE IF %KV_EXTTRN.TMPLATSIZ~=0 THEN DO;

   5841   1 000570  82C6 0003                            LB,'00FF'X        3,B6
   5841   1 000572       00FF
          1 000573  0581 003A                            BBF      s:5856,PREL

      590     5842    7                        JS=%KV_EXTTRN.TMPLATSIZ;

   5842   1 000575  BF47 0025                            STR,R3   J,AUTO

      591     5843    7                        SUBSTR(%EXTTXT,0,JS)=SUBSTR(%KV_EXTTRN.TXT,0,JS);

   5843   1 000577  AB86                                 LAB,B2   ,B6
          1 000578  2C08                                 LDV,R2   8
          1 000579  E853                                 LDR,R6   R3
          1 00057A  BB87                                 LAB,B3   ,AUTO
          1 00057B  3C40                                 LDV,R3   64
          1 00057C  0008                                 MMM

      592     5844    7                        IS=(%KV_USR_EXTOTPTRN.ID+1)*%KV_EXTTRN.TXTSIZ+JS;

   5844   1 00057D  E2C7 001B                            LLH,R6   FPT+1,AUTO
          1 00057F  6E01                                 ADV,R6   1
          1 000580  DCC7 001C                            LDB,B5   FPT+2,AUTO
          1 000582  D845 0002                            LDR,R5   2,B5
          1 000584  D570 007F                            AND,R5   127,IMO
          1 000586  EB55                                 MUL,R6   R5
          1 000587  EA47 0025                            ADD,R6   J,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:84   
          1 000589  EF47 0024                            STR,R6   I,AUTO

      593     5845    7                        %EXTOTPLCL.BFR_.BYTSIZ=JS;

   5845   1 00058B  C847 0025                            LDR,R4   J,AUTO
          1 00058D  CF47 001E                            STR,R4   FPT+4,AUTO

      594     5846    8                        DO WHILE JS>0;

   5846   1 00058F  4A81 001C                            BLEZ,R4  s:5854,PREL

      595     5847    8                           JS=JS-1;

   5847   1 000591  88C7 0025                            DEC      J,AUTO

      596     5848    8                           IF SUBSTR(%EXTTXT,JS,1)=KV$TRNTBL.OTPESC.CHR

   5848   1 000593  B847 0025                            LDR,R3   J,AUTO
          1 000595  3E40                                 ADV,R3   64
          1 000596  E0B7                                 LDH,R6   ,AUTO,R3
          1 000597  ECC7 000D                            LDB,B6   TRNTBL$,AUTO
          1 000599  D846 001B                            LDR,R5   27,B6
          1 00059B  5008                                 SOL,R5   8
          1 00059C  5068                                 SAR,R5   8
          1 00059D  E1D5                                 CMH,R6   R5
          1 00059E  0981 000A                            BNE      s:5853,PREL

      597     5849    9                           THEN DO;

      598     5850    9                              IS=IS-1;

   5850   1 0005A0  88C7 0024                            DEC      I,AUTO

      599     5851    9                              SUBSTR(%EXTTXT,JS,1)=SUBSTR(%KV_EXTTRN.TXT,IS,1);

   5851   1 0005A2  DCC7 001C                            LDB,B5   FPT+2,AUTO
          1 0005A4  A847 0024                            LDR,R2   I,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:85   
          1 0005A6  2E08                                 ADV,R2   8
          1 0005A7  C0A5                                 LDH,R4   ,B5,R2
          1 0005A8  C7B7                                 STH,R4   ,AUTO,R3

      600     5852    9                              END;

      601     5853    8                           END;

   5853   1 0005A9  E847 0025                            LDR,R6   J,AUTO
          1 0005AB  6A66                                 BGZ,R6   s:5847,SPREL

      602     5854    7                        GOTO EXTOTPLCL;

   5854   1 0005AC  0F81 0015                            B        s:5859,PREL

      603     5855    7                        END;
      604     5856    7                     ELSE IF %KV_EXTTRN.TXTSIZ>1 OR NOT %KV_EXTTRN.TRN THEN DO;

   5856   1 0005AE  4D01                                 CMV,R4   1
          1 0005AF  0301 0006                            BG       s:5857,PREL
          1 0005B1  82C6 0002                            LB,'0080'X        2,B6
          1 0005B3       0080
          1 0005B4  0501 006F                            BBT      s:5882,PREL

      605     5857    7                        JS=%KV_EXTTRN.TXTSIZ;

   5857   1 0005B6  CF47 0025                            STR,R4   J,AUTO

      606     5858    7                        %EXTOTPLCL.BFR_.BYTSIZ=JS;

   5858   1 0005B8  CF47 001E                            STR,R4   FPT+4,AUTO

      607     5859    7                        SUBSTR(%EXTTXT,0,JS)=SUBSTR(%KV_EXTTRN.TXT,

   5859   1 0005BA  EB54                                 MUL,R6   R4
          1 0005BB  AB86                                 LAB,B2   ,B6
          1 0005BC  A856                                 LDR,R2   R6
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:86   
          1 0005BD  2E08                                 ADV,R2   8
          1 0005BE  E854                                 LDR,R6   R4
          1 0005BF  BB87                                 LAB,B3   ,AUTO
          1 0005C0  3C40                                 LDV,R3   64
          1 0005C1  0008                                 MMM

   5859   1                              EXTOTPLCL       null
      608     5860    7                          %KV_USR_EXTOTPTRN.ID*JS,JS);
      609     5861    7   EXTOTPLCL:           ;
      610     5862    7                        IF %KV_EXTTRN.TRN AND NOT %EXTOTPLCL.HDN

   5862   1 0005C2  ECC7 001C            EXTOTPLCL       LDB,B6   FPT+2,AUTO
          1 0005C4  82C6 0002                            LB,'0080'X        2,B6
          1 0005C6       0080
          1 0005C7  0581 0047                            BBF      s:5876,PREL
          1 0005C9  82C7 001A                            LB,'0020'X        FPT,AUTO
          1 0005CB       0020
          1 0005CC  0501 0042                            BBT      s:5876,PREL
          1 0005CE  E0C6 0003                            LDH,R6   3,B6
          1 0005D0  6D01                                 CMV,R6   1
          1 0005D1  0981 003D                            BNE      s:5876,PREL
          1 0005D3  89C7 0018                            CMZ      TRUNC,AUTO
          1 0005D5  0801 0039                            BAL      s:5876,PREL

      611     5863    8                          AND %KV_EXTTRN.WDT=1 AND NOT TRUNC THEN DO;

      612     5864    8                           %EXTOTPLCL.TRN='1'B;

   5864   1 0005D7  8947 001A                            LBT,'0040'X       FPT,AUTO
   5864   1 0005D9       0040

      613     5865    8                           %KV_MRD.DVCCLM=%KV_MRD.DVCCLM+1;

   5865   1 0005DA  DCC7 0011                            LDB,B5   SRD$,AUTO
          1 0005DC  CC85                                 LDB,B4   ,B5
          1 0005DD  8AC4 001E                            INC      30,B4

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:87   
      614     5866    8                           %KV_SRD.CRT.CLM=%KV_MRD.DVCCLM;

   5866   1 0005DF  CC85                                 LDB,B4   ,B5
          1 0005E0  E844 001E                            LDR,R6   30,B4
          1 0005E2  EF45 0016                            STR,R6   22,B5

      615     5867    8                           %KV_SRD.HI_NONBLN_PST=%KV_SRD.CRT_PST-1;

   5867   1 0005E4  8CC5 0015                            LDI      21,B5
          1 0005E6  8470 FFFF FFFF                       AID      -1,IMO
          1 0005E9  8D45 0017                            SDI      23,B5

      616     5868    8                           IF NOT VDH_OTPLCL.NONVRT

   5868   1 0005EB  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
   5868   1 0005ED       0080
          1 0005EE  0501 000A                            BBT      s:5871,PREL

      617     5869    8                           THEN %KV_MVD.VRTCLM=%KV_MVD.VRTCLM+1;

   5869   1 0005F0  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0005F3  BCC6 0006                            LDB,B3   6,B6
          1 0005F5  8AC3 001B                            INC      27,B3
          1 0005F7  0F81 0017                            B        s:5876,PREL

      618     5870    9                           ELSE DO;

      619     5871    9                              %KV_SRD.VRTPSTOK='0'B;

   5871   1 0005F9  8845 000E                            LBF,'0010'X       14,B5
   5871   1 0005FB       0010

      620     5872    9                              IF %KV_VDI.RE_DSPLOWX>%KV_SSN.REDBFR.EDTLOWX

   5872   1 0005FC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0005FF  BCC6 0002                            LDB,B3   2,B6
          1 000601  ACC7 000F                            LDB,B2   VDI$,AUTO
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:88   
          1 000603  D842 0016                            LDR,R5   22,B2
          1 000605  5801 0005                            BLZ,R5   s:5873,PREL
          1 000607  D943 002B                            CMR,R5   43,B3
          1 000609  0A81 0005                            BALE     s:5876,PREL

      621     5873    9                              THEN %KV_VDI.RE_DSPLOWX=%KV_SSN.REDBFR.EDTLOWX;

   5873   1 00060B  D843 002B                            LDR,R5   43,B3
          1 00060D  DF42 0016                            STR,R5   22,B2

      622     5874    9                              END;

      623     5875    8                           END;

      624     5876    7                        %EXTOTPLCL.BFR_.ADR$=ADDR(%EXTTXT);

   5876   1 00060F  EBC7 0020                            LAB,B6   FPT+6,AUTO
          1 000611  EFC7 001B                            STB,B6   FPT+1,AUTO

      625     5877    7                        %EXTOTPLCL.BFR_.BYTX=0;

   5877   1 000613  8747 001D                            CL       FPT+3,AUTO

      626     5878    7                        CALL KVO$OTPLCL(FPT);

   5878   1 000615  DBC7 001A                            LAB,B5   FPT,AUTO
          1 000617  DFC7 0028                            STB,B5   J+3,AUTO
          1 000619  BBC7 0028                            LAB,B3   J+3,AUTO
          1 00061B  CBF0 0100                            LAB,B4   256,IMO
          1 00061D  E3C0 F9E2                            LNJ,B6   s:10,PREL
          1 00061F       0001                            DC       s:5879,PREL

      627     5879    7                        FPT(0)=0; /* SAY WERE DONE                               */

   5879   1 000620  8747 001A                            CL       FPT,AUTO

      628     5880    7                        END;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:89   

   5880   1 000622  0F81 001D                            B        s:5889,PREL

      629     5881    7                     ELSE DO;

      630     5882    7                        %OTPCHR=SUBSTR(%KV_EXTTRN.TXT,%KV_USR_EXTOTPTRN.ID,1);

   5882   1 000624  DCC7 000F                            LDB,B5   VDI$,AUTO
          1 000626  CCC5 000A                            LDB,B4   10,B5
          1 000628  A845 000C                            LDR,R2   12,B5
          1 00062A  9856                                 LDR,R1   R6
          1 00062B  1E08                                 ADV,R1   8
          1 00062C  E096                                 LDH,R6   ,B6,R1
          1 00062D  E7A4                                 STH,R6   ,B4,R2

      631     5883    7                        I=1;

   5883   1 00062E  6C01                                 LDV,R6   1
          1 00062F  EF47 0024                            STR,R6   I,AUTO

      632     5884    7                        CHRCNT=1;

   5884   1 000631  EF47 0014                            STR,R6   CHRCNT,AUTO

      633     5885    7                        IF TRUNC THEN GOTO NRMTRNTRUNC;

   5885   1 000633  89C7 0018                            CMZ      TRUNC,AUTO
          1 000635  0801 FC62                            BAL      s:5582,PREL

      634     5886    7                        IF %KV_EXTTRN.WDT=1 THEN GOTO NRMTRNPST;

   5886   1 000637  ECC7 001C                            LDB,B6   FPT+2,AUTO
          1 000639  D0C6 0003                            LDH,R5   3,B6
          1 00063B  5D01                                 CMV,R5   1
          1 00063C  0901 FB54                            BE       s:5511,PREL

      635     5887    7                        GOTO NRMTRNNO_PST;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:90   

   5887   1 00063E  0F81 FBE4                            B        s:5558,PREL

      636     5888    7                        END;
      637     5889    6                     END;

   5889   1 000640  8DC7 001C                            CMN      FPT+2,AUTO
          1 000642  0901 0005                            BE       s:5890,PREL
          1 000644  E847 001A                            LDR,R6   FPT,AUTO
          1 000646  6981 FF05                            BNEZ,R6  s:5835,PREL

      638     5890    5                  IF FPT(0)~=0 THEN CALL KVV$CALUSR(FPT);

   5890   1 000648  E847 001A                            LDR,R6   FPT,AUTO
          1 00064A  6901 000D                            BEZ,R6   s:5891,PREL

   5890   1 00064C  EBC7 001A                            LAB,B6   FPT,AUTO
          1 00064E  EFC7 0028                            STB,B6   J+3,AUTO
          1 000650  BBC7 0028                            LAB,B3   J+3,AUTO
          1 000652  CBF0 0100                            LAB,B4   256,IMO
          1 000654  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000657       0001                            DC       s:5891,PREL

      639     5891    5                  VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+1;

   5891   1 000658  8AC7 0009                            INC      VDH_OTPLCL+3,AUTO

      640     5892    5                  VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-1;

   5892   1 00065A  88C7 000A                            DEC      VDH_OTPLCL+4,AUTO

      641     5893    5                  END; /* IF EXTTRN                                              */

      642     5894    4               END; /* IF I~=CHRCNT                                              */

      643     5895    3            END; /* DO WHILE VDH_OTPLCL.BYTSIZ                                   */

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:91   
   5895   1 00065C  E847 000A                            LDR,R6   VDH_OTPLCL+4,AUTO
          1 00065E  6981 F9F1                            BNEZ,R6  s:5441,PREL

      644     5896    2         END; /* IF NOT TRN                                                      */

   5896   1 000660  0F81 00ED                            B        s:5945,PREL

      645     5897        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:92   
      646     5898    2      ELSE DO;

      647     5899                    /*
      648     5900                    * TRANSPARENT OUTPUT - JUST LOOK FOR OTPESCCHRS AND SEND THE SUBSTITUTE
      649     5901                    */
      650     5902    2         IF %KV_VDI.OTPCNDPND.PST~=0 THEN CALL KVV$CALUSR_PST;

   5902   1 000662  D843 001A                            LDR,R5   26,B3
          1 000664  5901 0007                            BEZ,R5   s:5903,PREL

   5902   1 000666  CBF0 0000                            LAB,B4   0,IMO
          1 000668  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 00066B       0001                            DC       s:5903,PREL

      651     5903    3         DO WHILE VDH_OTPLCL.BFR_.BYTSIZ~=0;

   5903   1 00066C  E847 000A                            LDR,R6   VDH_OTPLCL+4,AUTO
          1 00066E  6901 00DF                            BEZ,R6   s:5945,PREL

      652     5904                    /*
      653     5905                    * DETERMINE HOW MUCH SPACE IS LEFT IN THE RDH OUTPUT BUFFER
      654     5906                    */
      655     5907    4            IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN DO;

   5907   1 000670  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 000672  E846 000D                            LDR,R6   13,B6
          1 000674  6981 001F                            BNEZ,R6  s:5917,PREL

      656     5908                    /*
      657     5909                    * IF THE BUFFER IS EMPTY, CALL THE RDH TO GET MORE SPACE AND
      658     5910                    * SEE HOW MUCH WE GET.
      659     5911                    */
      660     5912    4               %KV_USR_GETOTPBFR=KV_USR_GETOTPBFR;

   5912   1 000676  8C80 0000 0000  xsym                 LDI      KV_USR_GETOTPBFR
          1 000679  8D47 001A                            SDI      FPT,AUTO

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:93   
      661     5913    4               %KV_USR_GETOTPBFR.ESTBYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ;

   5913   1 00067B  D847 000A                            LDR,R5   VDH_OTPLCL+4,AUTO
          1 00067D  DF47 001B                            STR,R5   FPT+1,AUTO

      662     5914    4               CALL KVV$CALUSR(FPT);

   5914   1 00067F  DBC7 001A                            LAB,B5   FPT,AUTO
          1 000681  DFC7 0028                            STB,B5   J+3,AUTO
          1 000683  BBC7 0028                            LAB,B3   J+3,AUTO
          1 000685  CBF0 0100                            LAB,B4   256,IMO
          1 000687  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 00068A       0001                            DC       s:5915,PREL

      663     5915    4               IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN RETURN;

   5915   1 00068B  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 00068D  E846 000D                            LDR,R6   13,B6
          1 00068F  6981 0004                            BNEZ,R6  s:5917,PREL

   5915   1 000691  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      664     5916    4               END;
      665     5917    3            CHRCNT=MINIMUM(VDH_OTPLCL.BFR_.BYTSIZ, %KV_VDI.OTPBFR_.BYTSIZ, 255);

   5917   1 000694  D870 00FF                            LDR,R5   255,IMO
          1 000696  D956                                 CMR,R5   R6
          1 000697  0381 0002                            BLE      s:5917+6,PREL
          1 000699  D856                                 LDR,R5   R6
          1 00069A  D947 000A                            CMR,R5   VDH_OTPLCL+4,AUTO
          1 00069C  0381 0003                            BLE      s:5917+12,PREL
          1 00069E  D847 000A                            LDR,R5   VDH_OTPLCL+4,AUTO
          1 0006A0  DF47 0014                            STR,R5   CHRCNT,AUTO

      666     5918        /*N* When PL6 can compile without next line, remove it. */
      667     5919    3            IF CHRCNT=0 THEN CALL KVV$CALUSR_PST;

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:94   
   5919   1 0006A2  5981 0007                            BNEZ,R5  s:5920,PREL

   5919   1 0006A4  CBF0 0000                            LAB,B4   0,IMO
          1 0006A6  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 0006A9       0001                            DC       s:5920,PREL

      668     5920    3            %OTPBFR=%INPBFR;

   5920   1 0006AA  ECC7 000F                            LDB,B6   VDI$,AUTO
          1 0006AC  DCC6 000A                            LDB,B5   10,B6
          1 0006AE  E846 000C                            LDR,R6   12,B6
          1 0006B0  D847 0014                            LDR,R5   CHRCNT,AUTO
          1 0006B2  D570 00FF                            AND,R5   255,IMO
          1 0006B4  ACC7 0007                            LDB,B2   VDH_OTPLCL+1,AUTO
          1 0006B6  A847 0009                            LDR,R2   VDH_OTPLCL+3,AUTO
          1 0006B8  EF47 0028                            STR,R6   J+3,AUTO
          1 0006BA  E855                                 LDR,R6   R5
          1 0006BB  BB85                                 LAB,B3   ,B5
          1 0006BC  B847 0028                            LDR,R3   J+3,AUTO
          1 0006BE  0008                                 MMM

      669     5921    3            IF NOT KV$TRNTBL.OTPESC.NONE

   5921   1 0006BF  ECC7 000D                            LDB,B6   TRNTBL$,AUTO
          1 0006C1  E2C6 001B                            LLH,R6   27,B6
          1 0006C3  6008                                 SOL,R6   8
          1 0006C4  6981 0022                            BNEZ,R6  s:5923,PREL

      670     5922    3            THEN CALL INDEX(I, KV$TRNTBL.OTPESC.CHR, %OTPBFR);

   5922   1 0006C6  DCC7 000F                            LDB,B5   VDI$,AUTO
          1 0006C8  CCC5 000A                            LDB,B4   10,B5
          1 0006CA  C845 000C                            LDR,R4   12,B5
          1 0006CC  B847 0014                            LDR,R3   CHRCNT,AUTO
          1 0006CE  B570 00FF                            AND,R3   255,IMO
          1 0006D0  A854                                 LDR,R2   R4
          1 0006D1  E853                                 LDR,R6   R3
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:95   
          1 0006D2  EA70 0100                            ADD,R6   256,IMO
          1 0006D4  0028                                 SRH      ;
          1 0006D5       C106 001B                                ALPHANUM(27,B6,1,1),;
          1 0006D7       4407 0028                                BINARY(J+3,AUTO,,4),;
          1 0006D9       4024 0000                                ALPHANUM(0,B4,R2,,R6)
          1 0006DB  5381 0005                            CBE      s:5922+27,PREL
          1 0006DD  BF47 0024                            STR,R3   I,AUTO
          1 0006DF  0F81 0005                            B        s:5922+31,PREL
          1 0006E1  9847 0029                            LDR,R1   J+4,AUTO
          1 0006E3  9F47 0024                            STR,R1   I,AUTO
          1 0006E5  0F81 0005                            B        s:5924,PREL

      671     5923    3            ELSE I=CHRCNT;

   5923   1 0006E7  C847 0014                            LDR,R4   CHRCNT,AUTO
          1 0006E9  CF47 0024                            STR,R4   I,AUTO

      672     5924    3            %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+I;

   5924   1 0006EB  DCC7 000F                            LDB,B5   VDI$,AUTO
          1 0006ED  E845 000C                            LDR,R6   12,B5
          1 0006EF  EA47 0024                            ADD,R6   I,AUTO
          1 0006F1  EF45 000C                            STR,R6   12,B5

      673     5925    3            %KV_VDI.OTPBFR_.BYTSIZ=%KV_VDI.OTPBFR_.BYTSIZ-I;

   5925   1 0006F3  C845 000D                            LDR,R4   13,B5
          1 0006F5  C247 0024                            SUB,R4   I,AUTO
          1 0006F7  CF45 000D                            STR,R4   13,B5

      674     5926    3            IF I~=CHRCNT THEN IF %KV_VDI.OTPBFR_.BYTSIZ<2

   5926   1 0006F9  B847 0024                            LDR,R3   I,AUTO
          1 0006FB  B947 0014                            CMR,R3   CHRCNT,AUTO
          1 0006FD  0901 0024                            BE       s:5939,PREL

   5926   1 0006FF  4D02                                 CMV,R4   2
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:96   
          1 000700  0281 0005                            BGE      s:5929,PREL

      675     5927    3            THEN %KV_VDI.OTPBFR_.BYTSIZ = 0;

   5927   1 000702  8745 000D                            CL       13,B5
          1 000704  0F81 001D                            B        s:5939,PREL

      676     5928    4            ELSE DO;

      677     5929    4               %OTPCHR=KV$TRNTBL.OTPESCCHRBFR1;

   5929   1 000706  CCC5 000A                            LDB,B4   10,B5
          1 000708  A0C6 001C                            LDH,R2   28,B6
          1 00070A  9856                                 LDR,R1   R6
          1 00070B  A794                                 STH,R2   ,B4,R1

      678     5930    4               %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+1;

   5930   1 00070C  8AC5 000C                            INC      12,B5

      679     5931    4               %KV_VDI.OTPBFR_.BYTSIZ=%KV_VDI.OTPBFR_.BYTSIZ-1;

   5931   1 00070E  88C5 000D                            DEC      13,B5

      680     5932    5               IF KV$TRNTBL.OTPESCCHRBFR2~=BINASC(0) THEN DO;

   5932   1 000710  C846 001C                            LDR,R4   28,B6
          1 000712  4008                                 SOL,R4   8
          1 000713  4068                                 SAR,R4   8
          1 000714  4D00                                 CMV,R4   0
          1 000715  0901 000A                            BE       s:5937,PREL

      681     5933    5                  %OTPCHR=KV$TRNTBL.OTPESCCHRBFR2;

   5933   1 000717  CCC5 000A                            LDB,B4   10,B5
          1 000719  A845 000C                            LDR,R2   12,B5
          1 00071B  C7A4                                 STH,R4   ,B4,R2
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:97   

      682     5934    5                  %KV_VDI.OTPBFR_.BYTX=%KV_VDI.OTPBFR_.BYTX+1;

   5934   1 00071C  8AC5 000C                            INC      12,B5

      683     5935    5                  %KV_VDI.OTPBFR_.BYTSIZ=%KV_VDI.OTPBFR_.BYTSIZ-1;

   5935   1 00071E  88C5 000D                            DEC      13,B5

      684     5936    5                  END;

      685     5937    4               I=I+1;

   5937   1 000720  8AC7 0024                            INC      I,AUTO

      686     5938    4               END;

      687     5939    3            %KV_STT.OTPCHRCNT=%KV_STT.OTPCHRCNT+I;

   5939   1 000722  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 000725  BC84                                 LDB,B3   ,B4
          1 000726  ACC3 0008                            LDB,B2   8,B3
          1 000728  9CC2 0033                            LDB,B1   51,B2
          1 00072A  F847 0024                            LDR,R7   I,AUTO
          1 00072C  6C00                                 LDV,R6   0
          1 00072D  8441 0034                            AID      52,B1
          1 00072F  8D41 0034                            SDI      52,B1

      688     5940    3            %KV_SSN.OTPCHRCNT=%KV_SSN.OTPCHRCNT+I;

   5940   1 000731  BCC4 0002                            LDB,B3   2,B4
          1 000733  F847 0024                            LDR,R7   I,AUTO
          1 000735  6C00                                 LDV,R6   0
          1 000736  8443 0018                            AID      24,B3
          1 000738  8D43 0018                            SDI      24,B3

      689     5941    3            %KV_VDI.TMPOTPCHRCNT=%KV_VDI.TMPOTPCHRCNT+I;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:98   

   5941   1 00073A  E845 0015                            LDR,R6   21,B5
          1 00073C  EA47 0024                            ADD,R6   I,AUTO
          1 00073E  EF45 0015                            STR,R6   21,B5

      690     5942    3            VDH_OTPLCL.BFR_.BYTX=VDH_OTPLCL.BFR_.BYTX+I;

   5942   1 000740  C847 0009                            LDR,R4   VDH_OTPLCL+3,AUTO
          1 000742  CA47 0024                            ADD,R4   I,AUTO
          1 000744  CF47 0009                            STR,R4   VDH_OTPLCL+3,AUTO

      691     5943    3            VDH_OTPLCL.BFR_.BYTSIZ=VDH_OTPLCL.BFR_.BYTSIZ-I;

   5943   1 000746  B847 000A                            LDR,R3   VDH_OTPLCL+4,AUTO
          1 000748  B247 0024                            SUB,R3   I,AUTO
          1 00074A  BF47 000A                            STR,R3   VDH_OTPLCL+4,AUTO

      692     5944    3            END;

   5944   1 00074C  3981 FF23                            BNEZ,R3  s:5907,PREL

      693     5945    2         END;

      694     5946    1   GOBACK: RETURN;

   5946   1 00074E  C380 0000 0000  xent GOBACK          LNJ,B4   X6A_ARET

      695     5947        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:99   
      696     5948        /*I* NAME: Y$WRAP.
      697     5949             DESCRIPTION: Wraps the line if that is permitted. Otherwise ALTRERTs
      698     5950             after adjusting the callers FPT if so requested.
      699     5951        */
      700     5952    1   Y$WRAP: PROC ALTRET;

   5952   1 000751  EFC7 0026            Y$WRAP          STB,B6   J+1,AUTO

      701     5953
      702     5954    3      IF VDH_OTPLCL.NO_WRAP THEN DO;

   5954   1 000753  82C7 0006                            LB,'0010'X        VDH_OTPLCL,AUTO
   5954   1 000755       0010
          1 000756  0581 0025                            BBF      s:5962,PREL

      703     5955    3         IF %KV_SRD.CRT.LIN<%KV_SRD.FLDEND.LIN AND NOT %KV_MVD.HRZSCR THEN EXIT;

   5955   1 000758  DCC7 0011                            LDB,B5   SRD$,AUTO
          1 00075A  E845 0015                            LDR,R6   21,B5
          1 00075C  E945 0010                            CMR,R6   16,B5
          1 00075E  0881 000B                            BAGE     s:5956,PREL
          1 000760  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 000763  BCC4 0006                            LDB,B3   6,B4
          1 000765  82C3 0016                            LB,'0004'X        22,B3
          1 000767       0004
          1 000768  0581 0013                            BBF      s:5962,PREL

      704     5956    4         IF CHRCNT<=0 THEN DO;

   5956   1 00076A  D847 0014                            LDR,R5   CHRCNT,AUTO
          1 00076C  5981 000B                            BNEZ,R5  s:5960,PREL

      705     5957    4            KV$VDH_OTPLCL.BFR_.BYTX = VDH_OTPLCL.BFR_.BYTX;

   5957   1 00076E  CCC7 0004                            LDB,B4   @KV$VDH_OTPLCL,AUTO
          1 000770  C847 0009                            LDR,R4   VDH_OTPLCL+3,AUTO
          1 000772  CF44 0003                            STR,R4   3,B4
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:100  

      706     5958    4            KV$VDH_OTPLCL.BFR_.BYTSIZ = VDH_OTPLCL.BFR_.BYTSIZ;

   5958   1 000774  E847 000A                            LDR,R6   VDH_OTPLCL+4,AUTO
          1 000776  EF44 0004                            STR,R6   4,B4

      707     5959    4            END;

      708     5960    3         ALTRETURN;

   5960   1 000778  ECC7 0026                            LDB,B6   J+1,AUTO
          1 00077A  B806                                 LDR,R3   ,B6
          1 00077B  C3B6                                 LNJ,B4   ,B6,R3

      709     5961    3         END;
      710     5962    2      IF VDH_OTPLCL.NONVRT AND %KV_MVD.ORG>=%KV#VD_ORG_X364 THEN ALTRETURN;

   5962   1 00077C  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
   5962   1 00077E       0080
          1 00077F  0581 000F                            BBF      s:5963,PREL
          1 000781  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000784  CCC5 0006                            LDB,B4   6,B5
          1 000786  E2C4 0015                            LLH,R6   21,B4
          1 000788  6D02                                 CMV,R6   2
          1 000789  0201 0005                            BL       s:5963,PREL

   5962   1 00078B  ECC7 0026                            LDB,B6   J+1,AUTO
          1 00078D  B806                                 LDR,R3   ,B6
          1 00078E  C3B6                                 LNJ,B4   ,B6,R3

      711     5963    2      CALL KVO$PST (KV_VDH_PST_WRAP);

   5963   1 00078F  BB80 0000 0008  02                   LAB,B3   +8
          1 000792  CBF0 0100                            LAB,B4   256,IMO
          1 000794  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000797       0001                            DC       s:5964,PREL

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:101  
      712     5964    2      IF NOT VDH_OTPLCL.NONVRT THEN %KV_SRD.VRTPSTOK = '1'B;

   5964   1 000798  82C7 0006                            LB,'0080'X        VDH_OTPLCL,AUTO
   5964   1 00079A       0080
          1 00079B  0501 0006                            BBT      s:5965,PREL

   5964   1 00079D  ECC7 0011                            LDB,B6   SRD$,AUTO
          1 00079F  8946 000E                            LBT,'0010'X       14,B6
          1 0007A1       0010

      713     5965    2      RETURN;

   5965   1 0007A2  ECC7 0026                            LDB,B6   J+1,AUTO
          1 0007A4  C3C6 0001                            LNJ,B4   1,B6

      714     5966    2   END Y$WRAP;
      715     5967        %EJECT;
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:102  
      716     5968    1   KVO$OTP1_VRT: ENTRY(KV$VDH_OTPLCL);

   5968   1 0007A6  D380 0000 0000  xent KVO$OTP1_VRT    LNJ,B5   X6A_AUTO_1
          1 0007A9       002C 0001                       DC       44,1

      717     5969                    /*F*   NAME: KVO$OTP1_VRT
      718     5970                    *      PURPOSE: puts a single character on the output stream.
      719     5971                    *      DESCRIPTION: The parameter is the character. It may be left-
      720     5972                    *                   or right-adjusted in a word. If right, the left
      721     5973                    *                   byte must be zero. (Zero must be right adjusted).
      722     5974                    *      ENTRY: KVO$OTP1_NONVRT  (for non-virtual output).
      723     5975                    *      ENTRY: KVO$OTP1_HDN  (for simulated-hidden virtual).
      724     5976                    */
      725     5977    1      VDH_OTPLCL.NONVRT='0'B;

   5977   1 0007AB  8847 0006                            LBF,'0080'X       VDH_OTPLCL,AUTO
   5977   1 0007AD       0080

      726     5978    1      VDH_OTPLCL.HDN='0'B;

   5978   1 0007AE  8847 0006                            LBF,'0020'X       VDH_OTPLCL,AUTO
   5978   1 0007B0       0020

      727     5979    1      GOTO WRT1_CHR;

   5979   1 0007B1  0F81 0019                            B        s:5986,PREL

      728     5980    1   KVO$OTP1_NONVRT: ENTRY(KV$VDH_OTPLCL);

   5980   1 0007B3  D380 0000 0000  xent KVO$OTP1_NONVRT LNJ,B5   X6A_AUTO_1
          1 0007B6       002C 0001                       DC       44,1

      729     5981    1      VDH_OTPLCL.NONVRT='1'B;

   5981   1 0007B8  8947 0006                            LBT,'0080'X       VDH_OTPLCL,AUTO
   5981   1 0007BA       0080

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:103  
      730     5982    1      VDH_OTPLCL.HDN='0'B;

   5982   1 0007BB  8847 0006                            LBF,'0020'X       VDH_OTPLCL,AUTO
   5982   1 0007BD       0020

      731     5983    1      GOTO WRT1_CHR;

   5983   1 0007BE  0F81 000C                            B        s:5986,PREL

      732     5984    1   KVO$OTP1_HDN: ENTRY(KV$VDH_OTPLCL);

   5984   1 0007C0  D380 0000 0000  xent KVO$OTP1_HDN    LNJ,B5   X6A_AUTO_1
          1 0007C3       002C 0001                       DC       44,1

      733     5985    1      VDH_OTPLCL.NONVRT='0'B;

   5985   1 0007C5  8847 0006                            LBF,'0080'X       VDH_OTPLCL,AUTO
   5985   1 0007C7       0080

      734     5986    1      VDH_OTPLCL.HDN='1'B;

   5986   1 0007C8  8947 0006                            LBT,'0020'X       VDH_OTPLCL,AUTO
   5986   1 0007CA       0020

   5986   1                              WRT1_CHR        null
      735     5987    1   WRT1_CHR:;
      736     5988    1      VDH_OTPLCL.TRN='0'B;

   5988   1 0007CB  8847 0006            WRT1_CHR        LBF,'0040'X       VDH_OTPLCL,AUTO
   5988   1 0007CD       0040

      737     5989    1      VDH_OTPLCL.NO_WRAP='0'B;

   5989   1 0007CE  8847 0006                            LBF,'0010'X       VDH_OTPLCL,AUTO
   5989   1 0007D0       0010

      738     5990    1      VDH_OTPLCL.BFR_.ADR$=ADDR(KV$VDH_OTPLCL);
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:104  

   5990   1 0007D1  ECC7 0004                            LDB,B6   @KV$VDH_OTPLCL,AUTO
          1 0007D3  EFC7 0007                            STB,B6   VDH_OTPLCL+1,AUTO

      739     5991    1      VDH_OTPLCL.BFR_.BYTSIZ=1;

   5991   1 0007D5  6C01                                 LDV,R6   1
          1 0007D6  EF47 000A                            STR,R6   VDH_OTPLCL+4,AUTO

      740     5992    1      VDH_OTPLCL.BFR_.BYTX=0;

   5992   1 0007D8  8747 0009                            CL       VDH_OTPLCL+3,AUTO

      741     5993    1      IF %INPCHR=BINASC(0) THEN VDH_OTPLCL.BFR_.BYTX=1;

   5993   1 0007DA  B847 0009                            LDR,R3   VDH_OTPLCL+3,AUTO
          1 0007DC  D0B6                                 LDH,R5   ,B6,R3
          1 0007DD  5D00                                 CMV,R5   0
          1 0007DE  0981 0004                            BNE      s:5994,PREL

   5993   1 0007E0  3C01                                 LDV,R3   1
          1 0007E1  BF47 0009                            STR,R3   VDH_OTPLCL+3,AUTO

      742     5994    1      GOTO THE_BEGINNING;

   5994   1 0007E3  0F81 F828                            B        s:5408,PREL
      743     5995    1   END KVO$OTPLCL;

PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:105  
--  Include file information  --

   K_ID_E.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVO$OTPLCL.
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:106  

 **** Variables and constants ****

  ****  Section 000 RoData KVO$OTPLCL

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(32)    r     1 BLANKS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KV$VDH_OTPLCL            19-0-0/b BIT         r     1 AUTONL
     B-0-0/w PTR         r     1 B4                        14-0-0/w STRC(16)    r     1 CHR
    14-0-0/w UBIN(16)    r     1 CHRCNT                    14-0-0/w SBIN(16)    r     1 CHRCNTS
    13-0-0/w UBIN(16)    r     1 ENDCLM                    13-0-0/w SBIN(16)    r     1 ENDCLM_S
    1A-0-0/w UBIN(16)    r     1 FPT(0:9)                  24-0-0/w UBIN(16)    r     1 I
    24-0-0/w SBIN(16)    r     1 IS                        25-0-0/w UBIN(16)    r     1 J
    25-0-0/w SBIN(16)    r     1 JS                        *0-0-0/w STRC(80)    r     1 KV$VDH_OTPLCL
    15-0-0/c CHAR        r     1 ORGCHR                    17-0-0/c CHAR        r     1 OTPESCCHR
    11-0-0/w PTR         r     1 SRD$                       D-0-0/w PTR         r     1 TRNTBL$
    18-0-0/b BIT         r     1 TRUNC                      6-0-0/w STRC(80)    r     1 VDH_OTPLCL
     F-0-0/w PTR         r     1 VDI$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(32)    r     1 KV_USR_GETOTPBFR
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_0_VRT           0-0-0/w UBIN(16)    r     1 KV_VDH_PST_LF
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_LF_VRT          0-0-0/w UBIN(16)    r     1 KV_VDH_PST_VRT
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_WRAP

  ****  BASED and DCB variables  ****
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:107  

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 BITS                       0-0-0/c CHAR(255)   r     1 CHARS
     0-0-0/w STRC(72)    r     1 KV$EXTOTPTRN               0-0-0/w STRC(512)   r     1 KV$MRD
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w ASTR(8)     r     1 KV$SCNOTPTRN               0-0-0/w STRC(64)    r     1 KV$SHRBFR
     0-0-0/c UBIN(8)     r     1 KV$SHRBFR_BYT(0:0)
     0-0-0/w STRC(496)   r     1 KV$SRD                     0-0-0/w STRC(1024)  r     1 KV$SSN
     0-0-0/w STRC(512)   r     1 KV$STR                     0-0-0/w STRC(8960)  r     1 KV$STT
     0-0-0/w STRC(499)   r     1 KV$TRNTBL                  0-0-0/w STRC(912)   r     1 KV$USRPRM
     0-0-0/w STRC(64)    r     1 KV$USR_EXTOTPTRN           0-0-0/w STRC(32)    r     1 KV$USR_GETOTPBFR
     0-0-0/w STRC(512)   r     1 KV$VDI                     0-0-0/w STRC(80)    r     1 Y@VDH_OTPLCL


   Procedure KVO$OTPLCL requires 2021 words for executable code.
   Procedure KVO$OTPLCL requires 44 words of local(AUTO) storage.

    No errors detected in file KVO$OTPLCL.:E05TSI    .
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:108  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:109  
          MINI XREF LISTING

AUTONL
      5378**DCL      5448<<ASSIGN   5450<<ASSIGN   5785>>IF
B4
      5333**DCL      3784--IMP-PTR  5595<<ASSIGN   5596>>CALLBLT  5596>>CALLBLT  5597>>ASSIGN   5598>>ASSIGN
      5599>>IF       5599>>IF       5605>>IF       5605>>IF       5611>>IF       5611>>IF       5616>>IF
      5617<<ASSIGN   5698<<ASSIGN   5699>>IF       5700>>DOINDEX  5708>>IF       5713>>ASSIGN
BITS.ARY
      5319**DCL      5599>>IF       5605>>IF       5611>>IF
BLANKS
      5747**LABEL    5474>>CALLBLT  5594--GOTO     5596--CALLALT
CHARS
      5320**DCL      5474>>CALLBLT  5505<<CALLBLT  5505>>CALLBLT  5505>>CALLBLT  5507>>CALLBLT  5538>>DOWHILE
      5551<<ASSIGN   5593>>ASSIGN   5602<<ASSIGN   5625>>DOWHILE  5728<<ASSIGN   5758>>IF       5843<<ASSIGN
      5848>>IF       5851<<ASSIGN   5859<<ASSIGN   5876--ASSIGN   5882<<ASSIGN   5920<<ASSIGN   5920>>ASSIGN
      5922>>CALLBLT  5929<<ASSIGN   5933<<ASSIGN   5993>>IF
CHR.CNT
      5357**DCL      5474>>CALLBLT  5505>>CALLBLT  5505>>CALLBLT  5507>>CALLBLT  5920>>ASSIGN   5920>>ASSIGN
      5922>>CALLBLT
CHRCNT
      5354**DCL      5355--REDEF    5356--REDEF    5441<<ASSIGN   5447<<ASSIGN   5447>>ASSIGN   5453<<ASSIGN
      5462<<ASSIGN   5470<<ASSIGN   5470>>ASSIGN   5471>>ASSIGN   5473>>IF       5474<<CALLBLT  5477>>IF
      5477<<ASSIGN   5479>>IF       5501>>IF       5502<<ASSIGN   5503>>IF       5503>>ASSIGN   5507<<CALLBLT
      5516>>ASSIGN   5528>>IF       5529>>ASSIGN   5536>>ASSIGN   5542>>ASSIGN   5547>>DOINDEX  5558>>ASSIGN
      5559>>ASSIGN   5560>>ASSIGN   5561>>ASSIGN   5562>>ASSIGN   5579>>ASSIGN   5583>>ASSIGN   5584>>ASSIGN
      5591>>IF       5603<<ASSIGN   5729<<ASSIGN   5754<<ASSIGN   5755>>ASSIGN   5756>>ASSIGN   5761<<ASSIGN
      5761>>ASSIGN   5769>>ASSIGN   5780<<ASSIGN   5780>>ASSIGN   5802<<ASSIGN   5802>>ASSIGN   5818>>ASSIGN
      5884<<ASSIGN   5917<<ASSIGN   5919>>IF       5923>>ASSIGN   5926>>IF       5956>>IF
CHRCNTS
      5355**DCL      5451>>IF
ENDCLM
      5349**DCL      5350--REDEF    5415<<ASSIGN   5416<<ASSIGN   5441>>ASSIGN   5442>>IF       5770>>ASSIGN
      5773>>ASSIGN
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:110  
ENDCLM_S
      5350**DCL      5563>>IF
EXTOTPLCL
      5859**LABEL    5854--GOTO
FPT
      5387**DCL      5496--ASSIGN   5497--ASSIGN   5498<>CALL     5826--ASSIGN   5827--ASSIGN   5828--ASSIGN
      5829--ASSIGN   5831--ASSIGN   5832--ASSIGN   5833--DOWHILE  5833>>DOWHILE  5835--IF       5835--IF
      5836--ASSIGN   5836--ASSIGN   5836--ASSIGN   5837--ASSIGN   5837--ASSIGN   5839--IF       5839--IF
      5839--IF       5841--IF       5842--ASSIGN   5843--ASSIGN   5843--ASSIGN   5844--ASSIGN   5844--ASSIGN
      5845--ASSIGN   5848--IF       5851--ASSIGN   5851--ASSIGN   5856--IF       5856--IF       5857--ASSIGN
      5858--ASSIGN   5859--ASSIGN   5859--ASSIGN   5859--ASSIGN   5862--IF       5862--IF       5862--IF
      5864--ASSIGN   5876--ASSIGN   5876--ASSIGN   5877--ASSIGN   5878<>CALL     5879<<ASSIGN   5882--ASSIGN
      5882--ASSIGN   5886--IF       5890>>IF       5890<>CALL     5912--ASSIGN   5913--ASSIGN   5914<>CALL
GOBACK
      5946**LABEL    5454--GOTO     5460--GOTO
I
      5388**DCL      5389--REDEF    5471<<ASSIGN   5477>>IF       5477>>ASSIGN   5503>>IF       5503<<ASSIGN
      5569<<ASSIGN   5571<<ASSIGN   5571>>ASSIGN   5579<<ASSIGN   5591>>IF       5596<<CALLBLT  5597>>ASSIGN
      5599>>IF       5601<<ASSIGN   5700<<DOINDEX  5730<<ASSIGN   5790<<ASSIGN   5797<<ASSIGN   5799<<ASSIGN
      5799>>ASSIGN   5800>>ASSIGN   5801>>ASSIGN   5802>>ASSIGN   5803<<ASSIGN   5805>>ASSIGN   5806<<ASSIGN
      5806>>ASSIGN   5883<<ASSIGN   5922<<CALLBLT  5923<<ASSIGN   5924>>ASSIGN   5925>>ASSIGN   5926>>IF
      5937<<ASSIGN   5937>>ASSIGN   5939>>ASSIGN   5940>>ASSIGN   5941>>ASSIGN   5942>>ASSIGN   5943>>ASSIGN
IS
      5389**DCL      5572>>IF       5708>>IF       5713>>ASSIGN   5770<<ASSIGN   5771>>IF       5782>>DOWHILE
      5785>>IF       5844<<ASSIGN   5850<<ASSIGN   5850>>ASSIGN   5851>>ASSIGN
J
      5390**DCL      5391--REDEF    5547<<DOINDEX  5597<<ASSIGN   5696<<ASSIGN   5697>>ASSIGN   5708>>IF
JS
      5391**DCL      5536<<ASSIGN   5538>>DOWHILE  5539<<ASSIGN   5539>>ASSIGN   5541>>IF       5542<<ASSIGN
      5542>>ASSIGN   5544>>ASSIGN   5598>>ASSIGN   5605>>IF       5611>>IF       5783<<ASSIGN   5785>>IF
      5785>>IF       5842<<ASSIGN   5843>>ASSIGN   5843>>ASSIGN   5844>>ASSIGN   5845>>ASSIGN   5846>>DOWHILE
      5847<<ASSIGN   5847>>ASSIGN   5848>>IF       5851>>ASSIGN   5857<<ASSIGN   5858>>ASSIGN   5859>>ASSIGN
      5859>>ASSIGN   5859>>ASSIGN
KV$EXTOTPTRN.CNT
      3752**DCL      5835>>IF       5836>>ASSIGN
KV$EXTOTPTRN.LNK$
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:111  
      3752**DCL      5837>>ASSIGN
KV$EXTOTPTRN.TMPLATSIZ
      3755**DCL      5839>>IF       5841>>IF       5842>>ASSIGN
KV$EXTOTPTRN.TRN
      3752**DCL      5856>>IF       5862>>IF
KV$EXTOTPTRN.TXT
      3757**DCL      5843>>ASSIGN   5851>>ASSIGN   5859>>ASSIGN   5882>>ASSIGN
KV$EXTOTPTRN.TXTSIZ
      3752**DCL      5839>>IF       5839>>IF       5844>>ASSIGN   5856>>IF       5857>>ASSIGN
KV$EXTOTPTRN.WDT
      3753**DCL      5862>>IF       5886>>IF
KV$MRD.AUTONL
      3644**DCL      5442>>IF
KV$MRD.DEVSCROLL
      3645**DCL      5442>>IF
KV$MRD.DVCCLM
      3658**DCL      5529<<ASSIGN   5529>>ASSIGN   5530>>ASSIGN   5865<<ASSIGN   5865>>ASSIGN   5866>>ASSIGN
KV$MRD.LNG
      3640**DCL      5442>>IF
KV$MRD.MINSP_FORPST
      3638**DCL      5473>>IF       5474>>CALLBLT  5754>>ASSIGN
KV$MRD.USRCNT
      3637**DCL      5442>>IF
KV$MRD.WDT
      3637**DCL      5442>>IF
KV$MVD.HRZSCR
      3693**DCL      5955>>IF
KV$MVD.ORG
      3689**DCL      5962>>IF
KV$MVD.RETYPOVR
      3692**DCL      5563>>IF       5785>>IF
KV$MVD.TABSIM
      3691**DCL      5718>>IF
KV$MVD.TRNTBL$
      3686**DCL      5411>>ASSIGN
KV$MVD.VRTCLM
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:112  
      3701**DCL      5516<<ASSIGN   5516>>ASSIGN   5631>>IF       5636<<ASSIGN   5636>>ASSIGN   5649>>IF
      5654>>ASSIGN   5686<<ASSIGN   5696>>ASSIGN   5697<<ASSIGN   5713<<ASSIGN   5818<<ASSIGN   5818>>ASSIGN
      5869<<ASSIGN   5869>>ASSIGN
KV$PTR.INPCNDPND
      3813**DCL      3822--REDEF    3826--REDEF
KV$PTR.LINLST$
      3809**DCL      3810--REDEF
KV$PTR.MVD$
      3808**DCL      5411>>ASSIGN   5516>>ASSIGN   5516>>ASSIGN   5563>>IF       5631>>IF       5636>>ASSIGN
      5636>>ASSIGN   5649>>IF       5654>>ASSIGN   5686>>ASSIGN   5696>>ASSIGN   5697>>ASSIGN   5713>>ASSIGN
      5718>>IF       5785>>IF       5818>>ASSIGN   5818>>ASSIGN   5869>>ASSIGN   5869>>ASSIGN   5955>>IF
      5962>>IF
KV$PTR.SRD$
      3809**DCL      5413>>ASSIGN
KV$PTR.SSN$
      3807**DCL      5525>>IF       5526>>ASSIGN   5560>>ASSIGN   5560>>ASSIGN   5872>>IF       5873>>ASSIGN
      5940>>ASSIGN   5940>>ASSIGN
KV$PTR.STR$
      3807**DCL      5698>>ASSIGN
KV$PTR.VDI$
      3807**DCL      5412>>ASSIGN   5561>>ASSIGN   5561>>ASSIGN   5939>>ASSIGN   5939>>ASSIGN
KV$PTR$
      3801**DCL      3807--IMP-PTR  5411>>ASSIGN   5412>>ASSIGN   5413>>ASSIGN   5516>>ASSIGN   5516>>ASSIGN
      5525>>IF       5526>>ASSIGN   5560>>ASSIGN   5560>>ASSIGN   5561>>ASSIGN   5561>>ASSIGN   5563>>IF
      5631>>IF       5636>>ASSIGN   5636>>ASSIGN   5649>>IF       5654>>ASSIGN   5686>>ASSIGN   5696>>ASSIGN
      5697>>ASSIGN   5698>>ASSIGN   5713>>ASSIGN   5718>>IF       5785>>IF       5818>>ASSIGN   5818>>ASSIGN
      5869>>ASSIGN   5869>>ASSIGN   5872>>IF       5873>>ASSIGN   5939>>ASSIGN   5939>>ASSIGN   5940>>ASSIGN
      5940>>ASSIGN   5955>>IF       5962>>IF
KV$SCNOTPTRN.CHR
      3784**DCL      5596>>CALLBLT
KV$SCNOTPTRN.CHRA
      3784**DCL      3784--REDEF    5598>>ASSIGN
KV$SCNOTPTRN.CNT
      3784**DCL      3784--IMP-SIZ  5596>>CALLBLT  5597>>ASSIGN   5599>>IF       5605>>IF       5611>>IF
KV$SHRBFR
      3846**DCL      5700--DOINDEX
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:113  
KV$SHRBFR.BYTSIZ
      3855**DCL      5700>>DOINDEX
KV$SHRBFR_BYT
      3861**DCL      5708>>IF       5713>>ASSIGN
KV$SRD.BRDEXS
      3990**DCL      5442>>IF
KV$SRD.BTMRHT
      3979**DCL      3984--REDEF
KV$SRD.BTMRHT.CLM
      3981**DCL      5416>>ASSIGN   5641>>ASSIGN   5803>>ASSIGN   5806>>ASSIGN
KV$SRD.BTMRHT.LIN
      3981**DCL      5569>>ASSIGN   5783>>ASSIGN
KV$SRD.CRT
      4055**DCL      4060--REDEF    5543>>ASSIGN
KV$SRD.CRT.CLM
      4057**DCL      5441>>ASSIGN   5530<<ASSIGN   5563>>IF       5637>>IF       5641<<ASSIGN   5648<<ASSIGN
      5648>>ASSIGN   5654<<ASSIGN   5661>>IF       5665<<ASSIGN   5665>>ASSIGN   5679<<ASSIGN   5769<<ASSIGN
      5769>>ASSIGN   5770>>ASSIGN   5773<<ASSIGN   5797>>ASSIGN   5805<<ASSIGN   5866<<ASSIGN
KV$SRD.CRT.LIN
      4057**DCL      5414>>IF       5442>>IF       5567>>IF       5567>>IF       5572>>IF       5642<<ASSIGN
      5642>>ASSIGN   5687<<ASSIGN   5783>>ASSIGN   5955>>IF
KV$SRD.CRTVRTLINPHSLIN
      4027**DCL      5687>>ASSIGN
KV$SRD.CRT_PST
      4060**DCL      5531>>IF       5867>>ASSIGN
KV$SRD.DVCLINBIS
      4097**DCL      5442>>IF       5569>>ASSIGN   5570>>IF       5783>>ASSIGN   5785>>IF
KV$SRD.FLDEND
      4019**DCL      4024--REDEF
KV$SRD.FLDEND.CLM
      4021**DCL      5414>>IF       5415>>ASSIGN
KV$SRD.FLDEND.LIN
      4021**DCL      5414>>IF       5567>>IF       5955>>IF
KV$SRD.HI_NONBLN
      4089**DCL      4094--REDEF    5543<<ASSIGN
KV$SRD.HI_NONBLN.CLM
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:114  
      4091**DCL      5544<<ASSIGN   5544>>ASSIGN
KV$SRD.HI_NONBLNVRT
      3989**DCL      5545<<ASSIGN
KV$SRD.HI_NONBLN_PST
      4094**DCL      5531>>IF       5867<<ASSIGN
KV$SRD.LNG
      3987**DCL      5454>>IF
KV$SRD.MRD$
      3883**DCL      5442>>IF       5442>>IF       5442>>IF       5442>>IF       5442>>IF       5473>>IF
      5474>>CALLBLT  5529>>ASSIGN   5529>>ASSIGN   5530>>ASSIGN   5754>>ASSIGN   5865>>ASSIGN   5865>>ASSIGN
      5866>>ASSIGN
KV$SRD.ORG
      3911**DCL      3916--REDEF
KV$SRD.PAGEHALT
      3988**DCL      5570>>IF       5785>>IF
KV$SRD.PRINTHALT
      3987**DCL      5570>>IF       5785>>IF
KV$SRD.SCROLL
      3988**DCL      5442>>IF
KV$SRD.SRDEND
      4124**DCL      4129--REDEF
KV$SRD.TOPLFT
      3945**DCL      3950--REDEF
KV$SRD.TOPLFT.CLM
      3947**DCL      5637>>IF       5661>>IF       5679>>ASSIGN   5799>>ASSIGN
KV$SRD.TRUNCATE
      3989**DCL      5455>>ASSIGN   5563>>IF       5772>>IF
KV$SRD.VRTPSTOK
      3988**DCL      5421>>IF       5524<<ASSIGN   5545>>ASSIGN   5819<<ASSIGN   5871<<ASSIGN   5964<<ASSIGN
KV$SRD.WDT
      3987**DCL      5454>>IF       5649>>IF       5797>>ASSIGN
KV$SSN.OTPCHRCNT
      4167**DCL      5560<<ASSIGN   5560>>ASSIGN   5940<<ASSIGN   5940>>ASSIGN
KV$SSN.REDBFR.EDTLOWX
      4181**DCL      5525>>IF       5526>>ASSIGN   5872>>IF       5873>>ASSIGN
KV$SSN.REDRSPCNT
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:115  
      4167**DCL      4168--REDEF
KV$STR.OTPTAB$
      4239**DCL      5698>>ASSIGN
KV$STT.OTPCHRCNT
      4686**DCL      5561<<ASSIGN   5561>>ASSIGN   5939<<ASSIGN   5939>>ASSIGN
KV$STT.REQSTATS.DSPMSK
      4577**DCL      4583--REDEF
KV$STT.REQSTATS.SLCMSK
      4618**DCL      4625--REDEF
KV$TRNTBL.EXTOTPTRN$
      4747**DCL      5832>>ASSIGN
KV$TRNTBL.HT_CHR
      4751**DCL      5728>>ASSIGN
KV$TRNTBL.OTPESC.CHR
      4750**DCL      5507>>CALLBLT  5848>>IF       5922>>CALLBLT
KV$TRNTBL.OTPESC.NONE
      4750**DCL      5506>>IF       5921>>IF
KV$TRNTBL.OTPESCCHR
      4749**DCL      4749--REDEF
KV$TRNTBL.OTPESCCHRBFR1
      4750**DCL      5929>>ASSIGN
KV$TRNTBL.OTPESCCHRBFR2
      4750**DCL      5932>>IF       5933>>ASSIGN
KV$TRNTBL.OTPTRN1$
      4746**DCL      5420>>IF       5505>>CALLBLT
KV$TRNTBL.OTPTRN2$
      4746**DCL      5594>>IF       5595>>ASSIGN   5616>>IF
KV$TRNTBL.OTPTRN3$
      4747**DCL      5617>>ASSIGN
KV$TRNTBL.SP_CHR
      4751**DCL      5551>>ASSIGN
KV$USRPRM.STT$
      4804**DCL      5561>>ASSIGN   5561>>ASSIGN   5939>>ASSIGN   5939>>ASSIGN
KV$USR_EXTOTPTRN.EXTTRN$
      4875**DCL      5832<<ASSIGN   5833>>DOWHILE  5835>>IF       5836>>ASSIGN   5837<<ASSIGN   5837>>ASSIGN
      5839>>IF       5839>>IF       5839>>IF       5841>>IF       5842>>ASSIGN   5843>>ASSIGN   5844>>ASSIGN
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:116  
      5851>>ASSIGN   5856>>IF       5856>>IF       5857>>ASSIGN   5859>>ASSIGN   5862>>IF       5862>>IF
      5882>>ASSIGN   5886>>IF
KV$USR_EXTOTPTRN.FNC
      4873**DCL      5826<<ASSIGN
KV$USR_EXTOTPTRN.ID
      4875**DCL      5828<<ASSIGN   5835>>IF       5836<<ASSIGN   5836>>ASSIGN   5844>>ASSIGN   5859>>ASSIGN
      5882>>ASSIGN
KV$USR_EXTOTPTRN.ORGCHR
      4875**DCL      5827<<ASSIGN
KV$USR_EXTOTPTRN.OTPLCLFLGS
      4875**DCL      5829<<ASSIGN   5829>>ASSIGN
KV$USR_GETOTPBFR
      4834**DCL      5496<<ASSIGN   5912<<ASSIGN
KV$USR_GETOTPBFR.ESTBYTSIZ
      4840**DCL      5497<<ASSIGN   5913<<ASSIGN
KV$USR_PST.PHSPST
      4938**DCL      4943--REDEF
KV$VDH_OTPLCL
      4984**DCL        10--PROC     5408>>ASSIGN   5968--ENTRY    5980--ENTRY    5984--ENTRY    5990--ASSIGN
KV$VDH_OTPLCL.BFR_.BYTSIZ
      5017**DCL      5958<<ASSIGN
KV$VDH_OTPLCL.BFR_.BYTX
      5017**DCL      5785>>IF       5957<<ASSIGN
KV$VDH_PST.PSTVAL
      5232**DCL      5237--REDEF
KV$VDI.OTPBFR_.ADR$
      5288**DCL      5505>>CALLBLT  5507>>CALLBLT  5551>>ASSIGN   5602>>ASSIGN   5728>>ASSIGN   5882>>ASSIGN
      5920>>ASSIGN   5922>>CALLBLT  5929>>ASSIGN   5933>>ASSIGN
KV$VDI.OTPBFR_.BYTSIZ
      5288**DCL      5491>>IF       5499>>IF       5501>>IF       5502>>ASSIGN   5559<<ASSIGN   5559>>ASSIGN
      5907>>IF       5915>>IF       5917>>ASSIGN   5925<<ASSIGN   5925>>ASSIGN   5926>>IF       5927<<ASSIGN
      5931<<ASSIGN   5931>>ASSIGN   5935<<ASSIGN   5935>>ASSIGN
KV$VDI.OTPBFR_.BYTX
      5288**DCL      5505>>CALLBLT  5507>>CALLBLT  5551>>ASSIGN   5552<<ASSIGN   5552>>ASSIGN   5558<<ASSIGN
      5558>>ASSIGN   5602>>ASSIGN   5728>>ASSIGN   5882>>ASSIGN   5920>>ASSIGN   5922>>CALLBLT  5924<<ASSIGN
      5924>>ASSIGN   5929>>ASSIGN   5930<<ASSIGN   5930>>ASSIGN   5933>>ASSIGN   5934<<ASSIGN   5934>>ASSIGN
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:117  
KV$VDI.OTPCNDPND.PST
      5299**DCL      5457>>IF       5457>>IF       5480>>IF       5581<<ASSIGN   5669<<ASSIGN   5680<<ASSIGN
      5766>>IF       5768<<ASSIGN   5810>>IF       5811<<ASSIGN   5902>>IF
KV$VDI.RE_DSPLOWX
      5293**DCL      5525>>IF       5526<<ASSIGN   5872>>IF       5873<<ASSIGN
KV$VDI.TMPOTPCHRCNT
      5293**DCL      5562<<ASSIGN   5562>>ASSIGN   5941<<ASSIGN   5941>>ASSIGN
KV$VDI.USRPRM$
      5263**DCL      5561>>ASSIGN   5561>>ASSIGN   5939>>ASSIGN   5939>>ASSIGN
KV$VDI.USRRQSDAT.RED
      5303**DCL      5563>>IF       5785>>IF
KVO$OTPLCL
        10**PROC     5878--CALL
KVO$PST
      5324**DCL-ENT  5429--CALL     5723--CALL     5744--CALL     5745--CALL     5963--CALL
KVV$CALUSR
      5325**DCL-ENT  5498--CALL     5890--CALL     5914--CALL
KVV$CALUSR_PST
      5326**DCL-ENT  5459--CALL     5487--CALL     5767--CALL     5902--CALL     5919--CALL
KV_USR_GETOTPBFR
      3606**DCL      5496>>ASSIGN   5912>>ASSIGN
KV_VDH_PST_0_VRT
      3574**DCL      5723<>CALL
KV_VDH_PST_LF
      3575**DCL      5744<>CALL
KV_VDH_PST_LF_VRT
      3576**DCL      5745<>CALL
KV_VDH_PST_VRT
      3577**DCL      5429<>CALL
KV_VDH_PST_WRAP
      3578**DCL      5963<>CALL
NRMTRNNO_PST
      5558**LABEL    5608--GOTO     5731--GOTO     5887--GOTO
NRMTRNPST
      5511**LABEL    5607--GOTO     5886--GOTO
NRMTRNTRUNC
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:118  
      5583**LABEL    5604--GOTO     5885--GOTO
NXTTBL
      5596**LABEL    5618--GOTO
ORGCHR
      5361**DCL      5593<<ASSIGN   5596>>CALLBLT  5625>>DOWHILE  5827>>ASSIGN
OTPESCCHR
      5369**DCL      5598<<ASSIGN   5602>>ASSIGN   5613>>DOCASE   5828>>ASSIGN
SRD$
      5345**DCL      3635--IMP-PTR  3883--IMP-PTR  5413<<ASSIGN   5414>>IF       5414>>IF       5414>>IF
      5415>>ASSIGN   5416>>ASSIGN   5421>>IF       5441>>ASSIGN   5442>>IF       5442>>IF       5442>>IF
      5442>>IF       5442>>IF       5442>>IF       5442>>IF       5442>>IF       5442>>IF       5454>>IF
      5454>>IF       5455>>ASSIGN   5473>>IF       5474>>CALLBLT  5524>>ASSIGN   5529>>ASSIGN   5529>>ASSIGN
      5530>>ASSIGN   5530>>ASSIGN   5531>>IF       5531>>IF       5543>>ASSIGN   5543>>ASSIGN   5544>>ASSIGN
      5544>>ASSIGN   5545>>ASSIGN   5545>>ASSIGN   5563>>IF       5563>>IF       5567>>IF       5567>>IF
      5567>>IF       5569>>ASSIGN   5569>>ASSIGN   5570>>IF       5570>>IF       5570>>IF       5572>>IF
      5637>>IF       5637>>IF       5641>>ASSIGN   5641>>ASSIGN   5642>>ASSIGN   5642>>ASSIGN   5648>>ASSIGN
      5648>>ASSIGN   5649>>IF       5654>>ASSIGN   5661>>IF       5661>>IF       5665>>ASSIGN   5665>>ASSIGN
      5679>>ASSIGN   5679>>ASSIGN   5687>>ASSIGN   5687>>ASSIGN   5754>>ASSIGN   5769>>ASSIGN   5769>>ASSIGN
      5770>>ASSIGN   5772>>IF       5773>>ASSIGN   5783>>ASSIGN   5783>>ASSIGN   5783>>ASSIGN   5785>>IF
      5785>>IF       5785>>IF       5797>>ASSIGN   5797>>ASSIGN   5799>>ASSIGN   5803>>ASSIGN   5805>>ASSIGN
      5806>>ASSIGN   5819>>ASSIGN   5865>>ASSIGN   5865>>ASSIGN   5866>>ASSIGN   5866>>ASSIGN   5867>>ASSIGN
      5867>>ASSIGN   5871>>ASSIGN   5955>>IF       5955>>IF       5964>>ASSIGN
TABLOOP
      5700**LABEL    5714--EXIT
THE_BEGINNING
      5408**LABEL    5994--GOTO
TRNTBL$
      5337**DCL      4731--IMP-PTR  5411<<ASSIGN   5420>>IF       5505>>CALLBLT  5506>>IF       5507>>CALLBLT
      5551>>ASSIGN   5594>>IF       5595>>ASSIGN   5616>>IF       5617>>ASSIGN   5728>>ASSIGN   5832>>ASSIGN
      5848>>IF       5921>>IF       5922>>CALLBLT  5929>>ASSIGN   5932>>IF       5933>>ASSIGN
TRUNC
      5373**DCL      5410<<ASSIGN   5455<<ASSIGN   5456>>IF       5528>>IF       5604>>IF       5644>>IF
      5653<<ASSIGN   5678<<ASSIGN   5717>>IF       5741>>IF       5765>>IF       5862>>IF       5885>>IF
VDH_OTPLCL
      5057**DCL      5408<<ASSIGN   5829--ASSIGN
VDH_OTPLCL.BFR_.ADR$
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:119  
      5090**DCL      5474>>CALLBLT  5505>>CALLBLT  5538>>DOWHILE  5593>>ASSIGN   5625>>DOWHILE  5758>>IF
      5920>>ASSIGN   5990<<ASSIGN   5993>>IF
VDH_OTPLCL.BFR_.BYTSIZ
      5090**DCL      5433>>DOWHILE  5470>>ASSIGN   5497>>ASSIGN   5584<<ASSIGN   5584>>ASSIGN   5625>>DOWHILE
      5667<<ASSIGN   5667>>ASSIGN   5690<<ASSIGN   5690>>ASSIGN   5735<<ASSIGN   5735>>ASSIGN   5747<<ASSIGN
      5747>>ASSIGN   5756<<ASSIGN   5756>>ASSIGN   5757>>DOWHILE  5760<<ASSIGN   5760>>ASSIGN   5779<<ASSIGN
      5779>>ASSIGN   5801<<ASSIGN   5801>>ASSIGN   5892<<ASSIGN   5892>>ASSIGN   5903>>DOWHILE  5913>>ASSIGN
      5917>>ASSIGN   5943<<ASSIGN   5943>>ASSIGN   5958>>ASSIGN   5991<<ASSIGN
VDH_OTPLCL.BFR_.BYTX
      5090**DCL      5474>>CALLBLT  5505>>CALLBLT  5536>>ASSIGN   5541>>IF       5542>>ASSIGN   5583<<ASSIGN
      5583>>ASSIGN   5593>>ASSIGN   5625>>DOWHILE  5666<<ASSIGN   5666>>ASSIGN   5689<<ASSIGN   5689>>ASSIGN
      5734<<ASSIGN   5734>>ASSIGN   5746<<ASSIGN   5746>>ASSIGN   5755<<ASSIGN   5755>>ASSIGN   5758>>IF
      5759<<ASSIGN   5759>>ASSIGN   5778<<ASSIGN   5778>>ASSIGN   5785>>IF       5800<<ASSIGN   5800>>ASSIGN
      5891<<ASSIGN   5891>>ASSIGN   5920>>ASSIGN   5942<<ASSIGN   5942>>ASSIGN   5957>>ASSIGN   5992<<ASSIGN
      5993>>IF       5993<<ASSIGN
VDH_OTPLCL.HDN
      5063**DCL      5547>>IF       5978<<ASSIGN   5982<<ASSIGN   5986<<ASSIGN
VDH_OTPLCL.NONVRT
      5063**DCL      5421>>IF       5511>>IF       5626>>IF       5681>>IF       5718>>IF       5743>>IF
      5813>>IF       5868>>IF       5962>>IF       5964>>IF       5977<<ASSIGN   5981<<ASSIGN   5985<<ASSIGN
VDH_OTPLCL.NO_WRAP
      5064**DCL      5742>>IF       5954>>IF       5989<<ASSIGN
VDH_OTPLCL.TRN
      5063**DCL      5420>>IF       5988<<ASSIGN
VDI$
      5341**DCL      5262--IMP-PTR  5412<<ASSIGN   5457>>IF       5457>>IF       5480>>IF       5491>>IF
      5499>>IF       5501>>IF       5502>>ASSIGN   5505>>CALLBLT  5505>>CALLBLT  5507>>CALLBLT  5507>>CALLBLT
      5525>>IF       5526>>ASSIGN   5551>>ASSIGN   5551>>ASSIGN   5552>>ASSIGN   5552>>ASSIGN   5558>>ASSIGN
      5558>>ASSIGN   5559>>ASSIGN   5559>>ASSIGN   5562>>ASSIGN   5562>>ASSIGN   5563>>IF       5581>>ASSIGN
      5602>>ASSIGN   5602>>ASSIGN   5669>>ASSIGN   5680>>ASSIGN   5728>>ASSIGN   5728>>ASSIGN   5766>>IF
      5768>>ASSIGN   5785>>IF       5810>>IF       5811>>ASSIGN   5872>>IF       5873>>ASSIGN   5882>>ASSIGN
      5882>>ASSIGN   5902>>IF       5907>>IF       5915>>IF       5917>>ASSIGN   5920>>ASSIGN   5920>>ASSIGN
      5922>>CALLBLT  5922>>CALLBLT  5924>>ASSIGN   5924>>ASSIGN   5925>>ASSIGN   5925>>ASSIGN   5926>>IF
      5927>>ASSIGN   5929>>ASSIGN   5929>>ASSIGN   5930>>ASSIGN   5930>>ASSIGN   5931>>ASSIGN   5931>>ASSIGN
      5933>>ASSIGN   5933>>ASSIGN   5934>>ASSIGN   5934>>ASSIGN   5935>>ASSIGN   5935>>ASSIGN   5941>>ASSIGN
      5941>>ASSIGN
PL6.E3A0      #001=KVO$OTPLCL File=KVO$OTPLCL.:E05TSI                            WED 07/30/97 02:10 Page:120  
WRT1_CHR
      5986**LABEL    5979--GOTO     5983--GOTO
Y$WRAP
      5952**PROC     5460--CALL     5577--CALL     5798--CALL
Y@VDH_OTPLCL.BFR_.ADR$
      5163**DCL      5876<<ASSIGN
Y@VDH_OTPLCL.BFR_.BYTSIZ
      5163**DCL      5845<<ASSIGN   5858<<ASSIGN
Y@VDH_OTPLCL.BFR_.BYTX
      5163**DCL      5877<<ASSIGN
Y@VDH_OTPLCL.EXTOTPTRN
      5137**DCL      5831<<ASSIGN
Y@VDH_OTPLCL.HDN
      5136**DCL      5862>>IF
Y@VDH_OTPLCL.TRN
      5136**DCL      5864<<ASSIGN
