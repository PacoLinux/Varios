VERSION E05

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:1    
        1        1        /*M* NIK$KEYIN - Keyin interface to I/O system */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR */
        8        8        NIK$KEYIN: PROC(KEY) ALTRET;
        9        9        /*D*  NAME:   NIK$KEYIN
       10       10              CALL:   CALL NIK$KEYIN(KEY$);
       11       11              INTERFACE:  Keyin routine pointed to by NI$DVT.KEYIN.
       12       12              INPUT:  NI$DCT - Device Control Table
       13       13                      NI$DVT - Device Table.
       14       14              DESCRIPTION:    OCZ$DEV_DCT is called to get the DCT index of the
       15       15                              device. If the device is not a TIGR-configured
       16       16                              LOCAL device (and not the DEVICE keyin), KCD$KEYIN
       17       17                              is called to handle the KEYIN.
       18       18                              Otherwise, if the device state is not KIWAIT or
       19       19                              SPWAIT an error message is printed on the console.
       20       20                              If the device was expecting a keyin then one of
       21       21                              the following actions is taken:
       22       22
       23       23                              RETRY:
       24       24                                  The device scheduler is called with a new
       25       25                              state of IDLE.
       26       26                              ERROR:
       27       27                                  All reqests are removed from the device
       28       28                              scheduler queue and the device scheduler is
       29       29                              called with a new state of IDLE.  NIO$COMP is
       30       30                              then called for each request with TYC.IOERR set
       31       31                              if no other TYC bits were set.
       32       32                              PROCEED:
       33       33                                  The first request on the device scheduler
       34       34                              queue is removed and the device scheduler is
       35       35                              called with a new state of IDLE.  TYC is then
       36       36                              cleared the the request that was removed and
       37       37                              NIO$COMP is called for that request.  Note that
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:2    
       38       38                              this keyin should be avoided (especially for
       39       39                              disk and tape) as it reports a normal completion
       40       40                              for an unsuccessful I/O.
       41       41                                                                           */
       42       42        /*
       43       43                Includes
       44       44        */
       45       45        %INCLUDE                HF_LOCK_C ;
       46       59        %INCLUDE                NI_DATA_C ;
       47      172        %INCLUDE                NI_DATA_R ;
       48      609        %INCLUDE                NI_MACROS_C ;
       49      876        %INCLUDE                OC_SUBS_C ;
       50     1607        /*
       51     1608                Parameters
       52     1609        */
       53     1610    1   DCL 1 KEY               ALIGNED PARAM,
       54     1611    1         2 MSG#            UBIN(18) UNAL,
       55     1612    1         2 CADDR           BIT(18) UNAL,
       56     1613    1         2 DEVNM           CHAR(8);
       57     1614        /*
       58     1615                Entries
       59     1616        */
       60     1617    1   DCL 1 NIK$KIPND         ENTRY(2) ;
       61     1618    1   DCL 1 NIO$COMP          ENTRY(2) ;
       62     1619    1   DCL 1 NIW$LDFW          ENTRY(2) ALTRET ;
       63     1620    1   DCL 1 OCI$MK_STTM       ENTRY(1) ;
       64     1621    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
       65     1622    1   DCL 1 OCZ$DEV_DCT       ENTRY(3) ALTRET ;
       66     1623        /*
       67     1624                Symrefs
       68     1625        */
       69     1626    1   DCL 1 NK_MXLOCAL        UBIN SYMREF ;
       70     1627        /*
       71     1628                Auto
       72     1629        */
       73     1630    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
       74     1631    1   DCL 1 DVSCH             EPTR ALIGNED AUTO ;
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:3    
       75     1632    1   DCL 1 I                 SBIN ALIGNED AUTO ;
       76     1633    1   DCL 1 OCMSG             SBIN ALIGNED AUTO ;
       77     1634    1   DCL 1 R$                PTR ALIGNED AUTO ;
       78     1635    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
       79     1636    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
       80     1637        /*
       81     1638                Based
       82     1639        */
       83     1640        %NI$DCT                 ( NAME=DCT,    STCLASS="BASED(DCT$)" ) ;
       84     1688        %NI$DVT ;
       85     1695        %NI$SQH                 ( NAME=SQH,    STCLASS="BASED(SQH$)" ) ;
       86     1708        %N$REQ                  ( NAME=REQ,    STCLASS=BASED ) ;
       87     1766        %EJECT;
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:4    
       88     1767    1           IF SUBSTR(KEY.DEVNM,0,4)=' ' THEN I=0;
       89     1768    2           ELSE DO;
       90     1769    2              OCMSG=KIILGL_MSG#;
       91     1770    2              CALL OCZ$DEV_DCT (KEY.DEVNM,I,KEY.CADDR) ALTRET(RET);
       92     1771    2              END;
       93     1772    1           OCMSG=NKYN_MSG#;
       94     1773    1           DCT$=N$DCT$(I);
       95     1774    2           IF DCT$=ADDR(NIL) AND KEY.MSG#~=KEY_DEVS# THEN DO;
       96     1775    2              CALL OCI$MK_WR (KEY.CADDR,NDEV_MSG#,1,'004'O,KEY.DEVNM);
       97     1776    2              GOTO RET;
       98     1777    2              END;
       99     1778    2           DO CASE(KEY.MSG#);
      100     1779    2            CASE(KEY_RETRY#,KEY_ERROR#,KEY_PROCEED#);
      101     1780    2              IF NOT (DCT.STATE=%KIWAIT OR DCT.STATE=%SPWAIT OR DCT.STATE=%MPCWAIT)
              1780                       THEN
      102     1781    2                 GOTO OCMESS;
      103     1782    2              DVSCH=DCT.DVT$->NI$DVT.DVSCH;
      104     1783    2              IF DVSCH=ENTADDR(NIL) THEN GOTO OCMESS;
      105     1784    2              OCMSG=KIILGL_MSG#;
      106     1785    2              SQH$=DCT.SQH$;
      107     1786    2              REQ$=ADDR(NIL);
      108     1787    3              DO CASE(KEY.MSG#);
      109     1788    3               CASE(KEY_ERROR#);
      110     1789                      %LOCK (G#=SQH.GATE);
      111     1792    3                 REQ$=DCT.SQ$;
      112     1793    4                 IF DCT.TYPE=%DV_DP THEN DO;
      113     1794    4                    DCT.SQ$=DCT.DP.BQ$;
      114     1795    4                    DCT.DP.BQ$=ADDR(NIL);
      115     1796    4                    DCT.DP.SWP=~DCT.DP.SWP;
      116     1797    4                    DCT.DFLG.AUTOERROR='1'B;
      117     1798    4                    END;
      118     1799    4                 ELSE DO;
      119     1800    4                    DCT.SQ$=ADDR(NIL);
      120     1801    4                    END;
      121     1802    4                 IF DCT.TYPE=%DV_MT THEN DO;
      122     1803    5                    IF DCT.MT.FREPOS$~=ADDR(NIL) THEN DO;
      123     1804    5                       R$=DCT.MT.FREPOS$;
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:5    
      124     1805    5                       DCT.MT.FREPOS$=ADDR(NIL);
      125     1806                            %UNLOCK (G#=SQH.GATE);
      126     1809    5                       CALL NIO$COMP(R$->REQ);
      127     1810                            %LOCK (G#=SQH.GATE);
      128     1813    5                       END;
      129     1814    4                    END;
      130     1815                      %UNLOCK (G#=SQH.GATE);
      131     1818    3               CASE(KEY_PROCEED#);
      132     1819    4                 IF DCT.TYPE=%DV_MT THEN DO;
      133     1820    5                    IF DCT.MT.FREPOS$~=ADDR(NIL) THEN DO;
      134     1821    5                       OCMSG=NPROCEED_MSG#;
      135     1822    5                       GOTO OCMESS;
      136     1823    5                       END;
      137     1824    4                    END;
      138     1825                      %LOCK (G#=SQH.GATE);
      139     1828                      %DEQUEUE (P#=REQ$,Q#=DCT.SQ$,A#=NO_REQ$);
      140     1835    3                 REQ$->REQ.FL$=REQ$;
      141     1836    3   NO_REQ$:
      142     1837                      %UNLOCK (G#=SQH.GATE);
      143     1840    3               END;
      144     1841    3              IF DCT.MSG#>0 THEN DO;
      145     1842    3                 CALL OCI$MK_STTM(DCT.MSG#);
      146     1843    3                 DCT.MSG#=0;
      147     1844    3                 END;
      148     1845    3              ELSE DO;
      149     1846    4                 DO I = 0 TO 1;
      150     1847    4                    IF DCT.SQH$->SQH.MPC$(I)~=ADDR(NIL) THEN
      151     1848    5                       IF DCT.SQH$->SQH.MPC$(I)->DCT.MSG#>0 THEN DO;
      152     1849    5                          CALL OCI$MK_STTM(DCT.SQH$->SQH.MPC$(I)->DCT.MSG#);
      153     1850    5                          DCT.SQH$->SQH.MPC$(I)->DCT.MSG#=0;
      154     1851    5                          END;
      155     1852    4                    END;
      156     1853    3                 END;
      157     1854    2              CALL DVSCH(DCT,%IDLE);
      158     1855    3              DO WHILE(REQ$~=ADDR(NIL));
      159     1856                      %DEQUEUE (P#=R$,Q#=REQ$);
      160     1863    4                 IF KEY.MSG#=KEY_ERROR# THEN DO;
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:6    
      161     1864    4                    R$->REQ.TYC.OPER='1'B;
      162     1865    4                    END;
      163     1866    4                 ELSE DO;
      164     1867    4                    R$->REQ.TYC='0'B;
      165     1868    4                    END;
      166     1869    3                 CALL NIO$COMP(R$->REQ);
      167     1870    3                 END;
      168     1871    2            CASE(KEY_QUIET#);
      169     1872    2              IF DCT.MSG#=0 THEN GOTO OCMESS;
      170     1873    2              CALL OCI$MK_STTM(DCT.MSG#);
      171     1874    2              DCT.MSG#=0;
      172     1875    2            CASE(KEY_FIRMLOAD#);
      173     1876    2              OCMSG=KIILGL_MSG#;
      174     1877    2              IF DCT.DVT$->NI$DVT.TYPE~=%DV_MPC THEN GOTO OCMESS;
      175     1878    3              IF DCT.MSG#>0 THEN DO;
      176     1879    3                 CALL OCI$MK_STTM(DCT.MSG#);
      177     1880    3                 END;
      178     1881    2              OCMSG=FWLIP_MSG#;
      179     1882    2              CALL NIW$LDFW(DCT,'0'B) ALTRET(OCMESS);
      180     1883    2            CASE(KEY_DEVS#);
      181     1884    2              CALL NIK$KIPND(KEY,I);
      182     1885    2            END/* CASE KEY.MSG# */;
      183     1886    1   RET:    ;
      184     1887    1           RETURN;
      185     1888    1   OCMESS: ;
      186     1889    1           CALL OCI$MK_WR(KEY.CADDR,OCMSG,1,'002'O,KEY.MSG#,I);
      187     1890    1           RETURN;
      188     1891    1   END NIK$KEYIN;
      189     1892        %EOD;

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:7    
--  Include file information  --

   OC_SUBS_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIK$KEYIN.

   Procedure NIK$KEYIN requires 316 words for executable code.
   Procedure NIK$KEYIN requires 18 words of local(AUTO) storage.

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:8    

 Object Unit name= NIK$KEYIN                                  File name= NIK$KEYIN.:E05TOU
 UTS= JUL 30 '97 03:32:38.96 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   316    474  NIK$KEYIN
    1  RoData even  none    10     12  NIK$KEYIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  NIK$KEYIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 OCZ$DEV_DCT
         yes           Std       7 OCI$MK_WR
         yes           Std       1 HFC$UNLOCK
         yes           Std       2 NIK$KIPND
         yes           Std       2 NIO$COMP
         yes           Std       1 OCI$MK_STTM
 yes     yes           Std       2 NIW$LDFW
 yes     yes           Std       2 NIM$DEQUEUE
         yes           Std       1 HFC$LOCK
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:9    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:10   


        1        1        /*M* NIK$KEYIN - Keyin interface to I/O system */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR */
        8        8        NIK$KEYIN: PROC(KEY) ALTRET;

      8  0 000000   000000 700200 xent  NIK$KEYIN    TSX0  ! X66_AUTO_1
         0 000001   000022 000001                    ZERO    18,1

        9        9        /*D*  NAME:   NIK$KEYIN
       10       10              CALL:   CALL NIK$KEYIN(KEY$);
       11       11              INTERFACE:  Keyin routine pointed to by NI$DVT.KEYIN.
       12       12              INPUT:  NI$DCT - Device Control Table
       13       13                      NI$DVT - Device Table.
       14       14              DESCRIPTION:    OCZ$DEV_DCT is called to get the DCT index of the
       15       15                              device. If the device is not a TIGR-configured
       16       16                              LOCAL device (and not the DEVICE keyin), KCD$KEYIN
       17       17                              is called to handle the KEYIN.
       18       18                              Otherwise, if the device state is not KIWAIT or
       19       19                              SPWAIT an error message is printed on the console.
       20       20                              If the device was expecting a keyin then one of
       21       21                              the following actions is taken:
       22       22
       23       23                              RETRY:
       24       24                                  The device scheduler is called with a new
       25       25                              state of IDLE.
       26       26                              ERROR:
       27       27                                  All reqests are removed from the device
       28       28                              scheduler queue and the device scheduler is
       29       29                              called with a new state of IDLE.  NIO$COMP is
       30       30                              then called for each request with TYC.IOERR set
       31       31                              if no other TYC bits were set.
       32       32                              PROCEED:
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:11   
       33       33                                  The first request on the device scheduler
       34       34                              queue is removed and the device scheduler is
       35       35                              called with a new state of IDLE.  TYC is then
       36       36                              cleared the the request that was removed and
       37       37                              NIO$COMP is called for that request.  Note that
       38       38                              this keyin should be avoided (especially for
       39       39                              disk and tape) as it reports a normal completion
       40       40                              for an unsuccessful I/O.
       41       41                                                                           */
       42       42        /*
       43       43                Includes
       44       44        */
       45       45        %INCLUDE                HF_LOCK_C ;
       46       59        %INCLUDE                NI_DATA_C ;
       47      172        %INCLUDE                NI_DATA_R ;
       48      609        %INCLUDE                NI_MACROS_C ;
       49      876        %INCLUDE                OC_SUBS_C ;
       50     1607        /*
       51     1608                Parameters
       52     1609        */
       53     1610    1   DCL 1 KEY               ALIGNED PARAM,
       54     1611    1         2 MSG#            UBIN(18) UNAL,
       55     1612    1         2 CADDR           BIT(18) UNAL,
       56     1613    1         2 DEVNM           CHAR(8);
       57     1614        /*
       58     1615                Entries
       59     1616        */
       60     1617    1   DCL 1 NIK$KIPND         ENTRY(2) ;
       61     1618    1   DCL 1 NIO$COMP          ENTRY(2) ;
       62     1619    1   DCL 1 NIW$LDFW          ENTRY(2) ALTRET ;
       63     1620    1   DCL 1 OCI$MK_STTM       ENTRY(1) ;
       64     1621    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
       65     1622    1   DCL 1 OCZ$DEV_DCT       ENTRY(3) ALTRET ;
       66     1623        /*
       67     1624                Symrefs
       68     1625        */
       69     1626    1   DCL 1 NK_MXLOCAL        UBIN SYMREF ;
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:12   
       70     1627        /*
       71     1628                Auto
       72     1629        */
       73     1630    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
       74     1631    1   DCL 1 DVSCH             EPTR ALIGNED AUTO ;
       75     1632    1   DCL 1 I                 SBIN ALIGNED AUTO ;
       76     1633    1   DCL 1 OCMSG             SBIN ALIGNED AUTO ;
       77     1634    1   DCL 1 R$                PTR ALIGNED AUTO ;
       78     1635    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
       79     1636    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
       80     1637        /*
       81     1638                Based
       82     1639        */
       83     1640        %NI$DCT                 ( NAME=DCT,    STCLASS="BASED(DCT$)" ) ;
       84     1688        %NI$DVT ;
       85     1695        %NI$SQH                 ( NAME=SQH,    STCLASS="BASED(SQH$)" ) ;
       86     1708        %N$REQ                  ( NAME=REQ,    STCLASS=BASED ) ;
       87     1766        %EJECT;
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:13   
       88     1767    1           IF SUBSTR(KEY.DEVNM,0,4)=' ' THEN I=0;

   1767  0 000002   200003 470500                    LDP0    @KEY,,AUTO
         0 000003   000001 236100                    LDQ     1,,PR0
         0 000004   000035 116000 xsym               CMPQ    B_VECTNIL+29
         0 000005   000010 601000 0                  TNZ     s:1769

   1767  0 000006   200006 450100                    STZ     I,,AUTO
         0 000007   000026 710000 0                  TRA     s:1772

       89     1768    2           ELSE DO;

       90     1769    2              OCMSG=KIILGL_MSG#;

   1769  0 000010   000252 235007                    LDA     170,DL
         0 000011   200007 755100                    STA     OCMSG,,AUTO

       91     1770    2              CALL OCZ$DEV_DCT (KEY.DEVNM,I,KEY.CADDR) ALTRET(RET);

   1770  0 000012   200003 236100                    LDQ     @KEY,,AUTO
         0 000013   400000 036007                    ADLQ    -131072,DL
         0 000014   200016 756100                    STQ     SQH$+4,,AUTO
         0 000015   200006 631500                    EPPR1   I,,AUTO
         0 000016   200015 451500                    STP1    SQH$+3,,AUTO
         0 000017   200003 236100                    LDQ     @KEY,,AUTO
         0 000020   000001 036003                    ADLQ    1,DU
         0 000021   200014 756100                    STQ     SQH$+2,,AUTO
         0 000022   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000023   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000024   000000 701000 xent               TSX1    OCZ$DEV_DCT
         0 000025   000453 702000 0                  TSX2    RET

       92     1771    2              END;

       93     1772    1           OCMSG=NKYN_MSG#;

   1772  0 000026   000253 235007                    LDA     171,DL
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:14   
         0 000027   200007 755100                    STA     OCMSG,,AUTO

       94     1773    1           DCT$=N$DCT$(I);

   1773  0 000030   000000 470400 xsym               LDP0    N$DCT$$
         0 000031   200006 720100                    LXL0    I,,AUTO
         0 000032   000000 236110                    LDQ     0,X0,PR0
         0 000033   200004 756100                    STQ     DCT$,,AUTO

       95     1774    2           IF DCT$=ADDR(NIL) AND KEY.MSG#~=KEY_DEVS# THEN DO;

   1774  0 000034   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000035   000061 601000 0                  TNZ     s:1778
         0 000036   200003 471500                    LDP1    @KEY,,AUTO
         0 000037   100000 221100                    LDX1    0,,PR1
         0 000040   000027 101003                    CMPX1   23,DU
         0 000041   000061 600000 0                  TZE     s:1778

       96     1775    2              CALL OCI$MK_WR (KEY.CADDR,NDEV_MSG#,1,'004'O,KEY.DEVNM);

   1775  0 000042   200003 236100                    LDQ     @KEY,,AUTO
         0 000043   000001 036003                    ADLQ    1,DU
         0 000044   200020 756100                    STQ     SQH$+6,,AUTO
         0 000045   000002 237000 1                  LDAQ    2
         0 000046   200016 757100                    STAQ    SQH$+4,,AUTO
         0 000047   000004 236000 1                  LDQ     4
         0 000050   200015 756100                    STQ     SQH$+3,,AUTO
         0 000051   200003 236100                    LDQ     @KEY,,AUTO
         0 000052   400000 036007                    ADLQ    -131072,DL
         0 000053   200014 756100                    STQ     SQH$+2,,AUTO
         0 000054   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000055   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000056   000000 701000 xent               TSX1    OCI$MK_WR
         0 000057   000000 011000                    NOP     0

       97     1776    2              GOTO RET;

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:15   
   1776  0 000060   000453 710000 0                  TRA     RET

       98     1777    2              END;
       99     1778    2           DO CASE(KEY.MSG#);

   1778  0 000061   200003 471500                    LDP1    @KEY,,AUTO
         0 000062   100000 236100                    LDQ     0,,PR1
         0 000063   000022 772000                    QRL     18
         0 000064   000022 136007                    SBLQ    18,DL
         0 000065   000006 116007                    CMPQ    6,DL
         0 000066   000070 602006 0                  TNC     s:1778+7,QL
         0 000067   000453 710000 0                  TRA     RET
         0 000070   000076 710000 0                  TRA     s:1780
         0 000071   000076 710000 0                  TRA     s:1780
         0 000072   000076 710000 0                  TRA     s:1780
         0 000073   000372 710000 0                  TRA     s:1872
         0 000074   000410 710000 0                  TRA     s:1876
         0 000075   000443 710000 0                  TRA     s:1884

      100     1779    2            CASE(KEY_RETRY#,KEY_ERROR#,KEY_PROCEED#);

      101     1780    2              IF NOT (DCT.STATE=%KIWAIT OR DCT.STATE=%SPWAIT OR DCT.STATE=%MPCWAIT)
              1780                       THEN

   1780  0 000076   200004 473500                    LDP3    DCT$,,AUTO
         0 000077   300007 236100                    LDQ     7,,PR3
         0 000100   000077 376007                    ANQ     63,DL
         0 000101   000004 116007                    CMPQ    4,DL
         0 000102   000107 600000 0                  TZE     s:1782
         0 000103   000003 116007                    CMPQ    3,DL
         0 000104   000107 600000 0                  TZE     s:1782
         0 000105   000007 116007                    CMPQ    7,DL
         0 000106   000454 601000 0                  TNZ     OCMESS

      102     1781    2                 GOTO OCMESS;
      103     1782    2              DVSCH=DCT.DVT$->NI$DVT.DVSCH;

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:16   
   1782  0 000107   300024 474500                    LDP4    20,,PR3
         0 000110   400002 236100                    LDQ     2,,PR4
         0 000111   200005 756100                    STQ     DVSCH,,AUTO

      104     1783    2              IF DVSCH=ENTADDR(NIL) THEN GOTO OCMESS;

   1783  0 000112   000002 116000 xsym               CMPQ    B_VECTNIL+2
         0 000113   000454 600000 0                  TZE     OCMESS

      105     1784    2              OCMSG=KIILGL_MSG#;

   1784  0 000114   000252 235007                    LDA     170,DL
         0 000115   200007 755100                    STA     OCMSG,,AUTO

      106     1785    2              SQH$=DCT.SQH$;

   1785  0 000116   300022 236100                    LDQ     18,,PR3
         0 000117   200012 756100                    STQ     SQH$,,AUTO

      107     1786    2              REQ$=ADDR(NIL);

   1786  0 000120   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000121   200011 756100                    STQ     REQ$,,AUTO

      108     1787    3              DO CASE(KEY.MSG#);

   1787  0 000122   100000 236100                    LDQ     0,,PR1
         0 000123   000022 772000                    QRL     18
         0 000124   000023 136007                    SBLQ    19,DL
         0 000125   000002 116007                    CMPQ    2,DL
         0 000126   000130 602006 0                  TNC     s:1787+6,QL
         0 000127   000255 710000 0                  TRA     s:1841
         0 000130   000132 710000 0                  TRA     s:1790
         0 000131   000217 710000 0                  TRA     s:1819

      109     1788    3               CASE(KEY_ERROR#);

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:17   
      110     1789                      %LOCK (G#=SQH.GATE);

   1790  0 000132   200012 630500                    EPPR0   SQH$,,AUTO
         0 000133   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000134   000000 701000 xent               TSX1    HFC$LOCK
         0 000135   000000 011000                    NOP     0

      111     1792    3                 REQ$=DCT.SQ$;

   1792  0 000136   200004 470500                    LDP0    DCT$,,AUTO
         0 000137   000001 236100                    LDQ     1,,PR0
         0 000140   200011 756100                    STQ     REQ$,,AUTO

      112     1793    4                 IF DCT.TYPE=%DV_DP THEN DO;

   1793  0 000141   000007 236100                    LDQ     7,,PR0
         0 000142   007700 376007                    ANQ     4032,DL
         0 000143   000600 116007                    CMPQ    384,DL
         0 000144   000162 601000 0                  TNZ     s:1800

      113     1794    4                    DCT.SQ$=DCT.DP.BQ$;

   1794  0 000145   000030 236100                    LDQ     24,,PR0
         0 000146   000001 756100                    STQ     1,,PR0

      114     1795    4                    DCT.DP.BQ$=ADDR(NIL);

   1795  0 000147   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000150   000030 756100                    STQ     24,,PR0

      115     1796    4                    DCT.DP.SWP=~DCT.DP.SWP;

   1796  0 000151   000031 236100                    LDQ     25,,PR0
         0 000152   400000 376003                    ANQ     -131072,DU
         0 000153   400000 676003                    ERQ     -131072,DU
         0 000154   000031 676100                    ERQ     25,,PR0
         0 000155   400000 376003                    ANQ     -131072,DU
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:18   
         0 000156   000031 656100                    ERSQ    25,,PR0

      116     1797    4                    DCT.DFLG.AUTOERROR='1'B;

   1797  0 000157   000020 236007                    LDQ     16,DL
         0 000160   000006 256100                    ORSQ    6,,PR0

      117     1798    4                    END;

   1798  0 000161   000164 710000 0                  TRA     s:1802

      118     1799    4                 ELSE DO;

      119     1800    4                    DCT.SQ$=ADDR(NIL);

   1800  0 000162   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000163   000001 756100                    STQ     1,,PR0

      120     1801    4                    END;

      121     1802    4                 IF DCT.TYPE=%DV_MT THEN DO;

   1802  0 000164   000007 236100                    LDQ     7,,PR0
         0 000165   007700 376007                    ANQ     4032,DL
         0 000166   000400 116007                    CMPQ    256,DL
         0 000167   000212 601000 0                  TNZ     s:1816

      122     1803    5                    IF DCT.MT.FREPOS$~=ADDR(NIL) THEN DO;

   1803  0 000170   000031 236100                    LDQ     25,,PR0
         0 000171   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000172   000212 600000 0                  TZE     s:1816

      123     1804    5                       R$=DCT.MT.FREPOS$;

   1804  0 000173   200010 756100                    STQ     R$,,AUTO

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:19   
      124     1805    5                       DCT.MT.FREPOS$=ADDR(NIL);

   1805  0 000174   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000175   000031 756100                    STQ     25,,PR0

      125     1806                            %UNLOCK (G#=SQH.GATE);

   1807  0 000176   200012 630500                    EPPR0   SQH$,,AUTO
         0 000177   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000200   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000201   000000 011000                    NOP     0

      126     1809    5                       CALL NIO$COMP(R$->REQ);

   1809  0 000202   200010 630500                    EPPR0   R$,,AUTO
         0 000203   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000204   000000 701000 xent               TSX1    NIO$COMP
         0 000205   000000 011000                    NOP     0

      127     1810                            %LOCK (G#=SQH.GATE);

   1811  0 000206   200012 630500                    EPPR0   SQH$,,AUTO
         0 000207   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000210   000000 701000 xent               TSX1    HFC$LOCK
         0 000211   000000 011000                    NOP     0

      128     1813    5                       END;

      129     1814    4                    END;

      130     1815                      %UNLOCK (G#=SQH.GATE);

   1816  0 000212   200012 630500                    EPPR0   SQH$,,AUTO
         0 000213   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000214   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000215   000000 011000                    NOP     0
         0 000216   000255 710000 0                  TRA     s:1841
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:20   

      131     1818    3               CASE(KEY_PROCEED#);

      132     1819    4                 IF DCT.TYPE=%DV_MT THEN DO;

   1819  0 000217   300007 236100                    LDQ     7,,PR3
         0 000220   007700 376007                    ANQ     4032,DL
         0 000221   000400 116007                    CMPQ    256,DL
         0 000222   000231 601000 0                  TNZ     s:1826

      133     1820    5                    IF DCT.MT.FREPOS$~=ADDR(NIL) THEN DO;

   1820  0 000223   300031 236100                    LDQ     25,,PR3
         0 000224   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000225   000231 600000 0                  TZE     s:1826

      134     1821    5                       OCMSG=NPROCEED_MSG#;

   1821  0 000226   000260 235007                    LDA     176,DL
         0 000227   200007 755100                    STA     OCMSG,,AUTO

      135     1822    5                       GOTO OCMESS;

   1822  0 000230   000454 710000 0                  TRA     OCMESS

      136     1823    5                       END;
      137     1824    4                    END;
      138     1825                      %LOCK (G#=SQH.GATE);

   1826  0 000231   200012 630500                    EPPR0   SQH$,,AUTO
         0 000232   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000233   000000 701000 xent               TSX1    HFC$LOCK
         0 000234   000000 011000                    NOP     0

      139     1828                      %DEQUEUE (P#=REQ$,Q#=DCT.SQ$,A#=NO_REQ$);

   1830  0 000235   200004 236100                    LDQ     DCT$,,AUTO
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:21   
         0 000236   000001 036003                    ADLQ    1,DU
         0 000237   200015 756100                    STQ     SQH$+3,,AUTO
         0 000240   200011 630500                    EPPR0   REQ$,,AUTO
         0 000241   200014 450500                    STP0    SQH$+2,,AUTO
         0 000242   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000243   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000244   000000 701000 xent               TSX1    NIM$DEQUEUE
         0 000245   000251 702000 0                  TSX2    NO_REQ$

      140     1835    3                 REQ$->REQ.FL$=REQ$;

   1835  0 000246   200011 236100                    LDQ     REQ$,,AUTO
         0 000247   200011 470500                    LDP0    REQ$,,AUTO
         0 000250   000000 756100                    STQ     0,,PR0

      141     1836    3   NO_REQ$:
      142     1837                      %UNLOCK (G#=SQH.GATE);

   1838  0 000251   200012 630500       NO_REQ$      EPPR0   SQH$,,AUTO
         0 000252   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000253   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000254   000000 011000                    NOP     0

      143     1840    3               END;

      144     1841    3              IF DCT.MSG#>0 THEN DO;

   1841  0 000255   200004 470500                    LDP0    DCT$,,AUTO
         0 000256   000027 720100                    LXL0    23,,PR0
         0 000257   000273 600000 0                  TZE     s:1846

      145     1842    3                 CALL OCI$MK_STTM(DCT.MSG#);

   1842  0 000260   200004 236100                    LDQ     DCT$,,AUTO
         0 000261   000005 036000 1                  ADLQ    5
         0 000262   200014 756100                    STQ     SQH$+2,,AUTO
         0 000263   200014 630500                    EPPR0   SQH$+2,,AUTO
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:22   
         0 000264   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000265   000000 701000 xent               TSX1    OCI$MK_STTM
         0 000266   000000 011000                    NOP     0

      146     1843    3                 DCT.MSG#=0;

   1843  0 000267   000000 220003                    LDX0    0,DU
         0 000270   200004 470500                    LDP0    DCT$,,AUTO
         0 000271   000027 440100                    SXL0    23,,PR0

      147     1844    3                 END;

   1844  0 000272   000327 710000 0                  TRA     s:1854

      148     1845    3              ELSE DO;

      149     1846    4                 DO I = 0 TO 1;

   1846  0 000273   200006 450100                    STZ     I,,AUTO

      150     1847    4                    IF DCT.SQH$->SQH.MPC$(I)~=ADDR(NIL) THEN

   1847  0 000274   200004 470500                    LDP0    DCT$,,AUTO
         0 000275   000022 471500                    LDP1    18,,PR0
         0 000276   200006 720100                    LXL0    I,,AUTO
         0 000277   100005 236110                    LDQ     5,X0,PR1
         0 000300   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000301   000323 600000 0                  TZE     s:1852

      151     1848    5                       IF DCT.SQH$->SQH.MPC$(I)->DCT.MSG#>0 THEN DO;

   1848  0 000302   100005 473510                    LDP3    5,X0,PR1
         0 000303   300027 721100                    LXL1    23,,PR3
         0 000304   000323 600000 0                  TZE     s:1852

      152     1849    5                          CALL OCI$MK_STTM(DCT.SQH$->SQH.MPC$(I)->DCT.MSG#);

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:23   
   1849  0 000305   200015 453500                    STP3    SQH$+3,,AUTO
         0 000306   200015 236100                    LDQ     SQH$+3,,AUTO
         0 000307   000005 036000 1                  ADLQ    5
         0 000310   200014 756100                    STQ     SQH$+2,,AUTO
         0 000311   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000312   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000313   000000 701000 xent               TSX1    OCI$MK_STTM
         0 000314   000000 011000                    NOP     0

      153     1850    5                          DCT.SQH$->SQH.MPC$(I)->DCT.MSG#=0;

   1850  0 000315   200004 470500                    LDP0    DCT$,,AUTO
         0 000316   000022 471500                    LDP1    18,,PR0
         0 000317   200006 720100                    LXL0    I,,AUTO
         0 000320   100005 473510                    LDP3    5,X0,PR1
         0 000321   000000 221003                    LDX1    0,DU
         0 000322   300027 441100                    SXL1    23,,PR3

      154     1851    5                          END;

      155     1852    4                    END;

   1852  0 000323   200006 054100                    AOS     I,,AUTO
         0 000324   200006 235100                    LDA     I,,AUTO
         0 000325   000001 115007                    CMPA    1,DL
         0 000326   000274 604400 0                  TMOZ    s:1847

      156     1853    3                 END;

      157     1854    2              CALL DVSCH(DCT,%IDLE);

   1854  0 000327   000006 236000 1                  LDQ     6
         0 000330   200004 235100                    LDA     DCT$,,AUTO
         0 000331   200014 757100                    STAQ    SQH$+2,,AUTO
         0 000332   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000333   200005 220100                    LDX0    DVSCH,,AUTO
         0 000334   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:24   
         0 000335   000000 701010                    TSX1    0,X0
         0 000336   000000 011000                    NOP     0

      158     1855    3              DO WHILE(REQ$~=ADDR(NIL));

   1855  0 000337   000366 710000 0                  TRA     s:1870

      159     1856                      %DEQUEUE (P#=R$,Q#=REQ$);

   1860  0 000340   200011 630500                    EPPR0   REQ$,,AUTO
         0 000341   200015 450500                    STP0    SQH$+3,,AUTO
         0 000342   200010 631500                    EPPR1   R$,,AUTO
         0 000343   200014 451500                    STP1    SQH$+2,,AUTO
         0 000344   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000345   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000346   000000 701000 xent               TSX1    NIM$DEQUEUE
         0 000347   000000 011000                    NOP     0

      160     1863    4                 IF KEY.MSG#=KEY_ERROR# THEN DO;

   1863  0 000350   200003 470500                    LDP0    @KEY,,AUTO
         0 000351   000000 220100                    LDX0    0,,PR0
         0 000352   000023 100003                    CMPX0   19,DU
         0 000353   000360 601000 0                  TNZ     s:1867

      161     1864    4                    R$->REQ.TYC.OPER='1'B;

   1864  0 000354   200010 471500                    LDP1    R$,,AUTO
         0 000355   200000 236003                    LDQ     65536,DU
         0 000356   100021 256100                    ORSQ    17,,PR1

      162     1865    4                    END;

   1865  0 000357   000362 710000 0                  TRA     s:1869

      163     1866    4                 ELSE DO;

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:25   
      164     1867    4                    R$->REQ.TYC='0'B;

   1867  0 000360   200010 471500                    LDP1    R$,,AUTO
         0 000361   100021 450100                    STZ     17,,PR1

      165     1868    4                    END;

      166     1869    3                 CALL NIO$COMP(R$->REQ);

   1869  0 000362   200010 630500                    EPPR0   R$,,AUTO
         0 000363   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000364   000000 701000 xent               TSX1    NIO$COMP
         0 000365   000000 011000                    NOP     0

      167     1870    3                 END;

   1870  0 000366   200011 236100                    LDQ     REQ$,,AUTO
         0 000367   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000370   000340 601000 0                  TNZ     s:1860
         0 000371   000453 710000 0                  TRA     RET

      168     1871    2            CASE(KEY_QUIET#);

      169     1872    2              IF DCT.MSG#=0 THEN GOTO OCMESS;

   1872  0 000372   200004 473500                    LDP3    DCT$,,AUTO
         0 000373   300027 721100                    LXL1    23,,PR3
         0 000374   000454 600000 0                  TZE     OCMESS

      170     1873    2              CALL OCI$MK_STTM(DCT.MSG#);

   1873  0 000375   200004 236100                    LDQ     DCT$,,AUTO
         0 000376   000005 036000 1                  ADLQ    5
         0 000377   200014 756100                    STQ     SQH$+2,,AUTO
         0 000400   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000401   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000402   000000 701000 xent               TSX1    OCI$MK_STTM
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:26   
         0 000403   000000 011000                    NOP     0

      171     1874    2              DCT.MSG#=0;

   1874  0 000404   000000 220003                    LDX0    0,DU
         0 000405   200004 470500                    LDP0    DCT$,,AUTO
         0 000406   000027 440100                    SXL0    23,,PR0
         0 000407   000453 710000 0                  TRA     RET

      172     1875    2            CASE(KEY_FIRMLOAD#);

      173     1876    2              OCMSG=KIILGL_MSG#;

   1876  0 000410   000252 235007                    LDA     170,DL
         0 000411   200007 755100                    STA     OCMSG,,AUTO

      174     1877    2              IF DCT.DVT$->NI$DVT.TYPE~=%DV_MPC THEN GOTO OCMESS;

   1877  0 000412   200004 473500                    LDP3    DCT$,,AUTO
         0 000413   300024 474500                    LDP4    20,,PR3
         0 000414   400053 236100                    LDQ     43,,PR4
         0 000415   777000 376003                    ANQ     -512,DU
         0 000416   007000 116003                    CMPQ    3584,DU
         0 000417   000454 601000 0                  TNZ     OCMESS

      175     1878    3              IF DCT.MSG#>0 THEN DO;

   1878  0 000420   300027 721100                    LXL1    23,,PR3
         0 000421   000431 600000 0                  TZE     s:1881

      176     1879    3                 CALL OCI$MK_STTM(DCT.MSG#);

   1879  0 000422   200004 236100                    LDQ     DCT$,,AUTO
         0 000423   000005 036000 1                  ADLQ    5
         0 000424   200014 756100                    STQ     SQH$+2,,AUTO
         0 000425   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000426   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:27   
         0 000427   000000 701000 xent               TSX1    OCI$MK_STTM
         0 000430   000000 011000                    NOP     0

      177     1880    3                 END;

      178     1881    2              OCMSG=FWLIP_MSG#;

   1881  0 000431   000232 235007                    LDA     154,DL
         0 000432   200007 755100                    STA     OCMSG,,AUTO

      179     1882    2              CALL NIW$LDFW(DCT,'0'B) ALTRET(OCMESS);

   1882  0 000433   000006 236000 1                  LDQ     6
         0 000434   200004 235100                    LDA     DCT$,,AUTO
         0 000435   200014 757100                    STAQ    SQH$+2,,AUTO
         0 000436   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000437   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000440   000000 701000 xent               TSX1    NIW$LDFW
         0 000441   000454 702000 0                  TSX2    OCMESS
         0 000442   000453 710000 0                  TRA     RET

      180     1883    2            CASE(KEY_DEVS#);

      181     1884    2              CALL NIK$KIPND(KEY,I);

   1884  0 000443   200006 633500                    EPPR3   I,,AUTO
         0 000444   200015 453500                    STP3    SQH$+3,,AUTO
         0 000445   200003 236100                    LDQ     @KEY,,AUTO
         0 000446   200014 756100                    STQ     SQH$+2,,AUTO
         0 000447   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000450   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000451   000000 701000 xent               TSX1    NIK$KIPND
         0 000452   000000 011000                    NOP     0

      182     1885    2            END/* CASE KEY.MSG# */;

   1884  0 000453                       RET          null
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:28   
      183     1886    1   RET:    ;
      184     1887    1           RETURN;

   1887  0 000453   000000 702200 xent               TSX2  ! X66_ARET

   1884  0 000454                       OCMESS       null
      185     1888    1   OCMESS: ;
      186     1889    1           CALL OCI$MK_WR(KEY.CADDR,OCMSG,1,'002'O,KEY.MSG#,I);

   1889  0 000454   200006 630500                    EPPR0   I,,AUTO
         0 000455   200021 450500                    STP0    SQH$+7,,AUTO
         0 000456   200003 236100                    LDQ     @KEY,,AUTO
         0 000457   200020 756100                    STQ     SQH$+6,,AUTO
         0 000460   000010 237000 1                  LDAQ    8
         0 000461   200016 757100                    STAQ    SQH$+4,,AUTO
         0 000462   200007 631500                    EPPR1   OCMSG,,AUTO
         0 000463   200015 451500                    STP1    SQH$+3,,AUTO
         0 000464   200003 236100                    LDQ     @KEY,,AUTO
         0 000465   400000 036007                    ADLQ    -131072,DL
         0 000466   200014 756100                    STQ     SQH$+2,,AUTO
         0 000467   200014 630500                    EPPR0   SQH$+2,,AUTO
         0 000470   000024 631400 xsym               EPPR1   B_VECTNIL+20
         0 000471   000000 701000 xent               TSX1    OCI$MK_WR
         0 000472   000000 011000                    NOP     0

      187     1890    1           RETURN;

   1890  0 000473   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000000 000047   004000 000000   000003 006000   000001 006000    ...'............
   1     004   000000 006000   000027 400000   000002 006000   002000 000000    ................
   1     010   000003 006000   000007 006000                                    ........
      188     1891    1   END NIK$KEYIN;
      189     1892        %EOD;

PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:29   
--  Include file information  --

   OC_SUBS_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIK$KEYIN.
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:30   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @KEY                       4-0-0/w PTR         r     1 DCT$
     5-0-0/w EPTR        r     1 DVSCH                      6-0-0/w SBIN        r     1 I
    *0-0-0/w STRC(108)   r     1 KEY                        7-0-0/w SBIN        r     1 OCMSG
    10-0-0/w PTR         r     1 R$                        11-0-0/w PTR         r     1 REQ$
    12-0-0/w PTR         r     1 SQH$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/w STRC(2844)  r     1 NI$DVT                     0-0-0/d STRC(1080)  r     1 REQ
     0-0-0/w STRC(252)   r     1 SQH


   Procedure NIK$KEYIN requires 316 words for executable code.
   Procedure NIK$KEYIN requires 18 words of local(AUTO) storage.
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:31   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:32   
          MINI XREF LISTING

DCT
      1649**DCL      1854<>CALL     1882<>CALL
DCT.DFLG.AUTOERROR
      1656**DCL      1797<<ASSIGN
DCT.DP
      1669**DCL      1676--REDEF    1679--REDEF    1680--REDEF    1682--REDEF    1682--REDEF    1683--REDEF
      1684--REDEF    1684--REDEF
DCT.DP.BQ$
      1669**DCL      1794>>ASSIGN   1795<<ASSIGN
DCT.DP.SWP
      1669**DCL      1796<<ASSIGN   1796>>ASSIGN
DCT.DVT$
      1665**DCL      1782>>ASSIGN   1877>>IF
DCT.MPC.IOCHANX
      1677**DCL      1677--REDEF
DCT.MSG#
      1669**DCL      1841>>IF       1842<>CALL     1843<<ASSIGN   1848>>IF       1849<>CALL     1850<<ASSIGN
      1872>>IF       1873<>CALL     1874<<ASSIGN   1878>>IF       1879<>CALL
DCT.MT.FREPOS$
      1680**DCL      1803>>IF       1804>>ASSIGN   1805<<ASSIGN   1820>>IF
DCT.SQ$
      1649**DCL      1792>>ASSIGN   1794<<ASSIGN   1800<<ASSIGN   1830<>CALL
DCT.SQH$
      1664**DCL      1785>>ASSIGN   1847>>IF       1848>>IF       1849>>CALL     1850>>ASSIGN
DCT.STATE
      1659**DCL      1780>>IF       1780>>IF       1780>>IF
DCT.TYPE
      1659**DCL      1793>>IF       1802>>IF       1819>>IF
DCT$
      1630**DCL      1649--IMP-PTR  1773<<ASSIGN   1774>>IF       1780>>IF       1780>>IF       1780>>IF
      1782>>ASSIGN   1785>>ASSIGN   1792>>ASSIGN   1793>>IF       1794>>ASSIGN   1794>>ASSIGN   1795>>ASSIGN
      1796>>ASSIGN   1796>>ASSIGN   1797>>ASSIGN   1800>>ASSIGN   1802>>IF       1803>>IF       1804>>ASSIGN
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:33   
      1805>>ASSIGN   1819>>IF       1820>>IF       1830>>CALL     1841>>IF       1842>>CALL     1843>>ASSIGN
      1847>>IF       1848>>IF       1849>>CALL     1850>>ASSIGN   1854>>CALL     1872>>IF       1873>>CALL
      1874>>ASSIGN   1877>>IF       1878>>IF       1879>>CALL     1882>>CALL
DVSCH
      1631**DCL      1782<<ASSIGN   1783>>IF       1854>>CALL
HFC$LOCK
        58**DCL-ENT  1790--CALL     1811--CALL     1826--CALL
HFC$UNLOCK
        58**DCL-ENT  1807--CALL     1816--CALL     1838--CALL
I
      1632**DCL      1767<<ASSIGN   1770<>CALL     1773>>ASSIGN   1846<<DOINDEX  1847>>IF       1848>>IF
      1849>>CALL     1850>>ASSIGN   1884<>CALL     1889<>CALL
KEY
      1610**DCL         8--PROC     1884<>CALL
KEY.CADDR
      1612**DCL      1770<>CALL     1775<>CALL     1889<>CALL
KEY.DEVNM
      1613**DCL      1767>>IF       1770<>CALL     1775<>CALL
KEY.MSG#
      1611**DCL      1774>>IF       1778>>DOCASE   1787>>DOCASE   1863>>IF       1889<>CALL
N$DCT$
       604**DCL      1773>>ASSIGN
N$DCT$$
       470**DCL       604--IMP-PTR  1773>>ASSIGN
N$FQ$
       470**DCL       605--IMP-PTR
N$REQ_INIT.BUFADDR
       489**DCL       490--REDEF     490--REDEF
N$REQ_INIT.DLA.DRELADDR
       481**DCL       481--REDEF
N$REQ_INIT.DVE.EOMCHAR
       518**DCL       519--REDEF
N$REQ_INIT.EAINFO
       512**DCL       512--REDEF
N$REQ_INIT.EAINFOX
       512**DCL       513--REDEF
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:34   
N$REQ_INIT.EVNTINFO
       513**DCL       513--REDEF
N$REQ_INIT.STATUS
       494**DCL       500--REDEF
NI$DVT.DVSCH
      1689**DCL      1782>>ASSIGN
NI$DVT.MPC
      1691**DCL      1692--REDEF
NI$DVT.TYPE
      1689**DCL      1877>>IF
NI$FQ$
       530**DCL       606--IMP-PTR
NI$IBUF$
       530**DCL       606--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       540**DCL       541--REDEF     541--REDEF
NI$IMXMBX_INIT.SIZE
       542**DCL       542--REDEF
NI$REQ_INIT.DCW
       564**DCL       567--REDEF
NI$REQ_INIT.DCW.TALLY
       565**DCL       565--REDEF
NI$REQ_INIT.IDCW.EXTA
       567**DCL       567--REDEF
NI$REQ_INIT.PCW
       569**DCL       573--REDEF
NI$REQ_INIT.SEEK
       574**DCL       575--REDEF     576--REDEF
NI$RP$
       578**DCL       608--IMP-PTR
NIK$KIPND
      1617**DCL-ENT  1884--CALL
NIM$DEQUEUE
       633**DCL-ENT  1830--CALL     1860--CALL
NIO$COMP
      1618**DCL-ENT  1809--CALL     1869--CALL
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:35   
NIW$LDFW
      1619**DCL-ENT  1882--CALL
NI_MBX_INIT.DCW.CONTROL.AE
       600**DCL       600--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       596**DCL       596--REDEF
NO_REQ$
      1838**LABEL    1830--CALLALT
OCI$MK_STTM
      1620**DCL-ENT  1842--CALL     1849--CALL     1873--CALL     1879--CALL
OCI$MK_WR
      1621**DCL-ENT  1775--CALL     1889--CALL
OCMESS
      1884**LABEL    1781--GOTO     1783--GOTO     1822--GOTO     1872--GOTO     1877--GOTO     1882--CALLALT
OCMSG
      1633**DCL      1769<<ASSIGN   1772<<ASSIGN   1784<<ASSIGN   1821<<ASSIGN   1876<<ASSIGN   1881<<ASSIGN
      1889<>CALL
OCZ$DEV_DCT
      1622**DCL-ENT  1770--CALL
R$
      1634**DCL      1804<<ASSIGN   1809>>CALL     1860<>CALL     1864>>ASSIGN   1867>>ASSIGN   1869>>CALL
REQ
      1717**DCL      1809<>CALL     1869<>CALL
REQ.BUFADDR
      1726**DCL      1727--REDEF    1727--REDEF
REQ.DLA.DRELADDR
      1718**DCL      1718--REDEF
REQ.DVE.EOMCHAR
      1755**DCL      1756--REDEF
REQ.EAINFO
      1749**DCL      1749--REDEF
REQ.EAINFOX
      1749**DCL      1750--REDEF
REQ.EVNTINFO
      1750**DCL      1750--REDEF
REQ.FL$
PL6.E3A0      #001=NIK$KEYIN File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:32 Page:36   
      1717**DCL      1835<<ASSIGN
REQ.STATUS
      1731**DCL      1737--REDEF
REQ.TYC
      1739**DCL      1867<<ASSIGN
REQ.TYC.OPER
      1740**DCL      1864<<ASSIGN
REQ$
      1635**DCL      1786<<ASSIGN   1792<<ASSIGN   1830<>CALL     1835>>ASSIGN   1835>>ASSIGN   1855>>DOWHILE
      1860<>CALL
RET
      1884**LABEL    1770--CALLALT  1776--GOTO
SQH.DOOR
      1704**DCL      1704--REDEF
SQH.GATE
      1704**DCL      1790<>CALL     1807<>CALL     1811<>CALL     1816<>CALL     1826<>CALL     1838<>CALL
SQH.MPC$
      1706**DCL      1847>>IF       1848>>IF       1849>>CALL     1850>>ASSIGN
SQH$
      1636**DCL      1704--IMP-PTR  1785<<ASSIGN   1790>>CALL     1807>>CALL     1811>>CALL     1816>>CALL
      1826>>CALL     1838>>CALL

PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:37   
      190        1        /*T***********************************************************/
      191        2        /*T*                                                         */
      192        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      193        4        /*T*                                                         */
      194        5        /*T***********************************************************/
      195        6        NIK$OPMSG: PROC(NI$DCT,MSG,ATTR,STATE,N$REQ);
      196        7        /**/
      197        8        /*D*  NAME:   NIK$OPMSG
      198        9              ENVIRONMENT:  Monitor Linkage Segment.
      199       10              INTERFACE:  OCI$MK_WR
      200       11              INPUT:  DCT - Device Control Table for the offending device.
      201       12                      MSG - Message number to be output.
      202       13                      ATTR - Console attributes.
      203       14                      STATE - State device is to be placed in.
      204       15                      N$REQ - Current request packet.
      205       16              OUTPUT:  The message number is passed to KEYIN.
      206       17              DESCRIPTION:  NIK$OPMSG call OCI$MK_WR to write messages to
      207       18                            the operators console
      208       19        */
      209       20        %INCLUDE NI$TABLES;
      210      236        %INCLUDE N$REQ;
      211      310        %INCLUDE NI_DATA_C;
      212      423        %NI$DCT (STCLASS="");
      213      471    1   DCL MSG SBIN;
      214      472    1   DCL ATTR BIT(18) ALIGNED;
      215      473    1   DCL STATE SBIN;
      216      474        %N$REQ (STCLASS="");
      217      532    1   DCL MPC$ PTR;
      218      533        %NI$DCT (NAME=MPC,STCLASS="BASED(MPC$)");
      219      581    1   DCL DCT$ PTR;
      220      582        %NI$DCT (NAME=DCT,STCLASS="BASED(DCT$)");
      221      630        %NI$DQH (NAME=DQH,STCLASS=BASED);
      222      653    1   DCL TATTR BIT(18) ALIGNED;
      223      654    1   DCL DCTX SBIN;
      224      655    1   DCL 1 PARM ALIGNED,
      225      656    1         2 STATE SBIN,                     /* PARAMETER #1                       */
      226      657    1         2 STATUS,
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:38   
      227      658    1           3 WD1 BIT(36),                  /* PARAMETER #2                       */
      228      659    1           3 WD2 BIT(36),                  /* PARAMETER #3                       */
      229      660    1         2 MJSTAT UBIN BYTE UNAL,          /* PARAMETER #4                       */
      230      661    1         2 MNSTAT UBIN BYTE UNAL,          /* PARAMETER #5                       */
      231      662    1         2 ININT UBIN BYTE UNAL,           /* PARAMETER #6                       */
      232      663    1         2 IOMCHN UBIN BYTE UNAL,          /* PARAMETER #7                       */
      233      664    1         2 IOMCNT UBIN BYTE UNAL,          /* PARAMETER #8                       */
      234      665    1         2 MPCNM CHAR(4),                  /* PARAMETER #9                       */
      235      666    1         2 FBIT SBIN BYTE UNAL,            /* PARAMETER #10                      */
      236      667    1         2 LBIT SBIN BYTE UNAL;            /* PARAMETER #11                      */
      237      668    1   DCL LEN(0:10) UBIN BYTE UNAL CONSTANT INIT(4,4,4,1,1,1,1,1,4,1,1);
      238      669    1   DCL MSG# SBIN;
      239      670    1   DCL I SBIN;
      240      671    1   DCL MNSTAT(0:5) BIT(1);
      241      672        /**/
      242      673        %INCLUDE OC_SUBS_C;
      243     1404    1   DCL OCI$MK_WRTM ENTRY(8);
      244     1405    1   DCL OCI$MK_WR ENTRY(7);
      245     1406    1   DCL OCI$MK_STTM ENTRY(1);
      246     1407        /* BEGIN PROCEDURE */
      247     1408    1           PARM='0'B;
      248     1409    1           DCT$=ADDR(NI$DCT);
      249     1410    1           IF NI$DCT.STATUS.DOWN AND STATE~=%SPWAIT AND STATE~=%KIWAIT THEN RETURN;
      250     1411    1           DCTX=NI$DCT.DCTX;
      251     1412    1           IF DCT.DQH$->DQH.MPC$ ~= ADDR(NIL) THEN
      252     1413    1              MPC$=DCT.DQH$->DQH.MPC$;
      253     1414    1           ELSE                            /* DEVICES LIKE MCA DON'T HAVE AN MPC */
      254     1415    1              MPC$=DCT$;
      255     1416    1           IF ADDR(ATTR)=ADDR(NIL) THEN TATTR=M_DEVC;
      256     1417    1           ELSE TATTR=ATTR;
      257     1418    1           IF ADDR(STATE)=ADDR(NIL) THEN PARM.STATE=255;
      258     1419    1           ELSE PARM.STATE=STATE;
      259     1420    2           IF ADDR(N$REQ)~=ADDR(NIL) THEN DO;
      260     1421    2              PARM.STATUS=N$REQ.STATUS;
      261     1422    2              PARM.MJSTAT=N$REQ.STATUS.MAJOR;
      262     1423    2              PARM.MNSTAT=BITBIN(N$REQ.STATUS.MINOR);
      263     1424    2              PARM.ININT=BITBIN(N$REQ.STATUS.ININT);
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:39   
      264     1425    2              PARM.IOMCHN=N$REQ.STATUS.IOM.CHANNEL;
      265     1426    2              PARM.IOMCNT=N$REQ.STATUS.IOM.CENTRAL;
      266     1427    2              MNSTAT=N$REQ.STATUS.MINOR;
      267     1428    2              I=0;
      268     1429    3              DO WHILE(I<6 AND NOT MNSTAT(I));
      269     1430    3                 I=I+1;
      270     1431    3                 END;
      271     1432    2              PARM.FBIT=I;
      272     1433    2              I=5;
      273     1434    3              DO WHILE(I>=0 AND NOT MNSTAT(I));
      274     1435    3                 I=I-1;
      275     1436    3                 END;
      276     1437    2              IF I<0 THEN PARM.LBIT=6;
      277     1438    2              ELSE PARM.LBIT=I;
      278     1439    2              END;
      279     1440    1           MSG#=MSG;
      280     1441    1           PARM.MPCNM=MPC.DEVNM;
      281     1442    2           IF ADDR(N$REQ) ~= ADDR(NIL) THEN DO ;
      282     1443    2              IF N$REQ.STATUS.POWEROFF THEN GOTO PWROFF ;
      283     1444    3              ELSE IF N$REQ.STATUS.IOM THEN DO ;
      284     1445    3                    MSG# = IOM_MSG# ;
      285     1446    3                    END ;
      286     1447    2              END ;
      287     1448    2           ELSE DO ;
      288     1449    2   PWROFF:    PARM.MPCNM = NI$DCT.DEVNM ;
      289     1450    2              DCTX       = MPC.DCTX ;
      290     1451    2              MSG#       = POWEROFF_MSG# ;
      291     1452    2              DCT$       = MPC$ ;
      292     1453    2              END ;
      293     1454    2           IF PARM.STATE=%SPWAIT OR PARM.STATE=%KIWAIT THEN DO;
      294     1455    2              IF DCT.MSG#>0 THEN CALL OCI$MK_STTM(DCT.MSG#);
      295     1456    2              CALL OCI$MK_WRTM(TATTR,MSG#,11,LEN,PARM,DCTX,,DCT.MSG#);
      296     1457    2              END;
      297     1458    1           ELSE CALL OCI$MK_WR(TATTR,MSG#,11,LEN,PARM,DCTX);
      298     1459    1           RETURN;
      299     1460    1   END NIK$OPMSG;
      300     1461        %EOD;
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:40   

PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:41   
--  Include file information  --

   OC_SUBS_C.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
      No diagnostics issued in procedure NIK$OPMSG.

   Procedure NIK$OPMSG requires 195 words for executable code.
   Procedure NIK$OPMSG requires 30 words of local(AUTO) storage.

PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:42   

 Object Unit name= NIK$OPMSG                                  File name= NIK$KEYIN.:E05TOU
 UTS= JUL 30 '97 03:33:09.92 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      3      3  NIK$OPMSG
    1   Proc  even  none   195    303  NIK$OPMSG
    2  RoData even  none     4      4  NIK$OPMSG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        5  NIK$OPMSG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 OCI$MK_STTM
         yes           Std       8 OCI$MK_WRTM
         yes           Std       7 OCI$MK_WR
                       nStd      0 X66_AUTO_5
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B_VECTNIL
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:43   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:44   


      190        1        /*T***********************************************************/
      191        2        /*T*                                                         */
      192        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      193        4        /*T*                                                         */
      194        5        /*T***********************************************************/
      195        6        NIK$OPMSG: PROC(NI$DCT,MSG,ATTR,STATE,N$REQ);

      6  1 000000   000000 700200 xent  NIK$OPMSG    TSX0  ! X66_AUTO_5
         1 000001   000036 000005                    ZERO    30,5

      196        7        /**/
      197        8        /*D*  NAME:   NIK$OPMSG
      198        9              ENVIRONMENT:  Monitor Linkage Segment.
      199       10              INTERFACE:  OCI$MK_WR
      200       11              INPUT:  DCT - Device Control Table for the offending device.
      201       12                      MSG - Message number to be output.
      202       13                      ATTR - Console attributes.
      203       14                      STATE - State device is to be placed in.
      204       15                      N$REQ - Current request packet.
      205       16              OUTPUT:  The message number is passed to KEYIN.
      206       17              DESCRIPTION:  NIK$OPMSG call OCI$MK_WR to write messages to
      207       18                            the operators console
      208       19        */
      209       20        %INCLUDE NI$TABLES;
      210      236        %INCLUDE N$REQ;
      211      310        %INCLUDE NI_DATA_C;
      212      423        %NI$DCT (STCLASS="");
      213      471    1   DCL MSG SBIN;
      214      472    1   DCL ATTR BIT(18) ALIGNED;
      215      473    1   DCL STATE SBIN;
      216      474        %N$REQ (STCLASS="");
      217      532    1   DCL MPC$ PTR;
      218      533        %NI$DCT (NAME=MPC,STCLASS="BASED(MPC$)");
      219      581    1   DCL DCT$ PTR;
      220      582        %NI$DCT (NAME=DCT,STCLASS="BASED(DCT$)");
      221      630        %NI$DQH (NAME=DQH,STCLASS=BASED);
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:45   
      222      653    1   DCL TATTR BIT(18) ALIGNED;
      223      654    1   DCL DCTX SBIN;
      224      655    1   DCL 1 PARM ALIGNED,
      225      656    1         2 STATE SBIN,                     /* PARAMETER #1                       */
      226      657    1         2 STATUS,
      227      658    1           3 WD1 BIT(36),                  /* PARAMETER #2                       */
      228      659    1           3 WD2 BIT(36),                  /* PARAMETER #3                       */
      229      660    1         2 MJSTAT UBIN BYTE UNAL,          /* PARAMETER #4                       */
      230      661    1         2 MNSTAT UBIN BYTE UNAL,          /* PARAMETER #5                       */
      231      662    1         2 ININT UBIN BYTE UNAL,           /* PARAMETER #6                       */
      232      663    1         2 IOMCHN UBIN BYTE UNAL,          /* PARAMETER #7                       */
      233      664    1         2 IOMCNT UBIN BYTE UNAL,          /* PARAMETER #8                       */
      234      665    1         2 MPCNM CHAR(4),                  /* PARAMETER #9                       */
      235      666    1         2 FBIT SBIN BYTE UNAL,            /* PARAMETER #10                      */
      236      667    1         2 LBIT SBIN BYTE UNAL;            /* PARAMETER #11                      */
      237      668    1   DCL LEN(0:10) UBIN BYTE UNAL CONSTANT INIT(4,4,4,1,1,1,1,1,4,1,1);
      238      669    1   DCL MSG# SBIN;
      239      670    1   DCL I SBIN;
      240      671    1   DCL MNSTAT(0:5) BIT(1);
      241      672        /**/
      242      673        %INCLUDE OC_SUBS_C;
      243     1404    1   DCL OCI$MK_WRTM ENTRY(8);
      244     1405    1   DCL OCI$MK_WR ENTRY(7);
      245     1406    1   DCL OCI$MK_STTM ENTRY(1);
      246     1407        /* BEGIN PROCEDURE */
      247     1408    1           PARM='0'B;

   1408  1 000002   000100 100400                    MLR     fill='000'O
         1 000003   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000004   200014 000027                    ADSC9   PARM,,AUTO               cn=0,n=23

      248     1409    1           DCT$=ADDR(NI$DCT);

   1409  1 000005   200003 236100                    LDQ     @NI$DCT,,AUTO
         1 000006   200011 756100                    STQ     DCT$,,AUTO

      249     1410    1           IF NI$DCT.STATUS.DOWN AND STATE~=%SPWAIT AND STATE~=%KIWAIT THEN RETURN;
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:46   

   1410  1 000007   200003 470500                    LDP0    @NI$DCT,,AUTO
         1 000010   000027 234100                    SZN     23,,PR0
         1 000011   000021 605000 1                  TPL     s:1411
         1 000012   200006 471500                    LDP1    @STATE,,AUTO
         1 000013   100000 235100                    LDA     0,,PR1
         1 000014   000003 115007                    CMPA    3,DL
         1 000015   000021 600000 1                  TZE     s:1411
         1 000016   000004 115007                    CMPA    4,DL
         1 000017   000021 600000 1                  TZE     s:1411

   1410  1 000020   000000 702200 xent               TSX2  ! X66_ARET

      250     1411    1           DCTX=NI$DCT.DCTX;

   1411  1 000021   000006 236100                    LDQ     6,,PR0
         1 000022   000025 772000                    QRL     21
         1 000023   200013 756100                    STQ     DCTX,,AUTO

      251     1412    1           IF DCT.DQH$->DQH.MPC$ ~= ADDR(NIL) THEN

   1412  1 000024   200011 471500                    LDP1    DCT$,,AUTO
         1 000025   100023 473500                    LDP3    19,,PR1
         1 000026   300015 236100                    LDQ     13,,PR3
         1 000027   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000030   000033 600000 1                  TZE     s:1415

      252     1413    1              MPC$=DCT.DQH$->DQH.MPC$;

   1413  1 000031   200010 756100                    STQ     MPC$,,AUTO
         1 000032   000035 710000 1                  TRA     s:1416

      253     1414    1           ELSE                            /* DEVICES LIKE MCA DON'T HAVE AN MPC */
      254     1415    1              MPC$=DCT$;

   1415  1 000033   200011 236100                    LDQ     DCT$,,AUTO
         1 000034   200010 756100                    STQ     MPC$,,AUTO
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:47   

      255     1416    1           IF ADDR(ATTR)=ADDR(NIL) THEN TATTR=M_DEVC;

   1416  1 000035   200005 236100                    LDQ     @ATTR,,AUTO
         1 000036   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000037   000043 601000 1                  TNZ     s:1417

   1416  1 000040   100000 220003                    LDX0    32768,DU
         1 000041   200012 740100                    STX0    TATTR,,AUTO
         1 000042   000046 710000 1                  TRA     s:1418

      256     1417    1           ELSE TATTR=ATTR;

   1417  1 000043   200005 474500                    LDP4    @ATTR,,AUTO
         1 000044   400000 220100                    LDX0    0,,PR4
         1 000045   200012 740100                    STX0    TATTR,,AUTO

      257     1418    1           IF ADDR(STATE)=ADDR(NIL) THEN PARM.STATE=255;

   1418  1 000046   200006 236100                    LDQ     @STATE,,AUTO
         1 000047   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000050   000054 601000 1                  TNZ     s:1419

   1418  1 000051   000377 235007                    LDA     255,DL
         1 000052   200014 755100                    STA     PARM,,AUTO
         1 000053   000057 710000 1                  TRA     s:1420

      258     1419    1           ELSE PARM.STATE=STATE;

   1419  1 000054   200006 474500                    LDP4    @STATE,,AUTO
         1 000055   400000 235100                    LDA     0,,PR4
         1 000056   200014 755100                    STA     PARM,,AUTO

      259     1420    2           IF ADDR(N$REQ)~=ADDR(NIL) THEN DO;

   1420  1 000057   200007 236100                    LDQ     @N$REQ,,AUTO
         1 000060   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:48   
         1 000061   000164 600000 1                  TZE     s:1440

      260     1421    2              PARM.STATUS=N$REQ.STATUS;

   1421  1 000062   200007 474500                    LDP4    @N$REQ,,AUTO
         1 000063   400014 237100                    LDAQ    12,,PR4
         1 000064   200015 755100                    STA     PARM+1,,AUTO
         1 000065   200016 756100                    STQ     PARM+2,,AUTO

      261     1422    2              PARM.MJSTAT=N$REQ.STATUS.MAJOR;

   1422  1 000066   400014 236100                    LDQ     12,,PR4
         1 000067   170000 376003                    ANQ     61440,DU
         1 000070   000003 772000                    QRL     3
         1 000071   200017 552140                    STBQ    PARM+3,'40'O,AUTO

      262     1423    2              PARM.MNSTAT=BITBIN(N$REQ.STATUS.MINOR);

   1423  1 000072   400014 236100                    LDQ     12,,PR4
         1 000073   000030 772000                    QRL     24
         1 000074   000077 376007                    ANQ     63,DL
         1 000075   000022 736000                    QLS     18
         1 000076   200017 552120                    STBQ    PARM+3,'20'O,AUTO

      263     1424    2              PARM.ININT=BITBIN(N$REQ.STATUS.ININT);

   1424  1 000077   400014 236100                    LDQ     12,,PR4
         1 000100   000023 772000                    QRL     19
         1 000101   000001 376007                    ANQ     1,DL
         1 000102   000011 736000                    QLS     9
         1 000103   200017 552110                    STBQ    PARM+3,'10'O,AUTO

      264     1425    2              PARM.IOMCHN=N$REQ.STATUS.IOM.CHANNEL;

   1425  1 000104   400014 236100                    LDQ     12,,PR4
         1 000105   700000 376007                    ANQ     -32768,DL
         1 000106   000017 772000                    QRL     15
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:49   
         1 000107   200017 552104                    STBQ    PARM+3,'04'O,AUTO

      265     1426    2              PARM.IOMCNT=N$REQ.STATUS.IOM.CENTRAL;

   1426  1 000110   400014 236100                    LDQ     12,,PR4
         1 000111   070000 376007                    ANQ     28672,DL
         1 000112   000017 736000                    QLS     15
         1 000113   200020 552140                    STBQ    PARM+4,'40'O,AUTO

      266     1427    2              MNSTAT=N$REQ.STATUS.MINOR;

   1427  1 000114   400014 236100                    LDQ     12,,PR4
         1 000115   000006 736000                    QLS     6
         1 000116   200024 752140                    STCQ    MNSTAT,'40'O,AUTO

      267     1428    2              I=0;

   1428  1 000117   200023 450100                    STZ     I,,AUTO

      268     1429    3              DO WHILE(I<6 AND NOT MNSTAT(I));

   1429  1 000120   000122 710000 1                  TRA     s:1431

      269     1430    3                 I=I+1;

   1430  1 000121   200023 054100                    AOS     I,,AUTO

      270     1431    3                 END;

   1431  1 000122   200023 235100                    LDA     I,,AUTO
         1 000123   000006 115007                    CMPA    6,DL
         1 000124   000134 605000 1                  TPL     s:1432
         1 000125   000000 115003                    CMPA    0,DU
         1 000126   000130 605000 1                  TPL     s:1431+6
         1 000127   000044 035003                    ADLA    36,DU
         1 000130   000000 066505                    CMPB    filb='0'B
         1 000131   200024 000001                    BDSC    MNSTAT,A,AUTO            by=0,bit=0,n=1
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:50   
         1 000132   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000133   000121 600000 1                  TZE     s:1430

      271     1432    2              PARM.FBIT=I;

   1432  1 000134   200023 236100                    LDQ     I,,AUTO
         1 000135   000022 736000                    QLS     18
         1 000136   200021 552120                    STBQ    PARM+5,'20'O,AUTO

      272     1433    2              I=5;

   1433  1 000137   000005 235007                    LDA     5,DL
         1 000140   200023 755100                    STA     I,,AUTO

      273     1434    3              DO WHILE(I>=0 AND NOT MNSTAT(I));

   1434  1 000141   000144 710000 1                  TRA     s:1436

      274     1435    3                 I=I-1;

   1435  1 000142   000001 336007                    LCQ     1,DL
         1 000143   200023 056100                    ASQ     I,,AUTO

      275     1436    3                 END;

   1436  1 000144   200023 235100                    LDA     I,,AUTO
         1 000145   000154 604000 1                  TMI     s:1437
         1 000146   000150 605000 1                  TPL     s:1436+4
         1 000147   000044 035003                    ADLA    36,DU
         1 000150   000000 066505                    CMPB    filb='0'B
         1 000151   200024 000001                    BDSC    MNSTAT,A,AUTO            by=0,bit=0,n=1
         1 000152   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000153   000142 600000 1                  TZE     s:1435

      276     1437    2              IF I<0 THEN PARM.LBIT=6;

   1437  1 000154   200023 235100                    LDA     I,,AUTO
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:51   
         1 000155   000161 605000 1                  TPL     s:1438

   1437  1 000156   006000 236007                    LDQ     3072,DL
         1 000157   200021 552110                    STBQ    PARM+5,'10'O,AUTO
         1 000160   000164 710000 1                  TRA     s:1440

      277     1438    2              ELSE PARM.LBIT=I;

   1438  1 000161   200023 236100                    LDQ     I,,AUTO
         1 000162   000011 736000                    QLS     9
         1 000163   200021 552110                    STBQ    PARM+5,'10'O,AUTO

      278     1439    2              END;

      279     1440    1           MSG#=MSG;

   1440  1 000164   200004 470500                    LDP0    @MSG,,AUTO
         1 000165   000000 235100                    LDA     0,,PR0
         1 000166   200022 755100                    STA     MSG#,,AUTO

      280     1441    1           PARM.MPCNM=MPC.DEVNM;

   1441  1 000167   200010 471500                    LDP1    MPC$,,AUTO
         1 000170   040100 100500                    MLR     fill='040'O
         1 000171   100002 000004                    ADSC9   2,,PR1                   cn=0,n=4
         1 000172   200020 200004                    ADSC9   PARM+4,,AUTO             cn=1,n=4

      281     1442    2           IF ADDR(N$REQ) ~= ADDR(NIL) THEN DO ;

   1442  1 000173   200007 236100                    LDQ     @N$REQ,,AUTO
         1 000174   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000175   000207 600000 1                  TZE     PWROFF

      282     1443    2              IF N$REQ.STATUS.POWEROFF THEN GOTO PWROFF ;

   1443  1 000176   200007 473500                    LDP3    @N$REQ,,AUTO
         1 000177   300014 236100                    LDQ     12,,PR3
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:52   
         1 000200   200000 316003                    CANQ    65536,DU
         1 000201   000207 601000 1                  TNZ     PWROFF

      283     1444    3              ELSE IF N$REQ.STATUS.IOM THEN DO ;

   1444  1 000202   770000 316007                    CANQ    -4096,DL
         1 000203   000222 600000 1                  TZE     s:1454

      284     1445    3                    MSG# = IOM_MSG# ;

   1445  1 000204   000223 235007                    LDA     147,DL
         1 000205   200022 755100                    STA     MSG#,,AUTO

      285     1446    3                    END ;

      286     1447    2              END ;

   1447  1 000206   000222 710000 1                  TRA     s:1454

      287     1448    2           ELSE DO ;

      288     1449    2   PWROFF:    PARM.MPCNM = NI$DCT.DEVNM ;

   1449  1 000207   200003 473500       PWROFF       LDP3    @NI$DCT,,AUTO
         1 000210   040100 100500                    MLR     fill='040'O
         1 000211   300002 000004                    ADSC9   2,,PR3                   cn=0,n=4
         1 000212   200020 200004                    ADSC9   PARM+4,,AUTO             cn=1,n=4

      289     1450    2              DCTX       = MPC.DCTX ;

   1450  1 000213   100006 236100                    LDQ     6,,PR1
         1 000214   000025 772000                    QRL     21
         1 000215   200013 756100                    STQ     DCTX,,AUTO

      290     1451    2              MSG#       = POWEROFF_MSG# ;

   1451  1 000216   000224 235007                    LDA     148,DL
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:53   
         1 000217   200022 755100                    STA     MSG#,,AUTO

      291     1452    2              DCT$       = MPC$ ;

   1452  1 000220   200010 236100                    LDQ     MPC$,,AUTO
         1 000221   200011 756100                    STQ     DCT$,,AUTO

      292     1453    2              END ;

      293     1454    2           IF PARM.STATE=%SPWAIT OR PARM.STATE=%KIWAIT THEN DO;

   1454  1 000222   200014 236100                    LDQ     PARM,,AUTO
         1 000223   000003 116007                    CMPQ    3,DL
         1 000224   000227 600000 1                  TZE     s:1455
         1 000225   000004 116007                    CMPQ    4,DL
         1 000226   000264 601000 1                  TNZ     s:1458

      294     1455    2              IF DCT.MSG#>0 THEN CALL OCI$MK_STTM(DCT.MSG#);

   1455  1 000227   200011 473500                    LDP3    DCT$,,AUTO
         1 000230   300027 720100                    LXL0    23,,PR3
         1 000231   000241 600000 1                  TZE     s:1456

   1455  1 000232   200011 236100                    LDQ     DCT$,,AUTO
         1 000233   000000 036000 2                  ADLQ    0
         1 000234   200026 756100                    STQ     MNSTAT+2,,AUTO
         1 000235   200026 630500                    EPPR0   MNSTAT+2,,AUTO
         1 000236   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000237   000000 701000 xent               TSX1    OCI$MK_STTM
         1 000240   000000 011000                    NOP     0

      295     1456    2              CALL OCI$MK_WRTM(TATTR,MSG#,11,LEN,PARM,DCTX,,DCT.MSG#);

   1456  1 000241   200011 236100                    LDQ     DCT$,,AUTO
         1 000242   000000 036000 2                  ADLQ    0
         1 000243   000001 235000 xsym               LDA     B_VECTNIL+1
         1 000244   200034 757100                    STAQ    MNSTAT+8,,AUTO
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:54   
         1 000245   200013 630500                    EPPR0   DCTX,,AUTO
         1 000246   200033 450500                    STP0    MNSTAT+7,,AUTO
         1 000247   200014 631500                    EPPR1   PARM,,AUTO
         1 000250   200032 451500                    STP1    MNSTAT+6,,AUTO
         1 000251   000002 237000 2                  LDAQ    2
         1 000252   200030 757100                    STAQ    MNSTAT+4,,AUTO
         1 000253   200022 633500                    EPPR3   MSG#,,AUTO
         1 000254   200027 453500                    STP3    MNSTAT+3,,AUTO
         1 000255   200012 634500                    EPPR4   TATTR,,AUTO
         1 000256   200026 454500                    STP4    MNSTAT+2,,AUTO
         1 000257   200026 630500                    EPPR0   MNSTAT+2,,AUTO
         1 000260   000026 631400 xsym               EPPR1   B_VECTNIL+22
         1 000261   000000 701000 xent               TSX1    OCI$MK_WRTM
         1 000262   000000 011000                    NOP     0

      296     1457    2              END;

   1457  1 000263   000302 710000 1                  TRA     s:1459

      297     1458    1           ELSE CALL OCI$MK_WR(TATTR,MSG#,11,LEN,PARM,DCTX);

   1458  1 000264   200013 633500                    EPPR3   DCTX,,AUTO
         1 000265   200033 453500                    STP3    MNSTAT+7,,AUTO
         1 000266   200014 634500                    EPPR4   PARM,,AUTO
         1 000267   200032 454500                    STP4    MNSTAT+6,,AUTO
         1 000270   000002 237000 2                  LDAQ    2
         1 000271   200030 757100                    STAQ    MNSTAT+4,,AUTO
         1 000272   200022 635500                    EPPR5   MSG#,,AUTO
         1 000273   200027 455500                    STP5    MNSTAT+3,,AUTO
         1 000274   200012 636500                    EPPR6   TATTR,,AUTO
         1 000275   200026 456500                    STP6    MNSTAT+2,,AUTO
         1 000276   200026 630500                    EPPR0   MNSTAT+2,,AUTO
         1 000277   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000300   000000 701000 xent               TSX1    OCI$MK_WR
         1 000301   000000 011000                    NOP     0

      298     1459    1           RETURN;
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:55   

   1459  1 000302   000000 702200 xent               TSX2  ! X66_ARET

LEN
 Sect OctLoc
   0     000   004004 004001   001001 001001   004001 001***                    ............

(unnamed)
 Sect OctLoc
   2     000   000027 400000   000000 000000   000015 006000   000000 006000    ................
      299     1460    1   END NIK$OPMSG;
      300     1461        %EOD;

PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:56   
--  Include file information  --

   OC_SUBS_C.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
      No diagnostics issued in procedure NIK$OPMSG.
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:57   

 **** Variables and constants ****

  ****  Section 000 RoData NIK$OPMSG

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b UBIN(9)     r     1 LEN(0:10)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @ATTR                      4-0-0/w PTR         r     1 @MSG
     7-0-0/w PTR         r     1 @N$REQ                     3-0-0/w PTR         r     1 @NI$DCT
     6-0-0/w PTR         r     1 @STATE                    *0-0-0/w BIT (18)    r     1 ATTR
    11-0-0/w PTR         r     1 DCT$                      13-0-0/w SBIN        r     1 DCTX
    23-0-0/w SBIN        r     1 I                         24-0-0/b BIT         r     1 MNSTAT(0:5)
    10-0-0/w PTR         r     1 MPC$                      *0-0-0/w SBIN        r     1 MSG
    22-0-0/w SBIN        r     1 MSG#                      *0-0-0/d STRC(1080)  r     1 N$REQ
    *0-0-0/w STRC(1332)  r     1 NI$DCT                    14-0-0/w STRC(207)   r     1 PARM
    *0-0-0/w SBIN        r     1 STATE                     12-0-0/w BIT (18)    r     1 TATTR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(648)   r     1 DQH
     0-0-0/w STRC(1332)  r     1 MPC


   Procedure NIK$OPMSG requires 195 words for executable code.
   Procedure NIK$OPMSG requires 30 words of local(AUTO) storage.
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:58   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:59   
          MINI XREF LISTING

ATTR
       472**DCL         6--PROC     1416--IF       1417>>ASSIGN
DCT.DP
       611**DCL       618--REDEF     621--REDEF     622--REDEF     624--REDEF     624--REDEF     625--REDEF
       626--REDEF     626--REDEF
DCT.DQH$
       607**DCL      1412>>IF       1413>>ASSIGN
DCT.MPC.IOCHANX
       619**DCL       619--REDEF
DCT.MSG#
       611**DCL      1455>>IF       1455<>CALL     1456<>CALL
DCT$
       581**DCL       591--IMP-PTR  1409<<ASSIGN   1412>>IF       1413>>ASSIGN   1415>>ASSIGN   1452<<ASSIGN
      1455>>IF       1455>>CALL     1456>>CALL
DCTX
       654**DCL      1411<<ASSIGN   1450<<ASSIGN   1456<>CALL     1458<>CALL
DQH.IOCHANX
       641**DCL       642--REDEF
DQH.MBX$
       650**DCL       651--REDEF
DQH.MPC$
       646**DCL      1412>>IF       1413>>ASSIGN
I
       670**DCL      1428<<ASSIGN   1429>>DOWHILE  1429>>DOWHILE  1430<<ASSIGN   1430>>ASSIGN   1432>>ASSIGN
      1433<<ASSIGN   1434>>DOWHILE  1434>>DOWHILE  1435<<ASSIGN   1435>>ASSIGN   1437>>IF       1438>>ASSIGN
LEN
       668**DCL      1456<>CALL     1458<>CALL
MNSTAT
       671**DCL      1427<<ASSIGN   1429>>DOWHILE  1434>>DOWHILE
MPC.DCTX
       543**DCL      1450>>ASSIGN
MPC.DEVNM
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:60   
       542**DCL      1441>>ASSIGN
MPC.DP
       562**DCL       569--REDEF     572--REDEF     573--REDEF     575--REDEF     575--REDEF     576--REDEF
       577--REDEF     577--REDEF
MPC.MPC.IOCHANX
       570**DCL       570--REDEF
MPC$
       532**DCL       542--IMP-PTR  1413<<ASSIGN   1415<<ASSIGN   1441>>ASSIGN   1450>>ASSIGN   1452>>ASSIGN
MSG
       471**DCL         6--PROC     1440>>ASSIGN
MSG#
       669**DCL      1440<<ASSIGN   1445<<ASSIGN   1451<<ASSIGN   1456<>CALL     1458<>CALL
N$REQ
       483**DCL         6--PROC     1420--IF       1442--IF
N$REQ.BUFADDR
       492**DCL       493--REDEF     493--REDEF
N$REQ.DLA.DRELADDR
       484**DCL       484--REDEF
N$REQ.DVE.EOMCHAR
       521**DCL       522--REDEF
N$REQ.EAINFO
       515**DCL       515--REDEF
N$REQ.EAINFOX
       515**DCL       516--REDEF
N$REQ.EVNTINFO
       516**DCL       516--REDEF
N$REQ.STATUS
       497**DCL       503--REDEF    1421>>ASSIGN
N$REQ.STATUS.ININT
       499**DCL      1424>>ASSIGN
N$REQ.STATUS.IOM
       500**DCL      1444>>IF
N$REQ.STATUS.IOM.CENTRAL
       500**DCL      1426>>ASSIGN
N$REQ.STATUS.IOM.CHANNEL
       500**DCL      1425>>ASSIGN
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:61   
N$REQ.STATUS.MAJOR
       497**DCL      1422>>ASSIGN
N$REQ.STATUS.MINOR
       498**DCL      1423>>ASSIGN   1427>>ASSIGN
N$REQ.STATUS.POWEROFF
       497**DCL      1443>>IF
NI$DCT
       432**DCL         6--PROC     1409--ASSIGN
NI$DCT.DCTX
       433**DCL      1411>>ASSIGN
NI$DCT.DEVNM
       432**DCL      1449>>ASSIGN
NI$DCT.DP
       452**DCL       459--REDEF     462--REDEF     463--REDEF     465--REDEF     465--REDEF     466--REDEF
       467--REDEF     467--REDEF
NI$DCT.MPC.IOCHANX
       460**DCL       460--REDEF
NI$DCT.STATUS.DOWN
       449**DCL      1410>>IF
OCI$MK_STTM
      1406**DCL-ENT  1455--CALL
OCI$MK_WR
      1405**DCL-ENT  1458--CALL
OCI$MK_WRTM
      1404**DCL-ENT  1456--CALL
PARM
       655**DCL      1408<<ASSIGN   1456<>CALL     1458<>CALL
PARM.FBIT
       666**DCL      1432<<ASSIGN
PARM.ININT
       662**DCL      1424<<ASSIGN
PARM.IOMCHN
       663**DCL      1425<<ASSIGN
PARM.IOMCNT
       664**DCL      1426<<ASSIGN
PARM.LBIT
PL6.E3A0      #002=NIK$OPMSG File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:62   
       667**DCL      1437<<ASSIGN   1438<<ASSIGN
PARM.MJSTAT
       660**DCL      1422<<ASSIGN
PARM.MNSTAT
       661**DCL      1423<<ASSIGN
PARM.MPCNM
       665**DCL      1441<<ASSIGN   1449<<ASSIGN
PARM.STATE
       656**DCL      1418<<ASSIGN   1419<<ASSIGN   1454>>IF       1454>>IF
PARM.STATUS
       657**DCL      1421<<ASSIGN
PWROFF
      1449**LABEL    1443--GOTO
STATE
       473**DCL         6--PROC     1410>>IF       1410>>IF       1418--IF       1419>>ASSIGN
TATTR
       653**DCL      1416<<ASSIGN   1417<<ASSIGN   1456<>CALL     1458<>CALL

PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:63   
      301        1        /*T***********************************************************/
      302        2        /*T*                                                         */
      303        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      304        4        /*T*                                                         */
      305        5        /*T***********************************************************/
      306        6        NIK$KIPND: PROC(KEY,DCTX);
      307        7        /**/
      308        8        /*P*    NAME: NIK$KIPND
      309        9                PURPOSE:  Every hour NIK$KIPND looks at all of the
      310       10                          DCTs for local devices and puts out a keyin pending
      311       11                          message for any device in SPWAIT, KIWAIT or MPCWAIT
      312       12                          state.                                           */
      313       13        /*
      314       14                Includes
      315       15        */
      316       16        %INCLUDE                NI_DATA_C ;
      317      129        %INCLUDE                NI_DATA_R ;
      318      566        %INCLUDE                NK$LDCT ;
      319      668        %INCLUDE                OC_SUBS_C ;
      320     1399        /*
      321     1400                Parameters
      322     1401        */
      323     1402    1   DCL DCTX                SBIN PARAM ;
      324     1403    1   DCL 1 KEY               ALIGNED PARAM,
      325     1404    1         2 MSG#            UBIN HALF UNAL,
      326     1405    1         2 CADDR           BIT(18) UNAL,
      327     1406    1         2 DEVNM           CHAR(8),
      328     1407    1         2 DNM             REDEF DEVNM,
      329     1408    1           3 D             CHAR(4),
      330     1409    1           3 TWSN          CHAR(4) ;
      331     1410        %INCLUDE XUD_UTS_M;
      332     1492        %XUD_UTS_EQU;
      333     1503        /*
      334     1504                Entries
      335     1505        */
      336     1506    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
      337     1507    1   DCL 1 SSC$MONTIMR       ENTRY(3) ;
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:64   
      338     1508    1   DCL 1 SSS$CURTIME       ENTRY(1) ;
      339     1509        /*
      340     1510                Symrefs
      341     1511        */
      342     1512    1   DCL 1 NK_MXLOCAL        SBIN SYMREF ;
      343     1513    1   DCL 1 NK_MXTOTAL        SBIN SYMREF ;
      344     1514        /*
      345     1515                Auto
      346     1516        */
      347     1517    1   DCL 1 CADDR             BIT(18) ALIGNED AUTO;
      348     1518    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      349     1519    1   DCL 1 FDCTX             SBIN ALIGNED AUTO ;
      350     1520    1   DCL 1 I                 SBIN ALIGNED AUTO ;
      351     1521    1   DCL NEXT_HOUR UBIN WORD;
      352     1522    1   DCL 1 LDCTX             SBIN ALIGNED AUTO ;
      353     1523    1   DCL 1 NMSG              SBIN ALIGNED AUTO ;
      354     1524    1   DCL 1 PARM              ALIGNED AUTO,
      355     1525    1         2 STATE           SBIN,
      356     1526    1         2 MPC1            CHAR(4),
      357     1527    1         2 MPC2            CHAR(4) ;
      358     1528        /*
      359     1529                Based
      360     1530        */
      361     1531        %NI$DCT                 ( NAME=DCT,     STCLASS="BASED(DCT$)" ) ;
      362     1579        %NI$SQH                 ( NAME=SQH,     STCLASS=BASED ) ;
      363     1592        %NK$LDCT                ( NAME=NK$LDCT, STCLASS="BASED(DCT$)" ) ;
      364     1638        /*
      365     1639                Constant
      366     1640        */
      367     1641        %EQU INTERVAL=60*60*100;                /* ONE HOUR */
      368     1642    1   DCL LEN(0:2) UBIN BYTE UNAL CONSTANT INIT(4,4,4);
      369     1643        %EJECT;
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:65   
      370     1644    1           IF KEY.CADDR='0'B THEN CADDR=M_DEVC;
      371     1645    1           ELSE CADDR=KEY.CADDR;
      372     1646    1           FDCTX=1;
      373     1647    1           LDCTX=NK_MXTOTAL;
      374     1648    2           IF ADDR(DCTX)~=ADDR(NIL) THEN DO;
      375     1649    3              IF N$DCT$(DCTX)~=ADDR(NIL) THEN DO;
      376     1650    3                 FDCTX=DCTX;
      377     1651    3                 LDCTX=DCTX;
      378     1652    3                 END;
      379     1653    2              END;
      380     1654    1           NMSG=0;
      381     1655    2           DO I=FDCTX TO LDCTX;
      382     1656    2              DCT$=N$DCT$(I);
      383     1657    2              IF DCT$~=ADDR(NIL)
      384     1658    2              THEN IF I<=NK_MXLOCAL
      385     1659    3                 THEN DO CASE(DCT.STATE);
      386     1660    3                  CASE(%SPWAIT,%KIWAIT,%MPCWAIT);
      387     1661    3                    IF KEY.MSG#=0 OR KEY.DNM.TWSN=SUBSTR(DCT.DEVNM,4,4)
      388     1662    4                    THEN DO;
      389     1663    4                       PARM.STATE=DCT.STATE;
      390     1664    4                       IF DCT.SQH$->SQH.MPC$(0)=ADDR(NIL) THEN
      391     1665    4                          PARM.MPC1=' ';
      392     1666    4                       ELSE
      393     1667    4                          PARM.MPC1=DCT.SQH$->SQH.MPC$(0)->DCT.DEVNM;
      394     1668    4                       IF DCT.SQH$->SQH.MPC$(1)=ADDR(NIL) THEN
      395     1669    4                          PARM.MPC2=' ';
      396     1670    4                       ELSE
      397     1671    4                          PARM.MPC2=DCT.SQH$->SQH.MPC$(1)->DCT.DEVNM;
      398     1672    4                       CALL OCI$MK_WR(CADDR,KIPND_MSG#,3,LEN,PARM,I);
      399     1673    4                       NMSG=NMSG+1;
      400     1674    4                       END;
      401     1675    3                  CASE(ELSE);
      402     1676    3                    IF DCT.TYPE=%DV_MPC AND DCT.DFLG.MPCSTOP AND
      403     1677    4                      NOT DCT.STATUS.DOWN THEN DO;
      404     1678    4                       PARM.STATE=10;
      405     1679    4                       CALL OCI$MK_WR(CADDR,KIPND_MSG#,3,LEN,PARM,I);
      406     1680    4                       END;
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:66   
      407     1681    3                  END;
      408     1682    2              END;
      409     1683    2           IF KEY.MSG#=0 THEN DO;
      410     1684    2              CALL SSS$CURTIME(NEXT_HOUR);
      411     1685        /* This code has been modified to always pass a centisecond value to
      412     1686           SSC$MONTIMR.  The value NEXT_HOUR that is passed to SSC$MONTIMR is the
      413     1687           number of centiseconds until the next interval. It is calculated in
      414     1688           in one of two ways.  If the current uts, (NEXT_HOUR from SYS$CURTIME) is
      415     1689           after 1/1/93.  The UTS for 1/1/93 is subtracted from NEXT_HOUR, this value
      416     1690           is then multiplied by 4 (to convert to centiseconds).  The
      417     1691           centiscond value is mod'ed with the interval, to get the number of
      418     1692           the number of centiseconds that have elapsed in this interval. This
      419     1693           value is then subtracted from the interval, the determine the number
      420     1694           centiseconds until the next interval.  Since the cookie date starts
      421     1695           on the hour, subtracting the cookie dat e from the current time is
      422     1696           sufficient to calculate the correct time in the interval.  If the
      423     1697           current time is before 1/1/93, the current time is mod'ed with the
      424     1698            with the interval and that value is subtracted from the interval.
      425     1699        */
      426     1700    2              IF NEXT_HOUR > %UTS_CUSP# THEN
      427     1701    2                 NEXT_HOUR = %INTERVAL - MOD((NEXT_HOUR -%UTS_CUSP#)*4, %INTERVAL);
      428     1702    2              ELSE
      429     1703    2                 NEXT_HOUR=%INTERVAL-MOD(NEXT_HOUR,%INTERVAL);
      430     1704    2              CALL SSC$MONTIMR(NEXT_HOUR,ENTADDR(NIK$KIPND),0);
      431     1705    2              END;
      432     1706    2           ELSE IF NMSG=0 THEN DO;
      433     1707    2                 CALL OCI$MK_WR(CADDR,NKIPND_MSG#,0,LEN,PARM);
      434     1708    2                 END;
      435     1709    1           RETURN;
      436     1710    1   END NIK$KIPND;

PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:67   
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
      No diagnostics issued in procedure NIK$KIPND.

   Procedure NIK$KIPND requires 178 words for executable code.
   Procedure NIK$KIPND requires 22 words of local(AUTO) storage.

    No errors detected in file NIK$KEYIN.:E05TSI    .

PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:68   

 Object Unit name= NIK$KIPND                                  File name= NIK$KEYIN.:E05TOU
 UTS= JUL 30 '97 03:33:32.08 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  NIK$KIPND
    1   Proc  even  none   178    262  NIK$KIPND
    2  RoData even  none    11     13  NIK$KIPND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        2  NIK$KIPND

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       7 OCI$MK_WR
         yes           Std       3 SSC$MONTIMR
         yes           Std       1 SSS$CURTIME
         yes           Std       2 NIK$KIPND
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:69   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                NK_MXLOCAL
     NK_MXTOTAL                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:70   


      301        1        /*T***********************************************************/
      302        2        /*T*                                                         */
      303        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      304        4        /*T*                                                         */
      305        5        /*T***********************************************************/
      306        6        NIK$KIPND: PROC(KEY,DCTX);

      6  1 000000   000000 700200 xent  NIK$KIPND    TSX0  ! X66_AUTO_2
         1 000001   000026 000002                    ZERO    22,2

      307        7        /**/
      308        8        /*P*    NAME: NIK$KIPND
      309        9                PURPOSE:  Every hour NIK$KIPND looks at all of the
      310       10                          DCTs for local devices and puts out a keyin pending
      311       11                          message for any device in SPWAIT, KIWAIT or MPCWAIT
      312       12                          state.                                           */
      313       13        /*
      314       14                Includes
      315       15        */
      316       16        %INCLUDE                NI_DATA_C ;
      317      129        %INCLUDE                NI_DATA_R ;
      318      566        %INCLUDE                NK$LDCT ;
      319      668        %INCLUDE                OC_SUBS_C ;
      320     1399        /*
      321     1400                Parameters
      322     1401        */
      323     1402    1   DCL DCTX                SBIN PARAM ;
      324     1403    1   DCL 1 KEY               ALIGNED PARAM,
      325     1404    1         2 MSG#            UBIN HALF UNAL,
      326     1405    1         2 CADDR           BIT(18) UNAL,
      327     1406    1         2 DEVNM           CHAR(8),
      328     1407    1         2 DNM             REDEF DEVNM,
      329     1408    1           3 D             CHAR(4),
      330     1409    1           3 TWSN          CHAR(4) ;
      331     1410        %INCLUDE XUD_UTS_M;
      332     1492        %XUD_UTS_EQU;
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:71   
      333     1503        /*
      334     1504                Entries
      335     1505        */
      336     1506    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
      337     1507    1   DCL 1 SSC$MONTIMR       ENTRY(3) ;
      338     1508    1   DCL 1 SSS$CURTIME       ENTRY(1) ;
      339     1509        /*
      340     1510                Symrefs
      341     1511        */
      342     1512    1   DCL 1 NK_MXLOCAL        SBIN SYMREF ;
      343     1513    1   DCL 1 NK_MXTOTAL        SBIN SYMREF ;
      344     1514        /*
      345     1515                Auto
      346     1516        */
      347     1517    1   DCL 1 CADDR             BIT(18) ALIGNED AUTO;
      348     1518    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      349     1519    1   DCL 1 FDCTX             SBIN ALIGNED AUTO ;
      350     1520    1   DCL 1 I                 SBIN ALIGNED AUTO ;
      351     1521    1   DCL NEXT_HOUR UBIN WORD;
      352     1522    1   DCL 1 LDCTX             SBIN ALIGNED AUTO ;
      353     1523    1   DCL 1 NMSG              SBIN ALIGNED AUTO ;
      354     1524    1   DCL 1 PARM              ALIGNED AUTO,
      355     1525    1         2 STATE           SBIN,
      356     1526    1         2 MPC1            CHAR(4),
      357     1527    1         2 MPC2            CHAR(4) ;
      358     1528        /*
      359     1529                Based
      360     1530        */
      361     1531        %NI$DCT                 ( NAME=DCT,     STCLASS="BASED(DCT$)" ) ;
      362     1579        %NI$SQH                 ( NAME=SQH,     STCLASS=BASED ) ;
      363     1592        %NK$LDCT                ( NAME=NK$LDCT, STCLASS="BASED(DCT$)" ) ;
      364     1638        /*
      365     1639                Constant
      366     1640        */
      367     1641        %EQU INTERVAL=60*60*100;                /* ONE HOUR */
      368     1642    1   DCL LEN(0:2) UBIN BYTE UNAL CONSTANT INIT(4,4,4);
      369     1643        %EJECT;
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:72   
      370     1644    1           IF KEY.CADDR='0'B THEN CADDR=M_DEVC;

   1644  1 000002   200003 470500                    LDP0    @KEY,,AUTO
         1 000003   000000 720100                    LXL0    0,,PR0
         1 000004   000010 601000 1                  TNZ     s:1645

   1644  1 000005   100000 221003                    LDX1    32768,DU
         1 000006   200005 741100                    STX1    CADDR,,AUTO
         1 000007   000011 710000 1                  TRA     s:1646

      371     1645    1           ELSE CADDR=KEY.CADDR;

   1645  1 000010   200005 740100                    STX0    CADDR,,AUTO

      372     1646    1           FDCTX=1;

   1646  1 000011   000001 235007                    LDA     1,DL
         1 000012   200007 755100                    STA     FDCTX,,AUTO

      373     1647    1           LDCTX=NK_MXTOTAL;

   1647  1 000013   000000 236000 xsym               LDQ     NK_MXTOTAL
         1 000014   200012 756100                    STQ     LDCTX,,AUTO

      374     1648    2           IF ADDR(DCTX)~=ADDR(NIL) THEN DO;

   1648  1 000015   200004 236100                    LDQ     @DCTX,,AUTO
         1 000016   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000017   000031 600000 1                  TZE     s:1654

      375     1649    3              IF N$DCT$(DCTX)~=ADDR(NIL) THEN DO;

   1649  1 000020   200004 471500                    LDP1    @DCTX,,AUTO
         1 000021   100000 720100                    LXL0    0,,PR1
         1 000022   000000 473400 xsym               LDP3    N$DCT$$
         1 000023   300000 236110                    LDQ     0,X0,PR3
         1 000024   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:73   
         1 000025   000031 600000 1                  TZE     s:1654

      376     1650    3                 FDCTX=DCTX;

   1650  1 000026   100000 235100                    LDA     0,,PR1
         1 000027   200007 755100                    STA     FDCTX,,AUTO

      377     1651    3                 LDCTX=DCTX;

   1651  1 000030   200012 755100                    STA     LDCTX,,AUTO

      378     1652    3                 END;

      379     1653    2              END;

      380     1654    1           NMSG=0;

   1654  1 000031   200013 450100                    STZ     NMSG,,AUTO

      381     1655    2           DO I=FDCTX TO LDCTX;

   1655  1 000032   200010 755100                    STA     I,,AUTO
         1 000033   000171 710000 1                  TRA     s:1682+1

      382     1656    2              DCT$=N$DCT$(I);

   1656  1 000034   000000 470400 xsym               LDP0    N$DCT$$
         1 000035   200010 720100                    LXL0    I,,AUTO
         1 000036   000000 236110                    LDQ     0,X0,PR0
         1 000037   200006 756100                    STQ     DCT$,,AUTO

      383     1657    2              IF DCT$~=ADDR(NIL)

   1657  1 000040   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000041   000170 600000 1                  TZE     s:1682

      384     1658    2              THEN IF I<=NK_MXLOCAL
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:74   

   1658  1 000042   200010 236100                    LDQ     I,,AUTO
         1 000043   000000 116000 xsym               CMPQ    NK_MXLOCAL
         1 000044   000170 605400 1                  TPNZ    s:1682

      385     1659    3                 THEN DO CASE(DCT.STATE);

   1659  1 000045   200006 471500                    LDP1    DCT$,,AUTO
         1 000046   100007 721100                    LXL1    7,,PR1
         1 000047   000077 361003                    ANX1    63,DU
         1 000050   000010 101003                    CMPX1   8,DU
         1 000051   000053 602011 1                  TNC     s:1659+6,X1
         1 000052   000137 710000 1                  TRA     s:1676
         1 000053   000137 710000 1                  TRA     s:1676
         1 000054   000137 710000 1                  TRA     s:1676
         1 000055   000137 710000 1                  TRA     s:1676
         1 000056   000063 710000 1                  TRA     s:1661
         1 000057   000063 710000 1                  TRA     s:1661
         1 000060   000137 710000 1                  TRA     s:1676
         1 000061   000137 710000 1                  TRA     s:1676
         1 000062   000063 710000 1                  TRA     s:1661

      386     1660    3                  CASE(%SPWAIT,%KIWAIT,%MPCWAIT);

      387     1661    3                    IF KEY.MSG#=0 OR KEY.DNM.TWSN=SUBSTR(DCT.DEVNM,4,4)

   1661  1 000063   200003 473500                    LDP3    @KEY,,AUTO
         1 000064   300000 222100                    LDX2    0,,PR3
         1 000065   000071 600000 1                  TZE     s:1663
         1 000066   300002 236100                    LDQ     2,,PR3
         1 000067   100003 116100                    CMPQ    3,,PR1
         1 000070   000170 601000 1                  TNZ     s:1682

      388     1662    4                    THEN DO;

      389     1663    4                       PARM.STATE=DCT.STATE;

PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:75   
   1663  1 000071   100007 236100                    LDQ     7,,PR1
         1 000072   000077 376007                    ANQ     63,DL
         1 000073   200014 756100                    STQ     PARM,,AUTO

      390     1664    4                       IF DCT.SQH$->SQH.MPC$(0)=ADDR(NIL) THEN

   1664  1 000074   100022 474500                    LDP4    18,,PR1
         1 000075   400005 236100                    LDQ     5,,PR4
         1 000076   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000077   000103 601000 1                  TNZ     s:1667

      391     1665    4                          PARM.MPC1=' ';

   1665  1 000100   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000101   200015 756100                    STQ     PARM+1,,AUTO
         1 000102   000106 710000 1                  TRA     s:1668

      392     1666    4                       ELSE
      393     1667    4                          PARM.MPC1=DCT.SQH$->SQH.MPC$(0)->DCT.DEVNM;

   1667  1 000103   400005 475500                    LDP5    5,,PR4
         1 000104   500002 236100                    LDQ     2,,PR5
         1 000105   200015 756100                    STQ     PARM+1,,AUTO

      394     1668    4                       IF DCT.SQH$->SQH.MPC$(1)=ADDR(NIL) THEN

   1668  1 000106   400006 236100                    LDQ     6,,PR4
         1 000107   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000110   000114 601000 1                  TNZ     s:1671

      395     1669    4                          PARM.MPC2=' ';

   1669  1 000111   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000112   200016 756100                    STQ     PARM+2,,AUTO
         1 000113   000117 710000 1                  TRA     s:1672

      396     1670    4                       ELSE
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:76   
      397     1671    4                          PARM.MPC2=DCT.SQH$->SQH.MPC$(1)->DCT.DEVNM;

   1671  1 000114   400006 475500                    LDP5    6,,PR4
         1 000115   500002 236100                    LDQ     2,,PR5
         1 000116   200016 756100                    STQ     PARM+2,,AUTO

      398     1672    4                       CALL OCI$MK_WR(CADDR,KIPND_MSG#,3,LEN,PARM,I);

   1672  1 000117   200010 635500                    EPPR5   I,,AUTO
         1 000120   200025 455500                    STP5    PARM+9,,AUTO
         1 000121   200014 634500                    EPPR4   PARM,,AUTO
         1 000122   200024 454500                    STP4    PARM+8,,AUTO
         1 000123   000002 237000 2                  LDAQ    2
         1 000124   200022 757100                    STAQ    PARM+6,,AUTO
         1 000125   000001 236000 2                  LDQ     1
         1 000126   200021 756100                    STQ     PARM+5,,AUTO
         1 000127   200005 636500                    EPPR6   CADDR,,AUTO
         1 000130   200020 456500                    STP6    PARM+4,,AUTO
         1 000131   200020 630500                    EPPR0   PARM+4,,AUTO
         1 000132   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000133   000000 701000 xent               TSX1    OCI$MK_WR
         1 000134   000000 011000                    NOP     0

      399     1673    4                       NMSG=NMSG+1;

   1673  1 000135   200013 054100                    AOS     NMSG,,AUTO

      400     1674    4                       END;

   1674  1 000136   000170 710000 1                  TRA     s:1682

      401     1675    3                  CASE(ELSE);

      402     1676    3                    IF DCT.TYPE=%DV_MPC AND DCT.DFLG.MPCSTOP AND

   1676  1 000137   100007 236100                    LDQ     7,,PR1
         1 000140   007700 376007                    ANQ     4032,DL
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:77   
         1 000141   000700 116007                    CMPQ    448,DL
         1 000142   000170 601000 1                  TNZ     s:1682
         1 000143   100006 236100                    LDQ     6,,PR1
         1 000144   001000 316007                    CANQ    512,DL
         1 000145   000170 600000 1                  TZE     s:1682
         1 000146   100027 234100                    SZN     23,,PR1
         1 000147   000170 604000 1                  TMI     s:1682

      403     1677    4                      NOT DCT.STATUS.DOWN THEN DO;

      404     1678    4                       PARM.STATE=10;

   1678  1 000150   000012 235007                    LDA     10,DL
         1 000151   200014 755100                    STA     PARM,,AUTO

      405     1679    4                       CALL OCI$MK_WR(CADDR,KIPND_MSG#,3,LEN,PARM,I);

   1679  1 000152   200010 633500                    EPPR3   I,,AUTO
         1 000153   200025 453500                    STP3    PARM+9,,AUTO
         1 000154   200014 634500                    EPPR4   PARM,,AUTO
         1 000155   200024 454500                    STP4    PARM+8,,AUTO
         1 000156   000002 237000 2                  LDAQ    2
         1 000157   200022 757100                    STAQ    PARM+6,,AUTO
         1 000160   000001 236000 2                  LDQ     1
         1 000161   200021 756100                    STQ     PARM+5,,AUTO
         1 000162   200005 635500                    EPPR5   CADDR,,AUTO
         1 000163   200020 455500                    STP5    PARM+4,,AUTO
         1 000164   200020 630500                    EPPR0   PARM+4,,AUTO
         1 000165   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000166   000000 701000 xent               TSX1    OCI$MK_WR
         1 000167   000000 011000                    NOP     0

      406     1680    4                       END;

      407     1681    3                  END;

      408     1682    2              END;
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:78   

   1682  1 000170   200010 054100                    AOS     I,,AUTO
         1 000171   200010 236100                    LDQ     I,,AUTO
         1 000172   200012 116100                    CMPQ    LDCTX,,AUTO
         1 000173   000034 604400 1                  TMOZ    s:1656

      409     1683    2           IF KEY.MSG#=0 THEN DO;

   1683  1 000174   200003 470500                    LDP0    @KEY,,AUTO
         1 000175   000000 220100                    LDX0    0,,PR0
         1 000176   000243 601000 1                  TNZ     s:1706

      410     1684    2              CALL SSS$CURTIME(NEXT_HOUR);

   1684  1 000177   200011 631500                    EPPR1   NEXT_HOUR,,AUTO
         1 000200   200020 451500                    STP1    PARM+4,,AUTO
         1 000201   200020 630500                    EPPR0   PARM+4,,AUTO
         1 000202   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000203   000000 701000 xent               TSX1    SSS$CURTIME
         1 000204   000000 011000                    NOP     0

      411     1685        /* This code has been modified to always pass a centisecond value to
      412     1686           SSC$MONTIMR.  The value NEXT_HOUR that is passed to SSC$MONTIMR is the
      413     1687           number of centiseconds until the next interval. It is calculated in
      414     1688           in one of two ways.  If the current uts, (NEXT_HOUR from SYS$CURTIME) is
      415     1689           after 1/1/93.  The UTS for 1/1/93 is subtracted from NEXT_HOUR, this value
      416     1690           is then multiplied by 4 (to convert to centiseconds).  The
      417     1691           centiscond value is mod'ed with the interval, to get the number of
      418     1692           the number of centiseconds that have elapsed in this interval. This
      419     1693           value is then subtracted from the interval, the determine the number
      420     1694           centiseconds until the next interval.  Since the cookie date starts
      421     1695           on the hour, subtracting the cookie dat e from the current time is
      422     1696           sufficient to calculate the correct time in the interval.  If the
      423     1697           current time is before 1/1/93, the current time is mod'ed with the
      424     1698            with the interval and that value is subtracted from the interval.
      425     1699        */
      426     1700    2              IF NEXT_HOUR > %UTS_CUSP# THEN
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:79   

   1700  1 000205   000001 236000 0                  LDQ     LEN+1
         1 000206   200011 116100                    CMPQ    NEXT_HOUR,,AUTO
         1 000207   000220 603000 1                  TRC     s:1703

      427     1701    2                 NEXT_HOUR = %INTERVAL - MOD((NEXT_HOUR -%UTS_CUSP#)*4, %INTERVAL);

   1701  1 000210   200011 236100                    LDQ     NEXT_HOUR,,AUTO
         1 000211   000001 136000 0                  SBLQ    LEN+1
         1 000212   000002 736000                    QLS     2
         1 000213   000004 506000 2                  DIV     4
         1 000214   000027 675000 xsym               ERA     B_VECTNIL+23
         1 000215   000005 035000 2                  ADLA    5
         1 000216   200011 755100                    STA     NEXT_HOUR,,AUTO
         1 000217   000226 710000 1                  TRA     s:1704

      428     1702    2              ELSE
      429     1703    2                 NEXT_HOUR=%INTERVAL-MOD(NEXT_HOUR,%INTERVAL);

   1703  1 000220   200011 235100                    LDA     NEXT_HOUR,,AUTO
         1 000221   000043 773000                    LRL     35
         1 000222   000004 507000 2                  DVF     4
         1 000223   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 000224   000005 036000 2                  ADLQ    5
         1 000225   200011 756100                    STQ     NEXT_HOUR,,AUTO

      430     1704    2              CALL SSC$MONTIMR(NEXT_HOUR,ENTADDR(NIK$KIPND),0);

   1704  1 000226   000000 636000 1                  EAQ     s:6
         1 000227   200020 756100                    STQ     PARM+4,,AUTO
         1 000230   000006 236000 2                  LDQ     6
         1 000231   200023 756100                    STQ     PARM+7,,AUTO
         1 000232   200020 630500                    EPPR0   PARM+4,,AUTO
         1 000233   200022 450500                    STP0    PARM+6,,AUTO
         1 000234   200011 631500                    EPPR1   NEXT_HOUR,,AUTO
         1 000235   200021 451500                    STP1    PARM+5,,AUTO
         1 000236   200021 630500                    EPPR0   PARM+5,,AUTO
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:80   
         1 000237   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000240   000000 701000 xent               TSX1    SSC$MONTIMR
         1 000241   000000 011000                    NOP     0

      431     1705    2              END;

   1705  1 000242   000261 710000 1                  TRA     s:1709

      432     1706    2           ELSE IF NMSG=0 THEN DO;

   1706  1 000243   200013 235100                    LDA     NMSG,,AUTO
         1 000244   000261 601000 1                  TNZ     s:1709

      433     1707    2                 CALL OCI$MK_WR(CADDR,NKIPND_MSG#,0,LEN,PARM);

   1707  1 000245   200014 631500                    EPPR1   PARM,,AUTO
         1 000246   200024 451500                    STP1    PARM+8,,AUTO
         1 000247   000010 237000 2                  LDAQ    8
         1 000250   200022 757100                    STAQ    PARM+6,,AUTO
         1 000251   000012 236000 2                  LDQ     10
         1 000252   200021 756100                    STQ     PARM+5,,AUTO
         1 000253   200005 633500                    EPPR3   CADDR,,AUTO
         1 000254   200020 453500                    STP3    PARM+4,,AUTO
         1 000255   200020 630500                    EPPR0   PARM+4,,AUTO
         1 000256   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000257   000000 701000 xent               TSX1    OCI$MK_WR
         1 000260   000000 011000                    NOP     0

      434     1708    2                 END;

      435     1709    1           RETURN;

   1709  1 000261   000000 702200 xent               TSX2  ! X66_ARET

LEN
 Sect OctLoc
   0     000   004004 004***                                                    ....
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:81   

(unnamed)
 Sect OctLoc
   0     001   540546 215000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000000 000227   000000 006000   000005 006000   000000 006000    ................
   2     004   000001 277100   000001 277101   000002 006000   000000 000230    ...@...A........
   2     010   000002 006000   000000 006000   000007 006000                    ............
      436     1710    1   END NIK$KIPND;

PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:82   
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
      No diagnostics issued in procedure NIK$KIPND.
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:83   

 **** Variables and constants ****

  ****  Section 000 RoData NIK$KIPND

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b UBIN(9)     r     1 LEN(0:2)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @DCTX                      3-0-0/w PTR         r     1 @KEY
     5-0-0/w BIT (18)    r     1 CADDR                      6-0-0/w PTR         r     1 DCT$
    *0-0-0/w SBIN        r     1 DCTX                       7-0-0/w SBIN        r     1 FDCTX
    10-0-0/w SBIN        r     1 I                         *0-0-0/w STRC(108)   r     1 KEY
    12-0-0/w SBIN        r     1 LDCTX                     11-0-0/w UBIN        r     1 NEXT_HOUR
    13-0-0/w SBIN        r     1 NMSG                      14-0-0/w STRC(108)   r     1 PARM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w SBIN        r     1 NK_MXLOCAL
     0-0-0/w SBIN        r     1 NK_MXTOTAL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w PTR         r     1 N$DCT$(0:0)
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:84   
     0-0-0/w STRC(252)   r     1 SQH


   Procedure NIK$KIPND requires 178 words for executable code.
   Procedure NIK$KIPND requires 22 words of local(AUTO) storage.

    No errors detected in file NIK$KEYIN.:E05TSI    .
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:85   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:86   
          MINI XREF LISTING

CADDR
      1517**DCL      1644<<ASSIGN   1645<<ASSIGN   1672<>CALL     1679<>CALL     1707<>CALL
DCT.DEVNM
      1540**DCL      1661>>IF       1667>>ASSIGN   1671>>ASSIGN
DCT.DFLG.MPCSTOP
      1545**DCL      1676>>IF
DCT.DP
      1560**DCL      1567--REDEF    1570--REDEF    1571--REDEF    1573--REDEF    1573--REDEF    1574--REDEF
      1575--REDEF    1575--REDEF
DCT.MPC.IOCHANX
      1568**DCL      1568--REDEF
DCT.SQH$
      1555**DCL      1664>>IF       1667>>ASSIGN   1668>>IF       1671>>ASSIGN
DCT.STATE
      1550**DCL      1659>>DOCASE   1663>>ASSIGN
DCT.STATUS.DOWN
      1557**DCL      1676>>IF
DCT.TYPE
      1550**DCL      1676>>IF
DCT$
      1518**DCL      1540--IMP-PTR  1605--IMP-PTR  1656<<ASSIGN   1657>>IF       1659>>DOCASE   1661>>IF
      1663>>ASSIGN   1664>>IF       1667>>ASSIGN   1668>>IF       1671>>ASSIGN   1676>>IF       1676>>IF
      1676>>IF
DCTX
      1402**DCL         6--PROC     1648--IF       1649>>IF       1650>>ASSIGN   1651>>ASSIGN
FDCTX
      1519**DCL      1646<<ASSIGN   1650<<ASSIGN   1655>>DOINDEX
I
      1520**DCL      1655<<DOINDEX  1656>>ASSIGN   1658>>IF       1672<>CALL     1679<>CALL
KEY
      1403**DCL         6--PROC
KEY.CADDR
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:87   
      1405**DCL      1644>>IF       1645>>ASSIGN
KEY.DEVNM
      1406**DCL      1407--REDEF
KEY.DNM.TWSN
      1409**DCL      1661>>IF
KEY.MSG#
      1404**DCL      1661>>IF       1683>>IF
LDCTX
      1522**DCL      1647<<ASSIGN   1651<<ASSIGN   1655>>DOINDEX
LEN
      1642**DCL      1672<>CALL     1679<>CALL     1707<>CALL
N$DCT$
       561**DCL      1649>>IF       1656>>ASSIGN
N$DCT$$
       427**DCL       561--IMP-PTR  1649>>IF       1656>>ASSIGN
N$FQ$
       427**DCL       562--IMP-PTR
N$REQ_INIT.BUFADDR
       446**DCL       447--REDEF     447--REDEF
N$REQ_INIT.DLA.DRELADDR
       438**DCL       438--REDEF
N$REQ_INIT.DVE.EOMCHAR
       475**DCL       476--REDEF
N$REQ_INIT.EAINFO
       469**DCL       469--REDEF
N$REQ_INIT.EAINFOX
       469**DCL       470--REDEF
N$REQ_INIT.EVNTINFO
       470**DCL       470--REDEF
N$REQ_INIT.STATUS
       451**DCL       457--REDEF
NEXT_HOUR
      1521**DCL      1684<>CALL     1700>>IF       1701<<ASSIGN   1701>>ASSIGN   1703<<ASSIGN   1703>>ASSIGN
      1704<>CALL
NI$FQ$
       487**DCL       563--IMP-PTR
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:88   
NI$IBUF$
       487**DCL       563--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       497**DCL       498--REDEF     498--REDEF
NI$IMXMBX_INIT.SIZE
       499**DCL       499--REDEF
NI$REQ_INIT.DCW
       521**DCL       524--REDEF
NI$REQ_INIT.DCW.TALLY
       522**DCL       522--REDEF
NI$REQ_INIT.IDCW.EXTA
       524**DCL       524--REDEF
NI$REQ_INIT.PCW
       526**DCL       530--REDEF
NI$REQ_INIT.SEEK
       531**DCL       532--REDEF     533--REDEF
NI$RP$
       535**DCL       565--IMP-PTR
NIK$KIPND
         6**PROC     1704--CALL
NI_MBX_INIT.DCW.CONTROL.AE
       557**DCL       557--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       553**DCL       553--REDEF
NK$LDCT.DDT$
      1607**DCL      1607--REDEF
NK$LDCT.IOQ$
      1606**DCL      1607--REDEF
NK$LDCT.LDCTX
      1608**DCL      1608--REDEF
NK$LDCT.LKFLG.ABORTED
      1620**DCL      1621--REDEF
NK$LDCT.RLCID.LDCTX
      1630**DCL      1630--REDEF
NK$LDCT.STA$
      1626**DCL      1627--REDEF
PL6.E3A0      #003=NIK$KIPND File=NIK$KEYIN.:E05TSI                              WED 07/30/97 03:33 Page:89   
NK$LDCT.SYMB$
      1605**DCL      1605--REDEF    1605--REDEF    1606--REDEF
NK_MXLOCAL
      1512**DCL      1658>>IF
NK_MXTOTAL
      1513**DCL      1647>>ASSIGN
NMSG
      1523**DCL      1654<<ASSIGN   1673<<ASSIGN   1673>>ASSIGN   1706>>IF
OCI$MK_WR
      1506**DCL-ENT  1672--CALL     1679--CALL     1707--CALL
PARM
      1524**DCL      1672<>CALL     1679<>CALL     1707<>CALL
PARM.MPC1
      1526**DCL      1665<<ASSIGN   1667<<ASSIGN
PARM.MPC2
      1527**DCL      1669<<ASSIGN   1671<<ASSIGN
PARM.STATE
      1525**DCL      1663<<ASSIGN   1678<<ASSIGN
SQH.DOOR
      1588**DCL      1588--REDEF
SQH.MPC$
      1590**DCL      1664>>IF       1667>>ASSIGN   1668>>IF       1671>>ASSIGN
SSC$MONTIMR
      1507**DCL-ENT  1704--CALL
SSS$CURTIME
      1508**DCL-ENT  1684--CALL
