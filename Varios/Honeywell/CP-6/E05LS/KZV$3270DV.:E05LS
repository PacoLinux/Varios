VERSION E05

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:1    
        1        1        /*M* KZV$3270DV - Device manager for 3270 devices */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8
        9        9        KZV$3270DV: PROC(PARAMETER1,PARAMETER2) ALTRET;
       10       10
       11       11        /* Include Files */
       12       12
       13       13        %INCLUDE CP_6_SUBS;
       14      553        %INCLUDE LCP_6;
       15     4832        %INCLUDE K_ID_E;
       16     4882        %INCLUDE KH$CHN;
       17     5004        %INCLUDE KH$STT;
       18     5034        %INCLUDE KH_MACRO_C;
       19     5777        %INCLUDE KHC_MAC_C;
       20     5818        %INCLUDE KL_CONTROL_C;
       21     6198        %INCLUDE KL_AFCN_C;
       22     6299        %INCLUDE KL_MACRO_C;
       23     9651        %INCLUDE KL_SUPER_C;
       24    12553        %INCLUDE KV$VDH;
       25    12984        %INCLUDE KV$GLB;
       26    13403        %INCLUDE KV$USR;
       27    13715        %INCLUDE KV$GLBCTX;
       28    14160        %INCLUDE KV_GLBCNS_E;
       29    14501        %INCLUDE KV_GLB_M;
       30    14623        %INCLUDE KV_PRMID_E;
       31    14797        %INCLUDE KZ$LINCTX;
       32    15417        %INCLUDE KZ$OTPBFR;
       33    15518        %INCLUDE KZ$INPBFR;
       34    15578        %INCLUDE KZ$3270CTR;
       35    15643        %INCLUDE KZ$3270DEV;
       36    15901        %INCLUDE KZ$3270STT;
       37    15965        %INCLUDE KZ$BSCSTT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:2    
       38    16071        %INCLUDE KZ_LIN_C;
       39    16127        %INCLUDE KZ_CLM_E;
       40    16299        %INCLUDE KZ_3270_C;
       41    16457        %INCLUDE KZ_PERR_C;
       42    16539        %INCLUDE KZ_3270M_C;
       43    17396        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:3    
       44    17397        /* Parameters */
       45    17398
       46    17399    1   DCL FAKE UBIN;
       47    17400
       48    17401    1   DCL PARAMETER1 CHAR (FAKE);
       49    17402        %KZ$EVENT (STCLASS=REDEF PARAMETER1);
       50    17484        %KZ$3270DEV (NAME=DEVCTX,STCLASS=REDEF PARAMETER1);
       51    17663        %KZ$LINCTX (NAME=LINCTX,STCLASS=REDEF PARAMETER1);
       52    18094
       53    18095    1   DCL PARAMETER2 CHAR (FAKE);
       54    18096    1   DCL LINRSP REDEF PARAMETER2 UBIN;
       55    18097    1   DCL LINSTAT REDEF PARAMETER2 BIT (16) ALIGNED;
       56    18098    1   DCL OTPBFR$ REDEF PARAMETER2 PTR;
       57    18099
       58    18100        /* EQUs */
       59    18101
       60    18102        %KV_INPOPRX_E;
       61    18114        %KZ_3270_E;
       62    18242        %K#ENTID_E;
       63    18261        %KV_USR_EVT_ID_E;
       64    18281        %KV_VDH_EVT_ID_E;
       65    18287        %KV_SCHRSN_E;
       66    18294        %KV_DSCRSN_E;
       67    18303        %KV_CMPCOD_E;
       68    18317        %KV_INPUNT_E;
       69    18322        %KV_PRMID_E;
       70    18478        %KV_STRTYP_E;
       71    18516        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:4    
       72    18517        /* Auto */
       73    18518
       74    18519    1   DCL LIN$ PTR;
       75    18520    1   DCL CTR$ PTR;
       76    18521    1   DCL DEV$ PTR;
       77    18522    1   DCL T$ PTR;
       78    18523    1   DCL P1$ PTR;
       79    18524    1   DCL CNT UBIN;
       80    18525    1   DCL I REDEF CNT UBIN;
       81    18526    1   DCL J UBIN;
       82    18527    1   DCL BFR$ PTR;
       83    18528    1   DCL BFR_SIZ UBIN;
       84    18529    1   DCL STAT# REDEF BFR_SIZ UBIN;
       85    18530    1   DCL TBFR$ PTR;
       86    18531    1   DCL STATUS BIT(16);
       87    18532    1   DCL STATUSW REDEF STATUS UBIN;
       88    18533    1   DCL 1 STATUSB REDEF STATUS,
       89    18534    1         2 I UBIN BYTE UNAL,
       90    18535    1         2 J UBIN BYTE UNAL;
       91    18536    1   DCL SZ SBIN;
       92    18537    1   DCL TCTR$ PTR;
       93    18538    1   DCL TDEV$ PTR;
       94    18539    1   DCL DFRD BIT(1);
       95    18540    1   DCL VDH_FLG UBIN;
       96    18541        %KV$USR_EVT (STCLASS="");
       97    18576        %KV$VDH_CNC (STCLASS="");
       98    18668        %KV$VDH_DAT (STCLASS="");
       99    18748        %KV$VDH_DSC (STCLASS="");
      100    18784        %KV$VDH_EVT (STCLASS="");
      101    18819        %KV$VDH_INT (STCLASS="");
      102    18856        %KV$VDH_OTPMRK (STCLASS="");
      103    18918        %KV@USRENT;
      104    18938        %KZ$EVENT (FPTN=KZ$CLMEVENT,STCLASS="");
      105    19020        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:5    
      106    19021        /* Static */
      107    19022
      108    19023    1   DCL POLADR_B(0:31) BIT(8) CONSTANT INIT(
      109    19024    1       '40'X,'C1'X,'C2'X,'C3'X,'C4'X,'C5'X,'C6'X,'C7'X,
      110    19025    1       'C8'X,'C9'X,'4A'X,'4B'X,'4C'X,'4D'X,'4E'X,'4F'X,
      111    19026    1       '50'X,'D1'X,'D2'X,'D3'X,'D4'X,'D5'X,'D6'X,'D7'X,
      112    19027    1       'D8'X,'D9'X,'5A'X,'5B'X,'5C'X,'5D'X,'5E'X,'5F'X);
      113    19028    1   DCL POLADR(0:31) REDEF POLADR_B UBIN BYTE UNAL;
      114    19029
      115    19030    1   DCL SELADR_B(0:31) BIT(8) CONSTANT INIT(
      116    19031    1       '60'X,'61'X,'E2'X,'E3'X,'E4'X,'E5'X,'E6'X,'E7'X,
      117    19032    1       'E8'X,'E9'X,'6A'X,'6B'X,'6C'X,'6D'X,'6E'X,'6F'X,
      118    19033    1       'F0'X,'F1'X,'F2'X,'F3'X,'F4'X,'F5'X,'F6'X,'F7'X,
      119    19034    1       'F8'X,'F9'X,'7A'X,'7B'X,'7C'X,'7D'X,'7E'X,'7F'X);
      120    19035    1   DCL SELADR(0:31) REDEF SELADR_B UBIN BYTE UNAL;
      121    19036        %KZ$3270CTR (NAME=KZ_3270CTR,STCLASS=CONSTANT);
      122    19076        %KZ$3270DEV (NAME=KZ_3270DEV,STCLASS=CONSTANT);
      123    19255        %KZ$INPBFR (NAME=KZ_INPBFR,STCLASS=CONSTANT);
      124    19288        %KZ$OTPBFR (NAME=KZ_OTPBFR,STCLASS=CONSTANT);
      125    19353        %KZ$EVENT (FPTN=KZ_CLMEVENT,STCLASS=CONSTANT);
      126    19435
      127    19436    1   DCL 1 PRO_ATTR CONSTANT,
      128    19437    1         2 TYP UBIN BYTE UNAL INIT(%KV_PRMID_TRMATTR),
      129    19438    1         2 LNG UBIN BYTE UNAL INIT(SIZEC(VLP_TRMATTR));
      130    19439        %VLP_TRMATTR (STCLASS=CONSTANT,CURSORUP=YES,FCNTBL='CP5');
      131    19477    1   DCL 1 PRO_CTL CONSTANT,
      132    19478    1         2 TYP UBIN BYTE UNAL INIT(%KV_PRMID_TRMCTL),
      133    19479    1         2 LNG UBIN BYTE UNAL INIT(SIZEC(VLP_TRMCTL));
      134    19480        %VLP_TRMCTL (STCLASS=CONSTANT,RETYPOVR=YES,EDITOVR=YES,UPPERCASE=YES);
      135    19520
      136    19521        %KV$USRPRM_INT;
      137    19535        %KV$SETPRMPREPRC (PRMID=KV_PRMID_MRDWDT);
      138    19548        %KV$SETPRMPREPRC (PRMID=KV_PRMID_MRDLNG);
      139    19561        %KV$SETPRMPREPRC (PRMID=KV_PRMID_3270);
      140    19574        %KV$SETPRMPREPRC (PRMID=KV_PRMID_SCROLL);
      141    19587        %KV$SETPRMPREPRC (PRMID=KV_PRMID_DEVSCROLL);
      142    19600        %KV$STREVTENB (STRTYP=KV_STRTYP_MRD);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:6    
      143    19605        %KV$STREVTENB (STRTYP=KV_STRTYP_VDI);
      144    19610        %KV$USRPRM (NAME=KZ_USRPRM,STCLASS=CONSTANT,
      145    19611          HLTMSG="'(ENTER TO GO) '",
      146    19612          USRSBR=KZT$3270,
      147    19613          TRNTBLHEDPTR$=KZ_TRNTBLHED$,
      148    19614          PRFFNCTBL=KZ_3270PRFFNCTBL,
      149    19615          INPFNCTBLHEDPTR$=KZ_INPFNCTBLHED$);
      150    19666    1   DCL KZ_TRNTBLHED$ PTR INIT(ADDR(KZ_3270STD)) CONSTANT;
      151    19667    1   DCL KZ_3270PRFFNCTBL UBIN SYMREF;
      152    19668    1   DCL KZT_USRPRM$ PTR SYMREF;
      153    19669    1   DCL KZ_INPFNCTBLHED$ PTR SYMREF;
      154    19670    1   DCL KZ_3270STD UBIN SYMREF;
      155    19671
      156    19672        %MACRO STAT(VAL='0'B,LOG(YES='1'B,NO='0'B)='0'B,CLR(YES='1'B,NO='0'B)='0'B,
      157    19673                    DWN(YES='1'B,NO='0'B)='0'B,ACT=0,LAST=",",
      158    19674                    NOINIT(YES=1,NO=0)=0);
      159    19675        %IF NOINIT=1;
      160    19676        %LSET INIT=CHARTEXT('/*');
      161    19677                2 X ALIGNED,
      162    19678        %ELSE;
      163    19679        %LSET INIT=CHARTEXT('INIT');
      164    19680                  2 *,
      165    19681        %ENDIF;
      166    19682                  3 VAL# BIT(16) %INIT(VAL)%CHARTEXT('/**/'),
      167    19683                  3 LOG# BIT(1) %INIT(LOG)%CHARTEXT('/**/'),
      168    19684                  3 CLR# BIT(1) %INIT(CLR)%CHARTEXT('/**/'),
      169    19685                  3 DWN# BIT(1) %INIT(DWN)%CHARTEXT('/**/'),
      170    19686                  3 * BIT(5) %INIT('0'B)%CHARTEXT('/**/'),
      171    19687                  3 ACT# UBIN BYTE UNAL %INIT(ACT)%CHARTEXT('/**/') LAST
      172    19688        %SET Y#STATSIZ=Y#STATSIZ+1;
      173    19689        %MEND;
      174    19690
      175    19691        %SET Y#STATSIZ=0;
      176    19692
      177    19693        %EQU KZ#STAT_DE=1;                      /* Device-end                         */
      178    19694        %EQU KZ#STAT_DSC=2;                     /* Disconnect                         */
      179    19695        %EQU KZ#STAT_RETRY=3;                   /* Retry                              */
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:7    
      180    19696        %EQU KZ#STAT_CONT=4;                    /* Continue                           */
      181    19697        %EQU KZ#STAT_PAPER=5;                   /* Out of paper                       */
      182    19698    1   DCL 1 STAT_ CONSTANT,
      183    19699        %STAT(VAL='0000'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      184    19715        %STAT(VAL='0200'X,ACT=%KZ#STAT_DE,LOG=NO);
      185    19731        %STAT(VAL='0010'X,ACT=%KZ#STAT_DSC,DWN=YES,LOG=NO);
      186    19747        %STAT(VAL='0210'X,ACT=%KZ#STAT_PAPER,LOG=NO);
      187    19763        %STAT(VAL='0002'X,ACT=%KZ#STAT_CONT,LOG=YES);
      188    19779        %STAT(VAL='0004'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      189    19795        %STAT(VAL='0008'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      190    19811        %STAT(VAL='000C'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      191    19827        %STAT(VAL='040C'X,ACT=%KZ#STAT_CONT,LOG=YES);
      192    19843        %STAT(VAL='0618'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      193    19859        %STAT(VAL='0418'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      194    19875        %STAT(VAL='0604'X,ACT=%KZ#STAT_CONT,LOG=YES);
      195    19891        %STAT(VAL='0404'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      196    19907        %STAT(VAL='0204'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      197    19923        %STAT(VAL='0001'X,ACT=%KZ#STAT_RETRY,LOG=YES);
      198    19939        %STAT(VAL='0020'X,ACT=%KZ#STAT_CONT,LOG=YES);
      199    19955        %STAT(VAL='0100'X,ACT=%KZ#STAT_CONT,LOG=YES);
      200    19971        %STAT(VAL='0C00'X,ACT=%KZ#STAT_CONT,LOG=YES);
      201    19987        %STAT(VAL='0E00'X,ACT=%KZ#STAT_CONT,LOG=YES);
      202    20003        %STAT(VAL='0208'X,ACT=%KZ#STAT_CONT,LOG=YES);
      203    20019        %STAT(VAL='0218'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES,LAST=";");
      204    20035    1   DCL 1 STAT(0:%(Y#STATSIZ-1)) REDEF STAT_,
      205    20036        %STAT(LAST=";",NOINIT=YES);
      206    20052        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:8    
      207    20053        /* Based Structures */
      208    20054
      209    20055        %KZ$LINCTX (STCLASS="BASED(LIN$)");
      210    20486        %KZ$3270CTR (STCLASS="BASED(CTR$)");
      211    20526        %KZ$3270DEV (STCLASS="BASED(DEV$)");
      212    20705        %KZ$INPBFR (STCLASS="BASED(BFR$)");
      213    20738        %KZ$OTPBFR (STCLASS="BASED(BFR$)");
      214    20803        %KV$MRD;
      215    20850        %KV$VDI;
      216    20921        %KV$PTR;
      217    20964        %KH$CHN;
      218    21088        %KV$OTPMRK (STCLASS=BASED);
      219    21115        %KH$CTLTBL (STCLASS="BASED(KH_CTLTBL$)");
      220    21327    1   DCL VDHTRCWORD UBIN WORD BASED;
      221    21328    1   DCL P$(0:31) PTR BASED ALIGNED;
      222    21329    1   DCL UBYT(0:31) UBIN BYTE CALIGNED BASED;
      223    21330    1   DCL BITS(0:1023) BIT(8) BASED CALIGNED;
      224    21331    1   DCL BIT16(0:1023) BIT(16) BASED ALIGNED;
      225    21332        %KL_CONTROLLER;
      226    21481        %KL_LINEDEV;
      227    21630        %B$TERMINAL_ID (STCLASS=BASED);
      228    21659        %KV$SSN;
      229    21738        %KV$STT (STCLASS="BASED(KZ_VDHSTT$)");
      230    22132        %KV$USRPRM;
      231    22183        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:9    
      232    22184        /* External Data */
      233    22185
      234    22186    1   DCL KZT_THRTL_INIT UBIN SYMREF;
      235    22187        %INHIBIT_DCLS;
      236    22199    1   DCL KZT_THRTL_UNBLK UBIN SYMREF;
      237    22200    1   DCL KH_INHLVL UBIN SYMREF;
      238    22201    1   DCL KH_PROFILE_ VECTOR SYMREF;
      239    22202    1   DCL CP_PHLEGM CPTR;
      240    22203    1   DCL P_PHLEGM REDEF CP_PHLEGM PTR;
      241    22204        %KZ_3270M_HDR (STCLASS=SYMREF);
      242    22228        %KZ$3270STT (STCLASS="BASED(KZ_3270M_HDR.STTBFR$)");
      243    22660        %KV$USR_EVT (NAME=KV_USR_EVT,STCLASS=SYMREF);
      244    22695        %KV$VDH_CNC (NAME=KV_VDH_CNC,STCLASS=SYMREF);
      245    22787        %KV$VDH_DAT (NAME=KV_VDH_DAT,STCLASS=SYMREF);
      246    22867        %KV$VDH_DSC (NAME=KV_VDH_DSC,STCLASS=SYMREF);
      247    22903        %KV$VDH_EVT (NAME=KV_VDH_EVT,STCLASS=SYMREF);
      248    22938        %KV$VDH_INT (NAME=KV_VDH_INT,STCLASS=SYMREF);
      249    22975        %KV$VDH_OTPMRK (NAME=KV_VDH_OTPMRK,STCLASS=SYMREF);
      250    23037        %KV$VDH_EVT (NAME=KV_VDH_EVT_RQSOTP,STCLASS=SYMREF);
      251    23072    1   DCL KZ_3270_BFRSIZ(0:7) UBIN SYMREF;
      252    23073    1   DCL KZ_VDHSTT$ PTR SYMREF;
      253    23074    1   DCL KH_CTLTBL$ PTR SYMREF;
      254    23075    1   DCL KZ_3270XLB(0:63) BIT(8) SYMREF;
      255    23076    1   DCL KZ_3270XL(0:63) REDEF KZ_3270XLB UBIN BYTE CALIGNED;
      256    23077        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:10   
      257    23078        /* External Routines */
      258    23079
      259    23080    1   DCL KZT$3270 ENTRY(1) ALTRET;
      260    23081    1   DCL KZT$CLEAR ENTRY(1) ALTRET;
      261    23082    1   DCL KZT$CLEARIMM ENTRY(1) ALTRET;
      262    23083    1   DCL KZT$SNDSLV ENTRY(1) ALTRET;
      263    23084    1   DCL KZT$CMPOTP ENTRY(1) ALTRET;
      264    23085    1   DCL KVV$INT ENTRY(1) ALTRET;
      265    23086    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      266    23087    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      267    23088    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
      268    23089    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
      269    23090    1   DCL KVV$VDI ENTRY(1) ALTRET;
      270    23091    1   DCL KZT_CNCDSC@ EPTR SYMREF;
      271    23092    1   DCL KHA$ERRLOG ENTRY(2) ALTRET;
      272    23093        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:11   
      273    23094    1           DEV$=ADDR(NIL);
      274    23095    1           CTR$=ADDR(NIL);
      275    23096    1           LIN$=KZ$EVENT.LINCTX$;
      276    23097    1           VDH_FLG=0;
      277    23098    2           DO CASE(KZ$EVENT.EVENT);
      278    23099
      279    23100        /* Get output */
      280    23101
      281    23102    2            CASE(%KZ#LINFCN_GETOTP);
      282    23103
      283    23104    2              IF KZ$LINCTX.OTPHD$~=ADDR(NIL) THEN
      284    23105    2                 CALL M$XXX;
      285    23106
      286    23107    2              IF KZ$LINCTX.OTPCNT=0 THEN
      287    23108    2                 ALTRETURN;                /* Nothing to do                      */
      288    23109
      289    23110    2              CNT=KZ$LINCTX.OTPCNT;        /* Save current count                 */
      290    23111    3   CTRLOOP:   IF KZ$LINCTX.OTPCTR$=ADDR(NIL) THEN DO;
      291    23112    3                 KZ$LINCTX.OTPCTR$=KZ$LINCTX.CTRHD$; /* Start at beginning       */
      292    23113    3                 KZ$LINCTX.OTPDEV$=ADDR(NIL);
      293    23114    3                 END;
      294    23115    2              ELSE
      295    23116    2                 CNT=0;               /* Force one full pass that finds nothing  */
      296    23117
      297    23118    2              CTR$=KZ$LINCTX.OTPCTR$;      /* Current controller                 */
      298    23119    3              DO WHILE(CTR$~=ADDR(NIL));
      299    23120    3                 IF KZ$LINCTX.OTPDEV$=ADDR(NIL) THEN
      300    23121    3                    KZ$LINCTX.OTPDEV$=KZ$3270CTR.DEVHD$;
      301    23122    3                 ELSE
      302    23123    3                    KZ$LINCTX.OTPDEV$=KZ$LINCTX.OTPDEV$->KZ$3270DEV.LNK$;
      303    23124    3                 DEV$=KZ$LINCTX.OTPDEV$;
      304    23125    4                 DO WHILE(DEV$~=ADDR(NIL));
      305    23126    5                    IF KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP THEN DO; /* Get output   */
      306    23127    5                       IF KZ$3270DEV.OTPHD$~=ADDR(NIL)
      307    23128    6                         AND NOT KZ$3270DEV.HLT THEN DO; /* Output exists        */
      308    23129    6                          J=0;             /* Number bytes gotten to send        */
      309    23130    6                          KZ$3270DEV.OTPBSY='1'B;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:12   
      310    23131    6   OTPLOOP:               IF KZ$LINCTX.OTPTL$~=ADDR(NIL) THEN
      311    23132    6                             KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;
      312    23133    6                          ELSE
      313    23134    6                             KZ$LINCTX.OTPHD$=KZ$3270DEV.OTPHD$;
      314    23135    6                          KZ$LINCTX.OTPTL$=KZ$3270DEV.OTPHD$;
      315    23136    6                          KZ$3270DEV.OTPHD$=KZ$3270DEV.OTPHD$->KZ$OTPBFR.LNK$;
      316    23137    6                          KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$ = ADDR(NIL);
      317    23138    6                          IF KZ$3270DEV.OTPHD$=ADDR(NIL) THEN
      318    23139    6                             KZ$3270DEV.OTPTL$=ADDR(NIL);
      319    23140    6                          J=J+KZ$LINCTX.OTPTL$->KZ$OTPBFR.DATA_SIZ;
      320    23141    6                          IF J<100 AND KZ$3270DEV.OTPHD$~=ADDR(NIL) AND
      321    23142    6                            NOT KZ$3270DEV.PRINTER AND NOT KZ$LINCTX.OTPTL$->KZ$OTPBFR.
             23142                                     FLAGS.HALT THEN
      322    23143    6                             GOTO OTPLOOP; /* Send more until > 100 bytes        */
      323    23144    6                          KZ$LINCTX.POLADR.CTR=SELADR(KZ$3270CTR.ADR);
      324    23145    6                          KZ$LINCTX.POLADR.DEV=POLADR(KZ$3270DEV.ADR);
      325    23146    6   GOTOTP:                KZ$LINCTX.OTPDEV$=DEV$;
      326    23147    6                          KZ$LINCTX.OTPCTR$=CTR$;
      327    23148    6                          KZ$LINCTX.CURCTR$=CTR$; /* Set current device          */
      328    23149    6                          KZ$LINCTX.CURDEV$=DEV$;
      329    23150    6                          RETURN;
      330    23151    6                          END;
      331    23152    5                       END;
      332    23153    5                    ELSE DO;               /* Specific Poll                      */
      333    23154    6                       IF KZ$3270DEV.ACTIVE OR KZ$EVENT.EVENT=%KZ#LINFCN_NEWCTR THEN DO
             23154                                ;
      334    23155    6                          KZ$LINCTX.POLADR.CTR=POLADR(KZ$3270CTR.ADR);
      335    23156    6                          KZ$LINCTX.POLADR.DEV=POLADR(KZ$3270DEV.ADR);
      336    23157    6                          GOTO GOTOTP;
      337    23158    6                          END;
      338    23159    5                       END;
      339    23160
      340    23161    4                    DEV$=KZ$3270DEV.LNK$;
      341    23162    4                    END;
      342    23163    3                 KZ$LINCTX.OTPDEV$=ADDR(NIL);
      343    23164    4                 IF KZ$EVENT.EVENT=%KZ#LINFCN_NEWCTR THEN DO;
      344    23165    4                    IF KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)=0 THEN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:13   
      345    23166    5                    DO;
      346    23167    5                       KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)=
      347    23168    5                         POLADR(KZ$LINCTX.CURCTR$->KZ$3270CTR.ADR);
      348    23169    5                       KZ$LINCTX.ACTCTR=KZ$LINCTX.ACTCTR+1;
      349    23170    5                       END;
      350    23171    4                    DEV$=KZ$3270CTR.DEVHD$; /* Start all active devs             */
      351    23172    5                    DO WHILE(DEV$~=ADDR(NIL));
      352    23173    5                       IF KZ$3270DEV.ACTIVE THEN
      353    23174    5                          CALL CNC_DEV;
      354    23175    5                       DEV$=KZ$3270DEV.LNK$;
      355    23176    5                       END;
      356    23177    4                    GOTO END_GETOTP;
      357    23178    4                    END;
      358    23179    3                 CTR$=KZ$3270CTR.LNK$;
      359    23180    3                 END;
      360    23181
      361    23182    2              IF KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP AND CNT=KZ$LINCTX.OTPCNT THEN
      362    23183    2                 KZ$LINCTX.OTPCNT=0;       /* Made one pass thru finding nothing */
      363    23184
      364    23185    2   END_GETOTP:
      365    23186    2              KZ$LINCTX.OTPCTR$=ADDR(NIL);
      366    23187    2              KZ$LINCTX.OTPDEV$=ADDR(NIL);
      367    23188    2              ALTRETURN;
      368    23189        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:14   
      369    23190        /* Requeue Output */
      370    23191
      371    23192    2            CASE(%KZ#LINFCN_REQOTP);
      372    23193
      373    23194    2              DEV$=ADDR(NIL);
      374    23195    2              CALL REQUEUE;
      375    23196
      376    23197        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:15   
      377    23198        /* Release Output */
      378    23199
      379    23200    2            CASE(%KZ#LINFCN_RELOTP);
      380    23201
      381    23202    2              BFR$=KZ$LINCTX.OTPHD$;
      382    23203    2              IF BFR$ = ADDR(NIL) THEN GOTO NOOOO;
      383    23204    2              KZ$LINCTX.OTPHD$=KZ$OTPBFR.LNK$;
      384    23205    2              IF KZ$LINCTX.OTPHD$=ADDR(NIL) THEN
      385    23206    2                 KZ$LINCTX.OTPTL$=ADDR(NIL);
      386    23207    2              DEV$=KZ$OTPBFR.DEV$;
      387    23208
      388    23209    2              IF NOT KZ$3270DEV.DSC THEN
      389    23210    2                 IF KZ$OTPBFR.FLAGS.HALT.PAG# THEN
      390    23211    2                    KZ$3270DEV.HLT.PAG='1'B;
      391    23212    2                 ELSE
      392    23213    2                    IF KZ$OTPBFR.FLAGS.HALT.INP# THEN
      393    23214    2                       KZ$3270DEV.HLT.INP='1'B;
      394    23215
      395    23216    2              CALL RELOTPBFR;
      396    23217    2   NOOOO:     ;
      397    23218        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:16   
      398    23219        /* Device said to wait */
      399    23220
      400    23221    2            CASE(%KZ#LINFCN_WAIT);
      401    23222
      402    23223    2              KZ$LINCTX.CURDEV$->KZ$3270DEV.HLT.WACK='1'B;
      403    23224    2              RETURN;
      404    23225        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:17   
      405    23226        /* Status received */
      406    23227
      407    23228    2            CASE(%KZ#LINFCN_STATUS);
      408    23229
      409    23230    2              CALL FND_CTX ALTRET(END_STATUS);
             23230                       /* Find existing context, or build new */
      410    23231    2              STATUS=KZ$LINCTX.INPBFR$->BIT16(1)&'3F3F'X; /* Remove garb         */
      411    23232    3              DO STAT#=1 TO %Y#STATSIZ-1;
      412    23233    3                 IF STATUSW=BITBIN(STAT.X.VAL#(STAT#)) THEN
      413    23234    3                    GOTO GOT_STATUS;
      414    23235    3                 END;
      415    23236    2              STAT#=0;                     /* Zero entry for unknown status      */
      416    23237
      417    23238    2   GOT_STATUS:
      418    23239
      419    23240    2              KZ$3270DEV.STATUS=STATUS;    /* Save last status                   */
      420    23241    2              IF STATUS='0800'X THEN
      421    23242    2                 GOTO END_STATUS;          /* Ignore busy when specific polling  */
      422    23243    2              IF KZ$3270DEV.PRINTER AND STATUS='0200'X
      423    23244    2                OR STAT.X.ACT#(STAT#)=%KZ#STAT_RETRY
      424    23245    2              THEN ;
      425    23246    2              ELSE
      426    23247    2                 IF(STAT.X.LOG#(STAT#))
      427    23248    2                 THEN
      428    23249    2                    CALL ERRLOG(%E$BADSTATUS);
      429    23250    2              IF KZ$3270DEV.PRINTER AND STATUS='0010'X THEN
      430    23251    3              DO;
      431    23252    3                 KZ$3270DEV.PRINTER_DOWNS=KZ$3270DEV.PRINTER_DOWNS+1;
      432    23253    3                 IF KZ$3270DEV.PRINTER_DOWNS < 10 THEN
      433    23254    4                 DO;
      434    23255    4                    KZ$3270DEV.HLT.WACK='1'B;
      435    23256    4                    CALL REQUEUE;
      436    23257    4                    GOTO END_STATUS;
      437    23258    4                    END;
      438    23259    3                 END;
      439    23260    3              DO CASE(STAT.X.ACT#(STAT#));
      440    23261    3               CASE(%KZ#STAT_DE);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:18   
      441    23262    3                 KZ$3270DEV.PRINTER_DOWNS=0;
      442    23263    3                 IF KZ$3270DEV.ACTIVE THEN
      443    23264    4                    IF KZ$3270DEV.HLT.WACK THEN DO;
      444    23265    4                       KZ$3270DEV.HLT.WACK='0'B;
      445    23266    4                       KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;
      446    23267    4                       END;
      447    23268    4                    ELSE DO;
      448    23269    4                       KZ$3270DEV.ACTIVE='0'B;
      449    23270    4                       KZ$3270DEV.REACT='1'B;
      450    23271    4                       CALL DSC_DEV(%KV_DSCRSN_HRDERR); /* Disconnect            */
      451    23272    4                       END;
      452    23273    3                 ELSE
      453    23274    3                    CALL CNC_DEV;          /* Connect                            */
      454    23275
      455    23276    3               CASE(%KZ#STAT_PAPER);
      456    23277    3                 IF KZ$LINCTX.PRO.SLAVE THEN
      457    23278    3                    IF KZ$3270DEV.OTPHD$->UBYT(SIZEC(KZ$OTPBFR)+4)=
      458    23279    3                      KZ_3270XL(8) THEN GOTO END_STATUS;
      459    23280    3                    ELSE
      460    23281    3                       IF KZ$3270DEV.OTPHD$->UBYT(SIZEC(KZ$OTPBFR)+2)=
      461    23282    3                         KZ_3270XL(8) THEN GOTO END_STATUS;
      462    23283    3                 BFR_SIZ=1;
      463    23284    3                 KZ$3270DEV.HLT.WACK='1'B;
      464    23285    3                 SZ=KZ_3270_BFRSIZ(BFR_SIZ);
      465    23286    3                 CALL KVB$GET2NSYS(SZ,BFR$) ALTRET(NO_MEMORY);
      466    23287    3                 KZ$3270STT.OTPBFRSIZ(BFR_SIZ)=KZ$3270STT.OTPBFRSIZ(BFR_SIZ)+1;
      467    23288    3                 KZ$3270STT.KHSTT.OTPBFRBYTUTL=
      468    23289    3                   KZ$3270STT.KHSTT.OTPBFRBYTUTL+(KZ_3270_BFRSIZ(BFR_SIZ)*2);
      469    23290    3                 KZ$OTPBFR=KZ_OTPBFR;
      470    23291    3                 KZ$OTPBFR.BFRSIZ=BFR_SIZ;
      471    23292    3                 KZ$OTPBFR.FLAGS.FIRST#='1'B;
      472    23293    3                 KZ$OTPBFR.FLAGS.LAST#='1'B;
      473    23294    3                 KZ$OTPBFR.FLAGS.CNT#='1'B;
      474    23295    3                 KZ$OTPBFR.DEV$=DEV$;
      475    23296    3                 IF KZ$LINCTX.PRO.SLAVE THEN
      476    23297    4                 DO;
      477    23298    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+0)=KZ_3270XL (KZ$3270CTR.ADR);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:19   
      478    23299    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+1)=KZ_3270XL (KZ$3270DEV.ADR);
      479    23300    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+2)=BITBIN(%KZ#ESCAPE);
      480    23301    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+3)=BITBIN(%KZ#WRITE);
      481    23302    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+4)=KZ_3270XL (8);
             23302                             /* WCC (START PRINT) */
      482    23303    4                    KZ$OTPBFR.DATA_SIZ=5;
      483    23304    4                    END;
      484    23305    3                 ELSE
      485    23306    4                 DO;
      486    23307    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+0)=BITBIN(%KZ#ESCAPE);
      487    23308    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+1)=BITBIN(%KZ#WRITE);
      488    23309    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+2)=KZ_3270XL (8);
             23309                             /* WCC (START PRINT) */
      489    23310    4                    KZ$OTPBFR.DATA_SIZ=3;
      490    23311    4                    END;
      491    23312    3                 KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;
      492    23313    3                 KZ$3270DEV.OTPHD$=BFR$;
      493    23314    3                 IF KZ$3270DEV.OTPTL$ = ADDR(NIL)
      494    23315    3                 THEN KZ$3270DEV.OTPTL$=BFR$;
      495    23316    3                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;
      496    23317
      497    23318    3               CASE(%KZ#STAT_DSC);
      498    23319    4                 IF KZ$3270DEV.ACTIVE THEN DO;
      499    23320    4                    KZ$3270DEV.ACTIVE='0'B; /* Dev down                          */
      500    23321    4                    CALL REQUEUE;          /* Get back any output                */
      501    23322    4                    CALL DSC_DEV(%KV_DSCRSN_HRDERR);
      502    23323    4                    END;
      503    23324
      504    23325    3               CASE(%KZ#STAT_RETRY);
      505    23326    3                 IF NOT KZ$3270DEV.ACTIVE THEN
      506    23327    3                    GOTO END_STATUS;       /* Ignore if not active               */
      507    23328    4                 IF KZ$LINCTX.OTPHD$~=ADDR(NIL) THEN DO;
      508    23329    4                    IF KZ$LINCTX.OTPHD$->KZ$OTPBFR.FLAGS.ERR# THEN
      509    23330    4                       GOTO CONT;
      510    23331    4                    KZ$LINCTX.OTPHD$->KZ$OTPBFR.FLAGS.ERR#='1'B;
      511    23332    4                    CALL REQUEUE;
      512    23333    4                    END;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:20   
      513    23334    3                 ELSE
      514    23335    4                    IF KZ$3270DEV.OTPHD$ ~= ADDR(NIL) THEN DO;
      515    23336    5                       IF KZ$3270DEV.OTPHD$->KZ$OTPBFR.FLAGS.ERR# THEN DO;
      516    23337    5                          KZ$LINCTX.OTPHD$=KZ$3270DEV.OTPHD$;
      517    23338    5                          KZ$LINCTX.OTPTL$=KZ$3270DEV.OTPHD$;
      518    23339    5                          KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=ADDR(NIL);
      519    23340    5                          KZ$3270DEV.OTPHD$=KZ$3270DEV.OTPHD$->KZ$OTPBFR.LNK$;
      520    23341    5                          IF KZ$3270DEV.OTPHD$ = ADDR(NIL) THEN
      521    23342    5                             KZ$3270DEV.OTPTL$=ADDR(NIL);
      522    23343    5                          GOTO CONT;
      523    23344    5                          END;
      524    23345    4                       KZ$3270DEV.OTPHD$->KZ$OTPBFR.FLAGS.ERR#='1'B;
      525    23346    4                       END;
      526    23347
      527    23348    3               CASE(%KZ#STAT_CONT);
      528    23349    3                 IF NOT KZ$3270DEV.ACTIVE THEN
      529    23350    3                    GOTO END_STATUS;
      530    23351    3   CONT:
      531    23352    3                 BFR$=KZ$LINCTX.OTPHD$;
      532    23353    4                 IF BFR$~=ADDR(NIL) THEN DO;
      533    23354    4                    KZ$LINCTX.OTPHD$=KZ$OTPBFR.LNK$;
      534    23355    4                    IF KZ$LINCTX.OTPHD$=ADDR(NIL) THEN
      535    23356    4                       KZ$LINCTX.OTPTL$=ADDR(NIL);
      536    23357    4                    KZ$OTPBFR.CMPCOD=%KV_CMPCOD_DVCERR;
      537    23358    4                    CALL RELOTPBFR;        /* Not sent properly                  */
      538    23359    4                    END;
      539    23360
      540    23361    3               END;
      541    23362
      542    23363    2   END_STATUS: ;
      543    23364        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:21   
      544    23365        /* Build specific poll address for current device */
      545    23366
      546    23367    2            CASE(%KZ#LINFCN_SPCPOL);
      547    23368
      548    23369    2              KZ$LINCTX.POLADR.CTR=POLADR(KZ$LINCTX.CURCTR$->KZ$3270CTR.ADR);
      549    23370    2              KZ$LINCTX.POLADR.DEV=POLADR(KZ$LINCTX.CURDEV$->KZ$3270DEV.ADR);
      550    23371    2              RETURN;
      551    23372        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:22   
      552    23373        /* Specific poll all devices.  Before first call, set KZ$LINCTX.OTPCTR$
      553    23374           and KZ$LINCTX.OTPDEV$ to ADDR(NIL).  Continue to call this until
      554    23375           it ALTRETs.  Do not make any GETOTP calls in between. */
      555    23376
      556    23377    2            CASE(%KZ#LINFCN_SPCPOLALL);
      557    23378
      558    23379    2              GOTO CTRLOOP;
      559    23380        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:23   
      560    23381        /* Get general poll address of next inactive controller */
      561    23382
      562    23383    2            CASE(%KZ#LINFCN_INACT_CTR);
      563    23384
      564    23385    2   INACT_CTR:
      565    23386    2              KZ$LINCTX.CURDEV$=ADDR(NIL);
      566    23387    2              I=KZ$LINCTX.INACT_CTR;
      567    23388    3              DO UNTIL(I=KZ$LINCTX.INACT_CTR);
      568    23389    4                 IF KZ$LINCTX.POLLST$->UBYT(I)=0 THEN DO;
      569    23390    4                    CTR$=KZ$LINCTX.CTRLST$->P$(I);
      570    23391    4                    KZ$LINCTX.POLADR.CTR=POLADR(KZ$3270CTR.ADR);
      571    23392    4                    KZ$LINCTX.POLADR.DEV=0; /* Just to make it look nice         */
      572    23393    4                    KZ$LINCTX.CURCTR$=CTR$;
      573    23394    4                    IF I<KZ$LINCTX.POLSIZ-1 THEN
      574    23395    4                       KZ$LINCTX.INACT_CTR=I+1;
      575    23396    4                    ELSE
      576    23397    4                       KZ$LINCTX.INACT_CTR=0;
      577    23398    4                    KZ$LINCTX.POLX=I;
      578    23399    4                    RETURN;
      579    23400    4                    END;
      580    23401    3                 I=I+1;
      581    23402    3                 IF I>=KZ$LINCTX.POLSIZ THEN /* At end                           */
      582    23403    3                    I=0;
      583    23404    3                 END;
      584    23405
      585    23406    2              ALTRETURN;
      586    23407        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:24   
      587    23408        /* Input */
      588    23409
      589    23410    2            CASE(%KZ#LINFCN_INP);
      590    23411
      591    23412    3              IF KZ$LINCTX.PRO.SLAVE THEN DO;
      592    23413    3                 IF KZ$LINCTX.INPDATSIZ <=3 THEN
      593    23414    3                    J=2;                   /* Displ to start of data             */
      594    23415    3                 ELSE
      595    23416    3                    J=4;
      596    23417    3                 CTR$=KZ$LINCTX.CURCTR$;
      597    23418    3                 DEV$=KZ$LINCTX.CURDEV$;
      598    23419    3                 KZ$3270DEV.IGN_INP='0'B;
      599    23420    3                 KZ$3270DEV.KBDLCK='1'B;
      600    23421    3                 KZ$3270DEV.AID=KZ$LINCTX.INPBFR$->UBYT(1);
      601    23422    3                 IF KZ$3270DEV.AID~=64 /* Special PASSTHRU AID */ THEN
      602    23423    3                    IF KZ$3270DEV.ACTIVE THEN
      603    23424    4                    DO;
      604    23425    4                       IF KZ$3270DEV.AID=108 OR /* PA1                           */
      605    23426    4                         KZ$3270DEV.AID=109 OR /* CLEAR                          */
      606    23427    4                         KZ$3270DEV.AID=110 THEN J=J+1; /* PA2                   */
      607    23428    4                       GOTO PROCESS_INPUT;
      608    23429    4                       END;
      609    23430    3                    ELSE
      610    23431    3                       GOTO IGNOR;
      611    23432    4                 ELSE DO;
      612    23433    4                    I=BITBIN(KZ$LINCTX.INPBFR$->BITS(2)&'0F'X);
      613    23434    5                    DO CASE(I);
      614    23435    5                     CASE(1);              /* Logon request                      */
      615    23436    5                       IF NOT KZ$3270DEV.ACTIVE AND NOT KZ$3270DEV.DSC THEN
      616    23437    5                          CALL CNC_DEV;
      617    23438    6                       ELSE DO;
      618    23439    6                          KZ$3270DEV.ACTIVE='0'B;
      619    23440    6                          KZ$3270DEV.REACT='1'B; /* Start it up later            */
      620    23441    6                          CALL DSC_DEV (%KV_DSCRSN_SFTERR);
      621    23442    6                          END;
      622    23443    5                     CASE(2);              /* Hung-up                            */
      623    23444    5                       IF KZ$3270DEV.ACTIVE THEN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:25   
      624    23445    6                       DO;
      625    23446    6                          CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);
      626    23447    6                          IF DFRD
      627    23448    6                          THEN KZ$3270DEV.DSC_LATER='1'B;
      628    23449    6                          ELSE
      629    23450    7                          DO;
      630    23451    7                             CALL DSC_DEV (%KV_DSCRSN_SFTERR);
      631    23452    7                             CALL EXIT_VDH (KZ$3270DEV.VDI$);
      632    23453    7                             END;
      633    23454    6                          END;
      634    23455    5                       ELSE CALL DSC_DEV (%KV_DSCRSN_SFTERR);
      635    23456    5                     CASE(3);              /* ATTN key                           */
      636    23457    5                       KZ$LINCTX.INPBFR$->BITS(1)='6C'X; /* PA1                  */
      637    23458    5                       KZ$3270DEV.AID = BITBIN('6C'X);
      638    23459    5                       KZ$LINCTX.INPDATSIZ=2;
      639    23460    5                       J=2;
      640    23461    5                       GOTO PROCESS_INPUT;
      641    23462    5                     END;
      642    23463    4                    GOTO XIT;
      643    23464    4                    END;
      644    23465    3                 END;
      645    23466    3              IF LINSTAT&%KZ#LINSTAT_FIRST THEN DO;
      646    23467    3                 CALL FND_CTX ALTRET(XIT);
      647    23468    3                 IF KZ$LINCTX.INPDATSIZ<=3 THEN
      648    23469    3                    J=3;                   /* Displ to start of data             */
      649    23470    3                 ELSE
      650    23471    3                    J=5;
      651    23472    3                 KZ$3270DEV.IGN_INP='0'B;
      652    23473    3                 KZ$3270DEV.KBDLCK='1'B;
      653    23474    3                 KZ$3270DEV.AID=KZ$LINCTX.INPBFR$->UBYT(2);
      654    23475    3   PROCESS_INPUT:
      655    23476    4                 IF NOT KZ$3270DEV.ACTIVE OR KZ$3270DEV.DSC THEN DO;
      656    23477    4                    IF NOT KZ$3270DEV.DSC THEN
      657    23478    4                       CALL CNC_DEV;
      658    23479    4   IGNOR:           KZ$3270DEV.IGN_INP='1'B;
      659    23480    4                    GOTO XIT;
      660    23481    4                    END;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:26   
      661    23482
      662    23483    4                 IF KZ$3270DEV.HLT.PAG OR KZ$3270DEV.HLT.INP THEN DO;
      663    23484    4                    IF KZ$3270DEV.HLT.PAG AND KZ$3270DEV.AID=125 /*ENTER*/ THEN
      664    23485    4                       KZ$3270DEV.IGN_INP='1'B;
      665    23486    4                    KZ$3270DEV.HLT.PAG='0'B;
      666    23487    4                    KZ$3270DEV.HLT.INP='0'B;
      667    23488    4                    KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;
      668    23489    4                    END;
      669    23490    3                 IF KZ$3270DEV.AID=109 /*CLEAR*/ THEN
      670    23491    4                 DO;
      671    23492    4                    CALL ENTER_VDH(KZ$3270DEV.VDI$,DFRD);
      672    23493    4                    IF DFRD THEN
      673    23494    4                       KZ$3270DEV.DFR.CLR='1'B;
      674    23495    5                    ELSE DO;
      675    23496    5                       CALL KZT$CLEARIMM(KZ$3270DEV);
      676    23497    5                       CALL EXIT_VDH(KZ$3270DEV.VDI$);
      677    23498                                                /* Send WCC.KEYRSTR, eventually.      */
      678    23499    5                       KZ$3270DEV.KBDLCK='1'B;
      679    23500    5                       END;
      680    23501    4                    END;
      681    23502    3                 END;
      682    23503    3              ELSE DO;
      683    23504    3                 J=0;
      684    23505    3                 CTR$=KZ$LINCTX.CURCTR$;
      685    23506    3                 DEV$=KZ$LINCTX.CURDEV$;
      686    23507    3                 IF DEV$=ADDR(NIL) THEN
      687    23508    3                    GOTO XIT;              /* Assume test-request                */
      688    23509    3                 END;
      689    23510
      690    23511    2              IF KZ$3270DEV.DSC OR NOT KZ$3270DEV.ACTIVE THEN
      691    23512    2                 KZ$3270DEV.IGN_INP='1'B;
      692    23513    3              IF NOT KZ$3270DEV.IGN_INP THEN DO;
      693    23514    4                 IF LINSTAT&%KZ#LINSTAT_LAST THEN DO;
      694    23515    4                    KZ$LINCTX.INPBFR$->UBYT(KZ$LINCTX.INPDATSIZ)=BITBIN(%
             23515                             KZ#3270INPCTRCHR);
      695    23516    4                    KZ$LINCTX.INPBFR$->UBYT(KZ$LINCTX.INPDATSIZ+1)=KZ$3270DEV.AID;
      696    23517    4                    END;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:27   
      697    23518    3                 CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);
      698    23519    4                 IF DFRD THEN DO;
      699    23520    4                    SZ=SIZEW(KZ$INPBFR);
      700    23521    4                    CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);
      701    23522    4                    T$->KZ$INPBFR=KZ_INPBFR;
      702    23523    4                    T$->KZ$INPBFR.BFR_SIZ=KZ$LINCTX.INPBFRSIZ;
      703    23524    4                    T$->KZ$INPBFR.DATA_SIZ=KZ$LINCTX.INPDATSIZ-J;
      704    23525    4                    T$->KZ$INPBFR.BYTX=J;
      705    23526    4                    T$->KZ$INPBFR.DATA$=KZ$LINCTX.INPBFR$;
      706    23527    4                    IF KZ$3270DEV.DFRTL$~=ADDR(NIL) THEN
      707    23528    4                       KZ$3270DEV.DFRTL$->KZ$INPBFR.LNK$=T$;
      708    23529    4                    ELSE
      709    23530    4                       KZ$3270DEV.DFRHD$=T$;
      710    23531    4                    KZ$3270DEV.DFRTL$=T$;
      711    23532    4                    KZ$LINCTX.INPBFR$=ADDR(NIL);
      712    23533    4                    IF LINSTAT&%KZ#LINSTAT_LAST THEN
      713    23534    4                       T$->KZ$INPBFR.DATA_SIZ=T$->KZ$INPBFR.DATA_SIZ+2;
      714    23535    4                    ELSE
      715    23536    4                       T$->KZ$INPBFR.FLAGS.CTN#='1'B;
      716    23537    4                    END;
      717    23538    4                 ELSE DO;
      718    23539    4                    KV$VDH_DAT=KV_VDH_DAT;
      719    23540    4                    KV$VDH_DAT.DAT__.ADR$=KZ$LINCTX.INPBFR$;
      720    23541    4                    KV$VDH_DAT.DAT__.BYTX=J;
      721    23542    4                    KV$VDH_DAT.DAT__.DATBYTSIZ=KZ$LINCTX.INPDATSIZ-J+2;
      722    23543    4                    IF NOT LINSTAT&%KZ#LINSTAT_LAST THEN
      723    23544    5                    DO;
      724    23545    5                       KV$VDH_DAT.CTN='1'B;
      725    23546    5                       KV$VDH_DAT.DAT__.DATBYTSIZ=
      726    23547    5                         KV$VDH_DAT.DAT__.DATBYTSIZ-2;
      727    23548    5                       END;
      728    23549    4                    KZ$3270DEV.MUST_SBA='1'B;
      729    23550    4                    CALL KVV$VDI(KV$VDH_DAT);
      730    23551    4                    CALL EXIT_VDH (KZ$3270DEV.VDI$);
      731    23552    4                    END;
      732    23553    3                 END;
      733    23554
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:28   
      734    23555    2              GOTO XIT;
      735    23556        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:29   
      736    23557        /*
      737    23558                    CONTROLLER RESPONDED TO POLLING -
      738    23559                       MAKE SURE THE CONTROLLER TIMEOUT BIT IS RESET.
      739    23560        */
      740    23561    2            CASE(%KZ#LINFCN_POLL_ANSWERED);
      741    23562
      742    23563    2              IF KZ$LINCTX.CTRLST$ ~= ADDR(NIL) THEN
      743    23564    2                 KZ$LINCTX.CTRLST$->P$(KZ$LINCTX.POLX)->
      744    23565    2                   KZ$3270CTR.TIMED_OUT_ONCE = '0'B;
      745    23566    2              RETURN;
      746    23567        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:30   
      747    23568        /* General Poll Time-out */
      748    23569
      749    23570    2            CASE(%KZ#LINFCN_POLTIMOUT);
      750    23571
      751    23572    2              DEV$=ADDR(NIL);
      752    23573    2              CALL REQUEUE;
      753    23574    3              IF KZ$LINCTX.CURCTR$=ADDR(NIL) THEN DO;
      754    23575    3                 CTR$ = KZ$LINCTX.CTRLST$->P$(KZ$LINCTX.POLX);
      755    23576    3                 KZ$LINCTX.CURDEV$=ADDR(NIL);
      756    23577    3                 IF KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)~=0 THEN
      757    23578    4                 DO;                       /* This controller was active         */
      758    23579    4                    IF NOT KZ$3270CTR.TIMED_OUT_ONCE THEN
      759    23580    5                    DO;               /* This is the controllers first time out  */
      760    23581    5                       KZ$3270CTR.TIMED_OUT_ONCE = '1'B;
      761    23582    5                       RETURN;             /* We'll give it another chance       */
      762    23583    5                       END;
      763    23584    5                    ELSE DO;               /* Alter its status to inactive.      */
      764    23585    5                       KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)=0;
      765    23586    5                       KZ$LINCTX.ACTCTR=KZ$LINCTX.ACTCTR-1;
      766    23587    5                       END;
      767    23588    4                    END;
      768    23589    3                 END;
      769    23590    3              ELSE DO;
      770    23591    3                 CTR$=KZ$LINCTX.CURCTR$;
      771    23592    4                 IF KZ$LINCTX.CURDEV$~=ADDR(NIL) THEN DO;
      772    23593    4                    DEV$=KZ$LINCTX.CURDEV$;
      773    23594    4                    GOTO POLTO4;
      774    23595    4                    END;
      775    23596    3                 END;
      776    23597    2   POLTO2:
      777    23598    2              DEV$=KZ$3270CTR.DEVHD$;
      778    23599    3              DO WHILE(DEV$~=ADDR(NIL));
      779    23600    3   POLTO4:
      780    23601    4                 IF KZ$3270DEV.ACTIVE THEN DO;
      781    23602    4                    KZ$3270DEV.ACTIVE='0'B;
      782    23603    4                    CALL DSC_DEV(%KV_DSCRSN_HRDERR);
      783    23604    4                    GOTO POLTO2;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:31   
      784    23605    4                    END;
      785    23606    3                 IF KZ$LINCTX.CURDEV$~=ADDR(NIL) THEN
      786    23607    3                    RETURN;
      787    23608    3                 DEV$=KZ$3270DEV.LNK$;
      788    23609    3                 END;
      789    23610    2              RETURN;
      790    23611
      791    23612        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:32   
      792    23613        /* Disconnect Channels */
      793    23614
      794    23615    2            CASE(%KZ#LINFCN_DSCTRM,
      795    23616    2                %KZ#LINFCN_KILL);
      796    23617
      797    23618    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);
      798    23619
      799    23620    3               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */
      800    23621    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_CHAN#;
      801    23622    3                 CALL REQUEUE;
      802    23623    3                 CTR$=KZ$LINCTX.CTRHD$;
      803    23624    3                 IF CTR$=ADDR(NIL) THEN
      804    23625    3                    CALL RLS_LINE;
      805    23626    3                 ELSE
      806    23627    4                 DO WHILE(CTR$~=ADDR(NIL));
      807    23628    4                    TCTR$=KZ$3270CTR.LNK$;
      808    23629    4                    DEV$=KZ$3270CTR.DEVHD$;
      809    23630    4                    IF DEV$=ADDR(NIL) THEN
      810    23631    4                       CALL RLS_CTR;
      811    23632    4                    ELSE
      812    23633    5                    DO WHILE(DEV$~=ADDR(NIL));
      813    23634    5                       TDEV$=KZ$3270DEV.LNK$;
      814    23635    6                       IF KZ$3270DEV.ACTIVE THEN DO;
      815    23636    6                          KZ$3270DEV.ACTIVE='0'B;
      816    23637    6                          CALL DSC_DEV(KZ$LINCTX.DSCRSN);
      817    23638    6                          END;
      818    23639    5                       ELSE
      819    23640    5                          CALL RLS_DEV;
      820    23641    5                       DEV$=TDEV$;
      821    23642    5                       END;
      822    23643    4                    CTR$=TCTR$;
      823    23644    4                    END;
      824    23645
      825    23646    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */
      826    23647    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_SUBCHAN#;
      827    23648    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;
      828    23649    3                 CALL FND_CTR ALTRET(NONE);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:33   
      829    23650    3                 CALL REQUEUE;
      830    23651    3                 DEV$=KZ$3270CTR.DEVHD$;
      831    23652    3                 IF DEV$=ADDR(NIL) THEN
      832    23653    3                    CALL RLS_CTR;
      833    23654    3                 ELSE
      834    23655    4                 DO WHILE(DEV$~=ADDR(NIL));
      835    23656    4                    TDEV$=KZ$3270DEV.LNK$;
      836    23657    5                    IF KZ$3270DEV.ACTIVE THEN DO;
      837    23658    5                       KZ$3270DEV.ACTIVE='0'B;
      838    23659    5                       CALL DSC_DEV(KZ$LINCTX.DSCRSN);
      839    23660    5                       END;
      840    23661    4                    ELSE
      841    23662    4                       CALL RLS_DEV;
      842    23663    4                    DEV$=TDEV$;
      843    23664    4                    END;
      844    23665
      845    23666    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */
      846    23667    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_SUBSUBCHAN#;
      847    23668    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;
      848    23669    3                 J=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBSUBDEVICE;
      849    23670    3                 CALL FND_CTR ALTRET(NONE);
      850    23671    3                 CALL FND_DEV ALTRET(NONE);
      851    23672    3                 CALL REQUEUE;
      852    23673    4                 IF KZ$3270DEV.ACTIVE THEN DO;
      853    23674    4                    KZ$3270DEV.ACTIVE='0'B;
      854    23675    4                    CALL DSC_DEV(KZ$LINCTX.DSCRSN);
      855    23676    4                    END;
      856    23677    3                 ELSE
      857    23678    3                    CALL RLS_DEV;
      858    23679    3   NONE:         ;
      859    23680    3               END;
      860    23681        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:34   
      861    23682        /* Controller Present */
      862    23683
      863    23684    2            CASE(%KZ#LINFCN_NEWCTR);
      864    23685
      865    23686    3              IF KZ$LINCTX.OTPCTR$=ADDR(NIL) THEN DO;
      866    23687    3                 KZ$LINCTX.CURCTR$=KZ$LINCTX.CTRLST$->P$(KZ$LINCTX.POLX);
      867    23688    3                 KZ$LINCTX.OTPCTR$=KZ$LINCTX.CURCTR$;
      868    23689    3                 KZ$LINCTX.OTPDEV$=ADDR(NIL);
      869    23690    3                 END;
      870    23691    2              ELSE KZ$LINCTX.CURCTR$=KZ$LINCTX.OTPCTR$;
      871    23692    2              GOTO CTRLOOP;
      872    23693        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:35   
      873    23694        /* Build Controller and Device Context */
      874    23695
      875    23696    2            CASE(%KZ#LINFCN_BLDCTX);
      876    23697
      877    23698    3              IF KZ_VDHSTT$=ADDR(NIL) THEN DO;
      878    23699
      879    23700                                                /* INIT VDH STAT BUFFER               */
      880    23701                      %DISABLE(INHLVL=KH_INHLVL);
      881    23705    3                 SZ=SIZEW(KV$STT);
      882    23706    3                 CALL KVB$GETSYS(SZ,KZ_VDHSTT$) ALTRET(NO_MEMORY);
      883    23707    3                 KV$STT='0'B;
      884    23708    3                 KV$STT.REQSTATS.FNC=%IGA_REQSTATS;
      885    23709    3                 KV$STT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;
      886    23710    3                 KV$STT.REQSTATS.SLCENT(%KH#ENTID_3270)='1'B;
      887    23711    3                 KV$STT.REQSTATS.DSPENT(%KH#ENTID_VDH)='1'B;
      888    23712
      889    23713                                                /* INIT 3270 STAT BUFFER              */
      890    23714    3                 SZ=SIZEW(KZ$3270STT);
      891    23715    3                 CALL KVB$GETSYS(SZ,KZ_3270M_HDR.STTBFR$) ALTRET(NO_MEMORY);
      892    23716    3                 KZ$3270STT='0'B;
      893    23717    3                 KZ$3270STT.REQSTATS.FNC=%IGA_REQSTATS;
      894    23718    3                 KZ$3270STT.REQSTATS.DSPENT(%KH#ENTID_3270)='1'B;
      895    23719    3                 KZ$3270STT.REQSTATS.SLCENT(%KH#ENTID_3270)='1'B;
      896    23720    3                 KZ$3270STT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;
      897    23721
      898    23722                                                /* INIT 3270 USRPRM                   */
      899    23723    3                 SZ=SIZEW(KV$USRPRM);
      900    23724    3                 CALL KVB$GETSYS(SZ,KZT_USRPRM$) ALTRET(NO_MEMORY);
      901    23725                      %ENABLE(INHLVL=KH_INHLVL);
      902    23731    3                 KZT_USRPRM$->KV$USRPRM=KZ_USRPRM;
      903    23732    3                 KZT_USRPRM$->KV$USRPRM.INHLVL=KH_INHLVL;
      904    23733    3                 KZT_USRPRM$->KV$USRPRM.STT$=KZ_VDHSTT$;
      905    23734    3                 END;
      906    23735
      907    23736    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);
      908    23737    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */
      909    23738
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:36   
      910    23739    3                 KZ$LINCTX.POLSIZ=KZ$LINCTX.POLSIZ+1; /* # controllers to poll   */
      911    23740    3                 CTR$=KZ$LINCTX.CTRHD$;    /* See if CTR already present         */
      912    23741    4                 DO WHILE(CTR$~=ADDR(NIL));
      913    23742    4                    IF KZ$3270CTR.ADR=KZ$EVENT.CHNCTX$->KL_CONTROLLER.CONT# THEN
      914    23743    4                       GOTO SETCTR;
      915    23744    4                    CTR$=KZ$3270CTR.LNK$;
      916    23745    4                    END;
      917    23746    3                 CALL BLD_CTR_CTX ALTRET(NO_MEMORY);
      918    23747    3   SETCTR:
      919    23748    3                 KZ$3270CTR.ADR=KZ$EVENT.CHNCTX$->KL_CONTROLLER.CONT#;
      920    23749    3                 KZ$3270CTR.ROWS=KZ$EVENT.CHNCTX$->KL_CONTROLLER.ROWS;
      921    23750    3                 KZ$3270CTR.COLS=KZ$EVENT.CHNCTX$->KL_CONTROLLER.COLUMNS;
      922    23751    3                 KZ$3270CTR.TYP=KZ$EVENT.CHNCTX$->KL_CONTROLLER.TYPE;
      923    23752    3                 KZ$3270CTR.LIN$=LIN$;
      924    23753    3                 KZ$3270CTR.CHN$=KZ$EVENT.CHN$;
      925    23754    3                 KZ$EVENT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_CONT#;
      926    23755    3                 KZ$EVENT.CHN$->KH$CHN.CTX$ = CTR$;
      927    23756
      928    23757    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */
      929    23758
      930    23759    3                 I=KZ$EVENT.CHNCTX$->KL_LINEDEV.CONTROLLER#;
      931    23760    3                 J=KZ$EVENT.CHNCTX$->KL_LINEDEV.DEVICE#;
      932    23761    3                 CALL FND_CTR ALTRET(NO_CTRLR);
      933    23762    3                 DEV$=KZ$3270CTR.DEVHD$;
      934    23763    4                 DO WHILE(DEV$~=ADDR(NIL));
      935    23764    4                    IF KZ$3270DEV.ADR=KZ$EVENT.CHNCTX$->KL_LINEDEV.DEVICE# THEN
      936    23765    4                       GOTO SETDEV;
      937    23766    4                    DEV$=KZ$3270DEV.LNK$;
      938    23767    4                    END;
      939    23768    3                 CALL BLD_DEV_CTX ALTRET(NO_MEMORY);
      940    23769    3   SETDEV:
      941    23770    3                 KZ$3270DEV.CHN$=KZ$EVENT.CHN$;
      942    23771    3                 KZ$EVENT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_LINEDEV#;
      943    23772    3                 KZ$EVENT.CHN$->KH$CHN.CTX$ = DEV$;
      944    23773    3                 IF KZ$3270CTR.TYP=3276 THEN
      945    23774    3                    KZ$3270DEV.EWALT='1'B;
      946    23775    3                 ELSE
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:37   
      947    23776    3                    KZ$3270DEV.EWALT='0'B;
      948    23777    3                 IF KZ$EVENT.CHNCTX$->KL_LINEDEV.TYPE>=3280 THEN
      949    23778    3                    KZ$3270DEV.PRINTER='1'B;
      950    23779    3                 ELSE
      951    23780    3                    KZ$3270DEV.PRINTER='0'B;
      952    23781    3                 CALL SET_PRO;
      953    23782    3   NO_CTRLR:
      954    23783    3               END;
      955    23784        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:38   
      956    23785        /* Build Context Complete */
      957    23786
      958    23787    2            CASE(%KZ#LINFCN_CTXCMP);
      959    23788                   %DISABLE(INHLVL=KH_INHLVL);
      960    23792    2              SZ=((KZ$LINCTX.POLSIZ*5)+1)/2;
      961    23793    2              CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);
      962    23794    2              KZ$LINCTX.CTRLST$=T$;
      963    23795    2              KZ$LINCTX.POLLST$=PINCRW(T$,
      964    23796    2                KZ$LINCTX.POLSIZ*2);
      965    23797
      966    23798    2              CTR$=KZ$LINCTX.CTRHD$;
      967    23799    3              DO I=0 TO KZ$LINCTX.POLSIZ-1;
      968    23800    3                 KZ$LINCTX.POLLST$->UBYT(I)=0; /* Make all controllers inactive  */
      969    23801    3                 KZ$LINCTX.CTRLST$->P$(I)=CTR$;
      970    23802    3                 CTR$=KZ$3270CTR.LNK$;
      971    23803    3                 END;
      972    23804                   %ENABLE(INHLVL=KH_INHLVL);
      973    23810        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:39   
      974    23811        /* Enable Channels  */
      975    23812
      976    23813    2            CASE(%KZ#LINFCN_ENABL);
      977    23814
      978    23815    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);
      979    23816
      980    23817    3               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */
      981    23818
      982    23819    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */
      983    23820
      984    23821    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */
      985    23822    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;
      986    23823    3                 J=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBSUBDEVICE;
      987    23824    3                 CALL FND_CTR ALTRET(NO_WAY);
      988    23825    3                 CALL FND_DEV ALTRET(NO_WAY);
      989    23826    3                 IF KZ$3270DEV.AWAIT_ENABLE OR
      990    23827    3                   (KZ$3270DEV.PRINTER AND NOT KZ$3270DEV.ACTIVE) OR
      991    23828    3                   KZ$3270DEV.CHN$->KH$CHN.AUTLGN
      992    23829    3                 THEN CALL CNC_DEV;
      993    23830    3   NO_WAY:       ;
      994    23831    3               END;
      995    23832        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:40   
      996    23833        /* General Poll on slave line */
      997    23834
      998    23835    2            CASE(%KZ#LINFCN_POL);
      999    23836
     1000    23837    3              IF KZ$LINCTX.INPDATSIZ~=4 THEN DO;
     1001    23838    3                 LINRSP=%KZ#LINRSP_NUL;    /* Not a valid poll                   */
     1002    23839    3                 RETURN;
     1003    23840    3                 END;
     1004    23841    2              STATUS = KZ$LINCTX.INPBFR$->BIT16(0)&'3F3F'X;
     1005    23842    2              IF STATUSB.I ~= STATUSB.J THEN
     1006    23843    3              DO;                          /* CTRL ADDRESS MESSED UP - BAD POLL  */
     1007    23844    3                 CALL ERRLOG(%E$BADPOL);
     1008    23845    3                 GOTO SND_EOT;
     1009    23846    3                 END;
     1010    23847    2              I = STATUSB.J;
     1011    23848    2              STATUS = KZ$LINCTX.INPBFR$->BIT16(1)&'3F3F'X;
     1012    23849    2              IF STATUSB.I ~= STATUSB.J THEN
     1013    23850    3              DO;                     /* Device addresses messed up - BAD POLL   */
     1014    23851    3                 CALL ERRLOG(%E$BADPOL);
     1015    23852    3                 GOTO SND_EOT;
     1016    23853    3                 END;
     1017    23854    2              J = STATUSB.J;
     1018    23855
     1019    23856    2              KZ$LINCTX.FLAGS.CTRINITDONE='1'B;
     1020    23857    2              KZ$LINCTX.RTRCNT=0;
     1021    23858    2              IF I>=32 THEN
     1022    23859    2                 GOTO SEL_ECT;
     1023    23860    2              IF J~=63 THEN
     1024    23861    2                 GOTO SPC_POL;
     1025    23862    3              IF KZ$LINCTX.CURCTR$=ADDR(NIL) THEN DO; /* No current ctr          */
     1026    23863    3                 CALL FND_CTR ALTRET(SND_EOT);
     1027    23864    3                 KZ$LINCTX.CURCTR$=CTR$;
     1028    23865    3                 END;
     1029    23866    2              ELSE
     1030    23867    2                 CTR$=KZ$LINCTX.CURCTR$;
     1031    23868
     1032    23869    2              IF KZ$LINCTX.CURDEV$~=ADDR(NIL) THEN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:41   
     1033    23870    2   NXTDEV:       DEV$=KZ$LINCTX.CURDEV$->KZ$3270DEV.LNK$;
     1034    23871    2              ELSE
     1035    23872    2                 DEV$=KZ$3270CTR.DEVHD$;
     1036    23873    2              IF DEV$=ADDR(NIL) THEN
     1037    23874    2                 IF KZ$LINCTX.OTPHD$=ADDR(NIL) THEN /* Nothing to send           */
     1038    23875    3                 DO;
     1039    23876    3                    KZ$LINCTX.OTPCNT=0;
     1040    23877    3                    GOTO SND_EOT;
     1041    23878    3                    END;
     1042    23879    3                 ELSE DO;
     1043    23880    3                    LINRSP=%KZ#LINRSP_DAT;
     1044    23881    3                    RETURN;
     1045    23882    3                    END;
     1046    23883    2              KZ$LINCTX.CURDEV$=DEV$;
     1047    23884    3              IF KZ$3270DEV.OTPHD$~=ADDR(NIL) AND NOT KZ$3270DEV.HLT THEN DO;
     1048    23885    3                 IF KZ$LINCTX.OTPTL$~=ADDR(NIL) THEN
     1049    23886    3                    KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;
     1050    23887    3                 ELSE
     1051    23888    3                    KZ$LINCTX.OTPHD$=KZ$3270DEV.OTPHD$;
     1052    23889    3                 KZ$LINCTX.OTPTL$=KZ$3270DEV.OTPHD$;
     1053    23890    3                 KZ$3270DEV.OTPHD$=KZ$3270DEV.OTPHD$->KZ$OTPBFR.LNK$;
     1054    23891    3                 KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=ADDR(NIL);
     1055    23892    3                 KZ$3270DEV.OTPBSY='1'B;
     1056    23893    3                 IF KZ$3270DEV.OTPHD$=ADDR(NIL) THEN
     1057    23894    3                    KZ$3270DEV.OTPTL$=ADDR(NIL);
     1058    23895    3                 END;
     1059    23896    2              GOTO NXTDEV;
     1060    23897        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:42   
     1061    23898        /* Specific Poll */
     1062    23899
     1063    23900    2   SPC_POL:
     1064    23901    2              STATUS=KZ$LINCTX.INPBFR$->BIT16(0)&'3F3F'X;
     1065    23902    2              CALL FND_CTR ALTRET(SND_EOT);
     1066    23903    2              CALL FND_DEV ALTRET(SND_EOT);
     1067    23904    2              IF KZ$3270DEV.OTPHD$~=ADDR(NIL) AND NOT KZ$3270DEV.HLT THEN
     1068    23905    2                 GOTO SND_DAT;
     1069    23906    2              GOTO SND_EOT;
     1070    23907
     1071    23908    2   SND_DAT:
     1072    23909    2              KZ$LINCTX.OTPHD$=KZ$3270DEV.OTPHD$;
     1073    23910    2              KZ$LINCTX.OTPTL$=KZ$3270DEV.OTPHD$;
     1074    23911    2              KZ$3270DEV.OTPHD$=KZ$3270DEV.OTPHD$->KZ$OTPBFR.LNK$;
     1075    23912    2              IF KZ$3270DEV.OTPHD$=ADDR(NIL) THEN
     1076    23913    2                 KZ$3270DEV.OTPTL$=ADDR(NIL);
     1077    23914    2              LINRSP=%KZ#LINRSP_DAT;
     1078    23915    2              RETURN;
     1079    23916
     1080    23917    2   SND_EOT:
     1081    23918    2              KZ$LINCTX.CURDEV$=ADDR(NIL);
     1082    23919    2              KZ$LINCTX.CURCTR$=ADDR(NIL);
     1083    23920    2              LINRSP=%KZ#LINRSP_EOT;
     1084    23921    2              RETURN;
     1085    23922
     1086    23923        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:43   
     1087    23924        /* Select for slave lines */
     1088    23925
     1089    23926    2   SEL_ECT:
     1090    23927    2              STATUS=KZ$LINCTX.INPBFR$->BIT16(0)&'1F1F'X;
     1091    23928    2              I=STATUSB.I;
     1092    23929    2              CALL FND_CTR ALTRET(SND_NULL);
     1093    23930    2              KZ$LINCTX.CURCTR$=CTR$;
     1094    23931    2              CALL FND_DEV ALTRET(SND_NULL);
     1095    23932    2              KZ$LINCTX.CURDEV$=DEV$;
     1096    23933    2   SND_ACK:   LINRSP=%KZ#LINRSP_ACK;
     1097    23934    2              RETURN;
     1098    23935
     1099    23936
     1100    23937    2   SND_NULL:  LINRSP=%KZ#LINRSP_NUL;
     1101    23938    2              RETURN;
     1102    23939
     1103    23940    2            CASE(%KZ#LINFCN_DISABL);
     1104    23941    2            CASE(ELSE);
     1105    23942    2              CALL M$XXX;                  /* Unknown function from line-manager */
     1106    23943    2            END;                           /* End DO CASE(KZ$EVENT.EVENT)        */
     1107    23944
     1108    23945    1   XIT:
     1109    23946    1           IF VDH_FLG~=0 THEN
     1110    23947    1              CALL EXIT_VDH (KZ$3270DEV.VDI$);
     1111    23948
     1112    23949    1           RETURN;
     1113    23950        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:44   
     1114    23951    1   NO_MEMORY:
     1115    23952        /* NO_MEMORY - Disconnect the line due to a lack of MEMory */
     1116    23953    1           CALL ERRLOG(%E$NO_MEMORY);
     1117    23954    1           CALL DSC_LINE;
     1118    23955    1           GOTO XIT;
     1119    23956        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:45   
     1120    23957        /* KZV$DFR - Process deferred items */
     1121    23958
     1122    23959    1   KZV$DFR: ENTRY(PARAMETER1) ALTRET;
     1123    23960
     1124    23961    1           DEV$=ADDR(DEVCTX);
     1125    23962    1           CTR$=KZ$3270DEV.CTR$;
     1126    23963    1           LIN$=KZ$3270CTR.LIN$;
     1127    23964    1           VDH_FLG=1;                      /* Already in VDH                     */
     1128    23965
     1129    23966    2           DO WHILE(KZ$3270DEV.DFRHD$~=ADDR(NIL));
     1130    23967    2              BFR$=KZ$3270DEV.DFRHD$;
     1131    23968    2              KZ$3270DEV.DFRHD$=KZ$OTPBFR.LNK$;
     1132    23969    2              IF KZ$3270DEV.DFRHD$=ADDR(NIL) THEN
     1133    23970    2                 KZ$3270DEV.DFRTL$=ADDR(NIL);
     1134    23971    3              DO CASE(KZ$OTPBFR.TYP);
     1135    23972    3               CASE(%KZ#BFRTYP_OTP);
     1136    23973    3                 CALL RELOTPBFR;
     1137    23974    3               CASE(%KZ#BFRTYP_INP);
     1138    23975    3                 KV$VDH_DAT=KV_VDH_DAT;
     1139    23976    3                 KV$VDH_DAT.DAT__.ADR$=KZ$INPBFR.DATA$;
     1140    23977    3                 KV$VDH_DAT.DAT__.BYTX=KZ$INPBFR.BYTX;
     1141    23978    3                 KV$VDH_DAT.DAT__.DATBYTSIZ=KZ$INPBFR.DATA_SIZ;
     1142    23979    3                 KV$VDH_DAT.CTN=KZ$INPBFR.FLAGS.CTN#;
     1143    23980    3                 KZ$3270DEV.MUST_SBA='1'B;
     1144    23981    3                 CALL KVV$VDI(KV$VDH_DAT);
     1145    23982    3                 KZ$3270STT.KHSTT.INPBFRBYTUTL=KZ$3270STT.KHSTT.INPBFRBYTUTL-
     1146    23983    3                   (KZ$INPBFR.BFR_SIZ*2);
     1147    23984    3                 T$=KZ$INPBFR.DATA$;
     1148    23985    3                 I=KZ$INPBFR.BFR_SIZ;
     1149    23986    3                 CALL KVB$RLSSYS(I,T$);
     1150    23987    3                 T$=BFR$;
     1151    23988    3                 CALL KVB$RLSSYS(SIZEW(KZ$INPBFR),T$);
     1152    23989    3               END;
     1153    23990    2              END;
     1154    23991    1           RETURN;
     1155    23992        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:46   
     1156    23993        /* KZV$DSC - Disconnect processing */
     1157    23994
     1158    23995    1   KZV$DSC: ENTRY(PARAMETER1) ALTRET;
     1159    23996
     1160    23997    1           DEV$=ADDR(DEVCTX);
     1161    23998    1           CTR$=KZ$3270DEV.CTR$;
     1162    23999    1           LIN$=KZ$3270CTR.LIN$;
     1163    24000    1           VDH_FLG=1;                      /* Already in VDH                     */
     1164    24001    1           CALL DSC_DEV(%KV_DSCRSN_PTH);
     1165    24002    1           RETURN;
     1166    24003
     1167    24004    1   KZV$DSC_CONT: ENTRY(PARAMETER1) ALTRET;
     1168    24005
     1169    24006    1           DEV$=ADDR(DEVCTX);
     1170    24007    1           CTR$=KZ$3270DEV.CTR$;
     1171    24008    1           LIN$=KZ$3270CTR.LIN$;
     1172    24009    1           VDH_FLG=1;                      /* Already in VDH                     */
     1173    24010    1           CALL DSC_DEV_CONT(%KV_DSCRSN_PTH);
     1174    24011    1           RETURN;
     1175    24012
     1176    24013    1   KZV$DSC_LINE: ENTRY(PARAMETER1) ALTRET;
     1177    24014
     1178    24015    1           LIN$=ADDR(LINCTX);
     1179    24016    1           CALL DSC_LINE;
     1180    24017    1           RETURN;
     1181    24018
     1182    24019    1   DSC_LINE: PROC;
     1183    24020
     1184    24021    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1185    24022    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_KILLED;
     1186    24023    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$LINCTX.CHN$->KH$CHN.TERMID);
     1187    24024    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1188    24025    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);
     1189    24026    2           RETURN;
     1190    24027
     1191    24028    2   END DSC_LINE;
     1192    24029        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:47   
     1193    24030        /* KZV$RELOTPBFR - Release an output buffer */
     1194    24031
     1195    24032    1   KZV$RELOTPBFR: ENTRY(PARAMETER1,PARAMETER2) ALTRET;
     1196    24033
     1197    24034    1           DEV$=ADDR(DEVCTX);
     1198    24035    1           CTR$=KZ$3270DEV.CTR$;
     1199    24036    1           LIN$=KZ$3270CTR.LIN$;
     1200    24037    1           VDH_FLG=1;                      /* Already in VDH                     */
     1201    24038    1           BFR$=OTPBFR$;
     1202    24039    1           CALL RELOTPBFR;
     1203    24040    1           RETURN;
     1204    24041        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:48   
     1205    24042        /* KZV$RLSCTX - Release Context */
     1206    24043
     1207    24044    1   KZV$RLSCTX: ENTRY(PARAMETER1) ALTRET;
     1208    24045
     1209    24046    1           DEV$=ADDR(DEVCTX);
     1210    24047    1           KZ$3270DEV.VDI$=ADDR(NIL);
     1211    24048    1           VDH_FLG=1;                      /* ALREADY IN VDH                     */
     1212    24049    1           CTR$=KZ$3270DEV.CTR$;
     1213    24050    1           LIN$=KZ$3270CTR.LIN$;
     1214    24051    1           CALL RLS_DEV;
     1215    24052    1           RETURN;
     1216    24053        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:49   
     1217    24054        /* Find controller context */
     1218    24055
     1219    24056    1   FND_CTR: PROC ALTRET;
     1220    24057
     1221    24058    2           IF I>31 THEN
     1222    24059    3           DO;                             /* Got a bad controller number        */
     1223    24060    3   ERRDEV:    CALL ERRLOG(%E$BADADR);
     1224    24061    3              ALTRETURN;
     1225    24062    3              END;
     1226    24063    2           CTR$=KZ$LINCTX.CTRHD$;
     1227    24064    3           DO WHILE(CTR$~=ADDR(NIL));
     1228    24065    3              IF KZ$3270CTR.ADR=I THEN
     1229    24066    3                 RETURN;
     1230    24067    3              CTR$=KZ$3270CTR.LNK$;
     1231    24068    3              END;
     1232    24069    2           GOTO ERRDEV;
     1233    24070
     1234    24071        /* Find device context given controller context */
     1235    24072
     1236    24073    2   FND_DEV: ENTRY ALTRET;
     1237    24074
     1238    24075    2           IF J>31 THEN
     1239    24076    2              GOTO ERRDEV;
     1240    24077    2           DEV$=KZ$3270CTR.DEVHD$;
     1241    24078    3           DO WHILE(DEV$~=ADDR(NIL));
     1242    24079    3              IF KZ$3270DEV.ADR=J THEN
     1243    24080    3                 RETURN;
     1244    24081    3              DEV$=KZ$3270DEV.LNK$;
     1245    24082    3              END;
     1246    24083    2           GOTO ERRDEV;
     1247    24084    2   END FND_CTR;
     1248    24085        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:50   
     1249    24086        /* Find device context */
     1250    24087
     1251    24088    1   FND_CTX: PROC ALTRET;
     1252    24089
     1253    24090
     1254    24091        /*N* KLUDGE UNTIL PL6 FIXED */
     1255    24092    2           STATUS=KZ$LINCTX.INPBFR$->BIT16(0)&'3F3F'X;
     1256    24093    2           I=STATUSB.I;
     1257    24094    2           J=STATUSB.J;
     1258    24095
     1259    24096    2           CALL FND_CTR ALTRET(NO_SUCH_ANIMAL);
     1260    24097    2           KZ$LINCTX.CURCTR$=CTR$;
     1261    24098    2           CALL FND_DEV ALTRET(NO_SUCH_ANIMAL);
     1262    24099    2           KZ$LINCTX.CURDEV$=DEV$;
     1263    24100    2           RETURN;
     1264    24101
     1265    24102    2   NO_SUCH_ANIMAL:
     1266    24103    2           ALTRETURN;
     1267    24104
     1268    24105    2   END FND_CTX;
     1269    24106        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:51   
     1270    24107        /* Build device context */
     1271    24108
     1272    24109    1   BLD_DEV_CTX: PROC ALTRET;
     1273    24110
     1274    24111    2           SZ=SIZEW(KZ$3270DEV);
     1275    24112    2           CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);
     1276    24113    2           KZ$3270STT.KHSTT.CTXBYTUTL = KZ$3270STT.KHSTT.CTXBYTUTL + SIZEC(KZ$3270DEV);
     1277    24114    2           DEV$=T$;
     1278    24115    2           KZ$LINCTX.CURDEV$=DEV$;
     1279    24116    2           KZ$3270DEV=KZ_3270DEV;
     1280    24117    2           KZ$3270DEV.CTR$=CTR$;
     1281    24118    2           KZ$3270DEV.ADR=J;
     1282    24119    2           KZ$3270DEV.ROWS=KZ$3270CTR.ROWS;
     1283    24120    2           KZ$3270DEV.COLS=KZ$3270CTR.COLS;
     1284    24121    2           IF KZ$3270CTR.TYP=3276 THEN
     1285    24122    2              KZ$3270DEV.EWALT='1'B;
     1286    24123    2           KZ$3270DEV.LNK$=KZ$3270CTR.DEVHD$;
     1287    24124    2           KZ$3270CTR.DEVHD$=DEV$;
     1288    24125    2           CALL SET_PRO;
     1289    24126    2           RETURN;
     1290    24127
     1291    24128    2   NO_MEMORY:
     1292    24129    2           ALTRETURN;
     1293    24130
     1294    24131    2   END BLD_DEV_CTX;
     1295    24132        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:52   
     1296    24133        /* Build controller context */
     1297    24134
     1298    24135    1   BLD_CTR_CTX: PROC ALTRET;
     1299    24136
     1300    24137    2           SZ=SIZEW(KZ$3270CTR);
     1301    24138    2           CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);
     1302    24139    2           KZ$3270STT.KHSTT.CTXBYTUTL = KZ$3270STT.KHSTT.CTXBYTUTL + SIZEC(KZ$3270CTR);
     1303    24140    2           CTR$=T$;
     1304    24141    2           KZ$3270CTR=KZ_3270CTR;
     1305    24142    2           P1$=ADDR(NIL);
     1306    24143    2           T$=KZ$LINCTX.CTRHD$;
     1307    24144    3           DO WHILE(T$~=ADDR(NIL));
     1308    24145    3              P1$=T$;
     1309    24146    3              T$=T$->KZ$3270CTR.LNK$;
     1310    24147    3              END;
     1311    24148    2           IF P1$~=ADDR(NIL) THEN
     1312    24149    2              P1$->KZ$3270CTR.LNK$=CTR$;
     1313    24150    2           ELSE
     1314    24151    2              KZ$LINCTX.CTRHD$=CTR$;
     1315    24152    2           RETURN;
     1316    24153
     1317    24154    2   NO_MEMORY:
     1318    24155    2           ALTRETURN;
     1319    24156
     1320    24157    2   END BLD_CTR_CTX;
     1321    24158        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:53   
     1322    24159        /* Initialize the PRO field in the dev context */
     1323    24160
     1324    24161    1   SET_PRO: PROC;
     1325    24162
     1326    24163    2           KZ$3270DEV.PRO='0'B;
     1327    24164    2           IF KZ$3270DEV.EWALT THEN
     1328    24165    2              KZ$3270DEV.PRO.EWALT='1'B;
     1329    24166    2           RETURN;
     1330    24167    2   END SET_PRO;
     1331    24168        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:54   
     1332    24169        /* RELOTPBFR - Release output buffer chain */
     1333    24170
     1334    24171    1   RELOTPBFR: PROC;
     1335    24172
     1336    24173    2   DCL I UBIN;
     1337    24174
     1338    24175    2           TBFR$=KZ$LINCTX.OTPHD$;
     1339    24176    3           DO WHILE(TBFR$~=ADDR(NIL));
     1340    24177    3              IF TBFR$->KZ$OTPBFR.DEV$=DEV$ THEN
     1341    24178    3                 GOTO MORE_OTP;
     1342    24179    3              TBFR$=TBFR$->KZ$OTPBFR.LNK$;
     1343    24180    3              END;
     1344    24181    2           KZ$3270DEV.OTPBSY='0'B;         /* No more for this dev               */
     1345    24182
     1346    24183    2   MORE_OTP:
     1347    24184
     1348    24185    2           CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);
     1349    24186    3           IF DFRD THEN DO;                /* Can't get to VDH now               */
     1350    24187    3              IF KZ$3270DEV.DFRTL$~=ADDR(NIL) THEN
     1351    24188    3                 KZ$3270DEV.DFRTL$->KZ$OTPBFR.LNK$=BFR$;
     1352    24189    3              ELSE
     1353    24190    3                 KZ$3270DEV.DFRHD$=BFR$;
     1354    24191    3              KZ$3270DEV.DFRTL$=BFR$;
     1355    24192    3              KZ$OTPBFR.LNK$=ADDR(NIL);
     1356    24193    3              RETURN;
     1357    24194    3              END;
     1358    24195
     1359    24196    2           IF KZ$3270DEV.OTPHD$=ADDR(NIL) AND KZ$3270DEV.DONE THEN
     1360    24197    2              IF NOT KZ$OTPBFR.FLAGS.RELOTPBFR THEN
     1361    24198    2                 CALL KZT$CMPOTP(KZ$3270DEV); /* Make VDH give up buffer         */
     1362    24199
     1363    24200    3           IF KZ$OTPBFR.MRKCNT~=0 THEN DO; /* Output markers                     */
     1364    24201    3              TBFR$=PINCRW(BFR$,KZ_3270_BFRSIZ(KZ$OTPBFR.BFRSIZ)-
     1365    24202    3                SIZEW(KV$OTPMRK));
     1366    24203    4              DO WHILE(KZ$OTPBFR.MRKCNT~=0);
     1367    24204    4                 KV$VDH_OTPMRK=KV_VDH_OTPMRK;
     1368    24205    4                 KV$VDH_OTPMRK.DAT=TBFR$->KV$OTPMRK;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:55   
     1369    24206    4                 KV$VDH_OTPMRK.CMPCOD=KZ$OTPBFR.CMPCOD;
     1370    24207    4                 CALL KVV$VDI(KV$VDH_OTPMRK);
     1371    24208    4                 TBFR$=PINCRW(TBFR$,-SIZEW(KV$OTPMRK));
     1372    24209    4                 KZ$OTPBFR.MRKCNT=KZ$OTPBFR.MRKCNT-1;
     1373    24210    4                 END;
     1374    24211    3              END;
     1375    24212
     1376    24213    2           IF KZ$OTPBFR.FLAGS.CNT# THEN
     1377    24214    2              KZ$3270DEV.OTPBYTES=KZ$3270DEV.OTPBYTES-KZ$OTPBFR.DATA_SIZ;
     1378    24215    2           IF KZ$3270DEV.OTPBYTES~=0 AND KZ$3270DEV.OTPHD$=ADDR(NIL) AND
     1379    24216    3             NOT KZ$3270DEV.OTPBSY AND KZ$3270DEV.DFRHD$=ADDR(NIL) THEN DO;
     1380    24217    3              CALL ERRLOG(%E$THRERR);
     1381    24218    3              KZ$3270DEV.OTPBYTES=0;
     1382    24219    3              END;
     1383    24220    3           IF KZ$3270DEV.THROTL AND KZ$3270DEV.OTPBYTES<=KZT_THRTL_UNBLK THEN DO;
     1384    24221    3              KZ$3270DEV.THROTL='0'B;
     1385    24222                   %KV$RQSOTP (RQSOTP=YES);
             24234    4           IF NOT KV$PTR.VDI$->KV$VDI.RQSOTP  THEN DO;
             24235    4              KV$PTR.VDI$->KV$VDI.RQSOTP = '1'B;
             24236    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);
             24237    4              END;                         /* END IF                             */
     1386    24240    3              END;
     1387    24241
     1388    24242    2           T$=BFR$;
     1389    24243    2           I=KZ_3270_BFRSIZ(KZ$OTPBFR.BFRSIZ);
     1390    24244    2           KZ$3270STT.KHSTT.OTPBFRBYTUTL = KZ$3270STT.KHSTT.OTPBFRBYTUTL - I*2;
     1391    24245    2           CALL KVB$RLS2NSYS(I,T$);
     1392    24246
     1393    24247    2           IF KZ$3270DEV.DSC.VDH_FINAL AND KZ$3270DEV.OTPHD$=ADDR(NIL)
     1394    24248    3             AND NOT KZ$3270DEV.OTPBSY THEN DO;
     1395    24249    3              KZ$3270DEV.DSC.DEV_FINAL='1'B; /* All output drained               */
     1396    24250    3              CALL DSC_DEV_FINAL;
     1397    24251    3              END;
     1398    24252
     1399    24253    2           CALL EXIT_VDH (KZ$3270DEV.VDI$);
     1400    24254
     1401    24255    2           RETURN;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:56   
     1402    24256
     1403    24257    2   END RELOTPBFR;
     1404    24258        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:57   
     1405    24259        /* Requeue current output back onto device queue */
     1406    24260
     1407    24261    1   REQUEUE: PROC;
     1408    24262    2   DCL B$ PTR;
     1409    24263    2   DCL X_00100_X UBIN;
     1410    24264    2   DCL O_11011_O PTR;
     1411    24265
     1412    24266    2           T$=DEV$;
     1413    24267    2           IF KZ$LINCTX.PRO.SLAVE THEN
     1414    24268    3           DO;                             /* SLAVE                              */
     1415    24269    4              DO WHILE (KZ$LINCTX.OTPHD$ ~= ADDR(NIL));
     1416    24270    4                 DEV$=KZ$LINCTX.OTPHD$->KZ$OTPBFR.DEV$;
     1417    24271    4                 B$=KZ$LINCTX.OTPHD$;
     1418    24272    4                 KZ$LINCTX.OTPHD$=KZ$LINCTX.OTPHD$->KZ$OTPBFR.LNK$;
     1419    24273    4                 IF KZ$LINCTX.OTPHD$ = ADDR(NIL)
     1420    24274    4                 THEN KZ$LINCTX.OTPTL$=ADDR(NIL);
     1421    24275    4                 B$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;
     1422    24276    4                 KZ$3270DEV.OTPHD$=B$;
     1423    24277    4                 IF KZ$3270DEV.OTPTL$ = ADDR(NIL)
     1424    24278    4                 THEN KZ$3270DEV.OTPTL$=B$;
     1425    24279    4                 KZ$3270DEV.OTPBSY='0'B;
     1426    24280    4                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;
     1427    24281    4                 END;
     1428    24282    3              END;
     1429    24283    2           ELSE
     1430    24284    2              IF KZ$LINCTX.OTPHD$ = ADDR(NIL) /* MASTER                          */
     1431    24285    2              THEN ;
     1432    24286    2              ELSE
     1433    24287    3              DO;
     1434    24288    3                 DEV$=KZ$LINCTX.OTPHD$->KZ$OTPBFR.DEV$;
     1435    24289    3                 X_00100_X=1;
     1436    24290    3                 O_11011_O=KZ$LINCTX.OTPHD$;
     1437    24291    4                 DO WHILE (O_11011_O->KZ$OTPBFR.LNK$ ~= ADDR(NIL));
     1438    24292    4                    X_00100_X=X_00100_X+1;
     1439    24293    4                    O_11011_O=O_11011_O->KZ$OTPBFR.LNK$;
     1440    24294    4                    END;
     1441    24295    3                 KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:58   
     1442    24296    3                 KZ$3270DEV.OTPHD$=KZ$LINCTX.OTPHD$;
     1443    24297    3                 IF KZ$3270DEV.OTPTL$ = ADDR(NIL)
     1444    24298    3                 THEN KZ$3270DEV.OTPTL$=KZ$LINCTX.OTPTL$;
     1445    24299    3                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+X_00100_X;
     1446    24300    3                 KZ$LINCTX.OTPHD$=ADDR(NIL);
     1447    24301    3                 KZ$LINCTX.OTPTL$=ADDR(NIL);
     1448    24302    3                 KZ$3270DEV.OTPBSY='0'B;
     1449    24303    3                 END;
     1450    24304    2           DEV$=T$;
     1451    24305
     1452    24306    2           RETURN;
     1453    24307
     1454    24308    2   END REQUEUE;
     1455    24309        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:59   
     1456    24310        /* RLS_DEV - Release Device Context */
     1457    24311
     1458    24312    1   RLS_DEV: PROC;
     1459    24313
     1460    24314    2           IF KZ$3270DEV.VDI$~=ADDR(NIL) THEN
     1461    24315    2              RETURN;
     1462    24316    3           IF KZ$3270DEV.REACT THEN DO;
     1463    24317    3              KZ$3270DEV.REACT='0'B;
     1464    24318    3              KZ$3270DEV.ACTIVE='1'B;
     1465    24319    3              END;
     1466    24320    3           IF KZ$LINCTX.FLAGS.DSC THEN DO;
     1467    24321    4              DO CASE (KZ$LINCTX.DSC_LEV);
     1468    24322    4               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */
     1469    24323    4                 CALL REALLY_CLR_DEV;
     1470    24324    4               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */
     1471    24325    4                 CALL CLR_DEV;
     1472    24326    4                 KZ$3270DEV.CLRD='1'B;
     1473    24327    4               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */
     1474    24328    4                 CALL CLR_DEV;
     1475    24329    4                 KZ$LINCTX.FLAGS.DSC='0'B;
     1476    24330    4                 RETURN;
     1477    24331    4               END;
     1478    24332    3              END;
     1479    24333    3           ELSE DO;
     1480    24334    3              CALL CLR_DEV;
     1481    24335    3              RETURN;
     1482    24336    3              END;
     1483    24337    2           DEV$=KZ$3270CTR.DEVHD$;
     1484    24338    3           DO WHILE (DEV$~=ADDR(NIL));
     1485    24339    3              IF KZ$3270DEV.CLRD = '0'B THEN RETURN;
     1486    24340    3              DEV$=KZ$3270DEV.LNK$;
     1487    24341    3              END;
     1488    24342    2           CALL RLS_CTR;
     1489    24343    2   END RLS_DEV;
     1490    24344        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:60   
     1491    24345        /* RLS_CTR - Release controller context */
     1492    24346
     1493    24347    1   RLS_CTR: PROC;
     1494    24348    3           DO CASE (KZ$LINCTX.DSC_LEV);
     1495    24349    3            CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                               */
     1496    24350    3              CALL REALLY_CLR_CTR;
     1497    24351    3            CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                      */
     1498    24352    3              CALL CLR_CTR;
     1499    24353    3              DEV$=KZ$3270CTR.DEVHD$;
     1500    24354    4              DO WHILE (DEV$~=ADDR(NIL));
     1501    24355    4                 KZ$3270DEV.CLRD = '0'B;
     1502    24356    4                 DEV$=KZ$3270DEV.LNK$;
     1503    24357    4                 END;
     1504    24358    3              KZ$LINCTX.FLAGS.DSC='0'B;
     1505    24359    3              RETURN;
     1506    24360    3            END;
     1507    24361    2           IF KZ$LINCTX.CTRHD$=ADDR(NIL) THEN CALL RLS_LINE;
     1508    24362    2   END RLS_CTR;
     1509    24363
     1510    24364        /* RLS_LINE - Release line context */
     1511    24365
     1512    24366    1   RLS_LINE: PROC;
     1513    24367    3           DO CASE (KZ$LINCTX.DSC_LEV);
     1514    24368    3            CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                               */
     1515    24369    3              CALL REALLY_CLR_LINE;
     1516    24370    3            END;
     1517    24371    2   END RLS_LINE;
     1518    24372        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:61   
     1519    24373    1   CLR_DEV: PROC;
     1520    24374    2           KZ$3270DEV.AWAIT_ENABLE='0'B;
     1521    24375    2           KZ$3270DEV.THROTL='0'B;
     1522    24376    2           KZ$3270DEV.OTPBSY='0'B;
     1523    24377    2           KZ$3270DEV.HLT='0'B;
     1524    24378                /*  OTPBYTES is not reset here:  there still may be some
     1525    24379                    output on the DFR queue.  */
     1526    24380    2           KZ$3270DEV.DSC='0'B;
     1527    24381    2           KZ$3270DEV.KBDLCK='1'B;
     1528    24382    2           KZ$3270DEV.DSC_LATER='0'B;
     1529    24383    2           KZ$3270DEV.MUST_SBA='0'B;
     1530    24384    2           KZ$3270DEV.PRINTER_DOWNS=0;
     1531    24385    2           KZ$3270CTR.PRINTER_CNC_DONE='0'B;
     1532    24386    2           CALL SET_PRO;
     1533    24387    2           IF KZ$3270DEV.ACTIVE THEN
     1534    24388    2              CALL CNC_DEV;
     1535    24389    2   END;
     1536    24390
     1537    24391    1   CLR_CTR: PROC;
     1538    24392    2           KZ$3270CTR.TIMED_OUT_ONCE='0'B;
     1539    24393    2           KZ$3270CTR.PRINTER_CNC_DONE='0'B;
     1540    24394    2   END;
     1541    24395
     1542    24396    1   REALLY_CLR_DEV: PROC;
     1543    24397    2           T$=KZ$3270CTR.DEVHD$;
     1544    24398    2           P1$=ADDR(NIL);
     1545    24399    3           DO WHILE(T$~=DEV$);
     1546    24400    3              P1$=T$;
     1547    24401    3              T$=T$->KZ$3270DEV.LNK$;
     1548    24402    3              END;
     1549    24403    2           IF P1$=ADDR(NIL) THEN
     1550    24404    2              KZ$3270CTR.DEVHD$=KZ$3270DEV.LNK$;
     1551    24405    2           ELSE
     1552    24406    2              P1$->KZ$3270DEV.LNK$=KZ$3270DEV.LNK$;
     1553    24407    2           KZ$LINCTX.OTPDEV$ = ADDR(NIL);
     1554    24408                %DISABLE(INHLVL=KH_INHLVL);
     1555    24412    2           CALL KVB$RLSSYS(SIZEW(KZ$3270DEV),T$);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:62   
     1556    24413                %ENABLE(INHLVL=KH_INHLVL);
     1557    24419    2           KZ$3270STT.KHSTT.CTXBYTUTL = KZ$3270STT.KHSTT.CTXBYTUTL - SIZEC(KZ$3270DEV);
     1558    24420    2   END;
     1559    24421
     1560    24422    1   REALLY_CLR_CTR: PROC;
     1561    24423    2           T$=KZ$LINCTX.CTRHD$;
     1562    24424    2           P1$=ADDR(NIL);
     1563    24425    3           DO WHILE(T$~=CTR$);
     1564    24426    3              P1$=T$;
     1565    24427    3              T$=T$->KZ$3270CTR.LNK$;
     1566    24428    3              END;
     1567    24429    2           IF P1$=ADDR(NIL) THEN
     1568    24430    2              KZ$LINCTX.CTRHD$=KZ$3270CTR.LNK$;
     1569    24431    2           ELSE
     1570    24432    2              P1$->KZ$3270CTR.LNK$=KZ$3270CTR.LNK$;
     1571    24433                %DISABLE(INHLVL=KH_INHLVL);
     1572    24437    2           CALL KVB$RLSSYS(SIZEW(KZ$3270CTR),T$);
     1573    24438                %ENABLE(INHLVL=KH_INHLVL);
     1574    24444    2           KZ$3270STT.KHSTT.CTXBYTUTL = KZ$3270STT.KHSTT.CTXBYTUTL - SIZEC(KZ$3270CTR);
     1575    24445    2   END;
     1576    24446
     1577    24447    1   REALLY_CLR_LINE: PROC;
     1578    24448    3           IF KZ$LINCTX.CTRLST$~=ADDR(NIL) THEN DO;
     1579    24449                   %DISABLE(INHLVL=KH_INHLVL);
     1580    24453    3              CALL KVB$RLSSYS
     1581    24454    3                (((KZ$LINCTX.POLSIZ*5)+1)/2,KZ$LINCTX.CTRLST$);
     1582    24455    3              KZ$LINCTX.CTRLST$=ADDR(NIL);
     1583    24456    3              END;
     1584    24457    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1585    24458    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_LINDSC;
     1586    24459    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$LINCTX.CHN$->KH$CHN.TERMID);
     1587    24460    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1588    24461    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);
     1589    24462                %ENABLE(INHLVL=KH_INHLVL);
     1590    24468    2   END;
     1591    24469        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:63   
     1592    24470        /* Disconnect a device */
     1593    24471
     1594    24472    1   DSC_DEV: PROC(RSN);
     1595    24473    2   DCL RSN UBIN;
     1596    24474
     1597    24475    2           IF KZ$3270DEV.ACTIVE AND KZ$LINCTX.PRO.SLAVE THEN
     1598    24476    2              CALL KZT$SNDSLV(KZ$3270DEV);
     1599    24477    3           IF NOT KZ$3270DEV.ACTIVE AND KZ$3270DEV.OTPHD$~=ADDR(NIL) THEN DO;
     1600    24478    3              IF KZ$3270DEV.DFRTL$~=ADDR(NIL) THEN
     1601    24479    3                 KZ$3270DEV.DFRTL$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;
     1602    24480    3              ELSE
     1603    24481    3                 KZ$3270DEV.DFRHD$=KZ$3270DEV.OTPHD$;
     1604    24482    3              KZ$3270DEV.DFRTL$=KZ$3270DEV.OTPTL$;
     1605    24483    3              KZ$3270DEV.OTPHD$=ADDR(NIL);
     1606    24484    3              KZ$3270DEV.OTPTL$=ADDR(NIL);
     1607    24485    3              END;
     1608    24486
     1609    24487    3           IF KZ$3270DEV.HLT THEN DO;
     1610    24488    3              KZ$3270DEV.HLT='0'B;
     1611    24489    3              IF KZ$3270DEV.OTPHD$~=ADDR(NIL) THEN
     1612    24490    3                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;
     1613    24491    3              END;
     1614    24492
     1615    24493    2           IF KZ$LINCTX.PRO.SLAVE AND NOT KZ$3270DEV.REACT THEN
     1616    24494    2              KZ$3270DEV.ACTIVE = '0'B;    /* Don't reactivate if a slave user   */
     1617    24495    2           IF KZ$3270DEV.DSC THEN
     1618    24496    3           DO;
     1619    24497    3              CALL DEL_DFRD; /* Make sure there is no defered process waiting.   */
     1620    24498    3              RETURN;                      /* Already in disconnect              */
     1621    24499    3              END;
     1622    24500
     1623    24501    2           IF KZ$3270DEV.VDI$=ADDR(NIL) THEN
     1624    24502    2              RETURN;                      /* Nothing to disconnect              */
     1625    24503
     1626    24504    2           CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);
     1627    24505    2           KZ$3270DEV.DSC.INT='1'B;        /* Disconnect initiated               */
     1628    24506    3           IF NOT DFRD THEN DO;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:64   
     1629    24507    3   TELL_VDH:  KZ$3270DEV.DSC.TOLD_VDH='1'B;
     1630    24508    3              KV$VDH_DSC=KV_VDH_DSC;
     1631    24509    3              KV$VDH_DSC.RSN=RSN;
     1632    24510    3              KV$VDH_DSC.ALLSSN = '1'B;
     1633    24511    3              IF NOT KZ$3270DEV.ACTIVE THEN
     1634    24512    3                 KV$VDH_DSC.NO_IO = '1'B;
     1635    24513    3              CALL KVV$VDI(KV$VDH_DSC);
     1636    24514    3              IF NOT KZ$3270DEV.ACTIVE
     1637    24515    3              THEN CALL DEL_DFRD;
     1638    24516    3              CALL EXIT_VDH (KZ$3270DEV.VDI$);
     1639    24517    3              END;
     1640    24518    2           ELSE
     1641    24519    2              KZ$3270DEV.DFR.DSCI='1'B;    /* Do it later                        */
     1642    24520
     1643    24521    2           RETURN;
     1644    24522
     1645    24523    2   DSC_DEV_CONT: ENTRY(RSN);
     1646    24524
     1647    24525    3           IF KZ$3270DEV.DFR.DSCI THEN DO;
     1648    24526    3              KZ$3270DEV.DFR.DSCI='0'B;
     1649    24527    3              CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);
             24527                       /* Already in VDH - make EXIT do nothing */
     1650    24528    3              GOTO TELL_VDH;
     1651    24529    3              END;
     1652    24530    2           RETURN;
     1653    24531
     1654    24532    2   END DSC_DEV;
     1655    24533
     1656    24534    1   DSC_DEV_FINAL: PROC;
     1657    24535
     1658    24536    2   DSC_FINAL:
     1659    24537    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1660    24538    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_DEVDSC;
     1661    24539    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$3270DEV.CHN$->KH$CHN.TERMID);
     1662    24540    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1663    24541                %DISABLE(INHLVL=KH_INHLVL);
     1664    24545    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:65   
     1665    24546                %ENABLE(INHLVL=KH_INHLVL);
     1666    24552    2           KZ$3270DEV.DSC.VDH_FINAL='0'B;
     1667    24553    2           KZ$3270DEV.DSC.DEV_FINAL='0'B;
     1668    24554    2           KV$VDH_EVT=KV_VDH_EVT;
     1669    24555    2           KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;
     1670    24556    2           CALL KVV$VDI(KV$VDH_EVT);
     1671    24557    2           RETURN;
     1672    24558
     1673    24559    2   END DSC_DEV_FINAL;
     1674    24560        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:66   
     1675    24561        /*
     1676    24562              Delete any output or input buffers sitting in the defered chain.
     1677    24563        */
     1678    24564    1   DEL_DFRD: PROC;
     1679    24565
     1680    24566    3           DO WHILE(KZ$3270DEV.DFRHD$~=ADDR(NIL));
     1681    24567    3              BFR$=KZ$3270DEV.DFRHD$;
     1682    24568    3              KZ$3270DEV.DFRHD$=KZ$OTPBFR.LNK$;
     1683    24569    3              IF KZ$3270DEV.DFRHD$=ADDR(NIL) THEN
     1684    24570    3                 KZ$3270DEV.DFRTL$=ADDR(NIL);
     1685    24571    4              DO CASE(KZ$OTPBFR.TYP);
     1686    24572    4               CASE(%KZ#BFRTYP_OTP);
     1687    24573    4                 KZ$OTPBFR.CMPCOD=%KV_CMPCOD_DVCERR;
     1688    24574    4                 CALL RELOTPBFR;
     1689    24575    4               CASE(%KZ#BFRTYP_INP);
     1690    24576    4                 T$=KZ$INPBFR.DATA$;
     1691    24577    4                 CALL KVB$RLSSYS(KZ$INPBFR.BFR_SIZ,T$);
     1692    24578    4                 T$=BFR$;
     1693    24579    4                 CALL KVB$RLSSYS(SIZEW(KZ$INPBFR),T$);
     1694    24580    4               END;
     1695    24581    3              END;
     1696    24582    2   END DEL_DFRD;
     1697    24583        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:67   
     1698    24584        /* Connect a device to VDH */
     1699    24585
     1700    24586    1   CNC_DEV: PROC;
     1701    24587
     1702    24588    2           IF KZ$3270DEV.VDI$~=ADDR(NIL) THEN
     1703    24589    2              RETURN;                      /* Already have someone going here    */
     1704    24590
     1705    24591    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1706    24592    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_CNCRQS;
     1707    24593    2           KZ$CLMEVENT.CHN$=KZ$3270DEV.CHN$;
     1708    24594    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1709    24595                %DISABLE(INHLVL=KH_INHLVL);
     1710    24599    2           CALL KZT_CNCDSC@(KZ$CLMEVENT)
     1711    24600    2           WHENALTRETURN
     1712    24601    3           DO;
     1713    24602                   %ENABLE(INHLVL=KH_INHLVL);
     1714    24608    3              KZ$3270DEV.AWAIT_ENABLE='1'B;
     1715    24609    3              RETURN;
     1716    24610    3              END;
     1717    24611    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1718    24612    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_SUBCNC;
     1719    24613    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$3270DEV.CHN$->KH$CHN.TERMID);
     1720    24614    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1721    24615    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);
     1722    24616                %ENABLE(INHLVL=KH_INHLVL);
     1723    24622    2           KZ$3270DEV.AWAIT_ENABLE='0'B;
     1724    24623
     1725    24624    2           KV$VDH_INT=KV_VDH_INT;
     1726    24625    2           KV$VDH_INT.CHN$=KZ$3270DEV.CHN$;
     1727    24626    2           KV$VDH_INT.USRCTX$=DEV$;
     1728    24627    2           KV$VDH_INT.USRPRM$=KZT_USRPRM$;
     1729    24628    2           KV$VDH_INT.RCVFLWCTRMAXCRD=KZT_THRTL_INIT;
     1730    24629    2           KV$VDH_INT.TRCBFRBYTSIZ=KH$CTLTBL.PARM.PTR$(%KL_HNDLRPARM_VDHTRC)->
             24629                    VDHTRCWORD;
     1731    24630
     1732    24631    2           VDH_FLG=0;
     1733    24632    2           CALL ENTER_VDH (ADDR(NIL),DFRD);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:68   
     1734    24633    2           CALL KVV$INT(KV$VDH_INT)
     1735    24634    2           WHENALTRETURN
     1736    24635    3           DO;
     1737    24636    3              CALL EXIT_VDH (ADDR(NIL));
     1738    24637    3              RETURN;
     1739    24638    3              END;
     1740    24639
     1741    24640    2           P1$=KV$VDH_INT.VDI$;            /* Save VDI$                          */
     1742    24641
     1743    24642    2           KV$VDH_CNC=KV_VDH_CNC;
     1744    24643        /*      KV$VDH_CNC.VDI$=P1$; */
     1745    24644    2           IF KH_PROFILE_ ~= VECTOR(NIL)
     1746    24645    3           THEN DO;
     1747    24646    3              CP_PHLEGM=VBASE (KH_PROFILE_);
     1748    24647    3              KV$VDH_CNC.PRF_.ADR$=P_PHLEGM;
     1749    24648    3              KV$VDH_CNC.PRF_.BYTSIZ=VBOUND (KH_PROFILE_)+1;
     1750    24649    3              END;
     1751    24650    3           ELSE DO;
     1752    24651    3              KV$VDH_CNC.PRF_.ADR$=ADDR(PRO_ATTR);
     1753    24652    3              KV$VDH_CNC.PRF_.BYTSIZ=(SIZEC(VLP_TRMATTR)+SIZEC(VLP_TRMCTL)+4);
     1754    24653    3              END;
     1755    24654    2           KV$VDH_CNC.LINSPD=KZ$3270DEV.CHN$->KH$CHN.LINSPD;
     1756    24655    2           KV$VDH_CNC.LCLENDPNTID=KZ$3270DEV.CHN$->KH$CHN.TERMID;
     1757    24656    2           KV$VDH_CNC.LCLENDPNTID.TTYP=%KLTY_LINEDEV#;
     1758    24657    2           %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_CMPOTP)='1'B;
     1759    24658    2           %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RQSOTP)='1'B;
     1760    24659    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DLTOTP)='1'B;
     1761    24660    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DSC)='1'B;
     1762    24661    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_GETSTR)='1'B;
     1763    24662    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_HLTOTP)='1'B;
     1764    24663    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNACP)='1'B;
     1765    24664    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNRJC)='1'B;
     1766    24665    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSSTR)='1'B;
     1767    24666    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSVDI)='1'B;
     1768    24667    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_SCH)='1'B;
     1769    24668    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_VDHEXT)='1'B;
     1770    24669    2           CALL KVV$VDI(KV$VDH_CNC) ALTRET (CNC_FAIL);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:69   
     1771    24670    2           KZ$3270DEV.ACTIVE='1'B;
     1772    24671
     1773    24672    2           KZ$3270DEV.VDI$=P1$;
     1774    24673
     1775    24674    2           CALL KZT$CLEAR(KZ$3270DEV);
     1776    24675
     1777    24676    2           %KV_VDI.USEOTPBFRTRN='0'B;
     1778    24677    3           IF KZ$3270DEV.PRINTER THEN DO;
     1779    24678    3              %KV_MRD.CTNFRM='1'B;         /* Continuous form                    */
     1780    24679    3              %KV_MRD.MINSP_FORPST=0;
     1781    24680    3              END;
     1782    24681    3           ELSE DO;                        /* Display                            */
     1783    24682    3              %KV_MRD.FSTERS='1'B;
     1784    24683    3              %KV_MRD.ATRRQRDSPPST='1'B;
     1785    24684    3              %KV_VDI.INPUNT=%KV_INPUNT_BLK;
     1786    24685    3              END;
     1787    24686    2           CALL EXIT_VDH (ADDR(NIL));
     1788    24687
     1789    24688    2           RETURN;
     1790    24689
     1791    24690    2   CNC_FAIL:
     1792    24691    2           KZ$3270DEV.ACTIVE='0'B;
     1793    24692
     1794    24693    2           KV$VDH_EVT=KV_VDH_EVT;
     1795    24694    2           KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;
     1796    24695    2           CALL KVV$VDI(KV$VDH_EVT);
     1797    24696    2           CALL EXIT_VDH (ADDR(NIL));
     1798    24697    2           RETURN;
     1799    24698
     1800    24699    2   END CNC_DEV;
     1801    24700        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:70   
     1802    24701        /* ERRLOG */
     1803    24702
     1804    24703    1   ERRLOG: PROC (ERROR);
     1805    24704    2   DCL ERROR UBIN;
     1806    24705        %FPT_WRSYSLOG (STCLASS="");
     1807    24800        %FPT_WRSYSLOG (FPTN=FPT@WRSYSLOG,STCLASS=CONSTANT,FCG='KZ',MID='V');
     1808    24895    2   DCL BADPOLBFR CHAR(4) BASED;
     1809    24896
     1810    24897    2           FPT_WRSYSLOG = FPT@WRSYSLOG;
     1811    24898    2           FPT_WRSYSLOG.V.TERMID = KZ$LINCTX.LINID;
     1812    24899    2           FPT_WRSYSLOG.V.ERRCODE.ERR# = ERROR;
     1813    24900    3           DO CASE (ERROR);
     1814    24901
     1815    24902    3            CASE (%E$BADPOL);
     1816    24903        /*E* ERROR:        KZV-E$BADPOL-4
     1817    24904             MESSAGE:      3270 SLAVE received a bad poll address.
     1818    24905             DESCRIPTION:  A SLAVE 3270 LINE received a poll with an illegal
     1819    24906                           Controller/Device address.
     1820    24907                           V0 = Channel number.
     1821    24908                           DATA = Vector of first four bytes of input.
     1822    24909        */
     1823    24910    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_NONFATAL_PROT#;
     1824    24911    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;
     1825    24912    3              FPT_WRSYSLOG.V.VALUES(1)=0;
     1826    24913    3              FPT_WRSYSLOG.V.VALUES(2)=0;
     1827    24914    3              FPT_WRSYSLOG.V.VALUES(3)=0;
     1828    24915    3              FPT_WRSYSLOG.BUF_=VECTOR(KZ$LINCTX.INPBFR$->BADPOLBFR);
     1829    24916
     1830    24917    3            CASE (%E$BADSTATUS);
     1831    24918        /*E* ERROR:        KZV-E$BADSTATUS-1
     1832    24919             MESSAGE:      Unknown 3270 device status received.
     1833    24920             DESCRIPTION:  A device status was received which requires an error log.
     1834    24921                           V0 = Channel number.
     1835    24922                           V1/V2 = Controller/Device numbers.
     1836    24923                           V3 = Status bytes received (S1/S2).
     1837    24924        */
     1838    24925    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_GOOD_HARD#;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:71   
     1839    24926    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;
     1840    24927    3              FPT_WRSYSLOG.V.VALUES(1)=I;
     1841    24928    3              FPT_WRSYSLOG.V.VALUES(2)=J;
     1842    24929    3              FPT_WRSYSLOG.V.VALUES(3)=STATUSW;
     1843    24930    4              IF KZ$LINCTX.OTPHD$~=ADDR(NIL) THEN DO;
     1844    24931    4                 VBASE(FPT_WRSYSLOG.BUF_)=KZ$LINCTX.OTPHD$;
     1845    24932    4                 VBOUND(FPT_WRSYSLOG.BUF_)=KZ$LINCTX.OTPHD$->KZ$OTPBFR.DATA_SIZ-1;
     1846    24933    4                 END;
     1847    24934    3              ELSE
     1848    24935    4                 IF KZ$3270DEV.OTPHD$ ~= ADDR(NIL) THEN DO;
     1849    24936    4                    VBASE(FPT_WRSYSLOG.BUF_)=KZ$3270DEV.OTPHD$;
     1850    24937    4                    VBOUND(FPT_WRSYSLOG.BUF_)=KZ$3270DEV.OTPHD$->KZ$OTPBFR.DATA_SIZ-1;
     1851    24938    4                    END;
     1852    24939
     1853    24940    3            CASE (%E$BADADR);
     1854    24941        /*E* ERROR:        KZV-E$BADADR-3
     1855    24942             MESSAGE:      Undefined Controller/Device number in LINFCN request.
     1856    24943             DESCRIPTION:  A LINFCN code of DSCTRM, KILL, BLDCTX, ENABL, or POL
     1857    24944                           was received by the 3270 device manager, but the
     1858    24945                           Controller/Device for which the service was requested
     1859    24946                           is undefined.
     1860    24947                           V0 = Channel number.
     1861    24948                           V1/V2 = Controller/Device numbers.
     1862    24949                           DATA = Vector of the KZ$EVENT parameter.
     1863    24950        */
     1864    24951    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_SOFT#;
     1865    24952    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;
     1866    24953    3              FPT_WRSYSLOG.V.VALUES(1)=I;
     1867    24954    3              FPT_WRSYSLOG.V.VALUES(2)=J;
     1868    24955    3              FPT_WRSYSLOG.V.VALUES(3)=0;
     1869    24956    3              FPT_WRSYSLOG.BUF_=VECTOR(KZ$EVENT);
     1870    24957
     1871    24958    3            CASE (%E$THRERR);
     1872    24959        /*E* ERROR:        KZV-E$THRERR-3
     1873    24960             MESSAGE:      Throttling is out of sync.
     1874    24961             DESCRIPTION:  A device's output byte count is non zero, but no output
     1875    24962                           is pending (or in progress).
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:72   
     1876    24963                           V0 = Channel number.
     1877    24964                           V1/V2 = Controller/Device numbers.
     1878    24965                           V3 = Current output byte count.
     1879    24966        */
     1880    24967    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_SOFT#;
     1881    24968    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;
     1882    24969    3              IF DEV$=ADDR(NIL) OR CTR$=ADDR(NIL) THEN
     1883    24970    4              DO;
     1884    24971    4                 FPT_WRSYSLOG.V.VALUES(1)=31;
     1885    24972    4                 FPT_WRSYSLOG.V.VALUES(2)=31;
     1886    24973    4                 FPT_WRSYSLOG.V.VALUES(3)=0;
     1887    24974    4                 END;
     1888    24975    3              ELSE
     1889    24976    4              DO;
     1890    24977    4                 FPT_WRSYSLOG.V.VALUES(1)=KZ$3270DEV.CTR$->KZ$3270CTR.ADR;
     1891    24978    4                 FPT_WRSYSLOG.V.VALUES(2)=KZ$3270DEV.ADR;
     1892    24979    4                 FPT_WRSYSLOG.V.VALUES(3)=KZ$3270DEV.OTPBYTES;
     1893    24980    4                 END;
     1894    24981    3            CASE (%E$NO_MEMORY);
     1895    24982        /*   ERROR:        KZV-E$NO_MEMORY-6
     1896    24983             MESSAGE:      Insufficient BISYNC MEMory (a NETCON parameter).
     1897    24984             DESCRIPTION:  A KVB call ALTRETed to indicate that BISYNC is out of
     1898    24985                           MEMory.  Since a necessary I/O buffer or device context
     1899    24986                           could not be allocated, the 3270 LINE associated
     1900    24987                           with the request has been disconnected.
     1901    24988                           V0 = Channel number.
     1902    24989                           V1/V2 = Controller/Device numbers.
     1903    24990                           V3 = Size of buffer, in words, which could not be allocated.
     1904    24991        */
     1905    24992    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_LINE_ABORT#;
     1906    24993    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;
     1907    24994    3              IF DEV$=ADDR(NIL) OR CTR$=ADDR(NIL) THEN
     1908    24995    4              DO;
     1909    24996    4                 FPT_WRSYSLOG.V.VALUES(1)=31;
     1910    24997    4                 FPT_WRSYSLOG.V.VALUES(2)=31;
     1911    24998    4                 END;
     1912    24999    3              ELSE
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:73   
     1913    25000    4              DO;
     1914    25001    4                 FPT_WRSYSLOG.V.VALUES(1)=KZ$3270DEV.CTR$->KZ$3270CTR.ADR;
     1915    25002    4                 FPT_WRSYSLOG.V.VALUES(2)=KZ$3270DEV.ADR;
     1916    25003    4                 END;
     1917    25004    3              FPT_WRSYSLOG.V.VALUES(3)=SZ;
     1918    25005    3            END;
     1919    25006    2           CALL KHA$ERRLOG(FPT_WRSYSLOG);
     1920    25007    2           RETURN;
     1921    25008    2   END ERRLOG;
     1922    25009        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:74   
     1923    25010        /* ENTER_VDH - Try to enter VDH */
     1924    25011
     1925    25012    1   ENTER_VDH: PROC(VDI$,DFRD);
     1926    25013
     1927    25014    2   DCL DFRD BIT(1) ALIGNED;
     1928    25015    2   DCL VDI$ PTR;
     1929    25016
     1930    25017    3           IF VDH_FLG~=0 THEN DO;
     1931    25018    3              VDH_FLG=VDH_FLG+1;
     1932    25019    3              DFRD='0'B;
     1933    25020    3              RETURN;
     1934    25021    3              END;
     1935    25022
     1936    25023    2           IF VDI$ = ADDR(NIL)
     1937    25024    3           THEN DO;
     1938    25025                   %KV$USRENT (VDI$="ADDR(NIL)");
             25031    3              KV@USRENT.SVDPTR$ = KV$PTR$;
     1939    25051    3              END;
     1940    25052    3           ELSE DO;
     1941    25053                   %KV$USRENT (VDI$=KZ$3270DEV.VDI$,DFR$=DFR,SCHRSN=%KV_SCHRSN_DFR1);
             25066    3           KZ$3270DEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             25066                    KZ$3270DEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             25067    4           IF NOT KZ$3270DEV.VDI$->KV$VDI.BSY THEN DO;
             25068    4              KZ$3270DEV.VDI$->KV$VDI.BSY = '1'B;
             25069    4              KV@USRENT.SVDPTR$ = KV$PTR$;
             25070    4              KV$PTR$ = KZ$3270DEV.VDI$->KV$VDI.ASNINPPTR$;
             25071    4              END;                         /* ELSE IF ~BSY                       */
             25072    4           ELSE DO;
             25073    4              KZ$3270DEV.VDI$->KV$VDI.DFR.USR(1) = '1'B;
             25074    4           KZ$3270DEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             25074                    KZ$3270DEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1
             25074                    ;
             25075    4              GOTO DFR;
             25076    4              END;                         /* END IF                             */
     1942    25079    3              END;
     1943    25080    2           VDH_FLG=1;
     1944    25081    2           DFRD='0'B;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:75   
     1945    25082    2           RETURN;
     1946    25083    2   DFR:
     1947    25084    2           DFRD='1'B;
     1948    25085    2           RETURN;
     1949    25086
     1950    25087    2   END ENTER_VDH;
     1951    25088        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:76   
     1952    25089        /* EXIT_VDH - Exit VDH if it was entered */
     1953    25090
     1954    25091    1   EXIT_VDH: PROC (VDI$);
     1955    25092
     1956    25093    2   DCL VDI$ PTR;
     1957    25094
     1958    25095    2           IF VDH_FLG=0 THEN RETURN;
     1959    25096    2           VDH_FLG=VDH_FLG-1;
     1960    25097    2           IF VDH_FLG~=0 THEN RETURN;
     1961    25098    2           IF VDI$ = ADDR(NIL)
     1962    25099    3           THEN DO;
     1963    25100                   %KV$USREXT (VDI$="ADDR(NIL)");
             25108    3           KV$PTR$ = KV@USRENT.SVDPTR$;
     1964    25110    3              END;
     1965    25111    3           ELSE DO;
     1966    25112    3              KV$USR_EVT=KV_USR_EVT;
     1967    25113    3              KV$USR_EVT.ID=%KV_USR_EVT_ID_VDHEXT;
     1968    25114    3              CALL KZT$3270(KV$USR_EVT);
     1969    25115                   %KV$USREXT;
             25121    3           KV$PTR.VDI$->KV$VDI.BSY = '0'B;
             25123    3           KV$PTR$ = KV@USRENT.SVDPTR$;
     1970    25125    3              END;
     1971    25126    2           RETURN;
     1972    25127
     1973    25128    2   END EXIT_VDH;
     1974    25129
     1975    25130    1   END KZV$3270DV;
     1976    25131        %EOD;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:77   
--  Include file information  --

   KZ_3270M_C.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KZ_3270_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   KZ$3270STT.:E05TOU  is referenced.
   KZ$3270DEV.:E05TOU  is referenced.
   KZ$3270CTR.:E05TOU  is referenced.
   KZ$INPBFR.:E05TOU  is referenced.
   KZ$OTPBFR.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$USR.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:78   
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KZV$3270DV.

   Procedure KZV$3270DV requires 6113 words for executable code.
   Procedure KZV$3270DV requires 159 words of local(AUTO) storage.

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:79   

 Object Unit name= KZV$3270DV                                 File name= KZV$3270DV.:E05TOU
 UTS= JUL 30 '97 03:04:18.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    253     FD  KZV$3270DV
    1   Proc  even  none  6113   17E1  KZV$3270DV
    2  RoData even  none     6      6  KZV$3270DV

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KZV$3270DV
     1    BC5          yes     yes      Std        1  KZV$DFR
     1    C76          yes     yes      Std        1  KZV$DSC
     1    C94          yes     yes      Std        1  KZV$DSC_CONT
     1    CB2          yes     yes      Std        1  KZV$DSC_LINE
     1    CEA          yes     yes      Std        2  KZV$RELOTPBFR
     1    D09          yes     yes      Std        1  KZV$RLSCTX
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:80   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KZT$3270
 yes     yes           Std       2 KVB$GET2NSYS
 yes     yes           Std       2 KVB$GETSYS
 yes     yes           Std       1 KZT$CLEARIMM
         yes           Std       0 KHI$ENABLE
 yes     yes           Std       1 KVV$VDI
         yes           Std       1 KHI$DISABLE
 yes     yes           Std       2 KVB$RLSSYS
 yes     yes           Std       1 KZT$CMPOTP
 yes     yes           Std       2 KVB$RLS2NSYS
 yes     yes           Std       1 KZT$SNDSLV
 yes     yes           Std       1 KZT$CLEAR
 yes     yes           Std       1 KVV$INT
 yes     yes           Std       2 KHA$ERRLOG
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET
                       nStd      0 X6C_ALRZ

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZ_3270PRFFNCTBL                      KZT_USRPRM$                           KZ_INPFNCTBLHED$
     KZ_3270STD                            KV$PTR$                               KZT_THRTL_INIT
     KZT_THRTL_UNBLK                       KH_INHLVL                             KH_PROFILE_
     KZ_3270M_HDR                          KV_USR_EVT                            KV_VDH_CNC
     KV_VDH_DAT                            KV_VDH_DSC                            KV_VDH_EVT
     KV_VDH_INT                            KV_VDH_OTPMRK                         KV_VDH_EVT_RQSOTP
     KZ_3270_BFRSIZ                        KZ_VDHSTT$                            KH_CTLTBL$
     KZ_3270XLB                            KZT_CNCDSC@                      r    G$ROS$
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:81   


        1        1        /*M* KZV$3270DV - Device manager for 3270 devices */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8
        9        9        KZV$3270DV: PROC(PARAMETER1,PARAMETER2) ALTRET;

      9   1 000000  D380 0000 0000  xent KZV$3270DV      LNJ,B5   X6A_AUTO_2
          1 000003       009F 0002                       DC       159,2

       10       10
       11       11        /* Include Files */
       12       12
       13       13        %INCLUDE CP_6_SUBS;
       14      553        %INCLUDE LCP_6;
       15     4832        %INCLUDE K_ID_E;
       16     4882        %INCLUDE KH$CHN;
       17     5004        %INCLUDE KH$STT;
       18     5034        %INCLUDE KH_MACRO_C;
       19     5777        %INCLUDE KHC_MAC_C;
       20     5818        %INCLUDE KL_CONTROL_C;
       21     6198        %INCLUDE KL_AFCN_C;
       22     6299        %INCLUDE KL_MACRO_C;
       23     9651        %INCLUDE KL_SUPER_C;
       24    12553        %INCLUDE KV$VDH;
       25    12984        %INCLUDE KV$GLB;
       26    13403        %INCLUDE KV$USR;
       27    13715        %INCLUDE KV$GLBCTX;
       28    14160        %INCLUDE KV_GLBCNS_E;
       29    14501        %INCLUDE KV_GLB_M;
       30    14623        %INCLUDE KV_PRMID_E;
       31    14797        %INCLUDE KZ$LINCTX;
       32    15417        %INCLUDE KZ$OTPBFR;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:82   
       33    15518        %INCLUDE KZ$INPBFR;
       34    15578        %INCLUDE KZ$3270CTR;
       35    15643        %INCLUDE KZ$3270DEV;
       36    15901        %INCLUDE KZ$3270STT;
       37    15965        %INCLUDE KZ$BSCSTT;
       38    16071        %INCLUDE KZ_LIN_C;
       39    16127        %INCLUDE KZ_CLM_E;
       40    16299        %INCLUDE KZ_3270_C;
       41    16457        %INCLUDE KZ_PERR_C;
       42    16539        %INCLUDE KZ_3270M_C;
       43    17396        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:83   
       44    17397        /* Parameters */
       45    17398
       46    17399    1   DCL FAKE UBIN;
       47    17400
       48    17401    1   DCL PARAMETER1 CHAR (FAKE);
       49    17402        %KZ$EVENT (STCLASS=REDEF PARAMETER1);
       50    17484        %KZ$3270DEV (NAME=DEVCTX,STCLASS=REDEF PARAMETER1);
       51    17663        %KZ$LINCTX (NAME=LINCTX,STCLASS=REDEF PARAMETER1);
       52    18094
       53    18095    1   DCL PARAMETER2 CHAR (FAKE);
       54    18096    1   DCL LINRSP REDEF PARAMETER2 UBIN;
       55    18097    1   DCL LINSTAT REDEF PARAMETER2 BIT (16) ALIGNED;
       56    18098    1   DCL OTPBFR$ REDEF PARAMETER2 PTR;
       57    18099
       58    18100        /* EQUs */
       59    18101
       60    18102        %KV_INPOPRX_E;
       61    18114        %KZ_3270_E;
       62    18242        %K#ENTID_E;
       63    18261        %KV_USR_EVT_ID_E;
       64    18281        %KV_VDH_EVT_ID_E;
       65    18287        %KV_SCHRSN_E;
       66    18294        %KV_DSCRSN_E;
       67    18303        %KV_CMPCOD_E;
       68    18317        %KV_INPUNT_E;
       69    18322        %KV_PRMID_E;
       70    18478        %KV_STRTYP_E;
       71    18516        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:84   
       72    18517        /* Auto */
       73    18518
       74    18519    1   DCL LIN$ PTR;
       75    18520    1   DCL CTR$ PTR;
       76    18521    1   DCL DEV$ PTR;
       77    18522    1   DCL T$ PTR;
       78    18523    1   DCL P1$ PTR;
       79    18524    1   DCL CNT UBIN;
       80    18525    1   DCL I REDEF CNT UBIN;
       81    18526    1   DCL J UBIN;
       82    18527    1   DCL BFR$ PTR;
       83    18528    1   DCL BFR_SIZ UBIN;
       84    18529    1   DCL STAT# REDEF BFR_SIZ UBIN;
       85    18530    1   DCL TBFR$ PTR;
       86    18531    1   DCL STATUS BIT(16);
       87    18532    1   DCL STATUSW REDEF STATUS UBIN;
       88    18533    1   DCL 1 STATUSB REDEF STATUS,
       89    18534    1         2 I UBIN BYTE UNAL,
       90    18535    1         2 J UBIN BYTE UNAL;
       91    18536    1   DCL SZ SBIN;
       92    18537    1   DCL TCTR$ PTR;
       93    18538    1   DCL TDEV$ PTR;
       94    18539    1   DCL DFRD BIT(1);
       95    18540    1   DCL VDH_FLG UBIN;
       96    18541        %KV$USR_EVT (STCLASS="");
       97    18576        %KV$VDH_CNC (STCLASS="");
       98    18668        %KV$VDH_DAT (STCLASS="");
       99    18748        %KV$VDH_DSC (STCLASS="");
      100    18784        %KV$VDH_EVT (STCLASS="");
      101    18819        %KV$VDH_INT (STCLASS="");
      102    18856        %KV$VDH_OTPMRK (STCLASS="");
      103    18918        %KV@USRENT;
      104    18938        %KZ$EVENT (FPTN=KZ$CLMEVENT,STCLASS="");
      105    19020        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:85   
      106    19021        /* Static */
      107    19022
      108    19023    1   DCL POLADR_B(0:31) BIT(8) CONSTANT INIT(
      109    19024    1       '40'X,'C1'X,'C2'X,'C3'X,'C4'X,'C5'X,'C6'X,'C7'X,
      110    19025    1       'C8'X,'C9'X,'4A'X,'4B'X,'4C'X,'4D'X,'4E'X,'4F'X,
      111    19026    1       '50'X,'D1'X,'D2'X,'D3'X,'D4'X,'D5'X,'D6'X,'D7'X,
      112    19027    1       'D8'X,'D9'X,'5A'X,'5B'X,'5C'X,'5D'X,'5E'X,'5F'X);
      113    19028    1   DCL POLADR(0:31) REDEF POLADR_B UBIN BYTE UNAL;
      114    19029
      115    19030    1   DCL SELADR_B(0:31) BIT(8) CONSTANT INIT(
      116    19031    1       '60'X,'61'X,'E2'X,'E3'X,'E4'X,'E5'X,'E6'X,'E7'X,
      117    19032    1       'E8'X,'E9'X,'6A'X,'6B'X,'6C'X,'6D'X,'6E'X,'6F'X,
      118    19033    1       'F0'X,'F1'X,'F2'X,'F3'X,'F4'X,'F5'X,'F6'X,'F7'X,
      119    19034    1       'F8'X,'F9'X,'7A'X,'7B'X,'7C'X,'7D'X,'7E'X,'7F'X);
      120    19035    1   DCL SELADR(0:31) REDEF SELADR_B UBIN BYTE UNAL;
      121    19036        %KZ$3270CTR (NAME=KZ_3270CTR,STCLASS=CONSTANT);
      122    19076        %KZ$3270DEV (NAME=KZ_3270DEV,STCLASS=CONSTANT);
      123    19255        %KZ$INPBFR (NAME=KZ_INPBFR,STCLASS=CONSTANT);
      124    19288        %KZ$OTPBFR (NAME=KZ_OTPBFR,STCLASS=CONSTANT);
      125    19353        %KZ$EVENT (FPTN=KZ_CLMEVENT,STCLASS=CONSTANT);
      126    19435
      127    19436    1   DCL 1 PRO_ATTR CONSTANT,
      128    19437    1         2 TYP UBIN BYTE UNAL INIT(%KV_PRMID_TRMATTR),
      129    19438    1         2 LNG UBIN BYTE UNAL INIT(SIZEC(VLP_TRMATTR));
      130    19439        %VLP_TRMATTR (STCLASS=CONSTANT,CURSORUP=YES,FCNTBL='CP5');
      131    19477    1   DCL 1 PRO_CTL CONSTANT,
      132    19478    1         2 TYP UBIN BYTE UNAL INIT(%KV_PRMID_TRMCTL),
      133    19479    1         2 LNG UBIN BYTE UNAL INIT(SIZEC(VLP_TRMCTL));
      134    19480        %VLP_TRMCTL (STCLASS=CONSTANT,RETYPOVR=YES,EDITOVR=YES,UPPERCASE=YES);
      135    19520
      136    19521        %KV$USRPRM_INT;
      137    19535        %KV$SETPRMPREPRC (PRMID=KV_PRMID_MRDWDT);
      138    19548        %KV$SETPRMPREPRC (PRMID=KV_PRMID_MRDLNG);
      139    19561        %KV$SETPRMPREPRC (PRMID=KV_PRMID_3270);
      140    19574        %KV$SETPRMPREPRC (PRMID=KV_PRMID_SCROLL);
      141    19587        %KV$SETPRMPREPRC (PRMID=KV_PRMID_DEVSCROLL);
      142    19600        %KV$STREVTENB (STRTYP=KV_STRTYP_MRD);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:86   
      143    19605        %KV$STREVTENB (STRTYP=KV_STRTYP_VDI);
      144    19610        %KV$USRPRM (NAME=KZ_USRPRM,STCLASS=CONSTANT,
      145    19611          HLTMSG="'(ENTER TO GO) '",
      146    19612          USRSBR=KZT$3270,
      147    19613          TRNTBLHEDPTR$=KZ_TRNTBLHED$,
      148    19614          PRFFNCTBL=KZ_3270PRFFNCTBL,
      149    19615          INPFNCTBLHEDPTR$=KZ_INPFNCTBLHED$);
      150    19666    1   DCL KZ_TRNTBLHED$ PTR INIT(ADDR(KZ_3270STD)) CONSTANT;
      151    19667    1   DCL KZ_3270PRFFNCTBL UBIN SYMREF;
      152    19668    1   DCL KZT_USRPRM$ PTR SYMREF;
      153    19669    1   DCL KZ_INPFNCTBLHED$ PTR SYMREF;
      154    19670    1   DCL KZ_3270STD UBIN SYMREF;
      155    19671
      156    19672        %MACRO STAT(VAL='0'B,LOG(YES='1'B,NO='0'B)='0'B,CLR(YES='1'B,NO='0'B)='0'B,
      157    19673                    DWN(YES='1'B,NO='0'B)='0'B,ACT=0,LAST=",",
      158    19674                    NOINIT(YES=1,NO=0)=0);
      159    19675        %IF NOINIT=1;
      160    19676        %LSET INIT=CHARTEXT('/*');
      161    19677                2 X ALIGNED,
      162    19678        %ELSE;
      163    19679        %LSET INIT=CHARTEXT('INIT');
      164    19680                  2 *,
      165    19681        %ENDIF;
      166    19682                  3 VAL# BIT(16) %INIT(VAL)%CHARTEXT('/**/'),
      167    19683                  3 LOG# BIT(1) %INIT(LOG)%CHARTEXT('/**/'),
      168    19684                  3 CLR# BIT(1) %INIT(CLR)%CHARTEXT('/**/'),
      169    19685                  3 DWN# BIT(1) %INIT(DWN)%CHARTEXT('/**/'),
      170    19686                  3 * BIT(5) %INIT('0'B)%CHARTEXT('/**/'),
      171    19687                  3 ACT# UBIN BYTE UNAL %INIT(ACT)%CHARTEXT('/**/') LAST
      172    19688        %SET Y#STATSIZ=Y#STATSIZ+1;
      173    19689        %MEND;
      174    19690
      175    19691        %SET Y#STATSIZ=0;
      176    19692
      177    19693        %EQU KZ#STAT_DE=1;                      /* Device-end                         */
      178    19694        %EQU KZ#STAT_DSC=2;                     /* Disconnect                         */
      179    19695        %EQU KZ#STAT_RETRY=3;                   /* Retry                              */
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:87   
      180    19696        %EQU KZ#STAT_CONT=4;                    /* Continue                           */
      181    19697        %EQU KZ#STAT_PAPER=5;                   /* Out of paper                       */
      182    19698    1   DCL 1 STAT_ CONSTANT,
      183    19699        %STAT(VAL='0000'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      184    19715        %STAT(VAL='0200'X,ACT=%KZ#STAT_DE,LOG=NO);
      185    19731        %STAT(VAL='0010'X,ACT=%KZ#STAT_DSC,DWN=YES,LOG=NO);
      186    19747        %STAT(VAL='0210'X,ACT=%KZ#STAT_PAPER,LOG=NO);
      187    19763        %STAT(VAL='0002'X,ACT=%KZ#STAT_CONT,LOG=YES);
      188    19779        %STAT(VAL='0004'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      189    19795        %STAT(VAL='0008'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      190    19811        %STAT(VAL='000C'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      191    19827        %STAT(VAL='040C'X,ACT=%KZ#STAT_CONT,LOG=YES);
      192    19843        %STAT(VAL='0618'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      193    19859        %STAT(VAL='0418'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      194    19875        %STAT(VAL='0604'X,ACT=%KZ#STAT_CONT,LOG=YES);
      195    19891        %STAT(VAL='0404'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      196    19907        %STAT(VAL='0204'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      197    19923        %STAT(VAL='0001'X,ACT=%KZ#STAT_RETRY,LOG=YES);
      198    19939        %STAT(VAL='0020'X,ACT=%KZ#STAT_CONT,LOG=YES);
      199    19955        %STAT(VAL='0100'X,ACT=%KZ#STAT_CONT,LOG=YES);
      200    19971        %STAT(VAL='0C00'X,ACT=%KZ#STAT_CONT,LOG=YES);
      201    19987        %STAT(VAL='0E00'X,ACT=%KZ#STAT_CONT,LOG=YES);
      202    20003        %STAT(VAL='0208'X,ACT=%KZ#STAT_CONT,LOG=YES);
      203    20019        %STAT(VAL='0218'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES,LAST=";");
      204    20035    1   DCL 1 STAT(0:%(Y#STATSIZ-1)) REDEF STAT_,
      205    20036        %STAT(LAST=";",NOINIT=YES);
      206    20052        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:88   
      207    20053        /* Based Structures */
      208    20054
      209    20055        %KZ$LINCTX (STCLASS="BASED(LIN$)");
      210    20486        %KZ$3270CTR (STCLASS="BASED(CTR$)");
      211    20526        %KZ$3270DEV (STCLASS="BASED(DEV$)");
      212    20705        %KZ$INPBFR (STCLASS="BASED(BFR$)");
      213    20738        %KZ$OTPBFR (STCLASS="BASED(BFR$)");
      214    20803        %KV$MRD;
      215    20850        %KV$VDI;
      216    20921        %KV$PTR;
      217    20964        %KH$CHN;
      218    21088        %KV$OTPMRK (STCLASS=BASED);
      219    21115        %KH$CTLTBL (STCLASS="BASED(KH_CTLTBL$)");
      220    21327    1   DCL VDHTRCWORD UBIN WORD BASED;
      221    21328    1   DCL P$(0:31) PTR BASED ALIGNED;
      222    21329    1   DCL UBYT(0:31) UBIN BYTE CALIGNED BASED;
      223    21330    1   DCL BITS(0:1023) BIT(8) BASED CALIGNED;
      224    21331    1   DCL BIT16(0:1023) BIT(16) BASED ALIGNED;
      225    21332        %KL_CONTROLLER;
      226    21481        %KL_LINEDEV;
      227    21630        %B$TERMINAL_ID (STCLASS=BASED);
      228    21659        %KV$SSN;
      229    21738        %KV$STT (STCLASS="BASED(KZ_VDHSTT$)");
      230    22132        %KV$USRPRM;
      231    22183        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:89   
      232    22184        /* External Data */
      233    22185
      234    22186    1   DCL KZT_THRTL_INIT UBIN SYMREF;
      235    22187        %INHIBIT_DCLS;
      236    22199    1   DCL KZT_THRTL_UNBLK UBIN SYMREF;
      237    22200    1   DCL KH_INHLVL UBIN SYMREF;
      238    22201    1   DCL KH_PROFILE_ VECTOR SYMREF;
      239    22202    1   DCL CP_PHLEGM CPTR;
      240    22203    1   DCL P_PHLEGM REDEF CP_PHLEGM PTR;
      241    22204        %KZ_3270M_HDR (STCLASS=SYMREF);
      242    22228        %KZ$3270STT (STCLASS="BASED(KZ_3270M_HDR.STTBFR$)");
      243    22660        %KV$USR_EVT (NAME=KV_USR_EVT,STCLASS=SYMREF);
      244    22695        %KV$VDH_CNC (NAME=KV_VDH_CNC,STCLASS=SYMREF);
      245    22787        %KV$VDH_DAT (NAME=KV_VDH_DAT,STCLASS=SYMREF);
      246    22867        %KV$VDH_DSC (NAME=KV_VDH_DSC,STCLASS=SYMREF);
      247    22903        %KV$VDH_EVT (NAME=KV_VDH_EVT,STCLASS=SYMREF);
      248    22938        %KV$VDH_INT (NAME=KV_VDH_INT,STCLASS=SYMREF);
      249    22975        %KV$VDH_OTPMRK (NAME=KV_VDH_OTPMRK,STCLASS=SYMREF);
      250    23037        %KV$VDH_EVT (NAME=KV_VDH_EVT_RQSOTP,STCLASS=SYMREF);
      251    23072    1   DCL KZ_3270_BFRSIZ(0:7) UBIN SYMREF;
      252    23073    1   DCL KZ_VDHSTT$ PTR SYMREF;
      253    23074    1   DCL KH_CTLTBL$ PTR SYMREF;
      254    23075    1   DCL KZ_3270XLB(0:63) BIT(8) SYMREF;
      255    23076    1   DCL KZ_3270XL(0:63) REDEF KZ_3270XLB UBIN BYTE CALIGNED;
      256    23077        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:90   
      257    23078        /* External Routines */
      258    23079
      259    23080    1   DCL KZT$3270 ENTRY(1) ALTRET;
      260    23081    1   DCL KZT$CLEAR ENTRY(1) ALTRET;
      261    23082    1   DCL KZT$CLEARIMM ENTRY(1) ALTRET;
      262    23083    1   DCL KZT$SNDSLV ENTRY(1) ALTRET;
      263    23084    1   DCL KZT$CMPOTP ENTRY(1) ALTRET;
      264    23085    1   DCL KVV$INT ENTRY(1) ALTRET;
      265    23086    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      266    23087    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      267    23088    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
      268    23089    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
      269    23090    1   DCL KVV$VDI ENTRY(1) ALTRET;
      270    23091    1   DCL KZT_CNCDSC@ EPTR SYMREF;
      271    23092    1   DCL KHA$ERRLOG ENTRY(2) ALTRET;
      272    23093        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:91   
      273    23094    1           DEV$=ADDR(NIL);

  23094   1 000005  EB80 0000 0000                       LAB,B6   0
          1 000008  EFC7 000D                            STB,B6   DEV$,AUTO

      274    23095    1           CTR$=ADDR(NIL);

  23095   1 00000A  DB80 0000 0000                       LAB,B5   0
          1 00000D  DFC7 000B                            STB,B5   CTR$,AUTO

      275    23096    1           LIN$=KZ$EVENT.LINCTX$;

  23096   1 00000F  CCC7 0004                            LDB,B4   @PARAMETER1,AUTO
          1 000011  BCC4 0003                            LDB,B3   3,B4
          1 000013  BFC7 0009                            STB,B3   LIN$,AUTO

      276    23097    1           VDH_FLG=0;

  23097   1 000015  8747 0021                            CL       VDH_FLG,AUTO

      277    23098    2           DO CASE(KZ$EVENT.EVENT);

  23098   1 000017  B804                                 LDR,R3   ,B4
          1 000018  3D18                                 CMV,R3   24
          1 000019  0281 0B8C                            BGE      s:23942,PREL
          1 00001B  A830 0000 0021  01                   LDR,R2   s:23098+10,R3
          1 00001E  83A0 0000 0039  01                   JMP      s:23104,R2
          1 000021       0B6D                            DC       s:23942,PREL
          1 000022       0000                            DC       s:23104,PREL
          1 000023       014E                            DC       s:23194,PREL
          1 000024       0158                            DC       s:23202,PREL
          1 000025       03F5                            DC       s:23412,PREL
          1 000026       064D                            DC       s:23572,PREL
          1 000027       0B6D                            DC       s:23942,PREL
          1 000028       079B                            DC       s:23686,PREL
          1 000029       07B7                            DC       s:23698,PREL
          1 00002A       09FD                            DC       s:23815,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:92   
          1 00002B       018C                            DC       s:23223,PREL
          1 00002C       038E                            DC       s:23369,PREL
          1 00002D       03A4                            DC       s:23379,PREL
          1 00002E       03A6                            DC       s:23383,PREL
          1 00002F       0B6D                            DC       s:23942,PREL
          1 000030       0194                            DC       s:23230,PREL
          1 000031       0B6D                            DC       s:23942,PREL
          1 000032       0A3B                            DC       s:23837,PREL
          1 000033       0B6D                            DC       s:23942,PREL
          1 000034       063C                            DC       s:23563,PREL
          1 000035       0991                            DC       s:23789,PREL
          1 000036       0B71                            DC       s:23943,PREL
          1 000037       06BB                            DC       s:23618,PREL
          1 000038       06BB                            DC       s:23618,PREL

      278    23099
      279    23100        /* Get output */
      280    23101
      281    23102    2            CASE(%KZ#LINFCN_GETOTP);

      282    23103
      283    23104    2              IF KZ$LINCTX.OTPHD$~=ADDR(NIL) THEN

  23104   1 000039  8DC3 0052                            CMN      82,B3
          1 00003B  0901 0005                            BE       s:23107,PREL

      284    23105    2                 CALL M$XXX;

  23105   1 00003D  B870 0082                            LDR,R3   130,IMO
          1 00003F  0001                                 MCL
          1 000040       0000                            DC       s:23105+3,PREL

      285    23106
      286    23107    2              IF KZ$LINCTX.OTPCNT=0 THEN

  23107   1 000041  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000043  E846 004D                            LDR,R6   77,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:93   
          1 000045  6981 0004                            BNEZ,R6  s:23110,PREL

      287    23108    2                 ALTRETURN;                /* Nothing to do                      */

  23108   1 000047  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      288    23109
      289    23110    2              CNT=KZ$LINCTX.OTPCNT;        /* Save current count                 */

  23110   1 00004A  EF47 0013                            STR,R6   CNT,AUTO

      290    23111    3   CTRLOOP:   IF KZ$LINCTX.OTPCTR$=ADDR(NIL) THEN DO;

  23111   1 00004C  ECC7 0009            CTRLOOP         LDB,B6   LIN$,AUTO
          1 00004E  8DC6 005E                            CMN      94,B6
          1 000050  0981 000B                            BNE      s:23116,PREL

      291    23112    3                 KZ$LINCTX.OTPCTR$=KZ$LINCTX.CTRHD$; /* Start at beginning       */

  23112   1 000052  DC86                                 LDB,B5   ,B6
          1 000053  DFC6 005E                            STB,B5   94,B6

      292    23113    3                 KZ$LINCTX.OTPDEV$=ADDR(NIL);

  23113   1 000055  CB80 0000 0000                       LAB,B4   0
          1 000058  CFC6 0062                            STB,B4   98,B6

      293    23114    3                 END;

  23114   1 00005A  0F81 0003                            B        s:23118,PREL

      294    23115    2              ELSE
      295    23116    2                 CNT=0;               /* Force one full pass that finds nothing  */

  23116   1 00005C  8747 0013                            CL       CNT,AUTO

      296    23117
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:94   
      297    23118    2              CTR$=KZ$LINCTX.OTPCTR$;      /* Current controller                 */

  23118   1 00005E  DCC6 005E                            LDB,B5   94,B6
          1 000060  DFC7 000B                            STB,B5   CTR$,AUTO

      298    23119    3              DO WHILE(CTR$~=ADDR(NIL));

  23119   1 000062  0F81 0101                            B        s:23180,PREL

      299    23120    3                 IF KZ$LINCTX.OTPDEV$=ADDR(NIL) THEN

  23120   1 000064  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000066  8DC6 0062                            CMN      98,B6
          1 000068  0981 0009                            BNE      s:23123,PREL

      300    23121    3                    KZ$LINCTX.OTPDEV$=KZ$3270CTR.DEVHD$;

  23121   1 00006A  DCC7 000B                            LDB,B5   CTR$,AUTO
          1 00006C  CCC5 0002                            LDB,B4   2,B5
          1 00006E  CFC6 0062                            STB,B4   98,B6
          1 000070  0F81 0006                            B        s:23124,PREL

      301    23122    3                 ELSE
      302    23123    3                    KZ$LINCTX.OTPDEV$=KZ$LINCTX.OTPDEV$->KZ$3270DEV.LNK$;

  23123   1 000072  DCC6 0062                            LDB,B5   98,B6
          1 000074  CC85                                 LDB,B4   ,B5
          1 000075  CFC6 0062                            STB,B4   98,B6

      303    23124    3                 DEV$=KZ$LINCTX.OTPDEV$;

  23124   1 000077  CFC7 000D                            STB,B4   DEV$,AUTO

      304    23125    4                 DO WHILE(DEV$~=ADDR(NIL));

  23125   1 000079  0F81 00A2                            B        s:23162,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:95   
      305    23126    5                    IF KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP THEN DO; /* Get output   */

  23126   1 00007B  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 00007D  E806                                 LDR,R6   ,B6
          1 00007E  6D01                                 CMV,R6   1
          1 00007F  0981 007B                            BNE      s:23154,PREL

      306    23127    5                       IF KZ$3270DEV.OTPHD$~=ADDR(NIL)

  23127   1 000081  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 000083  8DC5 0008                            CMN      8,B5
          1 000085  0901 0093                            BE       s:23161,PREL
          1 000087  82C5 0012                            LB,'00FF'X        18,B5
          1 000089       00FF
          1 00008A  0501 008E                            BBT      s:23161,PREL

      307    23128    6                         AND NOT KZ$3270DEV.HLT THEN DO; /* Output exists        */

      308    23129    6                          J=0;             /* Number bytes gotten to send        */

  23129   1 00008C  8747 0014                            CL       J,AUTO

      309    23130    6                          KZ$3270DEV.OTPBSY='1'B;

  23130   1 00008E  8945 0012                            LBT,'0400'X       18,B5
  23130   1 000090       0400

      310    23131    6   OTPLOOP:               IF KZ$LINCTX.OTPTL$~=ADDR(NIL) THEN

  23131   1 000091  ECC7 0009            OTPLOOP         LDB,B6   LIN$,AUTO
          1 000093  8DC6 0054                            CMN      84,B6
          1 000095  0901 000A                            BE       s:23134,PREL

      311    23132    6                             KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;

  23132   1 000097  DCC6 0054                            LDB,B5   84,B6
          1 000099  CCC7 000D                            LDB,B4   DEV$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:96   
          1 00009B  BCC4 0008                            LDB,B3   8,B4
          1 00009D  BF85                                 STB,B3   ,B5
          1 00009E  0F81 0007                            B        s:23135,PREL

      312    23133    6                          ELSE
      313    23134    6                             KZ$LINCTX.OTPHD$=KZ$3270DEV.OTPHD$;

  23134   1 0000A0  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 0000A2  CCC5 0008                            LDB,B4   8,B5
          1 0000A4  CFC6 0052                            STB,B4   82,B6

      314    23135    6                          KZ$LINCTX.OTPTL$=KZ$3270DEV.OTPHD$;

  23135   1 0000A6  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 0000A8  CCC5 0008                            LDB,B4   8,B5
          1 0000AA  CFC6 0054                            STB,B4   84,B6

      315    23136    6                          KZ$3270DEV.OTPHD$=KZ$3270DEV.OTPHD$->KZ$OTPBFR.LNK$;

  23136   1 0000AC  BCC5 0008                            LDB,B3   8,B5
          1 0000AE  AC83                                 LDB,B2   ,B3
          1 0000AF  AFC5 0008                            STB,B2   8,B5

      316    23137    6                          KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$ = ADDR(NIL);

  23137   1 0000B1  CCC6 0054                            LDB,B4   84,B6
          1 0000B3  BB80 0000 0000                       LAB,B3   0
          1 0000B6  BF84                                 STB,B3   ,B4

      317    23138    6                          IF KZ$3270DEV.OTPHD$=ADDR(NIL) THEN

  23138   1 0000B7  8DC5 0008                            CMN      8,B5
          1 0000B9  0981 0006                            BNE      s:23140,PREL

      318    23139    6                             KZ$3270DEV.OTPTL$=ADDR(NIL);

  23139   1 0000BB  CB80 0000 0000                       LAB,B4   0
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:97   
          1 0000BE  CFC5 000A                            STB,B4   10,B5

      319    23140    6                          J=J+KZ$LINCTX.OTPTL$->KZ$OTPBFR.DATA_SIZ;

  23140   1 0000C0  CCC6 0054                            LDB,B4   84,B6
          1 0000C2  E847 0014                            LDR,R6   J,AUTO
          1 0000C4  EA44 0003                            ADD,R6   3,B4
          1 0000C6  EF47 0014                            STR,R6   J,AUTO

      320    23141    6                          IF J<100 AND KZ$3270DEV.OTPHD$~=ADDR(NIL) AND

  23141   1 0000C8  6D64                                 CMV,R6   100
          1 0000C9  0281 000F                            BGE      s:23144,PREL
          1 0000CB  8DC5 0008                            CMN      8,B5
          1 0000CD  0901 000B                            BE       s:23144,PREL
          1 0000CF  82C5 0012                            LB,'0800'X        18,B5
          1 0000D1       0800
          1 0000D2  0501 0006                            BBT      s:23144,PREL
          1 0000D4  82C4 0002                            LB,'000C'X        2,B4
          1 0000D6       000C
          1 0000D7  0581 FFB9                            BBF      s:23131,PREL

      321    23142    6                           NOT KZ$3270DEV.PRINTER AND NOT KZ$LINCTX.OTPTL$->KZ$OTPBFR.
             23142                                     FLAGS.HALT THEN
      322    23143    6                             GOTO OTPLOOP; /* Send more until > 100 bytes        */
      323    23144    6                          KZ$LINCTX.POLADR.CTR=SELADR(KZ$3270CTR.ADR);

  23144   1 0000D9  BCC7 000B                            LDB,B3   CTR$,AUTO
          1 0000DB  B2C3 000A                            LLH,R3   10,B3
          1 0000DD  D2B0 0000 0010  00                   LLH,R5   SELADR_B,R3
          1 0000E0  D7C6 0064                            STH,R5   100,B6

      324    23145    6                          KZ$LINCTX.POLADR.DEV=POLADR(KZ$3270DEV.ADR);

  23145   1 0000E2  B2C5 0015                            LLH,R3   21,B5
          1 0000E4  D2B0 0000 0000  00                   LLH,R5   POLADR_B,R3
          1 0000E7  DAC6 0064                            SRM,R5,'00FF'X    100,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:98   
          1 0000E9       00FF

      325    23146    6   GOTOTP:                KZ$LINCTX.OTPDEV$=DEV$;

  23146   1 0000EA  ECC7 000D            GOTOTP          LDB,B6   DEV$,AUTO
          1 0000EC  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0000EE  EFC5 0062                            STB,B6   98,B5

      326    23147    6                          KZ$LINCTX.OTPCTR$=CTR$;

  23147   1 0000F0  CCC7 000B                            LDB,B4   CTR$,AUTO
          1 0000F2  CFC5 005E                            STB,B4   94,B5

      327    23148    6                          KZ$LINCTX.CURCTR$=CTR$; /* Set current device          */

  23148   1 0000F4  CFC5 004E                            STB,B4   78,B5

      328    23149    6                          KZ$LINCTX.CURDEV$=DEV$;

  23149   1 0000F6  EFC5 0050                            STB,B6   80,B5

      329    23150    6                          RETURN;

  23150   1 0000F8  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      330    23151    6                          END;
      331    23152    5                       END;
      332    23153    5                    ELSE DO;               /* Specific Poll                      */

      333    23154    6                      IF KZ$3270DEV.ACTIVE OR KZ$EVENT.EVENT=%KZ#LINFCN_NEWCTR THEN DO
             23154                                ;

  23154   1 0000FB  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 0000FD  82C5 0012                            LB,'4000'X        18,B5
          1 0000FF       4000
          1 000100  0501 0004                            BBT      s:23155,PREL
          1 000102  6D07                                 CMV,R6   7
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:99   
          1 000103  0981 0015                            BNE      s:23161,PREL

      334    23155    6                          KZ$LINCTX.POLADR.CTR=POLADR(KZ$3270CTR.ADR);

  23155   1 000105  CCC7 000B                            LDB,B4   CTR$,AUTO
          1 000107  B2C4 000A                            LLH,R3   10,B4
          1 000109  D2B0 0000 0000  00                   LLH,R5   POLADR_B,R3
          1 00010C  BCC7 0009                            LDB,B3   LIN$,AUTO
          1 00010E  D7C3 0064                            STH,R5   100,B3

      335    23156    6                          KZ$LINCTX.POLADR.DEV=POLADR(KZ$3270DEV.ADR);

  23156   1 000110  B2C5 0015                            LLH,R3   21,B5
          1 000112  E2B0 0000 0000  00                   LLH,R6   POLADR_B,R3
          1 000115  EAC3 0064                            SRM,R6,'00FF'X    100,B3
          1 000117       00FF

      336    23157    6                          GOTO GOTOTP;

  23157   1 000118  0FD2                                 B        s:23146,SPREL

      337    23158    6                          END;
      338    23159    5                       END;
      339    23160
      340    23161    4                    DEV$=KZ$3270DEV.LNK$;

  23161   1 000119  CC85                                 LDB,B4   ,B5
          1 00011A  CFC7 000D                            STB,B4   DEV$,AUTO

      341    23162    4                    END;

  23162   1 00011C  8DC7 000D                            CMN      DEV$,AUTO
          1 00011E  0981 FF5C                            BNE      s:23126,PREL

      342    23163    3                 KZ$LINCTX.OTPDEV$=ADDR(NIL);

  23163   1 000120  EB80 0000 0000                       LAB,B6   0
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:100  
          1 000123  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000125  EFC5 0062                            STB,B6   98,B5

      343    23164    4                 IF KZ$EVENT.EVENT=%KZ#LINFCN_NEWCTR THEN DO;

  23164   1 000127  BCC7 0004                            LDB,B3   @PARAMETER1,AUTO
          1 000129  E803                                 LDR,R6   ,B3
          1 00012A  6D07                                 CMV,R6   7
          1 00012B  0981 0033                            BNE      s:23179,PREL

      344    23165    4                    IF KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)=0 THEN

  23165   1 00012D  ACC5 0066                            LDB,B2   102,B5
          1 00012F  B845 006C                            LDR,R3   108,B5
          1 000131  B570 00FF                            AND,R3   255,IMO
          1 000133  D2B2                                 LLH,R5   ,B2,R3
          1 000134  5981 000E                            BNEZ,R5  s:23171,PREL

      345    23166    5                    DO;

      346    23167    5                       KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)=

  23167   1 000136  9CC5 004E                            LDB,B1   78,B5
          1 000138  A2C1 000A                            LLH,R2   10,B1
          1 00013A  C2A0 0000 0000  00                   LLH,R4   POLADR_B,R2
          1 00013D  C7B2                                 STH,R4   ,B2,R3

      347    23168    5                         POLADR(KZ$LINCTX.CURCTR$->KZ$3270CTR.ADR);
      348    23169    5                       KZ$LINCTX.ACTCTR=KZ$LINCTX.ACTCTR+1;

  23169   1 00013E  E2C5 006D                            LLH,R6   109,B5
          1 000140  6E01                                 ADV,R6   1
          1 000141  E7C5 006D                            STH,R6   109,B5

      349    23170    5                       END;

      350    23171    4                    DEV$=KZ$3270CTR.DEVHD$; /* Start all active devs             */
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:101  

  23171   1 000143  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 000145  ACC6 0002                            LDB,B2   2,B6
          1 000147  AFC7 000D                            STB,B2   DEV$,AUTO

      351    23172    5                    DO WHILE(DEV$~=ADDR(NIL));

  23172   1 000149  0F81 0010                            B        s:23176,PREL

      352    23173    5                       IF KZ$3270DEV.ACTIVE THEN

  23173   1 00014B  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00014D  82C6 0012                            LB,'4000'X        18,B6
          1 00014F       4000
          1 000150  0581 0004                            BBF      s:23175,PREL

      353    23174    5                          CALL CNC_DEV;

  23174   1 000152  E3C0 12F8                            LNJ,B6   s:0,PREL
          1 000154       0001                            DC       s:23175,PREL

      354    23175    5                       DEV$=KZ$3270DEV.LNK$;

  23175   1 000155  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000157  DC86                                 LDB,B5   ,B6
          1 000158  DFC7 000D                            STB,B5   DEV$,AUTO

      355    23176    5                       END;

  23176   1 00015A  8DC7 000D                            CMN      DEV$,AUTO
          1 00015C  09EF                                 BNE      s:23173,SPREL

      356    23177    4                    GOTO END_GETOTP;

  23177   1 00015D  0F81 001A                            B        s:23186,PREL

      357    23178    4                    END;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:102  
      358    23179    3                 CTR$=KZ$3270CTR.LNK$;

  23179   1 00015F  ACC7 000B                            LDB,B2   CTR$,AUTO
          1 000161  9C82                                 LDB,B1   ,B2
          1 000162  9FC7 000B                            STB,B1   CTR$,AUTO

      359    23180    3                 END;

  23180   1 000164  8DC7 000B                            CMN      CTR$,AUTO
          1 000166  0981 FEFD                            BNE      s:23120,PREL

      360    23181
      361    23182    2              IF KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP AND CNT=KZ$LINCTX.OTPCNT THEN

  23182   1 000168  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 00016A  E806                                 LDR,R6   ,B6
          1 00016B  6D01                                 CMV,R6   1
          1 00016C  0981 000B                            BNE      s:23186,PREL
          1 00016E  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000170  D847 0013                            LDR,R5   CNT,AUTO
          1 000172  D945 004D                            CMR,R5   77,B5
          1 000174  0981 0003                            BNE      s:23186,PREL

      362    23183    2                 KZ$LINCTX.OTPCNT=0;       /* Made one pass thru finding nothing */

  23183   1 000176  8745 004D                            CL       77,B5

      363    23184
      364    23185    2   END_GETOTP:
      365    23186    2              KZ$LINCTX.OTPCTR$=ADDR(NIL);

  23186   1 000178  EB80 0000 0000       END_GETOTP      LAB,B6   0
          1 00017B  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 00017D  EFC5 005E                            STB,B6   94,B5

      366    23187    2              KZ$LINCTX.OTPDEV$=ADDR(NIL);

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:103  
  23187   1 00017F  CB80 0000 0000                       LAB,B4   0
          1 000182  CFC5 0062                            STB,B4   98,B5

      367    23188    2              ALTRETURN;

  23188   1 000184  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      368    23189        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:104  
      369    23190        /* Requeue Output */
      370    23191
      371    23192    2            CASE(%KZ#LINFCN_REQOTP);

      372    23193
      373    23194    2              DEV$=ADDR(NIL);

  23194   1 000187  AB80 0000 0000                       LAB,B2   0
          1 00018A  AFC7 000D                            STB,B2   DEV$,AUTO

      374    23195    2              CALL REQUEUE;

  23195   1 00018C  E3C0 0E33                            LNJ,B6   s:0,PREL
          1 00018E       0001                            DC       s:23195+3,PREL
          1 00018F  0F81 0A1A                            B        s:23943,PREL

      375    23196
      376    23197        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:105  
      377    23198        /* Release Output */
      378    23199
      379    23200    2            CASE(%KZ#LINFCN_RELOTP);

      380    23201
      381    23202    2              BFR$=KZ$LINCTX.OTPHD$;

  23202   1 000191  ACC3 0052                            LDB,B2   82,B3
          1 000193  AFC7 0015                            STB,B2   BFR$,AUTO

      382    23203    2              IF BFR$ = ADDR(NIL) THEN GOTO NOOOO;

  23203   1 000195  8DC7 0015                            CMN      BFR$,AUTO
          1 000197  0901 002B                            BE       s:23209,PREL

      383    23204    2              KZ$LINCTX.OTPHD$=KZ$OTPBFR.LNK$;

  23204   1 000199  9C82                                 LDB,B1   ,B2
          1 00019A  9FC3 0052                            STB,B1   82,B3

      384    23205    2              IF KZ$LINCTX.OTPHD$=ADDR(NIL) THEN

  23205   1 00019C  8DC3 0052                            CMN      82,B3
          1 00019E  0981 0006                            BNE      s:23207,PREL

      385    23206    2                 KZ$LINCTX.OTPTL$=ADDR(NIL);

  23206   1 0001A0  EB80 0000 0000                       LAB,B6   0
          1 0001A3  EFC3 0054                            STB,B6   84,B3

      386    23207    2              DEV$=KZ$OTPBFR.DEV$;

  23207   1 0001A5  ECC2 0006                            LDB,B6   6,B2
          1 0001A7  EFC7 000D                            STB,B6   DEV$,AUTO

      387    23208
      388    23209    2              IF NOT KZ$3270DEV.DSC THEN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:106  

  23209   1 0001A9  82C6 0015                            LB,'00FF'X        21,B6
  23209   1 0001AB       00FF
          1 0001AC  0501 0013                            BBT      s:23216,PREL

      389    23210    2                 IF KZ$OTPBFR.FLAGS.HALT.PAG# THEN

  23210   1 0001AE  82C2 0002                            LB,'0008'X        2,B2
  23210   1 0001B0       0008
          1 0001B1  0581 0006                            BBF      s:23213,PREL

      390    23211    2                    KZ$3270DEV.HLT.PAG='1'B;

  23211   1 0001B3  8946 0012                            LBT,'0020'X       18,B6
  23211   1 0001B5       0020
          1 0001B6  0F81 0009                            B        s:23216,PREL

      391    23212    2                 ELSE
      392    23213    2                    IF KZ$OTPBFR.FLAGS.HALT.INP# THEN

  23213   1 0001B8  82C2 0002                            LB,'0004'X        2,B2
  23213   1 0001BA       0004
          1 0001BB  0581 0004                            BBF      s:23216,PREL

      393    23214    2                       KZ$3270DEV.HLT.INP='1'B;

  23214   1 0001BD  8946 0012                            LBT,'0008'X       18,B6
  23214   1 0001BF       0008

      394    23215
      395    23216    2              CALL RELOTPBFR;

  23216   1 0001C0  E3C0 0CAA                            LNJ,B6   s:0,PREL
          1 0001C2       0001                            DC       s:23209,PREL

  23209   1 0001C3  0F81 09E6            NOOOO           B        s:23943,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:107  
      396    23217    2   NOOOO:     ;
      397    23218        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:108  
      398    23219        /* Device said to wait */
      399    23220
      400    23221    2            CASE(%KZ#LINFCN_WAIT);

      401    23222
      402    23223    2              KZ$LINCTX.CURDEV$->KZ$3270DEV.HLT.WACK='1'B;

  23223   1 0001C5  ACC3 0050                            LDB,B2   80,B3
          1 0001C7  8942 0012                            LBT,'0080'X       18,B2
          1 0001C9       0080

      403    23224    2              RETURN;

  23224   1 0001CA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      404    23225        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:109  
      405    23226        /* Status received */
      406    23227
      407    23228    2            CASE(%KZ#LINFCN_STATUS);

      408    23229
      409    23230    2              CALL FND_CTX ALTRET(END_STATUS);
             23230                       /* Find existing context, or build new */

  23230   1 0001CD  E3C0 0BA8                            LNJ,B6   s:0,PREL
          1 0001CF       01F6                            DC       s:23361,PREL

      410    23231    2              STATUS=KZ$LINCTX.INPBFR$->BIT16(1)&'3F3F'X; /* Remove garb         */

  23231   1 0001D0  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 0001D2  DCC6 0056                            LDB,B5   86,B6
          1 0001D4  E845 0001                            LDR,R6   1,B5
          1 0001D6  E570 3F3F                            AND,R6   16191,IMO
          1 0001D8  EF47 001A                            STR,R6   STATUS,AUTO

      411    23232    3              DO STAT#=1 TO %Y#STATSIZ-1;

  23232   1 0001DA  5C01                                 LDV,R5   1
          1 0001DB  DF47 0017                            STR,R5   BFR_SIZ,AUTO
          1 0001DD  0F81 000D                            B        s:23235+2,PREL

      412    23233    3                 IF STATUSW=BITBIN(STAT.X.VAL#(STAT#)) THEN

  23233   1 0001DF  B847 0017                            LDR,R3   BFR_SIZ,AUTO
          1 0001E1  3001                                 SOL,R3   1
          1 0001E2  E847 001A                            LDR,R6   STATUS,AUTO
          1 0001E4  E930 0000 00BE  00                   CMR,R6   STAT_,R3
          1 0001E7  0901 0009                            BE       s:23240,PREL

      413    23234    3                    GOTO GOT_STATUS;
      414    23235    3                 END;

  23235   1 0001E9  8AC7 0017                            INC      BFR_SIZ,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:110  
          1 0001EB  E847 0017                            LDR,R6   BFR_SIZ,AUTO
          1 0001ED  6D15                                 CMV,R6   21
          1 0001EE  03F1                                 BLE      s:23233,SPREL

      415    23236    2              STAT#=0;                     /* Zero entry for unknown status      */

  23236   1 0001EF  8747 0017                            CL       BFR_SIZ,AUTO

      416    23237
      417    23238    2   GOT_STATUS:
      418    23239
      419    23240    2              KZ$3270DEV.STATUS=STATUS;    /* Save last status                   */

  23240   1 0001F1  ECC7 000D            GOT_STATUS      LDB,B6   DEV$,AUTO
          1 0001F3  E847 001A                            LDR,R6   STATUS,AUTO
          1 0001F5  EF46 0013                            STR,R6   19,B6

      420    23241    2              IF STATUS='0800'X THEN

  23241   1 0001F7  E970 0800                            CMR,R6   2048,IMO
          1 0001F9  0901 01CB                            BE       s:23361,PREL

      421    23242    2                 GOTO END_STATUS;          /* Ignore busy when specific polling  */
      422    23243    2              IF KZ$3270DEV.PRINTER AND STATUS='0200'X

  23243   1 0001FB  82C6 0012                            LB,'0800'X        18,B6
  23243   1 0001FD       0800
          1 0001FE  0581 0005                            BBF      s:23243+9,PREL
          1 000200  E970 0200                            CMR,R6   512,IMO
          1 000202  0901 001A                            BE       s:23250,PREL
          1 000204  B847 0017                            LDR,R3   BFR_SIZ,AUTO
          1 000206  3002                                 SOL,R3   2
          1 000207  3E01                                 ADV,R3   1
          1 000208  D2B0 0000 00BF  00                   LLH,R5   STAT_+1,R3
          1 00020B  5D03                                 CMV,R5   3
          1 00020C  0901 0010                            BE       s:23250,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:111  
      423    23244    2                OR STAT.X.ACT#(STAT#)=%KZ#STAT_RETRY
      424    23245    2              THEN ;
      425    23246    2              ELSE
      426    23247    2                 IF(STAT.X.LOG#(STAT#))

  23247   1 00020E  A847 0017                            LDR,R2   BFR_SIZ,AUTO
          1 000210  2001                                 SOL,R2   1
          1 000211  89A0 0000 00BF  00                   CMZ      STAT_+1,R2
          1 000214  0881 0008                            BAGE     s:23250,PREL

      427    23248    2                 THEN
      428    23249    2                    CALL ERRLOG(%E$BADSTATUS);

  23249   1 000216  DBF0 00C8                            LAB,B5   200,IMO
          1 000218  DFC7 007A                            STB,B5   I+4,AUTO
          1 00021A  E3C0 140C                            LNJ,B6   s:0,PREL
          1 00021C       0001                            DC       s:23250,PREL

      429    23250    2              IF KZ$3270DEV.PRINTER AND STATUS='0010'X THEN

  23250   1 00021D  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00021F  82C6 0012                            LB,'0800'X        18,B6
          1 000221       0800
          1 000222  0581 0016                            BBF      s:23260,PREL
          1 000224  E847 001A                            LDR,R6   STATUS,AUTO
          1 000226  E970 0010                            CMR,R6   16,IMO
          1 000228  0981 0010                            BNE      s:23260,PREL

      430    23251    3              DO;

      431    23252    3                 KZ$3270DEV.PRINTER_DOWNS=KZ$3270DEV.PRINTER_DOWNS+1;

  23252   1 00022A  8AC6 001B                            INC      27,B6

      432    23253    3                 IF KZ$3270DEV.PRINTER_DOWNS < 10 THEN

  23253   1 00022C  D846 001B                            LDR,R5   27,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:112  
          1 00022E  5D0A                                 CMV,R5   10
          1 00022F  0281 0009                            BGE      s:23260,PREL

      433    23254    4                 DO;

      434    23255    4                    KZ$3270DEV.HLT.WACK='1'B;

  23255   1 000231  8946 0012                            LBT,'0080'X       18,B6
  23255   1 000233       0080

      435    23256    4                    CALL REQUEUE;

  23256   1 000234  E3C0 0D8B                            LNJ,B6   s:0,PREL
          1 000236       0001                            DC       s:23257,PREL

      436    23257    4                    GOTO END_STATUS;

  23257   1 000237  0F81 018D                            B        s:23361,PREL

      437    23258    4                    END;
      438    23259    3                 END;
      439    23260    3              DO CASE(STAT.X.ACT#(STAT#));

  23260   1 000239  B847 0017                            LDR,R3   BFR_SIZ,AUTO
          1 00023B  3002                                 SOL,R3   2
          1 00023C  3E01                                 ADV,R3   1
          1 00023D  A2B0 0000 00BF  00                   LLH,R2   STAT_+1,R3
          1 000240  2D06                                 CMV,R2   6
          1 000241  0281 0183                            BGE      s:23361,PREL
          1 000243  9820 0000 0249  01                   LDR,R1   s:23260+16,R2
          1 000246  8390 0000 024F  01                   JMP      s:23262,R1
          1 000249       0176                            DC       s:23361,PREL
          1 00024A       0000                            DC       s:23262,PREL
          1 00024B       00FD                            DC       s:23319,PREL
          1 00024C       0111                            DC       s:23326,PREL
          1 00024D       0155                            DC       s:23349,PREL
          1 00024E       0029                            DC       s:23277,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:113  

      440    23261    3               CASE(%KZ#STAT_DE);

      441    23262    3                 KZ$3270DEV.PRINTER_DOWNS=0;

  23262   1 00024F  8746 001B                            CL       27,B6

      442    23263    3                 IF KZ$3270DEV.ACTIVE THEN

  23263   1 000251  82C6 0012                            LB,'4000'X        18,B6
  23263   1 000253       4000
          1 000254  0581 001E                            BBF      s:23274,PREL

      443    23264    4                    IF KZ$3270DEV.HLT.WACK THEN DO;

  23264   1 000256  82C6 0012                            LB,'0080'X        18,B6
  23264   1 000258       0080
          1 000259  0581 000A                            BBF      s:23269,PREL

      444    23265    4                       KZ$3270DEV.HLT.WACK='0'B;

  23265   1 00025B  8846 0012                            LBF,'0080'X       18,B6
  23265   1 00025D       0080

      445    23266    4                       KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;

  23266   1 00025E  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000260  8AC5 004D                            INC      77,B5

      446    23267    4                       END;

  23267   1 000262  0F81 0162                            B        s:23361,PREL

      447    23268    4                    ELSE DO;

      448    23269    4                       KZ$3270DEV.ACTIVE='0'B;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:114  
  23269   1 000264  8846 0012                            LBF,'4000'X       18,B6
  23269   1 000266       4000

      449    23270    4                       KZ$3270DEV.REACT='1'B;

  23270   1 000267  8946 001A                            LBT,'0040'X       26,B6
  23270   1 000269       0040

      450    23271    4                       CALL DSC_DEV(%KV_DSCRSN_HRDERR); /* Disconnect            */

  23271   1 00026A  DBF0 0004                            LAB,B5   4,IMO
          1 00026C  DFC7 0070                            STB,B5   CP_PHLEGM+5,AUTO
          1 00026E  E3C0 1032                            LNJ,B6   s:0,PREL
          1 000270       0001                            DC       s:23272,PREL

      451    23272    4                       END;

  23272   1 000271  0F81 0153                            B        s:23361,PREL

      452    23273    3                 ELSE
      453    23274    3                    CALL CNC_DEV;          /* Connect                            */

  23274   1 000273  E3C0 11D7                            LNJ,B6   s:0,PREL
          1 000275       0001                            DC       s:23274+3,PREL
          1 000276  0F81 014E                            B        s:23361,PREL

      454    23275
      455    23276    3               CASE(%KZ#STAT_PAPER);

      456    23277    3                 IF KZ$LINCTX.PRO.SLAVE THEN

  23277   1 000278  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 00027A  89C5 004B                            CMZ      75,B5
          1 00027C  0881 0010                            BAGE     s:23283,PREL

      457    23278    3                    IF KZ$3270DEV.OTPHD$->UBYT(SIZEC(KZ$OTPBFR)+4)=

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:115  
  23278   1 00027E  CCC6 0008                            LDB,B4   8,B6
          1 000280  E2C4 000A                            LLH,R6   10,B4
          1 000282  D280 0000 0004  xsym                 LLH,R5   KZ_3270XLB+4
          1 000285  E955                                 CMR,R6   R5
          1 000286  0901 013E                            BE       s:23361,PREL

      458    23279    3                      KZ_3270XL(8) THEN GOTO END_STATUS;
      459    23280    3                    ELSE
      460    23281    3                       IF KZ$3270DEV.OTPHD$->UBYT(SIZEC(KZ$OTPBFR)+2)=

  23281   1 000288  C2C4 0009                            LLH,R4   9,B4
          1 00028A  C955                                 CMR,R4   R5
          1 00028B  0901 0139                            BE       s:23361,PREL

      461    23282    3                         KZ_3270XL(8) THEN GOTO END_STATUS;
      462    23283    3                 BFR_SIZ=1;

  23283   1 00028D  6C01                                 LDV,R6   1
          1 00028E  EF47 0017                            STR,R6   BFR_SIZ,AUTO

      463    23284    3                 KZ$3270DEV.HLT.WACK='1'B;

  23284   1 000290  8946 0012                            LBT,'0080'X       18,B6
  23284   1 000292       0080

      464    23285    3                 SZ=KZ_3270_BFRSIZ(BFR_SIZ);

  23285   1 000293  B856                                 LDR,R3   R6
          1 000294  D830 0000 0000  xsym                 LDR,R5   KZ_3270_BFRSIZ,R3
          1 000297  DF47 001B                            STR,R5   SZ,AUTO

      465    23286    3                 CALL KVB$GET2NSYS(SZ,BFR$) ALTRET(NO_MEMORY);

  23286   1 000299  CBC7 0015                            LAB,B4   BFR$,AUTO
          1 00029B  CFC7 0094                            STB,B4   @DFRD+24,AUTO
          1 00029D  BBC7 001B                            LAB,B3   SZ,AUTO
          1 00029F  BFC7 0092                            STB,B3   @DFRD+22,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:116  
          1 0002A1  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0002A3  CBF0 0200                            LAB,B4   512,IMO
          1 0002A5  E380 0000 0000  xent                 LNJ,B6   KVB$GET2NSYS
          1 0002A8       0912                            DC       s:23953,PREL

      466    23287    3                 KZ$3270STT.OTPBFRSIZ(BFR_SIZ)=KZ$3270STT.OTPBFRSIZ(BFR_SIZ)+1;

  23287   1 0002A9  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 0002AC  B847 0017                            LDR,R3   BFR_SIZ,AUTO
          1 0002AE  3E41                                 ADV,R3   65
          1 0002AF  BF47 0092                            STR,R3   @DFRD+22,AUTO
          1 0002B1  3001                                 SOL,R3   1
          1 0002B2  3E01                                 ADV,R3   1
          1 0002B3  A847 0092                            LDR,R2   @DFRD+22,AUTO
          1 0002B5  2001                                 SOL,R2   1
          1 0002B6  8AB6                                 INC      ,B6,R3
          1 0002B7  8EA6                                 CAD      ,B6,R2

      467    23288    3                 KZ$3270STT.KHSTT.OTPBFRBYTUTL=

  23288   1 0002B8  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 0002BB  B847 0017                            LDR,R3   BFR_SIZ,AUTO
          1 0002BD  F830 0000 0000  xsym                 LDR,R7   KZ_3270_BFRSIZ,R3
          1 0002C0  6C00                                 LDV,R6   0
          1 0002C1  7081                                 DOL,R7   1
          1 0002C2  8446 001E                            AID      30,B6
          1 0002C4  8D46 001E                            SDI      30,B6

      468    23289    3                   KZ$3270STT.KHSTT.OTPBFRBYTUTL+(KZ_3270_BFRSIZ(BFR_SIZ)*2);
      469    23290    3                 KZ$OTPBFR=KZ_OTPBFR;

  23290   1 0002C6  AB80 0000 004F  00                   LAB,B2   KZ_OTPBFR
          1 0002C9  2C00                                 LDV,R2   0
          1 0002CA  6C10                                 LDV,R6   16
          1 0002CB  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 0002CD  3C00                                 LDV,R3   0
          1 0002CE  0008                                 MMM
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:117  

      470    23291    3                 KZ$OTPBFR.BFRSIZ=BFR_SIZ;

  23291   1 0002CF  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 0002D1  E847 0017                            LDR,R6   BFR_SIZ,AUTO
          1 0002D3  EF46 0004                            STR,R6   4,B6

      471    23292    3                 KZ$OTPBFR.FLAGS.FIRST#='1'B;

  23292   1 0002D5  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 0002D7  8946 0002                            LBT,'0080'X       2,B6
          1 0002D9       0080

      472    23293    3                 KZ$OTPBFR.FLAGS.LAST#='1'B;

  23293   1 0002DA  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 0002DC  8946 0002                            LBT,'0040'X       2,B6
          1 0002DE       0040

      473    23294    3                 KZ$OTPBFR.FLAGS.CNT#='1'B;

  23294   1 0002DF  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 0002E1  8946 0002                            LBT,'0020'X       2,B6
          1 0002E3       0020

      474    23295    3                 KZ$OTPBFR.DEV$=DEV$;

  23295   1 0002E4  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0002E6  DCC7 0015                            LDB,B5   BFR$,AUTO
          1 0002E8  EFC5 0006                            STB,B6   6,B5

      475    23296    3                 IF KZ$LINCTX.PRO.SLAVE THEN

  23296   1 0002EA  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0002EC  89C5 004B                            CMZ      75,B5
          1 0002EE  0881 0030                            BAGE     s:23307,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:118  
      476    23297    4                 DO;

      477    23298    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+0)=KZ_3270XL (KZ$3270CTR.ADR);

  23298   1 0002F0  CCC7 000B                            LDB,B4   CTR$,AUTO
          1 0002F2  B2C4 000A                            LLH,R3   10,B4
          1 0002F4  D2B0 0000 0000  xsym                 LLH,R5   KZ_3270XLB,R3
          1 0002F7  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 0002F9  D7C3 0008                            STH,R5   8,B3

      478    23299    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+1)=KZ_3270XL (KZ$3270DEV.ADR);

  23299   1 0002FB  B2C6 0015                            LLH,R3   21,B6
          1 0002FD  D2B0 0000 0000  xsym                 LLH,R5   KZ_3270XLB,R3
          1 000300  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 000302  DAC3 0008                            SRM,R5,'00FF'X    8,B3
          1 000304       00FF

      479    23300    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+2)=BITBIN(%KZ#ESCAPE);

  23300   1 000305  5C27                                 LDV,R5   39
          1 000306  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 000308  D7C3 0009                            STH,R5   9,B3

      480    23301    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+3)=BITBIN(%KZ#WRITE);

  23301   1 00030A  C870 00F1                            LDR,R4   241,IMO
          1 00030C  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 00030E  CAC3 0009                            SRM,R4,'00FF'X    9,B3
          1 000310       00FF

      481    23302    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+4)=KZ_3270XL (8);
             23302                             /* WCC (START PRINT) */

  23302   1 000311  B280 0000 0004  xsym                 LLH,R3   KZ_3270XLB+4
          1 000314  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 000316  B7C3 000A                            STH,R3   10,B3
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:119  

      482    23303    4                    KZ$OTPBFR.DATA_SIZ=5;

  23303   1 000318  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 00031A  2C05                                 LDV,R2   5
          1 00031B  AF43 0003                            STR,R2   3,B3

      483    23304    4                    END;

  23304   1 00031D  0F81 0019                            B        s:23312,PREL

      484    23305    3                 ELSE
      485    23306    4                 DO;

      486    23307    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+0)=BITBIN(%KZ#ESCAPE);

  23307   1 00031F  5C27                                 LDV,R5   39
          1 000320  CCC7 0015                            LDB,B4   BFR$,AUTO
          1 000322  D7C4 0008                            STH,R5   8,B4

      487    23308    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+1)=BITBIN(%KZ#WRITE);

  23308   1 000324  C870 00F1                            LDR,R4   241,IMO
          1 000326  CCC7 0015                            LDB,B4   BFR$,AUTO
          1 000328  CAC4 0008                            SRM,R4,'00FF'X    8,B4
          1 00032A       00FF

      488    23309    4                    BFR$->UBYT(SIZEC(KZ$OTPBFR)+2)=KZ_3270XL (8);
             23309                             /* WCC (START PRINT) */

  23309   1 00032B  B280 0000 0004  xsym                 LLH,R3   KZ_3270XLB+4
          1 00032E  CCC7 0015                            LDB,B4   BFR$,AUTO
          1 000330  B7C4 0009                            STH,R3   9,B4

      489    23310    4                    KZ$OTPBFR.DATA_SIZ=3;

  23310   1 000332  CCC7 0015                            LDB,B4   BFR$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:120  
          1 000334  2C03                                 LDV,R2   3
          1 000335  AF44 0003                            STR,R2   3,B4

      490    23311    4                    END;

      491    23312    3                 KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;

  23312   1 000337  CCC6 0008                            LDB,B4   8,B6
          1 000339  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 00033B  CF83                                 STB,B4   ,B3

      492    23313    3                 KZ$3270DEV.OTPHD$=BFR$;

  23313   1 00033C  CCC7 0015                            LDB,B4   BFR$,AUTO
          1 00033E  CFC6 0008                            STB,B4   8,B6

      493    23314    3                 IF KZ$3270DEV.OTPTL$ = ADDR(NIL)

  23314   1 000340  8DC6 000A                            CMN      10,B6
          1 000342  0981 0005                            BNE      s:23316,PREL

      494    23315    3                 THEN KZ$3270DEV.OTPTL$=BFR$;

  23315   1 000344  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 000346  BFC6 000A                            STB,B3   10,B6

      495    23316    3                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;

  23316   1 000348  8AC5 004D                            INC      77,B5
          1 00034A  0F81 007A                            B        s:23361,PREL

      496    23317
      497    23318    3               CASE(%KZ#STAT_DSC);

      498    23319    4                 IF KZ$3270DEV.ACTIVE THEN DO;

  23319   1 00034C  82C6 0012                            LB,'4000'X        18,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:121  
  23319   1 00034E       4000
          1 00034F  0581 0075                            BBF      s:23361,PREL

      499    23320    4                    KZ$3270DEV.ACTIVE='0'B; /* Dev down                          */

  23320   1 000351  8846 0012                            LBF,'4000'X       18,B6
  23320   1 000353       4000

      500    23321    4                    CALL REQUEUE;          /* Get back any output                */

  23321   1 000354  E3C0 0C6B                            LNJ,B6   s:0,PREL
          1 000356       0001                            DC       s:23322,PREL

      501    23322    4                    CALL DSC_DEV(%KV_DSCRSN_HRDERR);

  23322   1 000357  EBF0 0004                            LAB,B6   4,IMO
          1 000359  EFC7 0070                            STB,B6   CP_PHLEGM+5,AUTO
          1 00035B  E3C0 0F45                            LNJ,B6   s:0,PREL
          1 00035D       0001                            DC       s:23323,PREL

      502    23323    4                    END;

  23323   1 00035E  0F81 0066                            B        s:23361,PREL

      503    23324
      504    23325    3               CASE(%KZ#STAT_RETRY);

      505    23326    3                 IF NOT KZ$3270DEV.ACTIVE THEN

  23326   1 000360  82C6 0012                            LB,'4000'X        18,B6
  23326   1 000362       4000
          1 000363  0581 0061                            BBF      s:23361,PREL

      506    23327    3                    GOTO END_STATUS;       /* Ignore if not active               */
      507    23328    4                 IF KZ$LINCTX.OTPHD$~=ADDR(NIL) THEN DO;

  23328   1 000365  DCC7 0009                            LDB,B5   LIN$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:122  
          1 000367  8DC5 0052                            CMN      82,B5
          1 000369  0901 0010                            BE       s:23335,PREL

      508    23329    4                    IF KZ$LINCTX.OTPHD$->KZ$OTPBFR.FLAGS.ERR# THEN

  23329   1 00036B  CCC5 0052                            LDB,B4   82,B5
          1 00036D  82C4 0002                            LB,'0010'X        2,B4
          1 00036F       0010
          1 000370  0501 0038                            BBT      s:23352,PREL

      509    23330    4                       GOTO CONT;
      510    23331    4                    KZ$LINCTX.OTPHD$->KZ$OTPBFR.FLAGS.ERR#='1'B;

  23331   1 000372  8944 0002                            LBT,'0010'X       2,B4
  23331   1 000374       0010

      511    23332    4                    CALL REQUEUE;

  23332   1 000375  E3C0 0C4A                            LNJ,B6   s:0,PREL
          1 000377       0001                            DC       s:23333,PREL

      512    23333    4                    END;

  23333   1 000378  0F81 004C                            B        s:23361,PREL

      513    23334    3                 ELSE
      514    23335    4                    IF KZ$3270DEV.OTPHD$ ~= ADDR(NIL) THEN DO;

  23335   1 00037A  8DC6 0008                            CMN      8,B6
          1 00037C  0901 0048                            BE       s:23361,PREL

      515    23336    5                       IF KZ$3270DEV.OTPHD$->KZ$OTPBFR.FLAGS.ERR# THEN DO;

  23336   1 00037E  CCC6 0008                            LDB,B4   8,B6
          1 000380  82C4 0002                            LB,'0010'X        2,B4
          1 000382       0010
          1 000383  0581 001B                            BBF      s:23345,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:123  

      516    23337    5                          KZ$LINCTX.OTPHD$=KZ$3270DEV.OTPHD$;

  23337   1 000385  CFC5 0052                            STB,B4   82,B5

      517    23338    5                          KZ$LINCTX.OTPTL$=KZ$3270DEV.OTPHD$;

  23338   1 000387  BCC6 0008                            LDB,B3   8,B6
          1 000389  BFC5 0054                            STB,B3   84,B5

      518    23339    5                          KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=ADDR(NIL);

  23339   1 00038B  AB80 0000 0000                       LAB,B2   0
          1 00038E  AF83                                 STB,B2   ,B3

      519    23340    5                          KZ$3270DEV.OTPHD$=KZ$3270DEV.OTPHD$->KZ$OTPBFR.LNK$;

  23340   1 00038F  CCC6 0008                            LDB,B4   8,B6
          1 000391  BC84                                 LDB,B3   ,B4
          1 000392  BFC6 0008                            STB,B3   8,B6

      520    23341    5                          IF KZ$3270DEV.OTPHD$ = ADDR(NIL) THEN

  23341   1 000394  8DC6 0008                            CMN      8,B6
          1 000396  0981 0006                            BNE      s:23343,PREL

      521    23342    5                             KZ$3270DEV.OTPTL$=ADDR(NIL);

  23342   1 000398  CB80 0000 0000                       LAB,B4   0
          1 00039B  CFC6 000A                            STB,B4   10,B6

      522    23343    5                          GOTO CONT;

  23343   1 00039D  0F81 000B                            B        s:23352,PREL

      523    23344    5                          END;
      524    23345    4                       KZ$3270DEV.OTPHD$->KZ$OTPBFR.FLAGS.ERR#='1'B;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:124  

  23345   1 00039F  8944 0002                            LBT,'0010'X       2,B4
  23345   1 0003A1       0010

      525    23346    4                       END;

  23346   1 0003A2  0F81 0022                            B        s:23361,PREL

      526    23347
      527    23348    3               CASE(%KZ#STAT_CONT);

      528    23349    3                 IF NOT KZ$3270DEV.ACTIVE THEN

  23349   1 0003A4  82C6 0012                            LB,'4000'X        18,B6
  23349   1 0003A6       4000
          1 0003A7  0581 001D                            BBF      s:23361,PREL

      529    23350    3                    GOTO END_STATUS;
      530    23351    3   CONT:
      531    23352    3                 BFR$=KZ$LINCTX.OTPHD$;

  23352   1 0003A9  DCC7 0009            CONT            LDB,B5   LIN$,AUTO
          1 0003AB  CCC5 0052                            LDB,B4   82,B5
          1 0003AD  CFC7 0015                            STB,B4   BFR$,AUTO

      532    23353    4                 IF BFR$~=ADDR(NIL) THEN DO;

  23353   1 0003AF  8DC7 0015                            CMN      BFR$,AUTO
          1 0003B1  0901 0013                            BE       s:23361,PREL

      533    23354    4                    KZ$LINCTX.OTPHD$=KZ$OTPBFR.LNK$;

  23354   1 0003B3  BC84                                 LDB,B3   ,B4
          1 0003B4  BFC5 0052                            STB,B3   82,B5

      534    23355    4                    IF KZ$LINCTX.OTPHD$=ADDR(NIL) THEN

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:125  
  23355   1 0003B6  8DC5 0052                            CMN      82,B5
          1 0003B8  0981 0006                            BNE      s:23357,PREL

      535    23356    4                       KZ$LINCTX.OTPTL$=ADDR(NIL);

  23356   1 0003BA  AB80 0000 0000                       LAB,B2   0
          1 0003BD  AFC5 0054                            STB,B2   84,B5

      536    23357    4                    KZ$OTPBFR.CMPCOD=%KV_CMPCOD_DVCERR;

  23357   1 0003BF  6C0D                                 LDV,R6   13
          1 0003C0  E7C4 0005                            STH,R6   5,B4

      537    23358    4                    CALL RELOTPBFR;        /* Not sent properly                  */

  23358   1 0003C2  E3C0 0AA8                            LNJ,B6   s:0,PREL
          1 0003C4       0001                            DC       s:23361,PREL

      538    23359    4                    END;

      539    23360
      540    23361    3               END;

  23357   1 0003C5  0F81 07E4            END_STATUS      B        s:23943,PREL

      541    23362
      542    23363    2   END_STATUS: ;
      543    23364        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:126  
      544    23365        /* Build specific poll address for current device */
      545    23366
      546    23367    2            CASE(%KZ#LINFCN_SPCPOL);

      547    23368
      548    23369    2              KZ$LINCTX.POLADR.CTR=POLADR(KZ$LINCTX.CURCTR$->KZ$3270CTR.ADR);

  23369   1 0003C7  ACC3 004E                            LDB,B2   78,B3
          1 0003C9  92C2 000A                            LLH,R1   10,B2
          1 0003CB  E290 0000 0000  00                   LLH,R6   POLADR_B,R1
          1 0003CE  E7C3 0064                            STH,R6   100,B3

      549    23370    2              KZ$LINCTX.POLADR.DEV=POLADR(KZ$LINCTX.CURDEV$->KZ$3270DEV.ADR);

  23370   1 0003D0  9CC3 0050                            LDB,B1   80,B3
          1 0003D2  B2C1 0015                            LLH,R3   21,B1
          1 0003D4  E2B0 0000 0000  00                   LLH,R6   POLADR_B,R3
          1 0003D7  EAC3 0064                            SRM,R6,'00FF'X    100,B3
          1 0003D9       00FF

      550    23371    2              RETURN;

  23371   1 0003DA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      551    23372        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:127  
      552    23373        /* Specific poll all devices.  Before first call, set KZ$LINCTX.OTPCTR$
      553    23374           and KZ$LINCTX.OTPDEV$ to ADDR(NIL).  Continue to call this until
      554    23375           it ALTRETs.  Do not make any GETOTP calls in between. */
      555    23376
      556    23377    2            CASE(%KZ#LINFCN_SPCPOLALL);

      557    23378
      558    23379    2              GOTO CTRLOOP;

  23379   1 0003DD  0F81 FC6E                            B        s:23111,PREL

      559    23380        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:128  
      560    23381        /* Get general poll address of next inactive controller */
      561    23382
      562    23383    2            CASE(%KZ#LINFCN_INACT_CTR);

      563    23384
      564    23385    2   INACT_CTR:
      565    23386    2              KZ$LINCTX.CURDEV$=ADDR(NIL);

  23386   1 0003DF  AB80 0000 0000       INACT_CTR       LAB,B2   0
          1 0003E2  AFC3 0050                            STB,B2   80,B3

      566    23387    2              I=KZ$LINCTX.INACT_CTR;

  23387   1 0003E4  E2C3 006C                            LLH,R6   108,B3
          1 0003E6  EF47 0013                            STR,R6   CNT,AUTO

      567    23388    3              DO UNTIL(I=KZ$LINCTX.INACT_CTR);

      568    23389    4                 IF KZ$LINCTX.POLLST$->UBYT(I)=0 THEN DO;

  23389   1 0003E8  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 0003EA  DCC6 0066                            LDB,B5   102,B6
          1 0003EC  B847 0013                            LDR,R3   CNT,AUTO
          1 0003EE  E2B5                                 LLH,R6   ,B5,R3
          1 0003EF  6981 0029                            BNEZ,R6  s:23401,PREL

      569    23390    4                    CTR$=KZ$LINCTX.CTRLST$->P$(I);

  23390   1 0003F1  CCC6 0068                            LDB,B4   104,B6
          1 0003F3  BCB4                                 LDB,B3   ,B4,R3
          1 0003F4  BFC7 000B                            STB,B3   CTR$,AUTO

      570    23391    4                    KZ$LINCTX.POLADR.CTR=POLADR(KZ$3270CTR.ADR);

  23391   1 0003F6  A2C3 000A                            LLH,R2   10,B3
          1 0003F8  D2A0 0000 0000  00                   LLH,R5   POLADR_B,R2
          1 0003FB  D7C6 0064                            STH,R5   100,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:129  

      571    23392    4                    KZ$LINCTX.POLADR.DEV=0; /* Just to make it look nice         */

  23392   1 0003FD  8846 0064                            LBF,'00FF'X       100,B6
  23392   1 0003FF       00FF

      572    23393    4                    KZ$LINCTX.CURCTR$=CTR$;

  23393   1 000400  BFC6 004E                            STB,B3   78,B6

      573    23394    4                    IF I<KZ$LINCTX.POLSIZ-1 THEN

  23394   1 000402  E846 0065                            LDR,R6   101,B6
          1 000404  6EFF                                 ADV,R6   -1
          1 000405  6801 0009                            BLZ,R6   s:23397,PREL
          1 000407  E953                                 CMR,R6   R3
          1 000408  0381 0006                            BLE      s:23397,PREL

      574    23395    4                       KZ$LINCTX.INACT_CTR=I+1;

  23395   1 00040A  3E01                                 ADV,R3   1
          1 00040B  B7C6 006C                            STH,R3   108,B6
          1 00040D  0F81 0003                            B        s:23398,PREL

      575    23396    4                    ELSE
      576    23397    4                       KZ$LINCTX.INACT_CTR=0;

  23397   1 00040F  87C6 006C                            CLH      108,B6

      577    23398    4                    KZ$LINCTX.POLX=I;

  23398   1 000411  D847 0013                            LDR,R5   CNT,AUTO
          1 000413  DAC6 006C                            SRM,R5,'00FF'X    108,B6
          1 000415       00FF

      578    23399    4                    RETURN;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:130  
  23399   1 000416  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      579    23400    4                    END;
      580    23401    3                 I=I+1;

  23401   1 000419  8AC7 0013                            INC      CNT,AUTO

      581    23402    3                 IF I>=KZ$LINCTX.POLSIZ THEN /* At end                           */

  23402   1 00041B  E847 0013                            LDR,R6   CNT,AUTO
          1 00041D  6801 0005                            BLZ,R6   s:23403,PREL
          1 00041F  E946 0065                            CMR,R6   101,B6
          1 000421  0801 0003                            BAL      s:23404,PREL

      582    23403    3                    I=0;

  23403   1 000423  8747 0013                            CL       CNT,AUTO

      583    23404    3                 END;

  23404   1 000425  E2C6 006C                            LLH,R6   108,B6
          1 000427  E947 0013                            CMR,R6   CNT,AUTO
          1 000429  0981 FFBE                            BNE      s:23389,PREL

      584    23405
      585    23406    2              ALTRETURN;

  23406   1 00042B  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      586    23407        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:131  
      587    23408        /* Input */
      588    23409
      589    23410    2            CASE(%KZ#LINFCN_INP);

      590    23411
      591    23412    3              IF KZ$LINCTX.PRO.SLAVE THEN DO;

  23412   1 00042E  89C3 004B                            CMZ      75,B3
          1 000430  0881 00B7                            BAGE     s:23466,PREL

      592    23413    3                 IF KZ$LINCTX.INPDATSIZ <=3 THEN

  23413   1 000432  E843 0059                            LDR,R6   89,B3
          1 000434  6D03                                 CMV,R6   3
          1 000435  0301 0006                            BG       s:23416,PREL

      593    23414    3                    J=2;                   /* Displ to start of data             */

  23414   1 000437  5C02                                 LDV,R5   2
          1 000438  DF47 0014                            STR,R5   J,AUTO
          1 00043A  0F81 0004                            B        s:23417,PREL

      594    23415    3                 ELSE
      595    23416    3                    J=4;

  23416   1 00043C  5C04                                 LDV,R5   4
          1 00043D  DF47 0014                            STR,R5   J,AUTO

      596    23417    3                 CTR$=KZ$LINCTX.CURCTR$;

  23417   1 00043F  ACC3 004E                            LDB,B2   78,B3
          1 000441  AFC7 000B                            STB,B2   CTR$,AUTO

      597    23418    3                 DEV$=KZ$LINCTX.CURDEV$;

  23418   1 000443  DCC3 0050                            LDB,B5   80,B3
          1 000445  DFC7 000D                            STB,B5   DEV$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:132  

      598    23419    3                 KZ$3270DEV.IGN_INP='0'B;

  23419   1 000447  8845 0012                            LBF,'0100'X       18,B5
  23419   1 000449       0100

      599    23420    3                 KZ$3270DEV.KBDLCK='1'B;

  23420   1 00044A  8945 001A                            LBT,'0080'X       26,B5
  23420   1 00044C       0080

      600    23421    3                 KZ$3270DEV.AID=KZ$LINCTX.INPBFR$->UBYT(1);

  23421   1 00044D  ECC3 0056                            LDB,B6   86,B3
          1 00044F  E806                                 LDR,R6   ,B6
          1 000450  EAC5 0011                            SRM,R6,'00FF'X    17,B5
          1 000452       00FF

      601    23422    3                 IF KZ$3270DEV.AID~=64 /* Special PASSTHRU AID */ THEN

  23422   1 000453  E845 0011                            LDR,R6   17,B5
          1 000455  E570 00FF                            AND,R6   255,IMO
          1 000457  6D40                                 CMV,R6   64
          1 000458  0901 0013                            BE       s:23433,PREL

      602    23423    3                    IF KZ$3270DEV.ACTIVE THEN

  23423   1 00045A  82C5 0012                            LB,'4000'X        18,B5
  23423   1 00045C       4000
          1 00045D  0581 00C4                            BBF      s:23479,PREL

      603    23424    4                    DO;

      604    23425    4                       IF KZ$3270DEV.AID=108 OR /* PA1                           */

  23425   1 00045F  6D6C                                 CMV,R6   108
          1 000460  0901 0007                            BE       s:23427,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:133  
          1 000462  6D6D                                 CMV,R6   109
          1 000463  0901 0004                            BE       s:23427,PREL
          1 000465  6D6E                                 CMV,R6   110
          1 000466  0981 0003                            BNE      s:23428,PREL

      605    23426    4                         KZ$3270DEV.AID=109 OR /* CLEAR                          */
      606    23427    4                         KZ$3270DEV.AID=110 THEN J=J+1; /* PA2                   */

  23427   1 000468  8AC7 0014                            INC      J,AUTO

      607    23428    4                       GOTO PROCESS_INPUT;

  23428   1 00046A  0F81 00A5                            B        s:23476,PREL

      608    23429    4                       END;
      609    23430    3                    ELSE
      610    23431    3                       GOTO IGNOR;
      611    23432    4                 ELSE DO;

      612    23433    4                    I=BITBIN(KZ$LINCTX.INPBFR$->BITS(2)&'0F'X);

  23433   1 00046C  ECC3 0056                            LDB,B6   86,B3
          1 00046E  C2C6 0001                            LLH,R4   1,B6
          1 000470  4008                                 SOL,R4   8
          1 000471  C570 0F00                            AND,R4   3840,IMO
          1 000473  4048                                 SOR,R4   8
          1 000474  CF47 0013                            STR,R4   CNT,AUTO

      613    23434    5                    DO CASE(I);

  23434   1 000476  B854                                 LDR,R3   R4
          1 000477  3D04                                 CMV,R3   4
          1 000478  0281 006D                            BGE      s:23463,PREL
          1 00047A  A830 0000 0480  01                   LDR,R2   s:23434+10,R3
          1 00047D  83A0 0000 0484  01                   JMP      s:23436,R2
          1 000480       0062                            DC       s:23463,PREL
          1 000481       0000                            DC       s:23436,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:134  
          1 000482       001E                            DC       s:23444,PREL
          1 000483       0054                            DC       s:23457,PREL

      614    23435    5                     CASE(1);              /* Logon request                      */

      615    23436    5                       IF NOT KZ$3270DEV.ACTIVE AND NOT KZ$3270DEV.DSC THEN

  23436   1 000484  82C5 0012                            LB,'4000'X        18,B5
  23436   1 000486       4000
          1 000487  0501 000B                            BBT      s:23439,PREL
          1 000489  82C5 0015                            LB,'00FF'X        21,B5
          1 00048B       00FF
          1 00048C  0501 0006                            BBT      s:23439,PREL

      616    23437    5                          CALL CNC_DEV;

  23437   1 00048E  E3C0 0FBC                            LNJ,B6   s:0,PREL
          1 000490       0001                            DC       s:23437+3,PREL
          1 000491  0F81 0054                            B        s:23463,PREL

      617    23438    6                       ELSE DO;

      618    23439    6                          KZ$3270DEV.ACTIVE='0'B;

  23439   1 000493  8845 0012                            LBF,'4000'X       18,B5
  23439   1 000495       4000

      619    23440    6                          KZ$3270DEV.REACT='1'B; /* Start it up later            */

  23440   1 000496  8945 001A                            LBT,'0040'X       26,B5
  23440   1 000498       0040

      620    23441    6                          CALL DSC_DEV (%KV_DSCRSN_SFTERR);

  23441   1 000499  EBF0 0005                            LAB,B6   5,IMO
          1 00049B  EFC7 0070                            STB,B6   CP_PHLEGM+5,AUTO
          1 00049D  E3C0 0E03                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:135  
          1 00049F       0001                            DC       s:23442,PREL

      621    23442    6                          END;

  23442   1 0004A0  0F81 0045                            B        s:23463,PREL

      622    23443    5                     CASE(2);              /* Hung-up                            */

      623    23444    5                       IF KZ$3270DEV.ACTIVE THEN

  23444   1 0004A2  82C5 0012                            LB,'4000'X        18,B5
  23444   1 0004A4       4000
          1 0004A5  0581 0029                            BBF      s:23455,PREL

      624    23445    6                       DO;

      625    23446    6                          CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);

  23446   1 0004A7  9BC7 0020                            LAB,B1   DFRD,AUTO
          1 0004A9  9FC7 007C                            STB,B1   @VDI$+2,AUTO
          1 0004AB  EBC5 0004                            LAB,B6   4,B5
          1 0004AD  EFC7 007A                            STB,B6   I+4,AUTO
          1 0004AF  E3C0 128C                            LNJ,B6   s:0,PREL
          1 0004B1       0001                            DC       s:23447,PREL

      626    23447    6                          IF DFRD

  23447   1 0004B2  89C7 0020                            CMZ      DFRD,AUTO
          1 0004B4  0881 0008                            BAGE     s:23451,PREL

      627    23448    6                          THEN KZ$3270DEV.DSC_LATER='1'B;

  23448   1 0004B6  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0004B8  8946 001A                            LBT,'0020'X       26,B6
          1 0004BA       0020
          1 0004BB  0F81 002A                            B        s:23463,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:136  
      628    23449    6                          ELSE
      629    23450    7                          DO;

      630    23451    7                             CALL DSC_DEV (%KV_DSCRSN_SFTERR);

  23451   1 0004BD  EBF0 0005                            LAB,B6   5,IMO
          1 0004BF  EFC7 0070                            STB,B6   CP_PHLEGM+5,AUTO
          1 0004C1  E3C0 0DDF                            LNJ,B6   s:0,PREL
          1 0004C3       0001                            DC       s:23452,PREL

      631    23452    7                             CALL EXIT_VDH (KZ$3270DEV.VDI$);

  23452   1 0004C4  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0004C6  DBC6 0004                            LAB,B5   4,B6
          1 0004C8  DFC7 007A                            STB,B5   I+4,AUTO
          1 0004CA  E3C0 12D1                            LNJ,B6   s:0,PREL
          1 0004CC       0001                            DC       s:23454,PREL

      632    23453    7                             END;

      633    23454    6                          END;

  23454   1 0004CD  0F81 0018                            B        s:23463,PREL

      634    23455    5                       ELSE CALL DSC_DEV (%KV_DSCRSN_SFTERR);

  23455   1 0004CF  9BF0 0005                            LAB,B1   5,IMO
          1 0004D1  9FC7 0070                            STB,B1   CP_PHLEGM+5,AUTO
          1 0004D3  E3C0 0DCD                            LNJ,B6   s:0,PREL
          1 0004D5       0001                            DC       s:23455+7,PREL
          1 0004D6  0F81 000F                            B        s:23463,PREL

      635    23456    5                     CASE(3);              /* ATTN key                           */

      636    23457    5                       KZ$LINCTX.INPBFR$->BITS(1)='6C'X; /* PA1                  */

  23457   1 0004D8  6C6C                                 LDV,R6   108
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:137  
          1 0004D9  EA86                                 SRM,R6,'00FF'X    ,B6
          1 0004DA       00FF

      637    23458    5                       KZ$3270DEV.AID = BITBIN('6C'X);

  23458   1 0004DB  EAC5 0011                            SRM,R6,'00FF'X    17,B5
  23458   1 0004DD       00FF

      638    23459    5                       KZ$LINCTX.INPDATSIZ=2;

  23459   1 0004DE  2C02                                 LDV,R2   2
          1 0004DF  AF43 0059                            STR,R2   89,B3

      639    23460    5                       J=2;

  23460   1 0004E1  5C02                                 LDV,R5   2
          1 0004E2  DF47 0014                            STR,R5   J,AUTO

      640    23461    5                       GOTO PROCESS_INPUT;

  23461   1 0004E4  0F81 002B                            B        s:23476,PREL

      641    23462    5                     END;

      642    23463    4                    GOTO XIT;

  23463   1 0004E6  0F81 06C3                            B        s:23943,PREL

      643    23464    4                    END;
      644    23465    3                 END;
      645    23466    3              IF LINSTAT&%KZ#LINSTAT_FIRST THEN DO;

  23466   1 0004E8  ACC7 0006                            LDB,B2   @PARAMETER2,AUTO
          1 0004EA  E802                                 LDR,R6   ,B2
          1 0004EB  E570 8000                            AND,R6   -32768,IMO
          1 0004ED  6901 0093                            BEZ,R6   s:23504,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:138  
      646    23467    3                 CALL FND_CTX ALTRET(XIT);

  23467   1 0004EF  E3C0 0886                            LNJ,B6   s:0,PREL
          1 0004F1       06B9                            DC       s:23943,PREL

      647    23468    3                 IF KZ$LINCTX.INPDATSIZ<=3 THEN

  23468   1 0004F2  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 0004F4  E846 0059                            LDR,R6   89,B6
          1 0004F6  6D03                                 CMV,R6   3
          1 0004F7  0301 0006                            BG       s:23471,PREL

      648    23469    3                    J=3;                   /* Displ to start of data             */

  23469   1 0004F9  5C03                                 LDV,R5   3
          1 0004FA  DF47 0014                            STR,R5   J,AUTO
          1 0004FC  0F81 0004                            B        s:23472,PREL

      649    23470    3                 ELSE
      650    23471    3                    J=5;

  23471   1 0004FE  5C05                                 LDV,R5   5
          1 0004FF  DF47 0014                            STR,R5   J,AUTO

      651    23472    3                 KZ$3270DEV.IGN_INP='0'B;

  23472   1 000501  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 000503  8845 0012                            LBF,'0100'X       18,B5
          1 000505       0100

      652    23473    3                 KZ$3270DEV.KBDLCK='1'B;

  23473   1 000506  8945 001A                            LBT,'0080'X       26,B5
  23473   1 000508       0080

      653    23474    3                 KZ$3270DEV.AID=KZ$LINCTX.INPBFR$->UBYT(2);

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:139  
  23474   1 000509  CCC6 0056                            LDB,B4   86,B6
          1 00050B  E2C4 0001                            LLH,R6   1,B4
          1 00050D  EAC5 0011                            SRM,R6,'00FF'X    17,B5
          1 00050F       00FF

      654    23475    3   PROCESS_INPUT:
      655    23476    4                 IF NOT KZ$3270DEV.ACTIVE OR KZ$3270DEV.DSC THEN DO;

  23476   1 000510  82C5 0012            PROCESS_INPUT   LB,'4000'X        18,B5
  23476   1 000512       4000
          1 000513  0581 0006                            BBF      s:23477,PREL
          1 000515  82C5 0015                            LB,'00FF'X        21,B5
          1 000517       00FF
          1 000518  0581 0010                            BBF      s:23483,PREL

      656    23477    4                    IF NOT KZ$3270DEV.DSC THEN

  23477   1 00051A  82C5 0015                            LB,'00FF'X        21,B5
  23477   1 00051C       00FF
          1 00051D  0501 0004                            BBT      s:23479,PREL

      657    23478    4                       CALL CNC_DEV;

  23478   1 00051F  E3C0 0F2B                            LNJ,B6   s:0,PREL
          1 000521       0001                            DC       s:23479,PREL

      658    23479    4   IGNOR:           KZ$3270DEV.IGN_INP='1'B;

  23479   1 000522  ECC7 000D            IGNOR           LDB,B6   DEV$,AUTO
          1 000524  8946 0012                            LBT,'0100'X       18,B6
          1 000526       0100

      659    23480    4                    GOTO XIT;

  23480   1 000527  0F81 0682                            B        s:23943,PREL

      660    23481    4                    END;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:140  
      661    23482
      662    23483    4                 IF KZ$3270DEV.HLT.PAG OR KZ$3270DEV.HLT.INP THEN DO;

  23483   1 000529  82C5 0012                            LB,'0020'X        18,B5
  23483   1 00052B       0020
          1 00052C  0501 0006                            BBT      s:23484,PREL
          1 00052E  82C5 0012                            LB,'0008'X        18,B5
          1 000530       0008
          1 000531  0581 001A                            BBF      s:23490,PREL

      663    23484    4                    IF KZ$3270DEV.HLT.PAG AND KZ$3270DEV.AID=125 /*ENTER*/ THEN

  23484   1 000533  82C5 0012                            LB,'0020'X        18,B5
  23484   1 000535       0020
          1 000536  0581 000B                            BBF      s:23486,PREL
          1 000538  E845 0011                            LDR,R6   17,B5
          1 00053A  E570 00FF                            AND,R6   255,IMO
          1 00053C  6D7D                                 CMV,R6   125
          1 00053D  0981 0004                            BNE      s:23486,PREL

      664    23485    4                       KZ$3270DEV.IGN_INP='1'B;

  23485   1 00053F  8945 0012                            LBT,'0100'X       18,B5
  23485   1 000541       0100

      665    23486    4                    KZ$3270DEV.HLT.PAG='0'B;

  23486   1 000542  8845 0012                            LBF,'0020'X       18,B5
  23486   1 000544       0020

      666    23487    4                    KZ$3270DEV.HLT.INP='0'B;

  23487   1 000545  8845 0012                            LBF,'0008'X       18,B5
  23487   1 000547       0008

      667    23488    4                    KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:141  
  23488   1 000548  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 00054A  8AC6 004D                            INC      77,B6

      668    23489    4                    END;

      669    23490    3                 IF KZ$3270DEV.AID=109 /*CLEAR*/ THEN

  23490   1 00054C  E845 0011                            LDR,R6   17,B5
          1 00054E  E570 00FF                            AND,R6   255,IMO
          1 000550  6D6D                                 CMV,R6   109
          1 000551  0981 003D                            BNE      s:23511,PREL

      670    23491    4                 DO;

      671    23492    4                    CALL ENTER_VDH(KZ$3270DEV.VDI$,DFRD);

  23492   1 000553  EBC7 0020                            LAB,B6   DFRD,AUTO
          1 000555  EFC7 007C                            STB,B6   @VDI$+2,AUTO
          1 000557  CBC5 0004                            LAB,B4   4,B5
          1 000559  CFC7 007A                            STB,B4   I+4,AUTO
          1 00055B  E3C0 11E0                            LNJ,B6   s:0,PREL
          1 00055D       0001                            DC       s:23493,PREL

      672    23493    4                    IF DFRD THEN

  23493   1 00055E  89C7 0020                            CMZ      DFRD,AUTO
          1 000560  0881 0008                            BAGE     s:23496,PREL

      673    23494    4                       KZ$3270DEV.DFR.CLR='1'B;

  23494   1 000562  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000564  8946 0016                            LBT,'1000'X       22,B6
          1 000566       1000
          1 000567  0F81 0027                            B        s:23511,PREL

      674    23495    5                    ELSE DO;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:142  
      675    23496    5                       CALL KZT$CLEARIMM(KZ$3270DEV);

  23496   1 000569  BBC7 000D                            LAB,B3   DEV$,AUTO
          1 00056B  CBF0 0100                            LAB,B4   256,IMO
          1 00056D  E380 0000 0000  xent                 LNJ,B6   KZT$CLEARIMM
          1 000570       0001                            DC       s:23497,PREL

      676    23497    5                       CALL EXIT_VDH(KZ$3270DEV.VDI$);

  23497   1 000571  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000573  DBC6 0004                            LAB,B5   4,B6
          1 000575  DFC7 007A                            STB,B5   I+4,AUTO
          1 000577  E3C0 1224                            LNJ,B6   s:0,PREL
          1 000579       0001                            DC       s:23499,PREL

      677    23498                                                /* Send WCC.KEYRSTR, eventually.      */
      678    23499    5                       KZ$3270DEV.KBDLCK='1'B;

  23499   1 00057A  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00057C  8946 001A                            LBT,'0080'X       26,B6
          1 00057E       0080

      679    23500    5                       END;

      680    23501    4                    END;

      681    23502    3                 END;

  23502   1 00057F  0F81 000F                            B        s:23511,PREL

      682    23503    3              ELSE DO;

      683    23504    3                 J=0;

  23504   1 000581  8747 0014                            CL       J,AUTO

      684    23505    3                 CTR$=KZ$LINCTX.CURCTR$;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:143  

  23505   1 000583  9CC3 004E                            LDB,B1   78,B3
          1 000585  9FC7 000B                            STB,B1   CTR$,AUTO

      685    23506    3                 DEV$=KZ$LINCTX.CURDEV$;

  23506   1 000587  DCC3 0050                            LDB,B5   80,B3
          1 000589  DFC7 000D                            STB,B5   DEV$,AUTO

      686    23507    3                 IF DEV$=ADDR(NIL) THEN

  23507   1 00058B  8DC7 000D                            CMN      DEV$,AUTO
          1 00058D  0901 061C                            BE       s:23943,PREL

      687    23508    3                    GOTO XIT;              /* Assume test-request                */
      688    23509    3                 END;

      689    23510
      690    23511    2              IF KZ$3270DEV.DSC OR NOT KZ$3270DEV.ACTIVE THEN

  23511   1 00058F  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000591  82C6 0015                            LB,'00FF'X        21,B6
          1 000593       00FF
          1 000594  0501 0006                            BBT      s:23512,PREL
          1 000596  82C6 0012                            LB,'4000'X        18,B6
          1 000598       4000
          1 000599  0501 0004                            BBT      s:23513,PREL

      691    23512    2                 KZ$3270DEV.IGN_INP='1'B;

  23512   1 00059B  8946 0012                            LBT,'0100'X       18,B6
  23512   1 00059D       0100

      692    23513    3              IF NOT KZ$3270DEV.IGN_INP THEN DO;

  23513   1 00059E  82C6 0012                            LB,'0100'X        18,B6
  23513   1 0005A0       0100
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:144  
          1 0005A1  0501 00D1                            BBT      s:23555,PREL

      693    23514    4                 IF LINSTAT&%KZ#LINSTAT_LAST THEN DO;

  23514   1 0005A3  DCC7 0006                            LDB,B5   @PARAMETER2,AUTO
          1 0005A5  E805                                 LDR,R6   ,B5
          1 0005A6  E570 4000                            AND,R6   16384,IMO
          1 0005A8  6901 0013                            BEZ,R6   s:23518,PREL

      694    23515    4                    KZ$LINCTX.INPBFR$->UBYT(KZ$LINCTX.INPDATSIZ)=BITBIN(%
             23515                             KZ#3270INPCTRCHR);

  23515   1 0005AA  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 0005AC  BCC4 0056                            LDB,B3   86,B4
          1 0005AE  B844 0059                            LDR,R3   89,B4
          1 0005B0  6C32                                 LDV,R6   50
          1 0005B1  E7B3                                 STH,R6   ,B3,R3

      695    23516    4                    KZ$LINCTX.INPBFR$->UBYT(KZ$LINCTX.INPDATSIZ+1)=KZ$3270DEV.AID;

  23516   1 0005B2  BCC4 0056                            LDB,B3   86,B4
          1 0005B4  B844 0059                            LDR,R3   89,B4
          1 0005B6  D846 0011                            LDR,R5   17,B6
          1 0005B8  D570 00FF                            AND,R5   255,IMO
          1 0005BA  3E01                                 ADV,R3   1
          1 0005BB  D7B3                                 STH,R5   ,B3,R3

      696    23517    4                    END;

      697    23518    3                 CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);

  23518   1 0005BC  CBC7 0020                            LAB,B4   DFRD,AUTO
          1 0005BE  CFC7 007C                            STB,B4   @VDI$+2,AUTO
          1 0005C0  BBC6 0004                            LAB,B3   4,B6
          1 0005C2  BFC7 007A                            STB,B3   I+4,AUTO
          1 0005C4  E3C0 1177                            LNJ,B6   s:0,PREL
          1 0005C6       0001                            DC       s:23519,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:145  

      698    23519    4                 IF DFRD THEN DO;

  23519   1 0005C7  89C7 0020                            CMZ      DFRD,AUTO
          1 0005C9  0881 006A                            BAGE     s:23539,PREL

      699    23520    4                    SZ=SIZEW(KZ$INPBFR);

  23520   1 0005CB  6C08                                 LDV,R6   8
          1 0005CC  EF47 001B                            STR,R6   SZ,AUTO

      700    23521    4                    CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);

  23521   1 0005CE  EBC7 000F                            LAB,B6   T$,AUTO
          1 0005D0  EFC7 0094                            STB,B6   @DFRD+24,AUTO
          1 0005D2  DBC7 001B                            LAB,B5   SZ,AUTO
          1 0005D4  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 0005D6  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0005D8  CBF0 0200                            LAB,B4   512,IMO
          1 0005DA  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 0005DD       05DD                            DC       s:23953,PREL

      701    23522    4                    T$->KZ$INPBFR=KZ_INPBFR;

  23522   1 0005DE  AB80 0000 0047  00                   LAB,B2   KZ_INPBFR
          1 0005E1  2C00                                 LDV,R2   0
          1 0005E2  6C10                                 LDV,R6   16
          1 0005E3  BCC7 000F                            LDB,B3   T$,AUTO
          1 0005E5  3C00                                 LDV,R3   0
          1 0005E6  0008                                 MMM

      702    23523    4                    T$->KZ$INPBFR.BFR_SIZ=KZ$LINCTX.INPBFRSIZ;

  23523   1 0005E7  ECC7 000F                            LDB,B6   T$,AUTO
          1 0005E9  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0005EB  E845 0058                            LDR,R6   88,B5
          1 0005ED  EF46 0004                            STR,R6   4,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:146  

      703    23524    4                    T$->KZ$INPBFR.DATA_SIZ=KZ$LINCTX.INPDATSIZ-J;

  23524   1 0005EF  E845 0059                            LDR,R6   89,B5
          1 0005F1  E247 0014                            SUB,R6   J,AUTO
          1 0005F3  ECC7 000F                            LDB,B6   T$,AUTO
          1 0005F5  EF46 0003                            STR,R6   3,B6

      704    23525    4                    T$->KZ$INPBFR.BYTX=J;

  23525   1 0005F7  ECC7 000F                            LDB,B6   T$,AUTO
          1 0005F9  E847 0014                            LDR,R6   J,AUTO
          1 0005FB  EF46 0005                            STR,R6   5,B6

      705    23526    4                    T$->KZ$INPBFR.DATA$=KZ$LINCTX.INPBFR$;

  23526   1 0005FD  ECC5 0056                            LDB,B6   86,B5
          1 0005FF  CCC7 000F                            LDB,B4   T$,AUTO
          1 000601  EFC4 0006                            STB,B6   6,B4

      706    23527    4                    IF KZ$3270DEV.DFRTL$~=ADDR(NIL) THEN

  23527   1 000603  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000605  8DC6 000E                            CMN      14,B6
          1 000607  0901 0008                            BE       s:23530,PREL

      707    23528    4                       KZ$3270DEV.DFRTL$->KZ$INPBFR.LNK$=T$;

  23528   1 000609  CCC6 000E                            LDB,B4   14,B6
          1 00060B  BCC7 000F                            LDB,B3   T$,AUTO
          1 00060D  BF84                                 STB,B3   ,B4
          1 00060E  0F81 0005                            B        s:23531,PREL

      708    23529    4                    ELSE
      709    23530    4                       KZ$3270DEV.DFRHD$=T$;

  23530   1 000610  CCC7 000F                            LDB,B4   T$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:147  
          1 000612  CFC6 000C                            STB,B4   12,B6

      710    23531    4                    KZ$3270DEV.DFRTL$=T$;

  23531   1 000614  CCC7 000F                            LDB,B4   T$,AUTO
          1 000616  CFC6 000E                            STB,B4   14,B6

      711    23532    4                    KZ$LINCTX.INPBFR$=ADDR(NIL);

  23532   1 000618  BB80 0000 0000                       LAB,B3   0
          1 00061B  BFC5 0056                            STB,B3   86,B5

      712    23533    4                    IF LINSTAT&%KZ#LINSTAT_LAST THEN

  23533   1 00061D  CCC7 0006                            LDB,B4   @PARAMETER2,AUTO
          1 00061F  D804                                 LDR,R5   ,B4
          1 000620  D570 4000                            AND,R5   16384,IMO
          1 000622  5901 000A                            BEZ,R5   s:23536,PREL

      713    23534    4                       T$->KZ$INPBFR.DATA_SIZ=T$->KZ$INPBFR.DATA_SIZ+2;

  23534   1 000624  ACC7 000F                            LDB,B2   T$,AUTO
          1 000626  D842 0003                            LDR,R5   3,B2
          1 000628  5E02                                 ADV,R5   2
          1 000629  DF42 0003                            STR,R5   3,B2
          1 00062B  0F81 0047                            B        s:23555,PREL

      714    23535    4                    ELSE
      715    23536    4                       T$->KZ$INPBFR.FLAGS.CTN#='1'B;

  23536   1 00062D  ACC7 000F                            LDB,B2   T$,AUTO
          1 00062F  8942 0002                            LBT,'0020'X       2,B2
          1 000631       0020

      716    23537    4                    END;

  23537   1 000632  0F81 0040                            B        s:23555,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:148  

      717    23538    4                 ELSE DO;

      718    23539    4                    KV$VDH_DAT=KV_VDH_DAT;

  23539   1 000634  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_DAT
          1 000637  2C00                                 LDV,R2   0
          1 000638  6C10                                 LDV,R6   16
          1 000639  BB87                                 LAB,B3   ,AUTO
          1 00063A  3C7A                                 LDV,R3   122
          1 00063B  0008                                 MMM

      719    23540    4                    KV$VDH_DAT.DAT__.ADR$=KZ$LINCTX.INPBFR$;

  23540   1 00063C  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 00063E  DCC6 0056                            LDB,B5   86,B6
          1 000640  DFC7 003E                            STB,B5   KV$VDH_DAT+1,AUTO

      720    23541    4                    KV$VDH_DAT.DAT__.BYTX=J;

  23541   1 000642  E847 0014                            LDR,R6   J,AUTO
          1 000644  EF47 0040                            STR,R6   KV$VDH_DAT+3,AUTO

      721    23542    4                    KV$VDH_DAT.DAT__.DATBYTSIZ=KZ$LINCTX.INPDATSIZ-J+2;

  23542   1 000646  E246 0059                            SUB,R6   89,B6
          1 000648  8256                                 NEG      R6
          1 000649  6E02                                 ADV,R6   2
          1 00064A  EF47 0041                            STR,R6   KV$VDH_DAT+4,AUTO

      722    23543    4                    IF NOT LINSTAT&%KZ#LINSTAT_LAST THEN

  23543   1 00064C  CCC7 0006                            LDB,B4   @PARAMETER2,AUTO
          1 00064E  D804                                 LDR,R5   ,B4
          1 00064F  D570 4000                            AND,R5   16384,IMO
          1 000651  5981 0007                            BNEZ,R5  s:23549,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:149  
      723    23544    5                    DO;

      724    23545    5                       KV$VDH_DAT.CTN='1'B;

  23545   1 000653  8947 003D                            LBT,'0040'X       KV$VDH_DAT,AUTO
  23545   1 000655       0040

      725    23546    5                       KV$VDH_DAT.DAT__.DATBYTSIZ=

  23546   1 000656  6EFE                                 ADV,R6   -2
          1 000657  EF47 0041                            STR,R6   KV$VDH_DAT+4,AUTO

      726    23547    5                         KV$VDH_DAT.DAT__.DATBYTSIZ-2;
      727    23548    5                       END;

      728    23549    4                    KZ$3270DEV.MUST_SBA='1'B;

  23549   1 000659  ACC7 000D                            LDB,B2   DEV$,AUTO
          1 00065B  8942 001A                            LBT,'0010'X       26,B2
          1 00065D       0010

      729    23550    4                    CALL KVV$VDI(KV$VDH_DAT);

  23550   1 00065E  DBC7 003D                            LAB,B5   KV$VDH_DAT,AUTO
          1 000660  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 000662  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000664  CBF0 0100                            LAB,B4   256,IMO
          1 000666  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000669       0001                            DC       s:23551,PREL

      730    23551    4                    CALL EXIT_VDH (KZ$3270DEV.VDI$);

  23551   1 00066A  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00066C  DBC6 0004                            LAB,B5   4,B6
          1 00066E  DFC7 007A                            STB,B5   I+4,AUTO
          1 000670  E3C0 112B                            LNJ,B6   s:0,PREL
          1 000672       0001                            DC       s:23555,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:150  

      731    23552    4                    END;

      732    23553    3                 END;

      733    23554
      734    23555    2              GOTO XIT;

  23555   1 000673  0F81 0536                            B        s:23943,PREL

      735    23556        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:151  
      736    23557        /*
      737    23558                    CONTROLLER RESPONDED TO POLLING -
      738    23559                       MAKE SURE THE CONTROLLER TIMEOUT BIT IS RESET.
      739    23560        */
      740    23561    2            CASE(%KZ#LINFCN_POLL_ANSWERED);

      741    23562
      742    23563    2              IF KZ$LINCTX.CTRLST$ ~= ADDR(NIL) THEN

  23563   1 000675  8DC3 0068                            CMN      104,B3
          1 000677  0901 000B                            BE       s:23566,PREL

      743    23564    2                 KZ$LINCTX.CTRLST$->P$(KZ$LINCTX.POLX)->

  23564   1 000679  ACC3 0068                            LDB,B2   104,B3
          1 00067B  9843 006C                            LDR,R1   108,B3
          1 00067D  9570 00FF                            AND,R1   255,IMO
          1 00067F  9C92                                 LDB,B1   ,B2,R1
          1 000680  8841 000A                            LBF,'0080'X       10,B1
          1 000682       0080

      744    23565    2                   KZ$3270CTR.TIMED_OUT_ONCE = '0'B;
      745    23566    2              RETURN;

  23566   1 000683  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      746    23567        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:152  
      747    23568        /* General Poll Time-out */
      748    23569
      749    23570    2            CASE(%KZ#LINFCN_POLTIMOUT);

      750    23571
      751    23572    2              DEV$=ADDR(NIL);

  23572   1 000686  AB80 0000 0000                       LAB,B2   0
          1 000689  AFC7 000D                            STB,B2   DEV$,AUTO

      752    23573    2              CALL REQUEUE;

  23573   1 00068B  E3C0 0934                            LNJ,B6   s:0,PREL
          1 00068D       0001                            DC       s:23574,PREL

      753    23574    3              IF KZ$LINCTX.CURCTR$=ADDR(NIL) THEN DO;

  23574   1 00068E  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000690  8DC6 004E                            CMN      78,B6
          1 000692  0981 0027                            BNE      s:23591,PREL

      754    23575    3                 CTR$ = KZ$LINCTX.CTRLST$->P$(KZ$LINCTX.POLX);

  23575   1 000694  DCC6 0068                            LDB,B5   104,B6
          1 000696  B846 006C                            LDR,R3   108,B6
          1 000698  B570 00FF                            AND,R3   255,IMO
          1 00069A  CCB5                                 LDB,B4   ,B5,R3
          1 00069B  CFC7 000B                            STB,B4   CTR$,AUTO

      755    23576    3                 KZ$LINCTX.CURDEV$=ADDR(NIL);

  23576   1 00069D  BB80 0000 0000                       LAB,B3   0
          1 0006A0  BFC6 0050                            STB,B3   80,B6

      756    23577    3                 IF KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)~=0 THEN

  23577   1 0006A2  ACC6 0066                            LDB,B2   102,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:153  
          1 0006A4  E2B2                                 LLH,R6   ,B2,R3
          1 0006A5  6901 0022                            BEZ,R6   s:23598,PREL

      757    23578    4                 DO;                       /* This controller was active         */

      758    23579    4                    IF NOT KZ$3270CTR.TIMED_OUT_ONCE THEN

  23579   1 0006A7  82C4 000A                            LB,'0080'X        10,B4
  23579   1 0006A9       0080
          1 0006AA  0501 0007                            BBT      s:23585,PREL

      759    23580    5                    DO;               /* This is the controllers first time out  */

      760    23581    5                       KZ$3270CTR.TIMED_OUT_ONCE = '1'B;

  23581   1 0006AC  8944 000A                            LBT,'0080'X       10,B4
  23581   1 0006AE       0080

      761    23582    5                       RETURN;             /* We'll give it another chance       */

  23582   1 0006AF  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      762    23583    5                       END;
      763    23584    5                    ELSE DO;               /* Alter its status to inactive.      */

      764    23585    5                       KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)=0;

  23585   1 0006B2  87B2                                 CLH      ,B2,R3

      765    23586    5                       KZ$LINCTX.ACTCTR=KZ$LINCTX.ACTCTR-1;

  23586   1 0006B3  E2C6 006D                            LLH,R6   109,B6
          1 0006B5  6EFF                                 ADV,R6   -1
          1 0006B6  E7C6 006D                            STH,R6   109,B6

      766    23587    5                       END;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:154  
      767    23588    4                    END;

      768    23589    3                 END;

  23589   1 0006B8  0F81 000F                            B        s:23598,PREL

      769    23590    3              ELSE DO;

      770    23591    3                 CTR$=KZ$LINCTX.CURCTR$;

  23591   1 0006BA  DCC6 004E                            LDB,B5   78,B6
          1 0006BC  DFC7 000B                            STB,B5   CTR$,AUTO

      771    23592    4                 IF KZ$LINCTX.CURDEV$~=ADDR(NIL) THEN DO;

  23592   1 0006BE  8DC6 0050                            CMN      80,B6
          1 0006C0  0901 0007                            BE       s:23598,PREL

      772    23593    4                    DEV$=KZ$LINCTX.CURDEV$;

  23593   1 0006C2  CCC6 0050                            LDB,B4   80,B6
          1 0006C4  CFC7 000D                            STB,B4   DEV$,AUTO

      773    23594    4                    GOTO POLTO4;

  23594   1 0006C6  0F81 0009                            B        s:23601,PREL

      774    23595    4                    END;
      775    23596    3                 END;
      776    23597    2   POLTO2:
      777    23598    2              DEV$=KZ$3270CTR.DEVHD$;

  23598   1 0006C8  ECC7 000B            POLTO2          LDB,B6   CTR$,AUTO
          1 0006CA  DCC6 0002                            LDB,B5   2,B6
          1 0006CC  DFC7 000D                            STB,B5   DEV$,AUTO

      778    23599    3              DO WHILE(DEV$~=ADDR(NIL));
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:155  

  23599   1 0006CE  0F81 001F                            B        s:23609,PREL

      779    23600    3   POLTO4:
      780    23601    4                 IF KZ$3270DEV.ACTIVE THEN DO;

  23601   1 0006D0  ECC7 000D            POLTO4          LDB,B6   DEV$,AUTO
          1 0006D2  82C6 0012                            LB,'4000'X        18,B6
          1 0006D4       4000
          1 0006D5  0581 000C                            BBF      s:23606,PREL

      781    23602    4                    KZ$3270DEV.ACTIVE='0'B;

  23602   1 0006D7  8846 0012                            LBF,'4000'X       18,B6
  23602   1 0006D9       4000

      782    23603    4                    CALL DSC_DEV(%KV_DSCRSN_HRDERR);

  23603   1 0006DA  DBF0 0004                            LAB,B5   4,IMO
          1 0006DC  DFC7 0070                            STB,B5   CP_PHLEGM+5,AUTO
          1 0006DE  E3C0 0BC2                            LNJ,B6   s:0,PREL
          1 0006E0       0001                            DC       s:23604,PREL

      783    23604    4                    GOTO POLTO2;

  23604   1 0006E1  0FE7                                 B        s:23598,SPREL

      784    23605    4                    END;
      785    23606    3                 IF KZ$LINCTX.CURDEV$~=ADDR(NIL) THEN

  23606   1 0006E2  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0006E4  8DC5 0050                            CMN      80,B5
          1 0006E6  0901 0004                            BE       s:23608,PREL

      786    23607    3                    RETURN;

  23607   1 0006E8  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:156  

      787    23608    3                 DEV$=KZ$3270DEV.LNK$;

  23608   1 0006EB  CC86                                 LDB,B4   ,B6
          1 0006EC  CFC7 000D                            STB,B4   DEV$,AUTO

      788    23609    3                 END;

  23609   1 0006EE  8DC7 000D                            CMN      DEV$,AUTO
          1 0006F0  09E0                                 BNE      s:23601,SPREL

      789    23610    2              RETURN;

  23610   1 0006F1  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      790    23611
      791    23612        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:157  
      792    23613        /* Disconnect Channels */
      793    23614
      794    23615    2            CASE(%KZ#LINFCN_DSCTRM,

      795    23616    2                %KZ#LINFCN_KILL);
      796    23617
      797    23618    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);

  23618   1 0006F4  ACC4 0005                            LDB,B2   5,B4
          1 0006F6  9802                                 LDR,R1   ,B2
          1 0006F7  9570 00FF                            AND,R1   255,IMO
          1 0006F9  1D04                                 CMV,R1   4
          1 0006FA  0281 04AF                            BGE      s:23943,PREL
          1 0006FC  B810 0000 0702  01                   LDR,R3   s:23618+14,R1
          1 0006FF  83B0 0000 0706  01                   JMP      s:23621,R3
          1 000702       00CC                            DC       s:23673,PREL
          1 000703       0000                            DC       s:23621,PREL
          1 000704       0056                            DC       s:23647,PREL
          1 000705       009B                            DC       s:23667,PREL

      798    23619
      799    23620    3               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */

      800    23621    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_CHAN#;

  23621   1 000706  6C01                                 LDV,R6   1
          1 000707  EAC3 0085                            SRM,R6,'00FF'X    133,B3
          1 000709       00FF

      801    23622    3                 CALL REQUEUE;

  23622   1 00070A  E3C0 08B5                            LNJ,B6   s:0,PREL
          1 00070C       0001                            DC       s:23623,PREL

      802    23623    3                 CTR$=KZ$LINCTX.CTRHD$;

  23623   1 00070D  ECC7 0009                            LDB,B6   LIN$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:158  
          1 00070F  DC86                                 LDB,B5   ,B6
          1 000710  DFC7 000B                            STB,B5   CTR$,AUTO

      803    23624    3                 IF CTR$=ADDR(NIL) THEN

  23624   1 000712  8DC7 000B                            CMN      CTR$,AUTO
          1 000714  0981 0006                            BNE      s:23627,PREL

      804    23625    3                    CALL RLS_LINE;

  23625   1 000716  E3C0 09E7                            LNJ,B6   s:0,PREL
          1 000718       0001                            DC       s:23625+3,PREL
          1 000719  0F81 0490                            B        s:23943,PREL

      805    23626    3                 ELSE
      806    23627    4                 DO WHILE(CTR$~=ADDR(NIL));

  23627   1 00071B  0F81 003B                            B        s:23644,PREL

      807    23628    4                    TCTR$=KZ$3270CTR.LNK$;

  23628   1 00071D  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 00071F  DC86                                 LDB,B5   ,B6
          1 000720  DFC7 001C                            STB,B5   TCTR$,AUTO

      808    23629    4                    DEV$=KZ$3270CTR.DEVHD$;

  23629   1 000722  CCC6 0002                            LDB,B4   2,B6
          1 000724  CFC7 000D                            STB,B4   DEV$,AUTO

      809    23630    4                    IF DEV$=ADDR(NIL) THEN

  23630   1 000726  8DC7 000D                            CMN      DEV$,AUTO
          1 000728  0981 0006                            BNE      s:23633,PREL

      810    23631    4                       CALL RLS_CTR;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:159  
  23631   1 00072A  E3C0 098F                            LNJ,B6   s:0,PREL
          1 00072C       0001                            DC       s:23631+3,PREL
          1 00072D  0F81 0025                            B        s:23643,PREL

      811    23632    4                    ELSE
      812    23633    5                    DO WHILE(DEV$~=ADDR(NIL));

  23633   1 00072F  0F81 0020                            B        s:23642,PREL

      813    23634    5                       TDEV$=KZ$3270DEV.LNK$;

  23634   1 000731  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000733  DC86                                 LDB,B5   ,B6
          1 000734  DFC7 001E                            STB,B5   TDEV$,AUTO

      814    23635    6                       IF KZ$3270DEV.ACTIVE THEN DO;

  23635   1 000736  82C6 0012                            LB,'4000'X        18,B6
  23635   1 000738       4000
          1 000739  0581 000F                            BBF      s:23640,PREL

      815    23636    6                          KZ$3270DEV.ACTIVE='0'B;

  23636   1 00073B  8846 0012                            LBF,'4000'X       18,B6
  23636   1 00073D       4000

      816    23637    6                          CALL DSC_DEV(KZ$LINCTX.DSCRSN);

  23637   1 00073E  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 000740  BBC4 0038                            LAB,B3   56,B4
          1 000742  BFC7 0070                            STB,B3   CP_PHLEGM+5,AUTO
          1 000744  E3C0 0B5C                            LNJ,B6   s:0,PREL
          1 000746       0001                            DC       s:23638,PREL

      817    23638    6                          END;

  23638   1 000747  0F81 0004                            B        s:23641,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:160  

      818    23639    5                       ELSE
      819    23640    5                          CALL RLS_DEV;

  23640   1 000749  E3C0 08FD                            LNJ,B6   s:0,PREL
          1 00074B       0001                            DC       s:23641,PREL

      820    23641    5                       DEV$=TDEV$;

  23641   1 00074C  ECC7 001E                            LDB,B6   TDEV$,AUTO
          1 00074E  EFC7 000D                            STB,B6   DEV$,AUTO

      821    23642    5                       END;

  23642   1 000750  8DC7 000D                            CMN      DEV$,AUTO
          1 000752  09DF                                 BNE      s:23634,SPREL

      822    23643    4                    CTR$=TCTR$;

  23643   1 000753  ECC7 001C                            LDB,B6   TCTR$,AUTO
          1 000755  EFC7 000B                            STB,B6   CTR$,AUTO

      823    23644    4                    END;

  23644   1 000757  8DC7 000B                            CMN      CTR$,AUTO
          1 000759  09C4                                 BNE      s:23628,SPREL
          1 00075A  0F81 044F                            B        s:23943,PREL

      824    23645
      825    23646    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */

      826    23647    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_SUBCHAN#;

  23647   1 00075C  6C02                                 LDV,R6   2
          1 00075D  EAC3 0085                            SRM,R6,'00FF'X    133,B3
          1 00075F       00FF

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:161  
      827    23648    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;

  23648   1 000760  ACC4 0005                            LDB,B2   5,B4
          1 000762  D842 0002                            LDR,R5   2,B2
          1 000764  DF47 0013                            STR,R5   CNT,AUTO

      828    23649    3                 CALL FND_CTR ALTRET(NONE);

  23649   1 000766  E3C0 05C1                            LNJ,B6   s:0,PREL
          1 000768       006A                            DC       s:23673,PREL

      829    23650    3                 CALL REQUEUE;

  23650   1 000769  E3C0 0856                            LNJ,B6   s:0,PREL
          1 00076B       0001                            DC       s:23651,PREL

      830    23651    3                 DEV$=KZ$3270CTR.DEVHD$;

  23651   1 00076C  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 00076E  DCC6 0002                            LDB,B5   2,B6
          1 000770  DFC7 000D                            STB,B5   DEV$,AUTO

      831    23652    3                 IF DEV$=ADDR(NIL) THEN

  23652   1 000772  8DC7 000D                            CMN      DEV$,AUTO
          1 000774  0981 0006                            BNE      s:23655,PREL

      832    23653    3                    CALL RLS_CTR;

  23653   1 000776  E3C0 0943                            LNJ,B6   s:0,PREL
          1 000778       0001                            DC       s:23653+3,PREL
          1 000779  0F81 0430                            B        s:23943,PREL

      833    23654    3                 ELSE
      834    23655    4                 DO WHILE(DEV$~=ADDR(NIL));

  23655   1 00077B  0F81 0020                            B        s:23664,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:162  

      835    23656    4                    TDEV$=KZ$3270DEV.LNK$;

  23656   1 00077D  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00077F  DC86                                 LDB,B5   ,B6
          1 000780  DFC7 001E                            STB,B5   TDEV$,AUTO

      836    23657    5                    IF KZ$3270DEV.ACTIVE THEN DO;

  23657   1 000782  82C6 0012                            LB,'4000'X        18,B6
  23657   1 000784       4000
          1 000785  0581 000F                            BBF      s:23662,PREL

      837    23658    5                       KZ$3270DEV.ACTIVE='0'B;

  23658   1 000787  8846 0012                            LBF,'4000'X       18,B6
  23658   1 000789       4000

      838    23659    5                       CALL DSC_DEV(KZ$LINCTX.DSCRSN);

  23659   1 00078A  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 00078C  BBC4 0038                            LAB,B3   56,B4
          1 00078E  BFC7 0070                            STB,B3   CP_PHLEGM+5,AUTO
          1 000790  E3C0 0B10                            LNJ,B6   s:0,PREL
          1 000792       0001                            DC       s:23660,PREL

      839    23660    5                       END;

  23660   1 000793  0F81 0004                            B        s:23663,PREL

      840    23661    4                    ELSE
      841    23662    4                       CALL RLS_DEV;

  23662   1 000795  E3C0 08B1                            LNJ,B6   s:0,PREL
          1 000797       0001                            DC       s:23663,PREL

      842    23663    4                    DEV$=TDEV$;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:163  

  23663   1 000798  ECC7 001E                            LDB,B6   TDEV$,AUTO
          1 00079A  EFC7 000D                            STB,B6   DEV$,AUTO

      843    23664    4                    END;

  23664   1 00079C  8DC7 000D                            CMN      DEV$,AUTO
          1 00079E  09DF                                 BNE      s:23656,SPREL
          1 00079F  0F81 040A                            B        s:23943,PREL

      844    23665
      845    23666    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */

      846    23667    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_SUBSUBCHAN#;

  23667   1 0007A1  6C03                                 LDV,R6   3
          1 0007A2  EAC3 0085                            SRM,R6,'00FF'X    133,B3
          1 0007A4       00FF

      847    23668    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;

  23668   1 0007A5  ACC4 0005                            LDB,B2   5,B4
          1 0007A7  D842 0002                            LDR,R5   2,B2
          1 0007A9  DF47 0013                            STR,R5   CNT,AUTO

      848    23669    3                 J=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBSUBDEVICE;

  23669   1 0007AB  ACC4 0005                            LDB,B2   5,B4
          1 0007AD  C842 0003                            LDR,R4   3,B2
          1 0007AF  CF47 0014                            STR,R4   J,AUTO

      849    23670    3                 CALL FND_CTR ALTRET(NONE);

  23670   1 0007B1  E3C0 0576                            LNJ,B6   s:0,PREL
          1 0007B3       001F                            DC       s:23673,PREL

      850    23671    3                 CALL FND_DEV ALTRET(NONE);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:164  

  23671   1 0007B4  E3C0 059F                            LNJ,B6   s:0,PREL
          1 0007B6       001C                            DC       s:23673,PREL

      851    23672    3                 CALL REQUEUE;

  23672   1 0007B7  E3C0 0808                            LNJ,B6   s:0,PREL
          1 0007B9       0001                            DC       s:23673,PREL

      852    23673    4                 IF KZ$3270DEV.ACTIVE THEN DO;

  23673   1 0007BA  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0007BC  82C6 0012                            LB,'4000'X        18,B6
          1 0007BE       4000
          1 0007BF  0581 000F                            BBF      s:23678,PREL

      853    23674    4                    KZ$3270DEV.ACTIVE='0'B;

  23674   1 0007C1  8846 0012                            LBF,'4000'X       18,B6
  23674   1 0007C3       4000

      854    23675    4                    CALL DSC_DEV(KZ$LINCTX.DSCRSN);

  23675   1 0007C4  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0007C6  CBC5 0038                            LAB,B4   56,B5
          1 0007C8  CFC7 0070                            STB,B4   CP_PHLEGM+5,AUTO
          1 0007CA  E3C0 0AD6                            LNJ,B6   s:0,PREL
          1 0007CC       0001                            DC       s:23676,PREL

      855    23676    4                    END;

  23676   1 0007CD  0F81 0004                            B        s:23673,PREL

      856    23677    3                 ELSE
      857    23678    3                    CALL RLS_DEV;

  23678   1 0007CF  E3C0 0877                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:165  
          1 0007D1       0001                            DC       s:23673,PREL

  23673   1                              NONE            null
      858    23679    3   NONE:         ;
      859    23680    3               END;

  23680   1 0007D2  0F81 03D7            NONE            B        s:23943,PREL

      860    23681        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:166  
      861    23682        /* Controller Present */
      862    23683
      863    23684    2            CASE(%KZ#LINFCN_NEWCTR);

      864    23685
      865    23686    3              IF KZ$LINCTX.OTPCTR$=ADDR(NIL) THEN DO;

  23686   1 0007D4  8DC3 005E                            CMN      94,B3
          1 0007D6  0981 0013                            BNE      s:23691,PREL

      866    23687    3                 KZ$LINCTX.CURCTR$=KZ$LINCTX.CTRLST$->P$(KZ$LINCTX.POLX);

  23687   1 0007D8  ACC3 0068                            LDB,B2   104,B3
          1 0007DA  9843 006C                            LDR,R1   108,B3
          1 0007DC  9570 00FF                            AND,R1   255,IMO
          1 0007DE  9C92                                 LDB,B1   ,B2,R1
          1 0007DF  9FC3 004E                            STB,B1   78,B3

      867    23688    3                 KZ$LINCTX.OTPCTR$=KZ$LINCTX.CURCTR$;

  23688   1 0007E1  9FC3 005E                            STB,B1   94,B3

      868    23689    3                 KZ$LINCTX.OTPDEV$=ADDR(NIL);

  23689   1 0007E3  EB80 0000 0000                       LAB,B6   0
          1 0007E6  EFC3 0062                            STB,B6   98,B3

      869    23690    3                 END;

  23690   1 0007E8  0F81 0005                            B        s:23692,PREL

      870    23691    2              ELSE KZ$LINCTX.CURCTR$=KZ$LINCTX.OTPCTR$;

  23691   1 0007EA  ACC3 005E                            LDB,B2   94,B3
          1 0007EC  AFC3 004E                            STB,B2   78,B3

      871    23692    2              GOTO CTRLOOP;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:167  

  23692   1 0007EE  0F81 F85D                            B        s:23111,PREL

      872    23693        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:168  
      873    23694        /* Build Controller and Device Context */
      874    23695
      875    23696    2            CASE(%KZ#LINFCN_BLDCTX);

      876    23697
      877    23698    3              IF KZ_VDHSTT$=ADDR(NIL) THEN DO;

  23698   1 0007F0  8D80 0000 0000  xsym                 CMN      KZ_VDHSTT$
          1 0007F3  0981 00B4                            BNE      s:23736,PREL

      878    23699
      879    23700                                                /* INIT VDH STAT BUFFER               */
      880    23701                      %DISABLE(INHLVL=KH_INHLVL);

  23702   1 0007F5  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 0007F8  EF47 006A                            STR,R6   DISABLE_LEVEL,AUTO

  23703   1 0007FA  ABC7 006A                            LAB,B2   DISABLE_LEVEL,AUTO
          1 0007FC  AFC7 0092                            STB,B2   @DFRD+22,AUTO
          1 0007FE  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000800  CBF0 0100                            LAB,B4   256,IMO
          1 000802  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 000805       0001                            DC       s:23705,PREL

      881    23705    3                 SZ=SIZEW(KV$STT);

  23705   1 000806  E870 0230                            LDR,R6   560,IMO
          1 000808  EF47 001B                            STR,R6   SZ,AUTO

      882    23706    3                 CALL KVB$GETSYS(SZ,KZ_VDHSTT$) ALTRET(NO_MEMORY);

  23706   1 00080A  EB80 0000 0000  xsym                 LAB,B6   KZ_VDHSTT$
          1 00080D  EFC7 0094                            STB,B6   @DFRD+24,AUTO
          1 00080F  DBC7 001B                            LAB,B5   SZ,AUTO
          1 000811  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 000813  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000815  CBF0 0200                            LAB,B4   512,IMO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:169  
          1 000817  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 00081A       03A0                            DC       s:23953,PREL

      883    23707    3                 KV$STT='0'B;

  23707   1 00081B  AB80 0000 0000  02                   LAB,B2   0
          1 00081E  2C00                                 LDV,R2   0
          1 00081F  6C01                                 LDV,R6   1
          1 000820  BC80 0000 0000  xsym                 LDB,B3   KZ_VDHSTT$
          1 000823  3C00                                 LDV,R3   0
          1 000824  F870 0460                            LDR,R7   1120,IMO
          1 000826  D380 0000 0000  xent                 LNJ,B5   X6C_ALRZ

      884    23708    3                 KV$STT.REQSTATS.FNC=%IGA_REQSTATS;

  23708   1 000829  6C24                                 LDV,R6   36
          1 00082A  EC80 0000 0000  xsym                 LDB,B6   KZ_VDHSTT$
          1 00082D  E786                                 STH,R6   ,B6

      885    23709    3                 KV$STT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;

  23709   1 00082E  EC80 0000 0000  xsym                 LDB,B6   KZ_VDHSTT$
          1 000831  8946 0012                            LBT,'0020'X       18,B6
          1 000833       0020

      886    23710    3                 KV$STT.REQSTATS.SLCENT(%KH#ENTID_3270)='1'B;

  23710   1 000834  8946 0012                            LBT,'0200'X       18,B6
  23710   1 000836       0200

      887    23711    3                 KV$STT.REQSTATS.DSPENT(%KH#ENTID_VDH)='1'B;

  23711   1 000837  8946 0010                            LBT,'0020'X       16,B6
  23711   1 000839       0020

      888    23712
      889    23713                                                /* INIT 3270 STAT BUFFER              */
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:170  
      890    23714    3                 SZ=SIZEW(KZ$3270STT);

  23714   1 00083A  D870 00A6                            LDR,R5   166,IMO
          1 00083C  DF47 001B                            STR,R5   SZ,AUTO

      891    23715    3                 CALL KVB$GETSYS(SZ,KZ_3270M_HDR.STTBFR$) ALTRET(NO_MEMORY);

  23715   1 00083E  DB80 0000 0006  xsym                 LAB,B5   KZ_3270M_HDR+6
          1 000841  DFC7 0094                            STB,B5   @DFRD+24,AUTO
          1 000843  CBC7 001B                            LAB,B4   SZ,AUTO
          1 000845  CFC7 0092                            STB,B4   @DFRD+22,AUTO
          1 000847  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000849  CBF0 0200                            LAB,B4   512,IMO
          1 00084B  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 00084E       036C                            DC       s:23953,PREL

      892    23716    3                 KZ$3270STT='0'B;

  23716   1 00084F  AB80 0000 0000  02                   LAB,B2   0
          1 000852  2C00                                 LDV,R2   0
          1 000853  6C01                                 LDV,R6   1
          1 000854  BC80 0000 0006  xsym                 LDB,B3   KZ_3270M_HDR+6
          1 000857  3C00                                 LDV,R3   0
          1 000858  F870 014C                            LDR,R7   332,IMO
          1 00085A  D380 0000 0000  xent                 LNJ,B5   X6C_ALRZ

      893    23717    3                 KZ$3270STT.REQSTATS.FNC=%IGA_REQSTATS;

  23717   1 00085D  6C24                                 LDV,R6   36
          1 00085E  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 000861  E786                                 STH,R6   ,B6

      894    23718    3                 KZ$3270STT.REQSTATS.DSPENT(%KH#ENTID_3270)='1'B;

  23718   1 000862  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 000865  8946 0010                            LBT,'0200'X       16,B6
          1 000867       0200
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:171  

      895    23719    3                 KZ$3270STT.REQSTATS.SLCENT(%KH#ENTID_3270)='1'B;

  23719   1 000868  8946 0012                            LBT,'0200'X       18,B6
  23719   1 00086A       0200

      896    23720    3                 KZ$3270STT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;

  23720   1 00086B  8946 0012                            LBT,'0020'X       18,B6
  23720   1 00086D       0020

      897    23721
      898    23722                                                /* INIT 3270 USRPRM                   */
      899    23723    3                 SZ=SIZEW(KV$USRPRM);

  23723   1 00086E  5C39                                 LDV,R5   57
          1 00086F  DF47 001B                            STR,R5   SZ,AUTO

      900    23724    3                 CALL KVB$GETSYS(SZ,KZT_USRPRM$) ALTRET(NO_MEMORY);

  23724   1 000871  DB80 0000 0000  xsym                 LAB,B5   KZT_USRPRM$
          1 000874  DFC7 0094                            STB,B5   @DFRD+24,AUTO
          1 000876  CBC7 001B                            LAB,B4   SZ,AUTO
          1 000878  CFC7 0092                            STB,B4   @DFRD+22,AUTO
          1 00087A  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 00087C  CBF0 0200                            LAB,B4   512,IMO
          1 00087E  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 000881       0339                            DC       s:23953,PREL

      901    23725                      %ENABLE(INHLVL=KH_INHLVL);

  23726   1 000882  E847 006A                            LDR,R6   DISABLE_LEVEL,AUTO
          1 000884  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          1 000887  0901 0007                            BE       s:23731,PREL

  23728   1 000889  CBF0 0000                            LAB,B4   0,IMO
          1 00088B  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:172  
          1 00088E       0001                            DC       s:23731,PREL

      902    23731    3                 KZT_USRPRM$->KV$USRPRM=KZ_USRPRM;

  23731   1 00088F  AB80 0000 0083  00                   LAB,B2   KZ_USRPRM
          1 000892  2C00                                 LDV,R2   0
          1 000893  6C72                                 LDV,R6   114
          1 000894  BC80 0000 0000  xsym                 LDB,B3   KZT_USRPRM$
          1 000897  3C00                                 LDV,R3   0
          1 000898  0008                                 MMM

      903    23732    3                 KZT_USRPRM$->KV$USRPRM.INHLVL=KH_INHLVL;

  23732   1 000899  EC80 0000 0000  xsym                 LDB,B6   KZT_USRPRM$
          1 00089C  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 00089F  EF06                                 STR,R6   ,B6

      904    23733    3                 KZT_USRPRM$->KV$USRPRM.STT$=KZ_VDHSTT$;

  23733   1 0008A0  EC80 0000 0000  xsym                 LDB,B6   KZ_VDHSTT$
          1 0008A3  DC80 0000 0000  xsym                 LDB,B5   KZT_USRPRM$
          1 0008A6  EFC5 0033                            STB,B6   51,B5

      905    23734    3                 END;

      906    23735
      907    23736    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);

  23736   1 0008A8  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 0008AA  DCC6 0005                            LDB,B5   5,B6
          1 0008AC  B805                                 LDR,R3   ,B5
          1 0008AD  B570 00FF                            AND,R3   255,IMO
          1 0008AF  3D04                                 CMV,R3   4
          1 0008B0  0281 02F9                            BGE      s:23943,PREL
          1 0008B2  A830 0000 08B8  01                   LDR,R2   s:23736+16,R3
          1 0008B5  83A0 0000 08BC  01                   JMP      s:23739,R2
          1 0008B8       010C                            DC       s:23783,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:173  
          1 0008B9       010C                            DC       s:23783,PREL
          1 0008BA       0000                            DC       s:23739,PREL
          1 0008BB       0084                            DC       s:23759,PREL

      908    23737    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */

      909    23738
      910    23739    3                 KZ$LINCTX.POLSIZ=KZ$LINCTX.POLSIZ+1; /* # controllers to poll   */

  23739   1 0008BC  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 0008BE  8AC4 0065                            INC      101,B4

      911    23740    3                 CTR$=KZ$LINCTX.CTRHD$;    /* See if CTR already present         */

  23740   1 0008C0  DC84                                 LDB,B5   ,B4
          1 0008C1  DFC7 000B                            STB,B5   CTR$,AUTO

      912    23741    4                 DO WHILE(CTR$~=ADDR(NIL));

  23741   1 0008C3  0F81 0019                            B        s:23745,PREL

      913    23742    4                    IF KZ$3270CTR.ADR=KZ$EVENT.CHNCTX$->KL_CONTROLLER.CONT# THEN

  23742   1 0008C5  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 0008C7  8CC6 0001                            LDI      1,B6
          1 0008C9  B856                                 LDR,R3   R6
          1 0008CA  E570 7FFF                            AND,R6   32767,IMO
          1 0008CC  8D47 0092                            SDI      @DFRD+22,AUTO
          1 0008CE  DCC7 0092                            LDB,B5   @DFRD+22,AUTO
          1 0008D0  304F                                 SOR,R3   15
          1 0008D1  CCC7 000B                            LDB,B4   CTR$,AUTO
          1 0008D3  D2C4 000A                            LLH,R5   10,B4
          1 0008D5  3E08                                 ADV,R3   8
          1 0008D6  C2B5                                 LLH,R4   ,B5,R3
          1 0008D7  D954                                 CMR,R5   R4
          1 0008D8  0901 000A                            BE       s:23748,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:174  
      914    23743    4                       GOTO SETCTR;
      915    23744    4                    CTR$=KZ$3270CTR.LNK$;

  23744   1 0008DA  BC84                                 LDB,B3   ,B4
          1 0008DB  BFC7 000B                            STB,B3   CTR$,AUTO

      916    23745    4                    END;

  23745   1 0008DD  8DC7 000B                            CMN      CTR$,AUTO
          1 0008DF  09E6                                 BNE      s:23742,SPREL

      917    23746    3                 CALL BLD_CTR_CTX ALTRET(NO_MEMORY);

  23746   1 0008E0  E3C0 0521                            LNJ,B6   s:0,PREL
          1 0008E2       02D8                            DC       s:23953,PREL

      918    23747    3   SETCTR:
      919    23748    3                 KZ$3270CTR.ADR=KZ$EVENT.CHNCTX$->KL_CONTROLLER.CONT#;

  23748   1 0008E3  ECC7 0004            SETCTR          LDB,B6   @PARAMETER1,AUTO
          1 0008E5  8CC6 0001                            LDI      1,B6
          1 0008E7  B856                                 LDR,R3   R6
          1 0008E8  E570 7FFF                            AND,R6   32767,IMO
          1 0008EA  8D47 0092                            SDI      @DFRD+22,AUTO
          1 0008EC  DCC7 0092                            LDB,B5   @DFRD+22,AUTO
          1 0008EE  304F                                 SOR,R3   15
          1 0008EF  3E08                                 ADV,R3   8
          1 0008F0  D2B5                                 LLH,R5   ,B5,R3
          1 0008F1  CCC7 000B                            LDB,B4   CTR$,AUTO
          1 0008F3  D7C4 000A                            STH,R5   10,B4

      920    23749    3                 KZ$3270CTR.ROWS=KZ$EVENT.CHNCTX$->KL_CONTROLLER.ROWS;

  23749   1 0008F5  8CC6 0001                            LDI      1,B6
          1 0008F7  B856                                 LDR,R3   R6
          1 0008F8  E570 7FFF                            AND,R6   32767,IMO
          1 0008FA  8D47 0092                            SDI      @DFRD+22,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:175  
          1 0008FC  DCC7 0092                            LDB,B5   @DFRD+22,AUTO
          1 0008FE  304F                                 SOR,R3   15
          1 0008FF  3E09                                 ADV,R3   9
          1 000900  D2B5                                 LLH,R5   ,B5,R3
          1 000901  DAC4 0009                            SRM,R5,'00FF'X    9,B4
          1 000903       00FF

      921    23750    3                 KZ$3270CTR.COLS=KZ$EVENT.CHNCTX$->KL_CONTROLLER.COLUMNS;

  23750   1 000904  8CC6 0001                            LDI      1,B6
          1 000906  B856                                 LDR,R3   R6
          1 000907  E570 7FFF                            AND,R6   32767,IMO
          1 000909  8D47 0092                            SDI      @DFRD+22,AUTO
          1 00090B  DCC7 0092                            LDB,B5   @DFRD+22,AUTO
          1 00090D  304F                                 SOR,R3   15
          1 00090E  3E0A                                 ADV,R3   10
          1 00090F  D2B5                                 LLH,R5   ,B5,R3
          1 000910  D7C4 0009                            STH,R5   9,B4

      922    23751    3                 KZ$3270CTR.TYP=KZ$EVENT.CHNCTX$->KL_CONTROLLER.TYPE;

  23751   1 000912  8CC6 0001                            LDI      1,B6
          1 000914  B856                                 LDR,R3   R6
          1 000915  E570 7FFF                            AND,R6   32767,IMO
          1 000917  8D47 0092                            SDI      @DFRD+22,AUTO
          1 000919  DCC7 0092                            LDB,B5   @DFRD+22,AUTO
          1 00091B  304F                                 SOR,R3   15
          1 00091C  AB85                                 LAB,B2   ,B5
          1 00091D  A853                                 LDR,R2   R3
          1 00091E  2E0C                                 ADV,R2   12
          1 00091F  6C02                                 LDV,R6   2
          1 000920  BB84                                 LAB,B3   ,B4
          1 000921  3C10                                 LDV,R3   16
          1 000922  0008                                 MMM

      923    23752    3                 KZ$3270CTR.LIN$=LIN$;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:176  
  23752   1 000923  9CC7 0009                            LDB,B1   LIN$,AUTO
          1 000925  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 000927  9FC6 0004                            STB,B1   4,B6

      924    23753    3                 KZ$3270CTR.CHN$=KZ$EVENT.CHN$;

  23753   1 000929  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 00092B  DCC6 0007                            LDB,B5   7,B6
          1 00092D  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 00092F  DFC6 0006                            STB,B5   6,B6

      925    23754    3                 KZ$EVENT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_CONT#;

  23754   1 000931  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 000933  DCC6 0007                            LDB,B5   7,B6
          1 000935  6C09                                 LDV,R6   9
          1 000936  E7C5 0012                            STH,R6   18,B5

      926    23755    3                 KZ$EVENT.CHN$->KH$CHN.CTX$ = CTR$;

  23755   1 000938  DCC6 0007                            LDB,B5   7,B6
          1 00093A  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 00093C  EFC5 000C                            STB,B6   12,B5
          1 00093E  0F81 026B                            B        s:23943,PREL

      927    23756
      928    23757    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */

      929    23758
      930    23759    3                 I=KZ$EVENT.CHNCTX$->KL_LINEDEV.CONTROLLER#;

  23759   1 000940  8CC6 0001                            LDI      1,B6
          1 000942  9856                                 LDR,R1   R6
          1 000943  E570 7FFF                            AND,R6   32767,IMO
          1 000945  8D47 0092                            SDI      @DFRD+22,AUTO
          1 000947  DCC7 0092                            LDB,B5   @DFRD+22,AUTO
          1 000949  104F                                 SOR,R1   15
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:177  
          1 00094A  1E08                                 ADV,R1   8
          1 00094B  D295                                 LLH,R5   ,B5,R1
          1 00094C  DF47 0013                            STR,R5   CNT,AUTO

      931    23760    3                 J=KZ$EVENT.CHNCTX$->KL_LINEDEV.DEVICE#;

  23760   1 00094E  8CC6 0001                            LDI      1,B6
          1 000950  B856                                 LDR,R3   R6
          1 000951  E570 7FFF                            AND,R6   32767,IMO
          1 000953  8D47 0092                            SDI      @DFRD+22,AUTO
          1 000955  DCC7 0092                            LDB,B5   @DFRD+22,AUTO
          1 000957  304F                                 SOR,R3   15
          1 000958  3E09                                 ADV,R3   9
          1 000959  C2B5                                 LLH,R4   ,B5,R3
          1 00095A  CF47 0014                            STR,R4   J,AUTO

      932    23761    3                 CALL FND_CTR ALTRET(NO_CTRLR);

  23761   1 00095C  E3C0 03CB                            LNJ,B6   s:0,PREL
          1 00095E       006A                            DC       s:23783,PREL

      933    23762    3                 DEV$=KZ$3270CTR.DEVHD$;

  23762   1 00095F  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 000961  DCC6 0002                            LDB,B5   2,B6
          1 000963  DFC7 000D                            STB,B5   DEV$,AUTO

      934    23763    4                 DO WHILE(DEV$~=ADDR(NIL));

  23763   1 000965  0F81 0019                            B        s:23767,PREL

      935    23764    4                    IF KZ$3270DEV.ADR=KZ$EVENT.CHNCTX$->KL_LINEDEV.DEVICE# THEN

  23764   1 000967  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 000969  8CC6 0001                            LDI      1,B6
          1 00096B  B856                                 LDR,R3   R6
          1 00096C  E570 7FFF                            AND,R6   32767,IMO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:178  
          1 00096E  8D47 0092                            SDI      @DFRD+22,AUTO
          1 000970  DCC7 0092                            LDB,B5   @DFRD+22,AUTO
          1 000972  304F                                 SOR,R3   15
          1 000973  CCC7 000D                            LDB,B4   DEV$,AUTO
          1 000975  D2C4 0015                            LLH,R5   21,B4
          1 000977  3E09                                 ADV,R3   9
          1 000978  C2B5                                 LLH,R4   ,B5,R3
          1 000979  D954                                 CMR,R5   R4
          1 00097A  0901 000A                            BE       s:23770,PREL

      936    23765    4                       GOTO SETDEV;
      937    23766    4                    DEV$=KZ$3270DEV.LNK$;

  23766   1 00097C  BC84                                 LDB,B3   ,B4
          1 00097D  BFC7 000D                            STB,B3   DEV$,AUTO

      938    23767    4                    END;

  23767   1 00097F  8DC7 000D                            CMN      DEV$,AUTO
          1 000981  09E6                                 BNE      s:23764,SPREL

      939    23768    3                 CALL BLD_DEV_CTX ALTRET(NO_MEMORY);

  23768   1 000982  E3C0 0422                            LNJ,B6   s:0,PREL
          1 000984       0236                            DC       s:23953,PREL

      940    23769    3   SETDEV:
      941    23770    3                 KZ$3270DEV.CHN$=KZ$EVENT.CHN$;

  23770   1 000985  ECC7 0004            SETDEV          LDB,B6   @PARAMETER1,AUTO
          1 000987  DCC6 0007                            LDB,B5   7,B6
          1 000989  CCC7 000D                            LDB,B4   DEV$,AUTO
          1 00098B  DFC4 0006                            STB,B5   6,B4

      942    23771    3                 KZ$EVENT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_LINEDEV#;

  23771   1 00098D  BCC6 0007                            LDB,B3   7,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:179  
          1 00098F  6C0A                                 LDV,R6   10
          1 000990  E7C3 0012                            STH,R6   18,B3

      943    23772    3                 KZ$EVENT.CHN$->KH$CHN.CTX$ = DEV$;

  23772   1 000992  DCC6 0007                            LDB,B5   7,B6
          1 000994  CFC5 000C                            STB,B4   12,B5

      944    23773    3                 IF KZ$3270CTR.TYP=3276 THEN

  23773   1 000996  DCC7 000B                            LDB,B5   CTR$,AUTO
          1 000998  D845 0008                            LDR,R5   8,B5
          1 00099A  D970 0CCC                            CMR,R5   3276,IMO
          1 00099C  0981 0006                            BNE      s:23776,PREL

      945    23774    3                    KZ$3270DEV.EWALT='1'B;

  23774   1 00099E  8944 0012                            LBT,'2000'X       18,B4
  23774   1 0009A0       2000
          1 0009A1  0F81 0004                            B        s:23777,PREL

      946    23775    3                 ELSE
      947    23776    3                    KZ$3270DEV.EWALT='0'B;

  23776   1 0009A3  8844 0012                            LBF,'2000'X       18,B4
  23776   1 0009A5       2000

      948    23777    3                 IF KZ$EVENT.CHNCTX$->KL_LINEDEV.TYPE>=3280 THEN

  23777   1 0009A6  8CC6 0001                            LDI      1,B6
          1 0009A8  B856                                 LDR,R3   R6
          1 0009A9  E570 7FFF                            AND,R6   32767,IMO
          1 0009AB  8D47 0092                            SDI      @DFRD+22,AUTO
          1 0009AD  BCC7 0092                            LDB,B3   @DFRD+22,AUTO
          1 0009AF  304F                                 SOR,R3   15
          1 0009B0  5C02                                 LDV,R5   2
          1 0009B1  0021                                 ALR      ;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:180  
          1 0009B2       4233 0005                                ALPHANUM(5,B3,R3,,2),;
          1 0009B4       4007 0094                                ALPHANUM(@DFRD+24,AUTO,,R5,FILL)
          1 0009B6  437F                                 CSYNC    s:23777+15,SPREL
          1 0009B7  C847 0094                            LDR,R4   @DFRD+24,AUTO
          1 0009B9  C970 0CD0                            CMR,R4   3280,IMO
          1 0009BB  0201 0006                            BL       s:23780,PREL

      949    23778    3                    KZ$3270DEV.PRINTER='1'B;

  23778   1 0009BD  8944 0012                            LBT,'0800'X       18,B4
  23778   1 0009BF       0800
          1 0009C0  0F81 0004                            B        s:23781,PREL

      950    23779    3                 ELSE
      951    23780    3                    KZ$3270DEV.PRINTER='0'B;

  23780   1 0009C2  8844 0012                            LBF,'0800'X       18,B4
  23780   1 0009C4       0800

      952    23781    3                 CALL SET_PRO;

  23781   1 0009C5  E3C0 0493                            LNJ,B6   s:0,PREL
          1 0009C7       0001                            DC       s:23783,PREL

      953    23782    3   NO_CTRLR:
      954    23783    3               END;

  23783   1 0009C8  0F81 01E1            NO_CTRLR        B        s:23943,PREL

      955    23784        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:181  
      956    23785        /* Build Context Complete */
      957    23786
      958    23787    2            CASE(%KZ#LINFCN_CTXCMP);

      959    23788                   %DISABLE(INHLVL=KH_INHLVL);

  23789   1 0009CA  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 0009CD  EF47 006A                            STR,R6   DISABLE_LEVEL,AUTO

  23790   1 0009CF  ABC7 006A                            LAB,B2   DISABLE_LEVEL,AUTO
          1 0009D1  AFC7 0092                            STB,B2   @DFRD+22,AUTO
          1 0009D3  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0009D5  CBF0 0100                            LAB,B4   256,IMO
          1 0009D7  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 0009DA       0001                            DC       s:23792,PREL

      960    23792    2              SZ=((KZ$LINCTX.POLSIZ*5)+1)/2;

  23792   1 0009DB  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 0009DD  E846 0065                            LDR,R6   101,B6
          1 0009DF  6F05                                 MLV,R6   5
          1 0009E0  6E01                                 ADV,R6   1
          1 0009E1  E370 0002                            DIV,R6   2,IMO
          1 0009E3  EF47 001B                            STR,R6   SZ,AUTO

      961    23793    2              CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);

  23793   1 0009E5  DBC7 000F                            LAB,B5   T$,AUTO
          1 0009E7  DFC7 0094                            STB,B5   @DFRD+24,AUTO
          1 0009E9  CBC7 001B                            LAB,B4   SZ,AUTO
          1 0009EB  CFC7 0092                            STB,B4   @DFRD+22,AUTO
          1 0009ED  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0009EF  CBF0 0200                            LAB,B4   512,IMO
          1 0009F1  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 0009F4       01C6                            DC       s:23953,PREL

      962    23794    2              KZ$LINCTX.CTRLST$=T$;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:182  

  23794   1 0009F5  ECC7 000F                            LDB,B6   T$,AUTO
          1 0009F7  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0009F9  EFC5 0068                            STB,B6   104,B5

      963    23795    2              KZ$LINCTX.POLLST$=PINCRW(T$,

  23795   1 0009FB  B845 0065                            LDR,R3   101,B5
          1 0009FD  E853                                 LDR,R6   R3
          1 0009FE  70F0                                 DAR,R7   16
          1 0009FF  7081                                 DOL,R7   1
          1 000A00  8447 000F                            AID      T$,AUTO
          1 000A02  8D45 0066                            SDI      102,B5

      964    23796    2                KZ$LINCTX.POLSIZ*2);
      965    23797
      966    23798    2              CTR$=KZ$LINCTX.CTRHD$;

  23798   1 000A04  CC85                                 LDB,B4   ,B5
          1 000A05  CFC7 000B                            STB,B4   CTR$,AUTO

      967    23799    3              DO I=0 TO KZ$LINCTX.POLSIZ-1;

  23799   1 000A07  8747 0013                            CL       CNT,AUTO
          1 000A09  0F81 0014                            B        s:23803+2,PREL

      968    23800    3                 KZ$LINCTX.POLLST$->UBYT(I)=0; /* Make all controllers inactive  */

  23800   1 000A0B  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000A0D  DCC6 0066                            LDB,B5   102,B6
          1 000A0F  B847 0013                            LDR,R3   CNT,AUTO
          1 000A11  87B5                                 CLH      ,B5,R3

      969    23801    3                 KZ$LINCTX.CTRLST$->P$(I)=CTR$;

  23801   1 000A12  DCC6 0068                            LDB,B5   104,B6
          1 000A14  CCC7 000B                            LDB,B4   CTR$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:183  
          1 000A16  B847 0013                            LDR,R3   CNT,AUTO
          1 000A18  CFB5                                 STB,B4   ,B5,R3

      970    23802    3                 CTR$=KZ$3270CTR.LNK$;

  23802   1 000A19  DC84                                 LDB,B5   ,B4
          1 000A1A  DFC7 000B                            STB,B5   CTR$,AUTO

      971    23803    3                 END;

  23803   1 000A1C  8AC7 0013                            INC      CNT,AUTO
          1 000A1E  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000A20  E847 0013                            LDR,R6   CNT,AUTO
          1 000A22  6801 0004                            BLZ,R6   s:23805,PREL
          1 000A24  E946 0065                            CMR,R6   101,B6
          1 000A26  0865                                 BAL      s:23800,SPREL

      972    23804                   %ENABLE(INHLVL=KH_INHLVL);

  23805   1 000A27  D847 006A                            LDR,R5   DISABLE_LEVEL,AUTO
          1 000A29  D900 0000 0000  xsym                 CMR,R5   KH_INHLVL
          1 000A2C  0901 017D                            BE       s:23943,PREL

  23807   1 000A2E  CBF0 0000                            LAB,B4   0,IMO
          1 000A30  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 000A33       0001                            DC       s:23808,PREL

  23808   1 000A34  0F81 0175                            B        s:23943,PREL

      973    23810        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:184  
      974    23811        /* Enable Channels  */
      975    23812
      976    23813    2            CASE(%KZ#LINFCN_ENABL);

      977    23814
      978    23815    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);

  23815   1 000A36  ACC4 0005                            LDB,B2   5,B4
          1 000A38  9802                                 LDR,R1   ,B2
          1 000A39  9570 00FF                            AND,R1   255,IMO
          1 000A3B  1D04                                 CMV,R1   4
          1 000A3C  0281 016D                            BGE      s:23943,PREL
          1 000A3E  B810 0000 0A44  01                   LDR,R3   s:23815+14,R1
          1 000A41  83B0 0000 0A48  01                   JMP      s:23822,R3
          1 000A44       002A                            DC       s:23826,PREL
          1 000A45       002A                            DC       s:23826,PREL
          1 000A46       002A                            DC       s:23826,PREL
          1 000A47       0000                            DC       s:23822,PREL

      979    23816
      980    23817    3               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */

      981    23818
      982    23819    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */

      983    23820
      984    23821    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */

      985    23822    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;

  23822   1 000A48  E842 0002                            LDR,R6   2,B2
          1 000A4A  EF47 0013                            STR,R6   CNT,AUTO

      986    23823    3                 J=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBSUBDEVICE;

  23823   1 000A4C  ACC4 0005                            LDB,B2   5,B4
          1 000A4E  D842 0003                            LDR,R5   3,B2
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:185  
          1 000A50  DF47 0014                            STR,R5   J,AUTO

      987    23824    3                 CALL FND_CTR ALTRET(NO_WAY);

  23824   1 000A52  E3C0 02D5                            LNJ,B6   s:0,PREL
          1 000A54       001E                            DC       s:23826,PREL

      988    23825    3                 CALL FND_DEV ALTRET(NO_WAY);

  23825   1 000A55  E3C0 02FE                            LNJ,B6   s:0,PREL
          1 000A57       001B                            DC       s:23826,PREL

      989    23826    3                 IF KZ$3270DEV.AWAIT_ENABLE OR

  23826   1 000A58  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000A5A  82C6 001A                            LB,'0008'X        26,B6
          1 000A5C       0008
          1 000A5D  0501 0011                            BBT      s:23829,PREL
          1 000A5F  82C6 0012                            LB,'0800'X        18,B6
          1 000A61       0800
          1 000A62  0581 0006                            BBF      s:23826+17,PREL
          1 000A64  82C6 0012                            LB,'4000'X        18,B6
          1 000A66       4000
          1 000A67  0581 0007                            BBF      s:23829,PREL
          1 000A69  DCC6 0006                            LDB,B5   6,B6
          1 000A6B  8285                                 LB,'0004'X        ,B5
          1 000A6C       0004
          1 000A6D  0581 0004                            BBF      s:23826,PREL

      990    23827    3                   (KZ$3270DEV.PRINTER AND NOT KZ$3270DEV.ACTIVE) OR
      991    23828    3                   KZ$3270DEV.CHN$->KH$CHN.AUTLGN
      992    23829    3                 THEN CALL CNC_DEV;

  23829   1 000A6F  E3C0 09DB                            LNJ,B6   s:0,PREL
          1 000A71       0001                            DC       s:23826,PREL

  23826   1                              NO_WAY          null
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:186  
      993    23830    3   NO_WAY:       ;
      994    23831    3               END;

  23831   1 000A72  0F81 0137            NO_WAY          B        s:23943,PREL

      995    23832        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:187  
      996    23833        /* General Poll on slave line */
      997    23834
      998    23835    2            CASE(%KZ#LINFCN_POL);

      999    23836
     1000    23837    3              IF KZ$LINCTX.INPDATSIZ~=4 THEN DO;

  23837   1 000A74  E843 0059                            LDR,R6   89,B3
          1 000A76  6D04                                 CMV,R6   4
          1 000A77  0901 0007                            BE       s:23841,PREL

     1001    23838    3                 LINRSP=%KZ#LINRSP_NUL;    /* Not a valid poll                   */

  23838   1 000A79  ACC7 0006                            LDB,B2   @PARAMETER2,AUTO
          1 000A7B  8702                                 CL       ,B2

     1002    23839    3                 RETURN;

  23839   1 000A7C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1003    23840    3                 END;
     1004    23841    2              STATUS = KZ$LINCTX.INPBFR$->BIT16(0)&'3F3F'X;

  23841   1 000A7F  ACC3 0056                            LDB,B2   86,B3
          1 000A81  D802                                 LDR,R5   ,B2
          1 000A82  D570 3F3F                            AND,R5   16191,IMO
          1 000A84  DF47 001A                            STR,R5   STATUS,AUTO

     1005    23842    2              IF STATUSB.I ~= STATUSB.J THEN

  23842   1 000A86  C2C7 001A                            LLH,R4   STATUS,AUTO
          1 000A88  9847 001A                            LDR,R1   STATUS,AUTO
          1 000A8A  9570 00FF                            AND,R1   255,IMO
          1 000A8C  C951                                 CMR,R4   R1
          1 000A8D  0901 000A                            BE       s:23847,PREL

     1006    23843    3              DO;                          /* CTRL ADDRESS MESSED UP - BAD POLL  */
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:188  

     1007    23844    3                 CALL ERRLOG(%E$BADPOL);

  23844   1 000A8F  9BF0 00CA                            LAB,B1   202,IMO
          1 000A91  9FC7 007A                            STB,B1   I+4,AUTO
          1 000A93  E3C0 0B93                            LNJ,B6   s:0,PREL
          1 000A95       0001                            DC       s:23845,PREL

     1008    23845    3                 GOTO SND_EOT;

  23845   1 000A96  0F81 00D3                            B        s:23918,PREL

     1009    23846    3                 END;
     1010    23847    2              I = STATUSB.J;

  23847   1 000A98  9F47 0013                            STR,R1   CNT,AUTO

     1011    23848    2              STATUS = KZ$LINCTX.INPBFR$->BIT16(1)&'3F3F'X;

  23848   1 000A9A  B842 0001                            LDR,R3   1,B2
          1 000A9C  B570 3F3F                            AND,R3   16191,IMO
          1 000A9E  D853                                 LDR,R5   R3
          1 000A9F  DF47 001A                            STR,R5   STATUS,AUTO

     1012    23849    2              IF STATUSB.I ~= STATUSB.J THEN

  23849   1 000AA1  C2C7 001A                            LLH,R4   STATUS,AUTO
          1 000AA3  B847 001A                            LDR,R3   STATUS,AUTO
          1 000AA5  B570 00FF                            AND,R3   255,IMO
          1 000AA7  C953                                 CMR,R4   R3
          1 000AA8  0901 000A                            BE       s:23854,PREL

     1013    23850    3              DO;                     /* Device addresses messed up - BAD POLL   */

     1014    23851    3                 CALL ERRLOG(%E$BADPOL);

  23851   1 000AAA  9BF0 00CA                            LAB,B1   202,IMO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:189  
          1 000AAC  9FC7 007A                            STB,B1   I+4,AUTO
          1 000AAE  E3C0 0B78                            LNJ,B6   s:0,PREL
          1 000AB0       0001                            DC       s:23852,PREL

     1015    23852    3                 GOTO SND_EOT;

  23852   1 000AB1  0F81 00B8                            B        s:23918,PREL

     1016    23853    3                 END;
     1017    23854    2              J = STATUSB.J;

  23854   1 000AB3  BF47 0014                            STR,R3   J,AUTO

     1018    23855
     1019    23856    2              KZ$LINCTX.FLAGS.CTRINITDONE='1'B;

  23856   1 000AB5  8943 0034                            LBT,'0010'X       52,B3
  23856   1 000AB7       0010

     1020    23857    2              KZ$LINCTX.RTRCNT=0;

  23857   1 000AB8  8743 0039                            CL       57,B3

     1021    23858    2              IF I>=32 THEN

  23858   1 000ABA  1D20                                 CMV,R1   32
          1 000ABB  0281 00C1                            BGE      s:23927,PREL

     1022    23859    2                 GOTO SEL_ECT;
     1023    23860    2              IF J~=63 THEN

  23860   1 000ABD  3D3F                                 CMV,R3   63
          1 000ABE  0981 0073                            BNE      s:23901,PREL

     1024    23861    2                 GOTO SPC_POL;
     1025    23862    3              IF KZ$LINCTX.CURCTR$=ADDR(NIL) THEN DO; /* No current ctr          */

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:190  
  23862   1 000AC0  8DC3 004E                            CMN      78,B3
          1 000AC2  0981 000C                            BNE      s:23867,PREL

     1026    23863    3                 CALL FND_CTR ALTRET(SND_EOT);

  23863   1 000AC4  E3C0 0263                            LNJ,B6   s:0,PREL
          1 000AC6       00A4                            DC       s:23918,PREL

     1027    23864    3                 KZ$LINCTX.CURCTR$=CTR$;

  23864   1 000AC7  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 000AC9  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000ACB  EFC5 004E                            STB,B6   78,B5

     1028    23865    3                 END;

  23865   1 000ACD  0F81 0005                            B        s:23869,PREL

     1029    23866    2              ELSE
     1030    23867    2                 CTR$=KZ$LINCTX.CURCTR$;

  23867   1 000ACF  9CC3 004E                            LDB,B1   78,B3
          1 000AD1  9FC7 000B                            STB,B1   CTR$,AUTO

     1031    23868
     1032    23869    2              IF KZ$LINCTX.CURDEV$~=ADDR(NIL) THEN

  23869   1 000AD3  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000AD5  8DC6 0050                            CMN      80,B6
          1 000AD7  0901 000A                            BE       s:23872,PREL

     1033    23870    2   NXTDEV:       DEV$=KZ$LINCTX.CURDEV$->KZ$3270DEV.LNK$;

  23870   1 000AD9  ECC7 0009            NXTDEV          LDB,B6   LIN$,AUTO
          1 000ADB  DCC6 0050                            LDB,B5   80,B6
          1 000ADD  CC85                                 LDB,B4   ,B5
          1 000ADE  CFC7 000D                            STB,B4   DEV$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:191  
          1 000AE0  0F81 0007                            B        s:23873,PREL

     1034    23871    2              ELSE
     1035    23872    2                 DEV$=KZ$3270CTR.DEVHD$;

  23872   1 000AE2  DCC7 000B                            LDB,B5   CTR$,AUTO
          1 000AE4  CCC5 0002                            LDB,B4   2,B5
          1 000AE6  CFC7 000D                            STB,B4   DEV$,AUTO

     1036    23873    2              IF DEV$=ADDR(NIL) THEN

  23873   1 000AE8  8DC7 000D                            CMN      DEV$,AUTO
          1 000AEA  0981 0010                            BNE      s:23883,PREL

     1037    23874    2                 IF KZ$LINCTX.OTPHD$=ADDR(NIL) THEN /* Nothing to send           */

  23874   1 000AEC  8DC6 0052                            CMN      82,B6
          1 000AEE  0981 0005                            BNE      s:23880,PREL

     1038    23875    3                 DO;

     1039    23876    3                    KZ$LINCTX.OTPCNT=0;

  23876   1 000AF0  8746 004D                            CL       77,B6

     1040    23877    3                    GOTO SND_EOT;

  23877   1 000AF2  0F81 0077                            B        s:23918,PREL

     1041    23878    3                    END;
     1042    23879    3                 ELSE DO;

     1043    23880    3                    LINRSP=%KZ#LINRSP_DAT;

  23880   1 000AF4  DCC7 0006                            LDB,B5   @PARAMETER2,AUTO
          1 000AF6  6C02                                 LDV,R6   2
          1 000AF7  EF05                                 STR,R6   ,B5
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:192  

     1044    23881    3                    RETURN;

  23881   1 000AF8  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1045    23882    3                    END;
     1046    23883    2              KZ$LINCTX.CURDEV$=DEV$;

  23883   1 000AFB  CFC6 0050                            STB,B4   80,B6

     1047    23884    3              IF KZ$3270DEV.OTPHD$~=ADDR(NIL) AND NOT KZ$3270DEV.HLT THEN DO;

  23884   1 000AFD  8DC4 0008                            CMN      8,B4
          1 000AFF  0901 0030                            BE       s:23896,PREL
          1 000B01  82C4 0012                            LB,'00FF'X        18,B4
          1 000B03       00FF
          1 000B04  0501 002B                            BBT      s:23896,PREL

     1048    23885    3                 IF KZ$LINCTX.OTPTL$~=ADDR(NIL) THEN

  23885   1 000B06  8DC6 0054                            CMN      84,B6
          1 000B08  0901 0008                            BE       s:23888,PREL

     1049    23886    3                    KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;

  23886   1 000B0A  DCC6 0054                            LDB,B5   84,B6
          1 000B0C  BCC4 0008                            LDB,B3   8,B4
          1 000B0E  BF85                                 STB,B3   ,B5
          1 000B0F  0F81 0005                            B        s:23889,PREL

     1050    23887    3                 ELSE
     1051    23888    3                    KZ$LINCTX.OTPHD$=KZ$3270DEV.OTPHD$;

  23888   1 000B11  DCC4 0008                            LDB,B5   8,B4
          1 000B13  DFC6 0052                            STB,B5   82,B6

     1052    23889    3                 KZ$LINCTX.OTPTL$=KZ$3270DEV.OTPHD$;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:193  

  23889   1 000B15  DCC4 0008                            LDB,B5   8,B4
          1 000B17  DFC6 0054                            STB,B5   84,B6

     1053    23890    3                 KZ$3270DEV.OTPHD$=KZ$3270DEV.OTPHD$->KZ$OTPBFR.LNK$;

  23890   1 000B19  BCC4 0008                            LDB,B3   8,B4
          1 000B1B  AC83                                 LDB,B2   ,B3
          1 000B1C  AFC4 0008                            STB,B2   8,B4

     1054    23891    3                 KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=ADDR(NIL);

  23891   1 000B1E  DCC6 0054                            LDB,B5   84,B6
          1 000B20  BB80 0000 0000                       LAB,B3   0
          1 000B23  BF85                                 STB,B3   ,B5

     1055    23892    3                 KZ$3270DEV.OTPBSY='1'B;

  23892   1 000B24  8944 0012                            LBT,'0400'X       18,B4
  23892   1 000B26       0400

     1056    23893    3                 IF KZ$3270DEV.OTPHD$=ADDR(NIL) THEN

  23893   1 000B27  8DC4 0008                            CMN      8,B4
          1 000B29  0981 0006                            BNE      s:23896,PREL

     1057    23894    3                    KZ$3270DEV.OTPTL$=ADDR(NIL);

  23894   1 000B2B  DB80 0000 0000                       LAB,B5   0
          1 000B2E  DFC4 000A                            STB,B5   10,B4

     1058    23895    3                 END;

     1059    23896    2              GOTO NXTDEV;

  23896   1 000B30  0F81 FFA8                            B        s:23870,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:194  
     1060    23897        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:195  
     1061    23898        /* Specific Poll */
     1062    23899
     1063    23900    2   SPC_POL:
     1064    23901    2              STATUS=KZ$LINCTX.INPBFR$->BIT16(0)&'3F3F'X;

  23901   1 000B32  A802                 SPC_POL         LDR,R2   ,B2
          1 000B33  A570 3F3F                            AND,R2   16191,IMO
          1 000B35  D852                                 LDR,R5   R2
          1 000B36  DF47 001A                            STR,R5   STATUS,AUTO

     1065    23902    2              CALL FND_CTR ALTRET(SND_EOT);

  23902   1 000B38  E3C0 01EF                            LNJ,B6   s:0,PREL
          1 000B3A       0030                            DC       s:23918,PREL

     1066    23903    2              CALL FND_DEV ALTRET(SND_EOT);

  23903   1 000B3B  E3C0 0218                            LNJ,B6   s:0,PREL
          1 000B3D       002D                            DC       s:23918,PREL

     1067    23904    2              IF KZ$3270DEV.OTPHD$~=ADDR(NIL) AND NOT KZ$3270DEV.HLT THEN

  23904   1 000B3E  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000B40  8DC6 0008                            CMN      8,B6
          1 000B42  0901 0006                            BE       s:23906,PREL
          1 000B44  82C6 0012                            LB,'00FF'X        18,B6
          1 000B46       00FF
          1 000B47  0581 0003                            BBF      s:23909,PREL

     1068    23905    2                 GOTO SND_DAT;
     1069    23906    2              GOTO SND_EOT;

  23906   1 000B49  0F81 0020                            B        s:23918,PREL

     1070    23907
     1071    23908    2   SND_DAT:
     1072    23909    2              KZ$LINCTX.OTPHD$=KZ$3270DEV.OTPHD$;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:196  

  23909   1 000B4B  DCC6 0008            SND_DAT         LDB,B5   8,B6
          1 000B4D  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 000B4F  DFC4 0052                            STB,B5   82,B4

     1073    23910    2              KZ$LINCTX.OTPTL$=KZ$3270DEV.OTPHD$;

  23910   1 000B51  BCC6 0008                            LDB,B3   8,B6
          1 000B53  BFC4 0054                            STB,B3   84,B4

     1074    23911    2              KZ$3270DEV.OTPHD$=KZ$3270DEV.OTPHD$->KZ$OTPBFR.LNK$;

  23911   1 000B55  ACC6 0008                            LDB,B2   8,B6
          1 000B57  9C82                                 LDB,B1   ,B2
          1 000B58  9FC6 0008                            STB,B1   8,B6

     1075    23912    2              IF KZ$3270DEV.OTPHD$=ADDR(NIL) THEN

  23912   1 000B5A  8DC6 0008                            CMN      8,B6
          1 000B5C  0981 0006                            BNE      s:23914,PREL

     1076    23913    2                 KZ$3270DEV.OTPTL$=ADDR(NIL);

  23913   1 000B5E  DB80 0000 0000                       LAB,B5   0
          1 000B61  DFC6 000A                            STB,B5   10,B6

     1077    23914    2              LINRSP=%KZ#LINRSP_DAT;

  23914   1 000B63  DCC7 0006                            LDB,B5   @PARAMETER2,AUTO
          1 000B65  6C02                                 LDV,R6   2
          1 000B66  EF05                                 STR,R6   ,B5

     1078    23915    2              RETURN;

  23915   1 000B67  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1079    23916
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:197  
     1080    23917    2   SND_EOT:
     1081    23918    2              KZ$LINCTX.CURDEV$=ADDR(NIL);

  23918   1 000B6A  EB80 0000 0000       SND_EOT         LAB,B6   0
          1 000B6D  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000B6F  EFC5 0050                            STB,B6   80,B5

     1082    23919    2              KZ$LINCTX.CURCTR$=ADDR(NIL);

  23919   1 000B71  CB80 0000 0000                       LAB,B4   0
          1 000B74  CFC5 004E                            STB,B4   78,B5

     1083    23920    2              LINRSP=%KZ#LINRSP_EOT;

  23920   1 000B76  BCC7 0006                            LDB,B3   @PARAMETER2,AUTO
          1 000B78  6C01                                 LDV,R6   1
          1 000B79  EF03                                 STR,R6   ,B3

     1084    23921    2              RETURN;

  23921   1 000B7A  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1085    23922
     1086    23923        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:198  
     1087    23924        /* Select for slave lines */
     1088    23925
     1089    23926    2   SEL_ECT:
     1090    23927    2              STATUS=KZ$LINCTX.INPBFR$->BIT16(0)&'1F1F'X;

  23927   1 000B7D  A802                 SEL_ECT         LDR,R2   ,B2
          1 000B7E  A570 1F1F                            AND,R2   7967,IMO
          1 000B80  D852                                 LDR,R5   R2
          1 000B81  DF47 001A                            STR,R5   STATUS,AUTO

     1091    23928    2              I=STATUSB.I;

  23928   1 000B83  92C7 001A                            LLH,R1   STATUS,AUTO
          1 000B85  9F47 0013                            STR,R1   CNT,AUTO

     1092    23929    2              CALL FND_CTR ALTRET(SND_NULL);

  23929   1 000B87  E3C0 01A0                            LNJ,B6   s:0,PREL
          1 000B89       0017                            DC       s:23937,PREL

     1093    23930    2              KZ$LINCTX.CURCTR$=CTR$;

  23930   1 000B8A  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 000B8C  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000B8E  EFC5 004E                            STB,B6   78,B5

     1094    23931    2              CALL FND_DEV ALTRET(SND_NULL);

  23931   1 000B90  E3C0 01C3                            LNJ,B6   s:0,PREL
          1 000B92       000E                            DC       s:23937,PREL

     1095    23932    2              KZ$LINCTX.CURDEV$=DEV$;

  23932   1 000B93  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000B95  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000B97  EFC5 0050                            STB,B6   80,B5

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:199  
     1096    23933    2   SND_ACK:   LINRSP=%KZ#LINRSP_ACK;

  23933   1 000B99  CCC7 0006            SND_ACK         LDB,B4   @PARAMETER2,AUTO
          1 000B9B  6C03                                 LDV,R6   3
          1 000B9C  EF04                                 STR,R6   ,B4

     1097    23934    2              RETURN;

  23934   1 000B9D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1098    23935
     1099    23936
     1100    23937    2   SND_NULL:  LINRSP=%KZ#LINRSP_NUL;

  23937   1 000BA0  ECC7 0006            SND_NULL        LDB,B6   @PARAMETER2,AUTO
          1 000BA2  8706                                 CL       ,B6

     1101    23938    2              RETURN;

  23938   1 000BA3  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1102    23939
     1103    23940    2            CASE(%KZ#LINFCN_DISABL);

     1104    23941    2            CASE(ELSE);

     1105    23942    2              CALL M$XXX;                  /* Unknown function from line-manager */

  23942   1 000BA6  B870 0082                            LDR,R3   130,IMO
          1 000BA8  0001                                 MCL
          1 000BA9       0000                            DC       s:23942+3,PREL

     1106    23943    2            END;                           /* End DO CASE(KZ$EVENT.EVENT)        */

     1107    23944
     1108    23945    1   XIT:
     1109    23946    1           IF VDH_FLG~=0 THEN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:200  

  23946   1 000BAA  E847 0021            XIT             LDR,R6   VDH_FLG,AUTO
          1 000BAC  6901 000A                            BEZ,R6   s:23949,PREL

     1110    23947    1              CALL EXIT_VDH (KZ$3270DEV.VDI$);

  23947   1 000BAE  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000BB0  DBC6 0004                            LAB,B5   4,B6
          1 000BB2  DFC7 007A                            STB,B5   I+4,AUTO
          1 000BB4  E3C0 0BE7                            LNJ,B6   s:0,PREL
          1 000BB6       0001                            DC       s:23949,PREL

     1111    23948
     1112    23949    1           RETURN;

  23949   1 000BB7  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1113    23950        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:201  
     1114    23951    1   NO_MEMORY:
     1115    23952        /* NO_MEMORY - Disconnect the line due to a lack of MEMory */
     1116    23953    1           CALL ERRLOG(%E$NO_MEMORY);

  23953   1 000BBA  EBF0 00D0            NO_MEMORY       LAB,B6   208,IMO
          1 000BBC  EFC7 007A                            STB,B6   I+4,AUTO
          1 000BBE  E3C0 0A68                            LNJ,B6   s:0,PREL
          1 000BC0       0001                            DC       s:23954,PREL

     1117    23954    1           CALL DSC_LINE;

  23954   1 000BC1  E3C0 00FF                            LNJ,B6   s:0,PREL
          1 000BC3       0001                            DC       s:23955,PREL

     1118    23955    1           GOTO XIT;

  23955   1 000BC4  0FE6                                 B        s:23943,SPREL

     1119    23956        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:202  
     1120    23957        /* KZV$DFR - Process deferred items */
     1121    23958
     1122    23959    1   KZV$DFR: ENTRY(PARAMETER1) ALTRET;

  23959   1 000BC5  D380 0000 0000  xent KZV$DFR         LNJ,B5   X6A_AUTO_2
          1 000BC8       009F 0002                       DC       159,2

     1123    23960
     1124    23961    1           DEV$=ADDR(DEVCTX);

  23961   1 000BCA  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 000BCC  EFC7 000D                            STB,B6   DEV$,AUTO

     1125    23962    1           CTR$=KZ$3270DEV.CTR$;

  23962   1 000BCE  DCC6 0002                            LDB,B5   2,B6
          1 000BD0  DFC7 000B                            STB,B5   CTR$,AUTO

     1126    23963    1           LIN$=KZ$3270CTR.LIN$;

  23963   1 000BD2  CCC5 0004                            LDB,B4   4,B5
          1 000BD4  CFC7 0009                            STB,B4   LIN$,AUTO

     1127    23964    1           VDH_FLG=1;                      /* Already in VDH                     */

  23964   1 000BD6  6C01                                 LDV,R6   1
          1 000BD7  EF47 0021                            STR,R6   VDH_FLG,AUTO

     1128    23965
     1129    23966    2           DO WHILE(KZ$3270DEV.DFRHD$~=ADDR(NIL));

  23966   1 000BD9  0F81 0093                            B        s:23990,PREL

     1130    23967    2              BFR$=KZ$3270DEV.DFRHD$;

  23967   1 000BDB  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000BDD  DCC6 000C                            LDB,B5   12,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:203  
          1 000BDF  DFC7 0015                            STB,B5   BFR$,AUTO

     1131    23968    2              KZ$3270DEV.DFRHD$=KZ$OTPBFR.LNK$;

  23968   1 000BE1  CC85                                 LDB,B4   ,B5
          1 000BE2  CFC6 000C                            STB,B4   12,B6

     1132    23969    2              IF KZ$3270DEV.DFRHD$=ADDR(NIL) THEN

  23969   1 000BE4  8DC6 000C                            CMN      12,B6
          1 000BE6  0981 0006                            BNE      s:23971,PREL

     1133    23970    2                 KZ$3270DEV.DFRTL$=ADDR(NIL);

  23970   1 000BE8  DB80 0000 0000                       LAB,B5   0
          1 000BEB  DFC6 000E                            STB,B5   14,B6

     1134    23971    3              DO CASE(KZ$OTPBFR.TYP);

  23971   1 000BED  DCC7 0015                            LDB,B5   BFR$,AUTO
          1 000BEF  B2C5 0002                            LLH,R3   2,B5
          1 000BF1  3D03                                 CMV,R3   3
          1 000BF2  0281 007A                            BGE      s:23990,PREL
          1 000BF4  A830 0000 0BFA  01                   LDR,R2   s:23971+13,R3
          1 000BF7  83A0 0000 0BFD  01                   JMP      s:23973,R2
          1 000BFA       0070                            DC       s:23990,PREL
          1 000BFB       0005                            DC       s:23975,PREL
          1 000BFC       0000                            DC       s:23973,PREL

     1135    23972    3               CASE(%KZ#BFRTYP_OTP);

     1136    23973    3                 CALL RELOTPBFR;

  23973   1 000BFD  E3C0 026D                            LNJ,B6   s:0,PREL
          1 000BFF       0001                            DC       s:23973+3,PREL
          1 000C00  0F81 006C                            B        s:23990,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:204  
     1137    23974    3               CASE(%KZ#BFRTYP_INP);

     1138    23975    3                 KV$VDH_DAT=KV_VDH_DAT;

  23975   1 000C02  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_DAT
          1 000C05  2C00                                 LDV,R2   0
          1 000C06  6C10                                 LDV,R6   16
          1 000C07  BB87                                 LAB,B3   ,AUTO
          1 000C08  3C7A                                 LDV,R3   122
          1 000C09  0008                                 MMM

     1139    23976    3                 KV$VDH_DAT.DAT__.ADR$=KZ$INPBFR.DATA$;

  23976   1 000C0A  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 000C0C  DCC6 0006                            LDB,B5   6,B6
          1 000C0E  DFC7 003E                            STB,B5   KV$VDH_DAT+1,AUTO

     1140    23977    3                 KV$VDH_DAT.DAT__.BYTX=KZ$INPBFR.BYTX;

  23977   1 000C10  E846 0005                            LDR,R6   5,B6
          1 000C12  EF47 0040                            STR,R6   KV$VDH_DAT+3,AUTO

     1141    23978    3                 KV$VDH_DAT.DAT__.DATBYTSIZ=KZ$INPBFR.DATA_SIZ;

  23978   1 000C14  D846 0003                            LDR,R5   3,B6
          1 000C16  DF47 0041                            STR,R5   KV$VDH_DAT+4,AUTO

     1142    23979    3                 KV$VDH_DAT.CTN=KZ$INPBFR.FLAGS.CTN#;

  23979   1 000C18  C846 0002                            LDR,R4   2,B6
          1 000C1A  4001                                 SOL,R4   1
          1 000C1B  CAC7 003D                            SRM,R4,'0040'X    KV$VDH_DAT,AUTO
          1 000C1D       0040

     1143    23980    3                 KZ$3270DEV.MUST_SBA='1'B;

  23980   1 000C1E  CCC7 000D                            LDB,B4   DEV$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:205  
          1 000C20  8944 001A                            LBT,'0010'X       26,B4
          1 000C22       0010

     1144    23981    3                 CALL KVV$VDI(KV$VDH_DAT);

  23981   1 000C23  DBC7 003D                            LAB,B5   KV$VDH_DAT,AUTO
          1 000C25  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 000C27  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000C29  CBF0 0100                            LAB,B4   256,IMO
          1 000C2B  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000C2E       0001                            DC       s:23982,PREL

     1145    23982    3                 KZ$3270STT.KHSTT.INPBFRBYTUTL=KZ$3270STT.KHSTT.INPBFRBYTUTL-

  23982   1 000C2F  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 000C32  DCC7 0015                            LDB,B5   BFR$,AUTO
          1 000C34  F845 0004                            LDR,R7   4,B5
          1 000C36  6C00                                 LDV,R6   0
          1 000C37  7081                                 DOL,R7   1
          1 000C38  8656                                 CPL      R6
          1 000C39  8657                                 CPL      R7
          1 000C3A  8470 0000 0001                       AID      1,IMO
          1 000C3D  8446 001C                            AID      28,B6
          1 000C3F  8D46 001C                            SDI      28,B6

     1146    23983    3                   (KZ$INPBFR.BFR_SIZ*2);
     1147    23984    3                 T$=KZ$INPBFR.DATA$;

  23984   1 000C41  CCC5 0006                            LDB,B4   6,B5
          1 000C43  CFC7 000F                            STB,B4   T$,AUTO

     1148    23985    3                 I=KZ$INPBFR.BFR_SIZ;

  23985   1 000C45  D845 0004                            LDR,R5   4,B5
          1 000C47  DF47 0013                            STR,R5   CNT,AUTO

     1149    23986    3                 CALL KVB$RLSSYS(I,T$);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:206  

  23986   1 000C49  BBC7 000F                            LAB,B3   T$,AUTO
          1 000C4B  BFC7 0094                            STB,B3   @DFRD+24,AUTO
          1 000C4D  ABC7 0013                            LAB,B2   CNT,AUTO
          1 000C4F  AFC7 0092                            STB,B2   @DFRD+22,AUTO
          1 000C51  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000C53  CBF0 0200                            LAB,B4   512,IMO
          1 000C55  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000C58       0001                            DC       s:23987,PREL

     1150    23987    3                 T$=BFR$;

  23987   1 000C59  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 000C5B  EFC7 000F                            STB,B6   T$,AUTO

     1151    23988    3                 CALL KVB$RLSSYS(SIZEW(KZ$INPBFR),T$);

  23988   1 000C5D  DBF0 0008                            LAB,B5   8,IMO
          1 000C5F  CBC7 000F                            LAB,B4   T$,AUTO
          1 000C61  CFC7 0094                            STB,B4   @DFRD+24,AUTO
          1 000C63  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 000C65  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000C67  CBF0 0200                            LAB,B4   512,IMO
          1 000C69  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000C6C       0001                            DC       s:23990,PREL

     1152    23989    3               END;

     1153    23990    2              END;

  23990   1 000C6D  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000C6F  8DC6 000C                            CMN      12,B6
          1 000C71  0981 FF69                            BNE      s:23967,PREL

     1154    23991    1           RETURN;

  23991   1 000C73  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:207  

     1155    23992        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:208  
     1156    23993        /* KZV$DSC - Disconnect processing */
     1157    23994
     1158    23995    1   KZV$DSC: ENTRY(PARAMETER1) ALTRET;

  23995   1 000C76  D380 0000 0000  xent KZV$DSC         LNJ,B5   X6A_AUTO_2
          1 000C79       009F 0002                       DC       159,2

     1159    23996
     1160    23997    1           DEV$=ADDR(DEVCTX);

  23997   1 000C7B  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 000C7D  EFC7 000D                            STB,B6   DEV$,AUTO

     1161    23998    1           CTR$=KZ$3270DEV.CTR$;

  23998   1 000C7F  DCC6 0002                            LDB,B5   2,B6
          1 000C81  DFC7 000B                            STB,B5   CTR$,AUTO

     1162    23999    1           LIN$=KZ$3270CTR.LIN$;

  23999   1 000C83  CCC5 0004                            LDB,B4   4,B5
          1 000C85  CFC7 0009                            STB,B4   LIN$,AUTO

     1163    24000    1           VDH_FLG=1;                      /* Already in VDH                     */

  24000   1 000C87  6C01                                 LDV,R6   1
          1 000C88  EF47 0021                            STR,R6   VDH_FLG,AUTO

     1164    24001    1           CALL DSC_DEV(%KV_DSCRSN_PTH);

  24001   1 000C8A  BBF0 0002                            LAB,B3   2,IMO
          1 000C8C  BFC7 0070                            STB,B3   CP_PHLEGM+5,AUTO
          1 000C8E  E3C0 0612                            LNJ,B6   s:0,PREL
          1 000C90       0001                            DC       s:24002,PREL

     1165    24002    1           RETURN;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:209  
  24002   1 000C91  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1166    24003
     1167    24004    1   KZV$DSC_CONT: ENTRY(PARAMETER1) ALTRET;

  24004   1 000C94  D380 0000 0000  xent KZV$DSC_CONT    LNJ,B5   X6A_AUTO_2
          1 000C97       009F 0002                       DC       159,2

     1168    24005
     1169    24006    1           DEV$=ADDR(DEVCTX);

  24006   1 000C99  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 000C9B  EFC7 000D                            STB,B6   DEV$,AUTO

     1170    24007    1           CTR$=KZ$3270DEV.CTR$;

  24007   1 000C9D  DCC6 0002                            LDB,B5   2,B6
          1 000C9F  DFC7 000B                            STB,B5   CTR$,AUTO

     1171    24008    1           LIN$=KZ$3270CTR.LIN$;

  24008   1 000CA1  CCC5 0004                            LDB,B4   4,B5
          1 000CA3  CFC7 0009                            STB,B4   LIN$,AUTO

     1172    24009    1           VDH_FLG=1;                      /* Already in VDH                     */

  24009   1 000CA5  6C01                                 LDV,R6   1
          1 000CA6  EF47 0021                            STR,R6   VDH_FLG,AUTO

     1173    24010    1           CALL DSC_DEV_CONT(%KV_DSCRSN_PTH);

  24010   1 000CA8  BBF0 0002                            LAB,B3   2,IMO
          1 000CAA  BFC7 0070                            STB,B3   CP_PHLEGM+5,AUTO
          1 000CAC  E3C0 06BC                            LNJ,B6   s:0,PREL
          1 000CAE       0001                            DC       s:24011,PREL

     1174    24011    1           RETURN;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:210  

  24011   1 000CAF  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1175    24012
     1176    24013    1   KZV$DSC_LINE: ENTRY(PARAMETER1) ALTRET;

  24013   1 000CB2  D380 0000 0000  xent KZV$DSC_LINE    LNJ,B5   X6A_AUTO_2
          1 000CB5       009F 0002                       DC       159,2

     1177    24014
     1178    24015    1           LIN$=ADDR(LINCTX);

  24015   1 000CB7  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 000CB9  EFC7 0009                            STB,B6   LIN$,AUTO

     1179    24016    1           CALL DSC_LINE;

  24016   1 000CBB  E3C0 0005                            LNJ,B6   s:0,PREL
          1 000CBD       0001                            DC       s:24017,PREL

     1180    24017    1           RETURN;

  24017   1 000CBE  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1181    24018
     1182    24019    1   DSC_LINE: PROC;

  24019   1 000CC1  EFC7 006E            DSC_LINE        STB,B6   CP_PHLEGM+3,AUTO

     1183    24020
     1184    24021    2           KZ$CLMEVENT=KZ_CLMEVENT;

  24021   1 000CC3  AB80 0000 0057  00                   LAB,B2   KZ_CLMEVENT
          1 000CC6  2C00                                 LDV,R2   0
          1 000CC7  6C1C                                 LDV,R6   28
          1 000CC8  BBC7 005B                            LAB,B3   KZ$CLMEVENT,AUTO
          1 000CCA  3C00                                 LDV,R3   0
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:211  
          1 000CCB  0008                                 MMM

     1185    24022    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_KILLED;

  24022   1 000CCC  6C07                                 LDV,R6   7
          1 000CCD  EF47 005B                            STR,R6   KZ$CLMEVENT,AUTO

     1186    24023    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$LINCTX.CHN$->KH$CHN.TERMID);

  24023   1 000CCF  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000CD1  DCC6 0002                            LDB,B5   2,B6
          1 000CD3  CBC5 0012                            LAB,B4   18,B5
          1 000CD5  CFC7 0060                            STB,B4   KZ$CLMEVENT+5,AUTO

     1187    24024    2           KZ$CLMEVENT.LINCTX$=LIN$;

  24024   1 000CD7  EFC7 005E                            STB,B6   KZ$CLMEVENT+3,AUTO

     1188    24025    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);

  24025   1 000CD9  DBC7 005B                            LAB,B5   KZ$CLMEVENT,AUTO
          1 000CDB  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 000CDD  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000CDF  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          1 000CE2  CBF0 0100                            LAB,B4   256,IMO
          1 000CE4  E381                                 LNJ,B6   ,B1
          1 000CE5       0001                            DC       s:24026,PREL

     1189    24026    2           RETURN;

  24026   1 000CE6  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 000CE8  C3C6 0001                            LNJ,B4   1,B6

     1190    24027
     1191    24028    2   END DSC_LINE;
     1192    24029        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:212  
     1193    24030        /* KZV$RELOTPBFR - Release an output buffer */
     1194    24031
     1195    24032    1   KZV$RELOTPBFR: ENTRY(PARAMETER1,PARAMETER2) ALTRET;

  24032   1 000CEA  D380 0000 0000  xent KZV$RELOTPBFR   LNJ,B5   X6A_AUTO_2
          1 000CED       009F 0002                       DC       159,2

     1196    24033
     1197    24034    1           DEV$=ADDR(DEVCTX);

  24034   1 000CEF  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 000CF1  EFC7 000D                            STB,B6   DEV$,AUTO

     1198    24035    1           CTR$=KZ$3270DEV.CTR$;

  24035   1 000CF3  DCC6 0002                            LDB,B5   2,B6
          1 000CF5  DFC7 000B                            STB,B5   CTR$,AUTO

     1199    24036    1           LIN$=KZ$3270CTR.LIN$;

  24036   1 000CF7  CCC5 0004                            LDB,B4   4,B5
          1 000CF9  CFC7 0009                            STB,B4   LIN$,AUTO

     1200    24037    1           VDH_FLG=1;                      /* Already in VDH                     */

  24037   1 000CFB  6C01                                 LDV,R6   1
          1 000CFC  EF47 0021                            STR,R6   VDH_FLG,AUTO

     1201    24038    1           BFR$=OTPBFR$;

  24038   1 000CFE  BCC7 0006                            LDB,B3   @PARAMETER2,AUTO
          1 000D00  AC83                                 LDB,B2   ,B3
          1 000D01  AFC7 0015                            STB,B2   BFR$,AUTO

     1202    24039    1           CALL RELOTPBFR;

  24039   1 000D03  E3C0 0167                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:213  
          1 000D05       0001                            DC       s:24040,PREL

     1203    24040    1           RETURN;

  24040   1 000D06  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1204    24041        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:214  
     1205    24042        /* KZV$RLSCTX - Release Context */
     1206    24043
     1207    24044    1   KZV$RLSCTX: ENTRY(PARAMETER1) ALTRET;

  24044   1 000D09  D380 0000 0000  xent KZV$RLSCTX      LNJ,B5   X6A_AUTO_2
          1 000D0C       009F 0002                       DC       159,2

     1208    24045
     1209    24046    1           DEV$=ADDR(DEVCTX);

  24046   1 000D0E  ECC7 0004                            LDB,B6   @PARAMETER1,AUTO
          1 000D10  EFC7 000D                            STB,B6   DEV$,AUTO

     1210    24047    1           KZ$3270DEV.VDI$=ADDR(NIL);

  24047   1 000D12  DB80 0000 0000                       LAB,B5   0
          1 000D15  DFC6 0004                            STB,B5   4,B6

     1211    24048    1           VDH_FLG=1;                      /* ALREADY IN VDH                     */

  24048   1 000D17  6C01                                 LDV,R6   1
          1 000D18  EF47 0021                            STR,R6   VDH_FLG,AUTO

     1212    24049    1           CTR$=KZ$3270DEV.CTR$;

  24049   1 000D1A  CCC6 0002                            LDB,B4   2,B6
          1 000D1C  CFC7 000B                            STB,B4   CTR$,AUTO

     1213    24050    1           LIN$=KZ$3270CTR.LIN$;

  24050   1 000D1E  BCC4 0004                            LDB,B3   4,B4
          1 000D20  BFC7 0009                            STB,B3   LIN$,AUTO

     1214    24051    1           CALL RLS_DEV;

  24051   1 000D22  E3C0 0324                            LNJ,B6   s:0,PREL
          1 000D24       0001                            DC       s:24052,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:215  

     1215    24052    1           RETURN;

  24052   1 000D25  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1216    24053        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:216  
     1217    24054        /* Find controller context */
     1218    24055
     1219    24056    1   FND_CTR: PROC ALTRET;

  24056   1 000D28  EFC7 0070            FND_CTR         STB,B6   CP_PHLEGM+5,AUTO

     1220    24057
     1221    24058    2           IF I>31 THEN

  24058   1 000D2A  E847 0013                            LDR,R6   CNT,AUTO
          1 000D2C  6D1F                                 CMV,R6   31
          1 000D2D  0381 000C                            BLE      s:24063,PREL

     1222    24059    3           DO;                             /* Got a bad controller number        */

     1223    24060    3   ERRDEV:    CALL ERRLOG(%E$BADADR);

  24060   1 000D2F  EBF0 00CB            ERRDEV          LAB,B6   203,IMO
          1 000D31  EFC7 007A                            STB,B6   I+4,AUTO
          1 000D33  E3C0 08F3                            LNJ,B6   s:0,PREL
          1 000D35       0001                            DC       s:24061,PREL

     1224    24061    3              ALTRETURN;

  24061   1 000D36  ECC7 0070                            LDB,B6   CP_PHLEGM+5,AUTO
          1 000D38  B806                                 LDR,R3   ,B6
          1 000D39  C3B6                                 LNJ,B4   ,B6,R3

     1225    24062    3              END;
     1226    24063    2           CTR$=KZ$LINCTX.CTRHD$;

  24063   1 000D3A  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000D3C  CC85                                 LDB,B4   ,B5
          1 000D3D  CFC7 000B                            STB,B4   CTR$,AUTO

     1227    24064    3           DO WHILE(CTR$~=ADDR(NIL));

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:217  
  24064   1 000D3F  0F81 0010                            B        s:24068,PREL

     1228    24065    3              IF KZ$3270CTR.ADR=I THEN

  24065   1 000D41  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 000D43  E2C6 000A                            LLH,R6   10,B6
          1 000D45  E947 0013                            CMR,R6   CNT,AUTO
          1 000D47  0981 0005                            BNE      s:24067,PREL

     1229    24066    3                 RETURN;

  24066   1 000D49  ECC7 0070                            LDB,B6   CP_PHLEGM+5,AUTO
          1 000D4B  C3C6 0001                            LNJ,B4   1,B6

     1230    24067    3              CTR$=KZ$3270CTR.LNK$;

  24067   1 000D4D  DC86                                 LDB,B5   ,B6
          1 000D4E  DFC7 000B                            STB,B5   CTR$,AUTO

     1231    24068    3              END;

  24068   1 000D50  8DC7 000B                            CMN      CTR$,AUTO
          1 000D52  09EF                                 BNE      s:24065,SPREL

     1232    24069    2           GOTO ERRDEV;

  24069   1 000D53  0FDC                                 B        s:24059,SPREL

     1233    24070
     1234    24071        /* Find device context given controller context */
     1235    24072
     1236    24073    2   FND_DEV: ENTRY ALTRET;

  24073   1 000D54  EFC7 0070            FND_DEV         STB,B6   CP_PHLEGM+5,AUTO

     1237    24074
     1238    24075    2           IF J>31 THEN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:218  

  24075   1 000D56  E847 0014                            LDR,R6   J,AUTO
          1 000D58  6D1F                                 CMV,R6   31
          1 000D59  0356                                 BG       s:24059,SPREL

     1239    24076    2              GOTO ERRDEV;
     1240    24077    2           DEV$=KZ$3270CTR.DEVHD$;

  24077   1 000D5A  DCC7 000B                            LDB,B5   CTR$,AUTO
          1 000D5C  CCC5 0002                            LDB,B4   2,B5
          1 000D5E  CFC7 000D                            STB,B4   DEV$,AUTO

     1241    24078    3           DO WHILE(DEV$~=ADDR(NIL));

  24078   1 000D60  0F81 0010                            B        s:24082,PREL

     1242    24079    3              IF KZ$3270DEV.ADR=J THEN

  24079   1 000D62  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000D64  E2C6 0015                            LLH,R6   21,B6
          1 000D66  E947 0014                            CMR,R6   J,AUTO
          1 000D68  0981 0005                            BNE      s:24081,PREL

     1243    24080    3                 RETURN;

  24080   1 000D6A  ECC7 0070                            LDB,B6   CP_PHLEGM+5,AUTO
          1 000D6C  C3C6 0001                            LNJ,B4   1,B6

     1244    24081    3              DEV$=KZ$3270DEV.LNK$;

  24081   1 000D6E  DC86                                 LDB,B5   ,B6
          1 000D6F  DFC7 000D                            STB,B5   DEV$,AUTO

     1245    24082    3              END;

  24082   1 000D71  8DC7 000D                            CMN      DEV$,AUTO
          1 000D73  09EF                                 BNE      s:24079,SPREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:219  

     1246    24083    2           GOTO ERRDEV;

  24083   1 000D74  0F81 FFBA                            B        s:24059,PREL

     1247    24084    2   END FND_CTR;
     1248    24085        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:220  
     1249    24086        /* Find device context */
     1250    24087
     1251    24088    1   FND_CTX: PROC ALTRET;

  24088   1 000D76  EFC7 006E            FND_CTX         STB,B6   CP_PHLEGM+3,AUTO

     1252    24089
     1253    24090
     1254    24091        /*N* KLUDGE UNTIL PL6 FIXED */
     1255    24092    2           STATUS=KZ$LINCTX.INPBFR$->BIT16(0)&'3F3F'X;

  24092   1 000D78  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000D7A  CCC5 0056                            LDB,B4   86,B5
          1 000D7C  E804                                 LDR,R6   ,B4
          1 000D7D  E570 3F3F                            AND,R6   16191,IMO
          1 000D7F  EF47 001A                            STR,R6   STATUS,AUTO

     1256    24093    2           I=STATUSB.I;

  24093   1 000D81  D2C7 001A                            LLH,R5   STATUS,AUTO
          1 000D83  DF47 0013                            STR,R5   CNT,AUTO

     1257    24094    2           J=STATUSB.J;

  24094   1 000D85  C847 001A                            LDR,R4   STATUS,AUTO
          1 000D87  C570 00FF                            AND,R4   255,IMO
          1 000D89  CF47 0014                            STR,R4   J,AUTO

     1258    24095
     1259    24096    2           CALL FND_CTR ALTRET(NO_SUCH_ANIMAL);

  24096   1 000D8B  E3C0 FF9C                            LNJ,B6   s:0,PREL
          1 000D8D       0014                            DC       s:24103,PREL

     1260    24097    2           KZ$LINCTX.CURCTR$=CTR$;

  24097   1 000D8E  ECC7 000B                            LDB,B6   CTR$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:221  
          1 000D90  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000D92  EFC5 004E                            STB,B6   78,B5

     1261    24098    2           CALL FND_DEV ALTRET(NO_SUCH_ANIMAL);

  24098   1 000D94  E3C0 FFBF                            LNJ,B6   s:0,PREL
          1 000D96       000B                            DC       s:24103,PREL

     1262    24099    2           KZ$LINCTX.CURDEV$=DEV$;

  24099   1 000D97  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000D99  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000D9B  EFC5 0050                            STB,B6   80,B5

     1263    24100    2           RETURN;

  24100   1 000D9D  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 000D9F  C3C6 0001                            LNJ,B4   1,B6

     1264    24101
     1265    24102    2   NO_SUCH_ANIMAL:
     1266    24103    2           ALTRETURN;

  24103   1 000DA1  ECC7 006E            NO_SUCH_ANIMAL  LDB,B6   CP_PHLEGM+3,AUTO
          1 000DA3  B806                                 LDR,R3   ,B6
          1 000DA4  C3B6                                 LNJ,B4   ,B6,R3

     1267    24104
     1268    24105    2   END FND_CTX;
     1269    24106        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:222  
     1270    24107        /* Build device context */
     1271    24108
     1272    24109    1   BLD_DEV_CTX: PROC ALTRET;

  24109   1 000DA5  EFC7 006E            BLD_DEV_CTX     STB,B6   CP_PHLEGM+3,AUTO

     1273    24110
     1274    24111    2           SZ=SIZEW(KZ$3270DEV);

  24111   1 000DA7  6C1C                                 LDV,R6   28
          1 000DA8  EF47 001B                            STR,R6   SZ,AUTO

     1275    24112    2           CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);

  24112   1 000DAA  DBC7 000F                            LAB,B5   T$,AUTO
          1 000DAC  DFC7 0094                            STB,B5   @DFRD+24,AUTO
          1 000DAE  CBC7 001B                            LAB,B4   SZ,AUTO
          1 000DB0  CFC7 0092                            STB,B4   @DFRD+22,AUTO
          1 000DB2  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000DB4  CBF0 0200                            LAB,B4   512,IMO
          1 000DB6  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 000DB9       0045                            DC       s:24129,PREL

     1276    24113    2          KZ$3270STT.KHSTT.CTXBYTUTL = KZ$3270STT.KHSTT.CTXBYTUTL + SIZEC(KZ$3270DEV);

  24113   1 000DBA  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 000DBD  8CC6 0020                            LDI      32,B6
          1 000DBF  8470 0000 0038                       AID      56,IMO
          1 000DC2  8D46 0020                            SDI      32,B6

     1277    24114    2           DEV$=T$;

  24114   1 000DC4  DCC7 000F                            LDB,B5   T$,AUTO
          1 000DC6  DFC7 000D                            STB,B5   DEV$,AUTO

     1278    24115    2           KZ$LINCTX.CURDEV$=DEV$;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:223  
  24115   1 000DC8  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 000DCA  DFC4 0050                            STB,B5   80,B4

     1279    24116    2           KZ$3270DEV=KZ_3270DEV;

  24116   1 000DCC  AB80 0000 0000  00                   LAB,B2   POLADR_B
          1 000DCF  2C56                                 LDV,R2   86
          1 000DD0  6C38                                 LDV,R6   56
          1 000DD1  BB85                                 LAB,B3   ,B5
          1 000DD2  3C00                                 LDV,R3   0
          1 000DD3  0008                                 MMM

     1280    24117    2           KZ$3270DEV.CTR$=CTR$;

  24117   1 000DD4  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 000DD6  CCC7 000D                            LDB,B4   DEV$,AUTO
          1 000DD8  EFC4 0002                            STB,B6   2,B4

     1281    24118    2           KZ$3270DEV.ADR=J;

  24118   1 000DDA  E847 0014                            LDR,R6   J,AUTO
          1 000DDC  E7C4 0015                            STH,R6   21,B4

     1282    24119    2           KZ$3270DEV.ROWS=KZ$3270CTR.ROWS;

  24119   1 000DDE  D846 0009                            LDR,R5   9,B6
          1 000DE0  D570 00FF                            AND,R5   255,IMO
          1 000DE2  D7C4 0017                            STH,R5   23,B4

     1283    24120    2           KZ$3270DEV.COLS=KZ$3270CTR.COLS;

  24120   1 000DE4  D2C6 0009                            LLH,R5   9,B6
          1 000DE6  DAC4 0017                            SRM,R5,'00FF'X    23,B4
          1 000DE8       00FF

     1284    24121    2           IF KZ$3270CTR.TYP=3276 THEN

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:224  
  24121   1 000DE9  D846 0008                            LDR,R5   8,B6
          1 000DEB  D970 0CCC                            CMR,R5   3276,IMO
          1 000DED  0981 0004                            BNE      s:24123,PREL

     1285    24122    2              KZ$3270DEV.EWALT='1'B;

  24122   1 000DEF  8944 0012                            LBT,'2000'X       18,B4
  24122   1 000DF1       2000

     1286    24123    2           KZ$3270DEV.LNK$=KZ$3270CTR.DEVHD$;

  24123   1 000DF2  ACC6 0002                            LDB,B2   2,B6
          1 000DF4  AF84                                 STB,B2   ,B4

     1287    24124    2           KZ$3270CTR.DEVHD$=DEV$;

  24124   1 000DF5  CFC6 0002                            STB,B4   2,B6

     1288    24125    2           CALL SET_PRO;

  24125   1 000DF7  E3C0 0061                            LNJ,B6   s:0,PREL
          1 000DF9       0001                            DC       s:24126,PREL

     1289    24126    2           RETURN;

  24126   1 000DFA  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 000DFC  C3C6 0001                            LNJ,B4   1,B6

     1290    24127
     1291    24128    2   NO_MEMORY:
     1292    24129    2           ALTRETURN;

  24129   1 000DFE  ECC7 006E            NO_MEMORY       LDB,B6   CP_PHLEGM+3,AUTO
          1 000E00  B806                                 LDR,R3   ,B6
          1 000E01  C3B6                                 LNJ,B4   ,B6,R3

     1293    24130
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:225  
     1294    24131    2   END BLD_DEV_CTX;
     1295    24132        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:226  
     1296    24133        /* Build controller context */
     1297    24134
     1298    24135    1   BLD_CTR_CTX: PROC ALTRET;

  24135   1 000E02  EFC7 006E            BLD_CTR_CTX     STB,B6   CP_PHLEGM+3,AUTO

     1299    24136
     1300    24137    2           SZ=SIZEW(KZ$3270CTR);

  24137   1 000E04  6C0B                                 LDV,R6   11
          1 000E05  EF47 001B                            STR,R6   SZ,AUTO

     1301    24138    2           CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);

  24138   1 000E07  DBC7 000F                            LAB,B5   T$,AUTO
          1 000E09  DFC7 0094                            STB,B5   @DFRD+24,AUTO
          1 000E0B  CBC7 001B                            LAB,B4   SZ,AUTO
          1 000E0D  CFC7 0092                            STB,B4   @DFRD+22,AUTO
          1 000E0F  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000E11  CBF0 0200                            LAB,B4   512,IMO
          1 000E13  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 000E16       003F                            DC       s:24155,PREL

     1302    24139    2          KZ$3270STT.KHSTT.CTXBYTUTL = KZ$3270STT.KHSTT.CTXBYTUTL + SIZEC(KZ$3270CTR);

  24139   1 000E17  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 000E1A  8CC6 0020                            LDI      32,B6
          1 000E1C  8470 0000 0016                       AID      22,IMO
          1 000E1F  8D46 0020                            SDI      32,B6

     1303    24140    2           CTR$=T$;

  24140   1 000E21  DCC7 000F                            LDB,B5   T$,AUTO
          1 000E23  DFC7 000B                            STB,B5   CTR$,AUTO

     1304    24141    2           KZ$3270CTR=KZ_3270CTR;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:227  
  24141   1 000E25  AB80 0000 0000  00                   LAB,B2   POLADR_B
          1 000E28  2C40                                 LDV,R2   64
          1 000E29  6C16                                 LDV,R6   22
          1 000E2A  BB85                                 LAB,B3   ,B5
          1 000E2B  3C00                                 LDV,R3   0
          1 000E2C  0008                                 MMM

     1305    24142    2           P1$=ADDR(NIL);

  24142   1 000E2D  EB80 0000 0000                       LAB,B6   0
          1 000E30  EFC7 0011                            STB,B6   P1$,AUTO

     1306    24143    2           T$=KZ$LINCTX.CTRHD$;

  24143   1 000E32  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 000E34  AC84                                 LDB,B2   ,B4
          1 000E35  AFC7 000F                            STB,B2   T$,AUTO

     1307    24144    3           DO WHILE(T$~=ADDR(NIL));

  24144   1 000E37  0F81 0008                            B        s:24147,PREL

     1308    24145    3              P1$=T$;

  24145   1 000E39  ECC7 000F                            LDB,B6   T$,AUTO
          1 000E3B  EFC7 0011                            STB,B6   P1$,AUTO

     1309    24146    3              T$=T$->KZ$3270CTR.LNK$;

  24146   1 000E3D  DC86                                 LDB,B5   ,B6
          1 000E3E  DFC7 000F                            STB,B5   T$,AUTO

     1310    24147    3              END;

  24147   1 000E40  8DC7 000F                            CMN      T$,AUTO
          1 000E42  09F7                                 BNE      s:24145,SPREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:228  
     1311    24148    2           IF P1$~=ADDR(NIL) THEN

  24148   1 000E43  8DC7 0011                            CMN      P1$,AUTO
          1 000E45  0901 0006                            BE       s:24151,PREL

     1312    24149    2              P1$->KZ$3270CTR.LNK$=CTR$;

  24149   1 000E47  DCC7 000B                            LDB,B5   CTR$,AUTO
          1 000E49  DF86                                 STB,B5   ,B6
          1 000E4A  0F81 0006                            B        s:24152,PREL

     1313    24150    2           ELSE
     1314    24151    2              KZ$LINCTX.CTRHD$=CTR$;

  24151   1 000E4C  DCC7 000B                            LDB,B5   CTR$,AUTO
          1 000E4E  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 000E50  DF84                                 STB,B5   ,B4

     1315    24152    2           RETURN;

  24152   1 000E51  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 000E53  C3C6 0001                            LNJ,B4   1,B6

     1316    24153
     1317    24154    2   NO_MEMORY:
     1318    24155    2           ALTRETURN;

  24155   1 000E55  ECC7 006E            NO_MEMORY       LDB,B6   CP_PHLEGM+3,AUTO
          1 000E57  B806                                 LDR,R3   ,B6
          1 000E58  C3B6                                 LNJ,B4   ,B6,R3

     1319    24156
     1320    24157    2   END BLD_CTR_CTX;
     1321    24158        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:229  
     1322    24159        /* Initialize the PRO field in the dev context */
     1323    24160
     1324    24161    1   SET_PRO: PROC;

  24161   1 000E59  EFC7 0072            SET_PRO         STB,B6   @RSN+2,AUTO

     1325    24162
     1326    24163    2           KZ$3270DEV.PRO='0'B;

  24163   1 000E5B  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 000E5D  87C5 0011                            CLH      17,B5

     1327    24164    2           IF KZ$3270DEV.EWALT THEN

  24164   1 000E5F  82C5 0012                            LB,'2000'X        18,B5
  24164   1 000E61       2000
          1 000E62  0581 0004                            BBF      s:24166,PREL

     1328    24165    2              KZ$3270DEV.PRO.EWALT='1'B;

  24165   1 000E64  8945 0011                            LBT,'8000'X       17,B5
  24165   1 000E66       8000

     1329    24166    2           RETURN;

  24166   1 000E67  ECC7 0072                            LDB,B6   @RSN+2,AUTO
          1 000E69  C3C6 0001                            LNJ,B4   1,B6

     1330    24167    2   END SET_PRO;
     1331    24168        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:230  
     1332    24169        /* RELOTPBFR - Release output buffer chain */
     1333    24170
     1334    24171    1   RELOTPBFR: PROC;

  24171   1 000E6B  EFC7 0074            RELOTPBFR       STB,B6   O_11011_O+1,AUTO

     1335    24172
     1336    24173    2   DCL I UBIN;
     1337    24174
     1338    24175    2           TBFR$=KZ$LINCTX.OTPHD$;

  24175   1 000E6D  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 000E6F  CCC5 0052                            LDB,B4   82,B5
          1 000E71  CFC7 0018                            STB,B4   TBFR$,AUTO

     1339    24176    3           DO WHILE(TBFR$~=ADDR(NIL));

  24176   1 000E73  0F81 000C                            B        s:24180,PREL

     1340    24177    3              IF TBFR$->KZ$OTPBFR.DEV$=DEV$ THEN

  24177   1 000E75  ECC7 0018                            LDB,B6   TBFR$,AUTO
          1 000E77  DCC6 0006                            LDB,B5   6,B6
          1 000E79  DDC7 000D                            CMB,B5   DEV$,AUTO
          1 000E7B  0901 000C                            BE       s:24185,PREL

     1341    24178    3                 GOTO MORE_OTP;
     1342    24179    3              TBFR$=TBFR$->KZ$OTPBFR.LNK$;

  24179   1 000E7D  CC86                                 LDB,B4   ,B6
          1 000E7E  CFC7 0018                            STB,B4   TBFR$,AUTO

     1343    24180    3              END;

  24180   1 000E80  8DC7 0018                            CMN      TBFR$,AUTO
          1 000E82  09F3                                 BNE      s:24177,SPREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:231  
     1344    24181    2           KZ$3270DEV.OTPBSY='0'B;         /* No more for this dev               */

  24181   1 000E83  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000E85  8846 0012                            LBF,'0400'X       18,B6
          1 000E87       0400

     1345    24182
     1346    24183    2   MORE_OTP:
     1347    24184
     1348    24185    2           CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);

  24185   1 000E88  EBC7 0020            MORE_OTP        LAB,B6   DFRD,AUTO
          1 000E8A  EFC7 007C                            STB,B6   @VDI$+2,AUTO
          1 000E8C  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 000E8E  CBC5 0004                            LAB,B4   4,B5
          1 000E90  CFC7 007A                            STB,B4   I+4,AUTO
          1 000E92  E3C0 08A9                            LNJ,B6   s:0,PREL
          1 000E94       0001                            DC       s:24186,PREL

     1349    24186    3           IF DFRD THEN DO;                /* Can't get to VDH now               */

  24186   1 000E95  89C7 0020                            CMZ      DFRD,AUTO
          1 000E97  0881 0020                            BAGE     s:24196,PREL

     1350    24187    3              IF KZ$3270DEV.DFRTL$~=ADDR(NIL) THEN

  24187   1 000E99  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000E9B  8DC6 000E                            CMN      14,B6
          1 000E9D  0901 0008                            BE       s:24190,PREL

     1351    24188    3                 KZ$3270DEV.DFRTL$->KZ$OTPBFR.LNK$=BFR$;

  24188   1 000E9F  DCC6 000E                            LDB,B5   14,B6
          1 000EA1  CCC7 0015                            LDB,B4   BFR$,AUTO
          1 000EA3  CF85                                 STB,B4   ,B5
          1 000EA4  0F81 0005                            B        s:24191,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:232  
     1352    24189    3              ELSE
     1353    24190    3                 KZ$3270DEV.DFRHD$=BFR$;

  24190   1 000EA6  DCC7 0015                            LDB,B5   BFR$,AUTO
          1 000EA8  DFC6 000C                            STB,B5   12,B6

     1354    24191    3              KZ$3270DEV.DFRTL$=BFR$;

  24191   1 000EAA  DCC7 0015                            LDB,B5   BFR$,AUTO
          1 000EAC  DFC6 000E                            STB,B5   14,B6

     1355    24192    3              KZ$OTPBFR.LNK$=ADDR(NIL);

  24192   1 000EAE  CB80 0000 0000                       LAB,B4   0
          1 000EB1  BCC7 0015                            LDB,B3   BFR$,AUTO
          1 000EB3  CF83                                 STB,B4   ,B3

     1356    24193    3              RETURN;

  24193   1 000EB4  ECC7 0074                            LDB,B6   O_11011_O+1,AUTO
          1 000EB6  C3C6 0001                            LNJ,B4   1,B6

     1357    24194    3              END;
     1358    24195
     1359    24196    2           IF KZ$3270DEV.OTPHD$=ADDR(NIL) AND KZ$3270DEV.DONE THEN

  24196   1 000EB8  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000EBA  8DC6 0008                            CMN      8,B6
          1 000EBC  0981 0015                            BNE      s:24200,PREL
          1 000EBE  82C6 0012                            LB,'0200'X        18,B6
          1 000EC0       0200
          1 000EC1  0581 0010                            BBF      s:24200,PREL

     1360    24197    2              IF NOT KZ$OTPBFR.FLAGS.RELOTPBFR THEN

  24197   1 000EC3  DCC7 0015                            LDB,B5   BFR$,AUTO
          1 000EC5  82C5 0002                            LB,'0002'X        2,B5
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:233  
          1 000EC7       0002
          1 000EC8  0501 0009                            BBT      s:24200,PREL

     1361    24198    2                 CALL KZT$CMPOTP(KZ$3270DEV); /* Make VDH give up buffer         */

  24198   1 000ECA  BBC7 000D                            LAB,B3   DEV$,AUTO
          1 000ECC  CBF0 0100                            LAB,B4   256,IMO
          1 000ECE  E380 0000 0000  xent                 LNJ,B6   KZT$CMPOTP
          1 000ED1       0001                            DC       s:24200,PREL

     1362    24199
     1363    24200    3           IF KZ$OTPBFR.MRKCNT~=0 THEN DO; /* Output markers                     */

  24200   1 000ED2  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 000ED4  82C6 0005                            LB,'00FF'X        5,B6
          1 000ED6       00FF
          1 000ED7  0581 004C                            BBF      s:24213,PREL

     1364    24201    3              TBFR$=PINCRW(BFR$,KZ_3270_BFRSIZ(KZ$OTPBFR.BFRSIZ)-

  24201   1 000ED9  B846 0004                            LDR,R3   4,B6
          1 000EDB  A830 0000 0000  xsym                 LDR,R2   KZ_3270_BFRSIZ,R3
          1 000EDE  F852                                 LDR,R7   R2
          1 000EDF  6C00                                 LDV,R6   0
          1 000EE0  8447 0015                            AID      BFR$,AUTO
          1 000EE2  8470 FFFF FFFD                       AID      -3,IMO
          1 000EE5  8D47 0018                            SDI      TBFR$,AUTO

     1365    24202    3                SIZEW(KV$OTPMRK));
     1366    24203    4              DO WHILE(KZ$OTPBFR.MRKCNT~=0);

  24203   1 000EE7  82C6 0005                            LB,'00FF'X        5,B6
  24203   1 000EE9       00FF
          1 000EEA  0581 0039                            BBF      s:24213,PREL

     1367    24204    4                 KV$VDH_OTPMRK=KV_VDH_OTPMRK;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:234  
  24204   1 000EEC  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_OTPMRK
          1 000EEF  2C00                                 LDV,R2   0
          1 000EF0  6C0A                                 LDV,R6   10
          1 000EF1  BBC7 0054                            LAB,B3   KV$VDH_OTPMRK,AUTO
          1 000EF3  3C00                                 LDV,R3   0
          1 000EF4  0008                                 MMM

     1368    24205    4                 KV$VDH_OTPMRK.DAT=TBFR$->KV$OTPMRK;

  24205   1 000EF5  ACC7 0018                            LDB,B2   TBFR$,AUTO
          1 000EF7  2C00                                 LDV,R2   0
          1 000EF8  6C06                                 LDV,R6   6
          1 000EF9  BBC7 0055                            LAB,B3   KV$VDH_OTPMRK+1,AUTO
          1 000EFB  3C00                                 LDV,R3   0
          1 000EFC  0008                                 MMM

     1369    24206    4                 KV$VDH_OTPMRK.CMPCOD=KZ$OTPBFR.CMPCOD;

  24206   1 000EFD  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 000EFF  E2C6 0005                            LLH,R6   5,B6
          1 000F01  EF47 0058                            STR,R6   KV$VDH_OTPMRK+4,AUTO

     1370    24207    4                 CALL KVV$VDI(KV$VDH_OTPMRK);

  24207   1 000F03  DBC7 0054                            LAB,B5   KV$VDH_OTPMRK,AUTO
          1 000F05  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 000F07  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000F09  CBF0 0100                            LAB,B4   256,IMO
          1 000F0B  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000F0E       0001                            DC       s:24208,PREL

     1371    24208    4                 TBFR$=PINCRW(TBFR$,-SIZEW(KV$OTPMRK));

  24208   1 000F0F  ECC7 0018                            LDB,B6   TBFR$,AUTO
          1 000F11  DBC6 FFFD                            LAB,B5   -3,B6
          1 000F13  DFC7 0018                            STB,B5   TBFR$,AUTO

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:235  
     1372    24209    4                 KZ$OTPBFR.MRKCNT=KZ$OTPBFR.MRKCNT-1;

  24209   1 000F15  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 000F17  E846 0005                            LDR,R6   5,B6
          1 000F19  EA70 00FF                            ADD,R6   255,IMO
          1 000F1B  EAC6 0005                            SRM,R6,'00FF'X    5,B6
          1 000F1D       00FF

     1373    24210    4                 END;

  24210   1 000F1E  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 000F20  82C6 0005                            LB,'00FF'X        5,B6
          1 000F22       00FF
          1 000F23  0549                                 BBT      s:24204,SPREL

     1374    24211    3              END;

     1375    24212
     1376    24213    2           IF KZ$OTPBFR.FLAGS.CNT# THEN

  24213   1 000F24  82C6 0002                            LB,'0020'X        2,B6
  24213   1 000F26       0020
          1 000F27  0581 0009                            BBF      s:24215,PREL

     1377    24214    2              KZ$3270DEV.OTPBYTES=KZ$3270DEV.OTPBYTES-KZ$OTPBFR.DATA_SIZ;

  24214   1 000F29  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 000F2B  E845 0014                            LDR,R6   20,B5
          1 000F2D  E246 0003                            SUB,R6   3,B6
          1 000F2F  EF45 0014                            STR,R6   20,B5

     1378    24215    2           IF KZ$3270DEV.OTPBYTES~=0 AND KZ$3270DEV.OTPHD$=ADDR(NIL) AND

  24215   1 000F31  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000F33  E846 0014                            LDR,R6   20,B6
          1 000F35  6901 0019                            BEZ,R6   s:24220,PREL
          1 000F37  8DC6 0008                            CMN      8,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:236  
          1 000F39  0981 0015                            BNE      s:24220,PREL
          1 000F3B  82C6 0012                            LB,'0400'X        18,B6
          1 000F3D       0400
          1 000F3E  0501 0010                            BBT      s:24220,PREL
          1 000F40  8DC6 000C                            CMN      12,B6
          1 000F42  0981 000C                            BNE      s:24220,PREL

     1379    24216    3             NOT KZ$3270DEV.OTPBSY AND KZ$3270DEV.DFRHD$=ADDR(NIL) THEN DO;

     1380    24217    3              CALL ERRLOG(%E$THRERR);

  24217   1 000F44  DBF0 00C9                            LAB,B5   201,IMO
          1 000F46  DFC7 007A                            STB,B5   I+4,AUTO
          1 000F48  E3C0 06DE                            LNJ,B6   s:0,PREL
          1 000F4A       0001                            DC       s:24218,PREL

     1381    24218    3              KZ$3270DEV.OTPBYTES=0;

  24218   1 000F4B  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000F4D  8746 0014                            CL       20,B6

     1382    24219    3              END;

     1383    24220    3           IF KZ$3270DEV.THROTL AND KZ$3270DEV.OTPBYTES<=KZT_THRTL_UNBLK THEN DO;

  24220   1 000F4F  82C6 0012                            LB,'1000'X        18,B6
  24220   1 000F51       1000
          1 000F52  0581 0020                            BBF      s:24242,PREL
          1 000F54  E846 0014                            LDR,R6   20,B6
          1 000F56  E900 0000 0000  xsym                 CMR,R6   KZT_THRTL_UNBLK
          1 000F59  0301 0019                            BG       s:24242,PREL

     1384    24221    3              KZ$3270DEV.THROTL='0'B;

  24221   1 000F5B  8846 0012                            LBF,'1000'X       18,B6
  24221   1 000F5D       1000

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:237  
     1385    24222                   %KV$RQSOTP (RQSOTP=YES);
             24234    4           IF NOT KV$PTR.VDI$->KV$VDI.RQSOTP  THEN DO;

  24234   1 000F5E  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000F61  CC85                                 LDB,B4   ,B5
          1 000F62  82C4 0019                            LB,'0008'X        25,B4
          1 000F64       0008
          1 000F65  0501 000D                            BBT      s:24242,PREL

             24235    4              KV$PTR.VDI$->KV$VDI.RQSOTP = '1'B;

  24235   1 000F67  8944 0019                            LBT,'0008'X       25,B4
  24235   1 000F69       0008

             24236    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);

  24236   1 000F6A  BB80 0000 0001  02                   LAB,B3   +1
          1 000F6D  CBF0 0100                            LAB,B4   256,IMO
          1 000F6F  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000F72       0001                            DC       s:24242,PREL

             24237    4              END;                         /* END IF                             */

     1386    24240    3              END;

     1387    24241
     1388    24242    2           T$=BFR$;

  24242   1 000F73  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 000F75  EFC7 000F                            STB,B6   T$,AUTO

     1389    24243    2           I=KZ_3270_BFRSIZ(KZ$OTPBFR.BFRSIZ);

  24243   1 000F77  B846 0004                            LDR,R3   4,B6
          1 000F79  E830 0000 0000  xsym                 LDR,R6   KZ_3270_BFRSIZ,R3
          1 000F7C  EF47 0076                            STR,R6   I,AUTO

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:238  
     1390    24244    2           KZ$3270STT.KHSTT.OTPBFRBYTUTL = KZ$3270STT.KHSTT.OTPBFRBYTUTL - I*2;

  24244   1 000F7E  DC80 0000 0006  xsym                 LDB,B5   KZ_3270M_HDR+6
          1 000F81  F856                                 LDR,R7   R6
          1 000F82  6C00                                 LDV,R6   0
          1 000F83  7081                                 DOL,R7   1
          1 000F84  8656                                 CPL      R6
          1 000F85  8657                                 CPL      R7
          1 000F86  8470 0000 0001                       AID      1,IMO
          1 000F89  8445 001E                            AID      30,B5
          1 000F8B  8D45 001E                            SDI      30,B5

     1391    24245    2           CALL KVB$RLS2NSYS(I,T$);

  24245   1 000F8D  CBC7 000F                            LAB,B4   T$,AUTO
          1 000F8F  CFC7 0094                            STB,B4   @DFRD+24,AUTO
          1 000F91  BBC7 0076                            LAB,B3   I,AUTO
          1 000F93  BFC7 0092                            STB,B3   @DFRD+22,AUTO
          1 000F95  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 000F97  CBF0 0200                            LAB,B4   512,IMO
          1 000F99  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          1 000F9C       0001                            DC       s:24247,PREL

     1392    24246
     1393    24247    2           IF KZ$3270DEV.DSC.VDH_FINAL AND KZ$3270DEV.OTPHD$=ADDR(NIL)

  24247   1 000F9D  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000F9F  82C6 0015                            LB,'0020'X        21,B6
          1 000FA1       0020
          1 000FA2  0581 0010                            BBF      s:24253,PREL
          1 000FA4  8DC6 0008                            CMN      8,B6
          1 000FA6  0981 000C                            BNE      s:24253,PREL
          1 000FA8  82C6 0012                            LB,'0400'X        18,B6
          1 000FAA       0400
          1 000FAB  0501 0007                            BBT      s:24253,PREL

     1394    24248    3             AND NOT KZ$3270DEV.OTPBSY THEN DO;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:239  

     1395    24249    3              KZ$3270DEV.DSC.DEV_FINAL='1'B; /* All output drained               */

  24249   1 000FAD  8946 0015                            LBT,'0010'X       21,B6
  24249   1 000FAF       0010

     1396    24250    3              CALL DSC_DEV_FINAL;

  24250   1 000FB0  E3C0 03D4                            LNJ,B6   s:0,PREL
          1 000FB2       0001                            DC       s:24253,PREL

     1397    24251    3              END;

     1398    24252
     1399    24253    2           CALL EXIT_VDH (KZ$3270DEV.VDI$);

  24253   1 000FB3  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 000FB5  DBC6 0004                            LAB,B5   4,B6
          1 000FB7  DFC7 007A                            STB,B5   I+4,AUTO
          1 000FB9  E3C0 07E2                            LNJ,B6   s:0,PREL
          1 000FBB       0001                            DC       s:24255,PREL

     1400    24254
     1401    24255    2           RETURN;

  24255   1 000FBC  ECC7 0074                            LDB,B6   O_11011_O+1,AUTO
          1 000FBE  C3C6 0001                            LNJ,B4   1,B6

     1402    24256
     1403    24257    2   END RELOTPBFR;
     1404    24258        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:240  
     1405    24259        /* Requeue current output back onto device queue */
     1406    24260
     1407    24261    1   REQUEUE: PROC;

  24261   1 000FC0  EFC7 006E            REQUEUE         STB,B6   CP_PHLEGM+3,AUTO

     1408    24262    2   DCL B$ PTR;
     1409    24263    2   DCL X_00100_X UBIN;
     1410    24264    2   DCL O_11011_O PTR;
     1411    24265
     1412    24266    2           T$=DEV$;

  24266   1 000FC2  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 000FC4  DFC7 000F                            STB,B5   T$,AUTO

     1413    24267    2           IF KZ$LINCTX.PRO.SLAVE THEN

  24267   1 000FC6  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 000FC8  89C4 004B                            CMZ      75,B4
          1 000FCA  0881 0030                            BAGE     s:24284,PREL

     1414    24268    3           DO;                             /* SLAVE                              */

     1415    24269    4              DO WHILE (KZ$LINCTX.OTPHD$ ~= ADDR(NIL));

  24269   1 000FCC  0F81 0027                            B        s:24281,PREL

     1416    24270    4                 DEV$=KZ$LINCTX.OTPHD$->KZ$OTPBFR.DEV$;

  24270   1 000FCE  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000FD0  DCC6 0052                            LDB,B5   82,B6
          1 000FD2  CCC5 0006                            LDB,B4   6,B5
          1 000FD4  CFC7 000D                            STB,B4   DEV$,AUTO

     1417    24271    4                 B$=KZ$LINCTX.OTPHD$;

  24271   1 000FD6  DFC7 0070                            STB,B5   B$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:241  

     1418    24272    4                 KZ$LINCTX.OTPHD$=KZ$LINCTX.OTPHD$->KZ$OTPBFR.LNK$;

  24272   1 000FD8  BC85                                 LDB,B3   ,B5
          1 000FD9  BFC6 0052                            STB,B3   82,B6

     1419    24273    4                 IF KZ$LINCTX.OTPHD$ = ADDR(NIL)

  24273   1 000FDB  8DC6 0052                            CMN      82,B6
          1 000FDD  0981 0006                            BNE      s:24275,PREL

     1420    24274    4                 THEN KZ$LINCTX.OTPTL$=ADDR(NIL);

  24274   1 000FDF  AB80 0000 0000                       LAB,B2   0
          1 000FE2  AFC6 0054                            STB,B2   84,B6

     1421    24275    4                 B$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;

  24275   1 000FE4  ACC4 0008                            LDB,B2   8,B4
          1 000FE6  AF85                                 STB,B2   ,B5

     1422    24276    4                 KZ$3270DEV.OTPHD$=B$;

  24276   1 000FE7  DFC4 0008                            STB,B5   8,B4

     1423    24277    4                 IF KZ$3270DEV.OTPTL$ = ADDR(NIL)

  24277   1 000FE9  8DC4 000A                            CMN      10,B4
          1 000FEB  0981 0003                            BNE      s:24279,PREL

     1424    24278    4                 THEN KZ$3270DEV.OTPTL$=B$;

  24278   1 000FED  DFC4 000A                            STB,B5   10,B4

     1425    24279    4                 KZ$3270DEV.OTPBSY='0'B;

  24279   1 000FEF  8844 0012                            LBF,'0400'X       18,B4
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:242  
  24279   1 000FF1       0400

     1426    24280    4                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;

  24280   1 000FF2  8AC6 004D                            INC      77,B6

     1427    24281    4                 END;

  24281   1 000FF4  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 000FF6  8DC6 0052                            CMN      82,B6
          1 000FF8  09D6                                 BNE      s:24270,SPREL

     1428    24282    3              END;

  24282   1 000FF9  0F81 0045                            B        s:24304,PREL

     1429    24283    2           ELSE
     1430    24284    2              IF KZ$LINCTX.OTPHD$ = ADDR(NIL) /* MASTER                          */

  24284   1 000FFB  8DC4 0052                            CMN      82,B4
          1 000FFD  0901 0041                            BE       s:24304,PREL

     1431    24285    2              THEN ;
     1432    24286    2              ELSE
     1433    24287    3              DO;

     1434    24288    3                 DEV$=KZ$LINCTX.OTPHD$->KZ$OTPBFR.DEV$;

  24288   1 000FFF  BCC4 0052                            LDB,B3   82,B4
          1 001001  ACC3 0006                            LDB,B2   6,B3
          1 001003  AFC7 000D                            STB,B2   DEV$,AUTO

     1435    24289    3                 X_00100_X=1;

  24289   1 001005  6C01                                 LDV,R6   1
          1 001006  EF47 0072                            STR,R6   X_00100_X,AUTO

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:243  
     1436    24290    3                 O_11011_O=KZ$LINCTX.OTPHD$;

  24290   1 001008  BFC7 0073                            STB,B3   O_11011_O,AUTO

     1437    24291    4                 DO WHILE (O_11011_O->KZ$OTPBFR.LNK$ ~= ADDR(NIL));

  24291   1 00100A  0F81 0008                            B        s:24294,PREL

     1438    24292    4                    X_00100_X=X_00100_X+1;

  24292   1 00100C  8AC7 0072                            INC      X_00100_X,AUTO

     1439    24293    4                    O_11011_O=O_11011_O->KZ$OTPBFR.LNK$;

  24293   1 00100E  ECC7 0073                            LDB,B6   O_11011_O,AUTO
          1 001010  DC86                                 LDB,B5   ,B6
          1 001011  DFC7 0073                            STB,B5   O_11011_O,AUTO

     1440    24294    4                    END;

  24294   1 001013  ECC7 0073                            LDB,B6   O_11011_O,AUTO
          1 001015  8D86                                 CMN      ,B6
          1 001016  09F6                                 BNE      s:24292,SPREL

     1441    24295    3                 KZ$LINCTX.OTPTL$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;

  24295   1 001017  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 001019  CCC5 0054                            LDB,B4   84,B5
          1 00101B  BCC7 000D                            LDB,B3   DEV$,AUTO
          1 00101D  ACC3 0008                            LDB,B2   8,B3
          1 00101F  AF84                                 STB,B2   ,B4

     1442    24296    3                 KZ$3270DEV.OTPHD$=KZ$LINCTX.OTPHD$;

  24296   1 001020  CCC5 0052                            LDB,B4   82,B5
          1 001022  CFC3 0008                            STB,B4   8,B3

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:244  
     1443    24297    3                 IF KZ$3270DEV.OTPTL$ = ADDR(NIL)

  24297   1 001024  8DC3 000A                            CMN      10,B3
          1 001026  0981 0005                            BNE      s:24299,PREL

     1444    24298    3                 THEN KZ$3270DEV.OTPTL$=KZ$LINCTX.OTPTL$;

  24298   1 001028  ACC5 0054                            LDB,B2   84,B5
          1 00102A  AFC3 000A                            STB,B2   10,B3

     1445    24299    3                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+X_00100_X;

  24299   1 00102C  E845 004D                            LDR,R6   77,B5
          1 00102E  EA47 0072                            ADD,R6   X_00100_X,AUTO
          1 001030  EF45 004D                            STR,R6   77,B5

     1446    24300    3                 KZ$LINCTX.OTPHD$=ADDR(NIL);

  24300   1 001032  CB80 0000 0000                       LAB,B4   0
          1 001035  CFC5 0052                            STB,B4   82,B5

     1447    24301    3                 KZ$LINCTX.OTPTL$=ADDR(NIL);

  24301   1 001037  AB80 0000 0000                       LAB,B2   0
          1 00103A  AFC5 0054                            STB,B2   84,B5

     1448    24302    3                 KZ$3270DEV.OTPBSY='0'B;

  24302   1 00103C  8843 0012                            LBF,'0400'X       18,B3
  24302   1 00103E       0400

     1449    24303    3                 END;

     1450    24304    2           DEV$=T$;

  24304   1 00103F  ECC7 000F                            LDB,B6   T$,AUTO
          1 001041  EFC7 000D                            STB,B6   DEV$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:245  

     1451    24305
     1452    24306    2           RETURN;

  24306   1 001043  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 001045  C3C6 0001                            LNJ,B4   1,B6

     1453    24307
     1454    24308    2   END REQUEUE;
     1455    24309        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:246  
     1456    24310        /* RLS_DEV - Release Device Context */
     1457    24311
     1458    24312    1   RLS_DEV: PROC;

  24312   1 001047  EFC7 006E            RLS_DEV         STB,B6   CP_PHLEGM+3,AUTO

     1459    24313
     1460    24314    2           IF KZ$3270DEV.VDI$~=ADDR(NIL) THEN

  24314   1 001049  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 00104B  8DC5 0004                            CMN      4,B5
          1 00104D  0901 0005                            BE       s:24316,PREL

     1461    24315    2              RETURN;

  24315   1 00104F  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 001051  C3C6 0001                            LNJ,B4   1,B6

     1462    24316    3           IF KZ$3270DEV.REACT THEN DO;

  24316   1 001053  82C5 001A                            LB,'0040'X        26,B5
  24316   1 001055       0040
          1 001056  0581 0007                            BBF      s:24320,PREL

     1463    24317    3              KZ$3270DEV.REACT='0'B;

  24317   1 001058  8845 001A                            LBF,'0040'X       26,B5
  24317   1 00105A       0040

     1464    24318    3              KZ$3270DEV.ACTIVE='1'B;

  24318   1 00105B  8945 0012                            LBT,'4000'X       18,B5
  24318   1 00105D       4000

     1465    24319    3              END;

     1466    24320    3           IF KZ$LINCTX.FLAGS.DSC THEN DO;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:247  

  24320   1 00105E  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 001060  82C6 0034                            LB,'1000'X        52,B6
          1 001062       1000
          1 001063  0581 002F                            BBF      s:24334,PREL

     1467    24321    4              DO CASE (KZ$LINCTX.DSC_LEV);

  24321   1 001065  B846 0085                            LDR,R3   133,B6
          1 001067  B570 00FF                            AND,R3   255,IMO
          1 001069  3D04                                 CMV,R3   4
          1 00106A  0281 002F                            BGE      s:24337,PREL
          1 00106C  A830 0000 1072  01                   LDR,R2   s:24321+13,R3
          1 00106F  83A0 0000 1076  01                   JMP      s:24323,R2
          1 001072       001B                            DC       s:24332,PREL
          1 001073       0000                            DC       s:24323,PREL
          1 001074       0005                            DC       s:24325,PREL
          1 001075       000F                            DC       s:24328,PREL

     1468    24322    4               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */

     1469    24323    4                 CALL REALLY_CLR_DEV;

  24323   1 001076  E3C0 00E3                            LNJ,B6   s:0,PREL
          1 001078       0001                            DC       s:24323+3,PREL
          1 001079  0F81 0020                            B        s:24337,PREL

     1470    24324    4               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */

     1471    24325    4                 CALL CLR_DEV;

  24325   1 00107B  E3C0 009C                            LNJ,B6   s:0,PREL
          1 00107D       0001                            DC       s:24326,PREL

     1472    24326    4                 KZ$3270DEV.CLRD='1'B;

  24326   1 00107E  ECC7 000D                            LDB,B6   DEV$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:248  
          1 001080  8946 001A                            LBT,'0004'X       26,B6
          1 001082       0004
          1 001083  0F81 0016                            B        s:24337,PREL

     1473    24327    4               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */

     1474    24328    4                 CALL CLR_DEV;

  24328   1 001085  E3C0 0092                            LNJ,B6   s:0,PREL
          1 001087       0001                            DC       s:24329,PREL

     1475    24329    4                 KZ$LINCTX.FLAGS.DSC='0'B;

  24329   1 001088  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 00108A  8846 0034                            LBF,'1000'X       52,B6
          1 00108C       1000

     1476    24330    4                 RETURN;

  24330   1 00108D  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 00108F  C3C6 0001                            LNJ,B4   1,B6

     1477    24331    4               END;

     1478    24332    3              END;

  24332   1 001091  0F81 0008                            B        s:24337,PREL

     1479    24333    3           ELSE DO;

     1480    24334    3              CALL CLR_DEV;

  24334   1 001093  E3C0 0084                            LNJ,B6   s:0,PREL
          1 001095       0001                            DC       s:24335,PREL

     1481    24335    3              RETURN;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:249  
  24335   1 001096  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 001098  C3C6 0001                            LNJ,B4   1,B6

     1482    24336    3              END;
     1483    24337    2           DEV$=KZ$3270CTR.DEVHD$;

  24337   1 00109A  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 00109C  DCC6 0002                            LDB,B5   2,B6
          1 00109E  DFC7 000D                            STB,B5   DEV$,AUTO

     1484    24338    3           DO WHILE (DEV$~=ADDR(NIL));

  24338   1 0010A0  0F81 000F                            B        s:24341,PREL

     1485    24339    3              IF KZ$3270DEV.CLRD = '0'B THEN RETURN;

  24339   1 0010A2  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0010A4  82C6 001A                            LB,'0004'X        26,B6
          1 0010A6       0004
          1 0010A7  0501 0005                            BBT      s:24340,PREL

  24339   1 0010A9  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 0010AB  C3C6 0001                            LNJ,B4   1,B6

     1486    24340    3              DEV$=KZ$3270DEV.LNK$;

  24340   1 0010AD  DC86                                 LDB,B5   ,B6
          1 0010AE  DFC7 000D                            STB,B5   DEV$,AUTO

     1487    24341    3              END;

  24341   1 0010B0  8DC7 000D                            CMN      DEV$,AUTO
          1 0010B2  09F0                                 BNE      s:24339,SPREL

     1488    24342    2           CALL RLS_CTR;

  24342   1 0010B3  E3C0 0006                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:250  
          1 0010B5       0001                            DC       s:24343,PREL

     1489    24343    2   END RLS_DEV;

  24343   1 0010B6  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 0010B8  C3C6 0001                            LNJ,B4   1,B6

     1490    24344        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:251  
     1491    24345        /* RLS_CTR - Release controller context */
     1492    24346
     1493    24347    1   RLS_CTR: PROC;

  24347   1 0010BA  EFC7 0070            RLS_CTR         STB,B6   B$,AUTO

     1494    24348    3           DO CASE (KZ$LINCTX.DSC_LEV);

  24348   1 0010BC  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0010BE  B845 0085                            LDR,R3   133,B5
          1 0010C0  B570 00FF                            AND,R3   255,IMO
          1 0010C2  3D03                                 CMV,R3   3
          1 0010C3  0281 002E                            BGE      s:24361,PREL
          1 0010C5  A830 0000 10CB  01                   LDR,R2   s:24348+15,R3
          1 0010C8  83A0 0000 10CE  01                   JMP      s:24350,R2
          1 0010CB       0024                            DC       s:24361,PREL
          1 0010CC       0000                            DC       s:24350,PREL
          1 0010CD       0005                            DC       s:24352,PREL

     1495    24349    3            CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                               */

     1496    24350    3              CALL REALLY_CLR_CTR;

  24350   1 0010CE  E3C0 00FC                            LNJ,B6   s:0,PREL
          1 0010D0       0001                            DC       s:24350+3,PREL
          1 0010D1  0F81 0020                            B        s:24361,PREL

     1497    24351    3            CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                      */

     1498    24352    3              CALL CLR_CTR;

  24352   1 0010D3  E3C0 0078                            LNJ,B6   s:0,PREL
          1 0010D5       0001                            DC       s:24353,PREL

     1499    24353    3              DEV$=KZ$3270CTR.DEVHD$;

  24353   1 0010D6  ECC7 000B                            LDB,B6   CTR$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:252  
          1 0010D8  DCC6 0002                            LDB,B5   2,B6
          1 0010DA  DFC7 000D                            STB,B5   DEV$,AUTO

     1500    24354    4              DO WHILE (DEV$~=ADDR(NIL));

  24354   1 0010DC  0F81 0009                            B        s:24357,PREL

     1501    24355    4                 KZ$3270DEV.CLRD = '0'B;

  24355   1 0010DE  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0010E0  8846 001A                            LBF,'0004'X       26,B6
          1 0010E2       0004

     1502    24356    4                 DEV$=KZ$3270DEV.LNK$;

  24356   1 0010E3  DC86                                 LDB,B5   ,B6
          1 0010E4  DFC7 000D                            STB,B5   DEV$,AUTO

     1503    24357    4                 END;

  24357   1 0010E6  8DC7 000D                            CMN      DEV$,AUTO
          1 0010E8  09F6                                 BNE      s:24355,SPREL

     1504    24358    3              KZ$LINCTX.FLAGS.DSC='0'B;

  24358   1 0010E9  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 0010EB  8846 0034                            LBF,'1000'X       52,B6
          1 0010ED       1000

     1505    24359    3              RETURN;

  24359   1 0010EE  ECC7 0070                            LDB,B6   B$,AUTO
          1 0010F0  C3C6 0001                            LNJ,B4   1,B6

     1506    24360    3            END;

     1507    24361    2           IF KZ$LINCTX.CTRHD$=ADDR(NIL) THEN CALL RLS_LINE;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:253  

  24361   1 0010F2  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 0010F4  8D86                                 CMN      ,B6
          1 0010F5  0981 0004                            BNE      s:24362,PREL

  24361   1 0010F7  E3C0 0006                            LNJ,B6   s:0,PREL
          1 0010F9       0001                            DC       s:24362,PREL

     1508    24362    2   END RLS_CTR;

  24362   1 0010FA  ECC7 0070                            LDB,B6   B$,AUTO
          1 0010FC  C3C6 0001                            LNJ,B4   1,B6

     1509    24363
     1510    24364        /* RLS_LINE - Release line context */
     1511    24365
     1512    24366    1   RLS_LINE: PROC;

  24366   1 0010FE  EFC7 0072            RLS_LINE        STB,B6   X_00100_X,AUTO

     1513    24367    3           DO CASE (KZ$LINCTX.DSC_LEV);

  24367   1 001100  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 001102  B845 0085                            LDR,R3   133,B5
          1 001104  B570 00FF                            AND,R3   255,IMO
          1 001106  3D02                                 CMV,R3   2
          1 001107  0281 000C                            BGE      s:24371,PREL
          1 001109  A830 0000 110F  01                   LDR,R2   s:24367+15,R3
          1 00110C  83A0 0000 1111  01                   JMP      s:24369,R2
          1 00110F       0003                            DC       s:24371,PREL
          1 001110       0000                            DC       s:24369,PREL

     1514    24368    3            CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                               */

     1515    24369    3              CALL REALLY_CLR_LINE;

  24369   1 001111  E3C0 0121                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:254  
          1 001113       0001                            DC       s:24371,PREL

     1516    24370    3            END;

     1517    24371    2   END RLS_LINE;

  24371   1 001114  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 001116  C3C6 0001                            LNJ,B4   1,B6

     1518    24372        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:255  
     1519    24373    1   CLR_DEV: PROC;

  24373   1 001118  EFC7 0070            CLR_DEV         STB,B6   B$,AUTO

     1520    24374    2           KZ$3270DEV.AWAIT_ENABLE='0'B;

  24374   1 00111A  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 00111C  8845 001A                            LBF,'0008'X       26,B5
          1 00111E       0008

     1521    24375    2           KZ$3270DEV.THROTL='0'B;

  24375   1 00111F  8845 0012                            LBF,'1000'X       18,B5
  24375   1 001121       1000

     1522    24376    2           KZ$3270DEV.OTPBSY='0'B;

  24376   1 001122  8845 0012                            LBF,'0400'X       18,B5
  24376   1 001124       0400

     1523    24377    2           KZ$3270DEV.HLT='0'B;

  24377   1 001125  8845 0012                            LBF,'00FF'X       18,B5
  24377   1 001127       00FF

     1524    24378                /*  OTPBYTES is not reset here:  there still may be some
     1525    24379                    output on the DFR queue.  */
     1526    24380    2           KZ$3270DEV.DSC='0'B;

  24380   1 001128  8845 0015                            LBF,'00FF'X       21,B5
  24380   1 00112A       00FF

     1527    24381    2           KZ$3270DEV.KBDLCK='1'B;

  24381   1 00112B  8945 001A                            LBT,'0080'X       26,B5
  24381   1 00112D       0080

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:256  
     1528    24382    2           KZ$3270DEV.DSC_LATER='0'B;

  24382   1 00112E  8845 001A                            LBF,'0020'X       26,B5
  24382   1 001130       0020

     1529    24383    2           KZ$3270DEV.MUST_SBA='0'B;

  24383   1 001131  8845 001A                            LBF,'0010'X       26,B5
  24383   1 001133       0010

     1530    24384    2           KZ$3270DEV.PRINTER_DOWNS=0;

  24384   1 001134  8745 001B                            CL       27,B5

     1531    24385    2           KZ$3270CTR.PRINTER_CNC_DONE='0'B;

  24385   1 001136  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 001138  8846 000A                            LBF,'0040'X       10,B6
          1 00113A       0040

     1532    24386    2           CALL SET_PRO;

  24386   1 00113B  E3C0 FD1D                            LNJ,B6   s:0,PREL
          1 00113D       0001                            DC       s:24387,PREL

     1533    24387    2           IF KZ$3270DEV.ACTIVE THEN

  24387   1 00113E  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 001140  82C6 0012                            LB,'4000'X        18,B6
          1 001142       4000
          1 001143  0581 0004                            BBF      s:24389,PREL

     1534    24388    2              CALL CNC_DEV;

  24388   1 001145  E3C0 0305                            LNJ,B6   s:0,PREL
          1 001147       0001                            DC       s:24389,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:257  
     1535    24389    2   END;

  24389   1 001148  ECC7 0070                            LDB,B6   B$,AUTO
          1 00114A  C3C6 0001                            LNJ,B4   1,B6

     1536    24390
     1537    24391    1   CLR_CTR: PROC;

  24391   1 00114C  EFC7 0072            CLR_CTR         STB,B6   X_00100_X,AUTO

     1538    24392    2           KZ$3270CTR.TIMED_OUT_ONCE='0'B;

  24392   1 00114E  DCC7 000B                            LDB,B5   CTR$,AUTO
          1 001150  8845 000A                            LBF,'0080'X       10,B5
          1 001152       0080

     1539    24393    2           KZ$3270CTR.PRINTER_CNC_DONE='0'B;

  24393   1 001153  8845 000A                            LBF,'0040'X       10,B5
  24393   1 001155       0040

     1540    24394    2   END;

  24394   1 001156  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 001158  C3C6 0001                            LNJ,B4   1,B6

     1541    24395
     1542    24396    1   REALLY_CLR_DEV: PROC;

  24396   1 00115A  EFC7 0070            REALLY_CLR_DEV  STB,B6   B$,AUTO

     1543    24397    2           T$=KZ$3270CTR.DEVHD$;

  24397   1 00115C  DCC7 000B                            LDB,B5   CTR$,AUTO
          1 00115E  CCC5 0002                            LDB,B4   2,B5
          1 001160  CFC7 000F                            STB,B4   T$,AUTO

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:258  
     1544    24398    2           P1$=ADDR(NIL);

  24398   1 001162  BB80 0000 0000                       LAB,B3   0
          1 001165  BFC7 0011                            STB,B3   P1$,AUTO

     1545    24399    3           DO WHILE(T$~=DEV$);

  24399   1 001167  CDC7 000D                            CMB,B4   DEV$,AUTO
          1 001169  0901 000B                            BE       s:24403,PREL

     1546    24400    3              P1$=T$;

  24400   1 00116B  ECC7 000F                            LDB,B6   T$,AUTO
          1 00116D  EFC7 0011                            STB,B6   P1$,AUTO

     1547    24401    3              T$=T$->KZ$3270DEV.LNK$;

  24401   1 00116F  DC86                                 LDB,B5   ,B6
          1 001170  DFC7 000F                            STB,B5   T$,AUTO

     1548    24402    3              END;

  24402   1 001172  DDC7 000D                            CMB,B5   DEV$,AUTO
          1 001174  09F7                                 BNE      s:24400,SPREL

     1549    24403    2           IF P1$=ADDR(NIL) THEN

  24403   1 001175  8DC7 0011                            CMN      P1$,AUTO
          1 001177  0981 000A                            BNE      s:24406,PREL

     1550    24404    2              KZ$3270CTR.DEVHD$=KZ$3270DEV.LNK$;

  24404   1 001179  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00117B  DC86                                 LDB,B5   ,B6
          1 00117C  CCC7 000B                            LDB,B4   CTR$,AUTO
          1 00117E  DFC4 0002                            STB,B5   2,B4
          1 001180  0F81 0007                            B        s:24407,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:259  

     1551    24405    2           ELSE
     1552    24406    2              P1$->KZ$3270DEV.LNK$=KZ$3270DEV.LNK$;

  24406   1 001182  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 001184  DC86                                 LDB,B5   ,B6
          1 001185  CCC7 0011                            LDB,B4   P1$,AUTO
          1 001187  DF84                                 STB,B5   ,B4

     1553    24407    2           KZ$LINCTX.OTPDEV$ = ADDR(NIL);

  24407   1 001188  DB80 0000 0000                       LAB,B5   0
          1 00118B  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 00118D  DFC4 0062                            STB,B5   98,B4

     1554    24408                %DISABLE(INHLVL=KH_INHLVL);

  24409   1 00118F  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 001192  EF47 006A                            STR,R6   DISABLE_LEVEL,AUTO

  24410   1 001194  DBC7 006A                            LAB,B5   DISABLE_LEVEL,AUTO
          1 001196  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 001198  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 00119A  CBF0 0100                            LAB,B4   256,IMO
          1 00119C  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 00119F       0001                            DC       s:24412,PREL

     1555    24412    2           CALL KVB$RLSSYS(SIZEW(KZ$3270DEV),T$);

  24412   1 0011A0  EBF0 001C                            LAB,B6   28,IMO
          1 0011A2  DBC7 000F                            LAB,B5   T$,AUTO
          1 0011A4  DFC7 0094                            STB,B5   @DFRD+24,AUTO
          1 0011A6  EFC7 0092                            STB,B6   @DFRD+22,AUTO
          1 0011A8  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0011AA  CBF0 0200                            LAB,B4   512,IMO
          1 0011AC  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 0011AF       0001                            DC       s:24414,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:260  

     1556    24413                %ENABLE(INHLVL=KH_INHLVL);

  24414   1 0011B0  E847 006A                            LDR,R6   DISABLE_LEVEL,AUTO
          1 0011B2  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          1 0011B5  0901 0007                            BE       s:24419,PREL

  24416   1 0011B7  CBF0 0000                            LAB,B4   0,IMO
          1 0011B9  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 0011BC       0001                            DC       s:24419,PREL

     1557    24419    2          KZ$3270STT.KHSTT.CTXBYTUTL = KZ$3270STT.KHSTT.CTXBYTUTL - SIZEC(KZ$3270DEV);

  24419   1 0011BD  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 0011C0  8CC6 0020                            LDI      32,B6
          1 0011C2  8470 FFFF FFC8                       AID      -56,IMO
          1 0011C5  8D46 0020                            SDI      32,B6

     1558    24420    2   END;

  24420   1 0011C7  ECC7 0070                            LDB,B6   B$,AUTO
          1 0011C9  C3C6 0001                            LNJ,B4   1,B6

     1559    24421
     1560    24422    1   REALLY_CLR_CTR: PROC;

  24422   1 0011CB  EFC7 0072            REALLY_CLR_CTR  STB,B6   X_00100_X,AUTO

     1561    24423    2           T$=KZ$LINCTX.CTRHD$;

  24423   1 0011CD  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0011CF  CC85                                 LDB,B4   ,B5
          1 0011D0  CFC7 000F                            STB,B4   T$,AUTO

     1562    24424    2           P1$=ADDR(NIL);

  24424   1 0011D2  BB80 0000 0000                       LAB,B3   0
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:261  
          1 0011D5  BFC7 0011                            STB,B3   P1$,AUTO

     1563    24425    3           DO WHILE(T$~=CTR$);

  24425   1 0011D7  CDC7 000B                            CMB,B4   CTR$,AUTO
          1 0011D9  0901 000B                            BE       s:24429,PREL

     1564    24426    3              P1$=T$;

  24426   1 0011DB  ECC7 000F                            LDB,B6   T$,AUTO
          1 0011DD  EFC7 0011                            STB,B6   P1$,AUTO

     1565    24427    3              T$=T$->KZ$3270CTR.LNK$;

  24427   1 0011DF  DC86                                 LDB,B5   ,B6
          1 0011E0  DFC7 000F                            STB,B5   T$,AUTO

     1566    24428    3              END;

  24428   1 0011E2  DDC7 000B                            CMB,B5   CTR$,AUTO
          1 0011E4  09F7                                 BNE      s:24426,SPREL

     1567    24429    2           IF P1$=ADDR(NIL) THEN

  24429   1 0011E5  8DC7 0011                            CMN      P1$,AUTO
          1 0011E7  0981 0009                            BNE      s:24432,PREL

     1568    24430    2              KZ$LINCTX.CTRHD$=KZ$3270CTR.LNK$;

  24430   1 0011E9  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 0011EB  DC86                                 LDB,B5   ,B6
          1 0011EC  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 0011EE  DF84                                 STB,B5   ,B4
          1 0011EF  0F81 0007                            B        s:24434,PREL

     1569    24431    2           ELSE
     1570    24432    2              P1$->KZ$3270CTR.LNK$=KZ$3270CTR.LNK$;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:262  

  24432   1 0011F1  ECC7 000B                            LDB,B6   CTR$,AUTO
          1 0011F3  DC86                                 LDB,B5   ,B6
          1 0011F4  CCC7 0011                            LDB,B4   P1$,AUTO
          1 0011F6  DF84                                 STB,B5   ,B4

     1571    24433                %DISABLE(INHLVL=KH_INHLVL);

  24434   1 0011F7  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 0011FA  EF47 006A                            STR,R6   DISABLE_LEVEL,AUTO

  24435   1 0011FC  DBC7 006A                            LAB,B5   DISABLE_LEVEL,AUTO
          1 0011FE  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 001200  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001202  CBF0 0100                            LAB,B4   256,IMO
          1 001204  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 001207       0001                            DC       s:24437,PREL

     1572    24437    2           CALL KVB$RLSSYS(SIZEW(KZ$3270CTR),T$);

  24437   1 001208  EBF0 000B                            LAB,B6   11,IMO
          1 00120A  DBC7 000F                            LAB,B5   T$,AUTO
          1 00120C  DFC7 0094                            STB,B5   @DFRD+24,AUTO
          1 00120E  EFC7 0092                            STB,B6   @DFRD+22,AUTO
          1 001210  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001212  CBF0 0200                            LAB,B4   512,IMO
          1 001214  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 001217       0001                            DC       s:24439,PREL

     1573    24438                %ENABLE(INHLVL=KH_INHLVL);

  24439   1 001218  E847 006A                            LDR,R6   DISABLE_LEVEL,AUTO
          1 00121A  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          1 00121D  0901 0007                            BE       s:24444,PREL

  24441   1 00121F  CBF0 0000                            LAB,B4   0,IMO
          1 001221  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:263  
          1 001224       0001                            DC       s:24444,PREL

     1574    24444    2          KZ$3270STT.KHSTT.CTXBYTUTL = KZ$3270STT.KHSTT.CTXBYTUTL - SIZEC(KZ$3270CTR);

  24444   1 001225  EC80 0000 0006  xsym                 LDB,B6   KZ_3270M_HDR+6
          1 001228  8CC6 0020                            LDI      32,B6
          1 00122A  8470 FFFF FFEA                       AID      -22,IMO
          1 00122D  8D46 0020                            SDI      32,B6

     1575    24445    2   END;

  24445   1 00122F  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 001231  C3C6 0001                            LNJ,B4   1,B6

     1576    24446
     1577    24447    1   REALLY_CLR_LINE: PROC;

  24447   1 001233  EFC7 0074            REALLY_CLR_LINE STB,B6   O_11011_O+1,AUTO

     1578    24448    3           IF KZ$LINCTX.CTRLST$~=ADDR(NIL) THEN DO;

  24448   1 001235  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 001237  8DC5 0068                            CMN      104,B5
          1 001239  0901 0033                            BE       s:24457,PREL

     1579    24449                   %DISABLE(INHLVL=KH_INHLVL);

  24450   1 00123B  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 00123E  EF47 006A                            STR,R6   DISABLE_LEVEL,AUTO

  24451   1 001240  CBC7 006A                            LAB,B4   DISABLE_LEVEL,AUTO
          1 001242  CFC7 0092                            STB,B4   @DFRD+22,AUTO
          1 001244  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001246  CBF0 0100                            LAB,B4   256,IMO
          1 001248  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 00124B       0001                            DC       s:24453,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:264  
     1580    24453    3              CALL KVB$RLSSYS

  24453   1 00124C  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 00124E  E846 0065                            LDR,R6   101,B6
          1 001250  6F05                                 MLV,R6   5
          1 001251  6E01                                 ADV,R6   1
          1 001252  E370 0002                            DIV,R6   2,IMO
          1 001254  EF47 0092                            STR,R6   @DFRD+22,AUTO
          1 001256  DBC6 0068                            LAB,B5   104,B6
          1 001258  DFC7 0095                            STB,B5   @DFRD+25,AUTO
          1 00125A  CBC7 0092                            LAB,B4   @DFRD+22,AUTO
          1 00125C  CFC7 0093                            STB,B4   @DFRD+23,AUTO
          1 00125E  BBC7 0093                            LAB,B3   @DFRD+23,AUTO
          1 001260  CBF0 0200                            LAB,B4   512,IMO
          1 001262  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 001265       0001                            DC       s:24455,PREL

     1581    24454    3                (((KZ$LINCTX.POLSIZ*5)+1)/2,KZ$LINCTX.CTRLST$);
     1582    24455    3              KZ$LINCTX.CTRLST$=ADDR(NIL);

  24455   1 001266  EB80 0000 0000                       LAB,B6   0
          1 001269  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 00126B  EFC5 0068                            STB,B6   104,B5

     1583    24456    3              END;

     1584    24457    2           KZ$CLMEVENT=KZ_CLMEVENT;

  24457   1 00126D  AB80 0000 0057  00                   LAB,B2   KZ_CLMEVENT
          1 001270  2C00                                 LDV,R2   0
          1 001271  6C1C                                 LDV,R6   28
          1 001272  BBC7 005B                            LAB,B3   KZ$CLMEVENT,AUTO
          1 001274  3C00                                 LDV,R3   0
          1 001275  0008                                 MMM

     1585    24458    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_LINDSC;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:265  
  24458   1 001276  6C0A                                 LDV,R6   10
          1 001277  EF47 005B                            STR,R6   KZ$CLMEVENT,AUTO

     1586    24459    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$LINCTX.CHN$->KH$CHN.TERMID);

  24459   1 001279  ECC7 0009                            LDB,B6   LIN$,AUTO
          1 00127B  DCC6 0002                            LDB,B5   2,B6
          1 00127D  CBC5 0012                            LAB,B4   18,B5
          1 00127F  CFC7 0060                            STB,B4   KZ$CLMEVENT+5,AUTO

     1587    24460    2           KZ$CLMEVENT.LINCTX$=LIN$;

  24460   1 001281  EFC7 005E                            STB,B6   KZ$CLMEVENT+3,AUTO

     1588    24461    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);

  24461   1 001283  DBC7 005B                            LAB,B5   KZ$CLMEVENT,AUTO
          1 001285  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 001287  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001289  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          1 00128C  CBF0 0100                            LAB,B4   256,IMO
          1 00128E  E381                                 LNJ,B6   ,B1
          1 00128F       0001                            DC       s:24463,PREL

     1589    24462                %ENABLE(INHLVL=KH_INHLVL);

  24463   1 001290  E847 006A                            LDR,R6   DISABLE_LEVEL,AUTO
          1 001292  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          1 001295  0901 0007                            BE       s:24468,PREL

  24465   1 001297  CBF0 0000                            LAB,B4   0,IMO
          1 001299  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 00129C       0001                            DC       s:24468,PREL

     1590    24468    2   END;

  24468   1 00129D  ECC7 0074                            LDB,B6   O_11011_O+1,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:266  
          1 00129F  C3C6 0001                            LNJ,B4   1,B6

     1591    24469        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:267  
     1592    24470        /* Disconnect a device */
     1593    24471
     1594    24472    1   DSC_DEV: PROC(RSN);

  24472   1 0012A1  EFC7 006E            DSC_DEV         STB,B6   CP_PHLEGM+3,AUTO

     1595    24473    2   DCL RSN UBIN;
     1596    24474
     1597    24475    2           IF KZ$3270DEV.ACTIVE AND KZ$LINCTX.PRO.SLAVE THEN

  24475   1 0012A3  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 0012A5  82C5 0012                            LB,'4000'X        18,B5
          1 0012A7       4000
          1 0012A8  0581 000F                            BBF      s:24477,PREL
          1 0012AA  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 0012AC  89C4 004B                            CMZ      75,B4
          1 0012AE  0881 0009                            BAGE     s:24477,PREL

     1598    24476    2              CALL KZT$SNDSLV(KZ$3270DEV);

  24476   1 0012B0  BBC7 000D                            LAB,B3   DEV$,AUTO
          1 0012B2  CBF0 0100                            LAB,B4   256,IMO
          1 0012B4  E380 0000 0000  xent                 LNJ,B6   KZT$SNDSLV
          1 0012B7       0001                            DC       s:24477,PREL

     1599    24477    3           IF NOT KZ$3270DEV.ACTIVE AND KZ$3270DEV.OTPHD$~=ADDR(NIL) THEN DO;

  24477   1 0012B8  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0012BA  82C6 0012                            LB,'4000'X        18,B6
          1 0012BC       4000
          1 0012BD  0501 0022                            BBT      s:24487,PREL
          1 0012BF  8DC6 0008                            CMN      8,B6
          1 0012C1  0901 001E                            BE       s:24487,PREL

     1600    24478    3              IF KZ$3270DEV.DFRTL$~=ADDR(NIL) THEN

  24478   1 0012C3  8DC6 000E                            CMN      14,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:268  
          1 0012C5  0901 0008                            BE       s:24481,PREL

     1601    24479    3                 KZ$3270DEV.DFRTL$->KZ$OTPBFR.LNK$=KZ$3270DEV.OTPHD$;

  24479   1 0012C7  DCC6 000E                            LDB,B5   14,B6
          1 0012C9  CCC6 0008                            LDB,B4   8,B6
          1 0012CB  CF85                                 STB,B4   ,B5
          1 0012CC  0F81 0005                            B        s:24482,PREL

     1602    24480    3              ELSE
     1603    24481    3                 KZ$3270DEV.DFRHD$=KZ$3270DEV.OTPHD$;

  24481   1 0012CE  DCC6 0008                            LDB,B5   8,B6
          1 0012D0  DFC6 000C                            STB,B5   12,B6

     1604    24482    3              KZ$3270DEV.DFRTL$=KZ$3270DEV.OTPTL$;

  24482   1 0012D2  DCC6 000A                            LDB,B5   10,B6
          1 0012D4  DFC6 000E                            STB,B5   14,B6

     1605    24483    3              KZ$3270DEV.OTPHD$=ADDR(NIL);

  24483   1 0012D6  CB80 0000 0000                       LAB,B4   0
          1 0012D9  CFC6 0008                            STB,B4   8,B6

     1606    24484    3              KZ$3270DEV.OTPTL$=ADDR(NIL);

  24484   1 0012DB  BB80 0000 0000                       LAB,B3   0
          1 0012DE  BFC6 000A                            STB,B3   10,B6

     1607    24485    3              END;

     1608    24486
     1609    24487    3           IF KZ$3270DEV.HLT THEN DO;

  24487   1 0012E0  82C6 0012                            LB,'00FF'X        18,B6
  24487   1 0012E2       00FF
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:269  
          1 0012E3  0581 000C                            BBF      s:24493,PREL

     1610    24488    3              KZ$3270DEV.HLT='0'B;

  24488   1 0012E5  8846 0012                            LBF,'00FF'X       18,B6
  24488   1 0012E7       00FF

     1611    24489    3              IF KZ$3270DEV.OTPHD$~=ADDR(NIL) THEN

  24489   1 0012E8  8DC6 0008                            CMN      8,B6
          1 0012EA  0901 0005                            BE       s:24493,PREL

     1612    24490    3                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;

  24490   1 0012EC  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0012EE  8AC5 004D                            INC      77,B5

     1613    24491    3              END;

     1614    24492
     1615    24493    2           IF KZ$LINCTX.PRO.SLAVE AND NOT KZ$3270DEV.REACT THEN

  24493   1 0012F0  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0012F2  89C5 004B                            CMZ      75,B5
          1 0012F4  0881 0009                            BAGE     s:24495,PREL
          1 0012F6  82C6 001A                            LB,'0040'X        26,B6
          1 0012F8       0040
          1 0012F9  0501 0004                            BBT      s:24495,PREL

     1616    24494    2              KZ$3270DEV.ACTIVE = '0'B;    /* Don't reactivate if a slave user   */

  24494   1 0012FB  8846 0012                            LBF,'4000'X       18,B6
  24494   1 0012FD       4000

     1617    24495    2           IF KZ$3270DEV.DSC THEN

  24495   1 0012FE  82C6 0015                            LB,'00FF'X        21,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:270  
  24495   1 001300       00FF
          1 001301  0581 0008                            BBF      s:24501,PREL

     1618    24496    3           DO;

     1619    24497    3              CALL DEL_DFRD; /* Make sure there is no defered process waiting.   */

  24497   1 001303  E3C0 00E7                            LNJ,B6   s:0,PREL
          1 001305       0001                            DC       s:24498,PREL

     1620    24498    3              RETURN;                      /* Already in disconnect              */

  24498   1 001306  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 001308  C3C6 0001                            LNJ,B4   1,B6

     1621    24499    3              END;
     1622    24500
     1623    24501    2           IF KZ$3270DEV.VDI$=ADDR(NIL) THEN

  24501   1 00130A  8DC6 0004                            CMN      4,B6
          1 00130C  0981 0005                            BNE      s:24504,PREL

     1624    24502    2              RETURN;                      /* Nothing to disconnect              */

  24502   1 00130E  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 001310  C3C6 0001                            LNJ,B4   1,B6

     1625    24503
     1626    24504    2           CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);

  24504   1 001312  CBC7 0020                            LAB,B4   DFRD,AUTO
          1 001314  CFC7 007C                            STB,B4   @VDI$+2,AUTO
          1 001316  BBC6 0004                            LAB,B3   4,B6
          1 001318  BFC7 007A                            STB,B3   I+4,AUTO
          1 00131A  E3C0 0421                            LNJ,B6   s:0,PREL
          1 00131C       0001                            DC       s:24505,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:271  
     1627    24505    2           KZ$3270DEV.DSC.INT='1'B;        /* Disconnect initiated               */

  24505   1 00131D  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00131F  8946 0015                            LBT,'0080'X       21,B6
          1 001321       0080

     1628    24506    3           IF NOT DFRD THEN DO;

  24506   1 001322  89C7 0020                            CMZ      DFRD,AUTO
          1 001324  0801 003D                            BAL      s:24519,PREL

     1629    24507    3   TELL_VDH:  KZ$3270DEV.DSC.TOLD_VDH='1'B;

  24507   1 001326  ECC7 000D            TELL_VDH        LDB,B6   DEV$,AUTO
          1 001328  8946 0015                            LBT,'0040'X       21,B6
          1 00132A       0040

     1630    24508    3              KV$VDH_DSC=KV_VDH_DSC;

  24508   1 00132B  8C80 0000 0000  xsym                 LDI      KV_VDH_DSC
          1 00132E  8D47 0045                            SDI      KV$VDH_DSC,AUTO

     1631    24509    3              KV$VDH_DSC.RSN=RSN;

  24509   1 001330  DCC7 0070                            LDB,B5   @RSN,AUTO
          1 001332  D805                                 LDR,R5   ,B5
          1 001333  DAC7 0045                            SRM,R5,'00FF'X    KV$VDH_DSC,AUTO
          1 001335       00FF

     1632    24510    3              KV$VDH_DSC.ALLSSN = '1'B;

  24510   1 001336  8947 0046                            LBT,'4000'X       KV$VDH_DSC+1,AUTO
  24510   1 001338       4000

     1633    24511    3              IF NOT KZ$3270DEV.ACTIVE THEN

  24511   1 001339  82C6 0012                            LB,'4000'X        18,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:272  
  24511   1 00133B       4000
          1 00133C  0501 0004                            BBT      s:24513,PREL

     1634    24512    3                 KV$VDH_DSC.NO_IO = '1'B;

  24512   1 00133E  8947 0046                            LBT,'8000'X       KV$VDH_DSC+1,AUTO
  24512   1 001340       8000

     1635    24513    3              CALL KVV$VDI(KV$VDH_DSC);

  24513   1 001341  CBC7 0045                            LAB,B4   KV$VDH_DSC,AUTO
          1 001343  CFC7 0092                            STB,B4   @DFRD+22,AUTO
          1 001345  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001347  CBF0 0100                            LAB,B4   256,IMO
          1 001349  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 00134C       0001                            DC       s:24514,PREL

     1636    24514    3              IF NOT KZ$3270DEV.ACTIVE

  24514   1 00134D  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00134F  82C6 0012                            LB,'4000'X        18,B6
          1 001351       4000
          1 001352  0501 0004                            BBT      s:24516,PREL

     1637    24515    3              THEN CALL DEL_DFRD;

  24515   1 001354  E3C0 0096                            LNJ,B6   s:0,PREL
          1 001356       0001                            DC       s:24516,PREL

     1638    24516    3              CALL EXIT_VDH (KZ$3270DEV.VDI$);

  24516   1 001357  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 001359  DBC6 0004                            LAB,B5   4,B6
          1 00135B  DFC7 007A                            STB,B5   I+4,AUTO
          1 00135D  E3C0 043E                            LNJ,B6   s:0,PREL
          1 00135F       0001                            DC       s:24517,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:273  
     1639    24517    3              END;

  24517   1 001360  0F81 0004                            B        s:24521,PREL

     1640    24518    2           ELSE
     1641    24519    2              KZ$3270DEV.DFR.DSCI='1'B;    /* Do it later                        */

  24519   1 001362  8946 0016                            LBT,'8000'X       22,B6
  24519   1 001364       8000

     1642    24520
     1643    24521    2           RETURN;

  24521   1 001365  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 001367  C3C6 0001                            LNJ,B4   1,B6

     1644    24522
     1645    24523    2   DSC_DEV_CONT: ENTRY(RSN);

  24523   1 001369  EFC7 006E            DSC_DEV_CONT    STB,B6   CP_PHLEGM+3,AUTO

     1646    24524
     1647    24525    3           IF KZ$3270DEV.DFR.DSCI THEN DO;

  24525   1 00136B  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 00136D  89C5 0016                            CMZ      22,B5
          1 00136F  0881 0011                            BAGE     s:24530,PREL

     1648    24526    3              KZ$3270DEV.DFR.DSCI='0'B;

  24526   1 001371  8845 0016                            LBF,'8000'X       22,B5
  24526   1 001373       8000

     1649    24527    3              CALL ENTER_VDH (KZ$3270DEV.VDI$,DFRD);
             24527                       /* Already in VDH - make EXIT do nothing */

  24527   1 001374  EBC7 0020                            LAB,B6   DFRD,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:274  
          1 001376  EFC7 007C                            STB,B6   @VDI$+2,AUTO
          1 001378  CBC5 0004                            LAB,B4   4,B5
          1 00137A  CFC7 007A                            STB,B4   I+4,AUTO
          1 00137C  E3C0 03BF                            LNJ,B6   s:0,PREL
          1 00137E       0001                            DC       s:24528,PREL

     1650    24528    3              GOTO TELL_VDH;

  24528   1 00137F  0F81 FFA6                            B        s:24507,PREL

     1651    24529    3              END;
     1652    24530    2           RETURN;

  24530   1 001381  ECC7 006E                            LDB,B6   CP_PHLEGM+3,AUTO
          1 001383  C3C6 0001                            LNJ,B4   1,B6

     1653    24531
     1654    24532    2   END DSC_DEV;
     1655    24533
     1656    24534    1   DSC_DEV_FINAL: PROC;

  24534   1 001385  EFC7 0078            DSC_DEV_FINAL   STB,B6   I+2,AUTO

     1657    24535
     1658    24536    2   DSC_FINAL:
     1659    24537    2           KZ$CLMEVENT=KZ_CLMEVENT;

  24537   1 001387  AB80 0000 0057  00   DSC_FINAL       LAB,B2   KZ_CLMEVENT
          1 00138A  2C00                                 LDV,R2   0
          1 00138B  6C1C                                 LDV,R6   28
          1 00138C  BBC7 005B                            LAB,B3   KZ$CLMEVENT,AUTO
          1 00138E  3C00                                 LDV,R3   0
          1 00138F  0008                                 MMM

     1660    24538    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_DEVDSC;

  24538   1 001390  6C0B                                 LDV,R6   11
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:275  
          1 001391  EF47 005B                            STR,R6   KZ$CLMEVENT,AUTO

     1661    24539    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$3270DEV.CHN$->KH$CHN.TERMID);

  24539   1 001393  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 001395  DCC6 0006                            LDB,B5   6,B6
          1 001397  CBC5 0012                            LAB,B4   18,B5
          1 001399  CFC7 0060                            STB,B4   KZ$CLMEVENT+5,AUTO

     1662    24540    2           KZ$CLMEVENT.LINCTX$=LIN$;

  24540   1 00139B  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 00139D  DFC7 005E                            STB,B5   KZ$CLMEVENT+3,AUTO

     1663    24541                %DISABLE(INHLVL=KH_INHLVL);

  24542   1 00139F  D800 0000 0000  xsym                 LDR,R5   KH_INHLVL
          1 0013A2  DF47 006A                            STR,R5   DISABLE_LEVEL,AUTO

  24543   1 0013A4  BBC7 006A                            LAB,B3   DISABLE_LEVEL,AUTO
          1 0013A6  BFC7 0092                            STB,B3   @DFRD+22,AUTO
          1 0013A8  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0013AA  CBF0 0100                            LAB,B4   256,IMO
          1 0013AC  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 0013AF       0001                            DC       s:24545,PREL

     1664    24545    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);

  24545   1 0013B0  EBC7 005B                            LAB,B6   KZ$CLMEVENT,AUTO
          1 0013B2  EFC7 0092                            STB,B6   @DFRD+22,AUTO
          1 0013B4  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0013B6  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          1 0013B9  CBF0 0100                            LAB,B4   256,IMO
          1 0013BB  E381                                 LNJ,B6   ,B1
          1 0013BC       0001                            DC       s:24547,PREL

     1665    24546                %ENABLE(INHLVL=KH_INHLVL);
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:276  

  24547   1 0013BD  E847 006A                            LDR,R6   DISABLE_LEVEL,AUTO
          1 0013BF  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          1 0013C2  0901 0007                            BE       s:24552,PREL

  24549   1 0013C4  CBF0 0000                            LAB,B4   0,IMO
          1 0013C6  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 0013C9       0001                            DC       s:24552,PREL

     1666    24552    2           KZ$3270DEV.DSC.VDH_FINAL='0'B;

  24552   1 0013CA  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0013CC  8846 0015                            LBF,'0020'X       21,B6
          1 0013CE       0020

     1667    24553    2           KZ$3270DEV.DSC.DEV_FINAL='0'B;

  24553   1 0013CF  8846 0015                            LBF,'0010'X       21,B6
  24553   1 0013D1       0010

     1668    24554    2           KV$VDH_EVT=KV_VDH_EVT;

  24554   1 0013D2  8C80 0000 0000  xsym                 LDI      KV_VDH_EVT
          1 0013D5  8D47 0047                            SDI      KV$VDH_EVT,AUTO

     1669    24555    2           KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;

  24555   1 0013D7  5C03                                 LDV,R5   3
          1 0013D8  DAC7 0047                            SRM,R5,'00FF'X    KV$VDH_EVT,AUTO
          1 0013DA       00FF

     1670    24556    2           CALL KVV$VDI(KV$VDH_EVT);

  24556   1 0013DB  DBC7 0047                            LAB,B5   KV$VDH_EVT,AUTO
          1 0013DD  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 0013DF  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0013E1  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:277  
          1 0013E3  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 0013E6       0001                            DC       s:24557,PREL

     1671    24557    2           RETURN;

  24557   1 0013E7  ECC7 0078                            LDB,B6   I+2,AUTO
          1 0013E9  C3C6 0001                            LNJ,B4   1,B6

     1672    24558
     1673    24559    2   END DSC_DEV_FINAL;
     1674    24560        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:278  
     1675    24561        /*
     1676    24562              Delete any output or input buffers sitting in the defered chain.
     1677    24563        */
     1678    24564    1   DEL_DFRD: PROC;

  24564   1 0013EB  EFC7 0072            DEL_DFRD        STB,B6   X_00100_X,AUTO

     1679    24565
     1680    24566    3           DO WHILE(KZ$3270DEV.DFRHD$~=ADDR(NIL));

  24566   1 0013ED  0F81 0053                            B        s:24581,PREL

     1681    24567    3              BFR$=KZ$3270DEV.DFRHD$;

  24567   1 0013EF  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0013F1  DCC6 000C                            LDB,B5   12,B6
          1 0013F3  DFC7 0015                            STB,B5   BFR$,AUTO

     1682    24568    3              KZ$3270DEV.DFRHD$=KZ$OTPBFR.LNK$;

  24568   1 0013F5  CC85                                 LDB,B4   ,B5
          1 0013F6  CFC6 000C                            STB,B4   12,B6

     1683    24569    3              IF KZ$3270DEV.DFRHD$=ADDR(NIL) THEN

  24569   1 0013F8  8DC6 000C                            CMN      12,B6
          1 0013FA  0981 0006                            BNE      s:24571,PREL

     1684    24570    3                 KZ$3270DEV.DFRTL$=ADDR(NIL);

  24570   1 0013FC  DB80 0000 0000                       LAB,B5   0
          1 0013FF  DFC6 000E                            STB,B5   14,B6

     1685    24571    4              DO CASE(KZ$OTPBFR.TYP);

  24571   1 001401  DCC7 0015                            LDB,B5   BFR$,AUTO
          1 001403  B2C5 0002                            LLH,R3   2,B5
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:279  
          1 001405  3D03                                 CMV,R3   3
          1 001406  0281 003A                            BGE      s:24581,PREL
          1 001408  A830 0000 140E  01                   LDR,R2   s:24571+13,R3
          1 00140B  83A0 0000 1411  01                   JMP      s:24573,R2
          1 00140E       0030                            DC       s:24581,PREL
          1 00140F       0008                            DC       s:24576,PREL
          1 001410       0000                            DC       s:24573,PREL

     1686    24572    4               CASE(%KZ#BFRTYP_OTP);

     1687    24573    4                 KZ$OTPBFR.CMPCOD=%KV_CMPCOD_DVCERR;

  24573   1 001411  6C0D                                 LDV,R6   13
          1 001412  E7C5 0005                            STH,R6   5,B5

     1688    24574    4                 CALL RELOTPBFR;

  24574   1 001414  E3C0 FA56                            LNJ,B6   s:0,PREL
          1 001416       0001                            DC       s:24574+3,PREL
          1 001417  0F81 0029                            B        s:24581,PREL

     1689    24575    4               CASE(%KZ#BFRTYP_INP);

     1690    24576    4                 T$=KZ$INPBFR.DATA$;

  24576   1 001419  BCC5 0006                            LDB,B3   6,B5
          1 00141B  BFC7 000F                            STB,B3   T$,AUTO

     1691    24577    4                 CALL KVB$RLSSYS(KZ$INPBFR.BFR_SIZ,T$);

  24577   1 00141D  CBC7 000F                            LAB,B4   T$,AUTO
          1 00141F  CFC7 0094                            STB,B4   @DFRD+24,AUTO
          1 001421  ABC5 0004                            LAB,B2   4,B5
          1 001423  AFC7 0092                            STB,B2   @DFRD+22,AUTO
          1 001425  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001427  CBF0 0200                            LAB,B4   512,IMO
          1 001429  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:280  
          1 00142C       0001                            DC       s:24578,PREL

     1692    24578    4                 T$=BFR$;

  24578   1 00142D  ECC7 0015                            LDB,B6   BFR$,AUTO
          1 00142F  EFC7 000F                            STB,B6   T$,AUTO

     1693    24579    4                 CALL KVB$RLSSYS(SIZEW(KZ$INPBFR),T$);

  24579   1 001431  DBF0 0008                            LAB,B5   8,IMO
          1 001433  CBC7 000F                            LAB,B4   T$,AUTO
          1 001435  CFC7 0094                            STB,B4   @DFRD+24,AUTO
          1 001437  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 001439  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 00143B  CBF0 0200                            LAB,B4   512,IMO
          1 00143D  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 001440       0001                            DC       s:24581,PREL

     1694    24580    4               END;

     1695    24581    3              END;

  24581   1 001441  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 001443  8DC6 000C                            CMN      12,B6
          1 001445  0981 FFA9                            BNE      s:24567,PREL

     1696    24582    2   END DEL_DFRD;

  24582   1 001447  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 001449  C3C6 0001                            LNJ,B4   1,B6

     1697    24583        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:281  
     1698    24584        /* Connect a device to VDH */
     1699    24585
     1700    24586    1   CNC_DEV: PROC;

  24586   1 00144B  EFC7 0072            CNC_DEV         STB,B6   X_00100_X,AUTO

     1701    24587
     1702    24588    2           IF KZ$3270DEV.VDI$~=ADDR(NIL) THEN

  24588   1 00144D  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 00144F  8DC5 0004                            CMN      4,B5
          1 001451  0901 0005                            BE       s:24591,PREL

     1703    24589    2              RETURN;                      /* Already have someone going here    */

  24589   1 001453  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 001455  C3C6 0001                            LNJ,B4   1,B6

     1704    24590
     1705    24591    2           KZ$CLMEVENT=KZ_CLMEVENT;

  24591   1 001457  AB80 0000 0057  00                   LAB,B2   KZ_CLMEVENT
          1 00145A  2C00                                 LDV,R2   0
          1 00145B  6C1C                                 LDV,R6   28
          1 00145C  BBC7 005B                            LAB,B3   KZ$CLMEVENT,AUTO
          1 00145E  3C00                                 LDV,R3   0
          1 00145F  0008                                 MMM

     1706    24592    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_CNCRQS;

  24592   1 001460  6C0D                                 LDV,R6   13
          1 001461  EF47 005B                            STR,R6   KZ$CLMEVENT,AUTO

     1707    24593    2           KZ$CLMEVENT.CHN$=KZ$3270DEV.CHN$;

  24593   1 001463  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 001465  DCC6 0006                            LDB,B5   6,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:282  
          1 001467  DFC7 0062                            STB,B5   KZ$CLMEVENT+7,AUTO

     1708    24594    2           KZ$CLMEVENT.LINCTX$=LIN$;

  24594   1 001469  CCC7 0009                            LDB,B4   LIN$,AUTO
          1 00146B  CFC7 005E                            STB,B4   KZ$CLMEVENT+3,AUTO

     1709    24595                %DISABLE(INHLVL=KH_INHLVL);

  24596   1 00146D  D800 0000 0000  xsym                 LDR,R5   KH_INHLVL
          1 001470  DF47 006A                            STR,R5   DISABLE_LEVEL,AUTO

  24597   1 001472  BBC7 006A                            LAB,B3   DISABLE_LEVEL,AUTO
          1 001474  BFC7 0092                            STB,B3   @DFRD+22,AUTO
          1 001476  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001478  CBF0 0100                            LAB,B4   256,IMO
          1 00147A  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 00147D       0001                            DC       s:24599,PREL

     1710    24599    2           CALL KZT_CNCDSC@(KZ$CLMEVENT)

  24599   1 00147E  EBC7 005B                            LAB,B6   KZ$CLMEVENT,AUTO
          1 001480  EFC7 0092                            STB,B6   @DFRD+22,AUTO
          1 001482  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001484  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          1 001487  CBF0 0100                            LAB,B4   256,IMO
          1 001489  E381                                 LNJ,B6   ,B1
          1 00148A       0003                            DC       s:24603,PREL
          1 00148B  0F81 0017                            B        s:24611,PREL

     1711    24600    2           WHENALTRETURN
     1712    24601    3           DO;

     1713    24602                   %ENABLE(INHLVL=KH_INHLVL);

  24603   1 00148D  E847 006A                            LDR,R6   DISABLE_LEVEL,AUTO
          1 00148F  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:283  
          1 001492  0901 0007                            BE       s:24608,PREL

  24605   1 001494  CBF0 0000                            LAB,B4   0,IMO
          1 001496  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 001499       0001                            DC       s:24608,PREL

     1714    24608    3              KZ$3270DEV.AWAIT_ENABLE='1'B;

  24608   1 00149A  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 00149C  8946 001A                            LBT,'0008'X       26,B6
          1 00149E       0008

     1715    24609    3              RETURN;

  24609   1 00149F  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 0014A1  C3C6 0001                            LNJ,B4   1,B6

     1716    24610    3              END;
     1717    24611    2           KZ$CLMEVENT=KZ_CLMEVENT;

  24611   1 0014A3  AB80 0000 0057  00                   LAB,B2   KZ_CLMEVENT
          1 0014A6  2C00                                 LDV,R2   0
          1 0014A7  6C1C                                 LDV,R6   28
          1 0014A8  BBC7 005B                            LAB,B3   KZ$CLMEVENT,AUTO
          1 0014AA  3C00                                 LDV,R3   0
          1 0014AB  0008                                 MMM

     1718    24612    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_SUBCNC;

  24612   1 0014AC  6C0C                                 LDV,R6   12
          1 0014AD  EF47 005B                            STR,R6   KZ$CLMEVENT,AUTO

     1719    24613    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$3270DEV.CHN$->KH$CHN.TERMID);

  24613   1 0014AF  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0014B1  DCC6 0006                            LDB,B5   6,B6
          1 0014B3  CBC5 0012                            LAB,B4   18,B5
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:284  
          1 0014B5  CFC7 0060                            STB,B4   KZ$CLMEVENT+5,AUTO

     1720    24614    2           KZ$CLMEVENT.LINCTX$=LIN$;

  24614   1 0014B7  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0014B9  DFC7 005E                            STB,B5   KZ$CLMEVENT+3,AUTO

     1721    24615    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);

  24615   1 0014BB  BBC7 005B                            LAB,B3   KZ$CLMEVENT,AUTO
          1 0014BD  BFC7 0092                            STB,B3   @DFRD+22,AUTO
          1 0014BF  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0014C1  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          1 0014C4  CBF0 0100                            LAB,B4   256,IMO
          1 0014C6  E381                                 LNJ,B6   ,B1
          1 0014C7       0001                            DC       s:24617,PREL

     1722    24616                %ENABLE(INHLVL=KH_INHLVL);

  24617   1 0014C8  E847 006A                            LDR,R6   DISABLE_LEVEL,AUTO
          1 0014CA  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          1 0014CD  0901 0007                            BE       s:24622,PREL

  24619   1 0014CF  CBF0 0000                            LAB,B4   0,IMO
          1 0014D1  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 0014D4       0001                            DC       s:24622,PREL

     1723    24622    2           KZ$3270DEV.AWAIT_ENABLE='0'B;

  24622   1 0014D5  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0014D7  8846 001A                            LBF,'0008'X       26,B6
          1 0014D9       0008

     1724    24623
     1725    24624    2           KV$VDH_INT=KV_VDH_INT;

  24624   1 0014DA  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_INT
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:285  
          1 0014DD  2C00                                 LDV,R2   0
          1 0014DE  6C16                                 LDV,R6   22
          1 0014DF  BBC7 0049                            LAB,B3   KV$VDH_INT,AUTO
          1 0014E1  3C00                                 LDV,R3   0
          1 0014E2  0008                                 MMM

     1726    24625    2           KV$VDH_INT.CHN$=KZ$3270DEV.CHN$;

  24625   1 0014E3  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0014E5  DCC6 0006                            LDB,B5   6,B6
          1 0014E7  DFC7 004A                            STB,B5   KV$VDH_INT+1,AUTO

     1727    24626    2           KV$VDH_INT.USRCTX$=DEV$;

  24626   1 0014E9  EFC7 004C                            STB,B6   KV$VDH_INT+3,AUTO

     1728    24627    2           KV$VDH_INT.USRPRM$=KZT_USRPRM$;

  24627   1 0014EB  CC80 0000 0000  xsym                 LDB,B4   KZT_USRPRM$
          1 0014EE  CFC7 0050                            STB,B4   KV$VDH_INT+7,AUTO

     1729    24628    2           KV$VDH_INT.RCVFLWCTRMAXCRD=KZT_THRTL_INIT;

  24628   1 0014F0  E800 0000 0000  xsym                 LDR,R6   KZT_THRTL_INIT
          1 0014F3  EF47 0052                            STR,R6   KV$VDH_INT+9,AUTO

     1730    24629    2           KV$VDH_INT.TRCBFRBYTSIZ=KH$CTLTBL.PARM.PTR$(%KL_HNDLRPARM_VDHTRC)->
             24629                    VDHTRCWORD;

  24629   1 0014F5  BC80 0000 0000  xsym                 LDB,B3   KH_CTLTBL$
          1 0014F8  ACC3 001D                            LDB,B2   29,B3
          1 0014FA  D802                                 LDR,R5   ,B2
          1 0014FB  DF47 0053                            STR,R5   KV$VDH_INT+10,AUTO

     1731    24630
     1732    24631    2           VDH_FLG=0;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:286  
  24631   1 0014FD  8747 0021                            CL       VDH_FLG,AUTO

     1733    24632    2           CALL ENTER_VDH (ADDR(NIL),DFRD);

  24632   1 0014FF  AB80 0000 0000                       LAB,B2   0
          1 001502  AFC7 0097                            STB,B2   @DFRD+27,AUTO
          1 001504  9BC7 0020                            LAB,B1   DFRD,AUTO
          1 001506  9FC7 007C                            STB,B1   @VDI$+2,AUTO
          1 001508  EBC7 0097                            LAB,B6   @DFRD+27,AUTO
          1 00150A  EFC7 007A                            STB,B6   I+4,AUTO
          1 00150C  E3C0 022F                            LNJ,B6   s:0,PREL
          1 00150E       0001                            DC       s:24633,PREL

     1734    24633    2           CALL KVV$INT(KV$VDH_INT)

  24633   1 00150F  EBC7 0049                            LAB,B6   KV$VDH_INT,AUTO
          1 001511  EFC7 0092                            STB,B6   @DFRD+22,AUTO
          1 001513  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001515  CBF0 0100                            LAB,B4   256,IMO
          1 001517  E380 0000 0000  xent                 LNJ,B6   KVV$INT
          1 00151A       0003                            DC       s:24636,PREL
          1 00151B  0F81 0011                            B        s:24640,PREL

     1735    24634    2           WHENALTRETURN
     1736    24635    3           DO;

     1737    24636    3              CALL EXIT_VDH (ADDR(NIL));

  24636   1 00151D  EB80 0000 0000                       LAB,B6   0
          1 001520  EFC7 0099                            STB,B6   @DFRD+29,AUTO
          1 001522  DBC7 0099                            LAB,B5   @DFRD+29,AUTO
          1 001524  DFC7 007A                            STB,B5   I+4,AUTO
          1 001526  E3C0 0275                            LNJ,B6   s:0,PREL
          1 001528       0001                            DC       s:24637,PREL

     1738    24637    3              RETURN;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:287  
  24637   1 001529  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 00152B  C3C6 0001                            LNJ,B4   1,B6

     1739    24638    3              END;
     1740    24639
     1741    24640    2           P1$=KV$VDH_INT.VDI$;            /* Save VDI$                          */

  24640   1 00152D  ECC7 004E                            LDB,B6   KV$VDH_INT+5,AUTO
          1 00152F  EFC7 0011                            STB,B6   P1$,AUTO

     1742    24641
     1743    24642    2           KV$VDH_CNC=KV_VDH_CNC;

  24642   1 001531  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_CNC
          1 001534  2C00                                 LDV,R2   0
          1 001535  6C32                                 LDV,R6   50
          1 001536  BB87                                 LAB,B3   ,AUTO
          1 001537  3C48                                 LDV,R3   72
          1 001538  0008                                 MMM

     1744    24643        /*      KV$VDH_CNC.VDI$=P1$; */
     1745    24644    2           IF KH_PROFILE_ ~= VECTOR(NIL)

  24644   1 001539  EB80 0000 0000  xsym                 LAB,B6   KH_PROFILE_
          1 00153C  DB80 0000 0000  02                   LAB,B5   0
          1 00153F  5C06                                 LDV,R5   6
          1 001540  0022                                 ACM      ;
          1 001541       4606 0000                                ALPHANUM(0,B6,,6,FILL),;
          1 001543       4005 0003                                ALPHANUM(3,B5,,R5,FILL)
          1 001545  5381 0012                            CBE      s:24651,PREL

     1746    24645    3           THEN DO;

     1747    24646    3              CP_PHLEGM=VBASE (KH_PROFILE_);

  24646   1 001547  8C80 0000 0001  xsym                 LDI      KH_PROFILE_+1
          1 00154A  8D47 006B                            SDI      CP_PHLEGM,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:288  

     1748    24647    3              KV$VDH_CNC.PRF_.ADR$=P_PHLEGM;

  24647   1 00154C  ECC7 006B                            LDB,B6   CP_PHLEGM,AUTO
          1 00154E  EFC7 0025                            STB,B6   KV$VDH_CNC+1,AUTO

     1749    24648    3              KV$VDH_CNC.PRF_.BYTSIZ=VBOUND (KH_PROFILE_)+1;

  24648   1 001550  C800 0000 0000  xsym                 LDR,R4   KH_PROFILE_
          1 001553  4E01                                 ADV,R4   1
          1 001554  CF47 0028                            STR,R4   KV$VDH_CNC+4,AUTO

     1750    24649    3              END;

  24649   1 001556  0F81 0009                            B        s:24654,PREL

     1751    24650    3           ELSE DO;

     1752    24651    3              KV$VDH_CNC.PRF_.ADR$=ADDR(PRO_ATTR);

  24651   1 001558  EB80 0000 0065  00                   LAB,B6   PRO_ATTR
          1 00155B  EFC7 0025                            STB,B6   KV$VDH_CNC+1,AUTO

     1753    24652    3              KV$VDH_CNC.PRF_.BYTSIZ=(SIZEC(VLP_TRMATTR)+SIZEC(VLP_TRMCTL)+4);

  24652   1 00155D  6C3C                                 LDV,R6   60
          1 00155E  EF47 0028                            STR,R6   KV$VDH_CNC+4,AUTO

     1754    24653    3              END;

     1755    24654    2           KV$VDH_CNC.LINSPD=KZ$3270DEV.CHN$->KH$CHN.LINSPD;

  24654   1 001560  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 001562  CCC5 0006                            LDB,B4   6,B5
          1 001564  E844 0008                            LDR,R6   8,B4
          1 001566  E570 000F                            AND,R6   15,IMO
          1 001568  EAC7 002E                            SRM,R6,'00FF'X    KV$VDH_CNC+10,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:289  
          1 00156A       00FF

     1756    24655    2           KV$VDH_CNC.LCLENDPNTID=KZ$3270DEV.CHN$->KH$CHN.TERMID;

  24655   1 00156B  CCC5 0006                            LDB,B4   6,B5
          1 00156D  AB84                                 LAB,B2   ,B4
          1 00156E  2C24                                 LDV,R2   36
          1 00156F  6C10                                 LDV,R6   16
          1 001570  BB87                                 LAB,B3   ,AUTO
          1 001571  3C5E                                 LDV,R3   94
          1 001572  0008                                 MMM

     1757    24656    2           KV$VDH_CNC.LCLENDPNTID.TTYP=%KLTY_LINEDEV#;

  24656   1 001573  6C0A                                 LDV,R6   10
          1 001574  E7C7 002F                            STH,R6   KV$VDH_CNC+11,AUTO

     1758    24657    2           %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_CMPOTP)='1'B;

  24657   1 001576  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001579  DC86                                 LDB,B5   ,B6
          1 00157A  8945 001F                            LBT,'0008'X       31,B5
          1 00157C       0008

     1759    24658    2           %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RQSOTP)='1'B;

  24658   1 00157D  DC86                                 LDB,B5   ,B6
          1 00157E  8945 001F                            LBT,'0004'X       31,B5
          1 001580       0004

     1760    24659    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DLTOTP)='1'B;

  24659   1 001581  DC86                                 LDB,B5   ,B6
          1 001582  8945 001E                            LBT,'0010'X       30,B5
          1 001584       0010

     1761    24660    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DSC)='1'B;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:290  

  24660   1 001585  DC86                                 LDB,B5   ,B6
          1 001586  8945 001E                            LBT,'0008'X       30,B5
          1 001588       0008

     1762    24661    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_GETSTR)='1'B;

  24661   1 001589  DC86                                 LDB,B5   ,B6
          1 00158A  8945 001E                            LBT,'0002'X       30,B5
          1 00158C       0002

     1763    24662    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_HLTOTP)='1'B;

  24662   1 00158D  DC86                                 LDB,B5   ,B6
          1 00158E  8945 001E                            LBT,'0001'X       30,B5
          1 001590       0001

     1764    24663    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNACP)='1'B;

  24663   1 001591  DC86                                 LDB,B5   ,B6
          1 001592  8945 001F                            LBT,'8000'X       31,B5
          1 001594       8000

     1765    24664    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNRJC)='1'B;

  24664   1 001595  DC86                                 LDB,B5   ,B6
          1 001596  8945 001F                            LBT,'4000'X       31,B5
          1 001598       4000

     1766    24665    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSSTR)='1'B;

  24665   1 001599  DC86                                 LDB,B5   ,B6
          1 00159A  8945 001F                            LBT,'1000'X       31,B5
          1 00159C       1000

     1767    24666    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSVDI)='1'B;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:291  
  24666   1 00159D  DC86                                 LDB,B5   ,B6
          1 00159E  8945 001F                            LBT,'0100'X       31,B5
          1 0015A0       0100

     1768    24667    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_SCH)='1'B;

  24667   1 0015A1  DC86                                 LDB,B5   ,B6
          1 0015A2  8945 001F                            LBT,'0800'X       31,B5
          1 0015A4       0800

     1769    24668    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_VDHEXT)='1'B;

  24668   1 0015A5  DC86                                 LDB,B5   ,B6
          1 0015A6  8945 001F                            LBT,'0200'X       31,B5
          1 0015A8       0200

     1770    24669    2           CALL KVV$VDI(KV$VDH_CNC) ALTRET (CNC_FAIL);

  24669   1 0015A9  DBC7 0024                            LAB,B5   KV$VDH_CNC,AUTO
          1 0015AB  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 0015AD  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0015AF  CBF0 0100                            LAB,B4   256,IMO
          1 0015B1  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 0015B4       0049                            DC       s:24691,PREL

     1771    24670    2           KZ$3270DEV.ACTIVE='1'B;

  24670   1 0015B5  ECC7 000D                            LDB,B6   DEV$,AUTO
          1 0015B7  8946 0012                            LBT,'4000'X       18,B6
          1 0015B9       4000

     1772    24671
     1773    24672    2           KZ$3270DEV.VDI$=P1$;

  24672   1 0015BA  DCC7 0011                            LDB,B5   P1$,AUTO
          1 0015BC  DFC6 0004                            STB,B5   4,B6

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:292  
     1774    24673
     1775    24674    2           CALL KZT$CLEAR(KZ$3270DEV);

  24674   1 0015BE  BBC7 000D                            LAB,B3   DEV$,AUTO
          1 0015C0  CBF0 0100                            LAB,B4   256,IMO
          1 0015C2  E380 0000 0000  xent                 LNJ,B6   KZT$CLEAR
          1 0015C5       0001                            DC       s:24676,PREL

     1776    24675
     1777    24676    2           %KV_VDI.USEOTPBFRTRN='0'B;

  24676   1 0015C6  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0015C9  DC86                                 LDB,B5   ,B6
          1 0015CA  8845 001D                            LBF,'0080'X       29,B5
          1 0015CC       0080

     1778    24677    3           IF KZ$3270DEV.PRINTER THEN DO;

  24677   1 0015CD  DCC7 000D                            LDB,B5   DEV$,AUTO
          1 0015CF  82C5 0012                            LB,'0800'X        18,B5
          1 0015D1       0800
          1 0015D2  0581 000C                            BBF      s:24682,PREL

     1779    24678    3              %KV_MRD.CTNFRM='1'B;         /* Continuous form                    */

  24678   1 0015D4  CCC6 0008                            LDB,B4   8,B6
          1 0015D6  8944 0018                            LBT,'0800'X       24,B4
          1 0015D8       0800

     1780    24679    3              %KV_MRD.MINSP_FORPST=0;

  24679   1 0015D9  CCC6 0008                            LDB,B4   8,B6
          1 0015DB  87C4 000C                            CLH      12,B4

     1781    24680    3              END;

  24680   1 0015DD  0F81 000F                            B        s:24686,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:293  

     1782    24681    3           ELSE DO;                        /* Display                            */

     1783    24682    3              %KV_MRD.FSTERS='1'B;

  24682   1 0015DF  CCC6 0008                            LDB,B4   8,B6
          1 0015E1  8944 0017                            LBT,'0001'X       23,B4
          1 0015E3       0001

     1784    24683    3              %KV_MRD.ATRRQRDSPPST='1'B;

  24683   1 0015E4  CCC6 0008                            LDB,B4   8,B6
          1 0015E6  8944 0018                            LBT,'8000'X       24,B4
          1 0015E8       8000

     1785    24684    3              %KV_VDI.INPUNT=%KV_INPUNT_BLK;

  24684   1 0015E9  CC86                                 LDB,B4   ,B6
          1 0015EA  8944 001D                            LBT,'0060'X       29,B4
          1 0015EC       0060

     1786    24685    3              END;

     1787    24686    2           CALL EXIT_VDH (ADDR(NIL));

  24686   1 0015ED  CB80 0000 0000                       LAB,B4   0
          1 0015F0  CFC7 009B                            STB,B4   @DFRD+31,AUTO
          1 0015F2  BBC7 009B                            LAB,B3   @DFRD+31,AUTO
          1 0015F4  BFC7 007A                            STB,B3   I+4,AUTO
          1 0015F6  E3C0 01A5                            LNJ,B6   s:0,PREL
          1 0015F8       0001                            DC       s:24688,PREL

     1788    24687
     1789    24688    2           RETURN;

  24688   1 0015F9  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 0015FB  C3C6 0001                            LNJ,B4   1,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:294  

     1790    24689
     1791    24690    2   CNC_FAIL:
     1792    24691    2           KZ$3270DEV.ACTIVE='0'B;

  24691   1 0015FD  ECC7 000D            CNC_FAIL        LDB,B6   DEV$,AUTO
          1 0015FF  8846 0012                            LBF,'4000'X       18,B6
          1 001601       4000

     1793    24692
     1794    24693    2           KV$VDH_EVT=KV_VDH_EVT;

  24693   1 001602  8C80 0000 0000  xsym                 LDI      KV_VDH_EVT
          1 001605  8D47 0047                            SDI      KV$VDH_EVT,AUTO

     1795    24694    2           KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;

  24694   1 001607  5C03                                 LDV,R5   3
          1 001608  DAC7 0047                            SRM,R5,'00FF'X    KV$VDH_EVT,AUTO
          1 00160A       00FF

     1796    24695    2           CALL KVV$VDI(KV$VDH_EVT);

  24695   1 00160B  DBC7 0047                            LAB,B5   KV$VDH_EVT,AUTO
          1 00160D  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 00160F  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001611  CBF0 0100                            LAB,B4   256,IMO
          1 001613  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 001616       0001                            DC       s:24696,PREL

     1797    24696    2           CALL EXIT_VDH (ADDR(NIL));

  24696   1 001617  EB80 0000 0000                       LAB,B6   0
          1 00161A  EFC7 009D                            STB,B6   @DFRD+33,AUTO
          1 00161C  DBC7 009D                            LAB,B5   @DFRD+33,AUTO
          1 00161E  DFC7 007A                            STB,B5   I+4,AUTO
          1 001620  E3C0 017B                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:295  
          1 001622       0001                            DC       s:24697,PREL

     1798    24697    2           RETURN;

  24697   1 001623  ECC7 0072                            LDB,B6   X_00100_X,AUTO
          1 001625  C3C6 0001                            LNJ,B4   1,B6

     1799    24698
     1800    24699    2   END CNC_DEV;
     1801    24700        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:296  
     1802    24701        /* ERRLOG */
     1803    24702
     1804    24703    1   ERRLOG: PROC (ERROR);

  24703   1 001627  EFC7 0078            ERRLOG          STB,B6   I+2,AUTO

     1805    24704    2   DCL ERROR UBIN;
     1806    24705        %FPT_WRSYSLOG (STCLASS="");
     1807    24800        %FPT_WRSYSLOG (FPTN=FPT@WRSYSLOG,STCLASS=CONSTANT,FCG='KZ',MID='V');
     1808    24895    2   DCL BADPOLBFR CHAR(4) BASED;
     1809    24896
     1810    24897    2           FPT_WRSYSLOG = FPT@WRSYSLOG;

  24897   1 001629  AB80 0000 00E8  00                   LAB,B2   FPT@WRSYSLOG
          1 00162C  2C00                                 LDV,R2   0
          1 00162D  6C2A                                 LDV,R6   42
          1 00162E  BBC7 007C                            LAB,B3   FPT_WRSYSLOG,AUTO
          1 001630  3C00                                 LDV,R3   0
          1 001631  0008                                 MMM

     1811    24898    2           FPT_WRSYSLOG.V.TERMID = KZ$LINCTX.LINID;

  24898   1 001632  ACC7 0009                            LDB,B2   LIN$,AUTO
          1 001634  2C08                                 LDV,R2   8
          1 001635  6C10                                 LDV,R6   16
          1 001636  BBC7 0084                            LAB,B3   @DFRD+8,AUTO
          1 001638  3C00                                 LDV,R3   0
          1 001639  0008                                 MMM

     1812    24899    2           FPT_WRSYSLOG.V.ERRCODE.ERR# = ERROR;

  24899   1 00163A  ECC7 007A                            LDB,B6   @ERROR,AUTO
          1 00163C  E806                                 LDR,R6   ,B6
          1 00163D  6003                                 SOL,R6   3
          1 00163E  EAC7 0083                            SRM,R6,'FFF8'X    @DFRD+7,AUTO
          1 001640       FFF8

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:297  
     1813    24900    3           DO CASE (ERROR);

  24900   1 001641  B806                                 LDR,R3   ,B6
          1 001642  BA70 FF38                            ADD,R3   -200,IMO
          1 001644  3D09                                 CMV,R3   9
          1 001645  0281 00E6                            BGE      s:25006,PREL
          1 001647  A830 0000 164D  01                   LDR,R2   s:24900+12,R3
          1 00164A  83A0 0000 1656  01                   JMP      s:24910,R2
          1 00164D       0021                            DC       s:24925,PREL
          1 00164E       0080                            DC       s:24967,PREL
          1 00164F       0000                            DC       s:24910,PREL
          1 001650       005B                            DC       s:24951,PREL
          1 001651       00D6                            DC       s:25006,PREL
          1 001652       00D6                            DC       s:25006,PREL
          1 001653       00D6                            DC       s:25006,PREL
          1 001654       00D6                            DC       s:25006,PREL
          1 001655       00AD                            DC       s:24992,PREL

     1814    24901
     1815    24902    3            CASE (%E$BADPOL);

     1816    24903        /*E* ERROR:        KZV-E$BADPOL-4
     1817    24904             MESSAGE:      3270 SLAVE received a bad poll address.
     1818    24905             DESCRIPTION:  A SLAVE 3270 LINE received a poll with an illegal
     1819    24906                           Controller/Device address.
     1820    24907                           V0 = Channel number.
     1821    24908                           DATA = Vector of first four bytes of input.
     1822    24909        */
     1823    24910    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_NONFATAL_PROT#;

  24910   1 001656  6C04                                 LDV,R6   4
          1 001657  EAC7 0083                            SRM,R6,'0007'X    @DFRD+7,AUTO
          1 001659       0007

     1824    24911    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;

  24911   1 00165A  DCC7 0009                            LDB,B5   LIN$,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:298  
          1 00165C  D845 0033                            LDR,R5   51,B5
          1 00165E  DF47 008C                            STR,R5   @DFRD+16,AUTO

     1825    24912    3              FPT_WRSYSLOG.V.VALUES(1)=0;

  24912   1 001660  8747 008D                            CL       @DFRD+17,AUTO

     1826    24913    3              FPT_WRSYSLOG.V.VALUES(2)=0;

  24913   1 001662  8747 008E                            CL       @DFRD+18,AUTO

     1827    24914    3              FPT_WRSYSLOG.V.VALUES(3)=0;

  24914   1 001664  8747 008F                            CL       @DFRD+19,AUTO

     1828    24915    3              FPT_WRSYSLOG.BUF_=VECTOR(KZ$LINCTX.INPBFR$->BADPOLBFR);

  24915   1 001666  CCC5 0056                            LDB,B4   86,B5
          1 001668  CFC7 0093                            STB,B4   @DFRD+23,AUTO
          1 00166A  4C03                                 LDV,R4   3
          1 00166B  CF47 0092                            STR,R4   @DFRD+22,AUTO
          1 00166D  ABC7 0092                            LAB,B2   @DFRD+22,AUTO
          1 00166F  2C00                                 LDV,R2   0
          1 001670  6C06                                 LDV,R6   6
          1 001671  BBC7 007F                            LAB,B3   @DFRD+3,AUTO
          1 001673  3C00                                 LDV,R3   0
          1 001674  0008                                 MMM
          1 001675  0F81 00B6                            B        s:25006,PREL

     1829    24916
     1830    24917    3            CASE (%E$BADSTATUS);

     1831    24918        /*E* ERROR:        KZV-E$BADSTATUS-1
     1832    24919             MESSAGE:      Unknown 3270 device status received.
     1833    24920             DESCRIPTION:  A device status was received which requires an error log.
     1834    24921                           V0 = Channel number.
     1835    24922                           V1/V2 = Controller/Device numbers.
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:299  
     1836    24923                           V3 = Status bytes received (S1/S2).
     1837    24924        */
     1838    24925    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_GOOD_HARD#;

  24925   1 001677  6C01                                 LDV,R6   1
          1 001678  EAC7 0083                            SRM,R6,'0007'X    @DFRD+7,AUTO
          1 00167A       0007

     1839    24926    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;

  24926   1 00167B  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 00167D  D845 0033                            LDR,R5   51,B5
          1 00167F  DF47 008C                            STR,R5   @DFRD+16,AUTO

     1840    24927    3              FPT_WRSYSLOG.V.VALUES(1)=I;

  24927   1 001681  C847 0013                            LDR,R4   CNT,AUTO
          1 001683  CF47 008D                            STR,R4   @DFRD+17,AUTO

     1841    24928    3              FPT_WRSYSLOG.V.VALUES(2)=J;

  24928   1 001685  B847 0014                            LDR,R3   J,AUTO
          1 001687  BF47 008E                            STR,R3   @DFRD+18,AUTO

     1842    24929    3              FPT_WRSYSLOG.V.VALUES(3)=STATUSW;

  24929   1 001689  A847 001A                            LDR,R2   STATUS,AUTO
          1 00168B  AF47 008F                            STR,R2   @DFRD+19,AUTO

     1843    24930    4              IF KZ$LINCTX.OTPHD$~=ADDR(NIL) THEN DO;

  24930   1 00168D  8DC5 0052                            CMN      82,B5
          1 00168F  0901 000E                            BE       s:24935,PREL

     1844    24931    4                 VBASE(FPT_WRSYSLOG.BUF_)=KZ$LINCTX.OTPHD$;

  24931   1 001691  CCC5 0052                            LDB,B4   82,B5
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:300  
          1 001693  CFC7 0080                            STB,B4   @DFRD+4,AUTO

     1845    24932    4                 VBOUND(FPT_WRSYSLOG.BUF_)=KZ$LINCTX.OTPHD$->KZ$OTPBFR.DATA_SIZ-1;

  24932   1 001695  BCC5 0052                            LDB,B3   82,B5
          1 001697  9843 0003                            LDR,R1   3,B3
          1 001699  1EFF                                 ADV,R1   -1
          1 00169A  9F47 007F                            STR,R1   @DFRD+3,AUTO

     1846    24933    4                 END;

  24933   1 00169C  0F81 008F                            B        s:25006,PREL

     1847    24934    3              ELSE
     1848    24935    4                 IF KZ$3270DEV.OTPHD$ ~= ADDR(NIL) THEN DO;

  24935   1 00169E  CCC7 000D                            LDB,B4   DEV$,AUTO
          1 0016A0  8DC4 0008                            CMN      8,B4
          1 0016A2  0901 0089                            BE       s:25006,PREL

     1849    24936    4                    VBASE(FPT_WRSYSLOG.BUF_)=KZ$3270DEV.OTPHD$;

  24936   1 0016A4  BCC4 0008                            LDB,B3   8,B4
          1 0016A6  BFC7 0080                            STB,B3   @DFRD+4,AUTO

     1850    24937    4                    VBOUND(FPT_WRSYSLOG.BUF_)=KZ$3270DEV.OTPHD$->KZ$OTPBFR.DATA_SIZ-1;

  24937   1 0016A8  ACC4 0008                            LDB,B2   8,B4
          1 0016AA  9842 0003                            LDR,R1   3,B2
          1 0016AC  1EFF                                 ADV,R1   -1
          1 0016AD  9F47 007F                            STR,R1   @DFRD+3,AUTO

     1851    24938    4                    END;

  24938   1 0016AF  0F81 007C                            B        s:25006,PREL

     1852    24939
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:301  
     1853    24940    3            CASE (%E$BADADR);

     1854    24941        /*E* ERROR:        KZV-E$BADADR-3
     1855    24942             MESSAGE:      Undefined Controller/Device number in LINFCN request.
     1856    24943             DESCRIPTION:  A LINFCN code of DSCTRM, KILL, BLDCTX, ENABL, or POL
     1857    24944                           was received by the 3270 device manager, but the
     1858    24945                           Controller/Device for which the service was requested
     1859    24946                           is undefined.
     1860    24947                           V0 = Channel number.
     1861    24948                           V1/V2 = Controller/Device numbers.
     1862    24949                           DATA = Vector of the KZ$EVENT parameter.
     1863    24950        */
     1864    24951    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_SOFT#;

  24951   1 0016B1  6C03                                 LDV,R6   3
          1 0016B2  EAC7 0083                            SRM,R6,'0007'X    @DFRD+7,AUTO
          1 0016B4       0007

     1865    24952    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;

  24952   1 0016B5  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0016B7  D845 0033                            LDR,R5   51,B5
          1 0016B9  DF47 008C                            STR,R5   @DFRD+16,AUTO

     1866    24953    3              FPT_WRSYSLOG.V.VALUES(1)=I;

  24953   1 0016BB  C847 0013                            LDR,R4   CNT,AUTO
          1 0016BD  CF47 008D                            STR,R4   @DFRD+17,AUTO

     1867    24954    3              FPT_WRSYSLOG.V.VALUES(2)=J;

  24954   1 0016BF  B847 0014                            LDR,R3   J,AUTO
          1 0016C1  BF47 008E                            STR,R3   @DFRD+18,AUTO

     1868    24955    3              FPT_WRSYSLOG.V.VALUES(3)=0;

  24955   1 0016C3  8747 008F                            CL       @DFRD+19,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:302  

     1869    24956    3              FPT_WRSYSLOG.BUF_=VECTOR(KZ$EVENT);

  24956   1 0016C5  CCC7 0004                            LDB,B4   @PARAMETER1,AUTO
          1 0016C7  CFC7 0093                            STB,B4   @DFRD+23,AUTO
          1 0016C9  2C1B                                 LDV,R2   27
          1 0016CA  AF47 0092                            STR,R2   @DFRD+22,AUTO
          1 0016CC  ABC7 0092                            LAB,B2   @DFRD+22,AUTO
          1 0016CE  2C00                                 LDV,R2   0
          1 0016CF  6C06                                 LDV,R6   6
          1 0016D0  BBC7 007F                            LAB,B3   @DFRD+3,AUTO
          1 0016D2  3C00                                 LDV,R3   0
          1 0016D3  0008                                 MMM
          1 0016D4  0F81 0057                            B        s:25006,PREL

     1870    24957
     1871    24958    3            CASE (%E$THRERR);

     1872    24959        /*E* ERROR:        KZV-E$THRERR-3
     1873    24960             MESSAGE:      Throttling is out of sync.
     1874    24961             DESCRIPTION:  A device's output byte count is non zero, but no output
     1875    24962                           is pending (or in progress).
     1876    24963                           V0 = Channel number.
     1877    24964                           V1/V2 = Controller/Device numbers.
     1878    24965                           V3 = Current output byte count.
     1879    24966        */
     1880    24967    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_SOFT#;

  24967   1 0016D6  6C03                                 LDV,R6   3
          1 0016D7  EAC7 0083                            SRM,R6,'0007'X    @DFRD+7,AUTO
          1 0016D9       0007

     1881    24968    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;

  24968   1 0016DA  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 0016DC  D845 0033                            LDR,R5   51,B5
          1 0016DE  DF47 008C                            STR,R5   @DFRD+16,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:303  

     1882    24969    3              IF DEV$=ADDR(NIL) OR CTR$=ADDR(NIL) THEN

  24969   1 0016E0  8DC7 000D                            CMN      DEV$,AUTO
          1 0016E2  0901 0005                            BE       s:24971,PREL
          1 0016E4  8DC7 000B                            CMN      CTR$,AUTO
          1 0016E6  0981 000A                            BNE      s:24977,PREL

     1883    24970    4              DO;

     1884    24971    4                 FPT_WRSYSLOG.V.VALUES(1)=31;

  24971   1 0016E8  4C1F                                 LDV,R4   31
          1 0016E9  CF47 008D                            STR,R4   @DFRD+17,AUTO

     1885    24972    4                 FPT_WRSYSLOG.V.VALUES(2)=31;

  24972   1 0016EB  CF47 008E                            STR,R4   @DFRD+18,AUTO

     1886    24973    4                 FPT_WRSYSLOG.V.VALUES(3)=0;

  24973   1 0016ED  8747 008F                            CL       @DFRD+19,AUTO

     1887    24974    4                 END;

  24974   1 0016EF  0F81 003C                            B        s:25006,PREL

     1888    24975    3              ELSE
     1889    24976    4              DO;

     1890    24977    4                 FPT_WRSYSLOG.V.VALUES(1)=KZ$3270DEV.CTR$->KZ$3270CTR.ADR;

  24977   1 0016F1  CCC7 000D                            LDB,B4   DEV$,AUTO
          1 0016F3  BCC4 0002                            LDB,B3   2,B4
          1 0016F5  C2C3 000A                            LLH,R4   10,B3
          1 0016F7  CF47 008D                            STR,R4   @DFRD+17,AUTO

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:304  
     1891    24978    4                 FPT_WRSYSLOG.V.VALUES(2)=KZ$3270DEV.ADR;

  24978   1 0016F9  B2C4 0015                            LLH,R3   21,B4
          1 0016FB  BF47 008E                            STR,R3   @DFRD+18,AUTO

     1892    24979    4                 FPT_WRSYSLOG.V.VALUES(3)=KZ$3270DEV.OTPBYTES;

  24979   1 0016FD  A844 0014                            LDR,R2   20,B4
          1 0016FF  AF47 008F                            STR,R2   @DFRD+19,AUTO

     1893    24980    4                 END;

  24980   1 001701  0F81 002A                            B        s:25006,PREL

     1894    24981    3            CASE (%E$NO_MEMORY);

     1895    24982        /*   ERROR:        KZV-E$NO_MEMORY-6
     1896    24983             MESSAGE:      Insufficient BISYNC MEMory (a NETCON parameter).
     1897    24984             DESCRIPTION:  A KVB call ALTRETed to indicate that BISYNC is out of
     1898    24985                           MEMory.  Since a necessary I/O buffer or device context
     1899    24986                           could not be allocated, the 3270 LINE associated
     1900    24987                           with the request has been disconnected.
     1901    24988                           V0 = Channel number.
     1902    24989                           V1/V2 = Controller/Device numbers.
     1903    24990                           V3 = Size of buffer, in words, which could not be allocated.
     1904    24991        */
     1905    24992    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_LINE_ABORT#;

  24992   1 001703  6C06                                 LDV,R6   6
          1 001704  EAC7 0083                            SRM,R6,'0007'X    @DFRD+7,AUTO
          1 001706       0007

     1906    24993    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;

  24993   1 001707  DCC7 0009                            LDB,B5   LIN$,AUTO
          1 001709  D845 0033                            LDR,R5   51,B5
          1 00170B  DF47 008C                            STR,R5   @DFRD+16,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:305  

     1907    24994    3              IF DEV$=ADDR(NIL) OR CTR$=ADDR(NIL) THEN

  24994   1 00170D  8DC7 000D                            CMN      DEV$,AUTO
          1 00170F  0901 0005                            BE       s:24996,PREL
          1 001711  8DC7 000B                            CMN      CTR$,AUTO
          1 001713  0981 0008                            BNE      s:25001,PREL

     1908    24995    4              DO;

     1909    24996    4                 FPT_WRSYSLOG.V.VALUES(1)=31;

  24996   1 001715  4C1F                                 LDV,R4   31
          1 001716  CF47 008D                            STR,R4   @DFRD+17,AUTO

     1910    24997    4                 FPT_WRSYSLOG.V.VALUES(2)=31;

  24997   1 001718  CF47 008E                            STR,R4   @DFRD+18,AUTO

     1911    24998    4                 END;

  24998   1 00171A  0F81 000D                            B        s:25004,PREL

     1912    24999    3              ELSE
     1913    25000    4              DO;

     1914    25001    4                 FPT_WRSYSLOG.V.VALUES(1)=KZ$3270DEV.CTR$->KZ$3270CTR.ADR;

  25001   1 00171C  CCC7 000D                            LDB,B4   DEV$,AUTO
          1 00171E  BCC4 0002                            LDB,B3   2,B4
          1 001720  C2C3 000A                            LLH,R4   10,B3
          1 001722  CF47 008D                            STR,R4   @DFRD+17,AUTO

     1915    25002    4                 FPT_WRSYSLOG.V.VALUES(2)=KZ$3270DEV.ADR;

  25002   1 001724  B2C4 0015                            LLH,R3   21,B4
          1 001726  BF47 008E                            STR,R3   @DFRD+18,AUTO
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:306  

     1916    25003    4                 END;

     1917    25004    3              FPT_WRSYSLOG.V.VALUES(3)=SZ;

  25004   1 001728  B847 001B                            LDR,R3   SZ,AUTO
          1 00172A  BF47 008F                            STR,R3   @DFRD+19,AUTO

     1918    25005    3            END;

     1919    25006    2           CALL KHA$ERRLOG(FPT_WRSYSLOG);

  25006   1 00172C  DBC7 007C                            LAB,B5   FPT_WRSYSLOG,AUTO
          1 00172E  DFC7 0092                            STB,B5   @DFRD+22,AUTO
          1 001730  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 001732  CBF0 0100                            LAB,B4   256,IMO
          1 001734  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          1 001737       0001                            DC       s:25007,PREL

     1920    25007    2           RETURN;

  25007   1 001738  ECC7 0078                            LDB,B6   I+2,AUTO
          1 00173A  C3C6 0001                            LNJ,B4   1,B6

     1921    25008    2   END ERRLOG;
     1922    25009        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:307  
     1923    25010        /* ENTER_VDH - Try to enter VDH */
     1924    25011
     1925    25012    1   ENTER_VDH: PROC(VDI$,DFRD);

  25012   1 00173C  EFC7 0078            ENTER_VDH       STB,B6   I+2,AUTO

     1926    25013
     1927    25014    2   DCL DFRD BIT(1) ALIGNED;
     1928    25015    2   DCL VDI$ PTR;
     1929    25016
     1930    25017    3           IF VDH_FLG~=0 THEN DO;

  25017   1 00173E  E847 0021                            LDR,R6   VDH_FLG,AUTO
          1 001740  6901 000A                            BEZ,R6   s:25023,PREL

     1931    25018    3              VDH_FLG=VDH_FLG+1;

  25018   1 001742  8AC7 0021                            INC      VDH_FLG,AUTO

     1932    25019    3              DFRD='0'B;

  25019   1 001744  DCC7 007C                            LDB,B5   @DFRD,AUTO
          1 001746  8705                                 CL       ,B5

     1933    25020    3              RETURN;

  25020   1 001747  ECC7 0078                            LDB,B6   I+2,AUTO
          1 001749  C3C6 0001                            LNJ,B4   1,B6

     1934    25021    3              END;
     1935    25022
     1936    25023    2           IF VDI$ = ADDR(NIL)

  25023   1 00174B  DCC7 007A                            LDB,B5   @VDI$,AUTO
          1 00174D  8D85                                 CMN      ,B5
          1 00174E  0981 0008                            BNE      s:25066,PREL

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:308  
     1937    25024    3           THEN DO;

     1938    25025                   %KV$USRENT (VDI$="ADDR(NIL)");
             25031    3              KV@USRENT.SVDPTR$ = KV$PTR$;

  25031   1 001750  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 001753  CFC7 0059                            STB,B4   KV@USRENT,AUTO

     1939    25051    3              END;

  25051   1 001755  0F81 0034                            B        s:25080,PREL

     1940    25052    3           ELSE DO;

     1941    25053                   %KV$USRENT (VDI$=KZ$3270DEV.VDI$,DFR$=DFR,SCHRSN=%KV_SCHRSN_DFR1);
             25066    3           KZ$3270DEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             25066                    KZ$3270DEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  25066   1 001757  CCC7 000D                            LDB,B4   DEV$,AUTO
          1 001759  BCC4 0004                            LDB,B3   4,B4
          1 00175B  ACC3 0008                            LDB,B2   8,B3
          1 00175D  9CC2 0033                            LDB,B1   51,B2
          1 00175F  8AC1 0039                            INC      57,B1
          1 001761  8EC1 0038                            CAD      56,B1

             25067    4           IF NOT KZ$3270DEV.VDI$->KV$VDI.BSY THEN DO;

  25067   1 001763  ECC4 0004                            LDB,B6   4,B4
          1 001765  82C6 0019                            LB,'0080'X        25,B6
          1 001767       0080
          1 001768  0501 0012                            BBT      s:25073,PREL

             25068    4              KZ$3270DEV.VDI$->KV$VDI.BSY = '1'B;

  25068   1 00176A  8946 0019                            LBT,'0080'X       25,B6
  25068   1 00176C       0080

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:309  
             25069    4              KV@USRENT.SVDPTR$ = KV$PTR$;

  25069   1 00176D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001770  EFC7 0059                            STB,B6   KV@USRENT,AUTO

             25070    4              KV$PTR$ = KZ$3270DEV.VDI$->KV$VDI.ASNINPPTR$;

  25070   1 001772  BCC4 0004                            LDB,B3   4,B4
          1 001774  ACC3 0006                            LDB,B2   6,B3
          1 001776  AF80 0000 0000  xsym                 STB,B2   KV$PTR$

             25071    4              END;                         /* ELSE IF ~BSY                       */

  25071   1 001779  0F81 0010                            B        s:25080,PREL

             25072    4           ELSE DO;

             25073    4              KZ$3270DEV.VDI$->KV$VDI.DFR.USR(1) = '1'B;

  25073   1 00177B  8946 0018                            LBT,'4000'X       24,B6
  25073   1 00177D       4000

             25074    4           KZ$3270DEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             25074                   KZ$3270DEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1
             25074                    ;

  25074   1 00177E  ECC4 0004                            LDB,B6   4,B4
          1 001780  BCC6 0008                            LDB,B3   8,B6
          1 001782  ACC3 0033                            LDB,B2   51,B3
          1 001784  8AC2 003B                            INC      59,B2
          1 001786  8EC2 003A                            CAD      58,B2

             25075    4              GOTO DFR;

  25075   1 001788  0F81 000B                            B        s:25084,PREL

             25076    4              END;                         /* END IF                             */
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:310  
     1942    25079    3              END;
     1943    25080    2           VDH_FLG=1;

  25080   1 00178A  6C01                                 LDV,R6   1
          1 00178B  EF47 0021                            STR,R6   VDH_FLG,AUTO

     1944    25081    2           DFRD='0'B;

  25081   1 00178D  ECC7 007C                            LDB,B6   @DFRD,AUTO
          1 00178F  8706                                 CL       ,B6

     1945    25082    2           RETURN;

  25082   1 001790  ECC7 0078                            LDB,B6   I+2,AUTO
          1 001792  C3C6 0001                            LNJ,B4   1,B6

     1946    25083    2   DFR:
     1947    25084    2           DFRD='1'B;

  25084   1 001794  ECC7 007C            DFR             LDB,B6   @DFRD,AUTO
          1 001796  8906                                 LBT,'8000'X       ,B6
          1 001797       8000

     1948    25085    2           RETURN;

  25085   1 001798  ECC7 0078                            LDB,B6   I+2,AUTO
          1 00179A  C3C6 0001                            LNJ,B4   1,B6

     1949    25086
     1950    25087    2   END ENTER_VDH;
     1951    25088        %EJECT;
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:311  
     1952    25089        /* EXIT_VDH - Exit VDH if it was entered */
     1953    25090
     1954    25091    1   EXIT_VDH: PROC (VDI$);

  25091   1 00179C  EFC7 0078            EXIT_VDH        STB,B6   I+2,AUTO

     1955    25092
     1956    25093    2   DCL VDI$ PTR;
     1957    25094
     1958    25095    2           IF VDH_FLG=0 THEN RETURN;

  25095   1 00179E  E847 0021                            LDR,R6   VDH_FLG,AUTO
          1 0017A0  6981 0005                            BNEZ,R6  s:25096,PREL

  25095   1 0017A2  ECC7 0078                            LDB,B6   I+2,AUTO
          1 0017A4  C3C6 0001                            LNJ,B4   1,B6

     1959    25096    2           VDH_FLG=VDH_FLG-1;

  25096   1 0017A6  88C7 0021                            DEC      VDH_FLG,AUTO

     1960    25097    2           IF VDH_FLG~=0 THEN RETURN;

  25097   1 0017A8  E847 0021                            LDR,R6   VDH_FLG,AUTO
          1 0017AA  6901 0005                            BEZ,R6   s:25098,PREL

  25097   1 0017AC  ECC7 0078                            LDB,B6   I+2,AUTO
          1 0017AE  C3C6 0001                            LNJ,B4   1,B6

     1961    25098    2           IF VDI$ = ADDR(NIL)

  25098   1 0017B0  DCC7 007A                            LDB,B5   @VDI$,AUTO
          1 0017B2  8D85                                 CMN      ,B5
          1 0017B3  0981 0008                            BNE      s:25112,PREL

     1962    25099    3           THEN DO;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:312  
     1963    25100                   %KV$USREXT (VDI$="ADDR(NIL)");
             25108    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  25108   1 0017B5  CCC7 0059                            LDB,B4   KV@USRENT,AUTO
          1 0017B7  CF80 0000 0000  xsym                 STB,B4   KV$PTR$

     1964    25110    3              END;

  25110   1 0017BA  0F81 0022                            B        s:25126,PREL

     1965    25111    3           ELSE DO;

     1966    25112    3              KV$USR_EVT=KV_USR_EVT;

  25112   1 0017BC  8C80 0000 0000  xsym                 LDI      KV_USR_EVT
          1 0017BF  8D47 0022                            SDI      KV$USR_EVT,AUTO

     1967    25113    3              KV$USR_EVT.ID=%KV_USR_EVT_ID_VDHEXT;

  25113   1 0017C1  5C0E                                 LDV,R5   14
          1 0017C2  DAC7 0022                            SRM,R5,'007F'X    KV$USR_EVT,AUTO
          1 0017C4       007F

     1968    25114    3              CALL KZT$3270(KV$USR_EVT);

  25114   1 0017C5  CBC7 0022                            LAB,B4   KV$USR_EVT,AUTO
          1 0017C7  CFC7 0092                            STB,B4   @DFRD+22,AUTO
          1 0017C9  BBC7 0092                            LAB,B3   @DFRD+22,AUTO
          1 0017CB  CBF0 0100                            LAB,B4   256,IMO
          1 0017CD  E380 0000 0000  xent                 LNJ,B6   KZT$3270
          1 0017D0       0001                            DC       s:25121,PREL

     1969    25115                   %KV$USREXT;
             25121    3           KV$PTR.VDI$->KV$VDI.BSY = '0'B;

  25121   1 0017D1  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0017D4  DC86                                 LDB,B5   ,B6
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:313  
          1 0017D5  8845 0019                            LBF,'0080'X       25,B5
          1 0017D7       0080

             25123    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  25123   1 0017D8  DCC7 0059                            LDB,B5   KV@USRENT,AUTO
          1 0017DA  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

     1970    25125    3              END;

     1971    25126    2           RETURN;

  25126   1 0017DD  ECC7 0078                            LDB,B6   I+2,AUTO
          1 0017DF  C3C6 0001                            LNJ,B4   1,B6
     1972    25127
     1973    25128    2   END EXIT_VDH;
     1974    25129
     1975    25130    1   END KZV$3270DV;
     1976    25131        %EOD;

PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:314  
--  Include file information  --

   KZ_3270M_C.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KZ_3270_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   KZ$3270STT.:E05TOU  is referenced.
   KZ$3270DEV.:E05TOU  is referenced.
   KZ$3270CTR.:E05TOU  is referenced.
   KZ$INPBFR.:E05TOU  is referenced.
   KZ$OTPBFR.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$USR.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:315  
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KZV$3270DV.
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:316  

 **** Variables and constants ****

  ****  Section 000 RoData KZV$3270DV

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    E8-0-0/w STRC(336)   r     1 FPT@WRSYSLOG              20-0-0/w STRC(176)   r     1 KZ_3270CTR
    2B-0-0/w STRC(448)   r     1 KZ_3270DEV                57-0-0/w STRC(224)   r     1 KZ_CLMEVENT
    47-0-0/w STRC(128)   r     1 KZ_INPBFR                 4F-0-0/w STRC(128)   r     1 KZ_OTPBFR
    BC-0-0/w PTR         r     1 KZ_TRNTBLHED$             83-0-0/w STRC(912)   r     1 KZ_USRPRM
     0-0-0/b UBIN(8)     r     1 POLADR(0:31)
     0-0-0/b BIT (8)     r     1 POLADR_B(0:31)
    65-0-0/b STRC(16)    r     1 PRO_ATTR                  10-0-0/b UBIN(8)     r     1 SELADR(0:31)
    10-0-0/b BIT (8)     r     1 SELADR_B(0:31)
    BE-0-0/w STRC(32)    r     1 STAT(0:20)                BE-0-0/w STRC(672)   r     1 STAT_
    66-0-0/w STRC(320)   r     1 VLP_TRMATTR               7B-0-0/w STRC(128)   r     1 VLP_TRMCTL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    7C-0-0/w PTR         r     1 @DFRD                     7A-0-0/w PTR         r     1 @ERROR
     4-0-0/w PTR         r     1 @PARAMETER1                6-0-0/w PTR         r     1 @PARAMETER2
    70-0-0/w PTR         r     1 @RSN                      7A-0-0/w PTR         r     1 @VDI$
    7A-0-0/w PTR         r     1 @VDI$                     70-0-0/w PTR         r     1 B$
    15-0-0/w PTR         r     1 BFR$                      17-0-0/w UBIN(16)    r     1 BFR_SIZ
    13-0-0/w UBIN(16)    r     1 CNT                       6B-0-0/w PTR         r     1 CP_PHLEGM
     B-0-0/w PTR         r     1 CTR$                       D-0-0/w PTR         r     1 DEV$
    *0-0-0/w STRC(448)   r     1 DEVCTX                    20-0-0/b BIT         r     1 DFRD
    *0-0-0/w BIT         r     1 DFRD                      6A-0-0/w UBIN(16)    r     1 DISABLE_LEVEL
    *0-0-0/w UBIN(16)    r     1 ERROR                      8-0-0/w UBIN(16)    r     1 FAKE
    7C-0-0/w STRC(336)   r     1 FPT_WRSYSLOG              13-0-0/w UBIN(16)    r     1 I
    76-0-0/w UBIN(16)    r     1 I                         14-0-0/w UBIN(16)    r     1 J
    22-0-0/w STRC(32)    r     1 KV$USR_EVT                24-0-0/w STRC(400)   r     1 KV$VDH_CNC
    3D-0-0/w STRC(128)   r     1 KV$VDH_DAT                45-0-0/w STRC(32)    r     1 KV$VDH_DSC
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:317  
    47-0-0/w STRC(32)    r     1 KV$VDH_EVT                49-0-0/w STRC(176)   r     1 KV$VDH_INT
    54-0-0/w STRC(80)    r     1 KV$VDH_OTPMRK             59-0-0/w STRC(32)    r     1 KV@USRENT
    5B-0-0/w STRC(224)   r     1 KZ$CLMEVENT               *0-0-0/w STRC(224)   r     1 KZ$EVENT
     9-0-0/w PTR         r     1 LIN$                      *0-0-0/w STRC(2192)  r     1 LINCTX
    *0-0-0/w UBIN(16)    r     1 LINRSP                    *0-0-0/w BIT (16)    r     1 LINSTAT
    *0-0-0/w PTR         r     1 OTPBFR$                   73-0-0/w PTR         r     1 O_11011_O
    11-0-0/w PTR         r     1 P1$                       *0-0-0/w ACHR        r     1 PARAMETER1
    *0-0-0/c ACHR        r     1 PARAMETER2                6B-0-0/w PTR         r     1 P_PHLEGM
    *0-0-0/w UBIN(16)    r     1 RSN                       17-0-0/w UBIN(16)    r     1 STAT#
    1A-0-0/b BIT (16)    r     1 STATUS                    1A-0-0/b STRC(16)    r     1 STATUSB
    1A-0-0/w UBIN(16)    r     1 STATUSW                   1B-0-0/w SBIN(16)    r     1 SZ
     F-0-0/w PTR         r     1 T$                        18-0-0/w PTR         r     1 TBFR$
    1C-0-0/w PTR         r     1 TCTR$                     1E-0-0/w PTR         r     1 TDEV$
    21-0-0/w UBIN(16)    r     1 VDH_FLG                   *0-0-0/w PTR         r     1 VDI$
    *0-0-0/w PTR         r     1 VDI$                      72-0-0/w UBIN(16)    r     1 X_00100_X

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KH_CTLTBL$                 0-0-0/w UBIN(16)    r     1 KH_INHLVL
     0-0-0/w VECT        r     1 KH_PROFILE_                0-0-0/w PTR         r     1 KV$PTR$
     0-0-0/w STRC(32)    r     1 KV_USR_EVT                 0-0-0/w STRC(400)   r     1 KV_VDH_CNC
     0-0-0/w STRC(128)   r     1 KV_VDH_DAT                 0-0-0/w STRC(32)    r     1 KV_VDH_DSC
     0-0-0/w STRC(32)    r     1 KV_VDH_EVT                 0-0-0/w STRC(32)    r     1 KV_VDH_EVT_RQSOTP
     0-0-0/w STRC(176)   r     1 KV_VDH_INT                 0-0-0/w STRC(80)    r     1 KV_VDH_OTPMRK
     0-0-0/w EPTR        r     1 KZT_CNCDSC@                0-0-0/w UBIN(16)    r     1 KZT_THRTL_INIT
     0-0-0/w UBIN(16)    r     1 KZT_THRTL_UNBLK            0-0-0/w PTR         r     1 KZT_USRPRM$
     0-0-0/w STRC(272)   r     1 KZ_3270M_HDR               0-0-0/w UBIN(16)    r     1 KZ_3270PRFFNCTBL
     0-0-0/w UBIN(16)    r     1 KZ_3270STD
     0-0-0/c UBIN(8)     r     1 KZ_3270XL(0:63)
     0-0-0/b BIT (8)     r     1 KZ_3270XLB(0:63)
     0-0-0/w UBIN(16)    r     1 KZ_3270_BFRSIZ(0:7)
     0-0-0/w PTR         r     1 KZ_INPFNCTBLHED$           0-0-0/w PTR         r     1 KZ_VDHSTT$

  ****  BASED and DCB variables  ****
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:318  

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(128)   r     1 B$TERMINAL_ID              0-0-0/c CHAR(4)     r     1 BADPOLBFR
     0-0-0/w BIT (16)    r     1 BIT16(0:1023)              0-0-0/c BIT (8)     r     1 BITS(0:1023)
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(64)    r     1 KH$CTLTBL
     0-0-0/c STRC(128)   r     1 KL_CONTROLLER              0-0-0/c STRC(128)   r     1 KL_LINEDEV
     0-0-0/w STRC(512)   r     1 KV$MRD                     0-0-0/w STRC(48)    r     1 KV$OTPMRK
     0-0-0/w STRC(480)   r     1 KV$PTR                     0-0-0/w STRC(8960)  r     1 KV$STT
     0-0-0/w STRC(912)   r     1 KV$USRPRM                  0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/w STRC(176)   r     1 KZ$3270CTR                 0-0-0/w STRC(448)   r     1 KZ$3270DEV
     0-0-0/w STRC(2656)  r     1 KZ$3270STT                 0-0-0/w STRC(128)   r     1 KZ$INPBFR
     0-0-0/w STRC(2192)  r     1 KZ$LINCTX                  0-0-0/w STRC(128)   r     1 KZ$OTPBFR
     0-0-0/w PTR         r     1 P$(0:31)                   0-0-0/c UBIN(8)     r     1 UBYT(0:31)
     0-0-0/w UBIN(16)    r     1 VDHTRCWORD


   Procedure KZV$3270DV requires 6113 words for executable code.
   Procedure KZV$3270DV requires 159 words of local(AUTO) storage.
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:319  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:320  
          MINI XREF LISTING

B$ IN PROCEDURE REQUEUE
     24262**DCL     24271<<ASSIGN  24275>>ASSIGN  24276>>ASSIGN  24278>>ASSIGN
B$TERMINAL_ID.LEV
     21648**DCL     23618>>DOCASE  23736>>DOCASE  23815>>DOCASE
B$TERMINAL_ID.TERM
     21648**DCL     21657--REDEF
B$TERMINAL_ID.TERM.SUBDEVICE
     21654**DCL     23648>>ASSIGN  23668>>ASSIGN  23822>>ASSIGN
B$TERMINAL_ID.TERM.SUBSUBDEVICE
     21654**DCL     23669>>ASSIGN  23823>>ASSIGN
BADPOLBFR IN PROCEDURE ERRLOG
     24895**DCL     24915--ASSIGN
BFR$
     18527**DCL     20716--IMP-PTR 20749--IMP-PTR 23202<<ASSIGN  23203>>IF      23204>>ASSIGN  23207>>ASSIGN
     23210>>IF      23213>>IF      23286<>CALL    23290>>ASSIGN  23291>>ASSIGN  23292>>ASSIGN  23293>>ASSIGN
     23294>>ASSIGN  23295>>ASSIGN  23298>>ASSIGN  23299>>ASSIGN  23300>>ASSIGN  23301>>ASSIGN  23302>>ASSIGN
     23303>>ASSIGN  23307>>ASSIGN  23308>>ASSIGN  23309>>ASSIGN  23310>>ASSIGN  23312>>ASSIGN  23313>>ASSIGN
     23315>>ASSIGN  23352<<ASSIGN  23353>>IF      23354>>ASSIGN  23357>>ASSIGN  23967<<ASSIGN  23968>>ASSIGN
     23971>>DOCASE  23976>>ASSIGN  23977>>ASSIGN  23978>>ASSIGN  23979>>ASSIGN  23982>>ASSIGN  23984>>ASSIGN
     23985>>ASSIGN  23987>>ASSIGN  24038<<ASSIGN  24188>>ASSIGN  24190>>ASSIGN  24191>>ASSIGN  24192>>ASSIGN
     24197>>IF      24200>>IF      24201>>ASSIGN  24201>>ASSIGN  24203>>DOWHILE 24206>>ASSIGN  24209>>ASSIGN
     24209>>ASSIGN  24213>>IF      24214>>ASSIGN  24242>>ASSIGN  24243>>ASSIGN  24567<<ASSIGN  24568>>ASSIGN
     24571>>DOCASE  24573>>ASSIGN  24576>>ASSIGN  24577>>CALL    24578>>ASSIGN
BFR_SIZ
     18528**DCL     18529--REDEF   23283<<ASSIGN  23285>>ASSIGN  23287>>ASSIGN  23287>>ASSIGN  23288>>ASSIGN
     23291>>ASSIGN
BIT16
     21331**DCL     23231>>ASSIGN  23841>>ASSIGN  23848>>ASSIGN  23901>>ASSIGN  23927>>ASSIGN  24092>>ASSIGN
BITS
     21330**DCL     23433>>ASSIGN  23457<<ASSIGN
BLD_CTR_CTX
     24135**PROC    23746--CALL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:321  
BLD_DEV_CTX
     24109**PROC    23768--CALL
CLR_CTR
     24391**PROC    24352--CALL
CLR_DEV
     24373**PROC    24325--CALL    24328--CALL    24334--CALL
CNC_DEV
     24586**PROC    23174--CALL    23274--CALL    23437--CALL    23478--CALL    23829--CALL    24388--CALL
CNC_FAIL IN PROCEDURE CNC_DEV
     24691**LABEL   24669--CALLALT
CNT
     18524**DCL     18525--REDEF   23110<<ASSIGN  23116<<ASSIGN  23182>>IF
CONT
     23352**LABEL   23330--GOTO    23343--GOTO
CP_PHLEGM
     22202**DCL     22203--REDEF   24646<<ASSIGN
CTR$
     18520**DCL     20497--IMP-PTR 23095<<ASSIGN  23118<<ASSIGN  23119>>DOWHILE 23121>>ASSIGN  23144>>ASSIGN
     23147>>ASSIGN  23148>>ASSIGN  23155>>ASSIGN  23171>>ASSIGN  23179<<ASSIGN  23179>>ASSIGN  23298>>ASSIGN
     23390<<ASSIGN  23391>>ASSIGN  23393>>ASSIGN  23417<<ASSIGN  23505<<ASSIGN  23575<<ASSIGN  23579>>IF
     23581>>ASSIGN  23591<<ASSIGN  23598>>ASSIGN  23623<<ASSIGN  23624>>IF      23627>>DOWHILE 23628>>ASSIGN
     23629>>ASSIGN  23643<<ASSIGN  23651>>ASSIGN  23740<<ASSIGN  23741>>DOWHILE 23742>>IF      23744<<ASSIGN
     23744>>ASSIGN  23748>>ASSIGN  23749>>ASSIGN  23750>>ASSIGN  23751>>ASSIGN  23752>>ASSIGN  23753>>ASSIGN
     23755>>ASSIGN  23762>>ASSIGN  23773>>IF      23798<<ASSIGN  23801>>ASSIGN  23802<<ASSIGN  23802>>ASSIGN
     23864>>ASSIGN  23867<<ASSIGN  23872>>ASSIGN  23930>>ASSIGN  23962<<ASSIGN  23963>>ASSIGN  23998<<ASSIGN
     23999>>ASSIGN  24007<<ASSIGN  24008>>ASSIGN  24035<<ASSIGN  24036>>ASSIGN  24049<<ASSIGN  24050>>ASSIGN
     24063<<ASSIGN  24064>>DOWHILE 24065>>IF      24067<<ASSIGN  24067>>ASSIGN  24077>>ASSIGN  24097>>ASSIGN
     24117>>ASSIGN  24119>>ASSIGN  24120>>ASSIGN  24121>>IF      24123>>ASSIGN  24124>>ASSIGN  24140<<ASSIGN
     24141>>ASSIGN  24149>>ASSIGN  24151>>ASSIGN  24337>>ASSIGN  24353>>ASSIGN  24385>>ASSIGN  24392>>ASSIGN
     24393>>ASSIGN  24397>>ASSIGN  24404>>ASSIGN  24425>>DOWHILE 24430>>ASSIGN  24432>>ASSIGN  24969>>IF
     24994>>IF
CTRLOOP
     23111**LABEL   23379--GOTO    23692--GOTO
DEL_DFRD
     24564**PROC    24497--CALL    24515--CALL
DEV$
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:322  
     18521**DCL     20537--IMP-PTR 23094<<ASSIGN  23124<<ASSIGN  23125>>DOWHILE 23127>>IF      23127>>IF
     23130>>ASSIGN  23132>>ASSIGN  23134>>ASSIGN  23135>>ASSIGN  23136>>ASSIGN  23136>>ASSIGN  23138>>IF
     23139>>ASSIGN  23141>>IF      23141>>IF      23145>>ASSIGN  23146>>ASSIGN  23149>>ASSIGN  23154>>IF
     23156>>ASSIGN  23161<<ASSIGN  23161>>ASSIGN  23171<<ASSIGN  23172>>DOWHILE 23173>>IF      23175<<ASSIGN
     23175>>ASSIGN  23194<<ASSIGN  23207<<ASSIGN  23209>>IF      23211>>ASSIGN  23214>>ASSIGN  23240>>ASSIGN
     23243>>IF      23250>>IF      23252>>ASSIGN  23252>>ASSIGN  23253>>IF      23255>>ASSIGN  23262>>ASSIGN
     23263>>IF      23264>>IF      23265>>ASSIGN  23269>>ASSIGN  23270>>ASSIGN  23278>>IF      23281>>IF
     23284>>ASSIGN  23295>>ASSIGN  23299>>ASSIGN  23312>>ASSIGN  23313>>ASSIGN  23314>>IF      23315>>ASSIGN
     23319>>IF      23320>>ASSIGN  23326>>IF      23335>>IF      23336>>IF      23337>>ASSIGN  23338>>ASSIGN
     23340>>ASSIGN  23340>>ASSIGN  23341>>IF      23342>>ASSIGN  23345>>ASSIGN  23349>>IF      23418<<ASSIGN
     23419>>ASSIGN  23420>>ASSIGN  23421>>ASSIGN  23422>>IF      23423>>IF      23425>>IF      23425>>IF
     23425>>IF      23436>>IF      23436>>IF      23439>>ASSIGN  23440>>ASSIGN  23444>>IF      23446>>CALL
     23448>>ASSIGN  23452>>CALL    23458>>ASSIGN  23472>>ASSIGN  23473>>ASSIGN  23474>>ASSIGN  23476>>IF
     23476>>IF      23477>>IF      23479>>ASSIGN  23483>>IF      23483>>IF      23484>>IF      23484>>IF
     23485>>ASSIGN  23486>>ASSIGN  23487>>ASSIGN  23490>>IF      23492>>CALL    23494>>ASSIGN  23496>>CALL
     23497>>CALL    23499>>ASSIGN  23506<<ASSIGN  23507>>IF      23511>>IF      23511>>IF      23512>>ASSIGN
     23513>>IF      23516>>ASSIGN  23518>>CALL    23527>>IF      23528>>ASSIGN  23530>>ASSIGN  23531>>ASSIGN
     23549>>ASSIGN  23551>>CALL    23572<<ASSIGN  23593<<ASSIGN  23598<<ASSIGN  23599>>DOWHILE 23601>>IF
     23602>>ASSIGN  23608<<ASSIGN  23608>>ASSIGN  23629<<ASSIGN  23630>>IF      23633>>DOWHILE 23634>>ASSIGN
     23635>>IF      23636>>ASSIGN  23641<<ASSIGN  23651<<ASSIGN  23652>>IF      23655>>DOWHILE 23656>>ASSIGN
     23657>>IF      23658>>ASSIGN  23663<<ASSIGN  23673>>IF      23674>>ASSIGN  23762<<ASSIGN  23763>>DOWHILE
     23764>>IF      23766<<ASSIGN  23766>>ASSIGN  23770>>ASSIGN  23772>>ASSIGN  23774>>ASSIGN  23776>>ASSIGN
     23778>>ASSIGN  23780>>ASSIGN  23826>>IF      23826>>IF      23826>>IF      23826>>IF      23870<<ASSIGN
     23872<<ASSIGN  23873>>IF      23883>>ASSIGN  23884>>IF      23884>>IF      23886>>ASSIGN  23888>>ASSIGN
     23889>>ASSIGN  23890>>ASSIGN  23890>>ASSIGN  23892>>ASSIGN  23893>>IF      23894>>ASSIGN  23904>>IF
     23904>>IF      23909>>ASSIGN  23910>>ASSIGN  23911>>ASSIGN  23911>>ASSIGN  23912>>IF      23913>>ASSIGN
     23932>>ASSIGN  23947>>CALL    23961<<ASSIGN  23962>>ASSIGN  23966>>DOWHILE 23967>>ASSIGN  23968>>ASSIGN
     23969>>IF      23970>>ASSIGN  23980>>ASSIGN  23997<<ASSIGN  23998>>ASSIGN  24006<<ASSIGN  24007>>ASSIGN
     24034<<ASSIGN  24035>>ASSIGN  24046<<ASSIGN  24047>>ASSIGN  24049>>ASSIGN  24077<<ASSIGN  24078>>DOWHILE
     24079>>IF      24081<<ASSIGN  24081>>ASSIGN  24099>>ASSIGN  24114<<ASSIGN  24115>>ASSIGN  24116>>ASSIGN
     24117>>ASSIGN  24118>>ASSIGN  24119>>ASSIGN  24120>>ASSIGN  24122>>ASSIGN  24123>>ASSIGN  24124>>ASSIGN
     24163>>ASSIGN  24164>>IF      24165>>ASSIGN  24177>>IF      24181>>ASSIGN  24185>>CALL    24187>>IF
     24188>>ASSIGN  24190>>ASSIGN  24191>>ASSIGN  24196>>IF      24196>>IF      24198>>CALL    24214>>ASSIGN
     24214>>ASSIGN  24215>>IF      24215>>IF      24215>>IF      24215>>IF      24218>>ASSIGN  24220>>IF
     24220>>IF      24221>>ASSIGN  24247>>IF      24247>>IF      24247>>IF      24249>>ASSIGN  24253>>CALL
     24266>>ASSIGN  24270<<ASSIGN  24275>>ASSIGN  24276>>ASSIGN  24277>>IF      24278>>ASSIGN  24279>>ASSIGN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:323  
     24288<<ASSIGN  24295>>ASSIGN  24296>>ASSIGN  24297>>IF      24298>>ASSIGN  24302>>ASSIGN  24304<<ASSIGN
     24314>>IF      24316>>IF      24317>>ASSIGN  24318>>ASSIGN  24326>>ASSIGN  24337<<ASSIGN  24338>>DOWHILE
     24339>>IF      24340<<ASSIGN  24340>>ASSIGN  24353<<ASSIGN  24354>>DOWHILE 24355>>ASSIGN  24356<<ASSIGN
     24356>>ASSIGN  24374>>ASSIGN  24375>>ASSIGN  24376>>ASSIGN  24377>>ASSIGN  24380>>ASSIGN  24381>>ASSIGN
     24382>>ASSIGN  24383>>ASSIGN  24384>>ASSIGN  24387>>IF      24399>>DOWHILE 24404>>ASSIGN  24406>>ASSIGN
     24475>>IF      24476>>CALL    24477>>IF      24477>>IF      24478>>IF      24479>>ASSIGN  24479>>ASSIGN
     24481>>ASSIGN  24481>>ASSIGN  24482>>ASSIGN  24482>>ASSIGN  24483>>ASSIGN  24484>>ASSIGN  24487>>IF
     24488>>ASSIGN  24489>>IF      24493>>IF      24494>>ASSIGN  24495>>IF      24501>>IF      24504>>CALL
     24505>>ASSIGN  24507>>ASSIGN  24511>>IF      24514>>IF      24516>>CALL    24519>>ASSIGN  24525>>IF
     24526>>ASSIGN  24527>>CALL    24539>>ASSIGN  24552>>ASSIGN  24553>>ASSIGN  24566>>DOWHILE 24567>>ASSIGN
     24568>>ASSIGN  24569>>IF      24570>>ASSIGN  24588>>IF      24593>>ASSIGN  24608>>ASSIGN  24613>>ASSIGN
     24622>>ASSIGN  24625>>ASSIGN  24626>>ASSIGN  24654>>ASSIGN  24655>>ASSIGN  24670>>ASSIGN  24672>>ASSIGN
     24674>>CALL    24677>>IF      24691>>ASSIGN  24935>>IF      24936>>ASSIGN  24937>>ASSIGN  24969>>IF
     24977>>ASSIGN  24978>>ASSIGN  24979>>ASSIGN  24994>>IF      25001>>ASSIGN  25002>>ASSIGN  25066>>ASSIGN
     25066>>ASSIGN  25067>>IF      25068>>ASSIGN  25070>>ASSIGN  25073>>ASSIGN  25074>>ASSIGN  25074>>ASSIGN
DEVCTX
     17495**DCL     23961--ASSIGN  23997--ASSIGN  24006--ASSIGN  24034--ASSIGN  24046--ASSIGN
DFR IN PROCEDURE ENTER_VDH
     25084**LABEL   25075--GOTO
DFRD
     18539**DCL     23446<>CALL    23447>>IF      23492<>CALL    23493>>IF      23518<>CALL    23519>>IF
     24185<>CALL    24186>>IF      24504<>CALL    24506>>IF      24527<>CALL    24632<>CALL
DFRD IN PROCEDURE ENTER_VDH
     25014**DCL     25012--PROC    25019<<ASSIGN  25081<<ASSIGN  25084<<ASSIGN
DISABLE_LEVEL
     22197**DCL     23702<<ASSIGN  23703<>CALL    23726>>IF      23789<<ASSIGN  23790<>CALL    23805>>IF
     24409<<ASSIGN  24410<>CALL    24414>>IF      24434<<ASSIGN  24435<>CALL    24439>>IF      24450<<ASSIGN
     24451<>CALL    24463>>IF      24542<<ASSIGN  24543<>CALL    24547>>IF      24596<<ASSIGN  24597<>CALL
     24603>>IF      24617>>IF
DSC_DEV
     24472**PROC    23271--CALL    23322--CALL    23441--CALL    23451--CALL    23455--CALL    23603--CALL
     23637--CALL    23659--CALL    23675--CALL    24001--CALL
DSC_DEV_CONT IN PROCEDURE DSC_DEV
     24523**ENTRY   24010--CALL
DSC_DEV_FINAL
     24534**PROC    24250--CALL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:324  
DSC_LINE
     24019**PROC    23954--CALL    24016--CALL
END_GETOTP
     23186**LABEL   23177--GOTO
END_STATUS
     23357**LABEL   23230--CALLALT 23242--GOTO    23257--GOTO    23279--GOTO    23282--GOTO    23327--GOTO
     23350--GOTO
ENTER_VDH
     25012**PROC    23446--CALL    23492--CALL    23518--CALL    24185--CALL    24504--CALL    24527--CALL
     24632--CALL
ERRDEV IN PROCEDURE FND_CTR
     24060**LABEL   24069--GOTO    24076--GOTO    24083--GOTO
ERRLOG
     24703**PROC    23249--CALL    23844--CALL    23851--CALL    23953--CALL    24060--CALL    24217--CALL
ERROR IN PROCEDURE ERRLOG
     24704**DCL     24703--PROC    24899>>ASSIGN  24900>>DOCASE
EXIT_VDH
     25091**PROC    23452--CALL    23497--CALL    23551--CALL    23947--CALL    24253--CALL    24516--CALL
     24636--CALL    24686--CALL    24696--CALL
FAKE
     17399**DCL     17401--IMP-SIZ 18095--IMP-SIZ
FND_CTR
     24056**PROC    23649--CALL    23670--CALL    23761--CALL    23824--CALL    23863--CALL    23902--CALL
     23929--CALL    24096--CALL
FND_CTX
     24088**PROC    23230--CALL    23467--CALL
FND_DEV IN PROCEDURE FND_CTR
     24073**ENTRY   23671--CALL    23825--CALL    23903--CALL    23931--CALL    24098--CALL
FPT@WRSYSLOG IN PROCEDURE ERRLOG
     24813**DCL     24897>>ASSIGN
FPT@WRSYSLOG.V IN PROCEDURE ERRLOG
     24817**DCL     24815--DCLINIT
FPT@WRSYSLOG.V.TERMID.TERM IN PROCEDURE ERRLOG
     24882**DCL     24891--REDEF
FPT_WRSYSLOG IN PROCEDURE ERRLOG
     24718**DCL     24897<<ASSIGN  25006<>CALL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:325  
FPT_WRSYSLOG.BUF_ IN PROCEDURE ERRLOG
     24720**DCL     24915<<ASSIGN  24931<<ASSIGN  24932<<ASSIGN  24936<<ASSIGN  24937<<ASSIGN  24956<<ASSIGN
FPT_WRSYSLOG.V.ERRCODE.ERR# IN PROCEDURE ERRLOG
     24766**DCL     24899<<ASSIGN
FPT_WRSYSLOG.V.ERRCODE.SEV IN PROCEDURE ERRLOG
     24767**DCL     24910<<ASSIGN  24925<<ASSIGN  24951<<ASSIGN  24967<<ASSIGN  24992<<ASSIGN
FPT_WRSYSLOG.V.TERMID IN PROCEDURE ERRLOG
     24785**DCL     24898<<ASSIGN
FPT_WRSYSLOG.V.TERMID.TERM IN PROCEDURE ERRLOG
     24787**DCL     24796--REDEF
FPT_WRSYSLOG.V.VALUES IN PROCEDURE ERRLOG
     24798**DCL     24911<<ASSIGN  24912<<ASSIGN  24913<<ASSIGN  24914<<ASSIGN  24926<<ASSIGN  24927<<ASSIGN
     24928<<ASSIGN  24929<<ASSIGN  24952<<ASSIGN  24953<<ASSIGN  24954<<ASSIGN  24955<<ASSIGN  24968<<ASSIGN
     24971<<ASSIGN  24972<<ASSIGN  24973<<ASSIGN  24977<<ASSIGN  24978<<ASSIGN  24979<<ASSIGN  24993<<ASSIGN
     24996<<ASSIGN  24997<<ASSIGN  25001<<ASSIGN  25002<<ASSIGN  25004<<ASSIGN
GOTOTP
     23146**LABEL   23157--GOTO
GOT_STATUS
     23240**LABEL   23234--GOTO
I
     18525**DCL     23387<<ASSIGN  23388>>DOUNTIL 23389>>IF      23390>>ASSIGN  23394>>IF      23395>>ASSIGN
     23398>>ASSIGN  23401<<ASSIGN  23401>>ASSIGN  23402>>IF      23403<<ASSIGN  23433<<ASSIGN  23434>>DOCASE
     23648<<ASSIGN  23668<<ASSIGN  23759<<ASSIGN  23799<<DOINDEX 23800>>ASSIGN  23801>>ASSIGN  23822<<ASSIGN
     23847<<ASSIGN  23858>>IF      23928<<ASSIGN  23985<<ASSIGN  23986<>CALL    24058>>IF      24065>>IF
     24093<<ASSIGN  24927>>ASSIGN  24953>>ASSIGN
I IN PROCEDURE RELOTPBFR
     24173**DCL     24243<<ASSIGN  24244>>ASSIGN  24245<>CALL
IGNOR
     23479**LABEL   23431--GOTO
J
     18526**DCL     23129<<ASSIGN  23140<<ASSIGN  23140>>ASSIGN  23141>>IF      23414<<ASSIGN  23416<<ASSIGN
     23427<<ASSIGN  23427>>ASSIGN  23460<<ASSIGN  23469<<ASSIGN  23471<<ASSIGN  23504<<ASSIGN  23524>>ASSIGN
     23525>>ASSIGN  23541>>ASSIGN  23542>>ASSIGN  23669<<ASSIGN  23760<<ASSIGN  23823<<ASSIGN  23854<<ASSIGN
     23860>>IF      24075>>IF      24079>>IF      24094<<ASSIGN  24118>>ASSIGN  24928>>ASSIGN  24954>>ASSIGN
KH$CHN.AUTLGN
     20990**DCL     23826>>IF
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:326  
KH$CHN.CTX$
     21049**DCL     23755<<ASSIGN  23772<<ASSIGN
KH$CHN.LINSPD
     21033**DCL     24654>>ASSIGN
KH$CHN.TERMID
     21073**DCL     24023--ASSIGN  24459--ASSIGN  24539--ASSIGN  24613--ASSIGN  24655>>ASSIGN
KH$CHN.TERMID.TERM
     21075**DCL     21084--REDEF
KH$CHN.TERMID.TTYP
     21075**DCL     23754<<ASSIGN  23771<<ASSIGN
KH$CTLTBL.PARM.PTR$
     21258**DCL     24629>>ASSIGN
KHA$ERRLOG
     23092**DCL-ENT 25006--CALL
KHI$DISABLE
     22191**DCL-ENT 23703--CALL    23790--CALL    24410--CALL    24435--CALL    24451--CALL    24543--CALL
     24597--CALL
KHI$ENABLE
     22190**DCL-ENT 23728--CALL    23807--CALL    24416--CALL    24441--CALL    24465--CALL    24549--CALL
     24605--CALL    24619--CALL
KH_CTLTBL$
     23074**DCL     21132--IMP-PTR 24629>>ASSIGN
KH_INHLVL
     22200**DCL     23702>>ASSIGN  23726>>IF      23732>>ASSIGN  23789>>ASSIGN  23805>>IF      24409>>ASSIGN
     24414>>IF      24434>>ASSIGN  24439>>IF      24450>>ASSIGN  24463>>IF      24542>>ASSIGN  24547>>IF
     24596>>ASSIGN  24603>>IF      24617>>IF
KH_PROFILE_
     22201**DCL     24644>>IF      24646>>ASSIGN  24648>>ASSIGN
KL_CONTROLLER.COLUMNS
     21472**DCL     23750>>ASSIGN
KL_CONTROLLER.CONT#
     21464**DCL     23742>>IF      23748>>ASSIGN
KL_CONTROLLER.ROWS
     21468**DCL     23749>>ASSIGN
KL_CONTROLLER.TYPE
     21478**DCL     23751>>ASSIGN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:327  
KL_LINEDEV.CONTROLLER#
     21611**DCL     23759>>ASSIGN
KL_LINEDEV.DEVICE#
     21614**DCL     23760>>ASSIGN  23764>>IF
KL_LINEDEV.TYPE
     21619**DCL     23777>>IF
KV$MRD.ATRRQRDSPPST
     20837**DCL     24683<<ASSIGN
KV$MRD.CTNFRM
     20838**DCL     24678<<ASSIGN
KV$MRD.FSTERS
     20836**DCL     24682<<ASSIGN
KV$MRD.MINSP_FORPST
     20827**DCL     24679<<ASSIGN
KV$OTPMRK
     21107**DCL     24201--ASSIGN  24205>>ASSIGN  24208--ASSIGN
KV$OTPMRK.ID
     21112**DCL     21112--REDEF   21113--REDEF
KV$PTR.INPCNDPND
     20948**DCL     20957--REDEF   20961--REDEF
KV$PTR.LINLST$
     20944**DCL     20945--REDEF
KV$PTR.MRD$
     20943**DCL     24678>>ASSIGN  24679>>ASSIGN  24682>>ASSIGN  24683>>ASSIGN
KV$PTR.VDI$
     20942**DCL     24234>>IF      24235>>ASSIGN  24657>>ASSIGN  24658>>ASSIGN  24659>>ASSIGN  24660>>ASSIGN
     24661>>ASSIGN  24662>>ASSIGN  24663>>ASSIGN  24664>>ASSIGN  24665>>ASSIGN  24666>>ASSIGN  24667>>ASSIGN
     24668>>ASSIGN  24676>>ASSIGN  24684>>ASSIGN  25121>>ASSIGN
KV$PTR$
     20936**DCL     20942--IMP-PTR 24234>>IF      24235>>ASSIGN  24657>>ASSIGN  24658>>ASSIGN  24659>>ASSIGN
     24660>>ASSIGN  24661>>ASSIGN  24662>>ASSIGN  24663>>ASSIGN  24664>>ASSIGN  24665>>ASSIGN  24666>>ASSIGN
     24667>>ASSIGN  24668>>ASSIGN  24676>>ASSIGN  24678>>ASSIGN  24679>>ASSIGN  24682>>ASSIGN  24683>>ASSIGN
     24684>>ASSIGN  25031>>ASSIGN  25069>>ASSIGN  25070<<ASSIGN  25108<<ASSIGN  25121>>ASSIGN  25123<<ASSIGN
KV$SSN.REDRSPCNT
     21688**DCL     21689--REDEF
KV$STT
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:328  
     21765**DCL     23705--ASSIGN  23707<<ASSIGN
KV$STT.REQSTATS.DSPENT
     22017**DCL     23711<<ASSIGN
KV$STT.REQSTATS.DSPMSK
     22011**DCL     22017--REDEF
KV$STT.REQSTATS.FNC
     21929**DCL     23708<<ASSIGN
KV$STT.REQSTATS.SLCENT
     22059**DCL     23709<<ASSIGN  23710<<ASSIGN
KV$STT.REQSTATS.SLCMSK
     22052**DCL     22059--REDEF
KV$STT.USRENTCNT
     22121**DCL     25066<<ASSIGN  25066>>ASSIGN
KV$STT.USRENTDFRCNT
     22122**DCL     25074<<ASSIGN  25074>>ASSIGN
KV$USRPRM
     22153**DCL     23723--ASSIGN  23731<<ASSIGN
KV$USRPRM.INHLVL
     22153**DCL     23732<<ASSIGN
KV$USRPRM.STT$
     22180**DCL     23733<<ASSIGN  25066>>ASSIGN  25066>>ASSIGN  25074>>ASSIGN  25074>>ASSIGN
KV$USR_EVT
     18568**DCL     25112<<ASSIGN  25114<>CALL
KV$USR_EVT.ID
     18574**DCL     25113<<ASSIGN
KV$VDH_CNC
     18603**DCL     24642<<ASSIGN  24669<>CALL
KV$VDH_CNC.LCLENDPNTID
     18653**DCL     24655<<ASSIGN
KV$VDH_CNC.LCLENDPNTID.TERM
     18655**DCL     18664--REDEF
KV$VDH_CNC.LCLENDPNTID.TTYP
     18655**DCL     24656<<ASSIGN
KV$VDH_CNC.LINSPD
     18636**DCL     24654<<ASSIGN
KV$VDH_CNC.PRF_.ADR$
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:329  
     18632**DCL     24647<<ASSIGN  24651<<ASSIGN
KV$VDH_CNC.PRF_.BYTSIZ
     18632**DCL     24648<<ASSIGN  24652<<ASSIGN
KV$VDH_DAT
     18701**DCL     23539<<ASSIGN  23550<>CALL    23975<<ASSIGN  23981<>CALL
KV$VDH_DAT.CTN
     18708**DCL     23545<<ASSIGN  23979<<ASSIGN
KV$VDH_DAT.DAT__.ADR$
     18737**DCL     23540<<ASSIGN  23976<<ASSIGN
KV$VDH_DAT.DAT__.BYTX
     18737**DCL     23541<<ASSIGN  23977<<ASSIGN
KV$VDH_DAT.DAT__.DATBYTSIZ
     18737**DCL     23542<<ASSIGN  23546<<ASSIGN  23546>>ASSIGN  23978<<ASSIGN
KV$VDH_DSC
     18775**DCL     24508<<ASSIGN  24513<>CALL
KV$VDH_DSC.ALLSSN
     18781**DCL     24510<<ASSIGN
KV$VDH_DSC.NO_IO
     18781**DCL     24512<<ASSIGN
KV$VDH_DSC.RSN
     18781**DCL     24509<<ASSIGN
KV$VDH_EVT
     18811**DCL     24554<<ASSIGN  24556<>CALL    24693<<ASSIGN  24695<>CALL
KV$VDH_EVT.ID
     18817**DCL     24555<<ASSIGN  24694<<ASSIGN
KV$VDH_INT
     18846**DCL     24624<<ASSIGN  24633<>CALL
KV$VDH_INT.CHN$
     18852**DCL     24625<<ASSIGN
KV$VDH_INT.RCVFLWCTRMAXCRD
     18853**DCL     24628<<ASSIGN
KV$VDH_INT.TRCBFRBYTSIZ
     18854**DCL     24629<<ASSIGN
KV$VDH_INT.USRCTX$
     18852**DCL     24626<<ASSIGN
KV$VDH_INT.USRPRM$
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:330  
     18853**DCL     24627<<ASSIGN
KV$VDH_INT.VDI$
     18853**DCL     24640>>ASSIGN
KV$VDH_OTPMRK
     18883**DCL     24204<<ASSIGN  24207<>CALL
KV$VDH_OTPMRK.CMPCOD
     18916**DCL     24206<<ASSIGN
KV$VDH_OTPMRK.DAT
     18910**DCL     24205<<ASSIGN
KV$VDH_OTPMRK.DAT.ID
     18913**DCL     18913--REDEF   18914--REDEF
KV$VDI.ASNINPPTR$
     20872**DCL     25070>>ASSIGN
KV$VDI.BSY
     20906**DCL     25067>>IF      25068<<ASSIGN  25121<<ASSIGN
KV$VDI.DFR.USR
     20903**DCL     25073<<ASSIGN
KV$VDI.INPUNT
     20912**DCL     24684<<ASSIGN
KV$VDI.RQSOTP
     20907**DCL     24234>>IF      24235<<ASSIGN
KV$VDI.USEOTPBFRTRN
     20912**DCL     24676<<ASSIGN
KV$VDI.USREVTENB
     20914**DCL     24659<<ASSIGN  24660<<ASSIGN  24661<<ASSIGN  24662<<ASSIGN  24663<<ASSIGN  24664<<ASSIGN
     24665<<ASSIGN  24666<<ASSIGN  24667<<ASSIGN  24668<<ASSIGN
KV$VDI.USRPRM$
     20872**DCL     25066>>ASSIGN  25066>>ASSIGN  25074>>ASSIGN  25074>>ASSIGN
KV$VDI.VDHEVTENB
     20919**DCL     24657<<ASSIGN  24658<<ASSIGN
KV@USRENT.SVDPTR$
     18936**DCL     25031<<ASSIGN  25069<<ASSIGN  25108>>ASSIGN  25123>>ASSIGN
KVB$GET2NSYS
     23088**DCL-ENT 23286--CALL
KVB$GETSYS
     23086**DCL-ENT 23521--CALL    23706--CALL    23715--CALL    23724--CALL    23793--CALL    24112--CALL
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:331  
     24138--CALL
KVB$RLS2NSYS
     23089**DCL-ENT 24245--CALL
KVB$RLSSYS
     23087**DCL-ENT 23986--CALL    23988--CALL    24412--CALL    24437--CALL    24453--CALL    24577--CALL
     24579--CALL
KVV$INT
     23085**DCL-ENT 24633--CALL
KVV$VDI
     23090**DCL-ENT 23550--CALL    23981--CALL    24207--CALL    24236--CALL    24513--CALL    24556--CALL
     24669--CALL    24695--CALL
KV_USR_EVT
     22687**DCL     25112>>ASSIGN
KV_VDH_CNC
     22722**DCL     24642>>ASSIGN
KV_VDH_CNC.LCLENDPNTID.TERM
     22774**DCL     22783--REDEF
KV_VDH_DAT
     22820**DCL     23539>>ASSIGN  23975>>ASSIGN
KV_VDH_DSC
     22894**DCL     24508>>ASSIGN
KV_VDH_EVT
     22930**DCL     24554>>ASSIGN  24693>>ASSIGN
KV_VDH_EVT_RQSOTP
     23064**DCL     24236<>CALL
KV_VDH_INT
     22965**DCL     24624>>ASSIGN
KV_VDH_OTPMRK
     23002**DCL     24204>>ASSIGN
KV_VDH_OTPMRK.DAT.ID
     23032**DCL     23032--REDEF   23033--REDEF
KZ$3270CTR
     20497**DCL     24137--ASSIGN  24139--ASSIGN  24141<<ASSIGN  24437--CALL    24444--ASSIGN
KZ$3270CTR.ADR
     20513**DCL     23144>>ASSIGN  23155>>ASSIGN  23167>>ASSIGN  23298>>ASSIGN  23369>>ASSIGN  23391>>ASSIGN
     23742>>IF      23748<<ASSIGN  24065>>IF      24977>>ASSIGN  25001>>ASSIGN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:332  
KZ$3270CTR.CHN$
     20505**DCL     23753<<ASSIGN
KZ$3270CTR.COLS
     20509**DCL     23750<<ASSIGN  24120>>ASSIGN
KZ$3270CTR.DEVHD$
     20500**DCL     23121>>ASSIGN  23171>>ASSIGN  23598>>ASSIGN  23629>>ASSIGN  23651>>ASSIGN  23762>>ASSIGN
     23872>>ASSIGN  24077>>ASSIGN  24123>>ASSIGN  24124<<ASSIGN  24337>>ASSIGN  24353>>ASSIGN  24397>>ASSIGN
     24404<<ASSIGN
KZ$3270CTR.LIN$
     20503**DCL     23752<<ASSIGN  23963>>ASSIGN  23999>>ASSIGN  24008>>ASSIGN  24036>>ASSIGN  24050>>ASSIGN
KZ$3270CTR.LNK$
     20498**DCL     23179>>ASSIGN  23628>>ASSIGN  23744>>ASSIGN  23802>>ASSIGN  24067>>ASSIGN  24146>>ASSIGN
     24149<<ASSIGN  24427>>ASSIGN  24430>>ASSIGN  24432<<ASSIGN  24432>>ASSIGN
KZ$3270CTR.PRINTER_CNC_DONE
     20521**DCL     24385<<ASSIGN  24393<<ASSIGN
KZ$3270CTR.ROWS
     20511**DCL     23749<<ASSIGN  24119>>ASSIGN
KZ$3270CTR.TIMED_OUT_ONCE
     20518**DCL     23564<<ASSIGN  23579>>IF      23581<<ASSIGN  24392<<ASSIGN
KZ$3270CTR.TYP
     20507**DCL     23751<<ASSIGN  23773>>IF      24121>>IF
KZ$3270DEV
     20537**DCL     23496<>CALL    24111--ASSIGN  24113--ASSIGN  24116<<ASSIGN  24198<>CALL    24412--CALL
     24419--ASSIGN  24476<>CALL    24674<>CALL
KZ$3270DEV.ACTIVE
     20585**DCL     23154>>IF      23173>>IF      23263>>IF      23269<<ASSIGN  23319>>IF      23320<<ASSIGN
     23326>>IF      23349>>IF      23423>>IF      23436>>IF      23439<<ASSIGN  23444>>IF      23476>>IF
     23511>>IF      23601>>IF      23602<<ASSIGN  23635>>IF      23636<<ASSIGN  23657>>IF      23658<<ASSIGN
     23673>>IF      23674<<ASSIGN  23826>>IF      24318<<ASSIGN  24387>>IF      24475>>IF      24477>>IF
     24494<<ASSIGN  24511>>IF      24514>>IF      24670<<ASSIGN  24691<<ASSIGN
KZ$3270DEV.ADR
     20638**DCL     23145>>ASSIGN  23156>>ASSIGN  23299>>ASSIGN  23370>>ASSIGN  23764>>IF      24079>>IF
     24118<<ASSIGN  24978>>ASSIGN  25002>>ASSIGN
KZ$3270DEV.AID
     20575**DCL     23421<<ASSIGN  23422>>IF      23425>>IF      23425>>IF      23425>>IF      23458<<ASSIGN
     23474<<ASSIGN  23484>>IF      23490>>IF      23516>>ASSIGN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:333  
KZ$3270DEV.AWAIT_ENABLE
     20696**DCL     23826>>IF      24374<<ASSIGN  24608<<ASSIGN  24622<<ASSIGN
KZ$3270DEV.CHN$
     20544**DCL     23770<<ASSIGN  23826>>IF      24539>>ASSIGN  24593>>ASSIGN  24613>>ASSIGN  24625>>ASSIGN
     24654>>ASSIGN  24655>>ASSIGN
KZ$3270DEV.CLRD
     20698**DCL     24326<<ASSIGN  24339>>IF      24355<<ASSIGN
KZ$3270DEV.COLS
     20675**DCL     24120<<ASSIGN
KZ$3270DEV.CTR$
     20540**DCL     23962>>ASSIGN  23998>>ASSIGN  24007>>ASSIGN  24035>>ASSIGN  24049>>ASSIGN  24117<<ASSIGN
     24977>>ASSIGN  25001>>ASSIGN
KZ$3270DEV.DFR.CLR
     20668**DCL     23494<<ASSIGN
KZ$3270DEV.DFR.DSCI
     20662**DCL     24519<<ASSIGN  24525>>IF      24526<<ASSIGN
KZ$3270DEV.DFRHD$
     20551**DCL     23530<<ASSIGN  23966>>DOWHILE 23967>>ASSIGN  23968<<ASSIGN  23969>>IF      24190<<ASSIGN
     24215>>IF      24481<<ASSIGN  24566>>DOWHILE 24567>>ASSIGN  24568<<ASSIGN  24569>>IF
KZ$3270DEV.DFRTL$
     20555**DCL     23527>>IF      23528>>ASSIGN  23531<<ASSIGN  23970<<ASSIGN  24187>>IF      24188>>ASSIGN
     24191<<ASSIGN  24478>>IF      24479>>ASSIGN  24482<<ASSIGN  24570<<ASSIGN
KZ$3270DEV.DONE
     20601**DCL     24196>>IF
KZ$3270DEV.DSC
     20640**DCL     23209>>IF      23436>>IF      23476>>IF      23477>>IF      23511>>IF      24380<<ASSIGN
     24495>>IF
KZ$3270DEV.DSC.DEV_FINAL
     20653**DCL     24249<<ASSIGN  24553<<ASSIGN
KZ$3270DEV.DSC.INT
     20647**DCL     24505<<ASSIGN
KZ$3270DEV.DSC.TOLD_VDH
     20649**DCL     24507<<ASSIGN
KZ$3270DEV.DSC.VDH_FINAL
     20651**DCL     24247>>IF      24552<<ASSIGN
KZ$3270DEV.DSC_LATER
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:334  
     20692**DCL     23448<<ASSIGN  24382<<ASSIGN
KZ$3270DEV.EWALT
     20589**DCL     23774<<ASSIGN  23776<<ASSIGN  24122<<ASSIGN  24164>>IF
KZ$3270DEV.HLT
     20610**DCL     23127>>IF      23884>>IF      23904>>IF      24377<<ASSIGN  24487>>IF      24488<<ASSIGN
KZ$3270DEV.HLT.INP
     20625**DCL     23214<<ASSIGN  23483>>IF      23487<<ASSIGN
KZ$3270DEV.HLT.PAG
     20621**DCL     23211<<ASSIGN  23483>>IF      23484>>IF      23486<<ASSIGN
KZ$3270DEV.HLT.WACK
     20616**DCL     23223<<ASSIGN  23255<<ASSIGN  23264>>IF      23265<<ASSIGN  23284<<ASSIGN
KZ$3270DEV.IGN_INP
     20607**DCL     23419<<ASSIGN  23472<<ASSIGN  23479<<ASSIGN  23485<<ASSIGN  23512<<ASSIGN  23513>>IF
KZ$3270DEV.KBDLCK
     20688**DCL     23420<<ASSIGN  23473<<ASSIGN  23499<<ASSIGN  24381<<ASSIGN
KZ$3270DEV.LNK$
     20538**DCL     23123>>ASSIGN  23161>>ASSIGN  23175>>ASSIGN  23608>>ASSIGN  23634>>ASSIGN  23656>>ASSIGN
     23766>>ASSIGN  23870>>ASSIGN  24081>>ASSIGN  24123<<ASSIGN  24340>>ASSIGN  24356>>ASSIGN  24401>>ASSIGN
     24404>>ASSIGN  24406<<ASSIGN  24406>>ASSIGN
KZ$3270DEV.MUST_SBA
     20694**DCL     23549<<ASSIGN  23980<<ASSIGN  24383<<ASSIGN
KZ$3270DEV.OTPBSY
     20597**DCL     23130<<ASSIGN  23892<<ASSIGN  24181<<ASSIGN  24215>>IF      24247>>IF      24279<<ASSIGN
     24302<<ASSIGN  24376<<ASSIGN
KZ$3270DEV.OTPBYTES
     20634**DCL     24214<<ASSIGN  24214>>ASSIGN  24215>>IF      24218<<ASSIGN  24220>>IF      24979>>ASSIGN
KZ$3270DEV.OTPHD$
     20546**DCL     23127>>IF      23132>>ASSIGN  23134>>ASSIGN  23135>>ASSIGN  23136<<ASSIGN  23136>>ASSIGN
     23138>>IF      23141>>IF      23278>>IF      23281>>IF      23312>>ASSIGN  23313<<ASSIGN  23335>>IF
     23336>>IF      23337>>ASSIGN  23338>>ASSIGN  23340<<ASSIGN  23340>>ASSIGN  23341>>IF      23345>>ASSIGN
     23884>>IF      23886>>ASSIGN  23888>>ASSIGN  23889>>ASSIGN  23890<<ASSIGN  23890>>ASSIGN  23893>>IF
     23904>>IF      23909>>ASSIGN  23910>>ASSIGN  23911<<ASSIGN  23911>>ASSIGN  23912>>IF      24196>>IF
     24215>>IF      24247>>IF      24275>>ASSIGN  24276<<ASSIGN  24295>>ASSIGN  24296<<ASSIGN  24477>>IF
     24479>>ASSIGN  24481>>ASSIGN  24483<<ASSIGN  24489>>IF      24935>>IF      24936>>ASSIGN  24937>>ASSIGN
KZ$3270DEV.OTPTL$
     20549**DCL     23139<<ASSIGN  23314>>IF      23315<<ASSIGN  23342<<ASSIGN  23894<<ASSIGN  23913<<ASSIGN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:335  
     24277>>IF      24278<<ASSIGN  24297>>IF      24298<<ASSIGN  24482>>ASSIGN  24484<<ASSIGN
KZ$3270DEV.PRINTER
     20595**DCL     23141>>IF      23243>>IF      23250>>IF      23778<<ASSIGN  23780<<ASSIGN  23826>>IF
     24677>>IF
KZ$3270DEV.PRINTER_DOWNS
     20701**DCL     23252<<ASSIGN  23252>>ASSIGN  23253>>IF      23262<<ASSIGN  24384<<ASSIGN
KZ$3270DEV.PRO
     20559**DCL     24163<<ASSIGN
KZ$3270DEV.PRO.EWALT
     20564**DCL     24165<<ASSIGN
KZ$3270DEV.REACT
     20690**DCL     23270<<ASSIGN  23440<<ASSIGN  24316>>IF      24317<<ASSIGN  24493>>IF
KZ$3270DEV.ROWS
     20673**DCL     24119<<ASSIGN
KZ$3270DEV.STATUS
     20630**DCL     23240<<ASSIGN
KZ$3270DEV.THROTL
     20592**DCL     24220>>IF      24221<<ASSIGN  24375<<ASSIGN
KZ$3270DEV.VDI$
     20542**DCL     23446<>CALL    23452<>CALL    23492<>CALL    23497<>CALL    23518<>CALL    23551<>CALL
     23947<>CALL    24047<<ASSIGN  24185<>CALL    24253<>CALL    24314>>IF      24501>>IF      24504<>CALL
     24516<>CALL    24527<>CALL    24588>>IF      24672<<ASSIGN  25066>>ASSIGN  25066>>ASSIGN  25067>>IF
     25068>>ASSIGN  25070>>ASSIGN  25073>>ASSIGN  25074>>ASSIGN  25074>>ASSIGN
KZ$3270STT
     22248**DCL     23714--ASSIGN  23716<<ASSIGN
KZ$3270STT.KHSTT.CTXBYTUTL
     22592**DCL     24113<<ASSIGN  24113>>ASSIGN  24139<<ASSIGN  24139>>ASSIGN  24419<<ASSIGN  24419>>ASSIGN
     24444<<ASSIGN  24444>>ASSIGN
KZ$3270STT.KHSTT.INPBFRBYTUTL
     22591**DCL     23982<<ASSIGN  23982>>ASSIGN
KZ$3270STT.KHSTT.OTPBFRBYTUTL
     22591**DCL     23288<<ASSIGN  23288>>ASSIGN  24244<<ASSIGN  24244>>ASSIGN
KZ$3270STT.OTPBFRSIZ
     22637**DCL     23287<<ASSIGN  23287>>ASSIGN
KZ$3270STT.REQSTATS.DSPENT
     22525**DCL     23718<<ASSIGN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:336  
KZ$3270STT.REQSTATS.DSPMSK
     22519**DCL     22525--REDEF
KZ$3270STT.REQSTATS.FNC
     22437**DCL     23717<<ASSIGN
KZ$3270STT.REQSTATS.SLCENT
     22567**DCL     23719<<ASSIGN  23720<<ASSIGN
KZ$3270STT.REQSTATS.SLCMSK
     22560**DCL     22567--REDEF
KZ$CLMEVENT
     18952**DCL     24021<<ASSIGN  24025<>CALL    24457<<ASSIGN  24461<>CALL    24537<<ASSIGN  24545<>CALL
     24591<<ASSIGN  24599<>CALL    24611<<ASSIGN  24615<>CALL
KZ$CLMEVENT.CHN$
     18965**DCL     24593<<ASSIGN
KZ$CLMEVENT.EVENT
     18953**DCL     24022<<ASSIGN  24458<<ASSIGN  24538<<ASSIGN  24592<<ASSIGN  24612<<ASSIGN
KZ$CLMEVENT.LINCTX$
     18959**DCL     24024<<ASSIGN  24460<<ASSIGN  24540<<ASSIGN  24594<<ASSIGN  24614<<ASSIGN
KZ$CLMEVENT.TERMID$
     18962**DCL     24023<<ASSIGN  24459<<ASSIGN  24539<<ASSIGN  24613<<ASSIGN
KZ$EVENT
     17416**DCL     24956--ASSIGN
KZ$EVENT.CHN$
     17429**DCL     23753>>ASSIGN  23754>>ASSIGN  23755>>ASSIGN  23770>>ASSIGN  23771>>ASSIGN  23772>>ASSIGN
KZ$EVENT.CHNCTX$
     17420**DCL     23742>>IF      23748>>ASSIGN  23749>>ASSIGN  23750>>ASSIGN  23751>>ASSIGN  23759>>ASSIGN
     23760>>ASSIGN  23764>>IF      23777>>IF
KZ$EVENT.EVENT
     17417**DCL     23098>>DOCASE  23126>>IF      23154>>IF      23164>>IF      23182>>IF
KZ$EVENT.LINCTX$
     17423**DCL     23096>>ASSIGN
KZ$EVENT.TERMID$
     17426**DCL     23618>>DOCASE  23648>>ASSIGN  23668>>ASSIGN  23669>>ASSIGN  23736>>DOCASE  23815>>DOCASE
     23822>>ASSIGN  23823>>ASSIGN
KZ$INPBFR
     20716**DCL     23520--ASSIGN  23522<<ASSIGN  23988--CALL    24579--CALL
KZ$INPBFR.BFR_SIZ
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:337  
     20731**DCL     23523<<ASSIGN  23982>>ASSIGN  23985>>ASSIGN  24577<>CALL
KZ$INPBFR.BYTX
     20733**DCL     23525<<ASSIGN  23977>>ASSIGN
KZ$INPBFR.DATA$
     20735**DCL     23526<<ASSIGN  23976>>ASSIGN  23984>>ASSIGN  24576>>ASSIGN
KZ$INPBFR.DATA_SIZ
     20729**DCL     23524<<ASSIGN  23534<<ASSIGN  23534>>ASSIGN  23978>>ASSIGN
KZ$INPBFR.FLAGS.CTN#
     20726**DCL     23536<<ASSIGN  23979>>ASSIGN
KZ$INPBFR.LNK$
     20717**DCL     23528<<ASSIGN
KZ$LINCTX.ACTCTR
     20425**DCL     23169<<ASSIGN  23169>>ASSIGN  23586<<ASSIGN  23586>>ASSIGN
KZ$LINCTX.CHAN
     20157**DCL     24911>>ASSIGN  24926>>ASSIGN  24952>>ASSIGN  24968>>ASSIGN  24993>>ASSIGN
KZ$LINCTX.CHN$
     20069**DCL     24023>>ASSIGN  24459>>ASSIGN
KZ$LINCTX.CTRHD$
     20067**DCL     23112>>ASSIGN  23623>>ASSIGN  23740>>ASSIGN  23798>>ASSIGN  24063>>ASSIGN  24143>>ASSIGN
     24151<<ASSIGN  24361>>IF      24423>>ASSIGN  24430<<ASSIGN
KZ$LINCTX.CTRLST$
     20410**DCL     23390>>ASSIGN  23563>>IF      23564>>ASSIGN  23575>>ASSIGN  23687>>ASSIGN  23794<<ASSIGN
     23801>>ASSIGN  24448>>IF      24453<>CALL    24455<<ASSIGN
KZ$LINCTX.CURCTR$
     20362**DCL     23148<<ASSIGN  23167>>ASSIGN  23369>>ASSIGN  23393<<ASSIGN  23417>>ASSIGN  23505>>ASSIGN
     23574>>IF      23591>>ASSIGN  23687<<ASSIGN  23688>>ASSIGN  23691<<ASSIGN  23862>>IF      23864<<ASSIGN
     23867>>ASSIGN  23919<<ASSIGN  23930<<ASSIGN  24097<<ASSIGN
KZ$LINCTX.CURDEV$
     20365**DCL     23149<<ASSIGN  23223>>ASSIGN  23370>>ASSIGN  23386<<ASSIGN  23418>>ASSIGN  23506>>ASSIGN
     23576<<ASSIGN  23592>>IF      23593>>ASSIGN  23606>>IF      23869>>IF      23870>>ASSIGN  23883<<ASSIGN
     23918<<ASSIGN  23932<<ASSIGN  24099<<ASSIGN  24115<<ASSIGN
KZ$LINCTX.DSCRSN
     20237**DCL     23637<>CALL    23659<>CALL    23675<>CALL
KZ$LINCTX.DSC_LEV
     20464**DCL     23621<<ASSIGN  23647<<ASSIGN  23667<<ASSIGN  24321>>DOCASE  24348>>DOCASE  24367>>DOCASE
KZ$LINCTX.FLAGS.CTRINITDONE
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:338  
     20211**DCL     23856<<ASSIGN
KZ$LINCTX.FLAGS.DSC
     20174**DCL     24320>>IF      24329<<ASSIGN  24358<<ASSIGN
KZ$LINCTX.INACT_CTR
     20417**DCL     23387>>ASSIGN  23388>>DOUNTIL 23395<<ASSIGN  23397<<ASSIGN
KZ$LINCTX.INPBFR$
     20372**DCL     23231>>ASSIGN  23421>>ASSIGN  23433>>ASSIGN  23457>>ASSIGN  23474>>ASSIGN  23515>>ASSIGN
     23516>>ASSIGN  23526>>ASSIGN  23532<<ASSIGN  23540>>ASSIGN  23841>>ASSIGN  23848>>ASSIGN  23901>>ASSIGN
     23927>>ASSIGN  24092>>ASSIGN  24915>>ASSIGN
KZ$LINCTX.INPBFRSIZ
     20374**DCL     23523>>ASSIGN
KZ$LINCTX.INPDATSIZ
     20376**DCL     23413>>IF      23459<<ASSIGN  23468>>IF      23515>>ASSIGN  23516>>ASSIGN  23524>>ASSIGN
     23542>>ASSIGN  23837>>IF
KZ$LINCTX.LINID
     20087**DCL     24898>>ASSIGN
KZ$LINCTX.LINID.TERM
     20089**DCL     20098--REDEF
KZ$LINCTX.OTPCNT
     20354**DCL     20357--REDEF   23107>>IF      23110>>ASSIGN  23182>>IF      23183<<ASSIGN  23266<<ASSIGN
     23266>>ASSIGN  23316<<ASSIGN  23316>>ASSIGN  23488<<ASSIGN  23488>>ASSIGN  23876<<ASSIGN  24280<<ASSIGN
     24280>>ASSIGN  24299<<ASSIGN  24299>>ASSIGN  24490<<ASSIGN  24490>>ASSIGN
KZ$LINCTX.OTPCTR$
     20384**DCL     23111>>IF      23112<<ASSIGN  23118>>ASSIGN  23147<<ASSIGN  23186<<ASSIGN  23686>>IF
     23688<<ASSIGN  23691>>ASSIGN
KZ$LINCTX.OTPDEV$
     20391**DCL     23113<<ASSIGN  23120>>IF      23121<<ASSIGN  23123<<ASSIGN  23123>>ASSIGN  23124>>ASSIGN
     23146<<ASSIGN  23163<<ASSIGN  23187<<ASSIGN  23689<<ASSIGN  24407<<ASSIGN
KZ$LINCTX.OTPHD$
     20367**DCL     23104>>IF      23134<<ASSIGN  23202>>ASSIGN  23204<<ASSIGN  23205>>IF      23328>>IF
     23329>>IF      23331>>ASSIGN  23337<<ASSIGN  23352>>ASSIGN  23354<<ASSIGN  23355>>IF      23874>>IF
     23888<<ASSIGN  23909<<ASSIGN  24175>>ASSIGN  24269>>DOWHILE 24270>>ASSIGN  24271>>ASSIGN  24272<<ASSIGN
     24272>>ASSIGN  24273>>IF      24284>>IF      24288>>ASSIGN  24290>>ASSIGN  24296>>ASSIGN  24300<<ASSIGN
     24930>>IF      24931>>ASSIGN  24932>>ASSIGN
KZ$LINCTX.OTPTL$
     20370**DCL     23131>>IF      23132>>ASSIGN  23135<<ASSIGN  23137>>ASSIGN  23140>>ASSIGN  23141>>IF
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:339  
     23206<<ASSIGN  23338<<ASSIGN  23339>>ASSIGN  23356<<ASSIGN  23885>>IF      23886>>ASSIGN  23889<<ASSIGN
     23891>>ASSIGN  23910<<ASSIGN  24274<<ASSIGN  24295>>ASSIGN  24298>>ASSIGN  24301<<ASSIGN
KZ$LINCTX.POLADR.CTR
     20398**DCL     23144<<ASSIGN  23155<<ASSIGN  23369<<ASSIGN  23391<<ASSIGN
KZ$LINCTX.POLADR.DEV
     20399**DCL     23145<<ASSIGN  23156<<ASSIGN  23370<<ASSIGN  23392<<ASSIGN
KZ$LINCTX.POLLST$
     20405**DCL     23165>>IF      23167>>ASSIGN  23389>>IF      23577>>IF      23585>>ASSIGN  23795<<ASSIGN
     23800>>ASSIGN
KZ$LINCTX.POLSIZ
     20400**DCL     20402--REDEF   23394>>IF      23402>>IF      23739<<ASSIGN  23739>>ASSIGN  23792>>ASSIGN
     23795>>ASSIGN  23799>>DOINDEX 24453>>CALL
KZ$LINCTX.POLX
     20420**DCL     23165>>IF      23167>>ASSIGN  23398<<ASSIGN  23564>>ASSIGN  23575>>ASSIGN  23577>>IF
     23585>>ASSIGN  23687>>ASSIGN
KZ$LINCTX.PRO.SLAVE
     20305**DCL     23277>>IF      23296>>IF      23412>>IF      24267>>IF      24475>>IF      24493>>IF
KZ$LINCTX.RTRCNT
     20242**DCL     23857<<ASSIGN
KZ$OTPBFR
     20749**DCL     23278--IF      23281--IF      23290<<ASSIGN  23298--ASSIGN  23299--ASSIGN  23300--ASSIGN
     23301--ASSIGN  23302--ASSIGN  23307--ASSIGN  23308--ASSIGN  23309--ASSIGN
KZ$OTPBFR.BFRSIZ
     20792**DCL     23291<<ASSIGN  24201>>ASSIGN  24243>>ASSIGN
KZ$OTPBFR.CMPCOD
     20795**DCL     23357<<ASSIGN  24206>>ASSIGN  24573<<ASSIGN
KZ$OTPBFR.DATA_SIZ
     20790**DCL     23140>>ASSIGN  23303<<ASSIGN  23310<<ASSIGN  24214>>ASSIGN  24932>>ASSIGN  24937>>ASSIGN
KZ$OTPBFR.DEV$
     20800**DCL     23207>>ASSIGN  23295<<ASSIGN  24177>>IF      24270>>ASSIGN  24288>>ASSIGN
KZ$OTPBFR.FLAGS.CNT#
     20764**DCL     23294<<ASSIGN  24213>>IF
KZ$OTPBFR.FLAGS.ERR#
     20767**DCL     23329>>IF      23331<<ASSIGN  23336>>IF      23345<<ASSIGN
KZ$OTPBFR.FLAGS.FIRST#
     20755**DCL     23292<<ASSIGN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:340  
KZ$OTPBFR.FLAGS.HALT
     20770**DCL     23141>>IF
KZ$OTPBFR.FLAGS.HALT.INP#
     20773**DCL     23213>>IF
KZ$OTPBFR.FLAGS.HALT.PAG#
     20771**DCL     23210>>IF
KZ$OTPBFR.FLAGS.LAST#
     20760**DCL     23293<<ASSIGN
KZ$OTPBFR.FLAGS.RELOTPBFR
     20775**DCL     24197>>IF
KZ$OTPBFR.LNK$
     20750**DCL     23132<<ASSIGN  23136>>ASSIGN  23137<<ASSIGN  23204>>ASSIGN  23312<<ASSIGN  23339<<ASSIGN
     23340>>ASSIGN  23354>>ASSIGN  23886<<ASSIGN  23890>>ASSIGN  23891<<ASSIGN  23911>>ASSIGN  23968>>ASSIGN
     24179>>ASSIGN  24188<<ASSIGN  24192<<ASSIGN  24272>>ASSIGN  24275<<ASSIGN  24291>>DOWHILE 24293>>ASSIGN
     24295<<ASSIGN  24479<<ASSIGN  24568>>ASSIGN
KZ$OTPBFR.MRKCNT
     20797**DCL     24200>>IF      24203>>DOWHILE 24209<<ASSIGN  24209>>ASSIGN
KZ$OTPBFR.TYP
     20752**DCL     23971>>DOCASE  24571>>DOCASE
KZT$3270
     23080**DCL-ENT 19663--DCLINIT 25114--CALL
KZT$CLEAR
     23081**DCL-ENT 24674--CALL
KZT$CLEARIMM
     23082**DCL-ENT 23496--CALL
KZT$CMPOTP
     23084**DCL-ENT 24198--CALL
KZT$SNDSLV
     23083**DCL-ENT 24476--CALL
KZT_CNCDSC@
     23091**DCL     24025>>CALL    24461>>CALL    24545>>CALL    24599>>CALL    24615>>CALL
KZT_THRTL_INIT
     22186**DCL     24628>>ASSIGN
KZT_THRTL_UNBLK
     22199**DCL     24220>>IF
KZT_USRPRM$
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:341  
     19668**DCL     23724<>CALL    23731>>ASSIGN  23732>>ASSIGN  23733>>ASSIGN  24627>>ASSIGN
KZ_3270CTR
     19047**DCL     24141>>ASSIGN
KZ_3270DEV
     19087**DCL     24116>>ASSIGN
KZ_3270M_HDR.STTBFR$
     22220**DCL     22248--IMP-PTR 23287>>ASSIGN  23287>>ASSIGN  23288>>ASSIGN  23288>>ASSIGN  23715<>CALL
     23716>>ASSIGN  23717>>ASSIGN  23718>>ASSIGN  23719>>ASSIGN  23720>>ASSIGN  23982>>ASSIGN  23982>>ASSIGN
     24113>>ASSIGN  24113>>ASSIGN  24139>>ASSIGN  24139>>ASSIGN  24244>>ASSIGN  24244>>ASSIGN  24419>>ASSIGN
     24419>>ASSIGN  24444>>ASSIGN  24444>>ASSIGN
KZ_3270PRFFNCTBL
     19667**DCL     19664--DCLINIT
KZ_3270STD
     19670**DCL     19666--DCLINIT
KZ_3270XL
     23076**DCL     23278>>IF      23281>>IF      23298>>ASSIGN  23299>>ASSIGN  23302>>ASSIGN  23309>>ASSIGN
KZ_3270XLB
     23075**DCL     23076--REDEF
KZ_3270_BFRSIZ
     23072**DCL     23285>>ASSIGN  23288>>ASSIGN  24201>>ASSIGN  24243>>ASSIGN
KZ_CLMEVENT
     19367**DCL     24021>>ASSIGN  24457>>ASSIGN  24537>>ASSIGN  24591>>ASSIGN  24611>>ASSIGN
KZ_INPBFR
     19266**DCL     23522>>ASSIGN
KZ_INPFNCTBLHED$
     19669**DCL     19662--DCLINIT
KZ_OTPBFR
     19299**DCL     23290>>ASSIGN
KZ_TRNTBLHED$
     19666**DCL     19663--DCLINIT
KZ_USRPRM
     19636**DCL     23731>>ASSIGN
KZ_VDHSTT$
     23073**DCL     21765--IMP-PTR 23698>>IF      23706<>CALL    23707>>ASSIGN  23708>>ASSIGN  23709>>ASSIGN
     23710>>ASSIGN  23711>>ASSIGN  23733>>ASSIGN
LIN$
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:342  
     18519**DCL     20066--IMP-PTR 23096<<ASSIGN  23104>>IF      23107>>IF      23110>>ASSIGN  23111>>IF
     23112>>ASSIGN  23112>>ASSIGN  23113>>ASSIGN  23118>>ASSIGN  23120>>IF      23121>>ASSIGN  23123>>ASSIGN
     23123>>ASSIGN  23124>>ASSIGN  23131>>IF      23132>>ASSIGN  23134>>ASSIGN  23135>>ASSIGN  23137>>ASSIGN
     23140>>ASSIGN  23141>>IF      23144>>ASSIGN  23145>>ASSIGN  23146>>ASSIGN  23147>>ASSIGN  23148>>ASSIGN
     23149>>ASSIGN  23155>>ASSIGN  23156>>ASSIGN  23163>>ASSIGN  23165>>IF      23165>>IF      23167>>ASSIGN
     23167>>ASSIGN  23167>>ASSIGN  23169>>ASSIGN  23169>>ASSIGN  23182>>IF      23183>>ASSIGN  23186>>ASSIGN
     23187>>ASSIGN  23202>>ASSIGN  23204>>ASSIGN  23205>>IF      23206>>ASSIGN  23223>>ASSIGN  23231>>ASSIGN
     23266>>ASSIGN  23266>>ASSIGN  23277>>IF      23296>>IF      23316>>ASSIGN  23316>>ASSIGN  23328>>IF
     23329>>IF      23331>>ASSIGN  23337>>ASSIGN  23338>>ASSIGN  23339>>ASSIGN  23352>>ASSIGN  23354>>ASSIGN
     23355>>IF      23356>>ASSIGN  23369>>ASSIGN  23369>>ASSIGN  23370>>ASSIGN  23370>>ASSIGN  23386>>ASSIGN
     23387>>ASSIGN  23388>>DOUNTIL 23389>>IF      23390>>ASSIGN  23391>>ASSIGN  23392>>ASSIGN  23393>>ASSIGN
     23394>>IF      23395>>ASSIGN  23397>>ASSIGN  23398>>ASSIGN  23402>>IF      23412>>IF      23413>>IF
     23417>>ASSIGN  23418>>ASSIGN  23421>>ASSIGN  23433>>ASSIGN  23457>>ASSIGN  23459>>ASSIGN  23468>>IF
     23474>>ASSIGN  23488>>ASSIGN  23488>>ASSIGN  23505>>ASSIGN  23506>>ASSIGN  23515>>ASSIGN  23515>>ASSIGN
     23516>>ASSIGN  23516>>ASSIGN  23523>>ASSIGN  23524>>ASSIGN  23526>>ASSIGN  23532>>ASSIGN  23540>>ASSIGN
     23542>>ASSIGN  23563>>IF      23564>>ASSIGN  23564>>ASSIGN  23574>>IF      23575>>ASSIGN  23575>>ASSIGN
     23576>>ASSIGN  23577>>IF      23577>>IF      23585>>ASSIGN  23585>>ASSIGN  23586>>ASSIGN  23586>>ASSIGN
     23591>>ASSIGN  23592>>IF      23593>>ASSIGN  23606>>IF      23621>>ASSIGN  23623>>ASSIGN  23637>>CALL
     23647>>ASSIGN  23659>>CALL    23667>>ASSIGN  23675>>CALL    23686>>IF      23687>>ASSIGN  23687>>ASSIGN
     23687>>ASSIGN  23688>>ASSIGN  23688>>ASSIGN  23689>>ASSIGN  23691>>ASSIGN  23691>>ASSIGN  23739>>ASSIGN
     23739>>ASSIGN  23740>>ASSIGN  23752>>ASSIGN  23792>>ASSIGN  23794>>ASSIGN  23795>>ASSIGN  23795>>ASSIGN
     23798>>ASSIGN  23799>>DOINDEX 23800>>ASSIGN  23801>>ASSIGN  23837>>IF      23841>>ASSIGN  23848>>ASSIGN
     23856>>ASSIGN  23857>>ASSIGN  23862>>IF      23864>>ASSIGN  23867>>ASSIGN  23869>>IF      23870>>ASSIGN
     23874>>IF      23876>>ASSIGN  23883>>ASSIGN  23885>>IF      23886>>ASSIGN  23888>>ASSIGN  23889>>ASSIGN
     23891>>ASSIGN  23901>>ASSIGN  23909>>ASSIGN  23910>>ASSIGN  23918>>ASSIGN  23919>>ASSIGN  23927>>ASSIGN
     23930>>ASSIGN  23932>>ASSIGN  23963<<ASSIGN  23999<<ASSIGN  24008<<ASSIGN  24015<<ASSIGN  24023>>ASSIGN
     24024>>ASSIGN  24036<<ASSIGN  24050<<ASSIGN  24063>>ASSIGN  24092>>ASSIGN  24097>>ASSIGN  24099>>ASSIGN
     24115>>ASSIGN  24143>>ASSIGN  24151>>ASSIGN  24175>>ASSIGN  24267>>IF      24269>>DOWHILE 24270>>ASSIGN
     24271>>ASSIGN  24272>>ASSIGN  24272>>ASSIGN  24273>>IF      24274>>ASSIGN  24280>>ASSIGN  24280>>ASSIGN
     24284>>IF      24288>>ASSIGN  24290>>ASSIGN  24295>>ASSIGN  24296>>ASSIGN  24298>>ASSIGN  24299>>ASSIGN
     24299>>ASSIGN  24300>>ASSIGN  24301>>ASSIGN  24320>>IF      24321>>DOCASE  24329>>ASSIGN  24348>>DOCASE
     24358>>ASSIGN  24361>>IF      24367>>DOCASE  24407>>ASSIGN  24423>>ASSIGN  24430>>ASSIGN  24448>>IF
     24453>>CALL    24453>>CALL    24455>>ASSIGN  24459>>ASSIGN  24460>>ASSIGN  24475>>IF      24490>>ASSIGN
     24490>>ASSIGN  24493>>IF      24540>>ASSIGN  24594>>ASSIGN  24614>>ASSIGN  24898>>ASSIGN  24911>>ASSIGN
     24915>>ASSIGN  24926>>ASSIGN  24930>>IF      24931>>ASSIGN  24932>>ASSIGN  24952>>ASSIGN  24968>>ASSIGN
     24993>>ASSIGN
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:343  
LINCTX
     17674**DCL     24015--ASSIGN
LINCTX.LINID.TERM
     17697**DCL     17706--REDEF
LINCTX.OTPCNT
     17962**DCL     17965--REDEF
LINCTX.POLSIZ
     18008**DCL     18010--REDEF
LINRSP
     18096**DCL     23838<<ASSIGN  23880<<ASSIGN  23914<<ASSIGN  23920<<ASSIGN  23933<<ASSIGN  23937<<ASSIGN
LINSTAT
     18097**DCL     23466>>IF      23514>>IF      23533>>IF      23543>>IF
M$XXX
      4791**DCL-ENT 23105--CALL    23942--CALL
MORE_OTP IN PROCEDURE RELOTPBFR
     24185**LABEL   24178--GOTO
NONE
     23673**LABEL   23649--CALLALT 23670--CALLALT 23671--CALLALT
NOOOO
     23209**LABEL   23203--GOTO
NO_CTRLR
     23783**LABEL   23761--CALLALT
NO_MEMORY
     23953**LABEL   23286--CALLALT 23521--CALLALT 23706--CALLALT 23715--CALLALT 23724--CALLALT 23746--CALLALT
     23768--CALLALT 23793--CALLALT
NO_MEMORY IN PROCEDURE BLD_CTR_CTX
     24155**LABEL   24138--CALLALT
NO_MEMORY IN PROCEDURE BLD_DEV_CTX
     24129**LABEL   24112--CALLALT
NO_SUCH_ANIMAL IN PROCEDURE FND_CTX
     24103**LABEL   24096--CALLALT 24098--CALLALT
NO_WAY
     23826**LABEL   23824--CALLALT 23825--CALLALT
NXTDEV
     23870**LABEL   23896--GOTO
OTPBFR$
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:344  
     18098**DCL     24038>>ASSIGN
OTPLOOP
     23131**LABEL   23143--GOTO
O_11011_O IN PROCEDURE REQUEUE
     24264**DCL     24290<<ASSIGN  24291>>DOWHILE 24293<<ASSIGN  24293>>ASSIGN
P$
     21328**DCL     23390>>ASSIGN  23564>>ASSIGN  23575>>ASSIGN  23687>>ASSIGN  23801<<ASSIGN
P1$
     18523**DCL     24142<<ASSIGN  24145<<ASSIGN  24148>>IF      24149>>ASSIGN  24398<<ASSIGN  24400<<ASSIGN
     24403>>IF      24406>>ASSIGN  24424<<ASSIGN  24426<<ASSIGN  24429>>IF      24432>>ASSIGN  24640<<ASSIGN
     24672>>ASSIGN
PARAMETER1
     17401**DCL         9--PROC    17416--REDEF   17495--REDEF   17674--REDEF   23959--ENTRY   23995--ENTRY
     24004--ENTRY   24013--ENTRY   24032--ENTRY   24044--ENTRY
PARAMETER2
     18095**DCL         9--PROC    18096--REDEF   18097--REDEF   18098--REDEF   24032--ENTRY
POLADR
     19028**DCL     23145>>ASSIGN  23155>>ASSIGN  23156>>ASSIGN  23167>>ASSIGN  23369>>ASSIGN  23370>>ASSIGN
     23391>>ASSIGN
POLADR_B
     19023**DCL     19028--REDEF
POLTO2
     23598**LABEL   23604--GOTO
POLTO4
     23601**LABEL   23594--GOTO
PROCESS_INPUT
     23476**LABEL   23428--GOTO    23461--GOTO
PRO_ATTR
     19436**DCL     24651--ASSIGN
P_PHLEGM
     22203**DCL     24647>>ASSIGN
REALLY_CLR_CTR
     24422**PROC    24350--CALL
REALLY_CLR_DEV
     24396**PROC    24323--CALL
REALLY_CLR_LINE
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:345  
     24447**PROC    24369--CALL
RELOTPBFR
     24171**PROC    23216--CALL    23358--CALL    23973--CALL    24039--CALL    24574--CALL
REQUEUE
     24261**PROC    23195--CALL    23256--CALL    23321--CALL    23332--CALL    23573--CALL    23622--CALL
     23650--CALL    23672--CALL
RLS_CTR
     24347**PROC    23631--CALL    23653--CALL    24342--CALL
RLS_DEV
     24312**PROC    23640--CALL    23662--CALL    23678--CALL    24051--CALL
RLS_LINE
     24366**PROC    23625--CALL    24361--CALL
RSN IN PROCEDURE DSC_DEV
     24473**DCL     24472--PROC    24509>>ASSIGN  24523--ENTRY
SELADR
     19035**DCL     23144>>ASSIGN
SELADR_B
     19030**DCL     19035--REDEF
SEL_ECT
     23927**LABEL   23859--GOTO
SETCTR
     23748**LABEL   23743--GOTO
SETDEV
     23770**LABEL   23765--GOTO
SET_PRO
     24161**PROC    23781--CALL    24125--CALL    24386--CALL
SND_DAT
     23909**LABEL   23905--GOTO
SND_EOT
     23918**LABEL   23845--GOTO    23852--GOTO    23863--CALLALT 23877--GOTO    23902--CALLALT 23903--CALLALT
     23906--GOTO
SND_NULL
     23937**LABEL   23929--CALLALT 23931--CALLALT
SPC_POL
     23901**LABEL   23861--GOTO
STAT.X.ACT#
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:346  
     20049**DCL     23243>>IF      23260>>DOCASE
STAT.X.LOG#
     20045**DCL     23247>>IF
STAT.X.VAL#
     20044**DCL     23233>>IF
STAT#
     18529**DCL     23232<<DOINDEX 23233>>IF      23236<<ASSIGN  23243>>IF      23247>>IF      23260>>DOCASE
STATUS
     18531**DCL     18532--REDEF   18533--REDEF   23231<<ASSIGN  23240>>ASSIGN  23241>>IF      23243>>IF
     23250>>IF      23841<<ASSIGN  23848<<ASSIGN  23901<<ASSIGN  23927<<ASSIGN  24092<<ASSIGN
STATUSB.I
     18534**DCL     23842>>IF      23849>>IF      23928>>ASSIGN  24093>>ASSIGN
STATUSB.J
     18535**DCL     23842>>IF      23847>>ASSIGN  23849>>IF      23854>>ASSIGN  24094>>ASSIGN
STATUSW
     18532**DCL     23233>>IF      24929>>ASSIGN
STAT_
     19698**DCL     20035--REDEF
SZ
     18536**DCL     23285<<ASSIGN  23286<>CALL    23520<<ASSIGN  23521<>CALL    23705<<ASSIGN  23706<>CALL
     23714<<ASSIGN  23715<>CALL    23723<<ASSIGN  23724<>CALL    23792<<ASSIGN  23793<>CALL    24111<<ASSIGN
     24112<>CALL    24137<<ASSIGN  24138<>CALL    25004>>ASSIGN
T$
     18522**DCL     23521<>CALL    23522>>ASSIGN  23523>>ASSIGN  23524>>ASSIGN  23525>>ASSIGN  23526>>ASSIGN
     23528>>ASSIGN  23530>>ASSIGN  23531>>ASSIGN  23534>>ASSIGN  23534>>ASSIGN  23536>>ASSIGN  23793<>CALL
     23794>>ASSIGN  23795>>ASSIGN  23984<<ASSIGN  23986<>CALL    23987<<ASSIGN  23988<>CALL    24112<>CALL
     24114>>ASSIGN  24138<>CALL    24140>>ASSIGN  24143<<ASSIGN  24144>>DOWHILE 24145>>ASSIGN  24146<<ASSIGN
     24146>>ASSIGN  24242<<ASSIGN  24245<>CALL    24266<<ASSIGN  24304>>ASSIGN  24397<<ASSIGN  24399>>DOWHILE
     24400>>ASSIGN  24401<<ASSIGN  24401>>ASSIGN  24412<>CALL    24423<<ASSIGN  24425>>DOWHILE 24426>>ASSIGN
     24427<<ASSIGN  24427>>ASSIGN  24437<>CALL    24576<<ASSIGN  24577<>CALL    24578<<ASSIGN  24579<>CALL
TBFR$
     18530**DCL     24175<<ASSIGN  24176>>DOWHILE 24177>>IF      24179<<ASSIGN  24179>>ASSIGN  24201<<ASSIGN
     24205>>ASSIGN  24208<<ASSIGN  24208>>ASSIGN
TCTR$
     18537**DCL     23628<<ASSIGN  23643>>ASSIGN
TDEV$
PL6.E3A0      #001=KZV$3270DV File=KZV$3270DV.:E05TSI                            WED 07/30/97 03:04 Page:347  
     18538**DCL     23634<<ASSIGN  23641>>ASSIGN  23656<<ASSIGN  23663>>ASSIGN
TELL_VDH IN PROCEDURE DSC_DEV
     24507**LABEL   24528--GOTO
UBYT
     21329**DCL     23165>>IF      23167<<ASSIGN  23278>>IF      23281>>IF      23298<<ASSIGN  23299<<ASSIGN
     23300<<ASSIGN  23301<<ASSIGN  23302<<ASSIGN  23307<<ASSIGN  23308<<ASSIGN  23309<<ASSIGN  23389>>IF
     23421>>ASSIGN  23474>>ASSIGN  23515<<ASSIGN  23516<<ASSIGN  23577>>IF      23585<<ASSIGN  23800<<ASSIGN
VDHTRCWORD
     21327**DCL     24629>>ASSIGN
VDH_FLG
     18540**DCL     23097<<ASSIGN  23946>>IF      23964<<ASSIGN  24000<<ASSIGN  24009<<ASSIGN  24037<<ASSIGN
     24048<<ASSIGN  24631<<ASSIGN  25017>>IF      25018<<ASSIGN  25018>>ASSIGN  25080<<ASSIGN  25095>>IF
     25096<<ASSIGN  25096>>ASSIGN  25097>>IF
VDI$ IN PROCEDURE ENTER_VDH
     25015**DCL     25012--PROC    25023>>IF
VDI$ IN PROCEDURE EXIT_VDH
     25093**DCL     25091--PROC    25098>>IF
VLP_TRMATTR
     19456**DCL     19438--DCLINIT 24652--ASSIGN
VLP_TRMCTL
     19497**DCL     19479--DCLINIT 24652--ASSIGN
VLP_TRMCTL.BREAKCOUNT
     19508**DCL     19509--REDEF
XIT
     23946**LABEL   23463--GOTO    23467--CALLALT 23480--GOTO    23508--GOTO    23555--GOTO    23955--GOTO
X_00100_X IN PROCEDURE REQUEUE
     24263**DCL     24289<<ASSIGN  24292<<ASSIGN  24292>>ASSIGN  24299>>ASSIGN

PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:348  
     1977        1        /*T***********************************************************/
     1978        2        /*T*                                                         */
     1979        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1980        4        /*T*                                                         */
     1981        5        /*T***********************************************************/
     1982        6        KZT$3270INIT: PROC (HDR_INIT);
     1983        7
     1984        8        %INCLUDE KZ$LINCTX;
     1985      628        %INCLUDE KL_SUPER_C;
     1986     3530
     1987     3531        %KZ$INIT (FPTN=HDR_INIT,STCLASS="");
     1988     3553
     1989     3554    1   DCL KZ_HDR$(0:13) PTR BASED;
     1990     3555    1   DCL KZ_3270M_HDR UBIN SYMREF;
     1991     3556    1   DCL KZ_3270S_HDR UBIN SYMREF;
     1992     3557    1   DCL KZT_ORDERS@ EPTR SYMREF;
     1993     3558    1   DCL KZT_GO@ EPTR SYMREF;
     1994     3559    1   DCL KZT_CNCDSC@ EPTR SYMREF;
     1995     3560    1   DCL P$ PTR;
     1996     3561
     1997     3562    1           P$=HDR_INIT.HDR$;
     1998     3563    1           P$->KZ_HDR$(%KLPT_POLL#*2)=ADDR(KZ_3270M_HDR);
     1999     3564    1           P$->KZ_HDR$(%KLPT_POLL#*2+1)=ADDR(KZ_3270S_HDR);
     2000     3565    1           KZT_ORDERS@=HDR_INIT.ORDERS;
     2001     3566    1           KZT_CNCDSC@=HDR_INIT.CNCDSC;
     2002     3567    1           KZT_GO@=HDR_INIT.GO;
     2003     3568    1           RETURN;
     2004     3569    1   END;

PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:349  
--  Include file information  --

   KL_SUPER_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZT$3270INIT.

   Procedure KZT$3270INIT requires 38 words for executable code.
   Procedure KZT$3270INIT requires 8 words of local(AUTO) storage.

    No errors detected in file KZV$3270DV.:E05TSI    .

PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:350  

 Object Unit name= KZT$3270INIT                               File name= KZV$3270DV.:E05TOU
 UTS= JUL 30 '97 03:08:22.68 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    38     26  KZT$3270INIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KZT$3270INIT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZ_3270M_HDR                          KZ_3270S_HDR                          KZT_ORDERS@
     KZT_GO@                               KZT_CNCDSC@                      r    G$ROS$
PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:351  


     1977        1        /*T***********************************************************/
     1978        2        /*T*                                                         */
     1979        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1980        4        /*T*                                                         */
     1981        5        /*T***********************************************************/
     1982        6        KZT$3270INIT: PROC (HDR_INIT);

      6   0 000000  D380 0000 0000  xent KZT$3270INIT    LNJ,B5   X6A_AUTO_1
          0 000003       0008 0001                       DC       8,1

     1983        7
     1984        8        %INCLUDE KZ$LINCTX;
     1985      628        %INCLUDE KL_SUPER_C;
     1986     3530
     1987     3531        %KZ$INIT (FPTN=HDR_INIT,STCLASS="");
     1988     3553
     1989     3554    1   DCL KZ_HDR$(0:13) PTR BASED;
     1990     3555    1   DCL KZ_3270M_HDR UBIN SYMREF;
     1991     3556    1   DCL KZ_3270S_HDR UBIN SYMREF;
     1992     3557    1   DCL KZT_ORDERS@ EPTR SYMREF;
     1993     3558    1   DCL KZT_GO@ EPTR SYMREF;
     1994     3559    1   DCL KZT_CNCDSC@ EPTR SYMREF;
     1995     3560    1   DCL P$ PTR;
     1996     3561
     1997     3562    1           P$=HDR_INIT.HDR$;

   3562   0 000005  ECC7 0004                            LDB,B6   @HDR_INIT,AUTO
          0 000007  DC86                                 LDB,B5   ,B6
          0 000008  DFC7 0006                            STB,B5   P$,AUTO

     1998     3563    1           P$->KZ_HDR$(%KLPT_POLL#*2)=ADDR(KZ_3270M_HDR);

   3563   0 00000A  CB80 0000 0000  xsym                 LAB,B4   KZ_3270M_HDR
          0 00000D  CFC5 0010                            STB,B4   16,B5

     1999     3564    1           P$->KZ_HDR$(%KLPT_POLL#*2+1)=ADDR(KZ_3270S_HDR);
PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:352  

   3564   0 00000F  BB80 0000 0000  xsym                 LAB,B3   KZ_3270S_HDR
          0 000012  BFC5 0012                            STB,B3   18,B5

     2000     3565    1           KZT_ORDERS@=HDR_INIT.ORDERS;

   3565   0 000014  ACC6 0006                            LDB,B2   6,B6
          0 000016  AF80 0000 0000  xsym                 STB,B2   KZT_ORDERS@

     2001     3566    1           KZT_CNCDSC@=HDR_INIT.CNCDSC;

   3566   0 000019  9CC6 0004                            LDB,B1   4,B6
          0 00001B  9F80 0000 0000  xsym                 STB,B1   KZT_CNCDSC@

     2002     3567    1           KZT_GO@=HDR_INIT.GO;

   3567   0 00001E  DCC6 000A                            LDB,B5   10,B6
          0 000020  DF80 0000 0000  xsym                 STB,B5   KZT_GO@

     2003     3568    1           RETURN;

   3568   0 000023  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     2004     3569    1   END;

PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:353  
--  Include file information  --

   KL_SUPER_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZT$3270INIT.
PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:354  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @HDR_INIT                 *0-0-0/w STRC(192)   r     1 HDR_INIT
     6-0-0/w PTR         r     1 P$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w EPTR        r     1 KZT_CNCDSC@                0-0-0/w EPTR        r     1 KZT_GO@
     0-0-0/w EPTR        r     1 KZT_ORDERS@                0-0-0/w UBIN(16)    r     1 KZ_3270M_HDR
     0-0-0/w UBIN(16)    r     1 KZ_3270S_HDR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KZ_HDR$(0:13)


   Procedure KZT$3270INIT requires 38 words for executable code.
   Procedure KZT$3270INIT requires 8 words of local(AUTO) storage.

    No errors detected in file KZV$3270DV.:E05TSI    .
PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:355  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KZT$3270INIT File=KZV$3270DV.:E05TSI                          WED 07/30/97 03:08 Page:356  
          MINI XREF LISTING

HDR_INIT
      3545**DCL         6--PROC
HDR_INIT.CNCDSC
      3548**DCL      3566>>ASSIGN
HDR_INIT.GO
      3551**DCL      3567>>ASSIGN
HDR_INIT.HDR$
      3546**DCL      3562>>ASSIGN
HDR_INIT.ORDERS
      3549**DCL      3565>>ASSIGN
KZT_CNCDSC@
      3559**DCL      3566<<ASSIGN
KZT_GO@
      3558**DCL      3567<<ASSIGN
KZT_ORDERS@
      3557**DCL      3565<<ASSIGN
KZ_3270M_HDR
      3555**DCL      3563--ASSIGN
KZ_3270S_HDR
      3556**DCL      3564--ASSIGN
KZ_HDR$
      3554**DCL      3563<<ASSIGN   3564<<ASSIGN
P$
      3560**DCL      3562<<ASSIGN   3563>>ASSIGN   3564>>ASSIGN
