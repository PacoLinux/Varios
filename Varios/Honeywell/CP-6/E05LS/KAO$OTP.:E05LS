VERSION E05

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:1    
        1        1        /*M* KAO$OTP ASYNC HANDLER MLCP INTERFACE FOR OUTPUT                              */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
        8        8        KAO$OTP: PROC ASYNC;
        9        9        %INCLUDE LCP_6;
       10      200        %FPT_INTRET;
       11      220        %INCLUDE KV_ASCCHR_E;                   /*  EQU'S FOR ASCII CHR'S             */
       12      357 S      %INCLUDE KV_GLBCNS_E;
       13      358        %KV_SCHRSN_E;                           /*  Schedule reasons                  */
       14      365
       15      366        %INCLUDE KL_MACRO_C;
       16     3718        %INCLUDE KL_AFCN_C;
       17     3819        %INCLUDE K_ID_E;
       18     3869        %K#LYRID_E;
       19     3876        %K#ENTID_E;
       20     3895        %INCLUDE KH_TRC;
       21     3917        %INCLUDE KH$TRC;
       22     3946        %KH_TRC;
       23     3961        %KH$TRC(NAME=KH@TRC,STCLASS=AUTO);
       24     3983        %INCLUDE KH_TRC_M;                      /*  TRACE ROUTINES                    */
       25     4031        %INCLUDE KH$CHN;
       26     4153        %KH$CHN (STCLASS="BASED(BCHN$)");       /*  CHANNEL TABLES ITEM DEFINITONS    */
       27     4277        %EQU KH_CHN=CHARTEXT('KH$CHN');
       28     4278        %INCLUDE KH_CHN;
       29     4318        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
       30     4336        %INCLUDE KNH_MACRO_C;
       31     4619        %KNH$QHDR (STCLASS="BASED(G$HAND_Q$)");
       32     4632    1   DCL G$HAND_Q$ PTR SYMREF READONLY;
       33     4633
       34     4634        %INCLUDE KH$STT;                        /* For KA_STT                         */
       35     4664        %INCLUDE KV$BPC;
       36     4693 S      %INCLUDE KV$GLB;
       37     4694        %KV$STT (NAME = KV_STT, STCLASS = SYMREF);
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:2    
       38     5088        %KV$STT;
       39     5482        %SET KV_STT = CHARTEXT('KV_STT');
       40     5483 S      %INCLUDE KV$GLBCTX;
       41     5484        %INCLUDE KA$GLB;
       42     5625        %INCLUDE KA_GLB;
       43     5702        %INCLUDE KA_GLB_E;
       44     5780        %KA_HLTOTP_E;
       45     5789        %KA_TRC_E;
       46     5806        %KA_MSC;
       47     5828        %KA_STT;
       48     6191 S      %INCLUDE KV$VDH;
       49     6192        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
       50     6316        %KA$OTPBFR;                             /*  ASYNC output buffer               */
       51     6344        %KV$SSN;                                /*  VDH Session                       */
       52     6423        %KV$PTR;                                /*  VDH Pointers, status              */
       53     6466        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
       54     6537 S      %INCLUDE KV$USR;
       55     6538        %INCLUDE KV_GLB_M;                      /*  VDH-user macros                   */
       56     6660        %INCLUDE KV_INT;
       57     6699 S      %INCLUDE KV$INT;
       58     6700        %INCLUDE KV_INT_M;
       59     6843        %INCLUDE KA_PERR_C;
       60     6862 S      %INCLUDE GT_LCP6_M;
       61     6863        %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_BADCHNSTT, STCLASS = CONSTANT, FCG = KA, MID = O,
              6863            ERR = %E$ASN_BADCHNSTT, SEV = 3);
       62     6958        %FPT_WRSYSLOG (FPTN=FPT_WRSYSLOG_INVINT, FCG=KA, MID=O, ERR=%E$ASN_INVINT, SEV=3);
       63     7053
       64     7054    1   DCL KAO$OTPINT ENTRY;
       65     7055    1   DCL KHA$ERRLOG ENTRY(1) ALTRET;
       66     7056    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY(2) ALTRET;
       67     7057    1   DCL KHD$TRC ENTRY(1);
       68     7058    1   DCL KHC$XEQ2 ENTRY(1) ALTRET;
       69     7059    1   DCL X6A_INTRET ENTRY(1);
       70     7060
       71     7061        %INCLUDE G_JIT_M;
       72     7326        %G$JIT(STCLASS="BASED(G$JIT$)");
       73     7740    1   DCL G$JIT$ PTR SYMREF;
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:3    
       74     7741
       75     7742        %INCLUDE G_HJIT_M;
       76     7887        %G$UHJIT(STCLASS="BASED(G$UHJIT$)");
       77    10861    1   DCL G$UHJIT$ PTR SYMREF;
       78    10862
       79    10863
       80    10864
       81    10865
       82    10866    1   DCL Y@CHN UBIN;
       83    10867    1   DCL BCHN$ PTR;
       84    10868    1   DCL BCTX$ PTR;
       85    10869        %KV@USRENT;
       86    10889        /*
       87    10890        Saved execution time (from the JIT).
       88    10891        */
       89    10892    1   DCL Y@SVDEXCTIM UBIN(32) AUTO;
       90    10893        /*
       91    10894        Current execution time (from the JIT).
       92    10895        */
       93    10896    1   DCL Y@CRTEXCTIM UBIN(32) AUTO;
       94    10897
       95    10898        %KV$BOX (PAGE=YES, TITLE=Async Output Interrupt Processing);

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:4    
             10916    1   /***************************************************************************
             10917    1    *                                                                         *
             10918    1    *                     Async Output Interrupt Processing                   *
             10919    1    *                                                                         *
             10920    1    ***************************************************************************/

       96    10925
       97    10926    1      CALL KHC$XEQ2(Y@SVDEXCTIM);
       98    10927
       99    10928    1      Y@CHN = BITBIN(G$UHJIT.ISA_USR.DEV);
      100    10929    2      IF (Y@CHN > KH_CHNHI) THEN DO;
      101    10930        /*E* ERROR: KAO-E$ASN_INVINT                                               */
      102    10931        /*E* MESSAGE: Invalid interrupt                                               */
      103    10932        /*E* DESCRIPTION: An interrupt was received whose DEV is outside              */
      104    10933        /*,* the range of the channel tables.                                         */
      105    10934    2         FPT_WRSYSLOG_INVINT.V.TERMID.TERM.CHANNEL = Y@CHN;
      106    10935    2         CALL KHA$ERRLOG (FPT_WRSYSLOG_INVINT);
      107    10936              %KH$CALTRC (CND=NON,COD=%KA#TRC_INPINT);
      108    10971    2      END; ELSE DO;
      109    10972
      110    10973        /* CHANNEL NUMBER IS IN THE RANGE OF NUMBERS CONTAINED IN THE                 */
      111    10974        /* CHN TBL.                                                                   */
      112    10975
      113    10976        /* COMPUTE THE ADR OF THE CHN TBL ENTRY FOR THIS CHANNEL                      */
      114    10977
      115    10978    2         BCHN$ = PINCRW(KH_CHNLOW$, SIZEW(KH$CHN) * (Y@CHN/128));
      116    10979    2         %KH_CHN.INTCNT = %KH_CHN.INTCNT+1;
      117    10980    2         KA_STT.KHSTT.OTPINTCNT = KA_STT.KHSTT.OTPINTCNT + 1;
      118    10981
      119    10982        /* MOVE CTX ADR TO BASE REGISTER                                              */
      120    10983
      121    10984    2         BCTX$ = %KH_CHN.CTX$;
      122    10985              %KH$CALTRC (CND=DFL,COD=%KA#TRC_INPINT);
      123    11020
      124    11021        /* INTERRUPT VALIDATION                                                       */
      125    11022
      126    11023    3         IF (G$JIT.SYSID ~= %KH_CHN.SYSID) THEN DO;
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:5    
      127    11024
      128    11025        /* We don't own this channel. */
      129    11026
      130    11027        /*E* ERROR:         KAO-E$ASN_BADCHNSTT */
      131    11028        /*E* MESSAGE:       Async handler got output interrupt for channel it doesn't own */
      132    11029        /*E* DESCRIPTION:   KH$CHN.SYSID doesn't match G$JIT.SYSID */
      133    11030    3            CALL KHD$ERRLOG_SETTERMID_CHN (FPT_WRSYSLOG_BADCHNSTT, %KH_CHN);
      134    11031    3         END; ELSE DO;
      135    11032
      136    11033        /* THIS IS AN INTERRUPT FROM AN ASYNCHRONOUS LINE.                            */
      137    11034
      138    11035    4            IF (BCTX$ ~= ADDR(NIL)) THEN DO;
      139    11036
      140    11037        /* THE CONTEXT POINTER  IS NON-NULL, INDICATING WE HAVE                */
      141    11038        /* A CONTEXT BLOCK ASSOCIATED WITH THIS LINE.                                 */
      142    11039
      143    11040    4               BCTX$->KA$CTX.OTPINTCNT = BCTX$->KA$CTX.OTPINTCNT+1;
      144    11041                    %KV$USRENT (VDI$=BCTX$->KA$CTX.VDI$,DFR$=Y@DFR,
      145    11042                    SCHRSN=%KV_SCHRSN_DFR0,STT=KV_STT);
             11055    4           KV_STT.USRENTCNT = KV_STT.USRENTCNT + 1;
             11056    5           IF NOT BCTX$->KA$CTX.VDI$->KV$VDI.BSY THEN DO;
             11057    5              BCTX$->KA$CTX.VDI$->KV$VDI.BSY = '1'B;
             11058    5              KV@USRENT.SVDPTR$ = KV$PTR$;
             11059    5              KV$PTR$ = BCTX$->KA$CTX.VDI$->KV$VDI.ASNINPPTR$;
             11060    5              END;                         /* ELSE IF ~BSY                       */
             11061    5           ELSE DO;
             11062    5              BCTX$->KA$CTX.VDI$->KV$VDI.DFR.USR(0) = '1'B;
             11063    5           KV_STT.USRENTDFRCNT = KV_STT.USRENTDFRCNT + 1;
             11064    5              GOTO Y@DFR;
             11065    5              END;                         /* END IF                             */
      146    11068    4               CALL KAO$OTPINT;
      147    11069                    %KV$USREXT;
             11075    4           KV$PTR.VDI$->KV$VDI.BSY = '0'B;
             11077    4           KV$PTR$ = KV@USRENT.SVDPTR$;
      148    11079    4   Y@DFR:   END /* IF */;
      149    11080    3         END /* IF */;
      150    11081    2      END /* IF */;
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:6    
      151    11082
      152    11083    1      CALL KHC$XEQ2(Y@CRTEXCTIM);
      153    11084    1      KA_STT.KHSTT.OTPINTISATIM = KA_STT.KHSTT.OTPINTISATIM + Y@CRTEXCTIM - Y@SVDEXCTIM
             11084               ;
      154    11085
      155    11086        /* DONE PROCESSING THIS INTERRUPT. GO TO SLEEP UNTIL THE NEXT.                */
      156    11087
      157    11088    1      IF KNH$QHDR.SCQ.IPTR=KNH$QHDR.SCQ.RPTR
      158    11089    1      THEN CALL X6A_INTRET;
      159    11090    1      ELSE CALL X6A_INTRET(FPT_INTRET);    /* Only scan if needed                */
      160    11091
      161    11092    1   END KAO$OTP;
      162    11093
      163    11094        %EOD;

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:7    
--  Include file information  --

   G_HJIT_M.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   KA_PERR_C.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_INT.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KH_TRC_M.:E05TOU  is referenced.
   KH$TRC.:E05TOU  is referenced.
   KH_TRC.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:8    
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$OTP.

   Procedure KAO$OTP requires 210 words for executable code.
   Procedure KAO$OTP requires 26 words of local(AUTO) storage.

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:9    

 Object Unit name= KAO$OTP                                    File name= KAO$OTP.:E05TOU
 UTS= JUL 29 '97 23:56:21.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none    28     1C  KAO$OTP
    1  RoData even  UTS     21     15  KAO$OTP
    2   Proc  even  none   210     D2  KAO$OTP
    3  RoData even  none     4      4  KAO$OTP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes     Async       0  KAO$OTP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KHC$XEQ2
 yes     yes           Std       1 KHA$ERRLOG
 yes     yes           Std       2 KHD$ERRLOG_SETTERMID_CHN
         yes           Std       0 KAO$OTPINT
         yes           Std       1 X6A_INTRET
                       nStd      0 X6A_AAUTO
                       nStd      0 X6A_AARET
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:10   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNLOW$                       r    KH_CHNHI                         r    KH_CHNLOW
r    G$HAND_Q$                             KV_STT                                KA_STT
     KV$PTR$                               G$JIT$                                G$UHJIT$
r    G$ROS$
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:11   


        1        1        /*M* KAO$OTP ASYNC HANDLER MLCP INTERFACE FOR OUTPUT                             */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
        8        8        KAO$OTP: PROC ASYNC;

      8   2 000000  D380 0000 0000  xent KAO$OTP         LNJ,B5   X6A_AAUTO
          2 000003       001A 0000                       DC       26,0

        9        9        %INCLUDE LCP_6;
       10      200        %FPT_INTRET;
       11      220        %INCLUDE KV_ASCCHR_E;                   /*  EQU'S FOR ASCII CHR'S             */
       12      357 S      %INCLUDE KV_GLBCNS_E;
       13      358        %KV_SCHRSN_E;                           /*  Schedule reasons                  */
       14      365
       15      366        %INCLUDE KL_MACRO_C;
       16     3718        %INCLUDE KL_AFCN_C;
       17     3819        %INCLUDE K_ID_E;
       18     3869        %K#LYRID_E;
       19     3876        %K#ENTID_E;
       20     3895        %INCLUDE KH_TRC;
       21     3917        %INCLUDE KH$TRC;
       22     3946        %KH_TRC;
       23     3961        %KH$TRC(NAME=KH@TRC,STCLASS=AUTO);
       24     3983        %INCLUDE KH_TRC_M;                      /*  TRACE ROUTINES                    */
       25     4031        %INCLUDE KH$CHN;
       26     4153        %KH$CHN (STCLASS="BASED(BCHN$)");       /*  CHANNEL TABLES ITEM DEFINITONS    */
       27     4277        %EQU KH_CHN=CHARTEXT('KH$CHN');
       28     4278        %INCLUDE KH_CHN;
       29     4318        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
       30     4336        %INCLUDE KNH_MACRO_C;
       31     4619        %KNH$QHDR (STCLASS="BASED(G$HAND_Q$)");
       32     4632    1   DCL G$HAND_Q$ PTR SYMREF READONLY;
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:12   
       33     4633
       34     4634        %INCLUDE KH$STT;                        /* For KA_STT                         */
       35     4664        %INCLUDE KV$BPC;
       36     4693 S      %INCLUDE KV$GLB;
       37     4694        %KV$STT (NAME = KV_STT, STCLASS = SYMREF);
       38     5088        %KV$STT;
       39     5482        %SET KV_STT = CHARTEXT('KV_STT');
       40     5483 S      %INCLUDE KV$GLBCTX;
       41     5484        %INCLUDE KA$GLB;
       42     5625        %INCLUDE KA_GLB;
       43     5702        %INCLUDE KA_GLB_E;
       44     5780        %KA_HLTOTP_E;
       45     5789        %KA_TRC_E;
       46     5806        %KA_MSC;
       47     5828        %KA_STT;
       48     6191 S      %INCLUDE KV$VDH;
       49     6192        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
       50     6316        %KA$OTPBFR;                             /*  ASYNC output buffer               */
       51     6344        %KV$SSN;                                /*  VDH Session                       */
       52     6423        %KV$PTR;                                /*  VDH Pointers, status              */
       53     6466        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
       54     6537 S      %INCLUDE KV$USR;
       55     6538        %INCLUDE KV_GLB_M;                      /*  VDH-user macros                   */
       56     6660        %INCLUDE KV_INT;
       57     6699 S      %INCLUDE KV$INT;
       58     6700        %INCLUDE KV_INT_M;
       59     6843        %INCLUDE KA_PERR_C;
       60     6862 S      %INCLUDE GT_LCP6_M;
       61     6863       %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_BADCHNSTT, STCLASS = CONSTANT, FCG = KA, MID = O,
              6863            ERR = %E$ASN_BADCHNSTT, SEV = 3);
       62     6958        %FPT_WRSYSLOG (FPTN=FPT_WRSYSLOG_INVINT, FCG=KA, MID=O, ERR=%E$ASN_INVINT, SEV=3);
       63     7053
       64     7054    1   DCL KAO$OTPINT ENTRY;
       65     7055    1   DCL KHA$ERRLOG ENTRY(1) ALTRET;
       66     7056    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY(2) ALTRET;
       67     7057    1   DCL KHD$TRC ENTRY(1);
       68     7058    1   DCL KHC$XEQ2 ENTRY(1) ALTRET;
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:13   
       69     7059    1   DCL X6A_INTRET ENTRY(1);
       70     7060
       71     7061        %INCLUDE G_JIT_M;
       72     7326        %G$JIT(STCLASS="BASED(G$JIT$)");
       73     7740    1   DCL G$JIT$ PTR SYMREF;
       74     7741
       75     7742        %INCLUDE G_HJIT_M;
       76     7887        %G$UHJIT(STCLASS="BASED(G$UHJIT$)");
       77    10861    1   DCL G$UHJIT$ PTR SYMREF;
       78    10862
       79    10863
       80    10864
       81    10865
       82    10866    1   DCL Y@CHN UBIN;
       83    10867    1   DCL BCHN$ PTR;
       84    10868    1   DCL BCTX$ PTR;
       85    10869        %KV@USRENT;
       86    10889        /*
       87    10890        Saved execution time (from the JIT).
       88    10891        */
       89    10892    1   DCL Y@SVDEXCTIM UBIN(32) AUTO;
       90    10893        /*
       91    10894        Current execution time (from the JIT).
       92    10895        */
       93    10896    1   DCL Y@CRTEXCTIM UBIN(32) AUTO;
       94    10897
       95    10898        %KV$BOX (PAGE=YES, TITLE=Async Output Interrupt Processing);

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:14   
             10916    1   /***************************************************************************
             10917    1    *                                                                         *
             10918    1    *                     Async Output Interrupt Processing                   *
             10919    1    *                                                                         *
             10920    1    ***************************************************************************/

       96    10925
       97    10926    1      CALL KHC$XEQ2(Y@SVDEXCTIM);

  10926   2 000005  EBC7 0012                            LAB,B6   Y@SVDEXCTIM,AUTO
          2 000007  EFC7 0016                            STB,B6   Y@CRTEXCTIM+2,AUTO
          2 000009  BBC7 0016                            LAB,B3   Y@CRTEXCTIM+2,AUTO
          2 00000B  CBF0 0100                            LAB,B4   256,IMO
          2 00000D  E380 0000 0000  xent                 LNJ,B6   KHC$XEQ2
          2 000010       0001                            DC       s:10928,PREL

       98    10927
       99    10928    1      Y@CHN = BITBIN(G$UHJIT.ISA_USR.DEV);

  10928   2 000011  EC80 0000 0000  xsym                 LDB,B6   G$UHJIT$
          2 000014  E846 0081                            LDR,R6   129,B6
          2 000016  EF47 000B                            STR,R6   Y@CHN,AUTO

      100    10929    2      IF (Y@CHN > KH_CHNHI) THEN DO;

  10929   2 000018  E900 0000 0000  xsym                 CMR,R6   KH_CHNHI
          2 00001B  0381 000F                            BLE      s:10978,PREL

      101    10930        /*E* ERROR: KAO-E$ASN_INVINT                                               */
      102    10931        /*E* MESSAGE: Invalid interrupt                                               */
      103    10932        /*E* DESCRIPTION: An interrupt was received whose DEV is outside              */
      104    10933        /*,* the range of the channel tables.                                         */
      105    10934    2         FPT_WRSYSLOG_INVINT.V.TERMID.TERM.CHANNEL = Y@CHN;

  10934   2 00001D  EF00 0000 0010  00                   STR,R6   FPT_WRSYSLOG_INVINT+9

      106    10935    2         CALL KHA$ERRLOG (FPT_WRSYSLOG_INVINT);
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:15   

  10935   2 000020  BB80 0000 0000  03                   LAB,B3   0
          2 000023  CBF0 0100                            LAB,B4   256,IMO
          2 000025  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          2 000028       0001                            DC       s:10971,PREL

      107    10936              %KH$CALTRC (CND=NON,COD=%KA#TRC_INPINT);

      108    10971    2      END; ELSE DO;

  10971   2 000029  0F81 0075                            B        s:11079,PREL

      109    10972
      110    10973        /* CHANNEL NUMBER IS IN THE RANGE OF NUMBERS CONTAINED IN THE                 */
      111    10974        /* CHN TBL.                                                                   */
      112    10975
      113    10976        /* COMPUTE THE ADR OF THE CHN TBL ENTRY FOR THIS CHANNEL                      */
      114    10977
      115    10978    2         BCHN$ = PINCRW(KH_CHNLOW$, SIZEW(KH$CHN) * (Y@CHN/128));

  10978   2 00002B  6047                                 SOR,R6   7
          2 00002C  F856                                 LDR,R7   R6
          2 00002D  6C00                                 LDV,R6   0
          2 00002E  7085                                 DOL,R7   5
          2 00002F  8400 0000 0000  xsym                 AID      KH_CHNLOW$
          2 000032  8D47 000C                            SDI      BCHN$,AUTO

      116    10979    2         %KH_CHN.INTCNT = %KH_CHN.INTCNT+1;

  10979   2 000034  DCC7 000C                            LDB,B5   BCHN$,AUTO
          2 000036  8AC5 000F                            INC      15,B5
          2 000038  8EC5 000E                            CAD      14,B5

      117    10980    2         KA_STT.KHSTT.OTPINTCNT = KA_STT.KHSTT.OTPINTCNT + 1;

  10980   2 00003A  8A80 0000 0017  xsym                 INC      KA_STT+23
          2 00003D  8E80 0000 0016  xsym                 CAD      KA_STT+22
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:16   

      118    10981
      119    10982        /* MOVE CTX ADR TO BASE REGISTER                                              */
      120    10983
      121    10984    2         BCTX$ = %KH_CHN.CTX$;

  10984   2 000040  CCC5 000C                            LDB,B4   12,B5
          2 000042  CFC7 000E                            STB,B4   BCTX$,AUTO

      122    10985              %KH$CALTRC (CND=DFL,COD=%KA#TRC_INPINT);

      123    11020
      124    11021        /* INTERRUPT VALIDATION                                                       */
      125    11022
      126    11023    3         IF (G$JIT.SYSID ~= %KH_CHN.SYSID) THEN DO;

  11023   2 000044  BC80 0000 0000  xsym                 LDB,B3   G$JIT$
          2 000047  D843 0005                            LDR,R5   5,B3
          2 000049  D945 0006                            CMR,R5   6,B5
          2 00004B  0901 0012                            BE       s:11035,PREL

      127    11024
      128    11025        /* We don't own this channel. */
      129    11026
      130    11027        /*E* ERROR:         KAO-E$ASN_BADCHNSTT */
      131    11028        /*E* MESSAGE:      Async handler got output interrupt for channel it doesn't own */
      132    11029        /*E* DESCRIPTION:   KH$CHN.SYSID doesn't match G$JIT.SYSID */
      133    11030    3            CALL KHD$ERRLOG_SETTERMID_CHN (FPT_WRSYSLOG_BADCHNSTT, %KH_CHN);

  11030   2 00004D  DFC7 0018                            STB,B5   Y@CRTEXCTIM+4,AUTO
          2 00004F  AB80 0000 0000  01                   LAB,B2   FPT_WRSYSLOG_BADCHNSTT
          2 000052  AFC7 0016                            STB,B2   Y@CRTEXCTIM+2,AUTO
          2 000054  BBC7 0016                            LAB,B3   Y@CRTEXCTIM+2,AUTO
          2 000056  CBF0 0200                            LAB,B4   512,IMO
          2 000058  E380 0000 0000  xent                 LNJ,B6   KHD$ERRLOG_SETTERMID_CHN
          2 00005B       0001                            DC       s:11031,PREL

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:17   
      134    11031    3         END; ELSE DO;

  11031   2 00005C  0F81 0042                            B        s:11079,PREL

      135    11032
      136    11033        /* THIS IS AN INTERRUPT FROM AN ASYNCHRONOUS LINE.                            */
      137    11034
      138    11035    4            IF (BCTX$ ~= ADDR(NIL)) THEN DO;

  11035   2 00005E  8DC7 000E                            CMN      BCTX$,AUTO
          2 000060  0901 003E                            BE       s:11079,PREL

      139    11036
      140    11037        /* THE CONTEXT POINTER  IS NON-NULL, INDICATING WE HAVE                */
      141    11038        /* A CONTEXT BLOCK ASSOCIATED WITH THIS LINE.                                 */
      142    11039
      143    11040    4               BCTX$->KA$CTX.OTPINTCNT = BCTX$->KA$CTX.OTPINTCNT+1;

  11040   2 000062  8AC4 000F                            INC      15,B4
          2 000064  8EC4 000E                            CAD      14,B4

      144    11041                    %KV$USRENT (VDI$=BCTX$->KA$CTX.VDI$,DFR$=Y@DFR,
      145    11042                    SCHRSN=%KV_SCHRSN_DFR0,STT=KV_STT);
             11055    4           KV_STT.USRENTCNT = KV_STT.USRENTCNT + 1;

  11055   2 000066  8A80 0000 0039  xsym                 INC      KV_STT+57
          2 000069  8E80 0000 0038  xsym                 CAD      KV_STT+56

             11056    5           IF NOT BCTX$->KA$CTX.VDI$->KV$VDI.BSY THEN DO;

  11056   2 00006C  AC84                                 LDB,B2   ,B4
          2 00006D  82C2 0019                            LB,'0080'X        25,B2
          2 00006F       0080
          2 000070  0501 0011                            BBT      s:11062,PREL

             11057    5              BCTX$->KA$CTX.VDI$->KV$VDI.BSY = '1'B;

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:18   
  11057   2 000072  8942 0019                            LBT,'0080'X       25,B2
  11057   2 000074       0080

             11058    5              KV@USRENT.SVDPTR$ = KV$PTR$;

  11058   2 000075  AC80 0000 0000  xsym                 LDB,B2   KV$PTR$
          2 000078  AFC7 0010                            STB,B2   KV@USRENT,AUTO

             11059    5              KV$PTR$ = BCTX$->KA$CTX.VDI$->KV$VDI.ASNINPPTR$;

  11059   2 00007A  9C84                                 LDB,B1   ,B4
          2 00007B  ECC1 0006                            LDB,B6   6,B1
          2 00007D  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

             11060    5              END;                         /* ELSE IF ~BSY                       */

  11060   2 000080  0F81 000C                            B        s:11068,PREL

             11061    5           ELSE DO;

             11062    5              BCTX$->KA$CTX.VDI$->KV$VDI.DFR.USR(0) = '1'B;

  11062   2 000082  8942 0018                            LBT,'8000'X       24,B2
  11062   2 000084       8000

             11063    5           KV_STT.USRENTDFRCNT = KV_STT.USRENTDFRCNT + 1;

  11063   2 000085  8A80 0000 003B  xsym                 INC      KV_STT+59
          2 000088  8E80 0000 003A  xsym                 CAD      KV_STT+58

             11064    5              GOTO Y@DFR;

  11064   2 00008B  0F81 0013                            B        s:11079,PREL

             11065    5              END;                         /* END IF                             */
      146    11068    4               CALL KAO$OTPINT;

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:19   
  11068   2 00008D  CBF0 0000                            LAB,B4   0,IMO
          2 00008F  E380 0000 0000  xent                 LNJ,B6   KAO$OTPINT
          2 000092       0001                            DC       s:11075,PREL

      147    11069                    %KV$USREXT;
             11075    4           KV$PTR.VDI$->KV$VDI.BSY = '0'B;

  11075   2 000093  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 000096  DC86                                 LDB,B5   ,B6
          2 000097  8845 0019                            LBF,'0080'X       25,B5
          2 000099       0080

             11077    4           KV$PTR$ = KV@USRENT.SVDPTR$;

  11077   2 00009A  DCC7 0010                            LDB,B5   KV@USRENT,AUTO
          2 00009C  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

      148    11079    4   Y@DFR:   END /* IF */;

  11079   2                              Y@DFR           null
      149    11080    3         END /* IF */;

      150    11081    2      END /* IF */;

      151    11082
      152    11083    1      CALL KHC$XEQ2(Y@CRTEXCTIM);

  11083   2 00009F  EBC7 0014            Y@DFR           LAB,B6   Y@CRTEXCTIM,AUTO
          2 0000A1  EFC7 0016                            STB,B6   Y@CRTEXCTIM+2,AUTO
          2 0000A3  BBC7 0016                            LAB,B3   Y@CRTEXCTIM+2,AUTO
          2 0000A5  CBF0 0100                            LAB,B4   256,IMO
          2 0000A7  E380 0000 0000  xent                 LNJ,B6   KHC$XEQ2
          2 0000AA       0001                            DC       s:11084,PREL

      153    11084    1     KA_STT.KHSTT.OTPINTISATIM = KA_STT.KHSTT.OTPINTISATIM + Y@CRTEXCTIM - Y@SVDEXCTIM
             11084               ;

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:20   
  11084   2 0000AB  8C80 0000 001A  xsym                 LDI      KA_STT+26
          2 0000AE  8447 0014                            AID      Y@CRTEXCTIM,AUTO
          2 0000B0  84C7 0012                            SID      Y@SVDEXCTIM,AUTO
          2 0000B2  8D00 0000 001A  xsym                 SDI      KA_STT+26

      154    11085
      155    11086        /* DONE PROCESSING THIS INTERRUPT. GO TO SLEEP UNTIL THE NEXT.                */
      156    11087
      157    11088    1      IF KNH$QHDR.SCQ.IPTR=KNH$QHDR.SCQ.RPTR

  11088   2 0000B5  EC80 0000 0000  xsym                 LDB,B6   G$HAND_Q$
          2 0000B8  D846 0004                            LDR,R5   4,B6
          2 0000BA  D946 0005                            CMR,R5   5,B6
          2 0000BC  0981 0009                            BNE      s:11090,PREL

      158    11089    1      THEN CALL X6A_INTRET;

  11089   2 0000BE  CBF0 0000                            LAB,B4   0,IMO
          2 0000C0  E380 0000 0000  xent                 LNJ,B6   X6A_INTRET
          2 0000C3       0001                            DC       s:11089+6,PREL
          2 0000C4  0F81 000A                            B        s:11092,PREL

      159    11090    1      ELSE CALL X6A_INTRET(FPT_INTRET);    /* Only scan if needed                */

  11090   2 0000C6  BB80 0000 0002  03                   LAB,B3   +2
          2 0000C9  CBF0 0100                            LAB,B4   256,IMO
          2 0000CB  E380 0000 0000  xent                 LNJ,B6   X6A_INTRET
          2 0000CE       0001                            DC       s:11092,PREL

      160    11091
      161    11092    1   END KAO$OTP;

  11092   2 0000CF  C380 0000 0000  xent                 LNJ,B4   X6A_AARET
      162    11093
      163    11094        %EOD;

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:21   
--  Include file information  --

   G_HJIT_M.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   KA_PERR_C.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_INT.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KH_TRC_M.:E05TOU  is referenced.
   KH$TRC.:E05TOU  is referenced.
   KH_TRC.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:22   
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$OTP.
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:23   

 **** Variables and constants ****

  ****  Section 000  Data  KAO$OTP

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(112)   r     1 FPT_INTRET                 7-0-0/w STRC(336)   r     1 FPT_WRSYSLOG_INVINT

  ****  Section 001 RoData KAO$OTP

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(336)   r     1 FPT_WRSYSLOG_BADCHNSTT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     C-0-0/w PTR         r     1 BCHN$                      E-0-0/w PTR         r     1 BCTX$
    10-0-0/w STRC(32)    r     1 KV@USRENT                  B-0-0/w UBIN(16)    r     1 Y@CHN
    14-0-0/w UBIN(32)    r     1 Y@CRTEXCTIM               12-0-0/w UBIN(32)    r     1 Y@SVDEXCTIM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$HAND_Q$                  0-0-0/w PTR         r     1 G$JIT$
     0-0-0/w PTR         r     1 G$UHJIT$                   0-0-0/w STRC(2528)  r     1 KA_STT
     0-0-0/w UBIN(16)    r     1 KH_CHNHI                   0-0-0/w PTR         r     1 KH_CHNLOW$
     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(8960)  r     1 KV_STT

  ****  BASED and DCB variables  ****

PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:24   
  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(5616)  r     1 G$JIT                      0-0-0/w STRC(6480)  r     1 G$UHJIT
     0-0-0/w STRC(512)   r     1 KA$CTX                     0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w STRC(384)   r     1 KNH$QHDR                   0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KAO$OTP requires 210 words for executable code.
   Procedure KAO$OTP requires 26 words of local(AUTO) storage.
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:25   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:26   
          MINI XREF LISTING

BCHN$
     10867**DCL      4168--IMP-PTR 10978<<ASSIGN  10979>>ASSIGN  10979>>ASSIGN  10984>>ASSIGN  11023>>IF
     11030>>CALL
BCTX$
     10868**DCL     10984<<ASSIGN  11035>>IF      11040>>ASSIGN  11040>>ASSIGN  11056>>IF      11057>>ASSIGN
     11059>>ASSIGN  11062>>ASSIGN
FPT_INTRET
       213**DCL     11090<>CALL
FPT_INTRET.V
       217**DCL       215--DCLINIT
FPT_WRSYSLOG_BADCHNSTT
      6876**DCL     11030<>CALL
FPT_WRSYSLOG_BADCHNSTT.V
      6880**DCL      6878--DCLINIT
FPT_WRSYSLOG_BADCHNSTT.V.TERMID.TERM
      6945**DCL      6954--REDEF
FPT_WRSYSLOG_INVINT
      6971**DCL     10935<>CALL
FPT_WRSYSLOG_INVINT.V
      6975**DCL      6973--DCLINIT
FPT_WRSYSLOG_INVINT.V.TERMID.TERM
      7040**DCL      7049--REDEF
FPT_WRSYSLOG_INVINT.V.TERMID.TERM.CHANNEL
      7046**DCL     10934<<ASSIGN
G$HAND_Q$
      4632**DCL      4620--IMP-PTR 11088>>IF      11088>>IF
G$JIT.ERRLOG
      7670**DCL      7673--REDEF
G$JIT.JSUNIT
      7409**DCL      7410--REDEF
G$JIT.MCLS
      7408**DCL      7408--REDEF
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:27   
G$JIT.SYSID
      7398**DCL     11023>>IF
G$JIT.TMRZ
      7677**DCL      7678--REDEF
G$JIT.USER_EXTIME
      7401**DCL      7402--REDEF
G$JIT.USER_MEMTIME
      7404**DCL      7404--REDEF
G$JIT.USER_SVTIME
      7403**DCL      7403--REDEF
G$JIT$
      7740**DCL      7340--IMP-PTR 11023>>IF
G$UHJIT.ISA_USR
      9327**DCL      9622--REDEF
G$UHJIT.ISA_USR.DEV
      9349**DCL     10928>>ASSIGN
G$UHJIT.ISA_USR.P$$
      9402**DCL      9402--REDEF
G$UHJIT.TSA_CP.ISA.P$$
     10609**DCL     10609--REDEF
G$UHJIT.TSA_CP.P$$
     10480**DCL     10480--REDEF   10481--REDEF
G$UHJIT.TSA_DB.ISA.P$$
     10221**DCL     10221--REDEF
G$UHJIT.TSA_DB.P$$
     10092**DCL     10092--REDEF   10093--REDEF
G$UHJIT.TSA_RTT.P$$
     10855**DCL     10855--REDEF   10856--REDEF
G$UHJIT.TSA_USR.ISA.P$$
      9811**DCL      9811--REDEF
G$UHJIT.TSA_USR.P$$
      9682**DCL      9682--REDEF    9683--REDEF
G$UHJIT$
     10861**DCL      7904--IMP-PTR 10928>>ASSIGN
KA$CTX.HLTOTP
      6306**DCL      6308--REDEF
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:28   
KA$CTX.HLTOTPNXTBFR
      6310**DCL      6311--REDEF
KA$CTX.OTPINTCNT
      6223**DCL     11040<<ASSIGN  11040>>ASSIGN
KA$CTX.VDI$
      6218**DCL     11056>>IF      11057>>ASSIGN  11059>>ASSIGN  11062>>ASSIGN
KA$OTPBFR.HLTOTP
      6339**DCL      6340--REDEF
KAO$OTPINT
      7054**DCL-ENT 11068--CALL
KA_STT.KHSTT.OTPINTCNT
      6159**DCL     10980<<ASSIGN  10980>>ASSIGN
KA_STT.KHSTT.OTPINTISATIM
      6160**DCL     11084<<ASSIGN  11084>>ASSIGN
KA_STT.REQSTATS.DSPMSK
      6089**DCL      6095--REDEF
KA_STT.REQSTATS.SLCMSK
      6130**DCL      6137--REDEF
KH$CHN
      4168**DCL     10978--ASSIGN  11030<>CALL
KH$CHN.CTX$
      4238**DCL     10984>>ASSIGN
KH$CHN.INTCNT
      4244**DCL     10979<<ASSIGN  10979>>ASSIGN
KH$CHN.SYSID
      4201**DCL     11023>>IF
KH$CHN.TERMID.TERM
      4264**DCL      4273--REDEF
KHA$ERRLOG
      7055**DCL-ENT 10935--CALL
KHC$XEQ2
      7058**DCL-ENT 10926--CALL    11083--CALL
KHD$ERRLOG_SETTERMID_CHN
      7056**DCL-ENT 11030--CALL
KH_CHNHI
      4331**DCL      4332--REDEF   10929>>IF
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:29   
KH_CHNLOW
      4332**DCL      4333--REDEF
KH_CHNLOW$
      4331**DCL     10978>>ASSIGN
KNH$QHDR.RCQ
      4620**DCL      4620--REDEF
KNH$QHDR.SCQ.IPTR
      4621**DCL     11088>>IF
KNH$QHDR.SCQ.RPTR
      4621**DCL     11088>>IF
KV$PTR.INPCNDPND
      6450**DCL      6459--REDEF    6463--REDEF
KV$PTR.LINLST$
      6446**DCL      6447--REDEF
KV$PTR.VDI$
      6444**DCL     11075>>ASSIGN
KV$PTR$
      6438**DCL      6444--IMP-PTR 11058>>ASSIGN  11059<<ASSIGN  11075>>ASSIGN  11077<<ASSIGN
KV$SSN.REDRSPCNT
      6373**DCL      6374--REDEF
KV$STT.REQSTATS.DSPMSK
      5361**DCL      5367--REDEF
KV$STT.REQSTATS.SLCMSK
      5402**DCL      5409--REDEF
KV$VDI.ASNINPPTR$
      6488**DCL     11059>>ASSIGN
KV$VDI.BSY
      6522**DCL     11056>>IF      11057<<ASSIGN  11075<<ASSIGN
KV$VDI.DFR.USR
      6519**DCL     11062<<ASSIGN
KV@USRENT.SVDPTR$
     10887**DCL     11058<<ASSIGN  11077>>ASSIGN
KV_STT.REQSTATS.DSPMSK
      4967**DCL      4973--REDEF
KV_STT.REQSTATS.SLCMSK
      5008**DCL      5015--REDEF
PL6.E3A0      #001=KAO$OTP File=KAO$OTP.:E05TSI                                  TUE 07/29/97 23:56 Page:30   
KV_STT.USRENTCNT
      5077**DCL     11055<<ASSIGN  11055>>ASSIGN
KV_STT.USRENTDFRCNT
      5078**DCL     11063<<ASSIGN  11063>>ASSIGN
X6A_INTRET
      7059**DCL-ENT 11089--CALL    11090--CALL
Y@CHN
     10866**DCL     10928<<ASSIGN  10929>>IF      10934>>ASSIGN  10978>>ASSIGN
Y@CRTEXCTIM
     10896**DCL     11083<>CALL    11084>>ASSIGN
Y@DFR
     11079**LABEL   11064--GOTO
Y@SVDEXCTIM
     10892**DCL     10926<>CALL    11084>>ASSIGN

PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:31   
      164        1        /*T***********************************************************/
      165        2        /*T*                                                         */
      166        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      167        4        /*T*                                                         */
      168        5        /*T***********************************************************/
      169        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      170        7
      171        8
      172        9        KAO$OTPINT: PROC;
      173       10        %INCLUDE LCP_6;
      174      201        %INCLUDE KV$BPC;
      175      230        %INCLUDE KH$CHN;
      176      352        %KH$CHN (STCLASS="BASED(BCHN$)");       /*  CHANNEL TABLES ITEM DEFINITONS    */
      177      476        %EQU KH_CHN=CHARTEXT('KH$CHN');
      178      477        %INCLUDE KH_CHN;
      179      517        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      180      535        %INCLUDE KL_MACRO_C;                    /* For KA_STT/KV$STT                  */
      181     3887        %INCLUDE KL_AFCN_C;                     /* For KA_STT/KV$STT                  */
      182     3988        %INCLUDE K_ID_E;                        /* For KA_STT/KV$STT                  */
      183     4038        %K#ENTID_E;                             /* For KA_STT/KV$STT                  */
      184     4057        %K#LYRID_E;                             /* For KA_STT/KV$STT                  */
      185     4064        %INCLUDE KH$STT;                        /* For KA_STT                         */
      186     4094        %INCLUDE KV_ASCCHR_E;                   /*  EQU'S FOR ASCII CHR'S             */
      187     4231        %INCLUDE KV_GLBASM_E;
      188     4249 S      %INCLUDE KV_GLBCNS_E;
      189     4250        %KV_INPOPRX_E;
      190     4262        %KV_STRTYP_E;
      191     4300        %KV_VDH_FNC_E;
      192     4320        %KV_USR_FNC_E;
      193     4336        %KV_VDH_EVT_ID_E;
      194     4342
      195     4343 S      %INCLUDE KV$GLB;
      196     4344 S      %INCLUDE KV$GLBCTX;
      197     4345        %INCLUDE KA$GLB;
      198     4486        %INCLUDE KA_GLB;
      199     4563        %INCLUDE KA_GLB_E;
      200     4641        %KA_HLTOTP_E;
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:32   
      201     4650        %KA_MSC;
      202     4672        %KA_STT;
      203     5035        %INCLUDE KA_SCODE_C;
      204     5049 S      %INCLUDE KV$VDH;
      205     5050        %KA$CTX (STCLASS="BASED(BCTX$)");  /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      206     5174        %EQU KA_CTX=CHARTEXT('KA$CTX');
      207     5175        %KA$OTPBFR (STCLASS="BASED(Y@BFR$)");   /*  ASYNC output buffer               */
      208     5203 S      %INCLUDE KV$USR;
      209     5204        %INCLUDE KV_GLB_M;                      /*  VDH-user macros                   */
      210     5326        %INCLUDE KV_INT;
      211     5365 S      %INCLUDE KV$INT;
      212     5366        %INCLUDE KV_INT_M;                      /*  TRACE ROUTINES                    */
      213     5509        %INCLUDE GH_IOFNC_E;                    /*  IO FUNCTION CODES                 */
      214     5578        %INCLUDE KW_LCT_E;                      /*  MLCP LCT DEFINITIONS              */
      215     5933        %INCLUDE KW_ALCT_E;                     /*  MLCP ASYNC LCT DEFINITIONS        */
      216     6123        %KV$SSN;                                /*  VDH Session                       */
      217     6202    1   DCL KA_INT_LEV UBIN SYMREF;
      218     6203        %KV$PTR;                                /*  VDH Pointers, status              */
      219     6246        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      220     6317        %KV$TRNTBL;                             /*  VDH translate table               */
      221     6375        %KV$USR_EXTINPTRN;                      /*  VDI extended input translation    */
      222     6411        %INCLUDE KA_LCT_E;                 /*  MLCP ASYNC HANDLER LCT DEFINITIONS     */
      223     6535        %INCLUDE KH$IO;
      224     6782        %KH$IO(FPTN=KH_IO_INPCCBSTT,FNC=%GH#IO_INPCCBSTT,OTPCHN=YES,STCLASS=CONSTANT);
      225     6896        %KH$IO(FPTN=KH_IO_INPNXTCCBSTT,FNC=%GH#IO_INPNXTCCBSTT,OTPCHN=YES,STCLASS=CONSTANT);
      226     7010        %KH$IO(FPTN=KH_IO_INPRNG,FNC=%GH#IO_INPRNG,OTPCHN=YES,STCLASS=CONSTANT);
      227     7124        %KH$IOLD(FPTN=KH_IOLD,STCLASS=CONSTANT,OTPCHN=YES);
      228     7175        %KH$IO(FPTN=KH@IO_INPCCBSTT,FNC=%GH#IO_INPCCBSTT,OTPCHN=YES,STCLASS=AUTO);
      229     7289        %KH$IO(FPTN=KH@IO_INPNXTCCBSTT,FNC=%GH#IO_INPNXTCCBSTT,OTPCHN=YES,STCLASS=AUTO);
      230     7403        %KH$IO(FPTN=KH@IO_INPRNG,FNC=%GH#IO_INPRNG,OTPCHN=YES,STCLASS=AUTO);
      231     7517
      232     7518        %INCLUDE KA_PERR_C;
      233     7537 S      %INCLUDE GT_LCP6_M;
      234     7538        %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_IO_ERR, STCLASS = CONSTANT, FCG = KA, MID = O,
              7538            ERR = %E$ASN_IO_ERR, SEV = 3);
      235     7633
      236     7634        %VLP_SCODE (FPTN = Y_SCRIO_NAK, FCG = KA, MID = O, ERR# = %S$KA_IO_NAK, STCLASS =
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:33   
              7634            CONSTANT);
      237     7695        %INCLUDE KH_SCREECH_M;
      238     7706    1   DCL KHD$SCREECH ENTRY(1);
      239     7707
      240     7708
      241     7709    1   DCL KHI$IO_INP ENTRY(2) ALTRET;
      242     7710    1   DCL KAO$IOLD_OTP ENTRY;
      243     7711    1   DCL KAO$DLTOTP ENTRY(1);
      244     7712    1   DCL KAO$MRK ENTRY(1);
      245     7713    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY(2) ALTRET;
      246     7714    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      247     7715    1   DCL KHI$DISABLE ENTRY(1);
      248     7716    1   DCL KHI$ENABLE ENTRY;
      249     7717
      250     7718
      251     7719        %KV$VDH_EVT(ID = KV_VDH_EVT_ID_CMPOTP,
      252     7720         NAME = KV_VDH_EVT_CMPOTP,
      253     7721         STCLASS = SYMREF);
      254     7756        %KV$VDH_EVT(ID = KV_VDH_EVT_ID_RLSVDI,
      255     7757         NAME = KV_VDH_EVT_RLSVDI,
      256     7758         STCLASS = SYMREF);
      257     7793    1   DCL KVV$VDI ENTRY(1) ALTRET;            /* USED IN KV$CMPOTP                  */
      258     7794        %KV$VDH_EVT(ID = KV_VDH_EVT_ID_RQSOTP,
      259     7795         NAME = KV_VDH_EVT_RQSOTP,
      260     7796         STCLASS = SYMREF);
      261     7831        %KV$USR_EVT(NAME = Y@USR_EVT, STCLASS = AUTO);
      262     7866
      263     7867    1   DCL KVI$RE_DSPINP ENTRY;
      264     7868
      265     7869
      266     7870
      267     7871    1   DCL LVL UBIN;
      268     7872    1   DCL Y@BYTSIZ UBIN WORD;
      269     7873    1   DCL Y@WRDSIZ UBIN WORD BASED(Y@BFR$) ALIGNED;
      270     7874    1   DCL Y@BFR$ PTR;
      271     7875    1   DCL BCHN$ PTR;
      272     7876    1   DCL BCTX$ PTR;
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:34   
      273     7877
      274     7878    1   DCL Y_POWER_OF_2(0:15) UBIN WORD CONSTANT INIT(1,2,4,8,16,32,64,128,256,
      275     7879    1    512,1024,2048,4096,8192,16384,32764);
      276     7880
      277     7881    1      BCHN$ = %KV_VDI.CHN$;
      278     7882    1      BCTX$ = %KH_CHN.CTX$;
      279     7883    2   LOOP: DO WHILE ('1'B);                  /* LOOP START                         */
      280     7884
      281     7885        /* THIS LOOP IS TRAVERSED ONCE FOR EACH                                       */
      282     7886        /* OUTPUT BUFFER PROCESSED.                                                   */
      283     7887
      284     7888    2         Y@BFR$ = %KA_CTX.OTPBFRHED$;
      285     7889    3         IF %KH_CHN.OTPCCBCNT~=0 AND KA$OTPBFR.BYTCNT~=0 THEN DO;
      286     7890
      287     7891        /* We are expecting some output interrupts, as the output CCB                 */
      288     7892        /* count is non-zero.                                                         */
      289     7893
      290     7894        /* INPUT CCB STATUS                                                           */
      291     7895
      292     7896    3            KH@IO_INPCCBSTT = KH_IO_INPCCBSTT;
      293     7897    4            CALL KHI$IO_INP(%KH_CHN,KH@IO_INPCCBSTT) WHENALTRETURN DO;
      294     7898
      295     7899        /* THE IO (INPUT CCB STATUS) FAILED.                                          */
      296     7900
      297     7901        /*S* SCREECH_CODE: KAO-S$KA_IO_NAK
      298     7902             MESSAGE: Irrecoverable IO NAK  */
      299     7903                    %KH$SCREECH (COD = Y_SCRIO_NAK);
      300     7907    4            END /* WHENALTRETURN */;
      301     7908
      302     7909        /* EXIT IF STATUS NOT COMPLETE                                                */
      303     7910
      304     7911    4            IF (NOT KH@IO_INPCCBSTT.CCBSTT.CCBSTTCMP) THEN DO;
      305     7912    4               EXIT LOOP;                  /* LOOK BELOW                         */
      306     7913    4            END /* IF */;
      307     7914        /*E* ERROR:         KAO-E$ASN_IO_ERR */
      308     7915        /*E* MESSAGE:       IO error (bad CCB status) */
      309     7916        /*E* DESCRIPTION:   The CCB status indicated an IO error occurred. */
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:35   
      310     7917                 %KAC$CLCERRCHK(CCBSTT=KH@IO_INPCCBSTT.CCBSTT,
      311     7918                 CCBSRVERR=YES,
      312     7919                 DATCHKERR=YES,
      313     7920                 INVMMRADR=YES,
      314     7921                 BUSPRTERR=YES,
      315     7922                 UN_CRCMMRERR=YES);
      316     7928
      317     7929    4            IF KH@IO_INPCCBSTT.CCBSTT.PRG.BIT1 THEN DO;
      318     7930
      319     7931        /* This buffer was terminated prematurely.  Find out where. */
      320     7932
      321     7933    4               KH@IO_INPRNG = KH_IO_INPRNG;
      322     7934    4               CALL KHI$IO_INP(%KH_CHN, KH@IO_INPRNG);
      323     7935    4               KA$OTPBFR.BYTCNT = KA$OTPBFR.BYTCNT-KH@IO_INPRNG.RNG;
      324     7936    4            END;
      325     7937    3            ELSE KH@IO_INPRNG.RNG = 0;
      326     7938    3            %KH_CHN.OTPCCBCNT = %KH_CHN.OTPCCBCNT - 1;
      327     7939    4            IF (%KH_CHN.OTPCCBCNT > 0) THEN DO;
      328     7940
      329     7941        /* WE STILL HAVE AT LEAST 1 OUTPUT CCB IN USE,                                */
      330     7942        /* SO WE'LL DO AN IO (INPUT NEXT CCB STATUS) TO                               */
      331     7943        /* ADVANCE THE STATUS POINTER TO THE NEXT                                     */
      332     7944        /* IN-USE CCB.                                                                */
      333     7945
      334     7946    4               KH@IO_INPNXTCCBSTT = KH_IO_INPNXTCCBSTT;
      335     7947    5               CALL KHI$IO_INP(%KH_CHN,KH@IO_INPNXTCCBSTT) WHENALTRETURN DO;
      336     7948
      337     7949        /* THE IO (INPUT NEXT CCB STATUS) FAILED.
              7949        */
      338     7950
      339     7951        /*N* **** > NEED RECOVERY < ****                                                */
      340     7952                       %KH$SCREECH (COD = Y_SCRIO_NAK);
      341     7956    5               END /* WHENALTRETURN */;
      342     7957
      343     7958    4            END; ELSE DO;
      344     7959
      345     7960        /* THE STATUS POINTER WOULD CATCH THE LOAD POINTER                            */
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:36   
      346     7961        /* IN THE COMMUNICATIONS LINE CONTROLLER HARDWARE                             */
      347     7962        /* IF WE DID THE IO (INPUT NEXT CCB STATUS) NOW,                              */
      348     7963        /* SO WE HAVE TO WAIT TO DO IT. KAO$IOLD_OTP WILL                             */
      349     7964        /* DO IT AFTER IOLD'ING THE NEXT OUTPUT BUFFER.                               */
      350     7965
      351     7966    4               %KH_CHN.OTPCCBSTTPTRVLD = '0'B;
      352     7967    4               %KA_CTX.DLTOTPPND = '0'B;
      353     7968    4            END /* IF */;
      354     7969    3         END /* IF */;
      355     7970    2         ELSE IF Y@BFR$=ADDR(NIL)
      356     7971    2           OR Y@BFR$=%KA_CTX.OTPBFRNXTLOD$
      357     7972    2           OR Y@BFR$=%KV_VDI.OTPBFR_.ADR$ THEN EXIT LOOP;
      358     7973    2         ELSE KH@IO_INPRNG.RNG = 0;
      359     7974
      360     7975        /* WE HAVE A CCB THAT HAS COMPLETED. RELEASE THE ASSOCIATED BUFFER            */
      361     7976
      362     7977    2         %KA_CTX.OTPBFRHED$ = KA$OTPBFR.LNK$;
      363     7978    3         IF Y@BFR$=%KA_CTX.OTPBFRTAL$ THEN DO;
      364     7979
      365     7980        /* WE'RE RELEASING THE TAIL (LAST) BUFFER IN THE                              */
      366     7981        /* OUTPUT CHAIN.                                                              */
      367     7982
      368     7983    3            %KA_CTX.OTPBFRTAL$ = ADDR(NIL);
      369     7984    3            %KA_CTX.HLTOTP_ALL = %KA_CTX.HLTOTPNXTBFR_ALL|%KA_CTX.HLTOTP_ALL;
      370     7985    3            %KA_CTX.HLTOTPNXTBFR = '0'B;
      371     7986    3         END;
      372     7987
      373     7988
      374     7989    3         IF (KA$OTPBFR.NMBMRK > 0) THEN DO;
      375     7990    3            CALL KAO$MRK (KA$OTPBFR);
      376     7991    3         END;
      377     7992
      378     7993    2         LVL = KA_INT_LEV;
      379     7994        /*
      380     7995          If the current level is below the async inhibit level,
      381     7996          go to the async inhibit level.
      382     7997        */
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:37   
      383     7998    2         CALL KHI$DISABLE (LVL);
      384     7999
      385     8000    2         Y@BYTSIZ = Y_POWER_OF_2(Y@BFR$->KA$OTPBFR.BYTSIZLOG2);
      386     8001    2         Y@WRDSIZ = Y@BYTSIZ / 2;
      387     8002    2         %KA_CTX.OTPBFRBYTCNT = %KA_CTX.OTPBFRBYTCNT-Y@BYTSIZ;
      388     8003    2         CALL KVB$RLSSYS(Y@WRDSIZ);
      389     8004
      390     8005        /* Go back to the level we were at */
      391     8006
      392     8007    2         IF (LVL > KA_INT_LEV) THEN CALL KHI$ENABLE;
      393     8008
      394     8009    2         KA_STT.KHSTT.OTPBFRBYTUTL = KA_STT.KHSTT.OTPBFRBYTUTL - Y@BYTSIZ;
      395     8010
      396     8011    2      END LOOP ;
      397     8012    2      IF %KA_CTX.OTPBFRTAL$=ADDR(NIL) THEN DO;
      398     8013    2   KAO@CMPOTP:
      399     8014    3         IF %KV_VDI.RE_DSPINP THEN DO;
      400     8015
      401     8016        /* WE STOPPED ECHOING, RE-DISPLAY THE INPUT RECORD.                           */
      402     8017
      403     8018    3            CALL KVI$RE_DSPINP;
      404     8019    3            %KV_VDI.RE_DSPINP = '0'B;
      405     8020    3         END /* IF */;
      406     8021              %KV$CMPOTP;
              8026    3           IF KV$PTR.VDI$->KV$VDI.OTPCNDPND THEN DO;
              8027    3              CALL KVV$VDI(KV_VDH_EVT_CMPOTP);
              8028    3              END;                         /* END IF                             */
      407     8030    3         IF (%KH_CHN.OTPCCBCNT = 0) AND (%KA_CTX.OTPBFRBYTCNT ~= 0) THEN DO;
      408     8031    3            CALL KAO$IOLD_OTP ;
      409     8032    3         END /* IF */;
      410     8033    2      END; ELSE DO;
      411     8034
      412     8035        /* THIS ISN'T THE LAST BUFFER IN THE OUTPUT CHAIN.                            */
      413     8036
      414     8037    2         IF %KA_CTX.OTPBFRNXTLOD$~=ADDR(NIL) AND %KH_CHN.OTPCCBCNT<4
      415     8038    3           AND NOT %KA_CTX.HLTOTP THEN DO;
      416     8039    3            CALL KAO$IOLD_OTP ;
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:38   
      417     8040    3            IF %KH_CHN.OTPCCBCNT=0 AND NOT %KA_CTX.HLTOTP
      418     8041
      419     8042        /* NOTHING HAPPENNED, MUST HAVE GOT THE BFR FOR PENDING PST                   */
      420     8043
      421     8044    3            THEN GOTO KAO@CMPOTP;
      422     8045    3         END /* IF */;
      423     8046    2      END /* IF */;
      424     8047
      425     8048        /* CHECK TO SEE IF WE SHOULD UNBLOCK.                                         */
      426     8049
      427     8050    1      IF (%KA_CTX.OTPBFRBYTCNT <= KA_OTPUN_BLKLMT(%KV_VDI.LINSPD))
      428     8051    2        OR (%KA_CTX.OTPBFRHED$ = %KA_CTX.OTPBFRTAL$) THEN DO;
      429     8052
      430     8053        /* The output buffer byte count has fallen below the output                   */
      431     8054        /* block limit, or there is only one buffer. Request more output from VDH.    */
      432     8055
      433     8056              %KV$RQSOTP (RQSOTP=YES);
              8068    3           IF NOT KV$PTR.VDI$->KV$VDI.RQSOTP  THEN DO;
              8069    3              KV$PTR.VDI$->KV$VDI.RQSOTP = '1'B;
              8070    3              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);
              8071    3              END;                         /* END IF                             */
      434     8074    2      END /* IF */;
      435     8075    1      IF %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI)
      436     8076    2        AND %KH_CHN.OTPCCBCNT=0 AND NOT %KA_CTX.HLTOTP THEN DO;
      437     8077    2         CALL KAO$DLTOTP(Y@USR_EVT) ;
      438     8078
      439     8079        /* We are to report to VDH quiescence in ASYNC                                */
      440     8080        /* so we can complete the releasing of VDI.                                   */
      441     8081
      442     8082    2         CALL KVV$VDI(KV_VDH_EVT_RLSVDI) ;
      443     8083    2      END /* IF */;
      444     8084    1   END KAO$OTPINT;
      445     8085
      446     8086        %EOD;

PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:39   
--  Include file information  --

   KH_SCREECH_M.:E05TOU  is referenced.
   KA_PERR_C.:E05TOU  is referenced.
   KH$IO.:E05TOU  is referenced.
   KA_LCT_E.:E05TOU  is referenced.
   KW_ALCT_E.:E05TOU  is referenced.
   KW_LCT_E.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_INT.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KA_SCODE_C.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLBASM_E.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:40   
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$OTPINT.

   Procedure KAO$OTPINT requires 515 words for executable code.
   Procedure KAO$OTPINT requires 24 words of local(AUTO) storage.

PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:41   

 Object Unit name= KAO$OTPINT                                 File name= KAO$OTP.:E05TOU
 UTS= JUL 29 '97 23:57:34.96 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     51     33  KAO$OTPINT
    1   Proc  even  none   515    203  KAO$OTPINT
    2  RoData even  none     8      8  KAO$OTPINT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  KAO$OTPINT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KHI$IO_INP
 yes     yes           Std       2 KHD$ERRLOG_SETTERMID_CHN
         yes           Std       0 KHI$ENABLE
         yes           Std       0 KAO$IOLD_OTP
         yes           Std       1 KHD$SCREECH
         yes           Std       1 KAO$MRK
         yes           Std       1 KHI$DISABLE
         yes           Std       1 KAO$DLTOTP
 yes     yes           Std       2 KVB$RLSSYS
         yes           Std       0 KVI$RE_DSPINP
 yes     yes           Std       1 KVV$VDI
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:42   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNHI                         r    KH_CHNLOW                             KA_OTPUN_BLKLMT
     KA_STT                                KA_INT_LEV                            KV$PTR$
     KV_VDH_EVT_CMPOTP                     KV_VDH_EVT_RLSVDI                     KV_VDH_EVT_RQSOTP
r    G$ROS$
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:43   


      164        1        /*T***********************************************************/
      165        2        /*T*                                                         */
      166        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      167        4        /*T*                                                         */
      168        5        /*T***********************************************************/
      169        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      170        7
      171        8
      172        9        KAO$OTPINT: PROC;

      9   1 000000  D380 0000 0000  xent KAO$OTPINT      LNJ,B5   X6A_AUTO_0
          1 000003       0018 0000                       DC       24,0

      173       10        %INCLUDE LCP_6;
      174      201        %INCLUDE KV$BPC;
      175      230        %INCLUDE KH$CHN;
      176      352        %KH$CHN (STCLASS="BASED(BCHN$)");       /*  CHANNEL TABLES ITEM DEFINITONS    */
      177      476        %EQU KH_CHN=CHARTEXT('KH$CHN');
      178      477        %INCLUDE KH_CHN;
      179      517        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      180      535        %INCLUDE KL_MACRO_C;                    /* For KA_STT/KV$STT                  */
      181     3887        %INCLUDE KL_AFCN_C;                     /* For KA_STT/KV$STT                  */
      182     3988        %INCLUDE K_ID_E;                        /* For KA_STT/KV$STT                  */
      183     4038        %K#ENTID_E;                             /* For KA_STT/KV$STT                  */
      184     4057        %K#LYRID_E;                             /* For KA_STT/KV$STT                  */
      185     4064        %INCLUDE KH$STT;                        /* For KA_STT                         */
      186     4094        %INCLUDE KV_ASCCHR_E;                   /*  EQU'S FOR ASCII CHR'S             */
      187     4231        %INCLUDE KV_GLBASM_E;
      188     4249 S      %INCLUDE KV_GLBCNS_E;
      189     4250        %KV_INPOPRX_E;
      190     4262        %KV_STRTYP_E;
      191     4300        %KV_VDH_FNC_E;
      192     4320        %KV_USR_FNC_E;
      193     4336        %KV_VDH_EVT_ID_E;
      194     4342
      195     4343 S      %INCLUDE KV$GLB;
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:44   
      196     4344 S      %INCLUDE KV$GLBCTX;
      197     4345        %INCLUDE KA$GLB;
      198     4486        %INCLUDE KA_GLB;
      199     4563        %INCLUDE KA_GLB_E;
      200     4641        %KA_HLTOTP_E;
      201     4650        %KA_MSC;
      202     4672        %KA_STT;
      203     5035        %INCLUDE KA_SCODE_C;
      204     5049 S      %INCLUDE KV$VDH;
      205     5050        %KA$CTX (STCLASS="BASED(BCTX$)");  /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      206     5174        %EQU KA_CTX=CHARTEXT('KA$CTX');
      207     5175        %KA$OTPBFR (STCLASS="BASED(Y@BFR$)");   /*  ASYNC output buffer               */
      208     5203 S      %INCLUDE KV$USR;
      209     5204        %INCLUDE KV_GLB_M;                      /*  VDH-user macros                   */
      210     5326        %INCLUDE KV_INT;
      211     5365 S      %INCLUDE KV$INT;
      212     5366        %INCLUDE KV_INT_M;                      /*  TRACE ROUTINES                    */
      213     5509        %INCLUDE GH_IOFNC_E;                    /*  IO FUNCTION CODES                 */
      214     5578        %INCLUDE KW_LCT_E;                      /*  MLCP LCT DEFINITIONS              */
      215     5933        %INCLUDE KW_ALCT_E;                     /*  MLCP ASYNC LCT DEFINITIONS        */
      216     6123        %KV$SSN;                                /*  VDH Session                       */
      217     6202    1   DCL KA_INT_LEV UBIN SYMREF;
      218     6203        %KV$PTR;                                /*  VDH Pointers, status              */
      219     6246        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      220     6317        %KV$TRNTBL;                             /*  VDH translate table               */
      221     6375        %KV$USR_EXTINPTRN;                      /*  VDI extended input translation    */
      222     6411        %INCLUDE KA_LCT_E;                 /*  MLCP ASYNC HANDLER LCT DEFINITIONS     */
      223     6535        %INCLUDE KH$IO;
      224     6782        %KH$IO(FPTN=KH_IO_INPCCBSTT,FNC=%GH#IO_INPCCBSTT,OTPCHN=YES,STCLASS=CONSTANT);
      225     6896       %KH$IO(FPTN=KH_IO_INPNXTCCBSTT,FNC=%GH#IO_INPNXTCCBSTT,OTPCHN=YES,STCLASS=CONSTANT);
      226     7010        %KH$IO(FPTN=KH_IO_INPRNG,FNC=%GH#IO_INPRNG,OTPCHN=YES,STCLASS=CONSTANT);
      227     7124        %KH$IOLD(FPTN=KH_IOLD,STCLASS=CONSTANT,OTPCHN=YES);
      228     7175        %KH$IO(FPTN=KH@IO_INPCCBSTT,FNC=%GH#IO_INPCCBSTT,OTPCHN=YES,STCLASS=AUTO);
      229     7289        %KH$IO(FPTN=KH@IO_INPNXTCCBSTT,FNC=%GH#IO_INPNXTCCBSTT,OTPCHN=YES,STCLASS=AUTO);
      230     7403        %KH$IO(FPTN=KH@IO_INPRNG,FNC=%GH#IO_INPRNG,OTPCHN=YES,STCLASS=AUTO);
      231     7517
      232     7518        %INCLUDE KA_PERR_C;
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:45   
      233     7537 S      %INCLUDE GT_LCP6_M;
      234     7538        %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_IO_ERR, STCLASS = CONSTANT, FCG = KA, MID = O,
              7538            ERR = %E$ASN_IO_ERR, SEV = 3);
      235     7633
      236     7634        %VLP_SCODE (FPTN = Y_SCRIO_NAK, FCG = KA, MID = O, ERR# = %S$KA_IO_NAK, STCLASS =
              7634            CONSTANT);
      237     7695        %INCLUDE KH_SCREECH_M;
      238     7706    1   DCL KHD$SCREECH ENTRY(1);
      239     7707
      240     7708
      241     7709    1   DCL KHI$IO_INP ENTRY(2) ALTRET;
      242     7710    1   DCL KAO$IOLD_OTP ENTRY;
      243     7711    1   DCL KAO$DLTOTP ENTRY(1);
      244     7712    1   DCL KAO$MRK ENTRY(1);
      245     7713    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY(2) ALTRET;
      246     7714    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      247     7715    1   DCL KHI$DISABLE ENTRY(1);
      248     7716    1   DCL KHI$ENABLE ENTRY;
      249     7717
      250     7718
      251     7719        %KV$VDH_EVT(ID = KV_VDH_EVT_ID_CMPOTP,
      252     7720         NAME = KV_VDH_EVT_CMPOTP,
      253     7721         STCLASS = SYMREF);
      254     7756        %KV$VDH_EVT(ID = KV_VDH_EVT_ID_RLSVDI,
      255     7757         NAME = KV_VDH_EVT_RLSVDI,
      256     7758         STCLASS = SYMREF);
      257     7793    1   DCL KVV$VDI ENTRY(1) ALTRET;            /* USED IN KV$CMPOTP                  */
      258     7794        %KV$VDH_EVT(ID = KV_VDH_EVT_ID_RQSOTP,
      259     7795         NAME = KV_VDH_EVT_RQSOTP,
      260     7796         STCLASS = SYMREF);
      261     7831        %KV$USR_EVT(NAME = Y@USR_EVT, STCLASS = AUTO);
      262     7866
      263     7867    1   DCL KVI$RE_DSPINP ENTRY;
      264     7868
      265     7869
      266     7870
      267     7871    1   DCL LVL UBIN;
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:46   
      268     7872    1   DCL Y@BYTSIZ UBIN WORD;
      269     7873    1   DCL Y@WRDSIZ UBIN WORD BASED(Y@BFR$) ALIGNED;
      270     7874    1   DCL Y@BFR$ PTR;
      271     7875    1   DCL BCHN$ PTR;
      272     7876    1   DCL BCTX$ PTR;
      273     7877
      274     7878    1   DCL Y_POWER_OF_2(0:15) UBIN WORD CONSTANT INIT(1,2,4,8,16,32,64,128,256,
      275     7879    1    512,1024,2048,4096,8192,16384,32764);
      276     7880
      277     7881    1      BCHN$ = %KV_VDI.CHN$;

   7881   1 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000008  DC86                                 LDB,B5   ,B6
          1 000009  CC85                                 LDB,B4   ,B5
          1 00000A  CFC7 0010                            STB,B4   BCHN$,AUTO

      278     7882    1      BCTX$ = %KH_CHN.CTX$;

   7882   1 00000C  BCC4 000C                            LDB,B3   12,B4
          1 00000E  BFC7 0012                            STB,B3   BCTX$,AUTO

      279     7883    2   LOOP: DO WHILE ('1'B);                  /* LOOP START                         */

   7883   1                              LOOP            null
      280     7884
      281     7885        /* THIS LOOP IS TRAVERSED ONCE FOR EACH                                       */
      282     7886        /* OUTPUT BUFFER PROCESSED.                                                   */
      283     7887
      284     7888    2         Y@BFR$ = %KA_CTX.OTPBFRHED$;

   7888   1 000010  ECC7 0012            LOOP            LDB,B6   BCTX$,AUTO
          1 000012  DCC6 0002                            LDB,B5   2,B6
          1 000014  DFC7 000E                            STB,B5   Y@BFR$,AUTO

      285     7889    3         IF %KH_CHN.OTPCCBCNT~=0 AND KA$OTPBFR.BYTCNT~=0 THEN DO;

   7889   1 000016  CCC7 0010                            LDB,B4   BCHN$,AUTO
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:47   
          1 000018  82C4 0007                            LB,'000F'X        7,B4
          1 00001A       000F
          1 00001B  0581 00A3                            BBF      s:7970,PREL
          1 00001D  82C5 0002                            LB,'03FF'X        2,B5
          1 00001F       03FF
          1 000020  0581 009E                            BBF      s:7970,PREL

      286     7890
      287     7891        /* We are expecting some output interrupts, as the output CCB                 */
      288     7892        /* count is non-zero.                                                         */
      289     7893
      290     7894        /* INPUT CCB STATUS                                                           */
      291     7895
      292     7896    3            KH@IO_INPCCBSTT = KH_IO_INPCCBSTT;

   7896   1 000022  8C80 0000 0000  00                   LDI      KH_IO_INPCCBSTT
          1 000025  8D47 0004                            SDI      KH@IO_INPCCBSTT,AUTO

      293     7897    4            CALL KHI$IO_INP(%KH_CHN,KH@IO_INPCCBSTT) WHENALTRETURN DO;

   7897   1 000027  BBC7 0004                            LAB,B3   KH@IO_INPCCBSTT,AUTO
          1 000029  BFC7 0016                            STB,B3   BCTX$+4,AUTO
          1 00002B  CFC7 0014                            STB,B4   BCTX$+2,AUTO
          1 00002D  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 00002F  CBF0 0200                            LAB,B4   512,IMO
          1 000031  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 000034       0003                            DC       s:7905,PREL
          1 000035  0F81 000A                            B        s:7911,PREL

      294     7898
      295     7899        /* THE IO (INPUT CCB STATUS) FAILED.                                          */
      296     7900
      297     7901        /*S* SCREECH_CODE: KAO-S$KA_IO_NAK
      298     7902             MESSAGE: Irrecoverable IO NAK  */
      299     7903                    %KH$SCREECH (COD = Y_SCRIO_NAK);

   7905   1 000037  BB80 0000 0000  02                   LAB,B3   0
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:48   
          1 00003A  CBF0 0100                            LAB,B4   256,IMO
          1 00003C  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 00003F       0001                            DC       s:7911,PREL

      300     7907    4            END /* WHENALTRETURN */;

      301     7908
      302     7909        /* EXIT IF STATUS NOT COMPLETE                                                */
      303     7910
      304     7911    4            IF (NOT KH@IO_INPCCBSTT.CCBSTT.CCBSTTCMP) THEN DO;

   7911   1 000040  82C7 0005                            LB,'1000'X        KH@IO_INPCCBSTT+1,AUTO
   7911   1 000042       1000
          1 000043  0501 0003                            BBT      s:7926,PREL

      305     7912    4               EXIT LOOP;                  /* LOOK BELOW                         */

   7912   1 000045  0F81 0103                            B        s:8012,PREL

      306     7913    4            END /* IF */;
      307     7914        /*E* ERROR:         KAO-E$ASN_IO_ERR */
      308     7915        /*E* MESSAGE:       IO error (bad CCB status) */
      309     7916        /*E* DESCRIPTION:   The CCB status indicated an IO error occurred. */
      310     7917                 %KAC$CLCERRCHK(CCBSTT=KH@IO_INPCCBSTT.CCBSTT,
      311     7918                 CCBSRVERR=YES,
      312     7919                 DATCHKERR=YES,
      313     7920                 INVMMRADR=YES,
      314     7921                 BUSPRTERR=YES,
      315     7922                 UN_CRCMMRERR=YES);

   7926   1 000047  E847 0005                            LDR,R6   KH@IO_INPCCBSTT+1,AUTO
          1 000049  E570 0847                            AND,R6   2119,IMO
          1 00004B  6901 0012                            BEZ,R6   s:7929,PREL

   7926   1 00004D  ECC7 0010                            LDB,B6   BCHN$,AUTO
          1 00004F  EFC7 0016                            STB,B6   BCTX$+4,AUTO
          1 000051  DB80 0000 000B  00                   LAB,B5   FPT_WRSYSLOG_IO_ERR
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:49   
          1 000054  DFC7 0014                            STB,B5   BCTX$+2,AUTO
          1 000056  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 000058  CBF0 0200                            LAB,B4   512,IMO
          1 00005A  E380 0000 0000  xent                 LNJ,B6   KHD$ERRLOG_SETTERMID_CHN
          1 00005D       0001                            DC       s:7929,PREL

      316     7928
      317     7929    4            IF KH@IO_INPCCBSTT.CCBSTT.PRG.BIT1 THEN DO;

   7929   1 00005E  82C7 0005                            LB,'0400'X        KH@IO_INPCCBSTT+1,AUTO
   7929   1 000060       0400
          1 000061  0581 0023                            BBF      s:7937,PREL

      318     7930
      319     7931        /* This buffer was terminated prematurely.  Find out where. */
      320     7932
      321     7933    4               KH@IO_INPRNG = KH_IO_INPRNG;

   7933   1 000063  8C80 0000 0004  00                   LDI      KH_IO_INPRNG
          1 000066  8D47 0008                            SDI      KH@IO_INPRNG,AUTO

      322     7934    4               CALL KHI$IO_INP(%KH_CHN, KH@IO_INPRNG);

   7934   1 000068  EBC7 0008                            LAB,B6   KH@IO_INPRNG,AUTO
          1 00006A  EFC7 0016                            STB,B6   BCTX$+4,AUTO
          1 00006C  DCC7 0010                            LDB,B5   BCHN$,AUTO
          1 00006E  DFC7 0014                            STB,B5   BCTX$+2,AUTO
          1 000070  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 000072  CBF0 0200                            LAB,B4   512,IMO
          1 000074  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 000077       0001                            DC       s:7935,PREL

      323     7935    4               KA$OTPBFR.BYTCNT = KA$OTPBFR.BYTCNT-KH@IO_INPRNG.RNG;

   7935   1 000078  ECC7 000E                            LDB,B6   Y@BFR$,AUTO
          1 00007A  E846 0002                            LDR,R6   2,B6
          1 00007C  E570 03FF                            AND,R6   1023,IMO
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:50   
          1 00007E  E247 0009                            SUB,R6   KH@IO_INPRNG+1,AUTO
          1 000080  EAC6 0002                            SRM,R6,'03FF'X    2,B6
          1 000082       03FF

      324     7936    4            END;

   7936   1 000083  0F81 0003                            B        s:7938,PREL

      325     7937    3            ELSE KH@IO_INPRNG.RNG = 0;

   7937   1 000085  8747 0009                            CL       KH@IO_INPRNG+1,AUTO

      326     7938    3            %KH_CHN.OTPCCBCNT = %KH_CHN.OTPCCBCNT - 1;

   7938   1 000087  ECC7 0010                            LDB,B6   BCHN$,AUTO
          1 000089  E846 0007                            LDR,R6   7,B6
          1 00008B  EA70 000F                            ADD,R6   15,IMO
          1 00008D  EAC6 0007                            SRM,R6,'000F'X    7,B6
          1 00008F       000F

      327     7939    4            IF (%KH_CHN.OTPCCBCNT > 0) THEN DO;

   7939   1 000090  82C6 0007                            LB,'000F'X        7,B6
   7939   1 000092       000F
          1 000093  0581 0021                            BBF      s:7966,PREL

      328     7940
      329     7941        /* WE STILL HAVE AT LEAST 1 OUTPUT CCB IN USE,                                */
      330     7942        /* SO WE'LL DO AN IO (INPUT NEXT CCB STATUS) TO                               */
      331     7943        /* ADVANCE THE STATUS POINTER TO THE NEXT                                     */
      332     7944        /* IN-USE CCB.                                                                */
      333     7945
      334     7946    4               KH@IO_INPNXTCCBSTT = KH_IO_INPNXTCCBSTT;

   7946   1 000095  8C80 0000 0002  00                   LDI      KH_IO_INPNXTCCBSTT
          1 000098  8D47 0006                            SDI      KH@IO_INPNXTCCBSTT,AUTO

PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:51   
      335     7947    5               CALL KHI$IO_INP(%KH_CHN,KH@IO_INPNXTCCBSTT) WHENALTRETURN DO;

   7947   1 00009A  DBC7 0006                            LAB,B5   KH@IO_INPNXTCCBSTT,AUTO
          1 00009C  DFC7 0016                            STB,B5   BCTX$+4,AUTO
          1 00009E  EFC7 0014                            STB,B6   BCTX$+2,AUTO
          1 0000A0  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 0000A2  CBF0 0200                            LAB,B4   512,IMO
          1 0000A4  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 0000A7       0003                            DC       s:7954,PREL
          1 0000A8  0F81 000A                            B        s:7958,PREL

      336     7948
      337     7949        /* THE IO (INPUT NEXT CCB STATUS) FAILED.
              7949        */
      338     7950
      339     7951        /*N* **** > NEED RECOVERY < ****                                                */
      340     7952                       %KH$SCREECH (COD = Y_SCRIO_NAK);

   7954   1 0000AA  BB80 0000 0000  02                   LAB,B3   0
          1 0000AD  CBF0 0100                            LAB,B4   256,IMO
          1 0000AF  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 0000B2       0001                            DC       s:7958,PREL

      341     7956    5               END /* WHENALTRETURN */;

      342     7957
      343     7958    4            END; ELSE DO;

   7958   1 0000B3  0F81 001D                            B        s:7977,PREL

      344     7959
      345     7960        /* THE STATUS POINTER WOULD CATCH THE LOAD POINTER                            */
      346     7961        /* IN THE COMMUNICATIONS LINE CONTROLLER HARDWARE                             */
      347     7962        /* IF WE DID THE IO (INPUT NEXT CCB STATUS) NOW,                              */
      348     7963        /* SO WE HAVE TO WAIT TO DO IT. KAO$IOLD_OTP WILL                             */
      349     7964        /* DO IT AFTER IOLD'ING THE NEXT OUTPUT BUFFER.                               */
      350     7965
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:52   
      351     7966    4               %KH_CHN.OTPCCBSTTPTRVLD = '0'B;

   7966   1 0000B5  8846 0008                            LBF,'0040'X       8,B6
   7966   1 0000B7       0040

      352     7967    4               %KA_CTX.DLTOTPPND = '0'B;

   7967   1 0000B8  DCC7 0012                            LDB,B5   BCTX$,AUTO
          1 0000BA  8845 001D                            LBF,'0400'X       29,B5
          1 0000BC       0400

      353     7968    4            END /* IF */;

      354     7969    3         END /* IF */;

   7969   1 0000BD  0F81 0013                            B        s:7977,PREL

      355     7970    2         ELSE IF Y@BFR$=ADDR(NIL)

   7970   1 0000BF  8DC7 000E                            CMN      Y@BFR$,AUTO
          1 0000C1  0901 0087                            BE       s:8012,PREL
          1 0000C3  DDC6 0004                            CMB,B5   4,B6
          1 0000C5  0901 0083                            BE       s:8012,PREL
          1 0000C7  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0000CA  AC83                                 LDB,B2   ,B3
          1 0000CB  DDC2 000A                            CMB,B5   10,B2
          1 0000CD  0901 007B                            BE       s:8012,PREL

      356     7971    2           OR Y@BFR$=%KA_CTX.OTPBFRNXTLOD$
      357     7972    2           OR Y@BFR$=%KV_VDI.OTPBFR_.ADR$ THEN EXIT LOOP;
      358     7973    2         ELSE KH@IO_INPRNG.RNG = 0;

   7973   1 0000CF  8747 0009                            CL       KH@IO_INPRNG+1,AUTO

      359     7974
      360     7975        /* WE HAVE A CCB THAT HAS COMPLETED. RELEASE THE ASSOCIATED BUFFER            */
      361     7976
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:53   
      362     7977    2         %KA_CTX.OTPBFRHED$ = KA$OTPBFR.LNK$;

   7977   1 0000D1  ECC7 000E                            LDB,B6   Y@BFR$,AUTO
          1 0000D3  DC86                                 LDB,B5   ,B6
          1 0000D4  CCC7 0012                            LDB,B4   BCTX$,AUTO
          1 0000D6  DFC4 0002                            STB,B5   2,B4

      363     7978    3         IF Y@BFR$=%KA_CTX.OTPBFRTAL$ THEN DO;

   7978   1 0000D8  EDC4 0006                            CMB,B6   6,B4
          1 0000DA  0981 0015                            BNE      s:7989,PREL

      364     7979
      365     7980        /* WE'RE RELEASING THE TAIL (LAST) BUFFER IN THE                              */
      366     7981        /* OUTPUT CHAIN.                                                              */
      367     7982
      368     7983    3            %KA_CTX.OTPBFRTAL$ = ADDR(NIL);

   7983   1 0000DC  BB80 0000 0000                       LAB,B3   0
          1 0000DF  BFC4 0006                            STB,B3   6,B4

      369     7984    3            %KA_CTX.HLTOTP_ALL = %KA_CTX.HLTOTPNXTBFR_ALL|%KA_CTX.HLTOTP_ALL;

   7984   1 0000E1  E844 001D                            LDR,R6   29,B4
          1 0000E3  E570 C000                            AND,R6   -16384,IMO
          1 0000E5  D844 001C                            LDR,R5   28,B4
          1 0000E7  D570 C000                            AND,R5   -16384,IMO
          1 0000E9  E455                                 OR,R6    R5
          1 0000EA  EAC4 001C                            SRM,R6,'C000'X    28,B4
          1 0000EC       C000

      370     7985    3            %KA_CTX.HLTOTPNXTBFR = '0'B;

   7985   1 0000ED  8844 001D                            LBF,'C000'X       29,B4
   7985   1 0000EF       C000

      371     7986    3         END;
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:54   

      372     7987
      373     7988
      374     7989    3         IF (KA$OTPBFR.NMBMRK > 0) THEN DO;

   7989   1 0000F0  82C6 0003                            LB,'FC00'X        3,B6
   7989   1 0000F2       FC00
          1 0000F3  0581 0009                            BBF      s:7993,PREL

      375     7990    3            CALL KAO$MRK (KA$OTPBFR);

   7990   1 0000F5  BBC7 000E                            LAB,B3   Y@BFR$,AUTO
          1 0000F7  CBF0 0100                            LAB,B4   256,IMO
          1 0000F9  E380 0000 0000  xent                 LNJ,B6   KAO$MRK
          1 0000FC       0001                            DC       s:7993,PREL

      376     7991    3         END;

      377     7992
      378     7993    2         LVL = KA_INT_LEV;

   7993   1 0000FD  E800 0000 0000  xsym                 LDR,R6   KA_INT_LEV
          1 000100  EF47 000C                            STR,R6   LVL,AUTO

      379     7994        /*
      380     7995          If the current level is below the async inhibit level,
      381     7996          go to the async inhibit level.
      382     7997        */
      383     7998    2         CALL KHI$DISABLE (LVL);

   7998   1 000102  EBC7 000C                            LAB,B6   LVL,AUTO
          1 000104  EFC7 0014                            STB,B6   BCTX$+2,AUTO
          1 000106  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 000108  CBF0 0100                            LAB,B4   256,IMO
          1 00010A  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 00010D       0001                            DC       s:8000,PREL

PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:55   
      384     7999
      385     8000    2         Y@BYTSIZ = Y_POWER_OF_2(Y@BFR$->KA$OTPBFR.BYTSIZLOG2);

   8000   1 00010E  ECC7 000E                            LDB,B6   Y@BFR$,AUTO
          1 000110  B846 0002                            LDR,R3   2,B6
          1 000112  304A                                 SOR,R3   10
          1 000113  B570 000F                            AND,R3   15,IMO
          1 000115  E830 0000 0023  00                   LDR,R6   Y_POWER_OF_2,R3
          1 000118  EF47 000D                            STR,R6   Y@BYTSIZ,AUTO

      386     8001    2         Y@WRDSIZ = Y@BYTSIZ / 2;

   8001   1 00011A  6041                                 SOR,R6   1
          1 00011B  EF06                                 STR,R6   ,B6

      387     8002    2         %KA_CTX.OTPBFRBYTCNT = %KA_CTX.OTPBFRBYTCNT-Y@BYTSIZ;

   8002   1 00011C  DCC7 0012                            LDB,B5   BCTX$,AUTO
          1 00011E  D845 000B                            LDR,R5   11,B5
          1 000120  D247 000D                            SUB,R5   Y@BYTSIZ,AUTO
          1 000122  DF45 000B                            STR,R5   11,B5

      388     8003    2         CALL KVB$RLSSYS(Y@WRDSIZ);

   8003   1 000124  BBC7 000E                            LAB,B3   Y@BFR$,AUTO
          1 000126  CBF0 0100                            LAB,B4   256,IMO
          1 000128  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 00012B       0001                            DC       s:8007,PREL

      389     8004
      390     8005        /* Go back to the level we were at */
      391     8006
      392     8007    2         IF (LVL > KA_INT_LEV) THEN CALL KHI$ENABLE;

   8007   1 00012C  E847 000C                            LDR,R6   LVL,AUTO
          1 00012E  E900 0000 0000  xsym                 CMR,R6   KA_INT_LEV
          1 000131  0381 0007                            BLE      s:8009,PREL
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:56   

   8007   1 000133  CBF0 0000                            LAB,B4   0,IMO
          1 000135  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 000138       0001                            DC       s:8009,PREL

      393     8008
      394     8009    2         KA_STT.KHSTT.OTPBFRBYTUTL = KA_STT.KHSTT.OTPBFRBYTUTL - Y@BYTSIZ;

   8009   1 000139  F847 000D                            LDR,R7   Y@BYTSIZ,AUTO
          1 00013B  6C00                                 LDV,R6   0
          1 00013C  8480 0000 001E  xsym                 SID      KA_STT+30
          1 00013F  8656                                 CPL      R6
          1 000140  8657                                 CPL      R7
          1 000141  8470 0000 0001                       AID      1,IMO
          1 000144  8D00 0000 001E  xsym                 SDI      KA_STT+30

      395     8010
      396     8011    2      END LOOP ;

   8011   1 000147  0F81 FEC8                            B        s:7883,PREL

      397     8012    2      IF %KA_CTX.OTPBFRTAL$=ADDR(NIL) THEN DO;

   8012   1 000149  ECC7 0012                            LDB,B6   BCTX$,AUTO
          1 00014B  8DC6 0006                            CMN      6,B6
          1 00014D  0981 003A                            BNE      s:8037,PREL

      398     8013    2   KAO@CMPOTP:
      399     8014    3         IF %KV_VDI.RE_DSPINP THEN DO;

   8014   1 00014F  EC80 0000 0000  xsym KAO@CMPOTP      LDB,B6   KV$PTR$
          1 000152  DC86                                 LDB,B5   ,B6
          1 000153  82C5 0019                            LB,'0010'X        25,B5
          1 000155       0010
          1 000156  0581 000E                            BBF      s:8026,PREL

      400     8015
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:57   
      401     8016        /* WE STOPPED ECHOING, RE-DISPLAY THE INPUT RECORD.                           */
      402     8017
      403     8018    3            CALL KVI$RE_DSPINP;

   8018   1 000158  CBF0 0000                            LAB,B4   0,IMO
          1 00015A  E380 0000 0000  xent                 LNJ,B6   KVI$RE_DSPINP
          1 00015D       0001                            DC       s:8019,PREL

      404     8019    3            %KV_VDI.RE_DSPINP = '0'B;

   8019   1 00015E  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000161  DC86                                 LDB,B5   ,B6
          1 000162  8845 0019                            LBF,'0010'X       25,B5
          1 000164       0010

      405     8020    3         END /* IF */;

      406     8021              %KV$CMPOTP;
              8026    3           IF KV$PTR.VDI$->KV$VDI.OTPCNDPND THEN DO;

   8026   1 000165  DC86                                 LDB,B5   ,B6
          1 000166  E845 001A                            LDR,R6   26,B5
          1 000168  6901 000A                            BEZ,R6   s:8030,PREL

              8027    3              CALL KVV$VDI(KV_VDH_EVT_CMPOTP);

   8027   1 00016A  BB80 0000 0002  02                   LAB,B3   +2
          1 00016D  CBF0 0100                            LAB,B4   256,IMO
          1 00016F  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000172       0001                            DC       s:8030,PREL

              8028    3              END;                         /* END IF                             */

      407     8030    3         IF (%KH_CHN.OTPCCBCNT = 0) AND (%KA_CTX.OTPBFRBYTCNT ~= 0) THEN DO;

   8030   1 000173  ECC7 0010                            LDB,B6   BCHN$,AUTO
          1 000175  82C6 0007                            LB,'000F'X        7,B6
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:58   
          1 000177       000F
          1 000178  0501 0035                            BBT      s:8050,PREL
          1 00017A  DCC7 0012                            LDB,B5   BCTX$,AUTO
          1 00017C  E845 000B                            LDR,R6   11,B5
          1 00017E  6901 002F                            BEZ,R6   s:8050,PREL

      408     8031    3            CALL KAO$IOLD_OTP ;

   8031   1 000180  CBF0 0000                            LAB,B4   0,IMO
          1 000182  E380 0000 0000  xent                 LNJ,B6   KAO$IOLD_OTP
          1 000185       0001                            DC       s:8033,PREL

      409     8032    3         END /* IF */;

      410     8033    2      END; ELSE DO;

   8033   1 000186  0F81 0027                            B        s:8050,PREL

      411     8034
      412     8035        /* THIS ISN'T THE LAST BUFFER IN THE OUTPUT CHAIN.                            */
      413     8036
      414     8037    2         IF %KA_CTX.OTPBFRNXTLOD$~=ADDR(NIL) AND %KH_CHN.OTPCCBCNT<4

   8037   1 000188  8DC6 0004                            CMN      4,B6
          1 00018A  0901 0023                            BE       s:8050,PREL
          1 00018C  DCC7 0010                            LDB,B5   BCHN$,AUTO
          1 00018E  E845 0007                            LDR,R6   7,B5
          1 000190  E570 000F                            AND,R6   15,IMO
          1 000192  6D04                                 CMV,R6   4
          1 000193  0281 001A                            BGE      s:8050,PREL
          1 000195  82C6 001C                            LB,'C000'X        28,B6
          1 000197       C000
          1 000198  0501 0015                            BBT      s:8050,PREL

      415     8038    3           AND NOT %KA_CTX.HLTOTP THEN DO;

      416     8039    3            CALL KAO$IOLD_OTP ;
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:59   

   8039   1 00019A  CBF0 0000                            LAB,B4   0,IMO
          1 00019C  E380 0000 0000  xent                 LNJ,B6   KAO$IOLD_OTP
          1 00019F       0001                            DC       s:8040,PREL

      417     8040    3            IF %KH_CHN.OTPCCBCNT=0 AND NOT %KA_CTX.HLTOTP

   8040   1 0001A0  ECC7 0010                            LDB,B6   BCHN$,AUTO
          1 0001A2  82C6 0007                            LB,'000F'X        7,B6
          1 0001A4       000F
          1 0001A5  0501 0008                            BBT      s:8050,PREL
          1 0001A7  DCC7 0012                            LDB,B5   BCTX$,AUTO
          1 0001A9  82C5 001C                            LB,'C000'X        28,B5
          1 0001AB       C000
          1 0001AC  0581 FFA2                            BBF      s:8014,PREL

      418     8041
      419     8042        /* NOTHING HAPPENNED, MUST HAVE GOT THE BFR FOR PENDING PST                   */
      420     8043
      421     8044    3            THEN GOTO KAO@CMPOTP;
      422     8045    3         END /* IF */;

      423     8046    2      END /* IF */;

      424     8047
      425     8048        /* CHECK TO SEE IF WE SHOULD UNBLOCK.                                         */
      426     8049
      427     8050    1      IF (%KA_CTX.OTPBFRBYTCNT <= KA_OTPUN_BLKLMT(%KV_VDI.LINSPD))

   8050   1 0001AE  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0001B1  DC86                                 LDB,B5   ,B6
          1 0001B2  B2C5 001E                            LLH,R3   30,B5
          1 0001B4  CCC7 0012                            LDB,B4   BCTX$,AUTO
          1 0001B6  E844 000B                            LDR,R6   11,B4
          1 0001B8  E930 0000 0000  xsym                 CMR,R6   KA_OTPUN_BLKLMT,R3
          1 0001BB  0381 0007                            BLE      s:8068,PREL
          1 0001BD  BCC4 0002                            LDB,B3   2,B4
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:60   
          1 0001BF  BDC4 0006                            CMB,B3   6,B4
          1 0001C1  0981 0012                            BNE      s:8075,PREL

      428     8051    2        OR (%KA_CTX.OTPBFRHED$ = %KA_CTX.OTPBFRTAL$) THEN DO;

      429     8052
      430     8053        /* The output buffer byte count has fallen below the output                   */
      431     8054        /* block limit, or there is only one buffer. Request more output from VDH.    */
      432     8055
      433     8056              %KV$RQSOTP (RQSOTP=YES);
              8068    3           IF NOT KV$PTR.VDI$->KV$VDI.RQSOTP  THEN DO;

   8068   1 0001C3  82C5 0019                            LB,'0008'X        25,B5
   8068   1 0001C5       0008
          1 0001C6  0501 000D                            BBT      s:8075,PREL

              8069    3              KV$PTR.VDI$->KV$VDI.RQSOTP = '1'B;

   8069   1 0001C8  8945 0019                            LBT,'0008'X       25,B5
   8069   1 0001CA       0008

              8070    3              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);

   8070   1 0001CB  BB80 0000 0004  02                   LAB,B3   +4
          1 0001CE  CBF0 0100                            LAB,B4   256,IMO
          1 0001D0  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 0001D3       0001                            DC       s:8075,PREL

              8071    3              END;                         /* END IF                             */

      434     8074    2      END /* IF */;

      435     8075    1      IF %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI)

   8075   1 0001D4  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0001D7  DC86                                 LDB,B5   ,B6
          1 0001D8  82C5 001F                            LB,'0002'X        31,B5
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:61   
          1 0001DA       0002
          1 0001DB  0581 0024                            BBF      s:8084,PREL
          1 0001DD  CCC7 0010                            LDB,B4   BCHN$,AUTO
          1 0001DF  82C4 0007                            LB,'000F'X        7,B4
          1 0001E1       000F
          1 0001E2  0501 001D                            BBT      s:8084,PREL
          1 0001E4  BCC7 0012                            LDB,B3   BCTX$,AUTO
          1 0001E6  82C3 001C                            LB,'C000'X        28,B3
          1 0001E8       C000
          1 0001E9  0501 0016                            BBT      s:8084,PREL

      436     8076    2        AND %KH_CHN.OTPCCBCNT=0 AND NOT %KA_CTX.HLTOTP THEN DO;

      437     8077    2         CALL KAO$DLTOTP(Y@USR_EVT) ;

   8077   1 0001EB  ABC7 000A                            LAB,B2   Y@USR_EVT,AUTO
          1 0001ED  AFC7 0014                            STB,B2   BCTX$+2,AUTO
          1 0001EF  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 0001F1  CBF0 0100                            LAB,B4   256,IMO
          1 0001F3  E380 0000 0000  xent                 LNJ,B6   KAO$DLTOTP
          1 0001F6       0001                            DC       s:8082,PREL

      438     8078
      439     8079        /* We are to report to VDH quiescence in ASYNC                                */
      440     8080        /* so we can complete the releasing of VDI.                                   */
      441     8081
      442     8082    2         CALL KVV$VDI(KV_VDH_EVT_RLSVDI) ;

   8082   1 0001F7  BB80 0000 0006  02                   LAB,B3   +6
          1 0001FA  CBF0 0100                            LAB,B4   256,IMO
          1 0001FC  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 0001FF       0001                            DC       s:8084,PREL

      443     8083    2      END /* IF */;

      444     8084    1   END KAO$OTPINT;

PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:62   
   8084   1 000200  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      445     8085
      446     8086        %EOD;

PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:63   
--  Include file information  --

   KH_SCREECH_M.:E05TOU  is referenced.
   KA_PERR_C.:E05TOU  is referenced.
   KH$IO.:E05TOU  is referenced.
   KA_LCT_E.:E05TOU  is referenced.
   KW_ALCT_E.:E05TOU  is referenced.
   KW_LCT_E.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_INT.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KA_SCODE_C.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLBASM_E.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:64   
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$OTPINT.
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:65   

 **** Variables and constants ****

  ****  Section 000 RoData KAO$OTPINT

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     B-0-0/w STRC(336)   r     1 FPT_WRSYSLOG_IO_ERR        0-0-0/w STRC(32)    r     1 KH_IO_INPCCBSTT
     2-0-0/w STRC(32)    r     1 KH_IO_INPNXTCCBSTT         4-0-0/w STRC(32)    r     1 KH_IO_INPRNG
    23-0-0/w UBIN(16)    r     1 Y_POWER_OF_2(0:15)
    20-0-0/w STRC(48)    r     1 Y_SCRIO_NAK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    10-0-0/w PTR         r     1 BCHN$                     12-0-0/w PTR         r     1 BCTX$
     4-0-0/w STRC(32)    r     1 KH@IO_INPCCBSTT            6-0-0/w STRC(32)    r     1 KH@IO_INPNXTCCBSTT
     8-0-0/w STRC(32)    r     1 KH@IO_INPRNG               C-0-0/w UBIN(16)    r     1 LVL
     E-0-0/w PTR         r     1 Y@BFR$                     D-0-0/w UBIN(16)    r     1 Y@BYTSIZ
     A-0-0/w STRC(32)    r     1 Y@USR_EVT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 KA_INT_LEV
     0-0-0/w UBIN(16)    r     1 KA_OTPUN_BLKLMT(0:15)
     0-0-0/w STRC(2528)  r     1 KA_STT                     0-0-0/w PTR         r     1 KV$PTR$
     0-0-0/w STRC(32)    r     1 KV_VDH_EVT_CMPOTP          0-0-0/w STRC(32)    r     1 KV_VDH_EVT_RLSVDI
     0-0-0/w STRC(32)    r     1 KV_VDH_EVT_RQSOTP

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:66   
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KA$CTX                     0-0-0/w STRC(64)    r     1 KA$OTPBFR
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(512)   r     1 KV$VDI                     0-0-0/w UBIN(16)    r     1 Y@WRDSIZ


   Procedure KAO$OTPINT requires 515 words for executable code.
   Procedure KAO$OTPINT requires 24 words of local(AUTO) storage.
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:67   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:68   
          MINI XREF LISTING

BCHN$
      7875**DCL       367--IMP-PTR  7881<<ASSIGN   7882>>ASSIGN   7889>>IF       7897>>CALL     7926>>CALL
      7934>>CALL     7938>>ASSIGN   7938>>ASSIGN   7939>>IF       7947>>CALL     7966>>ASSIGN   8030>>IF
      8037>>IF       8040>>IF       8075>>IF
BCTX$
      7876**DCL      5069--IMP-PTR  7882<<ASSIGN   7888>>ASSIGN   7967>>ASSIGN   7970>>IF       7977>>ASSIGN
      7978>>IF       7983>>ASSIGN   7984>>ASSIGN   7984>>ASSIGN   7984>>ASSIGN   7985>>ASSIGN   8002>>ASSIGN
      8002>>ASSIGN   8012>>IF       8030>>IF       8037>>IF       8037>>IF       8040>>IF       8050>>IF
      8050>>IF       8050>>IF       8075>>IF
FPT_WRSYSLOG_IO_ERR
      7551**DCL      7926<>CALL
FPT_WRSYSLOG_IO_ERR.V
      7555**DCL      7553--DCLINIT
FPT_WRSYSLOG_IO_ERR.V.TERMID.TERM
      7620**DCL      7629--REDEF
KA$CTX.DLTOTPPND
      5170**DCL      7967<<ASSIGN
KA$CTX.HLTOTP
      5164**DCL      5166--REDEF    8037>>IF       8040>>IF       8075>>IF
KA$CTX.HLTOTPNXTBFR
      5168**DCL      5169--REDEF    7985<<ASSIGN
KA$CTX.HLTOTPNXTBFR_ALL
      5169**DCL      7984>>ASSIGN
KA$CTX.HLTOTP_ALL
      5166**DCL      7984<<ASSIGN   7984>>ASSIGN
KA$CTX.OTPBFRBYTCNT
      5079**DCL      8002<<ASSIGN   8002>>ASSIGN   8030>>IF       8050>>IF
KA$CTX.OTPBFRHED$
      5076**DCL      7888>>ASSIGN   7977<<ASSIGN   8050>>IF
KA$CTX.OTPBFRNXTLOD$
      5076**DCL      7970>>IF       8037>>IF
KA$CTX.OTPBFRTAL$
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:69   
      5077**DCL      7978>>IF       7983<<ASSIGN   8012>>IF       8050>>IF
KA$OTPBFR
      5194**DCL      7990<>CALL
KA$OTPBFR.BYTCNT
      5200**DCL      7889>>IF       7935<<ASSIGN   7935>>ASSIGN
KA$OTPBFR.BYTSIZLOG2
      5199**DCL      8000>>ASSIGN
KA$OTPBFR.HLTOTP
      5198**DCL      5199--REDEF
KA$OTPBFR.LNK$
      5198**DCL      7977>>ASSIGN
KA$OTPBFR.NMBMRK
      5200**DCL      7989>>IF
KAO$DLTOTP
      7711**DCL-ENT  8077--CALL
KAO$IOLD_OTP
      7710**DCL-ENT  8031--CALL     8039--CALL
KAO$MRK
      7712**DCL-ENT  7990--CALL
KAO@CMPOTP
      8014**LABEL    8044--GOTO
KA_INT_LEV
      6202**DCL      7993>>ASSIGN   8007>>IF
KA_OTPUN_BLKLMT
      4664**DCL      8050>>IF
KA_STT.KHSTT.OTPBFRBYTUTL
      5005**DCL      8009<<ASSIGN   8009>>ASSIGN
KA_STT.REQSTATS.DSPMSK
      4933**DCL      4939--REDEF
KA_STT.REQSTATS.SLCMSK
      4974**DCL      4981--REDEF
KH$CHN
       367**DCL      7897<>CALL     7926<>CALL     7934<>CALL     7947<>CALL
KH$CHN.CTX$
       437**DCL      7882>>ASSIGN
KH$CHN.OTPCCBCNT
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:70   
       411**DCL      7889>>IF       7938<<ASSIGN   7938>>ASSIGN   7939>>IF       8030>>IF       8037>>IF
      8040>>IF       8075>>IF
KH$CHN.OTPCCBSTTPTRVLD
       420**DCL      7966<<ASSIGN
KH$CHN.TERMID.TERM
       463**DCL       472--REDEF
KH@IO_INPCCBSTT
      7187**DCL      7896<<ASSIGN   7897<>CALL
KH@IO_INPCCBSTT.ASNSTT
      7196**DCL      7197--REDEF    7203--REDEF    7208--REDEF    7212--REDEF    7216--REDEF    7220--REDEF
      7227--REDEF    7233--REDEF    7239--REDEF    7244--REDEF    7251--REDEF    7254--REDEF    7258--REDEF
      7265--REDEF    7269--REDEF    7273--REDEF    7277--REDEF    7282--REDEF    7286--REDEF
KH@IO_INPCCBSTT.CCBSTT
      7258**DCL      7926>>IF
KH@IO_INPCCBSTT.CCBSTT.CCBSTTCMP
      7258**DCL      7911>>IF
KH@IO_INPCCBSTT.CCBSTT.PRG.BIT1
      7259**DCL      7929>>IF
KH@IO_INPNXTCCBSTT
      7301**DCL      7946<<ASSIGN   7947<>CALL
KH@IO_INPNXTCCBSTT.ASNSTT
      7310**DCL      7311--REDEF    7317--REDEF    7322--REDEF    7326--REDEF    7330--REDEF    7334--REDEF
      7341--REDEF    7347--REDEF    7353--REDEF    7358--REDEF    7365--REDEF    7368--REDEF    7372--REDEF
      7379--REDEF    7383--REDEF    7387--REDEF    7391--REDEF    7396--REDEF    7400--REDEF
KH@IO_INPRNG
      7415**DCL      7933<<ASSIGN   7934<>CALL
KH@IO_INPRNG.ASNSTT
      7424**DCL      7425--REDEF    7431--REDEF    7436--REDEF    7440--REDEF    7444--REDEF    7448--REDEF
      7455--REDEF    7461--REDEF    7467--REDEF    7472--REDEF    7479--REDEF    7482--REDEF    7486--REDEF
      7493--REDEF    7497--REDEF    7501--REDEF    7505--REDEF    7510--REDEF    7514--REDEF
KH@IO_INPRNG.RNG
      7436**DCL      7935>>ASSIGN   7937<<ASSIGN   7973<<ASSIGN
KHD$ERRLOG_SETTERMID_CHN
      7713**DCL-ENT  7926--CALL
KHD$SCREECH
      7706**DCL-ENT  7905--CALL     7954--CALL
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:71   
KHI$DISABLE
      7715**DCL-ENT  7998--CALL
KHI$ENABLE
      7716**DCL-ENT  8007--CALL
KHI$IO_INP
      7709**DCL-ENT  7897--CALL     7934--CALL     7947--CALL
KH_CHNHI
       530**DCL       531--REDEF
KH_CHNLOW
       531**DCL       532--REDEF
KH_IO_INPCCBSTT
      6794**DCL      7896>>ASSIGN
KH_IO_INPNXTCCBSTT
      6908**DCL      7946>>ASSIGN
KH_IO_INPRNG
      7022**DCL      7933>>ASSIGN
KV$PTR.INPCNDPND
      6230**DCL      6239--REDEF    6243--REDEF
KV$PTR.LINLST$
      6226**DCL      6227--REDEF
KV$PTR.VDI$
      6224**DCL      7881>>ASSIGN   7970>>IF       8014>>IF       8019>>ASSIGN   8026>>IF       8050>>IF
      8068>>IF       8069>>ASSIGN   8075>>IF
KV$PTR$
      6218**DCL      6224--IMP-PTR  7881>>ASSIGN   7970>>IF       8014>>IF       8019>>ASSIGN   8026>>IF
      8050>>IF       8068>>IF       8069>>ASSIGN   8075>>IF
KV$SSN.REDRSPCNT
      6152**DCL      6153--REDEF
KV$TRNTBL.OTPESCCHR
      6368**DCL      6368--REDEF
KV$VDI.CHN$
      6267**DCL      7881>>ASSIGN
KV$VDI.LINSPD
      6309**DCL      8050>>IF
KV$VDI.OTPBFR_.ADR$
      6293**DCL      7970>>IF
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:72   
KV$VDI.OTPCNDPND
      6304**DCL      8026>>IF
KV$VDI.RE_DSPINP
      6302**DCL      8014>>IF       8019<<ASSIGN
KV$VDI.RQSOTP
      6303**DCL      8068>>IF       8069<<ASSIGN
KV$VDI.VDHEVTENB
      6315**DCL      8075>>IF
KVB$RLSSYS
      7714**DCL-ENT  8003--CALL
KVI$RE_DSPINP
      7867**DCL-ENT  8018--CALL
KVV$VDI
      7793**DCL-ENT  8027--CALL     8070--CALL     8082--CALL
KV_VDH_EVT_CMPOTP
      7748**DCL      8027<>CALL
KV_VDH_EVT_RLSVDI
      7785**DCL      8082<>CALL
KV_VDH_EVT_RQSOTP
      7823**DCL      8070<>CALL
LOOP
      7883**LABEL    7912--EXIT     7972--EXIT
LVL
      7871**DCL      7993<<ASSIGN   7998<>CALL     8007>>IF
Y@BFR$
      7874**DCL      5194--IMP-PTR  7873--IMP-PTR  7888<<ASSIGN   7889>>IF       7935>>ASSIGN   7935>>ASSIGN
      7970>>IF       7970>>IF       7970>>IF       7977>>ASSIGN   7978>>IF       7989>>IF       7990>>CALL
      8000>>ASSIGN   8001>>ASSIGN   8003>>CALL
Y@BYTSIZ
      7872**DCL      8000<<ASSIGN   8001>>ASSIGN   8002>>ASSIGN   8009>>ASSIGN
Y@USR_EVT
      7858**DCL      8077<>CALL
Y@WRDSIZ
      7873**DCL      8001<<ASSIGN   8003<>CALL
Y_POWER_OF_2
      7878**DCL      8000>>ASSIGN
PL6.E3A0      #002=KAO$OTPINT File=KAO$OTP.:E05TSI                               TUE 07/29/97 23:57 Page:73   
Y_SCRIO_NAK
      7661**DCL      7905<>CALL     7954<>CALL

PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:74   
      447        1        /*T***********************************************************/
      448        2        /*T*                                                         */
      449        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      450        4        /*T*                                                         */
      451        5        /*T***********************************************************/
      452        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      453        7
      454        8
      455        9
      456       10
      457       11        KAO$TRNOTPIOLD: PROC;
      458       12        %INCLUDE LCP_6;
      459      203
      460      204        %INCLUDE KL_MACRO_C;                    /* For KA_STT/KV$STT                  */
      461     3556        %INCLUDE KL_AFCN_C;                     /* For KA_STT/KV$STT                  */
      462     3657        %INCLUDE K_ID_E;                        /* For KA_STT/KV$STT                  */
      463     3707        %K#ENTID_E;                             /* For KA_STT/KV$STT                  */
      464     3726        %K#LYRID_E;                             /* For KA_STT/KV$STT                  */
      465     3733
      466     3734        %INCLUDE KV$BPC;
      467     3763
      468     3764        %INCLUDE KH$CHN;
      469     3886        %KH$CHN (STCLASS="BASED(BCHN$)");       /*  CHANNEL TABLES ITEM DEFINITONS    */
      470     4010        %EQU KH_CHN=CHARTEXT('KH$CHN');
      471     4011        %INCLUDE KH_CHN;
      472     4051        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      473     4069        %INCLUDE KH$STT;                        /* For KA_STT                         */
      474     4099        %INCLUDE GH_IOFNC_E;                    /*  IO FUNCTION CODES                 */
      475     4168        %INCLUDE KV_ASCCHR_E;                   /*  EQU'S FOR ASCII CHR'S             */
      476     4305        %INCLUDE KV_GLBASM_E;
      477     4323 S      %INCLUDE KV_GLBCNS_E;
      478     4324        %KV_INPOPRX_E;
      479     4336        %KV_STRTYP_E;
      480     4374        %KV_VDH_FNC_E;
      481     4394        %KV_USR_FNC_E;
      482     4410        %KV_SCHRSN_E;                           /*  Schedule reasons                  */
      483     4417
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:75   
      484     4418    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY(2) ALTRET;
      485     4419
      486     4420 S      %INCLUDE KV$GLB;
      487     4421 S      %INCLUDE KV$GLBCTX;
      488     4422        %INCLUDE KA$GLB;
      489     4563        %INCLUDE KA_GLB;
      490     4640        %INCLUDE KA_GLB_E;
      491     4718        %KA_HLTOTP_E;
      492     4727        %KA_MSC;
      493     4749        %KA_STT;                                /*  STATISTICS                        */
      494     5112 S      %INCLUDE KV$VDH;
      495     5113        %KA$CTX (STCLASS="BASED(BCTX$)");  /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      496     5237        %EQU KA_CTX=CHARTEXT('KA$CTX');
      497     5238        %KA$OTPBFR;                             /*  ASYNC output buffer               */
      498     5266 S      %INCLUDE KV$USR;
      499     5267        %INCLUDE KV_GLB_M;                      /*  VDH-user macros                   */
      500     5389        %INCLUDE KV_INT_M;                      /*  TRACE ROUTINES                    */
      501     5532        %INCLUDE KW_LCT_E;                      /*  MLCP LCT DEFINITIONS              */
      502     5887        %KV$SSN;                                /*  VDH Session                       */
      503     5966        %KV$PTR;                                /*  VDH Pointers, status              */
      504     6009        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      505     6080 S      %INCLUDE KV$INT;
      506     6081        %KV$TRNTBL;                             /*  VDH translate table               */
      507     6139        %KV$USR_EXTINPTRN;                      /*  VDI extended input translation    */
      508     6175        %INCLUDE KH$IO;
      509     6422        %KH$IO(FPTN=KH_IO_INPNXTCCBSTT,FNC=%GH#IO_INPNXTCCBSTT,OTPCHN=YES,STCLASS=CONSTANT);
      510     6536        %KH$IO(FPTN=KH_IO_OTPLCTBYT,FNC=%GH#IO_OTPLCTBYT,OTPCHN=YES,STCLASS=CONSTANT);
      511     6650        %KH$IOLD(FPTN=KH_IOLD,STCLASS=CONSTANT,OTPCHN=YES);
      512     6701        %KH$IO(FPTN=KH@IO_INPNXTCCBSTT,FNC=%GH#IO_INPNXTCCBSTT,OTPCHN=YES,STCLASS=AUTO);
      513     6815        %KH$IO(FPTN=KH@IO_OTPLCTBYT,FNC=%GH#IO_OTPLCTBYT,OTPCHN=YES,STCLASS=AUTO);
      514     6929        %KH$IOLD(FPTN=KH@IOLD,STCLASS=AUTO,OTPCHN=YES);
      515     6980
      516     6981        %INCLUDE KA_PERR_C;
      517     7000 S      %INCLUDE GT_LCP6_M;
      518     7001        %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_IO_ERR, STCLASS = CONSTANT, FCG = KA, MID = O,
              7001            ERR = %E$ASN_IO_ERR, SEV = 3);
      519     7096
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:76   
      520     7097    1   DCL KAO$OTPINT ENTRY;
      521     7098    1   DCL KHI$IO_INP ENTRY(2) ALTRET;
      522     7099    1   DCL KHI$IO_OTPLCTBYT ENTRY(2) ALTRET;
      523     7100    1   DCL KHI$IOLD ENTRY(2) ALTRET;
      524     7101
      525     7102        %INCLUDE G_HJIT_M;
      526     7247        %G$UHJIT(STCLASS="BASED(G$UHJIT$)");
      527    10221    1   DCL G$UHJIT$ PTR SYMREF;
      528    10222
      529    10223
      530    10224
      531    10225
      532    10226
      533    10227    1   DCL Y@BYTCNT UBIN WORD;
      534    10228    1   DCL Y@BFR$ PTR;
      535    10229    1   DCL BCHN$ PTR;
      536    10230    1   DCL BCTX$ PTR;
      537    10231
      538    10232    1   DCL Y_POWER_OF_2(0:15) UBIN WORD CONSTANT INIT(1,2,4,8,16,32,64,128,256,
      539    10233    1    512,1024,2048,4096,8192,16384,32764);
      540    10234
      541    10235
      542    10236        /* TRUNCATE THE CURRENT OUTPUT BUFFER, AND DO IOLD'S ON AS                    */
      543    10237        /* MANY OUTPUT BUFFERS AS POSSIBLE.                                           */
      544    10238
      545    10239    1      BCTX$ = %KV_VDI.USRCTX$;
      546    10240    2      IF (%KV_VDI.OTPBFR_.ADR$ ~= ADDR(NIL)) THEN DO;
      547    10241
      548    10242        /* THE CURRENT BUFFER HASN'T BEEN TRUNCATED YET.                              */
      549    10243
      550    10244    2         Y@BFR$ = %KA_CTX.OTPBFRTAL$;
      551    10245    2         Y@BFR$->KA$OTPBFR.BYTCNT = %KV_VDI.OTPBFR_.BYTX-(LENGTHC(KA$OTPBFR)-1);
      552    10246    2         Y@BYTCNT = Y@BFR$->KA$OTPBFR.BYTCNT;
      553    10247    3         IF Y@BYTCNT~=0 OR Y@BFR$->KA$OTPBFR.NMBMRK~=0 THEN DO;
      554    10248
      555    10249        /* The buffer has data in it, so take it away from VDH.                       */
      556    10250
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:77   
      557    10251    3            %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL);
      558    10252    3            %KV_VDI.OTPBFR_.BYTSIZ = 0;
      559    10253    3            Y@BYTCNT = Y@BYTCNT+(LENGTHC(KA$OTPBFR)-1);
      560    10254    4            IF (Y@BYTCNT >= KA_OTPBFRBYTSIZ_SML) THEN DO;
      561    10255
      562    10256        /* This output buffer's data exceeds (or equals) what fits in                 */
      563    10257        /* a small buffer. Remember that for the next output buffer                   */
      564    10258        /* get operation.                                                             */
      565    10259
      566    10260    4               %KA_CTX.PRVOTPBFRDATEXCSML = '1'B;
      567    10261    5               IF (Y@BYTCNT >= Y_POWER_OF_2(Y@BFR$->KA$OTPBFR.BYTSIZLOG2)) THEN DO;
      568    10262
      569    10263        /* This output buffer is full.                                                */
      570    10264
      571    10265    6                  IF (Y@BFR$->KA$OTPBFR.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_SMLLOG2) THEN DO;
      572    10266
      573    10267        /* This is a small output buffer.                                             */
      574    10268
      575    10269    6                     KA_STT.OTPBFRFULCNT_SML = KA_STT.OTPBFRFULCNT_SML+1;
      576    10270    6                  END; ELSE DO;
      577    10271
      578    10272        /* This is a big output buffer.                                               */
      579    10273
      580    10274    6                     KA_STT.OTPBFRFULCNT_BIG = KA_STT.OTPBFRFULCNT_BIG+1;
      581    10275    6                  END /* IF */;
      582    10276    5               END /* IF */;
      583    10277    4            END; ELSE DO;
      584    10278    4               %KA_CTX.PRVOTPBFRDATEXCSML = '0'B;
      585    10279    4            END /* IF */;
      586    10280    3         END /* IF */;
      587    10281    2      END /* IF */;
      588    10282
      589    10283        %EJECT;
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:78   
      590    10284        /* DO IOLD'S ON ASYNC OUTPUT BUFFERS                                          */
      591    10285
      592    10286    1   KAO$IOLD_OTP: ENTRY;
      593    10287
      594    10288    1      BCHN$ = %KV_VDI.CHN$;
      595    10289    1      BCTX$ = %KH_CHN.CTX$;
      596    10290        /* SEE IF WE CAN IOLD MORE OUTPUT BUFFERS                                     */
      597    10291
      598    10292    2      IF %KA_CTX.OTPBFRNXTLOD$~=ADDR(NIL) AND %KH_CHN.OTPCCBCNT<4 THEN DO;
      599    10293
      600    10294        /* THERE ARE OUTPUT BUFFERS, AND NO IN-USE CCB'S.                             */
      601    10295
      602    10296    2         KH@IO_OTPLCTBYT = KH_IO_OTPLCTBYT;
      603    10297    3   LOOP: DO WHILE ('1'B);                  /* LOOP START                         */
      604    10298
      605    10299        /* THIS LOOP IS TRAVERSED ONCE FOR EACH OUTPUT BUFFER IOLD'D.                 */
      606    10300
      607    10301
      608    10302        /* THERE ARE MORE OUTPUT BUFFERS THAN IN-USE CCB'S, AND THERE                 */
      609    10303        /* ARE FREE CCB'S.                                                            */
      610    10304
      611    10305    3            Y@BFR$ = %KA_CTX.OTPBFRNXTLOD$;
      612    10306    4            IF NOT %KV_VDI.PHSDSC AND NOT %KV_VDI.INTPHSDSC THEN DO;
      613    10307
      614    10308        /* We still have something to talk to, honor halt conditions. */
      615    10309
      616    10310    4               IF %KA_CTX.HLTOTP THEN
      617    10311
      618    10312        /* WE CURRENTLY HAVE AN OUTPUT HALT CONDITION* MORE OUTPUT BUFFERS.           */
      619    10313
      620    10314    4               EXIT LOOP;                  /* LOOK BELOW                         */
      621    10315    5               IF Y@BFR$->KA$OTPBFR.HLTOTP_ALL THEN DO;
      622    10316
      623    10317        /* THE NEXT BUFFER ELIGIBLE FOR IOLD'ING HAS AN OUTPUT HALT BIT SET.          */
      624    10318
      625    10319    6                  IF (Y@BFR$ = %KA_CTX.OTPBFRHED$) THEN DO;
      626    10320
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:79   
      627    10321        /* THE BUFFER AT THE HEAD OF THE OUTPUT CHAIN HAS AN OUTPUT HALT              */
      628    10322        /* BIT SET*                                                                   */
      629    10323    6                     %KA_CTX.HLTOTP_ALL = Y@BFR$->KA$OTPBFR.HLTOTP_ALL|%KA_CTX.
             10323                              HLTOTP_ALL;
      630    10324    6                     Y@BFR$->KA$OTPBFR.HLTOTP_ALL = '0'B;
      631    10325    6                  END /* IF */;
      632    10326    5                  EXIT LOOP;               /* LOOK BELOW                         */
      633    10327    5               END /* IF */;
      634    10328    4            END /* IF */;
      635    10329    4            IF (Y@BFR$ = %KA_CTX.OTPBFRTAL$) THEN DO;
      636    10330    4               IF Y@BFR$~=%KA_CTX.OTPBFRHED$ THEN
      637    10331
      638    10332        /* THIS IS THE LAST OTP BFR IN THE CHAIN,                                     */
      639    10333        /* AND THERE ARE OTHER OTP BFR'S IOLD'D.                                      */
      640    10334
      641    10335    4               EXIT LOOP;                  /* LOOK BELOW                         */
      642    10336
      643    10337        /* THIS IS THE ONLY OTP BFR IN THE CHAIN.                                     */
      644    10338        /* NO MORE CHARACTERS WILL BE STORED INTO THIS BUFFER.                        */
      645    10339
      646    10340    4               Y@BFR$->KA$OTPBFR.BYTCNT = %KV_VDI.OTPBFR_.BYTX - (LENGTHC(KA$OTPBFR)-1)
             10340                        ;
      647    10341    4               %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL);
      648    10342    4               %KV_VDI.OTPBFR_.BYTSIZ = 0;
      649    10343    5               IF Y@BFR$->KA$OTPBFR.BYTCNT=0 THEN DO;
      650    10344    5                  %KA_CTX.OTPBFRNXTLOD$ = ADDR(NIL);
      651    10345    5                  CALL KAO$OTPINT;    /* Release the buffer - process markers    */
      652    10346    5                  EXIT LOOP;
      653    10347    5               END;
      654    10348    4            END /* IF */;
      655    10349    4            IF Y@BFR$->KA$OTPBFR.BYTCNT~=0 THEN DO;
      656    10350    4               IF %KH_CHN.OTPCCBCNT>=4 OR %KA_CTX.DLTOTPPND THEN
      657    10351
      658    10352        /* THE OUTPUT CCB COUNT IS 4, SO THERE AREN'T                                 */
      659    10353        /* ANY FREE CCBS TO IOLD.                                                     */
      660    10354
      661    10355    4               EXIT LOOP;                  /* LOOK BELOW                         */
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:80   
      662    10356    4               KH@IOLD = KH_IOLD;
      663    10357    4               KH@IOLD.BFR_.ADR$ = Y@BFR$;
      664    10358    4               KH@IOLD.BFR_.BYTSIZ = Y@BFR$->KA$OTPBFR.BYTCNT;
      665    10359    4               KH@IOLD.BFR_.BYTX = (LENGTHC(KA$OTPBFR)-1);
      666    10360    4               KH@IOLD.CCBCTR.INTCPU = '1'B;
      667    10361    4               KH@IOLD.CCBCTR.VLDCCB = '1'B;
      668    10362    4               CALL KHI$IOLD(%KH_CHN,KH@IOLD) WHENALTRETURN
      669    10363    5               DO;
      670    10364    5               END;
      671    10365
      672    10366        /* IOLD AND IO (OUTPUT CCB CONTROL) WERE SUCCESSFUL.                          */
      673    10367        /* UPDATE THE POINTERS.                                                       */
      674    10368
      675    10369    4               %KH_CHN.OTPCCBCNT = %KH_CHN.OTPCCBCNT+1;
      676    10370    5               IF NOT %KH_CHN.OTPCCBSTTPTRVLD THEN DO;
      677    10371
      678    10372        /* THE CCB STATUS POINTER (IN THE CLC HARDWARE)                               */
      679    10373        /* DOESN'T POINT TO AN IN-USE CCB                                             */
      680    10374        /* BECAUSE AT SOME POINT WE WOULD LIKE TO                                     */
      681    10375        /* HAVE ADVANCED THE STATUS POINTER VIA                                       */
      682    10376        /* IO (INPUT NEXT CCB STATUS), BUT COULDN'T                                   */
      683    10377        /* BECAUSE WE DIDN'T HAVE ANY IN-USE CCB'S (THE HARDWARE                      */
      684    10378        /* CCB COUNT WAS 0).                                                          */
      685    10379
      686    10380
      687    10381        /* WE'LL DO THE IO (INPUT NEXT CCB STATUS), WHICH                             */
      688    10382        /* INCREMENTS THE STATUS CCB POINTER AND DECREMENTS                           */
      689    10383        /* THE CCB COUNTER IN THE HARDWARE, NOW.                                      */
      690    10384
      691    10385    5                  KH@IO_INPNXTCCBSTT = KH_IO_INPNXTCCBSTT;
      692    10386    5                  CALL KHI$IO_INP(%KH_CHN,KH@IO_INPNXTCCBSTT);
      693    10387        /* THE IO (INPUT NEXT CCB STATUS) WAS SUCCESSFUL,                             */
      694    10388        /* SO SET THE CCB-STATUS-IS-VALID FLAG.                                       */
      695    10389
      696    10390    5                  %KH_CHN.OTPCCBSTTPTRVLD = '1'B;
      697    10391                       %KAC$CLCERRCHK(CCBSTT=KH@IO_INPNXTCCBSTT.CCBSTT,
      698    10392                       CCBSRVERR=YES,
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:81   
      699    10393                       DATCHKERR=YES,
      700    10394                       INVMMRADR=YES,
      701    10395                       BUSPRTERR=YES,
      702    10396                       UN_CRCMMRERR=YES);
      703    10402    5               END /* IF NOT CCBSTTPTRVLD */;
      704    10403        /* SINCE ALL OF THE OUTPUT BLED OFF (WAS TRANSFERRED OR DELETED)              */
      705    10404        /* WE SHOULD DO AN IO (OUTPUT CHANNEL CONTROL, START IO) TO                   */
      706    10405        /* GET THE OUTPUT CCP GOING, OR MAKE SURE IT IS GOING.                        */
      707    10406
      708    10407    5               IF KH@IO_OTPLCTBYT.LCTBYT='0'B THEN DO;
      709    10408
      710    10409        /* WE IOLD'D THE FIRST CCB, SO WE SHOULD DO AN                                */
      711    10410        /* IO TO GET THE COMM LINE CONTROLLER GOING.                                  */
      712    10411
      713    10412    5                  KH@IO_OTPLCTBYT.LCTBYT.ADR = %KW#TRNSTT;
      714    10413    5                  KH@IO_OTPLCTBYT.LCTBYT.DAT = BITBIN('3F'X);
      715    10414    5                  CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);
      716    10415    5                  KH@IO_OTPLCTBYT.LCTBYT.ADR = %KW#TRNSTTMSK;
      717    10416    5                  KH@IO_OTPLCTBYT.LCTBYT.DAT = BITBIN('FF'X);
      718    10417    5                  CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);
      719    10418    5               END /* IF OTPCCBCNT ~= 0 */;
      720    10419    4            END /* IF OTPBFR.BYTCNT ~= 0 */;
      721    10420    3            %KA_CTX.OTPBFRNXTLOD$ = Y@BFR$->KA$OTPBFR.LNK$;
      722    10421    3            IF (%KA_CTX.OTPBFRNXTLOD$ = ADDR(NIL)) THEN
      723    10422
      724    10423        /* ALL OUTPUT BUFFERS HAVE BEEN IOLD'D                                        */
      725    10424
      726    10425    3            EXIT LOOP;                     /* LOOK BELOW                         */
      727    10426    3         END LOOP;
      728    10427
      729    10428    2      END /* IF IOLD MORE OTPBFRS */;
      730    10429    1   END KAO$TRNOTPIOLD;
      731    10430
      732    10431        %EOD;

PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:82   
--  Include file information  --

   G_HJIT_M.:E05TOU  is referenced.
   KA_PERR_C.:E05TOU  is referenced.
   KH$IO.:E05TOU  is referenced.
   KW_LCT_E.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLBASM_E.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:83   
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$TRNOTPIOLD.

   Procedure KAO$TRNOTPIOLD requires 409 words for executable code.
   Procedure KAO$TRNOTPIOLD requires 24 words of local(AUTO) storage.

PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:84   

 Object Unit name= KAO$TRNOTPIOLD                             File name= KAO$OTP.:E05TOU
 UTS= JUL 29 '97 23:58:25.64 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     46     2E  KAO$TRNOTPIOLD
    1   Proc  even  none   409    199  KAO$TRNOTPIOLD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  KAO$TRNOTPIOLD
     1     60                  yes      Std        0  KAO$IOLD_OTP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 KAO$OTPINT
 yes     yes           Std       2 KHI$IOLD
 yes     yes           Std       2 KHI$IO_INP
 yes     yes           Std       2 KHD$ERRLOG_SETTERMID_CHN
 yes     yes           Std       2 KHI$IO_OTPLCTBYT
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:85   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNHI                         r    KH_CHNLOW                             KA_OTPBFRBYTSIZ_SML
     KA_OTPBFRBYTSIZ_SMLLOG2               KA_STT                                KV$PTR$
     G$UHJIT$                         r    G$ROS$
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:86   


      447        1        /*T***********************************************************/
      448        2        /*T*                                                         */
      449        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      450        4        /*T*                                                         */
      451        5        /*T***********************************************************/
      452        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      453        7
      454        8
      455        9
      456       10
      457       11        KAO$TRNOTPIOLD: PROC;

     11   1 000000  D380 0000 0000  xent KAO$TRNOTPIOLD  LNJ,B5   X6A_AUTO_0
          1 000003       0018 0000                       DC       24,0

      458       12        %INCLUDE LCP_6;
      459      203
      460      204        %INCLUDE KL_MACRO_C;                    /* For KA_STT/KV$STT                  */
      461     3556        %INCLUDE KL_AFCN_C;                     /* For KA_STT/KV$STT                  */
      462     3657        %INCLUDE K_ID_E;                        /* For KA_STT/KV$STT                  */
      463     3707        %K#ENTID_E;                             /* For KA_STT/KV$STT                  */
      464     3726        %K#LYRID_E;                             /* For KA_STT/KV$STT                  */
      465     3733
      466     3734        %INCLUDE KV$BPC;
      467     3763
      468     3764        %INCLUDE KH$CHN;
      469     3886        %KH$CHN (STCLASS="BASED(BCHN$)");       /*  CHANNEL TABLES ITEM DEFINITONS    */
      470     4010        %EQU KH_CHN=CHARTEXT('KH$CHN');
      471     4011        %INCLUDE KH_CHN;
      472     4051        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      473     4069        %INCLUDE KH$STT;                        /* For KA_STT                         */
      474     4099        %INCLUDE GH_IOFNC_E;                    /*  IO FUNCTION CODES                 */
      475     4168        %INCLUDE KV_ASCCHR_E;                   /*  EQU'S FOR ASCII CHR'S             */
      476     4305        %INCLUDE KV_GLBASM_E;
      477     4323 S      %INCLUDE KV_GLBCNS_E;
      478     4324        %KV_INPOPRX_E;
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:87   
      479     4336        %KV_STRTYP_E;
      480     4374        %KV_VDH_FNC_E;
      481     4394        %KV_USR_FNC_E;
      482     4410        %KV_SCHRSN_E;                           /*  Schedule reasons                  */
      483     4417
      484     4418    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY(2) ALTRET;
      485     4419
      486     4420 S      %INCLUDE KV$GLB;
      487     4421 S      %INCLUDE KV$GLBCTX;
      488     4422        %INCLUDE KA$GLB;
      489     4563        %INCLUDE KA_GLB;
      490     4640        %INCLUDE KA_GLB_E;
      491     4718        %KA_HLTOTP_E;
      492     4727        %KA_MSC;
      493     4749        %KA_STT;                                /*  STATISTICS                        */
      494     5112 S      %INCLUDE KV$VDH;
      495     5113        %KA$CTX (STCLASS="BASED(BCTX$)");  /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      496     5237        %EQU KA_CTX=CHARTEXT('KA$CTX');
      497     5238        %KA$OTPBFR;                             /*  ASYNC output buffer               */
      498     5266 S      %INCLUDE KV$USR;
      499     5267        %INCLUDE KV_GLB_M;                      /*  VDH-user macros                   */
      500     5389        %INCLUDE KV_INT_M;                      /*  TRACE ROUTINES                    */
      501     5532        %INCLUDE KW_LCT_E;                      /*  MLCP LCT DEFINITIONS              */
      502     5887        %KV$SSN;                                /*  VDH Session                       */
      503     5966        %KV$PTR;                                /*  VDH Pointers, status              */
      504     6009        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      505     6080 S      %INCLUDE KV$INT;
      506     6081        %KV$TRNTBL;                             /*  VDH translate table               */
      507     6139        %KV$USR_EXTINPTRN;                      /*  VDI extended input translation    */
      508     6175        %INCLUDE KH$IO;
      509     6422       %KH$IO(FPTN=KH_IO_INPNXTCCBSTT,FNC=%GH#IO_INPNXTCCBSTT,OTPCHN=YES,STCLASS=CONSTANT);
      510     6536        %KH$IO(FPTN=KH_IO_OTPLCTBYT,FNC=%GH#IO_OTPLCTBYT,OTPCHN=YES,STCLASS=CONSTANT);
      511     6650        %KH$IOLD(FPTN=KH_IOLD,STCLASS=CONSTANT,OTPCHN=YES);
      512     6701        %KH$IO(FPTN=KH@IO_INPNXTCCBSTT,FNC=%GH#IO_INPNXTCCBSTT,OTPCHN=YES,STCLASS=AUTO);
      513     6815        %KH$IO(FPTN=KH@IO_OTPLCTBYT,FNC=%GH#IO_OTPLCTBYT,OTPCHN=YES,STCLASS=AUTO);
      514     6929        %KH$IOLD(FPTN=KH@IOLD,STCLASS=AUTO,OTPCHN=YES);
      515     6980
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:88   
      516     6981        %INCLUDE KA_PERR_C;
      517     7000 S      %INCLUDE GT_LCP6_M;
      518     7001        %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_IO_ERR, STCLASS = CONSTANT, FCG = KA, MID = O,
              7001            ERR = %E$ASN_IO_ERR, SEV = 3);
      519     7096
      520     7097    1   DCL KAO$OTPINT ENTRY;
      521     7098    1   DCL KHI$IO_INP ENTRY(2) ALTRET;
      522     7099    1   DCL KHI$IO_OTPLCTBYT ENTRY(2) ALTRET;
      523     7100    1   DCL KHI$IOLD ENTRY(2) ALTRET;
      524     7101
      525     7102        %INCLUDE G_HJIT_M;
      526     7247        %G$UHJIT(STCLASS="BASED(G$UHJIT$)");
      527    10221    1   DCL G$UHJIT$ PTR SYMREF;
      528    10222
      529    10223
      530    10224
      531    10225
      532    10226
      533    10227    1   DCL Y@BYTCNT UBIN WORD;
      534    10228    1   DCL Y@BFR$ PTR;
      535    10229    1   DCL BCHN$ PTR;
      536    10230    1   DCL BCTX$ PTR;
      537    10231
      538    10232    1   DCL Y_POWER_OF_2(0:15) UBIN WORD CONSTANT INIT(1,2,4,8,16,32,64,128,256,
      539    10233    1    512,1024,2048,4096,8192,16384,32764);
      540    10234
      541    10235
      542    10236        /* TRUNCATE THE CURRENT OUTPUT BUFFER, AND DO IOLD'S ON AS                    */
      543    10237        /* MANY OUTPUT BUFFERS AS POSSIBLE.                                           */
      544    10238
      545    10239    1      BCTX$ = %KV_VDI.USRCTX$;

  10239   1 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000008  DC86                                 LDB,B5   ,B6
          1 000009  CCC5 0002                            LDB,B4   2,B5
          1 00000B  CFC7 0012                            STB,B4   BCTX$,AUTO

PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:89   
      546    10240    2      IF (%KV_VDI.OTPBFR_.ADR$ ~= ADDR(NIL)) THEN DO;

  10240   1 00000D  8DC5 000A                            CMN      10,B5
          1 00000F  0901 004E                            BE       s:10281,PREL

      547    10241
      548    10242        /* THE CURRENT BUFFER HASN'T BEEN TRUNCATED YET.                              */
      549    10243
      550    10244    2         Y@BFR$ = %KA_CTX.OTPBFRTAL$;

  10244   1 000011  BCC4 0006                            LDB,B3   6,B4
          1 000013  BFC7 000E                            STB,B3   Y@BFR$,AUTO

      551    10245    2         Y@BFR$->KA$OTPBFR.BYTCNT = %KV_VDI.OTPBFR_.BYTX-(LENGTHC(KA$OTPBFR)-1);

  10245   1 000015  E845 000C                            LDR,R6   12,B5
          1 000017  6EF9                                 ADV,R6   -7
          1 000018  EAC3 0002                            SRM,R6,'03FF'X    2,B3
          1 00001A       03FF

      552    10246    2         Y@BYTCNT = Y@BFR$->KA$OTPBFR.BYTCNT;

  10246   1 00001B  E843 0002                            LDR,R6   2,B3
          1 00001D  E570 03FF                            AND,R6   1023,IMO
          1 00001F  EF47 000D                            STR,R6   Y@BYTCNT,AUTO

      553    10247    3         IF Y@BYTCNT~=0 OR Y@BFR$->KA$OTPBFR.NMBMRK~=0 THEN DO;

  10247   1 000021  6981 0006                            BNEZ,R6  s:10251,PREL
          1 000023  82C3 0003                            LB,'FC00'X        3,B3
          1 000025       FC00
          1 000026  0581 0037                            BBF      s:10281,PREL

      554    10248
      555    10249        /* The buffer has data in it, so take it away from VDH.                       */
      556    10250
      557    10251    3            %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL);
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:90   

  10251   1 000028  DC86                                 LDB,B5   ,B6
          1 000029  AB80 0000 0000                       LAB,B2   0
          1 00002C  AFC5 000A                            STB,B2   10,B5

      558    10252    3            %KV_VDI.OTPBFR_.BYTSIZ = 0;

  10252   1 00002E  DC86                                 LDB,B5   ,B6
          1 00002F  8745 000D                            CL       13,B5

      559    10253    3            Y@BYTCNT = Y@BYTCNT+(LENGTHC(KA$OTPBFR)-1);

  10253   1 000031  6E07                                 ADV,R6   7
          1 000032  EF47 000D                            STR,R6   Y@BYTCNT,AUTO

      560    10254    4            IF (Y@BYTCNT >= KA_OTPBFRBYTSIZ_SML) THEN DO;

  10254   1 000034  E900 0000 0000  xsym                 CMR,R6   KA_OTPBFRBYTSIZ_SML
          1 000037  0201 0023                            BL       s:10278,PREL

      561    10255
      562    10256        /* This output buffer's data exceeds (or equals) what fits in                 */
      563    10257        /* a small buffer. Remember that for the next output buffer                   */
      564    10258        /* get operation.                                                             */
      565    10259
      566    10260    4               %KA_CTX.PRVOTPBFRDATEXCSML = '1'B;

  10260   1 000039  8944 001C                            LBT,'2000'X       28,B4
  10260   1 00003B       2000

      567    10261    5               IF (Y@BYTCNT >= Y_POWER_OF_2(Y@BFR$->KA$OTPBFR.BYTSIZLOG2)) THEN DO;

  10261   1 00003C  B843 0002                            LDR,R3   2,B3
          1 00003E  304A                                 SOR,R3   10
          1 00003F  B570 000F                            AND,R3   15,IMO
          1 000041  E930 0000 001E  00                   CMR,R6   Y_POWER_OF_2,R3
          1 000044  0201 0019                            BL       s:10281,PREL
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:91   

      568    10262
      569    10263        /* This output buffer is full.                                                */
      570    10264
      571    10265    6                  IF (Y@BFR$->KA$OTPBFR.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_SMLLOG2) THEN DO;

  10265   1 000046  B900 0000 0000  xsym                 CMR,R3   KA_OTPBFRBYTSIZ_SMLLOG2
          1 000049  0981 0009                            BNE      s:10274,PREL

      572    10266
      573    10267        /* This is a small output buffer.                                             */
      574    10268
      575    10269    6                     KA_STT.OTPBFRFULCNT_SML = KA_STT.OTPBFRFULCNT_SML+1;

  10269   1 00004B  8A80 0000 0049  xsym                 INC      KA_STT+73
          1 00004E  8E80 0000 0048  xsym                 CAD      KA_STT+72

      576    10270    6                  END; ELSE DO;

  10270   1 000051  0F81 000C                            B        s:10281,PREL

      577    10271
      578    10272        /* This is a big output buffer.                                               */
      579    10273
      580    10274    6                     KA_STT.OTPBFRFULCNT_BIG = KA_STT.OTPBFRFULCNT_BIG+1;

  10274   1 000053  8A80 0000 004B  xsym                 INC      KA_STT+75
          1 000056  8E80 0000 004A  xsym                 CAD      KA_STT+74

      581    10275    6                  END /* IF */;

      582    10276    5               END /* IF */;

      583    10277    4            END; ELSE DO;

  10277   1 000059  0F81 0004                            B        s:10281,PREL

PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:92   
      584    10278    4               %KA_CTX.PRVOTPBFRDATEXCSML = '0'B;

  10278   1 00005B  8844 001C                            LBF,'2000'X       28,B4
  10278   1 00005D       2000

      585    10279    4            END /* IF */;

      586    10280    3         END /* IF */;

      587    10281    2      END /* IF */;

  10281   1 00005E  0F81 0006                            B        s:10288,PREL

      588    10282
      589    10283        %EJECT;
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:93   
      590    10284        /* DO IOLD'S ON ASYNC OUTPUT BUFFERS                                          */
      591    10285
      592    10286    1   KAO$IOLD_OTP: ENTRY;

  10286   1 000060  D380 0000 0000  xent KAO$IOLD_OTP    LNJ,B5   X6A_AUTO_0
          1 000063       0018 0000                       DC       24,0

      593    10287
      594    10288    1      BCHN$ = %KV_VDI.CHN$;

  10288   1 000065  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000068  DC86                                 LDB,B5   ,B6
          1 000069  CC85                                 LDB,B4   ,B5
          1 00006A  CFC7 0010                            STB,B4   BCHN$,AUTO

      595    10289    1      BCTX$ = %KH_CHN.CTX$;

  10289   1 00006C  BCC4 000C                            LDB,B3   12,B4
          1 00006E  BFC7 0012                            STB,B3   BCTX$,AUTO

      596    10290        /* SEE IF WE CAN IOLD MORE OUTPUT BUFFERS                                     */
      597    10291
      598    10292    2      IF %KA_CTX.OTPBFRNXTLOD$~=ADDR(NIL) AND %KH_CHN.OTPCCBCNT<4 THEN DO;

  10292   1 000070  8DC3 0004                            CMN      4,B3
          1 000072  0901 0123                            BE       s:10429,PREL
          1 000074  E844 0007                            LDR,R6   7,B4
          1 000076  E570 000F                            AND,R6   15,IMO
          1 000078  6D04                                 CMV,R6   4
          1 000079  0281 011C                            BGE      s:10429,PREL

      599    10293
      600    10294        /* THERE ARE OUTPUT BUFFERS, AND NO IN-USE CCB'S.                             */
      601    10295
      602    10296    2         KH@IO_OTPLCTBYT = KH_IO_OTPLCTBYT;

  10296   1 00007B  8C80 0000 0002  00                   LDI      KH_IO_OTPLCTBYT
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:94   
          1 00007E  8D47 0006                            SDI      KH@IO_OTPLCTBYT,AUTO

      603    10297    3   LOOP: DO WHILE ('1'B);                  /* LOOP START                         */

  10297   1                              LOOP            null
      604    10298
      605    10299        /* THIS LOOP IS TRAVERSED ONCE FOR EACH OUTPUT BUFFER IOLD'D.                 */
      606    10300
      607    10301
      608    10302        /* THERE ARE MORE OUTPUT BUFFERS THAN IN-USE CCB'S, AND THERE                 */
      609    10303        /* ARE FREE CCB'S.                                                            */
      610    10304
      611    10305    3            Y@BFR$ = %KA_CTX.OTPBFRNXTLOD$;

  10305   1 000080  ECC7 0012            LOOP            LDB,B6   BCTX$,AUTO
          1 000082  DCC6 0004                            LDB,B5   4,B6
          1 000084  DFC7 000E                            STB,B5   Y@BFR$,AUTO

      612    10306    4            IF NOT %KV_VDI.PHSDSC AND NOT %KV_VDI.INTPHSDSC THEN DO;

  10306   1 000086  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 000089  BC84                                 LDB,B3   ,B4
          1 00008A  82C3 0019                            LB,'0040'X        25,B3
          1 00008C       0040
          1 00008D  0501 0025                            BBT      s:10329,PREL
          1 00008F  82C3 001D                            LB,'0800'X        29,B3
          1 000091       0800
          1 000092  0501 0020                            BBT      s:10329,PREL

      613    10307
      614    10308        /* We still have something to talk to, honor halt conditions. */
      615    10309
      616    10310    4               IF %KA_CTX.HLTOTP THEN

  10310   1 000094  82C6 001C                            LB,'C000'X        28,B6
  10310   1 000096       C000
          1 000097  0501 00FE                            BBT      s:10429,PREL
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:95   

      617    10311
      618    10312        /* WE CURRENTLY HAVE AN OUTPUT HALT CONDITION* MORE OUTPUT BUFFERS.           */
      619    10313
      620    10314    4               EXIT LOOP;                  /* LOOK BELOW                         */
      621    10315    5               IF Y@BFR$->KA$OTPBFR.HLTOTP_ALL THEN DO;

  10315   1 000099  82C5 0002                            LB,'C000'X        2,B5
  10315   1 00009B       C000
          1 00009C  0581 0016                            BBF      s:10329,PREL

      622    10316
      623    10317        /* THE NEXT BUFFER ELIGIBLE FOR IOLD'ING HAS AN OUTPUT HALT BIT SET.          */
      624    10318
      625    10319    6                  IF (Y@BFR$ = %KA_CTX.OTPBFRHED$) THEN DO;

  10319   1 00009E  DDC6 0002                            CMB,B5   2,B6
          1 0000A0  0981 0010                            BNE      s:10326,PREL

      626    10320
      627    10321        /* THE BUFFER AT THE HEAD OF THE OUTPUT CHAIN HAS AN OUTPUT HALT              */
      628    10322        /* BIT SET*                                                                   */
      629    10323    6                     %KA_CTX.HLTOTP_ALL = Y@BFR$->KA$OTPBFR.HLTOTP_ALL|%KA_CTX.
             10323                              HLTOTP_ALL;

  10323   1 0000A2  E845 0002                            LDR,R6   2,B5
          1 0000A4  E570 C000                            AND,R6   -16384,IMO
          1 0000A6  D846 001C                            LDR,R5   28,B6
          1 0000A8  D570 C000                            AND,R5   -16384,IMO
          1 0000AA  E455                                 OR,R6    R5
          1 0000AB  EAC6 001C                            SRM,R6,'C000'X    28,B6
          1 0000AD       C000

      630    10324    6                     Y@BFR$->KA$OTPBFR.HLTOTP_ALL = '0'B;

  10324   1 0000AE  8845 0002                            LBF,'C000'X       2,B5
  10324   1 0000B0       C000
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:96   

      631    10325    6                  END /* IF */;

      632    10326    5                  EXIT LOOP;               /* LOOK BELOW                         */

  10326   1 0000B1  0F81 00E4                            B        s:10429,PREL

      633    10327    5               END /* IF */;
      634    10328    4            END /* IF */;
      635    10329    4            IF (Y@BFR$ = %KA_CTX.OTPBFRTAL$) THEN DO;

  10329   1 0000B3  DDC6 0006                            CMB,B5   6,B6
          1 0000B5  0981 0026                            BNE      s:10349,PREL

      636    10330    4               IF Y@BFR$~=%KA_CTX.OTPBFRHED$ THEN

  10330   1 0000B7  DDC6 0002                            CMB,B5   2,B6
          1 0000B9  0981 00DC                            BNE      s:10429,PREL

      637    10331
      638    10332        /* THIS IS THE LAST OTP BFR IN THE CHAIN,                                     */
      639    10333        /* AND THERE ARE OTHER OTP BFR'S IOLD'D.                                      */
      640    10334
      641    10335    4               EXIT LOOP;                  /* LOOK BELOW                         */
      642    10336
      643    10337        /* THIS IS THE ONLY OTP BFR IN THE CHAIN.                                     */
      644    10338        /* NO MORE CHARACTERS WILL BE STORED INTO THIS BUFFER.                        */
      645    10339
      646    10340    4              Y@BFR$->KA$OTPBFR.BYTCNT = %KV_VDI.OTPBFR_.BYTX - (LENGTHC(KA$OTPBFR)-1)
             10340                        ;

  10340   1 0000BB  E843 000C                            LDR,R6   12,B3
          1 0000BD  6EF9                                 ADV,R6   -7
          1 0000BE  EAC5 0002                            SRM,R6,'03FF'X    2,B5
          1 0000C0       03FF

      647    10341    4               %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL);
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:97   

  10341   1 0000C1  BC84                                 LDB,B3   ,B4
          1 0000C2  AB80 0000 0000                       LAB,B2   0
          1 0000C5  AFC3 000A                            STB,B2   10,B3

      648    10342    4               %KV_VDI.OTPBFR_.BYTSIZ = 0;

  10342   1 0000C7  BC84                                 LDB,B3   ,B4
          1 0000C8  8743 000D                            CL       13,B3

      649    10343    5               IF Y@BFR$->KA$OTPBFR.BYTCNT=0 THEN DO;

  10343   1 0000CA  82C5 0002                            LB,'03FF'X        2,B5
  10343   1 0000CC       03FF
          1 0000CD  0501 000E                            BBT      s:10349,PREL

      650    10344    5                  %KA_CTX.OTPBFRNXTLOD$ = ADDR(NIL);

  10344   1 0000CF  BB80 0000 0000                       LAB,B3   0
          1 0000D2  BFC6 0004                            STB,B3   4,B6

      651    10345    5                  CALL KAO$OTPINT;    /* Release the buffer - process markers    */

  10345   1 0000D4  CBF0 0000                            LAB,B4   0,IMO
          1 0000D6  E380 0000 0000  xent                 LNJ,B6   KAO$OTPINT
          1 0000D9       0001                            DC       s:10346,PREL

      652    10346    5                  EXIT LOOP;

  10346   1 0000DA  0F81 00BB                            B        s:10429,PREL

      653    10347    5               END;
      654    10348    4            END /* IF */;
      655    10349    4            IF Y@BFR$->KA$OTPBFR.BYTCNT~=0 THEN DO;

  10349   1 0000DC  82C5 0002                            LB,'03FF'X        2,B5
  10349   1 0000DE       03FF
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:98   
          1 0000DF  0581 00A9                            BBF      s:10420,PREL

      656    10350    4               IF %KH_CHN.OTPCCBCNT>=4 OR %KA_CTX.DLTOTPPND THEN

  10350   1 0000E1  BCC7 0010                            LDB,B3   BCHN$,AUTO
          1 0000E3  E843 0007                            LDR,R6   7,B3
          1 0000E5  E570 000F                            AND,R6   15,IMO
          1 0000E7  6D04                                 CMV,R6   4
          1 0000E8  0281 00AD                            BGE      s:10429,PREL
          1 0000EA  82C6 001D                            LB,'0400'X        29,B6
          1 0000EC       0400
          1 0000ED  0501 00A8                            BBT      s:10429,PREL

      657    10351
      658    10352        /* THE OUTPUT CCB COUNT IS 4, SO THERE AREN'T                                 */
      659    10353        /* ANY FREE CCBS TO IOLD.                                                     */
      660    10354
      661    10355    4               EXIT LOOP;                  /* LOOK BELOW                         */
      662    10356    4               KH@IOLD = KH_IOLD;

  10356   1 0000EF  AB80 0000 0000  00                   LAB,B2   KH_IO_INPNXTCCBSTT
          1 0000F2  2C08                                 LDV,R2   8
          1 0000F3  6C0A                                 LDV,R6   10
          1 0000F4  BB87                                 LAB,B3   ,AUTO
          1 0000F5  3C10                                 LDV,R3   16
          1 0000F6  0008                                 MMM

      663    10357    4               KH@IOLD.BFR_.ADR$ = Y@BFR$;

  10357   1 0000F7  ECC7 000E                            LDB,B6   Y@BFR$,AUTO
          1 0000F9  EFC7 0009                            STB,B6   KH@IOLD+1,AUTO

      664    10358    4               KH@IOLD.BFR_.BYTSIZ = Y@BFR$->KA$OTPBFR.BYTCNT;

  10358   1 0000FB  E846 0002                            LDR,R6   2,B6
          1 0000FD  E570 03FF                            AND,R6   1023,IMO
          1 0000FF  EF47 000C                            STR,R6   KH@IOLD+4,AUTO
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:99   

      665    10359    4               KH@IOLD.BFR_.BYTX = (LENGTHC(KA$OTPBFR)-1);

  10359   1 000101  5C07                                 LDV,R5   7
          1 000102  DF47 000B                            STR,R5   KH@IOLD+3,AUTO

      666    10360    4               KH@IOLD.CCBCTR.INTCPU = '1'B;

  10360   1 000104  8947 0008                            LBT,'8000'X       KH@IOLD,AUTO
  10360   1 000106       8000

      667    10361    4               KH@IOLD.CCBCTR.VLDCCB = '1'B;

  10361   1 000107  8947 0008                            LBT,'4000'X       KH@IOLD,AUTO
  10361   1 000109       4000

      668    10362    4               CALL KHI$IOLD(%KH_CHN,KH@IOLD) WHENALTRETURN

  10362   1 00010A  DBC7 0008                            LAB,B5   KH@IOLD,AUTO
          1 00010C  DFC7 0016                            STB,B5   BCTX$+4,AUTO
          1 00010E  CCC7 0010                            LDB,B4   BCHN$,AUTO
          1 000110  CFC7 0014                            STB,B4   BCTX$+2,AUTO
          1 000112  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 000114  CBF0 0200                            LAB,B4   512,IMO
          1 000116  E380 0000 0000  xent                 LNJ,B6   KHI$IOLD
          1 000119       0003                            DC       s:10369,PREL
          1 00011A  0F81 0001                            B        s:10369,PREL

      669    10363    5               DO;

      670    10364    5               END;

      671    10365
      672    10366        /* IOLD AND IO (OUTPUT CCB CONTROL) WERE SUCCESSFUL.                          */
      673    10367        /* UPDATE THE POINTERS.                                                       */
      674    10368
      675    10369    4               %KH_CHN.OTPCCBCNT = %KH_CHN.OTPCCBCNT+1;
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:100  

  10369   1 00011C  ECC7 0010                            LDB,B6   BCHN$,AUTO
          1 00011E  E846 0007                            LDR,R6   7,B6
          1 000120  EA70 0001                            ADD,R6   1,IMO
          1 000122  EAC6 0007                            SRM,R6,'000F'X    7,B6
          1 000124       000F

      676    10370    5               IF NOT %KH_CHN.OTPCCBSTTPTRVLD THEN DO;

  10370   1 000125  82C6 0008                            LB,'0040'X        8,B6
  10370   1 000127       0040
          1 000128  0501 002E                            BBT      s:10407,PREL

      677    10371
      678    10372        /* THE CCB STATUS POINTER (IN THE CLC HARDWARE)                               */
      679    10373        /* DOESN'T POINT TO AN IN-USE CCB                                             */
      680    10374        /* BECAUSE AT SOME POINT WE WOULD LIKE TO                                     */
      681    10375        /* HAVE ADVANCED THE STATUS POINTER VIA                                       */
      682    10376        /* IO (INPUT NEXT CCB STATUS), BUT COULDN'T                                   */
      683    10377        /* BECAUSE WE DIDN'T HAVE ANY IN-USE CCB'S (THE HARDWARE                      */
      684    10378        /* CCB COUNT WAS 0).                                                          */
      685    10379
      686    10380
      687    10381        /* WE'LL DO THE IO (INPUT NEXT CCB STATUS), WHICH                             */
      688    10382        /* INCREMENTS THE STATUS CCB POINTER AND DECREMENTS                           */
      689    10383        /* THE CCB COUNTER IN THE HARDWARE, NOW.                                      */
      690    10384
      691    10385    5                  KH@IO_INPNXTCCBSTT = KH_IO_INPNXTCCBSTT;

  10385   1 00012A  8C80 0000 0000  00                   LDI      KH_IO_INPNXTCCBSTT
          1 00012D  8D47 0004                            SDI      KH@IO_INPNXTCCBSTT,AUTO

      692    10386    5                  CALL KHI$IO_INP(%KH_CHN,KH@IO_INPNXTCCBSTT);

  10386   1 00012F  DBC7 0004                            LAB,B5   KH@IO_INPNXTCCBSTT,AUTO
          1 000131  DFC7 0016                            STB,B5   BCTX$+4,AUTO
          1 000133  EFC7 0014                            STB,B6   BCTX$+2,AUTO
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:101  
          1 000135  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 000137  CBF0 0200                            LAB,B4   512,IMO
          1 000139  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 00013C       0001                            DC       s:10390,PREL

      693    10387        /* THE IO (INPUT NEXT CCB STATUS) WAS SUCCESSFUL,                             */
      694    10388        /* SO SET THE CCB-STATUS-IS-VALID FLAG.                                       */
      695    10389
      696    10390    5                  %KH_CHN.OTPCCBSTTPTRVLD = '1'B;

  10390   1 00013D  ECC7 0010                            LDB,B6   BCHN$,AUTO
          1 00013F  8946 0008                            LBT,'0040'X       8,B6
          1 000141       0040

      697    10391                       %KAC$CLCERRCHK(CCBSTT=KH@IO_INPNXTCCBSTT.CCBSTT,
      698    10392                       CCBSRVERR=YES,
      699    10393                       DATCHKERR=YES,
      700    10394                       INVMMRADR=YES,
      701    10395                       BUSPRTERR=YES,
      702    10396                       UN_CRCMMRERR=YES);

  10400   1 000142  E847 0005                            LDR,R6   KH@IO_INPNXTCCBSTT+1,AUTO
          1 000144  E570 0847                            AND,R6   2119,IMO
          1 000146  6901 0010                            BEZ,R6   s:10407,PREL

  10400   1 000148  EFC7 0016                            STB,B6   BCTX$+4,AUTO
          1 00014A  DB80 0000 0009  00                   LAB,B5   FPT_WRSYSLOG_IO_ERR
          1 00014D  DFC7 0014                            STB,B5   BCTX$+2,AUTO
          1 00014F  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 000151  CBF0 0200                            LAB,B4   512,IMO
          1 000153  E380 0000 0000  xent                 LNJ,B6   KHD$ERRLOG_SETTERMID_CHN
          1 000156       0001                            DC       s:10407,PREL

      703    10402    5               END /* IF NOT CCBSTTPTRVLD */;

      704    10403        /* SINCE ALL OF THE OUTPUT BLED OFF (WAS TRANSFERRED OR DELETED)              */
      705    10404        /* WE SHOULD DO AN IO (OUTPUT CHANNEL CONTROL, START IO) TO                   */
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:102  
      706    10405        /* GET THE OUTPUT CCP GOING, OR MAKE SURE IT IS GOING.                        */
      707    10406
      708    10407    5               IF KH@IO_OTPLCTBYT.LCTBYT='0'B THEN DO;

  10407   1 000157  E847 0007                            LDR,R6   KH@IO_OTPLCTBYT+1,AUTO
          1 000159  6981 002F                            BNEZ,R6  s:10420,PREL

      709    10408
      710    10409        /* WE IOLD'D THE FIRST CCB, SO WE SHOULD DO AN                                */
      711    10410        /* IO TO GET THE COMM LINE CONTROLLER GOING.                                  */
      712    10411
      713    10412    5                  KH@IO_OTPLCTBYT.LCTBYT.ADR = %KW#TRNSTT;

  10412   1 00015B  5C2E                                 LDV,R5   46
          1 00015C  DAC7 0007                            SRM,R5,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
          1 00015E       00FF

      714    10413    5                  KH@IO_OTPLCTBYT.LCTBYT.DAT = BITBIN('3F'X);

  10413   1 00015F  6C3F                                 LDV,R6   63
          1 000160  E7C7 0007                            STH,R6   KH@IO_OTPLCTBYT+1,AUTO

      715    10414    5                  CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);

  10414   1 000162  EBC7 0006                            LAB,B6   KH@IO_OTPLCTBYT,AUTO
          1 000164  EFC7 0016                            STB,B6   BCTX$+4,AUTO
          1 000166  DCC7 0010                            LDB,B5   BCHN$,AUTO
          1 000168  DFC7 0014                            STB,B5   BCTX$+2,AUTO
          1 00016A  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 00016C  CBF0 0200                            LAB,B4   512,IMO
          1 00016E  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTPLCTBYT
          1 000171       0001                            DC       s:10415,PREL

      716    10415    5                  KH@IO_OTPLCTBYT.LCTBYT.ADR = %KW#TRNSTTMSK;

  10415   1 000172  6C2F                                 LDV,R6   47
          1 000173  EAC7 0007                            SRM,R6,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:103  
          1 000175       00FF

      717    10416    5                  KH@IO_OTPLCTBYT.LCTBYT.DAT = BITBIN('FF'X);

  10416   1 000176  8947 0007                            LBT,'FF00'X       KH@IO_OTPLCTBYT+1,AUTO
  10416   1 000178       FF00

      718    10417    5                  CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);

  10417   1 000179  EBC7 0006                            LAB,B6   KH@IO_OTPLCTBYT,AUTO
          1 00017B  EFC7 0016                            STB,B6   BCTX$+4,AUTO
          1 00017D  DCC7 0010                            LDB,B5   BCHN$,AUTO
          1 00017F  DFC7 0014                            STB,B5   BCTX$+2,AUTO
          1 000181  BBC7 0014                            LAB,B3   BCTX$+2,AUTO
          1 000183  CBF0 0200                            LAB,B4   512,IMO
          1 000185  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTPLCTBYT
          1 000188       0001                            DC       s:10420,PREL

      719    10418    5               END /* IF OTPCCBCNT ~= 0 */;

      720    10419    4            END /* IF OTPBFR.BYTCNT ~= 0 */;

      721    10420    3            %KA_CTX.OTPBFRNXTLOD$ = Y@BFR$->KA$OTPBFR.LNK$;

  10420   1 000189  ECC7 000E                            LDB,B6   Y@BFR$,AUTO
          1 00018B  DC86                                 LDB,B5   ,B6
          1 00018C  CCC7 0012                            LDB,B4   BCTX$,AUTO
          1 00018E  DFC4 0004                            STB,B5   4,B4

      722    10421    3            IF (%KA_CTX.OTPBFRNXTLOD$ = ADDR(NIL)) THEN

  10421   1 000190  8DC4 0004                            CMN      4,B4
          1 000192  0901 0003                            BE       s:10429,PREL

      723    10422
      724    10423        /* ALL OUTPUT BUFFERS HAVE BEEN IOLD'D                                        */
      725    10424
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:104  
      726    10425    3            EXIT LOOP;                     /* LOOK BELOW                         */
      727    10426    3         END LOOP;

  10426   1 000194  0F81 FEEB                            B        s:10297,PREL

      728    10427
      729    10428    2      END /* IF IOLD MORE OTPBFRS */;

      730    10429    1   END KAO$TRNOTPIOLD;

  10429   1 000196  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      731    10430
      732    10431        %EOD;

PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:105  
--  Include file information  --

   G_HJIT_M.:E05TOU  is referenced.
   KA_PERR_C.:E05TOU  is referenced.
   KH$IO.:E05TOU  is referenced.
   KW_LCT_E.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLBASM_E.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:106  
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$TRNOTPIOLD.
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:107  

 **** Variables and constants ****

  ****  Section 000 RoData KAO$TRNOTPIOLD

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     9-0-0/w STRC(336)   r     1 FPT_WRSYSLOG_IO_ERR        4-0-0/w STRC(80)    r     1 KH_IOLD
     0-0-0/w STRC(32)    r     1 KH_IO_INPNXTCCBSTT         2-0-0/w STRC(32)    r     1 KH_IO_OTPLCTBYT
    1E-0-0/w UBIN(16)    r     1 Y_POWER_OF_2(0:15)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    10-0-0/w PTR         r     1 BCHN$                     12-0-0/w PTR         r     1 BCTX$
     8-0-0/w STRC(80)    r     1 KH@IOLD                    4-0-0/w STRC(32)    r     1 KH@IO_INPNXTCCBSTT
     6-0-0/w STRC(32)    r     1 KH@IO_OTPLCTBYT            E-0-0/w PTR         r     1 Y@BFR$
     D-0-0/w UBIN(16)    r     1 Y@BYTCNT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$UHJIT$                   0-0-0/w UBIN(16)    r     1 KA_OTPBFRBYTSIZ_SML
     0-0-0/w UBIN(16)    r     1 KA_OTPBFRBYTSIZ_SMLLOG2
     0-0-0/w STRC(2528)  r     1 KA_STT                     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KA$CTX                     0-0-0/w STRC(64)    r     1 KA$OTPBFR
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(480)   r     1 KV$PTR
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:108  
     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KAO$TRNOTPIOLD requires 409 words for executable code.
   Procedure KAO$TRNOTPIOLD requires 24 words of local(AUTO) storage.
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:109  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:110  
          MINI XREF LISTING

BCHN$
     10229**DCL      3901--IMP-PTR 10288<<ASSIGN  10289>>ASSIGN  10292>>IF      10350>>IF      10362>>CALL
     10369>>ASSIGN  10369>>ASSIGN  10370>>IF      10386>>CALL    10390>>ASSIGN  10400>>CALL    10414>>CALL
     10417>>CALL
BCTX$
     10230**DCL      5132--IMP-PTR 10239<<ASSIGN  10244>>ASSIGN  10260>>ASSIGN  10278>>ASSIGN  10289<<ASSIGN
     10292>>IF      10305>>ASSIGN  10310>>IF      10319>>IF      10323>>ASSIGN  10323>>ASSIGN  10329>>IF
     10330>>IF      10344>>ASSIGN  10350>>IF      10420>>ASSIGN  10421>>IF
FPT_WRSYSLOG_IO_ERR
      7014**DCL     10400<>CALL
FPT_WRSYSLOG_IO_ERR.V
      7018**DCL      7016--DCLINIT
FPT_WRSYSLOG_IO_ERR.V.TERMID.TERM
      7083**DCL      7092--REDEF
G$UHJIT.ISA_USR
      8687**DCL      8982--REDEF
G$UHJIT.ISA_USR.P$$
      8762**DCL      8762--REDEF
G$UHJIT.TSA_CP.ISA.P$$
      9969**DCL      9969--REDEF
G$UHJIT.TSA_CP.P$$
      9840**DCL      9840--REDEF    9841--REDEF
G$UHJIT.TSA_DB.ISA.P$$
      9581**DCL      9581--REDEF
G$UHJIT.TSA_DB.P$$
      9452**DCL      9452--REDEF    9453--REDEF
G$UHJIT.TSA_RTT.P$$
     10215**DCL     10215--REDEF   10216--REDEF
G$UHJIT.TSA_USR.ISA.P$$
      9171**DCL      9171--REDEF
G$UHJIT.TSA_USR.P$$
      9042**DCL      9042--REDEF    9043--REDEF
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:111  
G$UHJIT$
     10221**DCL      7264--IMP-PTR
KA$CTX.DLTOTPPND
      5233**DCL     10350>>IF
KA$CTX.HLTOTP
      5227**DCL      5229--REDEF   10310>>IF
KA$CTX.HLTOTPNXTBFR
      5231**DCL      5232--REDEF
KA$CTX.HLTOTP_ALL
      5229**DCL     10323<<ASSIGN  10323>>ASSIGN
KA$CTX.OTPBFRHED$
      5139**DCL     10319>>IF      10330>>IF
KA$CTX.OTPBFRNXTLOD$
      5139**DCL     10292>>IF      10305>>ASSIGN  10344<<ASSIGN  10420<<ASSIGN  10421>>IF
KA$CTX.OTPBFRTAL$
      5140**DCL     10244>>ASSIGN  10329>>IF
KA$CTX.PRVOTPBFRDATEXCSML
      5229**DCL     10260<<ASSIGN  10278<<ASSIGN
KA$OTPBFR
      5257**DCL     10245--ASSIGN  10253--ASSIGN  10340--ASSIGN  10359--ASSIGN
KA$OTPBFR.BYTCNT
      5263**DCL     10245<<ASSIGN  10246>>ASSIGN  10340<<ASSIGN  10343>>IF      10349>>IF      10358>>ASSIGN
KA$OTPBFR.BYTSIZLOG2
      5262**DCL     10261>>IF      10265>>IF
KA$OTPBFR.HLTOTP
      5261**DCL      5262--REDEF
KA$OTPBFR.HLTOTP_ALL
      5262**DCL     10315>>IF      10323>>ASSIGN  10324<<ASSIGN
KA$OTPBFR.LNK$
      5261**DCL     10420>>ASSIGN
KA$OTPBFR.NMBMRK
      5263**DCL     10247>>IF
KAO$OTPINT
      7097**DCL-ENT 10345--CALL
KA_OTPBFRBYTSIZ_SML
      4740**DCL     10254>>IF
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:112  
KA_OTPBFRBYTSIZ_SMLLOG2
      4741**DCL     10265>>IF
KA_STT.OTPBFRFULCNT_BIG
      5087**DCL     10274<<ASSIGN  10274>>ASSIGN
KA_STT.OTPBFRFULCNT_SML
      5087**DCL     10269<<ASSIGN  10269>>ASSIGN
KA_STT.REQSTATS.DSPMSK
      5010**DCL      5016--REDEF
KA_STT.REQSTATS.SLCMSK
      5051**DCL      5058--REDEF
KH$CHN
      3901**DCL     10362<>CALL    10386<>CALL    10400<>CALL    10414<>CALL    10417<>CALL
KH$CHN.CTX$
      3971**DCL     10289>>ASSIGN
KH$CHN.OTPCCBCNT
      3945**DCL     10292>>IF      10350>>IF      10369<<ASSIGN  10369>>ASSIGN
KH$CHN.OTPCCBSTTPTRVLD
      3954**DCL     10370>>IF      10390<<ASSIGN
KH$CHN.TERMID.TERM
      3997**DCL      4006--REDEF
KH@IOLD
      6943**DCL     10356<<ASSIGN  10362<>CALL
KH@IOLD.BFR_.ADR$
      6976**DCL     10357<<ASSIGN
KH@IOLD.BFR_.BYTSIZ
      6976**DCL     10358<<ASSIGN
KH@IOLD.BFR_.BYTX
      6976**DCL     10359<<ASSIGN
KH@IOLD.CCBCTR.INTCPU
      6950**DCL     10360<<ASSIGN
KH@IOLD.CCBCTR.VLDCCB
      6950**DCL     10361<<ASSIGN
KH@IO_INPNXTCCBSTT
      6713**DCL     10385<<ASSIGN  10386<>CALL
KH@IO_INPNXTCCBSTT.ASNSTT
      6722**DCL      6723--REDEF    6729--REDEF    6734--REDEF    6738--REDEF    6742--REDEF    6746--REDEF
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:113  
      6753--REDEF    6759--REDEF    6765--REDEF    6770--REDEF    6777--REDEF    6780--REDEF    6784--REDEF
      6791--REDEF    6795--REDEF    6799--REDEF    6803--REDEF    6808--REDEF    6812--REDEF
KH@IO_INPNXTCCBSTT.CCBSTT
      6784**DCL     10400>>IF
KH@IO_OTPLCTBYT
      6827**DCL     10296<<ASSIGN  10414<>CALL    10417<>CALL
KH@IO_OTPLCTBYT.ASNSTT
      6836**DCL      6837--REDEF    6843--REDEF    6848--REDEF    6852--REDEF    6856--REDEF    6860--REDEF
      6867--REDEF    6873--REDEF    6879--REDEF    6884--REDEF    6891--REDEF    6894--REDEF    6898--REDEF
      6905--REDEF    6909--REDEF    6913--REDEF    6917--REDEF    6922--REDEF    6926--REDEF
KH@IO_OTPLCTBYT.LCTBYT
      6843**DCL     10407>>IF
KH@IO_OTPLCTBYT.LCTBYT.ADR
      6843**DCL     10412<<ASSIGN  10415<<ASSIGN
KH@IO_OTPLCTBYT.LCTBYT.DAT
      6843**DCL     10413<<ASSIGN  10416<<ASSIGN
KHD$ERRLOG_SETTERMID_CHN
      4418**DCL-ENT 10400--CALL
KHI$IOLD
      7100**DCL-ENT 10362--CALL
KHI$IO_INP
      7098**DCL-ENT 10386--CALL
KHI$IO_OTPLCTBYT
      7099**DCL-ENT 10414--CALL    10417--CALL
KH_CHNHI
      4064**DCL      4065--REDEF
KH_CHNLOW
      4065**DCL      4066--REDEF
KH_IOLD
      6664**DCL     10356>>ASSIGN
KH_IO_INPNXTCCBSTT
      6434**DCL     10385>>ASSIGN
KH_IO_OTPLCTBYT
      6548**DCL     10296>>ASSIGN
KV$PTR.INPCNDPND
      5993**DCL      6002--REDEF    6006--REDEF
PL6.E3A0      #003=KAO$TRNOTPIOLD File=KAO$OTP.:E05TSI                           TUE 07/29/97 23:58 Page:114  
KV$PTR.LINLST$
      5989**DCL      5990--REDEF
KV$PTR.VDI$
      5987**DCL     10239>>ASSIGN  10240>>IF      10245>>ASSIGN  10251>>ASSIGN  10252>>ASSIGN  10288>>ASSIGN
     10306>>IF      10306>>IF      10340>>ASSIGN  10341>>ASSIGN  10342>>ASSIGN
KV$PTR$
      5981**DCL      5987--IMP-PTR 10239>>ASSIGN  10240>>IF      10245>>ASSIGN  10251>>ASSIGN  10252>>ASSIGN
     10288>>ASSIGN  10306>>IF      10306>>IF      10340>>ASSIGN  10341>>ASSIGN  10342>>ASSIGN
KV$SSN.REDRSPCNT
      5916**DCL      5917--REDEF
KV$TRNTBL.OTPESCCHR
      6132**DCL      6132--REDEF
KV$VDI.CHN$
      6030**DCL     10288>>ASSIGN
KV$VDI.INTPHSDSC
      6069**DCL     10306>>IF
KV$VDI.OTPBFR_.ADR$
      6056**DCL     10240>>IF      10251<<ASSIGN  10341<<ASSIGN
KV$VDI.OTPBFR_.BYTSIZ
      6056**DCL     10252<<ASSIGN  10342<<ASSIGN
KV$VDI.OTPBFR_.BYTX
      6056**DCL     10245>>ASSIGN  10340>>ASSIGN
KV$VDI.PHSDSC
      6065**DCL     10306>>IF
KV$VDI.USRCTX$
      6030**DCL     10239>>ASSIGN
LOOP
     10297**LABEL   10314--EXIT    10326--EXIT    10335--EXIT    10346--EXIT    10355--EXIT    10425--EXIT
Y@BFR$
     10228**DCL     10244<<ASSIGN  10245>>ASSIGN  10246>>ASSIGN  10247>>IF      10261>>IF      10265>>IF
     10305<<ASSIGN  10315>>IF      10319>>IF      10323>>ASSIGN  10324>>ASSIGN  10329>>IF      10330>>IF
     10340>>ASSIGN  10343>>IF      10349>>IF      10357>>ASSIGN  10358>>ASSIGN  10420>>ASSIGN
Y@BYTCNT
     10227**DCL     10246<<ASSIGN  10247>>IF      10253<<ASSIGN  10253>>ASSIGN  10254>>IF      10261>>IF
Y_POWER_OF_2
     10232**DCL     10261>>IF

PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:115  
      733        1        /*T***********************************************************/
      734        2        /*T*                                                         */
      735        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      736        4        /*T*                                                         */
      737        5        /*T***********************************************************/
      738        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      739        7
      740        8
      741        9
      742       10        /* Delete output buffers. We get here via                                     */
      743       11        /* KV$USR_EVT/%KV_USR_EVT_ID_DLTOTP.                                          */
      744       12
      745       13        KAO$DLTOTP: PROC(PRM_USR_EVT);
      746       14        %INCLUDE KH$CHN;
      747      136        %KH$CHN;                                /*  CHANNEL TABLES ITEM DEFINITONS    */
      748      260 S      %INCLUDE KV$GLB;
      749      261 S      %INCLUDE KV$GLBCTX;
      750      262 S      %INCLUDE KV$USR;
      751      263        %KV$USR_EVT(NAME=PRM_USR_EVT,STCLASS=);
      752      298
      753      299        %INCLUDE KA$GLB;
      754      440        %INCLUDE KA_GLB;
      755      517        %INCLUDE KA_GLBASM_E;
      756      599        %INCLUDE KA_GLB_E;
      757      677        %KA_HLTOTP_E;
      758      686        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      759      810        %KA$OTPBFR(STCLASS = "BASED(Y@BFR$)");  /*  ASYNC output buffer               */
      760      838        %KV$PTR;                                /*  VDH Pointers, status              */
      761      881        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      762      952
      763      953    1   DCL Y@BFR$ PTR;
      764      954    1   DCL Y@CRTCNF_IN_BFR BIT(1) UNAL;
      765      955    1   DCL KAO$ASNRQS ENTRY(3) ALTRET;
      766      956    1   DCL KAO$BFRCRTCNF ENTRY;
      767      957    1   DCL KAO$OTPINT ENTRY;
      768      958
      769      959        /*
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:116  
      770      960           Tell MLCP to purge output.
      771      961        */
      772      962    2      IF %KH_CHN.OTPCCBCNT~=0 THEN DO;
      773      963    2         %KA_CTX.DLTOTPPND = '1'B;
      774      964    2         CALL KAO$ASNRQS(%KA#OTPASNRQS_PRG);
      775      965    2      END;
      776      966    1      Y@CRTCNF_IN_BFR = '0'B;
      777      967    1      %KA_CTX.HLTOTP = '0'B;
      778      968    1      %KA_CTX.HLTOTPNXTBFR = '0'B;
      779      969        /*N* CHECK FOR DVC FLOW ALGO TO SEE IF WE SHOULD RESET DVCHLT?                */
      780      970        /*N* WHEN SETTING PRG.BIT, CHECK OTPCTRSTRCNT IN MLCP IF NO BUFFERS Q'D?      */
      781      971    1      %KA_CTX.ASNHLTOTP = '0'B;
      782      972
      783      973    1      Y@BFR$ = %KA_CTX.OTPBFRHED$;
      784      974    2      IF (Y@BFR$ ~= ADDR(NIL)) THEN DO;
      785      975
      786      976        /* THERE IS AN OUTPUT CHAIN TO RELEASE.                                       */
      787      977
      788      978    3   LOOP: DO WHILE (Y@BFR$ ~= ADDR(NIL));   /* LOOP START                         */
      789      979
      790      980    4            IF Y@BFR$=%KV_VDI.OTPBFR_.ADR$ THEN DO;
      791      981    4               KA$OTPBFR.BYTCNT = %KV_VDI.OTPBFR_.BYTX-LENGTHV(KA$OTPBFR);
      792      982    4               %KV_VDI.OTPBFR_.BYTSIZ = 0;
      793      983    4               %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL);
      794      984    4            END /* IF */;
      795      985        /* THIS LOOP IS TRAVERSED ONCE FOR EACH OUTPUT BUFFER EXAMINED.               */
      796      986
      797      987    4            IF (KA$OTPBFR.BYTCNT ~= 0) THEN DO;
      798      988
      799      989    5               IF KA$OTPBFR.CRTCNF_IN_BFR THEN DO;
      800      990    5                  Y@CRTCNF_IN_BFR = '0'B;
      801      991    5                  IF KA$OTPBFR.BYTCNT=3 AND KA$OTPBFR.LNK$=ADDR(NIL)
      802      992        /*
      803      993           This is the last buffer, and has only the CONFIG info. Leave it be.
      804      994        */
      805      995    5                  THEN EXIT LOOP;
      806      996    5                  Y@CRTCNF_IN_BFR = '1'B;
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:117  
      807      997    5               END;                        /* IF                                 */
      808      998    4               PRM_USR_EVT.ACT = '1'B;
      809      999    4            END /* IF */;
      810     1000    4            IF Y@BFR$=%KA_CTX.OTPBFRNXTLOD$ THEN DO;
      811     1001
      812     1002        /* This one will never get loaded (poor thing). Fix its bytecount. */
      813     1003
      814     1004    4               %KA_CTX.OTPBFRNXTLOD$ = KA$OTPBFR.LNK$;
      815     1005    4               KA$OTPBFR.BYTCNT = 0;
      816     1006    4            END;
      817     1007    3            Y@BFR$ = KA$OTPBFR.LNK$;
      818     1008    3         END /* LOOP */;
      819     1009    2         %KA_CTX.PRVOTPBFRDATEXCSML = '0'B;
      820     1010    2         %KV_VDI.OTPCNDPND = '0'B;
      821     1011    2         %KV_VDI.RE_DSPINP = '0'B;
      822     1012    2         CALL KAO$OTPINT;
      823     1013
      824     1014    2      END /* IF */;
      825     1015    2      IF Y@CRTCNF_IN_BFR THEN DO;
      826     1016
      827     1017        /* THE CURRENT CONFIGURATION INFORMATION (KA_LCT_CRTCNF) WAS                  */
      828     1018        /* BUFFERED IN THE OUTPUT BUFFERS. ASSUME WE DELETED THE BUFFER               */
      829     1019        /* CONTAINING THE INFORMATION BEFORE IT WAS PROCESSED, AND                    */
      830     1020        /* BUFFER IT AGAIN.                                                           */
      831     1021
      832     1022    2         CALL KAO$BFRCRTCNF;
      833     1023    2      END /* IF */;
      834     1024    1   END KAO$DLTOTP;
      835     1025
      836     1026        %EOD;

PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:118  
--  Include file information  --

   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KAO$DLTOTP.

   Procedure KAO$DLTOTP requires 174 words for executable code.
   Procedure KAO$DLTOTP requires 10 words of local(AUTO) storage.

PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:119  

 Object Unit name= KAO$DLTOTP                                 File name= KAO$OTP.:E05TOU
 UTS= JUL 30 '97 00:01:02.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   174     AE  KAO$DLTOTP
    1  RoData even  none     3      3  KAO$DLTOTP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KAO$DLTOTP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KAO$ASNRQS
         yes           Std       0 KAO$OTPINT
         yes           Std       0 KAO$BFRCRTCNF
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                          r    G$ROS$
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:120  


      733        1        /*T***********************************************************/
      734        2        /*T*                                                         */
      735        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      736        4        /*T*                                                         */
      737        5        /*T***********************************************************/
      738        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      739        7
      740        8
      741        9
      742       10        /* Delete output buffers. We get here via                                     */
      743       11        /* KV$USR_EVT/%KV_USR_EVT_ID_DLTOTP.                                          */
      744       12
      745       13        KAO$DLTOTP: PROC(PRM_USR_EVT);

     13   0 000000  D380 0000 0000  xent KAO$DLTOTP      LNJ,B5   X6A_AUTO_1
          0 000003       000A 0001                       DC       10,1

      746       14        %INCLUDE KH$CHN;
      747      136        %KH$CHN;                                /*  CHANNEL TABLES ITEM DEFINITONS    */
      748      260 S      %INCLUDE KV$GLB;
      749      261 S      %INCLUDE KV$GLBCTX;
      750      262 S      %INCLUDE KV$USR;
      751      263        %KV$USR_EVT(NAME=PRM_USR_EVT,STCLASS=);
      752      298
      753      299        %INCLUDE KA$GLB;
      754      440        %INCLUDE KA_GLB;
      755      517        %INCLUDE KA_GLBASM_E;
      756      599        %INCLUDE KA_GLB_E;
      757      677        %KA_HLTOTP_E;
      758      686        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      759      810        %KA$OTPBFR(STCLASS = "BASED(Y@BFR$)");  /*  ASYNC output buffer               */
      760      838        %KV$PTR;                                /*  VDH Pointers, status              */
      761      881        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      762      952
      763      953    1   DCL Y@BFR$ PTR;
      764      954    1   DCL Y@CRTCNF_IN_BFR BIT(1) UNAL;
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:121  
      765      955    1   DCL KAO$ASNRQS ENTRY(3) ALTRET;
      766      956    1   DCL KAO$BFRCRTCNF ENTRY;
      767      957    1   DCL KAO$OTPINT ENTRY;
      768      958
      769      959        /*
      770      960           Tell MLCP to purge output.
      771      961        */
      772      962    2      IF %KH_CHN.OTPCCBCNT~=0 THEN DO;

    962   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DC86                                 LDB,B5   ,B6
          0 000009  CC85                                 LDB,B4   ,B5
          0 00000A  82C4 0007                            LB,'000F'X        7,B4
          0 00000C       000F
          0 00000D  0581 000F                            BBF      s:966,PREL

      773      963    2         %KA_CTX.DLTOTPPND = '1'B;

    963   0 00000F  BCC5 0002                            LDB,B3   2,B5
          0 000011  8943 001D                            LBT,'0400'X       29,B3
          0 000013       0400

      774      964    2         CALL KAO$ASNRQS(%KA#OTPASNRQS_PRG);

    964   0 000014  BB80 0000 0001  01                   LAB,B3   +1
          0 000017  CBF0 0100                            LAB,B4   256,IMO
          0 000019  E380 0000 0000  xent                 LNJ,B6   KAO$ASNRQS
          0 00001C       0001                            DC       s:966,PREL

      775      965    2      END;

      776      966    1      Y@CRTCNF_IN_BFR = '0'B;

    966   0 00001D  8747 0008                            CL       Y@CRTCNF_IN_BFR,AUTO

      777      967    1      %KA_CTX.HLTOTP = '0'B;

PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:122  
    967   0 00001F  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000022  DC86                                 LDB,B5   ,B6
          0 000023  CCC5 0002                            LDB,B4   2,B5
          0 000025  8844 001C                            LBF,'C000'X       28,B4
          0 000027       C000

      778      968    1      %KA_CTX.HLTOTPNXTBFR = '0'B;

    968   0 000028  DC86                                 LDB,B5   ,B6
          0 000029  CCC5 0002                            LDB,B4   2,B5
          0 00002B  8844 001D                            LBF,'C000'X       29,B4
          0 00002D       C000

      779      969        /*N* CHECK FOR DVC FLOW ALGO TO SEE IF WE SHOULD RESET DVCHLT?                */
      780      970        /*N* WHEN SETTING PRG.BIT, CHECK OTPCTRSTRCNT IN MLCP IF NO BUFFERS Q'D?      */
      781      971    1      %KA_CTX.ASNHLTOTP = '0'B;

    971   0 00002E  DC86                                 LDB,B5   ,B6
          0 00002F  CCC5 0002                            LDB,B4   2,B5
          0 000031  8844 001D                            LBF,'0200'X       29,B4
          0 000033       0200

      782      972
      783      973    1      Y@BFR$ = %KA_CTX.OTPBFRHED$;

    973   0 000034  DC86                                 LDB,B5   ,B6
          0 000035  CCC5 0002                            LDB,B4   2,B5
          0 000037  BCC4 0002                            LDB,B3   2,B4
          0 000039  BFC7 0006                            STB,B3   Y@BFR$,AUTO

      784      974    2      IF (Y@BFR$ ~= ADDR(NIL)) THEN DO;

    974   0 00003B  8DC7 0006                            CMN      Y@BFR$,AUTO
          0 00003D  0901 0063                            BE       s:1015,PREL

      785      975
      786      976        /* THERE IS AN OUTPUT CHAIN TO RELEASE.                                       */
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:123  
      787      977
      788      978    3   LOOP: DO WHILE (Y@BFR$ ~= ADDR(NIL));   /* LOOP START                         */

    978   0 00003F  0F81 004A            LOOP            B        s:1008,PREL

      789      979
      790      980    4            IF Y@BFR$=%KV_VDI.OTPBFR_.ADR$ THEN DO;

    980   0 000041  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000044  DC86                                 LDB,B5   ,B6
          0 000045  CCC7 0006                            LDB,B4   Y@BFR$,AUTO
          0 000047  CDC5 000A                            CMB,B4   10,B5
          0 000049  0981 0010                            BNE      s:987,PREL

      791      981    4               KA$OTPBFR.BYTCNT = %KV_VDI.OTPBFR_.BYTX-LENGTHV(KA$OTPBFR);

    981   0 00004B  E845 000C                            LDR,R6   12,B5
          0 00004D  6EF9                                 ADV,R6   -7
          0 00004E  EAC4 0002                            SRM,R6,'03FF'X    2,B4
          0 000050       03FF

      792      982    4               %KV_VDI.OTPBFR_.BYTSIZ = 0;

    982   0 000051  DC86                                 LDB,B5   ,B6
          0 000052  8745 000D                            CL       13,B5

      793      983    4               %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL);

    983   0 000054  DC86                                 LDB,B5   ,B6
          0 000055  BB80 0000 0000                       LAB,B3   0
          0 000058  BFC5 000A                            STB,B3   10,B5

      794      984    4            END /* IF */;

      795      985        /* THIS LOOP IS TRAVERSED ONCE FOR EACH OUTPUT BUFFER EXAMINED.               */
      796      986
      797      987    4            IF (KA$OTPBFR.BYTCNT ~= 0) THEN DO;
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:124  

    987   0 00005A  82C4 0002                            LB,'03FF'X        2,B4
    987   0 00005C       03FF
          0 00005D  0581 0019                            BBF      s:1000,PREL

      798      988
      799      989    5               IF KA$OTPBFR.CRTCNF_IN_BFR THEN DO;

    989   0 00005F  82C4 0003                            LB,'0200'X        3,B4
    989   0 000061       0200
          0 000062  0581 0010                            BBF      s:998,PREL

      800      990    5                  Y@CRTCNF_IN_BFR = '0'B;

    990   0 000064  8747 0008                            CL       Y@CRTCNF_IN_BFR,AUTO

      801      991    5                  IF KA$OTPBFR.BYTCNT=3 AND KA$OTPBFR.LNK$=ADDR(NIL)

    991   0 000066  E844 0002                            LDR,R6   2,B4
          0 000068  E570 03FF                            AND,R6   1023,IMO
          0 00006A  6D03                                 CMV,R6   3
          0 00006B  0981 0004                            BNE      s:996,PREL
          0 00006D  8D84                                 CMN      ,B4
          0 00006E  0901 001F                            BE       s:1009,PREL

      802      992        /*
      803      993           This is the last buffer, and has only the CONFIG info. Leave it be.
      804      994        */
      805      995    5                  THEN EXIT LOOP;
      806      996    5                  Y@CRTCNF_IN_BFR = '1'B;

    996   0 000070  8947 0008                            LBT,'8000'X       Y@CRTCNF_IN_BFR,AUTO
    996   0 000072       8000

      807      997    5               END;                        /* IF                                 */

      808      998    4               PRM_USR_EVT.ACT = '1'B;
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:125  

    998   0 000073  DCC7 0004                            LDB,B5   @PRM_USR_EVT,AUTO
          0 000075  8905                                 LBT,'0080'X       ,B5
          0 000076       0080

      809      999    4            END /* IF */;

      810     1000    4            IF Y@BFR$=%KA_CTX.OTPBFRNXTLOD$ THEN DO;

   1000   0 000077  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00007A  DC86                                 LDB,B5   ,B6
          0 00007B  BCC5 0002                            LDB,B3   2,B5
          0 00007D  CDC3 0004                            CMB,B4   4,B3
          0 00007F  0981 0007                            BNE      s:1007,PREL

      811     1001
      812     1002        /* This one will never get loaded (poor thing). Fix its bytecount. */
      813     1003
      814     1004    4               %KA_CTX.OTPBFRNXTLOD$ = KA$OTPBFR.LNK$;

   1004   0 000081  AC84                                 LDB,B2   ,B4
          0 000082  AFC3 0004                            STB,B2   4,B3

      815     1005    4               KA$OTPBFR.BYTCNT = 0;

   1005   0 000084  8844 0002                            LBF,'03FF'X       2,B4
   1005   0 000086       03FF

      816     1006    4            END;

      817     1007    3            Y@BFR$ = KA$OTPBFR.LNK$;

   1007   0 000087  DC84                                 LDB,B5   ,B4
          0 000088  DFC7 0006                            STB,B5   Y@BFR$,AUTO

      818     1008    3         END /* LOOP */;

PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:126  
   1008   0 00008A  8DC7 0006                            CMN      Y@BFR$,AUTO
          0 00008C  0981 FFB4                            BNE      s:980,PREL

      819     1009    2         %KA_CTX.PRVOTPBFRDATEXCSML = '0'B;

   1009   0 00008E  DC86                                 LDB,B5   ,B6
          0 00008F  CCC5 0002                            LDB,B4   2,B5
          0 000091  8844 001C                            LBF,'2000'X       28,B4
          0 000093       2000

      820     1010    2         %KV_VDI.OTPCNDPND = '0'B;

   1010   0 000094  DC86                                 LDB,B5   ,B6
          0 000095  8745 001A                            CL       26,B5

      821     1011    2         %KV_VDI.RE_DSPINP = '0'B;

   1011   0 000097  DC86                                 LDB,B5   ,B6
          0 000098  8845 0019                            LBF,'0010'X       25,B5
          0 00009A       0010

      822     1012    2         CALL KAO$OTPINT;

   1012   0 00009B  CBF0 0000                            LAB,B4   0,IMO
          0 00009D  E380 0000 0000  xent                 LNJ,B6   KAO$OTPINT
          0 0000A0       0001                            DC       s:1015,PREL

      823     1013
      824     1014    2      END /* IF */;

      825     1015    2      IF Y@CRTCNF_IN_BFR THEN DO;

   1015   0 0000A1  89C7 0008                            CMZ      Y@CRTCNF_IN_BFR,AUTO
          0 0000A3  0881 0007                            BAGE     s:1024,PREL

      826     1016
      827     1017        /* THE CURRENT CONFIGURATION INFORMATION (KA_LCT_CRTCNF) WAS                  */
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:127  
      828     1018        /* BUFFERED IN THE OUTPUT BUFFERS. ASSUME WE DELETED THE BUFFER               */
      829     1019        /* CONTAINING THE INFORMATION BEFORE IT WAS PROCESSED, AND                    */
      830     1020        /* BUFFER IT AGAIN.                                                           */
      831     1021
      832     1022    2         CALL KAO$BFRCRTCNF;

   1022   0 0000A5  CBF0 0000                            LAB,B4   0,IMO
          0 0000A7  E380 0000 0000  xent                 LNJ,B6   KAO$BFRCRTCNF
          0 0000AA       0001                            DC       s:1024,PREL

      833     1023    2      END /* IF */;

      834     1024    1   END KAO$DLTOTP;

   1024   0 0000AB  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      835     1025
      836     1026        %EOD;

PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:128  
--  Include file information  --

   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KAO$DLTOTP.
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:129  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PRM_USR_EVT              *0-0-0/w STRC(32)    r     1 PRM_USR_EVT
     6-0-0/w PTR         r     1 Y@BFR$                     8-0-0/b BIT         r     1 Y@CRTCNF_IN_BFR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KA$CTX                     0-0-0/w STRC(64)    r     1 KA$OTPBFR
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KAO$DLTOTP requires 174 words for executable code.
   Procedure KAO$DLTOTP requires 10 words of local(AUTO) storage.
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:130  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:131  
          MINI XREF LISTING

KA$CTX.ASNHLTOTP
       807**DCL       971<<ASSIGN
KA$CTX.DLTOTPPND
       806**DCL       963<<ASSIGN
KA$CTX.HLTOTP
       800**DCL       802--REDEF     967<<ASSIGN
KA$CTX.HLTOTPNXTBFR
       804**DCL       805--REDEF     968<<ASSIGN
KA$CTX.OTPBFRHED$
       712**DCL       973>>ASSIGN
KA$CTX.OTPBFRNXTLOD$
       712**DCL      1000>>IF       1004<<ASSIGN
KA$CTX.PRVOTPBFRDATEXCSML
       802**DCL      1009<<ASSIGN
KA$OTPBFR
       829**DCL       981--ASSIGN
KA$OTPBFR.BYTCNT
       835**DCL       981<<ASSIGN    987>>IF        991>>IF       1005<<ASSIGN
KA$OTPBFR.CRTCNF_IN_BFR
       836**DCL       989>>IF
KA$OTPBFR.HLTOTP
       833**DCL       834--REDEF
KA$OTPBFR.LNK$
       833**DCL       991>>IF       1004>>ASSIGN   1007>>ASSIGN
KAO$ASNRQS
       955**DCL-ENT   964--CALL
KAO$BFRCRTCNF
       956**DCL-ENT  1022--CALL
KAO$OTPINT
       957**DCL-ENT  1012--CALL
KH$CHN.OTPCCBCNT
       195**DCL       962>>IF
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:132  
KH$CHN.TERMID.TERM
       247**DCL       256--REDEF
KV$PTR.INPCNDPND
       865**DCL       874--REDEF     878--REDEF
KV$PTR.LINLST$
       861**DCL       862--REDEF
KV$PTR.VDI$
       859**DCL       962>>IF        963>>ASSIGN    967>>ASSIGN    968>>ASSIGN    971>>ASSIGN    973>>ASSIGN
       980>>IF        981>>ASSIGN    982>>ASSIGN    983>>ASSIGN   1000>>IF       1004>>ASSIGN   1009>>ASSIGN
      1010>>ASSIGN   1011>>ASSIGN
KV$PTR$
       853**DCL       859--IMP-PTR   962>>IF        963>>ASSIGN    967>>ASSIGN    968>>ASSIGN    971>>ASSIGN
       973>>ASSIGN    980>>IF        981>>ASSIGN    982>>ASSIGN    983>>ASSIGN   1000>>IF       1004>>ASSIGN
      1009>>ASSIGN   1010>>ASSIGN   1011>>ASSIGN
KV$VDI.CHN$
       902**DCL       962>>IF
KV$VDI.OTPBFR_.ADR$
       928**DCL       980>>IF        983<<ASSIGN
KV$VDI.OTPBFR_.BYTSIZ
       928**DCL       982<<ASSIGN
KV$VDI.OTPBFR_.BYTX
       928**DCL       981>>ASSIGN
KV$VDI.OTPCNDPND
       939**DCL      1010<<ASSIGN
KV$VDI.RE_DSPINP
       937**DCL      1011<<ASSIGN
KV$VDI.USRCTX$
       902**DCL       963>>ASSIGN    967>>ASSIGN    968>>ASSIGN    971>>ASSIGN    973>>ASSIGN   1000>>IF
      1004>>ASSIGN   1009>>ASSIGN
LOOP
       978**LABEL     995--EXIT
PRM_USR_EVT
       290**DCL        13--PROC
PRM_USR_EVT.ACT
       296**DCL       998<<ASSIGN
Y@BFR$
PL6.E3A0      #004=KAO$DLTOTP File=KAO$OTP.:E05TSI                               WED 07/30/97 00:01 Page:133  
       953**DCL       829--IMP-PTR   973<<ASSIGN    974>>IF        978>>DOWHILE   980>>IF        981>>ASSIGN
       987>>IF        989>>IF        991>>IF        991>>IF       1000>>IF       1004>>ASSIGN   1005>>ASSIGN
      1007<<ASSIGN   1007>>ASSIGN
Y@CRTCNF_IN_BFR
       954**DCL       966<<ASSIGN    990<<ASSIGN    996<<ASSIGN   1015>>IF

PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:134  
      837        1        /*T***********************************************************/
      838        2        /*T*                                                         */
      839        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      840        4        /*T*                                                         */
      841        5        /*T***********************************************************/
      842        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      843        7
      844        8
      845        9        KAO$ASNRQSHLTOTP: PROC (PARM1);
      846       10 S      %INCLUDE KV$GLB;
      847       11 S      %INCLUDE KV_GLBCNS_E;
      848       12 S      %INCLUDE KV$GLBCTX;
      849       13
      850       14        %INCLUDE KV_GLB_M;
      851      136        %INCLUDE KA$GLB;
      852      277        %INCLUDE KA_GLB;
      853      354        %INCLUDE KA_GLBASM_E;
      854      436        %INCLUDE KA_GLB_E;
      855      514        %KA_HLTOTP_E;
      856      523 S      %INCLUDE KV$VDH;
      857      524        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      858      648        %KA$OTPBFR;                             /*  ASYNC output buffer               */
      859      676        %INCLUDE LCP_6;
      860      867        %INCLUDE KH$CHN;
      861      989        %KH$CHN;                                /*  CHANNEL TABLES ITEM DEFINITONS    */
      862     1113        %INCLUDE KH_CHN;
      863     1153        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      864     1171        %KV$SSN;                                /*  VDH Session                       */
      865     1250        %KV$PTR;                                /*  VDH Pointers, status              */
      866     1293        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      867     1364
      868     1365    1   DCL KAO$ASNRQS ENTRY(3) ALTRET;
      869     1366    1   DCL PARM1 UBIN;
      870     1367    1   DCL Y@HLTOTP_ALL BIT(8);
      871     1368
      872     1369    2      IF (%KV_VDI.PHSDSC OR %KV_SSN.LGCDSC) THEN DO;
      873     1370
PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:135  
      874     1371        /* WE HAVE A DISCONNECT SITUATION*                                            */
      875     1372    2         RETURN;
      876     1373    2      END /* IF */;
      877     1374    2      IF (%KV_SSN.USRHLTINH AND (PARM1 = %KA#HLTOTP_USRX)) THEN DO;
      878     1375
      879     1376        /* THIS IS A USER OUTPUT HALT REQUEST, AND USER HALTS ARE INHIBITED.          */
      880     1377
      881     1378    2         RETURN;
      882     1379    2      END /* IF */;
      883     1380    1      Y@HLTOTP_ALL = %KA_CTX.HLTOTP_ALL;
      884     1381    1      %KA_CTX.HLTOTP.BITT(PARM1) = '1'B;
      885     1382    2      IF (Y@HLTOTP_ALL) OR (%KA_CTX.OTPBFRTAL$ = ADDR(NIL)) THEN DO;
      886     1383
      887     1384        /* EITHER WE WERE ALREADY HALTED (EITHER SYNCHRONOUSLY OR                     */
      888     1385        /* ASYNCHRONOUSLY) OR THERE IS NO OUTPUT ACTIVE.                              */
      889     1386
      890     1387    2         RETURN;
      891     1388    2      END /* IF */;
      892     1389    1      CALL KAO$ASNRQS(%KA#OTPASNRQS_HLT,%KA#OTPASNRQS_RSM)
      893     1390    2      WHENRETURN DO;
      894     1391        /* The output asynchronous request succeeded.                                 */
      895     1392    2         %KA_CTX.ASNHLTOTP = '1'B;
      896     1393    2      END /* WHENRETURN */;
      897     1394    2      WHENALTRETURN DO;
      898     1395
      899     1396        /* The output asynchronous request failed.                                    */
      900     1397
      901     1398    2         %KA_CTX.HLTOTP.BITT(PARM1) = '0'B;
      902     1399    2      END /* WHENALTRETURN */;
      903     1400
      904     1401    1   END KAO$ASNRQSHLTOTP;
      905     1402
      906     1403        %EOD;

PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:136  
--  Include file information  --

   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$ASNRQSHLTOTP.

   Procedure KAO$ASNRQSHLTOTP requires 106 words for executable code.
   Procedure KAO$ASNRQSHLTOTP requires 8 words of local(AUTO) storage.

PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:137  

 Object Unit name= KAO$ASNRQSHLTOTP                           File name= KAO$OTP.:E05TOU
 UTS= JUL 30 '97 00:01:38.92 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   106     6A  KAO$ASNRQSHLTOTP
    1  RoData even  none     6      6  KAO$ASNRQSHLTOTP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KAO$ASNRQSHLTOTP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KAO$ASNRQS
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNHI                         r    KH_CHNLOW                             KV$PTR$
r    G$ROS$
PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:138  


      837        1        /*T***********************************************************/
      838        2        /*T*                                                         */
      839        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      840        4        /*T*                                                         */
      841        5        /*T***********************************************************/
      842        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      843        7
      844        8
      845        9        KAO$ASNRQSHLTOTP: PROC (PARM1);

      9   0 000000  D380 0000 0000  xent KAO$ASNRQSHLTOTPLNJ,B5   X6A_AUTO_1
          0 000003       0008 0001                       DC       8,1

      846       10 S      %INCLUDE KV$GLB;
      847       11 S      %INCLUDE KV_GLBCNS_E;
      848       12 S      %INCLUDE KV$GLBCTX;
      849       13
      850       14        %INCLUDE KV_GLB_M;
      851      136        %INCLUDE KA$GLB;
      852      277        %INCLUDE KA_GLB;
      853      354        %INCLUDE KA_GLBASM_E;
      854      436        %INCLUDE KA_GLB_E;
      855      514        %KA_HLTOTP_E;
      856      523 S      %INCLUDE KV$VDH;
      857      524        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      858      648        %KA$OTPBFR;                             /*  ASYNC output buffer               */
      859      676        %INCLUDE LCP_6;
      860      867        %INCLUDE KH$CHN;
      861      989        %KH$CHN;                                /*  CHANNEL TABLES ITEM DEFINITONS    */
      862     1113        %INCLUDE KH_CHN;
      863     1153        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      864     1171        %KV$SSN;                                /*  VDH Session                       */
      865     1250        %KV$PTR;                                /*  VDH Pointers, status              */
      866     1293        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      867     1364
      868     1365    1   DCL KAO$ASNRQS ENTRY(3) ALTRET;
PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:139  
      869     1366    1   DCL PARM1 UBIN;
      870     1367    1   DCL Y@HLTOTP_ALL BIT(8);
      871     1368
      872     1369    2      IF (%KV_VDI.PHSDSC OR %KV_SSN.LGCDSC) THEN DO;

   1369   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DC86                                 LDB,B5   ,B6
          0 000009  82C5 0019                            LB,'0040'X        25,B5
          0 00000B       0040
          0 00000C  0501 0008                            BBT      s:1372,PREL
          0 00000E  CCC6 0002                            LDB,B4   2,B6
          0 000010  82C4 0028                            LB,'0400'X        40,B4
          0 000012       0400
          0 000013  0581 0004                            BBF      s:1374,PREL

      873     1370
      874     1371        /* WE HAVE A DISCONNECT SITUATION*                                            */
      875     1372    2         RETURN;

   1372   0 000015  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      876     1373    2      END /* IF */;
      877     1374    2      IF (%KV_SSN.USRHLTINH AND (PARM1 = %KA#HLTOTP_USRX)) THEN DO;

   1374   0 000018  82C4 0028                            LB,'0010'X        40,B4
   1374   0 00001A       0010
          0 00001B  0581 000A                            BBF      s:1380,PREL
          0 00001D  BCC7 0004                            LDB,B3   @PARM1,AUTO
          0 00001F  E803                                 LDR,R6   ,B3
          0 000020  6D01                                 CMV,R6   1
          0 000021  0981 0004                            BNE      s:1380,PREL

      878     1375
      879     1376        /* THIS IS A USER OUTPUT HALT REQUEST, AND USER HALTS ARE INHIBITED.          */
      880     1377
      881     1378    2         RETURN;

PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:140  
   1378   0 000023  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      882     1379    2      END /* IF */;
      883     1380    1      Y@HLTOTP_ALL = %KA_CTX.HLTOTP_ALL;

   1380   0 000026  BCC5 0002                            LDB,B3   2,B5
          0 000028  E843 001C                            LDR,R6   28,B3
          0 00002A  E570 C000                            AND,R6   -16384,IMO
          0 00002C  6048                                 SOR,R6   8
          0 00002D  E7C7 0006                            STH,R6   Y@HLTOTP_ALL,AUTO

      884     1381    1      %KA_CTX.HLTOTP.BITT(PARM1) = '1'B;

   1381   0 00002F  ACC7 0004                            LDB,B2   @PARM1,AUTO
          0 000031  B802                                 LDR,R3   ,B2
          0 000032  9BC3 001C                            LAB,B1   28,B3
          0 000034  8931                                 LBT      ,B1,R3

      885     1382    2      IF (Y@HLTOTP_ALL) OR (%KA_CTX.OTPBFRTAL$ = ADDR(NIL)) THEN DO;

   1382   0 000035  E2C7 0006                            LLH,R6   Y@HLTOTP_ALL,AUTO
          0 000037  6008                                 SOL,R6   8
          0 000038  6981 000B                            BNEZ,R6  s:1387,PREL
          0 00003A  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00003D  DC86                                 LDB,B5   ,B6
          0 00003E  CCC5 0002                            LDB,B4   2,B5
          0 000040  8DC4 0006                            CMN      6,B4
          0 000042  0981 0004                            BNE      s:1389,PREL

      886     1383
      887     1384        /* EITHER WE WERE ALREADY HALTED (EITHER SYNCHRONOUSLY OR                     */
      888     1385        /* ASYNCHRONOUSLY) OR THERE IS NO OUTPUT ACTIVE.                              */
      889     1386
      890     1387    2         RETURN;

   1387   0 000044  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:141  
      891     1388    2      END /* IF */;
      892     1389    1      CALL KAO$ASNRQS(%KA#OTPASNRQS_HLT,%KA#OTPASNRQS_RSM)

   1389   0 000047  BB80 0000 0002  01                   LAB,B3   +2
          0 00004A  CBF0 0200                            LAB,B4   512,IMO
          0 00004C  E380 0000 0000  xent                 LNJ,B6   KAO$ASNRQS
          0 00004F       000C                            DC       s:1398,PREL

      893     1390    2      WHENRETURN DO;

      894     1391        /* The output asynchronous request succeeded.                                 */
      895     1392    2         %KA_CTX.ASNHLTOTP = '1'B;

   1392   0 000050  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000053  DC86                                 LDB,B5   ,B6
          0 000054  CCC5 0002                            LDB,B4   2,B5
          0 000056  8944 001D                            LBT,'0200'X       29,B4
          0 000058       0200

      896     1393    2      END /* WHENRETURN */;

   1393   0 000059  0F81 000D                            B        s:1401,PREL

      897     1394    2      WHENALTRETURN DO;

      898     1395
      899     1396        /* The output asynchronous request failed.                                    */
      900     1397
      901     1398    2         %KA_CTX.HLTOTP.BITT(PARM1) = '0'B;

   1398   0 00005B  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00005E  DC86                                 LDB,B5   ,B6
          0 00005F  CCC5 0002                            LDB,B4   2,B5
          0 000061  BCC7 0004                            LDB,B3   @PARM1,AUTO
          0 000063  B803                                 LDR,R3   ,B3
          0 000064  ABC4 001C                            LAB,B2   28,B4
          0 000066  8832                                 LBF      ,B2,R3
PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:142  

      902     1399    2      END /* WHENALTRETURN */;

      903     1400
      904     1401    1   END KAO$ASNRQSHLTOTP;

   1401   0 000067  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      905     1402
      906     1403        %EOD;

PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:143  
--  Include file information  --

   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$ASNRQSHLTOTP.
PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:144  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PARM1                    *0-0-0/w UBIN(16)    r     1 PARM1
     6-0-0/b BIT (8)     r     1 Y@HLTOTP_ALL

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KA$CTX                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(1024)  r     1 KV$SSN                     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KAO$ASNRQSHLTOTP requires 106 words for executable code.
   Procedure KAO$ASNRQSHLTOTP requires 8 words of local(AUTO) storage.
PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:145  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:146  
          MINI XREF LISTING

KA$CTX.ASNHLTOTP
       645**DCL      1392<<ASSIGN
KA$CTX.HLTOTP
       638**DCL       640--REDEF
KA$CTX.HLTOTP.BITT
       640**DCL      1381<<ASSIGN   1398<<ASSIGN
KA$CTX.HLTOTPNXTBFR
       642**DCL       643--REDEF
KA$CTX.HLTOTP_ALL
       640**DCL      1380>>ASSIGN
KA$CTX.OTPBFRTAL$
       551**DCL      1382>>IF
KA$OTPBFR.HLTOTP
       671**DCL       672--REDEF
KAO$ASNRQS
      1365**DCL-ENT  1389--CALL
KH$CHN.TERMID.TERM
      1100**DCL      1109--REDEF
KH_CHNHI
      1166**DCL      1167--REDEF
KH_CHNLOW
      1167**DCL      1168--REDEF
KV$PTR.INPCNDPND
      1277**DCL      1286--REDEF    1290--REDEF
KV$PTR.LINLST$
      1273**DCL      1274--REDEF
KV$PTR.SSN$
      1271**DCL      1369>>IF       1374>>IF
KV$PTR.VDI$
      1271**DCL      1369>>IF       1380>>ASSIGN   1381>>ASSIGN   1382>>IF       1392>>ASSIGN   1398>>ASSIGN
KV$PTR$
      1265**DCL      1271--IMP-PTR  1369>>IF       1369>>IF       1374>>IF       1380>>ASSIGN   1381>>ASSIGN
PL6.E3A0      #005=KAO$ASNRQSHLTOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:01 Page:147  
      1382>>IF       1392>>ASSIGN   1398>>ASSIGN
KV$SSN.LGCDSC
      1210**DCL      1369>>IF
KV$SSN.REDRSPCNT
      1200**DCL      1201--REDEF
KV$SSN.USRHLTINH
      1211**DCL      1374>>IF
KV$VDI.PHSDSC
      1349**DCL      1369>>IF
KV$VDI.USRCTX$
      1314**DCL      1380>>ASSIGN   1381>>ASSIGN   1382>>IF       1392>>ASSIGN   1398>>ASSIGN
PARM1
      1366**DCL         9--PROC     1374>>IF       1381>>ASSIGN   1398>>ASSIGN
Y@HLTOTP_ALL
      1367**DCL      1380<<ASSIGN   1382>>IF

PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:148  
      907        1        /*T***********************************************************/
      908        2        /*T*                                                         */
      909        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      910        4        /*T*                                                         */
      911        5        /*T***********************************************************/
      912        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      913        7
      914        8
      915        9        KAO$ASNRQSRSMOTP: PROC (PARM1);
      916       10 S      %INCLUDE KV$GLB;
      917       11 S      %INCLUDE KV_GLBCNS_E;
      918       12 S      %INCLUDE KV$GLBCTX;
      919       13
      920       14        %INCLUDE KV_GLB_M;
      921      136        %INCLUDE KA$GLB;
      922      277        %INCLUDE KA_GLB;
      923      354        %INCLUDE KA_GLBASM_E;
      924      436        %INCLUDE KA_GLB_E;
      925      514        %KA_HLTOTP_E;
      926      523 S      %INCLUDE KV$VDH;
      927      524        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      928      648        %INCLUDE LCP_6;
      929      839        %INCLUDE KH$CHN;
      930      961        %KH$CHN;                                /*  CHANNEL TABLES ITEM DEFINITONS    */
      931     1085        %INCLUDE KH_CHN;
      932     1125        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      933     1143        %KV$SSN;                                /*  VDH Session                       */
      934     1222        %KV$PTR;                                /*  VDH Pointers, status              */
      935     1265        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      936     1336
      937     1337    1   DCL KAO$ASNRQS ENTRY(3) ALTRET;
      938     1338    1   DCL PARM1 UBIN;
      939     1339
      940     1340    1      %KA_CTX.HLTOTP.BITT(PARM1) = '0'B;
      941     1341    2      IF (%KA_CTX.HLTOTP OR NOT %KA_CTX.ASNHLTOTP) THEN DO;
      942     1342
      943     1343        /* EITHER WE SHOULD STILL KEEP OUTPUT HALTED, OR WE DIDN'T                    */
PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:149  
      944     1344        /* ASYNCHRONOUSLY TELL THE COMM LINE CONTROLLER TO HALT.                      */
      945     1345
      946     1346    2         RETURN;
      947     1347    2      END /* IF */;
      948     1348    1      CALL KAO$ASNRQS(%KA#OTPASNRQS_RSM,%KA#OTPASNRQS_HLT)
      949     1349    2      WHENRETURN DO;
      950     1350        /* The output asynchronous request succeeded.                                 */
      951     1351
      952     1352    2         %KA_CTX.ASNHLTOTP = '0'B;
      953     1353    2      END /* WHENRETURN */;
      954     1354    2      WHENALTRETURN DO;
      955     1355
      956     1356        /* The output asynchronous request failed.                                    */
      957     1357
      958     1358    2         %KA_CTX.HLTOTP.BITT(PARM1) = '1'B;
      959     1359    2      END /* WHENALTRETURN */;
      960     1360
      961     1361    1   END KAO$ASNRQSRSMOTP;
      962     1362
      963     1363        %EOD;

PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:150  
--  Include file information  --

   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$ASNRQSRSMOTP.

   Procedure KAO$ASNRQSRSMOTP requires 71 words for executable code.
   Procedure KAO$ASNRQSRSMOTP requires 6 words of local(AUTO) storage.

PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:151  

 Object Unit name= KAO$ASNRQSRSMOTP                           File name= KAO$OTP.:E05TOU
 UTS= JUL 30 '97 00:02:03.52 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    71     47  KAO$ASNRQSRSMOTP
    1  RoData even  none     6      6  KAO$ASNRQSRSMOTP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KAO$ASNRQSRSMOTP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KAO$ASNRQS
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNHI                         r    KH_CHNLOW                             KV$PTR$
r    G$ROS$
PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:152  


      907        1        /*T***********************************************************/
      908        2        /*T*                                                         */
      909        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      910        4        /*T*                                                         */
      911        5        /*T***********************************************************/
      912        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      913        7
      914        8
      915        9        KAO$ASNRQSRSMOTP: PROC (PARM1);

      9   0 000000  D380 0000 0000  xent KAO$ASNRQSRSMOTPLNJ,B5   X6A_AUTO_1
          0 000003       0006 0001                       DC       6,1

      916       10 S      %INCLUDE KV$GLB;
      917       11 S      %INCLUDE KV_GLBCNS_E;
      918       12 S      %INCLUDE KV$GLBCTX;
      919       13
      920       14        %INCLUDE KV_GLB_M;
      921      136        %INCLUDE KA$GLB;
      922      277        %INCLUDE KA_GLB;
      923      354        %INCLUDE KA_GLBASM_E;
      924      436        %INCLUDE KA_GLB_E;
      925      514        %KA_HLTOTP_E;
      926      523 S      %INCLUDE KV$VDH;
      927      524        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
      928      648        %INCLUDE LCP_6;
      929      839        %INCLUDE KH$CHN;
      930      961        %KH$CHN;                                /*  CHANNEL TABLES ITEM DEFINITONS    */
      931     1085        %INCLUDE KH_CHN;
      932     1125        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      933     1143        %KV$SSN;                                /*  VDH Session                       */
      934     1222        %KV$PTR;                                /*  VDH Pointers, status              */
      935     1265        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
      936     1336
      937     1337    1   DCL KAO$ASNRQS ENTRY(3) ALTRET;
      938     1338    1   DCL PARM1 UBIN;
PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:153  
      939     1339
      940     1340    1      %KA_CTX.HLTOTP.BITT(PARM1) = '0'B;

   1340   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DC86                                 LDB,B5   ,B6
          0 000009  CCC5 0002                            LDB,B4   2,B5
          0 00000B  BCC7 0004                            LDB,B3   @PARM1,AUTO
          0 00000D  B803                                 LDR,R3   ,B3
          0 00000E  ABC4 001C                            LAB,B2   28,B4
          0 000010  8832                                 LBF      ,B2,R3

      941     1341    2      IF (%KA_CTX.HLTOTP OR NOT %KA_CTX.ASNHLTOTP) THEN DO;

   1341   0 000011  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000014  DC86                                 LDB,B5   ,B6
          0 000015  CCC5 0002                            LDB,B4   2,B5
          0 000017  82C4 001C                            LB,'C000'X        28,B4
          0 000019       C000
          0 00001A  0501 0006                            BBT      s:1346,PREL
          0 00001C  82C4 001D                            LB,'0200'X        29,B4
          0 00001E       0200
          0 00001F  0501 0004                            BBT      s:1348,PREL

      942     1342
      943     1343        /* EITHER WE SHOULD STILL KEEP OUTPUT HALTED, OR WE DIDN'T                    */
      944     1344        /* ASYNCHRONOUSLY TELL THE COMM LINE CONTROLLER TO HALT.                      */
      945     1345
      946     1346    2         RETURN;

   1346   0 000021  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      947     1347    2      END /* IF */;
      948     1348    1      CALL KAO$ASNRQS(%KA#OTPASNRQS_RSM,%KA#OTPASNRQS_HLT)

   1348   0 000024  BB80 0000 0002  01                   LAB,B3   +2
          0 000027  CBF0 0200                            LAB,B4   512,IMO
          0 000029  E380 0000 0000  xent                 LNJ,B6   KAO$ASNRQS
PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:154  
          0 00002C       000C                            DC       s:1358,PREL

      949     1349    2      WHENRETURN DO;

      950     1350        /* The output asynchronous request succeeded.                                 */
      951     1351
      952     1352    2         %KA_CTX.ASNHLTOTP = '0'B;

   1352   0 00002D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000030  DC86                                 LDB,B5   ,B6
          0 000031  CCC5 0002                            LDB,B4   2,B5
          0 000033  8844 001D                            LBF,'0200'X       29,B4
          0 000035       0200

      953     1353    2      END /* WHENRETURN */;

   1353   0 000036  0F81 000D                            B        s:1361,PREL

      954     1354    2      WHENALTRETURN DO;

      955     1355
      956     1356        /* The output asynchronous request failed.                                    */
      957     1357
      958     1358    2         %KA_CTX.HLTOTP.BITT(PARM1) = '1'B;

   1358   0 000038  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00003B  DC86                                 LDB,B5   ,B6
          0 00003C  CCC5 0002                            LDB,B4   2,B5
          0 00003E  BCC7 0004                            LDB,B3   @PARM1,AUTO
          0 000040  B803                                 LDR,R3   ,B3
          0 000041  ABC4 001C                            LAB,B2   28,B4
          0 000043  8932                                 LBT      ,B2,R3

      959     1359    2      END /* WHENALTRETURN */;

      960     1360
      961     1361    1   END KAO$ASNRQSRSMOTP;
PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:155  

   1361   0 000044  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      962     1362
      963     1363        %EOD;

PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:156  
--  Include file information  --

   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$ASNRQSRSMOTP.
PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:157  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PARM1                    *0-0-0/w UBIN(16)    r     1 PARM1

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KA$CTX                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KAO$ASNRQSRSMOTP requires 71 words for executable code.
   Procedure KAO$ASNRQSRSMOTP requires 6 words of local(AUTO) storage.
PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:158  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=KAO$ASNRQSRSMOTP File=KAO$OTP.:E05TSI                         WED 07/30/97 00:02 Page:159  
          MINI XREF LISTING

KA$CTX.ASNHLTOTP
       645**DCL      1341>>IF       1352<<ASSIGN
KA$CTX.HLTOTP
       638**DCL       640--REDEF    1341>>IF
KA$CTX.HLTOTP.BITT
       640**DCL      1340<<ASSIGN   1358<<ASSIGN
KA$CTX.HLTOTPNXTBFR
       642**DCL       643--REDEF
KAO$ASNRQS
      1337**DCL-ENT  1348--CALL
KH$CHN.TERMID.TERM
      1072**DCL      1081--REDEF
KH_CHNHI
      1138**DCL      1139--REDEF
KH_CHNLOW
      1139**DCL      1140--REDEF
KV$PTR.INPCNDPND
      1249**DCL      1258--REDEF    1262--REDEF
KV$PTR.LINLST$
      1245**DCL      1246--REDEF
KV$PTR.VDI$
      1243**DCL      1340>>ASSIGN   1341>>IF       1341>>IF       1352>>ASSIGN   1358>>ASSIGN
KV$PTR$
      1237**DCL      1243--IMP-PTR  1340>>ASSIGN   1341>>IF       1341>>IF       1352>>ASSIGN   1358>>ASSIGN
KV$SSN.REDRSPCNT
      1172**DCL      1173--REDEF
KV$VDI.USRCTX$
      1286**DCL      1340>>ASSIGN   1341>>IF       1341>>IF       1352>>ASSIGN   1358>>ASSIGN
PARM1
      1338**DCL         9--PROC     1340>>ASSIGN   1358>>ASSIGN

PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:160  
      964        1        /*T***********************************************************/
      965        2        /*T*                                                         */
      966        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      967        4        /*T*                                                         */
      968        5        /*T***********************************************************/
      969        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      970        7
      971        8
      972        9        KAO$ASNRQS: PROC (PRM_ASNRQS,PRM_OVRRIDASNRQS,CHN) ALTRET;
      973       10        %INCLUDE LCP_6;
      974      201        %INCLUDE KV_ASCCHR_E;                   /*  EQU'S FOR ASCII CHR'S             */
      975      338        %INCLUDE KV_GLBASM_E;
      976      356 S      %INCLUDE KV_GLBCNS_E;
      977      357        %KV_INPOPRX_E;
      978      369        %KV_STRTYP_E;
      979      407        %KV_VDH_FNC_E;
      980      427        %KV_SCHRSN_E;                           /*  Schedule reasons                  */
      981      434
      982      435 S      %INCLUDE KV$GLB;
      983      436 S      %INCLUDE KV$GLBCTX;
      984      437        %INCLUDE KA$GLB;
      985      578        %INCLUDE KA_GLB;
      986      655        %INCLUDE KA_GLB_E;
      987      733        %KA_HLTOTP_E;
      988      742        %KA_MSC;
      989      764        %INCLUDE KV_GLB_M;                      /*  VDH-user macros                   */
      990      886        %INCLUDE KV_INT_M;                      /*  TRACE ROUTINES                    */
      991     1029        %INCLUDE KH$CHN;
      992     1151        %KH$CHN (STCLASS="BASED(BCHN$)");       /*  CHANNEL TABLES ITEM DEFINITONS    */
      993     1275        %EQU KH_CHN=CHARTEXT('KH$CHN');
      994     1276        %INCLUDE KH_CHN;
      995     1316        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
      996     1334        %INCLUDE GH_IOFNC_E;                    /*  IO FUNCTION CODES                 */
      997     1403        %INCLUDE KW_LCT_E;                      /*  MLCP LCT DEFINITIONS              */
      998     1758        %INCLUDE KW_ALCT_E;                     /*  MLCP ASYNC LCT DEFINITIONS        */
      999     1948        %INCLUDE KA_LCT_E;                      /*  MLCP ASYNC LCT DEFINITIONS        */
     1000     2072        %KV$PTR;                                /*  VDH Pointers, status              */
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:161  
     1001     2115        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
     1002     2186        %INCLUDE KH$IO;
     1003     2433        %KH$IO(FPTN=KH_IO_INPLCTBYT,FNC=%GH#IO_INPLCTBYT,OTPCHN=YES,STCLASS=CONSTANT);
     1004     2547        %KH$IO(FPTN=KH_IO_OTPLCTBYT,FNC=%GH#IO_OTPLCTBYT,OTPCHN=YES,STCLASS=CONSTANT);
     1005     2661        %KH$IO(FPTN=KH@IO_INPLCTBYT,FNC=%GH#IO_INPLCTBYT,OTPCHN=YES,STCLASS=AUTO);
     1006     2775        %KH$IO(FPTN=KH@IO_OTPLCTBYT,FNC=%GH#IO_OTPLCTBYT,OTPCHN=YES,STCLASS=AUTO);
     1007     2889
     1008     2890        %INCLUDE KA_PERR_C;
     1009     2909 S      %INCLUDE GT_LCP6_M;
     1010     2910        %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_OTPASNRQSFAL, STCLASS = CONSTANT, FCG = KA, MID =
              2910            O, ERR = %E$ASN_OTPASNRQSFAL, SEV = 3);
     1011     3005
     1012     3006    1   DCL KHI$IO_INPLCTBYT ENTRY(2) ALTRET;
     1013     3007    1   DCL KHI$IO_OTPLCTBYT ENTRY(2) ALTRET;
     1014     3008    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY(2) ALTRET;
     1015     3009
     1016     3010
     1017     3011
     1018     3012
     1019     3013
     1020     3014    1   DCL Y@CNT1 UBIN WORD;
     1021     3015    1   DCL Y@CNT2 UBIN WORD;
     1022     3016    1   DCL BCHN$ PTR;
     1023     3017    1   DCL CHN UBIN;                 /* Passed channel table entry if NO_CTX entry.  */
     1024     3018
     1025     3019    1   DCL PRM_ASNRQS UBIN;
     1026     3020    1   DCL PRM_OVRRIDASNRQS UBIN;
     1027     3021
     1028     3022        %FPT_WRSYSLOG (FPTN=Y@WRSYSLOG, STCLASS=AUTO);
     1029     3117    1   DCL DW UBIN(32) BASED ALIGNED;
     1030     3118
     1031     3119    1      BCHN$ = %KV_VDI.CHN$;
     1032     3120    1      GOTO SUB_COMMON;
     1033     3121    1   KAO$ASNRQSNO_CTX: ENTRY (PRM_ASNRQS,PRM_OVRRIDASNRQS,CHN) ALTRET;
     1034     3122
     1035     3123    1      BCHN$ = ADDR(CHN);
     1036     3124
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:162  
     1037     3125    1   SUB_COMMON:;
     1038     3126        /**************************************************************************   */
     1039     3127        /***** THIS CODE MAY BE BEING EXECUTED WITHOUT A CONTEXT BLOCK. *****         */
     1040     3128        /***** BE CAREFUL ABOUT REFERENCES TO KA$CTX. *****                           */
     1041     3129        /**************************************************************************   */
     1042     3130    1      Y@CNT1 = 10;
     1043     3131    1      KH@IO_OTPLCTBYT = KH_IO_OTPLCTBYT;
     1044     3132    2   LOOP: DO WHILE ('1'B);                  /* LOOP START                         */
     1045     3133
     1046     3134        /* THIS LOOP IS TRAVERSED FOR EACH ATTEMPT TO READ A 0 OUT OF                 */
     1047     3135        /* KA_LCT_OTPASNRQS IN THE COMM LINE CONTROLLER'S RAM. IF WE DON'T FIND A 0 AF*/
     1048     3136        /* A WHILE, GIVE UP.                                                          */
     1049     3137
     1050     3138    2         KH@IO_INPLCTBYT = KH_IO_INPLCTBYT;
     1051     3139    2         KH@IO_INPLCTBYT.LCTBYT.ADR = %KA_LCT_OTPASNRQS;
     1052     3140    2         CALL KHI$IO_INPLCTBYT(%KH_CHN,KH@IO_INPLCTBYT)
     1053     3141    3         WHENALTRETURN DO;
     1054     3142
     1055     3143        /* WE GOT A NAK ON THE INPUT LCT BYTE (OR MAYBE OUTPUT LCT BYTE).             */
     1056     3144
     1057     3145    3            ALTRETURN;
     1058     3146    3         END /* IF */;
     1059     3147    2         IF (KH@IO_INPLCTBYT.LCTBYT.DAT = 0) THEN EXIT LOOP;
     1060     3148
     1061     3149        /* WE READ A 0 OUT OF KA_LCT_OTPASNRQS                                        */
     1062     3150
     1063     3151    3         ELSE IF (KH@IO_INPLCTBYT.LCTBYT.DAT = PRM_ASNRQS) THEN DO;
     1064     3152
     1065     3153        /* THE MLCP IS ALREADY WORKING ON THIS TYPE OF OUTPUT                         */
     1066     3154        /* ASYNCHRONOUS REQUEST. IGNORE THIS ONE                                      */
     1067     3155
     1068     3156    3            GOTO POKE_IT;                  /* Just in case it's hung up          */
     1069     3157    2         END; ELSE IF (ADDR(PRM_OVRRIDASNRQS) ~= ADDR(NIL))
     1070     3158    2         THEN IF (KH@IO_INPLCTBYT.LCTBYT.DAT = PRM_OVRRIDASNRQS)
     1071     3159
     1072     3160        /* The asynchronous request we're trying to communicate to the                */
     1073     3161        /* MLCP should over-ride the asynchronous request the MLCP is                 */
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:163  
     1074     3162        /* currently waiting to do. Store the new request ID. .                       */
     1075     3163
     1076     3164    2         THEN EXIT LOOP;                   /* LOOK BELOW                         */
     1077     3165    2         Y@CNT1 = Y@CNT1 - 1;
     1078     3166    3         IF (Y@CNT1 <= 0) THEN DO;
     1079     3167
     1080     3168        /* WE FAILED ON FINDING A 0 IN KA_LCT_OTPASNRQS*                              */
     1081     3169
     1082     3170        /*E* ERROR: KAO-E$ASN_OTPASNRQSFAL                                         */
     1083     3171        /*E* MESSAGE: Asynchronous output request to MLCP failed                      */
     1084     3172        /*E* DESCRIPTION: We tried to do an asynchronous output operation through     */
     1085     3173        /*,* the MLCP and it was busy with another asynchronous operation.            */
     1086     3174
     1087     3175    3            IF %KH_CHN.BUG THEN GOTO POKE_IT;
     1088     3176    3            %KH_CHN.BUG = '1'B;
     1089     3177    3            Y@WRSYSLOG = FPT_WRSYSLOG_OTPASNRQSFAL;
     1090     3178    3            Y@WRSYSLOG.V.VALUES(0) = PRM_ASNRQS;
     1091     3179    3            Y@WRSYSLOG.V.VALUES(1) = KH@IO_INPLCTBYT.LCTBYT.DAT;
     1092     3180    3            ADDR(Y@WRSYSLOG.V.VALUES(2))->DW =
     1093     3181    3              PINCRW(ADDR(Y@CNT1),-14)->DW;
     1094     3182    3            CALL KHD$ERRLOG_SETTERMID_CHN (Y@WRSYSLOG, %KH_CHN);
     1095     3183    3            GOTO POKE_IT;
     1096     3184    3         END /* IF */;
     1097     3185
     1098     3186        /* SPIN FOR A WHILE ON FAILURE                                                */
     1099     3187
     1100     3188    3         DO Y@CNT2 = 0 TO 199; END;
     1101     3189    2      END LOOP;
     1102     3190    1      %KH_CHN.BUG = '0'B;
     1103     3191    1      KH@IO_OTPLCTBYT.LCTBYT.ADR = %KA_LCT_OTPASNRQS;
     1104     3192    1      KH@IO_OTPLCTBYT.LCTBYT.DAT = PRM_ASNRQS;
     1105     3193    1      CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);
     1106     3194
     1107     3195        /* GET THE COMM LINE CONTROLLER GOING.                                        */
     1108     3196
     1109     3197    1   POKE_IT:;
     1110     3198    1      KH@IO_OTPLCTBYT.LCTBYT.ADR = %KW#TRNSTT;
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:164  
     1111     3199    1      KH@IO_OTPLCTBYT.LCTBYT.DAT = BITBIN('1F'X);
     1112     3200    1      CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);
     1113     3201    1      KH@IO_OTPLCTBYT.LCTBYT.ADR = %KW#TRNSTTMSK;
     1114     3202    1      KH@IO_OTPLCTBYT.LCTBYT.DAT = BITBIN('FF'X);
     1115     3203    1      CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);
     1116     3204    1      IF %KH_CHN.BUG THEN ALTRETURN;
     1117     3205    1   END KAO$ASNRQS;
     1118     3206
     1119     3207        %EOD;

PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:165  
--  Include file information  --

   KA_PERR_C.:E05TOU  is referenced.
   KH$IO.:E05TOU  is referenced.
   KA_LCT_E.:E05TOU  is referenced.
   KW_ALCT_E.:E05TOU  is referenced.
   KW_LCT_E.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLBASM_E.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$ASNRQS.
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:166  

   Procedure KAO$ASNRQS requires 228 words for executable code.
   Procedure KAO$ASNRQS requires 44 words of local(AUTO) storage.

PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:167  

 Object Unit name= KAO$ASNRQS                                 File name= KAO$OTP.:E05TOU
 UTS= JUL 30 '97 00:02:29.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     25     19  KAO$ASNRQS
    1   Proc  even  none   228     E4  KAO$ASNRQS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  KAO$ASNRQS
     1      E          yes     yes      Std        3  KAO$ASNRQSNO_CTX

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KHI$IO_INPLCTBYT
 yes     yes           Std       2 KHD$ERRLOG_SETTERMID_CHN
 yes     yes           Std       2 KHI$IO_OTPLCTBYT
                       nStd      0 X6A_AUTO_3
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:168  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNHI                         r    KH_CHNLOW                             KV$PTR$
r    G$ROS$
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:169  


      964        1        /*T***********************************************************/
      965        2        /*T*                                                         */
      966        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      967        4        /*T*                                                         */
      968        5        /*T***********************************************************/
      969        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
      970        7
      971        8
      972        9        KAO$ASNRQS: PROC (PRM_ASNRQS,PRM_OVRRIDASNRQS,CHN) ALTRET;

      9   1 000000  D380 0000 0000  xent KAO$ASNRQS      LNJ,B5   X6A_AUTO_3
          1 000003       002C 0003                       DC       44,3

      973       10        %INCLUDE LCP_6;
      974      201        %INCLUDE KV_ASCCHR_E;                   /*  EQU'S FOR ASCII CHR'S             */
      975      338        %INCLUDE KV_GLBASM_E;
      976      356 S      %INCLUDE KV_GLBCNS_E;
      977      357        %KV_INPOPRX_E;
      978      369        %KV_STRTYP_E;
      979      407        %KV_VDH_FNC_E;
      980      427        %KV_SCHRSN_E;                           /*  Schedule reasons                  */
      981      434
      982      435 S      %INCLUDE KV$GLB;
      983      436 S      %INCLUDE KV$GLBCTX;
      984      437        %INCLUDE KA$GLB;
      985      578        %INCLUDE KA_GLB;
      986      655        %INCLUDE KA_GLB_E;
      987      733        %KA_HLTOTP_E;
      988      742        %KA_MSC;
      989      764        %INCLUDE KV_GLB_M;                      /*  VDH-user macros                   */
      990      886        %INCLUDE KV_INT_M;                      /*  TRACE ROUTINES                    */
      991     1029        %INCLUDE KH$CHN;
      992     1151        %KH$CHN (STCLASS="BASED(BCHN$)");       /*  CHANNEL TABLES ITEM DEFINITONS    */
      993     1275        %EQU KH_CHN=CHARTEXT('KH$CHN');
      994     1276        %INCLUDE KH_CHN;
      995     1316        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:170  
      996     1334        %INCLUDE GH_IOFNC_E;                    /*  IO FUNCTION CODES                 */
      997     1403        %INCLUDE KW_LCT_E;                      /*  MLCP LCT DEFINITIONS              */
      998     1758        %INCLUDE KW_ALCT_E;                     /*  MLCP ASYNC LCT DEFINITIONS        */
      999     1948        %INCLUDE KA_LCT_E;                      /*  MLCP ASYNC LCT DEFINITIONS        */
     1000     2072        %KV$PTR;                                /*  VDH Pointers, status              */
     1001     2115        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
     1002     2186        %INCLUDE KH$IO;
     1003     2433        %KH$IO(FPTN=KH_IO_INPLCTBYT,FNC=%GH#IO_INPLCTBYT,OTPCHN=YES,STCLASS=CONSTANT);
     1004     2547        %KH$IO(FPTN=KH_IO_OTPLCTBYT,FNC=%GH#IO_OTPLCTBYT,OTPCHN=YES,STCLASS=CONSTANT);
     1005     2661        %KH$IO(FPTN=KH@IO_INPLCTBYT,FNC=%GH#IO_INPLCTBYT,OTPCHN=YES,STCLASS=AUTO);
     1006     2775        %KH$IO(FPTN=KH@IO_OTPLCTBYT,FNC=%GH#IO_OTPLCTBYT,OTPCHN=YES,STCLASS=AUTO);
     1007     2889
     1008     2890        %INCLUDE KA_PERR_C;
     1009     2909 S      %INCLUDE GT_LCP6_M;
     1010     2910       %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_OTPASNRQSFAL, STCLASS = CONSTANT, FCG = KA, MID =
              2910            O, ERR = %E$ASN_OTPASNRQSFAL, SEV = 3);
     1011     3005
     1012     3006    1   DCL KHI$IO_INPLCTBYT ENTRY(2) ALTRET;
     1013     3007    1   DCL KHI$IO_OTPLCTBYT ENTRY(2) ALTRET;
     1014     3008    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY(2) ALTRET;
     1015     3009
     1016     3010
     1017     3011
     1018     3012
     1019     3013
     1020     3014    1   DCL Y@CNT1 UBIN WORD;
     1021     3015    1   DCL Y@CNT2 UBIN WORD;
     1022     3016    1   DCL BCHN$ PTR;
     1023     3017    1   DCL CHN UBIN;                 /* Passed channel table entry if NO_CTX entry.  */
     1024     3018
     1025     3019    1   DCL PRM_ASNRQS UBIN;
     1026     3020    1   DCL PRM_OVRRIDASNRQS UBIN;
     1027     3021
     1028     3022        %FPT_WRSYSLOG (FPTN=Y@WRSYSLOG, STCLASS=AUTO);
     1029     3117    1   DCL DW UBIN(32) BASED ALIGNED;
     1030     3118
     1031     3119    1      BCHN$ = %KV_VDI.CHN$;
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:171  

   3119   1 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000008  DC86                                 LDB,B5   ,B6
          1 000009  CC85                                 LDB,B4   ,B5
          1 00000A  CFC7 0010                            STB,B4   BCHN$,AUTO

     1032     3120    1      GOTO SUB_COMMON;

   3120   1 00000C  0F81 000A                            B        s:3123,PREL

     1033     3121    1   KAO$ASNRQSNO_CTX: ENTRY (PRM_ASNRQS,PRM_OVRRIDASNRQS,CHN) ALTRET;

   3121   1 00000E  D380 0000 0000  xent KAO$ASNRQSNO_CTXLNJ,B5   X6A_AUTO_3
          1 000011       002C 0003                       DC       44,3

     1034     3122
     1035     3123    1      BCHN$ = ADDR(CHN);

   3123   1 000013  ECC7 0008                            LDB,B6   @CHN,AUTO
          1 000015  EFC7 0010                            STB,B6   BCHN$,AUTO

   3123   1                              SUB_COMMON      null
     1036     3124
     1037     3125    1   SUB_COMMON:;
     1038     3126        /**************************************************************************   */
     1039     3127        /***** THIS CODE MAY BE BEING EXECUTED WITHOUT A CONTEXT BLOCK. *****         */
     1040     3128        /***** BE CAREFUL ABOUT REFERENCES TO KA$CTX. *****                           */
     1041     3129        /**************************************************************************   */
     1042     3130    1      Y@CNT1 = 10;

   3130   1 000017  6C0A                 SUB_COMMON      LDV,R6   10
          1 000018  EF47 000E                            STR,R6   Y@CNT1,AUTO

     1043     3131    1      KH@IO_OTPLCTBYT = KH_IO_OTPLCTBYT;

   3131   1 00001A  8C80 0000 0002  00                   LDI      KH_IO_OTPLCTBYT
          1 00001D  8D47 000C                            SDI      KH@IO_OTPLCTBYT,AUTO
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:172  

     1044     3132    2   LOOP: DO WHILE ('1'B);                  /* LOOP START                         */

   3132   1                              LOOP            null
     1045     3133
     1046     3134        /* THIS LOOP IS TRAVERSED FOR EACH ATTEMPT TO READ A 0 OUT OF                 */
     1047     3135        /* KA_LCT_OTPASNRQS IN THE COMM LINE CONTROLLER'S RAM. IF WE DON'T FIND A 0 AF*/
     1048     3136        /* A WHILE, GIVE UP.                                                          */
     1049     3137
     1050     3138    2         KH@IO_INPLCTBYT = KH_IO_INPLCTBYT;

   3138   1 00001F  8C80 0000 0000  00   LOOP            LDI      KH_IO_INPLCTBYT
          1 000022  8D47 000A                            SDI      KH@IO_INPLCTBYT,AUTO

     1051     3139    2         KH@IO_INPLCTBYT.LCTBYT.ADR = %KA_LCT_OTPASNRQS;

   3139   1 000024  5C17                                 LDV,R5   23
          1 000025  DAC7 000B                            SRM,R5,'00FF'X    KH@IO_INPLCTBYT+1,AUTO
          1 000027       00FF

     1052     3140    2         CALL KHI$IO_INPLCTBYT(%KH_CHN,KH@IO_INPLCTBYT)

   3140   1 000028  EBC7 000A                            LAB,B6   KH@IO_INPLCTBYT,AUTO
          1 00002A  EFC7 002A                            STB,B6   Y@WRSYSLOG+24,AUTO
          1 00002C  DCC7 0010                            LDB,B5   BCHN$,AUTO
          1 00002E  DFC7 0028                            STB,B5   Y@WRSYSLOG+22,AUTO
          1 000030  BBC7 0028                            LAB,B3   Y@WRSYSLOG+22,AUTO
          1 000032  CBF0 0200                            LAB,B4   512,IMO
          1 000034  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INPLCTBYT
          1 000037       0003                            DC       s:3145,PREL
          1 000038  0F81 0004                            B        s:3147,PREL

     1053     3141    3         WHENALTRETURN DO;

     1054     3142
     1055     3143        /* WE GOT A NAK ON THE INPUT LCT BYTE (OR MAYBE OUTPUT LCT BYTE).             */
     1056     3144
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:173  
     1057     3145    3            ALTRETURN;

   3145   1 00003A  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1058     3146    3         END /* IF */;
     1059     3147    2         IF (KH@IO_INPLCTBYT.LCTBYT.DAT = 0) THEN EXIT LOOP;

   3147   1 00003D  E2C7 000B                            LLH,R6   KH@IO_INPLCTBYT+1,AUTO
          1 00003F  6901 004E                            BEZ,R6   s:3190,PREL

     1060     3148
     1061     3149        /* WE READ A 0 OUT OF KA_LCT_OTPASNRQS                                        */
     1062     3150
     1063     3151    3         ELSE IF (KH@IO_INPLCTBYT.LCTBYT.DAT = PRM_ASNRQS) THEN DO;

   3151   1 000041  ECC7 0004                            LDB,B6   @PRM_ASNRQS,AUTO
          1 000043  E906                                 CMR,R6   ,B6
          1 000044  0981 0003                            BNE      s:3157,PREL

     1064     3152
     1065     3153        /* THE MLCP IS ALREADY WORKING ON THIS TYPE OF OUTPUT                         */
     1066     3154        /* ASYNCHRONOUS REQUEST. IGNORE THIS ONE                                      */
     1067     3155
     1068     3156    3            GOTO POKE_IT;                  /* Just in case it's hung up          */

   3156   1 000046  0F81 0063                            B        s:3192,PREL

     1069     3157    2         END; ELSE IF (ADDR(PRM_OVRRIDASNRQS) ~= ADDR(NIL))

   3157   1 000048  DCC7 0006                            LDB,B5   @PRM_OVRRIDASNRQS,AUTO
          1 00004A  8DD5                                 CMN      B5
          1 00004B  0901 0004                            BE       s:3165,PREL

     1070     3158    2         THEN IF (KH@IO_INPLCTBYT.LCTBYT.DAT = PRM_OVRRIDASNRQS)

   3158   1 00004D  E905                                 CMR,R6   ,B5
          1 00004E  0901 003F                            BE       s:3190,PREL
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:174  

     1071     3159
     1072     3160        /* The asynchronous request we're trying to communicate to the                */
     1073     3161        /* MLCP should over-ride the asynchronous request the MLCP is                 */
     1074     3162        /* currently waiting to do. Store the new request ID. .                       */
     1075     3163
     1076     3164    2         THEN EXIT LOOP;                   /* LOOK BELOW                         */
     1077     3165    2         Y@CNT1 = Y@CNT1 - 1;

   3165   1 000050  88C7 000E                            DEC      Y@CNT1,AUTO

     1078     3166    3         IF (Y@CNT1 <= 0) THEN DO;

   3166   1 000052  D847 000E                            LDR,R5   Y@CNT1,AUTO
          1 000054  5981 002E                            BNEZ,R5  s:3188,PREL

     1079     3167
     1080     3168        /* WE FAILED ON FINDING A 0 IN KA_LCT_OTPASNRQS*                              */
     1081     3169
     1082     3170        /*E* ERROR: KAO-E$ASN_OTPASNRQSFAL                                         */
     1083     3171        /*E* MESSAGE: Asynchronous output request to MLCP failed                      */
     1084     3172        /*E* DESCRIPTION: We tried to do an asynchronous output operation through     */
     1085     3173        /*,* the MLCP and it was busy with another asynchronous operation.            */
     1086     3174
     1087     3175    3            IF %KH_CHN.BUG THEN GOTO POKE_IT;

   3175   1 000056  CCC7 0010                            LDB,B4   BCHN$,AUTO
          1 000058  89C4 0009                            CMZ      9,B4
          1 00005A  0801 004F                            BAL      s:3192,PREL

     1088     3176    3            %KH_CHN.BUG = '1'B;

   3176   1 00005C  8944 0009                            LBT,'8000'X       9,B4
   3176   1 00005E       8000

     1089     3177    3            Y@WRSYSLOG = FPT_WRSYSLOG_OTPASNRQSFAL;

PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:175  
   3177   1 00005F  AB80 0000 0000  00                   LAB,B2   KH_IO_INPLCTBYT
          1 000062  2C08                                 LDV,R2   8
          1 000063  6C2A                                 LDV,R6   42
          1 000064  BB87                                 LAB,B3   ,AUTO
          1 000065  3C24                                 LDV,R3   36
          1 000066  0008                                 MMM

     1090     3178    3            Y@WRSYSLOG.V.VALUES(0) = PRM_ASNRQS;

   3178   1 000067  E806                                 LDR,R6   ,B6
          1 000068  EF47 0022                            STR,R6   Y@WRSYSLOG+16,AUTO

     1091     3179    3            Y@WRSYSLOG.V.VALUES(1) = KH@IO_INPLCTBYT.LCTBYT.DAT;

   3179   1 00006A  D2C7 000B                            LLH,R5   KH@IO_INPLCTBYT+1,AUTO
          1 00006C  DF47 0023                            STR,R5   Y@WRSYSLOG+17,AUTO

     1092     3180    3            ADDR(Y@WRSYSLOG.V.VALUES(2))->DW =

   3180   1 00006E  8C87                                 LDI      ,AUTO
          1 00006F  8D47 0024                            SDI      Y@WRSYSLOG+18,AUTO

     1093     3181    3              PINCRW(ADDR(Y@CNT1),-14)->DW;
     1094     3182    3            CALL KHD$ERRLOG_SETTERMID_CHN (Y@WRSYSLOG, %KH_CHN);

   3182   1 000071  CCC7 0010                            LDB,B4   BCHN$,AUTO
          1 000073  CFC7 002A                            STB,B4   Y@WRSYSLOG+24,AUTO
          1 000075  ABC7 0012                            LAB,B2   Y@WRSYSLOG,AUTO
          1 000077  AFC7 0028                            STB,B2   Y@WRSYSLOG+22,AUTO
          1 000079  BBC7 0028                            LAB,B3   Y@WRSYSLOG+22,AUTO
          1 00007B  CBF0 0200                            LAB,B4   512,IMO
          1 00007D  E380 0000 0000  xent                 LNJ,B6   KHD$ERRLOG_SETTERMID_CHN
          1 000080       0001                            DC       s:3183,PREL

     1095     3183    3            GOTO POKE_IT;

   3183   1 000081  0F81 0028                            B        s:3192,PREL
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:176  

     1096     3184    3         END /* IF */;
     1097     3185
     1098     3186        /* SPIN FOR A WHILE ON FAILURE                                                */
     1099     3187
     1100     3188    3         DO Y@CNT2 = 0 TO 199; END;

   3188   1 000083  8747 000F                            CL       Y@CNT2,AUTO

   3188   1 000085  8AC7 000F                            INC      Y@CNT2,AUTO
          1 000087  E847 000F                            LDR,R6   Y@CNT2,AUTO
          1 000089  E970 00C7                            CMR,R6   199,IMO
          1 00008B  03FA                                 BLE      s:3188+2,SPREL

     1101     3189    2      END LOOP;

   3189   1 00008C  0F81 FF92                            B        s:3132,PREL

     1102     3190    1      %KH_CHN.BUG = '0'B;

   3190   1 00008E  ECC7 0010                            LDB,B6   BCHN$,AUTO
          1 000090  8846 0009                            LBF,'8000'X       9,B6
          1 000092       8000

     1103     3191    1      KH@IO_OTPLCTBYT.LCTBYT.ADR = %KA_LCT_OTPASNRQS;

   3191   1 000093  6C17                                 LDV,R6   23
          1 000094  EAC7 000D                            SRM,R6,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
          1 000096       00FF

     1104     3192    1      KH@IO_OTPLCTBYT.LCTBYT.DAT = PRM_ASNRQS;

   3192   1 000097  DCC7 0004                            LDB,B5   @PRM_ASNRQS,AUTO
          1 000099  D805                                 LDR,R5   ,B5
          1 00009A  D7C7 000D                            STH,R5   KH@IO_OTPLCTBYT+1,AUTO

     1105     3193    1      CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:177  

   3193   1 00009C  CBC7 000C                            LAB,B4   KH@IO_OTPLCTBYT,AUTO
          1 00009E  CFC7 002A                            STB,B4   Y@WRSYSLOG+24,AUTO
          1 0000A0  EFC7 0028                            STB,B6   Y@WRSYSLOG+22,AUTO
          1 0000A2  BBC7 0028                            LAB,B3   Y@WRSYSLOG+22,AUTO
          1 0000A4  CBF0 0200                            LAB,B4   512,IMO
          1 0000A6  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTPLCTBYT
          1 0000A9       0001                            DC       s:3192,PREL

   3192   1                              POKE_IT         null
     1106     3194
     1107     3195        /* GET THE COMM LINE CONTROLLER GOING.                                        */
     1108     3196
     1109     3197    1   POKE_IT:;
     1110     3198    1      KH@IO_OTPLCTBYT.LCTBYT.ADR = %KW#TRNSTT;

   3198   1 0000AA  6C2E                 POKE_IT         LDV,R6   46
          1 0000AB  EAC7 000D                            SRM,R6,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
          1 0000AD       00FF

     1111     3199    1      KH@IO_OTPLCTBYT.LCTBYT.DAT = BITBIN('1F'X);

   3199   1 0000AE  5C1F                                 LDV,R5   31
          1 0000AF  D7C7 000D                            STH,R5   KH@IO_OTPLCTBYT+1,AUTO

     1112     3200    1      CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);

   3200   1 0000B1  EBC7 000C                            LAB,B6   KH@IO_OTPLCTBYT,AUTO
          1 0000B3  EFC7 002A                            STB,B6   Y@WRSYSLOG+24,AUTO
          1 0000B5  DCC7 0010                            LDB,B5   BCHN$,AUTO
          1 0000B7  DFC7 0028                            STB,B5   Y@WRSYSLOG+22,AUTO
          1 0000B9  BBC7 0028                            LAB,B3   Y@WRSYSLOG+22,AUTO
          1 0000BB  CBF0 0200                            LAB,B4   512,IMO
          1 0000BD  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTPLCTBYT
          1 0000C0       0001                            DC       s:3201,PREL

     1113     3201    1      KH@IO_OTPLCTBYT.LCTBYT.ADR = %KW#TRNSTTMSK;
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:178  

   3201   1 0000C1  6C2F                                 LDV,R6   47
          1 0000C2  EAC7 000D                            SRM,R6,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
          1 0000C4       00FF

     1114     3202    1      KH@IO_OTPLCTBYT.LCTBYT.DAT = BITBIN('FF'X);

   3202   1 0000C5  8947 000D                            LBT,'FF00'X       KH@IO_OTPLCTBYT+1,AUTO
   3202   1 0000C7       FF00

     1115     3203    1      CALL KHI$IO_OTPLCTBYT(%KH_CHN,KH@IO_OTPLCTBYT);

   3203   1 0000C8  EBC7 000C                            LAB,B6   KH@IO_OTPLCTBYT,AUTO
          1 0000CA  EFC7 002A                            STB,B6   Y@WRSYSLOG+24,AUTO
          1 0000CC  DCC7 0010                            LDB,B5   BCHN$,AUTO
          1 0000CE  DFC7 0028                            STB,B5   Y@WRSYSLOG+22,AUTO
          1 0000D0  BBC7 0028                            LAB,B3   Y@WRSYSLOG+22,AUTO
          1 0000D2  CBF0 0200                            LAB,B4   512,IMO
          1 0000D4  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTPLCTBYT
          1 0000D7       0001                            DC       s:3204,PREL

     1116     3204    1      IF %KH_CHN.BUG THEN ALTRETURN;

   3204   1 0000D8  ECC7 0010                            LDB,B6   BCHN$,AUTO
          1 0000DA  89C6 0009                            CMZ      9,B6
          1 0000DC  0881 0004                            BAGE     s:3205,PREL

   3204   1 0000DE  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1117     3205    1   END KAO$ASNRQS;

   3205   1 0000E1  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1118     3206
     1119     3207        %EOD;

PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:179  
--  Include file information  --

   KA_PERR_C.:E05TOU  is referenced.
   KH$IO.:E05TOU  is referenced.
   KA_LCT_E.:E05TOU  is referenced.
   KW_ALCT_E.:E05TOU  is referenced.
   KW_LCT_E.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLBASM_E.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$ASNRQS.
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:180  

 **** Variables and constants ****

  ****  Section 000 RoData KAO$ASNRQS

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w STRC(336)   r     1 FPT_WRSYSLOG_OTPASNRQSFAL
     0-0-0/w STRC(32)    r     1 KH_IO_INPLCTBYT            2-0-0/w STRC(32)    r     1 KH_IO_OTPLCTBYT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     8-0-0/w PTR         r     1 @CHN                       4-0-0/w PTR         r     1 @PRM_ASNRQS
     6-0-0/w PTR         r     1 @PRM_OVRRIDASNRQS         10-0-0/w PTR         r     1 BCHN$
    *0-0-0/w UBIN(16)    r     1 CHN                        A-0-0/w STRC(32)    r     1 KH@IO_INPLCTBYT
     C-0-0/w STRC(32)    r     1 KH@IO_OTPLCTBYT           *0-0-0/w UBIN(16)    r     1 PRM_ASNRQS
    *0-0-0/w UBIN(16)    r     1 PRM_OVRRIDASNRQS           E-0-0/w UBIN(16)    r     1 Y@CNT1
     F-0-0/w UBIN(16)    r     1 Y@CNT2                    12-0-0/w STRC(336)   r     1 Y@WRSYSLOG

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(32)    r     1 DW                         0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w STRC(480)   r     1 KV$PTR                     0-0-0/w STRC(512)   r     1 KV$VDI

PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:181  

   Procedure KAO$ASNRQS requires 228 words for executable code.
   Procedure KAO$ASNRQS requires 44 words of local(AUTO) storage.
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:182  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:183  
          MINI XREF LISTING

BCHN$
      3016**DCL      1166--IMP-PTR  3119<<ASSIGN   3123<<ASSIGN   3140>>CALL     3175>>IF       3176>>ASSIGN
      3182>>CALL     3190>>ASSIGN   3193>>CALL     3200>>CALL     3203>>CALL     3204>>IF
CHN
      3017**DCL         9--PROC     3121--ENTRY    3123--ASSIGN
DW
      3117**DCL      3180<<ASSIGN   3180>>ASSIGN
FPT_WRSYSLOG_OTPASNRQSFAL
      2923**DCL      3177>>ASSIGN
FPT_WRSYSLOG_OTPASNRQSFAL.V
      2927**DCL      2925--DCLINIT
FPT_WRSYSLOG_OTPASNRQSFAL.V.TERMID.TERM
      2992**DCL      3001--REDEF
KH$CHN
      1166**DCL      3140<>CALL     3182<>CALL     3193<>CALL     3200<>CALL     3203<>CALL
KH$CHN.BUG
      1224**DCL      3175>>IF       3176<<ASSIGN   3190<<ASSIGN   3204>>IF
KH$CHN.TERMID.TERM
      1262**DCL      1271--REDEF
KH@IO_INPLCTBYT
      2673**DCL      3138<<ASSIGN   3140<>CALL
KH@IO_INPLCTBYT.ASNSTT
      2682**DCL      2683--REDEF    2689--REDEF    2694--REDEF    2698--REDEF    2702--REDEF    2706--REDEF
      2713--REDEF    2719--REDEF    2725--REDEF    2730--REDEF    2737--REDEF    2740--REDEF    2744--REDEF
      2751--REDEF    2755--REDEF    2759--REDEF    2763--REDEF    2768--REDEF    2772--REDEF
KH@IO_INPLCTBYT.LCTBYT.ADR
      2689**DCL      3139<<ASSIGN
KH@IO_INPLCTBYT.LCTBYT.DAT
      2689**DCL      3147>>IF       3151>>IF       3158>>IF       3179>>ASSIGN
KH@IO_OTPLCTBYT
      2787**DCL      3131<<ASSIGN   3193<>CALL     3200<>CALL     3203<>CALL
KH@IO_OTPLCTBYT.ASNSTT
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:184  
      2796**DCL      2797--REDEF    2803--REDEF    2808--REDEF    2812--REDEF    2816--REDEF    2820--REDEF
      2827--REDEF    2833--REDEF    2839--REDEF    2844--REDEF    2851--REDEF    2854--REDEF    2858--REDEF
      2865--REDEF    2869--REDEF    2873--REDEF    2877--REDEF    2882--REDEF    2886--REDEF
KH@IO_OTPLCTBYT.LCTBYT.ADR
      2803**DCL      3191<<ASSIGN   3198<<ASSIGN   3201<<ASSIGN
KH@IO_OTPLCTBYT.LCTBYT.DAT
      2803**DCL      3192<<ASSIGN   3199<<ASSIGN   3202<<ASSIGN
KHD$ERRLOG_SETTERMID_CHN
      3008**DCL-ENT  3182--CALL
KHI$IO_INPLCTBYT
      3006**DCL-ENT  3140--CALL
KHI$IO_OTPLCTBYT
      3007**DCL-ENT  3193--CALL     3200--CALL     3203--CALL
KH_CHNHI
      1329**DCL      1330--REDEF
KH_CHNLOW
      1330**DCL      1331--REDEF
KH_IO_INPLCTBYT
      2445**DCL      3138>>ASSIGN
KH_IO_OTPLCTBYT
      2559**DCL      3131>>ASSIGN
KV$PTR.INPCNDPND
      2099**DCL      2108--REDEF    2112--REDEF
KV$PTR.LINLST$
      2095**DCL      2096--REDEF
KV$PTR.VDI$
      2093**DCL      3119>>ASSIGN
KV$PTR$
      2087**DCL      2093--IMP-PTR  3119>>ASSIGN
KV$VDI.CHN$
      2136**DCL      3119>>ASSIGN
LOOP
      3132**LABEL    3147--EXIT     3164--EXIT
POKE_IT
      3192**LABEL    3156--GOTO     3175--GOTO     3183--GOTO
PRM_ASNRQS
PL6.E3A0      #007=KAO$ASNRQS File=KAO$OTP.:E05TSI                               WED 07/30/97 00:02 Page:185  
      3019**DCL         9--PROC     3121--ENTRY    3151>>IF       3178>>ASSIGN   3192>>ASSIGN
PRM_OVRRIDASNRQS
      3020**DCL         9--PROC     3121--ENTRY    3157--IF       3158>>IF
SUB_COMMON
      3123**LABEL    3120--GOTO
Y@CNT1
      3014**DCL      3130<<ASSIGN   3165<<ASSIGN   3165>>ASSIGN   3166>>IF       3180--ASSIGN
Y@CNT2
      3015**DCL      3188<<DOINDEX
Y@WRSYSLOG
      3035**DCL      3177<<ASSIGN   3182<>CALL
Y@WRSYSLOG.V.TERMID.TERM
      3104**DCL      3113--REDEF
Y@WRSYSLOG.V.VALUES
      3115**DCL      3178<<ASSIGN   3179<<ASSIGN   3180--ASSIGN

PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:186  
     1120        1        /*T***********************************************************/
     1121        2        /*T*                                                         */
     1122        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1123        4        /*T*                                                         */
     1124        5        /*T***********************************************************/
     1125        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
     1126        7
     1127        8
     1128        9        KAO$SNCFLWCTRHLT: PROC (PARM);
     1129       10        %INCLUDE LCP_6;
     1130      201        %INCLUDE KL_MACRO_C;                    /* For KA_STT/KV$STT                  */
     1131     3553        %INCLUDE KL_AFCN_C;                     /* For KA_STT/KV$STT                  */
     1132     3654        %INCLUDE K_ID_E;                        /* For KA_STT/KV$STT                  */
     1133     3704         %K#ENTID_E;                            /* For KA_STT/KV$STT                  */
     1134     3723         %K#LYRID_E;                            /* For KA_STT/KV$STT                  */
     1135     3730        %INCLUDE KH$STT;                        /* For KA_STT                         */
     1136     3760        %INCLUDE KV$BPC;
     1137     3789        %INCLUDE KH$CHN;
     1138     3911        %KH$CHN;                                /*  CHANNEL TABLES ITEM DEFINITONS    */
     1139     4035        %INCLUDE KH_CHN;
     1140     4075        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
     1141     4093 S      %INCLUDE KV$GLB;
     1142     4094        %INCLUDE KV_ASCCHR_E;
     1143     4231 S      %INCLUDE KV_GLBCNS_E;
     1144     4232 S      %INCLUDE KV$GLBCTX;
     1145     4233
     1146     4234        %INCLUDE KV_GLB_M;
     1147     4356        %INCLUDE KA$GLB;
     1148     4497        %INCLUDE KA_GLB;
     1149     4574        %INCLUDE KA_GLB_E;
     1150     4652        %KA_HLTOTP_E;
     1151     4661        %KA_STT;                                /*  STATISTICS                        */
     1152     5024        %KA_MSC;
     1153     5046 S      %INCLUDE KV$VDH;
     1154     5047        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
     1155     5171        %KA$OTPBFR;                             /*  ASYNC output buffer               */
     1156     5199        %KV$SSN;                                /*  VDH Session                       */
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:187  
     1157     5278        %KV$STT (NAME = KV_STT, STCLASS = SYMREF);
     1158     5672        %KV$PTR;                                /*  VDH Pointers, status              */
     1159     5715        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
     1160     5786        %KV$MRD;                                /* MASTER REAL DEVICE                 */
     1161     5833        %KV$ERD;                                /* EXTENDED REAL DEVICE               */
     1162     5917
     1163     5918    1   DCL KAV$VDI ENTRY(1) ALTRET;
     1164     5919    1   DCL KAO$OTPBNRCHR ENTRY(1);
     1165     5920    1   DCL KAO$TRNOTPIOLD ENTRY;
     1166     5921    1   DCL FLWBYT UBIN;
     1167     5922    1   DCL PARM1 UBIN;
     1168     5923    1   DCL PARM UBIN;
     1169     5924        %KV$USR_GETOTPBFR (NAME=KV_USR_GETOTPBFR, STCLASS=SYMREF READONLY);
     1170     5959    1   DCL Y$BYT(0:0) UBIN BYTE BASED CALIGNED;
     1171     5960
     1172     5961
     1173     5962    1      %KV_VDI.TMPOTPCHRCNT = 1;            /* (counting this one)                */
     1174     5963    2      IF (%KV_ERD.DVCOTPBFRSIZ >= 10) THEN DO;
     1175     5964
     1176     5965        /* THE OUTPUT BUFFER IN THE DEVICE IS REASONABLY LARGE.                       */
     1177     5966        /* DO FLOW CONTROL FOR THE DEVICE.                                            */
     1178     5967
     1179     5968    2         %KA_CTX.OTPCHRCNTUTLHLT = %KV_ERD.DVCOTPBFRSIZ;
     1180     5969    2      END; ELSE DO;
     1181     5970
     1182     5971        /* THE DECLARED SIZE OF THE OUTPUT BUFFER IN THE DEVICE ISN'T                 */
     1183     5972        /* REASONABLY LARGE. IT'S PROBABLY MISDECLARED. WE CAN'T USE IT.              */
     1184     5973
     1185     5974    2         %KA_CTX.OTPCHRCNTUTLHLT = 256;
     1186     5975    2      END /* IF */;
     1187     5976    1      FLWBYT = KA_DVCFLWCTRCHR(%KV_MRD.DVCFLWCTRALG);
     1188     5977    1      CALL Y$SNDBYT;
     1189     5978    1      PARM1 = %KA#HLTOTP_DVCX;
     1190     5979    1      GOTO SUB_COMMON;
     1191     5980    1   KAO$SNCHLTOTP: ENTRY (PARM);
     1192     5981    1      PARM1 = PARM;
     1193     5982    1   SUB_COMMON:;
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:188  
     1194     5983    2      IF (%KV_SSN.USRHLTINH AND (PARM1 = %KA#HLTOTP_USRX)) THEN DO;
     1195     5984
     1196     5985        /* THIS IS A USER OUTPUT HALT REQUEST, AND USER HALTS ARE INHIBITED.          */
     1197     5986
     1198     5987    2         RETURN;
     1199     5988    2      END /* IF */;
     1200     5989    1      IF (%KV_VDI.HALFDUPLEXPAPERTAPE OR %KV_VDI.FULLDUPLEXPAPERTAPE)
     1201     5990    2        AND NOT %KV_SSN.REDRQSPND THEN DO;
     1202     5991    2         FLWBYT = BITBIN(%ASCIIDC1);
     1203     5992    2         CALL Y$SNDBYT;
     1204     5993    1      END; ELSE FLWBYT = 0;
     1205     5994    1      CALL KAO$TRNOTPIOLD;
     1206     5995    2      IF (%KA_CTX.OTPBFRTAL$ ~= ADDR(NIL)) THEN DO;
     1207     5996
     1208     5997        /* WE HAVE AN OUTPUT BUFFER CHAIN* SET THE HALT BIT IN THE NEXT OUTPUT BUFFER */
     1209     5998
     1210     5999    2         %KA_CTX.HLTOTPNXTBFR.BITT(PARM1) = '1'B;
     1211     6000    2      END; ELSE DO;
     1212     6001
     1213     6002        /* THERE IS NO OUTPUT BUFFER CHAIN* OUTPUT IS CURRENTLY HALTED.               */
     1214     6003
     1215     6004    2         %KA_CTX.HLTOTP.BITT(PARM1) = '1'B;
     1216     6005    2      END /* IF */;
     1217     6006    2      IF FLWBYT~=0 THEN DO;
     1218     6007    2         FLWBYT = BITBIN(%ASCIIDC3);
     1219     6008    2         CALL Y$SNDBYT;
     1220     6009    2      END;
     1221     6010    1      RETURN;
     1222     6011
     1223     6012    1   Y$SNDBYT: PROC;
     1224     6013
     1225     6014    3      IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN DO;
     1226     6015    4         CALL KAV$VDI (KV_USR_GETOTPBFR) WHENALTRETURN DO;
     1227     6016    4            RETURN;
     1228     6017    4         END;
     1229     6018    3      END;
     1230     6019
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:189  
     1231     6020    2      %KV_SSN.OTPCHRCNT = %KV_SSN.OTPCHRCNT+1;
     1232     6021    2      KV_STT.OTPCHRCNT = KV_STT.OTPCHRCNT+1;
     1233     6022
     1234     6023    2      %KV_VDI.OTPBFR_.ADR$->Y$BYT(%KV_VDI.OTPBFR_.BYTX) = FLWBYT;
     1235     6024    2      %KV_VDI.OTPBFR_.BYTX = %KV_VDI.OTPBFR_.BYTX+1;
     1236     6025    2      %KV_VDI.OTPBFR_.BYTSIZ = %KV_VDI.OTPBFR_.BYTSIZ-1;
     1237     6026    2      RETURN;
     1238     6027    2   END Y$SNDBYT;
     1239     6028    1   END KAO$SNCFLWCTRHLT;
     1240     6029
     1241     6030        %EOD;

PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:190  
--  Include file information  --

   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$SNCFLWCTRHLT.

   Procedure KAO$SNCFLWCTRHLT requires 210 words for executable code.
   Procedure KAO$SNCFLWCTRHLT requires 10 words of local(AUTO) storage.
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:191  

PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:192  

 Object Unit name= KAO$SNCFLWCTRHLT                           File name= KAO$OTP.:E05TOU
 UTS= JUL 30 '97 00:03:19.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   210     D2  KAO$SNCFLWCTRHLT
    1  RoData even  none     2      2  KAO$SNCFLWCTRHLT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KAO$SNCFLWCTRHLT
     0     36                  yes      Std        1  KAO$SNCHLTOTP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 KAO$TRNOTPIOLD
 yes     yes           Std       1 KAV$VDI
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNHI                         r    KH_CHNLOW                             KA_DVCFLWCTRCHR
     KV_STT                                KV$PTR$                          r    KV_USR_GETOTPBFR
r    G$ROS$
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:193  


     1120        1        /*T***********************************************************/
     1121        2        /*T*                                                         */
     1122        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1123        4        /*T*                                                         */
     1124        5        /*T***********************************************************/
     1125        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
     1126        7
     1127        8
     1128        9        KAO$SNCFLWCTRHLT: PROC (PARM);

      9   0 000000  D380 0000 0000  xent KAO$SNCFLWCTRHLTLNJ,B5   X6A_AUTO_1
          0 000003       000A 0001                       DC       10,1

     1129       10        %INCLUDE LCP_6;
     1130      201        %INCLUDE KL_MACRO_C;                    /* For KA_STT/KV$STT                  */
     1131     3553        %INCLUDE KL_AFCN_C;                     /* For KA_STT/KV$STT                  */
     1132     3654        %INCLUDE K_ID_E;                        /* For KA_STT/KV$STT                  */
     1133     3704         %K#ENTID_E;                            /* For KA_STT/KV$STT                  */
     1134     3723         %K#LYRID_E;                            /* For KA_STT/KV$STT                  */
     1135     3730        %INCLUDE KH$STT;                        /* For KA_STT                         */
     1136     3760        %INCLUDE KV$BPC;
     1137     3789        %INCLUDE KH$CHN;
     1138     3911        %KH$CHN;                                /*  CHANNEL TABLES ITEM DEFINITONS    */
     1139     4035        %INCLUDE KH_CHN;
     1140     4075        %KH_CHNDAT;                             /*  CHANNEL TABLES ITEM DEFINITONS    */
     1141     4093 S      %INCLUDE KV$GLB;
     1142     4094        %INCLUDE KV_ASCCHR_E;
     1143     4231 S      %INCLUDE KV_GLBCNS_E;
     1144     4232 S      %INCLUDE KV$GLBCTX;
     1145     4233
     1146     4234        %INCLUDE KV_GLB_M;
     1147     4356        %INCLUDE KA$GLB;
     1148     4497        %INCLUDE KA_GLB;
     1149     4574        %INCLUDE KA_GLB_E;
     1150     4652        %KA_HLTOTP_E;
     1151     4661        %KA_STT;                                /*  STATISTICS                        */
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:194  
     1152     5024        %KA_MSC;
     1153     5046 S      %INCLUDE KV$VDH;
     1154     5047        %KA$CTX;                           /*  ASYNC CONTEXT BLOCK ITEM DEFINITIONS   */
     1155     5171        %KA$OTPBFR;                             /*  ASYNC output buffer               */
     1156     5199        %KV$SSN;                                /*  VDH Session                       */
     1157     5278        %KV$STT (NAME = KV_STT, STCLASS = SYMREF);
     1158     5672        %KV$PTR;                                /*  VDH Pointers, status              */
     1159     5715        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
     1160     5786        %KV$MRD;                                /* MASTER REAL DEVICE                 */
     1161     5833        %KV$ERD;                                /* EXTENDED REAL DEVICE               */
     1162     5917
     1163     5918    1   DCL KAV$VDI ENTRY(1) ALTRET;
     1164     5919    1   DCL KAO$OTPBNRCHR ENTRY(1);
     1165     5920    1   DCL KAO$TRNOTPIOLD ENTRY;
     1166     5921    1   DCL FLWBYT UBIN;
     1167     5922    1   DCL PARM1 UBIN;
     1168     5923    1   DCL PARM UBIN;
     1169     5924        %KV$USR_GETOTPBFR (NAME=KV_USR_GETOTPBFR, STCLASS=SYMREF READONLY);
     1170     5959    1   DCL Y$BYT(0:0) UBIN BYTE BASED CALIGNED;
     1171     5960
     1172     5961
     1173     5962    1      %KV_VDI.TMPOTPCHRCNT = 1;            /* (counting this one)                */

   5962   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DC86                                 LDB,B5   ,B6
          0 000009  6C01                                 LDV,R6   1
          0 00000A  EF45 0015                            STR,R6   21,B5

     1174     5963    2      IF (%KV_ERD.DVCOTPBFRSIZ >= 10) THEN DO;

   5963   0 00000C  DCC6 0008                            LDB,B5   8,B6
          0 00000E  CCC5 0008                            LDB,B4   8,B5
          0 000010  D844 0013                            LDR,R5   19,B4
          0 000012  5D0A                                 CMV,R5   10
          0 000013  0201 0008                            BL       s:5974,PREL

     1175     5964
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:195  
     1176     5965        /* THE OUTPUT BUFFER IN THE DEVICE IS REASONABLY LARGE.                       */
     1177     5966        /* DO FLOW CONTROL FOR THE DEVICE.                                            */
     1178     5967
     1179     5968    2         %KA_CTX.OTPCHRCNTUTLHLT = %KV_ERD.DVCOTPBFRSIZ;

   5968   0 000015  BC86                                 LDB,B3   ,B6
          0 000016  ACC3 0002                            LDB,B2   2,B3
          0 000018  DF42 000C                            STR,R5   12,B2

     1180     5969    2      END; ELSE DO;

   5969   0 00001A  0F81 0008                            B        s:5976,PREL

     1181     5970
     1182     5971        /* THE DECLARED SIZE OF THE OUTPUT BUFFER IN THE DEVICE ISN'T                 */
     1183     5972        /* REASONABLY LARGE. IT'S PROBABLY MISDECLARED. WE CAN'T USE IT.              */
     1184     5973
     1185     5974    2         %KA_CTX.OTPCHRCNTUTLHLT = 256;

   5974   0 00001C  BC86                                 LDB,B3   ,B6
          0 00001D  ACC3 0002                            LDB,B2   2,B3
          0 00001F  C870 0100                            LDR,R4   256,IMO
          0 000021  CF42 000C                            STR,R4   12,B2

     1186     5975    2      END /* IF */;

     1187     5976    1      FLWBYT = KA_DVCFLWCTRCHR(%KV_MRD.DVCFLWCTRALG);

   5976   0 000023  DCC6 0008                            LDB,B5   8,B6
          0 000025  B845 0015                            LDR,R3   21,B5
          0 000027  B570 00FF                            AND,R3   255,IMO
          0 000029  3001                                 SOL,R3   1
          0 00002A  D2B0 0000 0000  xsym                 LLH,R5   KA_DVCFLWCTRCHR,R3
          0 00002D  DF47 0006                            STR,R5   FLWBYT,AUTO

     1188     5977    1      CALL Y$SNDBYT;

PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:196  
   5977   0 00002F  E3C0 0065                            LNJ,B6   s:0,PREL
          0 000031       0001                            DC       s:5978,PREL

     1189     5978    1      PARM1 = %KA#HLTOTP_DVCX;

   5978   0 000032  8747 0007                            CL       PARM1,AUTO

     1190     5979    1      GOTO SUB_COMMON;

   5979   0 000034  0F81 000B                            B        s:5981,PREL

     1191     5980    1   KAO$SNCHLTOTP: ENTRY (PARM);

   5980   0 000036  D380 0000 0000  xent KAO$SNCHLTOTP   LNJ,B5   X6A_AUTO_1
          0 000039       000A 0001                       DC       10,1

     1192     5981    1      PARM1 = PARM;

   5981   0 00003B  ECC7 0004                            LDB,B6   @PARM,AUTO
          0 00003D  E806                                 LDR,R6   ,B6
          0 00003E  EF47 0007                            STR,R6   PARM1,AUTO

   5981   0                              SUB_COMMON      null
     1193     5982    1   SUB_COMMON:;
     1194     5983    2      IF (%KV_SSN.USRHLTINH AND (PARM1 = %KA#HLTOTP_USRX)) THEN DO;

   5983   0 000040  EC80 0000 0000  xsym SUB_COMMON      LDB,B6   KV$PTR$
          0 000043  DCC6 0002                            LDB,B5   2,B6
          0 000045  82C5 0028                            LB,'0010'X        40,B5
          0 000047       0010
          0 000048  0581 0009                            BBF      s:5989,PREL
          0 00004A  E847 0007                            LDR,R6   PARM1,AUTO
          0 00004C  6D01                                 CMV,R6   1
          0 00004D  0981 0004                            BNE      s:5989,PREL

     1195     5984
     1196     5985        /* THIS IS A USER OUTPUT HALT REQUEST, AND USER HALTS ARE INHIBITED.          */
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:197  
     1197     5986
     1198     5987    2         RETURN;

   5987   0 00004F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1199     5988    2      END /* IF */;
     1200     5989    1      IF (%KV_VDI.HALFDUPLEXPAPERTAPE OR %KV_VDI.FULLDUPLEXPAPERTAPE)

   5989   0 000052  CC86                                 LDB,B4   ,B6
          0 000053  82C4 0019                            LB,'0002'X        25,B4
          0 000055       0002
          0 000056  0501 0006                            BBT      s:5989+11,PREL
          0 000058  82C4 0019                            LB,'0020'X        25,B4
          0 00005A       0020
          0 00005B  0581 000E                            BBF      s:5993+2,PREL
          0 00005D  82C5 0028                            LB,'0002'X        40,B5
          0 00005F       0002
          0 000060  0501 0009                            BBT      s:5993+2,PREL

     1201     5990    2        AND NOT %KV_SSN.REDRQSPND THEN DO;

     1202     5991    2         FLWBYT = BITBIN(%ASCIIDC1);

   5991   0 000062  6C11                                 LDV,R6   17
          0 000063  EF47 0006                            STR,R6   FLWBYT,AUTO

     1203     5992    2         CALL Y$SNDBYT;

   5992   0 000065  E3C0 002F                            LNJ,B6   s:0,PREL
          0 000067       0001                            DC       s:5993,PREL

     1204     5993    1      END; ELSE FLWBYT = 0;

   5993   0 000068  0F81 0003                            B        s:5994,PREL

   5993   0 00006A  8747 0006                            CL       FLWBYT,AUTO

PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:198  
     1205     5994    1      CALL KAO$TRNOTPIOLD;

   5994   0 00006C  CBF0 0000                            LAB,B4   0,IMO
          0 00006E  E380 0000 0000  xent                 LNJ,B6   KAO$TRNOTPIOLD
          0 000071       0001                            DC       s:5995,PREL

     1206     5995    2      IF (%KA_CTX.OTPBFRTAL$ ~= ADDR(NIL)) THEN DO;

   5995   0 000072  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000075  DC86                                 LDB,B5   ,B6
          0 000076  CCC5 0002                            LDB,B4   2,B5
          0 000078  8DC4 0006                            CMN      6,B4
          0 00007A  0901 0008                            BE       s:6004,PREL

     1207     5996
     1208     5997        /* WE HAVE AN OUTPUT BUFFER CHAIN* SET THE HALT BIT IN THE NEXT OUTPUT BUFFER */
     1209     5998
     1210     5999    2         %KA_CTX.HLTOTPNXTBFR.BITT(PARM1) = '1'B;

   5999   0 00007C  BBC4 001D                            LAB,B3   29,B4
          0 00007E  B847 0007                            LDR,R3   PARM1,AUTO
          0 000080  8933                                 LBT      ,B3,R3

     1211     6000    2      END; ELSE DO;

   6000   0 000081  0F81 0006                            B        s:6006,PREL

     1212     6001
     1213     6002        /* THERE IS NO OUTPUT BUFFER CHAIN* OUTPUT IS CURRENTLY HALTED.               */
     1214     6003
     1215     6004    2         %KA_CTX.HLTOTP.BITT(PARM1) = '1'B;

   6004   0 000083  BBC4 001C                            LAB,B3   28,B4
          0 000085  B847 0007                            LDR,R3   PARM1,AUTO
          0 000087  8933                                 LBT      ,B3,R3

     1216     6005    2      END /* IF */;
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:199  

     1217     6006    2      IF FLWBYT~=0 THEN DO;

   6006   0 000088  E847 0006                            LDR,R6   FLWBYT,AUTO
          0 00008A  6901 0007                            BEZ,R6   s:6010,PREL

     1218     6007    2         FLWBYT = BITBIN(%ASCIIDC3);

   6007   0 00008C  6C13                                 LDV,R6   19
          0 00008D  EF47 0006                            STR,R6   FLWBYT,AUTO

     1219     6008    2         CALL Y$SNDBYT;

   6008   0 00008F  E3C0 0005                            LNJ,B6   s:0,PREL
          0 000091       0001                            DC       s:6010,PREL

     1220     6009    2      END;

     1221     6010    1      RETURN;

   6010   0 000092  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1222     6011
     1223     6012    1   Y$SNDBYT: PROC;

   6012   0 000095  EFC7 0008            Y$SNDBYT        STB,B6   PARM1+1,AUTO

     1224     6013
     1225     6014    3      IF %KV_VDI.OTPBFR_.BYTSIZ=0 THEN DO;

   6014   0 000097  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 00009A  CC85                                 LDB,B4   ,B5
          0 00009B  E844 000D                            LDR,R6   13,B4
          0 00009D  6981 0010                            BNEZ,R6  s:6020,PREL

     1226     6015    4         CALL KAV$VDI (KV_USR_GETOTPBFR) WHENALTRETURN DO;

PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:200  
   6015   0 00009F  BB80 0000 0000  01                   LAB,B3   0
          0 0000A2  CBF0 0100                            LAB,B4   256,IMO
          0 0000A4  E380 0000 0000  xent                 LNJ,B6   KAV$VDI
          0 0000A7       0003                            DC       s:6016,PREL
          0 0000A8  0F81 0005                            B        s:6020,PREL

     1227     6016    4            RETURN;

   6016   0 0000AA  ECC7 0008                            LDB,B6   PARM1+1,AUTO
          0 0000AC  C3C6 0001                            LNJ,B4   1,B6

     1228     6017    4         END;
     1229     6018    3      END;

     1230     6019
     1231     6020    2      %KV_SSN.OTPCHRCNT = %KV_SSN.OTPCHRCNT+1;

   6020   0 0000AE  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0000B1  DCC6 0002                            LDB,B5   2,B6
          0 0000B3  8AC5 0019                            INC      25,B5
          0 0000B5  8EC5 0018                            CAD      24,B5

     1232     6021    2      KV_STT.OTPCHRCNT = KV_STT.OTPCHRCNT+1;

   6021   0 0000B7  8A80 0000 0035  xsym                 INC      KV_STT+53
          0 0000BA  8E80 0000 0034  xsym                 CAD      KV_STT+52

     1233     6022
     1234     6023    2      %KV_VDI.OTPBFR_.ADR$->Y$BYT(%KV_VDI.OTPBFR_.BYTX) = FLWBYT;

   6023   0 0000BD  DC86                                 LDB,B5   ,B6
          0 0000BE  CCC5 000A                            LDB,B4   10,B5
          0 0000C0  B845 000C                            LDR,R3   12,B5
          0 0000C2  E847 0006                            LDR,R6   FLWBYT,AUTO
          0 0000C4  E7B4                                 STH,R6   ,B4,R3

     1235     6024    2      %KV_VDI.OTPBFR_.BYTX = %KV_VDI.OTPBFR_.BYTX+1;
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:201  

   6024   0 0000C5  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0000C8  DC86                                 LDB,B5   ,B6
          0 0000C9  8AC5 000C                            INC      12,B5

     1236     6025    2      %KV_VDI.OTPBFR_.BYTSIZ = %KV_VDI.OTPBFR_.BYTSIZ-1;

   6025   0 0000CB  DC86                                 LDB,B5   ,B6
          0 0000CC  88C5 000D                            DEC      13,B5

     1237     6026    2      RETURN;

   6026   0 0000CE  ECC7 0008                            LDB,B6   PARM1+1,AUTO
          0 0000D0  C3C6 0001                            LNJ,B4   1,B6
     1238     6027    2   END Y$SNDBYT;
     1239     6028    1   END KAO$SNCFLWCTRHLT;
     1240     6029
     1241     6030        %EOD;

PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:202  
--  Include file information  --

   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KAO$SNCFLWCTRHLT.
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:203  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PARM                      6-0-0/w UBIN(16)    r     1 FLWBYT
    *0-0-0/w UBIN(16)    r     1 PARM                       7-0-0/w UBIN(16)    r     1 PARM1

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(8)     r     1 KA_DVCFLWCTRCHR(0:3)
     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(8960)  r     1 KV_STT
     0-0-0/w STRC(32)    r     1 KV_USR_GETOTPBFR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KA$CTX                     0-0-0/w STRC(728)   r     1 KV$ERD
     0-0-0/w STRC(512)   r     1 KV$MRD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(1024)  r     1 KV$SSN                     0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/c UBIN(8)     r     1 Y$BYT(0:0)


   Procedure KAO$SNCFLWCTRHLT requires 210 words for executable code.
   Procedure KAO$SNCFLWCTRHLT requires 10 words of local(AUTO) storage.
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:204  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:205  
          MINI XREF LISTING

FLWBYT
      5921**DCL      5976<<ASSIGN   5991<<ASSIGN   5993<<ASSIGN   6006>>IF       6007<<ASSIGN   6023>>ASSIGN
KA$CTX.HLTOTP
      5161**DCL      5163--REDEF
KA$CTX.HLTOTP.BITT
      5163**DCL      6004<<ASSIGN
KA$CTX.HLTOTPNXTBFR
      5165**DCL      5166--REDEF
KA$CTX.HLTOTPNXTBFR.BITT
      5166**DCL      5999<<ASSIGN
KA$CTX.OTPBFRTAL$
      5074**DCL      5995>>IF
KA$CTX.OTPCHRCNTUTLHLT
      5076**DCL      5968<<ASSIGN   5974<<ASSIGN
KA$OTPBFR.HLTOTP
      5194**DCL      5195--REDEF
KAO$TRNOTPIOLD
      5920**DCL-ENT  5994--CALL
KAV$VDI
      5918**DCL-ENT  6015--CALL
KA_DVCFLWCTRCHR
      5042**DCL      5976>>ASSIGN
KA_STT.REQSTATS.DSPMSK
      4922**DCL      4928--REDEF
KA_STT.REQSTATS.SLCMSK
      4963**DCL      4970--REDEF
KH$CHN.TERMID.TERM
      4022**DCL      4031--REDEF
KH_CHNHI
      4088**DCL      4089--REDEF
KH_CHNLOW
      4089**DCL      4090--REDEF
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:206  
KV$ERD.DVCOTPBFRSIZ
      5890**DCL      5963>>IF       5968>>ASSIGN
KV$ERD.EXTSRD_CHR
      5911**DCL      5911--REDEF    5912--REDEF
KV$MRD.DVCFLWCTRALG
      5812**DCL      5976>>ASSIGN
KV$MRD.ERD$
      5808**DCL      5963>>IF       5968>>ASSIGN
KV$PTR.INPCNDPND
      5699**DCL      5708--REDEF    5712--REDEF
KV$PTR.LINLST$
      5695**DCL      5696--REDEF
KV$PTR.MRD$
      5694**DCL      5963>>IF       5968>>ASSIGN   5976>>ASSIGN
KV$PTR.SSN$
      5693**DCL      5983>>IF       5989>>IF       6020>>ASSIGN   6020>>ASSIGN
KV$PTR.VDI$
      5693**DCL      5962>>ASSIGN   5968>>ASSIGN   5974>>ASSIGN   5989>>IF       5989>>IF       5995>>IF
      5999>>ASSIGN   6004>>ASSIGN   6014>>IF       6023>>ASSIGN   6023>>ASSIGN   6024>>ASSIGN   6024>>ASSIGN
      6025>>ASSIGN   6025>>ASSIGN
KV$PTR$
      5687**DCL      5693--IMP-PTR  5962>>ASSIGN   5963>>IF       5968>>ASSIGN   5968>>ASSIGN   5974>>ASSIGN
      5976>>ASSIGN   5983>>IF       5989>>IF       5989>>IF       5989>>IF       5995>>IF       5999>>ASSIGN
      6004>>ASSIGN   6014>>IF       6020>>ASSIGN   6020>>ASSIGN   6023>>ASSIGN   6023>>ASSIGN   6024>>ASSIGN
      6024>>ASSIGN   6025>>ASSIGN   6025>>ASSIGN
KV$SSN.OTPCHRCNT
      5228**DCL      6020<<ASSIGN   6020>>ASSIGN
KV$SSN.REDRQSPND
      5240**DCL      5989>>IF
KV$SSN.REDRSPCNT
      5228**DCL      5229--REDEF
KV$SSN.USRHLTINH
      5239**DCL      5983>>IF
KV$VDI.FULLDUPLEXPAPERTAPE
      5771**DCL      5989>>IF
KV$VDI.HALFDUPLEXPAPERTAPE
PL6.E3A0      #008=KAO$SNCFLWCTRHLT File=KAO$OTP.:E05TSI                         WED 07/30/97 00:03 Page:207  
      5772**DCL      5989>>IF
KV$VDI.OTPBFR_.ADR$
      5762**DCL      6023>>ASSIGN
KV$VDI.OTPBFR_.BYTSIZ
      5762**DCL      6014>>IF       6025<<ASSIGN   6025>>ASSIGN
KV$VDI.OTPBFR_.BYTX
      5762**DCL      6023>>ASSIGN   6024<<ASSIGN   6024>>ASSIGN
KV$VDI.TMPOTPCHRCNT
      5767**DCL      5962<<ASSIGN
KV$VDI.USRCTX$
      5736**DCL      5968>>ASSIGN   5974>>ASSIGN   5995>>IF       5999>>ASSIGN   6004>>ASSIGN
KV_STT.OTPCHRCNT
      5660**DCL      6021<<ASSIGN   6021>>ASSIGN
KV_STT.REQSTATS.DSPMSK
      5551**DCL      5557--REDEF
KV_STT.REQSTATS.SLCMSK
      5592**DCL      5599--REDEF
KV_USR_GETOTPBFR
      5951**DCL      6015<>CALL
PARM
      5923**DCL         9--PROC     5980--ENTRY    5981>>ASSIGN
PARM1
      5922**DCL      5978<<ASSIGN   5981<<ASSIGN   5983>>IF       5999>>ASSIGN   6004>>ASSIGN
SUB_COMMON
      5981**LABEL    5979--GOTO
Y$BYT
      5959**DCL      6023<<ASSIGN
Y$SNDBYT
      6012**PROC     5977--CALL     5992--CALL     6008--CALL

PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:208  
     1242        1        /*T***********************************************************/
     1243        2        /*T*                                                         */
     1244        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1245        4        /*T*                                                         */
     1246        5        /*T***********************************************************/
     1247        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
     1248        7
     1249        8
     1250        9
     1251       10        /* THE PURPOSE OF THIS ROUTINE IS TO OUTPUT THE CONTROL STRING PASSED         */
     1252       11        /* AS AN ARGUMENT IN THE KA$BFRCTRSTR STRUCTURE                               */
     1253       12
     1254       13
     1255       14        KAO$BFRCTRSTR: PROC(PRM_BFRCTRSTR);
     1256       15
     1257       16 S      %INCLUDE KV$GLB;
     1258       17 S      %INCLUDE KV$GLBCTX;
     1259       18        %INCLUDE KA$GLB;
     1260      159        %INCLUDE KA_GLB;
     1261      236        %INCLUDE KA_GLB_E;
     1262      314        %KA_HLTOTP_E;
     1263      323        %KA$CTX;
     1264      447        %KV$PTR;                                /*  VDH Pointers, status              */
     1265      490        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
     1266      561
     1267      562 S      %INCLUDE KV$USR;
     1268      563
     1269      564    1   DCL KAO$TRNOTPIOLD ENTRY;
     1270      565    1   DCL KAV$VDI ENTRY(1) ALTRET;
     1271      566
     1272      567
     1273      568        %KV$USR_GETOTPBFR (NAME=Y@USR_GETOTPBFR, STCLASS=AUTO);
     1274      603        %KV$USR_GETOTPBFR (NAME=KV_USR_GETOTPBFR, STCLASS=SYMREF);
     1275      638        %KA$BFRCTRSTR(FPTN=PRM_BFRCTRSTR,STCLASS=);
     1276      665
     1277      666    1   DCL Y$BYT CHAR(PRM_BFRCTRSTR.TXTSIZ) CALIGNED BASED;
     1278      667
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:209  
     1279      668    2      IF %KV_VDI.OTPBFR_.BYTSIZ<PRM_BFRCTRSTR.TXTSIZ THEN DO;
     1280      669
     1281      670    2         Y@USR_GETOTPBFR = KV_USR_GETOTPBFR;
     1282      671    2         Y@USR_GETOTPBFR.ESTBYTSIZ = PRM_BFRCTRSTR.TXTSIZ;
     1283      672    2         CALL KAV$VDI(Y@USR_GETOTPBFR) ;
     1284      673    3         IF %KV_VDI.OTPBFR_.BYTSIZ < PRM_BFRCTRSTR.TXTSIZ THEN DO;
     1285      674    3            CALL KAO$TRNOTPIOLD;           /* Get rid of this one, its too small */
     1286      675    3            %KA_CTX.PRVOTPBFRDATEXCSML = '1'B;
     1287      676    3            CALL KAV$VDI (Y@USR_GETOTPBFR);
     1288      677    3            IF %KV_VDI.OTPBFR_.BYTSIZ = 0 THEN RETURN; /* Got aborted            */
     1289      678    3         END;
     1290      679    2      END /* IF */;
     1291      680
     1292      681        /* MOVE IN THE CONTROL STRING                                                 */
     1293      682
     1294      683    1      PINCRC (%KV_VDI.OTPBFR_.ADR$, %KV_VDI.OTPBFR_.BYTX)->Y$BYT =
     1295      684    1        PINCRC (ADDR(PRM_BFRCTRSTR),1)->Y$BYT;
     1296      685
     1297      686    1      %KV_VDI.OTPBFR_.BYTX = %KV_VDI.OTPBFR_.BYTX+PRM_BFRCTRSTR.TXTSIZ;
     1298      687    1      %KV_VDI.OTPBFR_.BYTSIZ = %KV_VDI.OTPBFR_.BYTSIZ-PRM_BFRCTRSTR.TXTSIZ;
     1299      688
     1300      689    1   END KAO$BFRCTRSTR;
     1301      690
     1302      691        %EOD;

PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:210  
--  Include file information  --

   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KAO$BFRCTRSTR.

   Procedure KAO$BFRCTRSTR requires 115 words for executable code.
   Procedure KAO$BFRCTRSTR requires 10 words of local(AUTO) storage.

PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:211  

 Object Unit name= KAO$BFRCTRSTR                              File name= KAO$OTP.:E05TOU
 UTS= JUL 30 '97 00:04:00.88 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   115     73  KAO$BFRCTRSTR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KAO$BFRCTRSTR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KAV$VDI
         yes           Std       0 KAO$TRNOTPIOLD
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KV_USR_GETOTPBFR                 r    G$ROS$
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:212  


     1242        1        /*T***********************************************************/
     1243        2        /*T*                                                         */
     1244        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1245        4        /*T*                                                         */
     1246        5        /*T***********************************************************/
     1247        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
     1248        7
     1249        8
     1250        9
     1251       10        /* THE PURPOSE OF THIS ROUTINE IS TO OUTPUT THE CONTROL STRING PASSED         */
     1252       11        /* AS AN ARGUMENT IN THE KA$BFRCTRSTR STRUCTURE                               */
     1253       12
     1254       13
     1255       14        KAO$BFRCTRSTR: PROC(PRM_BFRCTRSTR);

     14   0 000000  D380 0000 0000  xent KAO$BFRCTRSTR   LNJ,B5   X6A_AUTO_1
          0 000003       000A 0001                       DC       10,1

     1256       15
     1257       16 S      %INCLUDE KV$GLB;
     1258       17 S      %INCLUDE KV$GLBCTX;
     1259       18        %INCLUDE KA$GLB;
     1260      159        %INCLUDE KA_GLB;
     1261      236        %INCLUDE KA_GLB_E;
     1262      314        %KA_HLTOTP_E;
     1263      323        %KA$CTX;
     1264      447        %KV$PTR;                                /*  VDH Pointers, status              */
     1265      490        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
     1266      561
     1267      562 S      %INCLUDE KV$USR;
     1268      563
     1269      564    1   DCL KAO$TRNOTPIOLD ENTRY;
     1270      565    1   DCL KAV$VDI ENTRY(1) ALTRET;
     1271      566
     1272      567
     1273      568        %KV$USR_GETOTPBFR (NAME=Y@USR_GETOTPBFR, STCLASS=AUTO);
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:213  
     1274      603        %KV$USR_GETOTPBFR (NAME=KV_USR_GETOTPBFR, STCLASS=SYMREF);
     1275      638        %KA$BFRCTRSTR(FPTN=PRM_BFRCTRSTR,STCLASS=);
     1276      665
     1277      666    1   DCL Y$BYT CHAR(PRM_BFRCTRSTR.TXTSIZ) CALIGNED BASED;
     1278      667
     1279      668    2      IF %KV_VDI.OTPBFR_.BYTSIZ<PRM_BFRCTRSTR.TXTSIZ THEN DO;

    668   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DC86                                 LDB,B5   ,B6
          0 000009  CCC7 0004                            LDB,B4   @PRM_BFRCTRSTR,AUTO
          0 00000B  E284                                 LLH,R6   ,B4
          0 00000C  E945 000D                            CMR,R6   13,B5
          0 00000E  0381 0046                            BLE      s:683,PREL

     1280      669
     1281      670    2         Y@USR_GETOTPBFR = KV_USR_GETOTPBFR;

    670   0 000010  8C80 0000 0000  xsym                 LDI      KV_USR_GETOTPBFR
          0 000013  8D47 0006                            SDI      Y@USR_GETOTPBFR,AUTO

     1282      671    2         Y@USR_GETOTPBFR.ESTBYTSIZ = PRM_BFRCTRSTR.TXTSIZ;

    671   0 000015  D284                                 LLH,R5   ,B4
          0 000016  DF47 0007                            STR,R5   Y@USR_GETOTPBFR+1,AUTO

     1283      672    2         CALL KAV$VDI(Y@USR_GETOTPBFR) ;

    672   0 000018  DBC7 0006                            LAB,B5   Y@USR_GETOTPBFR,AUTO
          0 00001A  DFC7 0008                            STB,B5   Y@USR_GETOTPBFR+2,AUTO
          0 00001C  BBC7 0008                            LAB,B3   Y@USR_GETOTPBFR+2,AUTO
          0 00001E  CBF0 0100                            LAB,B4   256,IMO
          0 000020  E380 0000 0000  xent                 LNJ,B6   KAV$VDI
          0 000023       0001                            DC       s:673,PREL

     1284      673    3         IF %KV_VDI.OTPBFR_.BYTSIZ < PRM_BFRCTRSTR.TXTSIZ THEN DO;

    673   0 000024  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:214  
          0 000027  DC86                                 LDB,B5   ,B6
          0 000028  CCC7 0004                            LDB,B4   @PRM_BFRCTRSTR,AUTO
          0 00002A  E284                                 LLH,R6   ,B4
          0 00002B  E945 000D                            CMR,R6   13,B5
          0 00002D  0381 0027                            BLE      s:683,PREL

     1285      674    3            CALL KAO$TRNOTPIOLD;           /* Get rid of this one, its too small */

    674   0 00002F  CBF0 0000                            LAB,B4   0,IMO
          0 000031  E380 0000 0000  xent                 LNJ,B6   KAO$TRNOTPIOLD
          0 000034       0001                            DC       s:675,PREL

     1286      675    3            %KA_CTX.PRVOTPBFRDATEXCSML = '1'B;

    675   0 000035  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000038  DC86                                 LDB,B5   ,B6
          0 000039  CCC5 0002                            LDB,B4   2,B5
          0 00003B  8944 001C                            LBT,'2000'X       28,B4
          0 00003D       2000

     1287      676    3            CALL KAV$VDI (Y@USR_GETOTPBFR);

    676   0 00003E  DBC7 0006                            LAB,B5   Y@USR_GETOTPBFR,AUTO
          0 000040  DFC7 0008                            STB,B5   Y@USR_GETOTPBFR+2,AUTO
          0 000042  BBC7 0008                            LAB,B3   Y@USR_GETOTPBFR+2,AUTO
          0 000044  CBF0 0100                            LAB,B4   256,IMO
          0 000046  E380 0000 0000  xent                 LNJ,B6   KAV$VDI
          0 000049       0001                            DC       s:677,PREL

     1288      677    3            IF %KV_VDI.OTPBFR_.BYTSIZ = 0 THEN RETURN; /* Got aborted            */

    677   0 00004A  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00004D  DC86                                 LDB,B5   ,B6
          0 00004E  E845 000D                            LDR,R6   13,B5
          0 000050  6981 0004                            BNEZ,R6  s:683,PREL

    677   0 000052  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:215  

     1289      678    3         END;
     1290      679    2      END /* IF */;
     1291      680
     1292      681        /* MOVE IN THE CONTROL STRING                                                 */
     1293      682
     1294      683    1      PINCRC (%KV_VDI.OTPBFR_.ADR$, %KV_VDI.OTPBFR_.BYTX)->Y$BYT =

    683   0 000055  B845 000C                            LDR,R3   12,B5
          0 000057  CCC5 000A                            LDB,B4   10,B5
          0 000059  BCC7 0004                            LDB,B3   @PRM_BFRCTRSTR,AUTO
          0 00005B  E283                                 LLH,R6   ,B3
          0 00005C  AB83                                 LAB,B2   ,B3
          0 00005D  2C01                                 LDV,R2   1
          0 00005E  BB84                                 LAB,B3   ,B4
          0 00005F  0008                                 MMM

     1295      684    1        PINCRC (ADDR(PRM_BFRCTRSTR),1)->Y$BYT;
     1296      685
     1297      686    1      %KV_VDI.OTPBFR_.BYTX = %KV_VDI.OTPBFR_.BYTX+PRM_BFRCTRSTR.TXTSIZ;

    686   0 000060  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000063  DC86                                 LDB,B5   ,B6
          0 000064  E282                                 LLH,R6   ,B2
          0 000065  EA45 000C                            ADD,R6   12,B5
          0 000067  EF45 000C                            STR,R6   12,B5

     1298      687    1      %KV_VDI.OTPBFR_.BYTSIZ = %KV_VDI.OTPBFR_.BYTSIZ-PRM_BFRCTRSTR.TXTSIZ;

    687   0 000069  DC86                                 LDB,B5   ,B6
          0 00006A  E282                                 LLH,R6   ,B2
          0 00006B  E245 000D                            SUB,R6   13,B5
          0 00006D  8256                                 NEG      R6
          0 00006E  EF45 000D                            STR,R6   13,B5

     1299      688
     1300      689    1   END KAO$BFRCTRSTR;
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:216  

    689   0 000070  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1301      690
     1302      691        %EOD;

PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:217  
--  Include file information  --

   KA_GLB_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KAO$BFRCTRSTR.
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:218  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PRM_BFRCTRSTR            *0-0-0/w STRC(40)    r     1 PRM_BFRCTRSTR
     6-0-0/w STRC(32)    r     1 Y@USR_GETOTPBFR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(32)    r     1 KV_USR_GETOTPBFR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KA$CTX                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(512)   r     1 KV$VDI                     0-0-0/c ACHR        r     1 Y$BYT


   Procedure KAO$BFRCTRSTR requires 115 words for executable code.
   Procedure KAO$BFRCTRSTR requires 10 words of local(AUTO) storage.
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:219  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:220  
          MINI XREF LISTING

KA$CTX.HLTOTP
       437**DCL       439--REDEF
KA$CTX.HLTOTPNXTBFR
       441**DCL       442--REDEF
KA$CTX.PRVOTPBFRDATEXCSML
       439**DCL       675<<ASSIGN
KAO$TRNOTPIOLD
       564**DCL-ENT   674--CALL
KAV$VDI
       565**DCL-ENT   672--CALL      676--CALL
KV$PTR.INPCNDPND
       474**DCL       483--REDEF     487--REDEF
KV$PTR.LINLST$
       470**DCL       471--REDEF
KV$PTR.VDI$
       468**DCL       668>>IF        673>>IF        675>>ASSIGN    677>>IF        683>>ASSIGN    683>>ASSIGN
       686>>ASSIGN    686>>ASSIGN    687>>ASSIGN    687>>ASSIGN
KV$PTR$
       462**DCL       468--IMP-PTR   668>>IF        673>>IF        675>>ASSIGN    677>>IF        683>>ASSIGN
       683>>ASSIGN    686>>ASSIGN    686>>ASSIGN    687>>ASSIGN    687>>ASSIGN
KV$VDI.OTPBFR_.ADR$
       537**DCL       683>>ASSIGN
KV$VDI.OTPBFR_.BYTSIZ
       537**DCL       668>>IF        673>>IF        677>>IF        687<<ASSIGN    687>>ASSIGN
KV$VDI.OTPBFR_.BYTX
       537**DCL       683>>ASSIGN    686<<ASSIGN    686>>ASSIGN
KV$VDI.USRCTX$
       511**DCL       675>>ASSIGN
KV_USR_GETOTPBFR
       630**DCL       670>>ASSIGN
PRM_BFRCTRSTR
       651**DCL        14--PROC      683--ASSIGN
PL6.E3A0      #009=KAO$BFRCTRSTR File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:221  
PRM_BFRCTRSTR.TXTSIZ
       651**DCL       666--IMP-SIZ   668>>IF        671>>ASSIGN    673>>IF        683>>ASSIGN    683>>ASSIGN
       686>>ASSIGN    687>>ASSIGN
Y$BYT
       666**DCL       683<<ASSIGN    683>>ASSIGN
Y@USR_GETOTPBFR
       595**DCL       670<<ASSIGN    672<>CALL      676<>CALL
Y@USR_GETOTPBFR.ESTBYTSIZ
       601**DCL       671<<ASSIGN

PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:222  
     1303        1        /*T***********************************************************/
     1304        2        /*T*                                                         */
     1305        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1306        4        /*T*                                                         */
     1307        5        /*T***********************************************************/
     1308        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
     1309        7
     1310        8
     1311        9
     1312       10
     1313       11        KAO$BFRCRTCNF: PROC;
     1314       12 S      %INCLUDE KV_GLBCNS_E;
     1315       13        %KV_VDH_FNC_E;
     1316       33 S      %INCLUDE KV$GLB;
     1317       34 S      %INCLUDE KV$GLBCTX;
     1318       35        %KV$PTR;
     1319       78        %KV$VDI;
     1320      149        %KV$MRD;
     1321      196        %KV$ERD;
     1322      280
     1323      281        %INCLUDE KV_ASCCHR_E;
     1324      418        %INCLUDE KA_GLB;
     1325      495        %KA_MSC;                                /* to get KV_FLWCTRALG_.. equates     */
     1326      517        %INCLUDE KA_GLBASM_E;
     1327      599        %INCLUDE KA_GLB_E;
     1328      677        %KA_HLTOTP_E;
     1329      686        %INCLUDE KA$GLB;
     1330      827        %KA$OTPBFR;
     1331      855        %INCLUDE KH$CHN;
     1332      977        %KH$CHN;
     1333     1101    1   DCL KAO$BFRCTRSTR ENTRY(1);
     1334     1102
     1335     1103
     1336     1104
     1337     1105        %KA$BFRCTRSTR(FPTN=KA_BFRCTRSTR,FNC=CRTCNF,STCLASS=STATIC);
     1338     1132        %KA$BFRCTRSTR(FPTN=KA@BFRCTRSTR,FNC=CRTCNF,STCLASS=AUTO);
     1339     1159
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:223  
     1340     1160
     1341     1161        /*
     1342     1162           If ERD is not set up yet, just return because the configuration
     1343     1163           is going to change again shortly.
     1344     1164        */
     1345     1165
     1346     1166    1      IF (%KV_MRD.ERD$ = ADDR(NIL)) THEN RETURN;
     1347     1167
     1348     1168        /* SETUP THE CONTROL STRING TO INDICATE BUFFER CURRENT CONFIG                 */
     1349     1169
     1350     1170    1      KA@BFRCTRSTR = KA_BFRCTRSTR;
     1351     1171    1      KA@BFRCTRSTR.CRTCNF.LINSPD = %KV_VDI.LINSPD;
     1352     1172    1      KA@BFRCTRSTR.CRTCNF.PRT = 4 - %KV_VDI.PRTTYP;
     1353     1173    1      IF (%KV_MRD.DVCFLWCTRALG = %G_DVCFLWCTRALG_DC1DC3#)
     1354     1174    1        OR %KH_CHN.DC1DC3NTWOTPFLWCTR THEN
     1355     1175    1      KA@BFRCTRSTR.CRTCNF.DC1DC3FLWCTR = '1'B;
     1356     1176    1      ELSE KA@BFRCTRSTR.CRTCNF.DC1DC3FLWCTR = '0'B;
     1357     1177    1      KA@BFRCTRSTR.TXTSIZ = 3;
     1358     1178    1      CALL KAO$BFRCTRSTR(KA@BFRCTRSTR) ;
     1359     1179    1      IF %KV_VDI.OTPBFR_.ADR$~=ADDR(NIL)
     1360     1180    1      THEN %KV_VDI.OTPBFR_.ADR$->KA$OTPBFR.CRTCNF_IN_BFR = '1'B;
     1361     1181    1   END KAO$BFRCRTCNF;
     1362     1182
     1363     1183        %EOD;

PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:224  
--  Include file information  --

   KH$CHN.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KAO$BFRCRTCNF.

   Procedure KAO$BFRCRTCNF requires 98 words for executable code.
   Procedure KAO$BFRCRTCNF requires 10 words of local(AUTO) storage.

PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:225  

 Object Unit name= KAO$BFRCRTCNF                              File name= KAO$OTP.:E05TOU
 UTS= JUL 30 '97 00:04:12.24 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none     3      3  KAO$BFRCRTCNF
    1   Proc  even  none    98     62  KAO$BFRCRTCNF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  KAO$BFRCRTCNF

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KAO$BFRCTRSTR
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                          r    G$ROS$
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:226  


     1303        1        /*T***********************************************************/
     1304        2        /*T*                                                         */
     1305        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1306        4        /*T*                                                         */
     1307        5        /*T***********************************************************/
     1308        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
     1309        7
     1310        8
     1311        9
     1312       10
     1313       11        KAO$BFRCRTCNF: PROC;

     11   1 000000  D380 0000 0000  xent KAO$BFRCRTCNF   LNJ,B5   X6A_AUTO_0
          1 000003       000A 0000                       DC       10,0

     1314       12 S      %INCLUDE KV_GLBCNS_E;
     1315       13        %KV_VDH_FNC_E;
     1316       33 S      %INCLUDE KV$GLB;
     1317       34 S      %INCLUDE KV$GLBCTX;
     1318       35        %KV$PTR;
     1319       78        %KV$VDI;
     1320      149        %KV$MRD;
     1321      196        %KV$ERD;
     1322      280
     1323      281        %INCLUDE KV_ASCCHR_E;
     1324      418        %INCLUDE KA_GLB;
     1325      495        %KA_MSC;                                /* to get KV_FLWCTRALG_.. equates     */
     1326      517        %INCLUDE KA_GLBASM_E;
     1327      599        %INCLUDE KA_GLB_E;
     1328      677        %KA_HLTOTP_E;
     1329      686        %INCLUDE KA$GLB;
     1330      827        %KA$OTPBFR;
     1331      855        %INCLUDE KH$CHN;
     1332      977        %KH$CHN;
     1333     1101    1   DCL KAO$BFRCTRSTR ENTRY(1);
     1334     1102
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:227  
     1335     1103
     1336     1104
     1337     1105        %KA$BFRCTRSTR(FPTN=KA_BFRCTRSTR,FNC=CRTCNF,STCLASS=STATIC);
     1338     1132        %KA$BFRCTRSTR(FPTN=KA@BFRCTRSTR,FNC=CRTCNF,STCLASS=AUTO);
     1339     1159
     1340     1160
     1341     1161        /*
     1342     1162           If ERD is not set up yet, just return because the configuration
     1343     1163           is going to change again shortly.
     1344     1164        */
     1345     1165
     1346     1166    1      IF (%KV_MRD.ERD$ = ADDR(NIL)) THEN RETURN;

   1166   1 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000008  DCC6 0008                            LDB,B5   8,B6
          1 00000A  8DC5 0008                            CMN      8,B5
          1 00000C  0981 0004                            BNE      s:1170,PREL

   1166   1 00000E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1347     1167
     1348     1168        /* SETUP THE CONTROL STRING TO INDICATE BUFFER CURRENT CONFIG                 */
     1349     1169
     1350     1170    1      KA@BFRCTRSTR = KA_BFRCTRSTR;

   1170   1 000011  AB80 0000 0000  00                   LAB,B2   KA_BFRCTRSTR
          1 000014  2C00                                 LDV,R2   0
          1 000015  6C05                                 LDV,R6   5
          1 000016  BB87                                 LAB,B3   ,AUTO
          1 000017  3C08                                 LDV,R3   8
          1 000018  0008                                 MMM

     1351     1171    1      KA@BFRCTRSTR.CRTCNF.LINSPD = %KV_VDI.LINSPD;

   1171   1 000019  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00001C  DC86                                 LDB,B5   ,B6
          1 00001D  E2C5 001E                            LLH,R6   30,B5
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:228  
          1 00001F  EAC7 0005                            SRM,R6,'000F'X    KA@BFRCTRSTR+1,AUTO
          1 000021       000F

     1352     1172    1      KA@BFRCTRSTR.CRTCNF.PRT = 4 - %KV_VDI.PRTTYP;

   1172   1 000022  DC86                                 LDB,B5   ,B6
          1 000023  E2C5 0019                            LLH,R6   25,B5
          1 000025  8256                                 NEG      R6
          1 000026  6E04                                 ADV,R6   4
          1 000027  6005                                 SOL,R6   5
          1 000028  EAC7 0005                            SRM,R6,'00E0'X    KA@BFRCTRSTR+1,AUTO
          1 00002A       00E0

     1353     1173    1      IF (%KV_MRD.DVCFLWCTRALG = %G_DVCFLWCTRALG_DC1DC3#)

   1173   1 00002B  DCC6 0008                            LDB,B5   8,B6
          1 00002D  E845 0015                            LDR,R6   21,B5
          1 00002F  E570 00FF                            AND,R6   255,IMO
          1 000031  6D03                                 CMV,R6   3
          1 000032  0901 0008                            BE       s:1175,PREL
          1 000034  CC86                                 LDB,B4   ,B6
          1 000035  AC84                                 LDB,B2   ,B4
          1 000036  82C2 0009                            LB,'4000'X        9,B2
          1 000038       4000
          1 000039  0581 0006                            BBF      s:1176,PREL

     1354     1174    1        OR %KH_CHN.DC1DC3NTWOTPFLWCTR THEN
     1355     1175    1      KA@BFRCTRSTR.CRTCNF.DC1DC3FLWCTR = '1'B;

   1175   1 00003B  8947 0005                            LBT,'0010'X       KA@BFRCTRSTR+1,AUTO
   1175   1 00003D       0010
          1 00003E  0F81 0004                            B        s:1177,PREL

     1356     1176    1      ELSE KA@BFRCTRSTR.CRTCNF.DC1DC3FLWCTR = '0'B;

   1176   1 000040  8847 0005                            LBF,'0010'X       KA@BFRCTRSTR+1,AUTO
   1176   1 000042       0010
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:229  

     1357     1177    1      KA@BFRCTRSTR.TXTSIZ = 3;

   1177   1 000043  5C03                                 LDV,R5   3
          1 000044  D7C7 0004                            STH,R5   KA@BFRCTRSTR,AUTO

     1358     1178    1      CALL KAO$BFRCTRSTR(KA@BFRCTRSTR) ;

   1178   1 000046  CBC7 0004                            LAB,B4   KA@BFRCTRSTR,AUTO
          1 000048  CFC7 0008                            STB,B4   KA@BFRCTRSTR+4,AUTO
          1 00004A  BBC7 0008                            LAB,B3   KA@BFRCTRSTR+4,AUTO
          1 00004C  CBF0 0100                            LAB,B4   256,IMO
          1 00004E  E380 0000 0000  xent                 LNJ,B6   KAO$BFRCTRSTR
          1 000051       0001                            DC       s:1179,PREL

     1359     1179    1      IF %KV_VDI.OTPBFR_.ADR$~=ADDR(NIL)

   1179   1 000052  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000055  DC86                                 LDB,B5   ,B6
          1 000056  8DC5 000A                            CMN      10,B5
          1 000058  0901 0006                            BE       s:1181,PREL

     1360     1180    1      THEN %KV_VDI.OTPBFR_.ADR$->KA$OTPBFR.CRTCNF_IN_BFR = '1'B;

   1180   1 00005A  CCC5 000A                            LDB,B4   10,B5
          1 00005C  8944 0003                            LBT,'0200'X       3,B4
          1 00005E       0200

     1361     1181    1   END KAO$BFRCRTCNF;

   1181   1 00005F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1362     1182
     1363     1183        %EOD;

PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:230  
--  Include file information  --

   KH$CHN.:E05TOU  is referenced.
   KA$GLB.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KAO$BFRCRTCNF.
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:231  

 **** Variables and constants ****

  ****  Section 000  Data  KAO$BFRCRTCNF

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(40)    r     1 KA_BFRCTRSTR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w STRC(40)    r     1 KA@BFRCTRSTR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(64)    r     1 KA$OTPBFR                  0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w STRC(512)   r     1 KV$MRD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KAO$BFRCRTCNF requires 98 words for executable code.
   Procedure KAO$BFRCRTCNF requires 10 words of local(AUTO) storage.
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:232  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:233  
          MINI XREF LISTING

KA$OTPBFR.CRTCNF_IN_BFR
       853**DCL      1180<<ASSIGN
KA$OTPBFR.HLTOTP
       850**DCL       851--REDEF
KA@BFRCTRSTR
      1145**DCL      1170<<ASSIGN   1178<>CALL
KA@BFRCTRSTR.CRTCNF
      1147**DCL      1149--REDEF
KA@BFRCTRSTR.CRTCNF.DC1DC3FLWCTR
      1148**DCL      1175<<ASSIGN   1176<<ASSIGN
KA@BFRCTRSTR.CRTCNF.LINSPD
      1148**DCL      1171<<ASSIGN
KA@BFRCTRSTR.CRTCNF.PRT
      1147**DCL      1172<<ASSIGN
KA@BFRCTRSTR.TXTSIZ
      1145**DCL      1177<<ASSIGN
KAO$BFRCTRSTR
      1101**DCL-ENT  1178--CALL
KA_BFRCTRSTR
      1118**DCL      1170>>ASSIGN
KA_BFRCTRSTR.CRTCNF
      1120**DCL      1122--REDEF
KH$CHN.DC1DC3NTWOTPFLWCTR
      1050**DCL      1173>>IF
KH$CHN.TERMID.TERM
      1088**DCL      1097--REDEF
KV$ERD.EXTSRD_CHR
       274**DCL       274--REDEF     275--REDEF
KV$MRD.DVCFLWCTRALG
       175**DCL      1173>>IF
KV$MRD.ERD$
       171**DCL      1166>>IF
PL6.E3A0      #010=KAO$BFRCRTCNF File=KAO$OTP.:E05TSI                            WED 07/30/97 00:04 Page:234  
KV$PTR.INPCNDPND
        62**DCL        71--REDEF      75--REDEF
KV$PTR.LINLST$
        58**DCL        59--REDEF
KV$PTR.MRD$
        57**DCL      1166>>IF       1173>>IF
KV$PTR.VDI$
        56**DCL      1171>>ASSIGN   1172>>ASSIGN   1173>>IF       1179>>IF       1180>>ASSIGN
KV$PTR$
        50**DCL        56--IMP-PTR  1166>>IF       1171>>ASSIGN   1172>>ASSIGN   1173>>IF       1173>>IF
      1179>>IF       1180>>ASSIGN
KV$VDI.CHN$
        99**DCL      1173>>IF
KV$VDI.LINSPD
       141**DCL      1171>>ASSIGN
KV$VDI.OTPBFR_.ADR$
       125**DCL      1179>>IF       1180>>ASSIGN
KV$VDI.PRTTYP
       133**DCL      1172>>ASSIGN

PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:235  
     1364        1        /*T***********************************************************/
     1365        2        /*T*                                                         */
     1366        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1367        4        /*T*                                                         */
     1368        5        /*T***********************************************************/
     1369        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
     1370        7        %EJECT;
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:236  
     1371        8
     1372        9        /*P*
     1373       10            NAME: KAO$MRK
     1374       11            PURPOSE:
     1375       12                  To return markers in output buffers to VDH.
     1376       13        */
     1377       14        /*D*
     1378       15            NAME: KAO$MRK
     1379       16            CALL: CALL KAO$MRK(KA$OTPBFR)
     1380       17                  There is no altret.
     1381       18            PARAMETERS:
     1382       19                  The parameter is an async output buffer (KA$OTPBFR),
     1383       20                  with the number of bytes successfully processed
     1384       21                  in this output buffer indicated in its BYTCNT field.
     1385       22            INTERFACE:
     1386       23                  It calls KVV$VDI to return the markers to VDH.
     1387       24            DESCRIPTION:
     1388       25                  Markers are stacked in reverse order (last marker in
     1389       26                  lower physical memory) at the bottom of the output
     1390       27                  buffers. KAO$MRK compares the byte count of each such
     1391       28                  marker with Y@BYTCNT to determine if output prior to
     1392       29                  this marker has been successfully processed. It then
     1393       30                  calls KVV$VDI with the marker data and the appropiate
     1394       31                  completion code (completed or deleted).
     1395       32        */
     1396       33        KAO$MRK: PROC(KA$OTPBFR);
     1397       34
     1398       35 S      %INCLUDE KV_GLBCNS_E;
     1399       36        %KV_CMPCOD_E;                           /* marker completion codes            */
     1400       50
     1401       51 S      %INCLUDE KV$GLB;
     1402       52 S      %INCLUDE KV$VDH;
     1403       53        %KV$VDH_OTPMRK(NAME = KV_VDH_OTPMRK, STCLASS = CONSTANT);
     1404      115        %KV$VDH_OTPMRK(NAME = KV@VDH_OTPMRK, STCLASS = AUTO);
     1405      177
     1406      178        %INCLUDE KA_GLB_E;
     1407      256        %KA_HLTOTP_E;
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:237  
     1408      265        %INCLUDE KA$GLB;
     1409      406        %KA$OTPBFR(STCLASS = PARAM);
     1410      434
     1411      435    1   DCL 1 KA$OTPMRK ALIGNED BASED(Y@MRK$),
     1412      436        %KV$OTPMRK(NAME = DAT, LVL = 2, LAST = ",");
     1413      463    1          2 BYTCNT SBIN WORD ALIGNED;
     1414      464
     1415      465    1   DCL Y@BYTCNT SBIN;
     1416      466    1   DCL Y@MRK$ PTR;
     1417      467    1   DCL Y_POWER_OF_2(0:15) SBIN WORD CONSTANT INIT(1, 2, 4, 8, 16, 32, 64, 128, 256,
     1418      468    1    512, 1024, 2048, 4096, 8192, 16384, 32764);
     1419      469    1   DCL I UBIN;
     1420      470
     1421      471    1   DCL KVV$VDI ENTRY(1) ALTRET;
     1422      472
     1423      473
     1424      474        /* nothing to do if there are no markers in the buffer. */
     1425      475
     1426      476    1      IF KA$OTPBFR.NMBMRK = 0 THEN RETURN;
     1427      477
     1428      478        /* loop to go thru all the markers */
     1429      479
     1430      480    1      Y@BYTCNT = KA$OTPBFR.BYTCNT;
     1431      481    1      KV@VDH_OTPMRK = KV_VDH_OTPMRK;
     1432      482    1      Y@MRK$ = PINCRW(ADDR(KA$OTPBFR), Y_POWER_OF_2(KA$OTPBFR.BYTSIZLOG2)/2);
     1433      483    2      DO I = 0 TO KA$OTPBFR.NMBMRK - 1;
     1434      484    2         Y@MRK$ = PINCRW(Y@MRK$, -SIZEW(KA$OTPMRK));
     1435      485    2         KV@VDH_OTPMRK.DAT = KA$OTPMRK.DAT;
     1436      486    2         IF Y@BYTCNT >= KA$OTPMRK.BYTCNT THEN
     1437      487    2         KV@VDH_OTPMRK.CMPCOD = %KV_CMPCOD_NRM;
     1438      488    2         ELSE KV@VDH_OTPMRK.CMPCOD = %KV_CMPCOD_DLT;
     1439      489    2         CALL KVV$VDI(KV@VDH_OTPMRK);
     1440      490    2      END; /* DO I = .... */
     1441      491    1      RETURN;
     1442      492    1   END KAO$MRK;

PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:238  
--  Include file information  --

   KA$GLB.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is never referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KAO$MRK.

   Procedure KAO$MRK requires 99 words for executable code.
   Procedure KAO$MRK requires 18 words of local(AUTO) storage.

    No errors detected in file KAO$OTP.:E05TSI    .

PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:239  

 Object Unit name= KAO$MRK                                    File name= KAO$OTP.:E05TOU
 UTS= JUL 30 '97 00:04:28.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     21     15  KAO$MRK
    1   Proc  even  none    99     63  KAO$MRK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KAO$MRK

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KVV$VDI
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    G$ROS$
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:240  


     1364        1        /*T***********************************************************/
     1365        2        /*T*                                                         */
     1366        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1367        4        /*T*                                                         */
     1368        5        /*T***********************************************************/
     1369        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
     1370        7        %EJECT;
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:241  
     1371        8
     1372        9        /*P*
     1373       10            NAME: KAO$MRK
     1374       11            PURPOSE:
     1375       12                  To return markers in output buffers to VDH.
     1376       13        */
     1377       14        /*D*
     1378       15            NAME: KAO$MRK
     1379       16            CALL: CALL KAO$MRK(KA$OTPBFR)
     1380       17                  There is no altret.
     1381       18            PARAMETERS:
     1382       19                  The parameter is an async output buffer (KA$OTPBFR),
     1383       20                  with the number of bytes successfully processed
     1384       21                  in this output buffer indicated in its BYTCNT field.
     1385       22            INTERFACE:
     1386       23                  It calls KVV$VDI to return the markers to VDH.
     1387       24            DESCRIPTION:
     1388       25                  Markers are stacked in reverse order (last marker in
     1389       26                  lower physical memory) at the bottom of the output
     1390       27                  buffers. KAO$MRK compares the byte count of each such
     1391       28                  marker with Y@BYTCNT to determine if output prior to
     1392       29                  this marker has been successfully processed. It then
     1393       30                  calls KVV$VDI with the marker data and the appropiate
     1394       31                  completion code (completed or deleted).
     1395       32        */
     1396       33        KAO$MRK: PROC(KA$OTPBFR);

     33   1 000000  D380 0000 0000  xent KAO$MRK         LNJ,B5   X6A_AUTO_1
          1 000003       0012 0001                       DC       18,1

     1397       34
     1398       35 S      %INCLUDE KV_GLBCNS_E;
     1399       36        %KV_CMPCOD_E;                           /* marker completion codes            */
     1400       50
     1401       51 S      %INCLUDE KV$GLB;
     1402       52 S      %INCLUDE KV$VDH;
     1403       53        %KV$VDH_OTPMRK(NAME = KV_VDH_OTPMRK, STCLASS = CONSTANT);
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:242  
     1404      115        %KV$VDH_OTPMRK(NAME = KV@VDH_OTPMRK, STCLASS = AUTO);
     1405      177
     1406      178        %INCLUDE KA_GLB_E;
     1407      256        %KA_HLTOTP_E;
     1408      265        %INCLUDE KA$GLB;
     1409      406        %KA$OTPBFR(STCLASS = PARAM);
     1410      434
     1411      435    1   DCL 1 KA$OTPMRK ALIGNED BASED(Y@MRK$),
     1412      436        %KV$OTPMRK(NAME = DAT, LVL = 2, LAST = ",");
     1413      463    1          2 BYTCNT SBIN WORD ALIGNED;
     1414      464
     1415      465    1   DCL Y@BYTCNT SBIN;
     1416      466    1   DCL Y@MRK$ PTR;
     1417      467    1   DCL Y_POWER_OF_2(0:15) SBIN WORD CONSTANT INIT(1, 2, 4, 8, 16, 32, 64, 128, 256,
     1418      468    1    512, 1024, 2048, 4096, 8192, 16384, 32764);
     1419      469    1   DCL I UBIN;
     1420      470
     1421      471    1   DCL KVV$VDI ENTRY(1) ALTRET;
     1422      472
     1423      473
     1424      474        /* nothing to do if there are no markers in the buffer. */
     1425      475
     1426      476    1      IF KA$OTPBFR.NMBMRK = 0 THEN RETURN;

    476   1 000005  ECC7 0004                            LDB,B6   @KA$OTPBFR,AUTO
          1 000007  82C6 0003                            LB,'FC00'X        3,B6
          1 000009       FC00
          1 00000A  0501 0004                            BBT      s:480,PREL

    476   1 00000C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1427      477
     1428      478        /* loop to go thru all the markers */
     1429      479
     1430      480    1      Y@BYTCNT = KA$OTPBFR.BYTCNT;

    480   1 00000F  E846 0002                            LDR,R6   2,B6
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:243  
          1 000011  E570 03FF                            AND,R6   1023,IMO
          1 000013  EF47 000B                            STR,R6   Y@BYTCNT,AUTO

     1431      481    1      KV@VDH_OTPMRK = KV_VDH_OTPMRK;

    481   1 000015  AB80 0000 0000  00                   LAB,B2   KV_VDH_OTPMRK
          1 000018  2C00                                 LDV,R2   0
          1 000019  6C0A                                 LDV,R6   10
          1 00001A  BB87                                 LAB,B3   ,AUTO
          1 00001B  3C0C                                 LDV,R3   12
          1 00001C  0008                                 MMM

     1432      482    1      Y@MRK$ = PINCRW(ADDR(KA$OTPBFR), Y_POWER_OF_2(KA$OTPBFR.BYTSIZLOG2)/2);

    482   1 00001D  B846 0002                            LDR,R3   2,B6
          1 00001F  304A                                 SOR,R3   10
          1 000020  B570 000F                            AND,R3   15,IMO
          1 000022  E830 0000 0005  00                   LDR,R6   Y_POWER_OF_2,R3
          1 000025  E370 0002                            DIV,R6   2,IMO
          1 000027  A856                                 LDR,R2   R6
          1 000028  DBA6                                 LAB,B5   ,B6,R2
          1 000029  DFC7 000C                            STB,B5   Y@MRK$,AUTO

     1433      483    2      DO I = 0 TO KA$OTPBFR.NMBMRK - 1;

    483   1 00002B  8747 000E                            CL       I,AUTO
          1 00002D  0F81 002A                            B        s:490+2,PREL

     1434      484    2         Y@MRK$ = PINCRW(Y@MRK$, -SIZEW(KA$OTPMRK));

    484   1 00002F  ECC7 000C                            LDB,B6   Y@MRK$,AUTO
          1 000031  DBC6 FFFC                            LAB,B5   -4,B6
          1 000033  DFC7 000C                            STB,B5   Y@MRK$,AUTO

     1435      485    2         KV@VDH_OTPMRK.DAT = KA$OTPMRK.DAT;

    485   1 000035  AB85                                 LAB,B2   ,B5
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:244  
          1 000036  2C00                                 LDV,R2   0
          1 000037  6C06                                 LDV,R6   6
          1 000038  BB87                                 LAB,B3   ,AUTO
          1 000039  3C0E                                 LDV,R3   14
          1 00003A  0008                                 MMM

     1436      486    2         IF Y@BYTCNT >= KA$OTPMRK.BYTCNT THEN

    486   1 00003B  ECC7 000C                            LDB,B6   Y@MRK$,AUTO
          1 00003D  E847 000B                            LDR,R6   Y@BYTCNT,AUTO
          1 00003F  E946 0003                            CMR,R6   3,B6
          1 000041  0801 0005                            BAL      s:488,PREL

     1437      487    2         KV@VDH_OTPMRK.CMPCOD = %KV_CMPCOD_NRM;

    487   1 000043  8747 000A                            CL       KV@VDH_OTPMRK+4,AUTO
          1 000045  0F81 0004                            B        s:489,PREL

     1438      488    2         ELSE KV@VDH_OTPMRK.CMPCOD = %KV_CMPCOD_DLT;

    488   1 000047  5C0C                                 LDV,R5   12
          1 000048  DF47 000A                            STR,R5   KV@VDH_OTPMRK+4,AUTO

     1439      489    2         CALL KVV$VDI(KV@VDH_OTPMRK);

    489   1 00004A  CBC7 0006                            LAB,B4   KV@VDH_OTPMRK,AUTO
          1 00004C  CFC7 0010                            STB,B4   I+2,AUTO
          1 00004E  BBC7 0010                            LAB,B3   I+2,AUTO
          1 000050  CBF0 0100                            LAB,B4   256,IMO
          1 000052  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000055       0001                            DC       s:490,PREL

     1440      490    2      END; /* DO I = .... */

    490   1 000056  8AC7 000E                            INC      I,AUTO
          1 000058  ECC7 0004                            LDB,B6   @KA$OTPBFR,AUTO
          1 00005A  E846 0003                            LDR,R6   3,B6
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:245  
          1 00005C  604A                                 SOR,R6   10
          1 00005D  E947 000E                            CMR,R6   I,AUTO
          1 00005F  0350                                 BG       s:484,SPREL

     1441      491    1      RETURN;

    491   1 000060  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1442      492    1   END KAO$MRK;

PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:246  
--  Include file information  --

   KA$GLB.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is never referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KAO$MRK.
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:247  

 **** Variables and constants ****

  ****  Section 000 RoData KAO$MRK

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(80)    r     1 KV_VDH_OTPMRK
     5-0-0/w SBIN(16)    r     1 Y_POWER_OF_2(0:15)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KA$OTPBFR                 E-0-0/w UBIN(16)    r     1 I
    *0-0-0/w STRC(64)    r     1 KA$OTPBFR                  6-0-0/w STRC(80)    r     1 KV@VDH_OTPMRK
     B-0-0/w SBIN(16)    r     1 Y@BYTCNT                   C-0-0/w PTR         r     1 Y@MRK$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(64)    r     1 KA$OTPMRK


   Procedure KAO$MRK requires 99 words for executable code.
   Procedure KAO$MRK requires 18 words of local(AUTO) storage.

    No errors detected in file KAO$OTP.:E05TSI    .
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:248  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:249  
          MINI XREF LISTING

I
       469**DCL       483<<DOINDEX
KA$OTPBFR
       425**DCL        33--PROC      482--ASSIGN
KA$OTPBFR.BYTCNT
       431**DCL       480>>ASSIGN
KA$OTPBFR.BYTSIZLOG2
       430**DCL       482>>ASSIGN
KA$OTPBFR.HLTOTP
       429**DCL       430--REDEF
KA$OTPBFR.NMBMRK
       431**DCL       476>>IF        483>>DOINDEX
KA$OTPMRK
       435**DCL       484--ASSIGN
KA$OTPMRK.BYTCNT
       463**DCL       486>>IF
KA$OTPMRK.DAT
       457**DCL       485>>ASSIGN
KA$OTPMRK.DAT.ID
       460**DCL       460--REDEF     461--REDEF
KV@VDH_OTPMRK
       142**DCL       481<<ASSIGN    489<>CALL
KV@VDH_OTPMRK.CMPCOD
       175**DCL       487<<ASSIGN    488<<ASSIGN
KV@VDH_OTPMRK.DAT
       169**DCL       485<<ASSIGN
KV@VDH_OTPMRK.DAT.ID
       172**DCL       172--REDEF     173--REDEF
KVV$VDI
       471**DCL-ENT   489--CALL
KV_VDH_OTPMRK
        80**DCL       481>>ASSIGN
PL6.E3A0      #011=KAO$MRK File=KAO$OTP.:E05TSI                                  WED 07/30/97 00:04 Page:250  
KV_VDH_OTPMRK.DAT.ID
       110**DCL       110--REDEF     111--REDEF
Y@BYTCNT
       465**DCL       480<<ASSIGN    486>>IF
Y@MRK$
       466**DCL       435--IMP-PTR   482<<ASSIGN    484<<ASSIGN    484>>ASSIGN    485>>ASSIGN    486>>IF
Y_POWER_OF_2
       467**DCL       482>>ASSIGN
