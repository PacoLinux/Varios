VERSION E05

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:1    
        1        1        /*M*  JSP$PMME    Job Step PMME Service Decoder    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8
        9        9        JSP$PMME: PROC(CODE);
       10       10        %INCLUDE B$JIT;
       11      613        %INCLUDE B$P;
       12      697        %INCLUDE B$ROSEG;
       13      760        %INCLUDE B$SS;
       14      939        %INCLUDE B$USER;
       15     1155        %INCLUDE B_MAGIC_C;
       16     1273        %INCLUDE B_MLSMAC_C;
       17     2215        %INCLUDE B_ULSMAC_C;
       18     3324        %INCLUDE CP_6_SUBS;
       19     3864        %INCLUDE F$DCB;
       20     3913        %INCLUDE HF_LOCK_C;
       21     3927        %INCLUDE IR_DATA_M;
       22     4091        %INCLUDE JS$CP6V_C;
       23     4154        %INCLUDE JS_CP6;
       24     4572        %INCLUDE JS_CNTRL_R;
       25     4606        %INCLUDE J_ERRORS_C;
       26     4693        %INCLUDE J_ERRSET_C;
       27     4713        %INCLUDE MM_DATA_R;
       28     5233        %INCLUDE NK$LDCT;
       29     5335        %INCLUDE NK_LDCT_R;
       30     5344        %INCLUDE SS_SCHED_C;
       31     5577        %INCLUDE UD_ERRORS_C;
       32     5619        %INCLUDE UD_SEV_C;
       33     5633        %INCLUDE UD_EQU_E;
       34     6022        %INCLUDE UE_CP6;
       35     6713        %INCLUDE UM_CP6;
       36     7565                                                /*PARAMETERS*/
       37     7566    1   DCL CODE UBIN(36);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:2    
       38     7567                                                /*LOCAL AUTO*/
       39     7568    1   DCL DATA1 SBIN;
       40     7569    1   DCL P5$ PTR;
       41     7570    1   DCL I SBIN;
       42     7571    1   DCL J SBIN;
       43     7572    1   DCL T1$ PTR;
       44     7573    1   DCL T2$ PTR;
       45     7574    1   DCL PSIZE SBIN;
       46     7575    1   DCL PNUM SBIN;
       47     7576    1   DCL PTYPE BIT(18);
       48     7577    1   DCL SGFLAG BIT(9);
       49     7578    1   DCL CPEXIT_RUND UBIN WORD;
       50     7579    1   DCL 1 MSCODE DALIGNED,
       51     7580    1         2 FCG BIT(12) UNAL,
       52     7581    1         2 MID BIT(6) UNAL,
       53     7582    1         2 MON BIT(1) UNAL,
       54     7583    1         2 CODE UBIN(14) UNAL,
       55     7584    1         2 SEV UBIN(3) UNAL,
       56     7585    1         2 * BIT(20) UNAL,
       57     7586    1         2 CUSR BIT(1) UNAL,
       58     7587    1         2 * BIT(14) UNAL,
       59     7588    1         2 AUSER BIT(1) UNAL;
       60     7589    1   DCL 1 SCRUSR# UBIN(9);
       61     7590
       62     7591        %B$SVLDT (FPTN=SAVEP, STCLASS= ,FULL=NO);
       63     7632
       64     7633    1   DCL CMD_TYPE UBIN;
       65     7634    1   DCL CMD_SZ UBIN;
       66     7635
       67     7636    1   DCL 1 DEBUG_NAME,
       68     7637    1         2 CNT UBIN(9) UNAL,
       69     7638    1         2 TXT CHAR(31) UNAL;
       70     7639
       71     7640    1   DCL SSIC UBIN(36);
       72     7641    1   DCL TASP UBIN(9);
       73     7642    1   DCL WSR SBIN;
       74     7643    1   DCL ENTRY_ADDR UBIN;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:3    
       75     7644                                                /*EXTERNAL PROCEDURES                 */
       76     7645    1   DCL JSE$ABORTM ENTRY;
       77     7646    1   DCL JSE$ABORTX ENTRY;
       78     7647    1   DCL JST$GETPROG ENTRY(5);
       79     7648    1   DCL JSA$RUNDSPC ENTRY(2);
       80     7649    1   DCL JSA$UNSHARE ENTRY(2) ALTRET;
       81     7650    1   DCL JSS$BACKSS ENTRY;
       82     7651    1   DCL JSS$RUNDSPC ENTRY;
       83     7652    1   DCL JSU$RSTLMS ENTRY;
       84     7653    1   DCL JSA$QUIT ENTRY;
       85     7654    1   DCL JSA$CPQUIT ENTRY;
       86     7655    1   DCL JSE$ACP ENTRY;
       87     7656    1   DCL JQU$VALID ENTRY(1) ALTRET;
       88     7657    1   DCL JQS$SAVE ENTRY(4) ALTRET;
       89     7658    1   DCL JQS$GET ENTRY(4) ALTRET;
       90     7659    1   DCL JSX$XCONSAVE ENTRY(1);
       91     7660    1   DCL JSX$SVLDTXCON ENTRY(1);
       92     7661    1   DCL JSR$RUNDOWN ENTRY ALTRET;
       93     7662    1   DCL JSD$DELUSR ENTRY;
       94     7663    1   DCL JSF$CLSDCBS ENTRY;
       95     7664    1   DCL JSU$RELFSEG ENTRY;
       96     7665    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
       97     7666    1   DCL HFF$PTPRES ENTRY(1) ALTRET;
       98     7667    1   DCL HFF$WRITE ENTRY(1) ALTRET;
       99     7668    1   DCL JLL$LINK  ENTRY(6) ALTRET;
      100     7669    1   DCL JLL$LDTRC ENTRY(5) ALTRET;
      101     7670    1   DCL JLL$RTN ENTRY ALTRET;
      102     7671    1   DCL JLL$LOCATE ENTRY ALTRET;
      103     7672    1   DCL JDP$SEGLD ENTRY(2) ALTRET;
      104     7673    1   DCL JDS$OVRLY ENTRY(3) ALTRET;
      105     7674    1   DCL KQX$LDASR ENTRY(1);
      106     7675    1   DCL UDB$AUTO ENTRY;
      107     7676    1   DCL UDB$PMMEXIT2 ENTRY;
      108     7677    1   DCL UDB$CALCOMP ENTRY;
      109     7678    1   DCL UDN$MAGIC ENTRY;
      110     7679    1   DCL UDN$MAGICLS ENTRY;
      111     7680    1   DCL UDN$MAGICSS ENTRY;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:4    
      112     7681    1   DCL JSA$CLIB ENTRY(1) ALTRET;
      113     7682    1   DCL JSA$ASL ENTRY(1) ALTRET;
      114     7683    1   DCL JSA$ALIBDB ENTRY(1) ALTRET;
      115     7684    1   DCL JSA$DBCHK ENTRY(1) ALTRET;
      116     7685    1   DCL JSA$FINDSSP ENTRY(5) ALTRET;
      117     7686    1   DCL JSA$FINDAUTO ENTRY(5) ALTRET;
      118     7687    1   DCL SSR$REG ENTRY(3) ALTRET;
      119     7688    1   DCL SSR$RUE ENTRY(4);
      120     7689    1   DCL SST$SSFTCB ENTRY(6) ALTRET;
      121     7690    1   DCL SSV$EVENT ENTRY(7);
      122     7691    1   DCL UEP$CLEARONE ENTRY(3) ALTRET;
      123     7692    1   DCL UEP$MOVETCB ENTRY(3) ALTRET;
      124     7693    1   DCL SSU$DELTAGO ENTRY(3);
      125     7694    1   DCL JSX$RUNXCON ENTRY(1);
      126     7695    1   DCL JSX$UNXCON ENTRY;
      127     7696    1   DCL IRM$USER$SCREECH ENTRY;
      128     7697    1   DCL SC_CPEXIT ENTRY CONV(2,0);
      129     7698    1   DCL SC_JSPDTCB ENTRY CONV(2,0);
      130     7699
      131     7700        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:5    
      132     7701        %FPT_CPEXIT (FPTN=JS_FLAGS,
      133     7702                     STCLASS=CONSTANT,
      134     7703                     CONT=YES,
      135     7704                     QUIT=YES,
      136     7705                     ALTRTN=YES,
      137     7706                     SAVEFLG=YES,
      138     7707                     LINK=YES,
      139     7708                     VECTORS=NO);
      140     7734
      141     7735        %B$WSR_DESC (FPTN=NIL_DESC,STCLASS=CONSTANT);
      142     7757    1   DCL JS_CHECKCP SBIN CONSTANT SYMDEF INIT(1);
      143     7758                                                /* EXTERNAL DATA                      */
      144     7759        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
      145     7852    1   DCL B$PS0$ PTR SYMREF READONLY;
      146     7853    1   DCL B$PS1$ PTR SYMREF READONLY;
      147     7854    1   DCL B$PS2$ PTR SYMREF READONLY;
      148     7855    1   DCL B$PS3$ PTR SYMREF READONLY;
      149     7856    1   DCL B$PS4$ PTR SYMREF READONLY;
      150     7857    1   DCL B$PS5$ PTR SYMREF READONLY;
      151     7858    1   DCL B$PS6$ PTR SYMREF READONLY;
      152     7859    1   DCL B$JIT$ PTR SYMREF READONLY;
      153     7860    1   DCL B$UPT$ PTR SYMREF READONLY;
      154     7861    1   DCL B$DBLS$ PTR SYMREF READONLY;
      155     7862    1   DCL B$USERLS$ PTR SYMREF READONLY;
      156     7863    1   DCL B$LS$ PTR SYMREF READONLY;
      157     7864    1   DCL B$MISC2$ PTR SYMREF READONLY;
      158     7865    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      159     7866
      160     7867    1   DCL B$USRT$ PTR SYMREF;
      161     7868    1   DCL S$CU$ PTR SYMREF;
      162     7869
      163     7870
      164     7871    1   DCL 1 J_LOGON SYMREF READONLY,
      165     7872    1         2 CNT UBIN(9) UNAL,
      166     7873    1         2 NAME CHAR(7) UNAL;
      167     7874    1   DCL J_PLOCK SYMREF BIT(72) DALIGNED;
      168     7875    1   DCL J_SYSTXT CHAR(8) SYMREF READONLY;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:6    
      169     7876    1   DCL J_SYS$ PTR SYMREF READONLY;
      170     7877    1   DCL 1 SC_USER SYMREF,
      171     7878    1         2 RC BIT(72) UNAL,
      172     7879    1         2 USER# UBIN(9) UNAL;
      173     7880    1   DCL IRM_NODUMP BIT(36) SYMREF;
      174     7881    1   DCL IRM_ASCOUNT SBIN SYMREF;
      175     7882        %VLR_SITEINFO (FPTN=B_SITEINFO,STCLASS=SYMREF);
      176     7901    1   DCL B_MUAIS UBIN(36) SYMREF;
      177     7902    1   DCL S_CUN SBIN SYMREF;
      178     7903    1   DCL S_MING SBIN SYMREF;
      179     7904    1   DCL S_ASFGATE BIT(72) SYMREF;
      180     7905                                                /* BASED STRUCTURES                   */
      181     7906        %RV_DFNAME (STCLASS=BASED);
      182     7910    1   DCL B$DWTXT CHAR(8) BASED ALIGNED;
      183     7911    1   DCL B$TXT6 CHAR(6) BASED ALIGNED;
      184     7912
      185     7913    1   DCL B$PTR PTR BASED;
      186     7914    1   DCL PTR$(0:1023) PTR BASED ALIGNED;
      187     7915    1   DCL 1 B$PAGE BASED ALIGNED,
      188     7916    1         2 WRD(0:1023) BIT(36) ALIGNED;
      189     7917
      190     7918                                                /*                                    */
      191     7919        %B$WSR_DESC(FPTN=B$$DESCR);
      192     7941
      193     7942    1   DCL 1 B$PSEG BASED DALIGNED,
      194     7943              %B$WSR_DESC(FPTN=P0,LVL=2,STCLASS=BASED,LAST=NO);
      195     7965              %B$WSR_DESC(FPTN=P1,LVL=2,STCLASS=BASED,LAST=NO);
      196     7987              %B$WSR_DESC(FPTN=P2,LVL=2,STCLASS=BASED,LAST=NO);
      197     8009              %B$WSR_DESC(FPTN=P3,LVL=2,STCLASS=BASED,LAST=NO);
      198     8031              %B$WSR_DESC(FPTN=P4,LVL=2,STCLASS=BASED,LAST=NO);
      199     8053              %B$WSR_DESC(FPTN=P5,LVL=2,STCLASS=BASED,LAST=YES);
      200     8075                                                /*                                    */
      201     8076    1   DCL 1 TEXTC BASED,
      202     8077    1         2 SIZ UBIN(9) UNAL,
      203     8078    1         2 TEXT CHAR(TEXTC.SIZ);
      204     8079    1   DCL 1 FNTEXTC BASED,
      205     8080    1         2 SIZ UBIN(9) UNAL,
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:7    
      206     8081    1         2 TEXT CHAR(31) UNAL;
      207     8082
      208     8083    1   DCL 1 B$STARF BASED,
      209     8084    1         2 SIZ UBIN(9) UNAL,
      210     8085    1         2 STAR CHAR(1) UNAL;
      211     8086
      212     8087        %B_MLS (FPTN=B$MLS,STCLASS=BASED);
      213     8902        %B_USRULS (FPTN=B$ULNK,STCLASS=BASED);
      214     9101        %NK$LDCT;
      215     9147        %B$ECCB;
      216     9155        %B$XCON;
      217     9165        %B$ALIB;
      218     9169
      219     9170        %FPT$ALIB_V;
      220     9173        %FPT$SCON_V;
      221     9176        %FPT$OLAY_V;
      222     9179        %FPT$XCONRTN_V;
      223     9182        %FPT$UNSHARE_V;
      224     9185        %FPT$LINK_V;
      225     9188
      226     9189        %FPT_CPEXIT (FPTN=CPEXIT$V,
      227     9190                       VECTORS=NO,
      228     9191                       STCLASS=BASED);
      229     9217        %FPT_CPEXIT (FPTN=CPEXIT_V,
      230     9218                       VECTORS=NO,
      231     9219                       STCLASS=AUTO);
      232     9245    1   DCL 1 CPFPT BASED DALIGNED,
      233     9246    1         2 FLAGS BIT(18) UNAL,
      234     9247    1         2 * BIT(18) UNAL;
      235     9248
      236     9249    1   DCL B$PTYPE BIT(18) BASED DALIGNED;
      237     9250    1   DCL 1 B$PTYPE_MLINK BASED ALIGNED, 2 PTYPE BIT(18), 2 MLINK BIT(1);
      238     9251    1   DCL B$PNUM UBIN(9) BASED DALIGNED;
      239     9252
      240     9253        %SUB_EXC;
      241     9300        %SUB_ECCDELTA;
      242     9337
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:8    
      243     9338    1   DCL 1 MPARAM BASED DALIGNED,
      244     9339    1         2 ERR BIT(36) UNAL,
      245     9340    1         2 * BIT(36) UNAL;
      246     9341
      247     9342    1   DCL 1 B$SNAPUSR BASED DALIGNED,
      248     9343    1         2 * BIT(72) UNAL,
      249     9344    1         2 U# UBIN(9) UNAL;
      250     9345                                                /* STRING SUBSTITUTIONS               */
      251     9346        %SUB B$JIT = B$JIT$->B$JIT;
      252     9347        %SUB B$SS=B_MPT.SS$->B$SS;
      253     9348        %SUB B$PSEG=B_MPT.PS$->B$PSEG;
      254     9349        %SUB B$ULS=B$ULNK;
      255     9350
      256     9351        %SUB P0$=SAVEP.P0$;
      257     9352        %SUB P1$=SAVEP.P1$;
      258     9353        %SUB P2$=SAVEP.P2$;
      259     9354        %SUB P3$=SAVEP.P3$;
      260     9355        %SUB P4$=SAVEP.P4$;
      261     9356
      262     9357        %EQU CMD_TEXT = 0;
      263     9358        %EQU CMD_TEXTC = 1;
      264     9359
      265     9360        /* TO SET JIT.ERR */
      266     9361        %SUB FCG#='1223'O;
      267     9362        %SUB MID#='20'O;
      268     9363        %ERRCODE (NAME=EFPT,COD#=%E$BADVECT0);
      269     9371        %ERRCODE (NAME=EBADVECT1,COD#=%E$BADVECT1);
      270     9379        %ERRCODE (NAME=EBADVECT2,COD#=%E$BADVECT2);
      271     9387        %ERRCODE (NAME=EBADVECT3,COD#=%E$BADVECT3);
      272     9395        %ERRCODE (NAME=EWRONGTYPE,COD#=%E$WRONGTYPE);
      273     9403        %ERRCODE (NAME=ENOPROC,COD#=%E$NOPROC);
      274     9411        %ERRCODE (NAME=EFPT5,COD#=%E$BADVECT5);
      275     9419        %ERRCODE (NAME=EDOMAIN,COD#=%E$DOMAIN);
      276     9427        %ERRCODE (NAME=ENOLIB,COD#=%E$NOLIB);
      277     9435        %ERRCODE (NAME=EDLIB,COD#=%E$DLIB,SEV#=SEV_CONT#);
      278     9443        %ERRCODE (NAME=ELIBUNSH,COD#=%E$LIBUNSH,SEV#=SEV_ERROR#);
      279     9451        %ERRCODE (NAME=EDLIBREQ,COD#=%E$DLIBREQ);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:9    
      280     9459        %ERRCODE (NAME=ENOTASSOC,COD#=%E$NOTASSOC);
      281     9467        %ERRCODE (NAME=EJOBSTEP,COD#=%E$JOBSTEP);
      282     9475        %ERRCODE (NAME=ECPALT,COD#=%E$CPALT);
      283     9483        %ERRCODE (NAME=ENJOBSTEP,COD#=%E$NJOBSTEP);
      284     9491        %ERRCODE (NAME=ELOGOFF,COD#=%E$LOGOFF);
      285     9499        %ERRCODE (NAME=ECYALT,COD#=%E$CYALT);
      286     9507        %ERRCODE (NAME=ENOSTEPS,COD#=%E$NOSTEPS);
      287     9515        %ERRCODE (NAME=EDEBUGSP,COD#=%E$DEBUGSP);
      288     9523        %ERRCODE (NAME=EOPTPMME,COD#=%E$OPTPMME);
      289     9531        %ERRCODE (NAME=ESAVE,COD#=%E$SAVELINK);
      290     9539        %ERRCODE (NAME=ELINK,COD#=%E$XCONLINK);
      291     9547        %ERRCODE (NAME=ESSAVE,COD#=%E$SSAVE);
      292     9555        %ERRCODE (NAME=ESNAPU,COD#=%E$SNAPUSR);
      293     9563        %ERRCODE (NAME=EDFBUSY,COD#=%E$DFBUSY,SEV#=SEV_CONT#);
      294     9571        %ERRCODE (NAME=EBADSSP,COD#=%E$BADSSP);
      295     9579        %ERRCODE (NAME=EXCONRTNE,COD#=%E$XCONRTN);
      296     9587        %ERRCODE (NAME=EXCONRTNA,COD#=%E$XCONRTN,SEV#=SEV_ABORT#);
      297     9595        %ERRCODE (NAME=EOFF,COD#=%E$OFF,SEV#=SEV_ABORT#);
      298     9603        %ERRCODE (NAME=ENOOVRLY,COD#=%E$NOOVRLY,SEV#=SEV_CONT#);
      299     9611        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:10   
      300     9612        /*************************************************************
      301     9613         *                                                           *
      302     9614         *                        M$OLAY                             *
      303     9615         *                                                           *
      304     9616         *************************************************************/
      305     9617
      306     9618    1      WSR=B$SS.ISR.WSR;
      307     9619
      308     9620    1      CALL UDN$MAGIC;
      309     9621    2      DO CASE(CODE);
      310     9622
      311     9623    2       CASE(%C$OLAY#);
      312     9624    2         IF (S$CU$ -> B$U.CMF > 0) AND (NOT B$JIT.PRIV.ACTIVE & %PR_EXMM#) THEN GOTO
              9624                  NOTOVLAID;
      313     9625        /* Wait for master function count to go to zero before proceeding  */
      314     9626    3         DO WHILE (S$CU$->B$U.MF > S$CU$->B$U.CMF);
      315     9627    3              CALL SSR$REG(%SS_QMF);
      316     9628    3              END;
      317     9629
      318     9630        /* Check to make sure its really overlaid   */
      319     9631    2         IF B$ROSEG$->B$ROSEG.TREE$ = ADDR(NIL)
      320     9632    3         THEN DO;
      321     9633    3   NOTOVLAID:
      322     9634    3              B$JIT.ERR=ENOOVRLY;
      323     9635    3              RETURN;
      324     9636    3              END;
      325     9637        /*E*   ERROR: JSP-E$NOOVRLY-0
      326     9638               MESSAGE:  M$OLAY allowed only in overlaid run-units with no IO.
      327     9639        */
      328     9640
      329     9641        /* Go associate the shared overlay or read it in if unshared */
      330     9642    2         IF S$CU$->B$U.APR ~= 0
      331     9643    2         THEN CALL JDP$SEGLD(SAVEP.ECCS,ENTRY_ADDR) ALTRET(JIT_SET);
      332     9644    2         ELSE CALL JDS$OVRLY(SAVEP.ECCS,ENTRY_ADDR,B$PS1$->FPT$OLAY_V) ALTRET(JIT_SET);
      333     9645        /* Either routine will return with SAVEP.ECCS containing the NODE
      334     9646           number and ENTRY_ADDR set to B$NODE.ENTRY$.
      335     9647        */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:11   
      336     9648
      337     9649    2         IF B$JIT.ERR.CODE = 0
      338     9650    3         THEN DO;
      339     9651        /* Do the mucking with B$SS.IC here for in the event that we must
      340     9652           modify it because of the M$OLAY ENTER option, and/or because
      341     9653           we are running under DELTA.
      342     9654        */
      343     9655    3              CALL UDB$CALCOMP;
      344     9656
      345     9657    3              IF B$PS1$->FPT$OLAY_V.FLGS.ENTER='1'B
      346     9658    4              THEN DO;
      347     9659    4                   B$SS.X1 = B$SS.IC;
      348     9660    4                   B$SS.IC = ENTRY_ADDR;
      349     9661    4                   END;
      350     9662    4              ELSE DO;
      351     9663    4                   IF B$SS.FPT.ALT ~='0'B
      352     9664    4                   THEN B$SS.IC = B$SS.IC+1;
      353     9665    4                   END;
      354     9666
      355     9667    3              IF (B_MPT.ECCBDESC$->B$$DESCR.FLGS & %DSXXX)
      356     9668    4              THEN DO;
      357     9669    4                   DATA1=%ECC_OLAY#;
      358     9670    4                   SAVEP.EVID=BITBIN(B$PS1$->FPT$OLAY_V.FLGS);
      359     9671    4                   SAVEP.JERR=B$JIT.ERR;
      360     9672    4                   SAVEP.P#=0;
      361     9673    4                   CALL SSU$DELTAGO (DATA1,SAVEP);
      362     9674    4                   END;
      363     9675    3              ELSE CALL UDB$AUTO;
      364     9676    3              END;                         /*DO IF ERR.CODE = 0                  */
      365     9677        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:12   
      366     9678        /*************************************************************
      367     9679         *                                                           *
      368     9680         *                        M$SCON                             *
      369     9681         *                                                           *
      370     9682         *************************************************************/
      371     9683
      372     9684    2       CASE(%C$SCON#);
      373     9685    2         IF NOT (B$PS0$->FPT$SCON_V.SAVEFLG)
      374     9686    3         THEN DO;
      375     9687    3              IF B$SS.ISR.WSR ~= %CPWSR
      376     9688    3              THEN B$JIT.JUNK = (B$JIT.JUNK | %JJ_NOSAVE#);
      377     9689    3              ELSE B$JIT.JUNK2 = (B$JIT.JUNK2 | %JJ2_NOSAVE_CP#);
      378     9690    3              END;
      379     9691    2         ELSE IF B$SS.ISR.WSR = %CPWSR
      380     9692    2              THEN B$JIT.JUNK2 = (B$JIT.JUNK2 &~ %JJ2_NOSAVE_CP#);
      381     9693
      382     9694    2         IF (B$PS0$->FPT$SCON_V.XCON)
      383     9695    2         THEN B$JIT.JUNK = (B$JIT.JUNK | %JJ_SCON#);
      384     9696
      385     9697
      386     9698        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:13   
      387     9699        /*************************************************************
      388     9700         *                                                           *
      389     9701         *                        M$SAVE                             *
      390     9702         *                                                           *
      391     9703         *************************************************************/
      392     9704
      393     9705    2       CASE(%C$SAVE#);
      394     9706    2         J=4;
      395     9707    2         CALL CHECK_PSTACK ALTRET(FPT_BAD);
      396     9708    2         IF P0$=ADDR(NIL)
      397     9709    3         THEN DO;
      398     9710    3              B$JIT.ERR=EFPT;
      399     9711    3              RETURN;
      400     9712    3              END;
      401     9713    2         SGFLAG=%SVL_MSAVE#;
      402     9714    2         CALL DO_SAVE(SGFLAG) ALTRET(SAVE_ALTRET);
      403     9715    2   SAVE_ALTRET: ;
      404     9716    2         RETURN;
      405     9717
      406     9718        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:14   
      407     9719        /*************************************************************
      408     9720         *                                                           *
      409     9721         *                        M$LINK                             *
      410     9722         *                        M$LDTRC                            *
      411     9723         *                                                           *
      412     9724         *************************************************************/
      413     9725
      414     9726    2       CASE(%C$LINK#, %C$LDTRC#);
      415     9727    2         IF (B_MPT.ECCB$->B$ECCB.XCONF & '006'O)
      416     9728    3         THEN DO;
      417     9729    3              B$JIT.ERR=ESAVE;
      418     9730    3              RETURN;
      419     9731    3              END;
      420     9732        /*E*   ERROR: JSP-E$SAVELINK-E
      421     9733               MESSAGE: M$LINK or M$LDTRC not allowed during SAVE-GET.
      422     9734        */
      423     9735    2         IF (B_MPT.ECCB$->B$ECCB.XCONF & '140'O)
      424     9736    3         THEN DO;
      425     9737    3              B$JIT.ERR=ELINK;
      426     9738    3              RETURN;
      427     9739    3              END;
      428     9740        /*E*   ERROR:   JSP-E$XCONLINK-E
      429     9741               MESSAGE:  M$LINK-M$LDTRC not allowed when XCON Class 2 or 3 in progress.
      430     9742        */
      431     9743
      432     9744        /*  If there are 7 parameters on the Parameter Stack, the user has
      433     9745            passed a C00 FPT.  The V area parameter will indicate if the
      434     9746            command passed (if any) is is TEXT or TEXTC format.
      435     9747        */
      436     9748    2         SAVEP.CMD_DSCR = NIL_DESC;
      437     9749
      438     9750    2         J = 7 /*check P0 - P6 */;
      439     9751    2         CALL CHECK_PSTACK
      440     9752    3         WHENRETURN DO;
      441     9753    3              IF B$PS6$->FPT$LINK_V.TEXTC = '1'B
      442     9754    3              THEN CMD_TYPE = %CMD_TEXTC;
      443     9755    3              ELSE CMD_TYPE = %CMD_TEXT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:15   
      444     9756
      445     9757        /*  If the CP_CMD is specified, its descritor is moved to the
      446     9758            parameters in AUTO and all other parameters are marked NIL.
      447     9759            The ECHO parameter specification is moved to CPFLAGS1.
      448     9760        */
      449     9761    3              CALL HFF$NILERASE(5) ALTRET(NOT_CP_CMD);
      450     9762    3              P0$=ADDR(NIL); P1$=ADDR(NIL); P2$=ADDR(NIL); P3$=ADDR(NIL);
      451     9763    3              P4$ = B$PS5$;
      452     9764    3              SAVEP.CMD_DSCR = B$PSEG.P5;
      453     9765    3              IF B$PS6$->FPT$LINK_V.ECHO = '1'B
      454     9766    3              THEN B$JIT.CPFLAGS1.ECHO_LINK = '1'B;
      455     9767    3              ELSE B$JIT.CPFLAGS1.ECHO_LINK = '0'B;
      456     9768
      457     9769    3              END;
      458     9770
      459     9771        /*  If less then 7 parameters it must be a pre-C00 FPT.  The command
      460     9772            is therefore in TEXTC format and is not to be scanned by the
      461     9773            command processor.
      462     9774        */
      463     9775    3         WHENALTRETURN DO;
      464     9776    3              CMD_TYPE = %CMD_TEXTC;
      465     9777    3              J = 5 /* check P0 - P4*/;
      466     9778    3              CALL CHECK_PSTACK ALTRET(FPT_BAD);
      467     9779
      468     9780    3   NOT_CP_CMD: ;
      469     9781    3              IF P0$ = ADDR(NIL) THEN GOTO FPT_BAD;
      470     9782
      471     9783    3              IF P4$ ~= ADDR(NIL)
      472     9784    3              THEN SAVEP.CMD_DSCR = B$PSEG.P4;
      473     9785    3              END;
      474     9786
      475     9787        /*  If the user gave us a TEXTC descriptor, modify the descriptor
      476     9788            squirrled away in auto to make it a TEXT descriptor.
      477     9789        */
      478     9790    2         IF P4$ ~= ADDR(NIL)
      479     9791    3         THEN DO;
      480     9792    3              IF CMD_TYPE = %CMD_TEXTC
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:16   
      481     9793    4              THEN DO;
      482     9794    4                   CMD_SZ = P4$ ->TEXTC.SIZ;
      483     9795    4                   IF CMD_SZ > SAVEP.CMD_DSCR.BOUND
      484     9796    4                   THEN GOTO BAD_CMD;
      485     9797
      486     9798    4                   SAVEP.CMD_DSCR.BASE = SAVEP.CMD_DSCR.BASE+1;
      487     9799    4                   SAVEP.CMD_DSCR.BOUND = CMD_SZ -1;
      488     9800    4                   END;
      489     9801
      490     9802    4              ELSE DO;
      491     9803    4                   CMD_SZ = SAVEP.CMD_DSCR.BOUND +1;
      492     9804    4                   END;
      493     9805
      494     9806    3              IF CMD_SZ > SIZEC(B$JIT.CCBUF)
      495     9807    4              THEN DO;
      496     9808    4   BAD_CMD:        ;
      497     9809    4                   B$JIT.ERR = EFPT5;
      498     9810    4                   RETURN;
      499     9811    4                   END;
      500     9812
      501     9813    3              P4$ = ADDR(SAVEP.CMD_DSCR);
      502     9814    3              END /* do if P4$ not NIL */;
      503     9815
      504     9816        /*E* ERROR: JSP-E$BADVECT5-E
      505     9817             MESSAGE: The CMD parameter of M$LINK or M$LDTRC is bad.
      506     9818             MESSAGE1: Either the length byte of a TEXTC command is larger than
      507     9819                       the vector framing the command or the command itself is
      508     9820                       larger than B$JIT.CCBUF.
      509     9821             MESSAGE7: The CMD parameter of M$LINK or M$LDTRC is bad.
      510     9822        */
      511     9823
      512     9824        /*  Mark calcomp now as we are going off to the sunset, never to return.
      513     9825            This also marks B$SS. FPT.fpt_check so any traps now mean SUA.
      514     9826
      515     9827            If this is M$LINK, do it now - no entry to exit control or
      516     9828            entry to DELTA until we get to the called run unit.
      517     9829        */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:17   
      518     9830    2         CALL UDB$CALCOMP;
      519     9831    2         IF CODE=%C$LINK#
      520     9832    3         THEN DO;
      521     9833    3              CALL JLL$LINK(P0$,P1$,P2$,P3$,P4$) ALTRET(JIT_SET);
      522     9834    3              END;
      523     9835
      524     9836        /* If M$LDTRC, and the user is not associated with a debugger or ASL,
      525     9837           and the user does not have XCON, also do the LDTRC now.
      526     9838        */
      527     9839    3         ELSE DO;
      528     9840    3              B$SS.IC=B$SS.IC-2;
      529     9841    3              IF (B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET ='0'B)
      530     9842    3                AND (S$CU$->B$U.ASL=0)
      531     9843    3                AND (S$CU$->B$U.DB=0)
      532     9844    4              THEN DO;
      533     9845    4                   CALL JLL$LDTRC(P0$,P1$,P2$,P3$,P4$) ALTRET(JIT_SET);
      534     9846    4                   END;
      535     9847
      536     9848        /* Complete initialization of the TCB frame for SVLDT.
      537     9849        */
      538     9850    3              B$JIT.SVLDTF=%SVL_LDTRC#;
      539     9851    3              SAVEP.ECCS = 0;
      540     9852    3              SAVEP.P# = SIZEW(SAVEP) - POFFW(ADDR(P0$) , ADDR(SAVEP));
      541     9853
      542     9854        /* If the user has exit control or is running under DELTA,
      543     9855           build an XCON frame on the user's or DELTA TCB.
      544     9856        */
      545     9857    3              IF (B_MPT.ECCBDESC$->B$$DESCR.FLGS & %DSXXX)
      546     9858    3                OR (B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET='1'B)
      547     9859    4              THEN DO;
      548     9860    4                   CALL JSX$XCONSAVE(SAVEP);
      549     9861    4                   B$SS.IC=B$SS.IC+2;
      550     9862    4                   RETURN;                 /* Err has been set to E$NOROOM       */
      551     9863    4                   END;
      552     9864
      553     9865        /* If the user is associated with as ASL, build a SVLDT
      554     9866           frame on the user TCB.  The LDTRC will occur after the
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:18   
      555     9867           ASL has had a shot at exit control.
      556     9868        */
      557     9869    4              ELSE DO;
      558     9870    4                   CALL JSX$SVLDTXCON(SAVEP);
      559     9871    4                   END;
      560     9872    3              END;                         /*DO IF LDTRC                         */
      561     9873    2   JIT_SET: ;
      562     9874    2         B$JIT.SVLDTF='000'O;
      563     9875    2         RETURN;
      564     9876                                                /**/
      565     9877    2   FPT_BAD: ;
      566     9878    2         B$JIT.ERR=EFPT;
      567     9879    2         RETURN;
      568     9880        /*E*     ERROR: JSP-E$BADVECT0-E
      569     9881                 MESSAGE: FPT Vector 0 must not be null for that Service Request.
      570     9882                 MESSAGE1: One of the following Service Requests was issued with
      571     9883                              required Vector 0 set to the ADDR(NIL) :
      572     9884                                M$LINK - M$LDTRC - M$SAVE - M$YC
      573     9885        */
      574     9886        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:19   
      575     9887        /*************************************************************
      576     9888         *                                                           *
      577     9889         *                        M$PROCNAME                         *
      578     9890         *                                                           *
      579     9891         *************************************************************/
      580     9892
      581     9893    2       CASE(%C$PROCNAME#);
      582     9894    2         PNUM=S$CU$->B$U.APR;
      583     9895    2         CALL MVPROC (B$PS0$);
      584     9896    2         PNUM=S$CU$->B$U.ASP;
      585     9897    2         CALL MVPROC (B$PS1$);
      586     9898    2         PNUM=S$CU$->B$U.ASL;
      587     9899    2         CALL MVPROC (B$PS2$);
      588     9900    2         PNUM=S$CU$->B$U.DB;
      589     9901    2         CALL MVPROC (B$PS3$);
      590     9902    2         PNUM=S$CU$->B$U.ACP;
      591     9903    2         CALL MVPROC (B$PS4$);
      592     9904    2         RETURN;
      593     9905        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:20   
      594     9906        /*************************************************************
      595     9907         *                                                           *
      596     9908         *                        M$FINDPROC                         *
      597     9909         *                                                           *
      598     9910         *************************************************************/
      599     9911
      600     9912
      601     9913    2       CASE(%C$FINDPROC#);
      602     9914    2         PNUM = 0;
      603     9915    2         PTYPE = '0'B;
      604     9916
      605     9917    2         IF B$PS0$ -> B$PTYPE_MLINK.MLINK
      606     9918    3         THEN DO;
      607     9919    3              CALL JLL$LOCATE
      608     9920    4              WHENRETURN DO; RETURN; END;
      609     9921    4              WHENALTRETURN DO;
      610     9922    4                   B$JIT.ERR = ENOPROC;
      611     9923    4                   RETURN;
      612     9924    4                   END;
      613     9925    3              END;
      614     9926
      615     9927        /*    If there is not a valid name specified by the NAME parameter,
      616     9928              this is a request to return the name of the processor as
      617     9929              specified by the PNUM parameter.
      618     9930        */
      619     9931    2         IF B$PS1$->TEXTC.SIZ = 0
      620     9932    3         THEN DO;
      621     9933    3              CALL HFF$NILERASE(3)
      622     9934    4              WHENRETURN DO;
      623     9935    4                   PNUM = B$PS3$->B$PNUM;
      624     9936    4                   IF (PNUM > P_LAST_AUTO) OR (PNUM = 0) THEN GOTO BAD_PNUM;
      625     9937    4                   END;
      626     9938
      627     9939    4              WHENALTRETURN DO;
      628     9940    4   BAD_PNUM:       ;
      629     9941    4                   B$JIT.ERR = EBADVECT3;
      630     9942    4                   END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:21   
      631     9943    3              CALL MVPROC(B$PS1$);
      632     9944    3              CALL MVACCT(B$PS4$);
      633     9945    3              GOTO NO_PNUM;
      634     9946    3              END;
      635     9947
      636     9948        /*E* ERROR: JSP-E$BADVECT3-E
      637     9949             MESSAGE: The processor number specified on M$FINDPROC is bad.
      638     9950        */
      639     9951
      640     9952        /*    If the NAME parameter was specified, verify a valid length
      641     9953              was also specified.
      642     9954        */
      643     9955    3         ELSE DO;
      644     9956    3              IF B$PS1$->TEXTC.SIZ > 31
      645     9957    4              THEN DO;
      646     9958    4                   B$JIT.ERR = EBADVECT1;
      647     9959    4                   GOTO SET_PNUM;
      648     9960    4                   END;
      649     9961
      650     9962    3              T1$ = J_SYS$;
      651     9963    3              CALL HFF$NILERASE(4) ALTRET(NO_ACCT);
      652     9964    3              T1$ = B$PS4$;
      653     9965    3   NO_ACCT:   ;
      654     9966
      655     9967
      656     9968        /*    The JSA$FINDSSP routine is called to find the processor in the
      657     9969              processor tables and to return its type.
      658     9970        */
      659     9971    3              CALL JSA$FINDSSP (B$PS1$,T1$,PNUM,PTYPE,B$JIT.ERR)
      660     9972    4              WHENALTRETURN DO;
      661     9973    4                   B$JIT.ERR = '0'B;
      662     9974    4                   PTYPE = %P_SP#;
      663     9975    4                   CALL JSA$FINDAUTO(B$PS1$,T1$,PNUM)
      664     9976    5                   WHENALTRETURN DO;
      665     9977    5                        B$JIT.ERR = ENOPROC;
      666     9978    5                        PTYPE = '000000'O;
      667     9979    5                        END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:22   
      668     9980                        %UNLOCK (G=J_PLOCK);
      669     9983    4                   END;
      670     9984    3              END;
      671     9985
      672     9986        /*    Return the processor number if the PNUM parameter is not NIL
      673     9987              and is writeable.
      674     9988        */
      675     9989    2   SET_PNUM: ;
      676     9990    2         CALL HFF$WRITE(3) ALTRET(NO_PNUM);
      677     9991    2         B$PS3$->B$PNUM = PNUM;
      678     9992    2   NO_PNUM: ;
      679     9993
      680     9994        /*    Return the processor type if the RTYPE parameter is not NIL.
      681     9995        */
      682     9996    2         CALL HFF$NILERASE(2) ALTRET(NO_RTYPE);
      683     9997    2         B$PS2$->B$PTYPE = PTYPE;
      684     9998    2   NO_RTYPE: ;
      685     9999
      686    10000        /*    Validate the processor type if the user asked us to do so.
      687    10001        */
      688    10002    2         IF (B$JIT.ERR.CODE = 0) AND (B$PS0$->B$PTYPE)
      689    10003    3         THEN DO;
      690    10004    3              IF NOT(PTYPE & B$PS0$->B$PTYPE)
      691    10005    3              THEN B$JIT.ERR = EWRONGTYPE;
      692    10006    3              END;
      693    10007
      694    10008        /*E* ERROR: JSP-E$WRONGTYPE-E
      695    10009             MESSAGE: The processor is not of the type specified by M$FINDPROC PTYPE.
      696    10010        */
      697    10011
      698    10012    2         RETURN;
      699    10013
      700    10014        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:23   
      701    10015        /*************************************************************
      702    10016         *                                                           *
      703    10017         *                        M$UNSHARE                          *
      704    10018         *                                                           *
      705    10019         *************************************************************/
      706    10020
      707    10021
      708    10022    2       CASE(%C$UNSHARE#);
      709    10023
      710    10024    2         IF B$PS0$ -> FPT$UNSHARE_V.FLGS.PROG AND S$CU$->B$U.APR ~= 0
      711    10025    3         THEN DO;
      712    10026    3              PNUM=S$CU$->B$U.APR;
      713    10027    3              I = S$CU$->B$U.APO;
      714    10028    3              CALL JSA$UNSHARE(PNUM,I) ALTRET(BAD_SHARE);
      715    10029    3              S$CU$->B$U.APO = 0;
      716    10030    3              S$CU$->B$U.APR = 0;
      717    10031    3              END;
      718    10032
      719    10033    2         IF B$PS0$ -> FPT$UNSHARE_V.FLGS.LIB AND S$CU$->B$U.ASP ~= 0
      720    10034    3         THEN DO;
      721    10035    3              PNUM=S$CU$->B$U.ASP;
      722    10036    3              CALL JSA$UNSHARE(PNUM,0) ALTRET(BAD_SHARE);
      723    10037    3              S$CU$->B$U.ASP = 0;
      724    10038    3              END;
      725    10039
      726    10040    2   BAD_SHARE: ;
      727    10041                                 /* If BAD_SHARE JIT.ERR has been set by JSA$UNSHARE  */
      728    10042    2         RETURN;
      729    10043
      730    10044        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:24   
      731    10045        /*************************************************************
      732    10046         *                                                           *
      733    10047         *                        M$ALIB                             *
      734    10048         *                        M$DLIB                             *
      735    10049         *                                                           *
      736    10050         *************************************************************/
      737    10051
      738    10052    2       CASE(%C$ALIB#, %C$DLIB#);
      739    10053    2         PTYPE = (%P_DB | %P_ASL | %P_LIB);
      740    10054    2         CALL JSA$FINDSSP (B$PS0$,J_SYS$,PNUM,PTYPE,B$JIT.ERR)
      741    10055    2           ALTRET(DO_ALTRET);
      742    10056    2         IF PTYPE ~= %P_DB
      743    10057    2         THEN IF WSR ~= %USERWSR
      744    10058    3              THEN DO;
      745    10059    3                   B$JIT.ERR=EDOMAIN;
      746    10060    3                   RETURN;
      747    10061    3                   END;
      748    10062    3         DO CASE(CODE);
      749    10063    3          CASE(%C$ALIB#);
      750    10064                                                /* ASSOCIATE CORE LIBRARY             */
      751    10065    3            IF PTYPE = %P_LIB
      752    10066    4            THEN DO;
      753    10067    4                 IF B$JIT.PCL ~= 0         /* Library is unshared                */
      754    10068    5                 THEN DO;
      755    10069    5                      B$JIT.ERR = ELIBUNSH;
      756    10070                            /*E* ERROR: JSP-E$LIBUNSH-7
      757    10071                                 MESSAGE: Cannot M$ALIB with an unshared library.
      758    10072                                  */
      759    10073    5                      RETURN;
      760    10074    5                      END;
      761    10075    4                 IF S$CU$->B$U.ASP = PNUM THEN RETURN;
      762    10076    4                 TASP=S$CU$->B$U.ASP;
      763    10077    4                 IF (TASP ~=0)
      764    10078    5                 THEN DO;
      765    10079        /*E*     ERROR:  JSP-E$DLIB-C
      766    10080                 MESSAGE: M$ALIB caused disassociation of another shared library.
      767    10081        */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:25   
      768    10082    5                      CALL ZAPCLIB(TASP);
      769    10083    5                      B$JIT.ERR=EDLIB;
      770    10084    5                      END;
      771    10085    4                 CALL JSA$CLIB(PNUM) ALTRET(RESTORE_ASP);
      772    10086    4                 GOTO GET_PROCS;
      773    10087    4   RESTORE_ASP:  ;                         /*ALTRET FROM JSA$CLIB*/
      774    10088    4                 CALL JSA$CLIB(TASP);
      775    10089    4                 GOTO GET_PROCS;
      776    10090    4                 END;                      /*DO IF %P_LIB*/
      777    10091        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:26   
      778    10092                                                /* ASSOCIATE ASL                      */
      779    10093    3            IF PTYPE = %P_ASL
      780    10094    4            THEN DO;
      781    10095    4                 IF S$CU$->B$U.ASL = PNUM THEN RETURN;
      782    10096    4                 IF S$CU$->B$U.ASL ~=0
      783    10097    5                 THEN DO;
      784    10098    5   SET_DLIBREQ:       ;
      785    10099    5                      B$JIT.ERR=EDLIBREQ;
      786    10100    5                      RETURN;
      787    10101    5                      END;
      788    10102        /*E*   ERROR:   JSP-E$DLIBREQ-E
      789    10103               MESSAGE: A Library or Debugger of the same type is already associated.
      790    10104               MESSAGE1: M$ALIB of an Alternate Shared Library or of a
      791    10105                         Debugger requires that a processor of the same
      792    10106                         type is not already associated.
      793    10107        */
      794    10108    4                 CALL JSA$ASL(PNUM) ALTRET(DO_ALTRET);
      795    10109    4                 B$JIT.XCONF=(B$JIT.XCONF &~ %XC_ASL#);
      796    10110                                      /*  PREVENT CONFUSION ON NEXT ENTRY TO XCON     */
      797    10111    4                 END;
      798    10112        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:27   
      799    10113                                                /* ASSOCIATE DEBUGGER                 */
      800    10114    3            IF PTYPE = %P_DB
      801    10115    4            THEN DO;
      802    10116    4                 IF WSR < %ASLWSR
      803    10117    5                 THEN DO;
      804    10118    5                      B$JIT.ERR=EDOMAIN;
      805    10119    5                      RETURN;
      806    10120    5                      END;
      807    10121    4                 IF S$CU$->B$U.DB=PNUM THEN GOTO ADB_OK;
      808    10122    4                 IF S$CU$->B$U.DB ~=0 THEN GOTO SET_DLIBREQ;
      809    10123    4                 CALL JSA$ALIBDB(PNUM) ALTRET(DO_ALTRET);
      810    10124    4                 S$CU$->B$U.FLG=(S$CU$->B$U.FLG &~ %U_DIC);
      811    10125    4   ADB_OK:       ;
      812    10126    4                 T1$=ADDR(SAVEP);
      813    10127    4                 SAVEP.ECCS=0;
      814    10128    4                 CALL HFF$NILERASE(1) ALTRET(ALIB2);
      815    10129    4                 T1$->B$ALIB.CMDSZ = B$PSEG.P1.BOUND+1;
      816    10130    4   ALIB2:        ;
      817    10131    4                 SAVEP.EVID=0;
      818    10132    4                 CALL HFF$NILERASE(2) ALTRET(ALIB3);
      819    10133    4                 T1$->B$ALIB.REPLYSZ = B$PSEG.P2.BOUND+1;
      820    10134    4   ALIB3:        ;
      821    10135    4                 SAVEP.JERR='0'B;
      822    10136    4                 SAVEP.P#=0;
      823    10137    4                 DATA1 = %ECC_ALIB#;
      824    10138
      825    10139    4                 IF WSR = %ASLWSR
      826    10140    4                 THEN T1$->B$ALIB.WHO = %SC_AASL#;
      827    10141    4                 ELSE IF S$CU$->B$U.APR ~= 0
      828    10142    4                      THEN T1$->B$ALIB.WHO = %SC_ASHR#;
      829    10143    4                      ELSE IF (B$JIT.JUNK & %JJ_EXONLY#)
      830    10144    4                           THEN T1$->B$ALIB.WHO = %SC_EXUO#;
      831    10145                                                /* ELSE ALREADY SET TO 0 (%SC_AUSR#)  */
      832    10146
      833    10147    4                 CALL UDB$CALCOMP;
      834    10148    4                 CALL SSU$DELTAGO (DATA1,SAVEP);
      835    10149    4                 END;                      /* DO IF %P_DB*/
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:28   
      836    10150                                                /**/
      837    10151                                                /**/
      838    10152    3   GET_PROCS: ;
      839    10153    3            CALL SSR$REG(%SS_AP);
      840    10154    3            RETURN;
      841    10155        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:29   
      842    10156    3          CASE(%C$DLIB#);
      843    10157                                                /* DISASSOCIATE CORE LIBRARY          */
      844    10158    3            IF (B$P$ -> B$P.FLGS(PNUM) & %P_LIB)
      845    10159    4            THEN DO;
      846    10160    4                 IF S$CU$->B$U.ASP ~= PNUM THEN GOTO SET_NOTASSC;
      847    10161    4                 CALL ZAPCLIB(PNUM);
      848    10162    4                 RETURN;
      849    10163    4                 END;
      850    10164                                                /**/
      851    10165                                                /**/
      852    10166                                                /* DISASSOCIATE ASL                   */
      853    10167    3            IF (B$P$ -> B$P.FLGS(PNUM) & %P_ASL)
      854    10168    4            THEN DO;
      855    10169    4                 IF S$CU$->B$U.ASL ~= PNUM THEN GOTO SET_NOTASSC;
      856    10170    4                 B$JIT.JUNK=(B$JIT.JUNK | %JJ_DLIB#);
      857    10171    4                 CALL JSX$RUNXCON(%ASLWSR);
      858    10172    4                 RETURN;
      859    10173    4                 END;
      860    10174                                                /**/
      861    10175                                                /**/
      862    10176                                                /* DISASSOCIATE DEBUGGER              */
      863    10177    3            IF (B$P$ -> B$P.FLGS(PNUM) & %P_DB)
      864    10178    4            THEN DO;
      865    10179    4                 IF S$CU$->B$U.DB ~= PNUM THEN GOTO SET_NOTASSC;
      866    10180    4                 IF (B$JIT.JUNK & %JJ_UDELTA#) THEN RETURN;
      867    10181                                                /* DONT DLIB IF STARTED UNDER DELTA   */
      868    10182    4                 B$JIT.JUNK=(B$JIT.JUNK | %JJ_DLIB#);
      869    10183    4                 CALL JSX$RUNXCON(%DBWSR);
      870    10184    4                 RETURN;
      871    10185    4                 END;
      872    10186                                                /**/
      873    10187    3   SET_NOTASSC: ;
      874    10188    3            B$JIT.ERR=ENOTASSOC;
      875    10189        /*E*     ERROR:  JSP-E$NOTASSOC-E
      876    10190                 MESSAGE:  Library/Debugger not associated
      877    10191        */
      878    10192    3   DO_ALTRET: RETURN;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:30   
      879    10193    3            END;                           /*DO CASE(C$ALIB,C$DLIB)              */
      880    10194        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:31   
      881    10195        /*************************************************************
      882    10196         *                                                           *
      883    10197         *                        M$YC                               *
      884    10198         *                                                           *
      885    10199         *************************************************************/
      886    10200
      887    10201    2       CASE(%C$YC#);
      888    10202    2         IF B$SS.ISR.WSR = %CPWSR
      889    10203    3         THEN DO;
      890    10204    3              B$JIT.ERR=EDOMAIN;
      891    10205    3              RETURN;
      892    10206    3              END;
      893    10207    2         CALL HFF$NILERASE(0) ALTRET(FPT_BAD);
      894    10208    2         CALL HFF$PTPRES(0) ALTRET(FPT_BAD);
      895    10209    2         B$JIT.YC0SZ = B$PSEG.P0.BOUND;
      896    10210
      897    10211    2         CALL HFF$NILERASE(1)
      898    10212    3         WHENALTRETURN DO;
      899    10213    3              B$JIT.ERR=EBADVECT1;
      900    10214    3              RETURN;
      901    10215    3              END;
      902    10216
      903    10217    2         B$JIT.YC2SZ = 0;
      904    10218    2         CALL HFF$NILERASE(2) ALTRET(NO_REPLY);
      905    10219
      906    10220    2         CALL HFF$WRITE(2)
      907    10221    3         WHENRETURN DO;
      908    10222    3              B$JIT.YC2SZ = B$PSEG.P2.BOUND;
      909    10223    3              END;
      910    10224
      911    10225    3         WHENALTRETURN DO;
      912    10226    3              B$JIT.ERR=EBADVECT2;
      913    10227    3              RETURN;
      914    10228    3              END;
      915    10229
      916    10230    2   NO_REPLY: ;
      917    10231
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:32   
      918    10232    2         B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 | %CP_YCPMME#);
      919    10233    2         CALL UDB$CALCOMP;
      920    10234    2         CALL JSE$ACP;
      921    10235    2         RETURN;
      922    10236        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:33   
      923    10237        /*************************************************************
      924    10238         *                                                           *
      925    10239         *                        M$CPEXIT                           *
      926    10240         *                                                           *
      927    10241         *************************************************************/
      928    10242
      929    10243    2       CASE(%C$CPEXIT#);
      930    10244    2         IF B$SS.ISR.WSR ~= %CPWSR
      931    10245    3         THEN DO;
      932    10246    3              B$JIT.ERR=EDOMAIN;
      933    10247    3              RETURN;
      934    10248    3              END;
      935    10249        /*E*     ERROR:   JSP-E$DOMAIN-E
      936    10250                 MESSAGE: That Service Request is not permitted from your domain.
      937    10251                 DESCRIPTION: M$ALIB or M$DLIB and not user domain.
      938    10252                              M$CPEXIT and not CP domain.
      939    10253                              M$INTRTN and not ASL domain.
      940    10254                              M$YC from CP domain.
      941    10255        */
      942    10256        /*
      943    10257           The M$CPEXIT FPT is validated, as we will be running down the
      944    10258           Command Processor prior to using all the parameters and must
      945    10259           be certain we will not trap when accessing those parameters.
      946    10260        */
      947    10261    2         J=6;
      948    10262    2         CALL CHECK_PSTACK ALTRET(FPT_BAD);
      949    10263
      950    10264    2         IF P4$ ~= ADDR(NIL)
      951    10265    3         THEN DO;
      952    10266    3              DEBUG_NAME = P4$->TEXTC;
      953    10267    3              P4$=ADDR(DEBUG_NAME);
      954    10268    3              END;
      955    10269
      956    10270    2         CPEXIT_V=B$PS5$->CPEXIT$V;
      957    10271    2         P5$=ADDR(CPEXIT_V);
      958    10272    2         CPEXIT_RUND=0;                    /* Set internal flag                  */
      959    10273
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:34   
      960    10274        /*
      961    10275           If this is the first M$CPEXIT for this user, CP_JSTEP is set
      962    10276           in JIT.CPFLAGS1 so we won't get confused later when validating
      963    10277           the FPT and performing the interpretive exit.
      964    10278        */
      965    10279    2         IF NOT (B$JIT.CPFLAGS1 & %CP_FIRST#)
      966    10280    3         THEN DO;
      967    10281    3              B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 | %CP_JSTEP#);
      968    10282    3              S$CU$->B$U.FLG.STEP = '1'B;
      969    10283    3              END;
      970    10284
      971    10285
      972    10286        /*
      973    10287           When CP_LOGOFF has been set in JIT.CPFLAGS1, it has been
      974    10288           determined no more job steps are to be allowed.  CP_LOGOFF
      975    10289           will be set in combination with either CP_JSTEP or CP_RUND.
      976    10290        */
      977    10291
      978    10292    2         IF (B$JIT.CPFLAGS1 & %CP_LOGOFF#)
      979    10293    3         THEN DO;
      980    10294        /*
      981    10295           When CP_LOGOFF is set and the user is not yet rundown, the
      982    10296           only valid options on the M$CPEXIT FPT are Quit, DELTA or to
      983    10297           delete the user.  If Quit, the user is rundown, and the
      984    10298           Command Processor will eventually be re-entered with CP_LOGOFF
      985    10299           set in combination with CP_JSTEP.  If delete user, we rundown
      986    10300           the user prior to calling JSD$DELUSR; there will be no re-entry
      987    10301           to the Command Processor.  If post-association of DELTA, we will
      988    10302           make a check on the validity of allowing DELTA and either ALTRET
      989    10303           to the CPEXIT or associate DELTA.
      990    10304        */
      991    10305    3              IF NOT(B$JIT.CPFLAGS1 & %CP_JSTEP#)
      992    10306    4              THEN DO;
      993    10307    4                   IF (CPEXIT_V.CONT#) OR (CPEXIT_V.ALTRTN#)
      994    10308    5                   THEN DO;
      995    10309    5                        IF P4$ ~= ADDR(NIL)
      996    10310    5                        THEN GOTO DB_CHK;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:35   
      997    10311
      998    10312    5                        IF (B$JIT.CPFLAGS1 & %CP_YCPMME#)
      999    10313    5                        THEN GOTO CP_VALID2;
     1000    10314    5                        END;
     1001    10315
     1002    10316    4                   IF (CPEXIT_V.QUIT#) AND (P0$=ADDR(NIL) )
     1003    10317    4                   THEN GOTO CP_VALID2;
     1004    10318
     1005    10319    4                   ELSE IF ( (P0$=ADDR(NIL)) AND (P5$->CPFPT.FLAGS='0'B) )
     1006    10320    4                        THEN GOTO RUNDOWN_FIRST;
     1007    10321    4                        ELSE GOTO SET_NOSTEPS;
     1008    10322    4                   END;
     1009    10323
     1010    10324        /*
     1011    10325           When CP_LOGOFF is set and the user is at Job Step, the only
     1012    10326           valid options are to delete the user or to call for the
     1013    10327           Logoff Command Processor.  To prevent multiple entries to
     1014    10328           the Logoff Command Processor, JJ_LOGOFF is set in JIT.JUNK.
     1015    10329        */
     1016    10330    4              ELSE DO;
     1017    10331    4                   IF (B$JIT.CPFLAGS1 & %CP_JSTEP#)
     1018    10332    5                   THEN DO;
     1019    10333    5                        IF (B$JIT.CPFLAGS1 & %CP_LASTCP#)
     1020    10334    5                          AND NOT(B$JIT.JUNK & %JJ_LOGOFF#)
     1021    10335    5                          AND (P0$ ~= ADDR(NIL) )
     1022    10336    6                        THEN DO;
     1023    10337    6                             B$JIT.JUNK = (B$JIT.JUNK | %JJ_LOGOFF#);
     1024    10338    6                             GOTO CP_VALID2;
     1025    10339    6                             END;
     1026    10340
     1027    10341    5                        IF ( P0$=ADDR(NIL) AND P5$->CPFPT.FLAGS='0'B )
     1028    10342    5                        THEN GOTO CP_VALID2;
     1029    10343
     1030    10344        /*
     1031    10345           When any of these rules have been violated, we give an ALTRET
     1032    10346           to the M$CPEXIT.  However, we only allow this ALTRET once so
     1033    10347           we dont hang up trying to delete a user that is associated
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:36   
     1034    10348           with a confused Command Processor.
     1035    10349        */
     1036    10350    6                        ELSE DO;
     1037    10351    6   SET_NOSTEPS:              ;
     1038    10352    6                             IF NOT(B$JIT.JUNK & %JJ_LOGOFF#)
     1039    10353    7                             THEN DO;
     1040    10354    7                                  B$JIT.JUNK = (B$JIT.JUNK | %JJ_LOGOFF#);
     1041    10355    7                                  B$JIT.ERR=ENOSTEPS;
     1042    10356    7                                  GOTO RESTART_CP;
     1043    10357    7                                  END;
     1044    10358    7                             ELSE DO;
     1045    10359    7                                  P0$ = ADDR(NIL);
     1046    10360    7                                  P5$->CPFPT.FLAGS='0'B;
     1047    10361    7                                  GOTO RUNDOWN_FIRST;
     1048    10362    7                                  END;
     1049    10363    6                             END;
     1050    10364    5                        END;
     1051    10365        /*E*   ERROR:   JSP-E$NOSTEPS
     1052    10366               MESSAGE: No more Job Steps allowed.
     1053    10367               DESCRIPTION:  M$CPEXIT called to initiate another Job Step
     1054    10368                             when CP_LOGOFF has been set in CPFLAGS1.
     1055    10369        */
     1056    10370
     1057    10371        /*
     1058    10372           When we have LOGOFF set in CPFLAGS1 and the user is not at
     1059    10373           Job Step or at Rundown, we have a system error and so we SUA.
     1060    10374        */
     1061    10375    4                   ELSE GOTO SUA_CPEXIT;
     1062    10376    4                   END;
     1063    10377    3              END;
     1064    10378
     1065    10379        /*
     1066    10380           If this is the CPEXIT following an M$LINK with CP_CMD set, the
     1067    10381           user is already rundown.  Make sure that the CP has given us the
     1068    10382           name of a run-unit to link to.  Also make sure he isn't trying
     1069    10383           to link to a Debugger, or fake out a SAVE/GET, or continue
     1070    10384           from this strange state, etc.
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:37   
     1071    10385
     1072    10386           If this is the CPEXIT to load a program following the simulated
     1073    10387           M$LINK for an M$YC LINK=YES service request, rundown the current
     1074    10388           program and fetch the new one.
     1075    10389        */
     1076    10390    2         IF (B$JIT.JUNK2 & %JJ2_CP_LINK#) OR (B$JIT.CPFLAGS1 & %CP_LNKPMME#)
     1077    10391    3         THEN DO;
     1078    10392    3              IF (P0$ = ADDR(NIL)) OR (P4$ ~= ADDR(NIL))
     1079    10393    3                OR (P5$->CPFPT.FLAGS ~= '0'B)
     1080    10394    3              THEN GOTO ALTRET_CPEXIT;
     1081    10395
     1082    10396    3              IF (B$JIT.CPFLAGS1 & %CP_LNKPMME#)
     1083    10397    3              THEN GOTO CP_VALID2;
     1084    10398    3              ELSE GOTO RUNDOWN_FIRST;
     1085    10399    3              END;
     1086    10400
     1087    10401        /*
     1088    10402           If CP_RUND is set in JIT.CPFLAGS1, this may be a post association
     1089    10403           of DELTA or the initiation of a new job step.  If we are to begin
     1090    10404           a new job step, we must of course rundown the current job step first.
     1091    10405        */
     1092    10406    2         IF (B$JIT.CPFLAGS1 & %CP_RUND#)
     1093    10407    2           AND  (P4$ = ADDR(NIL))
     1094    10408    2           AND  (P5$->CPFPT.FLAGS = '0'B)
     1095    10409    3         THEN DO;                          /*NOT POST ASSOC OF DELTA*/
     1096    10410    3   RUNDOWN_FIRST: ;
     1097    10411    3              CPEXIT_RUND = CPEXIT_RUND+1; /* internal flag                      */
     1098    10412    3              GOTO CP_VALID2;
     1099    10413    3              END;
     1100    10414        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:38   
     1101    10415        /*
     1102    10416           We now enter a series of checks to determine if the options
     1103    10417           requested on the M$CPEXIT FPT are valid for the state the
     1104    10418           user is in, as indicated by the setting of JIT.CPFLAGS1.
     1105    10419           These checks and error messages are mostly to aid the develop-
     1106    10420           ment of Command Processors, but also insure that we dont get
     1107    10421           too confused should a Command Processor give us a bad FPT.
     1108    10422        */
     1109    10423    2         IF ( (B$JIT.CPFLAGS1 & %CP_JSTEP#) AND ( (CPEXIT_V & JS_FLAGS) ~='0'B) )
     1110    10424    3         THEN DO;
     1111    10425    3              B$JIT.ERR=EJOBSTEP;
     1112    10426    3              GOTO RESTART_CP;
     1113    10427    3              END;
     1114    10428        /*E*   ERROR:   JSP-E$JOBSTEP-E
     1115    10429               MESSAGE: That command is meaningless at Job Step
     1116    10430        */
     1117    10431
     1118    10432    2         IF ( (CPEXIT_V.ALTRTN#) AND NOT
     1119    10433    2           (B$JIT.CPFLAGS1 & (%CP_YCPMME# | %CP_LNKPMME#)) )
     1120    10434    3         THEN DO;
     1121    10435    3              B$JIT.ERR=ECPALT;
     1122    10436    3              GOTO RESTART_CP;
     1123    10437    3              END;
     1124    10438        /*E*   ERROR:   JSP-E$CPALT-E
     1125    10439               MESSAGE:  M$CPEXIT Bad (Altret set--CP_YCPMME not set)
     1126    10440        */
     1127    10441
     1128    10442    2         IF ( (CPEXIT_V.GETFLG#) OR (P5$->CPFPT.FLAGS='0'B) )
     1129    10443    2           AND NOT(B$JIT.CPFLAGS1 & (%CP_JSTEP# | %CP_LNKPMME#))
     1130    10444    3         THEN DO;
     1131    10445    3              B$JIT.ERR=ENJOBSTEP;
     1132    10446    3              GOTO RESTART_CP;
     1133    10447    3              END;
     1134    10448        /*E*   ERROR:   JSP-E$NJOBSTEP
     1135    10449               MESSAGE:  That command is allowed only at Job Step
     1136    10450        */
     1137    10451
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:39   
     1138    10452    2         IF ( (P0$=ADDR(NIL)) AND (P5$->CPFPT.FLAGS='0'B)  )
     1139    10453    2         THEN IF NOT (B$JIT.CPFLAGS1 & (%CP_JSTEP# | %CP_RUND#) )
     1140    10454    3              THEN DO;
     1141    10455    3                   B$JIT.ERR=ELOGOFF;
     1142    10456    3   RESTART_CP:     ;
     1143    10457    3                   B$JIT.USRERR=B$JIT.ERR;
     1144    10458    3                   RETURN;
     1145    10459    3                   END;
     1146    10460        /*E*   ERROR:   JSP-E$LOGOFF-E
     1147    10461               MESSAGE:  M$CPEXIT Bad (Logoff when not at Job Step or Run-down)
     1148    10462        */
     1149    10463
     1150    10464
     1151    10465        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:40   
     1152    10466        /*
     1153    10467           If this is an M$CPEXIT to simulate an M$LINK, write out the
     1154    10468           image and return to the command processor.
     1155    10469        */
     1156    10470    2         IF CPEXIT_V.LINK#
     1157    10471    3         THEN DO;
     1158    10472    3              B$JIT.PRIV.ACTIVE = B$JIT.PRIV.SAVED;
     1159    10473    3              B$JIT.JUNK2 = (B$JIT.JUNK2 | %JJ2_CP_LINK#);
     1160    10474    4              CALL JLL$LINK(P0$,P1$,P2$,P3$,ADDR(NIL)) WHENALTRETURN DO;
     1161    10475    4                   B$JIT.JUNK2 = B$JIT.JUNK2 &~ %JJ2_CP_LINK#;
     1162    10476    4                   GOTO CPEXIT_ALTRET;
     1163    10477    4                   END;
     1164    10478    3              IF (B$JIT.CPFLAGS1 & %CP_YC#)
     1165    10479    3              THEN B$JIT.JUNK = (B$JIT.JUNK | %JJ_ASYNCLINK#);
     1166    10480    3              RETURN;
     1167    10481    3              END;
     1168    10482
     1169    10483        /*
     1170    10484           If this M$CPEXIT is for post association of DELTA, we verify
     1171    10485           that this is a valid thing to do prior to running down the
     1172    10486           Command Processor.  This allows the user to continue without
     1173    10487           the debugger rather than being rundown as he would be should
     1174    10488           we get to JSE$ABORTM trying to associate the debugger.
     1175    10489        */
     1176    10490    2         IF (CPEXIT_V.CONT#) AND (P4$ ~= ADDR(NIL))
     1177    10491    3         THEN DO;
     1178    10492    3   DB_CHK:    ;
     1179    10493    3              PTYPE= %P_DB;
     1180    10494    3              CALL JSA$FINDSSP (B$PS4$,J_SYS$,PNUM,PTYPE,B$JIT.ERR)
     1181    10495    3                ALTRET(CPEXIT_ALTRET);
     1182    10496    3              CALL JSA$DBCHK(PNUM) ALTRET(CPEXIT_ALTRET);
     1183    10497
     1184    10498    3              IF (S$CU$->B$U.APR=0) OR (S$CU$->B$U.APR >= P_AUTO_START)
     1185    10499    3              THEN GOTO CP_VALID2;
     1186    10500    3              B$JIT.ERR=EDEBUGSP;
     1187    10501        /*E*   ERROR: JSP-E$DEBUGSP-E
     1188    10502               MESSAGE: You cannot associate a debugger with a shared processor.
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:41   
     1189    10503               DESCRIPTION:  YC DELTA when executing a standard shared processor.
     1190    10504        */
     1191    10505    3   CPEXIT_ALTRET: ;
     1192    10506    3              RETURN;
     1193    10507    3              END;
     1194    10508
     1195    10509        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:42   
     1196    10510        /*
     1197    10511           At this point, we have determined that the parameters supplied
     1198    10512           in the FPT are valid and we rundown the Command Processor.  Any
     1199    10513           error conditions that may result from this M$CPEXIT will be
     1200    10514           reported to the Command Processor by entering him at his start
     1201    10515           address with the error code in JIT.USRERR.
     1202    10516        */
     1203    10517
     1204    10518    2   CP_VALID2: ;
     1205    10519
     1206    10520    2         CALL UDB$CALCOMP;
     1207    10521    2         B$SS.FPTCHK=0;
     1208    10522    2         B$SS.FPT = (B$SS.FPT | '004000'O);
     1209    10523        /* If BRK was received give it to the user now.                    */
     1210    10524    2         IF B$JIT.JUNK2 & %JJ2_DFRBRK# THEN
     1211    10525    3         DO;
     1212    10526                   %LOCK (G#=S_ASFGATE);
     1213    10529    3              S$CU$->B$U.ASYNCH = S$CU$->B$U.ASYNCH | %U_BRK;
     1214    10530                   %UNLOCK (G#=S_ASFGATE);
     1215    10533    3              B$JIT.JUNK2 = B$JIT.JUNK2 & ~%JJ2_DFRBRK#;
     1216    10534    3              END;
     1217    10535
     1218    10536        /* Restore the privs we saved while going to the CP */
     1219    10537    2         B$JIT.PRIV.ACTIVE = B$JIT.PRIV.SAVED;
     1220    10538        /*
     1221    10539           If LOGON is exiting, we decrement his UC and set
     1222    10540           the user's ACP to 0.
     1223    10541        */
     1224    10542    2         IF B$P$ -> B$P.NAME(S$CU$->B$U.ACP) = J_LOGON
     1225    10543    3         THEN DO;
     1226    10544    3              B$P$ -> B$P.UC(S$CU$->B$U.ACP) = B$P$ -> B$P.UC(S$CU$->B$U.ACP) -1;
     1227    10545    3              S$CU$->B$U.ACP=0;
     1228    10546    3              GOTO FREE_DS;
     1229    10547    3              END;
     1230    10548
     1231    10549    2         IF (B$JIT.CPFLAGS1 & %CP_KEEPDS#)
     1232    10550    3         THEN DO;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:43   
     1233    10551    3   KEEP_DS:   ;
     1234    10552    3              CALL JSA$RUNDSPC(%CPWSQ,0);
     1235    10553    3              END;
     1236    10554    3         ELSE DO;
     1237    10555    3   FREE_DS:   ;
     1238    10556    3              CALL JSA$RUNDSPC(%CPWSQ,1);
     1239    10557    3              END;
     1240    10558    2         CALL JSS$RUNDSPC;
     1241    10559
     1242    10560    2         IF CPEXIT_RUND ~= 0
     1243    10561    3         THEN DO;
     1244    10562    3              CALL JSR$RUNDOWN ALTRET(ZAPUSER);
     1245    10563    3              END;
     1246    10564
     1247    10565    2         IF (B$JIT.CPFLAGS1 & %CP_JSTEP#)
     1248    10566    3         THEN DO;
     1249    10567    3              CALL JSF$CLSDCBS;            /*CLOSE ALL DCBS BUT M$UC             */
     1250    10568    3              CALL JSU$RSTLMS;
     1251    10569    3              END;
     1252    10570        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:44   
     1253    10571        /*
     1254    10572           Now we are ready to perform the CPEXIT.
     1255    10573
     1256    10574           If no name was specified and all flags are reset, it is a
     1257    10575           request to delete this user.
     1258    10576        */
     1259    10577    2         IF ( (P0$=ADDR(NIL)) AND (P5$->CPFPT.FLAGS='0'B)  )
     1260    10578    3         THEN DO;
     1261    10579    3   DELUSR:    ;
     1262    10580    3              S$CU$->B$U.FLG.CPIC = '0'B;
     1263    10581    3              CALL JSR$RUNDOWN ALTRET(ZAPUSER);
     1264    10582    3   ZAPUSER:   CALL JSD$DELUSR;
     1265    10583                                      /*No RETURN: This user gets eaten by sched.     */
     1266    10584    3              END;                         /*DO IF LOGOFF                        */
     1267    10585
     1268    10586
     1269    10587        /*
     1270    10588           When the Command Processor has detected a condition that
     1271    10589           requires no more job steps be allowed, he has set the CPOFF
     1272    10590           bit in the FPT flags.  We record this fact in JIT.RNST and
     1273    10591           begin the abort process by calling JSE$ABORTX.
     1274    10592        */
     1275    10593    2         IF (CPEXIT_V.CPOFF#)
     1276    10594    3         THEN DO;
     1277    10595    3              B$JIT.RNST=%RS_OFF#;
     1278    10596    3              IF (CPEXIT_V.JERR.CODE# = 0)
     1279    10597    3              THEN B$JIT.ERR=EOFF;
     1280    10598    3              ELSE B$JIT.ERR = CPEXIT_V.JERR;
     1281    10599        /*E*  ERROR:  JSP-E$OFF-E
     1282    10600              MESSAGE:  Your Command Processor has logged you off.
     1283    10601              DESCRIPTION: The Command Processor, when issuing an M$CPEXIT
     1284    10602               with OFF specified should also have JERR specified
     1285    10603               in the FPT.  Therefore the user should never see this
     1286    10604               error message.
     1287    10605        */
     1288    10606    3              B$JIT.CPFLAGS1=(B$JIT.CPFLAGS1 & %CP_USER#);
     1289    10607    3              CALL JSE$ABORTX;             /* WILL NOT RETURN                    */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:45   
     1290    10608    3              END;
     1291    10609
     1292    10610        /*
     1293    10611           If the user has issued an M$LINK request with CP_CMD, go get the
     1294    10612           program now.
     1295    10613        */
     1296    10614    2         IF (B$JIT.CPFLAGS1 & %CP_LNKPMME#)
     1297    10615    3         THEN DO;
     1298    10616    3              B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~ %CP_LNKPMME#);
     1299    10617    3              GOTO DO_CPEXIT;
     1300    10618    3              END;
     1301    10619
     1302    10620        /*
     1303    10621           If the user has issued an M$YC request with simulate M$LINK set,
     1304    10622           also do that now.
     1305    10623        */
     1306    10624    2         IF (B$JIT.JUNK2 & %JJ2_CP_LINK#)
     1307    10625    3         THEN DO;
     1308    10626    3              B$JIT.JUNK2 = (B$JIT.JUNK2 &~ %JJ2_CP_LINK#);
     1309    10627    3              IF (B$JIT.JUNK & %JJ_UDELTA#)
     1310    10628    3              THEN S$CU$->B$U.FLG.DIC = '1'B;
     1311    10629    3              GOTO DO_CPEXIT;
     1312    10630    3              END;
     1313    10631
     1314    10632        /*
     1315    10633           If the user is at Job Step, the CPEXIT must be either to
     1316    10634           initiate the next program or to GET a saved program image.
     1317    10635
     1318    10636           If the CPEXIT specifies a GET request a call is made to JQS$GET
     1319    10637           to restored the SAVEd image.  If the restored process had been
     1320    10638           originally saved becuase of an M$SAVE service request, or because
     1321    10639           of an M$YC request where the command was 'SAVE', the user's IC
     1322    10640           is adjusted to bypass the ALTRET for that request.  In any case,
     1323    10641           a call is then made to JSE$ACP to cause the Command Processor to
     1324    10642           be re-entered.
     1325    10643
     1326    10644        */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:46   
     1327    10645
     1328    10646    2         IF (B$JIT.CPFLAGS1 & %CP_JSTEP#)
     1329    10647    3         THEN DO;
     1330    10648    3              B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~ %CP_EXIT#);
     1331    10649    3              IF (CPEXIT_V.GETFLG#)
     1332    10650    4              THEN DO;
     1333    10651    4                   CALL JQS$GET(P0$,P1$,P2$,P3$) ALTRET(NO_GET);
     1334    10652    4                   CALL UDN$MAGIC;
     1335    10653    4                   B$JIT.SVLDTF=( (B$JIT.SVLDTF & %SVL_DIC#) | %SVL_GET#);
     1336    10654    4                   S$CU$->B$U.FLG.DIC='0'B;
     1337    10655    4                   IF (  (B$JIT.CPFLAGS1 & %CP_YCPMME#)
     1338    10656    4                     OR ( (B$SS.FPT.FCG = %FCG_JS#) AND (B$SS.FPT.CODE=%C$SAVE#) )  )
     1339    10657    4                   THEN IF B$SS.FPT.ALT='1'B
     1340    10658    5                        THEN DO;
     1341    10659    5                             B$SS.IC=B$SS.IC+1;
     1342    10660    5                             END;
     1343    10661    4                   B$JIT.CPFLAGS1 = ( (B$JIT.CPFLAGS1 & %CP_RESET#)
     1344    10662    4                     | %(CP_YCGET# | CP_YC#) );
     1345    10663    4                   CALL JSE$ACP;
     1346    10664    4   NO_GET:         ;
     1347    10665    4                   B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 & %CP_RESET#);
     1348    10666    4                   CALL JSE$ABORTM;
     1349    10667    4                   END;                    /*DO IF GET                           */
     1350    10668
     1351    10669        /*
     1352    10670           If this is a CPEXIT to initiate a new program, control is given
     1353    10671           to JST$GETPROG.
     1354    10672        */
     1355    10673    3   DO_CPEXIT: ;
     1356    10674    3              CALL JST$GETPROG(P0$,P1$,P2$,P3$,P4$);
     1357    10675    3              END;                         /*DO IF JOBSTEP*/
     1358    10676
     1359    10677        /*
     1360    10678           If the CPEXIT specifies we are to process the QUIT command, we
     1361    10679           must determine if the user said QUIT via M$YC.  If so, we call
     1362    10680           JSA$CPQUIT which will allow entry to DELTA and/or Exit Control.
     1363    10681           Otherwise, JSA$QUIT is called to bypass DELTA and Exit Control.
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:47   
     1364    10682        */
     1365    10683    2         IF (CPEXIT_V.QUIT#)
     1366    10684    3         THEN DO;
     1367    10685    3              IF (B$JIT.CPFLAGS1 & %CP_YCPMME#)
     1368    10686    3              THEN CALL JSA$CPQUIT;
     1369    10687    3              ELSE CALL JSA$QUIT;
     1370    10688    3              B$JIT.CPFLAGS1=(B$JIT.CPFLAGS1 & %CP_USER#);
     1371    10689    3              CALL JSE$ABORTX;             /* WILL NOT RETURN                    */
     1372    10690    3              END;
     1373    10691                                                /**/
     1374    10692        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:48   
     1375    10693        /*
     1376    10694           If the CPEXIT specifies we are to process the 'GO' command, the
     1377    10695           monitor first checks to see if this is a GO following restoring
     1378    10696           of a SAVEd program.  If so, processing continues as follows:
     1379    10697
     1380    10698              } If the program had been saved with the debugger in control,
     1381    10699              } SSU$DELTAGO is called to give control to the debugger.
     1382    10700              }
     1383    10701              } If the program that has been restored had requested exit
     1384    10702              } control for SAVE (see M$SCON) and that program is running
     1385    10703              } under control of a debugger, the GET XCON frame is moved
     1386    10704              } from the user's TCB to the debugger's TCB, and control is
     1387    10705              } given to the debugger.
     1388    10706              }
     1389    10707              } Otherwise no special action is required;  B$SS.IC will contain
     1390    10708              } the IC from either the IC from the time of the SAVE request
     1391    10709              } or the XCON IC.  In this case the GET XCON will be on the
     1392    10710              } user's TCB.
     1393    10711              }
     1394    10712        */
     1395    10713    2         IF (CPEXIT_V.CONT#)
     1396    10714    3         THEN DO;
     1397    10715        /*
     1398    10716           Before continuing with the interrupted process the monitor will
     1399    10717           inspect all ECCBs in the Read-Only Segment to determine if
     1400    10718           any domain has requested control over the YC-GO sequence via M$EVENT.
     1401    10719           For each request that is found, a call is made to SSV$EVENT to
     1402    10720           build a DO List entry for this user.  When this user is ready to
     1403    10721           be put in execution, the Scheduler will find the Do List entry
     1404    10722           and cause his Event Handler to be entered.
     1405    10723        */
     1406    10724    4              DO I=0 TO 3;
     1407    10725    4                   T1$=ADDR(B$ROSEG$->B$ROSEG.ECCB(I));
     1408    10726    4                   IF T1$->B$ECCB.FLAGS.YCSET
     1409    10727    5                   THEN DO;
     1410    10728    5                        J=%USERWSR-I;
     1411    10729    5                        SAVEP.ECCS=%SUBC_YC#;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:49   
     1412    10730    5                        SAVEP.EVID=0;
     1413    10731    5                        SAVEP.JERR='0'B;
     1414    10732    5                        CALL SSV$EVENT(B$JIT.USER,J,SAVEP.ECCS,SAVEP.EVID,SAVEP.JERR);
     1415    10733    5                        END;
     1416    10734    4                   END;
     1417    10735
     1418    10736    3              IF (B$JIT.SVLDTF & %SVL_GET#)
     1419    10737    4              THEN DO;
     1420    10738    4                   SGFLAG=B$JIT.SVLDTF;
     1421    10739    4                   B$JIT.SVLDTF=(B$JIT.SVLDTF &~ %SVL_GET#);
     1422    10740                                                /*                                    */
     1423    10741    4                   IF (SGFLAG & %SVL_DIC#)
     1424    10742    4                   THEN GOTO DELTA_GET;
     1425    10743
     1426    10744    4                   IF (B$JIT.JUNK & %JJ_SCON#)
     1427    10745    5                   THEN DO;
     1428    10746    5                        IF (B$JIT.JUNK & %JJ_UDELTA#)
     1429    10747    6                        THEN DO;
     1430    10748    7                             DO INHIBIT;
     1431    10749    7                                  B$LS$->B$MLS.MISC2=B$USERLS$->B$ULS.TCB;
             10749                                           /* USER TCB */
     1432    10750    7                                  B_MPT.LSDESC$->B$$DESCR=B$LS$->B$MLS.DBLS;
             10750                                           /* DELTA LS */
     1433    10751    7                                  CALL UDN$MAGICLS; /* DELTA DESCRs TO MAGIC     */
     1434    10752    7                                  T1$=B$MISC2$; /* USER TCB POINTER              */
     1435    10753    7                                  CALL UEP$MOVETCB (0,ADDR(NIL),T1$) ALTRET(D_TCB_FULL)
             10753                                           ;
     1436    10754    7                                  END;     /* INHIBIT                            */
     1437    10755                                                /* Returns with T1$-> XCON Frame      */
     1438    10756    6                             B_MPT.LSDESC$->B$$DESCR=B$LS$->B$MLS.USERLS;
     1439    10757    6                             CALL UDN$MAGICLS;
     1440    10758    6                             IF (T1$->B$XCON.CECCB.PROG='1'B)
     1441    10759    7                             THEN DO;
     1442    10760    7                                  B_MPT.ECCB$->B$ECCB.XCONF.PROG='0'B;
     1443    10761    7                                  END;
     1444    10762                                                /* Get GET Frame off of user TCB      */
     1445    10763    6                             T1$=ADDR(NIL);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:50   
     1446    10764    6                             CALL UEP$CLEARONE(0,T1$);
     1447    10765
     1448    10766    6   DELTA_GET:                ;
     1449    10767    6                             DATA1=%ECC_SAVLDT#;
     1450    10768    6                             CALL SSU$DELTAGO (DATA1,0);
     1451    10769
     1452    10770    6                             END;          /*DO IF XCON - DELTA ASSOCIATED       */
     1453    10771    5                        END;               /*DO IF JJ_SCON#                      */
     1454    10772    4                   END;                    /* DO IF SVL_GET#                     */
     1455    10773        /*
     1456    10774           Next, the monitor checks to see if the CPEXIT is to continue after
     1457    10775           post association of a debugger.  If no debugger is associated
     1458    10776           a call is made to JST$GETPROG to associate it.  However, if a
     1459    10777           debugger is already associated, SSU$DELTAGO is called to enter
     1460    10778           the debugger at it's start address, unless the debugger was in
     1461    10779           control at the time of interruption.  In this case, the debugger's
     1462    10780           Break Control routine will be entered.
     1463    10781        */
     1464    10782    3              IF P4$ ~= ADDR(NIL)
     1465    10783    4              THEN DO;
     1466    10784    4                   IF S$CU$->B$U.DB = 0
     1467    10785    4                   THEN GOTO DO_CPEXIT;
     1468    10786                                           /*    YC-DELTA when running under DELTA    */
     1469    10787    4                   B$JIT.JUNK = (B$JIT.JUNK | %JJ_UDELTA#);
     1470    10788    4                   B$USERLS$->B$ULNK.ECCB.FLGS = (B$USERLS$->B$ULNK.ECCB.FLGS | %DSXXX)
             10788                            ;
     1471    10789                  /* Set the under DELTA flags in case it was originally an ALIB.     */
     1472    10790    4                   SAVEP.ECCS=%SC_BYC#;
     1473    10791    4                   SAVEP.EVID=0;
     1474    10792    4                   SAVEP.JERR=B$JIT.ERR;
     1475    10793    4                   SAVEP.P#=0;
     1476    10794    4                   DATA1=%ECC_INT#;
     1477    10795
     1478    10796    4                   IF B$SS.ISR.WSR = %DBWSR
     1479    10797    5                   THEN DO;
     1480    10798                                      /* Go to DELTA BRK Routine if YC-DELTA when DIC */
     1481    10799    5                        CALL UDN$MAGICSS;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:51   
     1482    10800
     1483    10801    5                        SSIC=B_MPT.ECCB$->B$ECCB.BRK;
     1484    10802    5                        CALL SST$SSFTCB(SSIC,DATA1,SAVEP,B_MPT.SS$,B_MPT.TCB$)
     1485    10803    5                          ALTRET(D_TCB_FULL);
     1486    10804    5                        END;
     1487    10805    5                   ELSE DO;
     1488    10806                            /* Go to DELTA Start Addr if YC-DELTA when User or ASL IC */
     1489    10807    5                        IF (B$JIT.CPFLAGS1 & %CP_YCPMME#)
     1490    10808    6                        THEN DO;
     1491    10809    6                             IF B$SS.FPT.ALT ~='0'B
     1492    10810    6                             THEN B$SS.IC = B$SS.IC+1;
     1493    10811    6                             B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~%CP_YCPMME#);
     1494    10812    6                             END;
     1495    10813    5                        ELSE B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~ %CP_YC#);
     1496    10814    5                        CALL SSU$DELTAGO (DATA1,SAVEP);
     1497    10815                                 /* DELTAGO will back Safe-Store to find user frame   */
     1498    10816    5                        END;
     1499    10817    4                   END;                    /*DO IF P4$ ~NIL                      */
     1500    10818        /*
     1501    10819           Finally, to return control to the interrupted process, a call is
     1502    10820           made to UDB$AUTO, if that process had been interrupted by the
     1503    10821           YC interrupt, where the Auto used by JSP$PMME will be released.
     1504    10822           If the Command Processor had been entered because of an M$YC Service
     1505    10823           Request, UDB$PMMEXIT is called to check for error conditions.
     1506    10824        */
     1507    10825    3   JSP_CONT:  ;
     1508    10826        /* Here we eventually want to call FMM$ASSMRG to merge assigns if  */
     1509    10827        /* We are coming back from the cp and a 'SET' command was done     */
     1510    10828        /* Between job STEPS: We need to define a new flag in cpflags.     */
     1511    10829    3              IF (B$JIT.CPFLAGS1 & %CP_YC#)
     1512    10830    4              THEN DO;
     1513    10831    4                   B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~%CP_YC#);
     1514    10832    4                   CALL UDB$AUTO;          /*Flush auto and goto SSS$SEXIT       */
     1515    10833    4                   END;
     1516    10834    4              ELSE DO;
     1517    10835    4   JSP_CONT2:      ;
     1518    10836    4                   B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 & %CP_USER#);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:52   
     1519    10837    4                   CALL UDB$PMMEXIT2;      /*Will not return                     */
     1520    10838    4                   END;
     1521    10839    3              END;                         /* DO IF CONTINUE                     */
     1522    10840        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:53   
     1523    10841        /*
     1524    10842           If the CPEXIT specifies we are to ALTRET to the M$YC Service
     1525    10843           Request the error code is moved from the V area of the FPT to
     1526    10844           the JIT.  If the Command Processor didn't supply an error code
     1527    10845           we use a canned one.  Control is returned to the user via PMMEXIT.
     1528    10846        */
     1529    10847    2         IF (CPEXIT_V.ALTRTN#)
     1530    10848    3         THEN DO;
     1531    10849    3   ALTRET_CPEXIT: ;
     1532    10850    3              IF (CPEXIT_V.JERR.CODE# = 0)
     1533    10851    3              THEN CPEXIT_V.JERR = ECYALT;
     1534    10852        /*E*  ERROR:  JSP-E$CYALT-E
     1535    10853              MESSAGE: Command Processor has signaled ALTRET to your M$YC Service Request.
     1536    10854              DESCRIPTION: The Command Processor, when issuing an M$CPEXIT
     1537    10855               with ALTRTN specified should also have JERR specified
     1538    10856               in the FPT.  Therefore the user should never see this
     1539    10857               error message.
     1540    10858        */
     1541    10859    3              IF (B$JIT.JUNK2 & %JJ2_CP_LINK#)
     1542    10860    4              THEN DO;
     1543    10861    4                   B$JIT.JUNK2 = (B$JIT.JUNK2 &~ %JJ2_CP_LINK#);
     1544    10862    4                   CALL JSR$RUNDOWN ALTRET(ZAPUSER);
     1545    10863    4                   GOTO LNK_RTN;
     1546    10864    4                   END;
     1547    10865
     1548    10866    3              IF (B$JIT.CPFLAGS1 & %CP_LNKPMME#)
     1549    10867    4              THEN DO;
     1550    10868    4                   B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~ (%CP_LNKPMME# | %CP_BUFFULL#) );
     1551    10869    4   LNK_RTN:        ;
     1552    10870    4                   B$JIT.USRERR = CPEXIT_V.JERR;
     1553    10871    4                   B$JIT.JUNK = (B$JIT.JUNK &~ %JJ_MLINKIP#);
     1554    10872
     1555    10873    4                   SGFLAG = B$JIT.SVLDTF;
     1556    10874    4                   B$JIT.SVLDTF = '000'O;
     1557    10875    4                   IF (SGFLAG & %SVL_LINK#)
     1558    10876    4                   THEN CALL JLL$RTN;
     1559    10877    4                   ELSE CALL JSE$ACP;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:54   
     1560    10878    4                   END;
     1561    10879
     1562    10880    3              B$JIT.ERR = CPEXIT_V.JERR;
     1563    10881    3              GOTO JSP_CONT;
     1564    10882    3              END;
     1565    10883
     1566    10884        /*
     1567    10885           If the CPEXIT specifies that the currently interrupted process
     1568    10886           is to be SAVEd, a call is made to an internal subroutine
     1569    10887           (DO_SAVE) to accomplish this.  If the Command Processor had
     1570    10888           received this SAVE request via an M$YC Service Request, control
     1571    10889           is returned to the user by a call to UDB$PMMEXIT which will
     1572    10890           check for error conditions and possibly ALTRETing to the user.
     1573    10891           Otherwise the SAVE request was made following a Control-Y and
     1574    10892           so a call is made to JSE$ACP to re-enter the Command Processor.
     1575    10893        */
     1576    10894    2         IF (CPEXIT_V.SAVEFLG#)
     1577    10895    3         THEN DO;
     1578    10896    3              SGFLAG=%SVL_YCSAVE#;
     1579    10897    3              CALL DO_SAVE(SGFLAG) ALTRET(NO_SAVE);
     1580    10898    3   NO_SAVE:   ;
     1581    10899    3              IF (B$JIT.CPFLAGS1 & %CP_YCPMME#)
     1582    10900    3              THEN GOTO JSP_CONT2;
     1583    10901    4              ELSE DO;
     1584    10902    4                   B$JIT.USRERR=B$JIT.ERR;
     1585    10903    4                   CALL JSE$ACP;
     1586    10904    4                   END;
     1587    10905    3              END;
     1588    10906                                                /*                                    */
     1589    10907             /* TO GET HERE-WE HAVE FAILED TO FIND FAULT WITH THE
     1590    10908                M$CPEXIT & HAVE FAILED TO ANLZ WHAT IBEX WANTS US TO DO */
     1591    10909    2   SUA_CPEXIT: ;
     1592    10910    2         CALL SC_CPEXIT;
     1593    10911        /*S*   SCREECH_CODE:   JSP-S$CPEXIT
     1594    10912               TYPE:  SUA
     1595    10913               MESSAGE:   JSP$PMME failed to analyze the M$CPEXIT
     1596    10914        */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:55   
     1597    10915
     1598    10916        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:56   
     1599    10917
     1600    10918
     1601    10919                                           /* ALTRET FROM SST$SSFTCB USING DELTAS TCB */
     1602    10920    2   D_TCB_FULL: ;
     1603    10921    2         CALL SC_JSPDTCB;
     1604    10922        /*S*   SCREECH_CODE:   JSP-S$DTCB
     1605    10923               TYPE:   SUA
     1606    10924               MESSAGE:  DELTA's TCB is full (JSP$PMME)
     1607    10925               REMARKS:  Cannot get space in DELTA's TCB for one of
     1608    10926                         the following conditions:
     1609    10927
     1610    10928                         a)  The user has hit Control-Y and asked
     1611    10929                             for DELTA when DELTA is in control.
     1612    10930
     1613    10931                         b)  Restoring a SAVEd file (GET) when the
     1614    10932                             program that had been saved was running
     1615    10933                             under DELTA.
     1616    10934        */
     1617    10935                                                /*                                    */
     1618    10936        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:57   
     1619    10937        /*************************************************************
     1620    10938         *                                                           *
     1621    10939         *                        M$SCREECH                          *
     1622    10940         *                                                           *
     1623    10941         *************************************************************/
     1624    10942
     1625    10943    2       CASE(%C$SCREECH#);
     1626    10944
     1627    10945    2         MSCODE = B$PS0$->MPARAM;
     1628    10946        /* Users that are not system ghosts are limited to SNAP.
     1629    10947           Special Shared Processors are limited to SUA or SNAP.
     1630    10948           System Ghosts can specify any severity.
     1631    10949        */
     1632    10950    2         IF (B$SS.ISR.WSR  = %USERWSR)
     1633    10951    3         THEN DO;
     1634    10952    3              IF S_CUN > S_MING
     1635    10953    3              THEN MSCODE.SEV = 5;
     1636    10954    3              ELSE ;
     1637    10955    3              END;
     1638    10956    3         ELSE DO;
     1639    10957    3              IF MSCODE.SEV >6
     1640    10958    3              THEN MSCODE.SEV=6;
     1641    10959    3              IF MSCODE.SEV < 5
     1642    10960    3              THEN MSCODE.SEV=5;
     1643    10961    3              END;
     1644    10962
     1645    10963    2         IF MSCODE.AUSER='1'B
     1646    10964    3         THEN DO;
     1647    10965    3              IF B$PSEG.P0.BOUND < 15 THEN GOTO BAD_USR;
     1648    10966    3              SCRUSR# = B$PS0$->B$SNAPUSR.U#;
     1649    10967    3              IF (SCRUSR# > B_MUAIS) OR (B$USRT$->B$USER.US(SCRUSR#) = %SS_SNULL)
     1650    10968    4              THEN DO;
     1651    10969    4   BAD_USR:        ;
     1652    10970    4                   B$JIT.ERR=ESNAPU;
     1653    10971    4                   RETURN;
     1654    10972    4                   END;
     1655    10973        /*E*   ERROR:   JSP-E$SNAPUSR-E
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:58   
     1656    10974               MESSAGE: User specified via M$SCREECH FPT does not exist.
     1657    10975        */
     1658    10976    3              END;
     1659    10977    2         ELSE SCRUSR# = 0;
     1660    10978    3         DO I=1 TO B$ROSEG$->B$ROSEG.NUMDCBS;
     1661    10979    3              T1$=B$ROSEG$->B$ROSEG.DCBPTR$->PTR$(I);
     1662    10980    3              IF T1$~=ADDR(NIL)
     1663    10981    4              THEN DO;
     1664    10982    4                   IF T1$->F$DCB.FCD AND T1$->F$DCB.ASN=%COMGROUP#
     1665    10983    5                   THEN DO;
     1666    10984    5                        T2$=NK$LDCT$(T1$->F$DCB.LDCTX)->NK$LDCT.CG$;
     1667    10985    5                        CALL KQX$LDASR(T2$->B$PTR);
     1668    10986    5                        GOTO END_FND_CG;
     1669    10987    5                        END;
     1670    10988    4                   END;
     1671    10989    3              END;
     1672    10990    2   END_FND_CG:
     1673    10991    2         I=1;
     1674    10992    2         CALL HFF$NILERASE(I) ALTRET(NO_JITERR);
     1675    10993    2         B$JIT.ERR=B$PS1$->MPARAM.ERR;
     1676    10994    2   NO_JITERR: ;
     1677    10995    2         MSCODE.MON='0'B;
     1678    10996    2         MSCODE.CUSR='1'B;
     1679    10997    3         DO INHIBIT;
     1680    10998    3              SC_USER.RC = MSCODE;
     1681    10999    3              SC_USER.USER# = SCRUSR#;
     1682    11000    3              CALL IRM$USER$SCREECH;
     1683    11001    3              IF IRM_NODUMP ~='0'B
     1684    11002    4              THEN DO;
     1685    11003    4                   B$JIT.ERR=EDFBUSY;
     1686    11004    4                   GOTO NO_COUNT;
     1687    11005    4                   END;
     1688    11006        /*E*   ERROR:   JSP-E$DFBUSY-0
     1689    11007               MESSAGE:  System dump file busy-no file written
     1690    11008        */
     1691    11009    4              ELSE DO;
     1692    11010    4                   B$JIT.ERR='0'B;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:59   
     1693    11011    4                   J=IRM_ASCOUNT;
     1694    11012    4                   END;
     1695    11013    3              CALL HFF$NILERASE(2) ALTRET(NO_COUNT);
     1696    11014    3              IF B$PSEG.P2.BOUND < 10
     1697    11015    4              THEN DO;
     1698    11016    4                   B$JIT.ERR = EBADVECT2;
     1699    11017    4                   RETURN;
     1700    11018    4                   END;
     1701    11019    3              B$PS2$->DF_NAME.L=10;
     1702    11020    3              B$PS2$->DF_NAME.N1=':DF';
     1703    11021    3              B$PS2$->DF_NAME.MONID4=B_SITEINFO.VERSION#;
     1704    11022    3              CALL BINCHAR(B$PS2$->DF_NAME.DUMPC,IRM_ASCOUNT);
     1705    11023    3   NO_COUNT:  ;
     1706    11024    3              END;
     1707    11025    2         RETURN;
     1708    11026
     1709    11027        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:60   
     1710    11028        /*************************************************************
     1711    11029         *                                                           *
     1712    11030         *                        M$INTRTN                           *
     1713    11031         *                                                           *
     1714    11032         *************************************************************/
     1715    11033
     1716    11034    2       CASE(%C$INTRTN#);
     1717    11035    2         IF B$SS.ISR.WSR ~= %ASLWSR
     1718    11036    3         THEN DO;
     1719    11037    3              B$JIT.ERR=EDOMAIN;
     1720    11038    3              RETURN;
     1721    11039    3              END;
     1722    11040    2         CALL UDB$CALCOMP;
     1723    11041    2         CALL JSS$RUNDSPC;                 /*Flush IDS from Safe-Store           */
     1724    11042    2         CALL SSR$RUE(%SS_CBK);
     1725    11043    2         CALL UDB$AUTO;
     1726    11044
     1727    11045        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:61   
     1728    11046        /*************************************************************
     1729    11047         *                                                           *
     1730    11048         *                        M$XCONRTN                          *
     1731    11049         *                                                           *
     1732    11050         *************************************************************/
     1733    11051
     1734    11052    2       CASE(%C$XCONRTN#);
     1735    11053    2         IF B$SS.ISR.WSR = %USERWSR
     1736    11054    3         THEN DO;
     1737    11055    3              B$JIT.ERR=EDOMAIN;
     1738    11056    3              RETURN;
     1739    11057    3              END;
     1740    11058                                                /*                                    */
     1741    11059    2         IF (B$JIT.XCONF & %XC_URND#)
     1742    11060    3         THEN DO;
     1743    11061    3              CALL UDB$CALCOMP;
     1744    11062    3              CALL JSE$ABORTX;
     1745    11063    3              END;
     1746    11064                            /* Someone is confused--ABORTX should clean things up     */
     1747    11065                                                /*                                    */
     1748    11066    2         J=0;                              /* Set dont clean Entry Descriptor    */
     1749    11067    2         CALL HFF$NILERASE(0) ALTRET(NO_XFPT);
     1750    11068    2         IF B$PS0$->FPT$XCONRTN_V.NOENTRY='1'B
     1751    11069    2         THEN J=1;
     1752    11070    2   NO_XFPT: ;
     1753    11071    2         CALL HFF$NILERASE(1) ALTRET(NO_XFPT2);
     1754    11072    2         B$JIT.ERR=B$PS1$->MPARAM.ERR;
     1755    11073    2         GOTO GOT_XFPT;
     1756    11074    2   NO_XFPT2: ;
     1757    11075    2         IF (B$JIT.FRS & %RS_XCON#)
     1758    11076    2         THEN B$JIT.ERR=EXCONRTNA;
     1759    11077    2         ELSE B$JIT.ERR=EXCONRTNE;
     1760    11078        /*E*   ERROR:   JSP-E$XCONRTN-A
     1761    11079               MESSAGE: Abort by Special Shared Processor via M$XCONRTN.
     1762    11080               MESSAGE1: An abort condition, such as operator abort,
     1763    11081                         line hang-up, or limit exceeded, has occurred while
     1764    11082                         one of your Special Shared Processors was in
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:62   
     1765    11083                         control.  Bit settings in your Exit Control TCB
     1766    11084                         frame (or in the JIT) will indicate the cause
     1767    11085                         of the abort.
     1768    11086               MESSAGE6: Abort by Special Shared Processor via M$XCONRTN.
     1769    11087               DESCRIPTION: The user should never see this message as
     1770    11088                 the Special Shared Processor should always specify
     1771    11089                 the error code to be returned to the user.  See the
     1772    11090                 description of M$XCONRTN in the CP_6 Monitor Services
     1773    11091                 Reference Manual.
     1774    11092        */
     1775    11093    2   GOT_XFPT: ;
     1776    11094                                                /*                                    */
     1777    11095    2         I=B$SS.ISR.WSR;
     1778    11096    2         IF B_MPT.ECCB$->B$ECCB.XCONF.LIMIT='1'B
     1779    11097    2         THEN CALL JSX$UNXCON;
     1780    11098                                                /*                                    */
     1781    11099    2         B_MPT.ECCB$->B$ECCB.XCONF='000'O; /*Reset all Flags                     */
     1782    11100    2         B$JIT.RNST=(B$JIT.FRS & %RS_XCON#);
     1783    11101    2         B$JIT.FRS=(B$JIT.FRS &~ %RS_XCON#);
     1784    11102    2         B$JIT.XCONF=(B$JIT.XCONF & %XC_DOMAIN#);
     1785    11103                                                /*                                    */
     1786    11104    2         IF J=1                       /*If request to clean entry descriptor     */
     1787    11105    3         THEN DO;
     1788    11106    4              DO CASE(I);
     1789    11107    4               CASE(%DBWSR);
     1790    11108    4                 S$CU$->B$U.FLG.DELA='0'B;
     1791    11109    4                 B$USERLS$->B$ULNK.ECCB.FLGS=(B$USERLS$->B$ULNK.ECCB.FLGS &~ %DSXXX);
     1792    11110    4                 B$JIT.JUNK = (B$JIT.JUNK &~ %JJ_UDELTA#);
     1793    11111                                                /*                                    */
     1794    11112    4               CASE(%ASLWSR);
     1795    11113    4                 B$USERLS$->B$ULNK.ASLENT.ENTLOC=BITBIN('777777'O);
     1796    11114    4                 B$USERLS$->B$ULNK.ASLENT.TYP=15;
     1797    11115                                                /*User will get IPR fault             */
     1798    11116    4                 B$JIT.XCONF=(B$JIT.XCONF | %XC_ASL#);
     1799    11117    4                 END;                      /*DO CASE(CODE)*/
     1800    11118    3              END;                         /*DO IF no more calls allowed         */
     1801    11119                                                /*                                    */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:63   
     1802    11120    2         IF I ~= %ASLWSR                   /* IF NOT ASL                         */
     1803    11121    2         THEN CALL JSA$RUNDSPC(I,0);
     1804    11122    2         CALL UDB$CALCOMP;
     1805    11123    2         CALL JSS$RUNDSPC;
     1806    11124    2         CALL JSE$ABORTX;
     1807    11125                                                /*                                    */
     1808    11126                                                /*                                    */
     1809    11127        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:64   
     1810    11128                                                /* BAD CODE OR NOT IMPLEMEMTED        */
     1811    11129    2       CASE(ELSE);
     1812    11130    2         B$JIT.ERR=EOPTPMME;
     1813    11131    2         RETURN;
     1814    11132        /*
     1815    11133        */
     1816    11134    2         END;                              /*DO CASE(CODE)*/
     1817    11135    1      RETURN;
     1818    11136        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:65   
     1819    11137                                                /*INTERNAL PROCEDURES                 */
     1820    11138        /*I*   NAME:     CHECK_PSTACK
     1821    11139
     1822    11140               PURPOSE:  To validate the FPT and move the user parameters
     1823    11141                         to Monitor auto for those PMMEs that require running
     1824    11142                         down the user befor performing the service request.
     1825    11143
     1826    11144                         Called for:  CPEXIT  LINK  LDTRC  SAVE
     1827    11145
     1828    11146        */
     1829    11147    1   CHECK_PSTACK: PROC ALTRET;
     1830    11148
     1831    11149    2      PSIZE=(B_MPT.PSDESC$->B$$DESCR.BOUND+1)/8;
     1832    11150    2      IF (J>PSIZE) THEN ALTRETURN;
     1833    11151                                                /**/
     1834    11152    2      T1$ =ADDR(P0$);
     1835    11153    2      T2$ = ADDR(B$PS0$);
     1836    11154    2      I=0;
     1837    11155                                                /**/
     1838    11156    3      DO WHILE (I <= J);
     1839    11157    3           T1$->B$PTR =ADDR(NIL);
     1840    11158    3           CALL HFF$NILERASE(I) ALTRET(NEXTP);
     1841    11159    3           T1$->B$PTR = T2$->B$PTR;
     1842    11160    3   NEXTP:  ;
     1843    11161    3           T1$=PINCRW(T1$,1);
     1844    11162    3           T2$=PINCRW(T2$,1);
     1845    11163    3           I=I+1;
     1846    11164    3           END;
     1847    11165                                                /**/
     1848    11166                                                /**/
     1849    11167    2      IF P0$ ~= ADDR(NIL)
     1850    11168    3      THEN DO;
     1851    11169    3           SAVEP.FNAME=P0$->TEXTC;
     1852    11170    3           P0$=ADDR(SAVEP.FNAME);
     1853    11171    3           IF P0$->B$STARF.STAR='*'
     1854    11172    4           THEN DO;
     1855    11173    4                SAVEP.ACCT=B$JIT.ACCN;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:66   
     1856    11174    4                GOTO SET_P1$;
     1857    11175    4                END;
     1858    11176    3           END;
     1859    11177    2      ELSE IF CODE = %C$SAVE#
     1860    11178    2           THEN ALTRETURN;
     1861    11179
     1862    11180    2      IF P1$ ~= ADDR(NIL)
     1863    11181    3      THEN DO;
     1864    11182    3           SAVEP.ACCT = P1$->B$DWTXT;
     1865    11183    3           IF SAVEP.ACCT=' ' THEN GOTO SET_FACCN;
     1866    11184    3           END;
     1867    11185    3      ELSE DO;
     1868    11186    3           IF CODE = %C$CPEXIT#
     1869    11187    3           THEN SAVEP.ACCT=J_SYSTXT;
     1870    11188    4           ELSE DO;
     1871    11189    4   SET_FACCN:   ;
     1872    11190    4                SAVEP.ACCT=B$JIT.FACCN;
     1873    11191
     1874    11192    4                IF CODE ~= %C$CPEXIT#
     1875    11193    4                THEN GOTO SET_P1$;
     1876    11194
     1877    11195    4                IF (B$PS5$->CPEXIT$V.SAVEFLG#) OR (B$PS5$->CPEXIT$V.GETFLG#)
     1878    11196    4                THEN GOTO SET_P1$;
     1879    11197
     1880    11198    4                IF P3$ = ADDR(NIL)
     1881    11199    4                THEN GOTO SET_P3$;
     1882    11200    4                ELSE IF P3$->B$TXT6='      '
     1883    11201    5                     THEN DO;
     1884    11202    5   SET_P3$:               ;
     1885    11203    5                          P3$ = ADDR(B$JIT.FPSN);
     1886    11204    5                          END;
     1887    11205    4                END;
     1888    11206    3           END;
     1889    11207    2   SET_P1$: ;
     1890    11208    2      P1$=ADDR(SAVEP.ACCT);
     1891    11209
     1892    11210        /* normalize the run-unit name if account is :SYS */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:67   
     1893    11211    2      IF (SAVEP.ACCT=J_SYSTXT) AND (CODE ~= %C$SAVE#)
     1894    11212    3      THEN DO I=SAVEP.FNAME.CNT-1 DOWNTO 0;
     1895    11213    3           IF (SAVEP.FNAME.CTXT(I) >= '141'O/*a*/)
     1896    11214    3             AND (SAVEP.FNAME.CTXT(I) <= '172'O/*z*/)
     1897    11215    3           THEN SAVEP.FNAME.CTXT(I) = (SAVEP.FNAME.CTXT(I) & '737'O);
     1898    11216    3           END;
     1899    11217
     1900    11218    2      IF P2$ ~= ADDR(NIL)
     1901    11219    3      THEN DO;
     1902    11220    3           SAVEP.PASS = P2$->B$DWTXT;
     1903    11221    3           P2$=ADDR(SAVEP.PASS);
     1904    11222    3           END;
     1905    11223
     1906    11224    2      IF P3$ ~= ADDR(NIL)
     1907    11225    3      THEN DO;
     1908    11226    3           SAVEP.PSID = P3$->B$TXT6;
     1909    11227    3           P3$=ADDR(SAVEP.PSID);
     1910    11228    3           END;
     1911    11229
     1912    11230    2   END CHECK_PSTACK;
     1913    11231        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:68   
     1914    11232
     1915    11233        /*I*   NAME:   ZAPCLIB
     1916    11234
     1917    11235               PURPOSE:  To remove Core Library procedure from the users
     1918    11236                         page table on an M$DLIB request or when an M$ALIB
     1919    11237                         request requires disassociation of a different
     1920    11238                         Core Library.
     1921    11239
     1922    11240        */
     1923    11241    1   ZAPCLIB: PROC(J);
     1924    11242    2   DCL J SBIN;
     1925    11243    2   DCL I SBIN;
     1926    11244                                                /**/
     1927    11245             %LOCK (G=J_PLOCK);
     1928    11248    2      S$CU$->B$U.ASP = 0;                  /* Mark user tables                   */
     1929    11249    2      B$P$ -> B$P.UC(J) = B$P$ -> B$P.UC(J)-1;
     1930    11250           %UNLOCK (G=J_PLOCK);
     1931    11253    3      DO I=%LIBLO TO %ISEGHI;
     1932    11254    3           B$UPT$->B$PAGE.WRD(I) = MM_FPMC;
     1933    11255    3           END;
     1934    11256    2      RETURN;
     1935    11257    2   END ZAPCLIB;
     1936    11258        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:69   
     1937    11259                                                /*                                    */
     1938    11260    1   DO_SAVE: PROC(SFLAG) ALTRET;
     1939    11261    2   DCL SFLAG BIT(9) ALIGNED;
     1940    11262    2   DCL ERRJSQ UBIN(36);
     1941    11263    2   DCL USRIC SBIN;
     1942    11264                                                /*                                    */
     1943    11265                                                /*                                    */
     1944    11266    2      USRIC=1;
     1945    11267    3      DO WHILE (B$SS.ISR.WSR ~= %USERWSR);
     1946    11268    3           USRIC=0;
     1947    11269    3           IF B$SS.ISR.WSR=%DBWSR
     1948    11270    3           THEN SFLAG = (SFLAG | %SVL_DIC#);
     1949    11271    3           CALL JSS$BACKSS;
     1950    11272    3           END;
     1951    11273    2      CALL UDN$MAGICSS;                    /* SET USER MAGIC                     */
     1952    11274    2      CALL JQU$VALID(ERRJSQ) ALTRET(ALTR);
     1953    11275    2      IF (B$JIT.JUNK & %JJ_SCON#) AND (B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET='1'B)
     1954    11276    3      THEN DO;
     1955    11277    3           IF (B_MPT.ECCB$->B$ECCB.XCONF & (%SVL_SAVE# | %SVL_GET#) )
     1956    11278    4           THEN DO;
     1957    11279    4                B$JIT.ERR=ESSAVE;
     1958    11280    4                ALTRETURN;
     1959    11281    4                END;
     1960    11282        /*E*   ERROR:  JSP-E$SSAVE-E
     1961    11283               MESSAGE:   Save not allowed when in Exit Control for SAVE-GET
     1962    11284        */
     1963    11285    3           END;                            /*DO IF JJ_SCON#                      */
     1964    11286
     1965    11287    2      IF S$CU$->B$U.APR >= P_AUTO_START
     1966    11288    3      THEN DO;
     1967    11289    3           PNUM=S$CU$->B$U.APR;
     1968    11290    3           I = S$CU$->B$U.APO;
     1969    11291    3           CALL JSA$UNSHARE(PNUM,I) ALTRET(ALTR_XCON);
     1970    11292    3           S$CU$->B$U.APO = 0;
     1971    11293    3           S$CU$->B$U.APR = 0;
     1972    11294    3           END;
     1973    11295                       /* Note that JIT.ERR will be set by JSA$UNSHARE if he ALTRETS  */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:70   
     1974    11296
     1975    11297                                                /*  THIS IS THE FAST SAVE PATH        */
     1976    11298    2      IF (B$JIT.JUNK & %JJ_SCON#) ='000000'O
     1977    11299    2        AND (S$CU$->B$U.ASL=0)
     1978    11300    2        AND (S$CU$->B$U.DB=0)
     1979    11301    3      THEN DO;
     1980    11302    3           CALL JQS$SAVE(P0$,P1$,P2$,P3$)  ALTRET(ALTR2);
     1981    11303    3           RETURN;
     1982    11304    3           END;                            /*FAST PATH                           */
     1983    11305                                                /*                                    */
     1984    11306    2      B$JIT.SVLDTF=SFLAG;
     1985    11307    2      P4$=ADDR(NIL);                       /*NO COMMAND ON M$SAVE                */
     1986    11308    2      SAVEP.P# = SIZEW(SAVEP) - POFFW(ADDR(P0$) , ADDR(SAVEP));
     1987    11309    2      IF (USRIC=0) OR ( (B$JIT.JUNK & %JJ_SCON#) ='000000'O)
     1988    11310    3      THEN DO;                             /*CANT DO IT YET-- MAY HAVE ASL       */
     1989    11311    3           CALL JSX$SVLDTXCON(SAVEP);
     1990    11312    3           GOTO ALTR_XCON;
     1991    11313                                                /*USER TCB IS FULL                    */
     1992    11314    3           END;
     1993    11315    2      ELSE CALL JSX$XCONSAVE(SAVEP);
     1994    11316                                                /*  USER XCON OR DELTA                */
     1995    11317    2      GOTO ALTR_XCON;
     1996    11318    2   ALTR: ;
     1997    11319    2      B$JIT.ERR=EFPT;                      /*ANY SKELETON                        */
     1998    11320    2      B$JIT.ERR.CODE=ERRJSQ;
     1999    11321    2   ALTR_XCON: ;
     2000    11322    2      B$JIT.SVLDTF=(B$JIT.SVLDTF &~SFLAG);
     2001    11323    2   ALTR2: ;
     2002    11324    2      ALTRETURN;
     2003    11325
     2004    11326    2   END;                                    /*DO_SAVE                             */
     2005    11327        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:71   
     2006    11328    1   MVPROC:PROC (P$);
     2007    11329    2   DCL P$ PTR;
     2008    11330    2   DCL TYP UBIN;
     2009    11331
     2010    11332    2      TYP=0/*move name*/;
     2011    11333    2      GOTO COMMON;
     2012    11334
     2013    11335    2   MVACCT: ENTRY(P$);
     2014    11336    2      TYP=1/*move account*/;
     2015    11337    2   COMMON: ;
     2016    11338    2      CALL HFF$NILERASE(P$) ALTRET(ALL_DONE);
     2017    11339        /* If there is a valid entry indexed by PNUM, move the name and acct.
     2018    11340        */
     2019    11341    2      IF (PNUM ~= 0) AND (PNUM <= P_LAST_AUTO)
     2020    11342    3      THEN DO;
     2021    11343    3           IF B$P$->B$P.INSTDATE(PNUM) = 0 THEN GOTO SET_BLNKS;
     2022    11344    3           IF TYP=0
     2023    11345    3           THEN P$->FNTEXTC = B$P$->B$P.NAME(PNUM);
     2024    11346    3           ELSE P$->B$DWTXT = B$P$->B$P.ACCT(PNUM);
     2025    11347    3           END;
     2026    11348
     2027    11349        /* If not valid, move blanks.
     2028    11350        */
     2029    11351    3      ELSE DO;
     2030    11352    3   SET_BLNKS: ;
     2031    11353    3           IF TYP=0
     2032    11354    4           THEN DO;
     2033    11355    4                P$->FNTEXTC.TEXT = ' ';
     2034    11356    4                P$->FNTEXTC.SIZ = 0;
     2035    11357    4                END;
     2036    11358    3           ELSE P$->B$DWTXT = ' ';
     2037    11359    3           END;
     2038    11360    2   ALL_DONE: ;
     2039    11361    2      RETURN;
     2040    11362    2   END MVPROC;
     2041    11363    1   END JSP$PMME;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:72   
--  Include file information  --

   UM_CP6.:E05TOU  is referenced.
   UE_CP6.:E05TOU  is referenced.
   UD_EQU_E.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   MM_MACRO_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   MM$SYSGEN.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   MM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   J_ERRSET_C.:E05TOU  is referenced.
   J_ERRORS_C.:E05TOU  is referenced.
   JS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   JS_CP6.:E05TOU  is referenced.
   JS$CP6V_C.:E05TOU  is referenced.
   IR_DATA_M.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_ULSMAC_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$SS.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure JSP$PMME.

   Procedure JSP$PMME requires 2497 words for executable code.
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:73   
   Procedure JSP$PMME requires 70 words of local(AUTO) storage.

    No errors detected in file JSP$PMME.:E05TSI    .

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:74   

 Object Unit name= JSP$PMME                                   File name= JSP$PMME.:E05TOU
 UTS= JUL 29 '97 23:46:09.72 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     51     63  JSP$PMME
    1   Proc  even  none  2497   4701  JSP$PMME
    2  RoData even  none    43     53  JSP$PMME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  JSP$PMME

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      4  JS_CHECKCP
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:75   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 UDN$MAGIC
 yes     yes           Std       3 SSR$REG
         yes           Std       0 UDB$CALCOMP
 yes     yes           Std       2 JDP$SEGLD
         yes           Std       3 SSU$DELTAGO
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       1 JSX$XCONSAVE
 yes     yes           Std       1 JSA$CLIB
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 HFF$WRITE
 yes     yes           Std       2 JSA$UNSHARE
 yes     yes           Std       1 JSA$DBCHK
         yes           Std       5 JST$GETPROG
         yes           Std       0 UDN$MAGICLS
         yes           Std       1 KQX$LDASR
 yes     yes           Std       0 JSR$RUNDOWN
         yes           Std       0 JSD$DELUSR
         yes           Std       0 UDB$PMMEXIT2
 yes     yes           Std       3 UEP$CLEARONE
         yes           Std       0 UDB$AUTO
 yes     yes           Std       1 JSA$ASL
 yes     yes           Std       3 JDS$OVRLY
 yes     yes           Std       0 JLL$LOCATE
 yes     yes           Std       1 JSA$ALIBDB
         yes           Std       0 JSE$ABORTM
         yes           Std       0 UDN$MAGICSS
         yes           Std       0 JSS$RUNDSPC
         yes           Std       0 JSU$RSTLMS
         yes           Std       7 SSV$EVENT
         yes           Std       0 IRM$USER$SCREECH
 yes     yes           Std       6 JLL$LINK
         yes           Std       1 JSX$SVLDTXCON
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:76   
 yes     yes           Std       5 JSA$FINDSSP
 yes     yes           Std       6 SST$SSFTCB
         yes           Std       1 JSX$RUNXCON
         yes           Std       0 JSE$ABORTX
         yes           Std       1 HFC$LOCK
         yes           Std       2 JSA$RUNDSPC
         yes           Std       0 JSA$CPQUIT
         yes           Std       0 JSA$QUIT
 yes     yes           Std       4 JQS$GET
         yes           Std       4 SSR$RUE
 yes     yes           Std       5 JLL$LDTRC
 yes     yes           Std       0 JLL$RTN
         yes           Std       0 JSE$ACP
 yes     yes           Std       5 JSA$FINDAUTO
 yes     yes           Std       1 HFF$PTPRES
 yes     yes           Std       3 UEP$MOVETCB
         yes           Std       0 JSF$CLSDCBS
         yes           Std       0 JSX$UNXCON
         yes           Std       0 JSS$BACKSS
 yes     yes           Std       4 JQS$SAVE
 yes     yes           Std       1 JQU$VALID
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:77   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_JSPDTCB                            SC_CPEXIT                             P_AUTO_START
     P_LAST_AUTO                           B$P$                             r    MM_BYP$
     MM_FPMC                               N$DCT$$                               B_MPT
r    B$PS0$                           r    B$PS1$                           r    B$PS2$
r    B$PS3$                           r    B$PS4$                           r    B$PS5$
r    B$PS6$                           r    B$JIT$                           r    B$UPT$
r    B$USERLS$                        r    B$LS$                            r    B$MISC2$
r    B$ROSEG$                              B$USRT$                               S$CU$
r    J_LOGON                               J_PLOCK                          r    J_SYSTXT
r    J_SYS$                                SC_USER                               IRM_NODUMP
     IRM_ASCOUNT                           B_SITEINFO                            B_MUAIS
     S_CUN                                 S_MING                                S_ASFGATE
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:78   


        1        1        /*M*  JSP$PMME    Job Step PMME Service Decoder    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8
        9        9        JSP$PMME: PROC(CODE);

      9  1 000000   000000 700200 xent  JSP$PMME     TSX0  ! X66_AUTO_1
         1 000001   000106 000001                    ZERO    70,1

       10       10        %INCLUDE B$JIT;
       11      613        %INCLUDE B$P;
       12      697        %INCLUDE B$ROSEG;
       13      760        %INCLUDE B$SS;
       14      939        %INCLUDE B$USER;
       15     1155        %INCLUDE B_MAGIC_C;
       16     1273        %INCLUDE B_MLSMAC_C;
       17     2215        %INCLUDE B_ULSMAC_C;
       18     3324        %INCLUDE CP_6_SUBS;
       19     3864        %INCLUDE F$DCB;
       20     3913        %INCLUDE HF_LOCK_C;
       21     3927        %INCLUDE IR_DATA_M;
       22     4091        %INCLUDE JS$CP6V_C;
       23     4154        %INCLUDE JS_CP6;
       24     4572        %INCLUDE JS_CNTRL_R;
       25     4606        %INCLUDE J_ERRORS_C;
       26     4693        %INCLUDE J_ERRSET_C;
       27     4713        %INCLUDE MM_DATA_R;
       28     5233        %INCLUDE NK$LDCT;
       29     5335        %INCLUDE NK_LDCT_R;
       30     5344        %INCLUDE SS_SCHED_C;
       31     5577        %INCLUDE UD_ERRORS_C;
       32     5619        %INCLUDE UD_SEV_C;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:79   
       33     5633        %INCLUDE UD_EQU_E;
       34     6022        %INCLUDE UE_CP6;
       35     6713        %INCLUDE UM_CP6;
       36     7565                                                /*PARAMETERS*/
       37     7566    1   DCL CODE UBIN(36);
       38     7567                                                /*LOCAL AUTO*/
       39     7568    1   DCL DATA1 SBIN;
       40     7569    1   DCL P5$ PTR;
       41     7570    1   DCL I SBIN;
       42     7571    1   DCL J SBIN;
       43     7572    1   DCL T1$ PTR;
       44     7573    1   DCL T2$ PTR;
       45     7574    1   DCL PSIZE SBIN;
       46     7575    1   DCL PNUM SBIN;
       47     7576    1   DCL PTYPE BIT(18);
       48     7577    1   DCL SGFLAG BIT(9);
       49     7578    1   DCL CPEXIT_RUND UBIN WORD;
       50     7579    1   DCL 1 MSCODE DALIGNED,
       51     7580    1         2 FCG BIT(12) UNAL,
       52     7581    1         2 MID BIT(6) UNAL,
       53     7582    1         2 MON BIT(1) UNAL,
       54     7583    1         2 CODE UBIN(14) UNAL,
       55     7584    1         2 SEV UBIN(3) UNAL,
       56     7585    1         2 * BIT(20) UNAL,
       57     7586    1         2 CUSR BIT(1) UNAL,
       58     7587    1         2 * BIT(14) UNAL,
       59     7588    1         2 AUSER BIT(1) UNAL;
       60     7589    1   DCL 1 SCRUSR# UBIN(9);
       61     7590
       62     7591        %B$SVLDT (FPTN=SAVEP, STCLASS= ,FULL=NO);
       63     7632
       64     7633    1   DCL CMD_TYPE UBIN;
       65     7634    1   DCL CMD_SZ UBIN;
       66     7635
       67     7636    1   DCL 1 DEBUG_NAME,
       68     7637    1         2 CNT UBIN(9) UNAL,
       69     7638    1         2 TXT CHAR(31) UNAL;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:80   
       70     7639
       71     7640    1   DCL SSIC UBIN(36);
       72     7641    1   DCL TASP UBIN(9);
       73     7642    1   DCL WSR SBIN;
       74     7643    1   DCL ENTRY_ADDR UBIN;
       75     7644                                                /*EXTERNAL PROCEDURES                 */
       76     7645    1   DCL JSE$ABORTM ENTRY;
       77     7646    1   DCL JSE$ABORTX ENTRY;
       78     7647    1   DCL JST$GETPROG ENTRY(5);
       79     7648    1   DCL JSA$RUNDSPC ENTRY(2);
       80     7649    1   DCL JSA$UNSHARE ENTRY(2) ALTRET;
       81     7650    1   DCL JSS$BACKSS ENTRY;
       82     7651    1   DCL JSS$RUNDSPC ENTRY;
       83     7652    1   DCL JSU$RSTLMS ENTRY;
       84     7653    1   DCL JSA$QUIT ENTRY;
       85     7654    1   DCL JSA$CPQUIT ENTRY;
       86     7655    1   DCL JSE$ACP ENTRY;
       87     7656    1   DCL JQU$VALID ENTRY(1) ALTRET;
       88     7657    1   DCL JQS$SAVE ENTRY(4) ALTRET;
       89     7658    1   DCL JQS$GET ENTRY(4) ALTRET;
       90     7659    1   DCL JSX$XCONSAVE ENTRY(1);
       91     7660    1   DCL JSX$SVLDTXCON ENTRY(1);
       92     7661    1   DCL JSR$RUNDOWN ENTRY ALTRET;
       93     7662    1   DCL JSD$DELUSR ENTRY;
       94     7663    1   DCL JSF$CLSDCBS ENTRY;
       95     7664    1   DCL JSU$RELFSEG ENTRY;
       96     7665    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
       97     7666    1   DCL HFF$PTPRES ENTRY(1) ALTRET;
       98     7667    1   DCL HFF$WRITE ENTRY(1) ALTRET;
       99     7668    1   DCL JLL$LINK  ENTRY(6) ALTRET;
      100     7669    1   DCL JLL$LDTRC ENTRY(5) ALTRET;
      101     7670    1   DCL JLL$RTN ENTRY ALTRET;
      102     7671    1   DCL JLL$LOCATE ENTRY ALTRET;
      103     7672    1   DCL JDP$SEGLD ENTRY(2) ALTRET;
      104     7673    1   DCL JDS$OVRLY ENTRY(3) ALTRET;
      105     7674    1   DCL KQX$LDASR ENTRY(1);
      106     7675    1   DCL UDB$AUTO ENTRY;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:81   
      107     7676    1   DCL UDB$PMMEXIT2 ENTRY;
      108     7677    1   DCL UDB$CALCOMP ENTRY;
      109     7678    1   DCL UDN$MAGIC ENTRY;
      110     7679    1   DCL UDN$MAGICLS ENTRY;
      111     7680    1   DCL UDN$MAGICSS ENTRY;
      112     7681    1   DCL JSA$CLIB ENTRY(1) ALTRET;
      113     7682    1   DCL JSA$ASL ENTRY(1) ALTRET;
      114     7683    1   DCL JSA$ALIBDB ENTRY(1) ALTRET;
      115     7684    1   DCL JSA$DBCHK ENTRY(1) ALTRET;
      116     7685    1   DCL JSA$FINDSSP ENTRY(5) ALTRET;
      117     7686    1   DCL JSA$FINDAUTO ENTRY(5) ALTRET;
      118     7687    1   DCL SSR$REG ENTRY(3) ALTRET;
      119     7688    1   DCL SSR$RUE ENTRY(4);
      120     7689    1   DCL SST$SSFTCB ENTRY(6) ALTRET;
      121     7690    1   DCL SSV$EVENT ENTRY(7);
      122     7691    1   DCL UEP$CLEARONE ENTRY(3) ALTRET;
      123     7692    1   DCL UEP$MOVETCB ENTRY(3) ALTRET;
      124     7693    1   DCL SSU$DELTAGO ENTRY(3);
      125     7694    1   DCL JSX$RUNXCON ENTRY(1);
      126     7695    1   DCL JSX$UNXCON ENTRY;
      127     7696    1   DCL IRM$USER$SCREECH ENTRY;
      128     7697    1   DCL SC_CPEXIT ENTRY CONV(2,0);
      129     7698    1   DCL SC_JSPDTCB ENTRY CONV(2,0);
      130     7699
      131     7700        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:82   
      132     7701        %FPT_CPEXIT (FPTN=JS_FLAGS,
      133     7702                     STCLASS=CONSTANT,
      134     7703                     CONT=YES,
      135     7704                     QUIT=YES,
      136     7705                     ALTRTN=YES,
      137     7706                     SAVEFLG=YES,
      138     7707                     LINK=YES,
      139     7708                     VECTORS=NO);
      140     7734
      141     7735        %B$WSR_DESC (FPTN=NIL_DESC,STCLASS=CONSTANT);
      142     7757    1   DCL JS_CHECKCP SBIN CONSTANT SYMDEF INIT(1);
      143     7758                                                /* EXTERNAL DATA                      */
      144     7759        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
      145     7852    1   DCL B$PS0$ PTR SYMREF READONLY;
      146     7853    1   DCL B$PS1$ PTR SYMREF READONLY;
      147     7854    1   DCL B$PS2$ PTR SYMREF READONLY;
      148     7855    1   DCL B$PS3$ PTR SYMREF READONLY;
      149     7856    1   DCL B$PS4$ PTR SYMREF READONLY;
      150     7857    1   DCL B$PS5$ PTR SYMREF READONLY;
      151     7858    1   DCL B$PS6$ PTR SYMREF READONLY;
      152     7859    1   DCL B$JIT$ PTR SYMREF READONLY;
      153     7860    1   DCL B$UPT$ PTR SYMREF READONLY;
      154     7861    1   DCL B$DBLS$ PTR SYMREF READONLY;
      155     7862    1   DCL B$USERLS$ PTR SYMREF READONLY;
      156     7863    1   DCL B$LS$ PTR SYMREF READONLY;
      157     7864    1   DCL B$MISC2$ PTR SYMREF READONLY;
      158     7865    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      159     7866
      160     7867    1   DCL B$USRT$ PTR SYMREF;
      161     7868    1   DCL S$CU$ PTR SYMREF;
      162     7869
      163     7870
      164     7871    1   DCL 1 J_LOGON SYMREF READONLY,
      165     7872    1         2 CNT UBIN(9) UNAL,
      166     7873    1         2 NAME CHAR(7) UNAL;
      167     7874    1   DCL J_PLOCK SYMREF BIT(72) DALIGNED;
      168     7875    1   DCL J_SYSTXT CHAR(8) SYMREF READONLY;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:83   
      169     7876    1   DCL J_SYS$ PTR SYMREF READONLY;
      170     7877    1   DCL 1 SC_USER SYMREF,
      171     7878    1         2 RC BIT(72) UNAL,
      172     7879    1         2 USER# UBIN(9) UNAL;
      173     7880    1   DCL IRM_NODUMP BIT(36) SYMREF;
      174     7881    1   DCL IRM_ASCOUNT SBIN SYMREF;
      175     7882        %VLR_SITEINFO (FPTN=B_SITEINFO,STCLASS=SYMREF);
      176     7901    1   DCL B_MUAIS UBIN(36) SYMREF;
      177     7902    1   DCL S_CUN SBIN SYMREF;
      178     7903    1   DCL S_MING SBIN SYMREF;
      179     7904    1   DCL S_ASFGATE BIT(72) SYMREF;
      180     7905                                                /* BASED STRUCTURES                   */
      181     7906        %RV_DFNAME (STCLASS=BASED);
      182     7910    1   DCL B$DWTXT CHAR(8) BASED ALIGNED;
      183     7911    1   DCL B$TXT6 CHAR(6) BASED ALIGNED;
      184     7912
      185     7913    1   DCL B$PTR PTR BASED;
      186     7914    1   DCL PTR$(0:1023) PTR BASED ALIGNED;
      187     7915    1   DCL 1 B$PAGE BASED ALIGNED,
      188     7916    1         2 WRD(0:1023) BIT(36) ALIGNED;
      189     7917
      190     7918                                                /*                                    */
      191     7919        %B$WSR_DESC(FPTN=B$$DESCR);
      192     7941
      193     7942    1   DCL 1 B$PSEG BASED DALIGNED,
      194     7943              %B$WSR_DESC(FPTN=P0,LVL=2,STCLASS=BASED,LAST=NO);
      195     7965              %B$WSR_DESC(FPTN=P1,LVL=2,STCLASS=BASED,LAST=NO);
      196     7987              %B$WSR_DESC(FPTN=P2,LVL=2,STCLASS=BASED,LAST=NO);
      197     8009              %B$WSR_DESC(FPTN=P3,LVL=2,STCLASS=BASED,LAST=NO);
      198     8031              %B$WSR_DESC(FPTN=P4,LVL=2,STCLASS=BASED,LAST=NO);
      199     8053              %B$WSR_DESC(FPTN=P5,LVL=2,STCLASS=BASED,LAST=YES);
      200     8075                                                /*                                    */
      201     8076    1   DCL 1 TEXTC BASED,
      202     8077    1         2 SIZ UBIN(9) UNAL,
      203     8078    1         2 TEXT CHAR(TEXTC.SIZ);
      204     8079    1   DCL 1 FNTEXTC BASED,
      205     8080    1         2 SIZ UBIN(9) UNAL,
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:84   
      206     8081    1         2 TEXT CHAR(31) UNAL;
      207     8082
      208     8083    1   DCL 1 B$STARF BASED,
      209     8084    1         2 SIZ UBIN(9) UNAL,
      210     8085    1         2 STAR CHAR(1) UNAL;
      211     8086
      212     8087        %B_MLS (FPTN=B$MLS,STCLASS=BASED);
      213     8902        %B_USRULS (FPTN=B$ULNK,STCLASS=BASED);
      214     9101        %NK$LDCT;
      215     9147        %B$ECCB;
      216     9155        %B$XCON;
      217     9165        %B$ALIB;
      218     9169
      219     9170        %FPT$ALIB_V;
      220     9173        %FPT$SCON_V;
      221     9176        %FPT$OLAY_V;
      222     9179        %FPT$XCONRTN_V;
      223     9182        %FPT$UNSHARE_V;
      224     9185        %FPT$LINK_V;
      225     9188
      226     9189        %FPT_CPEXIT (FPTN=CPEXIT$V,
      227     9190                       VECTORS=NO,
      228     9191                       STCLASS=BASED);
      229     9217        %FPT_CPEXIT (FPTN=CPEXIT_V,
      230     9218                       VECTORS=NO,
      231     9219                       STCLASS=AUTO);
      232     9245    1   DCL 1 CPFPT BASED DALIGNED,
      233     9246    1         2 FLAGS BIT(18) UNAL,
      234     9247    1         2 * BIT(18) UNAL;
      235     9248
      236     9249    1   DCL B$PTYPE BIT(18) BASED DALIGNED;
      237     9250    1   DCL 1 B$PTYPE_MLINK BASED ALIGNED, 2 PTYPE BIT(18), 2 MLINK BIT(1);
      238     9251    1   DCL B$PNUM UBIN(9) BASED DALIGNED;
      239     9252
      240     9253        %SUB_EXC;
      241     9300        %SUB_ECCDELTA;
      242     9337
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:85   
      243     9338    1   DCL 1 MPARAM BASED DALIGNED,
      244     9339    1         2 ERR BIT(36) UNAL,
      245     9340    1         2 * BIT(36) UNAL;
      246     9341
      247     9342    1   DCL 1 B$SNAPUSR BASED DALIGNED,
      248     9343    1         2 * BIT(72) UNAL,
      249     9344    1         2 U# UBIN(9) UNAL;
      250     9345                                                /* STRING SUBSTITUTIONS               */
      251     9346        %SUB B$JIT = B$JIT$->B$JIT;
      252     9347        %SUB B$SS=B_MPT.SS$->B$SS;
      253     9348        %SUB B$PSEG=B_MPT.PS$->B$PSEG;
      254     9349        %SUB B$ULS=B$ULNK;
      255     9350
      256     9351        %SUB P0$=SAVEP.P0$;
      257     9352        %SUB P1$=SAVEP.P1$;
      258     9353        %SUB P2$=SAVEP.P2$;
      259     9354        %SUB P3$=SAVEP.P3$;
      260     9355        %SUB P4$=SAVEP.P4$;
      261     9356
      262     9357        %EQU CMD_TEXT = 0;
      263     9358        %EQU CMD_TEXTC = 1;
      264     9359
      265     9360        /* TO SET JIT.ERR */
      266     9361        %SUB FCG#='1223'O;
      267     9362        %SUB MID#='20'O;
      268     9363        %ERRCODE (NAME=EFPT,COD#=%E$BADVECT0);
      269     9371        %ERRCODE (NAME=EBADVECT1,COD#=%E$BADVECT1);
      270     9379        %ERRCODE (NAME=EBADVECT2,COD#=%E$BADVECT2);
      271     9387        %ERRCODE (NAME=EBADVECT3,COD#=%E$BADVECT3);
      272     9395        %ERRCODE (NAME=EWRONGTYPE,COD#=%E$WRONGTYPE);
      273     9403        %ERRCODE (NAME=ENOPROC,COD#=%E$NOPROC);
      274     9411        %ERRCODE (NAME=EFPT5,COD#=%E$BADVECT5);
      275     9419        %ERRCODE (NAME=EDOMAIN,COD#=%E$DOMAIN);
      276     9427        %ERRCODE (NAME=ENOLIB,COD#=%E$NOLIB);
      277     9435        %ERRCODE (NAME=EDLIB,COD#=%E$DLIB,SEV#=SEV_CONT#);
      278     9443        %ERRCODE (NAME=ELIBUNSH,COD#=%E$LIBUNSH,SEV#=SEV_ERROR#);
      279     9451        %ERRCODE (NAME=EDLIBREQ,COD#=%E$DLIBREQ);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:86   
      280     9459        %ERRCODE (NAME=ENOTASSOC,COD#=%E$NOTASSOC);
      281     9467        %ERRCODE (NAME=EJOBSTEP,COD#=%E$JOBSTEP);
      282     9475        %ERRCODE (NAME=ECPALT,COD#=%E$CPALT);
      283     9483        %ERRCODE (NAME=ENJOBSTEP,COD#=%E$NJOBSTEP);
      284     9491        %ERRCODE (NAME=ELOGOFF,COD#=%E$LOGOFF);
      285     9499        %ERRCODE (NAME=ECYALT,COD#=%E$CYALT);
      286     9507        %ERRCODE (NAME=ENOSTEPS,COD#=%E$NOSTEPS);
      287     9515        %ERRCODE (NAME=EDEBUGSP,COD#=%E$DEBUGSP);
      288     9523        %ERRCODE (NAME=EOPTPMME,COD#=%E$OPTPMME);
      289     9531        %ERRCODE (NAME=ESAVE,COD#=%E$SAVELINK);
      290     9539        %ERRCODE (NAME=ELINK,COD#=%E$XCONLINK);
      291     9547        %ERRCODE (NAME=ESSAVE,COD#=%E$SSAVE);
      292     9555        %ERRCODE (NAME=ESNAPU,COD#=%E$SNAPUSR);
      293     9563        %ERRCODE (NAME=EDFBUSY,COD#=%E$DFBUSY,SEV#=SEV_CONT#);
      294     9571        %ERRCODE (NAME=EBADSSP,COD#=%E$BADSSP);
      295     9579        %ERRCODE (NAME=EXCONRTNE,COD#=%E$XCONRTN);
      296     9587        %ERRCODE (NAME=EXCONRTNA,COD#=%E$XCONRTN,SEV#=SEV_ABORT#);
      297     9595        %ERRCODE (NAME=EOFF,COD#=%E$OFF,SEV#=SEV_ABORT#);
      298     9603        %ERRCODE (NAME=ENOOVRLY,COD#=%E$NOOVRLY,SEV#=SEV_CONT#);
      299     9611        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:87   
      300     9612        /*************************************************************
      301     9613         *                                                           *
      302     9614         *                        M$OLAY                             *
      303     9615         *                                                           *
      304     9616         *************************************************************/
      305     9617
      306     9618    1      WSR=B$SS.ISR.WSR;

   9618  1 000002   000000 470400 xsym               LDP0    B_MPT
         1 000003   000010 236100                    LDQ     8,,PR0
         1 000004   000004 772000                    QRL     4
         1 000005   000007 376007                    ANQ     7,DL
         1 000006   200070 756100                    STQ     WSR,,AUTO

      307     9619
      308     9620    1      CALL UDN$MAGIC;

   9620  1 000007   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000010   000000 701000 xent               TSX1    UDN$MAGIC
         1 000011   000000 011000                    NOP     0

      309     9621    2      DO CASE(CODE);

   9621  1 000012   200003 470500                    LDP0    @CODE,,AUTO
         1 000013   000000 235100                    LDA     0,,PR0
         1 000014   000004 135007                    SBLA    4,DL
         1 000015   000022 115007                    CMPA    18,DL
         1 000016   000020 602005 1                  TNC     s:9621+6,AL
         1 000017   004027 710000 1                  TRA     s:11130
         1 000020   000042 710000 1                  TRA     s:9624
         1 000021   000304 710000 1                  TRA     s:9727
         1 000022   000304 710000 1                  TRA     s:9727
         1 000023   001173 710000 1                  TRA     s:10053
         1 000024   001173 710000 1                  TRA     s:10053
         1 000025   001577 710000 1                  TRA     s:10202
         1 000026   001700 710000 1                  TRA     s:10244
         1 000027   003336 710000 1                  TRA     s:10945
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:88   
         1 000030   004027 710000 1                  TRA     s:11130
         1 000031   004027 710000 1                  TRA     s:11130
         1 000032   004027 710000 1                  TRA     s:11130
         1 000033   000262 710000 1                  TRA     s:9706
         1 000034   000217 710000 1                  TRA     s:9685
         1 000035   003567 710000 1                  TRA     s:11035
         1 000036   003616 710000 1                  TRA     s:11053
         1 000037   000626 710000 1                  TRA     s:9894
         1 000040   000702 710000 1                  TRA     s:9914
         1 000041   001111 710000 1                  TRA     s:10024

      310     9622
      311     9623    2       CASE(%C$OLAY#);

      312     9624    2         IF (S$CU$ -> B$U.CMF > 0) AND (NOT B$JIT.PRIV.ACTIVE & %PR_EXMM#) THEN GOTO
              9624                  NOTOVLAID;

   9624  1 000042   000000 471400 xsym               LDP1    S$CU$
         1 000043   100007 236100                    LDQ     7,,PR1
         1 000044   000077 316007                    CANQ    63,DL
         1 000045   000052 600000 1                  TZE     s:9626
         1 000046   000000 473400 xsym               LDP3    B$JIT$
         1 000047   300013 236100                    LDQ     11,,PR3
         1 000050   000004 376000 xsym               ANQ     B_VECTNIL+4
         1 000051   000101 600000 1                  TZE     NOTOVLAID

      313     9625        /* Wait for master function count to go to zero before proceeding  */
      314     9626    3         DO WHILE (S$CU$->B$U.MF > S$CU$->B$U.CMF);

   9626  1 000052   100006 236100                    LDQ     6,,PR1
         1 000053   000033 772000                    QRL     27
         1 000054   200100 756100                    STQ     USRIC+1,,AUTO
         1 000055   100007 236100                    LDQ     7,,PR1
         1 000056   000077 376007                    ANQ     63,DL
         1 000057   200100 116100                    CMPQ    USRIC+1,,AUTO
         1 000060   000075 605000 1                  TPL     s:9631

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:89   
      315     9627    3              CALL SSR$REG(%SS_QMF);

   9627  1 000061   000000 630400 2                  EPPR0   0
         1 000062   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000063   000000 701000 xent               TSX1    SSR$REG
         1 000064   000000 011000                    NOP     0

      316     9628    3              END;

   9628  1 000065   000000 470400 xsym               LDP0    S$CU$
         1 000066   000006 236100                    LDQ     6,,PR0
         1 000067   000033 772000                    QRL     27
         1 000070   200100 756100                    STQ     USRIC+1,,AUTO
         1 000071   000007 236100                    LDQ     7,,PR0
         1 000072   000077 376007                    ANQ     63,DL
         1 000073   200100 116100                    CMPQ    USRIC+1,,AUTO
         1 000074   000061 604000 1                  TMI     s:9627

      317     9629
      318     9630        /* Check to make sure its really overlaid   */
      319     9631    2         IF B$ROSEG$->B$ROSEG.TREE$ = ADDR(NIL)

   9631  1 000075   000000 470400 xsym               LDP0    B$ROSEG$
         1 000076   000001 236100                    LDQ     1,,PR0
         1 000077   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000100   000105 601000 1                  TNZ     s:9642

      320     9632    3         THEN DO;

      321     9633    3   NOTOVLAID:
      322     9634    3              B$JIT.ERR=ENOOVRLY;

   9634  1 000101   000043 236000 0     NOTOVLAID    LDQ     ENOOVRLY
         1 000102   000000 470400 xsym               LDP0    B$JIT$
         1 000103   000012 756100                    STQ     10,,PR0

      323     9635    3              RETURN;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:90   

   9635  1 000104   000000 702200 xent               TSX2  ! X66_ARET

      324     9636    3              END;
      325     9637        /*E*   ERROR: JSP-E$NOOVRLY-0
      326     9638               MESSAGE:  M$OLAY allowed only in overlaid run-units with no IO.
      327     9639        */
      328     9640
      329     9641        /* Go associate the shared overlay or read it in if unshared */
      330     9642    2         IF S$CU$->B$U.APR ~= 0

   9642  1 000105   000000 471400 xsym               LDP1    S$CU$
         1 000106   100007 236100                    LDQ     7,,PR1
         1 000107   777700 316003                    CANQ    -64,DU
         1 000110   000122 600000 1                  TZE     s:9644

      331     9643    2         THEN CALL JDP$SEGLD(SAVEP.ECCS,ENTRY_ADDR) ALTRET(JIT_SET);

   9643  1 000111   200071 633500                    EPPR3   ENTRY_ADDR,,AUTO
         1 000112   200101 453500                    STP3    USRIC+2,,AUTO
         1 000113   200023 634500                    EPPR4   SAVEP,,AUTO
         1 000114   200100 454500                    STP4    USRIC+1,,AUTO
         1 000115   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 000116   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000117   000000 701000 xent               TSX1    JDP$SEGLD
         1 000120   000616 702000 1                  TSX2    JIT_SET
         1 000121   000134 710000 1                  TRA     s:9649

      332     9644    2        ELSE CALL JDS$OVRLY(SAVEP.ECCS,ENTRY_ADDR,B$PS1$->FPT$OLAY_V) ALTRET(JIT_SET);

   9644  1 000122   000000 236000 xsym               LDQ     B$PS1$
         1 000123   200102 756100                    STQ     USRIC+3,,AUTO
         1 000124   200071 633500                    EPPR3   ENTRY_ADDR,,AUTO
         1 000125   200101 453500                    STP3    USRIC+2,,AUTO
         1 000126   200023 634500                    EPPR4   SAVEP,,AUTO
         1 000127   200100 454500                    STP4    USRIC+1,,AUTO
         1 000130   200100 630500                    EPPR0   USRIC+1,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:91   
         1 000131   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000132   000000 701000 xent               TSX1    JDS$OVRLY
         1 000133   000616 702000 1                  TSX2    JIT_SET

      333     9645        /* Either routine will return with SAVEP.ECCS containing the NODE
      334     9646           number and ENTRY_ADDR set to B$NODE.ENTRY$.
      335     9647        */
      336     9648
      337     9649    2         IF B$JIT.ERR.CODE = 0

   9649  1 000134   000000 470400 xsym               LDP0    B$JIT$
         1 000135   000012 236100                    LDQ     10,,PR0
         1 000136   377770 316007                    CANQ    131064,DL
         1 000137   004033 601000 1                  TNZ     s:11135

      338     9650    3         THEN DO;

      339     9651        /* Do the mucking with B$SS.IC here for in the event that we must
      340     9652           modify it because of the M$OLAY ENTER option, and/or because
      341     9653           we are running under DELTA.
      342     9654        */
      343     9655    3              CALL UDB$CALCOMP;

   9655  1 000140   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000141   000000 701000 xent               TSX1    UDB$CALCOMP
         1 000142   000000 011000                    NOP     0

      344     9656
      345     9657    3              IF B$PS1$->FPT$OLAY_V.FLGS.ENTER='1'B

   9657  1 000143   000000 470400 xsym               LDP0    B$PS1$
         1 000144   000000 236100                    LDQ     0,,PR0
         1 000145   002000 316003                    CANQ    1024,DU
         1 000146   000155 600000 1                  TZE     s:9663

      346     9658    4              THEN DO;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:92   
      347     9659    4                   B$SS.X1 = B$SS.IC;

   9659  1 000147   000000 471400 xsym               LDP1    B_MPT
         1 000150   100004 220100                    LDX0    4,,PR1
         1 000151   100050 440100                    SXL0    40,,PR1

      348     9660    4                   B$SS.IC = ENTRY_ADDR;

   9660  1 000152   200071 721100                    LXL1    ENTRY_ADDR,,AUTO
         1 000153   100004 741100                    STX1    4,,PR1

      349     9661    4                   END;

   9661  1 000154   000163 710000 1                  TRA     s:9667

      350     9662    4              ELSE DO;

      351     9663    4                   IF B$SS.FPT.ALT ~='0'B

   9663  1 000155   000000 471400 xsym               LDP1    B_MPT
         1 000156   100001 234100                    SZN     1,,PR1
         1 000157   000163 605000 1                  TPL     s:9667

      352     9664    4                   THEN B$SS.IC = B$SS.IC+1;

   9664  1 000160   100004 220100                    LDX0    4,,PR1
         1 000161   000001 621010                    EAX1    1,X0
         1 000162   100004 741100                    STX1    4,,PR1

      353     9665    4                   END;

      354     9666
      355     9667    3              IF (B_MPT.ECCBDESC$->B$$DESCR.FLGS & %DSXXX)

   9667  1 000163   000013 473400 xsym               LDP3    B_MPT+11
         1 000164   300000 236100                    LDQ     0,,PR3
         1 000165   000024 736000                    QLS     20
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:93   
         1 000166   777000 376003                    ANQ     -512,DU
         1 000167   020000 376003                    ANQ     8192,DU
         1 000170   000213 600000 1                  TZE     s:9675

      356     9668    4              THEN DO;

      357     9669    4                   DATA1=%ECC_OLAY#;

   9669  1 000171   000133 235007                    LDA     91,DL
         1 000172   200004 755100                    STA     DATA1,,AUTO

      358     9670    4                   SAVEP.EVID=BITBIN(B$PS1$->FPT$OLAY_V.FLGS);

   9670  1 000173   000000 236100                    LDQ     0,,PR0
         1 000174   000033 772000                    QRL     27
         1 000175   200024 756100                    STQ     SAVEP+1,,AUTO

      359     9671    4                   SAVEP.JERR=B$JIT.ERR;

   9671  1 000176   000000 474400 xsym               LDP4    B$JIT$
         1 000177   400012 236100                    LDQ     10,,PR4
         1 000200   200025 756100                    STQ     SAVEP+2,,AUTO

      360     9672    4                   SAVEP.P#=0;

   9672  1 000201   200026 450100                    STZ     SAVEP+3,,AUTO

      361     9673    4                   CALL SSU$DELTAGO (DATA1,SAVEP);

   9673  1 000202   200023 635500                    EPPR5   SAVEP,,AUTO
         1 000203   200101 455500                    STP5    USRIC+2,,AUTO
         1 000204   200004 636500                    EPPR6   DATA1,,AUTO
         1 000205   200100 456500                    STP6    USRIC+1,,AUTO
         1 000206   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 000207   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000210   000000 701000 xent               TSX1    SSU$DELTAGO
         1 000211   000000 011000                    NOP     0
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:94   

      362     9674    4                   END;

   9674  1 000212   004033 710000 1                  TRA     s:11135

      363     9675    3              ELSE CALL UDB$AUTO;

   9675  1 000213   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000214   000000 701000 xent               TSX1    UDB$AUTO
         1 000215   000000 011000                    NOP     0

      364     9676    3              END;                         /*DO IF ERR.CODE = 0                  */

   9676  1 000216   004033 710000 1                  TRA     s:11135

      365     9677        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:95   
      366     9678        /*************************************************************
      367     9679         *                                                           *
      368     9680         *                        M$SCON                             *
      369     9681         *                                                           *
      370     9682         *************************************************************/
      371     9683
      372     9684    2       CASE(%C$SCON#);

      373     9685    2         IF NOT (B$PS0$->FPT$SCON_V.SAVEFLG)

   9685  1 000217   000000 471400 xsym               LDP1    B$PS0$
         1 000220   100000 236100                    LDQ     0,,PR1
         1 000221   200000 316003                    CANQ    65536,DU
         1 000222   000242 601000 1                  TNZ     s:9691

      374     9686    3         THEN DO;

      375     9687    3              IF B$SS.ISR.WSR ~= %CPWSR

   9687  1 000223   000000 473400 xsym               LDP3    B_MPT
         1 000224   300010 236100                    LDQ     8,,PR3
         1 000225   000160 376007                    ANQ     112,DL
         1 000226   000100 116007                    CMPQ    64,DL
         1 000227   000235 600000 1                  TZE     s:9689

      376     9688    3              THEN B$JIT.JUNK = (B$JIT.JUNK | %JJ_NOSAVE#);

   9688  1 000230   000000 474400 xsym               LDP4    B$JIT$
         1 000231   400315 220100                    LDX0    205,,PR4
         1 000232   040000 260003                    ORX0    16384,DU
         1 000233   400315 740100                    STX0    205,,PR4
         1 000234   000253 710000 1                  TRA     s:9694

      377     9689    3              ELSE B$JIT.JUNK2 = (B$JIT.JUNK2 | %JJ2_NOSAVE_CP#);

   9689  1 000235   000000 474400 xsym               LDP4    B$JIT$
         1 000236   400321 220100                    LDX0    209,,PR4
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:96   
         1 000237   000040 260003                    ORX0    32,DU
         1 000240   400321 740100                    STX0    209,,PR4

      378     9690    3              END;

   9690  1 000241   000253 710000 1                  TRA     s:9694

      379     9691    2         ELSE IF B$SS.ISR.WSR = %CPWSR

   9691  1 000242   000000 473400 xsym               LDP3    B_MPT
         1 000243   300010 236100                    LDQ     8,,PR3
         1 000244   000160 376007                    ANQ     112,DL
         1 000245   000100 116007                    CMPQ    64,DL
         1 000246   000253 601000 1                  TNZ     s:9694

      380     9692    2              THEN B$JIT.JUNK2 = (B$JIT.JUNK2 &~ %JJ2_NOSAVE_CP#);

   9692  1 000247   000000 474400 xsym               LDP4    B$JIT$
         1 000250   400321 220100                    LDX0    209,,PR4
         1 000251   777737 360003                    ANX0    -33,DU
         1 000252   400321 740100                    STX0    209,,PR4

      381     9693
      382     9694    2         IF (B$PS0$->FPT$SCON_V.XCON)

   9694  1 000253   100000 234100                    SZN     0,,PR1
         1 000254   004033 605000 1                  TPL     s:11135

      383     9695    2         THEN B$JIT.JUNK = (B$JIT.JUNK | %JJ_SCON#);

   9695  1 000255   000000 474400 xsym               LDP4    B$JIT$
         1 000256   400315 220100                    LDX0    205,,PR4
         1 000257   100000 260003                    ORX0    32768,DU
         1 000260   400315 740100                    STX0    205,,PR4
         1 000261   004033 710000 1                  TRA     s:11135

      384     9696
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:97   
      385     9697
      386     9698        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:98   
      387     9699        /*************************************************************
      388     9700         *                                                           *
      389     9701         *                        M$SAVE                             *
      390     9702         *                                                           *
      391     9703         *************************************************************/
      392     9704
      393     9705    2       CASE(%C$SAVE#);

      394     9706    2         J=4;

   9706  1 000262   000004 236007                    LDQ     4,DL
         1 000263   200007 756100                    STQ     J,,AUTO

      395     9707    2         CALL CHECK_PSTACK ALTRET(FPT_BAD);

   9707  1 000264   004034 701000 1                  TSX1    CHECK_PSTACK
         1 000265   000622 702000 1                  TSX2    FPT_BAD

      396     9708    2         IF P0$=ADDR(NIL)

   9708  1 000266   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 000267   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000270   000275 601000 1                  TNZ     s:9713

      397     9709    3         THEN DO;

      398     9710    3              B$JIT.ERR=EFPT;

   9710  1 000271   000005 236000 0                  LDQ     EFPT
         1 000272   000000 470400 xsym               LDP0    B$JIT$
         1 000273   000012 756100                    STQ     10,,PR0

      399     9711    3              RETURN;

   9711  1 000274   000000 702200 xent               TSX2  ! X66_ARET

      400     9712    3              END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:99   
      401     9713    2         SGFLAG=%SVL_MSAVE#;

   9713  1 000275   004000 236003                    LDQ     2048,DU
         1 000276   200015 756100                    STQ     SGFLAG,,AUTO

      402     9714    2         CALL DO_SAVE(SGFLAG) ALTRET(SAVE_ALTRET);

   9714  1 000277   200015 630500                    EPPR0   SGFLAG,,AUTO
         1 000300   200075 450500                    STP0    CPEXIT_V+3,,AUTO
         1 000301   004352 701000 1                  TSX1    DO_SAVE
         1 000302   000303 702000 1                  TSX2    SAVE_ALTRET

   9713  1 000303                       SAVE_ALTRET  null
      403     9715    2   SAVE_ALTRET: ;
      404     9716    2         RETURN;

   9716  1 000303   000000 702200 xent               TSX2  ! X66_ARET

      405     9717
      406     9718        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:100  
      407     9719        /*************************************************************
      408     9720         *                                                           *
      409     9721         *                        M$LINK                             *
      410     9722         *                        M$LDTRC                            *
      411     9723         *                                                           *
      412     9724         *************************************************************/
      413     9725
      414     9726    2       CASE(%C$LINK#, %C$LDTRC#);

      415     9727    2         IF (B_MPT.ECCB$->B$ECCB.XCONF & '006'O)

   9727  1 000304   000005 471400 xsym               LDP1    B_MPT+5
         1 000305   100004 236100                    LDQ     4,,PR1
         1 000306   000011 736000                    QLS     9
         1 000307   777000 376003                    ANQ     -512,DU
         1 000310   006000 376003                    ANQ     3072,DU
         1 000311   000316 600000 1                  TZE     s:9735

      416     9728    3         THEN DO;

      417     9729    3              B$JIT.ERR=ESAVE;

   9729  1 000312   000032 236000 0                  LDQ     ESAVE
         1 000313   000000 473400 xsym               LDP3    B$JIT$
         1 000314   300012 756100                    STQ     10,,PR3

      418     9730    3              RETURN;

   9730  1 000315   000000 702200 xent               TSX2  ! X66_ARET

      419     9731    3              END;
      420     9732        /*E*   ERROR: JSP-E$SAVELINK-E
      421     9733               MESSAGE: M$LINK or M$LDTRC not allowed during SAVE-GET.
      422     9734        */
      423     9735    2         IF (B_MPT.ECCB$->B$ECCB.XCONF & '140'O)

   9735  1 000316   100004 236100                    LDQ     4,,PR1
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:101  
         1 000317   000011 736000                    QLS     9
         1 000320   777000 376003                    ANQ     -512,DU
         1 000321   140000 376003                    ANQ     49152,DU
         1 000322   000327 600000 1                  TZE     s:9748

      424     9736    3         THEN DO;

      425     9737    3              B$JIT.ERR=ELINK;

   9737  1 000323   000033 236000 0                  LDQ     ELINK
         1 000324   000000 473400 xsym               LDP3    B$JIT$
         1 000325   300012 756100                    STQ     10,,PR3

      426     9738    3              RETURN;

   9738  1 000326   000000 702200 xent               TSX2  ! X66_ARET

      427     9739    3              END;
      428     9740        /*E*   ERROR:   JSP-E$XCONLINK-E
      429     9741               MESSAGE:  M$LINK-M$LDTRC not allowed when XCON Class 2 or 3 in progress.
      430     9742        */
      431     9743
      432     9744        /*  If there are 7 parameters on the Parameter Stack, the user has
      433     9745            passed a C00 FPT.  The V area parameter will indicate if the
      434     9746            command passed (if any) is is TEXT or TEXTC format.
      435     9747        */
      436     9748    2         SAVEP.CMD_DSCR = NIL_DESC;

   9748  1 000327   000002 237000 0                  LDAQ    NIL_DESC
         1 000330   200052 757100                    STAQ    SAVEP+23,,AUTO

      437     9749
      438     9750    2         J = 7 /*check P0 - P6 */;

   9750  1 000331   000007 235007                    LDA     7,DL
         1 000332   200007 755100                    STA     J,,AUTO

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:102  
      439     9751    2         CALL CHECK_PSTACK

   9751  1 000333   004034 701000 1                  TSX1    CHECK_PSTACK
         1 000334   000376 702000 1                  TSX2    s:9776

      440     9752    3         WHENRETURN DO;

      441     9753    3              IF B$PS6$->FPT$LINK_V.TEXTC = '1'B

   9753  1 000335   000000 470400 xsym               LDP0    B$PS6$
         1 000336   000000 234100                    SZN     0,,PR0
         1 000337   000343 605000 1                  TPL     s:9755

      442     9754    3              THEN CMD_TYPE = %CMD_TEXTC;

   9754  1 000340   000001 235007                    LDA     1,DL
         1 000341   200054 755100                    STA     CMD_TYPE,,AUTO
         1 000342   000344 710000 1                  TRA     s:9761

      443     9755    3              ELSE CMD_TYPE = %CMD_TEXT;

   9755  1 000343   200054 450100                    STZ     CMD_TYPE,,AUTO

      444     9756
      445     9757        /*  If the CP_CMD is specified, its descritor is moved to the
      446     9758            parameters in AUTO and all other parameters are marked NIL.
      447     9759            The ECHO parameter specification is moved to CPFLAGS1.
      448     9760        */
      449     9761    3              CALL HFF$NILERASE(5) ALTRET(NOT_CP_CMD);

   9761  1 000344   000001 630400 2                  EPPR0   1
         1 000345   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000346   000000 701000 xent               TSX1    HFF$NILERASE
         1 000347   000404 702000 1                  TSX2    NOT_CP_CMD

      450     9762    3              P0$=ADDR(NIL); P1$=ADDR(NIL); P2$=ADDR(NIL); P3$=ADDR(NIL);

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:103  
   9762  1 000350   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000351   200027 756100                    STQ     SAVEP+4,,AUTO

   9762  1 000352   200030 756100                    STQ     SAVEP+5,,AUTO

   9762  1 000353   200031 756100                    STQ     SAVEP+6,,AUTO

   9762  1 000354   200032 756100                    STQ     SAVEP+7,,AUTO

      451     9763    3              P4$ = B$PS5$;

   9763  1 000355   000000 236000 xsym               LDQ     B$PS5$
         1 000356   200033 756100                    STQ     SAVEP+8,,AUTO

      452     9764    3              SAVEP.CMD_DSCR = B$PSEG.P5;

   9764  1 000357   000003 470400 xsym               LDP0    B_MPT+3
         1 000360   000012 237100                    LDAQ    10,,PR0
         1 000361   200052 757100                    STAQ    SAVEP+23,,AUTO

      453     9765    3              IF B$PS6$->FPT$LINK_V.ECHO = '1'B

   9765  1 000362   000000 471400 xsym               LDP1    B$PS6$
         1 000363   100000 236100                    LDQ     0,,PR1
         1 000364   200000 316003                    CANQ    65536,DU
         1 000365   000372 600000 1                  TZE     s:9767

      454     9766    3              THEN B$JIT.CPFLAGS1.ECHO_LINK = '1'B;

   9766  1 000366   000000 473400 xsym               LDP3    B$JIT$
         1 000367   000200 236003                    LDQ     128,DU
         1 000370   300143 256100                    ORSQ    99,,PR3
         1 000371   000375 710000 1                  TRA     s:9769

      455     9767    3              ELSE B$JIT.CPFLAGS1.ECHO_LINK = '0'B;

   9767  1 000372   000000 473400 xsym               LDP3    B$JIT$
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:104  
         1 000373   000002 236000 2                  LDQ     2
         1 000374   300143 356100                    ANSQ    99,,PR3

      456     9768
      457     9769    3              END;

   9769  1 000375   000415 710000 1                  TRA     s:9790

      458     9770
      459     9771        /*  If less then 7 parameters it must be a pre-C00 FPT.  The command
      460     9772            is therefore in TEXTC format and is not to be scanned by the
      461     9773            command processor.
      462     9774        */
      463     9775    3         WHENALTRETURN DO;

      464     9776    3              CMD_TYPE = %CMD_TEXTC;

   9776  1 000376   000001 235007                    LDA     1,DL
         1 000377   200054 755100                    STA     CMD_TYPE,,AUTO

      465     9777    3              J = 5 /* check P0 - P4*/;

   9777  1 000400   000005 236007                    LDQ     5,DL
         1 000401   200007 756100                    STQ     J,,AUTO

      466     9778    3              CALL CHECK_PSTACK ALTRET(FPT_BAD);

   9778  1 000402   004034 701000 1                  TSX1    CHECK_PSTACK
         1 000403   000622 702000 1                  TSX2    FPT_BAD

   9777  1 000404                       NOT_CP_CMD   null
      467     9779
      468     9780    3   NOT_CP_CMD: ;
      469     9781    3              IF P0$ = ADDR(NIL) THEN GOTO FPT_BAD;

   9781  1 000404   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 000405   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:105  
         1 000406   000622 600000 1                  TZE     FPT_BAD

      470     9782
      471     9783    3              IF P4$ ~= ADDR(NIL)

   9783  1 000407   200033 236100                    LDQ     SAVEP+8,,AUTO
         1 000410   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000411   000415 600000 1                  TZE     s:9790

      472     9784    3              THEN SAVEP.CMD_DSCR = B$PSEG.P4;

   9784  1 000412   000003 470400 xsym               LDP0    B_MPT+3
         1 000413   000010 237100                    LDAQ    8,,PR0
         1 000414   200052 757100                    STAQ    SAVEP+23,,AUTO

      473     9785    3              END;

      474     9786
      475     9787        /*  If the user gave us a TEXTC descriptor, modify the descriptor
      476     9788            squirrled away in auto to make it a TEXT descriptor.
      477     9789        */
      478     9790    2         IF P4$ ~= ADDR(NIL)

   9790  1 000415   200033 236100                    LDQ     SAVEP+8,,AUTO
         1 000416   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000417   000460 600000 1                  TZE     s:9830

      479     9791    3         THEN DO;

      480     9792    3              IF CMD_TYPE = %CMD_TEXTC

   9792  1 000420   200054 235100                    LDA     CMD_TYPE,,AUTO
         1 000421   000001 115007                    CMPA    1,DL
         1 000422   000443 601000 1                  TNZ     s:9803

      481     9793    4              THEN DO;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:106  
      482     9794    4                   CMD_SZ = P4$ ->TEXTC.SIZ;

   9794  1 000423   200033 470500                    LDP0    SAVEP+8,,AUTO
         1 000424   000100 101500                    MRL     fill='000'O
         1 000425   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         1 000426   200055 000004                    ADSC9   CMD_SZ,,AUTO             cn=0,n=4

      483     9795    4                   IF CMD_SZ > SAVEP.CMD_DSCR.BOUND

   9795  1 000427   200052 236100                    LDQ     SAVEP+23,,AUTO
         1 000430   000020 772000                    QRL     16
         1 000431   200055 116100                    CMPQ    CMD_SZ,,AUTO
         1 000432   000452 602000 1                  TNC     BAD_CMD

      484     9796    4                   THEN GOTO BAD_CMD;
      485     9797
      486     9798    4                   SAVEP.CMD_DSCR.BASE = SAVEP.CMD_DSCR.BASE+1;

   9798  1 000433   200053 054100                    AOS     SAVEP+24,,AUTO

      487     9799    4                   SAVEP.CMD_DSCR.BOUND = CMD_SZ -1;

   9799  1 000434   200055 236100                    LDQ     CMD_SZ,,AUTO
         1 000435   000001 136007                    SBLQ    1,DL
         1 000436   000020 736000                    QLS     16
         1 000437   200052 676100                    ERQ     SAVEP+23,,AUTO
         1 000440   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 000441   200052 656100                    ERSQ    SAVEP+23,,AUTO

      488     9800    4                   END;

   9800  1 000442   000447 710000 1                  TRA     s:9806

      489     9801
      490     9802    4              ELSE DO;

      491     9803    4                   CMD_SZ = SAVEP.CMD_DSCR.BOUND +1;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:107  

   9803  1 000443   200052 236100                    LDQ     SAVEP+23,,AUTO
         1 000444   000020 772000                    QRL     16
         1 000445   000001 036007                    ADLQ    1,DL
         1 000446   200055 756100                    STQ     CMD_SZ,,AUTO

      492     9804    4                   END;

      493     9805
      494     9806    3              IF CMD_SZ > SIZEC(B$JIT.CCBUF)

   9806  1 000447   200055 236100                    LDQ     CMD_SZ,,AUTO
         1 000450   000401 116007                    CMPQ    257,DL
         1 000451   000456 602000 1                  TNC     s:9813

      495     9807    4              THEN DO;

   9799  1 000452                       BAD_CMD      null
      496     9808    4   BAD_CMD:        ;
      497     9809    4                   B$JIT.ERR = EFPT5;

   9809  1 000452   000013 236000 0                  LDQ     EFPT5
         1 000453   000000 470400 xsym               LDP0    B$JIT$
         1 000454   000012 756100                    STQ     10,,PR0

      498     9810    4                   RETURN;

   9810  1 000455   000000 702200 xent               TSX2  ! X66_ARET

      499     9811    4                   END;
      500     9812
      501     9813    3              P4$ = ADDR(SAVEP.CMD_DSCR);

   9813  1 000456   200052 630500                    EPPR0   SAVEP+23,,AUTO
         1 000457   200033 450500                    STP0    SAVEP+8,,AUTO

      502     9814    3              END /* do if P4$ not NIL */;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:108  

      503     9815
      504     9816        /*E* ERROR: JSP-E$BADVECT5-E
      505     9817             MESSAGE: The CMD parameter of M$LINK or M$LDTRC is bad.
      506     9818             MESSAGE1: Either the length byte of a TEXTC command is larger than
      507     9819                       the vector framing the command or the command itself is
      508     9820                       larger than B$JIT.CCBUF.
      509     9821             MESSAGE7: The CMD parameter of M$LINK or M$LDTRC is bad.
      510     9822        */
      511     9823
      512     9824        /*  Mark calcomp now as we are going off to the sunset, never to return.
      513     9825            This also marks B$SS. FPT.fpt_check so any traps now mean SUA.
      514     9826
      515     9827            If this is M$LINK, do it now - no entry to exit control or
      516     9828            entry to DELTA until we get to the called run unit.
      517     9829        */
      518     9830    2         CALL UDB$CALCOMP;

   9830  1 000460   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000461   000000 701000 xent               TSX1    UDB$CALCOMP
         1 000462   000000 011000                    NOP     0

      519     9831    2         IF CODE=%C$LINK#

   9831  1 000463   200003 470500                    LDP0    @CODE,,AUTO
         1 000464   000000 235100                    LDA     0,,PR0
         1 000465   000005 115007                    CMPA    5,DL
         1 000466   000506 601000 1                  TNZ     s:9840

      520     9832    3         THEN DO;

      521     9833    3              CALL JLL$LINK(P0$,P1$,P2$,P3$,P4$) ALTRET(JIT_SET);

   9833  1 000467   200033 631500                    EPPR1   SAVEP+8,,AUTO
         1 000470   200104 451500                    STP1    USRIC+5,,AUTO
         1 000471   200032 633500                    EPPR3   SAVEP+7,,AUTO
         1 000472   200103 453500                    STP3    USRIC+4,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:109  
         1 000473   200031 634500                    EPPR4   SAVEP+6,,AUTO
         1 000474   200102 454500                    STP4    USRIC+3,,AUTO
         1 000475   200030 635500                    EPPR5   SAVEP+5,,AUTO
         1 000476   200101 455500                    STP5    USRIC+2,,AUTO
         1 000477   200027 636500                    EPPR6   SAVEP+4,,AUTO
         1 000500   200100 456500                    STP6    USRIC+1,,AUTO
         1 000501   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 000502   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000503   000000 701000 xent               TSX1    JLL$LINK
         1 000504   000616 702000 1                  TSX2    JIT_SET

      522     9834    3              END;

   9834  1 000505   000616 710000 1                  TRA     JIT_SET

      523     9835
      524     9836        /* If M$LDTRC, and the user is not associated with a debugger or ASL,
      525     9837           and the user does not have XCON, also do the LDTRC now.
      526     9838        */
      527     9839    3         ELSE DO;

      528     9840    3              B$SS.IC=B$SS.IC-2;

   9840  1 000506   000000 471400 xsym               LDP1    B_MPT
         1 000507   100004 220100                    LDX0    4,,PR1
         1 000510   777776 621010                    EAX1    -2,X0
         1 000511   100004 741100                    STX1    4,,PR1

      529     9841    3              IF (B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET ='0'B)

   9841  1 000512   000005 473400 xsym               LDP3    B_MPT+5
         1 000513   300004 236100                    LDQ     4,,PR3
         1 000514   040000 316003                    CANQ    16384,DU
         1 000515   000542 601000 1                  TNZ     s:9850
         1 000516   000000 474400 xsym               LDP4    S$CU$
         1 000517   400006 236100                    LDQ     6,,PR4
         1 000520   000777 316007                    CANQ    511,DL
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:110  
         1 000521   000542 601000 1                  TNZ     s:9850
         1 000522   777000 316007                    CANQ    -512,DL
         1 000523   000542 601000 1                  TNZ     s:9850

      530     9842    3                AND (S$CU$->B$U.ASL=0)
      531     9843    3                AND (S$CU$->B$U.DB=0)
      532     9844    4              THEN DO;

      533     9845    4                   CALL JLL$LDTRC(P0$,P1$,P2$,P3$,P4$) ALTRET(JIT_SET);

   9845  1 000524   200033 635500                    EPPR5   SAVEP+8,,AUTO
         1 000525   200104 455500                    STP5    USRIC+5,,AUTO
         1 000526   200032 636500                    EPPR6   SAVEP+7,,AUTO
         1 000527   200103 456500                    STP6    USRIC+4,,AUTO
         1 000530   200031 637500                    EPPR7   SAVEP+6,,AUTO
         1 000531   200102 457500                    STP7    USRIC+3,,AUTO
         1 000532   200030 630500                    EPPR0   SAVEP+5,,AUTO
         1 000533   200101 450500                    STP0    USRIC+2,,AUTO
         1 000534   200027 630500                    EPPR0   SAVEP+4,,AUTO
         1 000535   200100 450500                    STP0    USRIC+1,,AUTO
         1 000536   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 000537   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000540   000000 701000 xent               TSX1    JLL$LDTRC
         1 000541   000616 702000 1                  TSX2    JIT_SET

      534     9846    4                   END;

      535     9847
      536     9848        /* Complete initialization of the TCB frame for SVLDT.
      537     9849        */
      538     9850    3              B$JIT.SVLDTF=%SVL_LDTRC#;

   9850  1 000542   000000 470400 xsym               LDP0    B$JIT$
         1 000543   000010 236007                    LDQ     8,DL
         1 000544   000316 552104                    STBQ    206,'04'O,PR0

      539     9851    3              SAVEP.ECCS = 0;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:111  

   9851  1 000545   200023 450100                    STZ     SAVEP,,AUTO

      540     9852    3              SAVEP.P# = SIZEW(SAVEP) - POFFW(ADDR(P0$) , ADDR(SAVEP));

   9852  1 000546   200100 452500                    STP2    USRIC+1,,AUTO
         1 000547   200100 236100                    LDQ     USRIC+1,,AUTO
         1 000550   000023 036003                    ADLQ    19,DU
         1 000551   000022 772000                    QRL     18
         1 000552   200101 452500                    STP2    USRIC+2,,AUTO
         1 000553   200102 756100                    STQ     USRIC+3,,AUTO
         1 000554   200101 236100                    LDQ     USRIC+2,,AUTO
         1 000555   000027 036003                    ADLQ    23,DU
         1 000556   000022 772000                    QRL     18
         1 000557   200102 136100                    SBLQ    USRIC+3,,AUTO
         1 000560   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 000561   000032 036007                    ADLQ    26,DL
         1 000562   200026 756100                    STQ     SAVEP+3,,AUTO

      541     9853
      542     9854        /* If the user has exit control or is running under DELTA,
      543     9855           build an XCON frame on the user's or DELTA TCB.
      544     9856        */
      545     9857    3              IF (B_MPT.ECCBDESC$->B$$DESCR.FLGS & %DSXXX)

   9857  1 000563   000013 471400 xsym               LDP1    B_MPT+11
         1 000564   100000 236100                    LDQ     0,,PR1
         1 000565   000024 736000                    QLS     20
         1 000566   777000 376003                    ANQ     -512,DU
         1 000567   020000 376003                    ANQ     8192,DU
         1 000570   000575 601000 1                  TNZ     s:9860
         1 000571   000005 473400 xsym               LDP3    B_MPT+5
         1 000572   300004 236100                    LDQ     4,,PR3
         1 000573   040000 316003                    CANQ    16384,DU
         1 000574   000610 600000 1                  TZE     s:9870

      546     9858    3                OR (B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET='1'B)
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:112  
      547     9859    4              THEN DO;

      548     9860    4                   CALL JSX$XCONSAVE(SAVEP);

   9860  1 000575   200023 633500                    EPPR3   SAVEP,,AUTO
         1 000576   200100 453500                    STP3    USRIC+1,,AUTO
         1 000577   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 000600   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000601   000000 701000 xent               TSX1    JSX$XCONSAVE
         1 000602   000000 011000                    NOP     0

      549     9861    4                   B$SS.IC=B$SS.IC+2;

   9861  1 000603   000000 470400 xsym               LDP0    B_MPT
         1 000604   000004 220100                    LDX0    4,,PR0
         1 000605   000002 621010                    EAX1    2,X0
         1 000606   000004 741100                    STX1    4,,PR0

      550     9862    4                   RETURN;                 /* Err has been set to E$NOROOM       */

   9862  1 000607   000000 702200 xent               TSX2  ! X66_ARET

      551     9863    4                   END;
      552     9864
      553     9865        /* If the user is associated with as ASL, build a SVLDT
      554     9866           frame on the user TCB.  The LDTRC will occur after the
      555     9867           ASL has had a shot at exit control.
      556     9868        */
      557     9869    4              ELSE DO;

      558     9870    4                   CALL JSX$SVLDTXCON(SAVEP);

   9870  1 000610   200023 634500                    EPPR4   SAVEP,,AUTO
         1 000611   200100 454500                    STP4    USRIC+1,,AUTO
         1 000612   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 000613   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000614   000000 701000 xent               TSX1    JSX$SVLDTXCON
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:113  
         1 000615   000000 011000                    NOP     0

      559     9871    4                   END;

      560     9872    3              END;                         /*DO IF LDTRC                         */

   9861  1 000616                       JIT_SET      null
      561     9873    2   JIT_SET: ;
      562     9874    2         B$JIT.SVLDTF='000'O;

   9874  1 000616   000000 470400 xsym               LDP0    B$JIT$
         1 000617   000000 236003                    LDQ     0,DU
         1 000620   000316 552104                    STBQ    206,'04'O,PR0

      563     9875    2         RETURN;

   9875  1 000621   000000 702200 xent               TSX2  ! X66_ARET

   9874  1 000622                       FPT_BAD      null
      564     9876                                                /**/
      565     9877    2   FPT_BAD: ;
      566     9878    2         B$JIT.ERR=EFPT;

   9878  1 000622   000005 236000 0                  LDQ     EFPT
         1 000623   000000 470400 xsym               LDP0    B$JIT$
         1 000624   000012 756100                    STQ     10,,PR0

      567     9879    2         RETURN;

   9879  1 000625   000000 702200 xent               TSX2  ! X66_ARET

      568     9880        /*E*     ERROR: JSP-E$BADVECT0-E
      569     9881                 MESSAGE: FPT Vector 0 must not be null for that Service Request.
      570     9882                 MESSAGE1: One of the following Service Requests was issued with
      571     9883                              required Vector 0 set to the ADDR(NIL) :
      572     9884                                M$LINK - M$LDTRC - M$SAVE - M$YC
      573     9885        */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:114  
      574     9886        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:115  
      575     9887        /*************************************************************
      576     9888         *                                                           *
      577     9889         *                        M$PROCNAME                         *
      578     9890         *                                                           *
      579     9891         *************************************************************/
      580     9892
      581     9893    2       CASE(%C$PROCNAME#);

      582     9894    2         PNUM=S$CU$->B$U.APR;

   9894  1 000626   000000 471400 xsym               LDP1    S$CU$
         1 000627   100007 236100                    LDQ     7,,PR1
         1 000630   000030 772000                    QRL     24
         1 000631   200013 756100                    STQ     PNUM,,AUTO

      583     9895    2         CALL MVPROC (B$PS0$);

   9895  1 000632   000003 236000 2                  LDQ     3
         1 000633   200075 756100                    STQ     CPEXIT_V+3,,AUTO
         1 000634   004610 701000 1                  TSX1    MVPROC
         1 000635   000000 011000                    NOP     0

      584     9896    2         PNUM=S$CU$->B$U.ASP;

   9896  1 000636   000000 470400 xsym               LDP0    S$CU$
         1 000637   000007 236100                    LDQ     7,,PR0
         1 000640   000006 772000                    QRL     6
         1 000641   000077 376007                    ANQ     63,DL
         1 000642   200013 756100                    STQ     PNUM,,AUTO

      585     9897    2         CALL MVPROC (B$PS1$);

   9897  1 000643   000004 236000 2                  LDQ     4
         1 000644   200075 756100                    STQ     CPEXIT_V+3,,AUTO
         1 000645   004610 701000 1                  TSX1    MVPROC
         1 000646   000000 011000                    NOP     0

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:116  
      586     9898    2         PNUM=S$CU$->B$U.ASL;

   9898  1 000647   000000 470400 xsym               LDP0    S$CU$
         1 000650   000006 236100                    LDQ     6,,PR0
         1 000651   000777 376007                    ANQ     511,DL
         1 000652   200013 756100                    STQ     PNUM,,AUTO

      587     9899    2         CALL MVPROC (B$PS2$);

   9899  1 000653   000005 236000 2                  LDQ     5
         1 000654   200075 756100                    STQ     CPEXIT_V+3,,AUTO
         1 000655   004610 701000 1                  TSX1    MVPROC
         1 000656   000000 011000                    NOP     0

      588     9900    2         PNUM=S$CU$->B$U.DB;

   9900  1 000657   000000 470400 xsym               LDP0    S$CU$
         1 000660   000006 236100                    LDQ     6,,PR0
         1 000661   000011 772000                    QRL     9
         1 000662   000777 376007                    ANQ     511,DL
         1 000663   200013 756100                    STQ     PNUM,,AUTO

      589     9901    2         CALL MVPROC (B$PS3$);

   9901  1 000664   000006 236000 2                  LDQ     6
         1 000665   200075 756100                    STQ     CPEXIT_V+3,,AUTO
         1 000666   004610 701000 1                  TSX1    MVPROC
         1 000667   000000 011000                    NOP     0

      590     9902    2         PNUM=S$CU$->B$U.ACP;

   9902  1 000670   000000 470400 xsym               LDP0    S$CU$
         1 000671   000006 236100                    LDQ     6,,PR0
         1 000672   000022 772000                    QRL     18
         1 000673   000777 376007                    ANQ     511,DL
         1 000674   200013 756100                    STQ     PNUM,,AUTO

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:117  
      591     9903    2         CALL MVPROC (B$PS4$);

   9903  1 000675   000007 236000 2                  LDQ     7
         1 000676   200075 756100                    STQ     CPEXIT_V+3,,AUTO
         1 000677   004610 701000 1                  TSX1    MVPROC
         1 000700   000000 011000                    NOP     0

      592     9904    2         RETURN;

   9904  1 000701   000000 702200 xent               TSX2  ! X66_ARET

      593     9905        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:118  
      594     9906        /*************************************************************
      595     9907         *                                                           *
      596     9908         *                        M$FINDPROC                         *
      597     9909         *                                                           *
      598     9910         *************************************************************/
      599     9911
      600     9912
      601     9913    2       CASE(%C$FINDPROC#);

      602     9914    2         PNUM = 0;

   9914  1 000702   200013 450100                    STZ     PNUM,,AUTO

      603     9915    2         PTYPE = '0'B;

   9915  1 000703   000000 220003                    LDX0    0,DU
         1 000704   200014 740100                    STX0    PTYPE,,AUTO

      604     9916
      605     9917    2         IF B$PS0$ -> B$PTYPE_MLINK.MLINK

   9917  1 000705   000000 471400 xsym               LDP1    B$PS0$
         1 000706   100000 236100                    LDQ     0,,PR1
         1 000707   400000 316007                    CANQ    -131072,DL
         1 000710   000721 600000 1                  TZE     s:9931

      606     9918    3         THEN DO;

      607     9919    3              CALL JLL$LOCATE

   9919  1 000711   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000712   000000 701000 xent               TSX1    JLL$LOCATE
         1 000713   000715 702000 1                  TSX2    s:9922

      608     9920    4              WHENRETURN DO; RETURN; END;

   9920  1 000714   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:119  

      609     9921    4              WHENALTRETURN DO;

      610     9922    4                   B$JIT.ERR = ENOPROC;

   9922  1 000715   000012 236000 0                  LDQ     ENOPROC
         1 000716   000000 470400 xsym               LDP0    B$JIT$
         1 000717   000012 756100                    STQ     10,,PR0

      611     9923    4                   RETURN;

   9923  1 000720   000000 702200 xent               TSX2  ! X66_ARET

      612     9924    4                   END;
      613     9925    3              END;
      614     9926
      615     9927        /*    If there is not a valid name specified by the NAME parameter,
      616     9928              this is a request to return the name of the processor as
      617     9929              specified by the PNUM parameter.
      618     9930        */
      619     9931    2         IF B$PS1$->TEXTC.SIZ = 0

   9931  1 000721   000000 473400 xsym               LDP3    B$PS1$
         1 000722   000100 101500                    MRL     fill='000'O
         1 000723   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 000724   200100 000004                    ADSC9   USRIC+1,,AUTO            cn=0,n=4
         1 000725   200100 236100                    LDQ     USRIC+1,,AUTO
         1 000726   000000 116003                    CMPQ    0,DU
         1 000727   000763 601000 1                  TNZ     s:9956

      620     9932    3         THEN DO;

      621     9933    3              CALL HFF$NILERASE(3)

   9933  1 000730   000000 630400 2                  EPPR0   0
         1 000731   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000732   000000 701000 xent               TSX1    HFF$NILERASE
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:120  
         1 000733   000747 702000 1                  TSX2    BAD_PNUM

      622     9934    4              WHENRETURN DO;

      623     9935    4                   PNUM = B$PS3$->B$PNUM;

   9935  1 000734   000000 470400 xsym               LDP0    B$PS3$
         1 000735   000000 236100                    LDQ     0,,PR0
         1 000736   000033 772000                    QRL     27
         1 000737   200013 756100                    STQ     PNUM,,AUTO

      624     9936    4                   IF (PNUM > P_LAST_AUTO) OR (PNUM = 0) THEN GOTO BAD_PNUM;

   9936  1 000740   000744 604000 1                  TMI     s:9936+4
         1 000741   000000 116000 xsym               CMPQ    P_LAST_AUTO
         1 000742   000744 600000 1                  TZE     s:9936+4
         1 000743   000747 603000 1                  TRC     BAD_PNUM
         1 000744   000000 116003                    CMPQ    0,DU
         1 000745   000747 600000 1                  TZE     BAD_PNUM

      625     9937    4                   END;

   9937  1 000746   000752 710000 1                  TRA     s:9943

      626     9938
      627     9939    4              WHENALTRETURN DO;

   9936  1 000747                       BAD_PNUM     null
      628     9940    4   BAD_PNUM:       ;
      629     9941    4                   B$JIT.ERR = EBADVECT3;

   9941  1 000747   000010 236000 0                  LDQ     EBADVECT3
         1 000750   000000 470400 xsym               LDP0    B$JIT$
         1 000751   000012 756100                    STQ     10,,PR0

      630     9942    4                   END;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:121  
      631     9943    3              CALL MVPROC(B$PS1$);

   9943  1 000752   000004 236000 2                  LDQ     4
         1 000753   200075 756100                    STQ     CPEXIT_V+3,,AUTO
         1 000754   004610 701000 1                  TSX1    MVPROC
         1 000755   000000 011000                    NOP     0

      632     9944    3              CALL MVACCT(B$PS4$);

   9944  1 000756   000007 236000 2                  LDQ     7
         1 000757   200075 756100                    STQ     CPEXIT_V+3,,AUTO
         1 000760   004613 701000 1                  TSX1    MVACCT
         1 000761   000000 011000                    NOP     0

      633     9945    3              GOTO NO_PNUM;

   9945  1 000762   001065 710000 1                  TRA     NO_PNUM

      634     9946    3              END;
      635     9947
      636     9948        /*E* ERROR: JSP-E$BADVECT3-E
      637     9949             MESSAGE: The processor number specified on M$FINDPROC is bad.
      638     9950        */
      639     9951
      640     9952        /*    If the NAME parameter was specified, verify a valid length
      641     9953              was also specified.
      642     9954        */
      643     9955    3         ELSE DO;

      644     9956    3              IF B$PS1$->TEXTC.SIZ > 31

   9956  1 000763   000100 101500                    MRL     fill='000'O
         1 000764   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 000765   200100 000004                    ADSC9   USRIC+1,,AUTO            cn=0,n=4
         1 000766   200100 236100                    LDQ     USRIC+1,,AUTO
         1 000767   000040 116007                    CMPQ    32,DL
         1 000770   000775 604000 1                  TMI     s:9962
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:122  

      645     9957    4              THEN DO;

      646     9958    4                   B$JIT.ERR = EBADVECT1;

   9958  1 000771   000006 236000 0                  LDQ     EBADVECT1
         1 000772   000000 474400 xsym               LDP4    B$JIT$
         1 000773   400012 756100                    STQ     10,,PR4

      647     9959    4                   GOTO SET_PNUM;

   9959  1 000774   001055 710000 1                  TRA     SET_PNUM

      648     9960    4                   END;
      649     9961
      650     9962    3              T1$ = J_SYS$;

   9962  1 000775   000000 236000 xsym               LDQ     J_SYS$
         1 000776   200010 756100                    STQ     T1$,,AUTO

      651     9963    3              CALL HFF$NILERASE(4) ALTRET(NO_ACCT);

   9963  1 000777   000010 630400 2                  EPPR0   8
         1 001000   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001001   000000 701000 xent               TSX1    HFF$NILERASE
         1 001002   001005 702000 1                  TSX2    NO_ACCT

      652     9964    3              T1$ = B$PS4$;

   9964  1 001003   000000 236000 xsym               LDQ     B$PS4$
         1 001004   200010 756100                    STQ     T1$,,AUTO

   9964  1 001005                       NO_ACCT      null
      653     9965    3   NO_ACCT:   ;
      654     9966
      655     9967
      656     9968        /*    The JSA$FINDSSP routine is called to find the processor in the
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:123  
      657     9969              processor tables and to return its type.
      658     9970        */
      659     9971    3              CALL JSA$FINDSSP (B$PS1$,T1$,PNUM,PTYPE,B$JIT.ERR)

   9971  1 001005   000000 236000 xsym               LDQ     B$JIT$
         1 001006   000012 036003                    ADLQ    10,DU
         1 001007   200104 756100                    STQ     USRIC+5,,AUTO
         1 001010   200014 630500                    EPPR0   PTYPE,,AUTO
         1 001011   200103 450500                    STP0    USRIC+4,,AUTO
         1 001012   200013 631500                    EPPR1   PNUM,,AUTO
         1 001013   200102 451500                    STP1    USRIC+3,,AUTO
         1 001014   200010 633500                    EPPR3   T1$,,AUTO
         1 001015   200101 453500                    STP3    USRIC+2,,AUTO
         1 001016   000004 236000 2                  LDQ     4
         1 001017   200100 756100                    STQ     USRIC+1,,AUTO
         1 001020   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001021   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001022   000000 701000 xent               TSX1    JSA$FINDSSP
         1 001023   001025 702000 1                  TSX2    s:9973
         1 001024   001055 710000 1                  TRA     SET_PNUM

      660     9972    4              WHENALTRETURN DO;

      661     9973    4                   B$JIT.ERR = '0'B;

   9973  1 001025   000000 470400 xsym               LDP0    B$JIT$
         1 001026   000012 450100                    STZ     10,,PR0

      662     9974    4                   PTYPE = %P_SP#;

   9974  1 001027   040000 220003                    LDX0    16384,DU
         1 001030   200014 740100                    STX0    PTYPE,,AUTO

      663     9975    4                   CALL JSA$FINDAUTO(B$PS1$,T1$,PNUM)

   9975  1 001031   200013 631500                    EPPR1   PNUM,,AUTO
         1 001032   200102 451500                    STP1    USRIC+3,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:124  
         1 001033   200010 633500                    EPPR3   T1$,,AUTO
         1 001034   200101 453500                    STP3    USRIC+2,,AUTO
         1 001035   000004 236000 2                  LDQ     4
         1 001036   200100 756100                    STQ     USRIC+1,,AUTO
         1 001037   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001040   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001041   000000 701000 xent               TSX1    JSA$FINDAUTO
         1 001042   001044 702000 1                  TSX2    s:9977
         1 001043   001051 710000 1                  TRA     s:9981

      664     9976    5                   WHENALTRETURN DO;

      665     9977    5                        B$JIT.ERR = ENOPROC;

   9977  1 001044   000012 236000 0                  LDQ     ENOPROC
         1 001045   000000 470400 xsym               LDP0    B$JIT$
         1 001046   000012 756100                    STQ     10,,PR0

      666     9978    5                        PTYPE = '000000'O;

   9978  1 001047   000000 220003                    LDX0    0,DU
         1 001050   200014 740100                    STX0    PTYPE,,AUTO

      667     9979    5                        END;

      668     9980                        %UNLOCK (G=J_PLOCK);

   9981  1 001051   000011 630400 2                  EPPR0   9
         1 001052   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001053   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001054   000000 011000                    NOP     0

      669     9983    4                   END;

      670     9984    3              END;

   9974  1 001055                       SET_PNUM     null
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:125  
      671     9985
      672     9986        /*    Return the processor number if the PNUM parameter is not NIL
      673     9987              and is writeable.
      674     9988        */
      675     9989    2   SET_PNUM: ;
      676     9990    2         CALL HFF$WRITE(3) ALTRET(NO_PNUM);

   9990  1 001055   000000 630400 2                  EPPR0   0
         1 001056   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001057   000000 701000 xent               TSX1    HFF$WRITE
         1 001060   001065 702000 1                  TSX2    NO_PNUM

      677     9991    2         B$PS3$->B$PNUM = PNUM;

   9991  1 001061   000000 470400 xsym               LDP0    B$PS3$
         1 001062   200013 236100                    LDQ     PNUM,,AUTO
         1 001063   000033 736000                    QLS     27
         1 001064   000000 552140                    STBQ    0,'40'O,PR0

   9991  1 001065                       NO_PNUM      null
      678     9992    2   NO_PNUM: ;
      679     9993
      680     9994        /*    Return the processor type if the RTYPE parameter is not NIL.
      681     9995        */
      682     9996    2         CALL HFF$NILERASE(2) ALTRET(NO_RTYPE);

   9996  1 001065   000012 630400 2                  EPPR0   10
         1 001066   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001067   000000 701000 xent               TSX1    HFF$NILERASE
         1 001070   001074 702000 1                  TSX2    NO_RTYPE

      683     9997    2         B$PS2$->B$PTYPE = PTYPE;

   9997  1 001071   200014 220100                    LDX0    PTYPE,,AUTO
         1 001072   000000 470400 xsym               LDP0    B$PS2$
         1 001073   000000 740100                    STX0    0,,PR0

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:126  
   9997  1 001074                       NO_RTYPE     null
      684     9998    2   NO_RTYPE: ;
      685     9999
      686    10000        /*    Validate the processor type if the user asked us to do so.
      687    10001        */
      688    10002    2         IF (B$JIT.ERR.CODE = 0) AND (B$PS0$->B$PTYPE)

  10002  1 001074   000000 470400 xsym               LDP0    B$JIT$
         1 001075   000012 236100                    LDQ     10,,PR0
         1 001076   377770 316007                    CANQ    131064,DL
         1 001077   001110 601000 1                  TNZ     s:10012
         1 001100   000000 471400 xsym               LDP1    B$PS0$
         1 001101   100000 220100                    LDX0    0,,PR1
         1 001102   001110 600000 1                  TZE     s:10012

      689    10003    3         THEN DO;

      690    10004    3              IF NOT(PTYPE & B$PS0$->B$PTYPE)

  10004  1 001103   200014 221100                    LDX1    PTYPE,,AUTO
         1 001104   100000 361100                    ANX1    0,,PR1
         1 001105   001110 601000 1                  TNZ     s:10012

      691    10005    3              THEN B$JIT.ERR = EWRONGTYPE;

  10005  1 001106   000011 236000 0                  LDQ     EWRONGTYPE
         1 001107   000012 756100                    STQ     10,,PR0

      692    10006    3              END;

      693    10007
      694    10008        /*E* ERROR: JSP-E$WRONGTYPE-E
      695    10009             MESSAGE: The processor is not of the type specified by M$FINDPROC PTYPE.
      696    10010        */
      697    10011
      698    10012    2         RETURN;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:127  
  10012  1 001110   000000 702200 xent               TSX2  ! X66_ARET

      699    10013
      700    10014        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:128  
      701    10015        /*************************************************************
      702    10016         *                                                           *
      703    10017         *                        M$UNSHARE                          *
      704    10018         *                                                           *
      705    10019         *************************************************************/
      706    10020
      707    10021
      708    10022    2       CASE(%C$UNSHARE#);

      709    10023
      710    10024    2         IF B$PS0$ -> FPT$UNSHARE_V.FLGS.PROG AND S$CU$->B$U.APR ~= 0

  10024  1 001111   000000 471400 xsym               LDP1    B$PS0$
         1 001112   100000 236100                    LDQ     0,,PR1
         1 001113   002000 316003                    CANQ    1024,DU
         1 001114   001144 600000 1                  TZE     s:10033
         1 001115   000000 473400 xsym               LDP3    S$CU$
         1 001116   300007 236100                    LDQ     7,,PR3
         1 001117   777700 316003                    CANQ    -64,DU
         1 001120   001144 600000 1                  TZE     s:10033

      711    10025    3         THEN DO;

      712    10026    3              PNUM=S$CU$->B$U.APR;

  10026  1 001121   300007 236100                    LDQ     7,,PR3
         1 001122   000030 772000                    QRL     24
         1 001123   200013 756100                    STQ     PNUM,,AUTO

      713    10027    3              I = S$CU$->B$U.APO;

  10027  1 001124   300007 236100                    LDQ     7,,PR3
         1 001125   000014 772000                    QRL     12
         1 001126   007777 376007                    ANQ     4095,DL
         1 001127   200006 756100                    STQ     I,,AUTO

      714    10028    3              CALL JSA$UNSHARE(PNUM,I) ALTRET(BAD_SHARE);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:129  

  10028  1 001130   200006 634500                    EPPR4   I,,AUTO
         1 001131   200101 454500                    STP4    USRIC+2,,AUTO
         1 001132   200013 635500                    EPPR5   PNUM,,AUTO
         1 001133   200100 455500                    STP5    USRIC+1,,AUTO
         1 001134   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001135   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001136   000000 701000 xent               TSX1    JSA$UNSHARE
         1 001137   001172 702000 1                  TSX2    BAD_SHARE

      715    10029    3              S$CU$->B$U.APO = 0;

  10029  1 001140   000000 470400 xsym               LDP0    S$CU$
         1 001141   000000 236003                    LDQ     0,DU
         1 001142   000007 752114                    STCQ    7,'14'O,PR0

      716    10030    3              S$CU$->B$U.APR = 0;

  10030  1 001143   000007 752160                    STCQ    7,'60'O,PR0

      717    10031    3              END;

      718    10032
      719    10033    2         IF B$PS0$ -> FPT$UNSHARE_V.FLGS.LIB AND S$CU$->B$U.ASP ~= 0

  10033  1 001144   000000 470400 xsym               LDP0    B$PS0$
         1 001145   000000 430100                    FSZN    0,,PR0
         1 001146   001172 605000 1                  TPL     BAD_SHARE
         1 001147   000000 471400 xsym               LDP1    S$CU$
         1 001150   100007 236100                    LDQ     7,,PR1
         1 001151   007700 316007                    CANQ    4032,DL
         1 001152   001172 600000 1                  TZE     BAD_SHARE

      720    10034    3         THEN DO;

      721    10035    3              PNUM=S$CU$->B$U.ASP;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:130  
  10035  1 001153   100007 236100                    LDQ     7,,PR1
         1 001154   000006 772000                    QRL     6
         1 001155   000077 376007                    ANQ     63,DL
         1 001156   200013 756100                    STQ     PNUM,,AUTO

      722    10036    3              CALL JSA$UNSHARE(PNUM,0) ALTRET(BAD_SHARE);

  10036  1 001157   000013 236000 2                  LDQ     11
         1 001160   200101 756100                    STQ     USRIC+2,,AUTO
         1 001161   200013 633500                    EPPR3   PNUM,,AUTO
         1 001162   200100 453500                    STP3    USRIC+1,,AUTO
         1 001163   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001164   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001165   000000 701000 xent               TSX1    JSA$UNSHARE
         1 001166   001172 702000 1                  TSX2    BAD_SHARE

      723    10037    3              S$CU$->B$U.ASP = 0;

  10037  1 001167   000000 470400 xsym               LDP0    S$CU$
         1 001170   000000 236003                    LDQ     0,DU
         1 001171   000007 752102                    STCQ    7,'02'O,PR0

      724    10038    3              END;

  10033  1 001172                       BAD_SHARE    null
      725    10039
      726    10040    2   BAD_SHARE: ;
      727    10041                                 /* If BAD_SHARE JIT.ERR has been set by JSA$UNSHARE  */
      728    10042    2         RETURN;

  10042  1 001172   000000 702200 xent               TSX2  ! X66_ARET

      729    10043
      730    10044        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:131  
      731    10045        /*************************************************************
      732    10046         *                                                           *
      733    10047         *                        M$ALIB                             *
      734    10048         *                        M$DLIB                             *
      735    10049         *                                                           *
      736    10050         *************************************************************/
      737    10051
      738    10052    2       CASE(%C$ALIB#, %C$DLIB#);

      739    10053    2         PTYPE = (%P_DB | %P_ASL | %P_LIB);

  10053  1 001173   320000 220003                    LDX0    106496,DU
         1 001174   200014 740100                    STX0    PTYPE,,AUTO

      740    10054    2         CALL JSA$FINDSSP (B$PS0$,J_SYS$,PNUM,PTYPE,B$JIT.ERR)

  10054  1 001175   000000 236000 xsym               LDQ     B$JIT$
         1 001176   000012 036003                    ADLQ    10,DU
         1 001177   200104 756100                    STQ     USRIC+5,,AUTO
         1 001200   200014 631500                    EPPR1   PTYPE,,AUTO
         1 001201   200103 451500                    STP1    USRIC+4,,AUTO
         1 001202   200013 633500                    EPPR3   PNUM,,AUTO
         1 001203   200102 453500                    STP3    USRIC+3,,AUTO
         1 001204   000014 237000 2                  LDAQ    12
         1 001205   200100 757100                    STAQ    USRIC+1,,AUTO
         1 001206   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001207   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001210   000000 701000 xent               TSX1    JSA$FINDSSP
         1 001211   001576 702000 1                  TSX2    DO_ALTRET

      741    10055    2           ALTRET(DO_ALTRET);
      742    10056    2         IF PTYPE ~= %P_DB

  10056  1 001212   200014 220100                    LDX0    PTYPE,,AUTO
         1 001213   020000 100003                    CMPX0   8192,DU
         1 001214   001224 600000 1                  TZE     s:10062

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:132  
      743    10057    2         THEN IF WSR ~= %USERWSR

  10057  1 001215   200070 235100                    LDA     WSR,,AUTO
         1 001216   000007 115007                    CMPA    7,DL
         1 001217   001224 600000 1                  TZE     s:10062

      744    10058    3              THEN DO;

      745    10059    3                   B$JIT.ERR=EDOMAIN;

  10059  1 001220   000014 236000 0                  LDQ     EDOMAIN
         1 001221   000000 470400 xsym               LDP0    B$JIT$
         1 001222   000012 756100                    STQ     10,,PR0

      746    10060    3                   RETURN;

  10060  1 001223   000000 702200 xent               TSX2  ! X66_ARET

      747    10061    3                   END;
      748    10062    3         DO CASE(CODE);

  10062  1 001224   200003 470500                    LDP0    @CODE,,AUTO
         1 001225   000000 235100                    LDA     0,,PR0
         1 001226   000007 135007                    SBLA    7,DL
         1 001227   000002 115007                    CMPA    2,DL
         1 001230   001232 602005 1                  TNC     s:10062+6,AL
         1 001231   004033 710000 1                  TRA     s:11135
         1 001232   001234 710000 1                  TRA     s:10065
         1 001233   001503 710000 1                  TRA     s:10158

      749    10063    3          CASE(%C$ALIB#);

      750    10064                                                /* ASSOCIATE CORE LIBRARY             */
      751    10065    3            IF PTYPE = %P_LIB

  10065  1 001234   100000 100003                    CMPX0   32768,DU
         1 001235   001305 601000 1                  TNZ     s:10093
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:133  

      752    10066    4            THEN DO;

      753    10067    4                 IF B$JIT.PCL ~= 0         /* Library is unshared                */

  10067  1 001236   000000 471400 xsym               LDP1    B$JIT$
         1 001237   100215 721100                    LXL1    141,,PR1
         1 001240   001244 600000 1                  TZE     s:10075

      754    10068    5                 THEN DO;

      755    10069    5                      B$JIT.ERR = ELIBUNSH;

  10069  1 001241   000017 236000 0                  LDQ     ELIBUNSH
         1 001242   100012 756100                    STQ     10,,PR1

      756    10070                            /*E* ERROR: JSP-E$LIBUNSH-7
      757    10071                                 MESSAGE: Cannot M$ALIB with an unshared library.
      758    10072                                  */
      759    10073    5                      RETURN;

  10073  1 001243   000000 702200 xent               TSX2  ! X66_ARET

      760    10074    5                      END;
      761    10075    4                 IF S$CU$->B$U.ASP = PNUM THEN RETURN;

  10075  1 001244   000000 473400 xsym               LDP3    S$CU$
         1 001245   300007 236100                    LDQ     7,,PR3
         1 001246   000006 772000                    QRL     6
         1 001247   000077 376007                    ANQ     63,DL
         1 001250   200013 116100                    CMPQ    PNUM,,AUTO
         1 001251   001253 601000 1                  TNZ     s:10076

  10075  1 001252   000000 702200 xent               TSX2  ! X66_ARET

      762    10076    4                 TASP=S$CU$->B$U.ASP;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:134  
  10076  1 001253   000033 736000                    QLS     27
         1 001254   200067 756100                    STQ     TASP,,AUTO

      763    10077    4                 IF (TASP ~=0)

  10077  1 001255   200067 236100                    LDQ     TASP,,AUTO
         1 001256   777000 316003                    CANQ    -512,DU
         1 001257   001267 600000 1                  TZE     s:10085

      764    10078    5                 THEN DO;

      765    10079        /*E*     ERROR:  JSP-E$DLIB-C
      766    10080                 MESSAGE: M$ALIB caused disassociation of another shared library.
      767    10081        */
      768    10082    5                      CALL ZAPCLIB(TASP);

  10082  1 001260   200067 634500                    EPPR4   TASP,,AUTO
         1 001261   200075 454500                    STP4    CPEXIT_V+3,,AUTO
         1 001262   004306 701000 1                  TSX1    ZAPCLIB
         1 001263   000000 011000                    NOP     0

      769    10083    5                      B$JIT.ERR=EDLIB;

  10083  1 001264   000016 236000 0                  LDQ     EDLIB
         1 001265   000000 470400 xsym               LDP0    B$JIT$
         1 001266   000012 756100                    STQ     10,,PR0

      770    10084    5                      END;

      771    10085    4                 CALL JSA$CLIB(PNUM) ALTRET(RESTORE_ASP);

  10085  1 001267   200013 630500                    EPPR0   PNUM,,AUTO
         1 001270   200100 450500                    STP0    USRIC+1,,AUTO
         1 001271   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001272   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001273   000000 701000 xent               TSX1    JSA$CLIB
         1 001274   001276 702000 1                  TSX2    RESTORE_ASP
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:135  

      772    10086    4                 GOTO GET_PROCS;

  10086  1 001275   001476 710000 1                  TRA     GET_PROCS

  10077  1 001276                       RESTORE_ASP  null
      773    10087    4   RESTORE_ASP:  ;                         /*ALTRET FROM JSA$CLIB*/
      774    10088    4                 CALL JSA$CLIB(TASP);

  10088  1 001276   200067 630500                    EPPR0   TASP,,AUTO
         1 001277   200100 450500                    STP0    USRIC+1,,AUTO
         1 001300   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001301   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001302   000000 701000 xent               TSX1    JSA$CLIB
         1 001303   000000 011000                    NOP     0

      775    10089    4                 GOTO GET_PROCS;

  10089  1 001304   001476 710000 1                  TRA     GET_PROCS

      776    10090    4                 END;                      /*DO IF %P_LIB*/
      777    10091        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:136  
      778    10092                                                /* ASSOCIATE ASL                      */
      779    10093    3            IF PTYPE = %P_ASL

  10093  1 001305   200000 100003                    CMPX0   65536,DU
         1 001306   001337 601000 1                  TNZ     s:10114

      780    10094    4            THEN DO;

      781    10095    4                 IF S$CU$->B$U.ASL = PNUM THEN RETURN;

  10095  1 001307   000000 471400 xsym               LDP1    S$CU$
         1 001310   100006 236100                    LDQ     6,,PR1
         1 001311   000777 376007                    ANQ     511,DL
         1 001312   200013 116100                    CMPQ    PNUM,,AUTO
         1 001313   001315 601000 1                  TNZ     s:10096

  10095  1 001314   000000 702200 xent               TSX2  ! X66_ARET

      782    10096    4                 IF S$CU$->B$U.ASL ~=0

  10096  1 001315   100006 236100                    LDQ     6,,PR1
         1 001316   000777 316007                    CANQ    511,DL
         1 001317   001324 600000 1                  TZE     s:10108

      783    10097    5                 THEN DO;

  10096  1 001320                       SET_DLIBREQ  null
      784    10098    5   SET_DLIBREQ:       ;
      785    10099    5                      B$JIT.ERR=EDLIBREQ;

  10099  1 001320   000020 236000 0                  LDQ     EDLIBREQ
         1 001321   000000 470400 xsym               LDP0    B$JIT$
         1 001322   000012 756100                    STQ     10,,PR0

      786    10100    5                      RETURN;

  10100  1 001323   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:137  

      787    10101    5                      END;
      788    10102        /*E*   ERROR:   JSP-E$DLIBREQ-E
      789    10103               MESSAGE: A Library or Debugger of the same type is already associated.
      790    10104               MESSAGE1: M$ALIB of an Alternate Shared Library or of a
      791    10105                         Debugger requires that a processor of the same
      792    10106                         type is not already associated.
      793    10107        */
      794    10108    4                 CALL JSA$ASL(PNUM) ALTRET(DO_ALTRET);

  10108  1 001324   200013 633500                    EPPR3   PNUM,,AUTO
         1 001325   200100 453500                    STP3    USRIC+1,,AUTO
         1 001326   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001327   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001330   000000 701000 xent               TSX1    JSA$ASL
         1 001331   001576 702000 1                  TSX2    DO_ALTRET

      795    10109    4                 B$JIT.XCONF=(B$JIT.XCONF &~ %XC_ASL#);

  10109  1 001332   000000 470400 xsym               LDP0    B$JIT$
         1 001333   000316 236100                    LDQ     206,,PR0
         1 001334   777000 376003                    ANQ     -512,DU
         1 001335   775000 376003                    ANQ     -1536,DU
         1 001336   000316 552140                    STBQ    206,'40'O,PR0

      796    10110                                      /*  PREVENT CONFUSION ON NEXT ENTRY TO XCON     */
      797    10111    4                 END;

      798    10112        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:138  
      799    10113                                                /* ASSOCIATE DEBUGGER                 */
      800    10114    3            IF PTYPE = %P_DB

  10114  1 001337   200014 220100                    LDX0    PTYPE,,AUTO
         1 001340   020000 100003                    CMPX0   8192,DU
         1 001341   001476 601000 1                  TNZ     GET_PROCS

      801    10115    4            THEN DO;

      802    10116    4                 IF WSR < %ASLWSR

  10116  1 001342   200070 235100                    LDA     WSR,,AUTO
         1 001343   000006 115007                    CMPA    6,DL
         1 001344   001351 605000 1                  TPL     s:10121

      803    10117    5                 THEN DO;

      804    10118    5                      B$JIT.ERR=EDOMAIN;

  10118  1 001345   000014 236000 0                  LDQ     EDOMAIN
         1 001346   000000 470400 xsym               LDP0    B$JIT$
         1 001347   000012 756100                    STQ     10,,PR0

      805    10119    5                      RETURN;

  10119  1 001350   000000 702200 xent               TSX2  ! X66_ARET

      806    10120    5                      END;
      807    10121    4                 IF S$CU$->B$U.DB=PNUM THEN GOTO ADB_OK;

  10121  1 001351   000000 470400 xsym               LDP0    S$CU$
         1 001352   000006 236100                    LDQ     6,,PR0
         1 001353   000011 772000                    QRL     9
         1 001354   000777 376007                    ANQ     511,DL
         1 001355   200013 116100                    CMPQ    PNUM,,AUTO
         1 001356   001375 600000 1                  TZE     ADB_OK

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:139  
      808    10122    4                 IF S$CU$->B$U.DB ~=0 THEN GOTO SET_DLIBREQ;

  10122  1 001357   000006 236100                    LDQ     6,,PR0
         1 001360   777000 316007                    CANQ    -512,DL
         1 001361   001320 601000 1                  TNZ     SET_DLIBREQ

      809    10123    4                 CALL JSA$ALIBDB(PNUM) ALTRET(DO_ALTRET);

  10123  1 001362   200013 631500                    EPPR1   PNUM,,AUTO
         1 001363   200100 451500                    STP1    USRIC+1,,AUTO
         1 001364   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001365   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001366   000000 701000 xent               TSX1    JSA$ALIBDB
         1 001367   001576 702000 1                  TSX2    DO_ALTRET

      810    10124    4                 S$CU$->B$U.FLG=(S$CU$->B$U.FLG &~ %U_DIC);

  10124  1 001370   000044 236000 0                  LDQ     ENOOVRLY+1
         1 001371   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 001372   000000 470400 xsym               LDP0    S$CU$
         1 001373   000000 376100                    ANQ     0,,PR0
         1 001374   000000 756100                    STQ     0,,PR0

  10124  1 001375                       ADB_OK       null
      811    10125    4   ADB_OK:       ;
      812    10126    4                 T1$=ADDR(SAVEP);

  10126  1 001375   200023 630500                    EPPR0   SAVEP,,AUTO
         1 001376   200010 450500                    STP0    T1$,,AUTO

      813    10127    4                 SAVEP.ECCS=0;

  10127  1 001377   200023 450100                    STZ     SAVEP,,AUTO

      814    10128    4                 CALL HFF$NILERASE(1) ALTRET(ALIB2);

  10128  1 001400   000016 630400 2                  EPPR0   14
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:140  
         1 001401   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001402   000000 701000 xent               TSX1    HFF$NILERASE
         1 001403   001414 702000 1                  TSX2    ALIB2

      815    10129    4                 T1$->B$ALIB.CMDSZ = B$PSEG.P1.BOUND+1;

  10129  1 001404   000003 470400 xsym               LDP0    B_MPT+3
         1 001405   200010 471500                    LDP1    T1$,,AUTO
         1 001406   000002 236100                    LDQ     2,,PR0
         1 001407   000020 772000                    QRL     16
         1 001410   000001 036007                    ADLQ    1,DL
         1 001411   100000 676100                    ERQ     0,,PR1
         1 001412   000017 376000 2                  ANQ     15
         1 001413   100000 656100                    ERSQ    0,,PR1

  10129  1 001414                       ALIB2        null
      816    10130    4   ALIB2:        ;
      817    10131    4                 SAVEP.EVID=0;

  10131  1 001414   200024 450100                    STZ     SAVEP+1,,AUTO

      818    10132    4                 CALL HFF$NILERASE(2) ALTRET(ALIB3);

  10132  1 001415   000012 630400 2                  EPPR0   10
         1 001416   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001417   000000 701000 xent               TSX1    HFF$NILERASE
         1 001420   001431 702000 1                  TSX2    ALIB3

      819    10133    4                 T1$->B$ALIB.REPLYSZ = B$PSEG.P2.BOUND+1;

  10133  1 001421   000003 470400 xsym               LDP0    B_MPT+3
         1 001422   200010 471500                    LDP1    T1$,,AUTO
         1 001423   000004 236100                    LDQ     4,,PR0
         1 001424   000020 772000                    QRL     16
         1 001425   000001 036007                    ADLQ    1,DL
         1 001426   100001 676100                    ERQ     1,,PR1
         1 001427   000017 376000 2                  ANQ     15
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:141  
         1 001430   100001 656100                    ERSQ    1,,PR1

  10133  1 001431                       ALIB3        null
      820    10134    4   ALIB3:        ;
      821    10135    4                 SAVEP.JERR='0'B;

  10135  1 001431   200025 450100                    STZ     SAVEP+2,,AUTO

      822    10136    4                 SAVEP.P#=0;

  10136  1 001432   200026 450100                    STZ     SAVEP+3,,AUTO

      823    10137    4                 DATA1 = %ECC_ALIB#;

  10137  1 001433   000137 235007                    LDA     95,DL
         1 001434   200004 755100                    STA     DATA1,,AUTO

      824    10138
      825    10139    4                 IF WSR = %ASLWSR

  10139  1 001435   200070 236100                    LDQ     WSR,,AUTO
         1 001436   000006 116007                    CMPQ    6,DL
         1 001437   001444 601000 1                  TNZ     s:10141

      826    10140    4                 THEN T1$->B$ALIB.WHO = %SC_AASL#;

  10140  1 001440   200010 470500                    LDP0    T1$,,AUTO
         1 001441   001000 236003                    LDQ     512,DU
         1 001442   000000 552140                    STBQ    0,'40'O,PR0
         1 001443   001463 710000 1                  TRA     s:10147

      827    10141    4                 ELSE IF S$CU$->B$U.APR ~= 0

  10141  1 001444   000000 470400 xsym               LDP0    S$CU$
         1 001445   000007 236100                    LDQ     7,,PR0
         1 001446   777700 316003                    CANQ    -64,DU
         1 001447   001454 600000 1                  TZE     s:10143
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:142  

      828    10142    4                      THEN T1$->B$ALIB.WHO = %SC_ASHR#;

  10142  1 001450   200010 471500                    LDP1    T1$,,AUTO
         1 001451   002000 236003                    LDQ     1024,DU
         1 001452   100000 552140                    STBQ    0,'40'O,PR1
         1 001453   001463 710000 1                  TRA     s:10147

      829    10143    4                      ELSE IF (B$JIT.JUNK & %JJ_EXONLY#)

  10143  1 001454   000000 471400 xsym               LDP1    B$JIT$
         1 001455   100315 220100                    LDX0    205,,PR1
         1 001456   000010 360003                    ANX0    8,DU
         1 001457   001463 600000 1                  TZE     s:10147

      830    10144    4                           THEN T1$->B$ALIB.WHO = %SC_EXUO#;

  10144  1 001460   200010 473500                    LDP3    T1$,,AUTO
         1 001461   003000 236003                    LDQ     1536,DU
         1 001462   300000 552140                    STBQ    0,'40'O,PR3

      831    10145                                                /* ELSE ALREADY SET TO 0 (%SC_AUSR#)  */
      832    10146
      833    10147    4                 CALL UDB$CALCOMP;

  10147  1 001463   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001464   000000 701000 xent               TSX1    UDB$CALCOMP
         1 001465   000000 011000                    NOP     0

      834    10148    4                 CALL SSU$DELTAGO (DATA1,SAVEP);

  10148  1 001466   200023 630500                    EPPR0   SAVEP,,AUTO
         1 001467   200101 450500                    STP0    USRIC+2,,AUTO
         1 001470   200004 631500                    EPPR1   DATA1,,AUTO
         1 001471   200100 451500                    STP1    USRIC+1,,AUTO
         1 001472   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 001473   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:143  
         1 001474   000000 701000 xent               TSX1    SSU$DELTAGO
         1 001475   000000 011000                    NOP     0

      835    10149    4                 END;                      /* DO IF %P_DB*/

  10142  1 001476                       GET_PROCS    null
      836    10150                                                /**/
      837    10151                                                /**/
      838    10152    3   GET_PROCS: ;
      839    10153    3            CALL SSR$REG(%SS_AP);

  10153  1 001476   000021 630400 2                  EPPR0   17
         1 001477   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001500   000000 701000 xent               TSX1    SSR$REG
         1 001501   000000 011000                    NOP     0

      840    10154    3            RETURN;

  10154  1 001502   000000 702200 xent               TSX2  ! X66_ARET

      841    10155        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:144  
      842    10156    3          CASE(%C$DLIB#);

      843    10157                                                /* DISASSOCIATE CORE LIBRARY          */
      844    10158    3            IF (B$P$ -> B$P.FLGS(PNUM) & %P_LIB)

  10158  1 001503   200013 236100                    LDQ     PNUM,,AUTO
         1 001504   000042 402007                    MPY     34,DL
         1 001505   000000 471400 xsym               LDP1    B$P$
         1 001506   100027 221106                    LDX1    23,QL,PR1
         1 001507   100000 361003                    ANX1    32768,DU
         1 001510   001524 600000 1                  TZE     s:10167

      845    10159    4            THEN DO;

      846    10160    4                 IF S$CU$->B$U.ASP ~= PNUM THEN GOTO SET_NOTASSC;

  10160  1 001511   000000 473400 xsym               LDP3    S$CU$
         1 001512   300007 236100                    LDQ     7,,PR3
         1 001513   000006 772000                    QRL     6
         1 001514   000077 376007                    ANQ     63,DL
         1 001515   200013 116100                    CMPQ    PNUM,,AUTO
         1 001516   001573 601000 1                  TNZ     SET_NOTASSC

      847    10161    4                 CALL ZAPCLIB(PNUM);

  10161  1 001517   200013 634500                    EPPR4   PNUM,,AUTO
         1 001520   200075 454500                    STP4    CPEXIT_V+3,,AUTO
         1 001521   004306 701000 1                  TSX1    ZAPCLIB
         1 001522   000000 011000                    NOP     0

      848    10162    4                 RETURN;

  10162  1 001523   000000 702200 xent               TSX2  ! X66_ARET

      849    10163    4                 END;
      850    10164                                                /**/
      851    10165                                                /**/
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:145  
      852    10166                                                /* DISASSOCIATE ASL                   */
      853    10167    3            IF (B$P$ -> B$P.FLGS(PNUM) & %P_ASL)

  10167  1 001524   100027 221106                    LDX1    23,QL,PR1
         1 001525   200000 361003                    ANX1    65536,DU
         1 001526   001545 600000 1                  TZE     s:10177

      854    10168    4            THEN DO;

      855    10169    4                 IF S$CU$->B$U.ASL ~= PNUM THEN GOTO SET_NOTASSC;

  10169  1 001527   000000 473400 xsym               LDP3    S$CU$
         1 001530   300006 236100                    LDQ     6,,PR3
         1 001531   000777 376007                    ANQ     511,DL
         1 001532   200013 116100                    CMPQ    PNUM,,AUTO
         1 001533   001573 601000 1                  TNZ     SET_NOTASSC

      856    10170    4                 B$JIT.JUNK=(B$JIT.JUNK | %JJ_DLIB#);

  10170  1 001534   000000 474400 xsym               LDP4    B$JIT$
         1 001535   400315 221100                    LDX1    205,,PR4
         1 001536   004000 261003                    ORX1    2048,DU
         1 001537   400315 741100                    STX1    205,,PR4

      857    10171    4                 CALL JSX$RUNXCON(%ASLWSR);

  10171  1 001540   000022 630400 2                  EPPR0   18
         1 001541   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001542   000000 701000 xent               TSX1    JSX$RUNXCON
         1 001543   000000 011000                    NOP     0

      858    10172    4                 RETURN;

  10172  1 001544   000000 702200 xent               TSX2  ! X66_ARET

      859    10173    4                 END;
      860    10174                                                /**/
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:146  
      861    10175                                                /**/
      862    10176                                                /* DISASSOCIATE DEBUGGER              */
      863    10177    3            IF (B$P$ -> B$P.FLGS(PNUM) & %P_DB)

  10177  1 001545   100027 221106                    LDX1    23,QL,PR1
         1 001546   020000 361003                    ANX1    8192,DU
         1 001547   001573 600000 1                  TZE     SET_NOTASSC

      864    10178    4            THEN DO;

      865    10179    4                 IF S$CU$->B$U.DB ~= PNUM THEN GOTO SET_NOTASSC;

  10179  1 001550   000000 473400 xsym               LDP3    S$CU$
         1 001551   300006 236100                    LDQ     6,,PR3
         1 001552   000011 772000                    QRL     9
         1 001553   000777 376007                    ANQ     511,DL
         1 001554   200013 116100                    CMPQ    PNUM,,AUTO
         1 001555   001573 601000 1                  TNZ     SET_NOTASSC

      866    10180    4                 IF (B$JIT.JUNK & %JJ_UDELTA#) THEN RETURN;

  10180  1 001556   000000 474400 xsym               LDP4    B$JIT$
         1 001557   400315 221100                    LDX1    205,,PR4
         1 001560   200000 361003                    ANX1    65536,DU
         1 001561   001563 600000 1                  TZE     s:10182

  10180  1 001562   000000 702200 xent               TSX2  ! X66_ARET

      867    10181                                                /* DONT DLIB IF STARTED UNDER DELTA   */
      868    10182    4                 B$JIT.JUNK=(B$JIT.JUNK | %JJ_DLIB#);

  10182  1 001563   400315 221100                    LDX1    205,,PR4
         1 001564   004000 261003                    ORX1    2048,DU
         1 001565   400315 741100                    STX1    205,,PR4

      869    10183    4                 CALL JSX$RUNXCON(%DBWSR);

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:147  
  10183  1 001566   000001 630400 2                  EPPR0   1
         1 001567   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001570   000000 701000 xent               TSX1    JSX$RUNXCON
         1 001571   000000 011000                    NOP     0

      870    10184    4                 RETURN;

  10184  1 001572   000000 702200 xent               TSX2  ! X66_ARET

  10182  1 001573                       SET_NOTASSC  null
      871    10185    4                 END;
      872    10186                                                /**/
      873    10187    3   SET_NOTASSC: ;
      874    10188    3            B$JIT.ERR=ENOTASSOC;

  10188  1 001573   000021 236000 0                  LDQ     ENOTASSOC
         1 001574   000000 473400 xsym               LDP3    B$JIT$
         1 001575   300012 756100                    STQ     10,,PR3

      875    10189        /*E*     ERROR:  JSP-E$NOTASSOC-E
      876    10190                 MESSAGE:  Library/Debugger not associated
      877    10191        */
      878    10192    3   DO_ALTRET: RETURN;

  10192  1 001576   000000 702200 xent  DO_ALTRET    TSX2  ! X66_ARET

      879    10193    3            END;                           /*DO CASE(C$ALIB,C$DLIB)              */

      880    10194        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:148  
      881    10195        /*************************************************************
      882    10196         *                                                           *
      883    10197         *                        M$YC                               *
      884    10198         *                                                           *
      885    10199         *************************************************************/
      886    10200
      887    10201    2       CASE(%C$YC#);

      888    10202    2         IF B$SS.ISR.WSR = %CPWSR

  10202  1 001577   000000 471400 xsym               LDP1    B_MPT
         1 001600   100010 236100                    LDQ     8,,PR1
         1 001601   000160 376007                    ANQ     112,DL
         1 001602   000100 116007                    CMPQ    64,DL
         1 001603   001610 601000 1                  TNZ     s:10207

      889    10203    3         THEN DO;

      890    10204    3              B$JIT.ERR=EDOMAIN;

  10204  1 001604   000014 236000 0                  LDQ     EDOMAIN
         1 001605   000000 473400 xsym               LDP3    B$JIT$
         1 001606   300012 756100                    STQ     10,,PR3

      891    10205    3              RETURN;

  10205  1 001607   000000 702200 xent               TSX2  ! X66_ARET

      892    10206    3              END;
      893    10207    2         CALL HFF$NILERASE(0) ALTRET(FPT_BAD);

  10207  1 001610   000013 630400 2                  EPPR0   11
         1 001611   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001612   000000 701000 xent               TSX1    HFF$NILERASE
         1 001613   000622 702000 1                  TSX2    FPT_BAD

      894    10208    2         CALL HFF$PTPRES(0) ALTRET(FPT_BAD);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:149  

  10208  1 001614   000013 630400 2                  EPPR0   11
         1 001615   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001616   000000 701000 xent               TSX1    HFF$PTPRES
         1 001617   000622 702000 1                  TSX2    FPT_BAD

      895    10209    2         B$JIT.YC0SZ = B$PSEG.P0.BOUND;

  10209  1 001620   000003 470400 xsym               LDP0    B_MPT+3
         1 001621   000000 236100                    LDQ     0,,PR0
         1 001622   000020 772000                    QRL     16
         1 001623   000000 620006                    EAX0    0,QL
         1 001624   000000 471400 xsym               LDP1    B$JIT$
         1 001625   100146 740100                    STX0    102,,PR1

      896    10210
      897    10211    2         CALL HFF$NILERASE(1)

  10211  1 001626   000016 630400 2                  EPPR0   14
         1 001627   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001630   000000 701000 xent               TSX1    HFF$NILERASE
         1 001631   001633 702000 1                  TSX2    s:10213
         1 001632   001637 710000 1                  TRA     s:10217

      898    10212    3         WHENALTRETURN DO;

      899    10213    3              B$JIT.ERR=EBADVECT1;

  10213  1 001633   000006 236000 0                  LDQ     EBADVECT1
         1 001634   000000 470400 xsym               LDP0    B$JIT$
         1 001635   000012 756100                    STQ     10,,PR0

      900    10214    3              RETURN;

  10214  1 001636   000000 702200 xent               TSX2  ! X66_ARET

      901    10215    3              END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:150  
      902    10216
      903    10217    2         B$JIT.YC2SZ = 0;

  10217  1 001637   000000 220003                    LDX0    0,DU
         1 001640   000000 470400 xsym               LDP0    B$JIT$
         1 001641   000170 440100                    SXL0    120,,PR0

      904    10218    2         CALL HFF$NILERASE(2) ALTRET(NO_REPLY);

  10218  1 001642   000012 630400 2                  EPPR0   10
         1 001643   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001644   000000 701000 xent               TSX1    HFF$NILERASE
         1 001645   001665 702000 1                  TSX2    NO_REPLY

      905    10219
      906    10220    2         CALL HFF$WRITE(2)

  10220  1 001646   000012 630400 2                  EPPR0   10
         1 001647   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001650   000000 701000 xent               TSX1    HFF$WRITE
         1 001651   001661 702000 1                  TSX2    s:10226

      907    10221    3         WHENRETURN DO;

      908    10222    3              B$JIT.YC2SZ = B$PSEG.P2.BOUND;

  10222  1 001652   000003 470400 xsym               LDP0    B_MPT+3
         1 001653   000004 236100                    LDQ     4,,PR0
         1 001654   000020 772000                    QRL     16
         1 001655   000000 620006                    EAX0    0,QL
         1 001656   000000 471400 xsym               LDP1    B$JIT$
         1 001657   100170 440100                    SXL0    120,,PR1

      909    10223    3              END;

  10223  1 001660   001665 710000 1                  TRA     NO_REPLY

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:151  
      910    10224
      911    10225    3         WHENALTRETURN DO;

      912    10226    3              B$JIT.ERR=EBADVECT2;

  10226  1 001661   000007 236000 0                  LDQ     EBADVECT2
         1 001662   000000 470400 xsym               LDP0    B$JIT$
         1 001663   000012 756100                    STQ     10,,PR0

      913    10227    3              RETURN;

  10227  1 001664   000000 702200 xent               TSX2  ! X66_ARET

      914    10228    3              END;

  10228  1 001665                       NO_REPLY     null
      915    10229
      916    10230    2   NO_REPLY: ;
      917    10231
      918    10232    2         B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 | %CP_YCPMME#);

  10232  1 001665   000000 470400 xsym               LDP0    B$JIT$
         1 001666   000143 236100                    LDQ     99,,PR0
         1 001667   000045 276000 0                  ORQ     ENOOVRLY+2
         1 001670   000143 756100                    STQ     99,,PR0

      919    10233    2         CALL UDB$CALCOMP;

  10233  1 001671   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001672   000000 701000 xent               TSX1    UDB$CALCOMP
         1 001673   000000 011000                    NOP     0

      920    10234    2         CALL JSE$ACP;

  10234  1 001674   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001675   000000 701000 xent               TSX1    JSE$ACP
         1 001676   000000 011000                    NOP     0
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:152  

      921    10235    2         RETURN;

  10235  1 001677   000000 702200 xent               TSX2  ! X66_ARET

      922    10236        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:153  
      923    10237        /*************************************************************
      924    10238         *                                                           *
      925    10239         *                        M$CPEXIT                           *
      926    10240         *                                                           *
      927    10241         *************************************************************/
      928    10242
      929    10243    2       CASE(%C$CPEXIT#);

      930    10244    2         IF B$SS.ISR.WSR ~= %CPWSR

  10244  1 001700   000000 471400 xsym               LDP1    B_MPT
         1 001701   100010 236100                    LDQ     8,,PR1
         1 001702   000160 376007                    ANQ     112,DL
         1 001703   000100 116007                    CMPQ    64,DL
         1 001704   001711 600000 1                  TZE     s:10261

      931    10245    3         THEN DO;

      932    10246    3              B$JIT.ERR=EDOMAIN;

  10246  1 001705   000014 236000 0                  LDQ     EDOMAIN
         1 001706   000000 473400 xsym               LDP3    B$JIT$
         1 001707   300012 756100                    STQ     10,,PR3

      933    10247    3              RETURN;

  10247  1 001710   000000 702200 xent               TSX2  ! X66_ARET

      934    10248    3              END;
      935    10249        /*E*     ERROR:   JSP-E$DOMAIN-E
      936    10250                 MESSAGE: That Service Request is not permitted from your domain.
      937    10251                 DESCRIPTION: M$ALIB or M$DLIB and not user domain.
      938    10252                              M$CPEXIT and not CP domain.
      939    10253                              M$INTRTN and not ASL domain.
      940    10254                              M$YC from CP domain.
      941    10255        */
      942    10256        /*
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:154  
      943    10257           The M$CPEXIT FPT is validated, as we will be running down the
      944    10258           Command Processor prior to using all the parameters and must
      945    10259           be certain we will not trap when accessing those parameters.
      946    10260        */
      947    10261    2         J=6;

  10261  1 001711   000006 235007                    LDA     6,DL
         1 001712   200007 755100                    STA     J,,AUTO

      948    10262    2         CALL CHECK_PSTACK ALTRET(FPT_BAD);

  10262  1 001713   004034 701000 1                  TSX1    CHECK_PSTACK
         1 001714   000622 702000 1                  TSX2    FPT_BAD

      949    10263
      950    10264    2         IF P4$ ~= ADDR(NIL)

  10264  1 001715   200033 236100                    LDQ     SAVEP+8,,AUTO
         1 001716   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001717   001733 600000 1                  TZE     s:10270

      951    10265    3         THEN DO;

      952    10266    3              DEBUG_NAME = P4$->TEXTC;

  10266  1 001720   200033 470500                    LDP0    SAVEP+8,,AUTO
         1 001721   000100 101500                    MRL     fill='000'O
         1 001722   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         1 001723   200100 000002                    ADSC9   USRIC+1,,AUTO            cn=0,n=2
         1 001724   200100 220100                    LDX0    USRIC+1,,AUTO
         1 001725   000001 621010                    EAX1    1,X0
         1 001726   000100 100540                    MLR     fill='000'O
         1 001727   000000 000011                    ADSC9   0,,PR0                   cn=0,n=*X1
         1 001730   200056 000040                    ADSC9   DEBUG_NAME,,AUTO         cn=0,n=32

      953    10267    3              P4$=ADDR(DEBUG_NAME);

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:155  
  10267  1 001731   200056 631500                    EPPR1   DEBUG_NAME,,AUTO
         1 001732   200033 451500                    STP1    SAVEP+8,,AUTO

      954    10268    3              END;

      955    10269
      956    10270    2         CPEXIT_V=B$PS5$->CPEXIT$V;

  10270  1 001733   000000 470400 xsym               LDP0    B$PS5$
         1 001734   000000 237100                    LDAQ    0,,PR0
         1 001735   200072 757100                    STAQ    CPEXIT_V,,AUTO

      957    10271    2         P5$=ADDR(CPEXIT_V);

  10271  1 001736   200072 631500                    EPPR1   CPEXIT_V,,AUTO
         1 001737   200005 451500                    STP1    P5$,,AUTO

      958    10272    2         CPEXIT_RUND=0;                    /* Set internal flag                  */

  10272  1 001740   200016 450100                    STZ     CPEXIT_RUND,,AUTO

      959    10273
      960    10274        /*
      961    10275           If this is the first M$CPEXIT for this user, CP_JSTEP is set
      962    10276           in JIT.CPFLAGS1 so we won't get confused later when validating
      963    10277           the FPT and performing the interpretive exit.
      964    10278        */
      965    10279    2         IF NOT (B$JIT.CPFLAGS1 & %CP_FIRST#)

  10279  1 001741   000000 473400 xsym               LDP3    B$JIT$
         1 001742   300143 236100                    LDQ     99,,PR3
         1 001743   000046 376000 0                  ANQ     ENOOVRLY+3
         1 001744   001753 601000 1                  TNZ     s:10292

      966    10280    3         THEN DO;

      967    10281    3              B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 | %CP_JSTEP#);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:156  

  10281  1 001745   300143 236100                    LDQ     99,,PR3
         1 001746   000047 276000 0                  ORQ     ENOOVRLY+4
         1 001747   300143 756100                    STQ     99,,PR3

      968    10282    3              S$CU$->B$U.FLG.STEP = '1'B;

  10282  1 001750   000000 474400 xsym               LDP4    S$CU$
         1 001751   100000 236007                    LDQ     32768,DL
         1 001752   400000 256100                    ORSQ    0,,PR4

      969    10283    3              END;

      970    10284
      971    10285
      972    10286        /*
      973    10287           When CP_LOGOFF has been set in JIT.CPFLAGS1, it has been
      974    10288           determined no more job steps are to be allowed.  CP_LOGOFF
      975    10289           will be set in combination with either CP_JSTEP or CP_RUND.
      976    10290        */
      977    10291
      978    10292    2         IF (B$JIT.CPFLAGS1 & %CP_LOGOFF#)

  10292  1 001753   300143 236100                    LDQ     99,,PR3
         1 001754   000030 376000 xsym               ANQ     B_VECTNIL+24
         1 001755   002053 600000 1                  TZE     s:10390

      979    10293    3         THEN DO;

      980    10294        /*
      981    10295           When CP_LOGOFF is set and the user is not yet rundown, the
      982    10296           only valid options on the M$CPEXIT FPT are Quit, DELTA or to
      983    10297           delete the user.  If Quit, the user is rundown, and the
      984    10298           Command Processor will eventually be re-entered with CP_LOGOFF
      985    10299           set in combination with CP_JSTEP.  If delete user, we rundown
      986    10300           the user prior to calling JSD$DELUSR; there will be no re-entry
      987    10301           to the Command Processor.  If post-association of DELTA, we will
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:157  
      988    10302           make a check on the validity of allowing DELTA and either ALTRET
      989    10303           to the CPEXIT or associate DELTA.
      990    10304        */
      991    10305    3              IF NOT(B$JIT.CPFLAGS1 & %CP_JSTEP#)

  10305  1 001756   300143 236100                    LDQ     99,,PR3
         1 001757   000047 376000 0                  ANQ     ENOOVRLY+4
         1 001760   002010 601000 1                  TNZ     s:10331

      992    10306    4              THEN DO;

      993    10307    4                   IF (CPEXIT_V.CONT#) OR (CPEXIT_V.ALTRTN#)

  10307  1 001761   200072 234100                    SZN     CPEXIT_V,,AUTO
         1 001762   001766 604000 1                  TMI     s:10309
         1 001763   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 001764   100000 316003                    CANQ    32768,DU
         1 001765   001774 600000 1                  TZE     s:10316

      994    10308    5                   THEN DO;

      995    10309    5                        IF P4$ ~= ADDR(NIL)

  10309  1 001766   200033 236100                    LDQ     SAVEP+8,,AUTO
         1 001767   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001770   002240 601000 1                  TNZ     DB_CHK

      996    10310    5                        THEN GOTO DB_CHK;
      997    10311
      998    10312    5                        IF (B$JIT.CPFLAGS1 & %CP_YCPMME#)

  10312  1 001771   300143 236100                    LDQ     99,,PR3
         1 001772   000045 376000 0                  ANQ     ENOOVRLY+2
         1 001773   002301 601000 1                  TNZ     CP_VALID2

      999    10313    5                        THEN GOTO CP_VALID2;
     1000    10314    5                        END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:158  

     1001    10315
     1002    10316    4                   IF (CPEXIT_V.QUIT#) AND (P0$=ADDR(NIL) )

  10316  1 001774   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 001775   200000 316003                    CANQ    65536,DU
         1 001776   002002 600000 1                  TZE     s:10319
         1 001777   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 002000   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002001   002301 600000 1                  TZE     CP_VALID2

     1003    10317    4                   THEN GOTO CP_VALID2;
     1004    10318
     1005    10319    4                   ELSE IF ( (P0$=ADDR(NIL)) AND (P5$->CPFPT.FLAGS='0'B) )

  10319  1 002002   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 002003   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002004   002007 601000 1                  TNZ     s:10321
         1 002005   100000 220100                    LDX0    0,,PR1
         1 002006   002105 600000 1                  TZE     RUNDOWN_FIRST

     1006    10320    4                        THEN GOTO RUNDOWN_FIRST;
     1007    10321    4                        ELSE GOTO SET_NOSTEPS;

  10321  1 002007   002035 710000 1                  TRA     SET_NOSTEPS

     1008    10322    4                   END;
     1009    10323
     1010    10324        /*
     1011    10325           When CP_LOGOFF is set and the user is at Job Step, the only
     1012    10326           valid options are to delete the user or to call for the
     1013    10327           Logoff Command Processor.  To prevent multiple entries to
     1014    10328           the Logoff Command Processor, JJ_LOGOFF is set in JIT.JUNK.
     1015    10329        */
     1016    10330    4              ELSE DO;

     1017    10331    4                   IF (B$JIT.CPFLAGS1 & %CP_JSTEP#)
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:159  

  10331  1 002010   300143 236100                    LDQ     99,,PR3
         1 002011   000047 376000 0                  ANQ     ENOOVRLY+4
         1 002012   003331 600000 1                  TZE     SUA_CPEXIT

     1018    10332    5                   THEN DO;

     1019    10333    5                        IF (B$JIT.CPFLAGS1 & %CP_LASTCP#)

  10333  1 002013   300143 236100                    LDQ     99,,PR3
         1 002014   000022 376000 xsym               ANQ     B_VECTNIL+18
         1 002015   002030 600000 1                  TZE     s:10341
         1 002016   300315 220100                    LDX0    205,,PR3
         1 002017   000200 360003                    ANX0    128,DU
         1 002020   002030 601000 1                  TNZ     s:10341
         1 002021   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 002022   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002023   002030 600000 1                  TZE     s:10341

     1020    10334    5                          AND NOT(B$JIT.JUNK & %JJ_LOGOFF#)
     1021    10335    5                          AND (P0$ ~= ADDR(NIL) )
     1022    10336    6                        THEN DO;

     1023    10337    6                             B$JIT.JUNK = (B$JIT.JUNK | %JJ_LOGOFF#);

  10337  1 002024   300315 220100                    LDX0    205,,PR3
         1 002025   000200 260003                    ORX0    128,DU
         1 002026   300315 740100                    STX0    205,,PR3

     1024    10338    6                             GOTO CP_VALID2;

  10338  1 002027   002301 710000 1                  TRA     CP_VALID2

     1025    10339    6                             END;
     1026    10340
     1027    10341    5                        IF ( P0$=ADDR(NIL) AND P5$->CPFPT.FLAGS='0'B )

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:160  
  10341  1 002030   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 002031   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002032   002035 601000 1                  TNZ     SET_NOSTEPS
         1 002033   100000 220100                    LDX0    0,,PR1
         1 002034   002301 600000 1                  TZE     CP_VALID2

     1028    10342    5                        THEN GOTO CP_VALID2;
     1029    10343
     1030    10344        /*
     1031    10345           When any of these rules have been violated, we give an ALTRET
     1032    10346           to the M$CPEXIT.  However, we only allow this ALTRET once so
     1033    10347           we dont hang up trying to delete a user that is associated
     1034    10348           with a confused Command Processor.
     1035    10349        */
     1036    10350    6                        ELSE DO;

  10337  1 002035                       SET_NOSTEPS  null
     1037    10351    6   SET_NOSTEPS:              ;
     1038    10352    6                             IF NOT(B$JIT.JUNK & %JJ_LOGOFF#)

  10352  1 002035   300315 220100                    LDX0    205,,PR3
         1 002036   000200 360003                    ANX0    128,DU
         1 002037   002046 601000 1                  TNZ     s:10359

     1039    10353    7                             THEN DO;

     1040    10354    7                                  B$JIT.JUNK = (B$JIT.JUNK | %JJ_LOGOFF#);

  10354  1 002040   300315 220100                    LDX0    205,,PR3
         1 002041   000200 260003                    ORX0    128,DU
         1 002042   300315 740100                    STX0    205,,PR3

     1041    10355    7                                  B$JIT.ERR=ENOSTEPS;

  10355  1 002043   000027 236000 0                  LDQ     ENOSTEPS
         1 002044   300012 756100                    STQ     10,,PR3

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:161  
     1042    10356    7                                  GOTO RESTART_CP;

  10356  1 002045   002163 710000 1                  TRA     RESTART_CP

     1043    10357    7                                  END;
     1044    10358    7                             ELSE DO;

     1045    10359    7                                  P0$ = ADDR(NIL);

  10359  1 002046   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002047   200027 756100                    STQ     SAVEP+4,,AUTO

     1046    10360    7                                  P5$->CPFPT.FLAGS='0'B;

  10360  1 002050   000000 220003                    LDX0    0,DU
         1 002051   100000 740100                    STX0    0,,PR1

     1047    10361    7                                  GOTO RUNDOWN_FIRST;

  10361  1 002052   002105 710000 1                  TRA     RUNDOWN_FIRST

     1048    10362    7                                  END;
     1049    10363    6                             END;
     1050    10364    5                        END;
     1051    10365        /*E*   ERROR:   JSP-E$NOSTEPS
     1052    10366               MESSAGE: No more Job Steps allowed.
     1053    10367               DESCRIPTION:  M$CPEXIT called to initiate another Job Step
     1054    10368                             when CP_LOGOFF has been set in CPFLAGS1.
     1055    10369        */
     1056    10370
     1057    10371        /*
     1058    10372           When we have LOGOFF set in CPFLAGS1 and the user is not at
     1059    10373           Job Step or at Rundown, we have a system error and so we SUA.
     1060    10374        */
     1061    10375    4                   ELSE GOTO SUA_CPEXIT;
     1062    10376    4                   END;
     1063    10377    3              END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:162  
     1064    10378
     1065    10379        /*
     1066    10380           If this is the CPEXIT following an M$LINK with CP_CMD set, the
     1067    10381           user is already rundown.  Make sure that the CP has given us the
     1068    10382           name of a run-unit to link to.  Also make sure he isn't trying
     1069    10383           to link to a Debugger, or fake out a SAVE/GET, or continue
     1070    10384           from this strange state, etc.
     1071    10385
     1072    10386           If this is the CPEXIT to load a program following the simulated
     1073    10387           M$LINK for an M$YC LINK=YES service request, rundown the current
     1074    10388           program and fetch the new one.
     1075    10389        */
     1076    10390    2         IF (B$JIT.JUNK2 & %JJ2_CP_LINK#) OR (B$JIT.CPFLAGS1 & %CP_LNKPMME#)

  10390  1 002053   300321 220100                    LDX0    209,,PR3
         1 002054   000010 360003                    ANX0    8,DU
         1 002055   002061 601000 1                  TNZ     s:10392
         1 002056   300143 236100                    LDQ     99,,PR3
         1 002057   000050 376000 0                  ANQ     ENOOVRLY+5
         1 002060   002075 600000 1                  TZE     s:10406

     1077    10391    3         THEN DO;

     1078    10392    3              IF (P0$ = ADDR(NIL)) OR (P4$ ~= ADDR(NIL))

  10392  1 002061   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 002062   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002063   003226 600000 1                  TZE     ALTRET_CPEXIT
         1 002064   200033 236100                    LDQ     SAVEP+8,,AUTO
         1 002065   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002066   003226 601000 1                  TNZ     ALTRET_CPEXIT
         1 002067   100000 220100                    LDX0    0,,PR1
         1 002070   003226 601000 1                  TNZ     ALTRET_CPEXIT

     1079    10393    3                OR (P5$->CPFPT.FLAGS ~= '0'B)
     1080    10394    3              THEN GOTO ALTRET_CPEXIT;
     1081    10395
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:163  
     1082    10396    3              IF (B$JIT.CPFLAGS1 & %CP_LNKPMME#)

  10396  1 002071   300143 236100                    LDQ     99,,PR3
         1 002072   000050 376000 0                  ANQ     ENOOVRLY+5
         1 002073   002301 601000 1                  TNZ     CP_VALID2

     1083    10397    3              THEN GOTO CP_VALID2;
     1084    10398    3              ELSE GOTO RUNDOWN_FIRST;

  10398  1 002074   002105 710000 1                  TRA     RUNDOWN_FIRST

     1085    10399    3              END;
     1086    10400
     1087    10401        /*
     1088    10402           If CP_RUND is set in JIT.CPFLAGS1, this may be a post association
     1089    10403           of DELTA or the initiation of a new job step.  If we are to begin
     1090    10404           a new job step, we must of course rundown the current job step first.
     1091    10405        */
     1092    10406    2         IF (B$JIT.CPFLAGS1 & %CP_RUND#)

  10406  1 002075   300143 236100                    LDQ     99,,PR3
         1 002076   000044 376000 0                  ANQ     ENOOVRLY+1
         1 002077   002111 600000 1                  TZE     s:10423
         1 002100   200033 236100                    LDQ     SAVEP+8,,AUTO
         1 002101   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002102   002111 601000 1                  TNZ     s:10423
         1 002103   100000 220100                    LDX0    0,,PR1
         1 002104   002111 601000 1                  TNZ     s:10423

     1093    10407    2           AND  (P4$ = ADDR(NIL))
     1094    10408    2           AND  (P5$->CPFPT.FLAGS = '0'B)
     1095    10409    3         THEN DO;                          /*NOT POST ASSOC OF DELTA*/

  10398  1 002105                       RUNDOWN_FIR* null
     1096    10410    3   RUNDOWN_FIRST: ;
     1097    10411    3              CPEXIT_RUND = CPEXIT_RUND+1; /* internal flag                      */

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:164  
  10411  1 002105   200016 235100                    LDA     CPEXIT_RUND,,AUTO
         1 002106   000001 035007                    ADLA    1,DL
         1 002107   200016 755100                    STA     CPEXIT_RUND,,AUTO

     1098    10412    3              GOTO CP_VALID2;

  10412  1 002110   002301 710000 1                  TRA     CP_VALID2

     1099    10413    3              END;
     1100    10414        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:165  
     1101    10415        /*
     1102    10416           We now enter a series of checks to determine if the options
     1103    10417           requested on the M$CPEXIT FPT are valid for the state the
     1104    10418           user is in, as indicated by the setting of JIT.CPFLAGS1.
     1105    10419           These checks and error messages are mostly to aid the develop-
     1106    10420           ment of Command Processors, but also insure that we dont get
     1107    10421           too confused should a Command Processor give us a bad FPT.
     1108    10422        */
     1109    10423    2         IF ( (B$JIT.CPFLAGS1 & %CP_JSTEP#) AND ( (CPEXIT_V & JS_FLAGS) ~='0'B) )

  10423  1 002111   300143 236100                    LDQ     99,,PR3
         1 002112   000047 376000 0                  ANQ     ENOOVRLY+4
         1 002113   002122 600000 1                  TZE     s:10432
         1 002114   200072 237100                    LDAQ    CPEXIT_V,,AUTO
         1 002115   000000 377000 0                  ANAQ    JS_FLAGS
         1 002116   002122 600000 1                  TZE     s:10432

     1110    10424    3         THEN DO;

     1111    10425    3              B$JIT.ERR=EJOBSTEP;

  10425  1 002117   000022 236000 0                  LDQ     EJOBSTEP
         1 002120   300012 756100                    STQ     10,,PR3

     1112    10426    3              GOTO RESTART_CP;

  10426  1 002121   002163 710000 1                  TRA     RESTART_CP

     1113    10427    3              END;
     1114    10428        /*E*   ERROR:   JSP-E$JOBSTEP-E
     1115    10429               MESSAGE: That command is meaningless at Job Step
     1116    10430        */
     1117    10431
     1118    10432    2         IF ( (CPEXIT_V.ALTRTN#) AND NOT

  10432  1 002122   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 002123   100000 316003                    CANQ    32768,DU
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:166  
         1 002124   002134 600000 1                  TZE     s:10442
         1 002125   000045 236000 0                  LDQ     ENOOVRLY+2
         1 002126   000050 276000 0                  ORQ     ENOOVRLY+5
         1 002127   300143 376100                    ANQ     99,,PR3
         1 002130   002134 601000 1                  TNZ     s:10442

     1119    10433    2           (B$JIT.CPFLAGS1 & (%CP_YCPMME# | %CP_LNKPMME#)) )
     1120    10434    3         THEN DO;

     1121    10435    3              B$JIT.ERR=ECPALT;

  10435  1 002131   000023 236000 0                  LDQ     ECPALT
         1 002132   300012 756100                    STQ     10,,PR3

     1122    10436    3              GOTO RESTART_CP;

  10436  1 002133   002163 710000 1                  TRA     RESTART_CP

     1123    10437    3              END;
     1124    10438        /*E*   ERROR:   JSP-E$CPALT-E
     1125    10439               MESSAGE:  M$CPEXIT Bad (Altret set--CP_YCPMME not set)
     1126    10440        */
     1127    10441
     1128    10442    2         IF ( (CPEXIT_V.GETFLG#) OR (P5$->CPFPT.FLAGS='0'B) )

  10442  1 002134   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 002135   020000 316003                    CANQ    8192,DU
         1 002136   002141 601000 1                  TNZ     s:10442+5
         1 002137   100000 220100                    LDX0    0,,PR1
         1 002140   002150 601000 1                  TNZ     s:10452
         1 002141   000047 236000 0                  LDQ     ENOOVRLY+4
         1 002142   000050 276000 0                  ORQ     ENOOVRLY+5
         1 002143   300143 376100                    ANQ     99,,PR3
         1 002144   002150 601000 1                  TNZ     s:10452

     1129    10443    2           AND NOT(B$JIT.CPFLAGS1 & (%CP_JSTEP# | %CP_LNKPMME#))
     1130    10444    3         THEN DO;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:167  

     1131    10445    3              B$JIT.ERR=ENJOBSTEP;

  10445  1 002145   000024 236000 0                  LDQ     ENJOBSTEP
         1 002146   300012 756100                    STQ     10,,PR3

     1132    10446    3              GOTO RESTART_CP;

  10446  1 002147   002163 710000 1                  TRA     RESTART_CP

     1133    10447    3              END;
     1134    10448        /*E*   ERROR:   JSP-E$NJOBSTEP
     1135    10449               MESSAGE:  That command is allowed only at Job Step
     1136    10450        */
     1137    10451
     1138    10452    2         IF ( (P0$=ADDR(NIL)) AND (P5$->CPFPT.FLAGS='0'B)  )

  10452  1 002150   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 002151   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002152   002165 601000 1                  TNZ     s:10470
         1 002153   100000 220100                    LDX0    0,,PR1
         1 002154   002165 601000 1                  TNZ     s:10470

     1139    10453    2         THEN IF NOT (B$JIT.CPFLAGS1 & (%CP_JSTEP# | %CP_RUND#) )

  10453  1 002155   000047 236000 0                  LDQ     ENOOVRLY+4
         1 002156   000044 276000 0                  ORQ     ENOOVRLY+1
         1 002157   300143 376100                    ANQ     99,,PR3
         1 002160   002165 601000 1                  TNZ     s:10470

     1140    10454    3              THEN DO;

     1141    10455    3                   B$JIT.ERR=ELOGOFF;

  10455  1 002161   000025 236000 0                  LDQ     ELOGOFF
         1 002162   300012 756100                    STQ     10,,PR3

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:168  
  10455  1 002163                       RESTART_CP   null
     1142    10456    3   RESTART_CP:     ;
     1143    10457    3                   B$JIT.USRERR=B$JIT.ERR;

  10457  1 002163   300144 756100                    STQ     100,,PR3

     1144    10458    3                   RETURN;

  10458  1 002164   000000 702200 xent               TSX2  ! X66_ARET

     1145    10459    3                   END;
     1146    10460        /*E*   ERROR:   JSP-E$LOGOFF-E
     1147    10461               MESSAGE:  M$CPEXIT Bad (Logoff when not at Job Step or Run-down)
     1148    10462        */
     1149    10463
     1150    10464
     1151    10465        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:169  
     1152    10466        /*
     1153    10467           If this is an M$CPEXIT to simulate an M$LINK, write out the
     1154    10468           image and return to the command processor.
     1155    10469        */
     1156    10470    2         IF CPEXIT_V.LINK#

  10470  1 002165   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 002166   004000 316003                    CANQ    2048,DU
         1 002167   002233 600000 1                  TZE     s:10490

     1157    10471    3         THEN DO;

     1158    10472    3              B$JIT.PRIV.ACTIVE = B$JIT.PRIV.SAVED;

  10472  1 002170   300017 236100                    LDQ     15,,PR3
         1 002171   300013 756100                    STQ     11,,PR3

     1159    10473    3              B$JIT.JUNK2 = (B$JIT.JUNK2 | %JJ2_CP_LINK#);

  10473  1 002172   300321 220100                    LDX0    209,,PR3
         1 002173   000010 260003                    ORX0    8,DU
         1 002174   300321 740100                    STX0    209,,PR3

     1160    10474    4              CALL JLL$LINK(P0$,P1$,P2$,P3$,ADDR(NIL)) WHENALTRETURN DO;

  10474  1 002175   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002176   200100 756100                    STQ     USRIC+1,,AUTO
         1 002177   200100 634500                    EPPR4   USRIC+1,,AUTO
         1 002200   200105 454500                    STP4    USRIC+6,,AUTO
         1 002201   200032 635500                    EPPR5   SAVEP+7,,AUTO
         1 002202   200104 455500                    STP5    USRIC+5,,AUTO
         1 002203   200031 636500                    EPPR6   SAVEP+6,,AUTO
         1 002204   200103 456500                    STP6    USRIC+4,,AUTO
         1 002205   200030 637500                    EPPR7   SAVEP+5,,AUTO
         1 002206   200102 457500                    STP7    USRIC+3,,AUTO
         1 002207   200027 630500                    EPPR0   SAVEP+4,,AUTO
         1 002210   200101 450500                    STP0    USRIC+2,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:170  
         1 002211   200101 630500                    EPPR0   USRIC+2,,AUTO
         1 002212   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 002213   000000 701000 xent               TSX1    JLL$LINK
         1 002214   002216 702000 1                  TSX2    s:10475
         1 002215   002223 710000 1                  TRA     s:10478

     1161    10475    4                   B$JIT.JUNK2 = B$JIT.JUNK2 &~ %JJ2_CP_LINK#;

  10475  1 002216   000000 470400 xsym               LDP0    B$JIT$
         1 002217   000321 220100                    LDX0    209,,PR0
         1 002220   777767 360003                    ANX0    -9,DU
         1 002221   000321 740100                    STX0    209,,PR0

     1162    10476    4                   GOTO CPEXIT_ALTRET;

  10476  1 002222   002300 710000 1                  TRA     CPEXIT_ALTRET

     1163    10477    4                   END;
     1164    10478    3              IF (B$JIT.CPFLAGS1 & %CP_YC#)

  10478  1 002223   000000 470400 xsym               LDP0    B$JIT$
         1 002224   000143 236100                    LDQ     99,,PR0
         1 002225   000051 376000 0                  ANQ     ENOOVRLY+6
         1 002226   002232 600000 1                  TZE     s:10480

     1165    10479    3              THEN B$JIT.JUNK = (B$JIT.JUNK | %JJ_ASYNCLINK#);

  10479  1 002227   000315 220100                    LDX0    205,,PR0
         1 002230   000004 260003                    ORX0    4,DU
         1 002231   000315 740100                    STX0    205,,PR0

     1166    10480    3              RETURN;

  10480  1 002232   000000 702200 xent               TSX2  ! X66_ARET

     1167    10481    3              END;
     1168    10482
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:171  
     1169    10483        /*
     1170    10484           If this M$CPEXIT is for post association of DELTA, we verify
     1171    10485           that this is a valid thing to do prior to running down the
     1172    10486           Command Processor.  This allows the user to continue without
     1173    10487           the debugger rather than being rundown as he would be should
     1174    10488           we get to JSE$ABORTM trying to associate the debugger.
     1175    10489        */
     1176    10490    2         IF (CPEXIT_V.CONT#) AND (P4$ ~= ADDR(NIL))

  10490  1 002233   200072 234100                    SZN     CPEXIT_V,,AUTO
         1 002234   002301 605000 1                  TPL     CP_VALID2
         1 002235   200033 236100                    LDQ     SAVEP+8,,AUTO
         1 002236   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002237   002301 600000 1                  TZE     CP_VALID2

     1177    10491    3         THEN DO;

  10480  1 002240                       DB_CHK       null
     1178    10492    3   DB_CHK:    ;
     1179    10493    3              PTYPE= %P_DB;

  10493  1 002240   020000 220003                    LDX0    8192,DU
         1 002241   200014 740100                    STX0    PTYPE,,AUTO

     1180    10494    3              CALL JSA$FINDSSP (B$PS4$,J_SYS$,PNUM,PTYPE,B$JIT.ERR)

  10494  1 002242   000000 236000 xsym               LDQ     B$JIT$
         1 002243   000012 036003                    ADLQ    10,DU
         1 002244   200104 756100                    STQ     USRIC+5,,AUTO
         1 002245   200014 634500                    EPPR4   PTYPE,,AUTO
         1 002246   200103 454500                    STP4    USRIC+4,,AUTO
         1 002247   200013 635500                    EPPR5   PNUM,,AUTO
         1 002250   200102 455500                    STP5    USRIC+3,,AUTO
         1 002251   000024 237000 2                  LDAQ    20
         1 002252   200100 757100                    STAQ    USRIC+1,,AUTO
         1 002253   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 002254   000023 631400 xsym               EPPR1   B_VECTNIL+19
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:172  
         1 002255   000000 701000 xent               TSX1    JSA$FINDSSP
         1 002256   002300 702000 1                  TSX2    CPEXIT_ALTRET

     1181    10495    3                ALTRET(CPEXIT_ALTRET);
     1182    10496    3              CALL JSA$DBCHK(PNUM) ALTRET(CPEXIT_ALTRET);

  10496  1 002257   200013 630500                    EPPR0   PNUM,,AUTO
         1 002260   200100 450500                    STP0    USRIC+1,,AUTO
         1 002261   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 002262   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002263   000000 701000 xent               TSX1    JSA$DBCHK
         1 002264   002300 702000 1                  TSX2    CPEXIT_ALTRET

     1183    10497
     1184    10498    3              IF (S$CU$->B$U.APR=0) OR (S$CU$->B$U.APR >= P_AUTO_START)

  10498  1 002265   000000 470400 xsym               LDP0    S$CU$
         1 002266   000007 236100                    LDQ     7,,PR0
         1 002267   777700 316003                    CANQ    -64,DU
         1 002270   002301 600000 1                  TZE     CP_VALID2
         1 002271   000007 236100                    LDQ     7,,PR0
         1 002272   000030 772000                    QRL     24
         1 002273   000000 116000 xsym               CMPQ    P_AUTO_START
         1 002274   002301 603000 1                  TRC     CP_VALID2

     1185    10499    3              THEN GOTO CP_VALID2;
     1186    10500    3              B$JIT.ERR=EDEBUGSP;

  10500  1 002275   000030 236000 0                  LDQ     EDEBUGSP
         1 002276   000000 471400 xsym               LDP1    B$JIT$
         1 002277   100012 756100                    STQ     10,,PR1

  10500  1 002300                       CPEXIT_ALTR* null
     1187    10501        /*E*   ERROR: JSP-E$DEBUGSP-E
     1188    10502               MESSAGE: You cannot associate a debugger with a shared processor.
     1189    10503               DESCRIPTION:  YC DELTA when executing a standard shared processor.
     1190    10504        */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:173  
     1191    10505    3   CPEXIT_ALTRET: ;
     1192    10506    3              RETURN;

  10506  1 002300   000000 702200 xent               TSX2  ! X66_ARET

  10496  1 002301                       CP_VALID2    null
     1193    10507    3              END;
     1194    10508
     1195    10509        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:174  
     1196    10510        /*
     1197    10511           At this point, we have determined that the parameters supplied
     1198    10512           in the FPT are valid and we rundown the Command Processor.  Any
     1199    10513           error conditions that may result from this M$CPEXIT will be
     1200    10514           reported to the Command Processor by entering him at his start
     1201    10515           address with the error code in JIT.USRERR.
     1202    10516        */
     1203    10517
     1204    10518    2   CP_VALID2: ;
     1205    10519
     1206    10520    2         CALL UDB$CALCOMP;

  10520  1 002301   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002302   000000 701000 xent               TSX1    UDB$CALCOMP
         1 002303   000000 011000                    NOP     0

     1207    10521    2         B$SS.FPTCHK=0;

  10521  1 002304   000000 470400 xsym               LDP0    B_MPT
         1 002305   000007 450100                    STZ     7,,PR0

     1208    10522    2         B$SS.FPT = (B$SS.FPT | '004000'O);

  10522  1 002306   000001 220100                    LDX0    1,,PR0
         1 002307   004000 260003                    ORX0    2048,DU
         1 002310   000001 740100                    STX0    1,,PR0

     1209    10523        /* If BRK was received give it to the user now.                    */
     1210    10524    2         IF B$JIT.JUNK2 & %JJ2_DFRBRK# THEN

  10524  1 002311   000000 471400 xsym               LDP1    B$JIT$
         1 002312   100321 221100                    LDX1    209,,PR1
         1 002313   000004 361003                    ANX1    4,DU
         1 002314   002335 600000 1                  TZE     s:10537

     1211    10525    3         DO;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:175  
     1212    10526                   %LOCK (G#=S_ASFGATE);

  10527  1 002315   000026 630400 2                  EPPR0   22
         1 002316   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002317   000000 701000 xent               TSX1    HFC$LOCK
         1 002320   000000 011000                    NOP     0

     1213    10529    3              S$CU$->B$U.ASYNCH = S$CU$->B$U.ASYNCH | %U_BRK;

  10529  1 002321   000000 470400 xsym               LDP0    S$CU$
         1 002322   000001 236100                    LDQ     1,,PR0
         1 002323   000030 276000 xsym               ORQ     B_VECTNIL+24
         1 002324   000001 756100                    STQ     1,,PR0

     1214    10530                   %UNLOCK (G#=S_ASFGATE);

  10531  1 002325   000026 630400 2                  EPPR0   22
         1 002326   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002327   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002330   000000 011000                    NOP     0

     1215    10533    3              B$JIT.JUNK2 = B$JIT.JUNK2 & ~%JJ2_DFRBRK#;

  10533  1 002331   000000 470400 xsym               LDP0    B$JIT$
         1 002332   000321 220100                    LDX0    209,,PR0
         1 002333   777773 360003                    ANX0    -5,DU
         1 002334   000321 740100                    STX0    209,,PR0

     1216    10534    3              END;

     1217    10535
     1218    10536        /* Restore the privs we saved while going to the CP */
     1219    10537    2         B$JIT.PRIV.ACTIVE = B$JIT.PRIV.SAVED;

  10537  1 002335   000000 470400 xsym               LDP0    B$JIT$
         1 002336   000017 236100                    LDQ     15,,PR0
         1 002337   000013 756100                    STQ     11,,PR0
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:176  

     1220    10538        /*
     1221    10539           If LOGON is exiting, we decrement his UC and set
     1222    10540           the user's ACP to 0.
     1223    10541        */
     1224    10542    2         IF B$P$ -> B$P.NAME(S$CU$->B$U.ACP) = J_LOGON

  10542  1 002340   000000 471400 xsym               LDP1    S$CU$
         1 002341   100006 236100                    LDQ     6,,PR1
         1 002342   000022 772000                    QRL     18
         1 002343   000777 376007                    ANQ     511,DL
         1 002344   000021 402007                    MPY     17,DL
         1 002345   000003 736000                    QLS     3
         1 002346   000000 473400 xsym               LDP3    B$P$
         1 002347   000000 106506                    CMPC    fill='000'O
         1 002350   300032 000040                    ADSC9   26,Q,PR3                 cn=0,n=32
         1 002351   000000 000010 xsym               ADSC9   J_LOGON                  cn=0,n=8
         1 002352   002375 601000 1                  TNZ     s:10549

     1225    10543    3         THEN DO;

     1226    10544    3              B$P$ -> B$P.UC(S$CU$->B$U.ACP) = B$P$ -> B$P.UC(S$CU$->B$U.ACP) -1;

  10544  1 002353   100006 236100                    LDQ     6,,PR1
         1 002354   000022 772000                    QRL     18
         1 002355   000777 376007                    ANQ     511,DL
         1 002356   000021 402007                    MPY     17,DL
         1 002357   000001 736000                    QLS     1
         1 002360   000000 620006                    EAX0    0,QL
         1 002361   100006 236100                    LDQ     6,,PR1
         1 002362   000022 772000                    QRL     18
         1 002363   000777 376007                    ANQ     511,DL
         1 002364   000021 402007                    MPY     17,DL
         1 002365   000001 736000                    QLS     1
         1 002366   300000 235106                    LDA     0,QL,PR3
         1 002367   000001 135007                    SBLA    1,DL
         1 002370   300000 755110                    STA     0,X0,PR3
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:177  

     1227    10545    3              S$CU$->B$U.ACP=0;

  10545  1 002371   000000 471400 xsym               LDP1    S$CU$
         1 002372   000000 236003                    LDQ     0,DU
         1 002373   100006 552120                    STBQ    6,'20'O,PR1

     1228    10546    3              GOTO FREE_DS;

  10546  1 002374   002405 710000 1                  TRA     FREE_DS

     1229    10547    3              END;
     1230    10548
     1231    10549    2         IF (B$JIT.CPFLAGS1 & %CP_KEEPDS#)

  10549  1 002375   000143 236100                    LDQ     99,,PR0
         1 002376   000052 376000 0                  ANQ     ENOOVRLY+7
         1 002377   002405 600000 1                  TZE     FREE_DS

     1232    10550    3         THEN DO;

  10546  1 002400                       KEEP_DS      null
     1233    10551    3   KEEP_DS:   ;
     1234    10552    3              CALL JSA$RUNDSPC(%CPWSQ,0);

  10552  1 002400   000027 630400 2                  EPPR0   23
         1 002401   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002402   000000 701000 xent               TSX1    JSA$RUNDSPC
         1 002403   000000 011000                    NOP     0

     1235    10553    3              END;

  10553  1 002404   002411 710000 1                  TRA     s:10558

     1236    10554    3         ELSE DO;

  10546  1 002405                       FREE_DS      null
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:178  
     1237    10555    3   FREE_DS:   ;
     1238    10556    3              CALL JSA$RUNDSPC(%CPWSQ,1);

  10556  1 002405   000031 630400 2                  EPPR0   25
         1 002406   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002407   000000 701000 xent               TSX1    JSA$RUNDSPC
         1 002410   000000 011000                    NOP     0

     1239    10557    3              END;

     1240    10558    2         CALL JSS$RUNDSPC;

  10558  1 002411   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002412   000000 701000 xent               TSX1    JSS$RUNDSPC
         1 002413   000000 011000                    NOP     0

     1241    10559
     1242    10560    2         IF CPEXIT_RUND ~= 0

  10560  1 002414   200016 235100                    LDA     CPEXIT_RUND,,AUTO
         1 002415   002421 600000 1                  TZE     s:10565

     1243    10561    3         THEN DO;

     1244    10562    3              CALL JSR$RUNDOWN ALTRET(ZAPUSER);

  10562  1 002416   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002417   000000 701000 xent               TSX1    JSR$RUNDOWN
         1 002420   002447 702000 1                  TSX2    ZAPUSER

     1245    10563    3              END;

     1246    10564
     1247    10565    2         IF (B$JIT.CPFLAGS1 & %CP_JSTEP#)

  10565  1 002421   000000 470400 xsym               LDP0    B$JIT$
         1 002422   000143 236100                    LDQ     99,,PR0
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:179  
         1 002423   000047 376000 0                  ANQ     ENOOVRLY+4
         1 002424   002433 600000 1                  TZE     s:10577

     1248    10566    3         THEN DO;

     1249    10567    3              CALL JSF$CLSDCBS;            /*CLOSE ALL DCBS BUT M$UC             */

  10567  1 002425   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002426   000000 701000 xent               TSX1    JSF$CLSDCBS
         1 002427   000000 011000                    NOP     0

     1250    10568    3              CALL JSU$RSTLMS;

  10568  1 002430   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002431   000000 701000 xent               TSX1    JSU$RSTLMS
         1 002432   000000 011000                    NOP     0

     1251    10569    3              END;

     1252    10570        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:180  
     1253    10571        /*
     1254    10572           Now we are ready to perform the CPEXIT.
     1255    10573
     1256    10574           If no name was specified and all flags are reset, it is a
     1257    10575           request to delete this user.
     1258    10576        */
     1259    10577    2         IF ( (P0$=ADDR(NIL)) AND (P5$->CPFPT.FLAGS='0'B)  )

  10577  1 002433   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 002434   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002435   002452 601000 1                  TNZ     s:10593
         1 002436   200005 470500                    LDP0    P5$,,AUTO
         1 002437   000000 220100                    LDX0    0,,PR0
         1 002440   002452 601000 1                  TNZ     s:10593

     1260    10578    3         THEN DO;

  10569  1 002441                       DELUSR       null
     1261    10579    3   DELUSR:    ;
     1262    10580    3              S$CU$->B$U.FLG.CPIC = '0'B;

  10580  1 002441   000000 471400 xsym               LDP1    S$CU$
         1 002442   000033 236000 2                  LDQ     27
         1 002443   100000 356100                    ANSQ    0,,PR1

     1263    10581    3              CALL JSR$RUNDOWN ALTRET(ZAPUSER);

  10581  1 002444   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002445   000000 701000 xent               TSX1    JSR$RUNDOWN
         1 002446   002447 702000 1                  TSX2    ZAPUSER

     1264    10582    3   ZAPUSER:   CALL JSD$DELUSR;

  10582  1 002447   000002 631400 xsym  ZAPUSER      EPPR1   B_VECTNIL+2
         1 002450   000000 701000 xent               TSX1    JSD$DELUSR
         1 002451   000000 011000                    NOP     0

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:181  
     1265    10583                                      /*No RETURN: This user gets eaten by sched.     */
     1266    10584    3              END;                         /*DO IF LOGOFF                        */

     1267    10585
     1268    10586
     1269    10587        /*
     1270    10588           When the Command Processor has detected a condition that
     1271    10589           requires no more job steps be allowed, he has set the CPOFF
     1272    10590           bit in the FPT flags.  We record this fact in JIT.RNST and
     1273    10591           begin the abort process by calling JSE$ABORTX.
     1274    10592        */
     1275    10593    2         IF (CPEXIT_V.CPOFF#)

  10593  1 002452   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 002453   010000 316003                    CANQ    4096,DU
         1 002454   002475 600000 1                  TZE     s:10614

     1276    10594    3         THEN DO;

     1277    10595    3              B$JIT.RNST=%RS_OFF#;

  10595  1 002455   000000 470400 xsym               LDP0    B$JIT$
         1 002456   040000 236003                    LDQ     16384,DU
         1 002457   000314 552140                    STBQ    204,'40'O,PR0

     1278    10596    3              IF (CPEXIT_V.JERR.CODE# = 0)

  10596  1 002460   200073 236100                    LDQ     CPEXIT_V+1,,AUTO
         1 002461   777770 316007                    CANQ    -8,DL
         1 002462   002466 601000 1                  TNZ     s:10598

     1279    10597    3              THEN B$JIT.ERR=EOFF;

  10597  1 002463   000042 236000 0                  LDQ     EOFF
         1 002464   000012 756100                    STQ     10,,PR0
         1 002465   002467 710000 1                  TRA     s:10606

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:182  
     1280    10598    3              ELSE B$JIT.ERR = CPEXIT_V.JERR;

  10598  1 002466   000012 756100                    STQ     10,,PR0

     1281    10599        /*E*  ERROR:  JSP-E$OFF-E
     1282    10600              MESSAGE:  Your Command Processor has logged you off.
     1283    10601              DESCRIPTION: The Command Processor, when issuing an M$CPEXIT
     1284    10602               with OFF specified should also have JERR specified
     1285    10603               in the FPT.  Therefore the user should never see this
     1286    10604               error message.
     1287    10605        */
     1288    10606    3              B$JIT.CPFLAGS1=(B$JIT.CPFLAGS1 & %CP_USER#);

  10606  1 002467   000143 236100                    LDQ     99,,PR0
         1 002470   000053 376000 0                  ANQ     ENOOVRLY+8
         1 002471   000143 756100                    STQ     99,,PR0

     1289    10607    3              CALL JSE$ABORTX;             /* WILL NOT RETURN                    */

  10607  1 002472   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002473   000000 701000 xent               TSX1    JSE$ABORTX
         1 002474   000000 011000                    NOP     0

     1290    10608    3              END;

     1291    10609
     1292    10610        /*
     1293    10611           If the user has issued an M$LINK request with CP_CMD, go get the
     1294    10612           program now.
     1295    10613        */
     1296    10614    2         IF (B$JIT.CPFLAGS1 & %CP_LNKPMME#)

  10614  1 002475   000000 470400 xsym               LDP0    B$JIT$
         1 002476   000143 236100                    LDQ     99,,PR0
         1 002477   000050 376000 0                  ANQ     ENOOVRLY+5
         1 002500   002506 600000 1                  TZE     s:10624

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:183  
     1297    10615    3         THEN DO;

     1298    10616    3              B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~ %CP_LNKPMME#);

  10616  1 002501   000050 236000 0                  LDQ     ENOOVRLY+5
         1 002502   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 002503   000143 376100                    ANQ     99,,PR0
         1 002504   000143 756100                    STQ     99,,PR0

     1299    10617    3              GOTO DO_CPEXIT;

  10617  1 002505   002630 710000 1                  TRA     DO_CPEXIT

     1300    10618    3              END;
     1301    10619
     1302    10620        /*
     1303    10621           If the user has issued an M$YC request with simulate M$LINK set,
     1304    10622           also do that now.
     1305    10623        */
     1306    10624    2         IF (B$JIT.JUNK2 & %JJ2_CP_LINK#)

  10624  1 002506   000321 220100                    LDX0    209,,PR0
         1 002507   000010 360003                    ANX0    8,DU
         1 002510   002523 600000 1                  TZE     s:10646

     1307    10625    3         THEN DO;

     1308    10626    3              B$JIT.JUNK2 = (B$JIT.JUNK2 &~ %JJ2_CP_LINK#);

  10626  1 002511   000321 220100                    LDX0    209,,PR0
         1 002512   777767 360003                    ANX0    -9,DU
         1 002513   000321 740100                    STX0    209,,PR0

     1309    10627    3              IF (B$JIT.JUNK & %JJ_UDELTA#)

  10627  1 002514   000315 221100                    LDX1    205,,PR0
         1 002515   200000 361003                    ANX1    65536,DU
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:184  
         1 002516   002522 600000 1                  TZE     s:10629

     1310    10628    3              THEN S$CU$->B$U.FLG.DIC = '1'B;

  10628  1 002517   000000 471400 xsym               LDP1    S$CU$
         1 002520   100000 236003                    LDQ     32768,DU
         1 002521   100000 256100                    ORSQ    0,,PR1

     1311    10629    3              GOTO DO_CPEXIT;

  10629  1 002522   002630 710000 1                  TRA     DO_CPEXIT

     1312    10630    3              END;
     1313    10631
     1314    10632        /*
     1315    10633           If the user is at Job Step, the CPEXIT must be either to
     1316    10634           initiate the next program or to GET a saved program image.
     1317    10635
     1318    10636           If the CPEXIT specifies a GET request a call is made to JQS$GET
     1319    10637           to restored the SAVEd image.  If the restored process had been
     1320    10638           originally saved becuase of an M$SAVE service request, or because
     1321    10639           of an M$YC request where the command was 'SAVE', the user's IC
     1322    10640           is adjusted to bypass the ALTRET for that request.  In any case,
     1323    10641           a call is then made to JSE$ACP to cause the Command Processor to
     1324    10642           be re-entered.
     1325    10643
     1326    10644        */
     1327    10645
     1328    10646    2         IF (B$JIT.CPFLAGS1 & %CP_JSTEP#)

  10646  1 002523   000143 236100                    LDQ     99,,PR0
         1 002524   000047 376000 0                  ANQ     ENOOVRLY+4
         1 002525   002646 600000 1                  TZE     s:10683

     1329    10647    3         THEN DO;

     1330    10648    3              B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~ %CP_EXIT#);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:185  

  10648  1 002526   000054 236000 0                  LDQ     ENOOVRLY+9
         1 002527   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 002530   000143 376100                    ANQ     99,,PR0
         1 002531   000143 756100                    STQ     99,,PR0

     1331    10649    3              IF (CPEXIT_V.GETFLG#)

  10649  1 002532   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 002533   020000 316003                    CANQ    8192,DU
         1 002534   002630 600000 1                  TZE     DO_CPEXIT

     1332    10650    4              THEN DO;

     1333    10651    4                   CALL JQS$GET(P0$,P1$,P2$,P3$) ALTRET(NO_GET);

  10651  1 002535   200032 631500                    EPPR1   SAVEP+7,,AUTO
         1 002536   200103 451500                    STP1    USRIC+4,,AUTO
         1 002537   200031 633500                    EPPR3   SAVEP+6,,AUTO
         1 002540   200102 453500                    STP3    USRIC+3,,AUTO
         1 002541   200030 634500                    EPPR4   SAVEP+5,,AUTO
         1 002542   200101 454500                    STP4    USRIC+2,,AUTO
         1 002543   200027 635500                    EPPR5   SAVEP+4,,AUTO
         1 002544   200100 455500                    STP5    USRIC+1,,AUTO
         1 002545   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 002546   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 002547   000000 701000 xent               TSX1    JQS$GET
         1 002550   002621 702000 1                  TSX2    NO_GET

     1334    10652    4                   CALL UDN$MAGIC;

  10652  1 002551   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002552   000000 701000 xent               TSX1    UDN$MAGIC
         1 002553   000000 011000                    NOP     0

     1335    10653    4                   B$JIT.SVLDTF=( (B$JIT.SVLDTF & %SVL_DIC#) | %SVL_GET#);

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:186  
  10653  1 002554   000000 470400 xsym               LDP0    B$JIT$
         1 002555   000316 236100                    LDQ     206,,PR0
         1 002556   000033 736000                    QLS     27
         1 002557   200000 376003                    ANQ     65536,DU
         1 002560   000022 772000                    QRL     18
         1 002561   000000 620006                    EAX0    0,QL
         1 002562   001000 260003                    ORX0    512,DU
         1 002563   000000 636010                    EAQ     0,X0
         1 002564   000033 772000                    QRL     27
         1 002565   000316 552104                    STBQ    206,'04'O,PR0

     1336    10654    4                   S$CU$->B$U.FLG.DIC='0'B;

  10654  1 002566   000000 471400 xsym               LDP1    S$CU$
         1 002567   000034 236000 2                  LDQ     28
         1 002570   100000 356100                    ANSQ    0,,PR1

     1337    10655    4                   IF (  (B$JIT.CPFLAGS1 & %CP_YCPMME#)

  10655  1 002571   000143 236100                    LDQ     99,,PR0
         1 002572   000045 376000 0                  ANQ     ENOOVRLY+2
         1 002573   002604 601000 1                  TNZ     s:10657
         1 002574   000000 471400 xsym               LDP1    B_MPT
         1 002575   100001 236100                    LDQ     1,,PR1
         1 002576   370000 316003                    CANQ    126976,DU
         1 002577   002612 601000 1                  TNZ     s:10661
         1 002600   100001 236100                    LDQ     1,,PR1
         1 002601   007777 376003                    ANQ     4095,DU
         1 002602   000017 116003                    CMPQ    15,DU
         1 002603   002612 601000 1                  TNZ     s:10661

     1338    10656    4                     OR ( (B$SS.FPT.FCG = %FCG_JS#) AND (B$SS.FPT.CODE=%C$SAVE#) )  )
     1339    10657    4                   THEN IF B$SS.FPT.ALT='1'B

  10657  1 002604   000000 471400 xsym               LDP1    B_MPT
         1 002605   100001 234100                    SZN     1,,PR1
         1 002606   002612 605000 1                  TPL     s:10661
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:187  

     1340    10658    5                        THEN DO;

     1341    10659    5                             B$SS.IC=B$SS.IC+1;

  10659  1 002607   100004 220100                    LDX0    4,,PR1
         1 002610   000001 621010                    EAX1    1,X0
         1 002611   100004 741100                    STX1    4,,PR1

     1342    10660    5                             END;

     1343    10661    4                   B$JIT.CPFLAGS1 = ( (B$JIT.CPFLAGS1 & %CP_RESET#)

  10661  1 002612   000143 236100                    LDQ     99,,PR0
         1 002613   000055 376000 0                  ANQ     ENOOVRLY+10
         1 002614   000056 276000 0                  ORQ     ENOOVRLY+11
         1 002615   000143 756100                    STQ     99,,PR0

     1344    10662    4                     | %(CP_YCGET# | CP_YC#) );
     1345    10663    4                   CALL JSE$ACP;

  10663  1 002616   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002617   000000 701000 xent               TSX1    JSE$ACP
         1 002620   000000 011000                    NOP     0

  10661  1 002621                       NO_GET       null
     1346    10664    4   NO_GET:         ;
     1347    10665    4                   B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 & %CP_RESET#);

  10665  1 002621   000000 470400 xsym               LDP0    B$JIT$
         1 002622   000143 236100                    LDQ     99,,PR0
         1 002623   000055 376000 0                  ANQ     ENOOVRLY+10
         1 002624   000143 756100                    STQ     99,,PR0

     1348    10666    4                   CALL JSE$ABORTM;

  10666  1 002625   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:188  
         1 002626   000000 701000 xent               TSX1    JSE$ABORTM
         1 002627   000000 011000                    NOP     0

     1349    10667    4                   END;                    /*DO IF GET                           */

  10661  1 002630                       DO_CPEXIT    null
     1350    10668
     1351    10669        /*
     1352    10670           If this is a CPEXIT to initiate a new program, control is given
     1353    10671           to JST$GETPROG.
     1354    10672        */
     1355    10673    3   DO_CPEXIT: ;
     1356    10674    3              CALL JST$GETPROG(P0$,P1$,P2$,P3$,P4$);

  10674  1 002630   200033 630500                    EPPR0   SAVEP+8,,AUTO
         1 002631   200104 450500                    STP0    USRIC+5,,AUTO
         1 002632   200032 631500                    EPPR1   SAVEP+7,,AUTO
         1 002633   200103 451500                    STP1    USRIC+4,,AUTO
         1 002634   200031 633500                    EPPR3   SAVEP+6,,AUTO
         1 002635   200102 453500                    STP3    USRIC+3,,AUTO
         1 002636   200030 634500                    EPPR4   SAVEP+5,,AUTO
         1 002637   200101 454500                    STP4    USRIC+2,,AUTO
         1 002640   200027 635500                    EPPR5   SAVEP+4,,AUTO
         1 002641   200100 455500                    STP5    USRIC+1,,AUTO
         1 002642   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 002643   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 002644   000000 701000 xent               TSX1    JST$GETPROG
         1 002645   000000 011000                    NOP     0

     1357    10675    3              END;                         /*DO IF JOBSTEP*/

     1358    10676
     1359    10677        /*
     1360    10678           If the CPEXIT specifies we are to process the QUIT command, we
     1361    10679           must determine if the user said QUIT via M$YC.  If so, we call
     1362    10680           JSA$CPQUIT which will allow entry to DELTA and/or Exit Control.
     1363    10681           Otherwise, JSA$QUIT is called to bypass DELTA and Exit Control.
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:189  
     1364    10682        */
     1365    10683    2         IF (CPEXIT_V.QUIT#)

  10683  1 002646   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 002647   200000 316003                    CANQ    65536,DU
         1 002650   002673 600000 1                  TZE     s:10713

     1366    10684    3         THEN DO;

     1367    10685    3              IF (B$JIT.CPFLAGS1 & %CP_YCPMME#)

  10685  1 002651   000000 470400 xsym               LDP0    B$JIT$
         1 002652   000143 236100                    LDQ     99,,PR0
         1 002653   000045 376000 0                  ANQ     ENOOVRLY+2
         1 002654   002661 600000 1                  TZE     s:10687

     1368    10686    3              THEN CALL JSA$CPQUIT;

  10686  1 002655   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002656   000000 701000 xent               TSX1    JSA$CPQUIT
         1 002657   000000 011000                    NOP     0
         1 002660   002664 710000 1                  TRA     s:10688

     1369    10687    3              ELSE CALL JSA$QUIT;

  10687  1 002661   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002662   000000 701000 xent               TSX1    JSA$QUIT
         1 002663   000000 011000                    NOP     0

     1370    10688    3              B$JIT.CPFLAGS1=(B$JIT.CPFLAGS1 & %CP_USER#);

  10688  1 002664   000000 470400 xsym               LDP0    B$JIT$
         1 002665   000143 236100                    LDQ     99,,PR0
         1 002666   000053 376000 0                  ANQ     ENOOVRLY+8
         1 002667   000143 756100                    STQ     99,,PR0

     1371    10689    3              CALL JSE$ABORTX;             /* WILL NOT RETURN                    */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:190  

  10689  1 002670   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002671   000000 701000 xent               TSX1    JSE$ABORTX
         1 002672   000000 011000                    NOP     0

     1372    10690    3              END;

     1373    10691                                                /**/
     1374    10692        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:191  
     1375    10693        /*
     1376    10694           If the CPEXIT specifies we are to process the 'GO' command, the
     1377    10695           monitor first checks to see if this is a GO following restoring
     1378    10696           of a SAVEd program.  If so, processing continues as follows:
     1379    10697
     1380    10698              } If the program had been saved with the debugger in control,
     1381    10699              } SSU$DELTAGO is called to give control to the debugger.
     1382    10700              }
     1383    10701              } If the program that has been restored had requested exit
     1384    10702              } control for SAVE (see M$SCON) and that program is running
     1385    10703              } under control of a debugger, the GET XCON frame is moved
     1386    10704              } from the user's TCB to the debugger's TCB, and control is
     1387    10705              } given to the debugger.
     1388    10706              }
     1389    10707              } Otherwise no special action is required;  B$SS.IC will contain
     1390    10708              } the IC from either the IC from the time of the SAVE request
     1391    10709              } or the XCON IC.  In this case the GET XCON will be on the
     1392    10710              } user's TCB.
     1393    10711              }
     1394    10712        */
     1395    10713    2         IF (CPEXIT_V.CONT#)

  10713  1 002673   200072 234100                    SZN     CPEXIT_V,,AUTO
         1 002674   003223 605000 1                  TPL     s:10847

     1396    10714    3         THEN DO;

     1397    10715        /*
     1398    10716           Before continuing with the interrupted process the monitor will
     1399    10717           inspect all ECCBs in the Read-Only Segment to determine if
     1400    10718           any domain has requested control over the YC-GO sequence via M$EVENT.
     1401    10719           For each request that is found, a call is made to SSV$EVENT to
     1402    10720           build a DO List entry for this user.  When this user is ready to
     1403    10721           be put in execution, the Scheduler will find the Do List entry
     1404    10722           and cause his Event Handler to be entered.
     1405    10723        */
     1406    10724    4              DO I=0 TO 3;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:192  

  10724  1 002675   200006 450100                    STZ     I,,AUTO

     1407    10725    4                   T1$=ADDR(B$ROSEG$->B$ROSEG.ECCB(I));

  10725  1 002676   200006 236100                    LDQ     I,,AUTO
         1 002677   000006 402003                    MPY     6,DU
         1 002700   000024 036003                    ADLQ    20,DU
         1 002701   000000 036000 xsym               ADLQ    B$ROSEG$
         1 002702   200010 756100                    STQ     T1$,,AUTO

     1408    10726    4                   IF T1$->B$ECCB.FLAGS.YCSET

  10726  1 002703   200010 470500                    LDP0    T1$,,AUTO
         1 002704   000004 430100                    FSZN    4,,PR0
         1 002705   002734 605000 1                  TPL     s:10734

     1409    10727    5                   THEN DO;

     1410    10728    5                        J=%USERWSR-I;

  10728  1 002706   000007 235007                    LDA     7,DL
         1 002707   200006 135100                    SBLA    I,,AUTO
         1 002710   200007 755100                    STA     J,,AUTO

     1411    10729    5                        SAVEP.ECCS=%SUBC_YC#;

  10729  1 002711   000004 235007                    LDA     4,DL
         1 002712   200023 755100                    STA     SAVEP,,AUTO

     1412    10730    5                        SAVEP.EVID=0;

  10730  1 002713   200024 450100                    STZ     SAVEP+1,,AUTO

     1413    10731    5                        SAVEP.JERR='0'B;

  10731  1 002714   200025 450100                    STZ     SAVEP+2,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:193  

     1414    10732    5                        CALL SSV$EVENT(B$JIT.USER,J,SAVEP.ECCS,SAVEP.EVID,SAVEP.JERR);

  10732  1 002715   200025 631500                    EPPR1   SAVEP+2,,AUTO
         1 002716   200104 451500                    STP1    USRIC+5,,AUTO
         1 002717   200024 633500                    EPPR3   SAVEP+1,,AUTO
         1 002720   200103 453500                    STP3    USRIC+4,,AUTO
         1 002721   200023 634500                    EPPR4   SAVEP,,AUTO
         1 002722   200102 454500                    STP4    USRIC+3,,AUTO
         1 002723   200007 635500                    EPPR5   J,,AUTO
         1 002724   200101 455500                    STP5    USRIC+2,,AUTO
         1 002725   000000 236000 xsym               LDQ     B$JIT$
         1 002726   200000 036007                    ADLQ    65536,DL
         1 002727   200100 756100                    STQ     USRIC+1,,AUTO
         1 002730   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 002731   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 002732   000000 701000 xent               TSX1    SSV$EVENT
         1 002733   000000 011000                    NOP     0

     1415    10733    5                        END;

     1416    10734    4                   END;

  10734  1 002734   200006 054100                    AOS     I,,AUTO
         1 002735   200006 235100                    LDA     I,,AUTO
         1 002736   000003 115007                    CMPA    3,DL
         1 002737   002676 604400 1                  TMOZ    s:10725

     1417    10735
     1418    10736    3              IF (B$JIT.SVLDTF & %SVL_GET#)

  10736  1 002740   000000 470400 xsym               LDP0    B$JIT$
         1 002741   000316 236100                    LDQ     206,,PR0
         1 002742   000033 736000                    QLS     27
         1 002743   001000 376003                    ANQ     512,DU
         1 002744   003060 600000 1                  TZE     s:10782

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:194  
     1419    10737    4              THEN DO;

     1420    10738    4                   SGFLAG=B$JIT.SVLDTF;

  10738  1 002745   000316 236100                    LDQ     206,,PR0
         1 002746   000033 736000                    QLS     27
         1 002747   200015 756100                    STQ     SGFLAG,,AUTO

     1421    10739    4                   B$JIT.SVLDTF=(B$JIT.SVLDTF &~ %SVL_GET#);

  10739  1 002750   776000 376003                    ANQ     -1024,DU
         1 002751   000033 772000                    QRL     27
         1 002752   000316 552104                    STBQ    206,'04'O,PR0

     1422    10740                                                /*                                    */
     1423    10741    4                   IF (SGFLAG & %SVL_DIC#)

  10741  1 002753   200015 236100                    LDQ     SGFLAG,,AUTO
         1 002754   777000 376003                    ANQ     -512,DU
         1 002755   200000 376003                    ANQ     65536,DU
         1 002756   003046 601000 1                  TNZ     DELTA_GET

     1424    10742    4                   THEN GOTO DELTA_GET;
     1425    10743
     1426    10744    4                   IF (B$JIT.JUNK & %JJ_SCON#)

  10744  1 002757   000315 220100                    LDX0    205,,PR0
         1 002760   100000 360003                    ANX0    32768,DU
         1 002761   003060 600000 1                  TZE     s:10782

     1427    10745    5                   THEN DO;

     1428    10746    5                        IF (B$JIT.JUNK & %JJ_UDELTA#)

  10746  1 002762   000315 220100                    LDX0    205,,PR0
         1 002763   200000 360003                    ANX0    65536,DU
         1 002764   003060 600000 1                  TZE     s:10782
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:195  

     1429    10747    6                        THEN DO;

     1430    10748    7                             DO INHIBIT;

     1431    10749    7                                  B$LS$->B$MLS.MISC2=B$USERLS$->B$ULS.TCB;
             10749                                           /* USER TCB */

  10749  1 002765   000000 471600 xsym               LDP1  ! B$USERLS$
         1 002766   100036 237300                    LDAQ  ! 30,,PR1
         1 002767   000000 473600 xsym               LDP3  ! B$LS$
         1 002770   300260 757300                    STAQ  ! 176,,PR3

     1432    10750    7                                  B_MPT.LSDESC$->B$$DESCR=B$LS$->B$MLS.DBLS;
             10750                                           /* DELTA LS */

  10750  1 002771   000007 474600 xsym               LDP4  ! B_MPT+7
         1 002772   300064 237300                    LDAQ  ! 52,,PR3
         1 002773   400000 755300                    STA   ! 0,,PR4
         1 002774   400001 756300                    STQ   ! 1,,PR4

     1433    10751    7                                  CALL UDN$MAGICLS; /* DELTA DESCRs TO MAGIC     */

  10751  1 002775   000002 631600 xsym               EPPR1 ! B_VECTNIL+2
         1 002776   000000 701200 xent               TSX1  ! UDN$MAGICLS
         1 002777   000000 011200                    NOP   ! 0

     1434    10752    7                                  T1$=B$MISC2$; /* USER TCB POINTER              */

  10752  1 003000   000000 236200 xsym               LDQ   ! B$MISC2$
         1 003001   200010 756300                    STQ   ! T1$,,AUTO

     1435    10753    7                                 CALL UEP$MOVETCB (0,ADDR(NIL),T1$) ALTRET(D_TCB_FULL)
             10753                                           ;

  10753  1 003002   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 003003   200100 756300                    STQ   ! USRIC+1,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:196  
         1 003004   200010 630700                    EPPR0 ! T1$,,AUTO
         1 003005   200103 450700                    STP0  ! USRIC+4,,AUTO
         1 003006   200100 631700                    EPPR1 ! USRIC+1,,AUTO
         1 003007   200102 451700                    STP1  ! USRIC+3,,AUTO
         1 003010   000013 236200 2                  LDQ   ! 11
         1 003011   200101 756300                    STQ   ! USRIC+2,,AUTO
         1 003012   200101 630700                    EPPR0 ! USRIC+2,,AUTO
         1 003013   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         1 003014   000000 701200 xent               TSX1  ! UEP$MOVETCB
         1 003015   003333 702200 1                  TSX2  ! D_TCB_FULL

     1436    10754    7                                  END;     /* INHIBIT                            */

     1437    10755                                                /* Returns with T1$-> XCON Frame      */
     1438    10756    6                             B_MPT.LSDESC$->B$$DESCR=B$LS$->B$MLS.USERLS;

  10756  1 003016   000007 470400 xsym               LDP0    B_MPT+7
         1 003017   000000 471400 xsym               LDP1    B$LS$
         1 003020   100062 237100                    LDAQ    50,,PR1
         1 003021   000000 755100                    STA     0,,PR0
         1 003022   000001 756100                    STQ     1,,PR0

     1439    10757    6                             CALL UDN$MAGICLS;

  10757  1 003023   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003024   000000 701000 xent               TSX1    UDN$MAGICLS
         1 003025   000000 011000                    NOP     0

     1440    10758    6                             IF (T1$->B$XCON.CECCB.PROG='1'B)

  10758  1 003026   200010 470500                    LDP0    T1$,,AUTO
         1 003027   000100 234100                    SZN     64,,PR0
         1 003030   003034 605000 1                  TPL     s:10763

     1441    10759    7                             THEN DO;

     1442    10760    7                                  B_MPT.ECCB$->B$ECCB.XCONF.PROG='0'B;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:197  

  10760  1 003031   000005 471400 xsym               LDP1    B_MPT+5
         1 003032   000035 236000 2                  LDQ     29
         1 003033   100004 356100                    ANSQ    4,,PR1

     1443    10761    7                                  END;

     1444    10762                                                /* Get GET Frame off of user TCB      */
     1445    10763    6                             T1$=ADDR(NIL);

  10763  1 003034   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003035   200010 756100                    STQ     T1$,,AUTO

     1446    10764    6                             CALL UEP$CLEARONE(0,T1$);

  10764  1 003036   200010 630500                    EPPR0   T1$,,AUTO
         1 003037   200101 450500                    STP0    USRIC+2,,AUTO
         1 003040   000013 236000 2                  LDQ     11
         1 003041   200100 756100                    STQ     USRIC+1,,AUTO
         1 003042   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 003043   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003044   000000 701000 xent               TSX1    UEP$CLEARONE
         1 003045   000000 011000                    NOP     0

  10763  1 003046                       DELTA_GET    null
     1447    10765
     1448    10766    6   DELTA_GET:                ;
     1449    10767    6                             DATA1=%ECC_SAVLDT#;

  10767  1 003046   000136 235007                    LDA     94,DL
         1 003047   200004 755100                    STA     DATA1,,AUTO

     1450    10768    6                             CALL SSU$DELTAGO (DATA1,0);

  10768  1 003050   000013 236000 2                  LDQ     11
         1 003051   200101 756100                    STQ     USRIC+2,,AUTO
         1 003052   200004 630500                    EPPR0   DATA1,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:198  
         1 003053   200100 450500                    STP0    USRIC+1,,AUTO
         1 003054   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 003055   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003056   000000 701000 xent               TSX1    SSU$DELTAGO
         1 003057   000000 011000                    NOP     0

     1451    10769
     1452    10770    6                             END;          /*DO IF XCON - DELTA ASSOCIATED       */

     1453    10771    5                        END;               /*DO IF JJ_SCON#                      */

     1454    10772    4                   END;                    /* DO IF SVL_GET#                     */

     1455    10773        /*
     1456    10774           Next, the monitor checks to see if the CPEXIT is to continue after
     1457    10775           post association of a debugger.  If no debugger is associated
     1458    10776           a call is made to JST$GETPROG to associate it.  However, if a
     1459    10777           debugger is already associated, SSU$DELTAGO is called to enter
     1460    10778           the debugger at it's start address, unless the debugger was in
     1461    10779           control at the time of interruption.  In this case, the debugger's
     1462    10780           Break Control routine will be entered.
     1463    10781        */
     1464    10782    3              IF P4$ ~= ADDR(NIL)

  10782  1 003060   200033 236100                    LDQ     SAVEP+8,,AUTO
         1 003061   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003062   003200 600000 1                  TZE     JSP_CONT

     1465    10783    4              THEN DO;

     1466    10784    4                   IF S$CU$->B$U.DB = 0

  10784  1 003063   000000 470400 xsym               LDP0    S$CU$
         1 003064   000006 236100                    LDQ     6,,PR0
         1 003065   777000 316007                    CANQ    -512,DL
         1 003066   002630 600000 1                  TZE     DO_CPEXIT

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:199  
     1467    10785    4                   THEN GOTO DO_CPEXIT;
     1468    10786                                           /*    YC-DELTA when running under DELTA    */
     1469    10787    4                   B$JIT.JUNK = (B$JIT.JUNK | %JJ_UDELTA#);

  10787  1 003067   000000 471400 xsym               LDP1    B$JIT$
         1 003070   100315 220100                    LDX0    205,,PR1
         1 003071   200000 260003                    ORX0    65536,DU
         1 003072   100315 740100                    STX0    205,,PR1

     1470    10788    4                  B$USERLS$->B$ULNK.ECCB.FLGS = (B$USERLS$->B$ULNK.ECCB.FLGS | %DSXXX)
             10788                            ;

  10788  1 003073   000000 473400 xsym               LDP3    B$USERLS$
         1 003074   300034 236100                    LDQ     28,,PR3
         1 003075   000024 736000                    QLS     20
         1 003076   777000 376003                    ANQ     -512,DU
         1 003077   020000 276003                    ORQ     8192,DU
         1 003100   000024 772000                    QRL     20
         1 003101   300034 676100                    ERQ     28,,PR3
         1 003102   177600 376007                    ANQ     65408,DL
         1 003103   300034 656100                    ERSQ    28,,PR3

     1471    10789                  /* Set the under DELTA flags in case it was originally an ALIB.     */
     1472    10790    4                   SAVEP.ECCS=%SC_BYC#;

  10790  1 003104   000001 235007                    LDA     1,DL
         1 003105   200023 755100                    STA     SAVEP,,AUTO

     1473    10791    4                   SAVEP.EVID=0;

  10791  1 003106   200024 450100                    STZ     SAVEP+1,,AUTO

     1474    10792    4                   SAVEP.JERR=B$JIT.ERR;

  10792  1 003107   100012 236100                    LDQ     10,,PR1
         1 003110   200025 756100                    STQ     SAVEP+2,,AUTO

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:200  
     1475    10793    4                   SAVEP.P#=0;

  10793  1 003111   200026 450100                    STZ     SAVEP+3,,AUTO

     1476    10794    4                   DATA1=%ECC_INT#;

  10794  1 003112   000002 235007                    LDA     2,DL
         1 003113   200004 755100                    STA     DATA1,,AUTO

     1477    10795
     1478    10796    4                   IF B$SS.ISR.WSR = %DBWSR

  10796  1 003114   000000 474400 xsym               LDP4    B_MPT
         1 003115   400010 236100                    LDQ     8,,PR4
         1 003116   000160 376007                    ANQ     112,DL
         1 003117   000120 116007                    CMPQ    80,DL
         1 003120   003147 601000 1                  TNZ     s:10807

     1479    10797    5                   THEN DO;

     1480    10798                                      /* Go to DELTA BRK Routine if YC-DELTA when DIC */
     1481    10799    5                        CALL UDN$MAGICSS;

  10799  1 003121   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003122   000000 701000 xent               TSX1    UDN$MAGICSS
         1 003123   000000 011000                    NOP     0

     1482    10800
     1483    10801    5                        SSIC=B_MPT.ECCB$->B$ECCB.BRK;

  10801  1 003124   000005 470400 xsym               LDP0    B_MPT+5
         1 003125   000001 236100                    LDQ     1,,PR0
         1 003126   000022 772000                    QRL     18
         1 003127   200066 756100                    STQ     SSIC,,AUTO

     1484    10802    5                        CALL SST$SSFTCB(SSIC,DATA1,SAVEP,B_MPT.SS$,B_MPT.TCB$)

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:201  
  10802  1 003130   000036 236000 2                  LDQ     30
         1 003131   200104 756100                    STQ     USRIC+5,,AUTO
         1 003132   000037 236000 2                  LDQ     31
         1 003133   200103 756100                    STQ     USRIC+4,,AUTO
         1 003134   200023 631500                    EPPR1   SAVEP,,AUTO
         1 003135   200102 451500                    STP1    USRIC+3,,AUTO
         1 003136   200004 633500                    EPPR3   DATA1,,AUTO
         1 003137   200101 453500                    STP3    USRIC+2,,AUTO
         1 003140   200066 634500                    EPPR4   SSIC,,AUTO
         1 003141   200100 454500                    STP4    USRIC+1,,AUTO
         1 003142   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 003143   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 003144   000000 701000 xent               TSX1    SST$SSFTCB
         1 003145   003333 702000 1                  TSX2    D_TCB_FULL

     1485    10803    5                          ALTRET(D_TCB_FULL);
     1486    10804    5                        END;

  10804  1 003146   003200 710000 1                  TRA     JSP_CONT

     1487    10805    5                   ELSE DO;

     1488    10806                            /* Go to DELTA Start Addr if YC-DELTA when User or ASL IC */
     1489    10807    5                        IF (B$JIT.CPFLAGS1 & %CP_YCPMME#)

  10807  1 003147   100143 236100                    LDQ     99,,PR1
         1 003150   000045 376000 0                  ANQ     ENOOVRLY+2
         1 003151   003164 600000 1                  TZE     s:10813

     1490    10808    6                        THEN DO;

     1491    10809    6                             IF B$SS.FPT.ALT ~='0'B

  10809  1 003152   400001 234100                    SZN     1,,PR4
         1 003153   003157 605000 1                  TPL     s:10811

     1492    10810    6                             THEN B$SS.IC = B$SS.IC+1;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:202  

  10810  1 003154   400004 220100                    LDX0    4,,PR4
         1 003155   000001 621010                    EAX1    1,X0
         1 003156   400004 741100                    STX1    4,,PR4

     1493    10811    6                             B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~%CP_YCPMME#);

  10811  1 003157   000045 236000 0                  LDQ     ENOOVRLY+2
         1 003160   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 003161   100143 376100                    ANQ     99,,PR1
         1 003162   100143 756100                    STQ     99,,PR1

     1494    10812    6                             END;

  10812  1 003163   003170 710000 1                  TRA     s:10814

     1495    10813    5                        ELSE B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~ %CP_YC#);

  10813  1 003164   000051 236000 0                  LDQ     ENOOVRLY+6
         1 003165   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 003166   100143 376100                    ANQ     99,,PR1
         1 003167   100143 756100                    STQ     99,,PR1

     1496    10814    5                        CALL SSU$DELTAGO (DATA1,SAVEP);

  10814  1 003170   200023 635500                    EPPR5   SAVEP,,AUTO
         1 003171   200101 455500                    STP5    USRIC+2,,AUTO
         1 003172   200004 636500                    EPPR6   DATA1,,AUTO
         1 003173   200100 456500                    STP6    USRIC+1,,AUTO
         1 003174   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 003175   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003176   000000 701000 xent               TSX1    SSU$DELTAGO
         1 003177   000000 011000                    NOP     0

     1497    10815                                 /* DELTAGO will back Safe-Store to find user frame   */
     1498    10816    5                        END;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:203  
     1499    10817    4                   END;                    /*DO IF P4$ ~NIL                      */

  10811  1 003200                       JSP_CONT     null
     1500    10818        /*
     1501    10819           Finally, to return control to the interrupted process, a call is
     1502    10820           made to UDB$AUTO, if that process had been interrupted by the
     1503    10821           YC interrupt, where the Auto used by JSP$PMME will be released.
     1504    10822           If the Command Processor had been entered because of an M$YC Service
     1505    10823           Request, UDB$PMMEXIT is called to check for error conditions.
     1506    10824        */
     1507    10825    3   JSP_CONT:  ;
     1508    10826        /* Here we eventually want to call FMM$ASSMRG to merge assigns if  */
     1509    10827        /* We are coming back from the cp and a 'SET' command was done     */
     1510    10828        /* Between job STEPS: We need to define a new flag in cpflags.     */
     1511    10829    3              IF (B$JIT.CPFLAGS1 & %CP_YC#)

  10829  1 003200   000000 470400 xsym               LDP0    B$JIT$
         1 003201   000143 236100                    LDQ     99,,PR0
         1 003202   000051 376000 0                  ANQ     ENOOVRLY+6
         1 003203   003214 600000 1                  TZE     JSP_CONT2

     1512    10830    4              THEN DO;

     1513    10831    4                   B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~%CP_YC#);

  10831  1 003204   000051 236000 0                  LDQ     ENOOVRLY+6
         1 003205   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 003206   000143 376100                    ANQ     99,,PR0
         1 003207   000143 756100                    STQ     99,,PR0

     1514    10832    4                   CALL UDB$AUTO;          /*Flush auto and goto SSS$SEXIT       */

  10832  1 003210   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003211   000000 701000 xent               TSX1    UDB$AUTO
         1 003212   000000 011000                    NOP     0

     1515    10833    4                   END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:204  

  10833  1 003213   003223 710000 1                  TRA     s:10847

     1516    10834    4              ELSE DO;

  10831  1 003214                       JSP_CONT2    null
     1517    10835    4   JSP_CONT2:      ;
     1518    10836    4                   B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 & %CP_USER#);

  10836  1 003214   000000 470400 xsym               LDP0    B$JIT$
         1 003215   000143 236100                    LDQ     99,,PR0
         1 003216   000053 376000 0                  ANQ     ENOOVRLY+8
         1 003217   000143 756100                    STQ     99,,PR0

     1519    10837    4                   CALL UDB$PMMEXIT2;      /*Will not return                     */

  10837  1 003220   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003221   000000 701000 xent               TSX1    UDB$PMMEXIT2
         1 003222   000000 011000                    NOP     0

     1520    10838    4                   END;

     1521    10839    3              END;                         /* DO IF CONTINUE                     */

     1522    10840        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:205  
     1523    10841        /*
     1524    10842           If the CPEXIT specifies we are to ALTRET to the M$YC Service
     1525    10843           Request the error code is moved from the V area of the FPT to
     1526    10844           the JIT.  If the Command Processor didn't supply an error code
     1527    10845           we use a canned one.  Control is returned to the user via PMMEXIT.
     1528    10846        */
     1529    10847    2         IF (CPEXIT_V.ALTRTN#)

  10847  1 003223   200072 236100                    LDQ     CPEXIT_V,,AUTO
         1 003224   100000 316003                    CANQ    32768,DU
         1 003225   003310 600000 1                  TZE     s:10894

     1530    10848    3         THEN DO;

  10836  1 003226                       ALTRET_CPEX* null
     1531    10849    3   ALTRET_CPEXIT: ;
     1532    10850    3              IF (CPEXIT_V.JERR.CODE# = 0)

  10850  1 003226   200073 236100                    LDQ     CPEXIT_V+1,,AUTO
         1 003227   777770 316007                    CANQ    -8,DL
         1 003230   003233 601000 1                  TNZ     s:10859

     1533    10851    3              THEN CPEXIT_V.JERR = ECYALT;

  10851  1 003231   000026 236000 0                  LDQ     ECYALT
         1 003232   200073 756100                    STQ     CPEXIT_V+1,,AUTO

     1534    10852        /*E*  ERROR:  JSP-E$CYALT-E
     1535    10853              MESSAGE: Command Processor has signaled ALTRET to your M$YC Service Request.
     1536    10854              DESCRIPTION: The Command Processor, when issuing an M$CPEXIT
     1537    10855               with ALTRTN specified should also have JERR specified
     1538    10856               in the FPT.  Therefore the user should never see this
     1539    10857               error message.
     1540    10858        */
     1541    10859    3              IF (B$JIT.JUNK2 & %JJ2_CP_LINK#)

  10859  1 003233   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:206  
         1 003234   000321 220100                    LDX0    209,,PR0
         1 003235   000010 360003                    ANX0    8,DU
         1 003236   003246 600000 1                  TZE     s:10866

     1542    10860    4              THEN DO;

     1543    10861    4                   B$JIT.JUNK2 = (B$JIT.JUNK2 &~ %JJ2_CP_LINK#);

  10861  1 003237   000321 220100                    LDX0    209,,PR0
         1 003240   777767 360003                    ANX0    -9,DU
         1 003241   000321 740100                    STX0    209,,PR0

     1544    10862    4                   CALL JSR$RUNDOWN ALTRET(ZAPUSER);

  10862  1 003242   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003243   000000 701000 xent               TSX1    JSR$RUNDOWN
         1 003244   002447 702000 1                  TSX2    ZAPUSER

     1545    10863    4                   GOTO LNK_RTN;

  10863  1 003245   003256 710000 1                  TRA     LNK_RTN

     1546    10864    4                   END;
     1547    10865
     1548    10866    3              IF (B$JIT.CPFLAGS1 & %CP_LNKPMME#)

  10866  1 003246   000143 236100                    LDQ     99,,PR0
         1 003247   000050 376000 0                  ANQ     ENOOVRLY+5
         1 003250   003304 600000 1                  TZE     s:10880

     1549    10867    4              THEN DO;

     1550    10868    4                  B$JIT.CPFLAGS1 = (B$JIT.CPFLAGS1 &~ (%CP_LNKPMME# | %CP_BUFFULL#) );

  10868  1 003251   000050 236000 0                  LDQ     ENOOVRLY+5
         1 003252   000057 276000 0                  ORQ     ENOOVRLY+12
         1 003253   000027 676000 xsym               ERQ     B_VECTNIL+23
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:207  
         1 003254   000143 376100                    ANQ     99,,PR0
         1 003255   000143 756100                    STQ     99,,PR0

  10868  1 003256                       LNK_RTN      null
     1551    10869    4   LNK_RTN:        ;
     1552    10870    4                   B$JIT.USRERR = CPEXIT_V.JERR;

  10870  1 003256   200073 236100                    LDQ     CPEXIT_V+1,,AUTO
         1 003257   000000 470400 xsym               LDP0    B$JIT$
         1 003260   000144 756100                    STQ     100,,PR0

     1553    10871    4                   B$JIT.JUNK = (B$JIT.JUNK &~ %JJ_MLINKIP#);

  10871  1 003261   000315 220100                    LDX0    205,,PR0
         1 003262   777776 360003                    ANX0    -2,DU
         1 003263   000315 740100                    STX0    205,,PR0

     1554    10872
     1555    10873    4                   SGFLAG = B$JIT.SVLDTF;

  10873  1 003264   000316 236100                    LDQ     206,,PR0
         1 003265   000033 736000                    QLS     27
         1 003266   200015 756100                    STQ     SGFLAG,,AUTO

     1556    10874    4                   B$JIT.SVLDTF = '000'O;

  10874  1 003267   000000 236003                    LDQ     0,DU
         1 003270   000316 552104                    STBQ    206,'04'O,PR0

     1557    10875    4                   IF (SGFLAG & %SVL_LINK#)

  10875  1 003271   200015 236100                    LDQ     SGFLAG,,AUTO
         1 003272   777000 376003                    ANQ     -512,DU
         1 003273   020000 376003                    ANQ     8192,DU
         1 003274   003301 600000 1                  TZE     s:10877

     1558    10876    4                   THEN CALL JLL$RTN;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:208  

  10876  1 003275   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003276   000000 701000 xent               TSX1    JLL$RTN
         1 003277   000000 011000                    NOP     0
         1 003300   003304 710000 1                  TRA     s:10880

     1559    10877    4                   ELSE CALL JSE$ACP;

  10877  1 003301   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003302   000000 701000 xent               TSX1    JSE$ACP
         1 003303   000000 011000                    NOP     0

     1560    10878    4                   END;

     1561    10879
     1562    10880    3              B$JIT.ERR = CPEXIT_V.JERR;

  10880  1 003304   200073 236100                    LDQ     CPEXIT_V+1,,AUTO
         1 003305   000000 470400 xsym               LDP0    B$JIT$
         1 003306   000012 756100                    STQ     10,,PR0

     1563    10881    3              GOTO JSP_CONT;

  10881  1 003307   003200 710000 1                  TRA     JSP_CONT

     1564    10882    3              END;
     1565    10883
     1566    10884        /*
     1567    10885           If the CPEXIT specifies that the currently interrupted process
     1568    10886           is to be SAVEd, a call is made to an internal subroutine
     1569    10887           (DO_SAVE) to accomplish this.  If the Command Processor had
     1570    10888           received this SAVE request via an M$YC Service Request, control
     1571    10889           is returned to the user by a call to UDB$PMMEXIT which will
     1572    10890           check for error conditions and possibly ALTRETing to the user.
     1573    10891           Otherwise the SAVE request was made following a Control-Y and
     1574    10892           so a call is made to JSE$ACP to re-enter the Command Processor.
     1575    10893        */
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:209  
     1576    10894    2         IF (CPEXIT_V.SAVEFLG#)

  10894  1 003310   040000 316003                    CANQ    16384,DU
         1 003311   003331 600000 1                  TZE     SUA_CPEXIT

     1577    10895    3         THEN DO;

     1578    10896    3              SGFLAG=%SVL_YCSAVE#;

  10896  1 003312   002000 236003                    LDQ     1024,DU
         1 003313   200015 756100                    STQ     SGFLAG,,AUTO

     1579    10897    3              CALL DO_SAVE(SGFLAG) ALTRET(NO_SAVE);

  10897  1 003314   200015 630500                    EPPR0   SGFLAG,,AUTO
         1 003315   200075 450500                    STP0    CPEXIT_V+3,,AUTO
         1 003316   004352 701000 1                  TSX1    DO_SAVE
         1 003317   003320 702000 1                  TSX2    NO_SAVE

  10896  1 003320                       NO_SAVE      null
     1580    10898    3   NO_SAVE:   ;
     1581    10899    3              IF (B$JIT.CPFLAGS1 & %CP_YCPMME#)

  10899  1 003320   000000 470400 xsym               LDP0    B$JIT$
         1 003321   000143 236100                    LDQ     99,,PR0
         1 003322   000045 376000 0                  ANQ     ENOOVRLY+2
         1 003323   003214 601000 1                  TNZ     JSP_CONT2

     1582    10900    3              THEN GOTO JSP_CONT2;
     1583    10901    4              ELSE DO;

     1584    10902    4                   B$JIT.USRERR=B$JIT.ERR;

  10902  1 003324   000012 236100                    LDQ     10,,PR0
         1 003325   000144 756100                    STQ     100,,PR0

     1585    10903    4                   CALL JSE$ACP;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:210  

  10903  1 003326   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003327   000000 701000 xent               TSX1    JSE$ACP
         1 003330   000000 011000                    NOP     0

     1586    10904    4                   END;

     1587    10905    3              END;

  10902  1 003331                       SUA_CPEXIT   null
     1588    10906                                                /*                                    */
     1589    10907             /* TO GET HERE-WE HAVE FAILED TO FIND FAULT WITH THE
     1590    10908                M$CPEXIT & HAVE FAILED TO ANLZ WHAT IBEX WANTS US TO DO */
     1591    10909    2   SUA_CPEXIT: ;
     1592    10910    2         CALL SC_CPEXIT;

  10910  1 003331   000000 713400 xsym               CLIMB   SC_CPEXIT
         1 003332   000000 600000 xsid               climb   nvectors=         0

  10902  1 003333                       D_TCB_FULL   null
     1593    10911        /*S*   SCREECH_CODE:   JSP-S$CPEXIT
     1594    10912               TYPE:  SUA
     1595    10913               MESSAGE:   JSP$PMME failed to analyze the M$CPEXIT
     1596    10914        */
     1597    10915
     1598    10916        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:211  
     1599    10917
     1600    10918
     1601    10919                                           /* ALTRET FROM SST$SSFTCB USING DELTAS TCB */
     1602    10920    2   D_TCB_FULL: ;
     1603    10921    2         CALL SC_JSPDTCB;

  10921  1 003333   000000 713400 xsym               CLIMB   SC_JSPDTCB
         1 003334   000000 600000 xsid               climb   nvectors=         0
         1 003335   004033 710000 1                  TRA     s:11135

     1604    10922        /*S*   SCREECH_CODE:   JSP-S$DTCB
     1605    10923               TYPE:   SUA
     1606    10924               MESSAGE:  DELTA's TCB is full (JSP$PMME)
     1607    10925               REMARKS:  Cannot get space in DELTA's TCB for one of
     1608    10926                         the following conditions:
     1609    10927
     1610    10928                         a)  The user has hit Control-Y and asked
     1611    10929                             for DELTA when DELTA is in control.
     1612    10930
     1613    10931                         b)  Restoring a SAVEd file (GET) when the
     1614    10932                             program that had been saved was running
     1615    10933                             under DELTA.
     1616    10934        */
     1617    10935                                                /*                                    */
     1618    10936        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:212  
     1619    10937        /*************************************************************
     1620    10938         *                                                           *
     1621    10939         *                        M$SCREECH                          *
     1622    10940         *                                                           *
     1623    10941         *************************************************************/
     1624    10942
     1625    10943    2       CASE(%C$SCREECH#);

     1626    10944
     1627    10945    2         MSCODE = B$PS0$->MPARAM;

  10945  1 003336   000000 471400 xsym               LDP1    B$PS0$
         1 003337   100000 237100                    LDAQ    0,,PR1
         1 003340   200020 757100                    STAQ    MSCODE,,AUTO

     1628    10946        /* Users that are not system ghosts are limited to SNAP.
     1629    10947           Special Shared Processors are limited to SUA or SNAP.
     1630    10948           System Ghosts can specify any severity.
     1631    10949        */
     1632    10950    2         IF (B$SS.ISR.WSR  = %USERWSR)

  10950  1 003341   000000 473400 xsym               LDP3    B_MPT
         1 003342   300010 236100                    LDQ     8,,PR3
         1 003343   000160 376007                    ANQ     112,DL
         1 003344   000160 116007                    CMPQ    112,DL
         1 003345   003356 601000 1                  TNZ     s:10957

     1633    10951    3         THEN DO;

     1634    10952    3              IF S_CUN > S_MING

  10952  1 003346   000000 236000 xsym               LDQ     S_CUN
         1 003347   000000 116000 xsym               CMPQ    S_MING
         1 003350   003376 604400 1                  TMOZ    s:10963

     1635    10953    3              THEN MSCODE.SEV = 5;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:213  
  10953  1 003351   200020 236100                    LDQ     MSCODE,,AUTO
         1 003352   000040 376000 2                  ANQ     32
         1 003353   000005 276007                    ORQ     5,DL
         1 003354   200020 756100                    STQ     MSCODE,,AUTO

     1636    10954    3              ELSE ;
     1637    10955    3              END;

  10955  1 003355   003376 710000 1                  TRA     s:10963

     1638    10956    3         ELSE DO;

     1639    10957    3              IF MSCODE.SEV >6

  10957  1 003356   200020 236100                    LDQ     MSCODE,,AUTO
         1 003357   000007 376007                    ANQ     7,DL
         1 003360   000007 116007                    CMPQ    7,DL
         1 003361   003366 602000 1                  TNC     s:10959

     1640    10958    3              THEN MSCODE.SEV=6;

  10958  1 003362   200020 236100                    LDQ     MSCODE,,AUTO
         1 003363   000040 376000 2                  ANQ     32
         1 003364   000006 276007                    ORQ     6,DL
         1 003365   200020 756100                    STQ     MSCODE,,AUTO

     1641    10959    3              IF MSCODE.SEV < 5

  10959  1 003366   200020 236100                    LDQ     MSCODE,,AUTO
         1 003367   000007 376007                    ANQ     7,DL
         1 003370   000005 116007                    CMPQ    5,DL
         1 003371   003376 603000 1                  TRC     s:10963

     1642    10960    3              THEN MSCODE.SEV=5;

  10960  1 003372   200020 236100                    LDQ     MSCODE,,AUTO
         1 003373   000040 376000 2                  ANQ     32
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:214  
         1 003374   000005 276007                    ORQ     5,DL
         1 003375   200020 756100                    STQ     MSCODE,,AUTO

     1643    10961    3              END;

     1644    10962
     1645    10963    2         IF MSCODE.AUSER='1'B

  10963  1 003376   200021 236100                    LDQ     MSCODE+1,,AUTO
         1 003377   000001 316007                    CANQ    1,DL
         1 003400   003431 600000 1                  TZE     s:10977

     1646    10964    3         THEN DO;

     1647    10965    3              IF B$PSEG.P0.BOUND < 15 THEN GOTO BAD_USR;

  10965  1 003401   000003 474400 xsym               LDP4    B_MPT+3
         1 003402   400000 236100                    LDQ     0,,PR4
         1 003403   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 003404   000041 116000 2                  CMPQ    33
         1 003405   003425 602000 1                  TNC     BAD_USR

     1648    10966    3              SCRUSR# = B$PS0$->B$SNAPUSR.U#;

  10966  1 003406   100002 236100                    LDQ     2,,PR1
         1 003407   000033 772000                    QRL     27
         1 003410   000033 736000                    QLS     27
         1 003411   200022 756100                    STQ     SCRUSR#,,AUTO

     1649    10967    3              IF (SCRUSR# > B_MUAIS) OR (B$USRT$->B$USER.US(SCRUSR#) = %SS_SNULL)

  10967  1 003412   200022 236100                    LDQ     SCRUSR#,,AUTO
         1 003413   000033 772000                    QRL     27
         1 003414   000000 116000 xsym               CMPQ    B_MUAIS
         1 003415   003417 600000 1                  TZE     s:10967+5
         1 003416   003425 603000 1                  TRC     BAD_USR
         1 003417   000004 736000                    QLS     4
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:215  
         1 003420   000000 475400 xsym               LDP5    B$USRT$
         1 003421   500011 236106                    LDQ     9,QL,PR5
         1 003422   770000 376003                    ANQ     -4096,DU
         1 003423   300000 116003                    CMPQ    98304,DU
         1 003424   003432 601000 1                  TNZ     s:10978

     1650    10968    4              THEN DO;

  10967  1 003425                       BAD_USR      null
     1651    10969    4   BAD_USR:        ;
     1652    10970    4                   B$JIT.ERR=ESNAPU;

  10970  1 003425   000035 236000 0                  LDQ     ESNAPU
         1 003426   000000 475400 xsym               LDP5    B$JIT$
         1 003427   500012 756100                    STQ     10,,PR5

     1653    10971    4                   RETURN;

  10971  1 003430   000000 702200 xent               TSX2  ! X66_ARET

     1654    10972    4                   END;
     1655    10973        /*E*   ERROR:   JSP-E$SNAPUSR-E
     1656    10974               MESSAGE: User specified via M$SCREECH FPT does not exist.
     1657    10975        */
     1658    10976    3              END;
     1659    10977    2         ELSE SCRUSR# = 0;

  10977  1 003431   200022 450100                    STZ     SCRUSR#,,AUTO

     1660    10978    3         DO I=1 TO B$ROSEG$->B$ROSEG.NUMDCBS;

  10978  1 003432   000001 236007                    LDQ     1,DL
         1 003433   200006 756100                    STQ     I,,AUTO
         1 003434   003467 710000 1                  TRA     s:10989+1

     1661    10979    3              T1$=B$ROSEG$->B$ROSEG.DCBPTR$->PTR$(I);

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:216  
  10979  1 003435   000000 470400 xsym               LDP0    B$ROSEG$
         1 003436   000000 471500                    LDP1    0,,PR0
         1 003437   200006 720100                    LXL0    I,,AUTO
         1 003440   100000 236110                    LDQ     0,X0,PR1
         1 003441   200010 756100                    STQ     T1$,,AUTO

     1662    10980    3              IF T1$~=ADDR(NIL)

  10980  1 003442   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003443   003466 600000 1                  TZE     s:10989

     1663    10981    4              THEN DO;

     1664    10982    4                   IF T1$->F$DCB.FCD AND T1$->F$DCB.ASN=%COMGROUP#

  10982  1 003444   200010 471500                    LDP1    T1$,,AUTO
         1 003445   100031 236100                    LDQ     25,,PR1
         1 003446   020000 316007                    CANQ    8192,DL
         1 003447   003466 600000 1                  TZE     s:10989
         1 003450   100032 236100                    LDQ     26,,PR1
         1 003451   777000 376007                    ANQ     -512,DL
         1 003452   004000 116007                    CMPQ    2048,DL
         1 003453   003466 601000 1                  TNZ     s:10989

     1665    10983    5                   THEN DO;

     1666    10984    5                        T2$=NK$LDCT$(T1$->F$DCB.LDCTX)->NK$LDCT.CG$;

  10984  1 003454   100051 221100                    LDX1    41,,PR1
         1 003455   000000 473400 xsym               LDP3    N$DCT$$
         1 003456   300000 474511                    LDP4    0,X1,PR3
         1 003457   400027 236100                    LDQ     23,,PR4
         1 003460   200011 756100                    STQ     T2$,,AUTO

     1667    10985    5                        CALL KQX$LDASR(T2$->B$PTR);

  10985  1 003461   200011 630500                    EPPR0   T2$,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:217  
         1 003462   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003463   000000 701000 xent               TSX1    KQX$LDASR
         1 003464   000000 011000                    NOP     0

     1668    10986    5                        GOTO END_FND_CG;

  10986  1 003465   003474 710000 1                  TRA     END_FND_CG

     1669    10987    5                        END;
     1670    10988    4                   END;
     1671    10989    3              END;

  10989  1 003466   200006 054100                    AOS     I,,AUTO
         1 003467   000000 470400 xsym               LDP0    B$ROSEG$
         1 003470   000002 236100                    LDQ     2,,PR0
         1 003471   000022 772000                    QRL     18
         1 003472   200006 116100                    CMPQ    I,,AUTO
         1 003473   003435 605000 1                  TPL     s:10979

     1672    10990    2   END_FND_CG:
     1673    10991    2         I=1;

  10991  1 003474   000001 235007       END_FND_CG   LDA     1,DL
         1 003475   200006 755100                    STA     I,,AUTO

     1674    10992    2         CALL HFF$NILERASE(I) ALTRET(NO_JITERR);

  10992  1 003476   200006 630500                    EPPR0   I,,AUTO
         1 003477   200100 450500                    STP0    USRIC+1,,AUTO
         1 003500   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 003501   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003502   000000 701000 xent               TSX1    HFF$NILERASE
         1 003503   003510 702000 1                  TSX2    NO_JITERR

     1675    10993    2         B$JIT.ERR=B$PS1$->MPARAM.ERR;

  10993  1 003504   000000 470400 xsym               LDP0    B$PS1$
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:218  
         1 003505   000000 236100                    LDQ     0,,PR0
         1 003506   000000 471400 xsym               LDP1    B$JIT$
         1 003507   100012 756100                    STQ     10,,PR1

  10993  1 003510                       NO_JITERR    null
     1676    10994    2   NO_JITERR: ;
     1677    10995    2         MSCODE.MON='0'B;

  10995  1 003510   000042 236000 2                  LDQ     34
         1 003511   200020 356100                    ANSQ    MSCODE,,AUTO

     1678    10996    2         MSCODE.CUSR='1'B;

  10996  1 003512   100000 236007                    LDQ     32768,DL
         1 003513   200021 256100                    ORSQ    MSCODE+1,,AUTO

     1679    10997    3         DO INHIBIT;

     1680    10998    3              SC_USER.RC = MSCODE;

  10998  1 003514   200020 237300                    LDAQ  ! MSCODE,,AUTO
         1 003515   000000 755200 xsym               STA   ! SC_USER
         1 003516   000001 756200 xsym               STQ   ! SC_USER+1

     1681    10999    3              SC_USER.USER# = SCRUSR#;

  10999  1 003517   200022 236300                    LDQ   ! SCRUSR#,,AUTO
         1 003520   000002 552240 xsym               STBQ  ! SC_USER+2,'40'O

     1682    11000    3              CALL IRM$USER$SCREECH;

  11000  1 003521   000002 631600 xsym               EPPR1 ! B_VECTNIL+2
         1 003522   000000 701200 xent               TSX1  ! IRM$USER$SCREECH
         1 003523   000000 011200                    NOP   ! 0

     1683    11001    3              IF IRM_NODUMP ~='0'B

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:219  
  11001  1 003524   000000 235200 xsym               LDA   ! IRM_NODUMP
         1 003525   003532 600200 1                  TZE   ! s:11010

     1684    11002    4              THEN DO;

     1685    11003    4                   B$JIT.ERR=EDFBUSY;

  11003  1 003526   000036 236200 0                  LDQ   ! EDFBUSY
         1 003527   000000 470600 xsym               LDP0  ! B$JIT$
         1 003530   000012 756300                    STQ   ! 10,,PR0

     1686    11004    4                   GOTO NO_COUNT;

  11004  1 003531   003566 710200 1                  TRA   ! NO_COUNT

     1687    11005    4                   END;
     1688    11006        /*E*   ERROR:   JSP-E$DFBUSY-0
     1689    11007               MESSAGE:  System dump file busy-no file written
     1690    11008        */
     1691    11009    4              ELSE DO;

     1692    11010    4                   B$JIT.ERR='0'B;

  11010  1 003532   000000 470600 xsym               LDP0  ! B$JIT$
         1 003533   000012 450300                    STZ   ! 10,,PR0

     1693    11011    4                   J=IRM_ASCOUNT;

  11011  1 003534   000000 236200 xsym               LDQ   ! IRM_ASCOUNT
         1 003535   200007 756300                    STQ   ! J,,AUTO

     1694    11012    4                   END;

     1695    11013    3              CALL HFF$NILERASE(2) ALTRET(NO_COUNT);

  11013  1 003536   000012 630600 2                  EPPR0 ! 10
         1 003537   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:220  
         1 003540   000000 701200 xent               TSX1  ! HFF$NILERASE
         1 003541   003566 702200 1                  TSX2  ! NO_COUNT

     1696    11014    3              IF B$PSEG.P2.BOUND < 10

  11014  1 003542   000003 470600 xsym               LDP0  ! B_MPT+3
         1 003543   000004 236300                    LDQ   ! 4,,PR0
         1 003544   000034 376200 xsym               ANQ   ! B_VECTNIL+28
         1 003545   000043 116200 2                  CMPQ  ! 35
         1 003546   003553 603200 1                  TRC   ! s:11019

     1697    11015    4              THEN DO;

     1698    11016    4                   B$JIT.ERR = EBADVECT2;

  11016  1 003547   000007 236200 0                  LDQ   ! EBADVECT2
         1 003550   000000 471600 xsym               LDP1  ! B$JIT$
         1 003551   100012 756300                    STQ   ! 10,,PR1

     1699    11017    4                   RETURN;

  11017  1 003552   000000 702200 xent               TSX2  ! X66_ARET

     1700    11018    4                   END;
     1701    11019    3              B$PS2$->DF_NAME.L=10;

  11019  1 003553   000000 471600 xsym               LDP1  ! B$PS2$
         1 003554   012000 236203                    LDQ   ! 5120,DU
         1 003555   100000 552340                    STBQ  ! 0,'40'O,PR1

     1702    11020    3              B$PS2$->DF_NAME.N1=':DF';

  11020  1 003556   000060 236200 0                  LDQ   ! ENOOVRLY+13
         1 003557   000011 772200                    QRL   ! 9
         1 003560   100000 552334                    STBQ  ! 0,'34'O,PR1

     1703    11021    3              B$PS2$->DF_NAME.MONID4=B_SITEINFO.VERSION#;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:221  

  11021  1 003561   000064 236200 xsym               LDQ   ! B_SITEINFO+52
         1 003562   100001 756300                    STQ   ! 1,,PR1

     1704    11022    3              CALL BINCHAR(B$PS2$->DF_NAME.DUMPC,IRM_ASCOUNT);

  11022  1 003563   000100 301600                    BTD   !
         1 003564   000000 000004 xsym               NDSC9   IRM_ASCOUNT              cn=0,s=lsgnf,sf=0,n=4
         1 003565   100002 030003                    NDSC9   2,,PR1                   cn=0,s=nosgn,sf=0,n=3

  11022  1 003566                       NO_COUNT     null
     1705    11023    3   NO_COUNT:  ;
     1706    11024    3              END;

     1707    11025    2         RETURN;

  11025  1 003566   000000 702200 xent               TSX2  ! X66_ARET

     1708    11026
     1709    11027        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:222  
     1710    11028        /*************************************************************
     1711    11029         *                                                           *
     1712    11030         *                        M$INTRTN                           *
     1713    11031         *                                                           *
     1714    11032         *************************************************************/
     1715    11033
     1716    11034    2       CASE(%C$INTRTN#);

     1717    11035    2         IF B$SS.ISR.WSR ~= %ASLWSR

  11035  1 003567   000000 471400 xsym               LDP1    B_MPT
         1 003570   100010 236100                    LDQ     8,,PR1
         1 003571   000160 376007                    ANQ     112,DL
         1 003572   000140 116007                    CMPQ    96,DL
         1 003573   003600 600000 1                  TZE     s:11040

     1718    11036    3         THEN DO;

     1719    11037    3              B$JIT.ERR=EDOMAIN;

  11037  1 003574   000014 236000 0                  LDQ     EDOMAIN
         1 003575   000000 473400 xsym               LDP3    B$JIT$
         1 003576   300012 756100                    STQ     10,,PR3

     1720    11038    3              RETURN;

  11038  1 003577   000000 702200 xent               TSX2  ! X66_ARET

     1721    11039    3              END;
     1722    11040    2         CALL UDB$CALCOMP;

  11040  1 003600   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003601   000000 701000 xent               TSX1    UDB$CALCOMP
         1 003602   000000 011000                    NOP     0

     1723    11041    2         CALL JSS$RUNDSPC;                 /*Flush IDS from Safe-Store           */

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:223  
  11041  1 003603   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003604   000000 701000 xent               TSX1    JSS$RUNDSPC
         1 003605   000000 011000                    NOP     0

     1724    11042    2         CALL SSR$RUE(%SS_CBK);

  11042  1 003606   000044 630400 2                  EPPR0   36
         1 003607   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003610   000000 701000 xent               TSX1    SSR$RUE
         1 003611   000000 011000                    NOP     0

     1725    11043    2         CALL UDB$AUTO;

  11043  1 003612   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003613   000000 701000 xent               TSX1    UDB$AUTO
         1 003614   000000 011000                    NOP     0
         1 003615   004033 710000 1                  TRA     s:11135

     1726    11044
     1727    11045        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:224  
     1728    11046        /*************************************************************
     1729    11047         *                                                           *
     1730    11048         *                        M$XCONRTN                          *
     1731    11049         *                                                           *
     1732    11050         *************************************************************/
     1733    11051
     1734    11052    2       CASE(%C$XCONRTN#);

     1735    11053    2         IF B$SS.ISR.WSR = %USERWSR

  11053  1 003616   000000 471400 xsym               LDP1    B_MPT
         1 003617   100010 236100                    LDQ     8,,PR1
         1 003620   000160 376007                    ANQ     112,DL
         1 003621   000160 116007                    CMPQ    112,DL
         1 003622   003627 601000 1                  TNZ     s:11059

     1736    11054    3         THEN DO;

     1737    11055    3              B$JIT.ERR=EDOMAIN;

  11055  1 003623   000014 236000 0                  LDQ     EDOMAIN
         1 003624   000000 473400 xsym               LDP3    B$JIT$
         1 003625   300012 756100                    STQ     10,,PR3

     1738    11056    3              RETURN;

  11056  1 003626   000000 702200 xent               TSX2  ! X66_ARET

     1739    11057    3              END;
     1740    11058                                                /*                                    */
     1741    11059    2         IF (B$JIT.XCONF & %XC_URND#)

  11059  1 003627   000000 473400 xsym               LDP3    B$JIT$
         1 003630   300316 236100                    LDQ     206,,PR3
         1 003631   777000 376003                    ANQ     -512,DU
         1 003632   004000 376003                    ANQ     2048,DU
         1 003633   003642 600000 1                  TZE     s:11066
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:225  

     1742    11060    3         THEN DO;

     1743    11061    3              CALL UDB$CALCOMP;

  11061  1 003634   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003635   000000 701000 xent               TSX1    UDB$CALCOMP
         1 003636   000000 011000                    NOP     0

     1744    11062    3              CALL JSE$ABORTX;

  11062  1 003637   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003640   000000 701000 xent               TSX1    JSE$ABORTX
         1 003641   000000 011000                    NOP     0

     1745    11063    3              END;

     1746    11064                            /* Someone is confused--ABORTX should clean things up     */
     1747    11065                                                /*                                    */
     1748    11066    2         J=0;                              /* Set dont clean Entry Descriptor    */

  11066  1 003642   200007 450100                    STZ     J,,AUTO

     1749    11067    2         CALL HFF$NILERASE(0) ALTRET(NO_XFPT);

  11067  1 003643   000013 630400 2                  EPPR0   11
         1 003644   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003645   000000 701000 xent               TSX1    HFF$NILERASE
         1 003646   003654 702000 1                  TSX2    NO_XFPT

     1750    11068    2         IF B$PS0$->FPT$XCONRTN_V.NOENTRY='1'B

  11068  1 003647   000000 470400 xsym               LDP0    B$PS0$
         1 003650   000000 234100                    SZN     0,,PR0
         1 003651   003654 605000 1                  TPL     NO_XFPT

     1751    11069    2         THEN J=1;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:226  

  11069  1 003652   000001 235007                    LDA     1,DL
         1 003653   200007 755100                    STA     J,,AUTO

  11068  1 003654                       NO_XFPT      null
     1752    11070    2   NO_XFPT: ;
     1753    11071    2         CALL HFF$NILERASE(1) ALTRET(NO_XFPT2);

  11071  1 003654   000016 630400 2                  EPPR0   14
         1 003655   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003656   000000 701000 xent               TSX1    HFF$NILERASE
         1 003657   003665 702000 1                  TSX2    NO_XFPT2

     1754    11072    2         B$JIT.ERR=B$PS1$->MPARAM.ERR;

  11072  1 003660   000000 470400 xsym               LDP0    B$PS1$
         1 003661   000000 236100                    LDQ     0,,PR0
         1 003662   000000 471400 xsym               LDP1    B$JIT$
         1 003663   100012 756100                    STQ     10,,PR1

     1755    11073    2         GOTO GOT_XFPT;

  11073  1 003664   003700 710000 1                  TRA     GOT_XFPT

  11072  1 003665                       NO_XFPT2     null
     1756    11074    2   NO_XFPT2: ;
     1757    11075    2         IF (B$JIT.FRS & %RS_XCON#)

  11075  1 003665   000000 470400 xsym               LDP0    B$JIT$
         1 003666   000314 236100                    LDQ     204,,PR0
         1 003667   000011 736000                    QLS     9
         1 003670   777000 376003                    ANQ     -512,DU
         1 003671   760000 376003                    ANQ     -8192,DU
         1 003672   003676 600000 1                  TZE     s:11077

     1758    11076    2         THEN B$JIT.ERR=EXCONRTNA;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:227  
  11076  1 003673   000041 236000 0                  LDQ     EXCONRTNA
         1 003674   000012 756100                    STQ     10,,PR0
         1 003675   003700 710000 1                  TRA     GOT_XFPT

     1759    11077    2         ELSE B$JIT.ERR=EXCONRTNE;

  11077  1 003676   000040 236000 0                  LDQ     EXCONRTNE
         1 003677   000012 756100                    STQ     10,,PR0

  11075  1 003700                       GOT_XFPT     null
     1760    11078        /*E*   ERROR:   JSP-E$XCONRTN-A
     1761    11079               MESSAGE: Abort by Special Shared Processor via M$XCONRTN.
     1762    11080               MESSAGE1: An abort condition, such as operator abort,
     1763    11081                         line hang-up, or limit exceeded, has occurred while
     1764    11082                         one of your Special Shared Processors was in
     1765    11083                         control.  Bit settings in your Exit Control TCB
     1766    11084                         frame (or in the JIT) will indicate the cause
     1767    11085                         of the abort.
     1768    11086               MESSAGE6: Abort by Special Shared Processor via M$XCONRTN.
     1769    11087               DESCRIPTION: The user should never see this message as
     1770    11088                 the Special Shared Processor should always specify
     1771    11089                 the error code to be returned to the user.  See the
     1772    11090                 description of M$XCONRTN in the CP_6 Monitor Services
     1773    11091                 Reference Manual.
     1774    11092        */
     1775    11093    2   GOT_XFPT: ;
     1776    11094                                                /*                                    */
     1777    11095    2         I=B$SS.ISR.WSR;

  11095  1 003700   000000 470400 xsym               LDP0    B_MPT
         1 003701   000010 236100                    LDQ     8,,PR0
         1 003702   000004 772000                    QRL     4
         1 003703   000007 376007                    ANQ     7,DL
         1 003704   200006 756100                    STQ     I,,AUTO

     1778    11096    2         IF B_MPT.ECCB$->B$ECCB.XCONF.LIMIT='1'B

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:228  
  11096  1 003705   000005 471400 xsym               LDP1    B_MPT+5
         1 003706   100004 236100                    LDQ     4,,PR1
         1 003707   000100 316003                    CANQ    64,DU
         1 003710   003714 600000 1                  TZE     s:11099

     1779    11097    2         THEN CALL JSX$UNXCON;

  11097  1 003711   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003712   000000 701000 xent               TSX1    JSX$UNXCON
         1 003713   000000 011000                    NOP     0

     1780    11098                                                /*                                    */
     1781    11099    2         B_MPT.ECCB$->B$ECCB.XCONF='000'O; /*Reset all Flags                     */

  11099  1 003714   000005 470400 xsym               LDP0    B_MPT+5
         1 003715   000000 236003                    LDQ     0,DU
         1 003716   000004 552120                    STBQ    4,'20'O,PR0

     1782    11100    2         B$JIT.RNST=(B$JIT.FRS & %RS_XCON#);

  11100  1 003717   000000 470400 xsym               LDP0    B$JIT$
         1 003720   000314 236100                    LDQ     204,,PR0
         1 003721   000011 736000                    QLS     9
         1 003722   777000 376003                    ANQ     -512,DU
         1 003723   760000 376003                    ANQ     -8192,DU
         1 003724   000314 552140                    STBQ    204,'40'O,PR0

     1783    11101    2         B$JIT.FRS=(B$JIT.FRS &~ %RS_XCON#);

  11101  1 003725   000314 236100                    LDQ     204,,PR0
         1 003726   000011 736000                    QLS     9
         1 003727   777000 376003                    ANQ     -512,DU
         1 003730   017000 376003                    ANQ     7680,DU
         1 003731   000011 772000                    QRL     9
         1 003732   000314 552120                    STBQ    204,'20'O,PR0

     1784    11102    2         B$JIT.XCONF=(B$JIT.XCONF & %XC_DOMAIN#);
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:229  

  11102  1 003733   000316 236100                    LDQ     206,,PR0
         1 003734   777000 376003                    ANQ     -512,DU
         1 003735   007000 376003                    ANQ     3584,DU
         1 003736   000316 552140                    STBQ    206,'40'O,PR0

     1785    11103                                                /*                                    */
     1786    11104    2         IF J=1                       /*If request to clean entry descriptor     */

  11104  1 003737   200007 235100                    LDA     J,,AUTO
         1 003740   000001 115007                    CMPA    1,DL
         1 003741   004002 601000 1                  TNZ     s:11120

     1787    11105    3         THEN DO;

     1788    11106    4              DO CASE(I);

  11106  1 003742   200006 236100                    LDQ     I,,AUTO
         1 003743   000005 136007                    SBLQ    5,DL
         1 003744   000002 116007                    CMPQ    2,DL
         1 003745   003747 602006 1                  TNC     s:11106+5,QL
         1 003746   004002 710000 1                  TRA     s:11120
         1 003747   003751 710000 1                  TRA     s:11108
         1 003750   003771 710000 1                  TRA     s:11113

     1789    11107    4               CASE(%DBWSR);

     1790    11108    4                 S$CU$->B$U.FLG.DELA='0'B;

  11108  1 003751   000000 471400 xsym               LDP1    S$CU$
         1 003752   000045 236000 2                  LDQ     37
         1 003753   100000 356100                    ANSQ    0,,PR1

     1791    11109    4                 B$USERLS$->B$ULNK.ECCB.FLGS=(B$USERLS$->B$ULNK.ECCB.FLGS &~ %DSXXX);

  11109  1 003754   000000 471400 xsym               LDP1    B$USERLS$
         1 003755   100034 236100                    LDQ     28,,PR1
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:230  
         1 003756   000024 736000                    QLS     20
         1 003757   777000 376003                    ANQ     -512,DU
         1 003760   757000 376003                    ANQ     -8704,DU
         1 003761   000024 772000                    QRL     20
         1 003762   100034 676100                    ERQ     28,,PR1
         1 003763   177600 376007                    ANQ     65408,DL
         1 003764   100034 656100                    ERSQ    28,,PR1

     1792    11110    4                 B$JIT.JUNK = (B$JIT.JUNK &~ %JJ_UDELTA#);

  11110  1 003765   000315 220100                    LDX0    205,,PR0
         1 003766   577777 360003                    ANX0    -65537,DU
         1 003767   000315 740100                    STX0    205,,PR0
         1 003770   004002 710000 1                  TRA     s:11120

     1793    11111                                                /*                                    */
     1794    11112    4               CASE(%ASLWSR);

     1795    11113    4                 B$USERLS$->B$ULNK.ASLENT.ENTLOC=BITBIN('777777'O);

  11113  1 003771   777777 220003                    LDX0    -1,DU
         1 003772   000000 471400 xsym               LDP1    B$USERLS$
         1 003773   100052 740100                    STX0    42,,PR1

     1796    11114    4                 B$USERLS$->B$ULNK.ASLENT.TYP=15;

  11114  1 003774   000017 236007                    LDQ     15,DL
         1 003775   100052 256100                    ORSQ    42,,PR1

     1797    11115                                                /*User will get IPR fault             */
     1798    11116    4                 B$JIT.XCONF=(B$JIT.XCONF | %XC_ASL#);

  11116  1 003776   000316 236100                    LDQ     206,,PR0
         1 003777   777000 376003                    ANQ     -512,DU
         1 004000   002000 276003                    ORQ     1024,DU
         1 004001   000316 552140                    STBQ    206,'40'O,PR0

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:231  
     1799    11117    4                 END;                      /*DO CASE(CODE)*/

     1800    11118    3              END;                         /*DO IF no more calls allowed         */

     1801    11119                                                /*                                    */
     1802    11120    2         IF I ~= %ASLWSR                   /* IF NOT ASL                         */

  11120  1 004002   200006 235100                    LDA     I,,AUTO
         1 004003   000006 115007                    CMPA    6,DL
         1 004004   004015 600000 1                  TZE     s:11122

     1803    11121    2         THEN CALL JSA$RUNDSPC(I,0);

  11121  1 004005   000013 236000 2                  LDQ     11
         1 004006   200101 756100                    STQ     USRIC+2,,AUTO
         1 004007   200006 631500                    EPPR1   I,,AUTO
         1 004010   200100 451500                    STP1    USRIC+1,,AUTO
         1 004011   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 004012   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004013   000000 701000 xent               TSX1    JSA$RUNDSPC
         1 004014   000000 011000                    NOP     0

     1804    11122    2         CALL UDB$CALCOMP;

  11122  1 004015   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004016   000000 701000 xent               TSX1    UDB$CALCOMP
         1 004017   000000 011000                    NOP     0

     1805    11123    2         CALL JSS$RUNDSPC;

  11123  1 004020   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004021   000000 701000 xent               TSX1    JSS$RUNDSPC
         1 004022   000000 011000                    NOP     0

     1806    11124    2         CALL JSE$ABORTX;

  11124  1 004023   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:232  
         1 004024   000000 701000 xent               TSX1    JSE$ABORTX
         1 004025   000000 011000                    NOP     0
         1 004026   004033 710000 1                  TRA     s:11135

     1807    11125                                                /*                                    */
     1808    11126                                                /*                                    */
     1809    11127        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:233  
     1810    11128                                                /* BAD CODE OR NOT IMPLEMEMTED        */
     1811    11129    2       CASE(ELSE);

     1812    11130    2         B$JIT.ERR=EOPTPMME;

  11130  1 004027   000031 236000 0                  LDQ     EOPTPMME
         1 004030   000000 471400 xsym               LDP1    B$JIT$
         1 004031   100012 756100                    STQ     10,,PR1

     1813    11131    2         RETURN;

  11131  1 004032   000000 702200 xent               TSX2  ! X66_ARET

     1814    11132        /*
     1815    11133        */
     1816    11134    2         END;                              /*DO CASE(CODE)*/

     1817    11135    1      RETURN;

  11135  1 004033   000000 702200 xent               TSX2  ! X66_ARET

     1818    11136        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:234  
     1819    11137                                                /*INTERNAL PROCEDURES                 */
     1820    11138        /*I*   NAME:     CHECK_PSTACK
     1821    11139
     1822    11140               PURPOSE:  To validate the FPT and move the user parameters
     1823    11141                         to Monitor auto for those PMMEs that require running
     1824    11142                         down the user befor performing the service request.
     1825    11143
     1826    11144                         Called for:  CPEXIT  LINK  LDTRC  SAVE
     1827    11145
     1828    11146        */
     1829    11147    1   CHECK_PSTACK: PROC ALTRET;

  11147  1 004034   200074 741300       CHECK_PSTACK STX1  ! CPEXIT_V+2,,AUTO

     1830    11148
     1831    11149    2      PSIZE=(B_MPT.PSDESC$->B$$DESCR.BOUND+1)/8;

  11149  1 004035   000011 470400 xsym               LDP0    B_MPT+9
         1 004036   000000 236100                    LDQ     0,,PR0
         1 004037   000020 772000                    QRL     16
         1 004040   000001 036007                    ADLQ    1,DL
         1 004041   000003 772000                    QRL     3
         1 004042   200012 756100                    STQ     PSIZE,,AUTO

     1832    11150    2      IF (J>PSIZE) THEN ALTRETURN;

  11150  1 004043   200007 116100                    CMPQ    J,,AUTO
         1 004044   004046 605000 1                  TPL     s:11152

  11150  1 004045   000000 702211                    TSX2  ! 0,X1

     1833    11151                                                /**/
     1834    11152    2      T1$ =ADDR(P0$);

  11152  1 004046   200027 631500                    EPPR1   SAVEP+4,,AUTO
         1 004047   200010 451500                    STP1    T1$,,AUTO

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:235  
     1835    11153    2      T2$ = ADDR(B$PS0$);

  11153  1 004050   000003 236000 2                  LDQ     3
         1 004051   200011 756100                    STQ     T2$,,AUTO

     1836    11154    2      I=0;

  11154  1 004052   200006 450100                    STZ     I,,AUTO

     1837    11155                                                /**/
     1838    11156    3      DO WHILE (I <= J);

  11156  1 004053   200006 236100                    LDQ     I,,AUTO
         1 004054   200007 116100                    CMPQ    J,,AUTO
         1 004055   004105 605400 1                  TPNZ    s:11167

     1839    11157    3           T1$->B$PTR =ADDR(NIL);

  11157  1 004056   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004057   200010 470500                    LDP0    T1$,,AUTO
         1 004060   000000 756100                    STQ     0,,PR0

     1840    11158    3           CALL HFF$NILERASE(I) ALTRET(NEXTP);

  11158  1 004061   200006 630500                    EPPR0   I,,AUTO
         1 004062   200100 450500                    STP0    USRIC+1,,AUTO
         1 004063   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 004064   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004065   000000 701000 xent               TSX1    HFF$NILERASE
         1 004066   004073 702000 1                  TSX2    NEXTP

     1841    11159    3           T1$->B$PTR = T2$->B$PTR;

  11159  1 004067   200011 470500                    LDP0    T2$,,AUTO
         1 004070   000000 236100                    LDQ     0,,PR0
         1 004071   200010 471500                    LDP1    T1$,,AUTO
         1 004072   100000 756100                    STQ     0,,PR1
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:236  

  11159  1 004073                       NEXTP        null
     1842    11160    3   NEXTP:  ;
     1843    11161    3           T1$=PINCRW(T1$,1);

  11161  1 004073   200010 236100                    LDQ     T1$,,AUTO
         1 004074   000001 036003                    ADLQ    1,DU
         1 004075   200010 756100                    STQ     T1$,,AUTO

     1844    11162    3           T2$=PINCRW(T2$,1);

  11162  1 004076   200011 236100                    LDQ     T2$,,AUTO
         1 004077   000001 036003                    ADLQ    1,DU
         1 004100   200011 756100                    STQ     T2$,,AUTO

     1845    11163    3           I=I+1;

  11163  1 004101   200006 054100                    AOS     I,,AUTO

     1846    11164    3           END;

  11164  1 004102   200006 236100                    LDQ     I,,AUTO
         1 004103   200007 116100                    CMPQ    J,,AUTO
         1 004104   004056 604400 1                  TMOZ    s:11157

     1847    11165                                                /**/
     1848    11166                                                /**/
     1849    11167    2      IF P0$ ~= ADDR(NIL)

  11167  1 004105   200027 236100                    LDQ     SAVEP+4,,AUTO
         1 004106   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004107   004134 600000 1                  TZE     s:11177

     1850    11168    3      THEN DO;

     1851    11169    3           SAVEP.FNAME=P0$->TEXTC;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:237  
  11169  1 004110   200027 470500                    LDP0    SAVEP+4,,AUTO
         1 004111   000100 101500                    MRL     fill='000'O
         1 004112   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         1 004113   200100 000002                    ADSC9   USRIC+1,,AUTO            cn=0,n=2
         1 004114   200100 220100                    LDX0    USRIC+1,,AUTO
         1 004115   000001 621010                    EAX1    1,X0
         1 004116   000100 100540                    MLR     fill='000'O
         1 004117   000000 000011                    ADSC9   0,,PR0                   cn=0,n=*X1
         1 004120   200034 000040                    ADSC9   SAVEP+9,,AUTO            cn=0,n=32

     1852    11170    3           P0$=ADDR(SAVEP.FNAME);

  11170  1 004121   200034 631500                    EPPR1   SAVEP+9,,AUTO
         1 004122   200027 451500                    STP1    SAVEP+4,,AUTO

     1853    11171    3           IF P0$->B$STARF.STAR='*'

  11171  1 004123   040000 106500                    CMPC    fill='040'O
         1 004124   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         1 004125   000046 000001 2                  ADSC9   38                       cn=0,n=1
         1 004126   004142 601000 1                  TNZ     s:11180

     1854    11172    4           THEN DO;

     1855    11173    4                SAVEP.ACCT=B$JIT.ACCN;

  11173  1 004127   000000 470400 xsym               LDP0    B$JIT$
         1 004130   040100 100500                    MLR     fill='040'O
         1 004131   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 004132   200044 000010                    ADSC9   SAVEP+17,,AUTO           cn=0,n=8

     1856    11174    4                GOTO SET_P1$;

  11174  1 004133   004215 710000 1                  TRA     SET_P1$

     1857    11175    4                END;
     1858    11176    3           END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:238  
     1859    11177    2      ELSE IF CODE = %C$SAVE#

  11177  1 004134   200003 470500                    LDP0    @CODE,,AUTO
         1 004135   000000 235100                    LDA     0,,PR0
         1 004136   000017 115007                    CMPA    15,DL
         1 004137   004142 601000 1                  TNZ     s:11180

     1860    11178    2           THEN ALTRETURN;

  11178  1 004140   200074 221300                    LDX1  ! CPEXIT_V+2,,AUTO
         1 004141   000000 702211                    TSX2  ! 0,X1

     1861    11179
     1862    11180    2      IF P1$ ~= ADDR(NIL)

  11180  1 004142   200030 236100                    LDQ     SAVEP+5,,AUTO
         1 004143   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004144   004155 600000 1                  TZE     s:11186

     1863    11181    3      THEN DO;

     1864    11182    3           SAVEP.ACCT = P1$->B$DWTXT;

  11182  1 004145   200030 470500                    LDP0    SAVEP+5,,AUTO
         1 004146   040100 100500                    MLR     fill='040'O
         1 004147   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 004150   200044 000010                    ADSC9   SAVEP+17,,AUTO           cn=0,n=8

     1865    11183    3           IF SAVEP.ACCT=' ' THEN GOTO SET_FACCN;

  11183  1 004151   200044 237100                    LDAQ    SAVEP+17,,AUTO
         1 004152   000050 117000 2                  CMPAQ   40
         1 004153   004165 600000 1                  TZE     SET_FACCN

     1866    11184    3           END;

  11184  1 004154   004215 710000 1                  TRA     SET_P1$
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:239  

     1867    11185    3      ELSE DO;

     1868    11186    3           IF CODE = %C$CPEXIT#

  11186  1 004155   200003 470500                    LDP0    @CODE,,AUTO
         1 004156   000000 235100                    LDA     0,,PR0
         1 004157   000012 115007                    CMPA    10,DL
         1 004160   004165 601000 1                  TNZ     SET_FACCN

     1869    11187    3           THEN SAVEP.ACCT=J_SYSTXT;

  11187  1 004161   040100 100400                    MLR     fill='040'O
         1 004162   000000 000010 xsym               ADSC9   J_SYSTXT                 cn=0,n=8
         1 004163   200044 000010                    ADSC9   SAVEP+17,,AUTO           cn=0,n=8
         1 004164   004215 710000 1                  TRA     SET_P1$

     1870    11188    4           ELSE DO;

  11185  1 004165                       SET_FACCN    null
     1871    11189    4   SET_FACCN:   ;
     1872    11190    4                SAVEP.ACCT=B$JIT.FACCN;

  11190  1 004165   000000 470400 xsym               LDP0    B$JIT$
         1 004166   000006 237100                    LDAQ    6,,PR0
         1 004167   200044 757100                    STAQ    SAVEP+17,,AUTO

     1873    11191
     1874    11192    4                IF CODE ~= %C$CPEXIT#

  11192  1 004170   200003 471500                    LDP1    @CODE,,AUTO
         1 004171   100000 235100                    LDA     0,,PR1
         1 004172   000012 115007                    CMPA    10,DL
         1 004173   004215 601000 1                  TNZ     SET_P1$

     1875    11193    4                THEN GOTO SET_P1$;
     1876    11194
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:240  
     1877    11195    4                IF (B$PS5$->CPEXIT$V.SAVEFLG#) OR (B$PS5$->CPEXIT$V.GETFLG#)

  11195  1 004174   000000 473400 xsym               LDP3    B$PS5$
         1 004175   300000 236100                    LDQ     0,,PR3
         1 004176   040000 316003                    CANQ    16384,DU
         1 004177   004215 601000 1                  TNZ     SET_P1$
         1 004200   020000 316003                    CANQ    8192,DU
         1 004201   004215 601000 1                  TNZ     SET_P1$

     1878    11196    4                THEN GOTO SET_P1$;
     1879    11197
     1880    11198    4                IF P3$ = ADDR(NIL)

  11198  1 004202   200032 236100                    LDQ     SAVEP+7,,AUTO
         1 004203   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004204   004212 600000 1                  TZE     SET_P3$

     1881    11199    4                THEN GOTO SET_P3$;
     1882    11200    4                ELSE IF P3$->B$TXT6='      '

  11200  1 004205   200032 474500                    LDP4    SAVEP+7,,AUTO
         1 004206   040000 106500                    CMPC    fill='040'O
         1 004207   400000 000006                    ADSC9   0,,PR4                   cn=0,n=6
         1 004210   000061 000006 0                  ADSC9   ENOOVRLY+14              cn=0,n=6
         1 004211   004215 601000 1                  TNZ     SET_P1$

     1883    11201    5                     THEN DO;

  11195  1 004212                       SET_P3$      null
     1884    11202    5   SET_P3$:               ;
     1885    11203    5                          P3$ = ADDR(B$JIT.FPSN);

  11203  1 004212   000000 236000 xsym               LDQ     B$JIT$
         1 004213   000021 036003                    ADLQ    17,DU
         1 004214   200032 756100                    STQ     SAVEP+7,,AUTO

     1886    11204    5                          END;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:241  

     1887    11205    4                END;

     1888    11206    3           END;

  11199  1 004215                       SET_P1$      null
     1889    11207    2   SET_P1$: ;
     1890    11208    2      P1$=ADDR(SAVEP.ACCT);

  11208  1 004215   200044 630500                    EPPR0   SAVEP+17,,AUTO
         1 004216   200030 450500                    STP0    SAVEP+5,,AUTO

     1891    11209
     1892    11210        /* normalize the run-unit name if account is :SYS */
     1893    11211    2      IF (SAVEP.ACCT=J_SYSTXT) AND (CODE ~= %C$SAVE#)

  11211  1 004217   040000 106500                    CMPC    fill='040'O
         1 004220   200044 000010                    ADSC9   SAVEP+17,,AUTO           cn=0,n=8
         1 004221   000000 000010 xsym               ADSC9   J_SYSTXT                 cn=0,n=8
         1 004222   004262 601000 1                  TNZ     s:11218
         1 004223   200003 471500                    LDP1    @CODE,,AUTO
         1 004224   100000 235100                    LDA     0,,PR1
         1 004225   000017 115007                    CMPA    15,DL
         1 004226   004262 600000 1                  TZE     s:11218

     1894    11212    3      THEN DO I=SAVEP.FNAME.CNT-1 DOWNTO 0;

  11212  1 004227   200034 236100                    LDQ     SAVEP+9,,AUTO
         1 004230   000033 772000                    QRL     27
         1 004231   000001 136007                    SBLQ    1,DL
         1 004232   200006 756100                    STQ     I,,AUTO
         1 004233   004260 710000 1                  TRA     s:11216+2

     1895    11213    3           IF (SAVEP.FNAME.CTXT(I) >= '141'O/*a*/)

  11213  1 004234   200006 235100                    LDA     I,,AUTO
         1 004235   000000 106505                    CMPC    fill='000'O
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:242  
         1 004236   200034 200001                    ADSC9   SAVEP+9,A,AUTO           cn=1,n=1
         1 004237   000047 000002 2                  ADSC9   39                       cn=0,n=2
         1 004240   004256 602000 1                  TNC     s:11216
         1 004241   000105 106400                    CMPC    fill='000'O
         1 004242   000052 000002 2                  ADSC9   42                       cn=0,n=2
         1 004243   200034 200001                    ADSC9   SAVEP+9,A,AUTO           cn=1,n=1
         1 004244   004256 602000 1                  TNC     s:11216

     1896    11214    3             AND (SAVEP.FNAME.CTXT(I) <= '172'O/*z*/)
     1897    11215    3           THEN SAVEP.FNAME.CTXT(I) = (SAVEP.FNAME.CTXT(I) & '737'O);

  11215  1 004245   000100 100505                    MLR     fill='000'O
         1 004246   200034 200001                    ADSC9   SAVEP+9,A,AUTO           cn=1,n=1
         1 004247   200100 000004                    ADSC9   USRIC+1,,AUTO            cn=0,n=4
         1 004250   200100 236100                    LDQ     USRIC+1,,AUTO
         1 004251   737000 376003                    ANQ     -16896,DU
         1 004252   200101 756100                    STQ     USRIC+2,,AUTO
         1 004253   000105 100500                    MLR     fill='000'O
         1 004254   200101 000004                    ADSC9   USRIC+2,,AUTO            cn=0,n=4
         1 004255   200034 200001                    ADSC9   SAVEP+9,A,AUTO           cn=1,n=1

     1898    11216    3           END;

  11216  1 004256   000001 336007                    LCQ     1,DL
         1 004257   200006 056100                    ASQ     I,,AUTO
         1 004260   200006 235100                    LDA     I,,AUTO
         1 004261   004234 605000 1                  TPL     s:11213

     1899    11217
     1900    11218    2      IF P2$ ~= ADDR(NIL)

  11218  1 004262   200031 236100                    LDQ     SAVEP+6,,AUTO
         1 004263   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004264   004273 600000 1                  TZE     s:11224

     1901    11219    3      THEN DO;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:243  
     1902    11220    3           SAVEP.PASS = P2$->B$DWTXT;

  11220  1 004265   200031 470500                    LDP0    SAVEP+6,,AUTO
         1 004266   040100 100500                    MLR     fill='040'O
         1 004267   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 004270   200046 000010                    ADSC9   SAVEP+19,,AUTO           cn=0,n=8

     1903    11221    3           P2$=ADDR(SAVEP.PASS);

  11221  1 004271   200046 631500                    EPPR1   SAVEP+19,,AUTO
         1 004272   200031 451500                    STP1    SAVEP+6,,AUTO

     1904    11222    3           END;

     1905    11223
     1906    11224    2      IF P3$ ~= ADDR(NIL)

  11224  1 004273   200032 236100                    LDQ     SAVEP+7,,AUTO
         1 004274   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004275   004304 600000 1                  TZE     s:11230

     1907    11225    3      THEN DO;

     1908    11226    3           SAVEP.PSID = P3$->B$TXT6;

  11226  1 004276   200032 470500                    LDP0    SAVEP+7,,AUTO
         1 004277   040100 100500                    MLR     fill='040'O
         1 004300   000000 000006                    ADSC9   0,,PR0                   cn=0,n=6
         1 004301   200050 000006                    ADSC9   SAVEP+21,,AUTO           cn=0,n=6

     1909    11227    3           P3$=ADDR(SAVEP.PSID);

  11227  1 004302   200050 631500                    EPPR1   SAVEP+21,,AUTO
         1 004303   200032 451500                    STP1    SAVEP+7,,AUTO

     1910    11228    3           END;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:244  
     1911    11229
     1912    11230    2   END CHECK_PSTACK;

  11230  1 004304   200074 221300                    LDX1  ! CPEXIT_V+2,,AUTO
         1 004305   000001 702211                    TSX2  ! 1,X1

     1913    11231        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:245  
     1914    11232
     1915    11233        /*I*   NAME:   ZAPCLIB
     1916    11234
     1917    11235               PURPOSE:  To remove Core Library procedure from the users
     1918    11236                         page table on an M$DLIB request or when an M$ALIB
     1919    11237                         request requires disassociation of a different
     1920    11238                         Core Library.
     1921    11239
     1922    11240        */
     1923    11241    1   ZAPCLIB: PROC(J);

  11241  1 004306   200074 741300       ZAPCLIB      STX1  ! CPEXIT_V+2,,AUTO

     1924    11242    2   DCL J SBIN;
     1925    11243    2   DCL I SBIN;
     1926    11244                                                /**/
     1927    11245             %LOCK (G=J_PLOCK);

  11246  1 004307   000011 630400 2                  EPPR0   9
         1 004310   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004311   000000 701000 xent               TSX1    HFC$LOCK
         1 004312   000000 011000                    NOP     0

     1928    11248    2      S$CU$->B$U.ASP = 0;                  /* Mark user tables                   */

  11248  1 004313   000000 470400 xsym               LDP0    S$CU$
         1 004314   000000 236003                    LDQ     0,DU
         1 004315   000007 752102                    STCQ    7,'02'O,PR0

     1929    11249    2      B$P$ -> B$P.UC(J) = B$P$ -> B$P.UC(J)-1;

  11249  1 004316   200075 471500                    LDP1    @J,,AUTO
         1 004317   100000 236100                    LDQ     0,,PR1
         1 004320   000021 402007                    MPY     17,DL
         1 004321   000001 736000                    QLS     1
         1 004322   000000 620006                    EAX0    0,QL
         1 004323   100000 236100                    LDQ     0,,PR1
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:246  
         1 004324   000021 402007                    MPY     17,DL
         1 004325   000001 736000                    QLS     1
         1 004326   000000 473400 xsym               LDP3    B$P$
         1 004327   300000 235106                    LDA     0,QL,PR3
         1 004330   000001 135007                    SBLA    1,DL
         1 004331   300000 755110                    STA     0,X0,PR3

     1930    11250           %UNLOCK (G=J_PLOCK);

  11251  1 004332   000011 630400 2                  EPPR0   9
         1 004333   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004334   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004335   000000 011000                    NOP     0

     1931    11253    3      DO I=%LIBLO TO %ISEGHI;

  11253  1 004336   000440 235007                    LDA     288,DL
         1 004337   200076 755100                    STA     I,,AUTO

     1932    11254    3           B$UPT$->B$PAGE.WRD(I) = MM_FPMC;

  11254  1 004340   000000 236000 xsym               LDQ     MM_FPMC
         1 004341   000000 470400 xsym               LDP0    B$UPT$
         1 004342   200076 720100                    LXL0    I,,AUTO
         1 004343   000000 756110                    STQ     0,X0,PR0

     1933    11255    3           END;

  11255  1 004344   200076 054100                    AOS     I,,AUTO
         1 004345   200076 235100                    LDA     I,,AUTO
         1 004346   000477 115007                    CMPA    319,DL
         1 004347   004340 604400 1                  TMOZ    s:11254

     1934    11256    2      RETURN;

  11256  1 004350   200074 221300                    LDX1  ! CPEXIT_V+2,,AUTO
         1 004351   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:247  

     1935    11257    2   END ZAPCLIB;
     1936    11258        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:248  
     1937    11259                                                /*                                    */
     1938    11260    1   DO_SAVE: PROC(SFLAG) ALTRET;

  11260  1 004352   200074 741300       DO_SAVE      STX1  ! CPEXIT_V+2,,AUTO

     1939    11261    2   DCL SFLAG BIT(9) ALIGNED;
     1940    11262    2   DCL ERRJSQ UBIN(36);
     1941    11263    2   DCL USRIC SBIN;
     1942    11264                                                /*                                    */
     1943    11265                                                /*                                    */
     1944    11266    2      USRIC=1;

  11266  1 004353   000001 235007                    LDA     1,DL
         1 004354   200077 755100                    STA     USRIC,,AUTO

     1945    11267    3      DO WHILE (B$SS.ISR.WSR ~= %USERWSR);

  11267  1 004355   000000 470400 xsym               LDP0    B_MPT
         1 004356   000010 236100                    LDQ     8,,PR0
         1 004357   000160 376007                    ANQ     112,DL
         1 004360   000160 116007                    CMPQ    112,DL
         1 004361   004405 600000 1                  TZE     s:11273

     1946    11268    3           USRIC=0;

  11268  1 004362   200077 450100                    STZ     USRIC,,AUTO

     1947    11269    3           IF B$SS.ISR.WSR=%DBWSR

  11269  1 004363   000000 470400 xsym               LDP0    B_MPT
         1 004364   000010 236100                    LDQ     8,,PR0
         1 004365   000160 376007                    ANQ     112,DL
         1 004366   000120 116007                    CMPQ    80,DL
         1 004367   004375 601000 1                  TNZ     s:11271

     1948    11270    3           THEN SFLAG = (SFLAG | %SVL_DIC#);

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:249  
  11270  1 004370   200075 471500                    LDP1    @SFLAG,,AUTO
         1 004371   100000 236100                    LDQ     0,,PR1
         1 004372   777000 376003                    ANQ     -512,DU
         1 004373   200000 276003                    ORQ     65536,DU
         1 004374   100000 756100                    STQ     0,,PR1

     1949    11271    3           CALL JSS$BACKSS;

  11271  1 004375   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004376   000000 701000 xent               TSX1    JSS$BACKSS
         1 004377   000000 011000                    NOP     0

     1950    11272    3           END;

  11272  1 004400   000000 470400 xsym               LDP0    B_MPT
         1 004401   000010 236100                    LDQ     8,,PR0
         1 004402   000160 376007                    ANQ     112,DL
         1 004403   000160 116007                    CMPQ    112,DL
         1 004404   004362 601000 1                  TNZ     s:11268

     1951    11273    2      CALL UDN$MAGICSS;                    /* SET USER MAGIC                     */

  11273  1 004405   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004406   000000 701000 xent               TSX1    UDN$MAGICSS
         1 004407   000000 011000                    NOP     0

     1952    11274    2      CALL JQU$VALID(ERRJSQ) ALTRET(ALTR);

  11274  1 004410   200076 630500                    EPPR0   ERRJSQ,,AUTO
         1 004411   200100 450500                    STP0    USRIC+1,,AUTO
         1 004412   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 004413   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004414   000000 701000 xent               TSX1    JQU$VALID
         1 004415   004563 702000 1                  TSX2    ALTR

     1953    11275    2      IF (B$JIT.JUNK & %JJ_SCON#) AND (B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET='1'B)

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:250  
  11275  1 004416   000000 470400 xsym               LDP0    B$JIT$
         1 004417   000315 220100                    LDX0    205,,PR0
         1 004420   100000 360003                    ANX0    32768,DU
         1 004421   004437 600000 1                  TZE     s:11287
         1 004422   000005 471400 xsym               LDP1    B_MPT+5
         1 004423   100004 236100                    LDQ     4,,PR1
         1 004424   040000 316003                    CANQ    16384,DU
         1 004425   004437 600000 1                  TZE     s:11287

     1954    11276    3      THEN DO;

     1955    11277    3           IF (B_MPT.ECCB$->B$ECCB.XCONF & (%SVL_SAVE# | %SVL_GET#) )

  11277  1 004426   100004 236100                    LDQ     4,,PR1
         1 004427   000011 736000                    QLS     9
         1 004430   777000 376003                    ANQ     -512,DU
         1 004431   007000 376003                    ANQ     3584,DU
         1 004432   004437 600000 1                  TZE     s:11287

     1956    11278    4           THEN DO;

     1957    11279    4                B$JIT.ERR=ESSAVE;

  11279  1 004433   000034 236000 0                  LDQ     ESSAVE
         1 004434   000012 756100                    STQ     10,,PR0

     1958    11280    4                ALTRETURN;

  11280  1 004435   200074 221300                    LDX1  ! CPEXIT_V+2,,AUTO
         1 004436   000000 702211                    TSX2  ! 0,X1

     1959    11281    4                END;
     1960    11282        /*E*   ERROR:  JSP-E$SSAVE-E
     1961    11283               MESSAGE:   Save not allowed when in Exit Control for SAVE-GET
     1962    11284        */
     1963    11285    3           END;                            /*DO IF JJ_SCON#                      */
     1964    11286
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:251  
     1965    11287    2      IF S$CU$->B$U.APR >= P_AUTO_START

  11287  1 004437   000000 471400 xsym               LDP1    S$CU$
         1 004440   100007 236100                    LDQ     7,,PR1
         1 004441   000030 772000                    QRL     24
         1 004442   000000 116000 xsym               CMPQ    P_AUTO_START
         1 004443   004465 602000 1                  TNC     s:11298

     1966    11288    3      THEN DO;

     1967    11289    3           PNUM=S$CU$->B$U.APR;

  11289  1 004444   200013 756100                    STQ     PNUM,,AUTO

     1968    11290    3           I = S$CU$->B$U.APO;

  11290  1 004445   100007 236100                    LDQ     7,,PR1
         1 004446   000014 772000                    QRL     12
         1 004447   007777 376007                    ANQ     4095,DL
         1 004450   200006 756100                    STQ     I,,AUTO

     1969    11291    3           CALL JSA$UNSHARE(PNUM,I) ALTRET(ALTR_XCON);

  11291  1 004451   200006 633500                    EPPR3   I,,AUTO
         1 004452   200101 453500                    STP3    USRIC+2,,AUTO
         1 004453   200013 634500                    EPPR4   PNUM,,AUTO
         1 004454   200100 454500                    STP4    USRIC+1,,AUTO
         1 004455   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 004456   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004457   000000 701000 xent               TSX1    JSA$UNSHARE
         1 004460   004573 702000 1                  TSX2    ALTR_XCON

     1970    11292    3           S$CU$->B$U.APO = 0;

  11292  1 004461   000000 470400 xsym               LDP0    S$CU$
         1 004462   000000 236003                    LDQ     0,DU
         1 004463   000007 752114                    STCQ    7,'14'O,PR0
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:252  

     1971    11293    3           S$CU$->B$U.APR = 0;

  11293  1 004464   000007 752160                    STCQ    7,'60'O,PR0

     1972    11294    3           END;

     1973    11295                       /* Note that JIT.ERR will be set by JSA$UNSHARE if he ALTRETS  */
     1974    11296
     1975    11297                                                /*  THIS IS THE FAST SAVE PATH        */
     1976    11298    2      IF (B$JIT.JUNK & %JJ_SCON#) ='000000'O

  11298  1 004465   000000 470400 xsym               LDP0    B$JIT$
         1 004466   000315 220100                    LDX0    205,,PR0
         1 004467   100000 360003                    ANX0    32768,DU
         1 004470   004515 601000 1                  TNZ     s:11306
         1 004471   000000 471400 xsym               LDP1    S$CU$
         1 004472   100006 236100                    LDQ     6,,PR1
         1 004473   000777 316007                    CANQ    511,DL
         1 004474   004515 601000 1                  TNZ     s:11306
         1 004475   777000 316007                    CANQ    -512,DL
         1 004476   004515 601000 1                  TNZ     s:11306

     1977    11299    2        AND (S$CU$->B$U.ASL=0)
     1978    11300    2        AND (S$CU$->B$U.DB=0)
     1979    11301    3      THEN DO;

     1980    11302    3           CALL JQS$SAVE(P0$,P1$,P2$,P3$)  ALTRET(ALTR2);

  11302  1 004477   200032 633500                    EPPR3   SAVEP+7,,AUTO
         1 004500   200103 453500                    STP3    USRIC+4,,AUTO
         1 004501   200031 634500                    EPPR4   SAVEP+6,,AUTO
         1 004502   200102 454500                    STP4    USRIC+3,,AUTO
         1 004503   200030 635500                    EPPR5   SAVEP+5,,AUTO
         1 004504   200101 455500                    STP5    USRIC+2,,AUTO
         1 004505   200027 636500                    EPPR6   SAVEP+4,,AUTO
         1 004506   200100 456500                    STP6    USRIC+1,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:253  
         1 004507   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 004510   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 004511   000000 701000 xent               TSX1    JQS$SAVE
         1 004512   004606 702000 1                  TSX2    ALTR2

     1981    11303    3           RETURN;

  11303  1 004513   200074 221300                    LDX1  ! CPEXIT_V+2,,AUTO
         1 004514   000001 702211                    TSX2  ! 1,X1

     1982    11304    3           END;                            /*FAST PATH                           */
     1983    11305                                                /*                                    */
     1984    11306    2      B$JIT.SVLDTF=SFLAG;

  11306  1 004515   200075 471500                    LDP1    @SFLAG,,AUTO
         1 004516   100000 236100                    LDQ     0,,PR1
         1 004517   000033 772000                    QRL     27
         1 004520   000316 552104                    STBQ    206,'04'O,PR0

     1985    11307    2      P4$=ADDR(NIL);                       /*NO COMMAND ON M$SAVE                */

  11307  1 004521   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004522   200033 756100                    STQ     SAVEP+8,,AUTO

     1986    11308    2      SAVEP.P# = SIZEW(SAVEP) - POFFW(ADDR(P0$) , ADDR(SAVEP));

  11308  1 004523   200100 452500                    STP2    USRIC+1,,AUTO
         1 004524   200100 236100                    LDQ     USRIC+1,,AUTO
         1 004525   000023 036003                    ADLQ    19,DU
         1 004526   000022 772000                    QRL     18
         1 004527   200101 452500                    STP2    USRIC+2,,AUTO
         1 004530   200102 756100                    STQ     USRIC+3,,AUTO
         1 004531   200101 236100                    LDQ     USRIC+2,,AUTO
         1 004532   000027 036003                    ADLQ    23,DU
         1 004533   000022 772000                    QRL     18
         1 004534   200102 136100                    SBLQ    USRIC+3,,AUTO
         1 004535   000027 676000 xsym               ERQ     B_VECTNIL+23
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:254  
         1 004536   000032 036007                    ADLQ    26,DL
         1 004537   200026 756100                    STQ     SAVEP+3,,AUTO

     1987    11309    2      IF (USRIC=0) OR ( (B$JIT.JUNK & %JJ_SCON#) ='000000'O)

  11309  1 004540   200077 235100                    LDA     USRIC,,AUTO
         1 004541   004545 600000 1                  TZE     s:11311
         1 004542   000315 220100                    LDX0    205,,PR0
         1 004543   100000 360003                    ANX0    32768,DU
         1 004544   004554 601000 1                  TNZ     s:11315

     1988    11310    3      THEN DO;                             /*CANT DO IT YET-- MAY HAVE ASL       */

     1989    11311    3           CALL JSX$SVLDTXCON(SAVEP);

  11311  1 004545   200023 633500                    EPPR3   SAVEP,,AUTO
         1 004546   200100 453500                    STP3    USRIC+1,,AUTO
         1 004547   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 004550   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004551   000000 701000 xent               TSX1    JSX$SVLDTXCON
         1 004552   000000 011000                    NOP     0

     1990    11312    3           GOTO ALTR_XCON;

  11312  1 004553   004573 710000 1                  TRA     ALTR_XCON

     1991    11313                                                /*USER TCB IS FULL                    */
     1992    11314    3           END;
     1993    11315    2      ELSE CALL JSX$XCONSAVE(SAVEP);

  11315  1 004554   200023 633500                    EPPR3   SAVEP,,AUTO
         1 004555   200100 453500                    STP3    USRIC+1,,AUTO
         1 004556   200100 630500                    EPPR0   USRIC+1,,AUTO
         1 004557   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004560   000000 701000 xent               TSX1    JSX$XCONSAVE
         1 004561   000000 011000                    NOP     0

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:255  
     1994    11316                                                /*  USER XCON OR DELTA                */
     1995    11317    2      GOTO ALTR_XCON;

  11317  1 004562   004573 710000 1                  TRA     ALTR_XCON

  11309  1 004563                       ALTR         null
     1996    11318    2   ALTR: ;
     1997    11319    2      B$JIT.ERR=EFPT;                      /*ANY SKELETON                        */

  11319  1 004563   000005 236000 0                  LDQ     EFPT
         1 004564   000000 470400 xsym               LDP0    B$JIT$
         1 004565   000012 756100                    STQ     10,,PR0

     1998    11320    2      B$JIT.ERR.CODE=ERRJSQ;

  11320  1 004566   200076 236100                    LDQ     ERRJSQ,,AUTO
         1 004567   000003 736000                    QLS     3
         1 004570   000012 676100                    ERQ     10,,PR0
         1 004571   377770 376007                    ANQ     131064,DL
         1 004572   000012 656100                    ERSQ    10,,PR0

  11320  1 004573                       ALTR_XCON    null
     1999    11321    2   ALTR_XCON: ;
     2000    11322    2      B$JIT.SVLDTF=(B$JIT.SVLDTF &~SFLAG);

  11322  1 004573   200075 470500                    LDP0    @SFLAG,,AUTO
         1 004574   000000 236100                    LDQ     0,,PR0
         1 004575   777000 376003                    ANQ     -512,DU
         1 004576   777000 676003                    ERQ     -512,DU
         1 004577   200100 756100                    STQ     USRIC+1,,AUTO
         1 004600   000000 471400 xsym               LDP1    B$JIT$
         1 004601   100316 236100                    LDQ     206,,PR1
         1 004602   000033 736000                    QLS     27
         1 004603   200100 376100                    ANQ     USRIC+1,,AUTO
         1 004604   000033 772000                    QRL     27
         1 004605   100316 552104                    STBQ    206,'04'O,PR1

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:256  
  11322  1 004606                       ALTR2        null
     2001    11323    2   ALTR2: ;
     2002    11324    2      ALTRETURN;

  11324  1 004606   200074 221300                    LDX1  ! CPEXIT_V+2,,AUTO
         1 004607   000000 702211                    TSX2  ! 0,X1

     2003    11325
     2004    11326    2   END;                                    /*DO_SAVE                             */
     2005    11327        %EJECT;
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:257  
     2006    11328    1   MVPROC:PROC (P$);

  11328  1 004610   200074 741300       MVPROC       STX1  ! CPEXIT_V+2,,AUTO

     2007    11329    2   DCL P$ PTR;
     2008    11330    2   DCL TYP UBIN;
     2009    11331
     2010    11332    2      TYP=0/*move name*/;

  11332  1 004611   200076 450100                    STZ     TYP,,AUTO

     2011    11333    2      GOTO COMMON;

  11333  1 004612   004616 710000 1                  TRA     COMMON

     2012    11334
     2013    11335    2   MVACCT: ENTRY(P$);

  11335  1 004613   200074 741300       MVACCT       STX1  ! CPEXIT_V+2,,AUTO

     2014    11336    2      TYP=1/*move account*/;

  11336  1 004614   000001 235007                    LDA     1,DL
         1 004615   200076 755100                    STA     TYP,,AUTO

  11336  1 004616                       COMMON       null
     2015    11337    2   COMMON: ;
     2016    11338    2      CALL HFF$NILERASE(P$) ALTRET(ALL_DONE);

  11338  1 004616   200075 630500                    EPPR0   @P$,,AUTO
         1 004617   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004620   000000 701000 xent               TSX1    HFF$NILERASE
         1 004621   004677 702000 1                  TSX2    ALL_DONE

     2017    11339        /* If there is a valid entry indexed by PNUM, move the name and acct.
     2018    11340        */
     2019    11341    2      IF (PNUM ~= 0) AND (PNUM <= P_LAST_AUTO)
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:258  

  11341  1 004622   200013 235100                    LDA     PNUM,,AUTO
         1 004623   004655 600000 1                  TZE     SET_BLNKS
         1 004624   000000 236000 xsym               LDQ     P_LAST_AUTO
         1 004625   004630 604000 1                  TMI     s:11343
         1 004626   200013 116100                    CMPQ    PNUM,,AUTO
         1 004627   004655 604000 1                  TMI     SET_BLNKS

     2020    11342    3      THEN DO;

     2021    11343    3           IF B$P$->B$P.INSTDATE(PNUM) = 0 THEN GOTO SET_BLNKS;

  11343  1 004630   200013 236100                    LDQ     PNUM,,AUTO
         1 004631   000042 402007                    MPY     34,DL
         1 004632   000000 470400 xsym               LDP0    B$P$
         1 004633   000005 235106                    LDA     5,QL,PR0
         1 004634   004655 600000 1                  TZE     SET_BLNKS

     2022    11344    3           IF TYP=0

  11344  1 004635   200076 235100                    LDA     TYP,,AUTO
         1 004636   004647 601000 1                  TNZ     s:11346

     2023    11345    3           THEN P$->FNTEXTC = B$P$->B$P.NAME(PNUM);

  11345  1 004637   200075 471500                    LDP1    @P$,,AUTO
         1 004640   100000 473500                    LDP3    0,,PR1
         1 004641   200013 236100                    LDQ     PNUM,,AUTO
         1 004642   000210 402007                    MPY     136,DL
         1 004643   000100 100506                    MLR     fill='000'O
         1 004644   000032 000040                    ADSC9   26,Q,PR0                 cn=0,n=32
         1 004645   300000 000040                    ADSC9   0,,PR3                   cn=0,n=32
         1 004646   004677 710000 1                  TRA     ALL_DONE

     2024    11346    3           ELSE P$->B$DWTXT = B$P$->B$P.ACCT(PNUM);

  11346  1 004647   200075 471500                    LDP1    @P$,,AUTO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:259  
         1 004650   100000 473500                    LDP3    0,,PR1
         1 004651   000030 237106                    LDAQ    24,QL,PR0
         1 004652   300000 755100                    STA     0,,PR3
         1 004653   300001 756100                    STQ     1,,PR3

     2025    11347    3           END;

  11347  1 004654   004677 710000 1                  TRA     ALL_DONE

     2026    11348
     2027    11349        /* If not valid, move blanks.
     2028    11350        */
     2029    11351    3      ELSE DO;

  11344  1 004655                       SET_BLNKS    null
     2030    11352    3   SET_BLNKS: ;
     2031    11353    3           IF TYP=0

  11353  1 004655   200076 235100                    LDA     TYP,,AUTO
         1 004656   004671 601000 1                  TNZ     s:11358

     2032    11354    4           THEN DO;

     2033    11355    4                P$->FNTEXTC.TEXT = ' ';

  11355  1 004657   200075 470500                    LDP0    @P$,,AUTO
         1 004660   000000 471500                    LDP1    0,,PR0
         1 004661   040100 100400                    MLR     fill='040'O
         1 004662   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 004663   100000 200037                    ADSC9   0,,PR1                   cn=1,n=31

     2034    11356    4                P$->FNTEXTC.SIZ = 0;

  11356  1 004664   000000 471500                    LDP1    0,,PR0
         1 004665   000100 101400                    MRL     fill='000'O
         1 004666   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         1 004667   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:260  

     2035    11357    4                END;

  11357  1 004670   004677 710000 1                  TRA     ALL_DONE

     2036    11358    3           ELSE P$->B$DWTXT = ' ';

  11358  1 004671   200075 470500                    LDP0    @P$,,AUTO
         1 004672   000000 471500                    LDP1    0,,PR0
         1 004673   000035 235000 xsym               LDA     B_VECTNIL+29
         1 004674   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 004675   100000 755100                    STA     0,,PR1
         1 004676   100001 756100                    STQ     1,,PR1

     2037    11359    3           END;

  11359  1 004677                       ALL_DONE     null
     2038    11360    2   ALL_DONE: ;
     2039    11361    2      RETURN;

  11361  1 004677   200074 221300                    LDX1  ! CPEXIT_V+2,,AUTO
         1 004700   000001 702211                    TSX2  ! 1,X1

JS_FLAGS
 Sect OctLoc
   0     000   744000 000000   000000 000000                                    ........

NIL_DESC
 Sect OctLoc
   0     002   000000 000000   000000 000000                                    ........

(unnamed)
 Sect OctLoc
   0     004   000000 000001                                                    ....

EFPT
 Sect OctLoc
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:261  
   0     005   122320 406444                                                    R...

EBADVECT1
 Sect OctLoc
   0     006   122320 406454                                                    R...

EBADVECT2
 Sect OctLoc
   0     007   122320 406464                                                    R...

EBADVECT3
 Sect OctLoc
   0     010   122320 406474                                                    R...

EWRONGTYPE
 Sect OctLoc
   0     011   122320 403534                                                    R...

ENOPROC
 Sect OctLoc
   0     012   122320 403524                                                    R...

EFPT5
 Sect OctLoc
   0     013   122320 406514                                                    R...

EDOMAIN
 Sect OctLoc
   0     014   122320 406264                                                    R...

(unnamed)
 Sect OctLoc
   0     015   122320 404164                                                    R..t

EDLIB
 Sect OctLoc
   0     016   122320 404200                                                    R...
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:262  

ELIBUNSH
 Sect OctLoc
   0     017   122320 404224                                                    R...

EDLIBREQ
 Sect OctLoc
   0     020   122320 404174                                                    R..|

ENOTASSOC
 Sect OctLoc
   0     021   122320 404214                                                    R...

EJOBSTEP
 Sect OctLoc
   0     022   122320 404354                                                    R...

ECPALT
 Sect OctLoc
   0     023   122320 404374                                                    R...

ENJOBSTEP
 Sect OctLoc
   0     024   122320 404364                                                    R...

ELOGOFF
 Sect OctLoc
   0     025   122320 404404                                                    R...

ECYALT
 Sect OctLoc
   0     026   122320 404014                                                    R...

ENOSTEPS
 Sect OctLoc
   0     027   122320 404414                                                    R...

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:263  
EDEBUGSP
 Sect OctLoc
   0     030   122320 403114                                                    R..L

EOPTPMME
 Sect OctLoc
   0     031   122320 406234                                                    R...

ESAVE
 Sect OctLoc
   0     032   122320 405044                                                    R..$

ELINK
 Sect OctLoc
   0     033   122320 405054                                                    R..,

ESSAVE
 Sect OctLoc
   0     034   122320 404304                                                    R...

ESNAPU
 Sect OctLoc
   0     035   122320 404434                                                    R...

EDFBUSY
 Sect OctLoc
   0     036   122320 404420                                                    R...

(unnamed)
 Sect OctLoc
   0     037   122320 403514                                                    R...

EXCONRTNE
 Sect OctLoc
   0     040   122320 404154                                                    R..l

EXCONRTNA
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:264  
 Sect OctLoc
   0     041   122320 404156                                                    R..n

EOFF
 Sect OctLoc
   0     042   122320 404006                                                    R...

ENOOVRLY
 Sect OctLoc
   0     043   122320 404540                                                    R...

(unnamed)
 Sect OctLoc
   0     044   100000 000000   020000 000000   764000 000000   200000 000000    @...............
   0     050   004000 000000   040000 000000   000000 010000   712777 777777    .... ...........
   0     054   000000 020000   416777 777777   041000 000000   000000 000040    ........!......
   0     060   072104 106040   040040 040040   040040 040040                    :DF

(unnamed)
 Sect OctLoc
   2     000   000005 006000   000007 006000   777577 777777   000000 006000    ................
   2     004   000000 006000   000000 006000   000000 006000   000000 006000    ................
   2     010   000006 006000   000000 006000   000004 006000   000002 006000    ................
   2     014   000000 006000   000000 006000   000003 006000   000003 777777    ................
   2     020   000000 000043   000020 006000   000010 006000   000000 000000    ...#............
   2     024   000000 006000   000000 006000   000000 006000   000006 006000    ................
   2     030   000002 006000   000006 006000   000003 006000   757777 777777    ................
   2     034   677777 777777   777377 777777   000004 006000   000000 006000    ................
   2     040   777777 777770   000003 600000   777777 377777   000002 400000    ................
   2     044   000014 006000   737777 777777   052040 040040   141000 000000    ........*   a...
   2     050   040040 040040   040040 040040   172000 000000                            z...
     2040    11362    2   END MVPROC;
     2041    11363    1   END JSP$PMME;

PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:265  
--  Include file information  --

   UM_CP6.:E05TOU  is referenced.
   UE_CP6.:E05TOU  is referenced.
   UD_EQU_E.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   MM_MACRO_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   MM$SYSGEN.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   MM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   J_ERRSET_C.:E05TOU  is referenced.
   J_ERRORS_C.:E05TOU  is referenced.
   JS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   JS_CP6.:E05TOU  is referenced.
   JS$CP6V_C.:E05TOU  is referenced.
   IR_DATA_M.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_ULSMAC_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$SS.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure JSP$PMME.
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:266  

 **** Variables and constants ****

  ****  Section 000 RoData JSP$PMME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/b STRC        r     1 EBADVECT1                  7-0-0/b STRC        r     1 EBADVECT2
    10-0-0/b STRC        r     1 EBADVECT3                 23-0-0/b STRC        r     1 ECPALT
    26-0-0/b STRC        r     1 ECYALT                    30-0-0/b STRC        r     1 EDEBUGSP
    36-0-0/b STRC        r     1 EDFBUSY                   16-0-0/b STRC        r     1 EDLIB
    20-0-0/b STRC        r     1 EDLIBREQ                  14-0-0/b STRC        r     1 EDOMAIN
     5-0-0/b STRC        r     1 EFPT                      13-0-0/b STRC        r     1 EFPT5
    22-0-0/b STRC        r     1 EJOBSTEP                  17-0-0/b STRC        r     1 ELIBUNSH
    33-0-0/b STRC        r     1 ELINK                     25-0-0/b STRC        r     1 ELOGOFF
    24-0-0/b STRC        r     1 ENJOBSTEP                 43-0-0/b STRC        r     1 ENOOVRLY
    12-0-0/b STRC        r     1 ENOPROC                   27-0-0/b STRC        r     1 ENOSTEPS
    21-0-0/b STRC        r     1 ENOTASSOC                 42-0-0/b STRC        r     1 EOFF
    31-0-0/b STRC        r     1 EOPTPMME                  32-0-0/b STRC        r     1 ESAVE
    35-0-0/b STRC        r     1 ESNAPU                    34-0-0/b STRC        r     1 ESSAVE
    11-0-0/b STRC        r     1 EWRONGTYPE                41-0-0/b STRC        r     1 EXCONRTNA
    40-0-0/b STRC        r     1 EXCONRTNE                  0-0-0/d STRC(72)    r     1 JS_FLAGS
     2-0-0/w STRC(72)    r     1 NIL_DESC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @CODE                     75-0-0/w PTR         r     1 @J
    75-0-0/w PTR         r     1 @P$                       75-0-0/w PTR         r     1 @SFLAG
    55-0-0/w UBIN        r     1 CMD_SZ                    54-0-0/w UBIN        r     1 CMD_TYPE
    *0-0-0/w UBIN        r     1 CODE                      16-0-0/w UBIN        r     1 CPEXIT_RUND
    72-0-0/d STRC(72)    r     1 CPEXIT_V                   4-0-0/w SBIN        r     1 DATA1
    56-0-0/c STRC(288)   r     1 DEBUG_NAME                71-0-0/w UBIN        r     1 ENTRY_ADDR
    76-0-0/w UBIN        r     1 ERRJSQ                     6-0-0/w SBIN        r     1 I
    76-0-0/w SBIN        r     1 I                          7-0-0/w SBIN        r     1 J
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:267  
    *0-0-0/w SBIN        r     1 J                         20-0-0/d STRC(72)    r     1 MSCODE
    *0-0-0/w PTR         r     1 P$                         5-0-0/w PTR         r     1 P5$
    13-0-0/w SBIN        r     1 PNUM                      12-0-0/w SBIN        r     1 PSIZE
    14-0-0/b BIT (18)    r     1 PTYPE                     23-0-0/w STRC(900)   r     1 SAVEP
    22-0-0/w UBIN(9)     r     1 SCRUSR#                   *0-0-0/w BIT (9)     r     1 SFLAG
    15-0-0/b BIT (9)     r     1 SGFLAG                    66-0-0/w UBIN        r     1 SSIC
    10-0-0/w PTR         r     1 T1$                       11-0-0/w PTR         r     1 T2$
    67-0-0/w UBIN(9)     r     1 TASP                      76-0-0/w UBIN        r     1 TYP
    77-0-0/w SBIN        r     1 USRIC                     70-0-0/w SBIN        r     1 WSR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$LS$
     0-0-0/w PTR         r     1 B$MISC2$                   0-0-0/w PTR         r     1 B$P$
     0-0-0/w PTR         r     1 B$PS0$                     0-0-0/w PTR         r     1 B$PS1$
     0-0-0/w PTR         r     1 B$PS2$                     0-0-0/w PTR         r     1 B$PS3$
     0-0-0/w PTR         r     1 B$PS4$                     0-0-0/w PTR         r     1 B$PS5$
     0-0-0/w PTR         r     1 B$PS6$                     0-0-0/w PTR         r     1 B$ROSEG$
     0-0-0/w PTR         r     1 B$UPT$                     0-0-0/w PTR         r     1 B$USERLS$
     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/d STRC(432)   r     1 B_MPT
     0-0-0/w UBIN        r     1 B_MUAIS                    0-0-0/d STRC(2232)  r     1 B_SITEINFO
     0-0-0/w SBIN        r     1 IRM_ASCOUNT                0-0-0/b BIT         r     1 IRM_NODUMP
     0-0-0/c STRC(72)    r     1 J_LOGON                    0-0-0/d BIT (72)    r     1 J_PLOCK
     0-0-0/w PTR         r     1 J_SYS$                     0-0-0/c CHAR(8)     r     1 J_SYSTXT
     0-0-0/w PTR         r     1 MM_BYP$                    0-0-0/b STRC        r     1 MM_FPMC
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w UBIN        r     1 P_AUTO_START
     0-0-0/w UBIN        r     1 P_LAST_AUTO                0-0-0/w PTR         r     1 S$CU$
     0-0-0/b STRC(81)    r     1 SC_USER                    0-0-0/b BIT (72)    r     1 S_ASFGATE
     0-0-0/w SBIN        r     1 S_CUN                      0-0-0/w SBIN        r     1 S_MING

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:268  

     0-0-0/w STRC(72)    r     1 B$$DESCR                   0-0-0/w STRC(144)   r     1 B$ALIB
     0-0-0/w CHAR(8)     r     1 B$DWTXT                    0-0-0/w STRC(180)   r     1 B$ECCB
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(10368) r     1 B$MLS
     0-0-0/d STRC(1224)  r     1 B$P(0:0)                   0-0-0/w STRC(36864) r     1 B$PAGE
     0-0-0/d UBIN(9)     r     1 B$PNUM                     0-0-0/d STRC(432)   r     1 B$PSEG
     0-0-0/w PTR         r     1 B$PTR                      0-0-0/d BIT (18)    r     1 B$PTYPE
     0-0-0/w STRC(19)    r     1 B$PTYPE_MLINK              0-0-0/d STRC(3024)  r     1 B$ROSEG
     0-0-0/d STRC(81)    r     1 B$SNAPUSR                  0-0-0/d STRC(2304)  r     1 B$SS
     0-0-0/c STRC(18)    r     1 B$STARF                    0-0-0/w CHAR(6)     r     1 B$TXT6
     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/d STRC(2592)  r     1 B$ULNK
     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/w STRC(2448)  r     1 B$XCON
     0-0-0/d STRC(72)    r     1 CPEXIT$V                   0-0-0/d STRC        r     1 CPFPT
     0-0-0/d STRC(99)    r     1 DF_NAME                    0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/c STRC(288)   r     1 FNTEXTC                    0-0-0/d STRC(72)    r     1 FPT$LINK_V
     0-0-0/d STRC(72)    r     1 FPT$OLAY_V                 0-0-0/d STRC(72)    r     1 FPT$SCON_V
     0-0-0/d STRC(72)    r     1 FPT$UNSHARE_V              0-0-0/d STRC(72)    r     1 FPT$XCONRTN_V
     0-0-0/d STRC(72)    r     1 MPARAM                     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/w PTR         r     1 PTR$(0:1023)               0-0-0/c ASTR(9)     r     1 TEXTC


   Procedure JSP$PMME requires 2497 words for executable code.
   Procedure JSP$PMME requires 70 words of local(AUTO) storage.

    No errors detected in file JSP$PMME.:E05TSI    .
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:269  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:270  
          MINI XREF LISTING

ADB_OK
     10124**LABEL   10121--GOTO
ALIB2
     10129**LABEL   10128--CALLALT
ALIB3
     10133**LABEL   10132--CALLALT
ALL_DONE IN PROCEDURE MVPROC
     11359**LABEL   11338--CALLALT
ALTR IN PROCEDURE DO_SAVE
     11309**LABEL   11274--CALLALT
ALTR2 IN PROCEDURE DO_SAVE
     11322**LABEL   11302--CALLALT
ALTRET_CPEXIT
     10836**LABEL   10394--GOTO
ALTR_XCON IN PROCEDURE DO_SAVE
     11320**LABEL   11291--CALLALT 11312--GOTO    11317--GOTO
B$$DESCR
      7933**DCL     10750<<ASSIGN  10756<<ASSIGN
B$$DESCR.BOUND
      7937**DCL     11149>>ASSIGN
B$$DESCR.FLGS
      7937**DCL      9667>>IF       9857>>IF
B$ALIB.CMDSZ
      9166**DCL     10129<<ASSIGN
B$ALIB.REPLYSZ
      9166**DCL     10133<<ASSIGN
B$ALIB.WHO
      9166**DCL     10140<<ASSIGN  10142<<ASSIGN  10144<<ASSIGN
B$DO.ECCINFO
      1090**DCL      1091--REDEF
B$DWTXT
      7910**DCL     11182>>ASSIGN  11220>>ASSIGN  11346<<ASSIGN  11358<<ASSIGN
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:271  
B$ECCB.BRK
      9148**DCL     10801>>ASSIGN
B$ECCB.FLAGS.XCONSET
      9149**DCL      9841>>IF       9857>>IF      11275>>IF
B$ECCB.FLAGS.YCSET
      9150**DCL     10726>>IF
B$ECCB.XCONF
      9150**DCL      9727>>IF       9735>>IF      11099<<ASSIGN  11277>>IF
B$ECCB.XCONF.LIMIT
      9150**DCL     11096>>IF
B$ECCB.XCONF.PROG
      9150**DCL     10760<<ASSIGN
B$JIT.ACCN
       337**DCL     11173>>ASSIGN
B$JIT.CCBUF
       425**DCL      9806--IF
B$JIT.CPFLAGS1
       426**DCL     10232<<ASSIGN  10232>>ASSIGN  10279>>IF      10281<<ASSIGN  10281>>ASSIGN  10292>>IF
     10305>>IF      10312>>IF      10331>>IF      10333>>IF      10390>>IF      10396>>IF      10406>>IF
     10423>>IF      10432>>IF      10442>>IF      10453>>IF      10478>>IF      10549>>IF      10565>>IF
     10606<<ASSIGN  10606>>ASSIGN  10614>>IF      10616<<ASSIGN  10616>>ASSIGN  10646>>IF      10648<<ASSIGN
     10648>>ASSIGN  10655>>IF      10661<<ASSIGN  10661>>ASSIGN  10665<<ASSIGN  10665>>ASSIGN  10685>>IF
     10688<<ASSIGN  10688>>ASSIGN  10807>>IF      10811<<ASSIGN  10811>>ASSIGN  10813<<ASSIGN  10813>>ASSIGN
     10829>>IF      10831<<ASSIGN  10831>>ASSIGN  10836<<ASSIGN  10836>>ASSIGN  10866>>IF      10868<<ASSIGN
     10868>>ASSIGN  10899>>IF
B$JIT.CPFLAGS1.ECHO_LINK
       427**DCL      9766<<ASSIGN   9767<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       431**DCL       431--REDEF
B$JIT.ERR
       337**DCL      9634<<ASSIGN   9671>>ASSIGN   9710<<ASSIGN   9729<<ASSIGN   9737<<ASSIGN   9809<<ASSIGN
      9878<<ASSIGN   9922<<ASSIGN   9941<<ASSIGN   9958<<ASSIGN   9971<>CALL     9973<<ASSIGN   9977<<ASSIGN
     10005<<ASSIGN  10054<>CALL    10059<<ASSIGN  10069<<ASSIGN  10083<<ASSIGN  10099<<ASSIGN  10118<<ASSIGN
     10188<<ASSIGN  10204<<ASSIGN  10213<<ASSIGN  10226<<ASSIGN  10246<<ASSIGN  10355<<ASSIGN  10425<<ASSIGN
     10435<<ASSIGN  10445<<ASSIGN  10455<<ASSIGN  10457>>ASSIGN  10494<>CALL    10500<<ASSIGN  10597<<ASSIGN
     10598<<ASSIGN  10792>>ASSIGN  10880<<ASSIGN  10902>>ASSIGN  10970<<ASSIGN  10993<<ASSIGN  11003<<ASSIGN
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:272  
     11010<<ASSIGN  11016<<ASSIGN  11037<<ASSIGN  11055<<ASSIGN  11072<<ASSIGN  11076<<ASSIGN  11077<<ASSIGN
     11130<<ASSIGN  11279<<ASSIGN  11319<<ASSIGN
B$JIT.ERR.CODE
       338**DCL      9649>>IF      10002>>IF      11320<<ASSIGN
B$JIT.ERR.MID
       338**DCL       338--REDEF
B$JIT.FACCN
       337**DCL     11190>>ASSIGN
B$JIT.FPSN
       418**DCL     11203--ASSIGN
B$JIT.FRS
       533**DCL     11075>>IF      11100>>ASSIGN  11101<<ASSIGN  11101>>ASSIGN
B$JIT.JRESPEAK
       499**DCL       500--REDEF
B$JIT.JUNK
       537**DCL      9688<<ASSIGN   9688>>ASSIGN   9695<<ASSIGN   9695>>ASSIGN  10143>>IF      10170<<ASSIGN
     10170>>ASSIGN  10180>>IF      10182<<ASSIGN  10182>>ASSIGN  10333>>IF      10337<<ASSIGN  10337>>ASSIGN
     10352>>IF      10354<<ASSIGN  10354>>ASSIGN  10479<<ASSIGN  10479>>ASSIGN  10627>>IF      10744>>IF
     10746>>IF      10787<<ASSIGN  10787>>ASSIGN  10871<<ASSIGN  10871>>ASSIGN  11110<<ASSIGN  11110>>ASSIGN
     11275>>IF      11298>>IF      11309>>IF
B$JIT.JUNK2
       591**DCL      9689<<ASSIGN   9689>>ASSIGN   9692<<ASSIGN   9692>>ASSIGN  10390>>IF      10473<<ASSIGN
     10473>>ASSIGN  10475<<ASSIGN  10475>>ASSIGN  10524>>IF      10533<<ASSIGN  10533>>ASSIGN  10624>>IF
     10626<<ASSIGN  10626>>ASSIGN  10859>>IF      10861<<ASSIGN  10861>>ASSIGN
B$JIT.ORIGINATOR_PORT.FROM_CR
       608**DCL       608--REDEF     609--REDEF
B$JIT.PCL
       501**DCL     10067>>IF
B$JIT.PNR
       512**DCL       512--REDEF
B$JIT.PRIV.ACTIVE
       338**DCL      9624>>IF      10472<<ASSIGN  10537<<ASSIGN
B$JIT.PRIV.SAVED
       389**DCL     10472>>ASSIGN  10537>>ASSIGN
B$JIT.RNST
       516**DCL     10595<<ASSIGN  11100<<ASSIGN
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:273  
B$JIT.SVLDTF
       578**DCL      9850<<ASSIGN   9874<<ASSIGN  10653<<ASSIGN  10653>>ASSIGN  10736>>IF      10738>>ASSIGN
     10739<<ASSIGN  10739>>ASSIGN  10873>>ASSIGN  10874<<ASSIGN  11306<<ASSIGN  11322<<ASSIGN  11322>>ASSIGN
B$JIT.TSLINE
       606**DCL       607--REDEF
B$JIT.USER
       337**DCL     10732<>CALL
B$JIT.USRERR
       473**DCL     10457<<ASSIGN  10870<<ASSIGN  10902<<ASSIGN
B$JIT.XCONF
       558**DCL     10109<<ASSIGN  10109>>ASSIGN  11059>>IF      11102<<ASSIGN  11102>>ASSIGN  11116<<ASSIGN
     11116>>ASSIGN
B$JIT.YC0SZ
       474**DCL     10209<<ASSIGN
B$JIT.YC2SZ
       492**DCL     10217<<ASSIGN  10222<<ASSIGN
B$JIT$
      7859**DCL       332--IMP-PTR  9624>>IF       9634>>ASSIGN   9649>>IF       9671>>ASSIGN   9688>>ASSIGN
      9688>>ASSIGN   9689>>ASSIGN   9689>>ASSIGN   9692>>ASSIGN   9692>>ASSIGN   9695>>ASSIGN   9695>>ASSIGN
      9710>>ASSIGN   9729>>ASSIGN   9737>>ASSIGN   9766>>ASSIGN   9767>>ASSIGN   9806>>IF       9809>>ASSIGN
      9850>>ASSIGN   9874>>ASSIGN   9878>>ASSIGN   9922>>ASSIGN   9941>>ASSIGN   9958>>ASSIGN   9971>>CALL
      9973>>ASSIGN   9977>>ASSIGN  10002>>IF      10005>>ASSIGN  10054>>CALL    10059>>ASSIGN  10067>>IF
     10069>>ASSIGN  10083>>ASSIGN  10099>>ASSIGN  10109>>ASSIGN  10109>>ASSIGN  10118>>ASSIGN  10143>>IF
     10170>>ASSIGN  10170>>ASSIGN  10180>>IF      10182>>ASSIGN  10182>>ASSIGN  10188>>ASSIGN  10204>>ASSIGN
     10209>>ASSIGN  10213>>ASSIGN  10217>>ASSIGN  10222>>ASSIGN  10226>>ASSIGN  10232>>ASSIGN  10232>>ASSIGN
     10246>>ASSIGN  10279>>IF      10281>>ASSIGN  10281>>ASSIGN  10292>>IF      10305>>IF      10312>>IF
     10331>>IF      10333>>IF      10333>>IF      10337>>ASSIGN  10337>>ASSIGN  10352>>IF      10354>>ASSIGN
     10354>>ASSIGN  10355>>ASSIGN  10390>>IF      10390>>IF      10396>>IF      10406>>IF      10423>>IF
     10425>>ASSIGN  10432>>IF      10435>>ASSIGN  10442>>IF      10445>>ASSIGN  10453>>IF      10455>>ASSIGN
     10457>>ASSIGN  10457>>ASSIGN  10472>>ASSIGN  10472>>ASSIGN  10473>>ASSIGN  10473>>ASSIGN  10475>>ASSIGN
     10475>>ASSIGN  10478>>IF      10479>>ASSIGN  10479>>ASSIGN  10494>>CALL    10500>>ASSIGN  10524>>IF
     10533>>ASSIGN  10533>>ASSIGN  10537>>ASSIGN  10537>>ASSIGN  10549>>IF      10565>>IF      10595>>ASSIGN
     10597>>ASSIGN  10598>>ASSIGN  10606>>ASSIGN  10606>>ASSIGN  10614>>IF      10616>>ASSIGN  10616>>ASSIGN
     10624>>IF      10626>>ASSIGN  10626>>ASSIGN  10627>>IF      10646>>IF      10648>>ASSIGN  10648>>ASSIGN
     10653>>ASSIGN  10653>>ASSIGN  10655>>IF      10661>>ASSIGN  10661>>ASSIGN  10665>>ASSIGN  10665>>ASSIGN
     10685>>IF      10688>>ASSIGN  10688>>ASSIGN  10732>>CALL    10736>>IF      10738>>ASSIGN  10739>>ASSIGN
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:274  
     10739>>ASSIGN  10744>>IF      10746>>IF      10787>>ASSIGN  10787>>ASSIGN  10792>>ASSIGN  10807>>IF
     10811>>ASSIGN  10811>>ASSIGN  10813>>ASSIGN  10813>>ASSIGN  10829>>IF      10831>>ASSIGN  10831>>ASSIGN
     10836>>ASSIGN  10836>>ASSIGN  10859>>IF      10861>>ASSIGN  10861>>ASSIGN  10866>>IF      10868>>ASSIGN
     10868>>ASSIGN  10870>>ASSIGN  10871>>ASSIGN  10871>>ASSIGN  10873>>ASSIGN  10874>>ASSIGN  10880>>ASSIGN
     10899>>IF      10902>>ASSIGN  10902>>ASSIGN  10970>>ASSIGN  10993>>ASSIGN  11003>>ASSIGN  11010>>ASSIGN
     11016>>ASSIGN  11037>>ASSIGN  11055>>ASSIGN  11059>>IF      11072>>ASSIGN  11075>>IF      11076>>ASSIGN
     11077>>ASSIGN  11100>>ASSIGN  11100>>ASSIGN  11101>>ASSIGN  11101>>ASSIGN  11102>>ASSIGN  11102>>ASSIGN
     11110>>ASSIGN  11110>>ASSIGN  11116>>ASSIGN  11116>>ASSIGN  11130>>ASSIGN  11173>>ASSIGN  11190>>ASSIGN
     11203>>ASSIGN  11275>>IF      11279>>ASSIGN  11298>>IF      11306>>ASSIGN  11309>>IF      11319>>ASSIGN
     11320>>ASSIGN  11322>>ASSIGN  11322>>ASSIGN
B$LS$
      7863**DCL     10749>>ASSIGN  10750>>ASSIGN  10756>>ASSIGN
B$MISC2$
      7864**DCL     10752>>ASSIGN
B$MLS.DBLS
      8291**DCL     10750>>ASSIGN
B$MLS.MISC2
      8667**DCL     10749<<ASSIGN
B$MLS.USERLS
      8285**DCL     10756>>ASSIGN
B$P.ACCT
       644**DCL     11346>>ASSIGN
B$P.FLGS
       642**DCL     10158>>IF      10167>>IF      10177>>IF
B$P.INSTDATE
       627**DCL     11343>>IF
B$P.NAME
       645**DCL     10542>>IF      11345>>ASSIGN
B$P.UC
       622**DCL     10544<<ASSIGN  10544>>ASSIGN  11249<<ASSIGN  11249>>ASSIGN
B$P$
       675**DCL     10158>>IF      10167>>IF      10177>>IF      10542>>IF      10544>>ASSIGN  10544>>ASSIGN
     11249>>ASSIGN  11249>>ASSIGN  11343>>IF      11345>>ASSIGN  11346>>ASSIGN
B$PAGE.WRD
      7916**DCL     11254<<ASSIGN
B$PNUM
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:275  
      9251**DCL      9935>>ASSIGN   9991<<ASSIGN
B$PS0$
      7852**DCL      9685>>IF       9694>>IF       9895<>CALL     9917>>IF      10002>>IF      10004>>IF
     10024>>IF      10033>>IF      10054<>CALL    10945>>ASSIGN  10966>>ASSIGN  11068>>IF      11153--ASSIGN
B$PS1$
      7853**DCL      9644>>CALL     9657>>IF       9670>>ASSIGN   9897<>CALL     9931>>IF       9943<>CALL
      9956>>IF       9971<>CALL     9975<>CALL    10993>>ASSIGN  11072>>ASSIGN
B$PS2$
      7854**DCL      9899<>CALL     9997>>ASSIGN  11019>>ASSIGN  11020>>ASSIGN  11021>>ASSIGN  11022>>CALLBLT
B$PS3$
      7855**DCL      9901<>CALL     9935>>ASSIGN   9991>>ASSIGN
B$PS4$
      7856**DCL      9903<>CALL     9944<>CALL     9964>>ASSIGN  10494<>CALL
B$PS5$
      7857**DCL      9763>>ASSIGN  10270>>ASSIGN  11195>>IF      11195>>IF
B$PS6$
      7858**DCL      9753>>IF       9765>>IF
B$PSEG.P0.BOUND
      7961**DCL     10209>>ASSIGN  10965>>IF
B$PSEG.P1.BOUND
      7983**DCL     10129>>ASSIGN
B$PSEG.P2.BOUND
      8005**DCL     10133>>ASSIGN  10222>>ASSIGN  11014>>IF
B$PSEG.P4
      8047**DCL      9784>>ASSIGN
B$PSEG.P5
      8069**DCL      9764>>ASSIGN
B$PTR
      7913**DCL     10985<>CALL    11157<<ASSIGN  11159<<ASSIGN  11159>>ASSIGN
B$PTYPE
      9249**DCL      9997<<ASSIGN  10002>>IF      10004>>IF
B$PTYPE_MLINK.MLINK
      9250**DCL      9917>>IF
B$ROSEG.DCBPTR$
       708**DCL     10979>>ASSIGN
B$ROSEG.ECCB
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:276  
       714**DCL     10725--ASSIGN
B$ROSEG.NUMDCBS
       710**DCL     10978>>DOINDEX
B$ROSEG.TREE$
       709**DCL      9631>>IF
B$ROSEG$
      7865**DCL      9631>>IF      10725>>ASSIGN  10978>>DOINDEX 10979>>ASSIGN
B$SNAPUSR.U#
      9344**DCL     10966>>ASSIGN
B$SS.FPT
       771**DCL     10522<<ASSIGN  10522>>ASSIGN
B$SS.FPT.ALT
       772**DCL      9663>>IF      10657>>IF      10809>>IF
B$SS.FPT.CODE
       774**DCL     10655>>IF
B$SS.FPT.FCG
       773**DCL     10655>>IF
B$SS.FPTCHK
       813**DCL     10521<<ASSIGN
B$SS.IC
       779**DCL      9659>>ASSIGN   9660<<ASSIGN   9664<<ASSIGN   9664>>ASSIGN   9840<<ASSIGN   9840>>ASSIGN
      9861<<ASSIGN   9861>>ASSIGN  10659<<ASSIGN  10659>>ASSIGN  10810<<ASSIGN  10810>>ASSIGN
B$SS.ISR.WSR
       817**DCL      9618>>ASSIGN   9687>>IF       9691>>IF      10202>>IF      10244>>IF      10796>>IF
     10950>>IF      11035>>IF      11053>>IF      11095>>ASSIGN  11267>>DOWHILE 11269>>IF
B$SS.RVA
       812**DCL       813--REDEF
B$SS.X1
       911**DCL      9659<<ASSIGN
B$STARF.STAR
      8085**DCL     11171>>IF
B$TXT6
      7911**DCL     11200>>IF      11226>>ASSIGN
B$U.ACP
      1046**DCL      9902>>ASSIGN  10542>>IF      10544>>ASSIGN  10544>>ASSIGN  10545<<ASSIGN
B$U.APO
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:277  
      1050**DCL     10027>>ASSIGN  10029<<ASSIGN  11290>>ASSIGN  11292<<ASSIGN
B$U.APR
      1049**DCL      9642>>IF       9894>>ASSIGN  10024>>IF      10026>>ASSIGN  10030<<ASSIGN  10141>>IF
     10498>>IF      10498>>IF      11287>>IF      11289>>ASSIGN  11293<<ASSIGN
B$U.ASL
      1048**DCL      9841>>IF       9898>>ASSIGN  10095>>IF      10096>>IF      10169>>IF      11298>>IF
B$U.ASP
      1051**DCL      9896>>ASSIGN  10033>>IF      10035>>ASSIGN  10037<<ASSIGN  10075>>IF      10076>>ASSIGN
     10160>>IF      11248<<ASSIGN
B$U.ASYNCH
      1027**DCL     10529<<ASSIGN  10529>>ASSIGN
B$U.CMF
      1052**DCL      9624>>IF       9626>>DOWHILE
B$U.DB
      1047**DCL      9841>>IF       9900>>ASSIGN  10121>>IF      10122>>IF      10179>>IF      10784>>IF
     11298>>IF
B$U.FLG
       956**DCL     10124<<ASSIGN  10124>>ASSIGN
B$U.FLG.CPIC
       962**DCL     10580<<ASSIGN
B$U.FLG.DELA
       961**DCL     11108<<ASSIGN
B$U.FLG.DIC
       959**DCL     10628<<ASSIGN  10654<<ASSIGN
B$U.FLG.STEP
       983**DCL     10282<<ASSIGN
B$U.MF
      1045**DCL      9626>>DOWHILE
B$U.MISC
      1069**DCL      1070--REDEF
B$ULNK.ASLENT.ENTLOC
      9047**DCL     11113<<ASSIGN
B$ULNK.ASLENT.TYP
      9051**DCL     11114<<ASSIGN
B$ULNK.ECCB.FLGS
      9006**DCL     10788<<ASSIGN  10788>>ASSIGN  11109<<ASSIGN  11109>>ASSIGN
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:278  
B$ULNK.TCB
      9010**DCL     10749>>ASSIGN
B$UPT$
      7860**DCL     11254>>ASSIGN
B$USER.MISC
      1145**DCL      1146--REDEF
B$USER.US
      1132**DCL     10967>>IF
B$USERLS$
      7862**DCL     10749>>ASSIGN  10788>>ASSIGN  10788>>ASSIGN  11109>>ASSIGN  11109>>ASSIGN  11113>>ASSIGN
     11114>>ASSIGN
B$USRT$
      7867**DCL     10967>>IF
B$XCON.CECCB.PROG
      9156**DCL     10758>>IF
B$XCON.ERR.ERR#
      9162**DCL      9162--REDEF
B$XCON.LIMIT.MEM
      9160**DCL      9160--REDEF
BAD_CMD
      9799**LABEL    9796--GOTO
BAD_PNUM
      9936**LABEL    9936--GOTO
BAD_SHARE
     10033**LABEL   10028--CALLALT 10036--CALLALT
BAD_USR
     10967**LABEL   10965--GOTO
B_MPT.AS
      7795**DCL      7798--REDEF
B_MPT.ASDESC
      7827**DCL      7831--REDEF
B_MPT.ECCB
      7810**DCL      7813--REDEF
B_MPT.ECCB$
      7813**DCL      9727>>IF       9735>>IF       9841>>IF       9857>>IF      10760>>ASSIGN  10801>>ASSIGN
     11096>>IF      11099>>ASSIGN  11275>>IF      11277>>IF
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:279  
B_MPT.ECCBDESC
      7845**DCL      7849--REDEF
B_MPT.ECCBDESC$
      7849**DCL      9667>>IF       9857>>IF
B_MPT.LS
      7790**DCL      7793--REDEF
B_MPT.LSDESC
      7821**DCL      7825--REDEF
B_MPT.LSDESC$
      7825**DCL     10750>>ASSIGN  10756>>ASSIGN
B_MPT.PS
      7800**DCL      7803--REDEF
B_MPT.PS$
      7803**DCL      9764>>ASSIGN   9784>>ASSIGN  10129>>ASSIGN  10133>>ASSIGN  10209>>ASSIGN  10222>>ASSIGN
     10965>>IF      11014>>IF
B_MPT.PSDESC
      7833**DCL      7837--REDEF
B_MPT.PSDESC$
      7837**DCL     11149>>ASSIGN
B_MPT.SS
      7785**DCL      7788--REDEF
B_MPT.SS$
      7788**DCL      9618>>ASSIGN   9659>>ASSIGN   9659>>ASSIGN   9660>>ASSIGN   9663>>IF       9664>>ASSIGN
      9664>>ASSIGN   9687>>IF       9691>>IF       9840>>ASSIGN   9840>>ASSIGN   9861>>ASSIGN   9861>>ASSIGN
     10202>>IF      10244>>IF      10521>>ASSIGN  10522>>ASSIGN  10522>>ASSIGN  10655>>IF      10655>>IF
     10657>>IF      10659>>ASSIGN  10659>>ASSIGN  10796>>IF      10802<>CALL    10809>>IF      10810>>ASSIGN
     10810>>ASSIGN  10950>>IF      11035>>IF      11053>>IF      11095>>ASSIGN  11267>>DOWHILE 11269>>IF
B_MPT.SSDESC
      7815**DCL      7819--REDEF
B_MPT.TCB
      7805**DCL      7808--REDEF
B_MPT.TCB$
      7808**DCL     10802<>CALL
B_MPT.TCBDESC
      7839**DCL      7843--REDEF
B_MUAIS
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:280  
      7901**DCL     10967>>IF
B_SITEINFO.VERSION#
      7896**DCL     11021>>ASSIGN
CHECK_PSTACK
     11147**PROC     9707--CALL     9751--CALL     9778--CALL    10262--CALL
CMD_SZ
      7634**DCL      9794<<ASSIGN   9795>>IF       9799>>ASSIGN   9803<<ASSIGN   9806>>IF
CMD_TYPE
      7633**DCL      9754<<ASSIGN   9755<<ASSIGN   9776<<ASSIGN   9792>>IF
CODE
      7566**DCL         9--PROC     9621>>DOCASE   9831>>IF      10062>>DOCASE  11177>>IF      11186>>IF
     11192>>IF      11211>>IF
COMMON IN PROCEDURE MVPROC
     11336**LABEL   11333--GOTO
CPEXIT$V
      9204**DCL     10270>>ASSIGN
CPEXIT$V.GETFLG#
      9213**DCL     11195>>IF
CPEXIT$V.SAVEFLG#
      9212**DCL     11195>>IF
CPEXIT_ALTRET
     10500**LABEL   10476--GOTO    10494--CALLALT 10496--CALLALT
CPEXIT_RUND
      7578**DCL     10272<<ASSIGN  10411<<ASSIGN  10411>>ASSIGN  10560>>IF
CPEXIT_V
      9232**DCL     10270<<ASSIGN  10271--ASSIGN  10423>>IF
CPEXIT_V.ALTRTN#
      9240**DCL     10307>>IF      10432>>IF      10847>>IF
CPEXIT_V.CONT#
      9240**DCL     10307>>IF      10490>>IF      10713>>IF
CPEXIT_V.CPOFF#
      9241**DCL     10593>>IF
CPEXIT_V.GETFLG#
      9241**DCL     10442>>IF      10649>>IF
CPEXIT_V.JERR
      9242**DCL     10598>>ASSIGN  10851<<ASSIGN  10870>>ASSIGN  10880>>ASSIGN
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:281  
CPEXIT_V.JERR.CODE#
      9243**DCL     10596>>IF      10850>>IF
CPEXIT_V.LINK#
      9241**DCL     10470>>IF
CPEXIT_V.QUIT#
      9240**DCL     10316>>IF      10683>>IF
CPEXIT_V.SAVEFLG#
      9240**DCL     10894>>IF
CPFPT.FLAGS
      9246**DCL     10319>>IF      10341>>IF      10360<<ASSIGN  10392>>IF      10406>>IF      10442>>IF
     10452>>IF      10577>>IF
CP_VALID2
     10496**LABEL   10313--GOTO    10317--GOTO    10338--GOTO    10342--GOTO    10397--GOTO    10412--GOTO
     10499--GOTO
DATA1
      7568**DCL      9669<<ASSIGN   9673<>CALL    10137<<ASSIGN  10148<>CALL    10767<<ASSIGN  10768<>CALL
     10794<<ASSIGN  10802<>CALL    10814<>CALL
DB_CHK
     10480**LABEL   10310--GOTO
DEBUG_NAME
      7636**DCL     10266<<ASSIGN  10267--ASSIGN
DELTA_GET
     10763**LABEL   10742--GOTO
DF_NAME.DUMPC
      7907**DCL     11022<<CALLBLT
DF_NAME.L
      7907**DCL     11019<<ASSIGN
DF_NAME.MONID
      7907**DCL      7907--REDEF
DF_NAME.MONID4
      7907**DCL     11021<<ASSIGN
DF_NAME.N1
      7907**DCL     11020<<ASSIGN
DO_ALTRET
     10192**LABEL   10054--CALLALT 10108--CALLALT 10123--CALLALT
DO_CPEXIT
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:282  
     10661**LABEL   10617--GOTO    10629--GOTO    10785--GOTO
DO_SAVE
     11260**PROC     9714--CALL    10897--CALL
D_TCB_FULL
     10902**LABEL   10753--CALLALT 10802--CALLALT
EBADVECT1
      9372**DCL      9958>>ASSIGN  10213>>ASSIGN
EBADVECT2
      9380**DCL     10226>>ASSIGN  11016>>ASSIGN
EBADVECT3
      9388**DCL      9941>>ASSIGN
ECPALT
      9476**DCL     10435>>ASSIGN
ECYALT
      9500**DCL     10851>>ASSIGN
EDEBUGSP
      9516**DCL     10500>>ASSIGN
EDFBUSY
      9564**DCL     11003>>ASSIGN
EDLIB
      9436**DCL     10083>>ASSIGN
EDLIBREQ
      9452**DCL     10099>>ASSIGN
EDOMAIN
      9420**DCL     10059>>ASSIGN  10118>>ASSIGN  10204>>ASSIGN  10246>>ASSIGN  11037>>ASSIGN  11055>>ASSIGN
EFPT
      9364**DCL      9710>>ASSIGN   9878>>ASSIGN  11319>>ASSIGN
EFPT5
      9412**DCL      9809>>ASSIGN
EJOBSTEP
      9468**DCL     10425>>ASSIGN
ELIBUNSH
      9444**DCL     10069>>ASSIGN
ELINK
      9540**DCL      9737>>ASSIGN
ELOGOFF
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:283  
      9492**DCL     10455>>ASSIGN
END_FND_CG
     10991**LABEL   10986--GOTO
ENJOBSTEP
      9484**DCL     10445>>ASSIGN
ENOOVRLY
      9604**DCL      9634>>ASSIGN
ENOPROC
      9404**DCL      9922>>ASSIGN   9977>>ASSIGN
ENOSTEPS
      9508**DCL     10355>>ASSIGN
ENOTASSOC
      9460**DCL     10188>>ASSIGN
ENTRY_ADDR
      7643**DCL      9643<>CALL     9644<>CALL     9660>>ASSIGN
EOFF
      9596**DCL     10597>>ASSIGN
EOPTPMME
      9524**DCL     11130>>ASSIGN
ERRJSQ IN PROCEDURE DO_SAVE
     11262**DCL     11274<>CALL    11320>>ASSIGN
ESAVE
      9532**DCL      9729>>ASSIGN
ESNAPU
      9556**DCL     10970>>ASSIGN
ESSAVE
      9548**DCL     11279>>ASSIGN
EWRONGTYPE
      9396**DCL     10005>>ASSIGN
EXCONRTNA
      9588**DCL     11076>>ASSIGN
EXCONRTNE
      9580**DCL     11077>>ASSIGN
F$DCB.ACTPOS
      3890**DCL      3890--REDEF
F$DCB.ARS
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:284  
      3865**DCL      3865--REDEF
F$DCB.ASN
      3880**DCL     10982>>IF
F$DCB.ATTR
      3883**DCL      3884--REDEF
F$DCB.BORROW
      3898**DCL      3898--REDEF    3898--REDEF    3898--REDEF
F$DCB.DCBNAME.L
      3912**DCL      3912--IMP-SIZ
F$DCB.EOMCHAR
      3869**DCL      3869--REDEF
F$DCB.FCD
      3878**DCL     10982>>IF
F$DCB.FLDID
      3893**DCL      3893--REDEF
F$DCB.FORM$
      3887**DCL      3887--REDEF
F$DCB.FSECT
      3903**DCL      3903--REDEF
F$DCB.FSN
      3880**DCL      3880--REDEF    3880--REDEF    3881--REDEF
F$DCB.HEADER$
      3886**DCL      3886--REDEF
F$DCB.IXTNSIZE
      3884**DCL      3884--REDEF
F$DCB.LASTSTA$
      3874**DCL      3874--REDEF
F$DCB.LDCTX
      3887**DCL     10984>>ASSIGN
F$DCB.LVL
      3899**DCL      3899--REDEF
F$DCB.NAME.C
      3874**DCL      3874--REDEF
F$DCB.NOEOF
      3895**DCL      3895--REDEF
F$DCB.NRECS
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:285  
      3885**DCL      3885--REDEF
F$DCB.NRECX
      3904**DCL      3904--REDEF
F$DCB.OHDR
      3896**DCL      3896--REDEF
F$DCB.ORG
      3879**DCL      3879--REDEF
F$DCB.PRECNO
      3902**DCL      3902--REDEF
F$DCB.RCSZ
      3907**DCL      3907--REDEF
F$DCB.RES
      3875**DCL      3875--REDEF
F$DCB.SETX
      3887**DCL      3887--REDEF
F$DCB.TAB$
      3886**DCL      3887--REDEF
F$DCB.TDA
      3901**DCL      3901--REDEF
F$DCB.WSN
      3876**DCL      3876--REDEF
FNTEXTC
      8079**DCL     11345<<ASSIGN
FNTEXTC.SIZ
      8080**DCL     11356<<ASSIGN
FNTEXTC.TEXT
      8081**DCL     11355<<ASSIGN
FPT$LINK_V.ECHO
      9186**DCL      9765>>IF
FPT$LINK_V.TEXTC
      9186**DCL      9753>>IF
FPT$OLAY_V
      9177**DCL      9644<>CALL
FPT$OLAY_V.FLGS
      9177**DCL      9670>>ASSIGN
FPT$OLAY_V.FLGS.ENTER
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:286  
      9177**DCL      9657>>IF
FPT$SCON_V.SAVEFLG
      9174**DCL      9685>>IF
FPT$SCON_V.XCON
      9174**DCL      9694>>IF
FPT$UNSHARE_V.FLGS.LIB
      9183**DCL     10033>>IF
FPT$UNSHARE_V.FLGS.PROG
      9183**DCL     10024>>IF
FPT$XCONRTN_V.NOENTRY
      9180**DCL     11068>>IF
FPT_BAD
      9874**LABEL    9707--CALLALT  9778--CALLALT  9781--GOTO    10207--CALLALT 10208--CALLALT 10262--CALLALT
FREE_DS
     10546**LABEL   10546--GOTO
GET_PROCS
     10142**LABEL   10086--GOTO    10089--GOTO
GOT_XFPT
     11075**LABEL   11073--GOTO
HFC$LOCK
      3926**DCL-ENT 10527--CALL    11246--CALL
HFC$UNLOCK
      3926**DCL-ENT  9981--CALL    10531--CALL    11251--CALL
HFF$NILERASE
      7665**DCL-ENT  9761--CALL     9933--CALL     9963--CALL     9996--CALL    10128--CALL    10132--CALL
     10207--CALL    10211--CALL    10218--CALL    10992--CALL    11013--CALL    11067--CALL    11071--CALL
     11158--CALL    11338--CALL
HFF$PTPRES
      7666**DCL-ENT 10208--CALL
HFF$WRITE
      7667**DCL-ENT  9990--CALL    10220--CALL
I
      7570**DCL     10027<<ASSIGN  10028<>CALL    10724<<DOINDEX 10725>>ASSIGN  10728>>ASSIGN  10978<<DOINDEX
     10979>>ASSIGN  10991<<ASSIGN  10992<>CALL    11095<<ASSIGN  11106>>DOCASE  11120>>IF      11121<>CALL
     11154<<ASSIGN  11156>>DOWHILE 11158<>CALL    11163<<ASSIGN  11163>>ASSIGN  11212<<DOINDEX 11213>>IF
     11213>>IF      11215>>ASSIGN  11215>>ASSIGN  11290<<ASSIGN  11291<>CALL
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:287  
I IN PROCEDURE ZAPCLIB
     11243**DCL     11253<<DOINDEX 11254>>ASSIGN
IRM$USER$SCREECH
      7696**DCL-ENT 11000--CALL
IRM_ASCOUNT
      7881**DCL     11011>>ASSIGN  11022>>CALLBLT
IRM_NODUMP
      7880**DCL     11001>>IF
J
      7571**DCL      9706<<ASSIGN   9750<<ASSIGN   9777<<ASSIGN  10261<<ASSIGN  10728<<ASSIGN  10732<>CALL
     11011<<ASSIGN  11066<<ASSIGN  11069<<ASSIGN  11104>>IF      11150>>IF      11156>>DOWHILE
J IN PROCEDURE ZAPCLIB
     11242**DCL     11241--PROC    11249>>ASSIGN  11249>>ASSIGN
JDP$SEGLD
      7672**DCL-ENT  9643--CALL
JDS$OVRLY
      7673**DCL-ENT  9644--CALL
JIT_SET
      9861**LABEL    9643--CALLALT  9644--CALLALT  9833--CALLALT  9845--CALLALT
JLL$LDTRC
      7669**DCL-ENT  9845--CALL
JLL$LINK
      7668**DCL-ENT  9833--CALL    10474--CALL
JLL$LOCATE
      7671**DCL-ENT  9919--CALL
JLL$RTN
      7670**DCL-ENT 10876--CALL
JQS$GET
      7658**DCL-ENT 10651--CALL
JQS$SAVE
      7657**DCL-ENT 11302--CALL
JQU$VALID
      7656**DCL-ENT 11274--CALL
JSA$ALIBDB
      7683**DCL-ENT 10123--CALL
JSA$ASL
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:288  
      7682**DCL-ENT 10108--CALL
JSA$CLIB
      7681**DCL-ENT 10085--CALL    10088--CALL
JSA$CPQUIT
      7654**DCL-ENT 10686--CALL
JSA$DBCHK
      7684**DCL-ENT 10496--CALL
JSA$FINDAUTO
      7686**DCL-ENT  9975--CALL
JSA$FINDSSP
      7685**DCL-ENT  9971--CALL    10054--CALL    10494--CALL
JSA$QUIT
      7653**DCL-ENT 10687--CALL
JSA$RUNDSPC
      7648**DCL-ENT 10552--CALL    10556--CALL    11121--CALL
JSA$UNSHARE
      7649**DCL-ENT 10028--CALL    10036--CALL    11291--CALL
JSD$DELUSR
      7662**DCL-ENT 10582--CALL
JSE$ABORTM
      7645**DCL-ENT 10666--CALL
JSE$ABORTX
      7646**DCL-ENT 10607--CALL    10689--CALL    11062--CALL    11124--CALL
JSE$ACP
      7655**DCL-ENT 10234--CALL    10663--CALL    10877--CALL    10903--CALL
JSF$CLSDCBS
      7663**DCL-ENT 10567--CALL
JSP_CONT
     10811**LABEL   10881--GOTO
JSP_CONT2
     10831**LABEL   10900--GOTO
JSR$RUNDOWN
      7661**DCL-ENT 10562--CALL    10581--CALL    10862--CALL
JSS$BACKSS
      7650**DCL-ENT 11271--CALL
JSS$RUNDSPC
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:289  
      7651**DCL-ENT 10558--CALL    11041--CALL    11123--CALL
JST$GETPROG
      7647**DCL-ENT 10674--CALL
JSU$RSTLMS
      7652**DCL-ENT 10568--CALL
JSX$RUNXCON
      7694**DCL-ENT 10171--CALL    10183--CALL
JSX$SVLDTXCON
      7660**DCL-ENT  9870--CALL    11311--CALL
JSX$UNXCON
      7695**DCL-ENT 11097--CALL
JSX$XCONSAVE
      7659**DCL-ENT  9860--CALL    11315--CALL
JS_FLAGS
      7721**DCL     10423>>IF
J_LOGON
      7871**DCL     10542>>IF
J_PLOCK
      7874**DCL      9981<>CALL    11246<>CALL    11251<>CALL
J_SYS$
      7876**DCL      9962>>ASSIGN  10054<>CALL    10494<>CALL
J_SYSTXT
      7875**DCL     11187>>ASSIGN  11211>>IF
KQX$LDASR
      7674**DCL-ENT 10985--CALL
LNK_RTN
     10868**LABEL   10863--GOTO
MM$DESC.BOUND
      5184**DCL      5185--REDEF
MM$DESC.FLGS
      5185**DCL      5185--REDEF
MM$PPUT.USER#
      5173**DCL      5173--REDEF
MM_BYP$
      5104**DCL      5104--IMP-PTR
MM_FPMC
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:290  
      5110**DCL     11254>>ASSIGN
MPARAM
      9338**DCL     10945>>ASSIGN
MPARAM.ERR
      9339**DCL     10993>>ASSIGN  11072>>ASSIGN
MSCODE
      7579**DCL     10945<<ASSIGN  10998>>ASSIGN
MSCODE.AUSER
      7588**DCL     10963>>IF
MSCODE.CUSR
      7586**DCL     10996<<ASSIGN
MSCODE.MON
      7582**DCL     10995<<ASSIGN
MSCODE.SEV
      7584**DCL     10953<<ASSIGN  10957>>IF      10958<<ASSIGN  10959>>IF      10960<<ASSIGN
MVACCT IN PROCEDURE MVPROC
     11335**ENTRY    9944--CALL
MVPROC
     11328**PROC     9895--CALL     9897--CALL     9899--CALL     9901--CALL     9903--CALL     9943--CALL
N$DCT$$
      5342**DCL      5342--IMP-PTR 10984>>ASSIGN
NEXTP IN PROCEDURE CHECK_PSTACK
     11159**LABEL   11158--CALLALT
NIL_DESC
      7749**DCL      9748>>ASSIGN
NK$LDCT.CG$
      9145**DCL     10984>>ASSIGN
NK$LDCT.DDT$
      9116**DCL      9116--REDEF
NK$LDCT.IOQ$
      9115**DCL      9116--REDEF
NK$LDCT.LDCTX
      9117**DCL      9117--REDEF
NK$LDCT.LKFLG.ABORTED
      9129**DCL      9130--REDEF
NK$LDCT.RLCID.LDCTX
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:291  
      9139**DCL      9139--REDEF
NK$LDCT.STA$
      9135**DCL      9136--REDEF
NK$LDCT.SYMB$
      9114**DCL      9114--REDEF    9114--REDEF    9115--REDEF
NK$LDCT$
      5342**DCL     10984>>ASSIGN
NOTOVLAID
      9634**LABEL    9624--GOTO
NOT_CP_CMD
      9777**LABEL    9761--CALLALT
NO_ACCT
      9964**LABEL    9963--CALLALT
NO_COUNT
     11022**LABEL   11004--GOTO    11013--CALLALT
NO_GET
     10661**LABEL   10651--CALLALT
NO_JITERR
     10993**LABEL   10992--CALLALT
NO_PNUM
      9991**LABEL    9945--GOTO     9990--CALLALT
NO_REPLY
     10228**LABEL   10218--CALLALT
NO_RTYPE
      9997**LABEL    9996--CALLALT
NO_SAVE
     10896**LABEL   10897--CALLALT
NO_XFPT
     11068**LABEL   11067--CALLALT
NO_XFPT2
     11072**LABEL   11071--CALLALT
P$ IN PROCEDURE MVPROC
     11329**DCL     11328--PROC    11335--ENTRY   11338<>CALL    11345>>ASSIGN  11346>>ASSIGN  11355>>ASSIGN
     11356>>ASSIGN  11358>>ASSIGN
P5$
      7569**DCL     10271<<ASSIGN  10319>>IF      10341>>IF      10360>>ASSIGN  10392>>IF      10406>>IF
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:292  
     10442>>IF      10452>>IF      10577>>IF
PNUM
      7575**DCL      9894<<ASSIGN   9896<<ASSIGN   9898<<ASSIGN   9900<<ASSIGN   9902<<ASSIGN   9914<<ASSIGN
      9935<<ASSIGN   9936>>IF       9936>>IF       9971<>CALL     9975<>CALL     9991>>ASSIGN  10026<<ASSIGN
     10028<>CALL    10035<<ASSIGN  10036<>CALL    10054<>CALL    10075>>IF      10085<>CALL    10095>>IF
     10108<>CALL    10121>>IF      10123<>CALL    10158>>IF      10160>>IF      10161<>CALL    10167>>IF
     10169>>IF      10177>>IF      10179>>IF      10494<>CALL    10496<>CALL    11289<<ASSIGN  11291<>CALL
     11341>>IF      11341>>IF      11343>>IF      11345>>ASSIGN  11346>>ASSIGN
PSIZE
      7574**DCL     11149<<ASSIGN  11150>>IF
PTR$
      7914**DCL     10979>>ASSIGN
PTYPE
      7576**DCL      9915<<ASSIGN   9971<>CALL     9974<<ASSIGN   9978<<ASSIGN   9997>>ASSIGN  10004>>IF
     10053<<ASSIGN  10054<>CALL    10056>>IF      10065>>IF      10093>>IF      10114>>IF      10493<<ASSIGN
     10494<>CALL
P_AUTO_START
       670**DCL     10498>>IF      11287>>IF
P_LAST_AUTO
       671**DCL      9936>>IF      11341>>IF
RESTART_CP
     10455**LABEL   10356--GOTO    10426--GOTO    10436--GOTO    10446--GOTO
RESTORE_ASP
     10077**LABEL   10085--CALLALT
RUNDOWN_FIRST
     10398**LABEL   10320--GOTO    10361--GOTO    10398--GOTO
S$CU$
      7868**DCL      9624>>IF       9626>>DOWHILE  9626>>DOWHILE  9642>>IF       9841>>IF       9841>>IF
      9894>>ASSIGN   9896>>ASSIGN   9898>>ASSIGN   9900>>ASSIGN   9902>>ASSIGN  10024>>IF      10026>>ASSIGN
     10027>>ASSIGN  10029>>ASSIGN  10030>>ASSIGN  10033>>IF      10035>>ASSIGN  10037>>ASSIGN  10075>>IF
     10076>>ASSIGN  10095>>IF      10096>>IF      10121>>IF      10122>>IF      10124>>ASSIGN  10124>>ASSIGN
     10141>>IF      10160>>IF      10169>>IF      10179>>IF      10282>>ASSIGN  10498>>IF      10498>>IF
     10529>>ASSIGN  10529>>ASSIGN  10542>>IF      10544>>ASSIGN  10544>>ASSIGN  10545>>ASSIGN  10580>>ASSIGN
     10628>>ASSIGN  10654>>ASSIGN  10784>>IF      11108>>ASSIGN  11248>>ASSIGN  11287>>IF      11289>>ASSIGN
     11290>>ASSIGN  11292>>ASSIGN  11293>>ASSIGN  11298>>IF      11298>>IF
SAVEP
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:293  
      7596**DCL      9673<>CALL     9852--ASSIGN   9852--ASSIGN   9860<>CALL     9870<>CALL    10126--ASSIGN
     10148<>CALL    10802<>CALL    10814<>CALL    11308--ASSIGN  11308--ASSIGN  11311<>CALL    11315<>CALL
SAVEP.ACCT
      7608**DCL     11173<<ASSIGN  11182<<ASSIGN  11183>>IF      11187<<ASSIGN  11190<<ASSIGN  11208--ASSIGN
     11211>>IF
SAVEP.ACCT$
      7606**DCL      7606--REDEF
SAVEP.CMD_DSCR
      7625**DCL      9748<<ASSIGN   9764<<ASSIGN   9784<<ASSIGN   9813--ASSIGN
SAVEP.CMD_DSCR.BASE
      7628**DCL      9798<<ASSIGN   9798>>ASSIGN
SAVEP.CMD_DSCR.BOUND
      7627**DCL      9795>>IF       9799<<ASSIGN   9803>>ASSIGN
SAVEP.CMD_DSCR$
      7607**DCL      7607--REDEF    7607--REDEF
SAVEP.ECCS
      7602**DCL      7602--REDEF    9643<>CALL     9644<>CALL     9851<<ASSIGN  10127<<ASSIGN  10729<<ASSIGN
     10732<>CALL    10790<<ASSIGN
SAVEP.EVID
      7602**DCL      9670<<ASSIGN  10131<<ASSIGN  10730<<ASSIGN  10732<>CALL    10791<<ASSIGN
SAVEP.FNAME
      7607**DCL     11169<<ASSIGN  11170--ASSIGN
SAVEP.FNAME.CNT
      7607**DCL     11212>>DOINDEX
SAVEP.FNAME.CTXT
      7607**DCL     11213>>IF      11213>>IF      11215<<ASSIGN  11215>>ASSIGN
SAVEP.FNAME.TXT
      7607**DCL      7607--REDEF
SAVEP.JERR
      7602**DCL      9671<<ASSIGN  10135<<ASSIGN  10731<<ASSIGN  10732<>CALL    10792<<ASSIGN
SAVEP.NAME$
      7606**DCL      7606--REDEF
SAVEP.P#
      7602**DCL      9672<<ASSIGN   9852<<ASSIGN  10136<<ASSIGN  10793<<ASSIGN  11308<<ASSIGN
SAVEP.P0$
      7606**DCL      9708>>IF       9762<<ASSIGN   9781>>IF       9833<>CALL     9845<>CALL     9852--ASSIGN
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:294  
     10316>>IF      10319>>IF      10333>>IF      10341>>IF      10359<<ASSIGN  10392>>IF      10452>>IF
     10474<>CALL    10577>>IF      10651<>CALL    10674<>CALL    11152--ASSIGN  11167>>IF      11169>>ASSIGN
     11169>>ASSIGN  11170<<ASSIGN  11171>>IF      11302<>CALL    11308--ASSIGN
SAVEP.P1$
      7606**DCL      9762<<ASSIGN   9833<>CALL     9845<>CALL    10474<>CALL    10651<>CALL    10674<>CALL
     11180>>IF      11182>>ASSIGN  11208<<ASSIGN  11302<>CALL
SAVEP.P2$
      7606**DCL      9762<<ASSIGN   9833<>CALL     9845<>CALL    10474<>CALL    10651<>CALL    10674<>CALL
     11218>>IF      11220>>ASSIGN  11221<<ASSIGN  11302<>CALL
SAVEP.P3$
      7606**DCL      9762<<ASSIGN   9833<>CALL     9845<>CALL    10474<>CALL    10651<>CALL    10674<>CALL
     11198>>IF      11200>>IF      11203<<ASSIGN  11224>>IF      11226>>ASSIGN  11227<<ASSIGN  11302<>CALL
SAVEP.P4$
      7607**DCL      9763<<ASSIGN   9783>>IF       9790>>IF       9794>>ASSIGN   9813<<ASSIGN   9833<>CALL
      9845<>CALL    10264>>IF      10266>>ASSIGN  10266>>ASSIGN  10267<<ASSIGN  10309>>IF      10392>>IF
     10406>>IF      10490>>IF      10674<>CALL    10782>>IF      11307<<ASSIGN
SAVEP.PASS
      7608**DCL     11220<<ASSIGN  11221--ASSIGN
SAVEP.PASS$
      7606**DCL      7606--REDEF
SAVEP.PSID
      7608**DCL     11226<<ASSIGN  11227--ASSIGN
SAVEP.PSID$
      7606**DCL      7606--REDEF
SAVE_ALTRET
      9713**LABEL    9714--CALLALT
SCRUSR#
      7589**DCL     10966<<ASSIGN  10967>>IF      10967>>IF      10977<<ASSIGN  10999>>ASSIGN
SC_CPEXIT
      7697**DCL-ENT 10910--CALL
SC_JSPDTCB
      7698**DCL-ENT 10921--CALL
SC_USER.RC
      7878**DCL     10998<<ASSIGN
SC_USER.USER#
      7879**DCL     10999<<ASSIGN
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:295  
SET_BLNKS IN PROCEDURE MVPROC
     11344**LABEL   11343--GOTO
SET_DLIBREQ
     10096**LABEL   10122--GOTO
SET_FACCN IN PROCEDURE CHECK_PSTACK
     11185**LABEL   11183--GOTO
SET_NOSTEPS
     10337**LABEL   10321--GOTO
SET_NOTASSC
     10182**LABEL   10160--GOTO    10169--GOTO    10179--GOTO
SET_P1$ IN PROCEDURE CHECK_PSTACK
     11199**LABEL   11174--GOTO    11193--GOTO    11196--GOTO
SET_P3$ IN PROCEDURE CHECK_PSTACK
     11195**LABEL   11199--GOTO
SET_PNUM
      9974**LABEL    9959--GOTO
SFLAG IN PROCEDURE DO_SAVE
     11261**DCL     11260--PROC    11270<<ASSIGN  11270>>ASSIGN  11306>>ASSIGN  11322>>ASSIGN
SGFLAG
      7577**DCL      9713<<ASSIGN   9714<>CALL    10738<<ASSIGN  10741>>IF      10873<<ASSIGN  10875>>IF
     10896<<ASSIGN  10897<>CALL
SSIC
      7640**DCL     10801<<ASSIGN  10802<>CALL
SSR$REG
      7687**DCL-ENT  9627--CALL    10153--CALL
SSR$RUE
      7688**DCL-ENT 11042--CALL
SST$SSFTCB
      7689**DCL-ENT 10802--CALL
SSU$DELTAGO
      7693**DCL-ENT  9673--CALL    10148--CALL    10768--CALL    10814--CALL
SSV$EVENT
      7690**DCL-ENT 10732--CALL
SUA_CPEXIT
     10902**LABEL   10375--GOTO
S_ASFGATE
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:296  
      7904**DCL     10527<>CALL    10531<>CALL
S_CUN
      7902**DCL     10952>>IF
S_MING
      7903**DCL     10952>>IF
T1$
      7572**DCL      9962<<ASSIGN   9964<<ASSIGN   9971<>CALL     9975<>CALL    10126<<ASSIGN  10129>>ASSIGN
     10133>>ASSIGN  10140>>ASSIGN  10142>>ASSIGN  10144>>ASSIGN  10725<<ASSIGN  10726>>IF      10752<<ASSIGN
     10753<>CALL    10758>>IF      10763<<ASSIGN  10764<>CALL    10979<<ASSIGN  10980>>IF      10982>>IF
     10982>>IF      10984>>ASSIGN  11152<<ASSIGN  11157>>ASSIGN  11159>>ASSIGN  11161<<ASSIGN  11161>>ASSIGN
T2$
      7573**DCL     10984<<ASSIGN  10985>>CALL    11153<<ASSIGN  11159>>ASSIGN  11162<<ASSIGN  11162>>ASSIGN
TASP
      7641**DCL     10076<<ASSIGN  10077>>IF      10082<>CALL    10088<>CALL
TEXTC
      8076**DCL     10266>>ASSIGN  11169>>ASSIGN
TEXTC.SIZ
      8077**DCL      8078--IMP-SIZ  9794>>ASSIGN   9931>>IF       9956>>IF      10266>>ASSIGN  11169>>ASSIGN
TYP IN PROCEDURE MVPROC
     11330**DCL     11332<<ASSIGN  11336<<ASSIGN  11344>>IF      11353>>IF
UDB$AUTO
      7675**DCL-ENT  9675--CALL    10832--CALL    11043--CALL
UDB$CALCOMP
      7677**DCL-ENT  9655--CALL     9830--CALL    10147--CALL    10233--CALL    10520--CALL    11040--CALL
     11061--CALL    11122--CALL
UDB$PMMEXIT2
      7676**DCL-ENT 10837--CALL
UDN$MAGIC
      7678**DCL-ENT  9620--CALL    10652--CALL
UDN$MAGICLS
      7679**DCL-ENT 10751--CALL    10757--CALL
UDN$MAGICSS
      7680**DCL-ENT 10799--CALL    11273--CALL
UEP$CLEARONE
      7691**DCL-ENT 10764--CALL
UEP$MOVETCB
PL6.E3A0      #001=JSP$PMME File=JSP$PMME.:E05TSI                                TUE 07/29/97 23:46 Page:297  
      7692**DCL-ENT 10753--CALL
USRIC IN PROCEDURE DO_SAVE
     11263**DCL     11266<<ASSIGN  11268<<ASSIGN  11309>>IF
WSR
      7642**DCL      9618<<ASSIGN  10057>>IF      10116>>IF      10139>>IF
ZAPCLIB
     11241**PROC    10082--CALL    10161--CALL
ZAPUSER
     10582**LABEL   10562--CALLALT 10581--CALLALT 10862--CALLALT
