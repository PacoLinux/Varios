VERSION E05

PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:1    
        1        1        /*M*     Allocate TIGR built tables for MSOS */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*P*     NAME:     ITM$MAINT
        9        9                 PURPOSE:  ITM$MAINT builds and initializes the tables for the
       10       10                           channel 4 (MSOS/DPS90) or channel 3 (MCA/DPS8000) interface.
       11       11                           The devices are known as MCnn (Maintenance Channel followed
       12       12                           by IOM number).                                          */
       13       13        ITM$MAINT: PROC(PTR$,IOM#)  ALTRET;
       14       14        /**/
       15       15    1   DCL PTR$ PTR;                           /* POINTER TO TIGR TABLE SPACE        */
       16       16    1   DCL IOM# UBIN;                          /* IOM NUMBER TO USE FOR MSOS STUFF   */
       17       17        /**/
       18       18        /*  INCLUDE FILES  */
       19       19        /**/
       20       20        %INCLUDE HF_DATA_R;
       21       63        %INCLUDE IT_ERROR_C;
       22      146        %INCLUDE NI_DATA_R;
       23      583        %INCLUDE IT_IDATA_R;
       24      700        %INCLUDE NK_SUBS;
       25      725        %SUB YES = '1'B/*YES*/;
       26      726        %SUB NO = '0'B/*NO*/;
       27      727        /**/
       28      728        /*  AUTOMATIC  */
       29      729        /**/
       30      730    1   DCL SQH$ PTR;
       31      731    1   DCL DQH$ PTR;
       32      732    1   DCL CHTX UBIN(36);
       33      733    1   DCL TEMP UBIN(15) ALIGNED; /* Used because NIO$SPINTCON wants 15-bit DCTX */
       34      734        %NI$IOSTAT;
       35      743    1   DCL DEV$ PTR;
       36      744    1   DCL 1 DUPCHANERR_TEXT,
       37      745    1         2 COUNT UBIN(9) UNAL,
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:2    
       38      746    1         2 CHANNEL CHAR(8) UNAL,
       39      747    1         2 IOMTEXT CHAR(1) UNAL,
       40      748    1         2 DASH CHAR(1) UNAL,
       41      749    1         2 CHANTEXT CHAR(2) UNAL;
       42      750    1   DCL DEVNM CHAR(8);
       43      751    1   DCL IOM_NUMBER CHAR(1);
       44      752        /**/
       45      753        /*  BASED  */
       46      754        /**/
       47      755        %NI$DVT;
       48      762        %NI$SQH;
       49      775        %NI$DQH;
       50      798        %NI$CHT;
       51      801        %NI$DCT;
       52      849        %NI$IOM;
       53      854        %NI$MBX;
       54      873        %NI$PARTITION(NAME=IT_PARTITION, STCLASS=SYMREF);
       55      881        /**/
       56      882        /*  ENTRY DCLS  */
       57      883        /**/
       58      884    1   DCL ITE$ERROR ENTRY(2);
       59      885    1   DCL NIB$POSTER ENTRY(3);
       60      886    1   DCL NIJ$POSTER ENTRY(3);
       61      887    1   DCL ITH$ALLOCATE ENTRY(2) ALTRET;
       62      888    1   DCL ITH$SQH_INIT ENTRY(2) ALTRET;
       63      889    1   DCL ITH$DCT_INIT ENTRY(2) ALTRET;
       64      890    1   DCL NIO$SPINTCON ENTRY(3) ALTRET;
       65      891    1   DCL TMA$MSOS_SPEC ENTRY(3);
       66      892        /**/
       67      893        /*  SYMREFS  */
       68      894        /**/
       69      895    1   DCL IT_TXT_0000 CHAR(4) SYMREF;
       70      896        /**/
       71      897        %EJECT;
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:3    
       72      898        /*D*     NAME:     ITM$MAINT
       73      899         PURPOSE:  To build the necessary tables for the channel 4 (MSOS) or channel 3 (MCA)
       74      900        *
       75      901                 INPUT:    PTR$ - parameter - pointer to next available location
       76      902                           in the TIGR table area
       77      903                           IOM# - IOM#/IMU# to build MSOS/MCA info in I/O tables.
       78      904                 OUTPUT:   The initialized tables
       79      905        *
       80      906                 DESCRIPTION:  ITM$MAINT aquires space for and initializes the
       81      907                           NI$SQH,NI$DQH and NI$DCT entries for this channel. In
       82      908                           addition the cell NI_MAINT_DCTX(IOM#) is initialized to the DCT
       83      909                           index of this channel.
       84      910                               The channel entry in the NI$CHT table is
       85      911                           initialized to point to the DQH.        */
       86      912        /**/
       87      913    1           CALL ITH$SQH_INIT(PTR$,SQH$) ALTRET(ITM$MAINT_ERR);
       88      914    1           SQH$ -> NI$SQH.NDCT = 1;
       89      915        /**/
       90      916    1           DQH$ = PTR$;
       91      917    1           CALL ITH$ALLOCATE(PTR$,SIZEW(NI$DQH)) ALTRET(ITM$MAINT_ERR);
       92      918        /**/
       93      919    1           DQH$ -> NI$DQH = NI$DQH_C;     /*  set to constant inited structure   */
       94      920        /**/
       95      921    1           DQH$ -> NI$DQH.FL$ = DQH$;
       96      922        /*      DQH$ -> NI$DQH.IO$ = ADDR(NIL);         */
       97      923    1           DQH$ -> NI$DQH.SQH$ = SQH$;
       98      924    1           DQH$ -> NI$DQH.IOCHAN.IOM = IOM#;
       99      925        /*      DQH$ -> NI$DQH.MPC$ = ADDR(NIL);        */
      100      926        /**/
      101      927        /**/
      102      928        /**/
      103      929    1           CALL ITH$DCT_INIT(PTR$,DEV$) ALTRET(ITM$MAINT_ERR);
      104      930        /**/
      105      931    1           IF (NI_MAINT_DCTX(IOM#) = 0) THEN NI_MAINT_DCTX(IOM#) = N_DCTXMAX;
      106      932        /**/
      107      933    1           CALL BINCHAR(IOM_NUMBER, IOM#);
      108      934    1           CALL CONCAT(DEVNM, 'MC0', IOM_NUMBER, IT_TXT_0000);
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:4    
      109      935    1           DEV$ -> NI$DCT.DEVNM = DEVNM;
      110      936    1           IF HW_IOP  /* MSOS */
      111      937    2           THEN DO;
      112      938    2                DEV$ -> NI$DCT.DVT$ = NI$DVT$(NI_NDVTS-2);
      113      939    2                DQH$ -> NI$DQH.MBX$ = PINCRW (NI$IOM$(IOM#) -> NI$IOM.MBX$,
      114      940    2                  SIZEW(NI$MBX(0)) * 4);
      115      941    2                CHTX = IOM#*%N_MAXCHANS+4;
      116      942    2                DQH$->NI$DQH.IOSTATUS$=NI$FQ$->NI$FQ.HD$; /* Status in LOW REAL */
      117      943    2                NI$FQ$->NI$FQ.HD$=PINCRW(NI$FQ$->NI$FQ.HD$,SIZEW(NI$IOSTAT));
      118      944    2                DQH$ -> NI$DQH.IOCHAN.CHANNEL = 4; /* and talks thru chan #4 */
      119      945    2                NI$CHT$ -> NI$CHT.POSTER(CHTX) = ENTADDR(NIB$POSTER);
      120      946    2              END;
      121      947    2           ELSE DO;   /* MCA */
      122      948    2                DEV$ -> NI$DCT.DVT$ = NI$DVT$(NI_NDVTS-1);
      123      949        /*           DQH$ -> NI$DQH.MBX$ = ADDR(NIL);   */
      124      950    2                CHTX = IOM#*%N_MAXCHANS+3;
      125      951        /*           DQH$->NI$DQH.IOSTATUS$=ADDR(NIL);  */
      126      952    2                DQH$ -> NI$DQH.IOCHAN.CHANNEL = 3; /* talks thru chan #3 */
      127      953    2                NI$CHT$ -> NI$CHT.POSTER(CHTX) = ENTADDR(NIJ$POSTER);
      128      954    2              END;
      129      955    1           NI$CHT$ -> NI$CHT.DQH$(CHTX) = DQH$;
      130      956    1           DEV$ -> NI$DCT.DFLG.PSIA='1'B;
      131      957    1           DEV$ -> NI$DCT.TYPE = DEV$ -> NI$DCT.DVT$ -> NI$DVT.TYPE;
      132      958    1           TEMP=N_DCTXMAX;
      133      959    1           IF HW_IOP THEN
      134      960    1              CALL NIO$SPINTCON(TEMP,ENTADDR(TMA$MSOS_SPEC),0);
      135      961    1           IT_PARTITION.DEVICE(N_DCTXMAX) = IT_PARTITION.IOCHAN(IOM# * %N_MAXCHANS);
      136      962    1           DEV$ -> NI$DCT.SQH$ = SQH$;
      137      963    1           DEV$ -> NI$DCT.DQH$ = DQH$;
      138      964    1           DEV$ -> NI$DCT.DFLG.INPUT = YES;
      139      965    1           DEV$ -> NI$DCT.DFLG.OUTPUT = YES;
      140      966    1           RETURN;
      141      967    1   ITM$MAINT_ERR:
      142      968    1           ALTRETURN;
      143      969    1   END ITM$MAINT;

PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:5    
--  Include file information  --

   NK_SUBS.:E05TOU  is referenced.
   IT_IDATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   IT_ERROR_C.:E05TOU  is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure ITM$MAINT.

   Procedure ITM$MAINT requires 169 words for executable code.
   Procedure ITM$MAINT requires 22 words of local(AUTO) storage.

    No errors detected in file ITM$MAINT.:E05TSI    .

PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:6    

 Object Unit name= ITM$MAINT                                  File name= ITM$MAINT.:E05TOU
 UTS= JUL 29 '97 23:05:23.88 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  ITM$MAINT
    1   Proc  even  none   169    251  ITM$MAINT
    2  RoData even  none     5      5  ITM$MAINT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  ITM$MAINT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 ITH$SQH_INIT
         yes           Std       3 NIJ$POSTER
 yes     yes           Std       2 ITH$ALLOCATE
 yes     yes           Std       2 ITH$DCT_INIT
         yes           Std       3 NIB$POSTER
         yes           Std       3 TMA$MSOS_SPEC
 yes     yes           Std       3 NIO$SPINTCON
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:7    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     HW_IOP                                N$DCT$$                               N$FQ$
     NI$CHT$                               NI$DVT$                               NI$FQ$
     NI$IBUF$                              NI$IOM$                               NI$RP$
     N_DCTXMAX                             NI_MAINT_DCTX                         NI_NDVTS
     NI$DQH_C                              IT_PARTITION                          IT_TXT_0000
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:8    


        1        1        /*M*     Allocate TIGR built tables for MSOS */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*P*     NAME:     ITM$MAINT
        9        9                 PURPOSE:  ITM$MAINT builds and initializes the tables for the
       10       10                           channel 4 (MSOS/DPS90) or channel 3 (MCA/DPS8000) interface.
       11       11                           The devices are known as MCnn (Maintenance Channel followed
       12       12                           by IOM number).                                          */
       13       13        ITM$MAINT: PROC(PTR$,IOM#)  ALTRET;

     13  1 000000   000000 700200 xent  ITM$MAINT    TSX0  ! X66_AUTO_2
         1 000001   000026 000002                    ZERO    22,2

       14       14        /**/
       15       15    1   DCL PTR$ PTR;                           /* POINTER TO TIGR TABLE SPACE        */
       16       16    1   DCL IOM# UBIN;                          /* IOM NUMBER TO USE FOR MSOS STUFF   */
       17       17        /**/
       18       18        /*  INCLUDE FILES  */
       19       19        /**/
       20       20        %INCLUDE HF_DATA_R;
       21       63        %INCLUDE IT_ERROR_C;
       22      146        %INCLUDE NI_DATA_R;
       23      583        %INCLUDE IT_IDATA_R;
       24      700        %INCLUDE NK_SUBS;
       25      725        %SUB YES = '1'B/*YES*/;
       26      726        %SUB NO = '0'B/*NO*/;
       27      727        /**/
       28      728        /*  AUTOMATIC  */
       29      729        /**/
       30      730    1   DCL SQH$ PTR;
       31      731    1   DCL DQH$ PTR;
       32      732    1   DCL CHTX UBIN(36);
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:9    
       33      733    1   DCL TEMP UBIN(15) ALIGNED; /* Used because NIO$SPINTCON wants 15-bit DCTX */
       34      734        %NI$IOSTAT;
       35      743    1   DCL DEV$ PTR;
       36      744    1   DCL 1 DUPCHANERR_TEXT,
       37      745    1         2 COUNT UBIN(9) UNAL,
       38      746    1         2 CHANNEL CHAR(8) UNAL,
       39      747    1         2 IOMTEXT CHAR(1) UNAL,
       40      748    1         2 DASH CHAR(1) UNAL,
       41      749    1         2 CHANTEXT CHAR(2) UNAL;
       42      750    1   DCL DEVNM CHAR(8);
       43      751    1   DCL IOM_NUMBER CHAR(1);
       44      752        /**/
       45      753        /*  BASED  */
       46      754        /**/
       47      755        %NI$DVT;
       48      762        %NI$SQH;
       49      775        %NI$DQH;
       50      798        %NI$CHT;
       51      801        %NI$DCT;
       52      849        %NI$IOM;
       53      854        %NI$MBX;
       54      873        %NI$PARTITION(NAME=IT_PARTITION, STCLASS=SYMREF);
       55      881        /**/
       56      882        /*  ENTRY DCLS  */
       57      883        /**/
       58      884    1   DCL ITE$ERROR ENTRY(2);
       59      885    1   DCL NIB$POSTER ENTRY(3);
       60      886    1   DCL NIJ$POSTER ENTRY(3);
       61      887    1   DCL ITH$ALLOCATE ENTRY(2) ALTRET;
       62      888    1   DCL ITH$SQH_INIT ENTRY(2) ALTRET;
       63      889    1   DCL ITH$DCT_INIT ENTRY(2) ALTRET;
       64      890    1   DCL NIO$SPINTCON ENTRY(3) ALTRET;
       65      891    1   DCL TMA$MSOS_SPEC ENTRY(3);
       66      892        /**/
       67      893        /*  SYMREFS  */
       68      894        /**/
       69      895    1   DCL IT_TXT_0000 CHAR(4) SYMREF;
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:10   
       70      896        /**/
       71      897        %EJECT;
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:11   
       72      898        /*D*     NAME:     ITM$MAINT
       73      899         PURPOSE: To build the necessary tables for the channel 4 (MSOS) or channel 3 (MCA)
       74      900        *
       75      901                 INPUT:    PTR$ - parameter - pointer to next available location
       76      902                           in the TIGR table area
       77      903                           IOM# - IOM#/IMU# to build MSOS/MCA info in I/O tables.
       78      904                 OUTPUT:   The initialized tables
       79      905        *
       80      906                 DESCRIPTION:  ITM$MAINT aquires space for and initializes the
       81      907                           NI$SQH,NI$DQH and NI$DCT entries for this channel. In
       82      908                           addition the cell NI_MAINT_DCTX(IOM#) is initialized to the DCT
       83      909                           index of this channel.
       84      910                               The channel entry in the NI$CHT table is
       85      911                           initialized to point to the DQH.        */
       86      912        /**/
       87      913    1           CALL ITH$SQH_INIT(PTR$,SQH$) ALTRET(ITM$MAINT_ERR);

    913  1 000002   200005 630500                    EPPR0   SQH$,,AUTO
         1 000003   200023 450500                    STP0    IOM_NUMBER+3,,AUTO
         1 000004   200003 236100                    LDQ     @PTR$,,AUTO
         1 000005   200022 756100                    STQ     IOM_NUMBER+2,,AUTO
         1 000006   200022 630500                    EPPR0   IOM_NUMBER+2,,AUTO
         1 000007   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000010   000000 701000 xent               TSX1    ITH$SQH_INIT
         1 000011   000250 702000 1                  TSX2    ITM$MAINT_ERR

       88      914    1           SQH$ -> NI$SQH.NDCT = 1;

    914  1 000012   000001 220003                    LDX0    1,DU
         1 000013   200005 470500                    LDP0    SQH$,,AUTO
         1 000014   000002 440100                    SXL0    2,,PR0

       89      915        /**/
       90      916    1           DQH$ = PTR$;

    916  1 000015   200003 470500                    LDP0    @PTR$,,AUTO
         1 000016   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:12   
         1 000017   200006 756100                    STQ     DQH$,,AUTO

       91      917    1           CALL ITH$ALLOCATE(PTR$,SIZEW(NI$DQH)) ALTRET(ITM$MAINT_ERR);

    917  1 000020   000001 236000 2                  LDQ     1
         1 000021   200003 235100                    LDA     @PTR$,,AUTO
         1 000022   200022 757100                    STAQ    IOM_NUMBER+2,,AUTO
         1 000023   200022 630500                    EPPR0   IOM_NUMBER+2,,AUTO
         1 000024   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000025   000000 701000 xent               TSX1    ITH$ALLOCATE
         1 000026   000250 702000 1                  TSX2    ITM$MAINT_ERR

       92      918        /**/
       93      919    1           DQH$ -> NI$DQH = NI$DQH_C;     /*  set to constant inited structure   */

    919  1 000027   200006 470500                    LDP0    DQH$,,AUTO
         1 000030   000100 100400                    MLR     fill='000'O
         1 000031   000000 000110 xsym               ADSC9   NI$DQH_C                 cn=0,n=72
         1 000032   000000 000110                    ADSC9   0,,PR0                   cn=0,n=72

       94      920        /**/
       95      921    1           DQH$ -> NI$DQH.FL$ = DQH$;

    921  1 000033   200006 236100                    LDQ     DQH$,,AUTO
         1 000034   000000 756100                    STQ     0,,PR0

       96      922        /*      DQH$ -> NI$DQH.IO$ = ADDR(NIL);         */
       97      923    1           DQH$ -> NI$DQH.SQH$ = SQH$;

    923  1 000035   200005 236100                    LDQ     SQH$,,AUTO
         1 000036   000013 756100                    STQ     11,,PR0

       98      924    1           DQH$ -> NI$DQH.IOCHAN.IOM = IOM#;

    924  1 000037   200004 471500                    LDP1    @IOM#,,AUTO
         1 000040   100000 236100                    LDQ     0,,PR1
         1 000041   000031 736000                    QLS     25
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:13   
         1 000042   000001 676100                    ERQ     1,,PR0
         1 000043   000600 376003                    ANQ     384,DU
         1 000044   000001 656100                    ERSQ    1,,PR0

       99      925        /*      DQH$ -> NI$DQH.MPC$ = ADDR(NIL);        */
      100      926        /**/
      101      927        /**/
      102      928        /**/
      103      929    1           CALL ITH$DCT_INIT(PTR$,DEV$) ALTRET(ITM$MAINT_ERR);

    929  1 000045   200011 633500                    EPPR3   DEV$,,AUTO
         1 000046   200023 453500                    STP3    IOM_NUMBER+3,,AUTO
         1 000047   200003 236100                    LDQ     @PTR$,,AUTO
         1 000050   200022 756100                    STQ     IOM_NUMBER+2,,AUTO
         1 000051   200022 630500                    EPPR0   IOM_NUMBER+2,,AUTO
         1 000052   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000053   000000 701000 xent               TSX1    ITH$DCT_INIT
         1 000054   000250 702000 1                  TSX2    ITM$MAINT_ERR

      104      930        /**/
      105      931    1           IF (NI_MAINT_DCTX(IOM#) = 0) THEN NI_MAINT_DCTX(IOM#) = N_DCTXMAX;

    931  1 000055   200004 470500                    LDP0    @IOM#,,AUTO
         1 000056   000000 720100                    LXL0    0,,PR0
         1 000057   000000 235010 xsym               LDA     NI_MAINT_DCTX,X0
         1 000060   000063 601000 1                  TNZ     s:933

    931  1 000061   000000 236000 xsym               LDQ     N_DCTXMAX
         1 000062   000000 756010 xsym               STQ     NI_MAINT_DCTX,X0

      106      932        /**/
      107      933    1           CALL BINCHAR(IOM_NUMBER, IOM#);

    933  1 000063   000000 235100                    LDA     0,,PR0
         1 000064   000044 773000                    LRL     36
         1 000065   200022 757100                    STAQ    IOM_NUMBER+2,,AUTO
         1 000066   000100 301500                    BTD
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:14   
         1 000067   200022 000010                    NDSC9   IOM_NUMBER+2,,AUTO       cn=0,s=lsgnf,sf=0,n=8
         1 000070   200020 030001                    NDSC9   IOM_NUMBER,,AUTO         cn=0,s=nosgn,sf=0,n=1

      108      934    1           CALL CONCAT(DEVNM, 'MC0', IOM_NUMBER, IT_TXT_0000);

    934  1 000071   000000 236000 0                  LDQ     0
         1 000072   000002 376000 2                  ANQ     2
         1 000073   000040 276007                    ORQ     32,DL
         1 000074   200016 756100                    STQ     DEVNM,,AUTO
         1 000075   200020 236100                    LDQ     IOM_NUMBER,,AUTO
         1 000076   000033 772000                    QRL     27
         1 000077   200016 552104                    STBQ    DEVNM,'04'O,AUTO
         1 000100   000000 236000 xsym               LDQ     IT_TXT_0000
         1 000101   200017 756100                    STQ     DEVNM+1,,AUTO

      109      935    1           DEV$ -> NI$DCT.DEVNM = DEVNM;

    935  1 000102   200011 470500                    LDP0    DEV$,,AUTO
         1 000103   200016 237100                    LDAQ    DEVNM,,AUTO
         1 000104   000002 755100                    STA     2,,PR0
         1 000105   000003 756100                    STQ     3,,PR0

      110      936    1           IF HW_IOP  /* MSOS */

    936  1 000106   000000 234000 xsym               SZN     HW_IOP
         1 000107   000146 605000 1                  TPL     s:948

      111      937    2           THEN DO;

      112      938    2                DEV$ -> NI$DCT.DVT$ = NI$DVT$(NI_NDVTS-2);

    938  1 000110   000000 720000 xsym               LXL0    NI_NDVTS
         1 000111   777776 236010 xsym               LDQ     NI$DVT$-2,X0
         1 000112   200011 470500                    LDP0    DEV$,,AUTO
         1 000113   000024 756100                    STQ     20,,PR0

      113      939    2                DQH$ -> NI$DQH.MBX$ = PINCRW (NI$IOM$(IOM#) -> NI$IOM.MBX$,
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:15   

    939  1 000114   200004 471500                    LDP1    @IOM#,,AUTO
         1 000115   100000 721100                    LXL1    0,,PR1
         1 000116   000000 473411 xsym               LDP3    NI$IOM$,X1
         1 000117   300002 236100                    LDQ     2,,PR3
         1 000120   000020 036003                    ADLQ    16,DU
         1 000121   200006 474500                    LDP4    DQH$,,AUTO
         1 000122   400021 756100                    STQ     17,,PR4

      114      940    2                  SIZEW(NI$MBX(0)) * 4);
      115      941    2                CHTX = IOM#*%N_MAXCHANS+4;

    941  1 000123   100000 235100                    LDA     0,,PR1
         1 000124   000007 735000                    ALS     7
         1 000125   000004 035007                    ADLA    4,DL
         1 000126   200007 755100                    STA     CHTX,,AUTO

      116      942    2                DQH$->NI$DQH.IOSTATUS$=NI$FQ$->NI$FQ.HD$; /* Status in LOW REAL */

    942  1 000127   000000 473400 xsym               LDP3    NI$FQ$
         1 000130   300002 236100                    LDQ     2,,PR3
         1 000131   400016 756100                    STQ     14,,PR4

      117      943    2                NI$FQ$->NI$FQ.HD$=PINCRW(NI$FQ$->NI$FQ.HD$,SIZEW(NI$IOSTAT));

    943  1 000132   300002 236100                    LDQ     2,,PR3
         1 000133   000020 036003                    ADLQ    16,DU
         1 000134   300002 756100                    STQ     2,,PR3

      118      944    2                DQH$ -> NI$DQH.IOCHAN.CHANNEL = 4; /* and talks thru chan #4 */

    944  1 000135   400001 236100                    LDQ     1,,PR4
         1 000136   000003 376000 2                  ANQ     3
         1 000137   000004 276003                    ORQ     4,DU
         1 000140   400001 756100                    STQ     1,,PR4

      119      945    2                NI$CHT$ -> NI$CHT.POSTER(CHTX) = ENTADDR(NIB$POSTER);
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:16   

    945  1 000141   000001 735000                    ALS     1
         1 000142   000000 636000 xent               EAQ     NIB$POSTER
         1 000143   000000 470400 xsym               LDP0    NI$CHT$
         1 000144   000001 756105                    STQ     1,AL,PR0

      120      946    2              END;

    946  1 000145   000170 710000 1                  TRA     s:955

      121      947    2           ELSE DO;   /* MCA */

      122      948    2                DEV$ -> NI$DCT.DVT$ = NI$DVT$(NI_NDVTS-1);

    948  1 000146   000000 720000 xsym               LXL0    NI_NDVTS
         1 000147   777777 236010 xsym               LDQ     NI$DVT$-1,X0
         1 000150   200011 470500                    LDP0    DEV$,,AUTO
         1 000151   000024 756100                    STQ     20,,PR0

      123      949        /*           DQH$ -> NI$DQH.MBX$ = ADDR(NIL);   */
      124      950    2                CHTX = IOM#*%N_MAXCHANS+3;

    950  1 000152   200004 471500                    LDP1    @IOM#,,AUTO
         1 000153   100000 235100                    LDA     0,,PR1
         1 000154   000007 735000                    ALS     7
         1 000155   000003 035007                    ADLA    3,DL
         1 000156   200007 755100                    STA     CHTX,,AUTO

      125      951        /*           DQH$->NI$DQH.IOSTATUS$=ADDR(NIL);  */
      126      952    2                DQH$ -> NI$DQH.IOCHAN.CHANNEL = 3; /* talks thru chan #3 */

    952  1 000157   200006 473500                    LDP3    DQH$,,AUTO
         1 000160   300001 236100                    LDQ     1,,PR3
         1 000161   000003 376000 2                  ANQ     3
         1 000162   000003 276003                    ORQ     3,DU
         1 000163   300001 756100                    STQ     1,,PR3

PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:17   
      127      953    2                NI$CHT$ -> NI$CHT.POSTER(CHTX) = ENTADDR(NIJ$POSTER);

    953  1 000164   000001 735000                    ALS     1
         1 000165   000000 636000 xent               EAQ     NIJ$POSTER
         1 000166   000000 470400 xsym               LDP0    NI$CHT$
         1 000167   000001 756105                    STQ     1,AL,PR0

      128      954    2              END;

      129      955    1           NI$CHT$ -> NI$CHT.DQH$(CHTX) = DQH$;

    955  1 000170   200006 236100                    LDQ     DQH$,,AUTO
         1 000171   000000 470400 xsym               LDP0    NI$CHT$
         1 000172   000000 756105                    STQ     0,AL,PR0

      130      956    1           DEV$ -> NI$DCT.DFLG.PSIA='1'B;

    956  1 000173   200011 470500                    LDP0    DEV$,,AUTO
         1 000174   010000 236007                    LDQ     4096,DL
         1 000175   000006 256100                    ORSQ    6,,PR0

      131      957    1           DEV$ -> NI$DCT.TYPE = DEV$ -> NI$DCT.DVT$ -> NI$DVT.TYPE;

    957  1 000176   200011 470500                    LDP0    DEV$,,AUTO
         1 000177   000024 473500                    LDP3    20,,PR0
         1 000200   300053 236100                    LDQ     43,,PR3
         1 000201   000025 772000                    QRL     21
         1 000202   000007 752102                    STCQ    7,'02'O,PR0

      132      958    1           TEMP=N_DCTXMAX;

    958  1 000203   000000 236000 xsym               LDQ     N_DCTXMAX
         1 000204   000025 736000                    QLS     21
         1 000205   200010 756100                    STQ     TEMP,,AUTO

      133      959    1           IF HW_IOP THEN

PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:18   
    959  1 000206   000000 234000 xsym               SZN     HW_IOP
         1 000207   000224 605000 1                  TPL     s:961

      134      960    1              CALL NIO$SPINTCON(TEMP,ENTADDR(TMA$MSOS_SPEC),0);

    960  1 000210   000000 636000 xent               EAQ     TMA$MSOS_SPEC
         1 000211   200022 756100                    STQ     IOM_NUMBER+2,,AUTO
         1 000212   000004 236000 2                  LDQ     4
         1 000213   200025 756100                    STQ     IOM_NUMBER+5,,AUTO
         1 000214   200022 630500                    EPPR0   IOM_NUMBER+2,,AUTO
         1 000215   200024 450500                    STP0    IOM_NUMBER+4,,AUTO
         1 000216   200010 633500                    EPPR3   TEMP,,AUTO
         1 000217   200023 453500                    STP3    IOM_NUMBER+3,,AUTO
         1 000220   200023 630500                    EPPR0   IOM_NUMBER+3,,AUTO
         1 000221   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000222   000000 701000 xent               TSX1    NIO$SPINTCON
         1 000223   000000 011000                    NOP     0

      135      961    1           IT_PARTITION.DEVICE(N_DCTXMAX) = IT_PARTITION.IOCHAN(IOM# * %N_MAXCHANS);

    961  1 000224   200004 470500                    LDP0    @IOM#,,AUTO
         1 000225   000000 235100                    LDA     0,,PR0
         1 000226   000007 735000                    ALS     7
         1 000227   000000 236000 xsym               LDQ     N_DCTXMAX
         1 000230   000232 605000 1                  TPL     s:961+6
         1 000231   000044 036003                    ADLQ    36,DU
         1 000232   003006 060405                    CSL     bolr='003'O
         1 000233   000012 000001 xsym               BDSC    IT_PARTITION+10,A        by=0,bit=0,n=1
         1 000234   000000 000001 xsym               BDSC    IT_PARTITION,Q           by=0,bit=0,n=1

      136      962    1           DEV$ -> NI$DCT.SQH$ = SQH$;

    962  1 000235   200005 236100                    LDQ     SQH$,,AUTO
         1 000236   200011 471500                    LDP1    DEV$,,AUTO
         1 000237   100022 756100                    STQ     18,,PR1

      137      963    1           DEV$ -> NI$DCT.DQH$ = DQH$;
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:19   

    963  1 000240   200006 236100                    LDQ     DQH$,,AUTO
         1 000241   100023 756100                    STQ     19,,PR1

      138      964    1           DEV$ -> NI$DCT.DFLG.INPUT = YES;

    964  1 000242   400000 236007                    LDQ     -131072,DL
         1 000243   100006 256100                    ORSQ    6,,PR1

      139      965    1           DEV$ -> NI$DCT.DFLG.OUTPUT = YES;

    965  1 000244   200011 471500                    LDP1    DEV$,,AUTO
         1 000245   200000 236007                    LDQ     65536,DL
         1 000246   100006 256100                    ORSQ    6,,PR1

      140      966    1           RETURN;

    966  1 000247   000000 702200 xent               TSX2  ! X66_ARET

      141      967    1   ITM$MAINT_ERR:
      142      968    1           ALTRETURN;

    968  1 000250   000000 702200 xent  ITM$MAINT_E* TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   0     000   115103 060040                                                    MC0

(unnamed)
 Sect OctLoc
   2     000   000000 000022   000000 006000   777777 777000   777600 777777    ................
   2     004   000002 006000                                                    ....
      143      969    1   END ITM$MAINT;

PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:20   
--  Include file information  --

   NK_SUBS.:E05TOU  is referenced.
   IT_IDATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   IT_ERROR_C.:E05TOU  is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure ITM$MAINT.
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:21   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @IOM#                      3-0-0/w PTR         r     1 @PTR$
     7-0-0/w UBIN        r     1 CHTX                      11-0-0/w PTR         r     1 DEV$
    16-0-0/c CHAR(8)     r     1 DEVNM                      6-0-0/w PTR         r     1 DQH$
    *0-0-0/w UBIN        r     1 IOM#                      20-0-0/c CHAR        r     1 IOM_NUMBER
    *0-0-0/w PTR         r     1 PTR$                       5-0-0/w PTR         r     1 SQH$
    10-0-0/w UBIN(15)    r     1 TEMP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w BIT         r     1 HW_IOP                     0-0-0/w STRC(1800)  r     1 IT_PARTITION
     0-0-0/c CHAR(4)     r     1 IT_TXT_0000                0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 N$FQ$                      0-0-0/w PTR         r     1 NI$CHT$
     0-0-0/w STRC(648)   r     1 NI$DQH_C                   0-0-0/w PTR         r     1 NI$DVT$(0:49)
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$IOM$(0:3)
     0-0-0/w PTR         r     1 NI$RP$
     0-0-0/w UBIN        r     1 NI_MAINT_DCTX(0:3)
     0-0-0/w UBIN        r     1 NI_NDVTS                   0-0-0/w SBIN        r     1 N_DCTXMAX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 NI$CHT(0:127)              0-0-0/w STRC(1332)  r     1 NI$DCT
     0-0-0/w STRC(648)   r     1 NI$DQH                     0-0-0/w STRC(2844)  r     1 NI$DVT
     0-0-0/w STRC(144)   r     1 NI$FQ                      0-0-0/w STRC(252)   r     1 NI$IOM
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:22   
     0-0-0/d STRC(576)   r     1 NI$IOSTAT                  0-0-0/d STRC(144)   r     1 NI$MBX(0:63)
     0-0-0/w STRC(252)   r     1 NI$SQH


   Procedure ITM$MAINT requires 169 words for executable code.
   Procedure ITM$MAINT requires 22 words of local(AUTO) storage.

    No errors detected in file ITM$MAINT.:E05TSI    .
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:23   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:24   
          MINI XREF LISTING

CHTX
       732**DCL       941<<ASSIGN    945>>ASSIGN    950<<ASSIGN    953>>ASSIGN    955>>ASSIGN
DEV$
       743**DCL       929<>CALL      935>>ASSIGN    938>>ASSIGN    948>>ASSIGN    956>>ASSIGN    957>>ASSIGN
       957>>ASSIGN    962>>ASSIGN    963>>ASSIGN    964>>ASSIGN    965>>ASSIGN
DEVNM
       750**DCL       934<<CALLBLT   935>>ASSIGN
DQH$
       731**DCL       916<<ASSIGN    919>>ASSIGN    921>>ASSIGN    921>>ASSIGN    923>>ASSIGN    924>>ASSIGN
       939>>ASSIGN    942>>ASSIGN    944>>ASSIGN    952>>ASSIGN    955>>ASSIGN    963>>ASSIGN
HW_IOP
        59**DCL       936>>IF        959>>IF
IOM#
        16**DCL        13--PROC      924>>ASSIGN    931>>IF        931>>ASSIGN    933>>CALLBLT   939>>ASSIGN
       941>>ASSIGN    950>>ASSIGN    961>>ASSIGN
IOM_NUMBER
       751**DCL       933<<CALLBLT   934>>CALLBLT
ITH$ALLOCATE
       887**DCL-ENT   917--CALL
ITH$DCT_INIT
       889**DCL-ENT   929--CALL
ITH$SQH_INIT
       888**DCL-ENT   913--CALL
ITM$MAINT_ERR
       968**LABEL     913--CALLALT   917--CALLALT   929--CALLALT
IT_PARTITION.DEVICE
       879**DCL       961<<ASSIGN
IT_PARTITION.IOCHAN
       879**DCL       961>>ASSIGN
IT_TXT_0000
       895**DCL       934>>CALLBLT
N$DCT$$
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:25   
       444**DCL       578--IMP-PTR
N$FQ$
       444**DCL       579--IMP-PTR
N$REQ_INIT.BUFADDR
       463**DCL       464--REDEF     464--REDEF
N$REQ_INIT.DLA.DRELADDR
       455**DCL       455--REDEF
N$REQ_INIT.DVE.EOMCHAR
       492**DCL       493--REDEF
N$REQ_INIT.EAINFO
       486**DCL       486--REDEF
N$REQ_INIT.EAINFOX
       486**DCL       487--REDEF
N$REQ_INIT.EVNTINFO
       487**DCL       487--REDEF
N$REQ_INIT.STATUS
       468**DCL       474--REDEF
NI$CHT.DQH$
       799**DCL       955<<ASSIGN
NI$CHT.POSTER
       799**DCL       945<<ASSIGN    953<<ASSIGN
NI$CHT$
       503**DCL       799--IMP-PTR   945>>ASSIGN    953>>ASSIGN    955>>ASSIGN
NI$DCT.DEVNM
       810**DCL       935<<ASSIGN
NI$DCT.DFLG.INPUT
       812**DCL       964<<ASSIGN
NI$DCT.DFLG.OUTPUT
       813**DCL       965<<ASSIGN
NI$DCT.DFLG.PSIA
       814**DCL       956<<ASSIGN
NI$DCT.DP
       830**DCL       837--REDEF     840--REDEF     841--REDEF     843--REDEF     843--REDEF     844--REDEF
       845--REDEF     845--REDEF
NI$DCT.DQH$
       826**DCL       963<<ASSIGN
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:26   
NI$DCT.DVT$
       826**DCL       938<<ASSIGN    948<<ASSIGN    957>>ASSIGN
NI$DCT.MPC.IOCHANX
       838**DCL       838--REDEF
NI$DCT.SQH$
       825**DCL       962<<ASSIGN
NI$DCT.TYPE
       820**DCL       957<<ASSIGN
NI$DCT_C.DP
       630**DCL       637--REDEF     640--REDEF     641--REDEF     643--REDEF     643--REDEF     644--REDEF
       645--REDEF     645--REDEF
NI$DCT_C.MPC.IOCHANX
       638**DCL       638--REDEF
NI$DQH
       784**DCL       917--CALL      919<<ASSIGN
NI$DQH.FL$
       784**DCL       921<<ASSIGN
NI$DQH.IOCHAN.CHANNEL
       787**DCL       944<<ASSIGN    952<<ASSIGN
NI$DQH.IOCHAN.IOM
       787**DCL       924<<ASSIGN
NI$DQH.IOCHANX
       786**DCL       787--REDEF
NI$DQH.IOSTATUS$
       791**DCL       942<<ASSIGN
NI$DQH.MBX$
       795**DCL       796--REDEF     939<<ASSIGN
NI$DQH.SQH$
       790**DCL       923<<ASSIGN
NI$DQH_C
       658**DCL       919>>ASSIGN
NI$DQH_C.IOCHANX
       660**DCL       661--REDEF
NI$DQH_C.MBX$
       669**DCL       670--REDEF
NI$DVT.MPC
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:27   
       758**DCL       759--REDEF
NI$DVT.TYPE
       756**DCL       957>>ASSIGN
NI$DVT$
       503**DCL       938>>ASSIGN    948>>ASSIGN
NI$FQ.HD$
       580**DCL       942>>ASSIGN    943<<ASSIGN    943>>ASSIGN
NI$FQ$
       504**DCL       580--IMP-PTR   942>>ASSIGN    943>>ASSIGN    943>>ASSIGN
NI$IBUF$
       504**DCL       580--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       514**DCL       515--REDEF     515--REDEF
NI$IMXMBX_INIT.SIZE
       516**DCL       516--REDEF
NI$IOM.MBX$
       850**DCL       939>>ASSIGN
NI$IOM$
       526**DCL       939>>ASSIGN
NI$IOSTAT
       735**DCL       943--ASSIGN
NI$IOSTAT.AESDCW
       740**DCL       740--REDEF
NI$IOSTAT_C.AESDCW
       696**DCL       696--REDEF
NI$MBX
       865**DCL       939--ASSIGN
NI$MBX.DCW.CONTROL.AE
       870**DCL       870--REDEF
NI$MBX.LPW.CONTROL.AE
       866**DCL       866--REDEF
NI$REQ_INIT.DCW
       538**DCL       541--REDEF
NI$REQ_INIT.DCW.TALLY
       539**DCL       539--REDEF
NI$REQ_INIT.IDCW.EXTA
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:28   
       541**DCL       541--REDEF
NI$REQ_INIT.PCW
       543**DCL       547--REDEF
NI$REQ_INIT.SEEK
       548**DCL       549--REDEF     550--REDEF
NI$RP$
       552**DCL       582--IMP-PTR
NI$SQH.DOOR
       771**DCL       771--REDEF
NI$SQH.NDCT
       772**DCL       914<<ASSIGN
NI$SQH_C.DOOR
       681**DCL       681--REDEF
NIB$POSTER
       885**DCL-ENT   945--ASSIGN
NIJ$POSTER
       886**DCL-ENT   953--ASSIGN
NIO$SPINTCON
       890**DCL-ENT   960--CALL
NI_MAINT_DCTX
       556**DCL       931>>IF        931<<ASSIGN
NI_MBX_INIT.DCW.CONTROL.AE
       574**DCL       574--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       570**DCL       570--REDEF
NI_NDVTS
       577**DCL       938>>ASSIGN    948>>ASSIGN
N_DCTXMAX
       552**DCL       931>>ASSIGN    958>>ASSIGN    961>>ASSIGN
PTR$
        15**DCL        13--PROC      913<>CALL      916>>ASSIGN    917<>CALL      929<>CALL
SQH$
       730**DCL       913<>CALL      914>>ASSIGN    923>>ASSIGN    962>>ASSIGN
TEMP
       733**DCL       958<<ASSIGN    960<>CALL
TMA$MSOS_SPEC
PL6.E3A0      #001=ITM$MAINT File=ITM$MAINT.:E05TSI                              TUE 07/29/97 23:05 Page:29   
       891**DCL-ENT   960--CALL
