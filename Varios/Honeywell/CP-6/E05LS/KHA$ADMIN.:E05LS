VERSION E05

PL6.E3A0      #001=KHA$ASYNC File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:24 Page:1    
        1        1        /*M* KHA$ADMIN - Handler/Node Admin interface routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*F* NAME: KHA$ASYNC
        8        8
        9        9        KHA$ASYNC is the entry point to the event handler that is
       10       10        specified on the M$EVENT call in KHA$INIT.  This routine
       11       11        simply calls KHA$ADMIN.
       12       12        */
       13       13        KHA$ASYNC: PROC ASYNC;
       14       14
       15       15    1   DCL KHA$ADMIN ENTRY;
       16       16
       17       17    1        CALL KHA$ADMIN;
       18       18    1        RETURN;
       19       19
       20       20    1   END KHA$ASYNC;
       21       21        %EOD;

PL6.E3A0      #001=KHA$ASYNC File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:24 Page:2    
      No diagnostics issued in procedure KHA$ASYNC.

   Procedure KHA$ASYNC requires 14 words for executable code.
   Procedure KHA$ASYNC requires 4 words of local(AUTO) storage.

PL6.E3A0      #001=KHA$ASYNC File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:24 Page:3    

 Object Unit name= KHA$ASYNC                                  File name= KHA$ADMIN.:E05TOU
 UTS= JUL 30 '97 00:24:59.60 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    14      E  KHA$ASYNC

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes     Async       0  KHA$ASYNC

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 KHA$ADMIN
                       nStd      0 X6A_AAUTO
                       nStd      0 X6A_AARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    G$ROS$
PL6.E3A0      #001=KHA$ASYNC File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:24 Page:4    


        1        1        /*M* KHA$ADMIN - Handler/Node Admin interface routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*F* NAME: KHA$ASYNC
        8        8
        9        9        KHA$ASYNC is the entry point to the event handler that is
       10       10        specified on the M$EVENT call in KHA$INIT.  This routine
       11       11        simply calls KHA$ADMIN.
       12       12        */
       13       13        KHA$ASYNC: PROC ASYNC;

     13   0 000000  D380 0000 0000  xent KHA$ASYNC       LNJ,B5   X6A_AAUTO
          0 000003       0004 0000                       DC       4,0

       14       14
       15       15    1   DCL KHA$ADMIN ENTRY;
       16       16
       17       17    1        CALL KHA$ADMIN;

     17   0 000005  CBF0 0000                            LAB,B4   0,IMO
          0 000007  E380 0000 0000  xent                 LNJ,B6   KHA$ADMIN
          0 00000A       0001                            DC       s:18,PREL

       18       18    1        RETURN;

     18   0 00000B  C380 0000 0000  xent                 LNJ,B4   X6A_AARET
       19       19
       20       20    1   END KHA$ASYNC;
       21       21        %EOD;

PL6.E3A0      #001=KHA$ASYNC File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:24 Page:5    
      No diagnostics issued in procedure KHA$ASYNC.
PL6.E3A0      #001=KHA$ASYNC File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:24 Page:6    

 **** Variables and constants ****


   Procedure KHA$ASYNC requires 14 words for executable code.
   Procedure KHA$ASYNC requires 4 words of local(AUTO) storage.
PL6.E3A0      #001=KHA$ASYNC File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:24 Page:7    
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KHA$ASYNC File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:24 Page:8    
          MINI XREF LISTING

KHA$ADMIN
        15**DCL-ENT    17--CALL

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:9    
       22        1        /*T***********************************************************/
       23        2        /*T*                                                         */
       24        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       25        4        /*T*                                                         */
       26        5        /*T***********************************************************/
       27        6        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
       28        7        /*F* NAME: KHA$ADMIN - Event Handler for Events from Node Admin
       29        8
       30        9        KHA$ADMIN is the entry point for no-wait read complete on
       31       10        M$NA.
       32       11        The message received from the Node Administrator will indicate the
       33       12        function to be performed: enable/disable channel, return statistics,
       34       13        change control values, etc.
       35       14
       36       15        KHA$ADMIN will perform the indicated function.
       37       16        Some functions require that the handler administrative routine be
       38       17        called.  The handler administrative routine must have been established
       39       18        earlier on the call to KHA$INIT.  Parameters will be passed to
       40       19        the handler in a structure which is defined by the KH$ADMIN_FPT
       41       20        macro.  Please see the description of KH$ADMIN_FPT below for details.
       42       21
       43       22
       44       23        Before exiting, KHA$ADMIN will re-issue the no-wait read to M$NA.
       45       24
       46       25        */
       47       26        KHA$ADMIN: PROC;
       48       27        /**/
       49       28        %INCLUDE B_ERRORS_C;
       50     1155        %INCLUDE LCP_6;
       51     5434        %INCLUDE KL_AFCN_C;
       52     5535        %INCLUDE KH$CHN;
       53     5657        %INCLUDE KHC_MAC_C;
       54     5698        %INCLUDE KH_CHN;
       55     5738        %INCLUDE KL_CONTROL_C;
       56     6118        %INCLUDE KL_MACRO_C;
       57     9470        %INCLUDE KH_MACRO_C;
       58    10213        %INCLUDE KHA_FNC_E;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:10   
       59    10313        %INCLUDE K_ID_E;
       60    10363        /**/
       61    10364        %K#LYRID_E;
       62    10371        %K#ENTID_E;
       63    10390        %INHIBIT_DCLS;
       64    10402        /**/
       65    10403    1   DCL KHA$DVCADM_RNG ENTRY(6) ALTRET;
       66    10404    1   DCL KHA$DVCADM ENTRY(6) ALTRET;
       67    10405    1   DCL KHA$RDCLK ENTRY ALTRET;
       68    10406    1   DCL KHA$SETCLK ENTRY(1) ALTRET;
       69    10407    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
       70    10408        /**/
       71    10409        /* System structures */
       72    10410        %G$TCB;
       73    10431        %G$NWIO;
       74    10841        %G$EXCFR;
       75    11223
       76    11224    1   DCL G$TCB$ PTR SYMREF READONLY;
       77    11225    1   DCL KH_CTLTBL$ PTR SYMREF;
       78    11226    1   DCL KH_NA_DCB# UBIN SYMREF;
       79    11227    1   DCL KH_NA_EVENT# UBIN SYMREF;
       80    11228    1   DCL KH_ADMIN$ EPTR SYMREF;
       81    11229    1   DCL KH_INHLVL UBIN SYMREF;
       82    11230    1   DCL KV_SSNMAX UBIN SYMREF;
       83    11231    1   DCL KV_TYPAHDBFRLMT UBIN SYMREF;
       84    11232    1   DCL KV_MAXUFTSIZ UBIN SYMREF;
       85    11233    1   DCL KH_FLDWRTS SBIN SYMREF;             /* current number of failed writes */
       86    11234    1   DCL KH_ERRSND UBIN SYMREF;
       87    11235    1   DCL KH_WLCLKENT$ EPTR SYMREF;
       88    11236        /**/
       89    11237
       90    11238    1   DCL DEEP UBIN STATIC INIT(0);
       91    11239    1   DCL NEED2READ UBIN STATIC INIT(0);
       92    11240    1   DCL SIZE UBIN;
       93    11241    1   DCL PROTXT CHAR(SIZE) BASED;
       94    11242    1   DCL CHAN$ PTR;
       95    11243        %KH_CHNDAT (STCLASS=SYMREF);
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:11   
       96    11261    1   DCL KH_BUF$ PTR STATIC SYMDEF INIT(ADDR(NIL));
       97    11262    1   DCL WORDARRAY(0:0) UBIN WORD BASED;
       98    11263        %KL_MES (FPTN=KL$MES,STCLASS="BASED(KH_BUF$)");
       99    11286        %KL_CONTROL (FPTN=KL$CONTROL,STCLASS="BASED(KH_BUF$)");
      100    11423        %KL_ADMIN (FPTN=KL$ADMIN,STCLASS="BASED(KH_BUF$)");
      101    11584        %KL_CNFG_MSG (FPTN=KL$CNFG,STCLASS="BASED(KH_BUF$)");
      102    11868        %KL_DVCERRRSP (FPTN=KL$DVCERRRSP,STCLASS="BASED(KH_BUF$)");
      103    11921        %KH$CHN (NAME=CHN,STCLASS="BASED(CHAN$)");
      104    12045        %KL_HDR (FPTN=KL$HDR,STCLASS="BASED(KH_BUF$)");
      105    12126        %VLP_ERRCODE (FPTN=INIT_ONLY,FCG=KH,MID=A,MON='1'B,ERR#=%E$PARM_INITONLY,STCLASS=
             12126            CONSTANT);
      106    12172        /*E* ERROR: KHA-E$PARM_INITONLY
      107    12173             MESSAGE: That parameter is only setable at initialization.
      108    12174         */
      109    12175        %VLP_ERRCODE (FPTN=UNDEF,FCG=KH,MID=A,MON='1'B,ERR#=%E$PARM_UNDEF,STCLASS=CONSTANT);
      110    12221        /*E* ERROR: KHA-E$PARM_UNDEF
      111    12222             MESSAGE: That parameter is undefined for this handler.
      112    12223         */
      113    12224        %B$TERMINAL_ID (FPTN=TERMLO,STCLASS=AUTO,ALGN=WALIGNED);
      114    12253        %B$TERMINAL_ID (FPTN=TERMHI,STCLASS=AUTO,ALGN=WALIGNED);
      115    12282        %KL_CHNRSP (FPTN=KL$CHNRSP,STCLASS="BASED(KH_BUF$)");
      116    12502        %KL_PRFRSP (FPTN=KL$PRFRSP,STCLASS="BASED(KH_BUF$)");
      117    12552        %KH$CTLTBL (FPTN=KH$CTLTBL,STCLASS="BASED(KH_CTLTBL$)");
      118    12764        %KH$ADMIN_FPT (FPTN=ADMIN_FPT,STCLASS=AUTO);
      119    12975        %KL_REQSTATS (NAME=KL$REQSTATS,STCLASS="BASED(KH_BUF$)");
      120    13269    1   DCL ERROR UBIN;
      121    13270        /**/
      122    13271        %FPT_WRITE (FPTN=KHA_WRITE,STCLASS="STATIC SYMDEF");
      123    13295        %FPT_READ (FPTN=KHA_READ,STCLASS="STATIC SYMDEF",WAIT=YES);
      124    13321        %FPT_GDS (FPTN=KHA_GET5,STCLASS=CONSTANT,PAGES=5,RESULTS=KHA_BUFSEG,PARK=NO);
      125    13345        %VLP_SEGMENT (FPTN=KHA_BUFSEG,STCLASS=SYMREF);
      126    13366        /**/
      127    13367        %EJECT;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:12   
      128    13368    1        IF G$TCB$->G$TCB.ALT$->G$EXCFR.TRLR.ERR.ERR# = %E$XTRARD THEN
      129    13369    1             RETURN;
      130    13370
      131    13371    1        IF G$TCB$->G$TCB.STK$->G$EXCFR.TRLR.SUBC = %G_RTTMRSC# THEN
      132    13372    2        DO;
      133    13373    2             IF KH_WLCLKENT$ ~= ENTADDR(NIL) THEN
      134    13374    2                  CALL KH_WLCLKENT$;
      135    13375    2             RETURN;
      136    13376    2           END;
      137    13377    1        DEEP = DEEP + 1;
      138    13378    1        NEED2READ = 1;
      139    13379    1        IF G$TCB$->G$TCB.STK$->G$NWIO.TRLR.ERR.ERR# = %E$LD
      140    13380    2        THEN DO;
      141    13381    2             CALL M$GDS (KHA_GET5)         /* Get 5 more pages */
      142    13382    3             WHENALTRETURN DO;
      143    13383    3                  CALL M$XXX;
      144    13384    3                END;
      145    13385    2             VBOUND(KHA_READ.BUF_) = VBOUND(KHA_READ.BUF_) + (5 * 512);
      146    13386    2           END;
      147    13387
      148    13388
      149    13389
      150    13390
      151    13391    1        INHIBIT_LEVEL = KH_INHLVL;
      152    13392             %DISABLE;
      153    13396    2        DO CASE(KL$MES.CODE);
      154    13397    2        CASE(IGA_ADMIN);
      155    13398    2           TERMLO = KL$ADMIN.TERMID_LO;
      156    13399    2           TERMHI = KL$ADMIN.TERMID_HI;
      157    13400    2           CALL KHA$DVCADM_RNG(KL$ADMIN.FNC,KL$ADMIN.RESULTS,TERMLO,TERMHI);
      158    13401    2           KHA_WRITE.BUF_ = VECTOR(KL$ADMIN);
      159    13402    2           IF KH_FLDWRTS > 0 THEN
      160    13403    2                CALL KHA$SETCLK(KHA_WRITE);
      161    13404    2           ELSE
      162    13405    3           DO;
      163    13406    3                CALL M$WRITE(KHA_WRITE) WHENALTRETURN
      164    13407    4                DO;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:13   
      165    13408    4                     CALL KHA$SETCLK(KHA_WRITE);
      166    13409    4                   END;
      167    13410    3              END;
      168    13411    2        CASE(IGA_CONTROL);
      169    13412    2           IF (KL$CONTROL.PARMX > KH$CTLTBL.HIPARAM OR
      170    13413    2                KH$CTLTBL.PARM.PTR$(KL$CONTROL.PARMX) = ADDR(NIL)) AND
      171    13414    2                KL$CONTROL.PARMX ~= %KL_ASYNC_SSNMAX AND
      172    13415    2                KL$CONTROL.PARMX ~= %KL_HNDLRPARM_IMPTBLMAX AND
      173    13416    2                KL$CONTROL.PARMX ~= %KL_HNDLRPARM_ERRSND AND
      174    13417    3                KL$CONTROL.PARMX ~= %KL_HNDLRPARM_TYPAHDBFRLMT THEN DO;
      175    13418    3                KL$CONTROL.RESULTS = UNDEF;
      176    13419    3              END;                         /* IF */
      177    13420    3           ELSE DO;
      178    13421    3                KL$CONTROL.TYPE = 1;       /* ACK */
      179    13422    4                DO CASE(KL$CONTROL.CMD);
      180    13423    4                CASE(%KL_CONTROL_SET);
      181    13424    5                   DO CASE (KL$CONTROL.PARMX);
      182    13425    5                   CASE(%KL_ASYNC_SSNMAX);
      183    13426    5                      KV_SSNMAX = KL$CONTROL.VALUE;
      184    13427    5                   CASE(%KL_HNDLRPARM_TYPAHDBFRLMT);
      185    13428    5                      KV_TYPAHDBFRLMT = KL$CONTROL.VALUE;
      186    13429    5                   CASE (%KL_HNDLRPARM_IMPTBLMAX);
      187    13430    5                      KV_MAXUFTSIZ = KL$CONTROL.VALUE;
      188    13431    5                   CASE (%KL_HNDLRPARM_ERRSND);
      189    13432    5                      KH_ERRSND = KL$CONTROL.VALUE;
      190    13433    5                      IF KH$CTLTBL.PARM.PTR$(%KL_HNDLRPARM_ERRSND)~=ADDR(NIL)
      191    13434    5                      THEN KH$CTLTBL.PARM.PTR$(%KL_HNDLRPARM_ERRSND)->WORDARRAY(0) =
             13434                               KL$CONTROL.VALUE;
      192    13435    5                   CASE(ELSE);
      193    13436    6                      IF NOT KH$CTLTBL.PARM.FLAGS.INIT_ONLY(KL$CONTROL.PARMX) THEN DO;
      194    13437    6                           ADMIN_FPT = '0'B;
      195    13438    6                           ADMIN_FPT.CONTROL# = KL$CONTROL.PARMX;
      196    13439    6                           ADMIN_FPT.FNC = %KHA_FNC_CNTRLCHG;
      197    13440    6                           ADMIN_FPT.CTX$ = ADDR(KL$CONTROL);
      198    13441    6                           KL$CONTROL.OVALUE = KH$CTLTBL.PARM.PTR$(KL$CONTROL.PARMX)->
             13441                                    WORDARRAY(KL$CONTROL.INDX);
      199    13442    6                           KH$CTLTBL.PARM.PTR$(KL$CONTROL.PARMX)->WORDARRAY(KL$CONTROL.
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:14   
             13442                                    INDX) = KL$CONTROL.VALUE;
      200    13443    6                           CALL KH_ADMIN$(ADMIN_FPT);
      201    13444    6                         END;              /* IF NOT INIT_ONLY */
      202    13445    6                      ELSE DO;
      203    13446    6                           KL$CONTROL.RESULTS = INIT_ONLY;
      204    13447    6                         END;              /* ELSE */
      205    13448    5                   END;                    /* DO CASE PARMX */
      206    13449    4                CASE(%KL_CONTROL_DISPLAY);
      207    13450    5                   DO CASE (KL$CONTROL.PARMX);
      208    13451    5                   CASE(%KL_ASYNC_SSNMAX);
      209    13452    5                      KL$CONTROL.VALUE = KV_SSNMAX;
      210    13453    5                   CASE(%KL_HNDLRPARM_TYPAHDBFRLMT);
      211    13454    5                      KL$CONTROL.VALUE = KV_TYPAHDBFRLMT;
      212    13455    5                   CASE (%KL_HNDLRPARM_IMPTBLMAX);
      213    13456    5                      KL$CONTROL.VALUE = KV_MAXUFTSIZ;
      214    13457    5                   CASE (%KL_HNDLRPARM_ERRSND);
      215    13458    5                      KL$CONTROL.VALUE = KH_ERRSND;
      216    13459    5                   CASE (ELSE);
      217    13460    5                      KL$CONTROL.VALUE = KH$CTLTBL.PARM.PTR$(KL$CONTROL.PARMX)->
             13460                               WORDARRAY(KL$CONTROL.INDX);
      218    13461    5                   END;                    /* DO CASE PARMX */
      219    13462    4                END;                       /* DO CASE(CMD) */
      220    13463    3              END;                         /* ELSE */
      221    13464    2           KHA_WRITE.BUF_ = VECTOR(KL$CONTROL);
      222    13465    2           IF KH_FLDWRTS > 0 THEN
      223    13466    2                CALL KHA$SETCLK(KHA_WRITE);
      224    13467    2           ELSE
      225    13468    3           DO;
      226    13469    3                CALL M$WRITE(KHA_WRITE) WHENALTRETURN
      227    13470    4                DO;
      228    13471    4                     CALL KHA$SETCLK(KHA_WRITE);
      229    13472    4                   END;
      230    13473    3              END;
      231    13474    2        CASE(IGA_CNFG_MSG);
      232    13475    2           TERMLO = KL$CNFG.TERMID_LO;
      233    13476    2           TERMHI = KL$CNFG.TERMID_HI;
      234    13477    2           CALL KHA$DVCADM_RNG(%KHA_FNC_CNFG,KL$CNFG.RESULTS,TERMLO,TERMHI,VECTOR(
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:15   
             13477                    KL$CNFG.KHA));
      235    13478    2           KHA_WRITE.BUF_ = VECTOR(KL$HDR);
      236    13479    2           IF KH_FLDWRTS > 0 THEN
      237    13480    2                CALL KHA$SETCLK(KHA_WRITE);
      238    13481    2           ELSE
      239    13482    3           DO;
      240    13483    3                CALL M$WRITE(KHA_WRITE) WHENALTRETURN
      241    13484    4                DO;
      242    13485    4                     CALL KHA$SETCLK(KHA_WRITE);
      243    13486    4                   END;
      244    13487    3              END;
      245    13488    2        CASE(IGA_CHNRSP);
      246    13489    3           IF KL$CHNRSP.LINE_PROFILE THEN DO;
      247    13490    4                IF KL$CHNRSP.NAK THEN DO;
      248    13491    4                     TERMLO = KL$CHNRSP.TERMINAL_ID;
      249    13492    4                     CALL KHA$DVCADM(%KHA_FNC_SGNRJC,ERROR,TERMLO);
      250    13493    4                   END;                    /* IF NAK */
      251    13494    4                ELSE DO;
      252    13495    4                     TERMLO = KL$CHNRSP.TERMINAL_ID;
      253    13496    4                     CALL KHA$DVCADM(%KHA_FNC_BLDLINPRO,ERROR,TERMLO,,VECTOR(KL$CHNRSP.
             13496                              MESSAGE.MESSAGE));
      254    13497    4                   END;                    /* ELSE */
      255    13498    3              END;                         /* IF EXTCHNRSP.LINE_PROFILE */
      256    13499    2        CASE(IGA_DVCERRRSP);
      257    13500    2           TERMLO = KL$DVCERRRSP.TERMID;
      258    13501    2           CALL KHA$DVCADM(%KHA_FNC_DVCERRRSP,ERROR,TERMLO,,VECTOR(KL$DVCERRRSP.KYN#));
      259    13502
      260    13503    2        CASE (IGA_PRFRSP);
      261    13504    2           SIZE = (KL$PRFRSP.PROFILE.PRFSIZE + 1) / 2;
      262    13505    2           CALL KVB$GETSYS (SIZE,VBASE(KH_PROFILE_));
      263    13506    2           SIZE = SIZE * 2;
      264    13507    2           VBOUND(KH_PROFILE_) = KL$PRFRSP.PROFILE.PRFSIZE - 1;
      265    13508    2           VBASE(KH_PROFILE_)->PROTXT = KL$PRFRSP.PROFILE.PRFTXT;
      266    13509
      267    13510    2        CASE(IGA_REQSTATS);
      268    13511    2           ADMIN_FPT = '0'B;
      269    13512    2           ADMIN_FPT.CTX$ = ADDR(KL$REQSTATS);
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:16   
      270    13513    2           ADMIN_FPT.FNC = %KHA_FNC_REQSTATS;
      271    13514    3           CALL KH_ADMIN$(ADMIN_FPT) WHENALTRETURN DO;
      272    13515                      /*N* ??????*/
      273    13516    3              END;                         /* WHENALTRETURN */
      274    13517    2        END;                               /* DO CASE(KL$MES.CODE) */
      275    13518
      276    13519    1   RET: ;
      277    13520             %ENABLE;
      278    13526    1   DO_READ: ;
      279    13527    1        IF DEEP = 1 THEN
      280    13528    2        DO;
      281    13529    3             DO WHILE (NEED2READ ~= 0);
      282    13530    3                  NEED2READ = 0;
      283    13531        /*             CALL M$READ(KHA_READ) WHENALTRETURN DO; */
      284    13532        /*
      285    13533         *               let kha$rdclk call m$read to avoid the lost
      286    13534         *               read problem bisync runs into.
      287    13535         */
      288    13536    4                  CALL KHA$RDCLK WHENALTRETURN DO;
      289    13537    4                       CALL M$XXX;
      290    13538    4                     END;
      291    13539    3                END;
      292    13540    2           END;
      293    13541    1        DEEP = DEEP - 1;
      294    13542    1        RETURN;
      295    13543    1   END KHA$ADMIN;
      296    13544        %EOD;

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:17   
--  Include file information  --

   K_ID_E.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KHA$ADMIN.

   Procedure KHA$ADMIN requires 979 words for executable code.
   Procedure KHA$ADMIN requires 57 words of local(AUTO) storage.

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:18   

 Object Unit name= KHA$ADMIN                                  File name= KHA$ADMIN.:E05TOU
 UTS= JUL 30 '97 00:25:02.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none    40     28  KHA$ADMIN
    1  RoData even  UTS     12      C  KHA$ADMIN
    2   Proc  even  none   979    3D3  KHA$ADMIN
    3  RoData even  none     4      4  KHA$ADMIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        0  KHA$ADMIN

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0      2  KH_BUF$                            0      4  KHA_WRITE
    0     16  KHA_READ
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:19   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KVB$GETSYS
 yes     yes           Std       6 KHA$DVCADM
         yes           Std       0 KHI$ENABLE
         yes           Std       1 KHI$DISABLE
 yes     yes           Std       6 KHA$DVCADM_RNG
 yes     yes           Std       1 KHA$SETCLK
 yes     yes           Std       0 KHA$RDCLK
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET
                       nStd      0 X6C_ALR

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    G$TCB$                                KH_CTLTBL$                            KH_ADMIN$
     KH_INHLVL                             KV_SSNMAX                             KV_TYPAHDBFRLMT
     KV_MAXUFTSIZ                          KH_FLDWRTS                            KH_ERRSND
     KH_WLCLKENT$                          KH_CHNHI                              KH_CHNLOW
     KH_PROFILE_                           KHA_BUFSEG                       r    G$ROS$
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:20   


       22        1        /*T***********************************************************/
       23        2        /*T*                                                         */
       24        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       25        4        /*T*                                                         */
       26        5        /*T***********************************************************/
       27        6        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
       28        7        /*F* NAME: KHA$ADMIN - Event Handler for Events from Node Admin
       29        8
       30        9        KHA$ADMIN is the entry point for no-wait read complete on
       31       10        M$NA.
       32       11        The message received from the Node Administrator will indicate the
       33       12        function to be performed: enable/disable channel, return statistics,
       34       13        change control values, etc.
       35       14
       36       15        KHA$ADMIN will perform the indicated function.
       37       16        Some functions require that the handler administrative routine be
       38       17        called.  The handler administrative routine must have been established
       39       18        earlier on the call to KHA$INIT.  Parameters will be passed to
       40       19        the handler in a structure which is defined by the KH$ADMIN_FPT
       41       20        macro.  Please see the description of KH$ADMIN_FPT below for details.
       42       21
       43       22
       44       23        Before exiting, KHA$ADMIN will re-issue the no-wait read to M$NA.
       45       24
       46       25        */
       47       26        KHA$ADMIN: PROC;

     26   2 000000  D380 0000 0000  xent KHA$ADMIN       LNJ,B5   X6A_AUTO_0
          2 000003       0039 0000                       DC       57,0

       48       27        /**/
       49       28        %INCLUDE B_ERRORS_C;
       50     1155        %INCLUDE LCP_6;
       51     5434        %INCLUDE KL_AFCN_C;
       52     5535        %INCLUDE KH$CHN;
       53     5657        %INCLUDE KHC_MAC_C;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:21   
       54     5698        %INCLUDE KH_CHN;
       55     5738        %INCLUDE KL_CONTROL_C;
       56     6118        %INCLUDE KL_MACRO_C;
       57     9470        %INCLUDE KH_MACRO_C;
       58    10213        %INCLUDE KHA_FNC_E;
       59    10313        %INCLUDE K_ID_E;
       60    10363        /**/
       61    10364        %K#LYRID_E;
       62    10371        %K#ENTID_E;
       63    10390        %INHIBIT_DCLS;
       64    10402        /**/
       65    10403    1   DCL KHA$DVCADM_RNG ENTRY(6) ALTRET;
       66    10404    1   DCL KHA$DVCADM ENTRY(6) ALTRET;
       67    10405    1   DCL KHA$RDCLK ENTRY ALTRET;
       68    10406    1   DCL KHA$SETCLK ENTRY(1) ALTRET;
       69    10407    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
       70    10408        /**/
       71    10409        /* System structures */
       72    10410        %G$TCB;
       73    10431        %G$NWIO;
       74    10841        %G$EXCFR;
       75    11223
       76    11224    1   DCL G$TCB$ PTR SYMREF READONLY;
       77    11225    1   DCL KH_CTLTBL$ PTR SYMREF;
       78    11226    1   DCL KH_NA_DCB# UBIN SYMREF;
       79    11227    1   DCL KH_NA_EVENT# UBIN SYMREF;
       80    11228    1   DCL KH_ADMIN$ EPTR SYMREF;
       81    11229    1   DCL KH_INHLVL UBIN SYMREF;
       82    11230    1   DCL KV_SSNMAX UBIN SYMREF;
       83    11231    1   DCL KV_TYPAHDBFRLMT UBIN SYMREF;
       84    11232    1   DCL KV_MAXUFTSIZ UBIN SYMREF;
       85    11233    1   DCL KH_FLDWRTS SBIN SYMREF;             /* current number of failed writes */
       86    11234    1   DCL KH_ERRSND UBIN SYMREF;
       87    11235    1   DCL KH_WLCLKENT$ EPTR SYMREF;
       88    11236        /**/
       89    11237
       90    11238    1   DCL DEEP UBIN STATIC INIT(0);
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:22   
       91    11239    1   DCL NEED2READ UBIN STATIC INIT(0);
       92    11240    1   DCL SIZE UBIN;
       93    11241    1   DCL PROTXT CHAR(SIZE) BASED;
       94    11242    1   DCL CHAN$ PTR;
       95    11243        %KH_CHNDAT (STCLASS=SYMREF);
       96    11261    1   DCL KH_BUF$ PTR STATIC SYMDEF INIT(ADDR(NIL));
       97    11262    1   DCL WORDARRAY(0:0) UBIN WORD BASED;
       98    11263        %KL_MES (FPTN=KL$MES,STCLASS="BASED(KH_BUF$)");
       99    11286        %KL_CONTROL (FPTN=KL$CONTROL,STCLASS="BASED(KH_BUF$)");
      100    11423        %KL_ADMIN (FPTN=KL$ADMIN,STCLASS="BASED(KH_BUF$)");
      101    11584        %KL_CNFG_MSG (FPTN=KL$CNFG,STCLASS="BASED(KH_BUF$)");
      102    11868        %KL_DVCERRRSP (FPTN=KL$DVCERRRSP,STCLASS="BASED(KH_BUF$)");
      103    11921        %KH$CHN (NAME=CHN,STCLASS="BASED(CHAN$)");
      104    12045        %KL_HDR (FPTN=KL$HDR,STCLASS="BASED(KH_BUF$)");
      105    12126        %VLP_ERRCODE (FPTN=INIT_ONLY,FCG=KH,MID=A,MON='1'B,ERR#=%E$PARM_INITONLY,STCLASS=
             12126            CONSTANT);
      106    12172        /*E* ERROR: KHA-E$PARM_INITONLY
      107    12173             MESSAGE: That parameter is only setable at initialization.
      108    12174         */
      109    12175       %VLP_ERRCODE (FPTN=UNDEF,FCG=KH,MID=A,MON='1'B,ERR#=%E$PARM_UNDEF,STCLASS=CONSTANT);
      110    12221        /*E* ERROR: KHA-E$PARM_UNDEF
      111    12222             MESSAGE: That parameter is undefined for this handler.
      112    12223         */
      113    12224        %B$TERMINAL_ID (FPTN=TERMLO,STCLASS=AUTO,ALGN=WALIGNED);
      114    12253        %B$TERMINAL_ID (FPTN=TERMHI,STCLASS=AUTO,ALGN=WALIGNED);
      115    12282        %KL_CHNRSP (FPTN=KL$CHNRSP,STCLASS="BASED(KH_BUF$)");
      116    12502        %KL_PRFRSP (FPTN=KL$PRFRSP,STCLASS="BASED(KH_BUF$)");
      117    12552        %KH$CTLTBL (FPTN=KH$CTLTBL,STCLASS="BASED(KH_CTLTBL$)");
      118    12764        %KH$ADMIN_FPT (FPTN=ADMIN_FPT,STCLASS=AUTO);
      119    12975        %KL_REQSTATS (NAME=KL$REQSTATS,STCLASS="BASED(KH_BUF$)");
      120    13269    1   DCL ERROR UBIN;
      121    13270        /**/
      122    13271        %FPT_WRITE (FPTN=KHA_WRITE,STCLASS="STATIC SYMDEF");
      123    13295        %FPT_READ (FPTN=KHA_READ,STCLASS="STATIC SYMDEF",WAIT=YES);
      124    13321        %FPT_GDS (FPTN=KHA_GET5,STCLASS=CONSTANT,PAGES=5,RESULTS=KHA_BUFSEG,PARK=NO);
      125    13345        %VLP_SEGMENT (FPTN=KHA_BUFSEG,STCLASS=SYMREF);
      126    13366        /**/
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:23   
      127    13367        %EJECT;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:24   
      128    13368    1        IF G$TCB$->G$TCB.ALT$->G$EXCFR.TRLR.ERR.ERR# = %E$XTRARD THEN

  13368   2 000005  EC80 0000 0000  xsym                 LDB,B6   G$TCB$
          2 000008  DC86                                 LDB,B5   ,B6
          2 000009  E845 002C                            LDR,R6   44,B5
          2 00000B  6043                                 SOR,R6   3
          2 00000C  6D13                                 CMV,R6   19
          2 00000D  0981 0004                            BNE      s:13371,PREL

      129    13369    1             RETURN;

  13369   2 00000F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      130    13370
      131    13371    1        IF G$TCB$->G$TCB.STK$->G$EXCFR.TRLR.SUBC = %G_RTTMRSC# THEN

  13371   2 000012  CCC6 0002                            LDB,B4   2,B6
          2 000014  D844 0029                            LDR,R5   41,B4
          2 000016  5D01                                 CMV,R5   1
          2 000017  0981 0011                            BNE      s:13377,PREL

      132    13372    2        DO;

      133    13373    2             IF KH_WLCLKENT$ ~= ENTADDR(NIL) THEN

  13373   2 000019  BC80 0000 0000  xsym                 LDB,B3   KH_WLCLKENT$
          2 00001C  BD80 0000 0000  03                   CMB,B3   0
          2 00001F  0901 0006                            BE       s:13375,PREL

      134    13374    2                  CALL KH_WLCLKENT$;

  13374   2 000021  9B83                                 LAB,B1   ,B3
          2 000022  CBF0 0000                            LAB,B4   0,IMO
          2 000024  E381                                 LNJ,B6   ,B1
          2 000025       0001                            DC       s:13375,PREL

      135    13375    2             RETURN;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:25   

  13375   2 000026  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      136    13376    2           END;
      137    13377    1        DEEP = DEEP + 1;

  13377   2 000029  8A80 0000 0000  00                   INC      DEEP

      138    13378    1        NEED2READ = 1;

  13378   2 00002C  4C01                                 LDV,R4   1
          2 00002D  CF00 0000 0001  00                   STR,R4   NEED2READ

      139    13379    1        IF G$TCB$->G$TCB.STK$->G$NWIO.TRLR.ERR.ERR# = %E$LD

  13379   2 000030  B844 002C                            LDR,R3   44,B4
          2 000032  3043                                 SOR,R3   3
          2 000033  3D07                                 CMV,R3   7
          2 000034  0981 0016                            BNE      s:13391,PREL

      140    13380    2        THEN DO;

      141    13381    2             CALL M$GDS (KHA_GET5)         /* Get 5 more pages */

  13381   2 000036  BB80 0000 0004  01                   LAB,B3   KHA_GET5
          2 000039  B870 0902                            LDR,R3   2306,IMO
          2 00003B  0001                                 MCL
          2 00003C       0003                            DC       s:13383,PREL
          2 00003D  0F81 0005                            B        s:13385,PREL

      142    13382    3             WHENALTRETURN DO;

      143    13383    3                  CALL M$XXX;

  13383   2 00003F  B870 0082                            LDR,R3   130,IMO
          2 000041  0001                                 MCL
          2 000042       0000                            DC       s:13383+3,PREL
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:26   

      144    13384    3                END;

      145    13385    2             VBOUND(KHA_READ.BUF_) = VBOUND(KHA_READ.BUF_) + (5 * 512);

  13385   2 000043  E800 0000 001C  00                   LDR,R6   KHA_READ+6
          2 000046  EA70 0A00                            ADD,R6   2560,IMO
          2 000048  EF00 0000 001C  00                   STR,R6   KHA_READ+6

      146    13386    2           END;

      147    13387
      148    13388
      149    13389
      150    13390
      151    13391    1        INHIBIT_LEVEL = KH_INHLVL;

  13391   2 00004B  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 00004E  EF47 0004                            STR,R6   INHIBIT_LEVEL,AUTO

      152    13392             %DISABLE;

  13393   2 000050  EF47 0005                            STR,R6   DISABLE_LEVEL,AUTO

  13394   2 000052  EBC7 0005                            LAB,B6   DISABLE_LEVEL,AUTO
          2 000054  EFC7 002C                            STB,B6   ERROR+1,AUTO
          2 000056  BBC7 002C                            LAB,B3   ERROR+1,AUTO
          2 000058  CBF0 0100                            LAB,B4   256,IMO
          2 00005A  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 00005D       0001                            DC       s:13396,PREL

      153    13396    2        DO CASE(KL$MES.CODE);

  13396   2 00005E  EC80 0000 0002  00                   LDB,B6   KH_BUF$
          2 000061  B286                                 LLH,R3   ,B6
          2 000062  3EF0                                 ADV,R3   -16
          2 000063  3D33                                 CMV,R3   51
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:27   
          2 000064  0281 033E                            BGE      s:13517,PREL
          2 000066  A830 0000 006C  02                   LDR,R2   s:13396+14,R3
          2 000069  83A0 0000 009F  02                   JMP      s:13398,R2
          2 00006C       027A                            DC       s:13500,PREL
          2 00006D       0304                            DC       s:13517,PREL
          2 00006E       0304                            DC       s:13517,PREL
          2 00006F       0304                            DC       s:13517,PREL
          2 000070       0304                            DC       s:13517,PREL
          2 000071       0304                            DC       s:13517,PREL
          2 000072       0304                            DC       s:13517,PREL
          2 000073       0304                            DC       s:13517,PREL
          2 000074       0304                            DC       s:13517,PREL
          2 000075       0304                            DC       s:13517,PREL
          2 000076       0304                            DC       s:13517,PREL
          2 000077       0304                            DC       s:13517,PREL
          2 000078       0304                            DC       s:13517,PREL
          2 000079       0304                            DC       s:13517,PREL
          2 00007A       0304                            DC       s:13517,PREL
          2 00007B       0304                            DC       s:13517,PREL
          2 00007C       0304                            DC       s:13517,PREL
          2 00007D       005E                            DC       s:13412,PREL
          2 00007E       0304                            DC       s:13517,PREL
          2 00007F       0000                            DC       s:13398,PREL
          2 000080       02E9                            DC       s:13511,PREL
          2 000081       0304                            DC       s:13517,PREL
          2 000082       01BD                            DC       s:13475,PREL
          2 000083       0304                            DC       s:13517,PREL
          2 000084       0304                            DC       s:13517,PREL
          2 000085       0304                            DC       s:13517,PREL
          2 000086       0304                            DC       s:13517,PREL
          2 000087       0304                            DC       s:13517,PREL
          2 000088       0304                            DC       s:13517,PREL
          2 000089       0304                            DC       s:13517,PREL
          2 00008A       0304                            DC       s:13517,PREL
          2 00008B       0304                            DC       s:13517,PREL
          2 00008C       0304                            DC       s:13517,PREL
          2 00008D       0304                            DC       s:13517,PREL
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:28   
          2 00008E       0304                            DC       s:13517,PREL
          2 00008F       0304                            DC       s:13517,PREL
          2 000090       0304                            DC       s:13517,PREL
          2 000091       0304                            DC       s:13517,PREL
          2 000092       0304                            DC       s:13517,PREL
          2 000093       0304                            DC       s:13517,PREL
          2 000094       0304                            DC       s:13517,PREL
          2 000095       0304                            DC       s:13517,PREL
          2 000096       0304                            DC       s:13517,PREL
          2 000097       0304                            DC       s:13517,PREL
          2 000098       0304                            DC       s:13517,PREL
          2 000099       0304                            DC       s:13517,PREL
          2 00009A       0226                            DC       s:13489,PREL
          2 00009B       0304                            DC       s:13517,PREL
          2 00009C       0304                            DC       s:13517,PREL
          2 00009D       0304                            DC       s:13517,PREL
          2 00009E       02A9                            DC       s:13504,PREL

      154    13397    2        CASE(IGA_ADMIN);

      155    13398    2           TERMLO = KL$ADMIN.TERMID_LO;

  13398   2 00009F  AB86                                 LAB,B2   ,B6
          2 0000A0  2C24                                 LDV,R2   36
          2 0000A1  6C10                                 LDV,R6   16
          2 0000A2  BB87                                 LAB,B3   ,AUTO
          2 0000A3  3C12                                 LDV,R3   18
          2 0000A4  0008                                 MMM

      156    13399    2           TERMHI = KL$ADMIN.TERMID_HI;

  13399   2 0000A5  AC80 0000 0002  00                   LDB,B2   KH_BUF$
          2 0000A8  2C34                                 LDV,R2   52
          2 0000A9  6C10                                 LDV,R6   16
          2 0000AA  BB87                                 LAB,B3   ,AUTO
          2 0000AB  3C22                                 LDV,R3   34
          2 0000AC  0008                                 MMM
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:29   

      157    13400    2           CALL KHA$DVCADM_RNG(KL$ADMIN.FNC,KL$ADMIN.RESULTS,TERMLO,TERMHI);

  13400   2 0000AD  DBC7 0011                            LAB,B5   TERMHI,AUTO
          2 0000AF  DFC7 0032                            STB,B5   ERROR+7,AUTO
          2 0000B1  CBC7 0009                            LAB,B4   TERMLO,AUTO
          2 0000B3  CFC7 0030                            STB,B4   ERROR+5,AUTO
          2 0000B5  AC80 0000 0002  00                   LDB,B2   KH_BUF$
          2 0000B8  9BC2 000E                            LAB,B1   14,B2
          2 0000BA  9FC7 002E                            STB,B1   ERROR+3,AUTO
          2 0000BC  EBC2 0011                            LAB,B6   17,B2
          2 0000BE  EFC7 002C                            STB,B6   ERROR+1,AUTO
          2 0000C0  BBC7 002C                            LAB,B3   ERROR+1,AUTO
          2 0000C2  CBF0 0400                            LAB,B4   1024,IMO
          2 0000C4  E380 0000 0000  xent                 LNJ,B6   KHA$DVCADM_RNG
          2 0000C7       0001                            DC       s:13401,PREL

      158    13401    2           KHA_WRITE.BUF_ = VECTOR(KL$ADMIN);

  13401   2 0000C8  EC80 0000 0002  00                   LDB,B6   KH_BUF$
          2 0000CB  EFC7 002D                            STB,B6   ERROR+2,AUTO
          2 0000CD  6C43                                 LDV,R6   67
          2 0000CE  EF47 002C                            STR,R6   ERROR+1,AUTO
          2 0000D0  ABC7 002C                            LAB,B2   ERROR+1,AUTO
          2 0000D2  2C00                                 LDV,R2   0
          2 0000D3  6C06                                 LDV,R6   6
          2 0000D4  BB80 0000 0000  00                   LAB,B3   DEEP
          2 0000D7  3C14                                 LDV,R3   20
          2 0000D8  0008                                 MMM

      159    13402    2           IF KH_FLDWRTS > 0 THEN

  13402   2 0000D9  E800 0000 0000  xsym                 LDR,R6   KH_FLDWRTS
          2 0000DC  6A81 000C                            BLEZ,R6  s:13406,PREL

      160    13403    2                CALL KHA$SETCLK(KHA_WRITE);

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:30   
  13403   2 0000DE  BB80 0000 0002  03                   LAB,B3   +2
          2 0000E1  CBF0 0100                            LAB,B4   256,IMO
          2 0000E3  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 0000E6       0001                            DC       s:13403+9,PREL
          2 0000E7  0F81 02BB                            B        s:13517,PREL

      161    13404    2           ELSE
      162    13405    3           DO;

      163    13406    3                CALL M$WRITE(KHA_WRITE) WHENALTRETURN

  13406   2 0000E9  BB80 0000 0004  00                   LAB,B3   KHA_WRITE
          2 0000EC  B870 1543                            LDR,R3   5443,IMO
          2 0000EE  0001                                 MCL
          2 0000EF       0003                            DC       s:13408,PREL
          2 0000F0  0F81 000A                            B        s:13410,PREL

      164    13407    4                DO;

      165    13408    4                     CALL KHA$SETCLK(KHA_WRITE);

  13408   2 0000F2  BB80 0000 0002  03                   LAB,B3   +2
          2 0000F5  CBF0 0100                            LAB,B4   256,IMO
          2 0000F7  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 0000FA       0001                            DC       s:13410,PREL

      166    13409    4                   END;

      167    13410    3              END;

  13410   2 0000FB  0F81 02A7                            B        s:13517,PREL

      168    13411    2        CASE(IGA_CONTROL);

      169    13412    2           IF (KL$CONTROL.PARMX > KH$CTLTBL.HIPARAM OR

  13412   2 0000FD  DC80 0000 0000  xsym                 LDB,B5   KH_CTLTBL$
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:31   
          2 000100  E846 0012                            LDR,R6   18,B6
          2 000102  6801 0012                            BLZ,R6   s:13412+24,PREL
          2 000104  E905                                 CMR,R6   ,B5
          2 000105  0A01 000F                            BAG      s:13412+24,PREL
          2 000107  9856                                 LDR,R1   R6
          2 000108  1F06                                 MLV,R1   6
          2 000109  5C04                                 LDV,R5   4
          2 00010A  0021                                 ALR      ;
          2 00010B       4415 0002                                ALPHANUM(2,B5,R1,,4),;
          2 00010D       4007 002C                                ALPHANUM(ERROR+1,AUTO,,R5,FILL)
          2 00010F  437F                                 CSYNC    s:13412+17,SPREL
          2 000110  CCC7 002C                            LDB,B4   ERROR+1,AUTO
          2 000112  8DD4                                 CMN      B4
          2 000113  0981 0016                            BNE      s:13421,PREL
          2 000115  E846 0012                            LDR,R6   18,B6
          2 000117  6D18                                 CMV,R6   24
          2 000118  0901 0011                            BE       s:13421,PREL
          2 00011A  6D19                                 CMV,R6   25
          2 00011B  0901 000E                            BE       s:13421,PREL
          2 00011D  6D0A                                 CMV,R6   10
          2 00011E  0901 000B                            BE       s:13421,PREL
          2 000120  6D05                                 CMV,R6   5
          2 000121  0901 0008                            BE       s:13421,PREL

      170    13413    2                KH$CTLTBL.PARM.PTR$(KL$CONTROL.PARMX) = ADDR(NIL)) AND
      171    13414    2                KL$CONTROL.PARMX ~= %KL_ASYNC_SSNMAX AND
      172    13415    2                KL$CONTROL.PARMX ~= %KL_HNDLRPARM_IMPTBLMAX AND
      173    13416    2                KL$CONTROL.PARMX ~= %KL_HNDLRPARM_ERRSND AND
      174    13417    3                KL$CONTROL.PARMX ~= %KL_HNDLRPARM_TYPAHDBFRLMT THEN DO;

      175    13418    3                KL$CONTROL.RESULTS = UNDEF;

  13418   2 000123  8C80 0000 0002  01                   LDI      UNDEF
          2 000126  8D46 000E                            SDI      14,B6

      176    13419    3              END;                         /* IF */

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:32   
  13419   2 000128  0F81 00FE                            B        s:13464,PREL

      177    13420    3           ELSE DO;

      178    13421    3                KL$CONTROL.TYPE = 1;       /* ACK */

  13421   2 00012A  6C01                                 LDV,R6   1
          2 00012B  EA86                                 SRM,R6,'00FF'X    ,B6
          2 00012C       00FF

      179    13422    4                DO CASE(KL$CONTROL.CMD);

  13422   2 00012D  EC80 0000 0002  00                   LDB,B6   KH_BUF$
          2 000130  B846 0011                            LDR,R3   17,B6
          2 000132  3D03                                 CMV,R3   3
          2 000133  0281 00F3                            BGE      s:13464,PREL
          2 000135  A830 0000 013B  02                   LDR,R2   s:13422+14,R3
          2 000138  83A0 0000 013E  02                   JMP      s:13424,R2
          2 00013B       00E9                            DC       s:13464,PREL
          2 00013C       0000                            DC       s:13424,PREL
          2 00013D       0098                            DC       s:13450,PREL

      180    13423    4                CASE(%KL_CONTROL_SET);

      181    13424    5                   DO CASE (KL$CONTROL.PARMX);

  13424   2 00013E  9846 0012                            LDR,R1   18,B6
          2 000140  1EFB                                 ADV,R1   -5
          2 000141  1D15                                 CMV,R1   21
          2 000142  0281 0042                            BGE      s:13436,PREL
          2 000144  B810 0000 014A  02                   LDR,R3   s:13424+12,R1
          2 000147  83B0 0000 015F  02                   JMP      s:13426,R3
          2 00014A       0007                            DC       s:13428,PREL
          2 00014B       0026                            DC       s:13436,PREL
          2 00014C       0026                            DC       s:13436,PREL
          2 00014D       0026                            DC       s:13436,PREL
          2 00014E       0026                            DC       s:13436,PREL
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:33   
          2 00014F       0015                            DC       s:13432,PREL
          2 000150       0026                            DC       s:13436,PREL
          2 000151       0026                            DC       s:13436,PREL
          2 000152       0026                            DC       s:13436,PREL
          2 000153       0026                            DC       s:13436,PREL
          2 000154       0026                            DC       s:13436,PREL
          2 000155       0026                            DC       s:13436,PREL
          2 000156       0026                            DC       s:13436,PREL
          2 000157       0026                            DC       s:13436,PREL
          2 000158       0026                            DC       s:13436,PREL
          2 000159       0026                            DC       s:13436,PREL
          2 00015A       0026                            DC       s:13436,PREL
          2 00015B       0026                            DC       s:13436,PREL
          2 00015C       0026                            DC       s:13436,PREL
          2 00015D       0000                            DC       s:13426,PREL
          2 00015E       000E                            DC       s:13430,PREL

      182    13425    5                   CASE(%KL_ASYNC_SSNMAX);

      183    13426    5                      KV_SSNMAX = KL$CONTROL.VALUE;

  13426   2 00015F  D846 0014                            LDR,R5   20,B6
          2 000161  DF00 0000 0000  xsym                 STR,R5   KV_SSNMAX
          2 000164  0F81 00C2                            B        s:13464,PREL

      184    13427    5                   CASE(%KL_HNDLRPARM_TYPAHDBFRLMT);

      185    13428    5                      KV_TYPAHDBFRLMT = KL$CONTROL.VALUE;

  13428   2 000166  D846 0014                            LDR,R5   20,B6
          2 000168  DF00 0000 0000  xsym                 STR,R5   KV_TYPAHDBFRLMT
          2 00016B  0F81 00BB                            B        s:13464,PREL

      186    13429    5                   CASE (%KL_HNDLRPARM_IMPTBLMAX);

      187    13430    5                      KV_MAXUFTSIZ = KL$CONTROL.VALUE;

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:34   
  13430   2 00016D  D846 0014                            LDR,R5   20,B6
          2 00016F  DF00 0000 0000  xsym                 STR,R5   KV_MAXUFTSIZ
          2 000172  0F81 00B4                            B        s:13464,PREL

      188    13431    5                   CASE (%KL_HNDLRPARM_ERRSND);

      189    13432    5                      KH_ERRSND = KL$CONTROL.VALUE;

  13432   2 000174  D846 0014                            LDR,R5   20,B6
          2 000176  DF00 0000 0000  xsym                 STR,R5   KH_ERRSND

      190    13433    5                      IF KH$CTLTBL.PARM.PTR$(%KL_HNDLRPARM_ERRSND)~=ADDR(NIL)

  13433   2 000179  DC80 0000 0000  xsym                 LDB,B5   KH_CTLTBL$
          2 00017C  8DC5 0020                            CMN      32,B5
          2 00017E  0901 00A8                            BE       s:13464,PREL

      191    13434    5                      THEN KH$CTLTBL.PARM.PTR$(%KL_HNDLRPARM_ERRSND)->WORDARRAY(0) =
             13434                               KL$CONTROL.VALUE;

  13434   2 000180  CCC5 0020                            LDB,B4   32,B5
          2 000182  DF04                                 STR,R5   ,B4
          2 000183  0F81 00A3                            B        s:13464,PREL

      192    13435    5                   CASE(ELSE);

      193    13436    6                      IF NOT KH$CTLTBL.PARM.FLAGS.INIT_ONLY(KL$CONTROL.PARMX) THEN DO;

  13436   2 000185  B846 0012                            LDR,R3   18,B6
          2 000187  DC80 0000 0000  xsym                 LDB,B5   KH_CTLTBL$
          2 00018A  3F03                                 MLV,R3   3
          2 00018B  3E01                                 ADV,R3   1
          2 00018C  89B5                                 CMZ      ,B5,R3
          2 00018D  0801 0041                            BAL      s:13446,PREL

      194    13437    6                           ADMIN_FPT = '0'B;

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:35   
  13437   2 00018F  5C24                                 LDV,R5   36
          2 000190  0021                                 ALR      ;
          2 000191       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 000193       4007 0019                                ALPHANUM(ADMIN_FPT,AUTO,,R5,FILL)

      195    13438    6                           ADMIN_FPT.CONTROL# = KL$CONTROL.PARMX;

  13438   2 000195  437F                                 CSYNC    s:13437+5,SPREL
          2 000196  C846 0012                            LDR,R4   18,B6
          2 000198  CF47 002A                            STR,R4   ADMIN_FPT+17,AUTO

      196    13439    6                           ADMIN_FPT.FNC = %KHA_FNC_CNTRLCHG;

  13439   2 00019A  3C1E                                 LDV,R3   30
          2 00019B  BF47 0019                            STR,R3   ADMIN_FPT,AUTO

      197    13440    6                           ADMIN_FPT.CTX$ = ADDR(KL$CONTROL);

  13440   2 00019D  EFC7 0022                            STB,B6   ADMIN_FPT+9,AUTO

      198    13441    6                           KL$CONTROL.OVALUE = KH$CTLTBL.PARM.PTR$(KL$CONTROL.PARMX)->
             13441                                    WORDARRAY(KL$CONTROL.INDX);

  13441   2 00019F  A846 0012                            LDR,R2   18,B6
          2 0001A1  2F06                                 MLV,R2   6
          2 0001A2  5C04                                 LDV,R5   4
          2 0001A3  0021                                 ALR      ;
          2 0001A4       4425 0002                                ALPHANUM(2,B5,R2,,4),;
          2 0001A6       4007 002C                                ALPHANUM(ERROR+1,AUTO,,R5,FILL)
          2 0001A8  437F                                 CSYNC    s:13441+8,SPREL
          2 0001A9  CCC7 002C                            LDB,B4   ERROR+1,AUTO
          2 0001AB  A846 0013                            LDR,R2   19,B6
          2 0001AD  9824                                 LDR,R1   ,B4,R2
          2 0001AE  9F46 0015                            STR,R1   21,B6

      199    13442    6                          KH$CTLTBL.PARM.PTR$(KL$CONTROL.PARMX)->WORDARRAY(KL$CONTROL.
             13442                                    INDX) = KL$CONTROL.VALUE;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:36   

  13442   2 0001B0  B846 0012                            LDR,R3   18,B6
          2 0001B2  3F06                                 MLV,R3   6
          2 0001B3  0021                                 ALR      ;
          2 0001B4       4435 0002                                ALPHANUM(2,B5,R3,,4),;
          2 0001B6       4007 002C                                ALPHANUM(ERROR+1,AUTO,,R5,FILL)
          2 0001B8  437F                                 CSYNC    s:13442+7,SPREL
          2 0001B9  CCC7 002C                            LDB,B4   ERROR+1,AUTO
          2 0001BB  B846 0013                            LDR,R3   19,B6
          2 0001BD  C846 0014                            LDR,R4   20,B6
          2 0001BF  CF34                                 STR,R4   ,B4,R3

      200    13443    6                           CALL KH_ADMIN$(ADMIN_FPT);

  13443   2 0001C0  EBC7 0019                            LAB,B6   ADMIN_FPT,AUTO
          2 0001C2  EFC7 002C                            STB,B6   ERROR+1,AUTO
          2 0001C4  BBC7 002C                            LAB,B3   ERROR+1,AUTO
          2 0001C6  9C80 0000 0000  xsym                 LDB,B1   KH_ADMIN$
          2 0001C9  CBF0 0100                            LAB,B4   256,IMO
          2 0001CB  E381                                 LNJ,B6   ,B1
          2 0001CC       0001                            DC       s:13444,PREL

      201    13444    6                         END;              /* IF NOT INIT_ONLY */

  13444   2 0001CD  0F81 0059                            B        s:13464,PREL

      202    13445    6                      ELSE DO;

      203    13446    6                           KL$CONTROL.RESULTS = INIT_ONLY;

  13446   2 0001CF  8C80 0000 0000  01                   LDI      INIT_ONLY
          2 0001D2  8D46 000E                            SDI      14,B6

      204    13447    6                         END;              /* ELSE */

      205    13448    5                   END;                    /* DO CASE PARMX */

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:37   
  13448   2 0001D4  0F81 0052                            B        s:13464,PREL

      206    13449    4                CASE(%KL_CONTROL_DISPLAY);

      207    13450    5                   DO CASE (KL$CONTROL.PARMX);

  13450   2 0001D6  9846 0012                            LDR,R1   18,B6
          2 0001D8  1EFB                                 ADV,R1   -5
          2 0001D9  1D15                                 CMV,R1   21
          2 0001DA  0281 0038                            BGE      s:13460,PREL
          2 0001DC  B810 0000 01E2  02                   LDR,R3   s:13450+12,R1
          2 0001DF  83B0 0000 01F7  02                   JMP      s:13452,R3
          2 0001E2       0007                            DC       s:13454,PREL
          2 0001E3       001C                            DC       s:13460,PREL
          2 0001E4       001C                            DC       s:13460,PREL
          2 0001E5       001C                            DC       s:13460,PREL
          2 0001E6       001C                            DC       s:13460,PREL
          2 0001E7       0015                            DC       s:13458,PREL
          2 0001E8       001C                            DC       s:13460,PREL
          2 0001E9       001C                            DC       s:13460,PREL
          2 0001EA       001C                            DC       s:13460,PREL
          2 0001EB       001C                            DC       s:13460,PREL
          2 0001EC       001C                            DC       s:13460,PREL
          2 0001ED       001C                            DC       s:13460,PREL
          2 0001EE       001C                            DC       s:13460,PREL
          2 0001EF       001C                            DC       s:13460,PREL
          2 0001F0       001C                            DC       s:13460,PREL
          2 0001F1       001C                            DC       s:13460,PREL
          2 0001F2       001C                            DC       s:13460,PREL
          2 0001F3       001C                            DC       s:13460,PREL
          2 0001F4       001C                            DC       s:13460,PREL
          2 0001F5       0000                            DC       s:13452,PREL
          2 0001F6       000E                            DC       s:13456,PREL

      208    13451    5                   CASE(%KL_ASYNC_SSNMAX);

      209    13452    5                      KL$CONTROL.VALUE = KV_SSNMAX;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:38   

  13452   2 0001F7  D800 0000 0000  xsym                 LDR,R5   KV_SSNMAX
          2 0001FA  DF46 0014                            STR,R5   20,B6
          2 0001FC  0F81 002A                            B        s:13464,PREL

      210    13453    5                   CASE(%KL_HNDLRPARM_TYPAHDBFRLMT);

      211    13454    5                      KL$CONTROL.VALUE = KV_TYPAHDBFRLMT;

  13454   2 0001FE  D800 0000 0000  xsym                 LDR,R5   KV_TYPAHDBFRLMT
          2 000201  DF46 0014                            STR,R5   20,B6
          2 000203  0F81 0023                            B        s:13464,PREL

      212    13455    5                   CASE (%KL_HNDLRPARM_IMPTBLMAX);

      213    13456    5                      KL$CONTROL.VALUE = KV_MAXUFTSIZ;

  13456   2 000205  D800 0000 0000  xsym                 LDR,R5   KV_MAXUFTSIZ
          2 000208  DF46 0014                            STR,R5   20,B6
          2 00020A  0F81 001C                            B        s:13464,PREL

      214    13457    5                   CASE (%KL_HNDLRPARM_ERRSND);

      215    13458    5                      KL$CONTROL.VALUE = KH_ERRSND;

  13458   2 00020C  D800 0000 0000  xsym                 LDR,R5   KH_ERRSND
          2 00020F  DF46 0014                            STR,R5   20,B6
          2 000211  0F81 0015                            B        s:13464,PREL

      216    13459    5                   CASE (ELSE);

      217    13460    5                      KL$CONTROL.VALUE = KH$CTLTBL.PARM.PTR$(KL$CONTROL.PARMX)->
             13460                               WORDARRAY(KL$CONTROL.INDX);

  13460   2 000213  B846 0012                            LDR,R3   18,B6
          2 000215  DC80 0000 0000  xsym                 LDB,B5   KH_CTLTBL$
          2 000218  3F06                                 MLV,R3   6
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:39   
          2 000219  5C04                                 LDV,R5   4
          2 00021A  0021                                 ALR      ;
          2 00021B       4435 0002                                ALPHANUM(2,B5,R3,,4),;
          2 00021D       4007 002C                                ALPHANUM(ERROR+1,AUTO,,R5,FILL)
          2 00021F  437F                                 CSYNC    s:13460+11,SPREL
          2 000220  CCC7 002C                            LDB,B4   ERROR+1,AUTO
          2 000222  B846 0013                            LDR,R3   19,B6
          2 000224  C834                                 LDR,R4   ,B4,R3
          2 000225  CF46 0014                            STR,R4   20,B6

      218    13461    5                   END;                    /* DO CASE PARMX */

      219    13462    4                END;                       /* DO CASE(CMD) */

      220    13463    3              END;                         /* ELSE */

      221    13464    2           KHA_WRITE.BUF_ = VECTOR(KL$CONTROL);

  13464   2 000227  EC80 0000 0002  00                   LDB,B6   KH_BUF$
          2 00022A  EFC7 002D                            STB,B6   ERROR+2,AUTO
          2 00022C  6C2B                                 LDV,R6   43
          2 00022D  EF47 002C                            STR,R6   ERROR+1,AUTO
          2 00022F  ABC7 002C                            LAB,B2   ERROR+1,AUTO
          2 000231  2C00                                 LDV,R2   0
          2 000232  6C06                                 LDV,R6   6
          2 000233  BB80 0000 0000  00                   LAB,B3   DEEP
          2 000236  3C14                                 LDV,R3   20
          2 000237  0008                                 MMM

      222    13465    2           IF KH_FLDWRTS > 0 THEN

  13465   2 000238  E800 0000 0000  xsym                 LDR,R6   KH_FLDWRTS
          2 00023B  6A81 000C                            BLEZ,R6  s:13469,PREL

      223    13466    2                CALL KHA$SETCLK(KHA_WRITE);

  13466   2 00023D  BB80 0000 0002  03                   LAB,B3   +2
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:40   
          2 000240  CBF0 0100                            LAB,B4   256,IMO
          2 000242  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 000245       0001                            DC       s:13466+9,PREL
          2 000246  0F81 015C                            B        s:13517,PREL

      224    13467    2           ELSE
      225    13468    3           DO;

      226    13469    3                CALL M$WRITE(KHA_WRITE) WHENALTRETURN

  13469   2 000248  BB80 0000 0004  00                   LAB,B3   KHA_WRITE
          2 00024B  B870 1543                            LDR,R3   5443,IMO
          2 00024D  0001                                 MCL
          2 00024E       0003                            DC       s:13471,PREL
          2 00024F  0F81 000A                            B        s:13473,PREL

      227    13470    4                DO;

      228    13471    4                     CALL KHA$SETCLK(KHA_WRITE);

  13471   2 000251  BB80 0000 0002  03                   LAB,B3   +2
          2 000254  CBF0 0100                            LAB,B4   256,IMO
          2 000256  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 000259       0001                            DC       s:13473,PREL

      229    13472    4                   END;

      230    13473    3              END;

  13473   2 00025A  0F81 0148                            B        s:13517,PREL

      231    13474    2        CASE(IGA_CNFG_MSG);

      232    13475    2           TERMLO = KL$CNFG.TERMID_LO;

  13475   2 00025C  AB86                                 LAB,B2   ,B6
          2 00025D  2C22                                 LDV,R2   34
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:41   
          2 00025E  6C10                                 LDV,R6   16
          2 00025F  BB87                                 LAB,B3   ,AUTO
          2 000260  3C12                                 LDV,R3   18
          2 000261  0008                                 MMM

      233    13476    2           TERMHI = KL$CNFG.TERMID_HI;

  13476   2 000262  AC80 0000 0002  00                   LDB,B2   KH_BUF$
          2 000265  2C32                                 LDV,R2   50
          2 000266  6C10                                 LDV,R6   16
          2 000267  BB87                                 LAB,B3   ,AUTO
          2 000268  3C22                                 LDV,R3   34
          2 000269  0008                                 MMM

      234    13477    2           CALL KHA$DVCADM_RNG(%KHA_FNC_CNFG,KL$CNFG.RESULTS,TERMLO,TERMHI,VECTOR(
             13477                    KL$CNFG.KHA));

  13477   2 00026A  DC80 0000 0002  00                   LDB,B5   KH_BUF$
          2 00026D  CBC5 0021                            LAB,B4   33,B5
          2 00026F  CFC7 002D                            STB,B4   ERROR+2,AUTO
          2 000271  6C11                                 LDV,R6   17
          2 000272  EF47 002C                            STR,R6   ERROR+1,AUTO
          2 000274  ABF0 0011                            LAB,B2   17,IMO
          2 000276  9BC7 002C                            LAB,B1   ERROR+1,AUTO
          2 000278  9FC7 0037                            STB,B1   ERROR+12,AUTO
          2 00027A  EBC7 0011                            LAB,B6   TERMHI,AUTO
          2 00027C  EFC7 0035                            STB,B6   ERROR+10,AUTO
          2 00027E  EBC7 0009                            LAB,B6   TERMLO,AUTO
          2 000280  EFC7 0033                            STB,B6   ERROR+8,AUTO
          2 000282  EBC5 000E                            LAB,B6   14,B5
          2 000284  EFC7 0031                            STB,B6   ERROR+6,AUTO
          2 000286  AFC7 002F                            STB,B2   ERROR+4,AUTO
          2 000288  BBC7 002F                            LAB,B3   ERROR+4,AUTO
          2 00028A  CBF0 0500                            LAB,B4   1280,IMO
          2 00028C  E380 0000 0000  xent                 LNJ,B6   KHA$DVCADM_RNG
          2 00028F       0001                            DC       s:13478,PREL

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:42   
      235    13478    2           KHA_WRITE.BUF_ = VECTOR(KL$HDR);

  13478   2 000290  EC80 0000 0002  00                   LDB,B6   KH_BUF$
          2 000293  EFC7 002D                            STB,B6   ERROR+2,AUTO
          2 000295  6C21                                 LDV,R6   33
          2 000296  EF47 002C                            STR,R6   ERROR+1,AUTO
          2 000298  ABC7 002C                            LAB,B2   ERROR+1,AUTO
          2 00029A  2C00                                 LDV,R2   0
          2 00029B  6C06                                 LDV,R6   6
          2 00029C  BB80 0000 0000  00                   LAB,B3   DEEP
          2 00029F  3C14                                 LDV,R3   20
          2 0002A0  0008                                 MMM

      236    13479    2           IF KH_FLDWRTS > 0 THEN

  13479   2 0002A1  E800 0000 0000  xsym                 LDR,R6   KH_FLDWRTS
          2 0002A4  6A81 000C                            BLEZ,R6  s:13483,PREL

      237    13480    2                CALL KHA$SETCLK(KHA_WRITE);

  13480   2 0002A6  BB80 0000 0002  03                   LAB,B3   +2
          2 0002A9  CBF0 0100                            LAB,B4   256,IMO
          2 0002AB  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 0002AE       0001                            DC       s:13480+9,PREL
          2 0002AF  0F81 00F3                            B        s:13517,PREL

      238    13481    2           ELSE
      239    13482    3           DO;

      240    13483    3                CALL M$WRITE(KHA_WRITE) WHENALTRETURN

  13483   2 0002B1  BB80 0000 0004  00                   LAB,B3   KHA_WRITE
          2 0002B4  B870 1543                            LDR,R3   5443,IMO
          2 0002B6  0001                                 MCL
          2 0002B7       0003                            DC       s:13485,PREL
          2 0002B8  0F81 000A                            B        s:13487,PREL

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:43   
      241    13484    4                DO;

      242    13485    4                     CALL KHA$SETCLK(KHA_WRITE);

  13485   2 0002BA  BB80 0000 0002  03                   LAB,B3   +2
          2 0002BD  CBF0 0100                            LAB,B4   256,IMO
          2 0002BF  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 0002C2       0001                            DC       s:13487,PREL

      243    13486    4                   END;

      244    13487    3              END;

  13487   2 0002C3  0F81 00DF                            B        s:13517,PREL

      245    13488    2        CASE(IGA_CHNRSP);

      246    13489    3           IF KL$CHNRSP.LINE_PROFILE THEN DO;

  13489   2 0002C5  8286                                 LB,'0080'X        ,B6
  13489   2 0002C6       0080
          2 0002C7  0581 00DB                            BBF      s:13517,PREL

      247    13490    4                IF KL$CHNRSP.NAK THEN DO;

  13490   2 0002C9  8286                                 LB,'0010'X        ,B6
  13490   2 0002CA       0010
          2 0002CB  0581 001D                            BBF      s:13495,PREL

      248    13491    4                     TERMLO = KL$CHNRSP.TERMINAL_ID;

  13491   2 0002CD  AB86                                 LAB,B2   ,B6
          2 0002CE  2C0A                                 LDV,R2   10
          2 0002CF  6C10                                 LDV,R6   16
          2 0002D0  BB87                                 LAB,B3   ,AUTO
          2 0002D1  3C12                                 LDV,R3   18
          2 0002D2  0008                                 MMM
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:44   

      249    13492    4                     CALL KHA$DVCADM(%KHA_FNC_SGNRJC,ERROR,TERMLO);

  13492   2 0002D3  DBF0 0015                            LAB,B5   21,IMO
          2 0002D5  CBC7 0009                            LAB,B4   TERMLO,AUTO
          2 0002D7  CFC7 0030                            STB,B4   ERROR+5,AUTO
          2 0002D9  9BC7 002B                            LAB,B1   ERROR,AUTO
          2 0002DB  9FC7 002E                            STB,B1   ERROR+3,AUTO
          2 0002DD  DFC7 002C                            STB,B5   ERROR+1,AUTO
          2 0002DF  BBC7 002C                            LAB,B3   ERROR+1,AUTO
          2 0002E1  CBF0 0300                            LAB,B4   768,IMO
          2 0002E3  E380 0000 0000  xent                 LNJ,B6   KHA$DVCADM
          2 0002E6       0001                            DC       s:13493,PREL

      250    13493    4                   END;                    /* IF NAK */

  13493   2 0002E7  0F81 00BB                            B        s:13517,PREL

      251    13494    4                ELSE DO;

      252    13495    4                     TERMLO = KL$CHNRSP.TERMINAL_ID;

  13495   2 0002E9  AB86                                 LAB,B2   ,B6
          2 0002EA  2C0A                                 LDV,R2   10
          2 0002EB  6C10                                 LDV,R6   16
          2 0002EC  BB87                                 LAB,B3   ,AUTO
          2 0002ED  3C12                                 LDV,R3   18
          2 0002EE  0008                                 MMM

      253    13496    4                    CALL KHA$DVCADM(%KHA_FNC_BLDLINPRO,ERROR,TERMLO,,VECTOR(KL$CHNRSP.
             13496                              MESSAGE.MESSAGE));

  13496   2 0002EF  DC80 0000 0002  00                   LDB,B5   KH_BUF$
          2 0002F2  CBC5 001B                            LAB,B4   27,B5
          2 0002F4  CFC7 002D                            STB,B4   ERROR+2,AUTO
          2 0002F6  E870 00FE                            LDR,R6   254,IMO
          2 0002F8  EF47 002C                            STR,R6   ERROR+1,AUTO
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:45   
          2 0002FA  9BF0 0013                            LAB,B1   19,IMO
          2 0002FC  EBC7 002C                            LAB,B6   ERROR+1,AUTO
          2 0002FE  EFC7 0037                            STB,B6   ERROR+12,AUTO
          2 000300  AB80 0000 0000                       LAB,B2   0
          2 000303  AFC7 0035                            STB,B2   ERROR+10,AUTO
          2 000305  EBC7 0009                            LAB,B6   TERMLO,AUTO
          2 000307  EFC7 0033                            STB,B6   ERROR+8,AUTO
          2 000309  EBC7 002B                            LAB,B6   ERROR,AUTO
          2 00030B  EFC7 0031                            STB,B6   ERROR+6,AUTO
          2 00030D  9FC7 002F                            STB,B1   ERROR+4,AUTO
          2 00030F  BBC7 002F                            LAB,B3   ERROR+4,AUTO
          2 000311  CBF0 0500                            LAB,B4   1280,IMO
          2 000313  E380 0000 0000  xent                 LNJ,B6   KHA$DVCADM
          2 000316       0001                            DC       s:13498,PREL

      254    13497    4                   END;                    /* ELSE */

      255    13498    3              END;                         /* IF EXTCHNRSP.LINE_PROFILE */

  13498   2 000317  0F81 008B                            B        s:13517,PREL

      256    13499    2        CASE(IGA_DVCERRRSP);

      257    13500    2           TERMLO = KL$DVCERRRSP.TERMID;

  13500   2 000319  AB86                                 LAB,B2   ,B6
          2 00031A  2C04                                 LDV,R2   4
          2 00031B  6C10                                 LDV,R6   16
          2 00031C  BB87                                 LAB,B3   ,AUTO
          2 00031D  3C12                                 LDV,R3   18
          2 00031E  0008                                 MMM

      258    13501    2          CALL KHA$DVCADM(%KHA_FNC_DVCERRRSP,ERROR,TERMLO,,VECTOR(KL$DVCERRRSP.KYN#));

  13501   2 00031F  DC80 0000 0002  00                   LDB,B5   KH_BUF$
          2 000322  CBC5 0001                            LAB,B4   1,B5
          2 000324  CFC7 002D                            STB,B4   ERROR+2,AUTO
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:46   
          2 000326  6C01                                 LDV,R6   1
          2 000327  EF47 002C                            STR,R6   ERROR+1,AUTO
          2 000329  9BF0 0018                            LAB,B1   24,IMO
          2 00032B  EBC7 002C                            LAB,B6   ERROR+1,AUTO
          2 00032D  EFC7 0037                            STB,B6   ERROR+12,AUTO
          2 00032F  AB80 0000 0000                       LAB,B2   0
          2 000332  AFC7 0035                            STB,B2   ERROR+10,AUTO
          2 000334  EBC7 0009                            LAB,B6   TERMLO,AUTO
          2 000336  EFC7 0033                            STB,B6   ERROR+8,AUTO
          2 000338  EBC7 002B                            LAB,B6   ERROR,AUTO
          2 00033A  EFC7 0031                            STB,B6   ERROR+6,AUTO
          2 00033C  9FC7 002F                            STB,B1   ERROR+4,AUTO
          2 00033E  BBC7 002F                            LAB,B3   ERROR+4,AUTO
          2 000340  CBF0 0500                            LAB,B4   1280,IMO
          2 000342  E380 0000 0000  xent                 LNJ,B6   KHA$DVCADM
          2 000345       0001                            DC       s:13501+39,PREL
          2 000346  0F81 005C                            B        s:13517,PREL

      259    13502
      260    13503    2        CASE (IGA_PRFRSP);

      261    13504    2           SIZE = (KL$PRFRSP.PROFILE.PRFSIZE + 1) / 2;

  13504   2 000348  E846 0003                            LDR,R6   3,B6
          2 00034A  6E01                                 ADV,R6   1
          2 00034B  6041                                 SOR,R6   1
          2 00034C  EF47 0006                            STR,R6   SIZE,AUTO

      262    13505    2           CALL KVB$GETSYS (SIZE,VBASE(KH_PROFILE_));

  13505   2 00034E  DB80 0000 0001  xsym                 LAB,B5   KH_PROFILE_+1
          2 000351  DFC7 002E                            STB,B5   ERROR+3,AUTO
          2 000353  CBC7 0006                            LAB,B4   SIZE,AUTO
          2 000355  CFC7 002C                            STB,B4   ERROR+1,AUTO
          2 000357  BBC7 002C                            LAB,B3   ERROR+1,AUTO
          2 000359  CBF0 0200                            LAB,B4   512,IMO
          2 00035B  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:47   
          2 00035E       0001                            DC       s:13506,PREL

      263    13506    2           SIZE = SIZE * 2;

  13506   2 00035F  E847 0006                            LDR,R6   SIZE,AUTO
          2 000361  6001                                 SOL,R6   1
          2 000362  EF47 0006                            STR,R6   SIZE,AUTO

      264    13507    2           VBOUND(KH_PROFILE_) = KL$PRFRSP.PROFILE.PRFSIZE - 1;

  13507   2 000364  EC80 0000 0002  00                   LDB,B6   KH_BUF$
          2 000367  D846 0003                            LDR,R5   3,B6
          2 000369  5EFF                                 ADV,R5   -1
          2 00036A  DF00 0000 0000  xsym                 STR,R5   KH_PROFILE_

      265    13508    2           VBASE(KH_PROFILE_)->PROTXT = KL$PRFRSP.PROFILE.PRFTXT;

  13508   2 00036D  8C80 0000 0001  xsym                 LDI      KH_PROFILE_+1
          2 000370  B856                                 LDR,R3   R6
          2 000371  E570 7FFF                            AND,R6   32767,IMO
          2 000373  8D47 002C                            SDI      ERROR+1,AUTO
          2 000375  DCC7 002C                            LDB,B5   ERROR+1,AUTO
          2 000377  304F                                 SOR,R3   15
          2 000378  BF47 002E                            STR,R3   ERROR+3,AUTO
          2 00037A  DFC7 002F                            STB,B5   ERROR+4,AUTO
          2 00037C  AB86                                 LAB,B2   ,B6
          2 00037D  2C08                                 LDV,R2   8
          2 00037E  E870 0200                            LDR,R6   512,IMO
          2 000380  BB85                                 LAB,B3   ,B5
          2 000381  F847 0006                            LDR,R7   SIZE,AUTO
          2 000383  D380 0000 0000  xent                 LNJ,B5   X6C_ALR
          2 000386  0F81 001C                            B        s:13517,PREL

      266    13509
      267    13510    2        CASE(IGA_REQSTATS);

      268    13511    2           ADMIN_FPT = '0'B;
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:48   

  13511   2 000388  5C24                                 LDV,R5   36
          2 000389  0021                                 ALR      ;
          2 00038A       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 00038C       4007 0019                                ALPHANUM(ADMIN_FPT,AUTO,,R5,FILL)

      269    13512    2           ADMIN_FPT.CTX$ = ADDR(KL$REQSTATS);

  13512   2 00038E  437F                                 CSYNC    s:13511+5,SPREL
          2 00038F  EFC7 0022                            STB,B6   ADMIN_FPT+9,AUTO

      270    13513    2           ADMIN_FPT.FNC = %KHA_FNC_REQSTATS;

  13513   2 000391  6C04                                 LDV,R6   4
          2 000392  EF47 0019                            STR,R6   ADMIN_FPT,AUTO

      271    13514    3           CALL KH_ADMIN$(ADMIN_FPT) WHENALTRETURN DO;

  13514   2 000394  DBC7 0019                            LAB,B5   ADMIN_FPT,AUTO
          2 000396  DFC7 002C                            STB,B5   ERROR+1,AUTO
          2 000398  BBC7 002C                            LAB,B3   ERROR+1,AUTO
          2 00039A  9C80 0000 0000  xsym                 LDB,B1   KH_ADMIN$
          2 00039D  CBF0 0100                            LAB,B4   256,IMO
          2 00039F  E381                                 LNJ,B6   ,B1
          2 0003A0       0003                            DC       s:13517,PREL
          2 0003A1  0F81 0001                            B        s:13517,PREL

      272    13515                      /*N* ??????*/
      273    13516    3              END;                         /* WHENALTRETURN */

      274    13517    2        END;                               /* DO CASE(KL$MES.CODE) */

  13514   2                              RET             null
      275    13518
      276    13519    1   RET: ;
      277    13520             %ENABLE;

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:49   
  13521   2 0003A3  E847 0005            RET             LDR,R6   DISABLE_LEVEL,AUTO
          2 0003A5  E947 0004                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 0003A7  0901 0007                            BE       s:13524,PREL

  13523   2 0003A9  CBF0 0000                            LAB,B4   0,IMO
          2 0003AB  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0003AE       0001                            DC       s:13524,PREL

  13521   2                              DO_READ         null
      278    13526    1   DO_READ: ;
      279    13527    1        IF DEEP = 1 THEN

  13527   2 0003AF  E800 0000 0000  00   DO_READ         LDR,R6   DEEP
          2 0003B2  6D01                                 CMV,R6   1
          2 0003B3  0981 0019                            BNE      s:13541,PREL

      280    13528    2        DO;

      281    13529    3             DO WHILE (NEED2READ ~= 0);

  13529   2 0003B5  D800 0000 0001  00                   LDR,R5   NEED2READ
          2 0003B8  5901 0014                            BEZ,R5   s:13541,PREL

      282    13530    3                  NEED2READ = 0;

  13530   2 0003BA  8700 0000 0001  00                   CL       NEED2READ

      283    13531        /*             CALL M$READ(KHA_READ) WHENALTRETURN DO; */
      284    13532        /*
      285    13533         *               let kha$rdclk call m$read to avoid the lost
      286    13534         *               read problem bisync runs into.
      287    13535         */
      288    13536    4                  CALL KHA$RDCLK WHENALTRETURN DO;

  13536   2 0003BD  CBF0 0000                            LAB,B4   0,IMO
          2 0003BF  E380 0000 0000  xent                 LNJ,B6   KHA$RDCLK
          2 0003C2       0003                            DC       s:13537,PREL
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:50   
          2 0003C3  0F81 0005                            B        s:13539,PREL

      289    13537    4                       CALL M$XXX;

  13537   2 0003C5  B870 0082                            LDR,R3   130,IMO
          2 0003C7  0001                                 MCL
          2 0003C8       0000                            DC       s:13537+3,PREL

      290    13538    4                     END;

      291    13539    3                END;

  13539   2 0003C9  E800 0000 0001  00                   LDR,R6   NEED2READ
          2 0003CC  69EE                                 BNEZ,R6  s:13530,SPREL

      292    13540    2           END;

      293    13541    1        DEEP = DEEP - 1;

  13541   2 0003CD  8880 0000 0000  00                   DEC      DEEP

      294    13542    1        RETURN;

  13542   2 0003D0  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      295    13543    1   END KHA$ADMIN;
      296    13544        %EOD;

PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:51   
--  Include file information  --

   K_ID_E.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KHA$ADMIN.
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:52   

 **** Variables and constants ****

  ****  Section 000  Data  KHA$ADMIN

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 DEEP                      16-0-0/w STRC(288)   r     1 KHA_READ
     4-0-0/w STRC(288)   r     1 KHA_WRITE                  2-0-0/w PTR         r     1 KH_BUF$
     1-0-0/w UBIN(16)    r     1 NEED2READ

  ****  Section 001 RoData KHA$ADMIN

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(32)    r     1 INIT_ONLY                  4-0-0/w STRC(128)   r     1 KHA_GET5
     2-0-0/w STRC(32)    r     1 UNDEF

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    19-0-0/w STRC(288)   r     1 ADMIN_FPT                  7-0-0/w PTR         r     1 CHAN$
     5-0-0/w UBIN(16)    r     1 DISABLE_LEVEL             2B-0-0/w UBIN(16)    r     1 ERROR
     4-0-0/w UBIN(16)    r     1 INHIBIT_LEVEL              6-0-0/w UBIN(16)    r     1 SIZE
    11-0-0/w STRC(128)   r     1 TERMHI                     9-0-0/w STRC(128)   r     1 TERMLO

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$TCB$                     0-0-0/w STRC(48)    r     1 KHA_BUFSEG
     0-0-0/w EPTR        r     1 KH_ADMIN$                  0-0-0/w PTR         r     1 KH_CTLTBL$
     0-0-0/w UBIN(16)    r     1 KH_ERRSND                  0-0-0/w SBIN(16)    r     1 KH_FLDWRTS
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:53   
     0-0-0/w UBIN(16)    r     1 KH_INHLVL                  0-0-0/w VECT        r     1 KH_PROFILE_
     0-0-0/w EPTR        r     1 KH_WLCLKENT$               0-0-0/w UBIN(16)    r     1 KV_MAXUFTSIZ
     0-0-0/w UBIN(16)    r     1 KV_SSNMAX                  0-0-0/w UBIN(16)    r     1 KV_TYPAHDBFRLMT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(736)   r     1 G$EXCFR                    0-0-0/w STRC(976)   r     1 G$NWIO
     0-0-0/w STRC(96)    r     1 G$TCB                      0-0-0/w STRC(64)    r     1 KH$CTLTBL
     0-0-0/w STRC(544)   r     1 KL$ADMIN                   0-0-0/w STRC(2472)  r     1 KL$CHNRSP
     0-0-0/w STRC(736)   r     1 KL$CNFG                    0-0-0/w STRC(352)   r     1 KL$CONTROL
     0-0-0/w STRC(160)   r     1 KL$DVCERRRSP               0-0-0/w STRC(272)   r     1 KL$HDR
     0-0-0/w STRC(16)    r     1 KL$MES                     0-0-0/w STRC(4160)  r     1 KL$PRFRSP
     0-0-0/w STRC(320)   r     1 KL$REQSTATS                0-0-0/c ACHR        r     1 PROTXT
     0-0-0/w UBIN(16)    r     1 WORDARRAY(0:0)


   Procedure KHA$ADMIN requires 979 words for executable code.
   Procedure KHA$ADMIN requires 57 words of local(AUTO) storage.
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:54   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:55   
          MINI XREF LISTING

ADMIN_FPT
     12779**DCL     13437<<ASSIGN  13443<>CALL    13511<<ASSIGN  13514<>CALL
ADMIN_FPT.CONTROL#
     12965**DCL     13438<<ASSIGN
ADMIN_FPT.CTX$
     12835**DCL     13440<<ASSIGN  13512<<ASSIGN
ADMIN_FPT.FNC
     12780**DCL     13439<<ASSIGN  13513<<ASSIGN
ADMIN_FPT.TERMID.TERM
     12803**DCL     12812--REDEF
CHAN$
     11242**DCL     11936--IMP-PTR
CHN.TERMID.TERM
     12032**DCL     12041--REDEF
DEEP
     11238**DCL     13377<<ASSIGN  13377>>ASSIGN  13527>>IF      13541<<ASSIGN  13541>>ASSIGN
DISABLE_LEVEL
     10400**DCL     13393<<ASSIGN  13394<>CALL    13521>>IF
ERROR
     13269**DCL     13492<>CALL    13496<>CALL    13501<>CALL
G$EXCFR.P$$
     10910**DCL     10910--REDEF   10910--REDEF
G$EXCFR.PREVSZ
     10860**DCL     10860--REDEF
G$EXCFR.TRLR.ERR.ERR#
     11217**DCL     13368>>IF
G$EXCFR.TRLR.EVID
     11147**DCL     11165--REDEF   11173--REDEF   11173--REDEF
G$EXCFR.TRLR.SUBC
     11124**DCL     11124--REDEF   11142--REDEF   11146--REDEF   11146--REDEF   13371>>IF
G$NWIO.P$$
     10502**DCL     10502--REDEF   10502--REDEF
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:56   
G$NWIO.PREVSZ
     10452**DCL     10452--REDEF
G$NWIO.TRLR.ERR.ERR#
     10809**DCL     13379>>IF
G$NWIO.TRLR.EVID
     10739**DCL     10757--REDEF   10765--REDEF   10765--REDEF
G$NWIO.TRLR.SUBC
     10716**DCL     10716--REDEF   10734--REDEF   10738--REDEF   10738--REDEF
G$TCB.ALT$
     10428**DCL     13368>>IF
G$TCB.STK$
     10428**DCL     13371>>IF      13379>>IF
G$TCB$
     11224**DCL     13368>>IF      13371>>IF      13379>>IF
INHIBIT_LEVEL
     10397**DCL     13391<<ASSIGN  13393>>ASSIGN  13521>>IF
INIT_ONLY
     12140**DCL     13446>>ASSIGN
KH$CTLTBL.HIPARAM
     12570**DCL     13412>>IF
KH$CTLTBL.PARM.FLAGS.INIT_ONLY
     12619**DCL     13436>>IF
KH$CTLTBL.PARM.PTR$
     12695**DCL     13412>>IF      13433>>IF      13434>>ASSIGN  13441>>ASSIGN  13442>>ASSIGN  13460>>ASSIGN
KHA$DVCADM
     10404**DCL-ENT 13492--CALL    13496--CALL    13501--CALL
KHA$DVCADM_RNG
     10403**DCL-ENT 13400--CALL    13477--CALL
KHA$RDCLK
     10405**DCL-ENT 13536--CALL
KHA$SETCLK
     10406**DCL-ENT 13403--CALL    13408--CALL    13466--CALL    13471--CALL    13480--CALL    13485--CALL
KHA_BUFSEG
     13359**DCL     13337--DCLINIT
KHA_BUFSEG.BASE
     13363**DCL     13363--REDEF
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:57   
KHA_GET5
     13334**DCL     13381<>CALL
KHA_GET5.V
     13337**DCL     13337--DCLINIT
KHA_READ.BUF_
     13310**DCL     13385<<ASSIGN  13385>>ASSIGN
KHA_READ.V
     13313**DCL     13310--DCLINIT
KHA_WRITE
     13284**DCL     13403<>CALL    13406<>CALL    13408<>CALL    13466<>CALL    13469<>CALL    13471<>CALL
     13480<>CALL    13483<>CALL    13485<>CALL
KHA_WRITE.BUF_
     13286**DCL     13401<<ASSIGN  13464<<ASSIGN  13478<<ASSIGN
KHA_WRITE.V
     13289**DCL     13286--DCLINIT
KHI$DISABLE
     10394**DCL-ENT 13394--CALL
KHI$ENABLE
     10393**DCL-ENT 13523--CALL
KH_ADMIN$
     11228**DCL     13443>>CALL    13514>>CALL
KH_BUF$
     11261**DCL     11279--IMP-PTR 11317--IMP-PTR 11455--IMP-PTR 11615--IMP-PTR 11883--IMP-PTR 12061--IMP-PTR
     12297--IMP-PTR 12517--IMP-PTR 13127--IMP-PTR 13396>>DOCASE  13398>>ASSIGN  13399>>ASSIGN  13400>>CALL
     13400>>CALL    13401>>ASSIGN  13412>>IF      13412>>IF      13412>>IF      13412>>IF      13412>>IF
     13412>>IF      13418>>ASSIGN  13421>>ASSIGN  13422>>DOCASE  13424>>DOCASE  13426>>ASSIGN  13428>>ASSIGN
     13430>>ASSIGN  13432>>ASSIGN  13434>>ASSIGN  13436>>IF      13438>>ASSIGN  13440>>ASSIGN  13441>>ASSIGN
     13441>>ASSIGN  13441>>ASSIGN  13442>>ASSIGN  13442>>ASSIGN  13442>>ASSIGN  13446>>ASSIGN  13450>>DOCASE
     13452>>ASSIGN  13454>>ASSIGN  13456>>ASSIGN  13458>>ASSIGN  13460>>ASSIGN  13460>>ASSIGN  13460>>ASSIGN
     13464>>ASSIGN  13475>>ASSIGN  13476>>ASSIGN  13477>>CALL    13477>>CALL    13478>>ASSIGN  13489>>IF
     13490>>IF      13491>>ASSIGN  13495>>ASSIGN  13496>>CALL    13500>>ASSIGN  13501>>CALL    13504>>ASSIGN
     13507>>ASSIGN  13508>>ASSIGN  13512>>ASSIGN
KH_CHNHI
     11256**DCL     11257--REDEF
KH_CHNLOW
     11257**DCL     11258--REDEF
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:58   
KH_CTLTBL$
     11225**DCL     12569--IMP-PTR 13412>>IF      13412>>IF      13433>>IF      13434>>ASSIGN  13436>>IF
     13441>>ASSIGN  13442>>ASSIGN  13460>>ASSIGN
KH_ERRSND
     11234**DCL     13432<<ASSIGN  13458>>ASSIGN
KH_FLDWRTS
     11233**DCL     13402>>IF      13465>>IF      13479>>IF
KH_INHLVL
     11229**DCL     13391>>ASSIGN
KH_PROFILE_
     11258**DCL     13505<>CALL    13507<<ASSIGN  13508>>ASSIGN
KH_WLCLKENT$
     11235**DCL     13373>>IF      13374>>CALL
KL$ADMIN
     11455**DCL     13401--ASSIGN
KL$ADMIN.FNC
     11521**DCL     13400<>CALL
KL$ADMIN.RESULTS
     11484**DCL     13400<>CALL
KL$ADMIN.TERMID_HI
     11570**DCL     13399>>ASSIGN
KL$ADMIN.TERMID_HI.TERM
     11572**DCL     11581--REDEF
KL$ADMIN.TERMID_LO
     11541**DCL     13398>>ASSIGN
KL$ADMIN.TERMID_LO.TERM
     11543**DCL     11552--REDEF
KL$CHNRSP.LINE_PROFILE
     12304**DCL     13489>>IF
KL$CHNRSP.MESSAGE.MESSAGE
     12498**DCL     13496--CALL
KL$CHNRSP.NAK
     12316**DCL     13490>>IF
KL$CHNRSP.TERMINAL_ID
     12346**DCL     13491>>ASSIGN  13495>>ASSIGN
KL$CHNRSP.TERMINAL_ID.TERM
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:59   
     12348**DCL     12357--REDEF
KL$CNFG.KHA
     11756**DCL     13477--CALL
KL$CNFG.RESULTS
     11644**DCL     13477<>CALL
KL$CNFG.TERMID_HI
     11725**DCL     13476>>ASSIGN
KL$CNFG.TERMID_HI.TERM
     11727**DCL     11736--REDEF
KL$CNFG.TERMID_LO
     11696**DCL     13475>>ASSIGN
KL$CNFG.TERMID_LO.TERM
     11698**DCL     11707--REDEF
KL$CONTROL
     11317**DCL     13440--ASSIGN  13464--ASSIGN
KL$CONTROL.CMD
     11383**DCL     13422>>DOCASE
KL$CONTROL.INDX
     11385**DCL     13441>>ASSIGN  13442>>ASSIGN  13460>>ASSIGN
KL$CONTROL.OVALUE
     11387**DCL     13441<<ASSIGN
KL$CONTROL.PARMX
     11384**DCL     13412>>IF      13412>>IF      13412>>IF      13412>>IF      13412>>IF      13412>>IF
     13424>>DOCASE  13436>>IF      13438>>ASSIGN  13441>>ASSIGN  13442>>ASSIGN  13450>>DOCASE  13460>>ASSIGN
KL$CONTROL.RESULTS
     11346**DCL     13418<<ASSIGN  13446<<ASSIGN
KL$CONTROL.TYPE
     11323**DCL     13421<<ASSIGN
KL$CONTROL.VALUE
     11386**DCL     13426>>ASSIGN  13428>>ASSIGN  13430>>ASSIGN  13432>>ASSIGN  13434>>ASSIGN  13442>>ASSIGN
     13452<<ASSIGN  13454<<ASSIGN  13456<<ASSIGN  13458<<ASSIGN  13460<<ASSIGN
KL$DVCERRRSP.KYN#
     11889**DCL     13501--CALL
KL$DVCERRRSP.TERMID
     11907**DCL     13500>>ASSIGN
KL$DVCERRRSP.TERMID.TERM
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:60   
     11909**DCL     11918--REDEF
KL$HDR
     12061**DCL     13478--ASSIGN
KL$MES.CODE
     11283**DCL     13396>>DOCASE
KL$PRFRSP.PROFILE.PRFSIZE
     12544**DCL     13504>>ASSIGN  13507>>ASSIGN
KL$PRFRSP.PROFILE.PRFTXT
     12548**DCL     13508>>ASSIGN
KL$REQSTATS
     13127**DCL     13512--ASSIGN
KL$REQSTATS.DSPMSK
     13217**DCL     13223--REDEF
KL$REQSTATS.SLCMSK
     13258**DCL     13265--REDEF
KVB$GETSYS
     10407**DCL-ENT 13505--CALL
KV_MAXUFTSIZ
     11232**DCL     13430<<ASSIGN  13456>>ASSIGN
KV_SSNMAX
     11230**DCL     13426<<ASSIGN  13452>>ASSIGN
KV_TYPAHDBFRLMT
     11231**DCL     13428<<ASSIGN  13454>>ASSIGN
M$GDS
      5410**DCL-ENT 13381--CALL
M$WRITE
      5416**DCL-ENT 13406--CALL    13469--CALL    13483--CALL
M$XXX
      5393**DCL-ENT 13383--CALL    13537--CALL
NEED2READ
     11239**DCL     13378<<ASSIGN  13529>>DOWHILE 13530<<ASSIGN
PROTXT
     11241**DCL     13508<<ASSIGN
SIZE
     11240**DCL     11241--IMP-SIZ 13504<<ASSIGN  13505<>CALL    13506<<ASSIGN  13506>>ASSIGN  13508>>ASSIGN
TERMHI
PL6.E3A0      #002=KHA$ADMIN File=KHA$ADMIN.:E05TSI                              WED 07/30/97 00:25 Page:61   
     12267**DCL     13399<<ASSIGN  13400<>CALL    13476<<ASSIGN  13477<>CALL
TERMHI.TERM
     12271**DCL     12280--REDEF
TERMLO
     12238**DCL     13398<<ASSIGN  13400<>CALL    13475<<ASSIGN  13477<>CALL    13491<<ASSIGN  13492<>CALL
     13495<<ASSIGN  13496<>CALL    13500<<ASSIGN  13501<>CALL
TERMLO.TERM
     12242**DCL     12251--REDEF
UNDEF
     12189**DCL     13418>>ASSIGN
WORDARRAY
     11262**DCL     13434<<ASSIGN  13441>>ASSIGN  13442<<ASSIGN  13460>>ASSIGN

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:62   
      297        1        /*T***********************************************************/
      298        2        /*T*                                                         */
      299        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      300        4        /*T*                                                         */
      301        5        /*T***********************************************************/
      302        6        /*P* NAME: KHA$INIT
      303        7
      304        8        PURPOSE:
      305        9        KHA$INIT contains all the routines to handle the initialization
      306       10        of the interface between a handler and the Node Administrator.
      307       11        The following list contains the names of the entry points available:
      308       12
      309       13         KHA$INIT - initialize the path to Node Admin
      310       14         KHA$INIT_CONTROL - get handlers Control parameters
      311       15         KHA$INIT_CHANTBL - acquire resources and build KH$CHN
      312       16         KHA$INIT_DONE - tell Node Admin that handler initialization is complete
      313       17        */
      314       18
      315       19        KHA$INIT: PROC(PARM1,PARM2,PARM3) ALTRET;
      316       20        /* Includes */
      317       21        %INCLUDE G$BOBCAT_M;
      318       41        %INCLUDE GM_VIRTUAL_E;
      319      251        %INCLUDE LCP_6;
      320     4530        %INCLUDE KL_CONTROL_C;
      321     4910        %INCLUDE KL_AFCN_C;
      322     5011        %INCLUDE KL_MACRO_C;
      323     8363        %INCLUDE KH_MACRO_C;
      324     9106        %INCLUDE KH$CHN;
      325     9228        %INCLUDE KHA_FNC_E;
      326     9328        %INCLUDE KHC_MAC_C;
      327     9369        %INHIBIT_DCLS;
      328     9381        %INCLUDE KH_CHN;
      329     9421
      330     9422        /* Parameters */
      331     9423    1   DCL PARM1 UBIN;
      332     9424    1   DCL PARM2 UBIN;
      333     9425    1   DCL PARM3 UBIN;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:63   
      334     9426
      335     9427        /* Local Static */
      336     9428        %KL_ACQUIRE (FPTN=KL_ACQUIRE_CONS,STCLASS=CONSTANT);
      337     9510        %KL_CONTROL_INIT (NUM_FIXED = %KL_FIXED_HI,NUM_INDXD=4,STCLASS="BASED(KH_BUF$)",LAST
              9510            =NO);
      338     9636    1            2 BLOCK(0:15) UBIN WORD,
      339     9637    1            2 UNBLOCK(0:15) UBIN WORD,
      340     9638    1            2 USRPARM1(0:7) UBIN WORD,
      341     9639    1            2 USRPARM2(0:7) UBIN WORD;
      342     9640        %KL_CONTROL_INIT (FPTN=KL_CONTROL_CONS,NUM_FIXED=%KL_FIXED_HI,NUM_INDXD=4,STCLASS=
              9640            CONSTANT,LAST=NO);
      343     9766    1            2 BLOCK(0:15) UBIN WORD,
      344     9767    1            2 UNBLOCK(0:15) UBIN WORD,
      345     9768    1            2 USRPARM1(0:7) UBIN WORD,
      346     9769    1            2 USRPARM2(0:7) UBIN WORD;
      347     9770        %KL_ACQUIRE (STCLASS="BASED(KH_BUF$)");
      348     9852        %KL_INITDONE (STCLASS=CONSTANT);
      349     9891        %KL_CHNRSP (STCLASS="BASED(KH_BUF$)");
      350    10111        %G$BOBCAT (STCLASS="BASED(G$DS4$)");
      351    10124        %KL_HNDCMN_INFO (FPTN=HNDCMN,STCLASS=BASED);
      352    10204        %KH_CHNDAT (STCLASS=SYMREF);
      353    10222    1   DCL KH_ADMIN$ EPTR STATIC SYMDEF;
      354    10223    1   DCL KH_INHLVL UBIN STATIC SYMDEF INIT(63);
      355    10224    1   DCL KH_ERRSND UBIN STATIC SYMDEF INIT(0);
      356    10225    1   DCL KH_CTLTBL$ PTR SYMREF;
      357    10226    1   DCL KH_BUF$ PTR SYMREF;
      358    10227    1   DCL KV_SSNMAX UBIN SYMREF;
      359    10228    1   DCL KV_TYPAHDBFRLMT UBIN SYMREF;
      360    10229    1   DCL KV_MAXUFTSIZ UBIN SYMREF;
      361    10230    1   DCL KH_FLDWRTS SBIN WORD STATIC SYMDEF INIT(0);
      362    10231        /*
      363    10232                write buffers currently queued up.
      364    10233        */
      365    10234
      366    10235        /* Auto */
      367    10236    1   DCL PARM1$ PTR;
      368    10237    1   DCL PARM2$ PTR;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:64   
      369    10238    1   DCL PARM2C$ REDEF PARM2$ CPTR;
      370    10239    1   DCL PARM3$ PTR;
      371    10240    1   DCL CHN$ PTR;
      372    10241    1   DCL SIZE UBIN;
      373    10242    1   DCL I UBIN;
      374    10243        %VLP_ERRCODE (FPTN=ERROR,STCLASS=AUTO);
      375    10289    1   DCL CTRINDX UBIN;
      376    10290    1   DCL LSTCTRINDX UBIN;
      377    10291    1   DCL LSTCHN$ PTR;
      378    10292    1   DCL INDX UBIN;
      379    10293    1   DCL INDXBND UBIN;
      380    10294    1   DCL INDXP# UBIN;
      381    10295    1   DCL INIT_CNTL$ PTR;
      382    10296
      383    10297        /* Based structures */
      384    10298    1   DCL B$VECT VECTOR BASED;
      385    10299        %KL_SYSLOG (FPTN=KL$SYSLOG,STCLASS=AUTO,LAST=",");
      386    10323        %KL_ERRLOG (FPTN=ERRLOG,STCLASS=AUTO,LVL=2,LAST=",");
      387    10431    1                 3 MSG CHAR(200) CALIGNED;
      388    10432    1   DCL ERRMSG CHAR(SIZE) CALIGNED BASED;
      389    10433        %FPT_WRSYSLOG (FPTN=FPT$WRSYSLOG,STCLASS="BASED(PARM1$)");
      390    10528        %KL_REQSTATS (NAME=KL$REQSTATS,STCLASS=BASED);
      391    10822    1   DCL RESOURCE CHAR(2) BASED(PARM1$);     /* Resource type to get */
      392    10823    1   DCL ATTR BIT(16) WALIGNED BASED(PARM2$); /* Attribute to Acquire */
      393    10824                                           /* Entry to the handlers admin routine */
      394    10825    1   DCL ADMIN$ EPTR BASED(PARM2$);          /* for D00 */
      395    10826    1   DCL ONEWORD UBIN BASED;
      396    10827    1   DCL WORDARRAY(0:0) UBIN BASED;
      397    10828        %KH$CHN (STCLASS="BASED(CHN$)");
      398    10952        %KH$CTLTBL (FPTN=KH$CTLTBL,STCLASS="BASED(KH_CTLTBL$)");
      399    11164
      400    11165        /* Symrefs */
      401    11166    1   DCL G$DS4$ PTR SYMREF;
      402    11167
      403    11168        /* FPT's */
      404    11169        %FPT_CVM (FROMSEG=FROMSEG,USERSEG=USERSEG,TYPE=MON,PAGES=256,STCLASS=CONSTANT);
      405    11193        %FPT_GDS (FPTN=KHA_GETBUF,PAGES=1,RESULTS=KHA_BUFSEG,STCLASS="CONSTANT SYMDEF",NEXT=
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:65   
             11193            LITTLE,PARK=NO);
      406    11217        %VLP_SEGMENT (FPTN=FROMSEG);
      407    11238        %VLP_SEGMENT (FPTN=USERSEG);
      408    11259        %VLP_SEGMENT (FPTN=KHA_BUFSEG,STCLASS="STATIC SYMDEF");
      409    11280        %FPT_OPEN (RES='NA',
      410    11281                   ORG=CONSEC,
      411    11282                   STCLASS=CONSTANT);
      412    11310        %FPT_OPEN (FPTN=OPEN,STCLASS=AUTO);
      413    11338        %FPT_WRITE (FPTN=KHA_WRITE,STCLASS=SYMREF);
      414    11362        %FPT_READ (FPTN=KHA_READ,STCLASS=SYMREF);
      415    11388        %FPT_EVENT (EVENT$=KHA$ASYNC,STCLASS=CONSTANT);
      416    11428        %FPT_GETDCB (FPTN=GETDCB,
      417    11429                     DCBNAME=DCB_NA,
      418    11430                     DCBNUM=KH_NA_DCB#,STCLASS=CONSTANT);
      419    11450        %VLP_NAME (FPTN=DCB_NA,
      420    11451                   NAME='M$NA',STCLASS=CONSTANT);
      421    11466    1   DCL KH_NA_DCB# UBIN STATIC SYMDEF INIT(0);
      422    11467    1   DCL KH_NA_EVENT# UBIN STATIC SYMDEF INIT(0);
      423    11468    1   DCL KH_WLCLKENT$ EPTR STATIC SYMDEF INIT(ENTADDR(NIL));
      424    11469    1   DCL ADMIN_C00$ EPTR BASED(PARM3$);      /* for C00 */
      425    11470    1   DCL WLCLKENT$ EPTR BASED(PARM3$);       /* entry to users clock event code */
      426    11471    1   DCL KH_NODE# UBIN SYMREF;
      427    11472        %M$DCB (DCBN=F$DCB, STCLASS=BASED);
      428    11523
      429    11524        /* Entry point references */
      430    11525    1   DCL KHA$DVCADM_ALL ENTRY (6) ALTRET;
      431    11526    1   DCL KHA$UPD_CHN ENTRY(2);
      432    11527    1   DCL KHA$ASYNC ENTRY ASYNC;
      433    11528    1   DCL KHA$SETCLK ENTRY(1) ALTRET;
      434    11529    1   DCL KHC$UTS ENTRY(1) ALTRET;
      435    11530    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      436    11531        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:66   
      437    11532        /*F* NAME: KHA$INIT__ - Establish Connection with Node Administrator
      438    11533
      439    11534        The KHA$INIT routine may be used by a handler to establish
      440    11535        a DCB connection between the handler and the Node Administrator.
      441    11536
      442    11537        This routine will create a DCB, M$NA, for communicating with the Node
      443    11538        Administrator and open that DCB.  A one page buffer is required
      444    11539        for reading messages through this DCB.  KH$INIT will get this
      445    11540        buffer from the next available handler data segment.
      446    11541
      447    11542        The KHA$INIT service allows the handler to specify his
      448    11543        own administrative routine that will be called at some later
      449    11544        point by the library administrative routine.
      450    11545
      451    11546        The alternate return will be taken if the the DCB cannot be
      452    11547        created or opened, or if the buffer cannot be obtained.
      453    11548
      454    11549        After this call KH_NODE# is set up with the node number of the FEP.
      455    11550
      456    11551        The form of this call is:
      457    11552
      458    11553             CALL KHA$INIT(event#, admin$) ALTRET(label);
      459    11554
      460    11555        where:
      461    11556        */
      462    11557        /*K* event# -
      463    11558        is the event number that the library administrative routines
      464    11559        may use for its own events.
      465    11560
      466    11561        If this parameter is not specified, or if 0 is specified,
      467    11562        the KHA$INIT routine will take event control via M$EVENT.
      468    11563
      469    11564        If this parameter is specified, the handler must have established
      470    11565        event control, and later, when the handler's event routine is
      471    11566        entered with G$EXCFR.TRLR.EVID containing this event#, call the
      472    11567        library event handler.  The form of the call to the library
      473    11568        event handler is simply:
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:67   
      474    11569
      475    11570           CALL KHA$ADMIN;
      476    11571
      477    11572        */
      478    11573
      479    11574        /*K* admin$ -
      480    11575        is an EPTR to the handler's own administration routine.
      481    11576        The routine specified
      482    11577        will be called for any subsequent administrative events, i.e.
      483    11578        request for statistics, control parameter change, ENABLE,
      484    11579        DISABLE, KILL, etc.  The routine will be called as follows:
      485    11580
      486    11581            CALL  admin$(KH$ADMIN_FPT) ALTRET(error_encountered);
      487    11582
      488    11583        The reason for entry are described in KH$ADMIN_FPT.
      489    11584        */
      490    11585        /*D* NAME: KHA$INIT
      491    11586             DESCRIPTION: This entry point initializes the DCB path from the handler
      492    11587                          to Node Admin and saves the node number.
      493    11588             CALL: CALL KHA$INIT
      494    11589             INPUT: PARM1 contains the event number to use for admin events
      495    11590             OUTPUT: A DCB connection to Node Admin.
      496    11591             INTERFACE: M$OPEN, M$GETDCB.
      497    11592        */
      498    11593    2        CALL M$GETDCB(GETDCB) WHENALTRETURN DO;
      499    11594    2             ALTRETURN;
      500    11595    2           END;                            /* WHENALTRETURN */
      501    11596    1        OPEN = FPT_OPEN;
      502    11597    1        OPEN.V_ = VECTOR(OPEN.V);
      503    11598    1        OPEN.V.DCB# = KH_NA_DCB#;
      504    11599    1        KHA_READ.V.DCB# = KH_NA_DCB#;
      505    11600    1        KHA_WRITE.V.DCB# = KH_NA_DCB#;
      506    11601    2        CALL M$OPEN(OPEN) WHENALTRETURN DO; ALTRETURN; END;
      507    11602    1        KH_NODE# = DCBADDR(KH_NA_DCB#)->F$DCB.RLCID.NODE;
      508    11603    1        CALL M$GDS (KHA_GETBUF)
      509    11604    2        WHENALTRETURN DO;
      510    11605    2             ALTRETURN;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:68   
      511    11606    2           END;
      512    11607    1        KH_BUF$ = KHA_BUFSEG.BASE$;
      513    11608    1        VBASE(KHA_READ.BUF_) = KH_BUF$;
      514    11609    1        VBOUND(KHA_READ.BUF_) = KHA_BUFSEG.PAGES*512- 1;
      515    11610    1        PARM2$ = ADDR(PARM2);
      516    11611    1        PARM3$ = ADDR(PARM3);
      517    11612    1        IF ADDR(PARM1) ~= ADDR(NIL)
      518    11613    1        THEN KH_NA_EVENT# = PARM1;
      519    11614
      520    11615    1        IF ADDR(PARM2) ~= ADDR(NIL)
      521    11616    1        THEN KH_ADMIN$ = ADMIN$;
      522    11617
      523    11618    1        IF ADDR(PARM3) ~= ADDR(NIL) THEN
      524    11619    1             KH_WLCLKENT$ = WLCLKENT$;
      525    11620    1        IF KH_NA_EVENT# = 0
      526    11621    2        THEN DO;
      527    11622    2             KH_NA_EVENT# = 1;
      528    11623    2             CALL M$EVENT(FPT_EVENT);
      529    11624    2           END;
      530    11625
      531    11626    1        RETURN;
      532    11627        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:69   
      533    11628        /*F* NAME: KHA$INIT_CONTROL - Initialize the Control Parameters
      534    11629
      535    11630        Control parameters are maintained and changed by the host NETCON
      536    11631        processor.  The types of control parameters defined for a handler
      537    11632        include memory, resource, and interrupt level.  Each of these control
      538    11633        parameters is needed at handler initialization time to set up the
      539    11634        handler.  The control parameters are described in the CP-6 System
      540    11635        Support Reference Manual (HA20) discussion of the NETCON processor.
      541    11636
      542    11637        One of the functions of the administrative services is to get the
      543    11638        initial control parameters and handle any changes initiated by a user of
      544    11639        NETCON.  The handler sets up a table (KH$CTLTBL) which contains all the
      545    11640        information about control parameters for a handler.  Handler
      546    11641        administration will use this table for maintenance of the control
      547    11642        parameters.
      548    11643
      549    11644        The KHA$INIT_CONTROL routine is called by the handler to get the CONTROL
      550    11645        parameters from the host as part of the user handler initialization logic.
      551    11646
      552    11647        A message will be sent through the Node Administrator
      553    11648        to the Network Manager requesting the parameters.
      554    11649        The Network Manager will access the :NETCON file to  get
      555    11650        the parameters, package a message
      556    11651        containing this information and send it back to the FEP.
      557    11652        Once this message is received, the parameters will be moved to the
      558    11653        handler's data and the KHA$INIT_CONTROL routine will return.
      559    11654
      560    11655        Later, when subsequent administrative events are received from
      561    11656        the Node Administrator that require access to the handler's
      562    11657        control parameters, the library administrative routine will
      563    11658        field that request.
      564    11659        If the function is a display parameter request, the library
      565    11660        will return the information to the Node Administrator without
      566    11661        calling the handler administrative routine.  If the function
      567    11662        is to reset a control parameter, the library will
      568    11663        first call the handler administrative routine indicating
      569    11664        that this is a control parameter reset request, and on
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:70   
      570    11665        return, reset the control parameter value.
      571    11666
      572    11667        The form of this call is:
      573    11668
      574    11669           CALL KHA$INIT_CONTROL (kh$ctltbl) ALTRET(label);
      575    11670
      576    11671        where
      577    11672        */
      578    11673        /*K* kh$ctltbl - is the Control Table structure that has been
      579    11674        initialized by the handler to contain the addresses within
      580    11675        handler static data where the control values are to be stored.
      581    11676
      582    11677        The KH$CTLTBL macro is to be used to define this structure.
      583    11678        Please refer to the description of that macro for details.
      584    11679        */
      585    11680        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:71   
      586    11681    1   KHA$INIT_CONTROL: ENTRY(PARM1,PARM2,PARM3) ALTRET;
      587    11682    1        KH_CTLTBL$ = ADDR(PARM1);
      588    11683    1        KL_CONTROL_INIT = KL_CONTROL_CONS;
      589    11684    1        KL_CONTROL_INIT.NUM_FPARAM = KH$CTLTBL.HIPARAM;
      590    11685    1        KHA_WRITE.BUF_ = VECTOR(KL_CONTROL_INIT);
      591    11686    1        CALL M$WRITE(KHA_WRITE);
      592    11687    1        CALL M$READ(KHA_READ);
      593    11688
      594    11689    1        IF KL_CONTROL_INIT.TYPE =         1/* There are parameters               */
      595    11690    2        THEN DO;
      596    11691    2             INIT_CNTL$ = ADDR(KL_CONTROL_INIT.FPARAM);
      597    11692    2             SIZE = MINIMUM(KH$CTLTBL.HIPARAM,KL_CONTROL_INIT.NUM_FPARAM+
             11692                      KL_CONTROL_INIT.NUM_IPARAM)-1;
      598    11693    2             IF KL_CONTROL_INIT.NUM_FPARAM > %KL_ASYNC_SSNMAX THEN
      599    11694    2                  KV_SSNMAX = KL_CONTROL_INIT.FPARAM(%KL_ASYNC_SSNMAX);
      600    11695    2             IF KL_CONTROL_INIT.NUM_FPARAM > %KL_HNDLRPARM_TYPAHDBFRLMT THEN
      601    11696    2                  KV_TYPAHDBFRLMT = KL_CONTROL_INIT.FPARAM(%KL_HNDLRPARM_TYPAHDBFRLMT);
      602    11697    2             IF KL_CONTROL_INIT.NUM_FPARAM > %KL_HNDLRPARM_IMPTBLMAX THEN
      603    11698    2                  KV_MAXUFTSIZ = KL_CONTROL_INIT.FPARAM(%KL_HNDLRPARM_IMPTBLMAX);
      604    11699    2             KH_INHLVL = KL_CONTROL_INIT.FPARAM(%KL_HNDLRPARM_INTLVL);
      605    11700    2             KH_ERRSND = KL_CONTROL_INIT.FPARAM(%KL_HNDLRPARM_ERRSND);
      606    11701    3             DO I = 0 TO SIZE;
      607    11702    3                  IF I >= %KL_FIXED_HI
      608    11703    4                  THEN DO;
      609    11704    4                       INDXP# = I - %KL_FIXED_HI;
      610    11705    4                       INIT_CNTL$ = PINCRC(ADDR(KL_CONTROL_INIT),
      611    11706    4                            KL_CONTROL_INIT.IPARAM.OFFSET(INDXP#));
      612    11707    4                       INDXBND = KL_CONTROL_INIT.IPARAM.ARRAY_SZ(INDXP#);
      613    11708    4                     END;
      614    11709    3                  ELSE INDXBND = 0;
      615    11710
      616    11711    4                  DO INDX = 0 TO INDXBND;
      617    11712    4                       IF KH$CTLTBL.PARM.PTR$(I) ~= ADDR(NIL)
      618    11713    4                       THEN
      619    11714    4                            KH$CTLTBL.PARM.PTR$(I)->WORDARRAY(INDX)
      620    11715    4                                 = INIT_CNTL$->WORDARRAY(INDX);
      621    11716    4                       IF INDXBND = 0 THEN
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:72   
      622    11717    4                            INIT_CNTL$ = PINCRW(INIT_CNTL$,1);
      623    11718    4                     END/* DO INDX*/;
      624    11719
      625    11720    3                END/* DO I */;
      626    11721    2           END/*do if TYPE=1*/;
      627    11722    1        RETURN;
      628    11723        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:73   
      629    11724        /*F* NAME: KHA$INIT_CHANTBL - Initialize the Channel Table
      630    11725
      631    11726        Device allocation and control is a major function of the handler
      632    11727        administrative routines.  Physical channels are allocated to a handler
      633    11728        by the node administrator based on the resource and attribute the
      634    11729        handler requests.  Once a channel is allocated to a handler,
      635    11730        administrative events (i.e., kill, enable, partition, etc.) are reported
      636    11731        to the handler.  Also the state of a channel is maintained by these
      637    11732        services.  Each channel has a channel table entry which the handler can
      638    11733        read and modify.  (See KH$CHN below.)
      639    11734
      640    11735        The KHA$INIT_CHANTBL routine will
      641    11736
      642    11737        .fif
      643    11738
      644    11739        o acquire resources for the handler based on resource type and
      645    11740          parameters passed
      646    11741
      647    11742        o map the channel tables into the handler's data and initialize
      648    11743          pointers and delimiters relating to the channel table.
      649    11744
      650    11745        .fin
      651    11746
      652    11747        The KHA$INIT_CHANTBL service informs the Node Administrator of
      653    11748        what type of physical devices the handler requests.  This call
      654    11749        does not do the actual allocation of the physical devices.  The
      655    11750        handler will be called later at the administrative entry point
      656    11751        to actually start up the devices.  The handler administrative
      657    11752        point is established via the admin$ parameter on the call
      658    11753        to KHA$INIT.
      659    11754
      660    11755        This service also initializes that static data describing
      661    11756        the channel table.  See KH_CHNDAT below.
      662    11757
      663    11758        The form of this call is:
      664    11759
      665    11760            CALL KHA$INIT_CHANTBL (resource, attribute) ALTRET(label);
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:74   
      666    11761
      667    11762        where:
      668    11763        */
      669    11764        /*K* resource -
      670    11765        is a four character resource type to acquire.  The
      671    11766        last two characters of this field should be blank.
      672    11767        For details on resource types, see the discussion of the NETCON
      673    11768        commands CONFIG and DEFAULT, RESOURCE option, in the CP-6 System
      674    11769        Support Reference (HA20).
      675    11770        */
      676    11771
      677    11772        /*K* attribute -
      678    11773        is a 16 bit field which specifies which of the resources
      679    11774        specified to acquire.  For details on possible attributes, see the
      680    11775        discussion of the NETCON commands CONFIG and DEFAULT, ATTR option, in
      681    11776        the CP-6 System Support Reference (HA20).
      682    11777        A value of 0 means get all the lines
      683    11778        of the resource type specified.  A non-zero ATTR means get
      684    11779        the lines of the resource type specified that also have the
      685    11780        attributes specified.  See the G_ATTR_? subs in G_LCP6_E.
      686    11781        */
      687    11782
      688    11783        /*
      689    11784        Prior to D00, the admin$ was passed as the third parameter
      690    11785        to KHA$INIT_CONTROL.  This routine will still accept that
      691    11786        parameter so we can be backwardly compatable with our own
      692    11787        handlers.
      693    11788        */
      694    11789
      695    11790        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:75   
      696    11791    1   KHA$INIT_CHANTBL: ENTRY(PARM1,PARM2,PARM3) ALTRET;
      697    11792    1        PARM1$ = ADDR(PARM1);
      698    11793    1        PARM2$ = ADDR(PARM2);
      699    11794    1        PARM3$ = ADDR(PARM3);
      700    11795
      701    11796    1        IF ADDR(PARM3) ~= ADDR(NIL)
      702    11797    1        THEN KH_ADMIN$ = ADMIN_C00$;
      703    11798    1        FROMSEG.BASE = %GM_BOBCAT_BASE;
      704    11799    1        USERSEG.BASE = %GM_USRDS4_BASE;
      705    11800    1        CALL M$CVM (FPT_CVM)
      706    11801    2        WHENALTRETURN DO;
      707    11802    2             CALL M$XXX;
      708    11803    2           END;
      709    11804
      710    11805        /* Initialize local pointers */
      711    11806    1        KH_CHNLOW = G$BOBCAT.CHNLOW;
      712    11807    1        KH_CHNLOW$ = G$BOBCAT.CHNLOW$;
      713    11808    1        KH_CHNHI = G$BOBCAT.CHNHI;
      714    11809    1        KH_CHNHI_R.BTM7 = '1111111'B;
      715    11810    1        KH_CHNHI$ = G$BOBCAT.CHNHI$;
      716    11811    1        KL_ACQUIRE = KL_ACQUIRE_CONS;
      717    11812    1        KL_ACQUIRE.RES = RESOURCE;
      718    11813    1        KL_ACQUIRE.ATTR = ATTR;
      719    11814    1        KHA_WRITE.BUF_ = VECTOR(KL_ACQUIRE);
      720    11815    1        CALL M$WRITE (KHA_WRITE);
      721    11816
      722    11817    1        RETURN;
      723    11818        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:76   
      724    11819        /*F* NAME: KHA$INIT_DONE - Handler Initialization Complete
      725    11820
      726    11821        This routine is to be called when the handler specific initialization
      727    11822        is complete and the handler is ready to receive events for the
      728    11823        physical channels that have been assigned to it.
      729    11824
      730    11825        A message is sent to the Node Administrator indicating initialization is complete.
      731    11826        KHA$INIT_DONE then issues a no-wait read to the Node
      732    11827        Administrator for administrative events and returns to the handler.
      733    11828        Once this call is complete the handler is up and running.
      734    11829        The handler may then call KVM$RCV to begin scanning for incoming
      735    11830        messages.
      736    11831
      737    11832        The form of the call for this service is:
      738    11833
      739    11834            CALL KHA$INIT_DONE ALTRET(label);
      740    11835         */
      741    11836
      742    11837    1   KHA$INIT_DONE: ENTRY(PARM1,PARM2,PARM3) ALTRET;
      743    11838    1        KHA_WRITE.BUF_ = VECTOR(KL_INITDONE);
      744    11839    1        CALL M$WRITE(KHA_WRITE);
      745    11840    1        KHA_WRITE.V.DVBYTE.NODAT = '1'B;
      746    11841    1        KHA_READ.V.WAIT = '0'B;
      747    11842    1        KHA_READ.V.EVENT = KH_NA_EVENT#;
      748    11843    1        CALL M$READ(KHA_READ);
      749    11844    1        RETURN;
      750    11845        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:77   
      751    11846        /*F* NAME: KHA$ERRLOG - Write Error Log Entry
      752    11847
      753    11848        This routine will cause an error log entry as described by the
      754    11849        FPT_WRSYSLOG structure to be sent to the HOST.
      755    11850
      756    11851        The alternate return is taken if the error log cannot
      757    11852        be forwarded and there is not enough memory
      758    11853        to save it for retransmission later.
      759    11854
      760    11855        The form of the call for this service is:
      761    11856
      762    11857            CALL KHA$ERRLOG(FPT_WRSYSLOG, noretran) ALTRET (label);
      763    11858
      764    11859        where:
      765    11860        */
      766    11861        /*K* FPT_WRSYSLOG -
      767    11862        is the FPT structure used by the M$WRSYSLOG monitor service.
      768    11863        The FPT_WRSYSLOG from the LCP_6 INCLUDE should be used
      769    11864        to generate this structure.
      770    11865
      771    11866        Options on the FPT_WRSYSLOG macro are as follows:
      772    11867        */
      773    11868        /*K* FPT_WRSYSLOG.BUF = VARIABLE.
      774    11869        .XEQ GT_LCP6_M M$WRSYSLOG BUF
      775    11870        */
      776    11871        /*K* FPT_WRSYSLOG.FCG, MID, SEV, and ERR -
      777    11872        .XEQ GT_LCP6_M M$WRSYSLOG FCG
      778    11873
      779    11874        The SEVerity specified must
      780    11875        equal or exceed the ERRSND control parameter value set for this
      781    11876        handler or the error will not be logged.
      782    11877        */
      783    11878        /*K* FPT_WRSYSLOG.TERMINAL_ID.
      784    11879        .XEQ GT_LCP6_M M$WRSYSLOG TERMINAL_ID
      785    11880        */
      786    11881        /*K* FPT_WRSYSLOG.VALUES = ARRAY(0:3) UBIN.
      787    11882        .XEQ GT_LCP6_M M$WRSYSLOG VALUES
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:78   
      788    11883        */
      789    11884
      790    11885        /*K* noretran -
      791    11886        specifies that that retransmission is not to be attempted
      792    11887        if the errorlog entry cannot immediately be forwarded to
      793    11888        the host.
      794    11889        Absence of this parameter implies YES.
      795    11890        */
      796    11891
      797    11892    1   KHA$ERRLOG: ENTRY(PARM1,PARM2) ALTRET;
      798    11893
      799    11894    1        INHIBIT_LEVEL = KH_INHLVL;
      800    11895             %DISABLE;
      801    11899    1        PARM1$ = ADDR(PARM1);
      802    11900    1        IF FPT$WRSYSLOG.V.ERRCODE.SEV < KH_ERRSND
      803    11901    2        THEN DO;
      804    11902                  %ENABLE;
      805    11908    2             RETURN;
      806    11909    2           END;
      807    11910
      808    11911    1        KL$SYSLOG.FCN = IGA_SYSLOG;
      809    11912    1        KL$SYSLOG.FILENUM = 1;
      810    11913    1        KL$SYSLOG.ERRLOG.DATA_SIZE = 0;
      811    11914    1        KL$SYSLOG.ERRLOG.ERRCODE = ADDR(PARM1)->FPT$WRSYSLOG.V.ERRCODE;
      812    11915    1        KL$SYSLOG.ERRLOG.VALUES = ADDR(PARM1)->FPT$WRSYSLOG.V.VALUES;
      813    11916    1        KL$SYSLOG.ERRLOG.TERMID = ADDR(PARM1)->FPT$WRSYSLOG.V.TERMID;
      814    11917    1        CALL KHC$UTS (KL$SYSLOG.ERRLOG.UTS);
      815    11918    1        IF FPT$WRSYSLOG.BUF_ ~= VECTOR(NIL)
      816    11919    2        THEN DO;
      817    11920    2             KL$SYSLOG.ERRLOG.DATA_SIZE = VBOUND(ADDR(PARM1)->FPT$WRSYSLOG.BUF_)+1;
      818    11921    2             SIZE = KL$SYSLOG.ERRLOG.DATA_SIZE;
      819    11922    2             KL$SYSLOG.ERRLOG.MSG = VBASE(FPT$WRSYSLOG.BUF_)->ERRMSG;
      820    11923    2           END;
      821    11924    1        ELSE
      822    11925    1             SIZE = 0;
      823    11926    1        KHA_WRITE.BUF_ = VECTOR(KL$SYSLOG);
      824    11927    1        VBOUND(KHA_WRITE.BUF_) = SIZEC(KL$SYSLOG) + SIZE - SIZEC(KL$SYSLOG.ERRLOG.MSG)
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:79   
             11927                 - 1;
      825    11928    1        IF KH_FLDWRTS > 0 THEN
      826    11929    2        DO;
      827    11930    2             IF ADDR(PARM2) ~= ADDR(NIL) AND PARM2 ~= 0 THEN
      828    11931    3             DO;
      829    11932                       %ENABLE;
      830    11938    3                  ALTRETURN;
      831    11939    3                END;
      832    11940    2             CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
      833    11941    3             DO;
      834    11942                       %ENABLE;
      835    11948    3                  ALTRETURN;
      836    11949    3                END;
      837    11950    2           END;
      838    11951    1        ELSE
      839    11952    2        DO;
      840    11953    2             CALL M$WRITE(KHA_WRITE) WHENALTRETURN
      841    11954    3             DO;
      842    11955    3                  IF ADDR(PARM2) ~= ADDR(NIL) THEN
      843    11956    4                  DO;
      844    11957                            %ENABLE;
      845    11963    4                       ALTRETURN;
      846    11964    4                     END;
      847    11965    3                  ELSE
      848    11966    4                  DO;
      849    11967    4                       CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
      850    11968    5                       DO;
      851    11969                                 %ENABLE;
      852    11975    5                            ALTRETURN;
      853    11976    5                          END;
      854    11977    4                     END;
      855    11978    3                END;
      856    11979    2           END;
      857    11980
      858    11981             %ENABLE;
      859    11987    1        RETURN;
      860    11988
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:80   
      861    11989        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:81   
      862    11990        /*F* NAME: KHA$SNDSTT - Write Statistical Data
      863    11991
      864    11992        This routine copies the information from the
      865    11993        request statistics message into the the statistics
      866    11994        buffer and forwards the message on to the host.  The
      867    11995        altreturn is taken when the message cannot be forwarded.
      868    11996
      869    11997        The form of this call is:
      870    11998
      871    11999            CALL KHA$SNDSTT (request_stats, stats_buffer) ALTRET(label);
      872    12000
      873    12001        where:
      874    12002        */
      875    12003        /*K* request_stats -
      876    12004        is the buffer that was passed to the handler's routine
      877    12005        when the request for statistics was received.  The buffer
      878    12006        is in the form of the KL_REQSTATS message.
      879    12007        */
      880    12008
      881    12009        /*K* stats_buffer -
      882    12010        is the statistics buffer to be sent to the host.  This buffer
      883    12011        is also in the form of the KL_REQSTATS message.
      884    12012        */
      885    12013
      886    12014
      887    12015    1   KHA$SNDSTT: ENTRY(PARM1,PARM2) ALTRET;
      888    12016    1        PARM1$ = ADDR(PARM1);
      889    12017    1        PARM2C$ = VBASE(ADDR(PARM2)->B$VECT);
      890    12018    1        PARM2$->KL$REQSTATS.FEPNAME = PARM1$->KL$REQSTATS.FEPNAME;
      891    12019    1        PARM2$->KL$REQSTATS.SRCE_NODE = PARM1$->KL$REQSTATS.SRCE_NODE;
      892    12020    1        PARM2$->KL$REQSTATS.HANDLER = PARM1$->KL$REQSTATS.HANDLER;
      893    12021    1        PARM2$->KL$REQSTATS.NODE_NUM = PARM1$->KL$REQSTATS.NODE_NUM;
      894    12022    1        PARM2$->KL$REQSTATS.STATSSTA = PARM1$->KL$REQSTATS.STATSSTA;
      895    12023    1        PARM2$->KL$REQSTATS.FNC = IGA_REQSTATS;
      896    12024    1        KHA_WRITE.BUF_ = ADDR(PARM2)->B$VECT;
      897    12025    1        IF KH_FLDWRTS > 0 THEN
      898    12026    1             CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:82   
      899    12027    2             DO;
      900    12028                       %ENABLE;
      901    12034    2                  ALTRETURN;
      902    12035    2                END;
      903    12036    1        ELSE
      904    12037    1             CALL M$WRITE(KHA_WRITE) WHENALTRETURN
      905    12038    2             DO;
      906    12039    2                  CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
      907    12040    3                  DO;
      908    12041                            %ENABLE;
      909    12047    3                       ALTRETURN;
      910    12048    3                     END;
      911    12049    2                END;
      912    12050    1        RETURN;
      913    12051    1   END KHA$INIT;
      914    12052        %EOD;

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:83   
--  Include file information  --

   KH_CHN.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   GM_VIRTUAL_E.:E05TOU  is referenced.
   G$BOBCAT_M.:E05TOU  is referenced.
      No diagnostics issued in procedure KHA$INIT.

   Procedure KHA$INIT requires 975 words for executable code.
   Procedure KHA$INIT requires 205 words of local(AUTO) storage.

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:84   

 Object Unit name= KHA$INIT                                   File name= KHA$ADMIN.:E05TOU
 UTS= JUL 30 '97 00:25:51.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    208     D0  KHA$INIT
    1   Data  even  none    18     12  KHA$INIT
    2   Proc  even  none   975    3CF  KHA$INIT
    3  RoData even  none     8      8  KHA$INIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  KHA$INIT
     2     9B          yes     yes      Std        3  KHA$INIT_CONTROL
     2    180          yes     yes      Std        3  KHA$INIT_CHANTBL
     2    1FC          yes     yes      Std        3  KHA$INIT_DONE
     2    22A          yes     yes      Std        2  KHA$ERRLOG
     2    34C          yes     yes      Std        2  KHA$SNDSTT

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    1      0  KH_ADMIN$                          1      2  KH_INHLVL
    1      3  KH_ERRSND                          1      4  KH_FLDWRTS
    0     82  KHA_GETBUF                         1      B  KHA_BUFSEG
    1      E  KH_NA_DCB#                         1      F  KH_NA_EVENT#
    1     10  KH_WLCLKENT$
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:85   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          Async      0 KHA$ASYNC
 yes     yes           Std       1 KHC$UTS
         yes           Std       0 KHI$ENABLE
         yes           Std       1 KHI$DISABLE
 yes     yes           Std       1 KHA$SETCLK
                       nStd      0 X6A_AUTO_3
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET
                       nStd      0 X6C_ALR

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KH_CHNLOW$                            KH_CHNHI$                             KH_CHNHI
     KH_CHNLOW                             KH_CTLTBL$                            KH_BUF$
     KV_SSNMAX                             KV_TYPAHDBFRLMT                       KV_MAXUFTSIZ
     G$DS4$                                KHA_WRITE                             KHA_READ
     KH_NODE#                         r    G$ROS$
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:86   


      297        1        /*T***********************************************************/
      298        2        /*T*                                                         */
      299        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      300        4        /*T*                                                         */
      301        5        /*T***********************************************************/
      302        6        /*P* NAME: KHA$INIT
      303        7
      304        8        PURPOSE:
      305        9        KHA$INIT contains all the routines to handle the initialization
      306       10        of the interface between a handler and the Node Administrator.
      307       11        The following list contains the names of the entry points available:
      308       12
      309       13         KHA$INIT - initialize the path to Node Admin
      310       14         KHA$INIT_CONTROL - get handlers Control parameters
      311       15         KHA$INIT_CHANTBL - acquire resources and build KH$CHN
      312       16         KHA$INIT_DONE - tell Node Admin that handler initialization is complete
      313       17        */
      314       18
      315       19        KHA$INIT: PROC(PARM1,PARM2,PARM3) ALTRET;

     19   2 000000  D380 0000 0000  xent KHA$INIT        LNJ,B5   X6A_AUTO_3
          2 000003       00CD 0003                       DC       205,3

      316       20        /* Includes */
      317       21        %INCLUDE G$BOBCAT_M;
      318       41        %INCLUDE GM_VIRTUAL_E;
      319      251        %INCLUDE LCP_6;
      320     4530        %INCLUDE KL_CONTROL_C;
      321     4910        %INCLUDE KL_AFCN_C;
      322     5011        %INCLUDE KL_MACRO_C;
      323     8363        %INCLUDE KH_MACRO_C;
      324     9106        %INCLUDE KH$CHN;
      325     9228        %INCLUDE KHA_FNC_E;
      326     9328        %INCLUDE KHC_MAC_C;
      327     9369        %INHIBIT_DCLS;
      328     9381        %INCLUDE KH_CHN;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:87   
      329     9421
      330     9422        /* Parameters */
      331     9423    1   DCL PARM1 UBIN;
      332     9424    1   DCL PARM2 UBIN;
      333     9425    1   DCL PARM3 UBIN;
      334     9426
      335     9427        /* Local Static */
      336     9428        %KL_ACQUIRE (FPTN=KL_ACQUIRE_CONS,STCLASS=CONSTANT);
      337     9510       %KL_CONTROL_INIT (NUM_FIXED = %KL_FIXED_HI,NUM_INDXD=4,STCLASS="BASED(KH_BUF$)",LAST
              9510            =NO);
      338     9636    1            2 BLOCK(0:15) UBIN WORD,
      339     9637    1            2 UNBLOCK(0:15) UBIN WORD,
      340     9638    1            2 USRPARM1(0:7) UBIN WORD,
      341     9639    1            2 USRPARM2(0:7) UBIN WORD;
      342     9640        %KL_CONTROL_INIT (FPTN=KL_CONTROL_CONS,NUM_FIXED=%KL_FIXED_HI,NUM_INDXD=4,STCLASS=
              9640            CONSTANT,LAST=NO);
      343     9766    1            2 BLOCK(0:15) UBIN WORD,
      344     9767    1            2 UNBLOCK(0:15) UBIN WORD,
      345     9768    1            2 USRPARM1(0:7) UBIN WORD,
      346     9769    1            2 USRPARM2(0:7) UBIN WORD;
      347     9770        %KL_ACQUIRE (STCLASS="BASED(KH_BUF$)");
      348     9852        %KL_INITDONE (STCLASS=CONSTANT);
      349     9891        %KL_CHNRSP (STCLASS="BASED(KH_BUF$)");
      350    10111        %G$BOBCAT (STCLASS="BASED(G$DS4$)");
      351    10124        %KL_HNDCMN_INFO (FPTN=HNDCMN,STCLASS=BASED);
      352    10204        %KH_CHNDAT (STCLASS=SYMREF);
      353    10222    1   DCL KH_ADMIN$ EPTR STATIC SYMDEF;
      354    10223    1   DCL KH_INHLVL UBIN STATIC SYMDEF INIT(63);
      355    10224    1   DCL KH_ERRSND UBIN STATIC SYMDEF INIT(0);
      356    10225    1   DCL KH_CTLTBL$ PTR SYMREF;
      357    10226    1   DCL KH_BUF$ PTR SYMREF;
      358    10227    1   DCL KV_SSNMAX UBIN SYMREF;
      359    10228    1   DCL KV_TYPAHDBFRLMT UBIN SYMREF;
      360    10229    1   DCL KV_MAXUFTSIZ UBIN SYMREF;
      361    10230    1   DCL KH_FLDWRTS SBIN WORD STATIC SYMDEF INIT(0);
      362    10231        /*
      363    10232                write buffers currently queued up.
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:88   
      364    10233        */
      365    10234
      366    10235        /* Auto */
      367    10236    1   DCL PARM1$ PTR;
      368    10237    1   DCL PARM2$ PTR;
      369    10238    1   DCL PARM2C$ REDEF PARM2$ CPTR;
      370    10239    1   DCL PARM3$ PTR;
      371    10240    1   DCL CHN$ PTR;
      372    10241    1   DCL SIZE UBIN;
      373    10242    1   DCL I UBIN;
      374    10243        %VLP_ERRCODE (FPTN=ERROR,STCLASS=AUTO);
      375    10289    1   DCL CTRINDX UBIN;
      376    10290    1   DCL LSTCTRINDX UBIN;
      377    10291    1   DCL LSTCHN$ PTR;
      378    10292    1   DCL INDX UBIN;
      379    10293    1   DCL INDXBND UBIN;
      380    10294    1   DCL INDXP# UBIN;
      381    10295    1   DCL INIT_CNTL$ PTR;
      382    10296
      383    10297        /* Based structures */
      384    10298    1   DCL B$VECT VECTOR BASED;
      385    10299        %KL_SYSLOG (FPTN=KL$SYSLOG,STCLASS=AUTO,LAST=",");
      386    10323        %KL_ERRLOG (FPTN=ERRLOG,STCLASS=AUTO,LVL=2,LAST=",");
      387    10431    1                 3 MSG CHAR(200) CALIGNED;
      388    10432    1   DCL ERRMSG CHAR(SIZE) CALIGNED BASED;
      389    10433        %FPT_WRSYSLOG (FPTN=FPT$WRSYSLOG,STCLASS="BASED(PARM1$)");
      390    10528        %KL_REQSTATS (NAME=KL$REQSTATS,STCLASS=BASED);
      391    10822    1   DCL RESOURCE CHAR(2) BASED(PARM1$);     /* Resource type to get */
      392    10823    1   DCL ATTR BIT(16) WALIGNED BASED(PARM2$); /* Attribute to Acquire */
      393    10824                                           /* Entry to the handlers admin routine */
      394    10825    1   DCL ADMIN$ EPTR BASED(PARM2$);          /* for D00 */
      395    10826    1   DCL ONEWORD UBIN BASED;
      396    10827    1   DCL WORDARRAY(0:0) UBIN BASED;
      397    10828        %KH$CHN (STCLASS="BASED(CHN$)");
      398    10952        %KH$CTLTBL (FPTN=KH$CTLTBL,STCLASS="BASED(KH_CTLTBL$)");
      399    11164
      400    11165        /* Symrefs */
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:89   
      401    11166    1   DCL G$DS4$ PTR SYMREF;
      402    11167
      403    11168        /* FPT's */
      404    11169        %FPT_CVM (FROMSEG=FROMSEG,USERSEG=USERSEG,TYPE=MON,PAGES=256,STCLASS=CONSTANT);
      405    11193       %FPT_GDS (FPTN=KHA_GETBUF,PAGES=1,RESULTS=KHA_BUFSEG,STCLASS="CONSTANT SYMDEF",NEXT=
             11193            LITTLE,PARK=NO);
      406    11217        %VLP_SEGMENT (FPTN=FROMSEG);
      407    11238        %VLP_SEGMENT (FPTN=USERSEG);
      408    11259        %VLP_SEGMENT (FPTN=KHA_BUFSEG,STCLASS="STATIC SYMDEF");
      409    11280        %FPT_OPEN (RES='NA',
      410    11281                   ORG=CONSEC,
      411    11282                   STCLASS=CONSTANT);
      412    11310        %FPT_OPEN (FPTN=OPEN,STCLASS=AUTO);
      413    11338        %FPT_WRITE (FPTN=KHA_WRITE,STCLASS=SYMREF);
      414    11362        %FPT_READ (FPTN=KHA_READ,STCLASS=SYMREF);
      415    11388        %FPT_EVENT (EVENT$=KHA$ASYNC,STCLASS=CONSTANT);
      416    11428        %FPT_GETDCB (FPTN=GETDCB,
      417    11429                     DCBNAME=DCB_NA,
      418    11430                     DCBNUM=KH_NA_DCB#,STCLASS=CONSTANT);
      419    11450        %VLP_NAME (FPTN=DCB_NA,
      420    11451                   NAME='M$NA',STCLASS=CONSTANT);
      421    11466    1   DCL KH_NA_DCB# UBIN STATIC SYMDEF INIT(0);
      422    11467    1   DCL KH_NA_EVENT# UBIN STATIC SYMDEF INIT(0);
      423    11468    1   DCL KH_WLCLKENT$ EPTR STATIC SYMDEF INIT(ENTADDR(NIL));
      424    11469    1   DCL ADMIN_C00$ EPTR BASED(PARM3$);      /* for C00 */
      425    11470    1   DCL WLCLKENT$ EPTR BASED(PARM3$);       /* entry to users clock event code */
      426    11471    1   DCL KH_NODE# UBIN SYMREF;
      427    11472        %M$DCB (DCBN=F$DCB, STCLASS=BASED);
      428    11523
      429    11524        /* Entry point references */
      430    11525    1   DCL KHA$DVCADM_ALL ENTRY (6) ALTRET;
      431    11526    1   DCL KHA$UPD_CHN ENTRY(2);
      432    11527    1   DCL KHA$ASYNC ENTRY ASYNC;
      433    11528    1   DCL KHA$SETCLK ENTRY(1) ALTRET;
      434    11529    1   DCL KHC$UTS ENTRY(1) ALTRET;
      435    11530    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      436    11531        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:90   
      437    11532        /*F* NAME: KHA$INIT__ - Establish Connection with Node Administrator
      438    11533
      439    11534        The KHA$INIT routine may be used by a handler to establish
      440    11535        a DCB connection between the handler and the Node Administrator.
      441    11536
      442    11537        This routine will create a DCB, M$NA, for communicating with the Node
      443    11538        Administrator and open that DCB.  A one page buffer is required
      444    11539        for reading messages through this DCB.  KH$INIT will get this
      445    11540        buffer from the next available handler data segment.
      446    11541
      447    11542        The KHA$INIT service allows the handler to specify his
      448    11543        own administrative routine that will be called at some later
      449    11544        point by the library administrative routine.
      450    11545
      451    11546        The alternate return will be taken if the the DCB cannot be
      452    11547        created or opened, or if the buffer cannot be obtained.
      453    11548
      454    11549        After this call KH_NODE# is set up with the node number of the FEP.
      455    11550
      456    11551        The form of this call is:
      457    11552
      458    11553             CALL KHA$INIT(event#, admin$) ALTRET(label);
      459    11554
      460    11555        where:
      461    11556        */
      462    11557        /*K* event# -
      463    11558        is the event number that the library administrative routines
      464    11559        may use for its own events.
      465    11560
      466    11561        If this parameter is not specified, or if 0 is specified,
      467    11562        the KHA$INIT routine will take event control via M$EVENT.
      468    11563
      469    11564        If this parameter is specified, the handler must have established
      470    11565        event control, and later, when the handler's event routine is
      471    11566        entered with G$EXCFR.TRLR.EVID containing this event#, call the
      472    11567        library event handler.  The form of the call to the library
      473    11568        event handler is simply:
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:91   
      474    11569
      475    11570           CALL KHA$ADMIN;
      476    11571
      477    11572        */
      478    11573
      479    11574        /*K* admin$ -
      480    11575        is an EPTR to the handler's own administration routine.
      481    11576        The routine specified
      482    11577        will be called for any subsequent administrative events, i.e.
      483    11578        request for statistics, control parameter change, ENABLE,
      484    11579        DISABLE, KILL, etc.  The routine will be called as follows:
      485    11580
      486    11581            CALL  admin$(KH$ADMIN_FPT) ALTRET(error_encountered);
      487    11582
      488    11583        The reason for entry are described in KH$ADMIN_FPT.
      489    11584        */
      490    11585        /*D* NAME: KHA$INIT
      491    11586             DESCRIPTION: This entry point initializes the DCB path from the handler
      492    11587                          to Node Admin and saves the node number.
      493    11588             CALL: CALL KHA$INIT
      494    11589             INPUT: PARM1 contains the event number to use for admin events
      495    11590             OUTPUT: A DCB connection to Node Admin.
      496    11591             INTERFACE: M$OPEN, M$GETDCB.
      497    11592        */
      498    11593    2        CALL M$GETDCB(GETDCB) WHENALTRETURN DO;

  11593   2 000005  BB80 0000 00C1  00                   LAB,B3   GETDCB
          2 000008  B870 0D45                            LDR,R3   3397,IMO
          2 00000A  0001                                 MCL
          2 00000B       0003                            DC       s:11594,PREL
          2 00000C  0F81 0004                            B        s:11596,PREL

      499    11594    2             ALTRETURN;

  11594   2 00000E  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      500    11595    2           END;                            /* WHENALTRETURN */
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:92   
      501    11596    1        OPEN = FPT_OPEN;

  11596   2 000011  AB80 0000 008A  00                   LAB,B2   FPT_OPEN
          2 000014  2C00                                 LDV,R2   0
          2 000015  6C5E                                 LDV,R6   94
          2 000016  BBC7 0098                            LAB,B3   OPEN,AUTO
          2 000018  3C00                                 LDV,R3   0
          2 000019  0008                                 MMM

      502    11597    1        OPEN.V_ = VECTOR(OPEN.V);

  11597   2 00001A  EBC7 00BF                            LAB,B6   OPEN+39,AUTO
          2 00001C  EFC7 00C9                            STB,B6   OPEN+49,AUTO
          2 00001E  6C0F                                 LDV,R6   15
          2 00001F  EF47 00C8                            STR,R6   OPEN+48,AUTO
          2 000021  ABC7 00C8                            LAB,B2   OPEN+48,AUTO
          2 000023  2C00                                 LDV,R2   0
          2 000024  6C06                                 LDV,R6   6
          2 000025  BBC7 0098                            LAB,B3   OPEN,AUTO
          2 000027  3C00                                 LDV,R3   0
          2 000028  0008                                 MMM

      503    11598    1        OPEN.V.DCB# = KH_NA_DCB#;

  11598   2 000029  E800 0000 000E  01                   LDR,R6   KH_NA_DCB#
          2 00002C  E7C7 00BF                            STH,R6   OPEN+39,AUTO

      504    11599    1        KHA_READ.V.DCB# = KH_NA_DCB#;

  11599   2 00002E  E780 0000 000F  xsym                 STH,R6   KHA_READ+15

      505    11600    1        KHA_WRITE.V.DCB# = KH_NA_DCB#;

  11600   2 000031  E780 0000 000F  xsym                 STH,R6   KHA_WRITE+15

      506    11601    2        CALL M$OPEN(OPEN) WHENALTRETURN DO; ALTRETURN; END;

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:93   
  11601   2 000034  BBC7 0098                            LAB,B3   OPEN,AUTO
          2 000036  B870 3540                            LDR,R3   13632,IMO
          2 000038  0001                                 MCL
          2 000039       0003                            DC       s:11601+8,PREL
          2 00003A  0F81 0004                            B        s:11602,PREL

  11601   2 00003C  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      507    11602    1        KH_NODE# = DCBADDR(KH_NA_DCB#)->F$DCB.RLCID.NODE;

  11602   2 00003F  EC80 0000 0000  xsym                 LDB,B6   G$ROS$
          2 000042  DC86                                 LDB,B5   ,B6
          2 000043  B800 0000 000E  01                   LDR,R3   KH_NA_DCB#
          2 000046  CCB5                                 LDB,B4   ,B5,R3
          2 000047  E2C4 002D                            LLH,R6   45,B4
          2 000049  EF00 0000 0000  xsym                 STR,R6   KH_NODE#

      508    11603    1        CALL M$GDS (KHA_GETBUF)

  11603   2 00004C  BB80 0000 0082  00                   LAB,B3   KHA_GETBUF
          2 00004F  B870 0902                            LDR,R3   2306,IMO
          2 000051  0001                                 MCL
          2 000052       0003                            DC       s:11605,PREL
          2 000053  0F81 0004                            B        s:11607,PREL

      509    11604    2        WHENALTRETURN DO;

      510    11605    2             ALTRETURN;

  11605   2 000055  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      511    11606    2           END;
      512    11607    1        KH_BUF$ = KHA_BUFSEG.BASE$;

  11607   2 000058  EC80 0000 000B  01                   LDB,B6   KHA_BUFSEG
          2 00005B  EF80 0000 0000  xsym                 STB,B6   KH_BUF$

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:94   
      513    11608    1        VBASE(KHA_READ.BUF_) = KH_BUF$;

  11608   2 00005E  EF80 0000 0007  xsym                 STB,B6   KHA_READ+7

      514    11609    1        VBOUND(KHA_READ.BUF_) = KHA_BUFSEG.PAGES*512- 1;

  11609   2 000061  E800 0000 000D  01                   LDR,R6   KHA_BUFSEG+2
          2 000064  6009                                 SOL,R6   9
          2 000065  6EFF                                 ADV,R6   -1
          2 000066  EF00 0000 0006  xsym                 STR,R6   KHA_READ+6

      515    11610    1        PARM2$ = ADDR(PARM2);

  11610   2 000069  DCC7 0006                            LDB,B5   @PARM2,AUTO
          2 00006B  DFC7 000E                            STB,B5   PARM2$,AUTO

      516    11611    1        PARM3$ = ADDR(PARM3);

  11611   2 00006D  CCC7 0008                            LDB,B4   @PARM3,AUTO
          2 00006F  CFC7 0010                            STB,B4   PARM3$,AUTO

      517    11612    1        IF ADDR(PARM1) ~= ADDR(NIL)

  11612   2 000071  BCC7 0004                            LDB,B3   @PARM1,AUTO
          2 000073  8DD3                                 CMN      B3
          2 000074  0901 0005                            BE       s:11615,PREL

      518    11613    1        THEN KH_NA_EVENT# = PARM1;

  11613   2 000076  D803                                 LDR,R5   ,B3
          2 000077  DF00 0000 000F  01                   STR,R5   KH_NA_EVENT#

      519    11614
      520    11615    1        IF ADDR(PARM2) ~= ADDR(NIL)

  11615   2 00007A  8DD5                                 CMN      B5
          2 00007B  0901 0005                            BE       s:11618,PREL
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:95   

      521    11616    1        THEN KH_ADMIN$ = ADMIN$;

  11616   2 00007D  AC85                                 LDB,B2   ,B5
          2 00007E  AF80 0000 0000  01                   STB,B2   KH_ADMIN$

      522    11617
      523    11618    1        IF ADDR(PARM3) ~= ADDR(NIL) THEN

  11618   2 000081  8DD4                                 CMN      B4
          2 000082  0901 0005                            BE       s:11620,PREL

      524    11619    1             KH_WLCLKENT$ = WLCLKENT$;

  11619   2 000084  AC84                                 LDB,B2   ,B4
          2 000085  AF80 0000 0010  01                   STB,B2   KH_WLCLKENT$

      525    11620    1        IF KH_NA_EVENT# = 0

  11620   2 000088  D800 0000 000F  01                   LDR,R5   KH_NA_EVENT#
          2 00008B  5981 000C                            BNEZ,R5  s:11626,PREL

      526    11621    2        THEN DO;

      527    11622    2             KH_NA_EVENT# = 1;

  11622   2 00008D  5C01                                 LDV,R5   1
          2 00008E  DF00 0000 000F  01                   STR,R5   KH_NA_EVENT#

      528    11623    2             CALL M$EVENT(FPT_EVENT);

  11623   2 000091  BB80 0000 00B9  00                   LAB,B3   FPT_EVENT
          2 000094  B870 08C0                            LDR,R3   2240,IMO
          2 000096  0001                                 MCL
          2 000097       0000                            DC       s:11623+6,PREL

      529    11624    2           END;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:96   

      530    11625
      531    11626    1        RETURN;

  11626   2 000098  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      532    11627        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:97   
      533    11628        /*F* NAME: KHA$INIT_CONTROL - Initialize the Control Parameters
      534    11629
      535    11630        Control parameters are maintained and changed by the host NETCON
      536    11631        processor.  The types of control parameters defined for a handler
      537    11632        include memory, resource, and interrupt level.  Each of these control
      538    11633        parameters is needed at handler initialization time to set up the
      539    11634        handler.  The control parameters are described in the CP-6 System
      540    11635        Support Reference Manual (HA20) discussion of the NETCON processor.
      541    11636
      542    11637        One of the functions of the administrative services is to get the
      543    11638        initial control parameters and handle any changes initiated by a user of
      544    11639        NETCON.  The handler sets up a table (KH$CTLTBL) which contains all the
      545    11640        information about control parameters for a handler.  Handler
      546    11641        administration will use this table for maintenance of the control
      547    11642        parameters.
      548    11643
      549    11644        The KHA$INIT_CONTROL routine is called by the handler to get the CONTROL
      550    11645        parameters from the host as part of the user handler initialization logic.
      551    11646
      552    11647        A message will be sent through the Node Administrator
      553    11648        to the Network Manager requesting the parameters.
      554    11649        The Network Manager will access the :NETCON file to  get
      555    11650        the parameters, package a message
      556    11651        containing this information and send it back to the FEP.
      557    11652        Once this message is received, the parameters will be moved to the
      558    11653        handler's data and the KHA$INIT_CONTROL routine will return.
      559    11654
      560    11655        Later, when subsequent administrative events are received from
      561    11656        the Node Administrator that require access to the handler's
      562    11657        control parameters, the library administrative routine will
      563    11658        field that request.
      564    11659        If the function is a display parameter request, the library
      565    11660        will return the information to the Node Administrator without
      566    11661        calling the handler administrative routine.  If the function
      567    11662        is to reset a control parameter, the library will
      568    11663        first call the handler administrative routine indicating
      569    11664        that this is a control parameter reset request, and on
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:98   
      570    11665        return, reset the control parameter value.
      571    11666
      572    11667        The form of this call is:
      573    11668
      574    11669           CALL KHA$INIT_CONTROL (kh$ctltbl) ALTRET(label);
      575    11670
      576    11671        where
      577    11672        */
      578    11673        /*K* kh$ctltbl - is the Control Table structure that has been
      579    11674        initialized by the handler to contain the addresses within
      580    11675        handler static data where the control values are to be stored.
      581    11676
      582    11677        The KH$CTLTBL macro is to be used to define this structure.
      583    11678        Please refer to the description of that macro for details.
      584    11679        */
      585    11680        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:99   
      586    11681    1   KHA$INIT_CONTROL: ENTRY(PARM1,PARM2,PARM3) ALTRET;

  11681   2 00009B  D380 0000 0000  xent KHA$INIT_CONTROLLNJ,B5   X6A_AUTO_3
          2 00009E       00CD 0003                       DC       205,3

      587    11682    1        KH_CTLTBL$ = ADDR(PARM1);

  11682   2 0000A0  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 0000A2  EF80 0000 0000  xsym                 STB,B6   KH_CTLTBL$

      588    11683    1        KL_CONTROL_INIT = KL_CONTROL_CONS;

  11683   2 0000A5  AB80 0000 0000  00                   LAB,B2   KL_ACQUIRE_CONS
          2 0000A8  2C18                                 LDV,R2   24
          2 0000A9  E870 00D2                            LDR,R6   210,IMO
          2 0000AB  BC80 0000 0000  xsym                 LDB,B3   KH_BUF$
          2 0000AE  3C00                                 LDV,R3   0
          2 0000AF  0008                                 MMM

      589    11684    1        KL_CONTROL_INIT.NUM_FPARAM = KH$CTLTBL.HIPARAM;

  11684   2 0000B0  DC80 0000 0000  xsym                 LDB,B5   KH_BUF$
          2 0000B3  CC80 0000 0000  xsym                 LDB,B4   KH_CTLTBL$
          2 0000B6  E804                                 LDR,R6   ,B4
          2 0000B7  EF45 0012                            STR,R6   18,B5

      590    11685    1        KHA_WRITE.BUF_ = VECTOR(KL_CONTROL_INIT);

  11685   2 0000B9  DFC7 00C9                            STB,B5   OPEN+49,AUTO
          2 0000BB  E870 00D1                            LDR,R6   209,IMO
          2 0000BD  EF47 00C8                            STR,R6   OPEN+48,AUTO
          2 0000BF  ABC7 00C8                            LAB,B2   OPEN+48,AUTO
          2 0000C1  2C00                                 LDV,R2   0
          2 0000C2  6C06                                 LDV,R6   6
          2 0000C3  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 0000C6  3C0C                                 LDV,R3   12
          2 0000C7  0008                                 MMM
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:100  

      591    11686    1        CALL M$WRITE(KHA_WRITE);

  11686   2 0000C8  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 0000CB  B870 1543                            LDR,R3   5443,IMO
          2 0000CD  0001                                 MCL
          2 0000CE       0000                            DC       s:11686+6,PREL

      592    11687    1        CALL M$READ(KHA_READ);

  11687   2 0000CF  BB80 0000 0000  xsym                 LAB,B3   KHA_READ
          2 0000D2  B870 1542                            LDR,R3   5442,IMO
          2 0000D4  0001                                 MCL
          2 0000D5       0000                            DC       s:11687+6,PREL

      593    11688
      594    11689    1        IF KL_CONTROL_INIT.TYPE =         1/* There are parameters               */

  11689   2 0000D6  EC80 0000 0000  xsym                 LDB,B6   KH_BUF$
          2 0000D9  E806                                 LDR,R6   ,B6
          2 0000DA  E570 00FF                            AND,R6   255,IMO
          2 0000DC  6D01                                 CMV,R6   1
          2 0000DD  0981 009F                            BNE      s:11722,PREL

      595    11690    2        THEN DO;

      596    11691    2             INIT_CNTL$ = ADDR(KL_CONTROL_INIT.FPARAM);

  11691   2 0000DF  DBC6 0014                            LAB,B5   20,B6
          2 0000E1  DFC7 001F                            STB,B5   INIT_CNTL$,AUTO

      597    11692    2             SIZE = MINIMUM(KH$CTLTBL.HIPARAM,KL_CONTROL_INIT.NUM_FPARAM+
             11692                      KL_CONTROL_INIT.NUM_IPARAM)-1;

  11692   2 0000E3  D846 0012                            LDR,R5   18,B6
          2 0000E5  DA46 0013                            ADD,R5   19,B6
          2 0000E7  CC80 0000 0000  xsym                 LDB,B4   KH_CTLTBL$
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:101  
          2 0000EA  D904                                 CMR,R5   ,B4
          2 0000EB  0A81 0002                            BALE     s:11692+11,PREL
          2 0000ED  D804                                 LDR,R5   ,B4
          2 0000EE  5EFF                                 ADV,R5   -1
          2 0000EF  DF47 0014                            STR,R5   SIZE,AUTO

      598    11693    2             IF KL_CONTROL_INIT.NUM_FPARAM > %KL_ASYNC_SSNMAX THEN

  11693   2 0000F1  C846 0012                            LDR,R4   18,B6
          2 0000F3  4D18                                 CMV,R4   24
          2 0000F4  0381 0006                            BLE      s:11695,PREL

      599    11694    2                  KV_SSNMAX = KL_CONTROL_INIT.FPARAM(%KL_ASYNC_SSNMAX);

  11694   2 0000F6  B846 002C                            LDR,R3   44,B6
          2 0000F8  BF00 0000 0000  xsym                 STR,R3   KV_SSNMAX

      600    11695    2             IF KL_CONTROL_INIT.NUM_FPARAM > %KL_HNDLRPARM_TYPAHDBFRLMT THEN

  11695   2 0000FB  4D05                                 CMV,R4   5
          2 0000FC  0381 0006                            BLE      s:11697,PREL

      601    11696    2                 KV_TYPAHDBFRLMT = KL_CONTROL_INIT.FPARAM(%KL_HNDLRPARM_TYPAHDBFRLMT);

  11696   2 0000FE  E846 0019                            LDR,R6   25,B6
          2 000100  EF00 0000 0000  xsym                 STR,R6   KV_TYPAHDBFRLMT

      602    11697    2             IF KL_CONTROL_INIT.NUM_FPARAM > %KL_HNDLRPARM_IMPTBLMAX THEN

  11697   2 000103  4D19                                 CMV,R4   25
          2 000104  0381 0006                            BLE      s:11699,PREL

      603    11698    2                  KV_MAXUFTSIZ = KL_CONTROL_INIT.FPARAM(%KL_HNDLRPARM_IMPTBLMAX);

  11698   2 000106  E846 002D                            LDR,R6   45,B6
          2 000108  EF00 0000 0000  xsym                 STR,R6   KV_MAXUFTSIZ

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:102  
      604    11699    2             KH_INHLVL = KL_CONTROL_INIT.FPARAM(%KL_HNDLRPARM_INTLVL);

  11699   2 00010B  E846 0014                            LDR,R6   20,B6
          2 00010D  EF00 0000 0002  01                   STR,R6   KH_INHLVL

      605    11700    2             KH_ERRSND = KL_CONTROL_INIT.FPARAM(%KL_HNDLRPARM_ERRSND);

  11700   2 000110  B846 001E                            LDR,R3   30,B6
          2 000112  BF00 0000 0003  01                   STR,R3   KH_ERRSND

      606    11701    3             DO I = 0 TO SIZE;

  11701   2 000115  8747 0015                            CL       I,AUTO
          2 000117  0F81 005F                            B        s:11720+2,PREL

      607    11702    3                  IF I >= %KL_FIXED_HI

  11702   2 000119  E847 0015                            LDR,R6   I,AUTO
          2 00011B  6D1D                                 CMV,R6   29
          2 00011C  0201 0021                            BL       s:11709,PREL

      608    11703    4                  THEN DO;

      609    11704    4                       INDXP# = I - %KL_FIXED_HI;

  11704   2 00011E  6EE3                                 ADV,R6   -29
          2 00011F  EF47 001E                            STR,R6   INDXP#,AUTO

      610    11705    4                       INIT_CNTL$ = PINCRC(ADDR(KL_CONTROL_INIT),

  11705   2 000121  EC80 0000 0000  xsym                 LDB,B6   KH_BUF$
          2 000124  B856                                 LDR,R3   R6
          2 000125  3001                                 SOL,R3   1
          2 000126  3E32                                 ADV,R3   50
          2 000127  A836                                 LDR,R2   ,B6,R3
          2 000128  8C80 0000 0000  xsym                 LDI      KH_BUF$
          2 00012B  7031                                 DCL,R7   1
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:103  
          2 00012C  8D47 00C8                            SDI      OPEN+48,AUTO
          2 00012E  F852                                 LDR,R7   R2
          2 00012F  6C00                                 LDV,R6   0
          2 000130  8447 00C8                            AID      OPEN+48,AUTO
          2 000132  7071                                 DCR,R7   1
          2 000133  8D47 001F                            SDI      INIT_CNTL$,AUTO

      611    11706    4                            KL_CONTROL_INIT.IPARAM.OFFSET(INDXP#));
      612    11707    4                       INDXBND = KL_CONTROL_INIT.IPARAM.ARRAY_SZ(INDXP#);

  11707   2 000135  A847 001E                            LDR,R2   INDXP#,AUTO
          2 000137  2002                                 SOL,R2   2
          2 000138  2E62                                 ADV,R2   98
          2 000139  D2A6                                 LLH,R5   ,B6,R2
          2 00013A  DF47 001D                            STR,R5   INDXBND,AUTO

      613    11708    4                     END;

  11708   2 00013C  0F81 0003                            B        s:11711,PREL

      614    11709    3                  ELSE INDXBND = 0;

  11709   2 00013E  8747 001D                            CL       INDXBND,AUTO

      615    11710
      616    11711    4                  DO INDX = 0 TO INDXBND;

  11711   2 000140  8747 001C                            CL       INDX,AUTO
          2 000142  0F81 002D                            B        s:11718+2,PREL

      617    11712    4                       IF KH$CTLTBL.PARM.PTR$(I) ~= ADDR(NIL)

  11712   2 000144  EC80 0000 0000  xsym                 LDB,B6   KH_CTLTBL$
          2 000147  B847 0015                            LDR,R3   I,AUTO
          2 000149  3F06                                 MLV,R3   6
          2 00014A  5C04                                 LDV,R5   4
          2 00014B  0021                                 ALR      ;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:104  
          2 00014C       4436 0002                                ALPHANUM(2,B6,R3,,4),;
          2 00014E       4007 00C8                                ALPHANUM(OPEN+48,AUTO,,R5,FILL)
          2 000150  437F                                 CSYNC    s:11712+11,SPREL
          2 000151  DCC7 00C8                            LDB,B5   OPEN+48,AUTO
          2 000153  8DD5                                 CMN      B5
          2 000154  0901 000F                            BE       s:11716,PREL

      618    11713    4                       THEN
      619    11714    4                            KH$CTLTBL.PARM.PTR$(I)->WORDARRAY(INDX)

  11714   2 000156  0021                                 ALR      ;
          2 000157       4436 0002                                ALPHANUM(2,B6,R3,,4),;
          2 000159       4007 00C8                                ALPHANUM(OPEN+48,AUTO,,R5,FILL)
          2 00015B  437F                                 CSYNC    s:11714+4,SPREL
          2 00015C  DCC7 00C8                            LDB,B5   OPEN+48,AUTO
          2 00015E  A847 001C                            LDR,R2   INDX,AUTO
          2 000160  CCC7 001F                            LDB,B4   INIT_CNTL$,AUTO
          2 000162  E824                                 LDR,R6   ,B4,R2
          2 000163  EF25                                 STR,R6   ,B5,R2

      620    11715    4                                 = INIT_CNTL$->WORDARRAY(INDX);
      621    11716    4                       IF INDXBND = 0 THEN

  11716   2 000164  E847 001D                            LDR,R6   INDXBND,AUTO
          2 000166  6981 0007                            BNEZ,R6  s:11718,PREL

      622    11717    4                            INIT_CNTL$ = PINCRW(INIT_CNTL$,1);

  11717   2 000168  ECC7 001F                            LDB,B6   INIT_CNTL$,AUTO
          2 00016A  DBC6 0001                            LAB,B5   1,B6
          2 00016C  DFC7 001F                            STB,B5   INIT_CNTL$,AUTO

      623    11718    4                     END/* DO INDX*/;

  11718   2 00016E  8AC7 001C                            INC      INDX,AUTO
          2 000170  E847 001C                            LDR,R6   INDX,AUTO
          2 000172  E947 001D                            CMR,R6   INDXBND,AUTO
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:105  
          2 000174  03D0                                 BLE      s:11712,SPREL

      624    11719
      625    11720    3                END/* DO I */;

  11720   2 000175  8AC7 0015                            INC      I,AUTO
          2 000177  E847 0015                            LDR,R6   I,AUTO
          2 000179  E947 0014                            CMR,R6   SIZE,AUTO
          2 00017B  0381 FF9D                            BLE      s:11702,PREL

      626    11721    2           END/*do if TYPE=1*/;

      627    11722    1        RETURN;

  11722   2 00017D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      628    11723        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:106  
      629    11724        /*F* NAME: KHA$INIT_CHANTBL - Initialize the Channel Table
      630    11725
      631    11726        Device allocation and control is a major function of the handler
      632    11727        administrative routines.  Physical channels are allocated to a handler
      633    11728        by the node administrator based on the resource and attribute the
      634    11729        handler requests.  Once a channel is allocated to a handler,
      635    11730        administrative events (i.e., kill, enable, partition, etc.) are reported
      636    11731        to the handler.  Also the state of a channel is maintained by these
      637    11732        services.  Each channel has a channel table entry which the handler can
      638    11733        read and modify.  (See KH$CHN below.)
      639    11734
      640    11735        The KHA$INIT_CHANTBL routine will
      641    11736
      642    11737        .fif
      643    11738
      644    11739        o acquire resources for the handler based on resource type and
      645    11740          parameters passed
      646    11741
      647    11742        o map the channel tables into the handler's data and initialize
      648    11743          pointers and delimiters relating to the channel table.
      649    11744
      650    11745        .fin
      651    11746
      652    11747        The KHA$INIT_CHANTBL service informs the Node Administrator of
      653    11748        what type of physical devices the handler requests.  This call
      654    11749        does not do the actual allocation of the physical devices.  The
      655    11750        handler will be called later at the administrative entry point
      656    11751        to actually start up the devices.  The handler administrative
      657    11752        point is established via the admin$ parameter on the call
      658    11753        to KHA$INIT.
      659    11754
      660    11755        This service also initializes that static data describing
      661    11756        the channel table.  See KH_CHNDAT below.
      662    11757
      663    11758        The form of this call is:
      664    11759
      665    11760            CALL KHA$INIT_CHANTBL (resource, attribute) ALTRET(label);
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:107  
      666    11761
      667    11762        where:
      668    11763        */
      669    11764        /*K* resource -
      670    11765        is a four character resource type to acquire.  The
      671    11766        last two characters of this field should be blank.
      672    11767        For details on resource types, see the discussion of the NETCON
      673    11768        commands CONFIG and DEFAULT, RESOURCE option, in the CP-6 System
      674    11769        Support Reference (HA20).
      675    11770        */
      676    11771
      677    11772        /*K* attribute -
      678    11773        is a 16 bit field which specifies which of the resources
      679    11774        specified to acquire.  For details on possible attributes, see the
      680    11775        discussion of the NETCON commands CONFIG and DEFAULT, ATTR option, in
      681    11776        the CP-6 System Support Reference (HA20).
      682    11777        A value of 0 means get all the lines
      683    11778        of the resource type specified.  A non-zero ATTR means get
      684    11779        the lines of the resource type specified that also have the
      685    11780        attributes specified.  See the G_ATTR_? subs in G_LCP6_E.
      686    11781        */
      687    11782
      688    11783        /*
      689    11784        Prior to D00, the admin$ was passed as the third parameter
      690    11785        to KHA$INIT_CONTROL.  This routine will still accept that
      691    11786        parameter so we can be backwardly compatable with our own
      692    11787        handlers.
      693    11788        */
      694    11789
      695    11790        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:108  
      696    11791    1   KHA$INIT_CHANTBL: ENTRY(PARM1,PARM2,PARM3) ALTRET;

  11791   2 000180  D380 0000 0000  xent KHA$INIT_CHANTBLLNJ,B5   X6A_AUTO_3
          2 000183       00CD 0003                       DC       205,3

      697    11792    1        PARM1$ = ADDR(PARM1);

  11792   2 000185  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 000187  EFC7 000C                            STB,B6   PARM1$,AUTO

      698    11793    1        PARM2$ = ADDR(PARM2);

  11793   2 000189  DCC7 0006                            LDB,B5   @PARM2,AUTO
          2 00018B  DFC7 000E                            STB,B5   PARM2$,AUTO

      699    11794    1        PARM3$ = ADDR(PARM3);

  11794   2 00018D  CCC7 0008                            LDB,B4   @PARM3,AUTO
          2 00018F  CFC7 0010                            STB,B4   PARM3$,AUTO

      700    11795
      701    11796    1        IF ADDR(PARM3) ~= ADDR(NIL)

  11796   2 000191  8DD4                                 CMN      B4
          2 000192  0901 0005                            BE       s:11798,PREL

      702    11797    1        THEN KH_ADMIN$ = ADMIN_C00$;

  11797   2 000194  BC84                                 LDB,B3   ,B4
          2 000195  BF80 0000 0000  01                   STB,B3   KH_ADMIN$

      703    11798    1        FROMSEG.BASE = %GM_BOBCAT_BASE;

  11798   2 000198  8CF0 000C 0000                       LDI      786432,IMO
          2 00019B  8D00 0000 0005  01                   SDI      FROMSEG

      704    11799    1        USERSEG.BASE = %GM_USRDS4_BASE;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:109  

  11799   2 00019E  8D00 0000 0008  01                   SDI      USERSEG

      705    11800    1        CALL M$CVM (FPT_CVM)

  11800   2 0001A1  BB80 0000 0076  00                   LAB,B3   FPT_CVM
          2 0001A4  B870 0D08                            LDR,R3   3336,IMO
          2 0001A6  0001                                 MCL
          2 0001A7       0003                            DC       s:11802,PREL
          2 0001A8  0F81 0005                            B        s:11806,PREL

      706    11801    2        WHENALTRETURN DO;

      707    11802    2             CALL M$XXX;

  11802   2 0001AA  B870 0082                            LDR,R3   130,IMO
          2 0001AC  0001                                 MCL
          2 0001AD       0000                            DC       s:11802+3,PREL

      708    11803    2           END;

      709    11804
      710    11805        /* Initialize local pointers */
      711    11806    1        KH_CHNLOW = G$BOBCAT.CHNLOW;

  11806   2 0001AE  EC80 0000 0000  xsym                 LDB,B6   G$DS4$
          2 0001B1  E846 0034                            LDR,R6   52,B6
          2 0001B3  EF00 0000 0000  xsym                 STR,R6   KH_CHNLOW

      712    11807    1        KH_CHNLOW$ = G$BOBCAT.CHNLOW$;

  11807   2 0001B6  DCC6 0038                            LDB,B5   56,B6
          2 0001B8  DF80 0000 0000  xsym                 STB,B5   KH_CHNLOW$

      713    11808    1        KH_CHNHI = G$BOBCAT.CHNHI;

  11808   2 0001BB  D846 0035                            LDR,R5   53,B6
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:110  
          2 0001BD  DF00 0000 0000  xsym                 STR,R5   KH_CHNHI

      714    11809    1        KH_CHNHI_R.BTM7 = '1111111'B;

  11809   2 0001C0  8900 0000 0000  xsym                 LBT,'007F'X       KH_CHNHI
  11809   2 0001C3       007F

      715    11810    1        KH_CHNHI$ = G$BOBCAT.CHNHI$;

  11810   2 0001C4  CCC6 003A                            LDB,B4   58,B6
          2 0001C6  CF80 0000 0000  xsym                 STB,B4   KH_CHNHI$

      716    11811    1        KL_ACQUIRE = KL_ACQUIRE_CONS;

  11811   2 0001C9  AB80 0000 0000  00                   LAB,B2   KL_ACQUIRE_CONS
          2 0001CC  2C00                                 LDV,R2   0
          2 0001CD  6C18                                 LDV,R6   24
          2 0001CE  BC80 0000 0000  xsym                 LDB,B3   KH_BUF$
          2 0001D1  3C00                                 LDV,R3   0
          2 0001D2  0008                                 MMM

      717    11812    1        KL_ACQUIRE.RES = RESOURCE;

  11812   2 0001D3  ACC7 000C                            LDB,B2   PARM1$,AUTO
          2 0001D5  2C00                                 LDV,R2   0
          2 0001D6  6C02                                 LDV,R6   2
          2 0001D7  BC80 0000 0000  xsym                 LDB,B3   KH_BUF$
          2 0001DA  3C0C                                 LDV,R3   12
          2 0001DB  0008                                 MMM

      718    11813    1        KL_ACQUIRE.ATTR = ATTR;

  11813   2 0001DC  EC80 0000 0000  xsym                 LDB,B6   KH_BUF$
          2 0001DF  DCC7 000E                            LDB,B5   PARM2$,AUTO
          2 0001E1  E805                                 LDR,R6   ,B5
          2 0001E2  EF46 0007                            STR,R6   7,B6

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:111  
      719    11814    1        KHA_WRITE.BUF_ = VECTOR(KL_ACQUIRE);

  11814   2 0001E4  EFC7 00C9                            STB,B6   OPEN+49,AUTO
          2 0001E6  6C17                                 LDV,R6   23
          2 0001E7  EF47 00C8                            STR,R6   OPEN+48,AUTO
          2 0001E9  ABC7 00C8                            LAB,B2   OPEN+48,AUTO
          2 0001EB  2C00                                 LDV,R2   0
          2 0001EC  6C06                                 LDV,R6   6
          2 0001ED  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 0001F0  3C0C                                 LDV,R3   12
          2 0001F1  0008                                 MMM

      720    11815    1        CALL M$WRITE (KHA_WRITE);

  11815   2 0001F2  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 0001F5  B870 1543                            LDR,R3   5443,IMO
          2 0001F7  0001                                 MCL
          2 0001F8       0000                            DC       s:11815+6,PREL

      721    11816
      722    11817    1        RETURN;

  11817   2 0001F9  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      723    11818        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:112  
      724    11819        /*F* NAME: KHA$INIT_DONE - Handler Initialization Complete
      725    11820
      726    11821        This routine is to be called when the handler specific initialization
      727    11822        is complete and the handler is ready to receive events for the
      728    11823        physical channels that have been assigned to it.
      729    11824
      730    11825        A message is sent to the Node Administrator indicating initialization is complete.
      731    11826        KHA$INIT_DONE then issues a no-wait read to the Node
      732    11827        Administrator for administrative events and returns to the handler.
      733    11828        Once this call is complete the handler is up and running.
      734    11829        The handler may then call KVM$RCV to begin scanning for incoming
      735    11830        messages.
      736    11831
      737    11832        The form of the call for this service is:
      738    11833
      739    11834            CALL KHA$INIT_DONE ALTRET(label);
      740    11835         */
      741    11836
      742    11837    1   KHA$INIT_DONE: ENTRY(PARM1,PARM2,PARM3) ALTRET;

  11837   2 0001FC  D380 0000 0000  xent KHA$INIT_DONE   LNJ,B5   X6A_AUTO_3
          2 0001FF       00CD 0003                       DC       205,3

      743    11838    1        KHA_WRITE.BUF_ = VECTOR(KL_INITDONE);

  11838   2 000201  AB80 0000 0000  03                   LAB,B2   0
          2 000204  2C00                                 LDV,R2   0
          2 000205  6C06                                 LDV,R6   6
          2 000206  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 000209  3C0C                                 LDV,R3   12
          2 00020A  0008                                 MMM

      744    11839    1        CALL M$WRITE(KHA_WRITE);

  11839   2 00020B  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 00020E  B870 1543                            LDR,R3   5443,IMO
          2 000210  0001                                 MCL
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:113  
          2 000211       0000                            DC       s:11839+6,PREL

      745    11840    1        KHA_WRITE.V.DVBYTE.NODAT = '1'B;

  11840   2 000212  8900 0000 0011  xsym                 LBT,'0400'X       KHA_WRITE+17
  11840   2 000215       0400

      746    11841    1        KHA_READ.V.WAIT = '0'B;

  11841   2 000216  8800 0000 000F  xsym                 LBF,'0020'X       KHA_READ+15
  11841   2 000219       0020

      747    11842    1        KHA_READ.V.EVENT = KH_NA_EVENT#;

  11842   2 00021A  E800 0000 000F  01                   LDR,R6   KH_NA_EVENT#
          2 00021D  EF00 0000 0010  xsym                 STR,R6   KHA_READ+16

      748    11843    1        CALL M$READ(KHA_READ);

  11843   2 000220  BB80 0000 0000  xsym                 LAB,B3   KHA_READ
          2 000223  B870 1542                            LDR,R3   5442,IMO
          2 000225  0001                                 MCL
          2 000226       0000                            DC       s:11843+6,PREL

      749    11844    1        RETURN;

  11844   2 000227  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      750    11845        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:114  
      751    11846        /*F* NAME: KHA$ERRLOG - Write Error Log Entry
      752    11847
      753    11848        This routine will cause an error log entry as described by the
      754    11849        FPT_WRSYSLOG structure to be sent to the HOST.
      755    11850
      756    11851        The alternate return is taken if the error log cannot
      757    11852        be forwarded and there is not enough memory
      758    11853        to save it for retransmission later.
      759    11854
      760    11855        The form of the call for this service is:
      761    11856
      762    11857            CALL KHA$ERRLOG(FPT_WRSYSLOG, noretran) ALTRET (label);
      763    11858
      764    11859        where:
      765    11860        */
      766    11861        /*K* FPT_WRSYSLOG -
      767    11862        is the FPT structure used by the M$WRSYSLOG monitor service.
      768    11863        The FPT_WRSYSLOG from the LCP_6 INCLUDE should be used
      769    11864        to generate this structure.
      770    11865
      771    11866        Options on the FPT_WRSYSLOG macro are as follows:
      772    11867        */
      773    11868        /*K* FPT_WRSYSLOG.BUF = VARIABLE.
      774    11869        .XEQ GT_LCP6_M M$WRSYSLOG BUF
      775    11870        */
      776    11871        /*K* FPT_WRSYSLOG.FCG, MID, SEV, and ERR -
      777    11872        .XEQ GT_LCP6_M M$WRSYSLOG FCG
      778    11873
      779    11874        The SEVerity specified must
      780    11875        equal or exceed the ERRSND control parameter value set for this
      781    11876        handler or the error will not be logged.
      782    11877        */
      783    11878        /*K* FPT_WRSYSLOG.TERMINAL_ID.
      784    11879        .XEQ GT_LCP6_M M$WRSYSLOG TERMINAL_ID
      785    11880        */
      786    11881        /*K* FPT_WRSYSLOG.VALUES = ARRAY(0:3) UBIN.
      787    11882        .XEQ GT_LCP6_M M$WRSYSLOG VALUES
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:115  
      788    11883        */
      789    11884
      790    11885        /*K* noretran -
      791    11886        specifies that that retransmission is not to be attempted
      792    11887        if the errorlog entry cannot immediately be forwarded to
      793    11888        the host.
      794    11889        Absence of this parameter implies YES.
      795    11890        */
      796    11891
      797    11892    1   KHA$ERRLOG: ENTRY(PARM1,PARM2) ALTRET;

  11892   2 00022A  D380 0000 0000  xent KHA$ERRLOG      LNJ,B5   X6A_AUTO_3
          2 00022D       00CD 0003                       DC       205,3

      798    11893
      799    11894    1        INHIBIT_LEVEL = KH_INHLVL;

  11894   2 00022F  E800 0000 0002  01                   LDR,R6   KH_INHLVL
          2 000232  EF47 000A                            STR,R6   INHIBIT_LEVEL,AUTO

      800    11895             %DISABLE;

  11896   2 000234  EF47 000B                            STR,R6   DISABLE_LEVEL,AUTO

  11897   2 000236  EBC7 000B                            LAB,B6   DISABLE_LEVEL,AUTO
          2 000238  EFC7 00C8                            STB,B6   OPEN+48,AUTO
          2 00023A  BBC7 00C8                            LAB,B3   OPEN+48,AUTO
          2 00023C  CBF0 0100                            LAB,B4   256,IMO
          2 00023E  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000241       0001                            DC       s:11899,PREL

      801    11899    1        PARM1$ = ADDR(PARM1);

  11899   2 000242  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 000244  EFC7 000C                            STB,B6   PARM1$,AUTO

      802    11900    1        IF FPT$WRSYSLOG.V.ERRCODE.SEV < KH_ERRSND
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:116  

  11900   2 000246  E846 0007                            LDR,R6   7,B6
          2 000248  E570 0007                            AND,R6   7,IMO
          2 00024A  E900 0000 0003  01                   CMR,R6   KH_ERRSND
          2 00024D  0281 0010                            BGE      s:11911,PREL

      803    11901    2        THEN DO;

      804    11902                  %ENABLE;

  11903   2 00024F  D847 000B                            LDR,R5   DISABLE_LEVEL,AUTO
          2 000251  D947 000A                            CMR,R5   INHIBIT_LEVEL,AUTO
          2 000253  0901 0007                            BE       s:11908,PREL

  11905   2 000255  CBF0 0000                            LAB,B4   0,IMO
          2 000257  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00025A       0001                            DC       s:11908,PREL

      805    11908    2             RETURN;

  11908   2 00025B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      806    11909    2           END;
      807    11910
      808    11911    1        KL$SYSLOG.FCN = IGA_SYSLOG;

  11911   2 00025E  5C27                                 LDV,R5   39
          2 00025F  D7C7 0021                            STH,R5   KL$SYSLOG,AUTO

      809    11912    1        KL$SYSLOG.FILENUM = 1;

  11912   2 000261  6C01                                 LDV,R6   1
          2 000262  EAC7 0022                            SRM,R6,'00FF'X    KL$SYSLOG+1,AUTO
          2 000264       00FF

      810    11913    1        KL$SYSLOG.ERRLOG.DATA_SIZE = 0;

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:117  
  11913   2 000265  87C7 0033                            CLH      KL$SYSLOG+18,AUTO

      811    11914    1        KL$SYSLOG.ERRLOG.ERRCODE = ADDR(PARM1)->FPT$WRSYSLOG.V.ERRCODE;

  11914   2 000267  8CC6 0006                            LDI      6,B6
          2 000269  8D47 0023                            SDI      KL$SYSLOG+2,AUTO

      812    11915    1        KL$SYSLOG.ERRLOG.VALUES = ADDR(PARM1)->FPT$WRSYSLOG.V.VALUES;

  11915   2 00026B  AB86                                 LAB,B2   ,B6
          2 00026C  2C20                                 LDV,R2   32
          2 00026D  6C08                                 LDV,R6   8
          2 00026E  BB87                                 LAB,B3   ,AUTO
          2 00026F  3C5E                                 LDV,R3   94
          2 000270  0008                                 MMM

      813    11916    1        KL$SYSLOG.ERRLOG.TERMID = ADDR(PARM1)->FPT$WRSYSLOG.V.TERMID;

  11916   2 000271  2C10                                 LDV,R2   16
          2 000272  6C10                                 LDV,R6   16
          2 000273  BB87                                 LAB,B3   ,AUTO
          2 000274  3C4E                                 LDV,R3   78
          2 000275  0008                                 MMM

      814    11917    1        CALL KHC$UTS (KL$SYSLOG.ERRLOG.UTS);

  11917   2 000276  DBC7 0025                            LAB,B5   KL$SYSLOG+4,AUTO
          2 000278  DFC7 00C8                            STB,B5   OPEN+48,AUTO
          2 00027A  BBC7 00C8                            LAB,B3   OPEN+48,AUTO
          2 00027C  CBF0 0100                            LAB,B4   256,IMO
          2 00027E  E380 0000 0000  xent                 LNJ,B6   KHC$UTS
          2 000281       0001                            DC       s:11918,PREL

      815    11918    1        IF FPT$WRSYSLOG.BUF_ ~= VECTOR(NIL)

  11918   2 000282  ECC7 000C                            LDB,B6   PARM1$,AUTO
          2 000284  DB80 0000 0000  03                   LAB,B5   0
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:118  
          2 000287  5C06                                 LDV,R5   6
          2 000288  0022                                 ACM      ;
          2 000289       4606 0003                                ALPHANUM(3,B6,,6,FILL),;
          2 00028B       4005 0003                                ALPHANUM(3,B5,,R5,FILL)
          2 00028D  5381 0027                            CBE      s:11925,PREL

      816    11919    2        THEN DO;

      817    11920    2             KL$SYSLOG.ERRLOG.DATA_SIZE = VBOUND(ADDR(PARM1)->FPT$WRSYSLOG.BUF_)+1;

  11920   2 00028F  DCC7 0004                            LDB,B5   @PARM1,AUTO
          2 000291  E845 0003                            LDR,R6   3,B5
          2 000293  6E01                                 ADV,R6   1
          2 000294  E7C7 0033                            STH,R6   KL$SYSLOG+18,AUTO

      818    11921    2             SIZE = KL$SYSLOG.ERRLOG.DATA_SIZE;

  11921   2 000296  E2C7 0033                            LLH,R6   KL$SYSLOG+18,AUTO
          2 000298  EF47 0014                            STR,R6   SIZE,AUTO

      819    11922    2             KL$SYSLOG.ERRLOG.MSG = VBASE(FPT$WRSYSLOG.BUF_)->ERRMSG;

  11922   2 00029A  8CC6 0004                            LDI      4,B6
          2 00029C  B856                                 LDR,R3   R6
          2 00029D  E570 7FFF                            AND,R6   32767,IMO
          2 00029F  8D47 00C8                            SDI      OPEN+48,AUTO
          2 0002A1  CCC7 00C8                            LDB,B4   OPEN+48,AUTO
          2 0002A3  304F                                 SOR,R3   15
          2 0002A4  BF47 00CA                            STR,R3   OPEN+50,AUTO
          2 0002A6  CFC7 00CB                            STB,B4   OPEN+51,AUTO
          2 0002A8  AB84                                 LAB,B2   ,B4
          2 0002A9  A853                                 LDR,R2   R3
          2 0002AA  E847 0014                            LDR,R6   SIZE,AUTO
          2 0002AC  BB87                                 LAB,B3   ,AUTO
          2 0002AD  3C67                                 LDV,R3   103
          2 0002AE  F870 00C8                            LDR,R7   200,IMO
          2 0002B0  D380 0000 0000  xent                 LNJ,B5   X6C_ALR
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:119  

      820    11923    2           END;

  11923   2 0002B3  0F81 0003                            B        s:11926,PREL

      821    11924    1        ELSE
      822    11925    1             SIZE = 0;

  11925   2 0002B5  8747 0014                            CL       SIZE,AUTO

      823    11926    1        KHA_WRITE.BUF_ = VECTOR(KL$SYSLOG);

  11926   2 0002B7  EBC7 0021                            LAB,B6   KL$SYSLOG,AUTO
          2 0002B9  EFC7 00C9                            STB,B6   OPEN+49,AUTO
          2 0002BB  E870 00ED                            LDR,R6   237,IMO
          2 0002BD  EF47 00C8                            STR,R6   OPEN+48,AUTO
          2 0002BF  ABC7 00C8                            LAB,B2   OPEN+48,AUTO
          2 0002C1  2C00                                 LDV,R2   0
          2 0002C2  6C06                                 LDV,R6   6
          2 0002C3  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 0002C6  3C0C                                 LDV,R3   12
          2 0002C7  0008                                 MMM

      824    11927    1        VBOUND(KHA_WRITE.BUF_) = SIZEC(KL$SYSLOG) + SIZE - SIZEC(KL$SYSLOG.ERRLOG.MSG)
             11927                 - 1;

  11927   2 0002C8  E847 0014                            LDR,R6   SIZE,AUTO
          2 0002CA  6E25                                 ADV,R6   37
          2 0002CB  EF00 0000 0006  xsym                 STR,R6   KHA_WRITE+6

      825    11928    1        IF KH_FLDWRTS > 0 THEN

  11928   2 0002CE  D800 0000 0004  01                   LDR,R5   KH_FLDWRTS
          2 0002D1  5A81 0034                            BLEZ,R5  s:11953,PREL

      826    11929    2        DO;

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:120  
      827    11930    2             IF ADDR(PARM2) ~= ADDR(NIL) AND PARM2 ~= 0 THEN

  11930   2 0002D3  ECC7 0006                            LDB,B6   @PARM2,AUTO
          2 0002D5  8DD6                                 CMN      B6
          2 0002D6  0901 0013                            BE       s:11940,PREL
          2 0002D8  C806                                 LDR,R4   ,B6
          2 0002D9  4901 0010                            BEZ,R4   s:11940,PREL

      828    11931    3             DO;

      829    11932                       %ENABLE;

  11933   2 0002DB  B847 000B                            LDR,R3   DISABLE_LEVEL,AUTO
          2 0002DD  B947 000A                            CMR,R3   INHIBIT_LEVEL,AUTO
          2 0002DF  0901 0007                            BE       s:11938,PREL

  11935   2 0002E1  CBF0 0000                            LAB,B4   0,IMO
          2 0002E3  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0002E6       0001                            DC       s:11938,PREL

      830    11938    3                  ALTRETURN;

  11938   2 0002E7  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      831    11939    3                END;
      832    11940    2             CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  11940   2 0002EA  BB80 0000 0006  03                   LAB,B3   +6
          2 0002ED  CBF0 0100                            LAB,B4   256,IMO
          2 0002EF  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 0002F2       0003                            DC       s:11943,PREL
          2 0002F3  0F81 0010                            B        s:11950,PREL

      833    11941    3             DO;

      834    11942                       %ENABLE;

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:121  
  11943   2 0002F5  E847 000B                            LDR,R6   DISABLE_LEVEL,AUTO
          2 0002F7  E947 000A                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 0002F9  0901 0007                            BE       s:11948,PREL

  11945   2 0002FB  CBF0 0000                            LAB,B4   0,IMO
          2 0002FD  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000300       0001                            DC       s:11948,PREL

      835    11948    3                  ALTRETURN;

  11948   2 000301  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      836    11949    3                END;
      837    11950    2           END;

  11950   2 000304  0F81 0038                            B        s:11982,PREL

      838    11951    1        ELSE
      839    11952    2        DO;

      840    11953    2             CALL M$WRITE(KHA_WRITE) WHENALTRETURN

  11953   2 000306  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 000309  B870 1543                            LDR,R3   5443,IMO
          2 00030B  0001                                 MCL
          2 00030C       0003                            DC       s:11955,PREL
          2 00030D  0F81 002F                            B        s:11982,PREL

      841    11954    3             DO;

      842    11955    3                  IF ADDR(PARM2) ~= ADDR(NIL) THEN

  11955   2 00030F  ECC7 0006                            LDB,B6   @PARM2,AUTO
          2 000311  8DD6                                 CMN      B6
          2 000312  0901 0010                            BE       s:11967,PREL

      843    11956    4                  DO;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:122  

      844    11957                            %ENABLE;

  11958   2 000314  E847 000B                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000316  E947 000A                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 000318  0901 0007                            BE       s:11963,PREL

  11960   2 00031A  CBF0 0000                            LAB,B4   0,IMO
          2 00031C  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00031F       0001                            DC       s:11963,PREL

      845    11963    4                       ALTRETURN;

  11963   2 000320  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      846    11964    4                     END;
      847    11965    3                  ELSE
      848    11966    4                  DO;

      849    11967    4                       CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  11967   2 000323  BB80 0000 0006  03                   LAB,B3   +6
          2 000326  CBF0 0100                            LAB,B4   256,IMO
          2 000328  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 00032B       0003                            DC       s:11970,PREL
          2 00032C  0F81 0010                            B        s:11982,PREL

      850    11968    5                       DO;

      851    11969                                 %ENABLE;

  11970   2 00032E  E847 000B                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000330  E947 000A                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 000332  0901 0007                            BE       s:11975,PREL

  11972   2 000334  CBF0 0000                            LAB,B4   0,IMO
          2 000336  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:123  
          2 000339       0001                            DC       s:11975,PREL

      852    11975    5                            ALTRETURN;

  11975   2 00033A  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      853    11976    5                          END;
      854    11977    4                     END;

      855    11978    3                END;

      856    11979    2           END;

      857    11980
      858    11981             %ENABLE;

  11982   2 00033D  E847 000B                            LDR,R6   DISABLE_LEVEL,AUTO
          2 00033F  E947 000A                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 000341  0901 0007                            BE       s:11987,PREL

  11984   2 000343  CBF0 0000                            LAB,B4   0,IMO
          2 000345  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000348       0001                            DC       s:11987,PREL

      859    11987    1        RETURN;

  11987   2 000349  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      860    11988
      861    11989        %EJECT;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:124  
      862    11990        /*F* NAME: KHA$SNDSTT - Write Statistical Data
      863    11991
      864    11992        This routine copies the information from the
      865    11993        request statistics message into the the statistics
      866    11994        buffer and forwards the message on to the host.  The
      867    11995        altreturn is taken when the message cannot be forwarded.
      868    11996
      869    11997        The form of this call is:
      870    11998
      871    11999            CALL KHA$SNDSTT (request_stats, stats_buffer) ALTRET(label);
      872    12000
      873    12001        where:
      874    12002        */
      875    12003        /*K* request_stats -
      876    12004        is the buffer that was passed to the handler's routine
      877    12005        when the request for statistics was received.  The buffer
      878    12006        is in the form of the KL_REQSTATS message.
      879    12007        */
      880    12008
      881    12009        /*K* stats_buffer -
      882    12010        is the statistics buffer to be sent to the host.  This buffer
      883    12011        is also in the form of the KL_REQSTATS message.
      884    12012        */
      885    12013
      886    12014
      887    12015    1   KHA$SNDSTT: ENTRY(PARM1,PARM2) ALTRET;

  12015   2 00034C  D380 0000 0000  xent KHA$SNDSTT      LNJ,B5   X6A_AUTO_3
          2 00034F       00CD 0003                       DC       205,3

      888    12016    1        PARM1$ = ADDR(PARM1);

  12016   2 000351  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 000353  EFC7 000C                            STB,B6   PARM1$,AUTO

      889    12017    1        PARM2C$ = VBASE(ADDR(PARM2)->B$VECT);

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:125  
  12017   2 000355  DCC7 0006                            LDB,B5   @PARM2,AUTO
          2 000357  8CC5 0001                            LDI      1,B5
          2 000359  8D47 000E                            SDI      PARM2$,AUTO

      890    12018    1        PARM2$->KL$REQSTATS.FEPNAME = PARM1$->KL$REQSTATS.FEPNAME;

  12018   2 00035B  AB86                                 LAB,B2   ,B6
          2 00035C  2C10                                 LDV,R2   16
          2 00035D  6C08                                 LDV,R6   8
          2 00035E  BCC7 000E                            LDB,B3   PARM2$,AUTO
          2 000360  3C10                                 LDV,R3   16
          2 000361  0008                                 MMM

      891    12019    1        PARM2$->KL$REQSTATS.SRCE_NODE = PARM1$->KL$REQSTATS.SRCE_NODE;

  12019   2 000362  CCC7 000C                            LDB,B4   PARM1$,AUTO
          2 000364  E2C4 0001                            LLH,R6   1,B4
          2 000366  BCC7 000E                            LDB,B3   PARM2$,AUTO
          2 000368  E7C3 0001                            STH,R6   1,B3

      892    12020    1        PARM2$->KL$REQSTATS.HANDLER = PARM1$->KL$REQSTATS.HANDLER;

  12020   2 00036A  AB84                                 LAB,B2   ,B4
          2 00036B  2C18                                 LDV,R2   24
          2 00036C  6C08                                 LDV,R6   8
          2 00036D  3C18                                 LDV,R3   24
          2 00036E  0008                                 MMM

      893    12021    1        PARM2$->KL$REQSTATS.NODE_NUM = PARM1$->KL$REQSTATS.NODE_NUM;

  12021   2 00036F  BCC7 000C                            LDB,B3   PARM1$,AUTO
          2 000371  9CC7 000E                            LDB,B1   PARM2$,AUTO
          2 000373  E803                                 LDR,R6   ,B3
          2 000374  EA81                                 SRM,R6,'00FF'X    ,B1
          2 000375       00FF

      894    12022    1        PARM2$->KL$REQSTATS.STATSSTA = PARM1$->KL$REQSTATS.STATSSTA;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:126  

  12022   2 000376  AB83                                 LAB,B2   ,B3
          2 000377  2C08                                 LDV,R2   8
          2 000378  6C08                                 LDV,R6   8
          2 000379  BB81                                 LAB,B3   ,B1
          2 00037A  3C08                                 LDV,R3   8
          2 00037B  0008                                 MMM

      895    12023    1        PARM2$->KL$REQSTATS.FNC = IGA_REQSTATS;

  12023   2 00037C  6C24                                 LDV,R6   36
          2 00037D  ACC7 000E                            LDB,B2   PARM2$,AUTO
          2 00037F  E782                                 STH,R6   ,B2

      896    12024    1        KHA_WRITE.BUF_ = ADDR(PARM2)->B$VECT;

  12024   2 000380  AB85                                 LAB,B2   ,B5
          2 000381  2C00                                 LDV,R2   0
          2 000382  6C06                                 LDV,R6   6
          2 000383  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 000386  3C0C                                 LDV,R3   12
          2 000387  0008                                 MMM

      897    12025    1        IF KH_FLDWRTS > 0 THEN

  12025   2 000388  E800 0000 0004  01                   LDR,R6   KH_FLDWRTS
          2 00038B  6A81 001D                            BLEZ,R6  s:12037,PREL

      898    12026    1             CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  12026   2 00038D  BB80 0000 0006  03                   LAB,B3   +6
          2 000390  CBF0 0100                            LAB,B4   256,IMO
          2 000392  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 000395       0003                            DC       s:12029,PREL
          2 000396  0F81 0010                            B        s:12034+3,PREL

      899    12027    2             DO;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:127  

      900    12028                       %ENABLE;

  12029   2 000398  E847 000B                            LDR,R6   DISABLE_LEVEL,AUTO
          2 00039A  E947 000A                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 00039C  0901 0007                            BE       s:12034,PREL

  12031   2 00039E  CBF0 0000                            LAB,B4   0,IMO
          2 0003A0  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0003A3       0001                            DC       s:12034,PREL

      901    12034    2                  ALTRETURN;

  12034   2 0003A4  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
          2 0003A7  0F81 0024                            B        s:12050,PREL

      902    12035    2                END;
      903    12036    1        ELSE
      904    12037    1             CALL M$WRITE(KHA_WRITE) WHENALTRETURN

  12037   2 0003A9  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          2 0003AC  B870 1543                            LDR,R3   5443,IMO
          2 0003AE  0001                                 MCL
          2 0003AF       0003                            DC       s:12039,PREL
          2 0003B0  0F81 001B                            B        s:12050,PREL

      905    12038    2             DO;

      906    12039    2                  CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  12039   2 0003B2  BB80 0000 0006  03                   LAB,B3   +6
          2 0003B5  CBF0 0100                            LAB,B4   256,IMO
          2 0003B7  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          2 0003BA       0003                            DC       s:12042,PREL
          2 0003BB  0F81 0010                            B        s:12050,PREL

      907    12040    3                  DO;
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:128  

      908    12041                            %ENABLE;

  12042   2 0003BD  E847 000B                            LDR,R6   DISABLE_LEVEL,AUTO
          2 0003BF  E947 000A                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 0003C1  0901 0007                            BE       s:12047,PREL

  12044   2 0003C3  CBF0 0000                            LAB,B4   0,IMO
          2 0003C5  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0003C8       0001                            DC       s:12047,PREL

      909    12047    3                       ALTRETURN;

  12047   2 0003C9  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      910    12048    3                     END;
      911    12049    2                END;

      912    12050    1        RETURN;

  12050   2 0003CC  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      913    12051    1   END KHA$INIT;
      914    12052        %EOD;

PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:129  
--  Include file information  --

   KH_CHN.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   GM_VIRTUAL_E.:E05TOU  is referenced.
   G$BOBCAT_M.:E05TOU  is referenced.
      No diagnostics issued in procedure KHA$INIT.
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:130  

 **** Variables and constants ****

  ****  Section 000 RoData KHA$INIT

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    CD-0-0/c STRC(40)    r     1 DCB_NA                    76-0-0/w STRC(192)   r     1 FPT_CVM
    B9-0-0/w STRC(128)   r     1 FPT_EVENT                 8A-0-0/w STRC(752)   r     1 FPT_OPEN
    C1-0-0/w STRC(192)   r     1 GETDCB                    82-0-0/w STRC(128)   r     1 KHA_GETBUF
     0-0-0/w STRC(192)   r     1 KL_ACQUIRE_CONS            C-0-0/w STRC(1680)  r     1 KL_CONTROL_CONS
    75-0-0/w STRC(16)    r     1 KL_INITDONE

  ****  Section 001  Data  KHA$INIT

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w STRC(48)    r     1 FROMSEG                    B-0-0/w STRC(48)    r     1 KHA_BUFSEG
     0-0-0/w EPTR        r     1 KH_ADMIN$                  3-0-0/w UBIN(16)    r     1 KH_ERRSND
     4-0-0/w SBIN(16)    r     1 KH_FLDWRTS                 2-0-0/w UBIN(16)    r     1 KH_INHLVL
     E-0-0/w UBIN(16)    r     1 KH_NA_DCB#                 F-0-0/w UBIN(16)    r     1 KH_NA_EVENT#
    10-0-0/w EPTR        r     1 KH_WLCLKENT$               8-0-0/w STRC(48)    r     1 USERSEG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PARM1                     6-0-0/w PTR         r     1 @PARM2
     8-0-0/w PTR         r     1 @PARM3                    12-0-0/w PTR         r     1 CHN$
     B-0-0/w UBIN(16)    r     1 DISABLE_LEVEL             15-0-0/w UBIN(16)    r     1 I
    1C-0-0/w UBIN(16)    r     1 INDX                      1D-0-0/w UBIN(16)    r     1 INDXBND
    1E-0-0/w UBIN(16)    r     1 INDXP#                     A-0-0/w UBIN(16)    r     1 INHIBIT_LEVEL
    1F-0-0/w PTR         r     1 INIT_CNTL$                21-0-0/w STRC(1904)  r     1 KL$SYSLOG
    98-0-0/w STRC(752)   r     1 OPEN                      *0-0-0/w UBIN(16)    r     1 PARM1
     C-0-0/w PTR         r     1 PARM1$                    *0-0-0/w UBIN(16)    r     1 PARM2
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:131  
     E-0-0/w PTR         r     1 PARM2$                     E-0-0/w PTR         r     1 PARM2C$
    *0-0-0/w UBIN(16)    r     1 PARM3                     10-0-0/w PTR         r     1 PARM3$
    14-0-0/w UBIN(16)    r     1 SIZE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$DS4$                     0-0-0/w STRC(288)   r     1 KHA_READ
     0-0-0/w STRC(288)   r     1 KHA_WRITE                  0-0-0/w PTR         r     1 KH_BUF$
     0-0-0/w UBIN(16)    r     1 KH_CHNHI                   0-0-0/w PTR         r     1 KH_CHNHI$
     0-0-0/w STRC(16)    r     1 KH_CHNHI_R                 0-0-0/w UBIN(16)    r     1 KH_CHNLOW
     0-0-0/w PTR         r     1 KH_CHNLOW$                 0-0-0/w PTR         r     1 KH_CTLTBL$
     0-0-0/w UBIN(16)    r     1 KH_NODE#                   0-0-0/w UBIN(16)    r     1 KV_MAXUFTSIZ
     0-0-0/w UBIN(16)    r     1 KV_SSNMAX                  0-0-0/w UBIN(16)    r     1 KV_TYPAHDBFRLMT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w EPTR        r     1 ADMIN$                     0-0-0/w EPTR        r     1 ADMIN_C00$
     0-0-0/w BIT (16)    r     1 ATTR                       0-0-0/w VECT        r     1 B$VECT
     0-0-0/c ACHR        r     1 ERRMSG                     0-0-0/w ASTR(808)   r     1 F$DCB
     0-0-0/w STRC(336)   r     1 FPT$WRSYSLOG               0-0-0/w STRC(1696)  r     1 G$BOBCAT
     0-0-0/w STRC(64)    r     1 KH$CTLTBL                  0-0-0/w STRC(320)   r     1 KL$REQSTATS
     0-0-0/w STRC(192)   r     1 KL_ACQUIRE                 0-0-0/w STRC(1680)  r     1 KL_CONTROL_INIT
     0-0-0/c CHAR(2)     r     1 RESOURCE                   0-0-0/w EPTR        r     1 WLCLKENT$
     0-0-0/w UBIN(16)    r     1 WORDARRAY(0:0)


   Procedure KHA$INIT requires 975 words for executable code.
   Procedure KHA$INIT requires 205 words of local(AUTO) storage.
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:132  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:133  
          MINI XREF LISTING

ADMIN$
     10825**DCL     11616>>ASSIGN
ADMIN_C00$
     11469**DCL     11797>>ASSIGN
ATTR
     10823**DCL     11813>>ASSIGN
B$VECT
     10298**DCL     12017>>ASSIGN  12024>>ASSIGN
CHN$
     10240**DCL     10843--IMP-PTR
DCB_NA
     11464**DCL     11445--DCLINIT
DISABLE_LEVEL
      9379**DCL     11896<<ASSIGN  11897<>CALL    11903>>IF      11933>>IF      11943>>IF      11958>>IF
     11970>>IF      11982>>IF      12029>>IF      12042>>IF
ERRMSG
     10432**DCL     11922>>ASSIGN
F$DCB.DCBNAME.L
     11519**DCL     11519--IMP-SIZ
F$DCB.EOMCHAR
     11510**DCL     11510--REDEF   11511--REDEF
F$DCB.FLDID
     11509**DCL     11509--REDEF
F$DCB.RES
     11504**DCL     11505--REDEF
F$DCB.RLCID.NODE
     11514**DCL     11602>>ASSIGN
FPT$WRSYSLOG.BUF_
     10448**DCL     11918>>IF      11920>>ASSIGN  11922>>ASSIGN
FPT$WRSYSLOG.V.ERRCODE
     10467**DCL     11914>>ASSIGN
FPT$WRSYSLOG.V.ERRCODE.SEV
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:134  
     10495**DCL     11900>>IF
FPT$WRSYSLOG.V.TERMID
     10513**DCL     11916>>ASSIGN
FPT$WRSYSLOG.V.TERMID.TERM
     10515**DCL     10524--REDEF
FPT$WRSYSLOG.V.VALUES
     10526**DCL     11915>>ASSIGN
FPT_CVM
     11182**DCL     11800<>CALL
FPT_CVM.V
     11186**DCL     11185--DCLINIT
FPT_EVENT
     11410**DCL     11623<>CALL
FPT_EVENT.V
     11423**DCL     11414--DCLINIT
FPT_EVENT.V_
     11414**DCL     11414--REDEF
FPT_OPEN
     11295**DCL     11596>>ASSIGN
FPT_OPEN.V
     11303**DCL     11297--DCLINIT
FROMSEG
     11231**DCL     11185--DCLINIT
FROMSEG.BASE
     11235**DCL     11235--REDEF   11798<<ASSIGN
G$BOBCAT.CHNHI
     10118**DCL     11808>>ASSIGN
G$BOBCAT.CHNHI$
     10119**DCL     11810>>ASSIGN
G$BOBCAT.CHNLOW
     10118**DCL     11806>>ASSIGN
G$BOBCAT.CHNLOW$
     10119**DCL     11807>>ASSIGN
G$DS4$
     11166**DCL     10112--IMP-PTR 11806>>ASSIGN  11807>>ASSIGN  11808>>ASSIGN  11810>>ASSIGN
GETDCB
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:135  
     11443**DCL     11593<>CALL
GETDCB.V
     11447**DCL     11445--DCLINIT
I
     10242**DCL     11701<<DOINDEX 11702>>IF      11704>>ASSIGN  11712>>IF      11714>>ASSIGN
INDX
     10292**DCL     11711<<DOINDEX 11714>>ASSIGN  11714>>ASSIGN
INDXBND
     10293**DCL     11707<<ASSIGN  11709<<ASSIGN  11711>>DOINDEX 11716>>IF
INDXP#
     10294**DCL     11704<<ASSIGN  11705>>ASSIGN  11707>>ASSIGN
INHIBIT_LEVEL
      9376**DCL     11894<<ASSIGN  11896>>ASSIGN  11903>>IF      11933>>IF      11943>>IF      11958>>IF
     11970>>IF      11982>>IF      12029>>IF      12042>>IF
INIT_CNTL$
     10295**DCL     11691<<ASSIGN  11705<<ASSIGN  11714>>ASSIGN  11717<<ASSIGN  11717>>ASSIGN
KH$CHN.TERMID.TERM
     10939**DCL     10948--REDEF
KH$CTLTBL.HIPARAM
     10970**DCL     11684>>ASSIGN  11692>>ASSIGN
KH$CTLTBL.PARM.PTR$
     11095**DCL     11712>>IF      11714>>ASSIGN
KHA$ASYNC
     11527**DCL-ENT 11425--DCLINIT
KHA$SETCLK
     11528**DCL-ENT 11940--CALL    11967--CALL    12026--CALL    12039--CALL
KHA_BUFSEG
     11273**DCL     11209--DCLINIT
KHA_BUFSEG.BASE
     11277**DCL     11277--REDEF
KHA_BUFSEG.BASE$
     11277**DCL     11607>>ASSIGN
KHA_BUFSEG.PAGES
     11277**DCL     11609>>ASSIGN
KHA_GETBUF
     11206**DCL     11603<>CALL
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:136  
KHA_GETBUF.V
     11209**DCL     11209--DCLINIT
KHA_READ
     11375**DCL     11687<>CALL    11843<>CALL
KHA_READ.BUF_
     11377**DCL     11608<<ASSIGN  11609<<ASSIGN
KHA_READ.V.DCB#
     11380**DCL     11599<<ASSIGN
KHA_READ.V.EVENT
     11382**DCL     11842<<ASSIGN
KHA_READ.V.WAIT
     11381**DCL     11841<<ASSIGN
KHA_WRITE
     11351**DCL     11686<>CALL    11815<>CALL    11839<>CALL    11940<>CALL    11953<>CALL    11967<>CALL
     12026<>CALL    12037<>CALL    12039<>CALL
KHA_WRITE.BUF_
     11353**DCL     11685<<ASSIGN  11814<<ASSIGN  11838<<ASSIGN  11926<<ASSIGN  11927<<ASSIGN  12024<<ASSIGN
KHA_WRITE.V.DCB#
     11356**DCL     11600<<ASSIGN
KHA_WRITE.V.DVBYTE.NODAT
     11359**DCL     11840<<ASSIGN
KHC$UTS
     11529**DCL-ENT 11917--CALL
KHI$DISABLE
      9373**DCL-ENT 11897--CALL
KHI$ENABLE
      9372**DCL-ENT 11905--CALL    11935--CALL    11945--CALL    11960--CALL    11972--CALL    11984--CALL
     12031--CALL    12044--CALL
KH_ADMIN$
     10222**DCL     11616<<ASSIGN  11797<<ASSIGN
KH_BUF$
     10226**DCL      9543--IMP-PTR  9801--IMP-PTR  9906--IMP-PTR 11607<<ASSIGN  11608>>ASSIGN  11683>>ASSIGN
     11684>>ASSIGN  11685>>ASSIGN  11689>>IF      11691>>ASSIGN  11692>>ASSIGN  11692>>ASSIGN  11693>>IF
     11694>>ASSIGN  11695>>IF      11696>>ASSIGN  11697>>IF      11698>>ASSIGN  11699>>ASSIGN  11700>>ASSIGN
     11705>>ASSIGN  11705>>ASSIGN  11707>>ASSIGN  11811>>ASSIGN  11812>>ASSIGN  11813>>ASSIGN  11814>>ASSIGN
KH_CHNHI
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:137  
     10217**DCL     10218--REDEF   11808<<ASSIGN
KH_CHNHI$
     10217**DCL     11810<<ASSIGN
KH_CHNHI_R.BTM7
     10218**DCL     11809<<ASSIGN
KH_CHNLOW
     10218**DCL     10219--REDEF   11806<<ASSIGN
KH_CHNLOW$
     10217**DCL     11807<<ASSIGN
KH_CTLTBL$
     10225**DCL     10969--IMP-PTR 11682<<ASSIGN  11684>>ASSIGN  11692>>ASSIGN  11712>>IF      11714>>ASSIGN
KH_ERRSND
     10224**DCL     11700<<ASSIGN  11900>>IF
KH_FLDWRTS
     10230**DCL     11928>>IF      12025>>IF
KH_INHLVL
     10223**DCL     11699<<ASSIGN  11894>>ASSIGN
KH_NA_DCB#
     11466**DCL     11445--DCLINIT 11598>>ASSIGN  11599>>ASSIGN  11600>>ASSIGN  11602--ASSIGN
KH_NA_EVENT#
     11467**DCL     11613<<ASSIGN  11620>>IF      11622<<ASSIGN  11842>>ASSIGN
KH_NODE#
     11471**DCL     11602<<ASSIGN
KH_WLCLKENT$
     11468**DCL     11619<<ASSIGN
KL$REQSTATS.DSPMSK
     10770**DCL     10776--REDEF
KL$REQSTATS.FEPNAME
     10751**DCL     12018<<ASSIGN  12018>>ASSIGN
KL$REQSTATS.FNC
     10688**DCL     12023<<ASSIGN
KL$REQSTATS.HANDLER
     10757**DCL     12020<<ASSIGN  12020>>ASSIGN
KL$REQSTATS.NODE_NUM
     10693**DCL     12021<<ASSIGN  12021>>ASSIGN
KL$REQSTATS.SLCMSK
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:138  
     10811**DCL     10818--REDEF
KL$REQSTATS.SRCE_NODE
     10694**DCL     12019<<ASSIGN  12019>>ASSIGN
KL$REQSTATS.STATSSTA
     10747**DCL     12022<<ASSIGN  12022>>ASSIGN
KL$SYSLOG
     10314**DCL     11926--ASSIGN  11927--ASSIGN
KL$SYSLOG.ERRLOG.DATA_SIZE
     10429**DCL     11913<<ASSIGN  11920<<ASSIGN  11921>>ASSIGN
KL$SYSLOG.ERRLOG.ERRCODE
     10360**DCL     11914<<ASSIGN
KL$SYSLOG.ERRLOG.MSG
     10431**DCL     11922<<ASSIGN  11927--ASSIGN
KL$SYSLOG.ERRLOG.TERMID
     10411**DCL     11916<<ASSIGN
KL$SYSLOG.ERRLOG.TERMID.TERM
     10413**DCL     10422--REDEF
KL$SYSLOG.ERRLOG.UTS
     10391**DCL     11917<>CALL
KL$SYSLOG.ERRLOG.VALUES
     10425**DCL     11915<<ASSIGN
KL$SYSLOG.FCN
     10315**DCL     11911<<ASSIGN
KL$SYSLOG.FILENUM
     10318**DCL     11912<<ASSIGN
KL_ACQUIRE
      9801**DCL     11811<<ASSIGN  11814--ASSIGN
KL_ACQUIRE.ATTR
      9827**DCL     11813<<ASSIGN
KL_ACQUIRE.RES
      9825**DCL     11812<<ASSIGN
KL_ACQUIRE_CONS
      9459**DCL     11811>>ASSIGN
KL_CHNRSP.TERMINAL_ID.TERM
      9957**DCL      9966--REDEF
KL_CONTROL_CONS
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:139  
      9673**DCL     11683>>ASSIGN
KL_CONTROL_INIT
      9543**DCL     11683<<ASSIGN  11685--ASSIGN  11705--ASSIGN
KL_CONTROL_INIT.FPARAM
      9621**DCL     11691--ASSIGN  11694>>ASSIGN  11696>>ASSIGN  11698>>ASSIGN  11699>>ASSIGN  11700>>ASSIGN
KL_CONTROL_INIT.IPARAM.ARRAY_SZ
      9627**DCL     11707>>ASSIGN
KL_CONTROL_INIT.IPARAM.OFFSET
      9629**DCL     11705>>ASSIGN
KL_CONTROL_INIT.NUM_FPARAM
      9614**DCL     11684<<ASSIGN  11692>>ASSIGN  11693>>IF      11695>>IF      11697>>IF
KL_CONTROL_INIT.NUM_IPARAM
      9615**DCL     11692>>ASSIGN
KL_CONTROL_INIT.TYPE
      9549**DCL     11689>>IF
KL_INITDONE
      9883**DCL     11838--ASSIGN
KV_MAXUFTSIZ
     10229**DCL     11698<<ASSIGN
KV_SSNMAX
     10227**DCL     11694<<ASSIGN
KV_TYPAHDBFRLMT
     10228**DCL     11696<<ASSIGN
M$CVM
      4508**DCL-ENT 11800--CALL
M$EVENT
      4494**DCL-ENT 11623--CALL
M$GDS
      4506**DCL-ENT 11603--CALL
M$GETDCB
      4512**DCL-ENT 11593--CALL
M$OPEN
      4511**DCL-ENT 11601--CALL
M$READ
      4511**DCL-ENT 11687--CALL    11843--CALL
M$WRITE
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:140  
      4512**DCL-ENT 11686--CALL    11815--CALL    11839--CALL    11953--CALL    12037--CALL
M$XXX
      4489**DCL-ENT 11802--CALL
OPEN
     11323**DCL     11596<<ASSIGN  11601<>CALL
OPEN.V
     11331**DCL     11597--ASSIGN
OPEN.V.DCB#
     11331**DCL     11598<<ASSIGN
OPEN.V_
     11325**DCL     11597<<ASSIGN
PARM1
      9423**DCL        19--PROC    11612--IF      11613>>ASSIGN  11681--ENTRY   11682--ASSIGN  11791--ENTRY
     11792--ASSIGN  11837--ENTRY   11892--ENTRY   11899--ASSIGN  11914--ASSIGN  11915--ASSIGN  11916--ASSIGN
     11920--ASSIGN  12015--ENTRY   12016--ASSIGN
PARM1$
     10236**DCL     10446--IMP-PTR 10822--IMP-PTR 11792<<ASSIGN  11812>>ASSIGN  11899<<ASSIGN  11900>>IF
     11918>>IF      11922>>ASSIGN  12016<<ASSIGN  12018>>ASSIGN  12019>>ASSIGN  12020>>ASSIGN  12021>>ASSIGN
     12022>>ASSIGN
PARM2
      9424**DCL        19--PROC    11610--ASSIGN  11615--IF      11681--ENTRY   11791--ENTRY   11793--ASSIGN
     11837--ENTRY   11892--ENTRY   11930--IF      11930>>IF      11955--IF      12015--ENTRY   12017--ASSIGN
     12024--ASSIGN
PARM2$
     10237**DCL     10238--REDEF   10823--IMP-PTR 10825--IMP-PTR 11610<<ASSIGN  11616>>ASSIGN  11793<<ASSIGN
     11813>>ASSIGN  12018>>ASSIGN  12019>>ASSIGN  12020>>ASSIGN  12021>>ASSIGN  12022>>ASSIGN  12023>>ASSIGN
PARM2C$
     10238**DCL     12017<<ASSIGN
PARM3
      9425**DCL        19--PROC    11611--ASSIGN  11618--IF      11681--ENTRY   11791--ENTRY   11794--ASSIGN
     11796--IF      11837--ENTRY
PARM3$
     10239**DCL     11469--IMP-PTR 11470--IMP-PTR 11611<<ASSIGN  11619>>ASSIGN  11794<<ASSIGN  11797>>ASSIGN
RESOURCE
     10822**DCL     11812>>ASSIGN
SIZE
PL6.E3A0      #003=KHA$INIT File=KHA$ADMIN.:E05TSI                               WED 07/30/97 00:25 Page:141  
     10241**DCL     10432--IMP-SIZ 11692<<ASSIGN  11701>>DOINDEX 11921<<ASSIGN  11922>>ASSIGN  11925<<ASSIGN
     11927>>ASSIGN
USERSEG
     11252**DCL     11185--DCLINIT
USERSEG.BASE
     11256**DCL     11256--REDEF   11799<<ASSIGN
WLCLKENT$
     11470**DCL     11619>>ASSIGN
WORDARRAY
     10827**DCL     11714<<ASSIGN  11714>>ASSIGN

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:142  
      915        1        /*T***********************************************************/
      916        2        /*T*                                                         */
      917        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      918        4        /*T*                                                         */
      919        5        /*T***********************************************************/
      920        6        KHA$DVCADM: PROC (OPERATION,ERROR,TERMLO,TERMHI,DATAVEC,NORETRAN) ALTRET;
      921        7
      922        8        /*F* NAME: KHA$DVCADM - Change Channel State
      923        9
      924       10        The library device administration routine, KHA$DVCADM, maintains
      925       11        KH$CHN.STT which contains a value that reflects the state of a channel.
      926       12        This routine may be called by the library administrative routine,
      927       13        KHA$ADMIN, or by user handler routines.  The KHA$DVCADM routine may in turn
      928       14        call the user handler administrative point when necessary to
      929       15        complete the state transition.
      930       16
      931       17        The following is a table of the state transitions and the functions
      932       18        that are done:
      933       19
      934       20        .fif
      935       21        }Operation: Indicates what function is being requested of KHA$DVCADM
      936       22        }           for this channel.  The value used for operation is
      937       23        }           from the KHA_FNC_E include file and is of the form
      938       24        }           KHA_FNC_operation.  See KHA_FNC_E for more detail.
      939       25        }
      940       26        }Caller:   Indicates who originated the state transition request.
      941       27        }
      942       28        }          s(system) - refers to NODEADMN, SLUG(KEYIN,STATS or NETCON).
      943       29        }          h         - refers to the handler.
      944       30        }
      945       31        }Flags:    Indicates which channel table flags must be on for the requested
      946       32        }          state transition.  See KH$CHN.flag for more detail.
      947       33        }
      948       34        }Handler function:
      949       35        }          Indicates the value that will be supplied in KH$ADMIT_FPT.FNC
      950       36        }          when the handler is called at its administrative point to
      951       37        }          complete the operation.  This value is from the KHA_FNC_E
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:143  
      952       38        }          include file and is of the form KHA_FNC_function.  See
      953       39        }          KHA_FNC_E for more detail.
      954       40        }
      955       41        }          If a handler function is not specified the handler's
      956       42        }          administrative entry will not be called.
      957       43        }
      958       44        }State:    States are defined in KH$CHN.STT.
      959       45        }
      960       46        .bbk
      961       47        }Operation        Caller  Old state  New state       Flags      Hndlr function
      962       48        }---------        ------  ---------  ---------     -----------  --------------
      963       49        }ENABLE           s or h   enable      enable                    ENABLE
      964       50        }                          disable     enable        ~DED        ENABLE
      965       51        }                          bsydsbpnd   busy                      ENABLE
      966       52        }                          uninit      uninit         DED
      967       53        }                          uninit      enable                    ENABLE
      968       54        }
      969       55        .bek
      970       56        }DISABLE          s or h   disable     disable
      971       57        }                          enable      disable                   DISABLE
      972       58        }                          busy        bsydsbpnd                 DISABLE
      973       59        }                          bsydsbpnd   bsydsbpnd
      974       60        }                          lpp_enable  disable                   DISABLE
      975       61        }                          lpp_busy    lpp_bsydsbpnd
      976       62        }                          lpp_bsydsbpnd lpp_bsydsbpnd
      977       63        }
      978       64        }KILL             s or h   enable      disable                   DISABLE
      979       65        }                          busy        bsydsbpnd                 KILL
      980       66        }                          bsydsbpnd   bsydsbpnd                 KILL
      981       67        }                          lpp_enable  disable                   DISABLE
      982       68        }                          lpp_busy    bsydsbpnd                 KILL
      983       69        }                          lpp_bsydsbpnd bsydsbpnd               KILL
      984       70        }                          disable     disable        DED
      985       71        }
      986       72        }PARTITION        s        enable      partition                 KILL
      987       73        }                          disable     partition                 KILL
      988       74        }                          uninit      partition                 KILL
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:144  
      989       75        }
      990       76        }RETURN           s        partition   uninit
      991       77        }
      992       78        }DISCONNECT_EVT * h        busy        enable         REENB
      993       79        }                          busy        disable                   DISABLE
      994       80        }                          bsydsbpnd   disable                   DISABLE
      995       81        }
      996       82        }DISCONNECT_RQS   s or h   busy        busy                   DISCONNECT_RQS
      997       83        }                          bsydsbpnd   bsydsbpnd              DISCONNECT_RQS
      998       84        }                          lpp_busy    lpp_busy               DISCONNECT_RQS
      999       85        }                          lpp_bsydsbpnd lpp_bsydsbpnd        DISCONNECT_RQS
     1000       86        }
     1001       87        }CONNECT *        h        enable      busy
     1002       88        }
     1003       89        }INTDVC           s        uninit      enable         ENB        ENABLE
     1004       90        }                          uninit      uninit         DED        DISABLE
     1005       91        }                          partition   partition
     1006       92        }                          uninit      disable        ERR        DISABLE
     1007       93        }
     1008       94        }CNFG             s        all         same as old               CNFG
     1009       95        }
     1010       96        }RQSLINPRO        h        enable      lpp_enable
     1011       97        }                          busy        lpp_busy
     1012       98        }                          bsydsbpnd   lpp_bsydsbpnd
     1013       99        }
     1014      100        }BLDLINPRO        s        lpp_enable  enable
     1015      101        }                          lpp_busy    busy
     1016      102        }                          lpp_bsydspnd bsydsbpnd
     1017      103        }
     1018      104        }SGNRJC           s        lpp_enable  enable                    SGNRJC
     1019      105        }                          lpp_busy     busy                     SGNRJC
     1020      106        }                          lpp_bsydspnd bsydsbpnd                SGNRJC
     1021      107        }
     1022      108        }CNCRQSLINPRO     h        lpp_enable  enable
     1023      109        }                          lpp_busy    busy
     1024      110        }                          lpp_bsydspnd bsydsbpnd
     1025      111        }
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:145  
     1026      112        }DVCERR           h        all         same as old
     1027      113        }
     1028      114        }DVCERRRSP        s        all         same as old               DVCERRRSP
     1029      115        }
     1030      116        }HOSTDOWN         s        enable      disable        DSBHSTDWN  DISABLE
     1031      117        }                          enable      disable        KLLHSTDWN  KILL
     1032      118        }                          busy        bsydsbpnd      DSBHSTDWN
     1033      119        }                          busy        bsydsbpnd      KLLHSTDWN  KILL
     1034      120        }                          lpp_enb     disable        KLLHSTDWN  KILL
     1035      121        }                          lpp_bsy     bsydsbpnd      KLLHSTDWN  KILL
     1036      122        }                          lpp_bsydsbpnd bsydsbpnd    KLLHSTDWN  KILL
     1037      123        }                          lpp_bsy     bsydsbpnd      DSBHSTDWN  DISABLE
     1038      124        }                          lpp_enb     disable        DSBHSTDWN  DISABLE
     1039      125        }
     1040      126        }HOSTUP           s        disable     enable         ENBHSTUP   ENABLE
     1041      127        }                          bsydsbpnd   busy           ENBHSTUP
     1042      128        }
     1043      129        }ACTIVE *         h        all         same as old
     1044      130        }
     1045      131        }NOTACTIVE *      h        all         same as old
     1046      132        }
     1047      133        }        * sends administrative event to host.
     1048      134
     1049      135
     1050      136        .fin
     1051      137
     1052      138        Any requested operation which does not have a transition function
     1053      139        defined will result in an illegal state transition error and
     1054      140        the alternate return will be taken.
     1055      141
     1056      142        The form of this call is:
     1057      143
     1058      144          CALL KHA$DVCADM (operation,error,term_low,term_hi,datavec,noretran) ALTRET(label);
     1059      145
     1060      146        where:
     1061      147        */
     1062      148        /*K* operation - UBIN(16).
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:146  
     1063      149        contains a value that indicates what function
     1064      150        is to be performed.  Please refer to the description of KHA_FNC_E.
     1065      151        */
     1066      152
     1067      153        /*K* error - is where an error code will be returned
     1068      154        if the alternate return is taken.  This parameter is
     1069      155        in VLP_ERRCODE format.
     1070      156        The error codes are in the CP6 error message file, :ERRMSG.
     1071      157        */
     1072      158
     1073      159        /*K* term_low - a B$TERMINAL_ID structure that defines the
     1074      160        first item to be affected by this operation.
     1075      161        */
     1076      162
     1077      163        /*K* term_hi - a B$TERMINAL_ID structure that defines the
     1078      164        last item to be affected by this operation.
     1079      165        */
     1080      166
     1081      167        /*K* noretran - if specified, indicates that the caller does
     1082      168        not want the KHA$DVCADM routine to re-transmit any message
     1083      169        if any usage of M$WRITE fails.
     1084      170        */
     1085      171
     1086      172        /*K* datavec - is a vector to optional data:
     1087      173
     1088      174        .bbk
     1089      175        .fif
     1090      176                   operation            datavec structure
     1091      177                   --------             -----------------
     1092      178                   KHA_FNC_DVCERR       KL_KEYMES from file KL_MACRO_C
     1093      179                   KHA_FNC_RQSLINPRO    CHAR(255) TEXT signon string
     1094      180        .fin
     1095      181        .bek
     1096      182        */
     1097      183        /* Includes */
     1098      184        %INCLUDE LCP_6;
     1099     4463        %INCLUDE CP_6_SUBS;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:147  
     1100     5003        %INCLUDE KH$CHN;
     1101     5125        %INCLUDE KH_CHN;
     1102     5165        %INCLUDE KHA_FNC_E;
     1103     5265        %INCLUDE KL_CONTROL_C;
     1104     5645        %INCLUDE KL_AFCN_C;
     1105     5746        %INCLUDE KL_MACRO_C;
     1106     9098        %INCLUDE KH_MACRO_C;
     1107     9841        %INCLUDE KHC_MAC_C;
     1108     9882        %INCLUDE B_ERRORS_C;
     1109    11009
     1110    11010        /* Parameters */
     1111    11011    1   DCL OPERATION UBIN;
     1112    11012        %VLP_ERRCODE (FPTN=ERROR,STCLASS="");
     1113    11058        %B$TERMINAL_ID (FPTN=TERMLO,STCLASS=PARAM,ALGN=ALIGNED);
     1114    11087        %B$TERMINAL_ID (FPTN=TERMHI,STCLASS=PARAM,ALGN=ALIGNED);
     1115    11116    1   DCL DATAVEC VECTOR;
     1116    11117    1   DCL NORETRAN UBIN;
     1117    11118
     1118    11119        /* Entry DCLs */
     1119    11120    1   DCL KHA$GET_CTX_PTR ENTRY(2) ALTRET;
     1120    11121    1   DCL KHA$CHK_TRM_RNG ENTRY(2) ALTRET;
     1121    11122    1   DCL KHA$UPD_CHN ENTRY(2);
     1122    11123    1   DCL KHA$BLDLINPRO ENTRY(2) ALTRET;
     1123    11124    1   DCL KHA$SETCLK ENTRY(1) ALTRET;
     1124    11125        %INHIBIT_DCLS;
     1125    11137
     1126    11138        /* Equates */
     1127    11139        /* The Following equates are for the flags in the CHN table */
     1128    11140        %EQU Y#NON = 0;
     1129    11141        %EQU Y#DED = 1;
     1130    11142        %EQU Y#ERR = 2;
     1131    11143        %EQU Y#ENB = 3;
     1132    11144        %EQU Y#REENB = 4;
     1133    11145        %EQU Y#CTR = 5;
     1134    11146        %EQU Y#NOTDED = 6;
     1135    11147        %EQU Y#KLLHSTDWN = 7;
     1136    11148        %EQU Y#DSBHSTDWN = 8;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:148  
     1137    11149        %EQU Y#ENBHSTUP = 9;
     1138    11150
     1139    11151        /* The following equates are for the SOP (special operation) */
     1140    11152        %EQU Y#SOP_NON = 0;
     1141    11153        %EQU Y#SOP_INTCTR = 1;
     1142    11154        %EQU Y#SOP_ENB = 2;
     1143    11155        %EQU Y#SOP_PRT = 3;
     1144    11156        %EQU Y#SOP_UPDCHN = 4;
     1145    11157        %EQU Y#SOP_RQSLINPRO = 5;
     1146    11158        %EQU Y#SOP_BLDLINPRO = 6;
     1147    11159        %EQU Y#SOP_DVCERR = 7;
     1148    11160        %EQU Y#SOP_DVCERRRSP = 8;
     1149    11161        %EQU Y#SOP_SETENBHSTUP = 9;
     1150    11162        %EQU Y#SOP_CLRENBHSTUP = 10;
     1151    11163        %EQU Y#SOP_SNDADM = 11;
     1152    11164        %EQU Y#SOP_RSTDED = 13;
     1153    11165
     1154    11166        %MACRO TRANS (FPTN=X,
     1155    11167                       NEW(UNINT=%KH#CHN_STT_UN_INT,
     1156    11168                                BSY=%KH#CHN_STT_BSY,
     1157    11169                                BSYDSBPND=%KH#CHN_STT_BSYDSBPND,
     1158    11170                                BSYPRTPND=%KH#CHN_STT_BSYPRTPND,
     1159    11171                                DSB=%KH#CHN_STT_DSB,
     1160    11172                                ENB=%KH#CHN_STT_ENB,
     1161    11173                                LINPROPND_ENB=%KH#CHN_STT_LINPROPND_ENB,
     1162    11174                                LINPROPND_BSY=%KH#CHN_STT_LINPROPND_BSY,
     1163    11175                                LINPROPND_BSYDSBPND=%KH#CHN_STT_LINPROPND_BSYDSBPND,
     1164    11176                                PRT=%KH#CHN_STT_PRT)=-1,
     1165    11177                       OLD(UNINT=%KH#CHN_STT_UN_INT,
     1166    11178                                BSY=%KH#CHN_STT_BSY,
     1167    11179                                BSYDSBPND=%KH#CHN_STT_BSYDSBPND,
     1168    11180                                BSYPRTPND=%KH#CHN_STT_BSYPRTPND,
     1169    11181                                DSB=%KH#CHN_STT_DSB,
     1170    11182                                ENB=%KH#CHN_STT_ENB,
     1171    11183                                LINPROPND_ENB=%KH#CHN_STT_LINPROPND_ENB,
     1172    11184                                LINPROPND_BSY=%KH#CHN_STT_LINPROPND_BSY,
     1173    11185                                LINPROPND_BSYDSBPND=%KH#CHN_STT_LINPROPND_BSYDSBPND,
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:149  
     1174    11186                                PRT=%KH#CHN_STT_PRT)=-1,
     1175    11187                       HOP=%KHA_FNC_NON,
     1176    11188                       BSOP=%Y#SOP_NON,
     1177    11189                       ASOP=%Y#SOP_NON,
     1178    11190             FLGS(DED=%Y#DED,ERR=%Y#ERR,ENB=%Y#ENB,REENB=%Y#REENB,CTR=%Y#CTR,NOTDED=
             11190                 %Y#NOTDED,
     1179    11191                  KLLHSTDWN=%Y#KLLHSTDWN,DSBHSTDWN=%Y#DSBHSTDWN,ENBHSTUP=%Y#ENBHSTUP)=%Y#NON
             11191                      ,
     1180    11192                  STCLASS=CONSTANT,
     1181    11193                  LVL=2,
     1182    11194                  LAST(YES=1,NO=0)=0);
     1183    11195
     1184    11196        %LSET LISTDIR = '0'B;
     1185    11197        %LSET LISTEXP = '1'B;
     1186    11198        %LSET LISTCOM = '0'B;
     1187    11199        %LSET LISTSUB = '1'B;
     1188    11200        %LSET STR = SUBSTR(CONCAT(TEXTCHAR(STCLASS), '   '), 0, 3);
     1189    11201        %IF (STR = 'STA') OR (STR = 'CON') OR (STR = 'EXT');
     1190    11202        %LSET INIT = CHARTEXT(' INIT');
     1191    11203        %LSET ENIT = CHARTEXT('');
     1192    11204        %ELSE;
     1193    11205        %LSET INIT = CHARTEXT('/*');
     1194    11206        %LSET ENIT = CHARTEXT('*/');
     1195    11207        %ENDIF;
     1196    11208
     1197    11209        %IF LVL=1;
     1198    11210        DCL 1 FPTN STCLASS ALIGNED,
     1199    11211
     1200    11212                 2 %CHARTEXT('OLD ') SBIN BYTE CALIGNED %INIT(OLD)%ENIT,
     1201    11213                 2 %CHARTEXT('NEW ') SBIN BYTE CALIGNED %INIT(NEW)%ENIT,
     1202    11214                 2 %CHARTEXT('HOP ') UBIN BYTE CALIGNED %INIT(HOP)%ENIT,
     1203    11215                 2 %CHARTEXT('BSOP ') UBIN BYTE CALIGNED %INIT(BSOP)%ENIT,
     1204    11216                 2 %CHARTEXT('ASOP ') UBIN BYTE CALIGNED %INIT(ASOP)%ENIT,
     1205    11217                 2 %CHARTEXT('FLGS ') UBIN BYTE CALIGNED %INIT(FLGS)%ENIT,
     1206    11218                 2 * UBIN BYTE CALIGNED %INIT(0*0)%ENIT,
     1207    11219        %IF LAST=0;
     1208    11220                 2 %CHARTEXT('LAST ') BIT(1) %INIT('0'B)%ENIT,
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:150  
     1209    11221        %ELSE;
     1210    11222                 2 %CHARTEXT('LAST ') BIT(1) %INIT('1'B)%ENIT;
     1211    11223        %ENDIF;
     1212    11224        %ELSE;
     1213    11225                 2 * SBIN BYTE CALIGNED %INIT(OLD)%ENIT,
     1214    11226                 2 * SBIN BYTE CALIGNED %INIT(NEW)%ENIT,
     1215    11227                 2 * UBIN BYTE CALIGNED %INIT(HOP)%ENIT,
     1216    11228                 2 * UBIN BYTE CALIGNED %INIT(BSOP)%ENIT,
     1217    11229                 2 * UBIN BYTE CALIGNED %INIT(ASOP)%ENIT,
     1218    11230                 2 * UBIN BYTE CALIGNED %INIT(FLGS)%ENIT,
     1219    11231                 2 * UBIN BYTE CALIGNED %INIT(0*0)%ENIT,
     1220    11232        %IF LAST=0;
     1221    11233                 2 * BIT(1) %INIT('0'B)%ENIT,
     1222    11234        %ELSE;
     1223    11235                 2 * BIT(1) %INIT('1'B)%ENIT;
     1224    11236        %ENDIF;
     1225    11237        %ENDIF;
     1226    11238
     1227    11239        %MEND;
     1228    11240
     1229    11241        /* State transition table */
     1230    11242
     1231    11243        /*
     1232    11244             EVENT: DISABLE
     1233    11245         */
     1234    11246    1   DCL 1 TRAN_DISABLE CONSTANT,
     1235    11247             %TRANS (OLD=DSB,NEW=DSB);
     1236    11289             %TRANS (OLD=ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE);
     1237    11331             %TRANS (OLD=BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_DISABLE);
     1238    11373             %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND);
     1239    11415             %TRANS (OLD=LINPROPND_ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE);
     1240    11457             %TRANS (OLD=LINPROPND_BSY,NEW=LINPROPND_BSYDSBPND);
     1241    11499             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=LINPROPND_BSYDSBPND);
     1242    11541             %TRANS (LAST=YES);
     1243    11583
     1244    11584        /*
     1245    11585             EVENT: ENABLE
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:151  
     1246    11586         */
     1247    11587    1   DCL 1 TRAN_ENABLE CONSTANT,
     1248    11588             %TRANS (OLD=ENB,NEW=ENB,HOP=%KHA_FNC_ENABLE,ASOP=%Y#SOP_ENB);
     1249    11630             %TRANS (OLD=DSB,NEW=ENB,HOP=%KHA_FNC_ENABLE,ASOP=%Y#SOP_ENB,FLGS=NOTDED);
     1250    11672             %TRANS (OLD=BSYDSBPND,NEW=BSY,HOP=%KHA_FNC_ENABLE);
     1251    11714             %TRANS (OLD=UNINT,NEW=UNINT,FLGS=DED);
     1252    11756             %TRANS (OLD=UNINT,NEW=ENB,HOP=%KHA_FNC_ENABLE,BSOP=%Y#SOP_INTCTR,ASOP=
             11756                 %Y#SOP_ENB);
     1253    11798             %TRANS (LAST=YES);
     1254    11840
     1255    11841        /*
     1256    11842             EVENT: KILL
     1257    11843         */
     1258    11844    1   DCL 1 TRAN_KILL CONSTANT,
     1259    11845             %TRANS (OLD=ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE);
     1260    11887             %TRANS (OLD=BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL);
     1261    11929             %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL);
     1262    11971             %TRANS (OLD=LINPROPND_ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE);
     1263    12013             %TRANS (OLD=LINPROPND_BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL);
     1264    12055             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL);
     1265    12097             %TRANS (OLD=DSB,NEW=DSB,FLGS=DED,ASOP=%Y#SOP_RSTDED);
     1266    12139             %TRANS (LAST=YES);
     1267    12181
     1268    12182        /*
     1269    12183             EVENT: INTDVC
     1270    12184         */
     1271    12185    1   DCL 1 TRAN_INTDVC CONSTANT,
     1272    12186             %TRANS (OLD=PRT,NEW=PRT);
     1273    12228             %TRANS (OLD=UNINT,NEW=DSB,HOP=%KHA_FNC_DISABLE,BSOP=%Y#SOP_INTCTR,FLGS=ERR);
     1274    12270             %TRANS (OLD=UNINT,NEW=UNINT,HOP=%KHA_FNC_DISABLE,BSOP=%Y#SOP_INTCTR,FLGS=DED);
     1275    12312             %TRANS (OLD=UNINT,NEW=ENB,HOP=%KHA_FNC_ENABLE,BSOP=%Y#SOP_INTCTR,FLGS=ENB,ASOP=
             12312                 %Y#SOP_ENB);
     1276    12354             %TRANS (OLD=UNINT,NEW=DSB,HOP=%KHA_FNC_DISABLE,BSOP=%Y#SOP_INTCTR);
     1277    12396             %TRANS (LAST=YES);
     1278    12438
     1279    12439        /*
     1280    12440             EVENT: DISCONNECT_EVT (from a handler)
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:152  
     1281    12441         */
     1282    12442    1   DCL 1 TRAN_DISCONNECT_EVT CONSTANT,
     1283    12443             %TRANS (OLD=BSY,NEW=ENB,FLGS=REENB,ASOP=%Y#SOP_SNDADM);
     1284    12485             %TRANS (OLD=BSY,NEW=DSB,HOP=%KHA_FNC_DISABLE,ASOP=%Y#SOP_SNDADM);
     1285    12527             %TRANS (OLD=BSYDSBPND,NEW=DSB,HOP=%KHA_FNC_DISABLE,ASOP=%Y#SOP_SNDADM);
     1286    12569             %TRANS (LAST=YES);
     1287    12611
     1288    12612        /*
     1289    12613             EVENT: DISCONNECT_RQS (from a host)
     1290    12614         */
     1291    12615    1   DCL 1 TRAN_DISCONNECT_RQS CONSTANT,
     1292    12616             %TRANS (OLD=BSY,NEW=BSY,HOP=%KHA_FNC_DISCONNECT_RQS);
     1293    12658             %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_DISCONNECT_RQS);
     1294    12700             %TRANS (OLD=LINPROPND_BSY,NEW=LINPROPND_BSY,HOP=%KHA_FNC_DISCONNECT_RQS);
     1295    12742             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=LINPROPND_BSYDSBPND,HOP=
             12742                 %KHA_FNC_DISCONNECT_RQS);
     1296    12784             %TRANS (LAST=YES);
     1297    12826
     1298    12827        /*
     1299    12828             EVENT: CONNECT
     1300    12829         */
     1301    12830    1   DCL 1 TRAN_CONNECT CONSTANT,
     1302    12831             %TRANS (OLD=ENB,NEW=BSY,ASOP=%Y#SOP_SNDADM);
     1303    12873             %TRANS (LAST=YES);
     1304    12915
     1305    12916        /*
     1306    12917             EVENT: CONFIG
     1307    12918         */
     1308    12919    1   DCL 1 TRAN_CONFIG CONSTANT,
     1309    12920             %TRANS (OLD=DSB,NEW=DSB,BSOP=%Y#SOP_UPDCHN,HOP=%KHA_FNC_CNFG);
     1310    12962             %TRANS (OLD=ENB,NEW=ENB,BSOP=%Y#SOP_UPDCHN,HOP=%KHA_FNC_CNFG);
     1311    13004             %TRANS (OLD=BSY,NEW=BSY,BSOP=%Y#SOP_UPDCHN,HOP=%KHA_FNC_CNFG);
     1312    13046             %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,BSOP=%Y#SOP_UPDCHN,HOP=%KHA_FNC_CNFG);
     1313    13088             %TRANS (OLD=UNINT,NEW=UNINT,BSOP=%Y#SOP_UPDCHN);
     1314    13130             %TRANS (LAST=YES);
     1315    13172
     1316    13173        /*
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:153  
     1317    13174             EVENT: RELEASE
     1318    13175         */
     1319    13176    1   DCL 1 TRAN_PARTITION CONSTANT,
     1320    13177             %TRANS (OLD=DSB,NEW=PRT,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_PRT);
     1321    13219             %TRANS (OLD=UNINT,NEW=PRT,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_PRT);
     1322    13261             %TRANS (LAST=YES);
     1323    13303
     1324    13304        /*
     1325    13305             EVENT: RETURN
     1326    13306         */
     1327    13307    1   DCL 1 TRAN_RETURN CONSTANT,
     1328    13308             %TRANS (OLD=PRT,NEW=UNINT);
     1329    13350             %TRANS (LAST=YES);
     1330    13392
     1331    13393        /*
     1332    13394             EVENT: SGNRJC
     1333    13395        */
     1334    13396    1   DCL 1 TRAN_SGNRJC CONSTANT,
     1335    13397             %TRANS (OLD=LINPROPND_ENB,NEW=ENB,HOP=%KHA_FNC_SGNRJC);
     1336    13439             %TRANS (OLD=LINPROPND_BSY,NEW=BSY,HOP=%KHA_FNC_SGNRJC);
     1337    13481             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_SGNRJC);
     1338    13523             %TRANS (LAST=YES);
     1339    13565
     1340    13566        /*
     1341    13567             EVENT: BLDLINPRO
     1342    13568        */
     1343    13569    1   DCL 1 TRAN_BLDLINPRO CONSTANT,
     1344    13570             %TRANS (OLD=LINPROPND_ENB,NEW=ENB,BSOP=%Y#SOP_BLDLINPRO);
     1345    13612             %TRANS (OLD=LINPROPND_BSY,NEW=BSY,BSOP=%Y#SOP_BLDLINPRO);
     1346    13654             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND,BSOP=%Y#SOP_BLDLINPRO);
     1347    13696             %TRANS (LAST=YES);
     1348    13738
     1349    13739        /*
     1350    13740             EVENT: RQSLINPRO
     1351    13741        */
     1352    13742    1   DCL 1 TRAN_RQSLINPRO CONSTANT,
     1353    13743             %TRANS (OLD=ENB,NEW=LINPROPND_ENB,BSOP=%Y#SOP_RQSLINPRO);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:154  
     1354    13785             %TRANS (OLD=BSY,NEW=LINPROPND_BSY,BSOP=%Y#SOP_RQSLINPRO);
     1355    13827             %TRANS (OLD=BSYDSBPND,NEW=LINPROPND_BSYDSBPND,BSOP=%Y#SOP_RQSLINPRO);
     1356    13869             %TRANS (LAST=YES);
     1357    13911
     1358    13912        /*
     1359    13913             EVENT: CNCRQSLINPRO
     1360    13914        */
     1361    13915    1   DCL 1 TRAN_CNCRQSLINPRO CONSTANT,
     1362    13916              %TRANS (OLD=LINPROPND_ENB,NEW=ENB);
     1363    13958              %TRANS (OLD=LINPROPND_BSY,NEW=BSY);
     1364    14000              %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND);
     1365    14042              %TRANS (LAST=YES);
     1366    14084
     1367    14085        /*
     1368    14086             EVENT: DVCERR
     1369    14087        */
     1370    14088    1   DCL 1 TRAN_DVCERR CONSTANT,
     1371    14089              %TRANS (OLD=UNINT,NEW=UNINT,BSOP=%Y#SOP_DVCERR);
     1372    14131              %TRANS (OLD=BSY,NEW=BSY,BSOP=%Y#SOP_DVCERR);
     1373    14173              %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,BSOP=%Y#SOP_DVCERR);
     1374    14215              %TRANS (OLD=BSYPRTPND,NEW=BSYPRTPND,BSOP=%Y#SOP_DVCERR);
     1375    14257              %TRANS (OLD=DSB,NEW=DSB,BSOP=%Y#SOP_DVCERR);
     1376    14299              %TRANS (OLD=ENB,NEW=ENB,BSOP=%Y#SOP_DVCERR);
     1377    14341              %TRANS (OLD=LINPROPND_ENB,NEW=LINPROPND_ENB,BSOP=%Y#SOP_DVCERR);
     1378    14383              %TRANS (OLD=LINPROPND_BSY,NEW=LINPROPND_BSY,BSOP=%Y#SOP_DVCERR);
     1379    14425              %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=LINPROPND_BSYDSBPND,BSOP=%Y#SOP_DVCERR);
     1380    14467              %TRANS (OLD=PRT,NEW=PRT,BSOP=%Y#SOP_DVCERR);
     1381    14509              %TRANS (LAST=YES);
     1382    14551
     1383    14552        /*
     1384    14553             EVENT: DVCERRRSP
     1385    14554        */
     1386    14555    1   DCL 1 TRAN_DVCERRRSP CONSTANT,
     1387    14556              %TRANS (OLD=UNINT,NEW=UNINT,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1388    14598              %TRANS (OLD=BSY,NEW=BSY,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1389    14640              %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,BSOP=%Y#SOP_DVCERRRSP,HOP=
             14640                  %KHA_FNC_DVCERRRSP);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:155  
     1390    14682              %TRANS (OLD=BSYPRTPND,NEW=BSYPRTPND,BSOP=%Y#SOP_DVCERRRSP,HOP=
             14682                  %KHA_FNC_DVCERRRSP);
     1391    14724              %TRANS (OLD=DSB,NEW=DSB,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1392    14766              %TRANS (OLD=ENB,NEW=ENB,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1393    14808              %TRANS (OLD=LINPROPND_ENB,NEW=LINPROPND_ENB,BSOP=%Y#SOP_DVCERRRSP,HOP=
             14808                  %KHA_FNC_DVCERRRSP);
     1394    14850              %TRANS (OLD=LINPROPND_BSY,NEW=LINPROPND_BSY,BSOP=%Y#SOP_DVCERRRSP,HOP=
             14850                  %KHA_FNC_DVCERRRSP);
     1395    14892              %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=LINPROPND_BSYDSBPND,BSOP=%Y#SOP_DVCERRRSP,
             14892                  HOP=%KHA_FNC_DVCERRRSP);
     1396    14934              %TRANS (OLD=PRT,NEW=PRT,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1397    14976              %TRANS (LAST=YES);
     1398    15018
     1399    15019        /*
     1400    15020             EVENT: HOSTDOWN
     1401    15021         */
     1402    15022    1   DCL 1 TRAN_HOSTDOWN CONSTANT,
     1403    15023             %TRANS(OLD=ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE,ASOP=%Y#SOP_SETENBHSTUP,FLGS=
             15023                 DSBHSTDWN);
     1404    15065             %TRANS(OLD=ENB,NEW=DSB,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_SETENBHSTUP,FLGS=KLLHSTDWN
             15065                 );
     1405    15107             %TRANS(OLD=BSY,NEW=BSYDSBPND,ASOP=%Y#SOP_SETENBHSTUP,FLGS=DSBHSTDWN);
     1406    15149             %TRANS(OLD=BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_SETENBHSTUP,FLGS=
             15149                 KLLHSTDWN);
     1407    15191             %TRANS(OLD=LINPROPND_ENB,NEW=DSB,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_SETENBHSTUP,FLGS
             15191                 =KLLHSTDWN);
     1408    15233             %TRANS(OLD=LINPROPND_BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL,ASOP=
             15233                 %Y#SOP_SETENBHSTUP,FLGS=KLLHSTDWN);
     1409    15275             %TRANS(OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL,ASOP=
             15275                 %Y#SOP_SETENBHSTUP,FLGS=KLLHSTDWN);
     1410    15317             %TRANS(OLD=LINPROPND_ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE,ASOP=%Y#SOP_SETENBHSTUP,
             15317                 FLGS=DSBHSTDWN);
     1411    15359             %TRANS(OLD=LINPROPND_BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_DISABLE,ASOP=
             15359                 %Y#SOP_SETENBHSTUP,FLGS=DSBHSTDWN);
     1412    15401             %TRANS(LAST=YES);
     1413    15443
     1414    15444        /*
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:156  
     1415    15445             HOST UP
     1416    15446
     1417    15447         */
     1418    15448    1   DCL 1 TRAN_HOSTUP CONSTANT,
     1419    15449             %TRANS(OLD=DSB,NEW=ENB,HOP=%KHA_FNC_ENABLE,BSOP=%Y#SOP_CLRENBHSTUP,FLGS=
             15449                 ENBHSTUP);
     1420    15491             %TRANS(OLD=BSYDSBPND,NEW=BSY,BSOP=%Y#SOP_CLRENBHSTUP,FLGS=ENBHSTUP);
     1421    15533        %TRANS(OLD=BSY,NEW=BSY,HOP=%KHA_FNC_HOSTUP);
     1422    15575        %TRANS(OLD=ENB,NEW=ENB,HOP=%KHA_FNC_HOSTUP);
     1423    15617             %TRANS (LAST=YES);
     1424    15659
     1425    15660
     1426    15661        /*
     1427    15662             EVENT: ACTIVE
     1428    15663         */
     1429    15664    1   DCL 1 TRAN_ACTIVE CONSTANT,
     1430    15665             %TRANS(ASOP=%Y#SOP_SNDADM);
     1431    15707             %TRANS(LAST=YES);
     1432    15749
     1433    15750        /*E* ERROR: KHA-E$ILGLTRANS
     1434    15751             MESSAGE: That function is illegal for the current state.
     1435    15752           MESSAGE1: The function specified conflicts with the current state of the channel.
     1436    15753         */
     1437    15754        /*E* ERROR: KHA-E$DEDCHN
     1438    15755             MESSAGE: That channel is dead.  KILL channel and try again.
     1439    15756             MESSAGE1: That function is illegal on a dead channel.
     1440    15757        */
     1441    15758        /*E* ERROR: KHA-E$CLKFAILED
     1442    15759             MESSAGE: KHC$CLOCK altreturned.
     1443    15760             MESSAGE1: An M$READ or M$WRITE failed.  A clock setup to
     1444    15761                      reissue the read/write also failed.
     1445    15762        */
     1446    15763
     1447    15764
     1448    15765        /*
     1449    15766             The next item is an array pointing to the different transition
     1450    15767              table for each event.  If KHA_FNC_E changes this table needs to
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:157  
     1451    15768              change also.
     1452    15769         */
     1453    15770    1   DCL TRANS_TABLE$(0:%KHA_FNC_HI) PTR CONSTANT INIT(
     1454    15771    1                          ADDR(NIL) ,      /* %KHA_FNC_NON                       */
     1455    15772    1                       ADDR(TRAN_ENABLE) , /* %KHA_FNC_ENABLE                    */
     1456    15773    1                      ADDR(TRAN_DISABLE) , /* %KHA_FNC_DISABLE                   */
     1457    15774    1                         ADDR(TRAN_KILL) , /* %KHA_FNC_KILL                      */
     1458    15775    1                               ADDR(NIL) , /* %KHA_FNC_REQSTATS                  */
     1459    15776    1                               ADDR(NIL) , /* %KHA_FNC_CONTROL                   */
     1460    15777    1                      ADDR(NIL)          , /* %KHA_FNC_RELEASE                   */
     1461    15778    1                    ADDR(TRAN_PARTITION) , /* %KHA_FNC_PARTITION                 */
     1462    15779    1                    ADDR(TRAN_PARTITION) , /* %KHA_FNC_PARTITION_DGN             */
     1463    15780    1                       ADDR(TRAN_RETURN) , /* %KHA_FNC_RETURN                    */
     1464    15781    1                               ADDR(NIL) , /* %KHA_FNC_BLDCTX                    */
     1465    15782    1                               ADDR(NIL) , /* %KHA_FNC_BLDCTXCMP                 */
     1466    15783    1               ADDR(TRAN_DISCONNECT_EVT) , /* %KHA_FNC_DISCONNECT_EVT        */
     1467    15784    1               ADDR(TRAN_DISCONNECT_RQS) , /* %KHA_FNC_DISCONNECT_RQS        */
     1468    15785    1                      ADDR(TRAN_CONNECT) , /* %KHA_FNC_CONNECT                   */
     1469    15786    1                       ADDR(NIL) ,         /* %KHA_FNC_INTCTR                    */
     1470    15787    1                       ADDR(TRAN_INTDVC) , /* %KHA_FNC_INTDVC                    */
     1471    15788    1                       ADDR(TRAN_CONFIG) , /* %KHA_FNC_CNFG                      */
     1472    15789    1                  ADDR(TRAN_RQSLINPRO) ,   /* %KHA_FNC_RQSLINPRO              */
     1473    15790    1                  ADDR(TRAN_BLDLINPRO) ,   /* %KHA_FNC_BLDLINPRO                 */
     1474    15791    1                               ADDR(NIL) , /* %KHA_FNC_RQSDEFPRO                 */
     1475    15792    1                   ADDR(TRAN_SGNRJC),      /* %KHA_FNC_SGNRJC                 */
     1476    15793    1                  ADDR(TRAN_CNCRQSLINPRO), /* %KHA_FNC_CNCRQSLINPRO */
     1477    15794    1                    ADDR(TRAN_DVCERR),     /* %KHA_FNC_DVCERR */
     1478    15795    1                    ADDR(TRAN_DVCERRRSP),  /* %KHA_FNC_DVCERRRSP                 */
     1479    15796    1                   ADDR(TRAN_HOSTDOWN),    /* %KHA_FNC_HOSTDOWN                  */
     1480    15797    1                   ADDR(TRAN_HOSTUP),      /* %KHA_FNC_HOSTUP                    */
     1481    15798    1                   ADDR(NIL),              /* %KHA_FNC_CHNTBL  */
     1482    15799    1                   ADDR(TRAN_ACTIVE),      /* %KHA_FNC_ACTIVE                    */
     1483    15800    1                   ADDR(TRAN_ACTIVE)  /* %KHA_FNC_NOTACTIVE                    */
     1484    15801    1                                     );
     1485    15802
     1486    15803
     1487    15804        %KH$CHN(NAME=CHN_C,STCLASS=CONSTANT);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:158  
     1488    15928        %KH$CHN(NAME=CHN,STCLASS=AUTO);
     1489    16052        /* SYMREFS */
     1490    16053        %KH_CHNDAT;
     1491    16071    1   DCL KH_ADMIN$ EPTR SYMREF;
     1492    16072    1   DCL KH_NA_DCB# UBIN SYMREF;
     1493    16073    1   DCL KH_CTLTBL$ PTR SYMREF;
     1494    16074    1   DCL KH_INHLVL UBIN SYMREF;
     1495    16075    1   DCL KH_FLDWRTS SBIN SYMREF;
     1496    16076
     1497    16077        /* Auto */
     1498    16078    1   DCL TRANS$ PTR;
     1499    16079    1   DCL CHN$ PTR;
     1500    16080    1   DCL CTR$ PTR;
     1501    16081    1   DCL CTRCHN UBIN;
     1502    16082    1   DCL CTRTYPE UBIN;
     1503    16083    1   DCL LEV UBIN;
     1504    16084        %B$TERMINAL_ID (FPTN=TERMID,STCLASS=AUTO);
     1505    16113        %B$TERMINAL_ID (FPTN=TMP_TERMID,STCLASS=AUTO);
     1506    16142        %B$TERMINAL_ID (FPTN=TERMID_C,STCLASS=CONSTANT);
     1507    16171    1   DCL LIN$ PTR;
     1508    16172    1   DCL SIZE UBIN;
     1509    16173        %KH$ADMIN_FPT (FPTN=ADMIN_FPT,STCLASS=AUTO);
     1510    16384    1   DCL HOP UBIN;
     1511    16385    1   DCL BSOP UBIN;
     1512    16386    1   DCL ASOP UBIN;
     1513    16387    1   DCL NEW SBIN;
     1514    16388    1   DCL OLD UBIN;
     1515    16389    1   DCL STOP_FLAG BIT(1);
     1516    16390    1   DCL CHAN UBIN;
     1517    16391    1   DCL CHANLO UBIN;
     1518    16392    1   DCL CHANHI UBIN;
     1519    16393    1   DCL SUB UBIN;
     1520    16394    1   DCL SUBLO UBIN;
     1521    16395    1   DCL SUBHI UBIN;
     1522    16396    1   DCL SUBSUB UBIN;
     1523    16397    1   DCL SUBSUBLO UBIN;
     1524    16398    1   DCL SUBSUBHI UBIN;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:159  
     1525    16399    1   DCL RQSPRO_BUF(0:59) UBIN WORD;
     1526    16400    1   DCL RQSPRO$ PTR;
     1527    16401        %KL_RQSCHN (FPTN=KL_RQSPRO,STCLASS="BASED(RQSPRO$)");
     1528    16504        %FPT_WRITE (FPTN=KHA_WRITE,STCLASS=SYMREF);
     1529    16528        %KL_ADMIN (FPTN=ADMINC,STCLASS=CONSTANT,ORIGIN='KHA$ADMN');
     1530    16689        %KL_ADMIN (FPTN=ADMIN,STCLASS=AUTO,ORIGIN='KHA$ADMN');
     1531    16850    1   DCL KEYIN UBIN;
     1532    16851
     1533    16852        /* Based */
     1534    16853        %TRANS (FPTN=B$TRANS,STCLASS="BASED(TRANS$)",LVL=1,LAST=YES);
     1535    16895        %KH$CHN (STCLASS="BASED(CHN$)");
     1536    17019        %KL_HNDCMN_INFO (FPTN=KHA,STCLASS=BASED,LAST=";");
     1537    17099    1   DCL ONEWORD UBIN WORD BASED;
     1538    17100    1   DCL SIGNON CHAR(SIZE) BASED;
     1539    17101        %KH$CTLTBL (STCLASS="BASED(KH_CTLTBL$)");
     1540    17313
     1541    17314        /* ERRCODES */
     1542    17315        %VLP_ERRCODE (FPTN=ERR_BADCHN,FCG=KH,MID=A,MON='1'B,ERR#=%E$CHAN_NOT_THERE,STCLASS=
             17315            CONSTANT);
     1543    17361        /*E* ERROR: KHA-E$CHAN_NOT_THERE
     1544    17362             MESSAGE: That channel is undefined.
     1545    17363         */
     1546    17364        %VLP_ERRCODE (FPTN=ERR_ILGLTRANS,FCG=KH,MID=A,MON='1'B,ERR#=%E$ILGLTRANS,STCLASS=
             17364            CONSTANT);
     1547    17410        %VLP_ERRCODE(FPTN=ERR_CLKFAILED,FCG=KH,MID=A,MON='1'B,ERR#=%E$CLKFAILED,STCLASS=
             17410            CONSTANT);
     1548    17456        %VLP_ERRCODE (FPTN=ERR_DEDCHN,FCG=KH,MID=A,MON='1'B,ERR#=%E$DEDCHN,STCLASS=CONSTANT)
             17456            ;
     1549    17502        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:160  
     1550    17503    1        INHIBIT_LEVEL = KH_INHLVL;
     1551    17504             %DISABLE;
     1552    17508    1        LEV = TERMLO.LEV;
     1553    17509    1        CHANLO = TERMLO.TERM.CHANNEL / 128;
     1554    17510    1        CHANHI = CHANLO;
     1555    17511    1        SUBLO = TERMLO.TERM.SUBDEVICE;
     1556    17512    1        SUBHI = SUBLO;
     1557    17513    1        SUBSUBLO = TERMLO.TERM.SUBSUBDEVICE;
     1558    17514    1        SUBSUBHI = SUBSUBLO;
     1559    17515    1        STOP_FLAG = '1'B;
     1560    17516    1        GOTO COMMON;
     1561    17517        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:161  
     1562    17518    1   KHA$DVCADM_RNG: ENTRY (OPERATION,ERROR,TERMLO,TERMHI,DATAVEC,NORETRAN) ALTRET;
     1563    17519    1        INHIBIT_LEVEL = KH_INHLVL;
     1564    17520             %DISABLE;
     1565    17524    2        CALL KHA$CHK_TRM_RNG(TERMLO,TERMHI) WHENALTRETURN DO;
     1566    17525    2             ERROR = ERR_BADCHN;
     1567    17526                  %ENABLE;
     1568    17532    2             ALTRETURN;
     1569    17533    2           END;                            /* WHENALTRETURN */
     1570    17534    1        LEV = TERMLO.LEV;
     1571    17535    1        CHANLO = TERMLO.TERM.CHANNEL / 128;
     1572    17536    1        CHANHI = TERMHI.TERM.CHANNEL / 128;
     1573    17537    1        SUBLO = TERMLO.TERM.SUBDEVICE;
     1574    17538    1        SUBHI = TERMHI.TERM.SUBDEVICE;
     1575    17539    1        SUBSUBLO = TERMLO.TERM.SUBSUBDEVICE;
     1576    17540    1        SUBSUBHI = TERMHI.TERM.SUBSUBDEVICE;
     1577    17541    1        STOP_FLAG = '0'B;
     1578    17542    1        GOTO COMMON;
     1579    17543        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:162  
     1580    17544    1   KHA$DVCADM_ALL: ENTRY (OPERATION,ERROR,TERMLO,TERMHI,DATAVEC,NORETRAN) ALTRET;
     1581    17545    1        INHIBIT_LEVEL = KH_INHLVL;
     1582    17546             %DISABLE;
     1583    17550    1        CHANLO = KH_CHNLOW$->KH$CHN.CHNBIT0_9 * 64 / 128;
     1584    17551    1        CHANHI = KH_CHNHI$->KH$CHN.CHNBIT0_9 * 64 / 128;
     1585    17552    1        SUBLO = 0;
     1586    17553    1        SUBHI = 0;
     1587    17554    1        SUBSUBLO = 0;
     1588    17555    1        SUBSUBHI = 0;
     1589    17556    1        LEV = %TERMINAL_ID_LEV_CHAN#;
     1590    17557    1        STOP_FLAG = '0'B;
     1591    17558        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:163  
     1592    17559    1   COMMON: ;
     1593    17560    1        ERROR = '0'B;
     1594    17561    1        IF OPERATION > %KHA_FNC_HI+1
     1595    17562    2        THEN DO;
     1596    17563    2             ERROR = ERR_ILGLTRANS;
     1597    17564                  %ENABLE;
     1598    17570    2             ALTRETURN;
     1599    17571    2           END;
     1600    17572    1        TERMID = TERMID_C;
     1601    17573    1        IF ADDR(TERMLO) ~= ADDR(NIL)
     1602    17574    1        THEN
     1603    17575    1             TERMID.TERM.TERM_NAME = TERMLO.TERM.TERM_NAME;
     1604    17576    1        TERMID.LEV = LEV;
     1605    17577    2        DO CHAN = CHANLO TO CHANHI;
     1606    17578    2             TERMID.TERM.CHANNEL = CHAN * 128;
     1607    17579    3             DO SUB = SUBLO TO SUBHI;
     1608    17580    3                  TERMID.TERM.SUBDEVICE = SUB;
     1609    17581    4                  DO SUBSUB = SUBSUBLO TO SUBSUBHI;
     1610    17582    4                       TERMID.TERM.SUBSUBDEVICE = SUBSUB;
     1611    17583    5                       CALL KHA$GET_CTX_PTR(TERMID,CHN$) WHENALTRETURN DO;
     1612    17584    5                            ERROR = ERR_BADCHN;
     1613    17585    5                            GOTO ERROR_CHECK;
     1614    17586    5                          END;             /* WHENALTRETURN */
     1615    17587    5                       IF LEV = %TERMINAL_ID_LEV_CHAN# THEN DO;
     1616    17588    5                            LIN$ = CHN$;
     1617    17589    5                          END;             /* IF */
     1618    17590    5                       ELSE DO;
     1619    17591    5                            TMP_TERMID = TERMID;
     1620    17592    5                            TMP_TERMID.LEV = %TERMINAL_ID_LEV_CHAN#;
     1621    17593    5                            TMP_TERMID.TERM.SUBDEVICE = 0;
     1622    17594    5                            TMP_TERMID.TERM.SUBSUBDEVICE = 0;
     1623    17595    5                            CALL KHA$GET_CTX_PTR(TMP_TERMID,LIN$);
     1624    17596    5                          END;             /* ELSE */
     1625    17597    4                       OLD = KH$CHN.STT;
     1626    17598        /* Find the transition table */
     1627    17599    4                       TRANS$ = TRANS_TABLE$(OPERATION);
     1628    17600    4                       IF TRANS$ = ADDR(NIL)
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:164  
     1629    17601    5                       THEN DO;
     1630    17602                                 %ENABLE;
     1631    17608    5                            RETURN;
     1632    17609    5                          END;
     1633    17610
     1634    17611    5                       DO WHILE (NOT B$TRANS.LAST);
     1635    17612    5                            IF B$TRANS.OLD = OLD OR B$TRANS.OLD = -1
     1636    17613    5                            THEN
     1637    17614    6                            DO CASE (B$TRANS.FLGS);
     1638    17615
     1639    17616    6                            CASE (%Y#ENB);
     1640    17617    6                               IF KH$CHN.ENB
     1641    17618    6                               THEN
     1642    17619    6                                    GOTO GOT_TRANS;
     1643    17620
     1644    17621    6                            CASE (%Y#REENB);
     1645    17622    6                               IF KH$CHN.RE_ENB
     1646    17623    6                               THEN
     1647    17624    6                                    GOTO GOT_TRANS;
     1648    17625
     1649    17626    6                            CASE (%Y#DED);
     1650    17627    6                               IF KH$CHN.DED
     1651    17628    6                               THEN
     1652    17629    6                                    GOTO GOT_TRANS;
     1653    17630
     1654    17631    6                            CASE (%Y#CTR);
     1655    17632    6                               IF KH$CHN.CTR
     1656    17633    6                               THEN
     1657    17634    6                                    GOTO GOT_TRANS;
     1658    17635
     1659    17636
     1660    17637    6                            CASE (%Y#ERR);
     1661    17638
     1662    17639    6                            CASE (%Y#NOTDED);
     1663    17640    6                               IF ~KH$CHN.DED
     1664    17641    7                               THEN DO;
     1665    17642    7                                    ERROR = '0'B;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:165  
     1666    17643    7                                    GOTO GOT_TRANS;
     1667    17644    7                                  END;
     1668    17645    6                               ERROR = ERR_DEDCHN;
     1669    17646    6                            CASE (%Y#KLLHSTDWN);
     1670    17647    6                               IF KH$CHN.KLLHSTDWN
     1671    17648    6                               THEN
     1672    17649    6                                    GOTO GOT_TRANS;
     1673    17650
     1674    17651    6                            CASE (%Y#DSBHSTDWN);
     1675    17652    6                               IF KH$CHN.DSBHSTDWN
     1676    17653    6                               THEN
     1677    17654    6                                    GOTO GOT_TRANS;
     1678    17655
     1679    17656    6                            CASE (%Y#ENBHSTUP);
     1680    17657    6                               IF KH$CHN.ENBHSTUP
     1681    17658    6                               THEN
     1682    17659    6                                    GOTO GOT_TRANS;
     1683    17660
     1684    17661
     1685    17662    6                            CASE (ELSE);
     1686    17663    6                               GOTO GOT_TRANS;
     1687    17664
     1688    17665    6                            END /* END CASES */;
     1689    17666    5                            TRANS$ = PINCRW(TRANS$,SIZEW(B$TRANS));
     1690    17667    5                          END;             /* End DO WHILE (B$TRANS.LAST)        */
     1691    17668
     1692    17669    4                       IF ERROR = '0'B THEN
     1693    17670    4                            ERROR = ERR_ILGLTRANS;
     1694    17671    4                       GOTO ERROR_CHECK;
     1695    17672
     1696    17673    4   GOT_TRANS:          ;
     1697    17674    4                       IF B$TRANS.NEW = -1
     1698    17675    4                       THEN
     1699    17676    4                            NEW = OLD;
     1700    17677    4                       ELSE
     1701    17678    4                            NEW = B$TRANS.NEW;
     1702    17679    4                       IF NEW = -1         /* Illegal state transition           */
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:166  
     1703    17680    5                       THEN DO;
     1704    17681    5                            ERROR = ERR_ILGLTRANS;
     1705    17682    5                            GOTO ERROR_CHECK;
     1706    17683    5                          END;
     1707    17684    4                       HOP = B$TRANS.HOP;
     1708    17685    4                       BSOP = B$TRANS.BSOP;
     1709    17686    4                       ASOP = B$TRANS.ASOP;
     1710    17687    4                       KH$CHN.STT = NEW;
     1711    17688
     1712    17689        /* Do any special operations before the call to admin */
     1713    17690    5                       DO CASE (BSOP);
     1714    17691
     1715    17692    5                       CASE (%Y#SOP_INTCTR);
     1716    17693    5                          CALL GET_CONTROLLER;
     1717    17694    5                          IF NOT CTR$->KH$CHN.CCPDWNLD(CTRTYPE) AND
     1718    17695    5                               KH$CHN.TERMID.LEV    = %TERMINAL_ID_LEV_CHAN#
     1719    17696    6                          THEN DO;
     1720    17697    6                               ADMIN_FPT.FNC = %KHA_FNC_INTCTR;
     1721    17698    6                               ADMIN_FPT.TERMID = TERMID;
     1722    17699    6                               ADMIN_FPT.CHN$ = CHN$;
     1723    17700    6                               ADMIN_FPT.LIN$ = LIN$;
     1724    17701    6                               CALL KH_ADMIN$(ADMIN_FPT)
     1725    17702    7                               WHENALTRETURN DO;
     1726    17703    7                                    ERROR = ADMIN_FPT.RESULTS;
     1727    17704    7                                    KH$CHN.STT = OLD;
     1728    17705    7                                    GOTO ERROR_CHECK;
     1729    17706    7                                  END;
     1730    17707    6                               CTR$->KH$CHN.CCPDWNLD(CTRTYPE) = '1'B;
     1731    17708    6                             END;
     1732    17709    5                       CASE(%Y#SOP_UPDCHN);
     1733    17710    5                       CASE(%Y#SOP_RQSLINPRO);
     1734    17711    5                          RQSPRO$ = ADDR(RQSPRO_BUF);
     1735    17712    5                          RQSPRO_BUF = '0'B;
     1736    17713    5                          KL_RQSPRO.FCN = IGA_RQSCHN;
     1737    17714    5                          KL_RQSPRO.LINE_PROFILE = '1'B;
     1738    17715    5                          KL_RQSPRO.TERMINAL_ID = TERMID;
     1739    17716    5                          KL_RQSPRO.TERMINAL_ID.TTYP = TERMLO.TTYP;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:167  
     1740    17717    6                          IF ADDR(DATAVEC) ~= ADDR(NIL) THEN DO;
     1741    17718    6                               KL_RQSPRO.SGN.L = VBOUND(DATAVEC) + 1;
     1742    17719    6                               SIZE = VBOUND(DATAVEC) + 1;
     1743    17720    6                               KL_RQSPRO.SGN.TXT = VBASE(DATAVEC)->SIGNON;
     1744    17721    6                             END;          /* IF */
     1745    17722    6                          ELSE DO;
     1746    17723    6                               KL_RQSPRO.SGN.L = 0;
     1747    17724    6                               KL_RQSPRO.SGN.TXT = ' ';
     1748    17725    6                             END;          /* ELSE */
     1749    17726    5                          KHA_WRITE.BUF_ = VECTOR(RQSPRO_BUF);
     1750    17727    5                          IF KH_FLDWRTS > 0 THEN
     1751    17728    6                          DO;
     1752    17729    6                               IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0 THEN
     1753    17730    6                                    ALTRETURN;
     1754    17731    6                               CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
     1755    17732    7                               DO;
     1756    17733    7                                    ERROR = ERR_CLKFAILED;
     1757    17734    7                                    GOTO ERROR_CHECK;
     1758    17735    7                                  END;
     1759    17736    6                             END;
     1760    17737    5                          ELSE
     1761    17738    5                               CALL M$WRITE(KHA_WRITE) WHENALTRETURN
     1762    17739    6                               DO;
     1763    17740    6                                    IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0
             17740                                             THEN
     1764    17741    6                                         ALTRETURN;
     1765    17742    6                                    ELSE
     1766    17743    6                                         CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
     1767    17744    7                                         DO;
     1768    17745    7                                              ERROR = ERR_CLKFAILED;
     1769    17746    7                                              GOTO ERROR_CHECK;
     1770    17747    7                                            END;
     1771    17748    6                                  END;
     1772    17749
     1773    17750    5                       CASE(%Y#SOP_BLDLINPRO);
     1774    17751    5                          CALL KHA$BLDLINPRO(TERMID,VBASE(DATAVEC)) ALTRET(ERROR_CHECK)
             17751                                   ;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:168  
     1775    17752    5                       CASE(%Y#SOP_DVCERR);
     1776    17753    5                          KHA_WRITE.BUF_ = DATAVEC;
     1777    17754    5                          IF KH_FLDWRTS > 0 THEN
     1778    17755    6                          DO;
     1779    17756    6                               IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0 THEN
     1780    17757    6                                    ALTRETURN;
     1781    17758    6                               CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
     1782    17759    7                               DO;
     1783    17760    7                                    ERROR = ERR_CLKFAILED;
     1784    17761    7                                    GOTO ERROR_CHECK;
     1785    17762    7                                  END;
     1786    17763    6                             END;
     1787    17764    5                          ELSE
     1788    17765    5                               CALL M$WRITE(KHA_WRITE) WHENALTRETURN
     1789    17766    6                               DO;
     1790    17767    6                                    IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0
             17767                                             THEN
     1791    17768    6                                         ALTRETURN;
     1792    17769    6                                    ELSE
     1793    17770    6                                         CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
     1794    17771    7                                         DO;
     1795    17772    7                                              ERROR = ERR_CLKFAILED;
     1796    17773    7                                              GOTO ERROR_CHECK;
     1797    17774    7                                            END;
     1798    17775    6                                  END;
     1799    17776
     1800    17777    5                       CASE(%Y#SOP_DVCERRRSP);
     1801    17778    5                          ADMIN = ADMINC;
     1802    17779    5                          KEYIN = VBASE(DATAVEC)->ONEWORD;
     1803    17780    5                          ADMIN_FPT.CTX$ = ADDR(KEYIN);
     1804    17781
     1805    17782    5                       CASE(%Y#SOP_CLRENBHSTUP);
     1806    17783    5                          KH$CHN.ENBHSTUP = '0'B;
     1807    17784
     1808    17785    5                       END;                /* End cases                          */
     1809    17786
     1810    17787        /* Call the handler admin routine */
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:169  
     1811    17788    4                       IF HOP ~= %KHA_FNC_NON
     1812    17789    5                       THEN DO;
     1813    17790    5                            ADMIN_FPT.FNC = HOP;
     1814    17791    5                            ADMIN_FPT.TERMID = TERMID;
     1815    17792    5                            ADMIN_FPT.CHN$ = CHN$;
     1816    17793    5                            ADMIN_FPT.LIN$ = LIN$;
     1817    17794    5                            CALL KH_ADMIN$(ADMIN_FPT)
     1818    17795    6                            WHENALTRETURN DO;
     1819    17796    6                                 ERROR = ADMIN_FPT.RESULTS;
     1820    17797    6                                 KH$CHN.STT = OLD;
     1821    17798    6                                 GOTO ERROR_CHECK;
     1822    17799    6                               END;        /* WHENALTRETURN */
     1823    17800    5                          END;             /* IF HOP ~= NON */
     1824    17801
     1825    17802        /* Do any special processing after operation */
     1826    17803    5                       DO CASE (ASOP);
     1827    17804    5                       CASE(%Y#SOP_RSTDED);
     1828    17805    5                          KH$CHN.DED = '0'B;
     1829    17806
     1830    17807
     1831    17808    5                       CASE (%Y#SOP_PRT);
     1832    17809    5                          KH$CHN.DWNLOD = '0'B;
     1833    17810    5                          KH$CHN.DED = '0'B;
     1834    17811    5                          KH$CHN.HAND$ = ADDR(NIL);
     1835    17812    5                          KH$CHN.SYSID = 0;
     1836    17813    5                          CALL GET_CONTROLLER;
     1837    17814    5                          CTR$->KH$CHN.CCPDWNLD(CTRTYPE) = '0'B;
     1838    17815
     1839    17816    5                       CASE (%Y#SOP_ENB);
     1840    17817    5                          KH$CHN.DWNLOD = '1'B;
     1841    17818
     1842    17819    5                       CASE (%Y#SOP_SETENBHSTUP);
     1843    17820    5                          KH$CHN.ENBHSTUP = '1'B;
     1844    17821
     1845    17822    5                       CASE (%Y#SOP_SNDADM);
     1846    17823    5                          ADMIN = ADMINC;
     1847    17824    5                          ADMIN.TERMID_LO = KH$CHN.TERMID;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:170  
     1848    17825    5                          ADMIN.TERMID_HI = KH$CHN.TERMID;
     1849    17826    5                          ADMIN.FNC = OPERATION;
     1850    17827    5                          KHA_WRITE.BUF_ = VECTOR(ADMIN);
     1851    17828    5                          IF KH_FLDWRTS > 0 THEN
     1852    17829    6                          DO;
     1853    17830    6                               IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0 THEN
     1854    17831    6                                    ALTRETURN;
     1855    17832    6                               CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
     1856    17833    7                               DO;
     1857    17834    7                                    ERROR = ERR_CLKFAILED;
     1858    17835    7                                    GOTO ERROR_CHECK;
     1859    17836    7                                  END;
     1860    17837    6                             END;
     1861    17838    5                          ELSE
     1862    17839    5                               CALL M$WRITE(KHA_WRITE) WHENALTRETURN
     1863    17840    6                               DO;
     1864    17841    6                                    IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0
             17841                                             THEN
     1865    17842    6                                         ALTRETURN;
     1866    17843    6                                    ELSE
     1867    17844    6                                         CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN
     1868    17845    7                                         DO;
     1869    17846    7                                              ERROR = ERR_CLKFAILED;
     1870    17847    7                                              GOTO ERROR_CHECK;
     1871    17848    7                                            END;
     1872    17849    6                                  END;
     1873    17850
     1874    17851    5                       END;                /* end cases                          */
     1875    17852
     1876    17853    4   NEXT_CHANNEL:       ;
     1877    17854    4                     END;                  /* DO SUBSUB */
     1878    17855    3                END;                       /* DO SUB */
     1879    17856    2           END;                            /* DO CHAN */
     1880    17857             %ENABLE;
     1881    17863    1        RETURN;
     1882    17864
     1883    17865    1   ERROR_CHECK: ;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:171  
     1884    17866                 /*N* ERRORLOG */
     1885    17867    1        IF STOP_FLAG
     1886    17868    2        THEN DO;
     1887    17869                  %ENABLE;
     1888    17875    2             ALTRETURN;
     1889    17876    2           END;                            /* IF */
     1890    17877    1        GOTO NEXT_CHANNEL;
     1891    17878
     1892    17879        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:172  
     1893    17880    1   GET_CONTROLLER: PROC;
     1894    17881    3        DO SELECT(KH$CHN.DVCID & 'FF00'X);
     1895    17882
     1896    17883    3             SELECT ('2100'X);             /* MLC-8 */
     1897    17884    3             CTRCHN = (TERMID.TERM.CHANNEL/(64*16))*64*16;
     1898    17885    3   SET_CCPTYPE: ;
     1899    17886    3             IF KH$CHN.ATTR & %G_ATTR_CL_ASYNC
     1900    17887    3             THEN
     1901    17888    3                  CTRTYPE = %KH#CHN_CCPDWNLD_ASYNC;
     1902    17889    3             ELSE
     1903    17890    3                  IF KH$CHN.ATTR & %G_ATTR_CL_SYNC
     1904    17891    3                  THEN
     1905    17892    3                       CTRTYPE=%KH#CHN_CCPDWNLD_SYNC;
     1906    17893    3                  ELSE
     1907    17894    3                       IF KH$CHN.ATTR & %G_ATTR_CL_HDLC
     1908    17895    3                       THEN
     1909    17896    3                            CTRTYPE=%KH#CHN_CCPDWNLD_HDLC;
     1910    17897    3                       ELSE
     1911    17898    3                            CTRTYPE=%KH#CHN_CCPDWNLD_OTHER;
     1912    17899
     1913    17900    3             SELECT ('2900'X);
     1914    17901    3             CTRCHN = (TERMID.TERM.CHANNEL/(64*32))*64*32;
     1915    17902    3             GOTO SET_CCPTYPE;
     1916    17903
     1917    17904    3             SELECT (ELSE);
     1918    17905    3        CTRCHN = TERMID.TERM.CHANNEL;
     1919    17906    3        CTRTYPE=%KH#CHN_CCPDWNLD_OTHER;
     1920    17907
     1921    17908    3           END;
     1922    17909    2        CTR$ = PINCRW(KH_CHNLOW$,CTRCHN/128*SIZEW(KH$CHN));
     1923    17910
     1924    17911    2        RETURN;
     1925    17912
     1926    17913    2   END GET_CONTROLLER;
     1927    17914    1   END KHA$DVCADM;

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:173  
--  Include file information  --

   B_ERRORS_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KHA$DVCADM.

   Procedure KHA$DVCADM requires 1403 words for executable code.
   Procedure KHA$DVCADM requires 216 words of local(AUTO) storage.

    No errors detected in file KHA$ADMIN.:E05TSI    .

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:174  

 Object Unit name= KHA$DVCADM                                 File name= KHA$ADMIN.:E05TOU
 UTS= JUL 30 '97 00:26:42.16 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    562    232  KHA$DVCADM
    1   Proc  even  none  1403    57B  KHA$DVCADM
    2  RoData even  none     3      3  KHA$DVCADM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        6  KHA$DVCADM
     1     37          yes     yes      Std        6  KHA$DVCADM_RNG
     1     95          yes     yes      Std        6  KHA$DVCADM_ALL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KHI$DISABLE
         yes           Std       0 KHI$ENABLE
 yes     yes           Std       2 KHA$GET_CTX_PTR
 yes     yes           Std       2 KHA$CHK_TRM_RNG
 yes     yes           Std       1 KHA$SETCLK
 yes     yes           Std       2 KHA$BLDLINPRO
                       nStd      0 X6A_AUTO_N
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET
                       nStd      0 X6C_ALR
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:175  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_CHNLOW$                       r    KH_CHNHI$                        r    KH_CHNHI
r    KH_CHNLOW                             KH_ADMIN$                             KH_CTLTBL$
     KH_INHLVL                             KH_FLDWRTS                            KHA_WRITE
r    G$ROS$
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:176  


      915        1        /*T***********************************************************/
      916        2        /*T*                                                         */
      917        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      918        4        /*T*                                                         */
      919        5        /*T***********************************************************/
      920        6        KHA$DVCADM: PROC (OPERATION,ERROR,TERMLO,TERMHI,DATAVEC,NORETRAN) ALTRET;

      6   1 000000  D380 0000 0000  xent KHA$DVCADM      LNJ,B5   X6A_AUTO_N
          1 000003       00D8 0006                       DC       216,6

      921        7
      922        8        /*F* NAME: KHA$DVCADM - Change Channel State
      923        9
      924       10        The library device administration routine, KHA$DVCADM, maintains
      925       11        KH$CHN.STT which contains a value that reflects the state of a channel.
      926       12        This routine may be called by the library administrative routine,
      927       13        KHA$ADMIN, or by user handler routines.  The KHA$DVCADM routine may in turn
      928       14        call the user handler administrative point when necessary to
      929       15        complete the state transition.
      930       16
      931       17        The following is a table of the state transitions and the functions
      932       18        that are done:
      933       19
      934       20        .fif
      935       21        }Operation: Indicates what function is being requested of KHA$DVCADM
      936       22        }           for this channel.  The value used for operation is
      937       23        }           from the KHA_FNC_E include file and is of the form
      938       24        }           KHA_FNC_operation.  See KHA_FNC_E for more detail.
      939       25        }
      940       26        }Caller:   Indicates who originated the state transition request.
      941       27        }
      942       28        }          s(system) - refers to NODEADMN, SLUG(KEYIN,STATS or NETCON).
      943       29        }          h         - refers to the handler.
      944       30        }
      945       31        }Flags:    Indicates which channel table flags must be on for the requested
      946       32        }          state transition.  See KH$CHN.flag for more detail.
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:177  
      947       33        }
      948       34        }Handler function:
      949       35        }          Indicates the value that will be supplied in KH$ADMIT_FPT.FNC
      950       36        }          when the handler is called at its administrative point to
      951       37        }          complete the operation.  This value is from the KHA_FNC_E
      952       38        }          include file and is of the form KHA_FNC_function.  See
      953       39        }          KHA_FNC_E for more detail.
      954       40        }
      955       41        }          If a handler function is not specified the handler's
      956       42        }          administrative entry will not be called.
      957       43        }
      958       44        }State:    States are defined in KH$CHN.STT.
      959       45        }
      960       46        .bbk
      961       47        }Operation        Caller  Old state  New state       Flags      Hndlr function
      962       48        }---------        ------  ---------  ---------     -----------  --------------
      963       49        }ENABLE           s or h   enable      enable                    ENABLE
      964       50        }                          disable     enable        ~DED        ENABLE
      965       51        }                          bsydsbpnd   busy                      ENABLE
      966       52        }                          uninit      uninit         DED
      967       53        }                          uninit      enable                    ENABLE
      968       54        }
      969       55        .bek
      970       56        }DISABLE          s or h   disable     disable
      971       57        }                          enable      disable                   DISABLE
      972       58        }                          busy        bsydsbpnd                 DISABLE
      973       59        }                          bsydsbpnd   bsydsbpnd
      974       60        }                          lpp_enable  disable                   DISABLE
      975       61        }                          lpp_busy    lpp_bsydsbpnd
      976       62        }                          lpp_bsydsbpnd lpp_bsydsbpnd
      977       63        }
      978       64        }KILL             s or h   enable      disable                   DISABLE
      979       65        }                          busy        bsydsbpnd                 KILL
      980       66        }                          bsydsbpnd   bsydsbpnd                 KILL
      981       67        }                          lpp_enable  disable                   DISABLE
      982       68        }                          lpp_busy    bsydsbpnd                 KILL
      983       69        }                          lpp_bsydsbpnd bsydsbpnd               KILL
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:178  
      984       70        }                          disable     disable        DED
      985       71        }
      986       72        }PARTITION        s        enable      partition                 KILL
      987       73        }                          disable     partition                 KILL
      988       74        }                          uninit      partition                 KILL
      989       75        }
      990       76        }RETURN           s        partition   uninit
      991       77        }
      992       78        }DISCONNECT_EVT * h        busy        enable         REENB
      993       79        }                          busy        disable                   DISABLE
      994       80        }                          bsydsbpnd   disable                   DISABLE
      995       81        }
      996       82        }DISCONNECT_RQS   s or h   busy        busy                   DISCONNECT_RQS
      997       83        }                          bsydsbpnd   bsydsbpnd              DISCONNECT_RQS
      998       84        }                          lpp_busy    lpp_busy               DISCONNECT_RQS
      999       85        }                          lpp_bsydsbpnd lpp_bsydsbpnd        DISCONNECT_RQS
     1000       86        }
     1001       87        }CONNECT *        h        enable      busy
     1002       88        }
     1003       89        }INTDVC           s        uninit      enable         ENB        ENABLE
     1004       90        }                          uninit      uninit         DED        DISABLE
     1005       91        }                          partition   partition
     1006       92        }                          uninit      disable        ERR        DISABLE
     1007       93        }
     1008       94        }CNFG             s        all         same as old               CNFG
     1009       95        }
     1010       96        }RQSLINPRO        h        enable      lpp_enable
     1011       97        }                          busy        lpp_busy
     1012       98        }                          bsydsbpnd   lpp_bsydsbpnd
     1013       99        }
     1014      100        }BLDLINPRO        s        lpp_enable  enable
     1015      101        }                          lpp_busy    busy
     1016      102        }                          lpp_bsydspnd bsydsbpnd
     1017      103        }
     1018      104        }SGNRJC           s        lpp_enable  enable                    SGNRJC
     1019      105        }                          lpp_busy     busy                     SGNRJC
     1020      106        }                          lpp_bsydspnd bsydsbpnd                SGNRJC
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:179  
     1021      107        }
     1022      108        }CNCRQSLINPRO     h        lpp_enable  enable
     1023      109        }                          lpp_busy    busy
     1024      110        }                          lpp_bsydspnd bsydsbpnd
     1025      111        }
     1026      112        }DVCERR           h        all         same as old
     1027      113        }
     1028      114        }DVCERRRSP        s        all         same as old               DVCERRRSP
     1029      115        }
     1030      116        }HOSTDOWN         s        enable      disable        DSBHSTDWN  DISABLE
     1031      117        }                          enable      disable        KLLHSTDWN  KILL
     1032      118        }                          busy        bsydsbpnd      DSBHSTDWN
     1033      119        }                          busy        bsydsbpnd      KLLHSTDWN  KILL
     1034      120        }                          lpp_enb     disable        KLLHSTDWN  KILL
     1035      121        }                          lpp_bsy     bsydsbpnd      KLLHSTDWN  KILL
     1036      122        }                          lpp_bsydsbpnd bsydsbpnd    KLLHSTDWN  KILL
     1037      123        }                          lpp_bsy     bsydsbpnd      DSBHSTDWN  DISABLE
     1038      124        }                          lpp_enb     disable        DSBHSTDWN  DISABLE
     1039      125        }
     1040      126        }HOSTUP           s        disable     enable         ENBHSTUP   ENABLE
     1041      127        }                          bsydsbpnd   busy           ENBHSTUP
     1042      128        }
     1043      129        }ACTIVE *         h        all         same as old
     1044      130        }
     1045      131        }NOTACTIVE *      h        all         same as old
     1046      132        }
     1047      133        }        * sends administrative event to host.
     1048      134
     1049      135
     1050      136        .fin
     1051      137
     1052      138        Any requested operation which does not have a transition function
     1053      139        defined will result in an illegal state transition error and
     1054      140        the alternate return will be taken.
     1055      141
     1056      142        The form of this call is:
     1057      143
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:180  
     1058      144         CALL KHA$DVCADM (operation,error,term_low,term_hi,datavec,noretran) ALTRET(label);
     1059      145
     1060      146        where:
     1061      147        */
     1062      148        /*K* operation - UBIN(16).
     1063      149        contains a value that indicates what function
     1064      150        is to be performed.  Please refer to the description of KHA_FNC_E.
     1065      151        */
     1066      152
     1067      153        /*K* error - is where an error code will be returned
     1068      154        if the alternate return is taken.  This parameter is
     1069      155        in VLP_ERRCODE format.
     1070      156        The error codes are in the CP6 error message file, :ERRMSG.
     1071      157        */
     1072      158
     1073      159        /*K* term_low - a B$TERMINAL_ID structure that defines the
     1074      160        first item to be affected by this operation.
     1075      161        */
     1076      162
     1077      163        /*K* term_hi - a B$TERMINAL_ID structure that defines the
     1078      164        last item to be affected by this operation.
     1079      165        */
     1080      166
     1081      167        /*K* noretran - if specified, indicates that the caller does
     1082      168        not want the KHA$DVCADM routine to re-transmit any message
     1083      169        if any usage of M$WRITE fails.
     1084      170        */
     1085      171
     1086      172        /*K* datavec - is a vector to optional data:
     1087      173
     1088      174        .bbk
     1089      175        .fif
     1090      176                   operation            datavec structure
     1091      177                   --------             -----------------
     1092      178                   KHA_FNC_DVCERR       KL_KEYMES from file KL_MACRO_C
     1093      179                   KHA_FNC_RQSLINPRO    CHAR(255) TEXT signon string
     1094      180        .fin
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:181  
     1095      181        .bek
     1096      182        */
     1097      183        /* Includes */
     1098      184        %INCLUDE LCP_6;
     1099     4463        %INCLUDE CP_6_SUBS;
     1100     5003        %INCLUDE KH$CHN;
     1101     5125        %INCLUDE KH_CHN;
     1102     5165        %INCLUDE KHA_FNC_E;
     1103     5265        %INCLUDE KL_CONTROL_C;
     1104     5645        %INCLUDE KL_AFCN_C;
     1105     5746        %INCLUDE KL_MACRO_C;
     1106     9098        %INCLUDE KH_MACRO_C;
     1107     9841        %INCLUDE KHC_MAC_C;
     1108     9882        %INCLUDE B_ERRORS_C;
     1109    11009
     1110    11010        /* Parameters */
     1111    11011    1   DCL OPERATION UBIN;
     1112    11012        %VLP_ERRCODE (FPTN=ERROR,STCLASS="");
     1113    11058        %B$TERMINAL_ID (FPTN=TERMLO,STCLASS=PARAM,ALGN=ALIGNED);
     1114    11087        %B$TERMINAL_ID (FPTN=TERMHI,STCLASS=PARAM,ALGN=ALIGNED);
     1115    11116    1   DCL DATAVEC VECTOR;
     1116    11117    1   DCL NORETRAN UBIN;
     1117    11118
     1118    11119        /* Entry DCLs */
     1119    11120    1   DCL KHA$GET_CTX_PTR ENTRY(2) ALTRET;
     1120    11121    1   DCL KHA$CHK_TRM_RNG ENTRY(2) ALTRET;
     1121    11122    1   DCL KHA$UPD_CHN ENTRY(2);
     1122    11123    1   DCL KHA$BLDLINPRO ENTRY(2) ALTRET;
     1123    11124    1   DCL KHA$SETCLK ENTRY(1) ALTRET;
     1124    11125        %INHIBIT_DCLS;
     1125    11137
     1126    11138        /* Equates */
     1127    11139        /* The Following equates are for the flags in the CHN table */
     1128    11140        %EQU Y#NON = 0;
     1129    11141        %EQU Y#DED = 1;
     1130    11142        %EQU Y#ERR = 2;
     1131    11143        %EQU Y#ENB = 3;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:182  
     1132    11144        %EQU Y#REENB = 4;
     1133    11145        %EQU Y#CTR = 5;
     1134    11146        %EQU Y#NOTDED = 6;
     1135    11147        %EQU Y#KLLHSTDWN = 7;
     1136    11148        %EQU Y#DSBHSTDWN = 8;
     1137    11149        %EQU Y#ENBHSTUP = 9;
     1138    11150
     1139    11151        /* The following equates are for the SOP (special operation) */
     1140    11152        %EQU Y#SOP_NON = 0;
     1141    11153        %EQU Y#SOP_INTCTR = 1;
     1142    11154        %EQU Y#SOP_ENB = 2;
     1143    11155        %EQU Y#SOP_PRT = 3;
     1144    11156        %EQU Y#SOP_UPDCHN = 4;
     1145    11157        %EQU Y#SOP_RQSLINPRO = 5;
     1146    11158        %EQU Y#SOP_BLDLINPRO = 6;
     1147    11159        %EQU Y#SOP_DVCERR = 7;
     1148    11160        %EQU Y#SOP_DVCERRRSP = 8;
     1149    11161        %EQU Y#SOP_SETENBHSTUP = 9;
     1150    11162        %EQU Y#SOP_CLRENBHSTUP = 10;
     1151    11163        %EQU Y#SOP_SNDADM = 11;
     1152    11164        %EQU Y#SOP_RSTDED = 13;
     1153    11165
     1154    11166        %MACRO TRANS (FPTN=X,
     1155    11167                       NEW(UNINT=%KH#CHN_STT_UN_INT,
     1156    11168                                BSY=%KH#CHN_STT_BSY,
     1157    11169                                BSYDSBPND=%KH#CHN_STT_BSYDSBPND,
     1158    11170                                BSYPRTPND=%KH#CHN_STT_BSYPRTPND,
     1159    11171                                DSB=%KH#CHN_STT_DSB,
     1160    11172                                ENB=%KH#CHN_STT_ENB,
     1161    11173                                LINPROPND_ENB=%KH#CHN_STT_LINPROPND_ENB,
     1162    11174                                LINPROPND_BSY=%KH#CHN_STT_LINPROPND_BSY,
     1163    11175                                LINPROPND_BSYDSBPND=%KH#CHN_STT_LINPROPND_BSYDSBPND,
     1164    11176                                PRT=%KH#CHN_STT_PRT)=-1,
     1165    11177                       OLD(UNINT=%KH#CHN_STT_UN_INT,
     1166    11178                                BSY=%KH#CHN_STT_BSY,
     1167    11179                                BSYDSBPND=%KH#CHN_STT_BSYDSBPND,
     1168    11180                                BSYPRTPND=%KH#CHN_STT_BSYPRTPND,
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:183  
     1169    11181                                DSB=%KH#CHN_STT_DSB,
     1170    11182                                ENB=%KH#CHN_STT_ENB,
     1171    11183                                LINPROPND_ENB=%KH#CHN_STT_LINPROPND_ENB,
     1172    11184                                LINPROPND_BSY=%KH#CHN_STT_LINPROPND_BSY,
     1173    11185                                LINPROPND_BSYDSBPND=%KH#CHN_STT_LINPROPND_BSYDSBPND,
     1174    11186                                PRT=%KH#CHN_STT_PRT)=-1,
     1175    11187                       HOP=%KHA_FNC_NON,
     1176    11188                       BSOP=%Y#SOP_NON,
     1177    11189                       ASOP=%Y#SOP_NON,
     1178    11190             FLGS(DED=%Y#DED,ERR=%Y#ERR,ENB=%Y#ENB,REENB=%Y#REENB,CTR=%Y#CTR,NOTDED=
             11190                 %Y#NOTDED,
     1179    11191                 KLLHSTDWN=%Y#KLLHSTDWN,DSBHSTDWN=%Y#DSBHSTDWN,ENBHSTUP=%Y#ENBHSTUP)=%Y#NON
             11191                      ,
     1180    11192                  STCLASS=CONSTANT,
     1181    11193                  LVL=2,
     1182    11194                  LAST(YES=1,NO=0)=0);
     1183    11195
     1184    11196        %LSET LISTDIR = '0'B;
     1185    11197        %LSET LISTEXP = '1'B;
     1186    11198        %LSET LISTCOM = '0'B;
     1187    11199        %LSET LISTSUB = '1'B;
     1188    11200        %LSET STR = SUBSTR(CONCAT(TEXTCHAR(STCLASS), '   '), 0, 3);
     1189    11201        %IF (STR = 'STA') OR (STR = 'CON') OR (STR = 'EXT');
     1190    11202        %LSET INIT = CHARTEXT(' INIT');
     1191    11203        %LSET ENIT = CHARTEXT('');
     1192    11204        %ELSE;
     1193    11205        %LSET INIT = CHARTEXT('/*');
     1194    11206        %LSET ENIT = CHARTEXT('*/');
     1195    11207        %ENDIF;
     1196    11208
     1197    11209        %IF LVL=1;
     1198    11210        DCL 1 FPTN STCLASS ALIGNED,
     1199    11211
     1200    11212                 2 %CHARTEXT('OLD ') SBIN BYTE CALIGNED %INIT(OLD)%ENIT,
     1201    11213                 2 %CHARTEXT('NEW ') SBIN BYTE CALIGNED %INIT(NEW)%ENIT,
     1202    11214                 2 %CHARTEXT('HOP ') UBIN BYTE CALIGNED %INIT(HOP)%ENIT,
     1203    11215                 2 %CHARTEXT('BSOP ') UBIN BYTE CALIGNED %INIT(BSOP)%ENIT,
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:184  
     1204    11216                 2 %CHARTEXT('ASOP ') UBIN BYTE CALIGNED %INIT(ASOP)%ENIT,
     1205    11217                 2 %CHARTEXT('FLGS ') UBIN BYTE CALIGNED %INIT(FLGS)%ENIT,
     1206    11218                 2 * UBIN BYTE CALIGNED %INIT(0*0)%ENIT,
     1207    11219        %IF LAST=0;
     1208    11220                 2 %CHARTEXT('LAST ') BIT(1) %INIT('0'B)%ENIT,
     1209    11221        %ELSE;
     1210    11222                 2 %CHARTEXT('LAST ') BIT(1) %INIT('1'B)%ENIT;
     1211    11223        %ENDIF;
     1212    11224        %ELSE;
     1213    11225                 2 * SBIN BYTE CALIGNED %INIT(OLD)%ENIT,
     1214    11226                 2 * SBIN BYTE CALIGNED %INIT(NEW)%ENIT,
     1215    11227                 2 * UBIN BYTE CALIGNED %INIT(HOP)%ENIT,
     1216    11228                 2 * UBIN BYTE CALIGNED %INIT(BSOP)%ENIT,
     1217    11229                 2 * UBIN BYTE CALIGNED %INIT(ASOP)%ENIT,
     1218    11230                 2 * UBIN BYTE CALIGNED %INIT(FLGS)%ENIT,
     1219    11231                 2 * UBIN BYTE CALIGNED %INIT(0*0)%ENIT,
     1220    11232        %IF LAST=0;
     1221    11233                 2 * BIT(1) %INIT('0'B)%ENIT,
     1222    11234        %ELSE;
     1223    11235                 2 * BIT(1) %INIT('1'B)%ENIT;
     1224    11236        %ENDIF;
     1225    11237        %ENDIF;
     1226    11238
     1227    11239        %MEND;
     1228    11240
     1229    11241        /* State transition table */
     1230    11242
     1231    11243        /*
     1232    11244             EVENT: DISABLE
     1233    11245         */
     1234    11246    1   DCL 1 TRAN_DISABLE CONSTANT,
     1235    11247             %TRANS (OLD=DSB,NEW=DSB);
     1236    11289             %TRANS (OLD=ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE);
     1237    11331             %TRANS (OLD=BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_DISABLE);
     1238    11373             %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND);
     1239    11415             %TRANS (OLD=LINPROPND_ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE);
     1240    11457             %TRANS (OLD=LINPROPND_BSY,NEW=LINPROPND_BSYDSBPND);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:185  
     1241    11499             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=LINPROPND_BSYDSBPND);
     1242    11541             %TRANS (LAST=YES);
     1243    11583
     1244    11584        /*
     1245    11585             EVENT: ENABLE
     1246    11586         */
     1247    11587    1   DCL 1 TRAN_ENABLE CONSTANT,
     1248    11588             %TRANS (OLD=ENB,NEW=ENB,HOP=%KHA_FNC_ENABLE,ASOP=%Y#SOP_ENB);
     1249    11630             %TRANS (OLD=DSB,NEW=ENB,HOP=%KHA_FNC_ENABLE,ASOP=%Y#SOP_ENB,FLGS=NOTDED);
     1250    11672             %TRANS (OLD=BSYDSBPND,NEW=BSY,HOP=%KHA_FNC_ENABLE);
     1251    11714             %TRANS (OLD=UNINT,NEW=UNINT,FLGS=DED);
     1252    11756             %TRANS (OLD=UNINT,NEW=ENB,HOP=%KHA_FNC_ENABLE,BSOP=%Y#SOP_INTCTR,ASOP=
             11756                 %Y#SOP_ENB);
     1253    11798             %TRANS (LAST=YES);
     1254    11840
     1255    11841        /*
     1256    11842             EVENT: KILL
     1257    11843         */
     1258    11844    1   DCL 1 TRAN_KILL CONSTANT,
     1259    11845             %TRANS (OLD=ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE);
     1260    11887             %TRANS (OLD=BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL);
     1261    11929             %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL);
     1262    11971             %TRANS (OLD=LINPROPND_ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE);
     1263    12013             %TRANS (OLD=LINPROPND_BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL);
     1264    12055             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL);
     1265    12097             %TRANS (OLD=DSB,NEW=DSB,FLGS=DED,ASOP=%Y#SOP_RSTDED);
     1266    12139             %TRANS (LAST=YES);
     1267    12181
     1268    12182        /*
     1269    12183             EVENT: INTDVC
     1270    12184         */
     1271    12185    1   DCL 1 TRAN_INTDVC CONSTANT,
     1272    12186             %TRANS (OLD=PRT,NEW=PRT);
     1273    12228             %TRANS (OLD=UNINT,NEW=DSB,HOP=%KHA_FNC_DISABLE,BSOP=%Y#SOP_INTCTR,FLGS=ERR);
     1274    12270             %TRANS (OLD=UNINT,NEW=UNINT,HOP=%KHA_FNC_DISABLE,BSOP=%Y#SOP_INTCTR,FLGS=DED);
     1275    12312            %TRANS (OLD=UNINT,NEW=ENB,HOP=%KHA_FNC_ENABLE,BSOP=%Y#SOP_INTCTR,FLGS=ENB,ASOP=
             12312                 %Y#SOP_ENB);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:186  
     1276    12354             %TRANS (OLD=UNINT,NEW=DSB,HOP=%KHA_FNC_DISABLE,BSOP=%Y#SOP_INTCTR);
     1277    12396             %TRANS (LAST=YES);
     1278    12438
     1279    12439        /*
     1280    12440             EVENT: DISCONNECT_EVT (from a handler)
     1281    12441         */
     1282    12442    1   DCL 1 TRAN_DISCONNECT_EVT CONSTANT,
     1283    12443             %TRANS (OLD=BSY,NEW=ENB,FLGS=REENB,ASOP=%Y#SOP_SNDADM);
     1284    12485             %TRANS (OLD=BSY,NEW=DSB,HOP=%KHA_FNC_DISABLE,ASOP=%Y#SOP_SNDADM);
     1285    12527             %TRANS (OLD=BSYDSBPND,NEW=DSB,HOP=%KHA_FNC_DISABLE,ASOP=%Y#SOP_SNDADM);
     1286    12569             %TRANS (LAST=YES);
     1287    12611
     1288    12612        /*
     1289    12613             EVENT: DISCONNECT_RQS (from a host)
     1290    12614         */
     1291    12615    1   DCL 1 TRAN_DISCONNECT_RQS CONSTANT,
     1292    12616             %TRANS (OLD=BSY,NEW=BSY,HOP=%KHA_FNC_DISCONNECT_RQS);
     1293    12658             %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_DISCONNECT_RQS);
     1294    12700             %TRANS (OLD=LINPROPND_BSY,NEW=LINPROPND_BSY,HOP=%KHA_FNC_DISCONNECT_RQS);
     1295    12742             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=LINPROPND_BSYDSBPND,HOP=
             12742                 %KHA_FNC_DISCONNECT_RQS);
     1296    12784             %TRANS (LAST=YES);
     1297    12826
     1298    12827        /*
     1299    12828             EVENT: CONNECT
     1300    12829         */
     1301    12830    1   DCL 1 TRAN_CONNECT CONSTANT,
     1302    12831             %TRANS (OLD=ENB,NEW=BSY,ASOP=%Y#SOP_SNDADM);
     1303    12873             %TRANS (LAST=YES);
     1304    12915
     1305    12916        /*
     1306    12917             EVENT: CONFIG
     1307    12918         */
     1308    12919    1   DCL 1 TRAN_CONFIG CONSTANT,
     1309    12920             %TRANS (OLD=DSB,NEW=DSB,BSOP=%Y#SOP_UPDCHN,HOP=%KHA_FNC_CNFG);
     1310    12962             %TRANS (OLD=ENB,NEW=ENB,BSOP=%Y#SOP_UPDCHN,HOP=%KHA_FNC_CNFG);
     1311    13004             %TRANS (OLD=BSY,NEW=BSY,BSOP=%Y#SOP_UPDCHN,HOP=%KHA_FNC_CNFG);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:187  
     1312    13046             %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,BSOP=%Y#SOP_UPDCHN,HOP=%KHA_FNC_CNFG);
     1313    13088             %TRANS (OLD=UNINT,NEW=UNINT,BSOP=%Y#SOP_UPDCHN);
     1314    13130             %TRANS (LAST=YES);
     1315    13172
     1316    13173        /*
     1317    13174             EVENT: RELEASE
     1318    13175         */
     1319    13176    1   DCL 1 TRAN_PARTITION CONSTANT,
     1320    13177             %TRANS (OLD=DSB,NEW=PRT,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_PRT);
     1321    13219             %TRANS (OLD=UNINT,NEW=PRT,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_PRT);
     1322    13261             %TRANS (LAST=YES);
     1323    13303
     1324    13304        /*
     1325    13305             EVENT: RETURN
     1326    13306         */
     1327    13307    1   DCL 1 TRAN_RETURN CONSTANT,
     1328    13308             %TRANS (OLD=PRT,NEW=UNINT);
     1329    13350             %TRANS (LAST=YES);
     1330    13392
     1331    13393        /*
     1332    13394             EVENT: SGNRJC
     1333    13395        */
     1334    13396    1   DCL 1 TRAN_SGNRJC CONSTANT,
     1335    13397             %TRANS (OLD=LINPROPND_ENB,NEW=ENB,HOP=%KHA_FNC_SGNRJC);
     1336    13439             %TRANS (OLD=LINPROPND_BSY,NEW=BSY,HOP=%KHA_FNC_SGNRJC);
     1337    13481             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_SGNRJC);
     1338    13523             %TRANS (LAST=YES);
     1339    13565
     1340    13566        /*
     1341    13567             EVENT: BLDLINPRO
     1342    13568        */
     1343    13569    1   DCL 1 TRAN_BLDLINPRO CONSTANT,
     1344    13570             %TRANS (OLD=LINPROPND_ENB,NEW=ENB,BSOP=%Y#SOP_BLDLINPRO);
     1345    13612             %TRANS (OLD=LINPROPND_BSY,NEW=BSY,BSOP=%Y#SOP_BLDLINPRO);
     1346    13654             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND,BSOP=%Y#SOP_BLDLINPRO);
     1347    13696             %TRANS (LAST=YES);
     1348    13738
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:188  
     1349    13739        /*
     1350    13740             EVENT: RQSLINPRO
     1351    13741        */
     1352    13742    1   DCL 1 TRAN_RQSLINPRO CONSTANT,
     1353    13743             %TRANS (OLD=ENB,NEW=LINPROPND_ENB,BSOP=%Y#SOP_RQSLINPRO);
     1354    13785             %TRANS (OLD=BSY,NEW=LINPROPND_BSY,BSOP=%Y#SOP_RQSLINPRO);
     1355    13827             %TRANS (OLD=BSYDSBPND,NEW=LINPROPND_BSYDSBPND,BSOP=%Y#SOP_RQSLINPRO);
     1356    13869             %TRANS (LAST=YES);
     1357    13911
     1358    13912        /*
     1359    13913             EVENT: CNCRQSLINPRO
     1360    13914        */
     1361    13915    1   DCL 1 TRAN_CNCRQSLINPRO CONSTANT,
     1362    13916              %TRANS (OLD=LINPROPND_ENB,NEW=ENB);
     1363    13958              %TRANS (OLD=LINPROPND_BSY,NEW=BSY);
     1364    14000              %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND);
     1365    14042              %TRANS (LAST=YES);
     1366    14084
     1367    14085        /*
     1368    14086             EVENT: DVCERR
     1369    14087        */
     1370    14088    1   DCL 1 TRAN_DVCERR CONSTANT,
     1371    14089              %TRANS (OLD=UNINT,NEW=UNINT,BSOP=%Y#SOP_DVCERR);
     1372    14131              %TRANS (OLD=BSY,NEW=BSY,BSOP=%Y#SOP_DVCERR);
     1373    14173              %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,BSOP=%Y#SOP_DVCERR);
     1374    14215              %TRANS (OLD=BSYPRTPND,NEW=BSYPRTPND,BSOP=%Y#SOP_DVCERR);
     1375    14257              %TRANS (OLD=DSB,NEW=DSB,BSOP=%Y#SOP_DVCERR);
     1376    14299              %TRANS (OLD=ENB,NEW=ENB,BSOP=%Y#SOP_DVCERR);
     1377    14341              %TRANS (OLD=LINPROPND_ENB,NEW=LINPROPND_ENB,BSOP=%Y#SOP_DVCERR);
     1378    14383              %TRANS (OLD=LINPROPND_BSY,NEW=LINPROPND_BSY,BSOP=%Y#SOP_DVCERR);
     1379    14425              %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=LINPROPND_BSYDSBPND,BSOP=%Y#SOP_DVCERR);
     1380    14467              %TRANS (OLD=PRT,NEW=PRT,BSOP=%Y#SOP_DVCERR);
     1381    14509              %TRANS (LAST=YES);
     1382    14551
     1383    14552        /*
     1384    14553             EVENT: DVCERRRSP
     1385    14554        */
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:189  
     1386    14555    1   DCL 1 TRAN_DVCERRRSP CONSTANT,
     1387    14556              %TRANS (OLD=UNINT,NEW=UNINT,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1388    14598              %TRANS (OLD=BSY,NEW=BSY,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1389    14640              %TRANS (OLD=BSYDSBPND,NEW=BSYDSBPND,BSOP=%Y#SOP_DVCERRRSP,HOP=
             14640                  %KHA_FNC_DVCERRRSP);
     1390    14682              %TRANS (OLD=BSYPRTPND,NEW=BSYPRTPND,BSOP=%Y#SOP_DVCERRRSP,HOP=
             14682                  %KHA_FNC_DVCERRRSP);
     1391    14724              %TRANS (OLD=DSB,NEW=DSB,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1392    14766              %TRANS (OLD=ENB,NEW=ENB,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1393    14808              %TRANS (OLD=LINPROPND_ENB,NEW=LINPROPND_ENB,BSOP=%Y#SOP_DVCERRRSP,HOP=
             14808                  %KHA_FNC_DVCERRRSP);
     1394    14850              %TRANS (OLD=LINPROPND_BSY,NEW=LINPROPND_BSY,BSOP=%Y#SOP_DVCERRRSP,HOP=
             14850                  %KHA_FNC_DVCERRRSP);
     1395    14892             %TRANS (OLD=LINPROPND_BSYDSBPND,NEW=LINPROPND_BSYDSBPND,BSOP=%Y#SOP_DVCERRRSP,
             14892                  HOP=%KHA_FNC_DVCERRRSP);
     1396    14934              %TRANS (OLD=PRT,NEW=PRT,BSOP=%Y#SOP_DVCERRRSP,HOP=%KHA_FNC_DVCERRRSP);
     1397    14976              %TRANS (LAST=YES);
     1398    15018
     1399    15019        /*
     1400    15020             EVENT: HOSTDOWN
     1401    15021         */
     1402    15022    1   DCL 1 TRAN_HOSTDOWN CONSTANT,
     1403    15023             %TRANS(OLD=ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE,ASOP=%Y#SOP_SETENBHSTUP,FLGS=
             15023                 DSBHSTDWN);
     1404    15065            %TRANS(OLD=ENB,NEW=DSB,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_SETENBHSTUP,FLGS=KLLHSTDWN
             15065                 );
     1405    15107             %TRANS(OLD=BSY,NEW=BSYDSBPND,ASOP=%Y#SOP_SETENBHSTUP,FLGS=DSBHSTDWN);
     1406    15149             %TRANS(OLD=BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_SETENBHSTUP,FLGS=
             15149                 KLLHSTDWN);
     1407    15191            %TRANS(OLD=LINPROPND_ENB,NEW=DSB,HOP=%KHA_FNC_KILL,ASOP=%Y#SOP_SETENBHSTUP,FLGS
             15191                 =KLLHSTDWN);
     1408    15233             %TRANS(OLD=LINPROPND_BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL,ASOP=
             15233                 %Y#SOP_SETENBHSTUP,FLGS=KLLHSTDWN);
     1409    15275             %TRANS(OLD=LINPROPND_BSYDSBPND,NEW=BSYDSBPND,HOP=%KHA_FNC_KILL,ASOP=
             15275                 %Y#SOP_SETENBHSTUP,FLGS=KLLHSTDWN);
     1410    15317             %TRANS(OLD=LINPROPND_ENB,NEW=DSB,HOP=%KHA_FNC_DISABLE,ASOP=%Y#SOP_SETENBHSTUP,
             15317                 FLGS=DSBHSTDWN);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:190  
     1411    15359             %TRANS(OLD=LINPROPND_BSY,NEW=BSYDSBPND,HOP=%KHA_FNC_DISABLE,ASOP=
             15359                 %Y#SOP_SETENBHSTUP,FLGS=DSBHSTDWN);
     1412    15401             %TRANS(LAST=YES);
     1413    15443
     1414    15444        /*
     1415    15445             HOST UP
     1416    15446
     1417    15447         */
     1418    15448    1   DCL 1 TRAN_HOSTUP CONSTANT,
     1419    15449             %TRANS(OLD=DSB,NEW=ENB,HOP=%KHA_FNC_ENABLE,BSOP=%Y#SOP_CLRENBHSTUP,FLGS=
             15449                 ENBHSTUP);
     1420    15491             %TRANS(OLD=BSYDSBPND,NEW=BSY,BSOP=%Y#SOP_CLRENBHSTUP,FLGS=ENBHSTUP);
     1421    15533        %TRANS(OLD=BSY,NEW=BSY,HOP=%KHA_FNC_HOSTUP);
     1422    15575        %TRANS(OLD=ENB,NEW=ENB,HOP=%KHA_FNC_HOSTUP);
     1423    15617             %TRANS (LAST=YES);
     1424    15659
     1425    15660
     1426    15661        /*
     1427    15662             EVENT: ACTIVE
     1428    15663         */
     1429    15664    1   DCL 1 TRAN_ACTIVE CONSTANT,
     1430    15665             %TRANS(ASOP=%Y#SOP_SNDADM);
     1431    15707             %TRANS(LAST=YES);
     1432    15749
     1433    15750        /*E* ERROR: KHA-E$ILGLTRANS
     1434    15751             MESSAGE: That function is illegal for the current state.
     1435    15752          MESSAGE1: The function specified conflicts with the current state of the channel.
     1436    15753         */
     1437    15754        /*E* ERROR: KHA-E$DEDCHN
     1438    15755             MESSAGE: That channel is dead.  KILL channel and try again.
     1439    15756             MESSAGE1: That function is illegal on a dead channel.
     1440    15757        */
     1441    15758        /*E* ERROR: KHA-E$CLKFAILED
     1442    15759             MESSAGE: KHC$CLOCK altreturned.
     1443    15760             MESSAGE1: An M$READ or M$WRITE failed.  A clock setup to
     1444    15761                      reissue the read/write also failed.
     1445    15762        */
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:191  
     1446    15763
     1447    15764
     1448    15765        /*
     1449    15766             The next item is an array pointing to the different transition
     1450    15767              table for each event.  If KHA_FNC_E changes this table needs to
     1451    15768              change also.
     1452    15769         */
     1453    15770    1   DCL TRANS_TABLE$(0:%KHA_FNC_HI) PTR CONSTANT INIT(
     1454    15771    1                          ADDR(NIL) ,      /* %KHA_FNC_NON                       */
     1455    15772    1                       ADDR(TRAN_ENABLE) , /* %KHA_FNC_ENABLE                    */
     1456    15773    1                      ADDR(TRAN_DISABLE) , /* %KHA_FNC_DISABLE                   */
     1457    15774    1                         ADDR(TRAN_KILL) , /* %KHA_FNC_KILL                      */
     1458    15775    1                               ADDR(NIL) , /* %KHA_FNC_REQSTATS                  */
     1459    15776    1                               ADDR(NIL) , /* %KHA_FNC_CONTROL                   */
     1460    15777    1                      ADDR(NIL)          , /* %KHA_FNC_RELEASE                   */
     1461    15778    1                    ADDR(TRAN_PARTITION) , /* %KHA_FNC_PARTITION                 */
     1462    15779    1                    ADDR(TRAN_PARTITION) , /* %KHA_FNC_PARTITION_DGN             */
     1463    15780    1                       ADDR(TRAN_RETURN) , /* %KHA_FNC_RETURN                    */
     1464    15781    1                               ADDR(NIL) , /* %KHA_FNC_BLDCTX                    */
     1465    15782    1                               ADDR(NIL) , /* %KHA_FNC_BLDCTXCMP                 */
     1466    15783    1               ADDR(TRAN_DISCONNECT_EVT) , /* %KHA_FNC_DISCONNECT_EVT        */
     1467    15784    1               ADDR(TRAN_DISCONNECT_RQS) , /* %KHA_FNC_DISCONNECT_RQS        */
     1468    15785    1                      ADDR(TRAN_CONNECT) , /* %KHA_FNC_CONNECT                   */
     1469    15786    1                       ADDR(NIL) ,         /* %KHA_FNC_INTCTR                    */
     1470    15787    1                       ADDR(TRAN_INTDVC) , /* %KHA_FNC_INTDVC                    */
     1471    15788    1                       ADDR(TRAN_CONFIG) , /* %KHA_FNC_CNFG                      */
     1472    15789    1                  ADDR(TRAN_RQSLINPRO) ,   /* %KHA_FNC_RQSLINPRO              */
     1473    15790    1                  ADDR(TRAN_BLDLINPRO) ,   /* %KHA_FNC_BLDLINPRO                 */
     1474    15791    1                               ADDR(NIL) , /* %KHA_FNC_RQSDEFPRO                 */
     1475    15792    1                   ADDR(TRAN_SGNRJC),      /* %KHA_FNC_SGNRJC                 */
     1476    15793    1                  ADDR(TRAN_CNCRQSLINPRO), /* %KHA_FNC_CNCRQSLINPRO */
     1477    15794    1                    ADDR(TRAN_DVCERR),     /* %KHA_FNC_DVCERR */
     1478    15795    1                    ADDR(TRAN_DVCERRRSP),  /* %KHA_FNC_DVCERRRSP                 */
     1479    15796    1                   ADDR(TRAN_HOSTDOWN),    /* %KHA_FNC_HOSTDOWN                  */
     1480    15797    1                   ADDR(TRAN_HOSTUP),      /* %KHA_FNC_HOSTUP                    */
     1481    15798    1                   ADDR(NIL),              /* %KHA_FNC_CHNTBL  */
     1482    15799    1                   ADDR(TRAN_ACTIVE),      /* %KHA_FNC_ACTIVE                    */
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:192  
     1483    15800    1                   ADDR(TRAN_ACTIVE)  /* %KHA_FNC_NOTACTIVE                    */
     1484    15801    1                                     );
     1485    15802
     1486    15803
     1487    15804        %KH$CHN(NAME=CHN_C,STCLASS=CONSTANT);
     1488    15928        %KH$CHN(NAME=CHN,STCLASS=AUTO);
     1489    16052        /* SYMREFS */
     1490    16053        %KH_CHNDAT;
     1491    16071    1   DCL KH_ADMIN$ EPTR SYMREF;
     1492    16072    1   DCL KH_NA_DCB# UBIN SYMREF;
     1493    16073    1   DCL KH_CTLTBL$ PTR SYMREF;
     1494    16074    1   DCL KH_INHLVL UBIN SYMREF;
     1495    16075    1   DCL KH_FLDWRTS SBIN SYMREF;
     1496    16076
     1497    16077        /* Auto */
     1498    16078    1   DCL TRANS$ PTR;
     1499    16079    1   DCL CHN$ PTR;
     1500    16080    1   DCL CTR$ PTR;
     1501    16081    1   DCL CTRCHN UBIN;
     1502    16082    1   DCL CTRTYPE UBIN;
     1503    16083    1   DCL LEV UBIN;
     1504    16084        %B$TERMINAL_ID (FPTN=TERMID,STCLASS=AUTO);
     1505    16113        %B$TERMINAL_ID (FPTN=TMP_TERMID,STCLASS=AUTO);
     1506    16142        %B$TERMINAL_ID (FPTN=TERMID_C,STCLASS=CONSTANT);
     1507    16171    1   DCL LIN$ PTR;
     1508    16172    1   DCL SIZE UBIN;
     1509    16173        %KH$ADMIN_FPT (FPTN=ADMIN_FPT,STCLASS=AUTO);
     1510    16384    1   DCL HOP UBIN;
     1511    16385    1   DCL BSOP UBIN;
     1512    16386    1   DCL ASOP UBIN;
     1513    16387    1   DCL NEW SBIN;
     1514    16388    1   DCL OLD UBIN;
     1515    16389    1   DCL STOP_FLAG BIT(1);
     1516    16390    1   DCL CHAN UBIN;
     1517    16391    1   DCL CHANLO UBIN;
     1518    16392    1   DCL CHANHI UBIN;
     1519    16393    1   DCL SUB UBIN;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:193  
     1520    16394    1   DCL SUBLO UBIN;
     1521    16395    1   DCL SUBHI UBIN;
     1522    16396    1   DCL SUBSUB UBIN;
     1523    16397    1   DCL SUBSUBLO UBIN;
     1524    16398    1   DCL SUBSUBHI UBIN;
     1525    16399    1   DCL RQSPRO_BUF(0:59) UBIN WORD;
     1526    16400    1   DCL RQSPRO$ PTR;
     1527    16401        %KL_RQSCHN (FPTN=KL_RQSPRO,STCLASS="BASED(RQSPRO$)");
     1528    16504        %FPT_WRITE (FPTN=KHA_WRITE,STCLASS=SYMREF);
     1529    16528        %KL_ADMIN (FPTN=ADMINC,STCLASS=CONSTANT,ORIGIN='KHA$ADMN');
     1530    16689        %KL_ADMIN (FPTN=ADMIN,STCLASS=AUTO,ORIGIN='KHA$ADMN');
     1531    16850    1   DCL KEYIN UBIN;
     1532    16851
     1533    16852        /* Based */
     1534    16853        %TRANS (FPTN=B$TRANS,STCLASS="BASED(TRANS$)",LVL=1,LAST=YES);
     1535    16895        %KH$CHN (STCLASS="BASED(CHN$)");
     1536    17019        %KL_HNDCMN_INFO (FPTN=KHA,STCLASS=BASED,LAST=";");
     1537    17099    1   DCL ONEWORD UBIN WORD BASED;
     1538    17100    1   DCL SIGNON CHAR(SIZE) BASED;
     1539    17101        %KH$CTLTBL (STCLASS="BASED(KH_CTLTBL$)");
     1540    17313
     1541    17314        /* ERRCODES */
     1542    17315        %VLP_ERRCODE (FPTN=ERR_BADCHN,FCG=KH,MID=A,MON='1'B,ERR#=%E$CHAN_NOT_THERE,STCLASS=
             17315            CONSTANT);
     1543    17361        /*E* ERROR: KHA-E$CHAN_NOT_THERE
     1544    17362             MESSAGE: That channel is undefined.
     1545    17363         */
     1546    17364        %VLP_ERRCODE (FPTN=ERR_ILGLTRANS,FCG=KH,MID=A,MON='1'B,ERR#=%E$ILGLTRANS,STCLASS=
             17364            CONSTANT);
     1547    17410        %VLP_ERRCODE(FPTN=ERR_CLKFAILED,FCG=KH,MID=A,MON='1'B,ERR#=%E$CLKFAILED,STCLASS=
             17410            CONSTANT);
     1548    17456       %VLP_ERRCODE (FPTN=ERR_DEDCHN,FCG=KH,MID=A,MON='1'B,ERR#=%E$DEDCHN,STCLASS=CONSTANT)
             17456            ;
     1549    17502        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:194  
     1550    17503    1        INHIBIT_LEVEL = KH_INHLVL;

  17503   1 000005  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 000008  EF47 0010                            STR,R6   INHIBIT_LEVEL,AUTO

     1551    17504             %DISABLE;

  17505   1 00000A  EF47 0011                            STR,R6   DISABLE_LEVEL,AUTO

  17506   1 00000C  EBC7 0011                            LAB,B6   DISABLE_LEVEL,AUTO
          1 00000E  EFC7 00D2                            STB,B6   KEYIN+3,AUTO
          1 000010  BBC7 00D2                            LAB,B3   KEYIN+3,AUTO
          1 000012  CBF0 0100                            LAB,B4   256,IMO
          1 000014  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 000017       0001                            DC       s:17508,PREL

     1552    17508    1        LEV = TERMLO.LEV;

  17508   1 000018  ECC7 0008                            LDB,B6   @TERMLO,AUTO
          1 00001A  E806                                 LDR,R6   ,B6
          1 00001B  E570 00FF                            AND,R6   255,IMO
          1 00001D  EF47 003A                            STR,R6   LEV,AUTO

     1553    17509    1        CHANLO = TERMLO.TERM.CHANNEL / 128;

  17509   1 00001F  D846 0001                            LDR,R5   1,B6
          1 000021  5047                                 SOR,R5   7
          1 000022  DF47 0067                            STR,R5   CHANLO,AUTO

     1554    17510    1        CHANHI = CHANLO;

  17510   1 000024  DF47 0068                            STR,R5   CHANHI,AUTO

     1555    17511    1        SUBLO = TERMLO.TERM.SUBDEVICE;

  17511   1 000026  C846 0002                            LDR,R4   2,B6
          1 000028  CF47 006A                            STR,R4   SUBLO,AUTO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:195  

     1556    17512    1        SUBHI = SUBLO;

  17512   1 00002A  CF47 006B                            STR,R4   SUBHI,AUTO

     1557    17513    1        SUBSUBLO = TERMLO.TERM.SUBSUBDEVICE;

  17513   1 00002C  B846 0003                            LDR,R3   3,B6
          1 00002E  BF47 006D                            STR,R3   SUBSUBLO,AUTO

     1558    17514    1        SUBSUBHI = SUBSUBLO;

  17514   1 000030  BF47 006E                            STR,R3   SUBSUBHI,AUTO

     1559    17515    1        STOP_FLAG = '1'B;

  17515   1 000032  8947 0065                            LBT,'8000'X       STOP_FLAG,AUTO
  17515   1 000034       8000

     1560    17516    1        GOTO COMMON;

  17516   1 000035  0F81 0096                            B        s:17557,PREL

     1561    17517        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:196  
     1562    17518    1   KHA$DVCADM_RNG: ENTRY (OPERATION,ERROR,TERMLO,TERMHI,DATAVEC,NORETRAN) ALTRET;

  17518   1 000037  D380 0000 0000  xent KHA$DVCADM_RNG  LNJ,B5   X6A_AUTO_N
          1 00003A       00D8 0006                       DC       216,6

     1563    17519    1        INHIBIT_LEVEL = KH_INHLVL;

  17519   1 00003C  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 00003F  EF47 0010                            STR,R6   INHIBIT_LEVEL,AUTO

     1564    17520             %DISABLE;

  17521   1 000041  EF47 0011                            STR,R6   DISABLE_LEVEL,AUTO

  17522   1 000043  EBC7 0011                            LAB,B6   DISABLE_LEVEL,AUTO
          1 000045  EFC7 00D2                            STB,B6   KEYIN+3,AUTO
          1 000047  BBC7 00D2                            LAB,B3   KEYIN+3,AUTO
          1 000049  CBF0 0100                            LAB,B4   256,IMO
          1 00004B  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 00004E       0001                            DC       s:17524,PREL

     1565    17524    2        CALL KHA$CHK_TRM_RNG(TERMLO,TERMHI) WHENALTRETURN DO;

  17524   1 00004F  BBC7 0008                            LAB,B3   @TERMLO,AUTO
          1 000051  CBF0 0200                            LAB,B4   512,IMO
          1 000053  E380 0000 0000  xent                 LNJ,B6   KHA$CHK_TRM_RNG
          1 000056       0003                            DC       s:17525,PREL
          1 000057  0F81 0016                            B        s:17534,PREL

     1566    17525    2             ERROR = ERR_BADCHN;

  17525   1 000059  8C80 0000 022A  00                   LDI      ERR_BADCHN
          1 00005C  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 00005E  8D06                                 SDI      ,B6

     1567    17526                  %ENABLE;

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:197  
  17527   1 00005F  D847 0011                            LDR,R5   DISABLE_LEVEL,AUTO
          1 000061  D947 0010                            CMR,R5   INHIBIT_LEVEL,AUTO
          1 000063  0901 0007                            BE       s:17532,PREL

  17529   1 000065  CBF0 0000                            LAB,B4   0,IMO
          1 000067  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 00006A       0001                            DC       s:17532,PREL

     1568    17532    2             ALTRETURN;

  17532   1 00006B  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1569    17533    2           END;                            /* WHENALTRETURN */
     1570    17534    1        LEV = TERMLO.LEV;

  17534   1 00006E  ECC7 0008                            LDB,B6   @TERMLO,AUTO
          1 000070  E806                                 LDR,R6   ,B6
          1 000071  E570 00FF                            AND,R6   255,IMO
          1 000073  EF47 003A                            STR,R6   LEV,AUTO

     1571    17535    1        CHANLO = TERMLO.TERM.CHANNEL / 128;

  17535   1 000075  D846 0001                            LDR,R5   1,B6
          1 000077  5047                                 SOR,R5   7
          1 000078  DF47 0067                            STR,R5   CHANLO,AUTO

     1572    17536    1        CHANHI = TERMHI.TERM.CHANNEL / 128;

  17536   1 00007A  DCC7 000A                            LDB,B5   @TERMHI,AUTO
          1 00007C  C845 0001                            LDR,R4   1,B5
          1 00007E  4047                                 SOR,R4   7
          1 00007F  CF47 0068                            STR,R4   CHANHI,AUTO

     1573    17537    1        SUBLO = TERMLO.TERM.SUBDEVICE;

  17537   1 000081  B846 0002                            LDR,R3   2,B6
          1 000083  BF47 006A                            STR,R3   SUBLO,AUTO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:198  

     1574    17538    1        SUBHI = TERMHI.TERM.SUBDEVICE;

  17538   1 000085  A845 0002                            LDR,R2   2,B5
          1 000087  AF47 006B                            STR,R2   SUBHI,AUTO

     1575    17539    1        SUBSUBLO = TERMLO.TERM.SUBSUBDEVICE;

  17539   1 000089  9846 0003                            LDR,R1   3,B6
          1 00008B  9F47 006D                            STR,R1   SUBSUBLO,AUTO

     1576    17540    1        SUBSUBHI = TERMHI.TERM.SUBSUBDEVICE;

  17540   1 00008D  E845 0003                            LDR,R6   3,B5
          1 00008F  EF47 006E                            STR,R6   SUBSUBHI,AUTO

     1577    17541    1        STOP_FLAG = '0'B;

  17541   1 000091  8747 0065                            CL       STOP_FLAG,AUTO

     1578    17542    1        GOTO COMMON;

  17542   1 000093  0F81 0038                            B        s:17557,PREL

     1579    17543        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:199  
     1580    17544    1   KHA$DVCADM_ALL: ENTRY (OPERATION,ERROR,TERMLO,TERMHI,DATAVEC,NORETRAN) ALTRET;

  17544   1 000095  D380 0000 0000  xent KHA$DVCADM_ALL  LNJ,B5   X6A_AUTO_N
          1 000098       00D8 0006                       DC       216,6

     1581    17545    1        INHIBIT_LEVEL = KH_INHLVL;

  17545   1 00009A  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          1 00009D  EF47 0010                            STR,R6   INHIBIT_LEVEL,AUTO

     1582    17546             %DISABLE;

  17547   1 00009F  EF47 0011                            STR,R6   DISABLE_LEVEL,AUTO

  17548   1 0000A1  EBC7 0011                            LAB,B6   DISABLE_LEVEL,AUTO
          1 0000A3  EFC7 00D2                            STB,B6   KEYIN+3,AUTO
          1 0000A5  BBC7 00D2                            LAB,B3   KEYIN+3,AUTO
          1 0000A7  CBF0 0100                            LAB,B4   256,IMO
          1 0000A9  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 0000AC       0001                            DC       s:17550,PREL

     1583    17550    1        CHANLO = KH_CHNLOW$->KH$CHN.CHNBIT0_9 * 64 / 128;

  17550   1 0000AD  EC80 0000 0000  xsym                 LDB,B6   KH_CHNLOW$
          1 0000B0  E806                                 LDR,R6   ,B6
          1 0000B1  E570 FFC0                            AND,R6   -64,IMO
          1 0000B3  6047                                 SOR,R6   7
          1 0000B4  EF47 0067                            STR,R6   CHANLO,AUTO

     1584    17551    1        CHANHI = KH_CHNHI$->KH$CHN.CHNBIT0_9 * 64 / 128;

  17551   1 0000B6  DC80 0000 0000  xsym                 LDB,B5   KH_CHNHI$
          1 0000B9  D805                                 LDR,R5   ,B5
          1 0000BA  D570 FFC0                            AND,R5   -64,IMO
          1 0000BC  5047                                 SOR,R5   7
          1 0000BD  DF47 0068                            STR,R5   CHANHI,AUTO

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:200  
     1585    17552    1        SUBLO = 0;

  17552   1 0000BF  8747 006A                            CL       SUBLO,AUTO

     1586    17553    1        SUBHI = 0;

  17553   1 0000C1  8747 006B                            CL       SUBHI,AUTO

     1587    17554    1        SUBSUBLO = 0;

  17554   1 0000C3  8747 006D                            CL       SUBSUBLO,AUTO

     1588    17555    1        SUBSUBHI = 0;

  17555   1 0000C5  8747 006E                            CL       SUBSUBHI,AUTO

     1589    17556    1        LEV = %TERMINAL_ID_LEV_CHAN#;

  17556   1 0000C7  4C01                                 LDV,R4   1
          1 0000C8  CF47 003A                            STR,R4   LEV,AUTO

     1590    17557    1        STOP_FLAG = '0'B;

  17557   1 0000CA  8747 0065                            CL       STOP_FLAG,AUTO

  17557   1                              COMMON          null
     1591    17558        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:201  
     1592    17559    1   COMMON: ;
     1593    17560    1        ERROR = '0'B;

  17560   1 0000CC  ECC7 0006            COMMON          LDB,B6   @ERROR,AUTO
          1 0000CE  8706                                 CL       ,B6
          1 0000CF  8746 0001                            CL       1,B6

     1594    17561    1        IF OPERATION > %KHA_FNC_HI+1

  17561   1 0000D1  DCC7 0004                            LDB,B5   @OPERATION,AUTO
          1 0000D3  E805                                 LDR,R6   ,B5
          1 0000D4  6D1E                                 CMV,R6   30
          1 0000D5  0381 0014                            BLE      s:17572,PREL

     1595    17562    2        THEN DO;

     1596    17563    2             ERROR = ERR_ILGLTRANS;

  17563   1 0000D7  8C80 0000 022C  00                   LDI      ERR_ILGLTRANS
          1 0000DA  8D06                                 SDI      ,B6

     1597    17564                  %ENABLE;

  17565   1 0000DB  D847 0011                            LDR,R5   DISABLE_LEVEL,AUTO
          1 0000DD  D947 0010                            CMR,R5   INHIBIT_LEVEL,AUTO
          1 0000DF  0901 0007                            BE       s:17570,PREL

  17567   1 0000E1  CBF0 0000                            LAB,B4   0,IMO
          1 0000E3  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 0000E6       0001                            DC       s:17570,PREL

     1598    17570    2             ALTRETURN;

  17570   1 0000E7  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1599    17571    2           END;
     1600    17572    1        TERMID = TERMID_C;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:202  

  17572   1 0000EA  AB80 0000 0200  00                   LAB,B2   TERMID_C
          1 0000ED  2C00                                 LDV,R2   0
          1 0000EE  6C10                                 LDV,R6   16
          1 0000EF  BB87                                 LAB,B3   ,AUTO
          1 0000F0  3C76                                 LDV,R3   118
          1 0000F1  0008                                 MMM

     1601    17573    1        IF ADDR(TERMLO) ~= ADDR(NIL)

  17573   1 0000F2  CCC7 0008                            LDB,B4   @TERMLO,AUTO
          1 0000F4  8DD4                                 CMN      B4
          1 0000F5  0901 0007                            BE       s:17576,PREL

     1602    17574    1        THEN
     1603    17575    1             TERMID.TERM.TERM_NAME = TERMLO.TERM.TERM_NAME;

  17575   1 0000F7  AB84                                 LAB,B2   ,B4
          1 0000F8  2C08                                 LDV,R2   8
          1 0000F9  6C08                                 LDV,R6   8
          1 0000FA  BB87                                 LAB,B3   ,AUTO
          1 0000FB  3C7E                                 LDV,R3   126
          1 0000FC  0008                                 MMM

     1604    17576    1        TERMID.LEV = LEV;

  17576   1 0000FD  E847 003A                            LDR,R6   LEV,AUTO
          1 0000FF  EAC7 003B                            SRM,R6,'00FF'X    TERMID,AUTO
          1 000101       00FF

     1605    17577    2        DO CHAN = CHANLO TO CHANHI;

  17577   1 000102  D847 0067                            LDR,R5   CHANLO,AUTO
          1 000104  DF47 0066                            STR,R5   CHAN,AUTO
          1 000106  0F81 03ED                            B        s:17856+2,PREL

     1606    17578    2             TERMID.TERM.CHANNEL = CHAN * 128;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:203  

  17578   1 000108  E847 0066                            LDR,R6   CHAN,AUTO
          1 00010A  6007                                 SOL,R6   7
          1 00010B  EF47 003C                            STR,R6   TERMID+1,AUTO

     1607    17579    3             DO SUB = SUBLO TO SUBHI;

  17579   1 00010D  D847 006A                            LDR,R5   SUBLO,AUTO
          1 00010F  DF47 0069                            STR,R5   SUB,AUTO
          1 000111  0F81 03DA                            B        s:17855+2,PREL

     1608    17580    3                  TERMID.TERM.SUBDEVICE = SUB;

  17580   1 000113  E847 0069                            LDR,R6   SUB,AUTO
          1 000115  EF47 003D                            STR,R6   TERMID+2,AUTO

     1609    17581    4                  DO SUBSUB = SUBSUBLO TO SUBSUBHI;

  17581   1 000117  D847 006D                            LDR,R5   SUBSUBLO,AUTO
          1 000119  DF47 006C                            STR,R5   SUBSUB,AUTO
          1 00011B  0F81 03C8                            B        s:17851+2,PREL

     1610    17582    4                       TERMID.TERM.SUBSUBDEVICE = SUBSUB;

  17582   1 00011D  E847 006C                            LDR,R6   SUBSUB,AUTO
          1 00011F  EF47 003E                            STR,R6   TERMID+3,AUTO

     1611    17583    5                       CALL KHA$GET_CTX_PTR(TERMID,CHN$) WHENALTRETURN DO;

  17583   1 000121  EBC7 0034                            LAB,B6   CHN$,AUTO
          1 000123  EFC7 00D4                            STB,B6   KEYIN+5,AUTO
          1 000125  DBC7 003B                            LAB,B5   TERMID,AUTO
          1 000127  DFC7 00D2                            STB,B5   KEYIN+3,AUTO
          1 000129  BBC7 00D2                            LAB,B3   KEYIN+3,AUTO
          1 00012B  CBF0 0200                            LAB,B4   512,IMO
          1 00012D  E380 0000 0000  xent                 LNJ,B6   KHA$GET_CTX_PTR
          1 000130       0003                            DC       s:17584,PREL
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:204  
          1 000131  0F81 0009                            B        s:17587,PREL

     1612    17584    5                            ERROR = ERR_BADCHN;

  17584   1 000133  8C80 0000 022A  00                   LDI      ERR_BADCHN
          1 000136  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 000138  8D06                                 SDI      ,B6

     1613    17585    5                            GOTO ERROR_CHECK;

  17585   1 000139  0F81 03CF                            B        s:17858,PREL

     1614    17586    5                          END;             /* WHENALTRETURN */
     1615    17587    5                       IF LEV = %TERMINAL_ID_LEV_CHAN# THEN DO;

  17587   1 00013B  E847 003A                            LDR,R6   LEV,AUTO
          1 00013D  6D01                                 CMV,R6   1
          1 00013E  0981 0007                            BNE      s:17591,PREL

     1616    17588    5                            LIN$ = CHN$;

  17588   1 000140  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 000142  EFC7 004B                            STB,B6   LIN$,AUTO

     1617    17589    5                          END;             /* IF */

  17589   1 000144  0F81 0020                            B        s:17597,PREL

     1618    17590    5                       ELSE DO;

     1619    17591    5                            TMP_TERMID = TERMID;

  17591   1 000146  AB87                                 LAB,B2   ,AUTO
          1 000147  2C76                                 LDV,R2   118
          1 000148  6C10                                 LDV,R6   16
          1 000149  BBC7 0043                            LAB,B3   TMP_TERMID,AUTO
          1 00014B  3C00                                 LDV,R3   0
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:205  
          1 00014C  0008                                 MMM

     1620    17592    5                            TMP_TERMID.LEV = %TERMINAL_ID_LEV_CHAN#;

  17592   1 00014D  6C01                                 LDV,R6   1
          1 00014E  EAC7 0043                            SRM,R6,'00FF'X    TMP_TERMID,AUTO
          1 000150       00FF

     1621    17593    5                            TMP_TERMID.TERM.SUBDEVICE = 0;

  17593   1 000151  8747 0045                            CL       TMP_TERMID+2,AUTO

     1622    17594    5                            TMP_TERMID.TERM.SUBSUBDEVICE = 0;

  17594   1 000153  8747 0046                            CL       TMP_TERMID+3,AUTO

     1623    17595    5                            CALL KHA$GET_CTX_PTR(TMP_TERMID,LIN$);

  17595   1 000155  EBC7 004B                            LAB,B6   LIN$,AUTO
          1 000157  EFC7 00D4                            STB,B6   KEYIN+5,AUTO
          1 000159  DBC7 0043                            LAB,B5   TMP_TERMID,AUTO
          1 00015B  DFC7 00D2                            STB,B5   KEYIN+3,AUTO
          1 00015D  BBC7 00D2                            LAB,B3   KEYIN+3,AUTO
          1 00015F  CBF0 0200                            LAB,B4   512,IMO
          1 000161  E380 0000 0000  xent                 LNJ,B6   KHA$GET_CTX_PTR
          1 000164       0001                            DC       s:17597,PREL

     1624    17596    5                          END;             /* ELSE */

     1625    17597    4                       OLD = KH$CHN.STT;

  17597   1 000165  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 000167  E2C6 0001                            LLH,R6   1,B6
          1 000169  EF47 0064                            STR,R6   OLD,AUTO

     1626    17598        /* Find the transition table */
     1627    17599    4                       TRANS$ = TRANS_TABLE$(OPERATION);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:206  

  17599   1 00016B  DCC7 0004                            LDB,B5   @OPERATION,AUTO
          1 00016D  B805                                 LDR,R3   ,B5
          1 00016E  CCB0 0000 01A4  00                   LDB,B4   TRANS_TABLE$,R3
          1 000171  CFC7 0032                            STB,B4   TRANS$,AUTO

     1628    17600    4                       IF TRANS$ = ADDR(NIL)

  17600   1 000173  8DC7 0032                            CMN      TRANS$,AUTO
          1 000175  0981 0010                            BNE      s:17611,PREL

     1629    17601    5                       THEN DO;

     1630    17602                                 %ENABLE;

  17603   1 000177  D847 0011                            LDR,R5   DISABLE_LEVEL,AUTO
          1 000179  D947 0010                            CMR,R5   INHIBIT_LEVEL,AUTO
          1 00017B  0901 0007                            BE       s:17608,PREL

  17605   1 00017D  CBF0 0000                            LAB,B4   0,IMO
          1 00017F  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 000182       0001                            DC       s:17608,PREL

     1631    17608    5                            RETURN;

  17608   1 000183  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1632    17609    5                          END;
     1633    17610
     1634    17611    5                       DO WHILE (NOT B$TRANS.LAST);

  17611   1 000186  0F81 0083                            B        s:17667,PREL

     1635    17612    5                            IF B$TRANS.OLD = OLD OR B$TRANS.OLD = -1

  17612   1 000188  ECC7 0032                            LDB,B6   TRANS$,AUTO
          1 00018A  E086                                 LDH,R6   ,B6
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:207  
          1 00018B  6801 0005                            BLZ,R6   s:17612+9,PREL
          1 00018D  E947 0064                            CMR,R6   OLD,AUTO
          1 00018F  0901 0004                            BE       s:17614,PREL
          1 000191  6DFF                                 CMV,R6   -1
          1 000192  0981 0073                            BNE      s:17666,PREL

     1636    17613    5                            THEN
     1637    17614    6                            DO CASE (B$TRANS.FLGS);

  17614   1 000194  B846 0002                            LDR,R3   2,B6
          1 000196  B570 00FF                            AND,R3   255,IMO
          1 000198  3D0A                                 CMV,R3   10
          1 000199  0281 006A                            BGE      s:17663,PREL
          1 00019B  A830 0000 01A1  01                   LDR,R2   s:17614+13,R3
          1 00019E  83A0 0000 01AB  01                   JMP      s:17617,R2
          1 0001A1       0059                            DC       s:17663,PREL
          1 0001A2       0012                            DC       s:17627,PREL
          1 0001A3       005B                            DC       s:17666,PREL
          1 0001A4       0000                            DC       s:17617,PREL
          1 0001A5       0009                            DC       s:17622,PREL
          1 0001A6       001B                            DC       s:17632,PREL
          1 0001A7       0024                            DC       s:17640,PREL
          1 0001A8       003E                            DC       s:17647,PREL
          1 0001A9       0047                            DC       s:17652,PREL
          1 0001AA       0050                            DC       s:17657,PREL

     1638    17615
     1639    17616    6                            CASE (%Y#ENB);

     1640    17617    6                               IF KH$CHN.ENB

  17617   1 0001AB  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0001AD  82C5 0007                            LB,'0040'X        7,B5
          1 0001AF       0040
          1 0001B0  0501 0073                            BBT      s:17669,PREL
          1 0001B2  0F81 0053                            B        s:17666,PREL

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:208  
     1641    17618    6                               THEN
     1642    17619    6                                    GOTO GOT_TRANS;
     1643    17620
     1644    17621    6                            CASE (%Y#REENB);

     1645    17622    6                               IF KH$CHN.RE_ENB

  17622   1 0001B4  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0001B6  82C5 0007                            LB,'0080'X        7,B5
          1 0001B8       0080
          1 0001B9  0501 006A                            BBT      s:17669,PREL
          1 0001BB  0F81 004A                            B        s:17666,PREL

     1646    17623    6                               THEN
     1647    17624    6                                    GOTO GOT_TRANS;
     1648    17625
     1649    17626    6                            CASE (%Y#DED);

     1650    17627    6                               IF KH$CHN.DED

  17627   1 0001BD  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0001BF  82C5 0009                            LB,'0100'X        9,B5
          1 0001C1       0100
          1 0001C2  0501 0061                            BBT      s:17669,PREL
          1 0001C4  0F81 0041                            B        s:17666,PREL

     1651    17628    6                               THEN
     1652    17629    6                                    GOTO GOT_TRANS;
     1653    17630
     1654    17631    6                            CASE (%Y#CTR);

     1655    17632    6                               IF KH$CHN.CTR

  17632   1 0001C6  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0001C8  82C5 0007                            LB,'0020'X        7,B5
          1 0001CA       0020
          1 0001CB  0501 0058                            BBT      s:17669,PREL
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:209  
          1 0001CD  0F81 0038                            B        s:17666,PREL

     1656    17633    6                               THEN
     1657    17634    6                                    GOTO GOT_TRANS;
     1658    17635
     1659    17636
     1660    17637    6                            CASE (%Y#ERR);

     1661    17638
     1662    17639    6                            CASE (%Y#NOTDED);

     1663    17640    6                               IF ~KH$CHN.DED

  17640   1 0001CF  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0001D1  D845 0009                            LDR,R5   9,B5
          1 0001D3  5007                                 SOL,R5   7
          1 0001D4  D570 8000                            AND,R5   -32768,IMO
          1 0001D6  D670 8000                            XOR,R5   -32768,IMO
          1 0001D8  5901 0008                            BEZ,R5   s:17645,PREL

     1664    17641    7                               THEN DO;

     1665    17642    7                                    ERROR = '0'B;

  17642   1 0001DA  CCC7 0006                            LDB,B4   @ERROR,AUTO
          1 0001DC  8704                                 CL       ,B4
          1 0001DD  8744 0001                            CL       1,B4

     1666    17643    7                                    GOTO GOT_TRANS;

  17643   1 0001DF  0F81 0044                            B        s:17669,PREL

     1667    17644    7                                  END;
     1668    17645    6                               ERROR = ERR_DEDCHN;

  17645   1 0001E1  8C80 0000 0230  00                   LDI      ERR_DEDCHN
          1 0001E4  CCC7 0006                            LDB,B4   @ERROR,AUTO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:210  
          1 0001E6  8D04                                 SDI      ,B4
          1 0001E7  0F81 001E                            B        s:17666,PREL

     1669    17646    6                            CASE (%Y#KLLHSTDWN);

     1670    17647    6                               IF KH$CHN.KLLHSTDWN

  17647   1 0001E9  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0001EB  82C5 0009                            LB,'1000'X        9,B5
          1 0001ED       1000
          1 0001EE  0501 0035                            BBT      s:17669,PREL
          1 0001F0  0F81 0015                            B        s:17666,PREL

     1671    17648    6                               THEN
     1672    17649    6                                    GOTO GOT_TRANS;
     1673    17650
     1674    17651    6                            CASE (%Y#DSBHSTDWN);

     1675    17652    6                               IF KH$CHN.DSBHSTDWN

  17652   1 0001F2  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0001F4  82C5 0009                            LB,'2000'X        9,B5
          1 0001F6       2000
          1 0001F7  0501 002C                            BBT      s:17669,PREL
          1 0001F9  0F81 000C                            B        s:17666,PREL

     1676    17653    6                               THEN
     1677    17654    6                                    GOTO GOT_TRANS;
     1678    17655
     1679    17656    6                            CASE (%Y#ENBHSTUP);

     1680    17657    6                               IF KH$CHN.ENBHSTUP

  17657   1 0001FB  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0001FD  82C5 0009                            LB,'0800'X        9,B5
          1 0001FF       0800
          1 000200  0501 0023                            BBT      s:17669,PREL
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:211  
          1 000202  0F81 0003                            B        s:17666,PREL

     1681    17658    6                               THEN
     1682    17659    6                                    GOTO GOT_TRANS;
     1683    17660
     1684    17661
     1685    17662    6                            CASE (ELSE);

     1686    17663    6                               GOTO GOT_TRANS;

  17663   1 000204  0F81 001F                            B        s:17669,PREL

     1687    17664
     1688    17665    6                            END /* END CASES */;

     1689    17666    5                            TRANS$ = PINCRW(TRANS$,SIZEW(B$TRANS));

  17666   1 000206  DBC6 0004                            LAB,B5   4,B6
          1 000208  DFC7 0032                            STB,B5   TRANS$,AUTO

     1690    17667    5                          END;             /* End DO WHILE (B$TRANS.LAST)        */

  17667   1 00020A  ECC7 0032                            LDB,B6   TRANS$,AUTO
          1 00020C  82C6 0003                            LB,'0080'X        3,B6
          1 00020E       0080
          1 00020F  0581 FF78                            BBF      s:17612,PREL

     1691    17668
     1692    17669    4                       IF ERROR = '0'B THEN

  17669   1 000211  DCC7 0006                            LDB,B5   @ERROR,AUTO
          1 000213  CB80 0000 0000  02                   LAB,B4   0
          1 000216  5C01                                 LDV,R5   1
          1 000217  0022                                 ACM      ;
          1 000218       4405 0000                                ALPHANUM(0,B5,,4,FILL),;
          1 00021A       4004 0000                                ALPHANUM(0,B4,,R5,FILL)
          1 00021C  5301 0005                            CBNE     s:17671,PREL
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:212  

     1693    17670    4                            ERROR = ERR_ILGLTRANS;

  17670   1 00021E  8C80 0000 022C  00                   LDI      ERR_ILGLTRANS
          1 000221  8D05                                 SDI      ,B5

     1694    17671    4                       GOTO ERROR_CHECK;

  17671   1 000222  0F81 02E6                            B        s:17858,PREL

  17669   1                              GOT_TRANS       null
     1695    17672
     1696    17673    4   GOT_TRANS:          ;
     1697    17674    4                       IF B$TRANS.NEW = -1

  17674   1 000224  E806                 GOT_TRANS       LDR,R6   ,B6
          1 000225  6008                                 SOL,R6   8
          1 000226  6068                                 SAR,R6   8
          1 000227  6DFF                                 CMV,R6   -1
          1 000228  0981 0007                            BNE      s:17678,PREL

     1698    17675    4                       THEN
     1699    17676    4                            NEW = OLD;

  17676   1 00022A  D847 0064                            LDR,R5   OLD,AUTO
          1 00022C  DF47 0063                            STR,R5   NEW,AUTO
          1 00022E  0F81 0003                            B        s:17679,PREL

     1700    17677    4                       ELSE
     1701    17678    4                            NEW = B$TRANS.NEW;

  17678   1 000230  EF47 0063                            STR,R6   NEW,AUTO

     1702    17679    4                       IF NEW = -1         /* Illegal state transition           */

  17679   1 000232  D847 0063                            LDR,R5   NEW,AUTO
          1 000234  5DFF                                 CMV,R5   -1
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:213  
          1 000235  0981 0009                            BNE      s:17684,PREL

     1703    17680    5                       THEN DO;

     1704    17681    5                            ERROR = ERR_ILGLTRANS;

  17681   1 000237  8C80 0000 022C  00                   LDI      ERR_ILGLTRANS
          1 00023A  DCC7 0006                            LDB,B5   @ERROR,AUTO
          1 00023C  8D05                                 SDI      ,B5

     1705    17682    5                            GOTO ERROR_CHECK;

  17682   1 00023D  0F81 02CB                            B        s:17858,PREL

     1706    17683    5                          END;
     1707    17684    4                       HOP = B$TRANS.HOP;

  17684   1 00023F  C2C6 0001                            LLH,R4   1,B6
          1 000241  CF47 0060                            STR,R4   HOP,AUTO

     1708    17685    4                       BSOP = B$TRANS.BSOP;

  17685   1 000243  B846 0001                            LDR,R3   1,B6
          1 000245  B570 00FF                            AND,R3   255,IMO
          1 000247  BF47 0061                            STR,R3   BSOP,AUTO

     1709    17686    4                       ASOP = B$TRANS.ASOP;

  17686   1 000249  A2C6 0002                            LLH,R2   2,B6
          1 00024B  AF47 0062                            STR,R2   ASOP,AUTO

     1710    17687    4                       KH$CHN.STT = NEW;

  17687   1 00024D  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 00024F  D7C5 0001                            STH,R5   1,B5

     1711    17688
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:214  
     1712    17689        /* Do any special operations before the call to admin */
     1713    17690    5                       DO CASE (BSOP);

  17690   1 000251  3D0B                                 CMV,R3   11
          1 000252  0281 0196                            BGE      s:17788,PREL
          1 000254  9830 0000 025A  01                   LDR,R1   s:17690+9,R3
          1 000257  8390 0000 0265  01                   JMP      s:17693,R1
          1 00025A       0184                            DC       s:17788,PREL
          1 00025B       0000                            DC       s:17693,PREL
          1 00025C       0184                            DC       s:17788,PREL
          1 00025D       0184                            DC       s:17788,PREL
          1 00025E       0184                            DC       s:17788,PREL
          1 00025F       004A                            DC       s:17711,PREL
          1 000260       00FE                            DC       s:17751,PREL
          1 000261       0112                            DC       s:17753,PREL
          1 000262       0169                            DC       s:17778,PREL
          1 000263       0184                            DC       s:17788,PREL
          1 000264       017F                            DC       s:17783,PREL

     1714    17691
     1715    17692    5                       CASE (%Y#SOP_INTCTR);

     1716    17693    5                          CALL GET_CONTROLLER;

  17693   1 000265  E3C0 02B7                            LNJ,B6   s:0,PREL
          1 000267       0001                            DC       s:17694,PREL

     1717    17694    5                          IF NOT CTR$->KH$CHN.CCPDWNLD(CTRTYPE) AND

  17694   1 000268  ECC7 0036                            LDB,B6   CTR$,AUTO
          1 00026A  B847 0039                            LDR,R3   CTRTYPE,AUTO
          1 00026C  3E19                                 ADV,R3   25
          1 00026D  82B6                                 LB       ,B6,R3
          1 00026E  0501 017A                            BBT      s:17788,PREL
          1 000270  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 000272  E845 0012                            LDR,R6   18,B5
          1 000274  E570 00FF                            AND,R6   255,IMO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:215  
          1 000276  6D01                                 CMV,R6   1
          1 000277  0981 0171                            BNE      s:17788,PREL

     1718    17695    5                               KH$CHN.TERMID.LEV    = %TERMINAL_ID_LEV_CHAN#
     1719    17696    6                          THEN DO;

     1720    17697    6                               ADMIN_FPT.FNC = %KHA_FNC_INTCTR;

  17697   1 000279  5C0F                                 LDV,R5   15
          1 00027A  DF47 004E                            STR,R5   ADMIN_FPT,AUTO

     1721    17698    6                               ADMIN_FPT.TERMID = TERMID;

  17698   1 00027C  AB87                                 LAB,B2   ,AUTO
          1 00027D  2C76                                 LDV,R2   118
          1 00027E  6C10                                 LDV,R6   16
          1 00027F  BBC7 004F                            LAB,B3   ADMIN_FPT+1,AUTO
          1 000281  3C00                                 LDV,R3   0
          1 000282  0008                                 MMM

     1722    17699    6                               ADMIN_FPT.CHN$ = CHN$;

  17699   1 000283  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 000285  EFC7 0059                            STB,B6   ADMIN_FPT+11,AUTO

     1723    17700    6                               ADMIN_FPT.LIN$ = LIN$;

  17700   1 000287  DCC7 004B                            LDB,B5   LIN$,AUTO
          1 000289  DFC7 005B                            STB,B5   ADMIN_FPT+13,AUTO

     1724    17701    6                               CALL KH_ADMIN$(ADMIN_FPT)

  17701   1 00028B  CBC7 004E                            LAB,B4   ADMIN_FPT,AUTO
          1 00028D  CFC7 00D2                            STB,B4   KEYIN+3,AUTO
          1 00028F  BBC7 00D2                            LAB,B3   KEYIN+3,AUTO
          1 000291  9C80 0000 0000  xsym                 LDB,B1   KH_ADMIN$
          1 000294  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:216  
          1 000296  E381                                 LNJ,B6   ,B1
          1 000297       0003                            DC       s:17703,PREL
          1 000298  0F81 000E                            B        s:17707,PREL

     1725    17702    7                               WHENALTRETURN DO;

     1726    17703    7                                    ERROR = ADMIN_FPT.RESULTS;

  17703   1 00029A  8CC7 005D                            LDI      ADMIN_FPT+15,AUTO
          1 00029C  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 00029E  8D06                                 SDI      ,B6

     1727    17704    7                                    KH$CHN.STT = OLD;

  17704   1 00029F  D847 0064                            LDR,R5   OLD,AUTO
          1 0002A1  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0002A3  D7C5 0001                            STH,R5   1,B5

     1728    17705    7                                    GOTO ERROR_CHECK;

  17705   1 0002A5  0F81 0263                            B        s:17858,PREL

     1729    17706    7                                  END;
     1730    17707    6                               CTR$->KH$CHN.CCPDWNLD(CTRTYPE) = '1'B;

  17707   1 0002A7  ECC7 0036                            LDB,B6   CTR$,AUTO
          1 0002A9  B847 0039                            LDR,R3   CTRTYPE,AUTO
          1 0002AB  3E19                                 ADV,R3   25
          1 0002AC  8936                                 LBT      ,B6,R3

     1731    17708    6                             END;

  17708   1 0002AD  0F81 013B                            B        s:17788,PREL

     1732    17709    5                       CASE(%Y#SOP_UPDCHN);

     1733    17710    5                       CASE(%Y#SOP_RQSLINPRO);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:217  

     1734    17711    5                          RQSPRO$ = ADDR(RQSPRO_BUF);

  17711   1 0002AF  DBC7 006F                            LAB,B5   RQSPRO_BUF,AUTO
          1 0002B1  DFC7 00AB                            STB,B5   RQSPRO$,AUTO

     1735    17712    5                          RQSPRO_BUF = '0'B;

  17712   1 0002B3  5C78                                 LDV,R5   120
          1 0002B4  0021                                 ALR      ;
          1 0002B5       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0002B7       4007 006F                                ALPHANUM(RQSPRO_BUF,AUTO,,R5,FILL)

     1736    17713    5                          KL_RQSPRO.FCN = IGA_RQSCHN;

  17713   1 0002B9  6C3D                                 LDV,R6   61
          1 0002BA  437F                                 CSYNC    s:17713,SPREL
          1 0002BB  DCC7 00AB                            LDB,B5   RQSPRO$,AUTO
          1 0002BD  E785                                 STH,R6   ,B5

     1737    17714    5                          KL_RQSPRO.LINE_PROFILE = '1'B;

  17714   1 0002BE  8905                                 LBT,'0080'X       ,B5
  17714   1 0002BF       0080

     1738    17715    5                          KL_RQSPRO.TERMINAL_ID = TERMID;

  17715   1 0002C0  AB87                                 LAB,B2   ,AUTO
          1 0002C1  2C76                                 LDV,R2   118
          1 0002C2  6C10                                 LDV,R6   16
          1 0002C3  BB85                                 LAB,B3   ,B5
          1 0002C4  3C0A                                 LDV,R3   10
          1 0002C5  0008                                 MMM

     1739    17716    5                          KL_RQSPRO.TERMINAL_ID.TTYP = TERMLO.TTYP;

  17716   1 0002C6  ECC7 0008                            LDB,B6   @TERMLO,AUTO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:218  
          1 0002C8  E286                                 LLH,R6   ,B6
          1 0002C9  CCC7 00AB                            LDB,B4   RQSPRO$,AUTO
          1 0002CB  E7C4 0005                            STH,R6   5,B4

     1740    17717    6                          IF ADDR(DATAVEC) ~= ADDR(NIL) THEN DO;

  17717   1 0002CD  9CC7 000C                            LDB,B1   @DATAVEC,AUTO
          1 0002CF  8DD1                                 CMN      B1
          1 0002D0  0901 0027                            BE       s:17723,PREL

     1741    17718    6                               KL_RQSPRO.SGN.L = VBOUND(DATAVEC) + 1;

  17718   1 0002D2  E801                                 LDR,R6   ,B1
          1 0002D3  6E01                                 ADV,R6   1
          1 0002D4  E7C4 000D                            STH,R6   13,B4

     1742    17719    6                               SIZE = VBOUND(DATAVEC) + 1;

  17719   1 0002D6  E801                                 LDR,R6   ,B1
          1 0002D7  6E01                                 ADV,R6   1
          1 0002D8  EF47 004D                            STR,R6   SIZE,AUTO

     1743    17720    6                               KL_RQSPRO.SGN.TXT = VBASE(DATAVEC)->SIGNON;

  17720   1 0002DA  C2C4 000D                            LLH,R4   13,B4
          1 0002DC  8CC1 0001                            LDI      1,B1
          1 0002DE  B856                                 LDR,R3   R6
          1 0002DF  E570 7FFF                            AND,R6   32767,IMO
          1 0002E1  8D47 00D2                            SDI      KEYIN+3,AUTO
          1 0002E3  ECC7 00D2                            LDB,B6   KEYIN+3,AUTO
          1 0002E5  304F                                 SOR,R3   15
          1 0002E6  BF47 00D4                            STR,R3   KEYIN+5,AUTO
          1 0002E8  CF47 00D5                            STR,R4   KEYIN+6,AUTO
          1 0002EA  EFC7 00D6                            STB,B6   KEYIN+7,AUTO
          1 0002EC  AB86                                 LAB,B2   ,B6
          1 0002ED  A853                                 LDR,R2   R3
          1 0002EE  E847 004D                            LDR,R6   SIZE,AUTO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:219  
          1 0002F0  BB84                                 LAB,B3   ,B4
          1 0002F1  3C1B                                 LDV,R3   27
          1 0002F2  F854                                 LDR,R7   R4
          1 0002F3  D380 0000 0000  xent                 LNJ,B5   X6C_ALR

     1744    17721    6                             END;          /* IF */

  17721   1 0002F6  0F81 000D                            B        s:17726,PREL

     1745    17722    6                          ELSE DO;

     1746    17723    6                               KL_RQSPRO.SGN.L = 0;

  17723   1 0002F8  87C4 000D                            CLH      13,B4

     1747    17724    6                               KL_RQSPRO.SGN.TXT = ' ';

  17724   1 0002FA  E2C4 000D                            LLH,R6   13,B4
          1 0002FC  D856                                 LDR,R5   R6
          1 0002FD  DA70 2000                            ADD,R5   8192,IMO
          1 0002FF  0021                                 ALR      ;
          1 000300       4178 2000                                ALPHANUM('2000'X,IMO,,1),;
          1 000302       C004 000D                                ALPHANUM(13,B4,1,R5,FILL)

     1748    17725    6                             END;          /* ELSE */

     1749    17726    5                          KHA_WRITE.BUF_ = VECTOR(RQSPRO_BUF);

  17726   1 000304  EBC7 006F                            LAB,B6   RQSPRO_BUF,AUTO
          1 000306  437F                                 CSYNC    s:17726+1,SPREL
          1 000307  EFC7 00D3                            STB,B6   KEYIN+4,AUTO
          1 000309  6C77                                 LDV,R6   119
          1 00030A  EF47 00D2                            STR,R6   KEYIN+3,AUTO
          1 00030C  ABC7 00D2                            LAB,B2   KEYIN+3,AUTO
          1 00030E  2C00                                 LDV,R2   0
          1 00030F  6C06                                 LDV,R6   6
          1 000310  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:220  
          1 000313  3C0C                                 LDV,R3   12
          1 000314  0008                                 MMM

     1750    17727    5                          IF KH_FLDWRTS > 0 THEN

  17727   1 000315  E800 0000 0000  xsym                 LDR,R6   KH_FLDWRTS
          1 000318  6A81 0021                            BLEZ,R6  s:17738,PREL

     1751    17728    6                          DO;

     1752    17729    6                               IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0 THEN

  17729   1 00031A  ECC7 000E                            LDB,B6   @NORETRAN,AUTO
          1 00031C  8DD6                                 CMN      B6
          1 00031D  0901 0007                            BE       s:17731,PREL
          1 00031F  D806                                 LDR,R5   ,B6
          1 000320  5901 0004                            BEZ,R5   s:17731,PREL

     1753    17730    6                                    ALTRETURN;

  17730   1 000322  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1754    17731    6                               CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  17731   1 000325  BB80 0000 0001  02                   LAB,B3   +1
          1 000328  CBF0 0100                            LAB,B4   256,IMO
          1 00032A  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          1 00032D       0003                            DC       s:17733,PREL
          1 00032E  0F81 0009                            B        s:17736,PREL

     1755    17732    7                               DO;

     1756    17733    7                                    ERROR = ERR_CLKFAILED;

  17733   1 000330  8C80 0000 022E  00                   LDI      ERR_CLKFAILED
          1 000333  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 000335  8D06                                 SDI      ,B6
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:221  

     1757    17734    7                                    GOTO ERROR_CHECK;

  17734   1 000336  0F81 01D2                            B        s:17858,PREL

     1758    17735    7                                  END;
     1759    17736    6                             END;

  17736   1 000338  0F81 00B0                            B        s:17788,PREL

     1760    17737    5                          ELSE
     1761    17738    5                               CALL M$WRITE(KHA_WRITE) WHENALTRETURN

  17738   1 00033A  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          1 00033D  B870 1543                            LDR,R3   5443,IMO
          1 00033F  0001                                 MCL
          1 000340       0003                            DC       s:17740,PREL
          1 000341  0F81 001F                            B        s:17748,PREL

     1762    17739    6                               DO;

     1763    17740    6                                    IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0
             17740                                             THEN

  17740   1 000343  ECC7 000E                            LDB,B6   @NORETRAN,AUTO
          1 000345  8DD6                                 CMN      B6
          1 000346  0901 0007                            BE       s:17743,PREL
          1 000348  E806                                 LDR,R6   ,B6
          1 000349  6901 0004                            BEZ,R6   s:17743,PREL

     1764    17741    6                                         ALTRETURN;

  17741   1 00034B  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1765    17742    6                                    ELSE
     1766    17743    6                                         CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:222  
  17743   1 00034E  BB80 0000 0001  02                   LAB,B3   +1
          1 000351  CBF0 0100                            LAB,B4   256,IMO
          1 000353  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          1 000356       0003                            DC       s:17745,PREL
          1 000357  0F81 0009                            B        s:17748,PREL

     1767    17744    7                                         DO;

     1768    17745    7                                              ERROR = ERR_CLKFAILED;

  17745   1 000359  8C80 0000 022E  00                   LDI      ERR_CLKFAILED
          1 00035C  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 00035E  8D06                                 SDI      ,B6

     1769    17746    7                                              GOTO ERROR_CHECK;

  17746   1 00035F  0F81 01A9                            B        s:17858,PREL

     1770    17747    7                                            END;
     1771    17748    6                                  END;

  17748   1 000361  0F81 0087                            B        s:17788,PREL

     1772    17749
     1773    17750    5                       CASE(%Y#SOP_BLDLINPRO);

     1774    17751    5                         CALL KHA$BLDLINPRO(TERMID,VBASE(DATAVEC)) ALTRET(ERROR_CHECK)
             17751                                   ;

  17751   1 000363  DCC7 000C                            LDB,B5   @DATAVEC,AUTO
          1 000365  CBC5 0001                            LAB,B4   1,B5
          1 000367  CFC7 00D4                            STB,B4   KEYIN+5,AUTO
          1 000369  BBC7 003B                            LAB,B3   TERMID,AUTO
          1 00036B  BFC7 00D2                            STB,B3   KEYIN+3,AUTO
          1 00036D  BBC7 00D2                            LAB,B3   KEYIN+3,AUTO
          1 00036F  CBF0 0200                            LAB,B4   512,IMO
          1 000371  E380 0000 0000  xent                 LNJ,B6   KHA$BLDLINPRO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:223  
          1 000374       0195                            DC       s:17858,PREL
          1 000375  0F81 0073                            B        s:17788,PREL

     1775    17752    5                       CASE(%Y#SOP_DVCERR);

     1776    17753    5                          KHA_WRITE.BUF_ = DATAVEC;

  17753   1 000377  ACC7 000C                            LDB,B2   @DATAVEC,AUTO
          1 000379  2C00                                 LDV,R2   0
          1 00037A  6C06                                 LDV,R6   6
          1 00037B  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          1 00037E  3C0C                                 LDV,R3   12
          1 00037F  0008                                 MMM

     1777    17754    5                          IF KH_FLDWRTS > 0 THEN

  17754   1 000380  E800 0000 0000  xsym                 LDR,R6   KH_FLDWRTS
          1 000383  6A81 0021                            BLEZ,R6  s:17765,PREL

     1778    17755    6                          DO;

     1779    17756    6                               IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0 THEN

  17756   1 000385  ECC7 000E                            LDB,B6   @NORETRAN,AUTO
          1 000387  8DD6                                 CMN      B6
          1 000388  0901 0007                            BE       s:17758,PREL
          1 00038A  D806                                 LDR,R5   ,B6
          1 00038B  5901 0004                            BEZ,R5   s:17758,PREL

     1780    17757    6                                    ALTRETURN;

  17757   1 00038D  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1781    17758    6                               CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  17758   1 000390  BB80 0000 0001  02                   LAB,B3   +1
          1 000393  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:224  
          1 000395  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          1 000398       0003                            DC       s:17760,PREL
          1 000399  0F81 0009                            B        s:17763,PREL

     1782    17759    7                               DO;

     1783    17760    7                                    ERROR = ERR_CLKFAILED;

  17760   1 00039B  8C80 0000 022E  00                   LDI      ERR_CLKFAILED
          1 00039E  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 0003A0  8D06                                 SDI      ,B6

     1784    17761    7                                    GOTO ERROR_CHECK;

  17761   1 0003A1  0F81 0167                            B        s:17858,PREL

     1785    17762    7                                  END;
     1786    17763    6                             END;

  17763   1 0003A3  0F81 0045                            B        s:17788,PREL

     1787    17764    5                          ELSE
     1788    17765    5                               CALL M$WRITE(KHA_WRITE) WHENALTRETURN

  17765   1 0003A5  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          1 0003A8  B870 1543                            LDR,R3   5443,IMO
          1 0003AA  0001                                 MCL
          1 0003AB       0003                            DC       s:17767,PREL
          1 0003AC  0F81 001F                            B        s:17775,PREL

     1789    17766    6                               DO;

     1790    17767    6                                    IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0
             17767                                             THEN

  17767   1 0003AE  ECC7 000E                            LDB,B6   @NORETRAN,AUTO
          1 0003B0  8DD6                                 CMN      B6
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:225  
          1 0003B1  0901 0007                            BE       s:17770,PREL
          1 0003B3  E806                                 LDR,R6   ,B6
          1 0003B4  6901 0004                            BEZ,R6   s:17770,PREL

     1791    17768    6                                         ALTRETURN;

  17768   1 0003B6  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1792    17769    6                                    ELSE
     1793    17770    6                                         CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  17770   1 0003B9  BB80 0000 0001  02                   LAB,B3   +1
          1 0003BC  CBF0 0100                            LAB,B4   256,IMO
          1 0003BE  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          1 0003C1       0003                            DC       s:17772,PREL
          1 0003C2  0F81 0009                            B        s:17775,PREL

     1794    17771    7                                         DO;

     1795    17772    7                                              ERROR = ERR_CLKFAILED;

  17772   1 0003C4  8C80 0000 022E  00                   LDI      ERR_CLKFAILED
          1 0003C7  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 0003C9  8D06                                 SDI      ,B6

     1796    17773    7                                              GOTO ERROR_CHECK;

  17773   1 0003CA  0F81 013E                            B        s:17858,PREL

     1797    17774    7                                            END;
     1798    17775    6                                  END;

  17775   1 0003CC  0F81 001C                            B        s:17788,PREL

     1799    17776
     1800    17777    5                       CASE(%Y#SOP_DVCERRRSP);

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:226  
     1801    17778    5                          ADMIN = ADMINC;

  17778   1 0003CE  AB80 0000 0208  00                   LAB,B2   ADMINC
          1 0003D1  2C00                                 LDV,R2   0
          1 0003D2  6C44                                 LDV,R6   68
          1 0003D3  BBC7 00AD                            LAB,B3   ADMIN,AUTO
          1 0003D5  3C00                                 LDV,R3   0
          1 0003D6  0008                                 MMM

     1802    17779    5                          KEYIN = VBASE(DATAVEC)->ONEWORD;

  17779   1 0003D7  ECC7 000C                            LDB,B6   @DATAVEC,AUTO
          1 0003D9  DCC6 0001                            LDB,B5   1,B6
          1 0003DB  E805                                 LDR,R6   ,B5
          1 0003DC  EF47 00CF                            STR,R6   KEYIN,AUTO

     1803    17780    5                          ADMIN_FPT.CTX$ = ADDR(KEYIN);

  17780   1 0003DE  DBC7 00CF                            LAB,B5   KEYIN,AUTO
          1 0003E0  DFC7 0057                            STB,B5   ADMIN_FPT+9,AUTO
          1 0003E2  0F81 0006                            B        s:17788,PREL

     1804    17781
     1805    17782    5                       CASE(%Y#SOP_CLRENBHSTUP);

     1806    17783    5                          KH$CHN.ENBHSTUP = '0'B;

  17783   1 0003E4  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 0003E6  8845 0009                            LBF,'0800'X       9,B5
          1 0003E8       0800

     1807    17784
     1808    17785    5                       END;                /* End cases                          */

     1809    17786
     1810    17787        /* Call the handler admin routine */
     1811    17788    4                       IF HOP ~= %KHA_FNC_NON
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:227  

  17788   1 0003E9  E847 0060                            LDR,R6   HOP,AUTO
          1 0003EB  6901 002E                            BEZ,R6   s:17803,PREL

     1812    17789    5                       THEN DO;

     1813    17790    5                            ADMIN_FPT.FNC = HOP;

  17790   1 0003ED  EF47 004E                            STR,R6   ADMIN_FPT,AUTO

     1814    17791    5                            ADMIN_FPT.TERMID = TERMID;

  17791   1 0003EF  AB87                                 LAB,B2   ,AUTO
          1 0003F0  2C76                                 LDV,R2   118
          1 0003F1  6C10                                 LDV,R6   16
          1 0003F2  BBC7 004F                            LAB,B3   ADMIN_FPT+1,AUTO
          1 0003F4  3C00                                 LDV,R3   0
          1 0003F5  0008                                 MMM

     1815    17792    5                            ADMIN_FPT.CHN$ = CHN$;

  17792   1 0003F6  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 0003F8  EFC7 0059                            STB,B6   ADMIN_FPT+11,AUTO

     1816    17793    5                            ADMIN_FPT.LIN$ = LIN$;

  17793   1 0003FA  DCC7 004B                            LDB,B5   LIN$,AUTO
          1 0003FC  DFC7 005B                            STB,B5   ADMIN_FPT+13,AUTO

     1817    17794    5                            CALL KH_ADMIN$(ADMIN_FPT)

  17794   1 0003FE  CBC7 004E                            LAB,B4   ADMIN_FPT,AUTO
          1 000400  CFC7 00D2                            STB,B4   KEYIN+3,AUTO
          1 000402  BBC7 00D2                            LAB,B3   KEYIN+3,AUTO
          1 000404  9C80 0000 0000  xsym                 LDB,B1   KH_ADMIN$
          1 000407  CBF0 0100                            LAB,B4   256,IMO
          1 000409  E381                                 LNJ,B6   ,B1
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:228  
          1 00040A       0003                            DC       s:17796,PREL
          1 00040B  0F81 000E                            B        s:17803,PREL

     1818    17795    6                            WHENALTRETURN DO;

     1819    17796    6                                 ERROR = ADMIN_FPT.RESULTS;

  17796   1 00040D  8CC7 005D                            LDI      ADMIN_FPT+15,AUTO
          1 00040F  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 000411  8D06                                 SDI      ,B6

     1820    17797    6                                 KH$CHN.STT = OLD;

  17797   1 000412  D847 0064                            LDR,R5   OLD,AUTO
          1 000414  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 000416  D7C5 0001                            STH,R5   1,B5

     1821    17798    6                                 GOTO ERROR_CHECK;

  17798   1 000418  0F81 00F0                            B        s:17858,PREL

     1822    17799    6                               END;        /* WHENALTRETURN */
     1823    17800    5                          END;             /* IF HOP ~= NON */

     1824    17801
     1825    17802        /* Do any special processing after operation */
     1826    17803    5                       DO CASE (ASOP);

  17803   1 00041A  B847 0062                            LDR,R3   ASOP,AUTO
          1 00041C  3D0E                                 CMV,R3   14
          1 00041D  0281 00C4                            BGE      s:17851,PREL
          1 00041F  A830 0000 0425  01                   LDR,R2   s:17803+11,R3
          1 000422  83A0 0000 0433  01                   JMP      s:17805,R2
          1 000425       00AF                            DC       s:17851,PREL
          1 000426       00AF                            DC       s:17851,PREL
          1 000427       0027                            DC       s:17817,PREL
          1 000428       0007                            DC       s:17809,PREL
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:229  
          1 000429       00AF                            DC       s:17851,PREL
          1 00042A       00AF                            DC       s:17851,PREL
          1 00042B       00AF                            DC       s:17851,PREL
          1 00042C       00AF                            DC       s:17851,PREL
          1 00042D       00AF                            DC       s:17851,PREL
          1 00042E       002E                            DC       s:17820,PREL
          1 00042F       00AF                            DC       s:17851,PREL
          1 000430       0035                            DC       s:17823,PREL
          1 000431       00AF                            DC       s:17851,PREL
          1 000432       0000                            DC       s:17805,PREL

     1827    17804    5                       CASE(%Y#SOP_RSTDED);

     1828    17805    5                          KH$CHN.DED = '0'B;

  17805   1 000433  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 000435  8846 0009                            LBF,'0100'X       9,B6
          1 000437       0100
          1 000438  0F81 00A9                            B        s:17851,PREL

     1829    17806
     1830    17807
     1831    17808    5                       CASE (%Y#SOP_PRT);

     1832    17809    5                          KH$CHN.DWNLOD = '0'B;

  17809   1 00043A  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 00043C  8846 0007                            LBF,'1000'X       7,B6
          1 00043E       1000

     1833    17810    5                          KH$CHN.DED = '0'B;

  17810   1 00043F  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 000441  8846 0009                            LBF,'0100'X       9,B6
          1 000443       0100

     1834    17811    5                          KH$CHN.HAND$ = ADDR(NIL);
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:230  

  17811   1 000444  EB80 0000 0000                       LAB,B6   0
          1 000447  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 000449  EFC5 001E                            STB,B6   30,B5

     1835    17812    5                          KH$CHN.SYSID = 0;

  17812   1 00044B  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 00044D  8746 0006                            CL       6,B6

     1836    17813    5                          CALL GET_CONTROLLER;

  17813   1 00044F  E3C0 00CD                            LNJ,B6   s:0,PREL
          1 000451       0001                            DC       s:17814,PREL

     1837    17814    5                          CTR$->KH$CHN.CCPDWNLD(CTRTYPE) = '0'B;

  17814   1 000452  ECC7 0036                            LDB,B6   CTR$,AUTO
          1 000454  B847 0039                            LDR,R3   CTRTYPE,AUTO
          1 000456  3E19                                 ADV,R3   25
          1 000457  8836                                 LBF      ,B6,R3
          1 000458  0F81 0089                            B        s:17851,PREL

     1838    17815
     1839    17816    5                       CASE (%Y#SOP_ENB);

     1840    17817    5                          KH$CHN.DWNLOD = '1'B;

  17817   1 00045A  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 00045C  8946 0007                            LBT,'1000'X       7,B6
          1 00045E       1000
          1 00045F  0F81 0082                            B        s:17851,PREL

     1841    17818
     1842    17819    5                       CASE (%Y#SOP_SETENBHSTUP);

     1843    17820    5                          KH$CHN.ENBHSTUP = '1'B;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:231  

  17820   1 000461  ECC7 0034                            LDB,B6   CHN$,AUTO
          1 000463  8946 0009                            LBT,'0800'X       9,B6
          1 000465       0800
          1 000466  0F81 007B                            B        s:17851,PREL

     1844    17821
     1845    17822    5                       CASE (%Y#SOP_SNDADM);

     1846    17823    5                          ADMIN = ADMINC;

  17823   1 000468  AB80 0000 0208  00                   LAB,B2   ADMINC
          1 00046B  2C00                                 LDV,R2   0
          1 00046C  6C44                                 LDV,R6   68
          1 00046D  BBC7 00AD                            LAB,B3   ADMIN,AUTO
          1 00046F  3C00                                 LDV,R3   0
          1 000470  0008                                 MMM

     1847    17824    5                          ADMIN.TERMID_LO = KH$CHN.TERMID;

  17824   1 000471  ACC7 0034                            LDB,B2   CHN$,AUTO
          1 000473  2C24                                 LDV,R2   36
          1 000474  6C10                                 LDV,R6   16
          1 000475  BBC7 00BF                            LAB,B3   ADMIN+18,AUTO
          1 000477  3C00                                 LDV,R3   0
          1 000478  0008                                 MMM

     1848    17825    5                          ADMIN.TERMID_HI = KH$CHN.TERMID;

  17825   1 000479  ACC7 0034                            LDB,B2   CHN$,AUTO
          1 00047B  2C24                                 LDV,R2   36
          1 00047C  6C10                                 LDV,R6   16
          1 00047D  BBC7 00C7                            LAB,B3   ADMIN+26,AUTO
          1 00047F  3C00                                 LDV,R3   0
          1 000480  0008                                 MMM

     1849    17826    5                          ADMIN.FNC = OPERATION;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:232  

  17826   1 000481  ECC7 0004                            LDB,B6   @OPERATION,AUTO
          1 000483  E806                                 LDR,R6   ,B6
          1 000484  EF47 00BE                            STR,R6   ADMIN+17,AUTO

     1850    17827    5                          KHA_WRITE.BUF_ = VECTOR(ADMIN);

  17827   1 000486  DBC7 00AD                            LAB,B5   ADMIN,AUTO
          1 000488  DFC7 00D3                            STB,B5   KEYIN+4,AUTO
          1 00048A  5C43                                 LDV,R5   67
          1 00048B  DF47 00D2                            STR,R5   KEYIN+3,AUTO
          1 00048D  ABC7 00D2                            LAB,B2   KEYIN+3,AUTO
          1 00048F  2C00                                 LDV,R2   0
          1 000490  6C06                                 LDV,R6   6
          1 000491  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          1 000494  3C0C                                 LDV,R3   12
          1 000495  0008                                 MMM

     1851    17828    5                          IF KH_FLDWRTS > 0 THEN

  17828   1 000496  E800 0000 0000  xsym                 LDR,R6   KH_FLDWRTS
          1 000499  6A81 0021                            BLEZ,R6  s:17839,PREL

     1852    17829    6                          DO;

     1853    17830    6                               IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0 THEN

  17830   1 00049B  DCC7 000E                            LDB,B5   @NORETRAN,AUTO
          1 00049D  8DD5                                 CMN      B5
          1 00049E  0901 0007                            BE       s:17832,PREL
          1 0004A0  C805                                 LDR,R4   ,B5
          1 0004A1  4901 0004                            BEZ,R4   s:17832,PREL

     1854    17831    6                                    ALTRETURN;

  17831   1 0004A3  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:233  
     1855    17832    6                               CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  17832   1 0004A6  BB80 0000 0001  02                   LAB,B3   +1
          1 0004A9  CBF0 0100                            LAB,B4   256,IMO
          1 0004AB  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          1 0004AE       0003                            DC       s:17834,PREL
          1 0004AF  0F81 0009                            B        s:17837,PREL

     1856    17833    7                               DO;

     1857    17834    7                                    ERROR = ERR_CLKFAILED;

  17834   1 0004B1  8C80 0000 022E  00                   LDI      ERR_CLKFAILED
          1 0004B4  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 0004B6  8D06                                 SDI      ,B6

     1858    17835    7                                    GOTO ERROR_CHECK;

  17835   1 0004B7  0F81 0051                            B        s:17858,PREL

     1859    17836    7                                  END;
     1860    17837    6                             END;

  17837   1 0004B9  0F81 0028                            B        s:17851,PREL

     1861    17838    5                          ELSE
     1862    17839    5                               CALL M$WRITE(KHA_WRITE) WHENALTRETURN

  17839   1 0004BB  BB80 0000 0000  xsym                 LAB,B3   KHA_WRITE
          1 0004BE  B870 1543                            LDR,R3   5443,IMO
          1 0004C0  0001                                 MCL
          1 0004C1       0003                            DC       s:17841,PREL
          1 0004C2  0F81 001F                            B        s:17851,PREL

     1863    17840    6                               DO;

     1864    17841    6                                    IF ADDR(NORETRAN) ~= ADDR(NIL) AND NORETRAN ~= 0
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:234  
             17841                                             THEN

  17841   1 0004C4  ECC7 000E                            LDB,B6   @NORETRAN,AUTO
          1 0004C6  8DD6                                 CMN      B6
          1 0004C7  0901 0007                            BE       s:17844,PREL
          1 0004C9  E806                                 LDR,R6   ,B6
          1 0004CA  6901 0004                            BEZ,R6   s:17844,PREL

     1865    17842    6                                         ALTRETURN;

  17842   1 0004CC  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1866    17843    6                                    ELSE
     1867    17844    6                                         CALL KHA$SETCLK(KHA_WRITE) WHENALTRETURN

  17844   1 0004CF  BB80 0000 0001  02                   LAB,B3   +1
          1 0004D2  CBF0 0100                            LAB,B4   256,IMO
          1 0004D4  E380 0000 0000  xent                 LNJ,B6   KHA$SETCLK
          1 0004D7       0003                            DC       s:17846,PREL
          1 0004D8  0F81 0009                            B        s:17851,PREL

     1868    17845    7                                         DO;

     1869    17846    7                                              ERROR = ERR_CLKFAILED;

  17846   1 0004DA  8C80 0000 022E  00                   LDI      ERR_CLKFAILED
          1 0004DD  ECC7 0006                            LDB,B6   @ERROR,AUTO
          1 0004DF  8D06                                 SDI      ,B6

     1870    17847    7                                              GOTO ERROR_CHECK;

  17847   1 0004E0  0F81 0028                            B        s:17858,PREL

     1871    17848    7                                            END;
     1872    17849    6                                  END;

     1873    17850
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:235  
     1874    17851    5                       END;                /* end cases                          */

  17846   1                              NEXT_CHANNEL    null
     1875    17852
     1876    17853    4   NEXT_CHANNEL:       ;
     1877    17854    4                     END;                  /* DO SUBSUB */

  17854   1 0004E2  8AC7 006C            NEXT_CHANNEL    INC      SUBSUB,AUTO
          1 0004E4  E847 006C                            LDR,R6   SUBSUB,AUTO
          1 0004E6  E947 006E                            CMR,R6   SUBSUBHI,AUTO
          1 0004E8  0381 FC34                            BLE      s:17582,PREL

     1878    17855    3                END;                       /* DO SUB */

  17855   1 0004EA  8AC7 0069                            INC      SUB,AUTO
          1 0004EC  E847 0069                            LDR,R6   SUB,AUTO
          1 0004EE  E947 006B                            CMR,R6   SUBHI,AUTO
          1 0004F0  0381 FC22                            BLE      s:17580,PREL

     1879    17856    2           END;                            /* DO CHAN */

  17856   1 0004F2  8AC7 0066                            INC      CHAN,AUTO
          1 0004F4  E847 0066                            LDR,R6   CHAN,AUTO
          1 0004F6  E947 0068                            CMR,R6   CHANHI,AUTO
          1 0004F8  0381 FC0F                            BLE      s:17578,PREL

     1880    17857             %ENABLE;

  17858   1 0004FA  D847 0011                            LDR,R5   DISABLE_LEVEL,AUTO
          1 0004FC  D947 0010                            CMR,R5   INHIBIT_LEVEL,AUTO
          1 0004FE  0901 0007                            BE       s:17863,PREL

  17860   1 000500  CBF0 0000                            LAB,B4   0,IMO
          1 000502  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 000505       0001                            DC       s:17863,PREL

     1881    17863    1        RETURN;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:236  

  17863   1 000506  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

  17858   1                              ERROR_CHECK     null
     1882    17864
     1883    17865    1   ERROR_CHECK: ;
     1884    17866                 /*N* ERRORLOG */
     1885    17867    1        IF STOP_FLAG

  17867   1 000509  89C7 0065            ERROR_CHECK     CMZ      STOP_FLAG,AUTO
          1 00050B  0881 0010                            BAGE     s:17877,PREL

     1886    17868    2        THEN DO;

     1887    17869                  %ENABLE;

  17870   1 00050D  E847 0011                            LDR,R6   DISABLE_LEVEL,AUTO
          1 00050F  E947 0010                            CMR,R6   INHIBIT_LEVEL,AUTO
          1 000511  0901 0007                            BE       s:17875,PREL

  17872   1 000513  CBF0 0000                            LAB,B4   0,IMO
          1 000515  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 000518       0001                            DC       s:17875,PREL

     1888    17875    2             ALTRETURN;

  17875   1 000519  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1889    17876    2           END;                            /* IF */
     1890    17877    1        GOTO NEXT_CHANNEL;

  17877   1 00051C  0FC6                                 B        s:17851,SPREL

     1891    17878
     1892    17879        %EJECT;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:237  
     1893    17880    1   GET_CONTROLLER: PROC;

  17880   1 00051D  EFC7 00D0            GET_CONTROLLER  STB,B6   KEYIN+1,AUTO

     1894    17881    3        DO SELECT(KH$CHN.DVCID & 'FF00'X);

  17881   1 00051F  DCC7 0034                            LDB,B5   CHN$,AUTO
          1 000521  E845 0002                            LDR,R6   2,B5
          1 000523  E570 FF00                            AND,R6   -256,IMO
          1 000525  E970 2100                            CMR,R6   8448,IMO
          1 000527  0201 003D                            BL       s:17905,PREL
          1 000529  0901 0007                            BE       s:17884,PREL
          1 00052B  E970 2900                            CMR,R6   10496,IMO
          1 00052D  0981 0037                            BNE      s:17905,PREL
          1 00052F  0F81 002E                            B        s:17901,PREL

     1895    17882
     1896    17883    3             SELECT ('2100'X);             /* MLC-8 */

     1897    17884    3             CTRCHN = (TERMID.TERM.CHANNEL/(64*16))*64*16;

  17884   1 000531  E847 003C                            LDR,R6   TERMID+1,AUTO
          1 000533  604A                                 SOR,R6   10
          1 000534  600A                                 SOL,R6   10
          1 000535  EF47 0038                            STR,R6   CTRCHN,AUTO

  17884   1                              SET_CCPTYPE     null
     1898    17885    3   SET_CCPTYPE: ;
     1899    17886    3             IF KH$CHN.ATTR & %G_ATTR_CL_ASYNC

  17886   1 000537  ECC7 0034            SET_CCPTYPE     LDB,B6   CHN$,AUTO
          1 000539  E846 0005                            LDR,R6   5,B6
          1 00053B  E570 8000                            AND,R6   -32768,IMO
          1 00053D  6901 0005                            BEZ,R6   s:17890,PREL

     1900    17887    3             THEN
     1901    17888    3                  CTRTYPE = %KH#CHN_CCPDWNLD_ASYNC;
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:238  

  17888   1 00053F  8747 0039                            CL       CTRTYPE,AUTO
          1 000541  0F81 002A                            B        s:17909,PREL

     1902    17889    3             ELSE
     1903    17890    3                  IF KH$CHN.ATTR & %G_ATTR_CL_SYNC

  17890   1 000543  E846 0005                            LDR,R6   5,B6
          1 000545  E570 1000                            AND,R6   4096,IMO
          1 000547  6901 0006                            BEZ,R6   s:17894,PREL

     1904    17891    3                  THEN
     1905    17892    3                       CTRTYPE=%KH#CHN_CCPDWNLD_SYNC;

  17892   1 000549  6C01                                 LDV,R6   1
          1 00054A  EF47 0039                            STR,R6   CTRTYPE,AUTO
          1 00054C  0F81 001F                            B        s:17909,PREL

     1906    17893    3                  ELSE
     1907    17894    3                       IF KH$CHN.ATTR & %G_ATTR_CL_HDLC

  17894   1 00054E  E846 0005                            LDR,R6   5,B6
          1 000550  E570 2000                            AND,R6   8192,IMO
          1 000552  6901 0006                            BEZ,R6   s:17898,PREL

     1908    17895    3                       THEN
     1909    17896    3                            CTRTYPE=%KH#CHN_CCPDWNLD_HDLC;

  17896   1 000554  6C02                                 LDV,R6   2
          1 000555  EF47 0039                            STR,R6   CTRTYPE,AUTO
          1 000557  0F81 0014                            B        s:17909,PREL

     1910    17897    3                       ELSE
     1911    17898    3                            CTRTYPE=%KH#CHN_CCPDWNLD_OTHER;

  17898   1 000559  6C03                                 LDV,R6   3
          1 00055A  EF47 0039                            STR,R6   CTRTYPE,AUTO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:239  
          1 00055C  0F81 000F                            B        s:17909,PREL

     1912    17899
     1913    17900    3             SELECT ('2900'X);

     1914    17901    3             CTRCHN = (TERMID.TERM.CHANNEL/(64*32))*64*32;

  17901   1 00055E  E847 003C                            LDR,R6   TERMID+1,AUTO
          1 000560  604B                                 SOR,R6   11
          1 000561  600B                                 SOL,R6   11
          1 000562  EF47 0038                            STR,R6   CTRCHN,AUTO

     1915    17902    3             GOTO SET_CCPTYPE;

  17902   1 000564  0FD3                                 B        s:17884,SPREL

     1916    17903
     1917    17904    3             SELECT (ELSE);

     1918    17905    3        CTRCHN = TERMID.TERM.CHANNEL;

  17905   1 000565  E847 003C                            LDR,R6   TERMID+1,AUTO
          1 000567  EF47 0038                            STR,R6   CTRCHN,AUTO

     1919    17906    3        CTRTYPE=%KH#CHN_CCPDWNLD_OTHER;

  17906   1 000569  5C03                                 LDV,R5   3
          1 00056A  DF47 0039                            STR,R5   CTRTYPE,AUTO

     1920    17907
     1921    17908    3           END;

     1922    17909    2        CTR$ = PINCRW(KH_CHNLOW$,CTRCHN/128*SIZEW(KH$CHN));

  17909   1 00056C  E847 0038                            LDR,R6   CTRCHN,AUTO
          1 00056E  6047                                 SOR,R6   7
          1 00056F  F856                                 LDR,R7   R6
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:240  
          1 000570  6C00                                 LDV,R6   0
          1 000571  7085                                 DOL,R7   5
          1 000572  8400 0000 0000  xsym                 AID      KH_CHNLOW$
          1 000575  8D47 0036                            SDI      CTR$,AUTO

     1923    17910
     1924    17911    2        RETURN;

  17911   1 000577  ECC7 00D0                            LDB,B6   KEYIN+1,AUTO
          1 000579  C3C6 0001                            LNJ,B4   1,B6
     1925    17912
     1926    17913    2   END GET_CONTROLLER;
     1927    17914    1   END KHA$DVCADM;

PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:241  
--  Include file information  --

   B_ERRORS_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KHA$DVCADM.
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:242  

 **** Variables and constants ****

  ****  Section 000 RoData KHA$DVCADM

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

   208-0-0/w STRC(544)   r     1 ADMINC                   22A-0-0/w STRC(32)    r     1 ERR_BADCHN
   22E-0-0/w STRC(32)    r     1 ERR_CLKFAILED            230-0-0/w STRC(32)    r     1 ERR_DEDCHN
   22C-0-0/w STRC(32)    r     1 ERR_ILGLTRANS            200-0-0/c STRC(128)   r     1 TERMID_C
   1A4-0-0/w PTR         r     1 TRANS_TABLE$(0:29)
   19C-0-0/c STRC(121)   r     1 TRAN_ACTIVE               D8-0-0/c STRC(249)   r     1 TRAN_BLDLINPRO
    F8-0-0/c STRC(249)   r     1 TRAN_CNCRQSLINPRO         9C-0-0/c STRC(377)   r     1 TRAN_CONFIG
    94-0-0/c STRC(121)   r     1 TRAN_CONNECT               0-0-0/c STRC(505)   r     1 TRAN_DISABLE
    70-0-0/c STRC(249)   r     1 TRAN_DISCONNECT_EVT       80-0-0/c STRC(313)   r     1 TRAN_DISCONNECT_RQS
   108-0-0/c STRC(697)   r     1 TRAN_DVCERR              134-0-0/c STRC(697)   r     1 TRAN_DVCERRRSP
    20-0-0/c STRC(377)   r     1 TRAN_ENABLE              160-0-0/c STRC(633)   r     1 TRAN_HOSTDOWN
   188-0-0/c STRC(313)   r     1 TRAN_HOSTUP               58-0-0/c STRC(377)   r     1 TRAN_INTDVC
    38-0-0/c STRC(505)   r     1 TRAN_KILL                 B4-0-0/c STRC(185)   r     1 TRAN_PARTITION
    C0-0-0/c STRC(121)   r     1 TRAN_RETURN               E8-0-0/c STRC(249)   r     1 TRAN_RQSLINPRO
    C8-0-0/c STRC(249)   r     1 TRAN_SGNRJC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     C-0-0/w PTR         r     1 @DATAVEC                   6-0-0/w PTR         r     1 @ERROR
     E-0-0/w PTR         r     1 @NORETRAN                  4-0-0/w PTR         r     1 @OPERATION
     A-0-0/w PTR         r     1 @TERMHI                    8-0-0/w PTR         r     1 @TERMLO
    AD-0-0/w STRC(544)   r     1 ADMIN                     4E-0-0/w STRC(288)   r     1 ADMIN_FPT
    62-0-0/w UBIN(16)    r     1 ASOP                      61-0-0/w UBIN(16)    r     1 BSOP
    66-0-0/w UBIN(16)    r     1 CHAN                      68-0-0/w UBIN(16)    r     1 CHANHI
    67-0-0/w UBIN(16)    r     1 CHANLO                    34-0-0/w PTR         r     1 CHN$
    36-0-0/w PTR         r     1 CTR$                      38-0-0/w UBIN(16)    r     1 CTRCHN
    39-0-0/w UBIN(16)    r     1 CTRTYPE                   *0-0-0/w VECT        r     1 DATAVEC
    11-0-0/w UBIN(16)    r     1 DISABLE_LEVEL             *0-0-0/w STRC(32)    r     1 ERROR
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:243  
    60-0-0/w UBIN(16)    r     1 HOP                       10-0-0/w UBIN(16)    r     1 INHIBIT_LEVEL
    CF-0-0/w UBIN(16)    r     1 KEYIN                     3A-0-0/w UBIN(16)    r     1 LEV
    4B-0-0/w PTR         r     1 LIN$                      63-0-0/w SBIN(16)    r     1 NEW
    *0-0-0/w UBIN(16)    r     1 NORETRAN                  64-0-0/w UBIN(16)    r     1 OLD
    *0-0-0/w UBIN(16)    r     1 OPERATION                 AB-0-0/w PTR         r     1 RQSPRO$
    6F-0-0/w UBIN(16)    r     1 RQSPRO_BUF(0:59)
    4D-0-0/w UBIN(16)    r     1 SIZE                      65-0-0/b BIT         r     1 STOP_FLAG
    69-0-0/w UBIN(16)    r     1 SUB                       6B-0-0/w UBIN(16)    r     1 SUBHI
    6A-0-0/w UBIN(16)    r     1 SUBLO                     6C-0-0/w UBIN(16)    r     1 SUBSUB
    6E-0-0/w UBIN(16)    r     1 SUBSUBHI                  6D-0-0/w UBIN(16)    r     1 SUBSUBLO
    *0-0-0/w STRC(128)   r     1 TERMHI                    3B-0-0/c STRC(128)   r     1 TERMID
    *0-0-0/w STRC(128)   r     1 TERMLO                    43-0-0/c STRC(128)   r     1 TMP_TERMID
    32-0-0/w PTR         r     1 TRANS$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(288)   r     1 KHA_WRITE                  0-0-0/w EPTR        r     1 KH_ADMIN$
     0-0-0/w PTR         r     1 KH_CHNHI$                  0-0-0/w PTR         r     1 KH_CHNLOW$
     0-0-0/w PTR         r     1 KH_CTLTBL$                 0-0-0/w SBIN(16)    r     1 KH_FLDWRTS
     0-0-0/w UBIN(16)    r     1 KH_INHLVL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(57)    r     1 B$TRANS                    0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w ASTR(216)   r     1 KL_RQSPRO                  0-0-0/w UBIN(16)    r     1 ONEWORD
     0-0-0/c ACHR        r     1 SIGNON


   Procedure KHA$DVCADM requires 1403 words for executable code.
   Procedure KHA$DVCADM requires 216 words of local(AUTO) storage.
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:244  

    No errors detected in file KHA$ADMIN.:E05TSI    .
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:245  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:246  
          MINI XREF LISTING

ADMIN
     16721**DCL     17778<<ASSIGN  17823<<ASSIGN  17827--ASSIGN
ADMIN.FNC
     16787**DCL     17826<<ASSIGN
ADMIN.TERMID_HI
     16836**DCL     17825<<ASSIGN
ADMIN.TERMID_HI.TERM
     16838**DCL     16847--REDEF
ADMIN.TERMID_LO
     16807**DCL     17824<<ASSIGN
ADMIN.TERMID_LO.TERM
     16809**DCL     16818--REDEF
ADMINC
     16560**DCL     17778>>ASSIGN  17823>>ASSIGN
ADMINC.TERMID_HI.TERM
     16677**DCL     16686--REDEF
ADMINC.TERMID_LO.TERM
     16648**DCL     16657--REDEF
ADMIN_FPT
     16188**DCL     17701<>CALL    17794<>CALL
ADMIN_FPT.CHN$
     16315**DCL     17699<<ASSIGN  17792<<ASSIGN
ADMIN_FPT.CTX$
     16244**DCL     17780<<ASSIGN
ADMIN_FPT.FNC
     16189**DCL     17697<<ASSIGN  17790<<ASSIGN
ADMIN_FPT.LIN$
     16319**DCL     17700<<ASSIGN  17793<<ASSIGN
ADMIN_FPT.RESULTS
     16340**DCL     17703>>ASSIGN  17796>>ASSIGN
ADMIN_FPT.TERMID
     16210**DCL     17698<<ASSIGN  17791<<ASSIGN
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:247  
ADMIN_FPT.TERMID.TERM
     16212**DCL     16221--REDEF
ASOP
     16386**DCL     17686<<ASSIGN  17803>>DOCASE
B$TRANS
     16867**DCL     17666--ASSIGN
B$TRANS.ASOP
     16872**DCL     17686>>ASSIGN
B$TRANS.BSOP
     16871**DCL     17685>>ASSIGN
B$TRANS.FLGS
     16873**DCL     17614>>DOCASE
B$TRANS.HOP
     16870**DCL     17684>>ASSIGN
B$TRANS.LAST
     16878**DCL     17611>>DOWHILE
B$TRANS.NEW
     16869**DCL     17674>>IF      17678>>ASSIGN
B$TRANS.OLD
     16868**DCL     17612>>IF      17612>>IF
BSOP
     16385**DCL     17685<<ASSIGN  17690>>DOCASE
CHAN
     16390**DCL     17577<<DOINDEX 17578>>ASSIGN
CHANHI
     16392**DCL     17510<<ASSIGN  17536<<ASSIGN  17551<<ASSIGN  17577>>DOINDEX
CHANLO
     16391**DCL     17509<<ASSIGN  17510>>ASSIGN  17535<<ASSIGN  17550<<ASSIGN  17577>>DOINDEX
CHN.TERMID.TERM
     16039**DCL     16048--REDEF
CHN$
     16079**DCL     16910--IMP-PTR 17583<>CALL    17588>>ASSIGN  17597>>ASSIGN  17617>>IF      17622>>IF
     17627>>IF      17632>>IF      17640>>IF      17647>>IF      17652>>IF      17657>>IF      17687>>ASSIGN
     17694>>IF      17699>>ASSIGN  17704>>ASSIGN  17783>>ASSIGN  17792>>ASSIGN  17797>>ASSIGN  17805>>ASSIGN
     17809>>ASSIGN  17810>>ASSIGN  17811>>ASSIGN  17812>>ASSIGN  17817>>ASSIGN  17820>>ASSIGN  17824>>ASSIGN
     17825>>ASSIGN  17881>>DOSELCT 17886>>IF      17890>>IF      17894>>IF
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:248  
CHN_C.TERMID.TERM
     15915**DCL     15924--REDEF
COMMON
     17557**LABEL   17516--GOTO    17542--GOTO
CTR$
     16080**DCL     17694>>IF      17707>>ASSIGN  17814>>ASSIGN  17909<<ASSIGN
CTRCHN
     16081**DCL     17884<<ASSIGN  17901<<ASSIGN  17905<<ASSIGN  17909>>ASSIGN
CTRTYPE
     16082**DCL     17694>>IF      17707>>ASSIGN  17814>>ASSIGN  17888<<ASSIGN  17892<<ASSIGN  17896<<ASSIGN
     17898<<ASSIGN  17906<<ASSIGN
DATAVEC
     11116**DCL         6--PROC    17518--ENTRY   17544--ENTRY   17717--IF      17718>>ASSIGN  17719>>ASSIGN
     17720>>ASSIGN  17751<>CALL    17753>>ASSIGN  17779>>ASSIGN
DISABLE_LEVEL
     11135**DCL     17505<<ASSIGN  17506<>CALL    17521<<ASSIGN  17522<>CALL    17527>>IF      17547<<ASSIGN
     17548<>CALL    17565>>IF      17603>>IF      17858>>IF      17870>>IF
ERROR
     11026**DCL         6--PROC    17518--ENTRY   17525<<ASSIGN  17544--ENTRY   17560<<ASSIGN  17563<<ASSIGN
     17584<<ASSIGN  17642<<ASSIGN  17645<<ASSIGN  17669>>IF      17670<<ASSIGN  17681<<ASSIGN  17703<<ASSIGN
     17733<<ASSIGN  17745<<ASSIGN  17760<<ASSIGN  17772<<ASSIGN  17796<<ASSIGN  17834<<ASSIGN  17846<<ASSIGN
ERROR_CHECK
     17858**LABEL   17585--GOTO    17671--GOTO    17682--GOTO    17705--GOTO    17734--GOTO    17746--GOTO
     17751--CALLALT 17761--GOTO    17773--GOTO    17798--GOTO    17835--GOTO    17847--GOTO
ERR_BADCHN
     17329**DCL     17525>>ASSIGN  17584>>ASSIGN
ERR_CLKFAILED
     17424**DCL     17733>>ASSIGN  17745>>ASSIGN  17760>>ASSIGN  17772>>ASSIGN  17834>>ASSIGN  17846>>ASSIGN
ERR_DEDCHN
     17470**DCL     17645>>ASSIGN
ERR_ILGLTRANS
     17378**DCL     17563>>ASSIGN  17670>>ASSIGN  17681>>ASSIGN
GET_CONTROLLER
     17880**PROC    17693--CALL    17813--CALL
GOT_TRANS
     17669**LABEL   17619--GOTO    17624--GOTO    17629--GOTO    17634--GOTO    17643--GOTO    17649--GOTO
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:249  
     17654--GOTO    17659--GOTO    17663--GOTO
HOP
     16384**DCL     17684<<ASSIGN  17788>>IF      17790>>ASSIGN
INHIBIT_LEVEL
     11132**DCL     17503<<ASSIGN  17505>>ASSIGN  17519<<ASSIGN  17521>>ASSIGN  17527>>IF      17545<<ASSIGN
     17547>>ASSIGN  17565>>IF      17603>>IF      17858>>IF      17870>>IF
KEYIN
     16850**DCL     17779<<ASSIGN  17780--ASSIGN
KH$CHN
     16910**DCL     17909--ASSIGN
KH$CHN.ATTR
     16943**DCL     17886>>IF      17890>>IF      17894>>IF
KH$CHN.CCPDWNLD
     16931**DCL     17694>>IF      17707<<ASSIGN  17814<<ASSIGN
KH$CHN.CHNBIT0_9
     16917**DCL     17550>>ASSIGN  17551>>ASSIGN
KH$CHN.CTR
     16953**DCL     17632>>IF
KH$CHN.DED
     16970**DCL     17627>>IF      17640>>IF      17805<<ASSIGN  17810<<ASSIGN
KH$CHN.DSBHSTDWN
     16968**DCL     17652>>IF
KH$CHN.DVCID
     16936**DCL     17881>>DOSELCT
KH$CHN.DWNLOD
     16948**DCL     17809<<ASSIGN  17817<<ASSIGN
KH$CHN.ENB
     16953**DCL     17617>>IF
KH$CHN.ENBHSTUP
     16969**DCL     17657>>IF      17783<<ASSIGN  17820<<ASSIGN
KH$CHN.HAND$
     17017**DCL     17811<<ASSIGN
KH$CHN.KLLHSTDWN
     16969**DCL     17647>>IF
KH$CHN.RE_ENB
     16953**DCL     17622>>IF
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:250  
KH$CHN.STT
     16926**DCL     17597>>ASSIGN  17687<<ASSIGN  17704<<ASSIGN  17797<<ASSIGN
KH$CHN.SYSID
     16943**DCL     17812<<ASSIGN
KH$CHN.TERMID
     17004**DCL     17824>>ASSIGN  17825>>ASSIGN
KH$CHN.TERMID.LEV
     17006**DCL     17694>>IF
KH$CHN.TERMID.TERM
     17006**DCL     17015--REDEF
KHA$BLDLINPRO
     11123**DCL-ENT 17751--CALL
KHA$CHK_TRM_RNG
     11121**DCL-ENT 17524--CALL
KHA$GET_CTX_PTR
     11120**DCL-ENT 17583--CALL    17595--CALL
KHA$SETCLK
     11124**DCL-ENT 17731--CALL    17743--CALL    17758--CALL    17770--CALL    17832--CALL    17844--CALL
KHA_WRITE
     16517**DCL     17731<>CALL    17738<>CALL    17743<>CALL    17758<>CALL    17765<>CALL    17770<>CALL
     17832<>CALL    17839<>CALL    17844<>CALL
KHA_WRITE.BUF_
     16519**DCL     17726<<ASSIGN  17753<<ASSIGN  17827<<ASSIGN
KHI$DISABLE
     11129**DCL-ENT 17506--CALL    17522--CALL    17548--CALL
KHI$ENABLE
     11128**DCL-ENT 17529--CALL    17567--CALL    17605--CALL    17860--CALL    17872--CALL
KH_ADMIN$
     16071**DCL     17701>>CALL    17794>>CALL
KH_CHNHI
     16066**DCL     16067--REDEF
KH_CHNHI$
     16066**DCL     17551>>ASSIGN
KH_CHNLOW
     16067**DCL     16068--REDEF
KH_CHNLOW$
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:251  
     16066**DCL     17550>>ASSIGN  17909>>ASSIGN
KH_CTLTBL$
     16073**DCL     17118--IMP-PTR
KH_FLDWRTS
     16075**DCL     17727>>IF      17754>>IF      17828>>IF
KH_INHLVL
     16074**DCL     17503>>ASSIGN  17519>>ASSIGN  17545>>ASSIGN
KL_RQSPRO.FCN
     16417**DCL     17713<<ASSIGN
KL_RQSPRO.LINE_PROFILE
     16423**DCL     17714<<ASSIGN
KL_RQSPRO.SGN.L
     16490**DCL     16498--IMP-SIZ 17718<<ASSIGN  17720>>ASSIGN  17723<<ASSIGN  17724>>ASSIGN
KL_RQSPRO.SGN.TXT
     16498**DCL     17720<<ASSIGN  17724<<ASSIGN
KL_RQSPRO.TERMINAL_ID
     16468**DCL     17715<<ASSIGN
KL_RQSPRO.TERMINAL_ID.TERM
     16470**DCL     16479--REDEF
KL_RQSPRO.TERMINAL_ID.TTYP
     16470**DCL     17716<<ASSIGN
LEV
     16083**DCL     17508<<ASSIGN  17534<<ASSIGN  17556<<ASSIGN  17576>>ASSIGN  17587>>IF
LIN$
     16171**DCL     17588<<ASSIGN  17595<>CALL    17700>>ASSIGN  17793>>ASSIGN
M$WRITE
      4445**DCL-ENT 17738--CALL    17765--CALL    17839--CALL
NEW
     16387**DCL     17676<<ASSIGN  17678<<ASSIGN  17679>>IF      17687>>ASSIGN
NEXT_CHANNEL
     17846**LABEL   17877--GOTO
NORETRAN
     11117**DCL         6--PROC    17518--ENTRY   17544--ENTRY   17729--IF      17729>>IF      17740--IF
     17740>>IF      17756--IF      17756>>IF      17767--IF      17767>>IF      17830--IF      17830>>IF
     17841--IF      17841>>IF
OLD
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:252  
     16388**DCL     17597<<ASSIGN  17612>>IF      17676>>ASSIGN  17704>>ASSIGN  17797>>ASSIGN
ONEWORD
     17099**DCL     17779>>ASSIGN
OPERATION
     11011**DCL         6--PROC    17518--ENTRY   17544--ENTRY   17561>>IF      17599>>ASSIGN  17826>>ASSIGN
RQSPRO$
     16400**DCL     16416--IMP-PTR 17711<<ASSIGN  17713>>ASSIGN  17714>>ASSIGN  17715>>ASSIGN  17716>>ASSIGN
     17718>>ASSIGN  17720>>ASSIGN  17720>>ASSIGN  17723>>ASSIGN  17724>>ASSIGN  17724>>ASSIGN
RQSPRO_BUF
     16399**DCL     17711--ASSIGN  17712<<ASSIGN  17726--ASSIGN
SET_CCPTYPE IN PROCEDURE GET_CONTROLLER
     17884**LABEL   17902--GOTO
SIGNON
     17100**DCL     17720>>ASSIGN
SIZE
     16172**DCL     17100--IMP-SIZ 17719<<ASSIGN  17720>>ASSIGN
STOP_FLAG
     16389**DCL     17515<<ASSIGN  17541<<ASSIGN  17557<<ASSIGN  17867>>IF
SUB
     16393**DCL     17579<<DOINDEX 17580>>ASSIGN
SUBHI
     16395**DCL     17512<<ASSIGN  17538<<ASSIGN  17553<<ASSIGN  17579>>DOINDEX
SUBLO
     16394**DCL     17511<<ASSIGN  17512>>ASSIGN  17537<<ASSIGN  17552<<ASSIGN  17579>>DOINDEX
SUBSUB
     16396**DCL     17581<<DOINDEX 17582>>ASSIGN
SUBSUBHI
     16398**DCL     17514<<ASSIGN  17540<<ASSIGN  17555<<ASSIGN  17581>>DOINDEX
SUBSUBLO
     16397**DCL     17513<<ASSIGN  17514>>ASSIGN  17539<<ASSIGN  17554<<ASSIGN  17581>>DOINDEX
TERMHI
     11101**DCL         6--PROC    17518--ENTRY   17524<>CALL    17544--ENTRY
TERMHI.TERM
     11105**DCL     11114--REDEF
TERMHI.TERM.CHANNEL
     11111**DCL     17536>>ASSIGN
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:253  
TERMHI.TERM.SUBDEVICE
     11111**DCL     17538>>ASSIGN
TERMHI.TERM.SUBSUBDEVICE
     11111**DCL     17540>>ASSIGN
TERMID
     16098**DCL     17572<<ASSIGN  17583<>CALL    17591>>ASSIGN  17698>>ASSIGN  17715>>ASSIGN  17751<>CALL
     17791>>ASSIGN
TERMID.LEV
     16102**DCL     17576<<ASSIGN
TERMID.TERM
     16102**DCL     16111--REDEF
TERMID.TERM.CHANNEL
     16108**DCL     17578<<ASSIGN  17884>>ASSIGN  17901>>ASSIGN  17905>>ASSIGN
TERMID.TERM.SUBDEVICE
     16108**DCL     17580<<ASSIGN
TERMID.TERM.SUBSUBDEVICE
     16108**DCL     17582<<ASSIGN
TERMID.TERM.TERM_NAME
     16111**DCL     17575<<ASSIGN
TERMID_C
     16156**DCL     17572>>ASSIGN
TERMID_C.TERM
     16160**DCL     16169--REDEF
TERMLO
     11072**DCL         6--PROC    17518--ENTRY   17524<>CALL    17544--ENTRY   17573--IF
TERMLO.LEV
     11076**DCL     17508>>ASSIGN  17534>>ASSIGN
TERMLO.TERM
     11076**DCL     11085--REDEF
TERMLO.TERM.CHANNEL
     11082**DCL     17509>>ASSIGN  17535>>ASSIGN
TERMLO.TERM.SUBDEVICE
     11082**DCL     17511>>ASSIGN  17537>>ASSIGN
TERMLO.TERM.SUBSUBDEVICE
     11082**DCL     17513>>ASSIGN  17539>>ASSIGN
TERMLO.TERM.TERM_NAME
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:254  
     11085**DCL     17575>>ASSIGN
TERMLO.TTYP
     11076**DCL     17716>>ASSIGN
TMP_TERMID
     16127**DCL     17591<<ASSIGN  17595<>CALL
TMP_TERMID.LEV
     16131**DCL     17592<<ASSIGN
TMP_TERMID.TERM
     16131**DCL     16140--REDEF
TMP_TERMID.TERM.SUBDEVICE
     16137**DCL     17593<<ASSIGN
TMP_TERMID.TERM.SUBSUBDEVICE
     16137**DCL     17594<<ASSIGN
TRANS$
     16078**DCL     16867--IMP-PTR 17599<<ASSIGN  17600>>IF      17611>>DOWHILE 17612>>IF      17612>>IF
     17614>>DOCASE  17666<<ASSIGN  17666>>ASSIGN  17674>>IF      17678>>ASSIGN  17684>>ASSIGN  17685>>ASSIGN
     17686>>ASSIGN
TRANS_TABLE$
     15770**DCL     17599>>ASSIGN
TRAN_ACTIVE
     15664**DCL     15799--DCLINIT 15800--DCLINIT
TRAN_BLDLINPRO
     13569**DCL     15790--DCLINIT
TRAN_CNCRQSLINPRO
     13915**DCL     15793--DCLINIT
TRAN_CONFIG
     12919**DCL     15788--DCLINIT
TRAN_CONNECT
     12830**DCL     15785--DCLINIT
TRAN_DISABLE
     11246**DCL     15773--DCLINIT
TRAN_DISCONNECT_EVT
     12442**DCL     15783--DCLINIT
TRAN_DISCONNECT_RQS
     12615**DCL     15784--DCLINIT
TRAN_DVCERR
PL6.E3A0      #004=KHA$DVCADM File=KHA$ADMIN.:E05TSI                             WED 07/30/97 00:26 Page:255  
     14088**DCL     15794--DCLINIT
TRAN_DVCERRRSP
     14555**DCL     15795--DCLINIT
TRAN_ENABLE
     11587**DCL     15772--DCLINIT
TRAN_HOSTDOWN
     15022**DCL     15796--DCLINIT
TRAN_HOSTUP
     15448**DCL     15797--DCLINIT
TRAN_INTDVC
     12185**DCL     15787--DCLINIT
TRAN_KILL
     11844**DCL     15774--DCLINIT
TRAN_PARTITION
     13176**DCL     15778--DCLINIT 15779--DCLINIT
TRAN_RETURN
     13307**DCL     15780--DCLINIT
TRAN_RQSLINPRO
     13742**DCL     15789--DCLINIT
TRAN_SGNRJC
     13396**DCL     15792--DCLINIT
