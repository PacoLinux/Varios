VERSION E05

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:1    
        1        1        /*M* FTO$OPNAT contains tape opening routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* THI=1,PLM=3,MCL=10 */
        8        8
        9        9        FTO$OPNAT: PROC(PN$);
       10       10
       11       11        /*F*    NAME: FTO$OPNAT
       12       12                PURPOSE: Contains tape opening routines.
       13       13         ***/
       14       14        /*P*    NAME: FTO$OPNAT
       15       15                PURPOSE: Opens tape DCB.
       16       16                INPUT: PN$ - pointers from FPT_OPEN
       17       17         ***/
       18       18
       19       19         /***
       20       20          *** INCLUDE files:
       21       21          ***/
       22       22
       23       23        %INCLUDE B$JIT_C;
       24      337           %B$JIT0;
       25      426           %U$JIT1X;
       26      429           %M$JIT2;
       27      439           %F$JIT3;
       28      444           %S$JIT4X;
       29      447           %J$JIT5X;
       30      450           %A$JIT6X;
       31      453        %INCLUDE CP_6;
       32     6012        %INCLUDE CP_6_SUBS;
       33     6552        %INCLUDE F$CP6P_C;
       34     6563        %INCLUDE F$CP6V_C;
       35     6789           %FPT$OPEN_V;
       36     6804           %VLP$SN_V;
       37     6807        %MACRO F$DCBBJ(BASED=BASED);
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:2    
       38     6808        %INCLUDE F$DCB;
       39     6857        %MEND;
       40     6858           %F$DCBBJ(BASED="BASED(JDCB$)");
       41     6908        %INCLUDE F_ERRORS_C;
       42     7148        %INCLUDE F_FMTCODE_C;
       43     7182        %INCLUDE F_FPTCODE_C;
       44     7218        %INCLUDE FM_BUF_R;
       45     7227        %INCLUDE FM$CFU;
       46     7272            %FT$CFUSN;
       47     7275           %FM$CFUJ;
       48     7280        %INCLUDE FM$GRAN;
       49     7349            %FM$GRAN;
       50     7353        %INCLUDE FM$FIT;
       51     7574            %FM$FIT;
       52     7577           %CODE02;
       53     7581           %CODE03;
       54     7588           %CODE04;
       55     7596        %CODE16;
       56     7604        %MACRO FT$DDTBD(BASED=BASED);
       57     7605        %INCLUDE FT$DDT;
       58     7666        %MEND;
       59     7667           %FT$DDTBD(BASED="BASED(DDDT$)");
       60     7729        %INCLUDE FT$LBLS;
       61     7997        %INCLUDE FT$RECS;
       62     8065        %INCLUDE FT_SUBS;
       63     8145        %INCLUDE NK$LDCT;
       64     8247            %NK$LDCT;
       65     8293        %INCLUDE NK_LDCT_R;
       66     8302        %INCLUDE XUD_UTS_M;
       67     8384         %XUD$UTS_ENTRIES;
       68     8416         %XUD_UTS_EQU;
       69     8427
       70     8428         /***
       71     8429          *** External routines:
       72     8430          ***/
       73     8431
       74     8432    1   DCL FMD$FLSHBUF ENTRY(1);               /* Flush specified buffer             */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:3    
       75     8433    1   DCL FMD$GETBUF ENTRY(3);                /* Get specified buffer               */
       76     8434    1   DCL FMH$JGETPG ENTRY(1) ALTRET;         /* Get journal page                   */
       77     8435    1   DCL FMN$CHKFLACN ENTRY(1) ALTRET;       /* Verify file name and account       */
       78     8436    1   DCL FMP$CLSERR ENTRY;                   /* Release journal CFUs               */
       79     8437    1   DCL FMO$BLDFIT ENTRY(1) ALTRET;         /* Build a FIT in FPOOL buffer        */
       80     8438    1   DCL FMO$GETDOMAIN ENTRY(1);             /* Get current domain                 */
       81     8439    1   DCL FMO$LOCCODE ENTRY(2) ALTRET;        /* Find FIT information               */
       82     8440    1   DCL FMO$SECCHK ENTRY(2);                /* Security checks                    */
       83     8441    1   DCL FMO$TRNINFO ENTRY(2) ALTRET;        /* Transfer FIT info                  */
       84     8442    1   DCL FMR$G8 ENTRY(2) ALTRET;             /* Get CFU                            */
       85     8443    1   DCL FRA$OPR ENTRY ALTRET;               /* Get tape mounted                   */
       86     8444    1   DCL FRB$CLS ENTRY;                      /* Close tape and release resource    */
       87     8445    1   DCL FRB$CREM ENTRY;                     /* Remove tape                        */
       88     8446    1   DCL FSA$FSP ENTRY(2) ALTRET;            /* Free RO space                      */
       89     8447    1   DCL FSA$GSP ENTRY(2) ALTRET;            /* Get RO space                       */
       90     8448    1   DCL FSF$TAPEFORM ENTRY ALTRET;          /* Set up FORM info for UR/SYMB       */
       91     8449    1   DCL FTC$DFLTCLOSE ENTRY;                /* Default close after test open      */
       92     8450    1   DCL FTI$RDASCEBC ENTRY(1) ALTRET;       /* Read ASCII/EBCDIC label            */
       93     8451    1   DCL FTI$RDBIN ENTRY(1) ALTRET;          /* Read binary record (get FIT)       */
       94     8452    1   DCL FTI$REWIND ENTRY ALTRET;            /* Rewind tape                        */
       95     8453    1   DCL FTI$SPFILE ENTRY ALTRET;            /* Space DCB.ARS files                */
       96     8454    1   DCL FTI$SPREC ENTRY ALTRET;             /* Space DCB.ARS records              */
       97     8455    1   DCL FTI$WRBIN ENTRY(1) ALTRET;          /* Write specified buffer in binary   */
       98     8456    1   DCL FTI$WRFM ENTRY ALTRET;              /* Write file mark                    */
       99     8457    1   DCL FTL$CVOL ENTRY(5) ALTRET;           /* Volume changing                    */
      100     8458    1   DCL FTL$FINDFILE ENTRY ALTRET;          /* Find file by name and section      */
      101     8459    1   DCL FTL$FINDHDR1 ENTRY ALTRET;          /* Find next HDR1                     */
      102     8460    1   DCL FTL$FINDNEXT ENTRY ALTRET;          /* Find next file, ignore FSN.        */
      103     8461    1   DCL FTL$FINDSEQ ENTRY ALTRET;           /* Find file by sequence and section  */
      104     8462    1   DCL FTL$FINDSEQIBM ENTRY ALTRET;        /* Find file by sequence, IBM tapes   */
      105     8463    1   DCL FTL$GETFSN ENTRY ALTRET;            /* Get file sequence number from tape */
      106     8464    1   DCL FTL$GETULBLS ENTRY(3) ALTRET;       /* Get user labels                    */
      107     8465    1   DCL FTL$LBLS ENTRY(2) ALTRET;           /* Write specified label (HDR)        */
      108     8466    1   DCL FTL$PEOS ENTRY ALTRET;              /* Position to end of volume set      */
      109     8467    1   DCL FTL$SPF ENTRY(1) ALTRET;            /* Position to next beginning-of-file */
      110     8468    1   DCL FTL$ULBLS ENTRY(3) ALTRET;          /* Write user labels                  */
      111     8469    1   DCL FTL$VOL1 ENTRY ALTRET;              /* Write VOL1 label                   */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:4    
      112     8470    1   DCL FTR$CHNGVOL ENTRY(1) ALTRET;        /* Change to specified volume of set  */
      113     8471    1   DCL FTR$DPT ENTRY ALTRET;               /* Density, permit, type check/set    */
      114     8472    1   DCL FTR$RELCFUS ENTRY ALTRET;           /* Release CFUs                       */
      115     8473    1   DCL FTR$RELFPOOLS ENTRY ALTRET;         /* Release all FPOOL buffers          */
      116     8474    1   DCL FTR$SETSN ENTRY(2) ALTRET;          /* Set actual serial number           */
      117     8475    1   DCL FTW$WRAT ENTRY(3) ALTRET;
      118     8476    1   DCL HFF$DSIZ ENTRY(2) ALTRET;           /* Determine segment size             */
      119     8477    1   DCL SSS$SYSTIME ENTRY(1);               /* Get UTS                            */
      120     8478    1   DCL UMT$JDATE ENTRY(2) ALTRET;          /* Convert UTS to Julian date         */
      121     8479    1   DCL UMT$UTSJ ENTRY(2) ALTRET;           /* Converts Julian date to UTS        */
      122     8480    1   DCL UQB$MDEQ ENTRY(1) ALTRET;           /* Dequeue journal                    */
      123     8481
      124     8482         /***
      125     8483          *** SYMREF data:
      126     8484          ***/
      127     8485
      128     8486    1   DCL B$JIT$ PTR SYMREF;
      129     8487    1   DCL B_TICSDAY UBIN SYMREF;              /* Number of tics per day             */
      130     8488    1   DCL FT_PROT SBIN SYMREF;                /* System protection type             */
      131     8489
      132     8490         /***
      133     8491          *** Parameter:
      134     8492          ***/
      135     8493
      136     8494           %FPT$OPEN_P(FPTN=PN$,PFMT=PTR,STCLASS=" ");
      137     8500
      138     8501         /***
      139     8502          *** BASED:
      140     8503          ***/
      141     8504
      142     8505    1   DCL 1 LASTKEY UNAL BASED,
      143     8506    1         2 * CHAR(256) UNAL;
      144     8507    1   DCL 1 FOUR_SNS UNAL BASED,
      145     8508    1         2 * UBIN WORD UNAL,
      146     8509    1         2 SNS CHAR(24) UNAL;
      147     8510
      148     8511         /***
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:5    
      149     8512          *** AUTO data:
      150     8513          ***/
      151     8514
      152     8515    1   DCL AFPOOL$ PTR AUTO;                   /* Pointer to FPOOL buffer            */
      153     8516    1   DCL ALABEL CHAR(3) AUTO;                /* Temporary for tape label.          */
      154     8517    1   DCL BACKUP_FM_CNT SBIN AUTO;            /* Number of file marks to back up    */
      155     8518    1   DCL CREATED_BY_CP6 BIT(1) AUTO;         /* Remembers HDR1 info                */
      156     8519    1   DCL CREATE_DATE_UTS UBIN AUTO;          /* Creation date UTS                  */
      157     8520    1   DCL CREATE_OLDFILE BIT(1) AUTO;    /* FUN=CREATE,EXIST=OLDFILE file exists    */
      158     8521    1   DCL DDDT$ PTR AUTO;                /* Pointer to DDT entry for DCB's device   */
      159     8522        %VLP_ERRCODE(FPTN=ERRSAV,STCLASS=AUTO); /* To save B$JIT.ERR                  */
      160     8567    1   DCL I SBIN AUTO;                        /* Used as temp and index             */
      161     8568    1   DCL J SBIN AUTO;                        /* Used as temp and index             */
      162     8569    1   DCL JDCB$ PTR AUTO;                     /* Pointer to DCB                     */
      163     8570    1   DCL 1 JDCB REDEF JDCB$,
      164     8571    1         2 DCBX UBIN HALF UNAL,            /* Index of DCB                       */
      165     8572    1         2 * UBIN HALF UNAL;
      166     8573    1   DCL MAXBLKL SBIN WORD AUTO;             /* Max possible BLKL                  */
      167     8574    1   DCL NO_IFPARAM_RESTRICT BIT(1) AUTO;    /* Indicates FITless RESTRICT file    */
      168     8575    1   DCL FILE_NAME CHAR(31) ALIGNED AUTO;    /* Name of current file on tape       */
      169     8576    1   DCL FILE_SEQ SBIN ALIGNED AUTO;    /* Sequence number of current file on tape */
      170     8577    1   DCL TEMP$ PTR AUTO;                     /* A useful item                      */
      171     8578
      172     8579         /***
      173     8580          *** CONSTANT data:
      174     8581          ***/
      175     8582
      176     8583        %EQU FT_MAXDENS = 6 ;
      177     8584    1   DCL FT_DENS(0:%%FT_MAXDENS) BIT(18) CONSTANT SYMDEF INIT(
              8584            /* Bits correspond to DCB.ATTR */
      178     8585    1                 '0'O,                     /* Unspecified                        */
      179     8586    1                 '0'O,                     /* No longer specified (7T)           */
      180     8587    1                 %ATTR_D800#,
      181     8588    1                 %ATTR_D1600#,
      182     8589    1                 %ATTR_D6250#,
      183     8590    1                 %ATTR_D38000#,
      184     8591    1                 '0'O );                   /* Unknown                            */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:6    
      185     8592
      186     8593        %EQU FT_MAXFMTS=4;
      187     8594    1   DCL FT_FORMAT(0:%FT_MAXFMTS) UBIN BYTE UNAL CONSTANT INIT(
      188     8595    1      ASCBIN('D'),
      189     8596    1      ASCBIN('S'),
      190     8597    1      ASCBIN('V'),
      191     8598    1      ASCBIN('F'),
      192     8599    1      ASCBIN('U') );
      193     8600                                      /* Known basic tape formats...U must be last    */
      194     8601        %EQU FT_MAXCP6FMT=10;
      195     8602    1   DCL FT_CP6FMT(0:%FT_MAXCP6FMT) UBIN BYTE UNAL CONSTANT INIT(
      196     8603    1      ASCBIN('C'),
      197     8604    1      ASCBIN('K'),
      198     8605    1      ASCBIN('R'),
      199     8606    1      ASCBIN('X'),
      200     8607    1      ASCBIN('x'),
      201     8608    1      ASCBIN('F'),
      202     8609    1      ASCBIN('I'),
      203     8610    1      ASCBIN('D'),
      204     8611    1      ASCBIN('U'),
      205     8612    1      ASCBIN('S'),
      206     8613    1      ASCBIN('i') );
      207     8614    1   DCL FT_CP6FMTORG(0:%FT_MAXCP6FMT) UBIN BYTE UNAL CONSTANT INIT(
      208     8615    1      %CONSEC#,
      209     8616    1      %KEYED#,
      210     8617    1      %RANDOM#,
      211     8618    1      %RESTRICT#,
      212     8619    1      %RESTRICT#,
      213     8620    1      %RELATIVE#,
      214     8621    1      %INDEXED#,
      215     8622    1      %IDS#,
      216     8623    1      %UR#,
      217     8624    1      %SYMB#,
      218     8625    1      %IREL# );
      219     8626
      220     8627        %FPT_PFIL(FPTN=FPT_PFIL_EOF,BOF=NO,STCLASS=CONSTANT);
      221     8642
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:7    
      222     8643        %FT$ERR( ERRNAME=E_ASCIITAP, MID='17'O, CODE=%E$ASCIITAP, SEV=2 );
      223     8651        /*E*    ERROR: FTO-E$ASCIITAP-2
      224     8652                 MESSAGE: You can't create an EBCDIC tape file on an ASCII
      225     8653                    volume set% (LT#%SN)%
      226     8654                DESCRIPTION: The user attempted to write an EBCDIC format file
      227     8655                   to an ASCII tape.
      228     8656         ***/
      229     8657
      230     8658        %FT$ERR( ERRNAME=E_BADFSN, MID='17'O, CODE=%E$BADFSN, SEV=2 );
      231     8666        /*E*     ERROR: FTO-E$BADFSN-2
      232     8667                 MESSAGE: FSN > 9999% for %TA%
      233     8668                 MESSAGE1: You can't create a tape file with file sequence
      234     8669                           number greater than 9999.
      235     8670                 DESCRIPTION: Obvious.
      236     8671         ***/
      237     8672
      238     8673        %FT$ERR( ERRNAME=E_BOT, MID='17'O, CODE=%E$BOT, SEV=2 );
      239     8681        /*E*     ERROR: FTO-E$BOT-2
      240     8682                 MESSAGE: Beginning of tape% on %TA%
      241     8683                 MESSAGE1: The beginning of tape was encountered on a
      242     8684                           backspace record or backspace file operation.
      243     8685         ***/
      244     8686
      245     8687        %FT$ERR( ERRNAME=E_BRDUPSN, MID='17'O, CODE=%E$BRDUPSN, SEV=2 );
      246     8695        /*E*     ERROR: FTO-E$BRDUPSN-2
      247     8696                 MESSAGE: Blank or duplicate serial number% on DCB %DC%
      248     8697                 MESSAGE1: The serial number list contains either a blank
      249     8698                    serial number between non-blank serial numbers or a
      250     8699                    serial number that is duplicated% on DCB %DC%.
      251     8700         ***/
      252     8701
      253     8702        %FT$ERR( ERRNAME=E_BLKL, MID='17'O, CODE=%E$BLKL, SEV=2 );
      254     8710        /*E*     ERROR: FTO-E$BLKL-2
      255     8711                 MESSAGE: F$DCB.BLKL too large
      256     8712                 MESSAGE1: Due to the 9-to-8 conversion BLKL would be too large.
      257     8713         ***/
      258     8714
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:8    
      259     8715        %FT$ERR( ERRNAME=E_EBCDICTAP, MID='17'O, CODE=%E$EBCDICTAP, SEV=2 );
      260     8723        /*E*     ERROR: FTO-E$EBCDICTAP-2
      261     8724                 MESSAGE: You can't create an ASCII tape file on an EBCDIC
      262     8725                    volume set% (LT#%SN)%
      263     8726                 DESCRIPTION: The user attempted to write an ASCII format file
      264     8727                   to an EBCDIC tape.
      265     8728         ***/
      266     8729
      267     8730        %FT$ERR( ERRNAME=E_EOSET, MID='17'O, CODE=%E$EOSET, SEV=2 );
      268     8738        /*E*     ERROR: FTO-E$EOSET-2
      269     8739                 MESSAGE: Beginning/end of volume set% looking for %TA%
      270     8740                 MESSAGE1: On an open NXTF the beginning or end of set
      271     8741                    was detected% on LT#%SN% looking for %TA%
      272     8742         ***/
      273     8743
      274     8744        %FT$ERR( ERRNAME=E_FUNNYPOS, MID='17'O, CODE=%E$FUNNYPOS, SEV=2 );
      275     8752        /*E*     ERROR: FTO-E$FUNNYPOS-2
      276     8753                 MESSAGE: Improper position% on %TA%
      277     8754                 MESSAGE1: Tape volume is not positioned for creating a new file.
      278     8755                 DESCRIPTION: The tape is positioned after an EOV label group
      279     8756                    or position is unknown.
      280     8757         ***/
      281     8758
      282     8759        %FT$ERR( ERRNAME=E_NOACCESS, MID='17'O, CODE=%E$NOACCESS, SEV=2 );
      283     8767        /*E*     ERROR: FTO-E$NOACCESS-2
      284     8768                 MESSAGE: Access denied% to %TA%% through DCB %DC%
      285     8769                 DESCRIPTION: Attempt to open a file to which access is denied.
      286     8770         ***/
      287     8771
      288     8772        %FT$ERR( ERRNAME=E_NOCFUS, MID='17'O, CODE=%E$NOCFUS, SEV=2 );
      289     8780        /*E*     ERROR: FTO-E$NOCFUS
      290     8781                 MESSAGE: No system table space for SN list% for %TA%
      291     8782                 MESSAGE1: There is no CFU space for a serial number table.
      292     8783                 DESCRIPTION: There is not enough CFU space to hold the user's
      293     8784                    serial number list.
      294     8785         ***/
      295     8786
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:9    
      296     8787        %FT$ERR( ERRNAME=E_NOIFPARAM, MID='17'O, CODE=%E$NOIFPARAM, SEV=2 );
      297     8795        /*E*     ERROR: FTO-E$NOIFPARAM
      298     8796                 MESSAGE: No IFPARAM specified% for %TA%
      299     8797                 MESSAGE1: Restrict tape files must have IFPARAM specified
      300     8798                           for creation.
      301     8799                 DESCRIPTION: An attempt to open a RESTRICT tape file in
      302     8800                    CREATE mode without having an IFPARAM buffer was made.
      303     8801         ***/
      304     8802
      305     8803        %FT$ERR( ERRNAME=E_NOFIDTHIS, MID='17'O, CODE=%E$NOFIDTHIS, SEV=2 );
      306     8811        /*E*     ERROR: FTO-E$NOFIDTHIS-2
      307     8812                 MESSAGE: No file specified% on DCB %DC%
      308     8813                 MESSAGE1: No file name or file sequence number is specified.
      309     8814                 DESCRIPTION: An attempt to open an input or update tape file
      310     8815                    with no name was specified.
      311     8816         ***/
      312     8817
      313     8818        %FT$ERR( ERRNAME=E_NOFPOOL, MID='17'O, CODE=%E$NOFPOOL, SEV=2 );
      314     8826        /*E*     ERROR: FTO-E$NOFPOOL-2
      315     8827                 MESSAGE: Not enough FPOOLs% for %TA%
      316     8828                 MESSAGE1: FPOOL limit does not permit label processing and
      317     8829                    file blocking/deblocking.
      318     8830         ***/
      319     8831
      320     8832        %FT$ERR( ERRNAME=E_NORESTRICT, MID='17'O, CODE=%E$NORESTRICT, SEV=2 );
      321     8840        /*E*     ERROR: FTO-E$NORESTRICT-2
      322     8841                 MESSAGE: No access to RESTRICT format files allowed% on DCB %DC%
      323     8842                 MESSAGE1: FMBLK privilege is needed to access RESTRICT
      324     8843                    format tape files.
      325     8844         ***/
      326     8845
      327     8846        %FT$ERR( ERRNAME=E_NOSN, MID='17'O, CODE=%E$NOSN, SEV=2 );
      328     8854        /*E*     ERROR: FTO-E$NOSN-2
      329     8855                 MESSAGE: No SN specified% on DCB %DC%
      330     8856                 MESSAGE1: An attempt to open an input or update volume with
      331     8857                    no serial number specified was made.
      332     8858         ***/
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:10   
      333     8859
      334     8860        %FT$ERR( ERRNAME=E_NOTFREEORG, MID='17'O, CODE=%E$NOTFREEORG, SEV=2 );
      335     8868        /*E*     ERROR: FTO-E$NOTFREEORG-2
      336     8869                 MESSAGE: ORG not valid for managed tape% on DCB %DC%
      337     8870                 MESSAGE1: Only FREE, UNDEF, FIXED, and VARIABLE are permitted
      338     8871                    for managed free tape organizations.
      339     8872         ***/
      340     8873
      341     8874        %FT$ERR( ERRNAME=E_SCRORDER, MID='17'O, CODE=%E$SCRORDER, SEV=2 );
      342     8882        /*E*     ERROR: FTO-E$SCRORDER-2
      343     8883                 MESSAGE: Out of order ANSscratch volume% on DCB %DC%
      344     8884                 MESSAGE1: ANSscratch tapes can not be CVOLed to unless
      345     8885                           at beginning of volume set.
      346     8886                 DESCRIPTION: Attempt to open a scratch tape not at set beginning.
      347     8887                    This error helps to enforce ANS FSN field in HDR1 by ensuring
      348     8888                    that the correct FSN is always known.
      349     8889         ***/
      350     8890        %FT$ERR( ERRNAME=E_VOLERR, MID='17'O, CODE=%E$VOLERR, SEV=2 );
      351     8898        /*E*    ERROR: FTO-E$VOLERR-2
      352     8899                 MESSAGE: Specified VOL not in SN list% on DCB %DC%
      353     8900                 MESSAGE1: DCB.VOL specifies a volume not contained in the
      354     8901                           serial number list.
      355     8902                DESCRIPTION: DCB.VOL was greater than 1 and no serial number
      356     8903                   list was specified or DCB.VOL specified a serial number not
      357     8904                   contained within the list.
      358     8905         ***/
      359     8906        %FT$ERR( ERRNAME=E_WRONGSN , MID='17'O, CODE=%E$WRONGSN, SEV=2 );
      360     8914        /*E*    ERROR: FTO-E$WRONGSN-2
      361     8915                MESSAGE: End of volume set% on %TA%. Tape is empty.
      362     8916                MESSAGE1: The operator mounted a tape with a serial number
      363     8917                          different from the one in VOL1. This tape will be
      364     8918                          treated as an empty tape.
      365     8919
      366     8920         ***/
      367     8921        %FT$ERR( ERRNAME=E_WRONGDENSITY , MID='17'O, CODE=%E$WRONGDENSITY, SEV=2 );
      368     8929        /*E*    ERROR: FTO-E$WRONGDENSITY-2
      369     8930                MESSAGE: The tape density is different from the drive density.
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:11   
      370     8931         ***/
      371     8932        %FT$ERR( ERRNAME=E_NOFILE ,MID='14'O, CODE=%E$NOFILE , SEV=2 );
      372     8940
      373     8941        /********************/
      374     8942
      375     8943         /***
      376     8944          *** Get pointer to DCB; initialize for open.
      377     8945          ***/
      378     8946
      379     8947    1      JDCB$ = B$JIT.DCB$;                  /* Get pointer to DCB                 */
      380     8948    1      IF F$DCB.ACS = %JRNL#
      381     8949    1       THEN IF F$DCB.OWNER
      382     8950    1          THEN F$DCB.CFU$->FM$CFUJ.SNLINKX = 0; /* No SN list yet                */
      383     8951    1          ELSE ;
      384     8952    1       ELSE F$DCB.CFU$ = ADDR(NIL);        /* Assume only one vol in set         */
      385     8953
      386     8954         /***
      387     8955          *** Determine values for odd specifications.
      388     8956          ***/
      389     8957
      390     8958    1      IF F$DCB.DENSITY > %FT_MAXDENS THEN F$DCB.DENSITY = 0; /* Use default      */
      391     8959
      392     8960    1      F$DCB.OLDIOERR = 0;                  /* No I/O errors yet hit on this file */
      393     8961
      394     8962         /***
      395     8963          *** Open tape according to type and function.  7-track tape can only
      396     8964          *** be opened ASN=DEVICE and ORG=FREE.
      397     8965          ***/
      398     8966
      399     8967    1      F$DCB.IFMT = FMTTAPE#;
      400     8968    1      CREATE_OLDFILE = %NO#;
      401     8969    1      IF F$DCB.ACS ~= %JRNL#
      402     8970    1       THEN IF F$DCB.ORG = %RESTRICT# AND F$DCB.FUN = %CREATE#
      403     8971    1          THEN F$DCB.ACS = %BLOCK#;
      404     8972    1          ELSE F$DCB.ACS = %SEQUEN#;       /* No DIRECT use of tape              */
      405     8973    1      IF F$DCB.ASN = %DEVICE# OR PN$.V_->FPT$OPEN_V.OPER.MNTONLY
      406     8974    1       THEN CALL FTO_OPNDEV ALTRET(FREEPOOLS);
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:12   
      407     8975    2       ELSE DO;
      408     8976    2         IF F$DCB.ACS = %JRNL#
      409     8977    2          THEN CALL FTO_OPNJRNL ALTRET(FREEPOOLS);
      410     8978    3          ELSE DO;
      411     8979    4            DO CASE(F$DCB.FUN);
      412     8980    4             CASE(%CREATE#);               /* Create                             */
      413     8981    4               IF F$DCB.EXIST = %OLDFILE#
      414     8982    5                THEN DO;         /* File must be extended if it exists already   */
      415     8983    5                  CALL FTO_OPNEXISTING ALTRET(CHKERR);
      416     8984    5                  CREATE_OLDFILE = %YES#;
      417     8985    6                  DO WHILE('0'B);
      418     8986    6   CHKERR:           ;
      419     8987    6                     IF B$JIT.ERR.CODE ~= %E$NOFILE
      420     8988    6                      THEN GOTO FREEPOOLS; /* Unexpected error                   */
      421     8989    6                     CALL FTO_OPNCREATE ALTRET(FREEPOOLS);
      422     8990    6                     END;
      423     8991    5                  END;
      424     8992    4                ELSE CALL FTO_OPNCREATE ALTRET(FREEPOOLS);
      425     8993    4             CASE(%IN#,%UPDATE#);          /* Input and update                   */
      426     8994    4               CALL FTO_OPNEXISTING ALTRET(FREEPOOLS);
      427     8995    4             END;
      428     8996
      429     8997    4            DO CASE(F$DCB.FUN);
      430     8998    4             CASE(%CREATE#,%UPDATE#); /* Need RO space for last key if keyed,sequen */
      431     8999    4               IF F$DCB.ORG = %KEYED# OR F$DCB.ORG = %INDEXED#
      432     9000    4                THEN IF F$DCB.ACS = %SEQUEN#
      433     9001    5                   THEN DO;                /* Get RO space for key               */
      434     9002    5                     CALL FSA$GSP(64,F$DCB.LASTKEY$) ALTRET(FREEPOOLS);
      435     9003    5                     F$DCB.TAPTYP.HAVLASTKEY = %NO#;
      436     9004    5                     END;
      437     9005    4                   ELSE ;
      438     9006    4                ELSE IF F$DCB.ORG = %RELATIVE#
      439     9007    4                   THEN F$DCB.LASTKEY = 0;
      440     9008    4                   ELSE F$DCB.LASTKEY = -1;
      441     9009    4             CASE(ELSE);
      442     9010    4               F$DCB.LASTKEY = 0;
      443     9011    4             END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:13   
      444     9012    3            END;
      445     9013    2         END;
      446     9014
      447     9015         /***
      448     9016          *** Initialize to read/write first record of file.
      449     9017          ***/
      450     9018
      451     9019    1      F$DCB.AFTRBLK = %NO#;                /* Positioned before                  */
      452     9020    1      F$DCB.PRECNO = 1;                    /* First block                        */
      453     9021    1      F$DCB.RPOS = %YES#;                  /* Positioned to                      */
      454     9022    1      F$DCB.CRECNO = 1;                    /* First record                       */
      455     9023    1      F$DCB.CRECX = F$DCB.BOL;             /* First record is just after BOL     */
      456     9024    1      F$DCB.SPAN = %NO#;                   /* Expect next record to begin span   */
      457     9025    1      F$DCB.NRECX = 1;                     /* First of block                     */
      458     9026    1      F$DCB.CONT = %NO#;                   /* No previous continuation           */
      459     9027    1      F$DCB.GDISP = 0;                     /* Nothing read/written yet           */
      460     9028    1      F$DCB.BLKLEN = F$DCB.BOL;            /* Block length includes header       */
      461     9029    1      F$DCB.CBUFNUM = 0;                   /* No current buffer                  */
      462     9030    1      F$DCB.NEW_FSECT = %YES#;
      463     9031    1      F$DCB.TRNC = FT_EBTRUNC#;       /* Fake empty buffer trunc to get buffer   */
      464     9032    1      F$DCB.TAPTYP.PASTFM = %NO#;          /* Not after file mark                */
      465     9033
      466     9034    1      IF F$DCB.ACS = %JRNL# AND NOT F$DCB.OWNER
      467     9035    1       THEN ;
      468     9036    1       ELSE FT$DDT.POS = FTP_BOD#;         /* In data                            */
      469     9037    1      F$DCB.MEDIA = FMTTAPE#;              /* Tape, of course                    */
      470     9038    1      F$DCB.IASN = %TAPE#;
      471     9039
      472     9040    1      IF F$DCB.ACS = %JRNL#
      473     9041    2       THEN DO;                            /* Finish CFU initialization          */
      474     9042    2         IF F$DCB.OWNER
      475     9043    3          THEN DO;
      476     9044    3            F$DCB.CFU$->FM$CFUJ.PRECNO = 1; /* Before first block                */
      477     9045    3            F$DCB.CFU$->FM$CFUJ.BLKLEN = F$DCB.BOL;
      478     9046    3            F$DCB.CFU$->FM$CFUJ.USER = B$JIT.USER;
      479     9047    3            CALL FMO$GETDOMAIN(I);
      480     9048    3            F$DCB.CFU$->FM$CFUJ.DMAIN = I;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:14   
      481     9049    3            F$DCB.CFU$->FM$CFUJ.DCB# = PN$.V_->FPT$OPEN_V.DCB#;
      482     9050    3            F$DCB.CBUFNUM = 1;             /* Always for JRNL                    */
      483     9051    3            F$DCB.TRNC = FT_NOTRUNC#;
      484     9052    3            CALL FMD$FLSHBUF(1);
      485     9053    3            F$DCB.BFR.DA(1) = 0;
      486     9054    3            CALL FMD$GETBUF( 1, 1, TEMP$ );
      487     9055    3            END;
      488     9056    2         CALL FMH$JGETPG(1);
      489     9057    2         F$DCB.SHARED = %YES#;
      490     9058    2         CALL UQB$MDEQ(F$DCB.CFU$);
      491     9059    2         END;
      492     9060
      493     9061         /***
      494     9062          *** For test open, just close file.
      495     9063          ***/
      496     9064
      497     9065    1      IF PN$.V_->FPT$OPEN_V.OPER.TEST AND F$DCB.ASN ~= %DEVICE#
      498     9066    1       THEN CALL FTC$DFLTCLOSE;
      499     9067    1       ELSE F$DCB.FCD = %YES#;             /* File is open                       */
      500     9068
      501     9069         /***
      502     9070          *** Open is done.
      503     9071          ***/
      504     9072
      505     9073    1   FREEPOOLS:
      506     9074    1      CALL FTR$RELFPOOLS;                  /* Release all FPOOL buffers          */
      507     9075    1      IF F$DCB.ACS ~= %JRNL#
      508     9076    2       THEN DO;
      509     9077    2         IF NOT F$DCB.FCD
      510     9078    2          THEN CALL FTR$RELCFUS;           /* Not open...release CFUs            */
      511     9079    2          ELSE ;                           /* Open                               */
      512     9080    2         END;
      513     9081    2       ELSE DO;
      514     9082    2         IF B$JIT.ERR
      515     9083    3          THEN DO;                         /* Error (not open)                   */
      516     9084    3            CALL FMP$CLSERR;
      517     9085    3            END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:15   
      518     9086    2         END;
      519     9087    1   JUSTRET: ;
      520     9088    1      IF CREATE_OLDFILE
      521     9089    2       THEN DO;                            /* Position to file's end             */
      522     9090    2         CALL FTW$WRAT( FPTPFIL, FPT_PFIL_EOF ) ALTRET(CLOSEFILE);
      523     9091    3         DO WHILE('0'B);
      524     9092    3   CLOSEFILE: ;
      525     9093    3            CALL FTC$DFLTCLOSE;
      526     9094    3            F$DCB.FCD = %NO#;
      527     9095    3            GOTO FREEPOOLS;
      528     9096    3            END;
      529     9097    2         END;
      530     9098    1      RETURN;
      531     9099
      532     9100        /*********************************************************************/
      533     9101        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:16   
      534     9102        /*********************************************************************/
      535     9103    1   FTO_OPNDEV: PROC ALTRET;
      536     9104        /*F*     NAME: FTO_OPNDEV
      537     9105                 PURPOSE: Open device tape/ mount only open.
      538     9106         ***/
      539     9107
      540     9108        /********************/
      541     9109
      542     9110         /***
      543     9111          *** Get initial serial number.
      544     9112          ***/
      545     9113
      546     9114    2      CALL FTO_GETSN ALTRET(JUSTALT);      /* Determine serial number            */
      547     9115    2      IF FT_PROT = FT_FULLPROT#
      548     9116    3       THEN DO;        /* Fully protected system...must specify serial numbers   */
      549     9117    3         F$DCB.MAXVOL = 0;
      550     9118    3         END;
      551     9119    2      IF F$DCB.PSN = ' ' AND (F$DCB.FUN ~= %CREATE# OR FT_PROT = FT_FULLPROT#)
      552     9120    3       THEN DO;
      553     9121    3         B$JIT.ERR = E_NOSN; /*E* ERROR: FTO-E$NOSN */
      554     9122    3         ALTRETURN;
      555     9123    3         END;
      556     9124
      557     9125         /***
      558     9126          *** Check BLKL and RECL for managed free tape (not if mount only).
      559     9127          ***/
      560     9128
      561     9129    2      IF NOT PN$.V_->FPT$OPEN_V.OPER.MNTONLY
      562     9130    2       THEN CALL FTO_CHK_BLKL_RECL ALTRET(JUSTALT);
      563     9131
      564     9132         /***
      565     9133          *** Set attributes and get tape.
      566     9134          ***/
      567     9135
      568     9136    2      IF F$DCB.RESNT.NUM = ' '
      569     9137    3       THEN DO;                            /* Set more accurate name             */
      570     9138    3         IF PN$.V_->FPT$OPEN_V.OPER.MNTONLY
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:17   
      571     9139    3          THEN F$DCB.RES = 'MT';
      572     9140    3          ELSE IF F$DCB.ASN ~= %DEVICE#
      573     9141    3             THEN F$DCB.RES = 'LT';
      574     9142    3             ELSE IF F$DCB.ORG = %FREE#
      575     9143    3                THEN F$DCB.RES = 'FT';
      576     9144    3                ELSE F$DCB.RES = 'MT';
      577     9145    3         END;
      578     9146    2      IF F$DCB.DENSITY = 0
      579     9147    2       THEN F$DCB.ATTR = '0'B;
      580     9148    2       ELSE F$DCB.ATTR = FT_DENS(F$DCB.DENSITY);
      581     9149                                                /* Specify density                    */
      582     9150    2      CALL FRA$OPR ALTRET(JUSTALT);        /* Get tape                           */
      583     9151    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
      584     9152
      585     9153        /* If this is an unprotected system and the serial number as mounted
      586     9154           by the operator does not match the VOL1.SN then we dont set
      587     9155           the DDT.SN entry as this will be needed to determine the
      588     9156           validity of the real M$OPEN (not MNTONLY) operation. */
      589     9157
      590     9158    2      IF NOT (FT_PROT = FT_UNPROT# AND F$DCB.PSN ~= FT$DDT.SN AND FT$DDT.ANST) THEN
      591     9159    2         FT$DDT.SN = F$DCB.PSN;            /* Set actual serial number           */
      592     9160
      593     9161        /* Now lets check the tape density against the drive density.
      594     9162           If they dont match then we have to altreturn */
      595     9163
      596     9164    3      IF FT$DDT.DENSITY ~= 0 AND NOT FT_DENS(FT$DDT.DENSITY)&F$DCB.ATTR THEN DO;
      597     9165    3         IF F$DCB.ASN=%DEVICE# AND
      598     9166    3           F$DCB.FUN=%CREATE# AND
      599     9167    3           F$DCB.EXIST~=%OLDFILE#
      600     9168    3          THEN
      601     9169    3            EXIT;
      602     9170    3         B$JIT.ERR = E_WRONGDENSITY;
      603     9171    3         GOTO CLSTAP;
      604     9172    3         END;
      605     9173    2      I = F$DCB.VOL;
      606     9174    2      CALL FTR$SETSN(I,ADDR(F$DCB.PSN)) ALTRET(NEVER0);
      607     9175    2   NEVER0: ;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:18   
      608     9176
      609     9177         /***
      610     9178          *** We now have the tape.  If mount only open, we're done.
      611     9179          ***/
      612     9180
      613     9181    2      IF PN$.V_->FPT$OPEN_V.OPER.MNTONLY
      614     9182    3       THEN DO;                            /* Just close tape                    */
      615     9183    3         IF FT$DDT.ANST                    /* Return tape type                   */
      616     9184    4          THEN DO;
      617     9185    4            F$DCB.ASN = %TAPE#;
      618     9186    4            F$DCB.FSN = FT$DDT.FRSTFSN + 1; /* +1 since pre-FSN                  */
      619     9187    4            F$DCB.FSECT = FT$DDT.FRSTFSECT;
      620     9188    4            END;
      621     9189    3          ELSE F$DCB.ASN = %DEVICE#;
      622     9190    3         F$DCB.DENSITY = FT$DDT.DENSITY;
      623     9191    4         IF FT$DDT.FMNEEDED THEN DO;       /* File mark needed before rewind     */
      624     9192    4            FT$DDT.FMNEEDED = %NO#;
      625     9193    4            CALL FTI$WRFM ALTRET(CLSTAP);
      626     9194    4            END;
      627     9195    3         CALL FTI$REWIND ALTRET(CLSTAP);   /* Position to BOV                    */
      628     9196    3         FT$DDT.NOTEOF = '0'B;             /* No longer in middle of file        */
      629     9197    3         FT$DDT.FSN = FT$DDT.FRSTFSN;      /* Back to BOT                        */
      630     9198    3         CALL FRB$CLS;
      631     9199    3         ALTRETURN;
      632     9200    3         END;
      633     9201
      634     9202         /***
      635     9203          *** Do tape checks.
      636     9204          ***/
      637     9205
      638     9206    3      IF F$DCB.FUN = %CREATE# THEN DO;
      639     9207    3         IF FT$DDT.POS = FTP_BOV# THEN     /* If at BOV, set DDT.EBCDIC.         */
      640     9208    3            FT$DDT.EBCDIC = F$DCB.EBCDIC;
      641     9209    3          ELSE                             /* Not at BOV, can't change EBCDIC.   */
      642     9210    4            IF FT$DDT.EBCDIC ~= F$DCB.EBCDIC THEN DO; /* Tried to change EBCDIC. */
      643     9211    4               IF FT$DDT.EBCDIC THEN
      644     9212    4                  B$JIT.ERR = E_EBCDICTAP; /*E* ERROR: FTO-E$EBCDICTAP */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:19   
      645     9213    4                ELSE
      646     9214    4                  B$JIT.ERR = E_ASCIITAP;  /*E* ERROR: FTO-E$ASCIITAP */
      647     9215    4               GOTO CLSTAP;
      648     9216    4               END;
      649     9217    3         F$DCB.NOEOF = %YES#;              /* Always for create                  */
      650     9218    3         F$DCB.EOP = WRITEEOP#;            /* Always for create                  */
      651     9219    3         F$DCB.FMOD = %YES#;
      652     9220    3         F$DCB.LSTBLK = %YES#;
      653     9221    3         END;
      654     9222    2       ELSE
      655     9223    2         F$DCB.NOEOF = %NO#;               /* Not output open                    */
      656     9224    2      IF NOT FT$DDT.EBCDIC OR F$DCB.ANSISPANSEQ
      657     9225    2       THEN F$DCB.REALSPAN = '1'B;
      658     9226    2      CALL FTR$DPT ALTRET(CLSTAP);         /* Do density, permit, type checks    */
      659     9227    2      NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POSLOST = %NO#;
              9227               /* Permit free tape I/O */
      660     9228    2      NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.NOTEOF = '0'B;
              9228               /* No longer in middle of file */
      661     9229
      662     9230         /***
      663     9231          *** Allow anything.
      664     9232          ***/
      665     9233
      666     9234    2      F$DCB.FFLG = '0'B;
      667     9235    2      F$DCB.FFLG.READ = %YES#;
      668     9236    2      IF F$DCB.FUN ~= %IN#
      669     9237    3       THEN DO;
      670     9238    3         F$DCB.FFLG.WNEW = %YES#;
      671     9239    3         F$DCB.FFLG.UPD = %YES#;
      672     9240    3         END;
      673     9241    3       ELSE DO;                            /* No user labels input               */
      674     9242    3         CALL HFF$DSIZ( POFFW(ADDR(PN$.UHL_),ADDR(PN$.V_)), I ) ALTRET(NOUHL);
      675     9243    3         TEMP$ = PN$.UHL_;
      676     9244    3         IF TEMP$ ~= ADDR(NIL) AND I >= 4
      677     9245    3          THEN TEMP$->VLP$SN_V.NUM = 0;    /* None                               */
      678     9246    3   NOUHL: ;
      679     9247    3         END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:20   
      680     9248    2      F$DCB.TAPTYP.RWASC = %YES#;
      681     9249    2      F$DCB.TAPTYP.CP6F = %NO#;
      682     9250    2      CALL FTO_SETTAPTYP;
      683     9251    2      RETURN;
      684     9252
      685     9253    2   CLSTAP: ;
      686     9254    2      CALL FRB$CLS;
      687     9255    2   JUSTALT: ;
      688     9256    2      ALTRETURN;
      689     9257
      690     9258    2   END FTO_OPNDEV;
      691     9259        /*********************************************************************/
      692     9260        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:21   
      693     9261        /*********************************************************************/
      694     9262    1   FTO_OPNCREATE: PROC ALTRET;
      695     9263        /*F*    NAME: FTO_OPNCREATE
      696     9264                PURPOSE: Open tape file for create.
      697     9265         ***/
      698     9266
      699     9267        /********************/
      700     9268
      701     9269         /***
      702     9270          *** Check file name, BLKL and RECL.
      703     9271          ***/
      704     9272
      705     9273    2      CALL FMN$CHKFLACN(JDCB$) ALTRET(JUSTALT); /* Check file name and account   */
      706     9274    2      CALL FTO_CHK_BLKL_RECL ALTRET(JUSTALT);
      707     9275
      708     9276    2      CALL FTO_CREATEOPEN ALTRET(JUSTALT);
      709     9277    2      RETURN;
      710     9278
      711     9279    2   JUSTALT: ;
      712     9280    2      ALTRETURN;
      713     9281
      714     9282    2   END FTO_OPNCREATE;
      715     9283        /********************************************************************/
      716     9284        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:22   
      717     9285        /********************************************************************/
      718     9286    1   FTO_CREATEOPEN: PROC ALTRET;
      719     9287        /*F*     NAME: FTO_CREATEOPEN
      720     9288                 PURPOSE: Opens tape and tape file for creation.
      721     9289         ***/
      722     9290
      723     9291        /********************/
      724     9292
      725     9293         /***
      726     9294          *** For CP-6 files, no EBCDIC translation.
      727     9295          ***/
      728     9296
      729     9297    2      CALL FTO_SETTAPTYP;                  /* Determine tape type                */
      730     9298    2      IF ((NOT F$DCB.TAPTYP.RWASC) AND
      731     9299    2        (F$DCB.BLKL > 88888 )) THEN        /* CHECK IF BLKL WOULD BE TO BIG      */
      732     9300    3      DO;
      733     9301    3         B$JIT.ERR = E_BLKL;            /*E*  ERROR: FTO-E$BLKL       */
      734     9302    3         GOTO JUSTALT;
      735     9303    3         END;
      736     9304    2      IF F$DCB.TAPTYP.CP6F
      737     9305    3       THEN DO;                            /* CP6 file                           */
      738     9306    3         F$DCB.EBCDIC = %NO#;
      739     9307    3         F$DCB.CNVRT = %NO#;
      740     9308    3         END;
      741     9309
      742     9310    2      IF NOT F$DCB.EBCDIC OR F$DCB.ANSISPANSEQ
      743     9311    2       THEN F$DCB.REALSPAN = '1'B;
      744     9312
      745     9313         /***
      746     9314          *** Scratch mount implied if no SN.  Otherwise put SN list in
      747     9315          *** the CFU area.
      748     9316          ***/
      749     9317
      750     9318    2      IF F$DCB.VOL = 0                     /* Remember if initial vol specified  */
      751     9319    2       THEN F$DCB.SEZ_OK = %NO#;
      752     9320    2       ELSE F$DCB.SEZ_OK = %YES#;          /* Initial vol specified              */
      753     9321    2      CALL FTO_GETSN ALTRET(JUSTALT);      /* Determine serial number            */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:23   
      754     9322    2      IF FT_PROT = FT_FULLPROT#
      755     9323    3       THEN DO;                       /* Fully protected system...no scratches   */
      756     9324    3         F$DCB.MAXVOL = 0;
      757     9325    3         IF F$DCB.PSN = ' '
      758     9326    4          THEN DO;                         /* No scratches                       */
      759     9327    4            B$JIT.ERR = E_NOSN; /*E* ERROR: FTO-E$NOSN */
      760     9328    4            GOTO JUSTALT;
      761     9329    4            END;
      762     9330    3         END;
      763     9331
      764     9332
      765     9333         /***
      766     9334          *** Default resource is MT.
      767     9335          ***/
      768     9336
      769     9337    2      IF F$DCB.RESNT.NUM = ' ' THEN F$DCB.RES = 'LT';
      770     9338
      771     9339         /***
      772     9340          *** Get tape mounted; if not at beginning of set it can't be scratch
      773     9341          *** since the FSN can not be known.  The tape must be the same (EBCDIC
      774     9342          *** or ASCII) as the new file.
      775     9343          ***/
      776     9344
      777     9345    2      IF F$DCB.DENSITY = 0
      778     9346    2       THEN F$DCB.ATTR = '0'B;
      779     9347    2       ELSE F$DCB.ATTR = FT_DENS(F$DCB.DENSITY);
      780     9348    2      CALL FRA$OPR ALTRET(RELCFUS);        /* Get tape                           */
      781     9349    3      DO CASE(F$DCB.ORG);
      782     9350    3       CASE(%UR#,%SYMB#);
      783     9351    3         F$DCB.ATTR=F$DCB.ATTR|F$DCB.FORM$->CODE16.ATTR;
      784     9352    3       END;
      785     9353    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
      786     9354    2      FT$DDT.SN = F$DCB.PSN;
      787     9355    2      I = F$DCB.VOL;
      788     9356    2      CALL FTR$SETSN(I,ADDR(F$DCB.PSN)) ALTRET(NEVER1);
      789     9357    2   NEVER1: ;
      790     9358
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:24   
      791     9359         /***
      792     9360          *** Create opens can not be allowed to ANSscratch or unlabelled tapes
      793     9361          *** which are not the first volume of a set since the file
      794     9362          *** sequence number can not be determined.
      795     9363          ***/
      796     9364
      797     9365    2      IF F$DCB.VOL > 1
      798     9366    2        AND (FT$DDT.SCRTCH OR NOT FT$DDT.ANST)
      799     9367    3       THEN DO;                            /* Illegal mount of scratch tape      */
      800     9368    3         B$JIT.ERR = E_SCRORDER; /*E* ERROR: FTO-E$SCRORDER */
      801     9369    3         GOTO CLSTAP;
      802     9370    3         END;
      803     9371
      804     9372         /*
      805     9373          * If last close left the tape in the middle of the file, space to the
      806     9374          * next beginning-of-file in the tape set.
      807     9375          */
      808     9376
      809     9377    3      IF FT$DDT.NOTEOF THEN DO;
      810     9378    3         FT$DDT.NOTEOF = '0'B;
      811     9379    3         ALABEL = ' ';
      812     9380    3         CALL FTL$SPF(ALABEL) ALTRET(CLSTAP);
      813     9381    3         DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
      814     9382    3         END;
      815     9383
      816     9384         /*
      817     9385          * Position to end of volume set if requested.
      818     9386          */
      819     9387
      820     9388    3      IF F$DCB.XTEND THEN DO;              /* Extend volume set                  */
      821     9389    3         CALL FTL$PEOS ALTRET(CLSTAP);
      822     9390    3         DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
      823     9391    3         END;
      824     9392
      825     9393         /***
      826     9394          *** Only permit writing if current position is known to be
      827     9395          *** either between the double file mark at volume end or before
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:25   
      828     9396          *** the next HDR1 on the tape.
      829     9397          ***/
      830     9398
      831     9399    2      IF (FT$DDT.POS ~= FTP_HDR# AND FT$DDT.POS ~= FTP_BOV#)
      832     9400    2        OR FT$DDT.FUNNYPOS
      833     9401    3       THEN DO;                       /* Not positioned where writing allowed    */
      834     9402    3         B$JIT.ERR = E_FUNNYPOS; /*E* ERROR: FTO-E$FUNNYPOS */
      835     9403    3         GOTO CLSTAP;
      836     9404    3         END;
      837     9405
      838     9406         /***
      839     9407          *** Only permit change of recording code (EBCDIC/ASCII) if at the
      840     9408          *** beginning of a volume set.
      841     9409          ***/
      842     9410
      843     9411    2      IF FT$DDT.POS = FTP_BOV# AND F$DCB.VOL = 1
      844     9412    3       THEN DO;                       /* At beginning of set, begin 'new' set    */
      845     9413    3         FT$DDT.EBCDIC = F$DCB.EBCDIC;
      846     9414    3         F$DCB.FSN = 1;                    /* Beginning of set                   */
      847     9415    3         END;
      848     9416    3       ELSE DO;   /* Not at beginning of set, tape and file must use same code   */
      849     9417    3         IF FT$DDT.EBCDIC ~= F$DCB.EBCDIC
      850     9418    4          THEN DO;                         /* They don't use same code           */
      851     9419    4            IF FT$DDT.EBCDIC
      852     9420    4             THEN B$JIT.ERR = E_EBCDICTAP; /*E* ERROR: FTO-E$EBCDICTAP */
      853     9421    4             ELSE B$JIT.ERR = E_ASCIITAP; /*E* ERROR: FTO-E$ASCIITAP */
      854     9422    4            GOTO CLSTAP;
      855     9423    4            END;
      856     9424    3         F$DCB.FSN = FT$DDT.FSN + 1;       /* Next file in sequence              */
      857     9425    3         END;
      858     9426
      859     9427         /***
      860     9428          *** FSN must be 9999 or less.  Do checks on tape.
      861     9429          ***/
      862     9430
      863     9431    2      IF F$DCB.FSN > 9999
      864     9432    3       THEN DO;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:26   
      865     9433    3         B$JIT.ERR = E_BADFSN; /*E* ERROR: FTO-E$BADFSN */
      866     9434    3         GOTO CLSTAP;
      867     9435    3         END;
      868     9436    2      F$DCB.NOEOF = %YES#;                 /* Indicate output tape to FTR$DPT    */
      869     9437    2      CALL FTR$DPT ALTRET(CLSTAP);    /* Do density, write permit, type checks   */
      870     9438    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
      871     9439
      872     9440         /***
      873     9441          *** Build FORM area and FIT if necessary.
      874     9442          ***/
      875     9443
      876     9444    2      IF F$DCB.TAPTYP.CP6F
      877     9445    3       THEN DO;                            /* Build FIT                          */
      878     9446    3         IF NOT F$DCB.BUPM&'01'B THEN F$DCB.DESC.BUPM=F$DCB.BUPM;
      879     9447    3         CALL FMO$BLDFIT(PN$) ALTRET(CLSTAP); /* Build the FIT                   */
      880     9448    3         END;
      881     9449
      882     9450         /***
      883     9451          *** Write VOL1 if at beginning of tape.
      884     9452          ***/
      885     9453
      886     9454    2      F$DCB.FSECT = 1;                     /* First section                      */
      887     9455    2      IF FT$DDT.POS = FTP_BOV#             /* Write new labels if at BOV         */
      888     9456    2        OR FT$DDT.EXPIRE = ' '             /* Detects first labeled file on PO   */
      889     9457    3       THEN DO;
      890     9458    3         IF F$DCB.VOL = 1
      891     9459    4          THEN DO;                         /* Beginning of set                   */
      892     9460    4            CALL SSS$SYSTIME( I );         /* Get universal time                 */
      893     9461    4            IF F$DCB.EXPIRE = 0 THEN F$DCB.EXPIRE = B$JIT.DEFEXP;
              9461                     /* Use default if none */
      894     9462    4            IF F$DCB.EXPIRE < 0            /* Default (0) => NEVER               */
      895     9463    4             THEN FT$DDT.EXPIRE = '99365'; /* Negative means never               */
      896     9464    5             ELSE DO;                      /* Calculate expiration date          */
      897     9465    5               CALL XUD$UTS_ADJUST(I,I,F$DCB.EXPIRE*%UTS_CSEC_DAY#);
      898     9466    5               CALL UMT$JDATE( FT$DDT.EXPIRE, I );
      899     9467    5               IF FT$DDT.EXPIRE > '99364'  /* This means never                   */
      900     9468    5                THEN FT$DDT.EXPIRE = '00001'; /* Avoid ambiguity, use next day   */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:27   
      901     9469    5               END;
      902     9470    4            END;
      903     9471    3         FT$DDT.VOLACCESS = F$DCB.VOLACCESS; /* Remember access control          */
      904     9472    3         FT$DDT.ACCT = B$JIT.ACCN;         /* Remember owner                     */
      905     9473    3         IF FT$DDT.POS = FTP_BOV#
      906     9474    3          THEN CALL FTL$VOL1 ALTRET(CLSTAP); /* Only if at BOV                   */
      907     9475    3         END;
      908     9476
      909     9477         /***
      910     9478          *** Write HDR1 and HDR2 followed by User Header Labels.
      911     9479          ***/
      912     9480
      913     9481    2      F$DCB.PRECNO = 1;
      914     9482    2      F$DCB.AFTRBLK = %NO#;                /* In case of CVOL                    */
      915     9483    2      BACKUP_FM_CNT = 0;                   /* Assume CVOL not needed             */
      916     9484    2      IF F$DCB.ORG = %RESTRICT# AND NO_IFPARAM_RESTRICT
      917     9485    2       THEN CALL FTL$LBLS( 'HDR' ) ALTRET( CLSTAP );
      918     9486    2       ELSE CALL FTL$LBLS( 'HDR', ADDR(NIL) ) ALTRET( CLSTAP );
      919     9487    2      FT$DDT.FMNEEDED = %YES#;             /* Need file marks                    */
      920     9488    2      FT$DDT.SCRTCH = %NO#;                /* Tape is no longer scratch          */
      921     9489    2      CALL HFF$DSIZ( POFFW(ADDR(PN$.UHL_),ADDR(PN$.V_)), I ) ALTRET(NOUHL);
      922     9490    2      TEMP$ = PN$.UHL_;
      923     9491    2      IF TEMP$ = ADDR(NIL) THEN I = 0;     /* Might be default open              */
      924     9492    2      CALL FTL$ULBLS('UHL',TEMP$,I) ALTRET(CLSTAP);
      925     9493    2   NOUHL: ;
      926     9494    2      CALL FTI$WRFM ALTRET(CLSTAP);
      927     9495    2      BACKUP_FM_CNT = 2;                   /* CVOL needed if tape end            */
      928     9496    2      FT$DDT.FSN = F$DCB.FSN;              /* Restore FSN                        */
      929     9497
      930     9498         /***
      931     9499          *** Determine protection for CP-6 format files; default protection
      932     9500          *** for non CP-6 format files.
      933     9501          ***/
      934     9502
      935     9503    2      IF F$DCB.TAPTYP.CP6F
      936     9504    3       THEN DO;                            /* CP-6 format file                   */
      937     9505    3         TEMP$ = FM$BUF$(F$DCB.BFR.BUFX(1)); /* Get pointer                      */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:28   
      938     9506    3         TEMP$->FT$HDR.L1 = 16 * F$DCB.BFR1.SIZ(1); /* 4096 * #pages / 256       */
      939     9507    3         TEMP$->FT$HDR.L2 = 0;             /* 4096 - (4096 / 256) * 256          */
      940     9508    3         TEMP$->FT$HDR.S1 = 0;
      941     9509    3         TEMP$->FT$HDR.S2 = 128;           /* Set FPARAM bit                     */
      942     9510    3         F$DCB.ARS = 4096 * F$DCB.BFR1.SIZ(1);
      943     9511                                                /* Write entire FIT                   */
      944     9512    3         CALL FTI$WRBIN(TEMP$) ALTRET(CLSTAP);
      945     9513    3         BACKUP_FM_CNT = 2;                /* CVOL needed if tape end            */
      946     9514    3         F$DCB.OWNER = %YES#;              /* Only protect by account            */
      947     9515    3         CALL FMO$SECCHK( PN$.V_->FPT$OPEN_V, TEMP$->FPT$OPEN_V );
      948     9516                                                /* Pass V area and FIT TO SET FFLG    */
      949     9517    3         END;
      950     9518    3       ELSE DO;                            /* No protection for non CP-6         */
      951     9519    3         F$DCB.FFLG = '0'B;
      952     9520    3         F$DCB.FFLG.READ = %YES#;
      953     9521    3         F$DCB.FFLG.WNEW = %YES#;
      954     9522    3         F$DCB.FFLG.UPD = %YES#;
      955     9523    3         END;
      956     9524    2      F$DCB.NOEOF = %YES#;                 /* Always for create                  */
      957     9525    2      F$DCB.EOP = WRITEEOP#;               /* Always for create                  */
      958     9526    2      F$DCB.FMOD = %YES#;
      959     9527    2      F$DCB.LSTBLK = %YES#;
      960     9528    2      IF F$DCB.EBCDIC THEN
      961     9529    2         F$DCB.STR = F$DCB.VOL - 1;
      962     9530
      963     9531         /***
      964     9532          *** A volume change is needed if tape end was hit and the user
      965     9533          *** doesn't desire CVOL control.
      966     9534          ***/
      967     9535
      968     9536    2      IF BACKUP_FM_CNT > 0 AND NOT F$DCB.CVOL AND F$DCB.TYC.EOT(1)
      969     9537    3       THEN DO;                            /* Change to next volume              */
      970     9538    3         CALL FTL$CVOL(TEMP$,ADDR(NIL),0) ALTRET(CHKVOLOUT);
      971     9539    3         END;
      972     9540    2      RETURN;
      973     9541
      974     9542    2   CHKVOLOUT: ;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:29   
      975     9543    2      IF B$JIT.ERR.CODE = %E$VOLOUT
      976     9544    3       THEN DO;                            /* No next volume...can't CVOL        */
      977     9545    3         ERRSAV = B$JIT.ERR;
      978     9546    3         F$DCB.ARS = - BACKUP_FM_CNT;      /* Backup to beginning of file        */
      979     9547    3         CALL FTI$SPFILE ALTRET(CLSTAP);
      980     9548    3         F$DCB.ARS = 1;                    /* Skip file mark or VOL1             */
      981     9549    3         CALL FTI$SPREC ALTRET(CLSTAP);
      982     9550    3         CALL FTI$WRFM ALTRET(CLSTAP);
      983     9551    3         F$DCB.ARS = -1;
      984     9552    3         CALL FTI$SPFILE ALTRET(CLSTAP);
      985     9553    3         FT$DDT.POS = FTP_HDR#;
      986     9554    3         GOTO CLSTAPERR;
      987     9555    3         END;
      988     9556
      989     9557         /***
      990     9558          *** Errors: ***
      991     9559          ***/
      992     9560
      993     9561    2   CLSTAP: ;
      994     9562    2      ERRSAV = B$JIT.ERR;
      995     9563    2   CLSTAPERR: ;
      996     9564    2      CALL FRB$CLS;
      997     9565    2      B$JIT.ERR = ERRSAV;
      998     9566
      999     9567    2   RELCFUS:
     1000     9568    2      CALL FTR$RELCFUS;
     1001     9569
     1002     9570    2   JUSTALT:
     1003     9571    2      ALTRETURN;
     1004     9572
     1005     9573    2   END FTO_CREATEOPEN;
     1006     9574        /*********************************************************************/
     1007     9575        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:30   
     1008     9576        /*********************************************************************/
     1009     9577    1   FTO_CHK_BLKL_RECL: PROC ALTRET;
     1010     9578        /*F*     NAME: FTO_CHK_BLKL_RECL
     1011     9579                 PURPOSE: Check (and possibly adjust) BLKL and RECL options.
     1012     9580         ***/
     1013     9581
     1014     9582        /********************/
     1015     9583
     1016     9584         /***
     1017     9585          *** Make sure format is legal for free tape.
     1018     9586          ***/
     1019     9587
     1020     9588    2      IF F$DCB.ASN = %DEVICE#
     1021     9589    3       THEN DO;
     1022     9590    4         DO CASE(F$DCB.ORG);
     1023     9591    4          CASE(%FREE#);
     1024     9592    4            F$DCB.TAPTYP.MANAGED = %NO#;
     1025     9593    4            RETURN;                        /* No BLKL checking                   */
     1026     9594    4          CASE(ELSE);
     1027     9595    4            F$DCB.ORG = %FREE#;
     1028     9596    4            F$DCB.TAPTYP.MANAGED = %NO#;
     1029     9597    4            RETURN;                        /* No BLKL checking                   */
     1030     9598    4          CASE(%VARIABLE#);
     1031     9599    4            F$DCB.TAPTYP.MANAGED = %YES#;
     1032     9600    4            F$DCB.EBCDIC = %NO#;           /* Must be ANS format                 */
     1033     9601    4          CASE(%FIXED#,%UNDEF#);
     1034     9602    4            F$DCB.TAPTYP.MANAGED = %YES#;
     1035     9603    4          CASE(%CONSEC#,%KEYED#,%RANDOM#,%UR#,%RELATIVE#,%INDEXED#,
     1036     9604    4              %IDS#,%RESTRICT#,%TERMINAL#,%SYMB#,%IREL#);
     1037     9605    4            B$JIT.ERR = E_NOTFREEORG; /*E* ERROR: FTO-E$NOTFREEORG */
     1038     9606    4            ALTRETURN;
     1039     9607    4          END;
     1040     9608    3         END;
     1041     9609    2      MAXBLKL = 4096 * (B$JIT.FBUL - 2);   /* Minus 2 for label, a/m buffers     */
     1042     9610    2      IF MAXBLKL <= 0
     1043     9611    3       THEN DO;                            /* Not enough FPOOLs                  */
     1044     9612    3         B$JIT.ERR = E_NOFPOOL;            /*E* ERROR: FTO-E$NOFPOOL */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:31   
     1045     9613    3         ALTRETURN;
     1046     9614    3         END;
     1047     9615    2      IF MAXBLKL > 99996
     1048     9616    2       THEN MAXBLKL = 99996;               /* Limit size to word bound < 99999   */
     1049     9617
     1050     9618         /***
     1051     9619          *** Process create open depending on file org.
     1052     9620          ***/
     1053     9621
     1054     9622    3      DO CASE(F$DCB.ORG);
     1055     9623
     1056     9624    3       CASE(ELSE);
     1057     9625    3         F$DCB.ORG = %CONSEC#;
     1058     9626    3         GOTO CONSECORG;
     1059     9627
     1060     9628    3       CASE(%UNDEF#);
     1061     9629    3         F$DCB.BOL = 0;                    /* No BOL                             */
     1062     9630    3         F$DCB.BLOCKED = %NO#;             /* Not blocked                        */
     1063     9631    3         F$DCB.SPANNED = %NO#;             /* Not spanned                        */
     1064     9632    3         IF F$DCB.RECL = 0                 /* *RECL*                             */
     1065     9633    3          THEN F$DCB.RECL = 80;            /* Default is 80                      */
     1066     9634    3          ELSE IF F$DCB.RECL < 4
     1067     9635    3             THEN F$DCB.RECL = 4;          /* Minimum                            */
     1068     9636    3             ELSE IF F$DCB.RECL > 65536    /* Maximum                            */
     1069     9637    3                THEN F$DCB.RECL = 65536;
     1070     9638    3         F$DCB.BLKL = F$DCB.RECL;          /* One record per block               */
     1071     9639
     1072     9640    3       CASE(%FIXED#);
     1073     9641    3         F$DCB.BOL = 0;                    /* No BOL                             */
     1074     9642    3         F$DCB.SPANNED = %NO#;             /* No spanning                        */
     1075     9643    3         IF F$DCB.RECL = 0                 /* *RECL*                             */
     1076     9644    3          THEN F$DCB.RECL = 80;            /* Default is 80                      */
     1077     9645    3          ELSE IF F$DCB.RECL < 1
     1078     9646    3             THEN F$DCB.RECL = 1;          /* Minimum                            */
     1079     9647    3             ELSE IF F$DCB.RECL > MAXBLKL  /* Maximum                            */
     1080     9648    3                THEN F$DCB.RECL = MAXBLKL;
     1081     9649    3         IF F$DCB.BLOCKED
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:32   
     1082     9650    4          THEN DO;                         /* Fixed and blocked                  */
     1083     9651    4            IF F$DCB.BLKL = 0
     1084     9652    4             THEN IF F$DCB.EBCDIC
     1085     9653    4                THEN F$DCB.BLKL = 6400;
     1086     9654    4                ELSE F$DCB.BLKL = 2000;
     1087     9655    4            IF F$DCB.BLKL < F$DCB.RECL
     1088     9656    4             THEN F$DCB.BLKL = F$DCB.RECL; /* Minimum is record length           */
     1089     9657    4             ELSE IF F$DCB.BLKL > MAXBLKL  /* Maximum                            */
     1090     9658    4                THEN F$DCB.BLKL = MAXBLKL;
     1091     9659    4            F$DCB.BLKL = ( (F$DCB.BLKL + (F$DCB.RECL - 1) ) / F$DCB.RECL) * F$DCB.RECL;
              9659                     /* Make integral */
     1092     9660    4            END;
     1093     9661    4          ELSE DO;                         /* Fixed and not blocked              */
     1094     9662    4            F$DCB.BLKL = F$DCB.RECL;       /* One record per block               */
     1095     9663    4            END;
     1096     9664    3         IF NOT F$DCB.EBCDIC
     1097     9665    3          THEN F$DCB.BLKL = ( (F$DCB.BLKL + 3) / 4 ) * 4;
     1098     9666
     1099     9667    3       CASE(%RANDOM#,%RESTRICT#,%IDS#);
     1100     9668    3         IF F$DCB.ORG = %RESTRICT#
     1101     9669    4          THEN DO;                    /* Make sure IFPARAM buffer is present     */
     1102     9670    4            IF NOT B$JIT.PRIV.ACTIVE & %PR_FMBLK#
     1103     9671    5             THEN DO;                      /* Not allowed to access RESTRICT     */
     1104     9672    5               B$JIT.ERR = E_NORESTRICT; /*E* ERROR: FTO-E$NORESTRICT */
     1105     9673    5               ALTRETURN;
     1106     9674    5               END;
     1107     9675    4            NO_IFPARAM_RESTRICT = %NO#;    /* Assume FIT specified               */
     1108     9676    4            CALL HFF$DSIZ(POFFW(ADDR(PN$.IFPARAM_),ADDR(PN$.V_)),I) ALTRET(NOIFPARAM);
     1109     9677    4            TEMP$ = PN$.IFPARAM_;          /* Get pointer to IFPARAM             */
     1110     9678    4            IF TEMP$ = ADDR(NIL) THEN I = 0; /* Might be default open            */
     1111     9679    4            IF I < 4096
     1112     9680    5             THEN DO;
     1113     9681    5   NOIFPARAM:  ;
     1114     9682    5               NO_IFPARAM_RESTRICT = %YES#;
     1115     9683    5               END;
     1116     9684    4            IF F$DCB.BLKL < 4096
     1117     9685    4             THEN F$DCB.BLKL = 4096;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:33   
     1118     9686    4             ELSE F$DCB.BLKL = ((F$DCB.BLKL + 4095) / 4096) * 4096;
     1119     9687    4            END;
     1120     9688    3          ELSE F$DCB.BLKL = 4096;
     1121     9689    3         F$DCB.BOL = 0;                    /* No BOL                             */
     1122     9690    3         F$DCB.BLOCKED = %NO#;             /* Not blocked                        */
     1123     9691    3         F$DCB.SPANNED = %NO#;             /* Not spanned                        */
     1124     9692    3         F$DCB.RECL = 4096;                /* One granule per record             */
     1125     9693
     1126     9694    3       CASE(%CONSEC#,%KEYED#,%RELATIVE#,%UR#,%INDEXED#,%SYMB#,%IREL#);
     1127     9695    3   CONSECORG: ;
     1128     9696    3         F$DCB.BOL = 4;
     1129     9697    3         F$DCB.SPANNED = %YES#;            /* Always spanned                     */
     1130     9698    3         F$DCB.BLOCKED = %YES#;            /* Always blocked                     */
     1131     9699    4         DO CASE(F$DCB.ORG);
     1132     9700    4          CASE(%INDEXED#);
     1133     9701    4            IF F$DCB.KEYL < 1 THEN F$DCB.KEYL = 1;
     1134     9702    4          CASE(%UR#,%SYMB#);
     1135     9703    4            CALL FSF$TAPEFORM ALTRET(JUSTALT); /*Establish FORM info             */
     1136     9704    4          END;
     1137     9705    3         F$DCB.RECL = 0;                   /* Undetermined maximum record length */
     1138     9706    3         IF F$DCB.BLKL < 4096
     1139     9707    3          THEN F$DCB.BLKL = 4096;          /* Minimum                            */
     1140     9708    3          ELSE IF F$DCB.BLKL > MAXBLKL
     1141     9709    3             THEN F$DCB.BLKL = MAXBLKL;    /* Maximum                            */
     1142     9710    3             ELSE F$DCB.BLKL = ( (F$DCB.BLKL + 4095) / 4096 ) * 4096;
     1143     9711                                                /* To nearest page size               */
     1144     9712
     1145     9713    3       CASE(%VARIABLE#);
     1146     9714    3         IF F$DCB.EBCDIC
     1147     9715    4          THEN DO;                         /* V format                           */
     1148     9716    4            F$DCB.BOL = 4;
     1149     9717    4            IF F$DCB.RECL = 0
     1150     9718    4             THEN F$DCB.RECL = 80;
     1151     9719    4            F$DCB.RECL = F$DCB.RECL + 4;   /* Include control bytes              */
     1152     9720    4            IF F$DCB.RECL < 5
     1153     9721    4             THEN F$DCB.RECL = 5;          /* Minimum                            */
     1154     9722    4             ELSE IF F$DCB.RECL > 32768 - F$DCB.BOL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:34   
     1155     9723    4                THEN F$DCB.RECL = 32768 - F$DCB.BOL; /* Maximum                  */
     1156     9724    4            IF F$DCB.BLOCKED
     1157     9725    5             THEN DO;
     1158     9726    5               IF F$DCB.BLKL = 0
     1159     9727    5                THEN F$DCB.BLKL = 6400;
     1160     9728    5                ELSE IF F$DCB.BLKL < F$DCB.RECL + F$DCB.BOL
     1161     9729    5                   THEN F$DCB.BLKL = F$DCB.RECL + F$DCB.BOL; /* Minimum          */
     1162     9730    5                   ELSE IF F$DCB.BLKL > 32768
     1163     9731    5                      THEN F$DCB.BLKL = 32768; /* Maximum                        */
     1164     9732    5               END;
     1165     9733    4             ELSE F$DCB.BLKL = F$DCB.RECL + F$DCB.BOL;
     1166     9734    4            END;
     1167     9735    4          ELSE DO;                         /* D, S formats                       */
     1168     9736    4            F$DCB.BOL = 0;
     1169     9737    4            IF NOT F$DCB.SPANNED
     1170     9738    5             THEN DO;                      /* D format                           */
     1171     9739    5               IF F$DCB.RECL = 0
     1172     9740    5                THEN F$DCB.RECL = 80;
     1173     9741    5               F$DCB.RECL = F$DCB.RECL + 4; /* Include control bytes             */
     1174     9742    5               IF F$DCB.RECL < 5
     1175     9743    5                THEN F$DCB.RECL = 5;       /* Minimum                            */
     1176     9744    5                ELSE IF F$DCB.RECL > 9999 - F$DCB.BOL
     1177     9745    5                   THEN F$DCB.RECL = 9999 - F$DCB.BOL; /* Maximum                */
     1178     9746    5               IF F$DCB.BLOCKED
     1179     9747    6                THEN DO;
     1180     9748    6                  IF F$DCB.BLKL = 0
     1181     9749    6                   THEN F$DCB.BLKL = 2048; /* Default                            */
     1182     9750    6                  IF F$DCB.BLKL < F$DCB.RECL + F$DCB.BOL
     1183     9751    6                   THEN F$DCB.BLKL = F$DCB.RECL + F$DCB.BOL; /* MInimum          */
     1184     9752    6                   ELSE IF F$DCB.BLKL > MAXBLKL
     1185     9753    6                      THEN F$DCB.BLKL = MAXBLKL; /* Maximum                      */
     1186     9754    6                  END;
     1187     9755    5                ELSE F$DCB.BLKL = F$DCB.RECL + F$DCB.BOL; /* One record/block    */
     1188     9756    5               END;
     1189     9757    5             ELSE DO;                      /* S format                           */
     1190     9758    5               IF F$DCB.RECL ~= 0          /* Zero means unlimited               */
     1191     9759    5                THEN F$DCB.RECL = F$DCB.RECL + 5; /* Include control bytes       */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:35   
     1192     9760    5               IF F$DCB.BLKL = 0
     1193     9761    5                THEN F$DCB.BLKL = 2048;    /* Default                            */
     1194     9762    5                ELSE IF F$DCB.BLKL < 6
     1195     9763    5                   THEN F$DCB.BLKL = 6;    /* Minimum includes SCF plus 1 byte   */
     1196     9764    5                   ELSE IF F$DCB.BLKL > MAXBLKL
     1197     9765    5                      THEN F$DCB.BLKL = MAXBLKL; /* Maximum                      */
     1198     9766    5               END;
     1199     9767    4            END;
     1200     9768    3         IF NOT F$DCB.EBCDIC
     1201     9769    3          THEN F$DCB.BLKL = ( (F$DCB.BLKL + 3) / 4 ) * 4;
     1202     9770    3       END /* DO CASE(F$DCB.ORG); */ ;
     1203     9771
     1204     9772
     1205     9773    2      RETURN;
     1206     9774
     1207     9775    2   JUSTALT: ;
     1208     9776    2      ALTRETURN;
     1209     9777
     1210     9778    2   END FTO_CHK_BLKL_RECL;
     1211     9779        /*********************************************************************/
     1212     9780        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:36   
     1213     9781        /*********************************************************************/
     1214     9782    1   FTO_OPNJRNL: PROC ALTRET;
     1215     9783
     1216     9784         /***
     1217     9785          *** All JRNL file attributes are fixed.
     1218     9786          ***/
     1219     9787
     1220     9788    2      F$DCB.BLKL = 4096;
     1221     9789    2      F$DCB.RECL = 0;
     1222     9790    2      F$DCB.SPANNED = %YES#;
     1223     9791    2      F$DCB.BLOCKED = %YES#;
     1224     9792    2      F$DCB.EBCDIC = %NO#;
     1225     9793    2      F$DCB.BOL = 4;
     1226     9794    2      IF NOT F$DCB.OWNER THEN RETURN;      /* Nothing else to do                 */
     1227     9795
     1228     9796         /***
     1229     9797          *** JRNL owner.
     1230     9798          ***/
     1231     9799
     1232     9800    2      CALL FTO_CREATEOPEN ALTRET(JUSTALT);
     1233     9801    2      TEMP$ = F$DCB.CFU$;                  /* Put common info in CFU             */
     1234     9802    2      TEMP$->FM$CFUJ.DCTX = F$DCB.SETX;
     1235     9803    2      TEMP$->FM$CFUJ.VOL = F$DCB.VOL;
     1236     9804    2      TEMP$->FM$CFUJ.MAXVOL = F$DCB.MAXVOL;
     1237     9805    2      RETURN;
     1238     9806
     1239     9807    2   JUSTALT: ;
     1240     9808    2      ALTRETURN;
     1241     9809
     1242     9810    2   END FTO_OPNJRNL;
     1243     9811        /*********************************************************************/
     1244     9812        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:37   
     1245     9813        /*********************************************************************/
     1246     9814    1   FTO_OPNEXISTING: PROC ALTRET;
     1247     9815        /*F*     NAME: FTO_OPNEXISTING
     1248     9816                 PURPOSE: Open existing file on tape.
     1249     9817         ***/
     1250     9818
     1251     9819        /********************/
     1252     9820
     1253     9821         /***
     1254     9822          *** Get serial number of volume to open.
     1255     9823          ***/
     1256     9824
     1257     9825    2      CALL FTO_SNLIST ALTRET(JUSTALT);
     1258     9826    2      IF FT_PROT = FT_FULLPROT# THEN F$DCB.MAXVOL = 0;
              9826               /* No scratch allowed for full prot */
     1259     9827    2      IF F$DCB.PSN = ' '
     1260     9828    3       THEN DO;
     1261     9829    3         B$JIT.ERR = E_NOSN; /*E* ERROR: FTO-E$NOSN */
     1262     9830    3         ALTRETURN;
     1263     9831    3         END;
     1264     9832
     1265     9833         /***
     1266     9834          *** If file name and sequence number are not specified,
     1267     9835          *** NXTF must be specified.
     1268     9836          ***/
     1269     9837
     1270     9838    2      IF F$DCB.NAME.L <= 0 AND F$DCB.FSN <= 0
     1271     9839    3       THEN DO;                  /* No file name or sequence number specified    */
     1272     9840    3         IF PN$.V_ ~= ADDR(NIL)
     1273     9841    4          THEN DO;
     1274     9842    4            IF (PN$.V_->FPT$OPEN_V.OPER.NXTF AND PN$.V_->FPT$OPEN_V.OPER.THISF)
     1275     9843    4              OR NOT PN$.V_->FPT$OPEN_V.OPER.NXTF
     1276     9844    5             THEN DO;            /* File name should be specified and it isn't   */
     1277     9845    5               B$JIT.ERR = E_NOFIDTHIS; /*E* ERROR: FTO-E$NOFIDTHIS */
     1278     9846    5               ALTRETURN;
     1279     9847    5               END;
     1280     9848    4            END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:38   
     1281     9849    4          ELSE DO;                    /* Default open and no file specification  */
     1282     9850    4            B$JIT.ERR = E_NOFIDTHIS; /*E* ERROR: FTO-E$NOFIDTHIS */
     1283     9851    4            ALTRETURN;
     1284     9852    4            END;
     1285     9853    3         END;
     1286     9854
     1287     9855         /***
     1288     9856          *** Set up requested attributes and get volume.
     1289     9857          ***/
     1290     9858
     1291     9859    2      IF F$DCB.DENSITY = 0
     1292     9860    2       THEN F$DCB.ATTR = '0'B;
     1293     9861    2       ELSE F$DCB.ATTR = FT_DENS(F$DCB.DENSITY);
     1294     9862    2      IF F$DCB.RESNT.NUM = ' ' THEN F$DCB.RES = 'LT';
     1295     9863
     1296     9864    2   ATTEMPT_OPEN_EXISTING: ;
     1297     9865
     1298     9866    2      CALL FRA$OPR ALTRET(JUSTALT);
     1299     9867    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$; /* Get DDT entry pointer       */
     1300     9868
     1301     9869        /*  If the serial number as mounted by the operator is different
     1302     9870            from the one in the VOL1 then the tape should be treated as an
     1303     9871            empty tape. If input or update then E$WRONGSN is reported.
     1304     9872            If create,oldfile then E$NOFILE is used which causes
     1305     9873            the file to be opened with create,newfile  */
     1306     9874
     1307     9875
     1308     9876    2      IF FT$DDT.POS = FTP_BOV# AND FT$DDT.ANST AND
     1309     9877    3        FT$DDT.SN ~= F$DCB.PSN AND FT_PROT = FT_UNPROT# THEN DO;
     1310     9878    3         IF F$DCB.FUN = %CREATE# AND F$DCB.EXIST = %OLDFILE# THEN
     1311     9879    3            B$JIT.ERR = E_NOFILE;
     1312     9880    3          ELSE
     1313     9881    3            B$JIT.ERR = E_WRONGSN;
     1314     9882    3         GOTO CLSTAP;
     1315     9883    3         END;
     1316     9884
     1317     9885    2      FT$DDT.SN = F$DCB.PSN;               /* Set actual serial number           */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:39   
     1318     9886
     1319     9887        /* Now lets check the tape density against the drive density.
     1320     9888           If they dont match then we have to altreturn */
     1321     9889
     1322     9890    3      IF FT$DDT.DENSITY ~= 0 AND NOT FT_DENS(FT$DDT.DENSITY)&F$DCB.ATTR THEN DO;
     1323     9891    3         B$JIT.ERR = E_WRONGDENSITY;
     1324     9892    3         GOTO CLSTAP;
     1325     9893    3         END;
     1326     9894
     1327     9895    2      IF NOT FT$DDT.EBCDIC OR F$DCB.ANSISPANSEQ
     1328     9896    2       THEN F$DCB.REALSPAN = '1'B;
     1329     9897
     1330     9898         /*
     1331     9899          * If last close left the tape in the middle of the file, space to the
     1332     9900          * next beginning-of-file in the tape set.
     1333     9901          */
     1334     9902
     1335     9903    3      IF FT$DDT.NOTEOF THEN DO;
     1336     9904    3         FT$DDT.NOTEOF = '0'B;
     1337     9905    3         ALABEL = ' ';
     1338     9906    3         CALL FTL$SPF(ALABEL) ALTRET(CLSTAP);
     1339     9907    3         DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1340     9908    3         END;
     1341     9909
     1342     9910    2      FT$DDT.FUNNYPOS = %NO#;         /* Don't care since position will be found */
     1343     9911    3      IF FT$DDT.FMNEEDED THEN DO;     /* File mark needed before positioning     */
     1344     9912    3         FT$DDT.FMNEEDED = %NO#;
     1345     9913    3         CALL FTI$WRFM ALTRET(RETFSN);
     1346     9914    3         F$DCB.ARS = -1;
     1347     9915    3         CALL FTI$SPREC ALTRET(RETFSN);
     1348     9916    3         END;
     1349     9917    2      I = F$DCB.VOL;
     1350     9918    2      CALL FTR$SETSN(I,ADDR(F$DCB.PSN)) ALTRET(NEVER2);
     1351     9919    2   NEVER2: ;
     1352     9920    2      CALL FTR$DPT ALTRET(CLSTAP);         /* Do write permit and type checking  */
     1353     9921
     1354     9922         /***
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:40   
     1355     9923          *** We are now ready to attempt opening the specified file.
     1356     9924          ***/
     1357     9925
     1358     9926    2      IF F$DCB.IGNOREFSN THEN              /* Ignore FSN/FSECT?                  */
     1359     9927    2         F$DCB.FSECT = 0;                  /* Don't care what FSECT.             */
     1360     9928    2       ELSE
     1361     9929    2         F$DCB.FSECT = 1;                  /* Open first section of file         */
     1362     9930    2      F$DCB.EBCDIC = FT$DDT.EBCDIC;        /* Fill in DCB.EBCDIC early           */
     1363     9931    2      IF PN$.V_ = ADDR(NIL) THEN           /* Default open                       */
     1364     9932    2         IF F$DCB.NAME.L <= 0 THEN
     1365     9933    2            IF F$DCB.REALSPAN THEN
     1366     9934    2               CALL FTL$FINDSEQ ALTRET(RETFSN);
     1367     9935    2             ELSE
     1368     9936    2               CALL FTL$FINDSEQIBM ALTRET(RETFSN);
     1369     9937    2          ELSE
     1370     9938    2            CALL FTL$FINDFILE ALTRET(RETFSN);
     1371     9939    3       ELSE DO;
     1372     9940    3         IF (PN$.V_->FPT$OPEN_V.OPER.NXTF AND PN$.V_->FPT$OPEN_V.OPER.THISF) OR
     1373     9941    4           NOT PN$.V_->FPT$OPEN_V.OPER.NXTF THEN DO; /* Open specified file      */
     1374     9942    4            IF F$DCB.NAME.L <= 0 THEN      /* Find by sequence number            */
     1375     9943    4               IF F$DCB.REALSPAN THEN
     1376     9944    4                  CALL FTL$FINDSEQ ALTRET(RETFSN);
     1377     9945    4                ELSE
     1378     9946    4                  CALL FTL$FINDSEQIBM ALTRET(RETFSN);
     1379     9947                                           /* No file name...open by sequence number  */
     1380     9948    5             ELSE DO;                      /* Find file by name                  */
     1381     9949    6               IF F$DCB.FSN > 0 THEN DO;   /* First position to FSN              */
     1382     9950    6                  IF F$DCB.REALSPAN THEN
     1383     9951    6                     CALL FTL$FINDSEQ ALTRET(RETFSN);
     1384     9952    6                   ELSE
     1385     9953    6                     CALL FTL$FINDSEQIBM ALTRET(RETFSN);
     1386     9954    6                  F$DCB.ARS = -1;          /* Back up to begin search            */
     1387     9955    6                  CALL FTI$SPREC ALTRET(CLSTAP);
     1388     9956    6                  END;
     1389     9957    5               CALL FTL$FINDFILE ALTRET(RETFSN);
     1390     9958    5               END;
     1391     9959                                                /* File name is specified             */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:41   
     1392     9960    4            END;
     1393     9961    4          ELSE DO;                         /* NXTF, not THISF                    */
     1394     9962    5            IF PN$.V_->FPT$OPEN_V.SRCHCOND.REV THEN DO; /* Reverse NXTF          */
     1395     9963    5               I = FT$DDT.FSN - 1;
     1396     9964    6               IF I <= 0 THEN DO;          /* Beginning of set                   */
     1397     9965    6                  B$JIT.ERR = E_EOSET; /*E* ERROR: FTO-E$EOSET */
     1398     9966    6                  GOTO CLSTAP;
     1399     9967    6                  END;
     1400     9968    5               F$DCB.FSN = I;
     1401     9969    5               IF F$DCB.REALSPAN THEN
     1402     9970    5                  CALL FTL$FINDSEQ ALTRET(RETFSN);
     1403     9971    5                ELSE
     1404     9972    5                  CALL FTL$FINDSEQIBM ALTRET(RETFSN);
     1405     9973    5               END;
     1406     9974    5             ELSE DO;                      /* Open next file                     */
     1407     9975    5               IF FT$DDT.POSLOST AND PN$.V_->FPT$OPEN_V.FINDPOS THEN
     1408     9976    5                  CALL FTL$FINDHDR1 ALTRET(RETFSN); /* Find any next file        */
     1409     9977    6                ELSE DO;
     1410     9978    7                  IF F$DCB.IGNOREFSN THEN DO;
     1411     9979    7                     F$DCB.FSN = F$DCB.FSN + 1;
     1412     9980    7                     CALL FTL$FINDNEXT ALTRET(RETFSN);
     1413     9981    7                     END;
     1414     9982    7                   ELSE DO;
     1415     9983    7                     F$DCB.FSN = FT$DDT.FSN + 1;
     1416     9984    7                     IF F$DCB.REALSPAN THEN /* Find specific next file           */
     1417     9985    7                        CALL FTL$FINDSEQ ALTRET(RETFSN);
     1418     9986    7                      ELSE
     1419     9987    7                        CALL FTL$FINDSEQIBM ALTRET(RETFSN);
     1420     9988    7                     END;
     1421     9989    6                  END;
     1422     9990    5               END;
     1423     9991    4            END;
     1424     9992    3         END;
     1425     9993
     1426     9994         /***
     1427     9995          *** Specified file has been found. Merge information into the DCB.
     1428     9996          ***/
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:42   
     1429     9997
     1430     9998    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$; /* Get DDT pointer             */
     1431     9999    2      F$DCB.EBCDIC = FT$DDT.EBCDIC;
     1432    10000    2      AFPOOL$ = FM$BUF$(F$DCB.BFR.BUFX(F$DCB.LPOOL-1));
     1433    10001                                                /* Get label buffer pointer           */
     1434    10002    2      IF AFPOOL$->FT$LBL1.SYSTEM.ID = 'CP-6'
     1435    10003    2       THEN CREATED_BY_CP6 = %YES#;
     1436    10004    2       ELSE CREATED_BY_CP6 = %NO#;
     1437    10005    2      F$DCB.DENSITY = FT$DDT.DENSITY;      /* Pass density                       */
     1438    10006    2      CALL CHARBIN( I, AFPOOL$->FT$LBL1.FSECT ); /* Set file section #           */
     1439    10007    2      F$DCB.FSECT = I;
     1440    10008    2      CALL CHARBIN( I, AFPOOL$->FT$LBL1.FSEQU_NUM );
     1441    10009    2      FILE_SEQ = I;
     1442    10010    2      FT$DDT.FSN = I - 1;                  /* Set correct DDT info               */
     1443    10011    2      IF F$DCB.EBCDIC THEN                 /* Remember 1st vol of file if IBM.   */
     1444    10012    2         F$DCB.STR = F$DCB.VOL - 1;
     1445    10013    2      FILE_NAME = AFPOOL$->FT$LBL1.FILE_ID; /* Set file id                       */
     1446    10014
     1447    10015         /***
     1448    10016          *** If HDR2 exists, merge its information into the DCB. Otherwise, default.
     1449    10017          ***/
     1450    10018
     1451    10019    2      TEMP$ = PINCRC( AFPOOL$, 80 );       /* Point to HDR2 (if any)             */
     1452    10020    2      IF TEMP$->FT$ANYLBL.LABEL_TYPE ~= 'HDR2' AND FT$DDT.POS = FTP_HDR#
     1453    10021    3       THEN DO;                            /* No HDR2 yet and still possible     */
     1454    10022    3         CALL FTI$RDASCEBC(TEMP$) ALTRET(CLSTAP);
     1455    10023    3         IF F$DCB.TYC.EOF(1)
     1456    10024    3          THEN FT$DDT.POS = FTP_BOD#;      /* Past fm..no HDR2                   */
     1457    10025    4          ELSE DO;
     1458    10026    4            IF TEMP$->FT$ANYLBL.LABEL_TYPE = 'HDR2'
     1459    10027    5             THEN DO;                      /* Got HDR2                           */
     1460    10028    5               IF F$DCB.ARS < 80
     1461    10029    6                THEN DO;                   /* Bad one                            */
     1462    10030    6                  TEMP$->FT$ANYLBL.LABEL_TYPE = ' '; /* Forget it                */
     1463    10031    6                  END;
     1464    10032    5               END;
     1465    10033    5             ELSE DO;                      /* Not HDR2...probably user label     */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:43   
     1466    10034    5               F$DCB.ARS = -1;
     1467    10035    5               CALL FTI$SPREC ALTRET(CLSTAP);
     1468    10036    5               END;
     1469    10037    4            END;
     1470    10038    3         END;
     1471    10039    2      F$DCB.SPANNED = %NO#;                /* Assume not spanned                 */
     1472    10040    2      IF TEMP$->FT$ANYLBL.LABEL_TYPE = 'HDR2'
     1473    10041    3       THEN DO;                            /* HDR2 exists                        */
     1474    10042    3         CALL CHARBIN( I, TEMP$->FT$LBL2.BLKL );
     1475    10043    3         F$DCB.BLKL = I;
     1476    10044    3         CALL CHARBIN( I, TEMP$->FT$LBL2.RECL );
     1477    10045    3         F$DCB.RECL = I;
     1478    10046    3         CALL CHARBIN( I, TEMP$->FT$LBL2.BUF_OFFSET );
     1479    10047    3         F$DCB.BOL = I;
     1480    10048    3         F$DCB.BLOCKED = %YES#;            /* Assume blocking                    */
     1481    10049    3         I = ASCBIN( TEMP$->FT$LBL2.FORMAT ); /* Identify file format            */
     1482    10050    3         J = 0;
     1483    10051    4         DO WHILE(FT_FORMAT(J) ~= I AND J < %FT_MAXFMTS);
     1484    10052    4            J = J + 1;
     1485    10053    4            END;
     1486    10054    4         DO CASE(J);
     1487    10055    4          CASE(ELSE);                      /* U and CP-6 formats                 */
     1488    10056    4            IF CREATED_BY_CP6
     1489    10057    5             THEN DO;                      /* CP-6 created--check type           */
     1490    10058    5               I = ASCBIN( TEMP$->FT$LBL2.CP6.FILE_FORMAT ); /* Get sub-format   */
     1491    10059    5               IF I ~= ASCBIN( ' ' )
     1492    10060    6                THEN DO;                   /* CP-6 format file                   */
     1493    10061    6                  FILE_NAME = TEMP$->FT$LBL2.CP6.FILE_ID;
     1494    10062    6                  J = 0;
     1495    10063    7                  DO WHILE(FT_CP6FMT(J) ~= I AND J < %FT_MAXCP6FMT);
     1496    10064    7                     J = J + 1;
     1497    10065    7                     END;
     1498    10066    6                  F$DCB.ORG = FT_CP6FMTORG(J); /* Determine ORG                  */
     1499    10067    7                  DO CASE(F$DCB.ORG);
     1500    10068    7                   CASE(%CONSEC#,%KEYED#,%UR#,%INDEXED#,%RELATIVE#,%SYMB#,%IREL#);
     1501    10069    7                     J = ASCBIN(TEMP$->FT$LBL2.CP6.BLOCK_ATTR);
     1502    10070    7                     IF J = ASCBIN(' ')
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:44   
     1503    10071    7                      THEN F$DCB.BLOCKED = %NO#; /*   - not blocked, not spanned */
     1504    10072    7                      ELSE IF J = ASCBIN('S')
     1505    10073    8                         THEN DO;          /* S - not blocked, spanned           */
     1506    10074    8                           F$DCB.BLOCKED = %NO#;
     1507    10075    8                           F$DCB.SPANNED = %YES#;
     1508    10076    8                           END;
     1509    10077    7                         ELSE IF J = ASCBIN('R')
     1510    10078    7                            THEN F$DCB.SPANNED = %YES#; /* R - blocked, spanned  */
     1511    10079    7                            ELSE ;         /* B - blocked, not spanned           */
     1512    10080    7                   CASE(%RANDOM#,%IDS#);
     1513    10081    7                     F$DCB.BLOCKED = %NO#;
     1514    10082    7                   CASE(%RESTRICT#);
     1515    10083    7                     F$DCB.BLOCKED = %NO#;
     1516    10084    7                     F$DCB.ACS = %BLOCK#;
     1517    10085    7                     IF I = ASCBIN('x')
     1518    10086    7                      THEN NO_IFPARAM_RESTRICT = %YES#;
     1519    10087    7                      ELSE NO_IFPARAM_RESTRICT = %NO#;
     1520    10088    7                   END;
     1521    10089    6                  F$DCB.BLKL = (F$DCB.BLKL * 8 + 7) / 9;
     1522    10090    6                  F$DCB.RECL = (F$DCB.RECL * 8 + 7) / 9;
     1523    10091    6                  END;
     1524    10092    6                ELSE DO;
     1525    10093    6                  F$DCB.ORG = %UNDEF#;     /* UUUUUUUUUU                         */
     1526    10094    6                  F$DCB.BLKL = F$DCB.RECL;
     1527    10095    6                  END;
     1528    10096    5               END;
     1529    10097    5             ELSE DO;                      /* Not CP-6 created                   */
     1530    10098    5               F$DCB.ORG = %UNDEF#;
     1531    10099    5               F$DCB.BLKL = F$DCB.RECL;
     1532    10100    5               END;
     1533    10101    4          CASE(3);                         /* FFFFFFFFFF                         */
     1534    10102    4            F$DCB.ORG = %FIXED#;
     1535    10103    4            IF F$DCB.BLKL <= F$DCB.RECL THEN F$DCB.BLOCKED = %NO#;
     1536    10104    4          CASE(2);                         /* VVVVVVVVVV                         */
     1537    10105    4            F$DCB.ORG = %VARIABLE#;
     1538    10106    4            J = ASCBIN(TEMP$->FT$LBL2.OTHEROS.BLOCK_ATTR);
     1539    10107    4            F$DCB.BOL = 4;            /* Chris Fries says this is OK for IBM V   */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:45   
     1540    10108    4            IF J = ASCBIN(' ')
     1541    10109    4             THEN F$DCB.BLOCKED = %NO#;    /*   - not blocked, not spanned       */
     1542    10110    4             ELSE IF J = ASCBIN('S')
     1543    10111    5                THEN DO;                   /* S - not blocked, spanned           */
     1544    10112    5                  F$DCB.BLOCKED = %NO#;
     1545    10113    5                  F$DCB.SPANNED = %YES#;
     1546    10114    5                  END;
     1547    10115    4                ELSE IF J = ASCBIN('R')
     1548    10116    4                   THEN F$DCB.SPANNED = %YES#; /* R - blocked, spanned           */
     1549    10117    4                   ELSE ;                  /* B - blocked, not spanned           */
     1550    10118    4          CASE(1);                         /* SSSSSSSSSS                         */
     1551    10119    4            F$DCB.ORG = %VARIABLE#;
     1552    10120    4            F$DCB.SPANNED = %YES#;
     1553    10121    4          CASE(0);                         /* DDDDDDDDDD                         */
     1554    10122    4            F$DCB.ORG = %VARIABLE#;
     1555    10123    4          END;
     1556    10124    3         END;
     1557    10125    3       ELSE DO;                            /* HDR2 does not exist                */
     1558    10126    3         IF F$DCB.ORG = %UNDEF# OR F$DCB.ORG = %FIXED#
     1559    10127    3          THEN ;                           /* Believe user                       */
     1560    10128    4          ELSE DO;
     1561    10129    4            F$DCB.ORG = %UNDEF#;
     1562    10130    4            F$DCB.BOL = 0;
     1563    10131    4            F$DCB.BLOCKED = %NO#;
     1564    10132    4            F$DCB.BLKL = 65536;
     1565    10133    4            F$DCB.RECL = 65536;
     1566    10134    4            END;
     1567    10135    3         END;
     1568    10136
     1569    10137         /***
     1570    10138          *** Get user labels if any.
     1571    10139          ***/
     1572    10140
     1573    10141    2      IF FT$DDT.POS = FTP_HDR#
     1574    10142    3       THEN DO;                            /* Still may have user labels         */
     1575    10143    3         CALL HFF$DSIZ( POFFW(ADDR(PN$.UHL_),ADDR(PN$.V_)), I ) ALTRET(NOUHL);
     1576    10144    3         TEMP$ = PN$.UHL_;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:46   
     1577    10145    3         IF TEMP$ = ADDR(NIL) THEN I = 0;  /* Might be default open              */
     1578    10146    3         CALL FTL$GETULBLS('UHL', TEMP$, I ) ALTRET(CLSTAP);
     1579    10147    4         DO WHILE('0'B);
     1580    10148    4   NOUHL:   ;
     1581    10149    4            F$DCB.ARS = 1;                 /* Position to first data record      */
     1582    10150    4            CALL FTI$SPFILE ALTRET(CLSTAP);
     1583    10151    4            END;
     1584    10152    3         FT$DDT.POS = FTP_BOD#;            /* Now in data area                   */
     1585    10153    3         END;
     1586    10154    2      F$DCB.FSN = FILE_SEQ;                /* Return file sequence number        */
     1587    10155
     1588    10156         /***
     1589    10157          *** Remember creation date.
     1590    10158          ***/
     1591    10159
     1592    10160    2      IF AFPOOL$->FT$ANYLBL.LABEL_TYPE = 'HDR1' THEN
     1593    10161    3         IF AFPOOL$->FT$LBL1.CREATE_DATE ~= ' ' THEN DO;
     1594    10162    3            CALL FTO_CHECK_DIGITS(AFPOOL$->FT$LBL1.CREATE_DATE,5) ALTRET(BADDATE);
     1595    10163    3            CALL UMT$UTSJ( CREATE_DATE_UTS, AFPOOL$->FT$LBL1.CREATE_DATE );
     1596    10164    3            END;
     1597    10165    2          ELSE
     1598    10166    2   BADDATE: CALL SSS$SYSTIME( CREATE_DATE_UTS );
     1599    10167    2       ELSE
     1600    10168    2         CALL SSS$SYSTIME( CREATE_DATE_UTS );
     1601    10169
     1602    10170         /***
     1603    10171          *** For CP-6 format files, do FIT checks.
     1604    10172          ***/
     1605    10173
     1606    10174    2      CALL FTO_SETTAPTYP;                  /* Determine type of file             */
     1607    10175    2      IF F$DCB.TAPTYP.CP6F
     1608    10176    3       THEN DO;                            /* CP-6 format                        */
     1609    10177    3         F$DCB.CNVRT = %NO#;
     1610    10178    3         F$DCB.ARS = 4096;                 /* FIT size                           */
     1611    10179    3         CALL FTI$RDBIN(AFPOOL$) ALTRET(CLSTAP);
     1612    10180    3         IF F$DCB.TYC.EOF(1)
     1613    10181    4          THEN DO;                         /* What, no FIT?                      */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:47   
     1614    10182    4            F$DCB.ARS = -1;                /* Backup                             */
     1615    10183    4            CALL FTI$SPFILE ALTRET(CLSTAP);
     1616    10184    4            END;
     1617    10185    3         IF F$DCB.ARS > 24
     1618    10186    3          THEN TEMP$ = PINCRW( AFPOOL$, SIZEW(AFPOOL$->FM$GRAN) );
     1619    10187    3          ELSE TEMP$ = AFPOOL$;
     1620    10188    3         END;
     1621    10189    3       ELSE DO;                            /* No FIT                             */
     1622    10190    3         J = 0;
     1623    10191    3         TEMP$ = ADDR(J);
     1624    10192    3         END;
     1625    10193
     1626    10194    2      F$DCB.OWNER = %YES#;                 /* Only protect by account            */
     1627    10195    2      IF F$DCB.ORG = %RESTRICT#
     1628    10196    2        AND NOT B$JIT.PRIV.ACTIVE & %PR_FMBLK#
     1629    10197    2       THEN B$JIT.ERR = E_NORESTRICT; /*E* ERROR: FTO-E$NORESTRICT */
     1630    10198    2       ELSE CALL FMO$SECCHK(PN$.V_->FPT$OPEN_V,TEMP$->FM$FIT);
     1631    10199                                           /* Pass V area and FIT for security checks */
     1632    10200    2      IF (F$DCB.BLKL > 4096 * (B$JIT.FBUL-2)) AND NOT F$DCB.TAPTYP.USRBUF
     1633    10201    2       THEN B$JIT.ERR = E_NOFPOOL; /*E* FTO-E$NOFPOOL */
     1634    10202    2      IF B$JIT.ERR
     1635    10203    3       THEN DO;                            /* Some error...                      */
     1636    10204    3         ERRSAV = B$JIT.ERR;
     1637    10205    3         B$JIT.ERR = '0'B;
     1638    10206    3         CALL FTC$DFLTCLOSE;               /* Close this file                    */
     1639    10207    3         B$JIT.ERR = '0'B;
     1640    10208    3         IF PN$.V_->FPT$OPEN_V.OPER.NXTF AND NOT PN$.V_->FPT$OPEN_V.OPER.THISF
     1641    10209    3           AND ERRSAV.ERR# = %E$NOFILE
     1642    10210    3          THEN GOTO ATTEMPT_OPEN_EXISTING;
             10210                   /* Access not allowed...try to open next file */
     1643    10211    4          ELSE DO;
     1644    10212    4            IF ERRSAV.ERR# = %E$NOFILE
     1645    10213    5             THEN DO;                 /* Can't hide file so don't permit access  */
     1646    10214    5               F$DCB.NAME.C = ' ';
     1647    10215    5               F$DCB.NAME.L = 0;
     1648    10216    5               ERRSAV = E_NOACCESS; /*E* ERROR: FTO-E$NOACCESS */
     1649    10217    5               END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:48   
     1650    10218    5             ELSE DO;                      /* Return name of inaccessible file   */
     1651    10219    5               CALL INDEX( J, ' ', FILE_NAME )
     1652    10220    6                WHENALTRETURN DO;
     1653    10221    6                  J = 31;
     1654    10222    6                  END;
     1655    10223    5               F$DCB.NAME.C = FILE_NAME;
     1656    10224    5               F$DCB.NAME.L = J;
     1657    10225    5               END;
     1658    10226    4            GOTO CLSTAPERR;
     1659    10227    4            END;
     1660    10228    3         END;
     1661    10229
     1662    10230         /***
     1663    10231          *** Get indexed file information if needed.
     1664    10232          ***/
     1665    10233
     1666    10234    2      IF F$DCB.ORG = %INDEXED#
     1667    10235    3       THEN DO;
     1668    10236    3         AFPOOL$ = TEMP$;
     1669    10237    3         J = 2;
     1670    10238    3         CALL FMO$LOCCODE(AFPOOL$,J);
     1671    10239    3         F$DCB.KEYX = AFPOOL$->CODE02.KEYX;
     1672    10240    3         F$DCB.KEYL = AFPOOL$->CODE02.KEYL;
     1673    10241    3         END;
     1674    10242
     1675    10243         /***
     1676    10244          *** Set file name.
     1677    10245          ***/
     1678    10246
     1679    10247    2      CALL INDEX( J, ' ', FILE_NAME )
     1680    10248    3       WHENALTRETURN DO;
     1681    10249    3         J = 31;
     1682    10250    3         END;
     1683    10251    2      F$DCB.NAME.C = FILE_NAME;
     1684    10252    2      F$DCB.NAME.L = J;
     1685    10253
     1686    10254    2      IF F$DCB.TAPTYP.CP6F
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:49   
     1687    10255    3       THEN DO;
     1688    10256    3         AFPOOL$ = TEMP$;
     1689    10257    3         J = 3;
     1690    10258    3         CALL FMO$LOCCODE( AFPOOL$, J );
     1691    10259    3         F$DCB.TYPE = AFPOOL$->CODE03.TYPE;
     1692    10260    3         END;
     1693    10261    2       ELSE F$DCB.TYPE = ' ';
     1694    10262
     1695    10263         /***
     1696    10264          *** Return FIT if requested.
     1697    10265          ***/
     1698    10266
     1699    10267    2      IF PN$.FPARAM_ ~= ADDR(NIL)
     1700    10268    3       THEN DO;                            /* Return FIT if requested            */
     1701    10269    3         IF F$DCB.TAPTYP.CP6F
     1702    10270    3          THEN CALL FMO$TRNINFO( PN$.FPARAM_, TEMP$ ) ALTRET(CLSTAP);
     1703    10271    4          ELSE DO;                         /* Build creation only FIT            */
     1704    10272    4            AFPOOL$ = PN$.FPARAM_;
     1705    10273    4            AFPOOL$->FM$FIT.CODES(0) = '0'B;
     1706    10274    4            AFPOOL$->FM$FIT.CODES.CODE(0) = 1;
     1707    10275    4            AFPOOL$->FM$FIT.CODES.CODE(1) = 04;
     1708    10276    4            AFPOOL$->FM$FIT.CODES.NAW(1) = LENGTHW( CODE04 );
     1709    10277    4            AFPOOL$->FM$FIT.CODES.NDW(1) = LENGTHW( CODE04 );
     1710    10278    4            AFPOOL$->FM$FIT.CODES.ITEMX(1) = 2;
     1711    10279    4            TEMP$ = PINCRW( AFPOOL$, AFPOOL$->FM$FIT.CODES.ITEMX(1) );
     1712    10280    4            TEMP$->CODE04.ACCESS.TIME = CREATE_DATE_UTS;
     1713    10281    4            TEMP$->CODE04.MODIFY.TIME = CREATE_DATE_UTS;
     1714    10282    4            TEMP$->CODE04.CREATION.TIME = CREATE_DATE_UTS;
     1715    10283    4            TEMP$->CODE04.SVMODIFY.TIME = 0;
     1716    10284    4            TEMP$->CODE04.GAC.N = 0;
     1717    10285    4            TEMP$->CODE04.GAC.TIME = 0;
     1718    10286    4            TEMP$->CODE04.CREATOR = '0'B;
     1719    10287    4            TEMP$ = PINCRW( TEMP$, LENGTHW(CODE04) );
     1720    10288    4            AFPOOL$->FM$FIT.CODES.NAW(0) = POFFW( TEMP$, AFPOOL$ );
     1721    10289    4            END;
     1722    10290    3         END;
     1723    10291                                                /* Return FIT if requested            */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:50   
     1724    10292    2      RETURN;
     1725    10293
     1726    10294    2   RETFSN: ;
     1727    10295    2      IF F$DCB.SETX ~= 0 AND B$JIT.ERR.CODE = %E$EOSET
     1728    10296    3       THEN DO;                            /* Return end of set sequence         */
     1729    10297    3         DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;
     1730    10298    3         F$DCB.FSN = FT$DDT.FSN; /* FSN of last (or before first) file of set    */
     1731    10299    3         END;
     1732    10300    2   CLSTAP: ;
     1733    10301    2      ERRSAV = B$JIT.ERR;
     1734    10302    2   CLSTAPERR: ;
     1735    10303    2      CALL FRB$CLS;
     1736    10304    2      B$JIT.ERR = ERRSAV;
     1737    10305
     1738    10306    2   JUSTALT: ;
     1739    10307    2      ALTRETURN;
     1740    10308
     1741    10309    2   END FTO_OPNEXISTING;
     1742    10310        /*********************************************************************/
     1743    10311        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:51   
     1744    10312        /*********************************************************************/
     1745    10313    1   FTO_CHECK_DIGITS: PROC(STRING,LEN) ALTRET;
     1746    10314        /*F*    NAME: FTO_CHECK_DIGITS
     1747    10315                PURPOSE: Make sure the passed string contains only digits. */
     1748    10316
     1749    10317    2   DCL LEN UBIN;
     1750    10318    2   DCL STRING CHAR(LEN);
     1751    10319    2   DCL IX SBIN;
     1752    10320    2   DCL IC SBIN;
     1753    10321
     1754    10322    3      DO IX = LEN-1 DOWNTO 0;
     1755    10323    3         IC = ASCBIN(SUBSTR(STRING,IX,1)) - 48;
     1756    10324    3         IF IC > 9 THEN
     1757    10325    3            ALTRETURN;
     1758    10326    3         END;
     1759    10327    2      RETURN;
     1760    10328
     1761    10329    2   END FTO_CHECK_DIGITS;
     1762    10330        /*********************************************************************/
     1763    10331        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:52   
     1764    10332        /*********************************************************************/
     1765    10333    1   FTO_SETTAPTYP: PROC;
     1766    10334        /*F*    NAME: FTO_SETTAPTYP
     1767    10335                PURPOSE: Sets up DCB.TAPTYP from DCB info.
     1768    10336         ***/
     1769    10337
     1770    10338        /********************/
     1771    10339
     1772    10340    2      F$DCB.DVBYTE = '0'B;                 /* Not generally used for tapes       */
     1773    10341    3      DO CASE(F$DCB.ORG);                  /* Depends on ORG                     */
     1774    10342    3       CASE(%UNDEF#,%VARIABLE#,%FIXED#);
     1775    10343    3         F$DCB.TAPTYP.RWASC = %YES#;       /* Read/write in ASCII mode           */
     1776    10344    3         F$DCB.TAPTYP.CP6F = %NO#;         /* Not a CP-6 format                  */
     1777    10345    3         F$DCB.TYPE = '  ';                /* No type                            */
     1778    10346    3       CASE( %RESTRICT# );
     1779    10347    3         F$DCB.TAPTYP.RWASC = %NO#;
     1780    10348    3         F$DCB.TAPTYP.CP6F = ~ NO_IFPARAM_RESTRICT;
     1781    10349    3         F$DCB.EBCDIC = %NO#;
     1782    10350    3         F$DCB.CNVRT = %NO#;
     1783    10351    3       CASE(ELSE);
     1784    10352    3         F$DCB.TAPTYP.RWASC = %NO#;        /* Read/write binary                  */
     1785    10353    3         F$DCB.TAPTYP.CP6F = %YES#;        /* CP-6 format                        */
     1786    10354    3       END;
     1787    10355    3      DO CASE(F$DCB.ORG);
     1788    10356    3       CASE(%UNDEF#,%RANDOM#,%RESTRICT#,%IDS#,%FREE#);
     1789    10357    3         F$DCB.TAPTYP.USRBUF = %YES#;      /* Read/write user buffer             */
     1790    10358    3       CASE(ELSE);
     1791    10359    3         F$DCB.TAPTYP.USRBUF = %NO#;       /* Read/write FPOOL buffer            */
     1792    10360    3       END;
     1793    10361    3      DO CASE(F$DCB.ORG);
     1794    10362    3       CASE(%RANDOM#,%IDS#,%RESTRICT#);
     1795    10363    3         F$DCB.IORG = %RANDOM#;
     1796    10364    3       CASE(%KEYED#,%INDEXED#);
     1797    10365    3         F$DCB.IORG = %KEYED#;
     1798    10366    3       CASE(%CONSEC#,%RELATIVE#,%IREL#);
     1799    10367    3         F$DCB.IORG = %CONSEC#;
     1800    10368    3       CASE(%SYMB#);
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:53   
     1801    10369    3         F$DCB.IORG = %SYMB#;
     1802    10370    3       CASE(%UR#);
     1803    10371    3         F$DCB.IORG = %UR#;
     1804    10372    3         F$DCB.IFMT = FMTURFILE#;
     1805    10373    3       CASE(ELSE);
     1806    10374    3         F$DCB.IORG = %UNDEF#;
     1807    10375    3       END;
     1808    10376    2      F$DCB.DVBYTE.BIN = ~ F$DCB.TAPTYP.RWASC;
     1809    10377
     1810    10378    2      RETURN;
     1811    10379
     1812    10380    2   END FTO_SETTAPTYP;
     1813    10381        /*********************************************************************/
     1814    10382        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:54   
     1815    10383        /*********************************************************************/
     1816    10384    1   FTO_GETSN: PROC ALTRET;
     1817    10385        /*F*     NAME: FTO_GETSN
     1818    10386                 PURPOSE: Determine initial serial number.
     1819    10387         ***/
     1820    10388
     1821    10389        /********************/
     1822    10390
     1823    10391         /***
     1824    10392          *** Scratch mount implied if no SN.  Otherwise put SN list in
     1825    10393          *** the CFU area.
     1826    10394          ***/
     1827    10395
     1828    10396    2      IF F$DCB.PSN = ' '
     1829    10397    3       THEN DO;                            /* Scratch SN                         */
     1830    10398    3         IF F$DCB.MAXVOL > 0
     1831    10399    3          THEN F$DCB.MAXVOL = F$DCB.MAXVOL - 1;
     1832    10400                                                /* Need at least one volume           */
     1833    10401    3         IF F$DCB.VOL > 1
     1834    10402    4          THEN DO;                         /* Don't have specified volume        */
     1835    10403    4            B$JIT.ERR = E_VOLERR; /*E* ERROR: FTO-E$VOLERR */
     1836    10404    4            ALTRETURN;
     1837    10405    4            END;
     1838    10406    3          ELSE F$DCB.VOL = 1;              /* At first volume                    */
     1839    10407    3         END;
     1840    10408    3       ELSE DO;
     1841    10409    3         CALL FTO_SNLIST ALTRET(JUSTALT);
     1842    10410    3         END;
     1843    10411    2      RETURN;
     1844    10412
     1845    10413    2   JUSTALT: ;
     1846    10414    2      ALTRETURN;
     1847    10415
     1848    10416    2   END FTO_GETSN;
     1849    10417        /*********************************************************************/
     1850    10418        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:55   
     1851    10419        /*********************************************************************/
     1852    10420    1   FTO_SNLIST: PROC ALTRET;
     1853    10421        /*F*    NAME: FTO_SNLIST
     1854    10422                PURPOSE: Merge user specified SN list into the DCB.
     1855    10423         ***/
     1856    10424
     1857    10425         /***
     1858    10426          *** AUTO data:
     1859    10427          ***/
     1860    10428
     1861    10429    2   DCL CFUX SBIN AUTO;                /* Offset from CFU base to current CFU     */
     1862    10430    2   DCL PCFU$ PTR AUTO;                     /* Pointer to previous CFU            */
     1863    10431    2   DCL PSN CHAR(6) AUTO;                   /* Test serial number                 */
     1864    10432    2   DCL SN$ PTR AUTO;                       /* Pointer to user specified SN list  */
     1865    10433    2   DCL JRNL_OFFSET SBIN AUTO;         /* JRNL SN list doesn't include first SN   */
     1866    10434        /********************/
     1867    10435
     1868    10436         /***
     1869    10437          *** Default begin at first volume.
     1870    10438          ***/
     1871    10439
     1872    10440    2      SN$ = PN$.SN_;                       /* Get pointer to SN list             */
     1873    10441    2      IF F$DCB.VOL <= 0 THEN F$DCB.VOL = 1; /* Default first SN                  */
     1874    10442
     1875    10443         /***
     1876    10444          *** If no SN list is specified, only one vol exists.
     1877    10445          ***/
     1878    10446
     1879    10447    2      IF SN$ = ADDR(NIL)
     1880    10448    3       THEN DO;                            /* No SN list                         */
     1881    10449    3         IF F$DCB.VOL = 1
     1882    10450    3          THEN RETURN;                     /* Primary volume is selected volume  */
     1883    10451    4          ELSE DO;
     1884    10452    4            B$JIT.ERR = E_VOLERR; /*E* ERROR: FTO-E$VOLERR */
     1885    10453    4            ALTRETURN;
     1886    10454    4            END;
     1887    10455    3         END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:56   
     1888    10456
     1889    10457         /***
     1890    10458          *** If no SN list and first vol, just return.
     1891    10459          ***/
     1892    10460
     1893    10461    2      I = SN$->VLP$SN_V.NUM;
     1894    10462    2      IF F$DCB.ACS = %JRNL#
     1895    10463    3       THEN DO;                            /* Skip first SN if JRNL              */
     1896    10464    3         JRNL_OFFSET = 1;
     1897    10465    3         SN$ = PINCRC( SN$, 6 );
     1898    10466    3         END;
     1899    10467    2       ELSE JRNL_OFFSET = 0;
     1900    10468    2      I = I - JRNL_OFFSET;
     1901    10469    2      IF F$DCB.VOL = 1 AND I <= 0 THEN RETURN;
     1902    10470
     1903    10471         /***
     1904    10472          *** Account for blank serial numbers at list end as DCB.MAXVOL.
     1905    10473          ***/
     1906    10474
     1907    10475    2      I = I - 1;                           /* Index of last SN                   */
     1908    10476    2      J = 0;                               /* Non-blank SN flag                  */
     1909    10477    3      DO WHILE( I >= 0  AND  J = 0 );
     1910    10478    3         IF SN$->VLP$SN_V.SN(I) = ' '
     1911    10479    4          THEN DO;
     1912    10480    4            F$DCB.MAXVOL = F$DCB.MAXVOL + 1;
     1913    10481    4            I = I - 1;
     1914    10482    4            END;
     1915    10483    3          ELSE J = 1;
     1916    10484    3         END;
     1917    10485
     1918    10486    2      I = I + 1;                           /* # SNs actually in list             */
     1919    10487
     1920    10488         /***
     1921    10489          *** If the initial volume number is greater than the number
     1922    10490          *** of volumes, error.
     1923    10491          ***/
     1924    10492
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:57   
     1925    10493    2      IF F$DCB.VOL > I
     1926    10494    3       THEN DO;                            /* Initial volume not in list         */
     1927    10495    3         B$JIT.ERR = E_VOLERR; /*E* ERROR: FTO-E$VOLERR */
     1928    10496    3         ALTRETURN;
     1929    10497    3         END;
     1930    10498
     1931    10499         /***
     1932    10500          *** Make sure no blank or duplicate SNs are in list.
     1933    10501          ***/
     1934    10502
     1935    10503    3      DO J = 0 TO I - 2;                   /* Which SN to compare                */
     1936    10504    3         PSN = SN$->VLP$SN_V.SN(J);
     1937    10505    3         IF PSN = ' '
     1938    10506    4          THEN DO;                         /* Blank SN                           */
     1939    10507    4            B$JIT.ERR = E_BRDUPSN; /*E* ERROR: FTO-E$BRDUPSN */
     1940    10508    4            ALTRETURN;
     1941    10509    4            END;
     1942    10510    4         DO CFUX = J+1 TO I-1;
     1943    10511    4            IF PSN = SN$->VLP$SN_V.SN(CFUX)
     1944    10512    5             THEN DO;                      /* Duplicate SN                       */
     1945    10513    5               B$JIT.ERR = E_BRDUPSN; /*E* ERROR: FTO-E$BRDUPSN */
     1946    10514    5               ALTRETURN;
     1947    10515    5               END;
     1948    10516    4            END;
     1949    10517    3         END;
     1950    10518
     1951    10519         /***
     1952    10520          *** Current SN is that specified by DCB.VOL.
     1953    10521          ***/
     1954    10522
     1955    10523    2      F$DCB.PSN = SN$->VLP$SN_V.SN(F$DCB.VOL - 1);
     1956    10524    2      IF I <= 1 THEN RETURN;               /* No CFUs needed                     */
     1957    10525
     1958    10526         /***
     1959    10527          *** Create CFU SN list linked to DCB.
     1960    10528          ***/
     1961    10529
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:58   
     1962    10530    2      CALL FMR$G8(PCFU$,CFUX) ALTRET(NOCFUS);
     1963    10531    2      IF F$DCB.ACS = %JRNL#
     1964    10532    2       THEN F$DCB.CFU$->FM$CFUJ.SNLINKX = CFUX; /* Link to CFU already there     */
     1965    10533    2       ELSE F$DCB.CFU$ = PCFU$;
     1966    10534    3      DO WHILE(I > 4);                     /* Process complete SN blocks         */
     1967    10535    3         PCFU$->FT$CFUSN.SYSID = B$JIT.SYSID; /* Remember user info              */
     1968    10536    3         PCFU$->FT$CFUSN.DCBX = JDCB.DCBX;
     1969    10537    3         PCFU$->FT$CFUSN.NUM = 4;          /* 4 SNs in this CFU                  */
     1970    10538    3         PCFU$->FOUR_SNS.SNS = SN$->FOUR_SNS.SNS; /* Move next 4 SNs             */
     1971    10539    3         CALL FMR$G8(TEMP$,CFUX) ALTRET(NOTENUFCFUS); /* Get next SN CFU         */
     1972    10540    3         PCFU$->FT$CFUSN.LINKX = CFUX;     /* Link current CFU to last           */
     1973    10541    3         PCFU$ = TEMP$;                    /* Make current CFU previous          */
     1974    10542    3         SN$ = PINCRW( SN$, 6 );           /* Point to next group of 4 SNs       */
     1975    10543    3         I = I - 4;                        /* Processed 4 more                   */
     1976    10544    3         END;
     1977    10545    2      PCFU$->FT$CFUSN.SYSID = B$JIT.SYSID; /* Remember user info                 */
     1978    10546    2      PCFU$->FT$CFUSN.DCBX = JDCB.DCBX;
     1979    10547    2      PCFU$->FT$CFUSN.NUM = I;             /* Set # SNs in last CFU              */
     1980    10548    3      DO WHILE (I >= 1);
     1981    10549    3         I = I - 1;                        /* Convert # to index                 */
     1982    10550    3         PCFU$->FT$CFUSN.SN(I) = SN$->VLP$SN_V.SN(I);
     1983    10551    3         END;
     1984    10552    2      RETURN;
     1985    10553
     1986    10554         /***
     1987    10555          *** Not enough CFUs were available.
     1988    10556          ***/
     1989    10557
     1990    10558    2   NOTENUFCFUS:
     1991    10559    2      CALL FTR$RELCFUS;
     1992    10560
     1993    10561    2   NOCFUS:
     1994    10562           /*E* ERROR: FTO-E$NOCFUS */
     1995    10563    2      B$JIT.ERR = E_NOCFUS;
     1996    10564    2      ALTRETURN;
     1997    10565
     1998    10566    2   END FTO_SNLIST;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:59   
     1999    10567        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:60   
     2000    10568        /***************************************************************/
     2001    10569    1   FTO$SNLIST: ENTRY(PN$);
     2002    10570        /*F*  NAME: FTO$SNLIST
     2003    10571              PURPOSE:  Provide external entry to FTO_SNLIST for OD use.
     2004    10572        */
     2005    10573
     2006    10574    1      JDCB$ = B$JIT.DCB$;
     2007    10575    1      CALL FTO_SNLIST;
     2008    10576    1      RETURN;
     2009    10577
     2010    10578        /*********************************************************************/
     2011    10579    1   END FTO$OPNAT;
     2012    10580        /*********************************************************************/

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:61   
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FT_SUBS.:E05TOU  is referenced.
   FT$RECS.:E05TOU  cannot be made into a system file and is referenced.
   FT$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FT$DDT.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   FM$CFU.:E05TOU  is referenced.
   FM_BUF_R.:E05TOU  cannot be made into a system file and is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FTO$OPNAT.

   Procedure FTO$OPNAT requires 3230 words for executable code.
   Procedure FTO$OPNAT requires 48 words of local(AUTO) storage.

    No errors detected in file FTO$OPNAT.:E05TSI    .

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:62   

 Object Unit name= FTO$OPNAT                                  File name= FTO$OPNAT.:E05TOU
 UTS= JUL 29 '97 18:01:41.24 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     53     65  FTO$OPNAT
    2   Proc  even  none  3230   6236  FTO$OPNAT
    3  RoData even  none    46     56  FTO$OPNAT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        1  FTO$OPNAT
     2   6226                  yes      Std        1  FTO$SNLIST

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  FT_DENS
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:63   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMO$GETDOMAIN
 yes     yes           Std       1 FMH$JGETPG
 yes     yes           Std       3 FTW$WRAT
 yes     yes           Std       2 FSA$GSP
         yes           Std       1 FMD$FLSHBUF
         yes           Std       0 FTC$DFLTCLOSE
         yes           Std       3 FMD$GETBUF
 yes     yes           Std       0 FTR$RELFPOOLS
 yes     yes           Std       1 UQB$MDEQ
 yes     yes           Std       0 FTR$RELCFUS
         yes           Std       0 FMP$CLSERR
 yes     yes           Std       0 FTI$WRFM
         yes           Std       0 FRB$CLS
 yes     yes           Std       0 FTR$DPT
 yes     yes           Std       2 HFF$DSIZ
 yes     yes           Std       0 FRA$OPR
 yes     yes           Std       2 FTR$SETSN
 yes     yes           Std       0 FTI$REWIND
 yes     yes           Std       1 FMN$CHKFLACN
 yes     yes           Std       1 FTL$SPF
 yes     yes           Std       0 FTL$PEOS
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       0 FTL$VOL1
 yes     yes           Std       2 FTL$LBLS
         yes           Std       2 FMO$SECCHK
 yes     yes           Std       5 FTL$CVOL
 yes     yes           Std       3 FTL$ULBLS
 yes     yes           Std       1 FMO$BLDFIT
 yes     yes           Std       2 UMT$JDATE
 yes     yes           Std       1 FTI$WRBIN
 yes     yes           Std       0 FTI$SPFILE
 yes     yes           Std       0 FTI$SPREC
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:64   
 yes     yes           Std       3 XUD$UTS_ADJUST
 yes     yes           Std       0 FSF$TAPEFORM
 yes     yes           Std       3 FTL$GETULBLS
 yes     yes           Std       0 FTL$FINDSEQ
 yes     yes           Std       1 FTI$RDASCEBC
 yes     yes           Std       2 FMO$TRNINFO
 yes     yes           Std       0 FTL$FINDHDR1
 yes     yes           Std       0 FTL$FINDSEQIBM
 yes     yes           Std       0 FTL$FINDFILE
 yes     yes           Std       2 UMT$UTSJ
 yes     yes           Std       1 FTI$RDBIN
 yes     yes           Std       2 FMO$LOCCODE
 yes     yes           Std       0 FTL$FINDNEXT
 yes     yes           Std       2 FMR$G8
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  FM$BUF$                               N$DCT$$
     B$JIT$                                FT_PROT                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:65   


        1        1        /*M* FTO$OPNAT contains tape opening routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* THI=1,PLM=3,MCL=10 */
        8        8
        9        9        FTO$OPNAT: PROC(PN$);

      9  2 000000   000000 700200 xent  FTO$OPNAT    TSX0  ! X66_AUTO_1
         2 000001   000060 000001                    ZERO    48,1

       10       10
       11       11        /*F*    NAME: FTO$OPNAT
       12       12                PURPOSE: Contains tape opening routines.
       13       13         ***/
       14       14        /*P*    NAME: FTO$OPNAT
       15       15                PURPOSE: Opens tape DCB.
       16       16                INPUT: PN$ - pointers from FPT_OPEN
       17       17         ***/
       18       18
       19       19         /***
       20       20          *** INCLUDE files:
       21       21          ***/
       22       22
       23       23        %INCLUDE B$JIT_C;
       24      337           %B$JIT0;
       25      426           %U$JIT1X;
       26      429           %M$JIT2;
       27      439           %F$JIT3;
       28      444           %S$JIT4X;
       29      447           %J$JIT5X;
       30      450           %A$JIT6X;
       31      453        %INCLUDE CP_6;
       32     6012        %INCLUDE CP_6_SUBS;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:66   
       33     6552        %INCLUDE F$CP6P_C;
       34     6563        %INCLUDE F$CP6V_C;
       35     6789           %FPT$OPEN_V;
       36     6804           %VLP$SN_V;
       37     6807        %MACRO F$DCBBJ(BASED=BASED);
       38     6808        %INCLUDE F$DCB;
       39     6857        %MEND;
       40     6858           %F$DCBBJ(BASED="BASED(JDCB$)");
       41     6908        %INCLUDE F_ERRORS_C;
       42     7148        %INCLUDE F_FMTCODE_C;
       43     7182        %INCLUDE F_FPTCODE_C;
       44     7218        %INCLUDE FM_BUF_R;
       45     7227        %INCLUDE FM$CFU;
       46     7272            %FT$CFUSN;
       47     7275           %FM$CFUJ;
       48     7280        %INCLUDE FM$GRAN;
       49     7349            %FM$GRAN;
       50     7353        %INCLUDE FM$FIT;
       51     7574            %FM$FIT;
       52     7577           %CODE02;
       53     7581           %CODE03;
       54     7588           %CODE04;
       55     7596        %CODE16;
       56     7604        %MACRO FT$DDTBD(BASED=BASED);
       57     7605        %INCLUDE FT$DDT;
       58     7666        %MEND;
       59     7667           %FT$DDTBD(BASED="BASED(DDDT$)");
       60     7729        %INCLUDE FT$LBLS;
       61     7997        %INCLUDE FT$RECS;
       62     8065        %INCLUDE FT_SUBS;
       63     8145        %INCLUDE NK$LDCT;
       64     8247            %NK$LDCT;
       65     8293        %INCLUDE NK_LDCT_R;
       66     8302        %INCLUDE XUD_UTS_M;
       67     8384         %XUD$UTS_ENTRIES;
       68     8416         %XUD_UTS_EQU;
       69     8427
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:67   
       70     8428         /***
       71     8429          *** External routines:
       72     8430          ***/
       73     8431
       74     8432    1   DCL FMD$FLSHBUF ENTRY(1);               /* Flush specified buffer             */
       75     8433    1   DCL FMD$GETBUF ENTRY(3);                /* Get specified buffer               */
       76     8434    1   DCL FMH$JGETPG ENTRY(1) ALTRET;         /* Get journal page                   */
       77     8435    1   DCL FMN$CHKFLACN ENTRY(1) ALTRET;       /* Verify file name and account       */
       78     8436    1   DCL FMP$CLSERR ENTRY;                   /* Release journal CFUs               */
       79     8437    1   DCL FMO$BLDFIT ENTRY(1) ALTRET;         /* Build a FIT in FPOOL buffer        */
       80     8438    1   DCL FMO$GETDOMAIN ENTRY(1);             /* Get current domain                 */
       81     8439    1   DCL FMO$LOCCODE ENTRY(2) ALTRET;        /* Find FIT information               */
       82     8440    1   DCL FMO$SECCHK ENTRY(2);                /* Security checks                    */
       83     8441    1   DCL FMO$TRNINFO ENTRY(2) ALTRET;        /* Transfer FIT info                  */
       84     8442    1   DCL FMR$G8 ENTRY(2) ALTRET;             /* Get CFU                            */
       85     8443    1   DCL FRA$OPR ENTRY ALTRET;               /* Get tape mounted                   */
       86     8444    1   DCL FRB$CLS ENTRY;                      /* Close tape and release resource    */
       87     8445    1   DCL FRB$CREM ENTRY;                     /* Remove tape                        */
       88     8446    1   DCL FSA$FSP ENTRY(2) ALTRET;            /* Free RO space                      */
       89     8447    1   DCL FSA$GSP ENTRY(2) ALTRET;            /* Get RO space                       */
       90     8448    1   DCL FSF$TAPEFORM ENTRY ALTRET;          /* Set up FORM info for UR/SYMB       */
       91     8449    1   DCL FTC$DFLTCLOSE ENTRY;                /* Default close after test open      */
       92     8450    1   DCL FTI$RDASCEBC ENTRY(1) ALTRET;       /* Read ASCII/EBCDIC label            */
       93     8451    1   DCL FTI$RDBIN ENTRY(1) ALTRET;          /* Read binary record (get FIT)       */
       94     8452    1   DCL FTI$REWIND ENTRY ALTRET;            /* Rewind tape                        */
       95     8453    1   DCL FTI$SPFILE ENTRY ALTRET;            /* Space DCB.ARS files                */
       96     8454    1   DCL FTI$SPREC ENTRY ALTRET;             /* Space DCB.ARS records              */
       97     8455    1   DCL FTI$WRBIN ENTRY(1) ALTRET;          /* Write specified buffer in binary   */
       98     8456    1   DCL FTI$WRFM ENTRY ALTRET;              /* Write file mark                    */
       99     8457    1   DCL FTL$CVOL ENTRY(5) ALTRET;           /* Volume changing                    */
      100     8458    1   DCL FTL$FINDFILE ENTRY ALTRET;          /* Find file by name and section      */
      101     8459    1   DCL FTL$FINDHDR1 ENTRY ALTRET;          /* Find next HDR1                     */
      102     8460    1   DCL FTL$FINDNEXT ENTRY ALTRET;          /* Find next file, ignore FSN.        */
      103     8461    1   DCL FTL$FINDSEQ ENTRY ALTRET;           /* Find file by sequence and section  */
      104     8462    1   DCL FTL$FINDSEQIBM ENTRY ALTRET;        /* Find file by sequence, IBM tapes   */
      105     8463    1   DCL FTL$GETFSN ENTRY ALTRET;            /* Get file sequence number from tape */
      106     8464    1   DCL FTL$GETULBLS ENTRY(3) ALTRET;       /* Get user labels                    */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:68   
      107     8465    1   DCL FTL$LBLS ENTRY(2) ALTRET;           /* Write specified label (HDR)        */
      108     8466    1   DCL FTL$PEOS ENTRY ALTRET;              /* Position to end of volume set      */
      109     8467    1   DCL FTL$SPF ENTRY(1) ALTRET;            /* Position to next beginning-of-file */
      110     8468    1   DCL FTL$ULBLS ENTRY(3) ALTRET;          /* Write user labels                  */
      111     8469    1   DCL FTL$VOL1 ENTRY ALTRET;              /* Write VOL1 label                   */
      112     8470    1   DCL FTR$CHNGVOL ENTRY(1) ALTRET;        /* Change to specified volume of set  */
      113     8471    1   DCL FTR$DPT ENTRY ALTRET;               /* Density, permit, type check/set    */
      114     8472    1   DCL FTR$RELCFUS ENTRY ALTRET;           /* Release CFUs                       */
      115     8473    1   DCL FTR$RELFPOOLS ENTRY ALTRET;         /* Release all FPOOL buffers          */
      116     8474    1   DCL FTR$SETSN ENTRY(2) ALTRET;          /* Set actual serial number           */
      117     8475    1   DCL FTW$WRAT ENTRY(3) ALTRET;
      118     8476    1   DCL HFF$DSIZ ENTRY(2) ALTRET;           /* Determine segment size             */
      119     8477    1   DCL SSS$SYSTIME ENTRY(1);               /* Get UTS                            */
      120     8478    1   DCL UMT$JDATE ENTRY(2) ALTRET;          /* Convert UTS to Julian date         */
      121     8479    1   DCL UMT$UTSJ ENTRY(2) ALTRET;           /* Converts Julian date to UTS        */
      122     8480    1   DCL UQB$MDEQ ENTRY(1) ALTRET;           /* Dequeue journal                    */
      123     8481
      124     8482         /***
      125     8483          *** SYMREF data:
      126     8484          ***/
      127     8485
      128     8486    1   DCL B$JIT$ PTR SYMREF;
      129     8487    1   DCL B_TICSDAY UBIN SYMREF;              /* Number of tics per day             */
      130     8488    1   DCL FT_PROT SBIN SYMREF;                /* System protection type             */
      131     8489
      132     8490         /***
      133     8491          *** Parameter:
      134     8492          ***/
      135     8493
      136     8494           %FPT$OPEN_P(FPTN=PN$,PFMT=PTR,STCLASS=" ");
      137     8500
      138     8501         /***
      139     8502          *** BASED:
      140     8503          ***/
      141     8504
      142     8505    1   DCL 1 LASTKEY UNAL BASED,
      143     8506    1         2 * CHAR(256) UNAL;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:69   
      144     8507    1   DCL 1 FOUR_SNS UNAL BASED,
      145     8508    1         2 * UBIN WORD UNAL,
      146     8509    1         2 SNS CHAR(24) UNAL;
      147     8510
      148     8511         /***
      149     8512          *** AUTO data:
      150     8513          ***/
      151     8514
      152     8515    1   DCL AFPOOL$ PTR AUTO;                   /* Pointer to FPOOL buffer            */
      153     8516    1   DCL ALABEL CHAR(3) AUTO;                /* Temporary for tape label.          */
      154     8517    1   DCL BACKUP_FM_CNT SBIN AUTO;            /* Number of file marks to back up    */
      155     8518    1   DCL CREATED_BY_CP6 BIT(1) AUTO;         /* Remembers HDR1 info                */
      156     8519    1   DCL CREATE_DATE_UTS UBIN AUTO;          /* Creation date UTS                  */
      157     8520    1   DCL CREATE_OLDFILE BIT(1) AUTO;    /* FUN=CREATE,EXIST=OLDFILE file exists    */
      158     8521    1   DCL DDDT$ PTR AUTO;                /* Pointer to DDT entry for DCB's device   */
      159     8522        %VLP_ERRCODE(FPTN=ERRSAV,STCLASS=AUTO); /* To save B$JIT.ERR                  */
      160     8567    1   DCL I SBIN AUTO;                        /* Used as temp and index             */
      161     8568    1   DCL J SBIN AUTO;                        /* Used as temp and index             */
      162     8569    1   DCL JDCB$ PTR AUTO;                     /* Pointer to DCB                     */
      163     8570    1   DCL 1 JDCB REDEF JDCB$,
      164     8571    1         2 DCBX UBIN HALF UNAL,            /* Index of DCB                       */
      165     8572    1         2 * UBIN HALF UNAL;
      166     8573    1   DCL MAXBLKL SBIN WORD AUTO;             /* Max possible BLKL                  */
      167     8574    1   DCL NO_IFPARAM_RESTRICT BIT(1) AUTO;    /* Indicates FITless RESTRICT file    */
      168     8575    1   DCL FILE_NAME CHAR(31) ALIGNED AUTO;    /* Name of current file on tape       */
      169     8576    1   DCL FILE_SEQ SBIN ALIGNED AUTO;    /* Sequence number of current file on tape */
      170     8577    1   DCL TEMP$ PTR AUTO;                     /* A useful item                      */
      171     8578
      172     8579         /***
      173     8580          *** CONSTANT data:
      174     8581          ***/
      175     8582
      176     8583        %EQU FT_MAXDENS = 6 ;
      177     8584    1   DCL FT_DENS(0:%%FT_MAXDENS) BIT(18) CONSTANT SYMDEF INIT(
              8584            /* Bits correspond to DCB.ATTR */
      178     8585    1                 '0'O,                     /* Unspecified                        */
      179     8586    1                 '0'O,                     /* No longer specified (7T)           */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:70   
      180     8587    1                 %ATTR_D800#,
      181     8588    1                 %ATTR_D1600#,
      182     8589    1                 %ATTR_D6250#,
      183     8590    1                 %ATTR_D38000#,
      184     8591    1                 '0'O );                   /* Unknown                            */
      185     8592
      186     8593        %EQU FT_MAXFMTS=4;
      187     8594    1   DCL FT_FORMAT(0:%FT_MAXFMTS) UBIN BYTE UNAL CONSTANT INIT(
      188     8595    1      ASCBIN('D'),
      189     8596    1      ASCBIN('S'),
      190     8597    1      ASCBIN('V'),
      191     8598    1      ASCBIN('F'),
      192     8599    1      ASCBIN('U') );
      193     8600                                      /* Known basic tape formats...U must be last    */
      194     8601        %EQU FT_MAXCP6FMT=10;
      195     8602    1   DCL FT_CP6FMT(0:%FT_MAXCP6FMT) UBIN BYTE UNAL CONSTANT INIT(
      196     8603    1      ASCBIN('C'),
      197     8604    1      ASCBIN('K'),
      198     8605    1      ASCBIN('R'),
      199     8606    1      ASCBIN('X'),
      200     8607    1      ASCBIN('x'),
      201     8608    1      ASCBIN('F'),
      202     8609    1      ASCBIN('I'),
      203     8610    1      ASCBIN('D'),
      204     8611    1      ASCBIN('U'),
      205     8612    1      ASCBIN('S'),
      206     8613    1      ASCBIN('i') );
      207     8614    1   DCL FT_CP6FMTORG(0:%FT_MAXCP6FMT) UBIN BYTE UNAL CONSTANT INIT(
      208     8615    1      %CONSEC#,
      209     8616    1      %KEYED#,
      210     8617    1      %RANDOM#,
      211     8618    1      %RESTRICT#,
      212     8619    1      %RESTRICT#,
      213     8620    1      %RELATIVE#,
      214     8621    1      %INDEXED#,
      215     8622    1      %IDS#,
      216     8623    1      %UR#,
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:71   
      217     8624    1      %SYMB#,
      218     8625    1      %IREL# );
      219     8626
      220     8627        %FPT_PFIL(FPTN=FPT_PFIL_EOF,BOF=NO,STCLASS=CONSTANT);
      221     8642
      222     8643        %FT$ERR( ERRNAME=E_ASCIITAP, MID='17'O, CODE=%E$ASCIITAP, SEV=2 );
      223     8651        /*E*    ERROR: FTO-E$ASCIITAP-2
      224     8652                 MESSAGE: You can't create an EBCDIC tape file on an ASCII
      225     8653                    volume set% (LT#%SN)%
      226     8654                DESCRIPTION: The user attempted to write an EBCDIC format file
      227     8655                   to an ASCII tape.
      228     8656         ***/
      229     8657
      230     8658        %FT$ERR( ERRNAME=E_BADFSN, MID='17'O, CODE=%E$BADFSN, SEV=2 );
      231     8666        /*E*     ERROR: FTO-E$BADFSN-2
      232     8667                 MESSAGE: FSN > 9999% for %TA%
      233     8668                 MESSAGE1: You can't create a tape file with file sequence
      234     8669                           number greater than 9999.
      235     8670                 DESCRIPTION: Obvious.
      236     8671         ***/
      237     8672
      238     8673        %FT$ERR( ERRNAME=E_BOT, MID='17'O, CODE=%E$BOT, SEV=2 );
      239     8681        /*E*     ERROR: FTO-E$BOT-2
      240     8682                 MESSAGE: Beginning of tape% on %TA%
      241     8683                 MESSAGE1: The beginning of tape was encountered on a
      242     8684                           backspace record or backspace file operation.
      243     8685         ***/
      244     8686
      245     8687        %FT$ERR( ERRNAME=E_BRDUPSN, MID='17'O, CODE=%E$BRDUPSN, SEV=2 );
      246     8695        /*E*     ERROR: FTO-E$BRDUPSN-2
      247     8696                 MESSAGE: Blank or duplicate serial number% on DCB %DC%
      248     8697                 MESSAGE1: The serial number list contains either a blank
      249     8698                    serial number between non-blank serial numbers or a
      250     8699                    serial number that is duplicated% on DCB %DC%.
      251     8700         ***/
      252     8701
      253     8702        %FT$ERR( ERRNAME=E_BLKL, MID='17'O, CODE=%E$BLKL, SEV=2 );
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:72   
      254     8710        /*E*     ERROR: FTO-E$BLKL-2
      255     8711                 MESSAGE: F$DCB.BLKL too large
      256     8712                 MESSAGE1: Due to the 9-to-8 conversion BLKL would be too large.
      257     8713         ***/
      258     8714
      259     8715        %FT$ERR( ERRNAME=E_EBCDICTAP, MID='17'O, CODE=%E$EBCDICTAP, SEV=2 );
      260     8723        /*E*     ERROR: FTO-E$EBCDICTAP-2
      261     8724                 MESSAGE: You can't create an ASCII tape file on an EBCDIC
      262     8725                    volume set% (LT#%SN)%
      263     8726                 DESCRIPTION: The user attempted to write an ASCII format file
      264     8727                   to an EBCDIC tape.
      265     8728         ***/
      266     8729
      267     8730        %FT$ERR( ERRNAME=E_EOSET, MID='17'O, CODE=%E$EOSET, SEV=2 );
      268     8738        /*E*     ERROR: FTO-E$EOSET-2
      269     8739                 MESSAGE: Beginning/end of volume set% looking for %TA%
      270     8740                 MESSAGE1: On an open NXTF the beginning or end of set
      271     8741                    was detected% on LT#%SN% looking for %TA%
      272     8742         ***/
      273     8743
      274     8744        %FT$ERR( ERRNAME=E_FUNNYPOS, MID='17'O, CODE=%E$FUNNYPOS, SEV=2 );
      275     8752        /*E*     ERROR: FTO-E$FUNNYPOS-2
      276     8753                 MESSAGE: Improper position% on %TA%
      277     8754                 MESSAGE1: Tape volume is not positioned for creating a new file.
      278     8755                 DESCRIPTION: The tape is positioned after an EOV label group
      279     8756                    or position is unknown.
      280     8757         ***/
      281     8758
      282     8759        %FT$ERR( ERRNAME=E_NOACCESS, MID='17'O, CODE=%E$NOACCESS, SEV=2 );
      283     8767        /*E*     ERROR: FTO-E$NOACCESS-2
      284     8768                 MESSAGE: Access denied% to %TA%% through DCB %DC%
      285     8769                 DESCRIPTION: Attempt to open a file to which access is denied.
      286     8770         ***/
      287     8771
      288     8772        %FT$ERR( ERRNAME=E_NOCFUS, MID='17'O, CODE=%E$NOCFUS, SEV=2 );
      289     8780        /*E*     ERROR: FTO-E$NOCFUS
      290     8781                 MESSAGE: No system table space for SN list% for %TA%
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:73   
      291     8782                 MESSAGE1: There is no CFU space for a serial number table.
      292     8783                 DESCRIPTION: There is not enough CFU space to hold the user's
      293     8784                    serial number list.
      294     8785         ***/
      295     8786
      296     8787        %FT$ERR( ERRNAME=E_NOIFPARAM, MID='17'O, CODE=%E$NOIFPARAM, SEV=2 );
      297     8795        /*E*     ERROR: FTO-E$NOIFPARAM
      298     8796                 MESSAGE: No IFPARAM specified% for %TA%
      299     8797                 MESSAGE1: Restrict tape files must have IFPARAM specified
      300     8798                           for creation.
      301     8799                 DESCRIPTION: An attempt to open a RESTRICT tape file in
      302     8800                    CREATE mode without having an IFPARAM buffer was made.
      303     8801         ***/
      304     8802
      305     8803        %FT$ERR( ERRNAME=E_NOFIDTHIS, MID='17'O, CODE=%E$NOFIDTHIS, SEV=2 );
      306     8811        /*E*     ERROR: FTO-E$NOFIDTHIS-2
      307     8812                 MESSAGE: No file specified% on DCB %DC%
      308     8813                 MESSAGE1: No file name or file sequence number is specified.
      309     8814                 DESCRIPTION: An attempt to open an input or update tape file
      310     8815                    with no name was specified.
      311     8816         ***/
      312     8817
      313     8818        %FT$ERR( ERRNAME=E_NOFPOOL, MID='17'O, CODE=%E$NOFPOOL, SEV=2 );
      314     8826        /*E*     ERROR: FTO-E$NOFPOOL-2
      315     8827                 MESSAGE: Not enough FPOOLs% for %TA%
      316     8828                 MESSAGE1: FPOOL limit does not permit label processing and
      317     8829                    file blocking/deblocking.
      318     8830         ***/
      319     8831
      320     8832        %FT$ERR( ERRNAME=E_NORESTRICT, MID='17'O, CODE=%E$NORESTRICT, SEV=2 );
      321     8840        /*E*     ERROR: FTO-E$NORESTRICT-2
      322     8841                 MESSAGE: No access to RESTRICT format files allowed% on DCB %DC%
      323     8842                 MESSAGE1: FMBLK privilege is needed to access RESTRICT
      324     8843                    format tape files.
      325     8844         ***/
      326     8845
      327     8846        %FT$ERR( ERRNAME=E_NOSN, MID='17'O, CODE=%E$NOSN, SEV=2 );
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:74   
      328     8854        /*E*     ERROR: FTO-E$NOSN-2
      329     8855                 MESSAGE: No SN specified% on DCB %DC%
      330     8856                 MESSAGE1: An attempt to open an input or update volume with
      331     8857                    no serial number specified was made.
      332     8858         ***/
      333     8859
      334     8860        %FT$ERR( ERRNAME=E_NOTFREEORG, MID='17'O, CODE=%E$NOTFREEORG, SEV=2 );
      335     8868        /*E*     ERROR: FTO-E$NOTFREEORG-2
      336     8869                 MESSAGE: ORG not valid for managed tape% on DCB %DC%
      337     8870                 MESSAGE1: Only FREE, UNDEF, FIXED, and VARIABLE are permitted
      338     8871                    for managed free tape organizations.
      339     8872         ***/
      340     8873
      341     8874        %FT$ERR( ERRNAME=E_SCRORDER, MID='17'O, CODE=%E$SCRORDER, SEV=2 );
      342     8882        /*E*     ERROR: FTO-E$SCRORDER-2
      343     8883                 MESSAGE: Out of order ANSscratch volume% on DCB %DC%
      344     8884                 MESSAGE1: ANSscratch tapes can not be CVOLed to unless
      345     8885                           at beginning of volume set.
      346     8886                 DESCRIPTION: Attempt to open a scratch tape not at set beginning.
      347     8887                    This error helps to enforce ANS FSN field in HDR1 by ensuring
      348     8888                    that the correct FSN is always known.
      349     8889         ***/
      350     8890        %FT$ERR( ERRNAME=E_VOLERR, MID='17'O, CODE=%E$VOLERR, SEV=2 );
      351     8898        /*E*    ERROR: FTO-E$VOLERR-2
      352     8899                 MESSAGE: Specified VOL not in SN list% on DCB %DC%
      353     8900                 MESSAGE1: DCB.VOL specifies a volume not contained in the
      354     8901                           serial number list.
      355     8902                DESCRIPTION: DCB.VOL was greater than 1 and no serial number
      356     8903                   list was specified or DCB.VOL specified a serial number not
      357     8904                   contained within the list.
      358     8905         ***/
      359     8906        %FT$ERR( ERRNAME=E_WRONGSN , MID='17'O, CODE=%E$WRONGSN, SEV=2 );
      360     8914        /*E*    ERROR: FTO-E$WRONGSN-2
      361     8915                MESSAGE: End of volume set% on %TA%. Tape is empty.
      362     8916                MESSAGE1: The operator mounted a tape with a serial number
      363     8917                          different from the one in VOL1. This tape will be
      364     8918                          treated as an empty tape.
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:75   
      365     8919
      366     8920         ***/
      367     8921        %FT$ERR( ERRNAME=E_WRONGDENSITY , MID='17'O, CODE=%E$WRONGDENSITY, SEV=2 );
      368     8929        /*E*    ERROR: FTO-E$WRONGDENSITY-2
      369     8930                MESSAGE: The tape density is different from the drive density.
      370     8931         ***/
      371     8932        %FT$ERR( ERRNAME=E_NOFILE ,MID='14'O, CODE=%E$NOFILE , SEV=2 );
      372     8940
      373     8941        /********************/
      374     8942
      375     8943         /***
      376     8944          *** Get pointer to DCB; initialize for open.
      377     8945          ***/
      378     8946
      379     8947    1      JDCB$ = B$JIT.DCB$;                  /* Get pointer to DCB                 */

   8947  2 000002   000000 470400 xsym               LDP0    B$JIT$
         2 000003   000232 236100                    LDQ     154,,PR0
         2 000004   200016 756100                    STQ     JDCB$,,AUTO

      380     8948    1      IF F$DCB.ACS = %JRNL#

   8948  2 000005   200016 471500                    LDP1    JDCB$,,AUTO
         2 000006   100036 236100                    LDQ     30,,PR1
         2 000007   000777 376007                    ANQ     511,DL
         2 000010   000004 116007                    CMPQ    4,DL
         2 000011   000021 601000 2                  TNZ     s:8952

      381     8949    1       THEN IF F$DCB.OWNER

   8949  2 000012   100064 236100                    LDQ     52,,PR1
         2 000013   040000 316007                    CANQ    16384,DL
         2 000014   000023 600000 2                  TZE     s:8958

      382     8950    1          THEN F$DCB.CFU$->FM$CFUJ.SNLINKX = 0; /* No SN list yet                */

   8950  2 000015   100066 473500                    LDP3    54,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:76   
         2 000016   000000 220003                    LDX0    0,DU
         2 000017   300006 440100                    SXL0    6,,PR3
         2 000020   000023 710000 2                  TRA     s:8958

      383     8951    1          ELSE ;
      384     8952    1       ELSE F$DCB.CFU$ = ADDR(NIL);        /* Assume only one vol in set         */

   8952  2 000021   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000022   100066 756100                    STQ     54,,PR1

      385     8953
      386     8954         /***
      387     8955          *** Determine values for odd specifications.
      388     8956          ***/
      389     8957
      390     8958    1      IF F$DCB.DENSITY > %FT_MAXDENS THEN F$DCB.DENSITY = 0; /* Use default      */

   8958  2 000023   200016 471500                    LDP1    JDCB$,,AUTO
         2 000024   100043 236100                    LDQ     35,,PR1
         2 000025   000777 376007                    ANQ     511,DL
         2 000026   000007 116007                    CMPQ    7,DL
         2 000027   000032 602000 2                  TNC     s:8960

   8958  2 000030   000000 236003                    LDQ     0,DU
         2 000031   100043 552104                    STBQ    35,'04'O,PR1

      391     8959
      392     8960    1      F$DCB.OLDIOERR = 0;                  /* No I/O errors yet hit on this file */

   8960  2 000032   000000 236000 3                  LDQ     0
         2 000033   100102 356100                    ANSQ    66,,PR1

      393     8961
      394     8962         /***
      395     8963          *** Open tape according to type and function.  7-track tape can only
      396     8964          *** be opened ASN=DEVICE and ORG=FREE.
      397     8965          ***/
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:77   
      398     8966
      399     8967    1      F$DCB.IFMT = FMTTAPE#;

   8967  2 000034   005000 236003                    LDQ     2560,DU
         2 000035   100103 552140                    STBQ    67,'40'O,PR1

      400     8968    1      CREATE_OLDFILE = %NO#;

   8968  2 000036   200011 450100                    STZ     CREATE_OLDFILE,,AUTO

      401     8969    1      IF F$DCB.ACS ~= %JRNL#

   8969  2 000037   100036 236100                    LDQ     30,,PR1
         2 000040   000777 376007                    ANQ     511,DL
         2 000041   000004 116007                    CMPQ    4,DL
         2 000042   000060 600000 2                  TZE     s:8973

      402     8970    1       THEN IF F$DCB.ORG = %RESTRICT# AND F$DCB.FUN = %CREATE#

   8970  2 000043   100032 236100                    LDQ     26,,PR1
         2 000044   777000 376003                    ANQ     -512,DU
         2 000045   022000 116003                    CMPQ    9216,DU
         2 000046   000056 601000 2                  TNZ     s:8972
         2 000047   100032 236100                    LDQ     26,,PR1
         2 000050   000777 376003                    ANQ     511,DU
         2 000051   000003 116003                    CMPQ    3,DU
         2 000052   000056 601000 2                  TNZ     s:8972

      403     8971    1          THEN F$DCB.ACS = %BLOCK#;

   8971  2 000053   000003 236007                    LDQ     3,DL
         2 000054   100036 552104                    STBQ    30,'04'O,PR1
         2 000055   000060 710000 2                  TRA     s:8973

      404     8972    1          ELSE F$DCB.ACS = %SEQUEN#;       /* No DIRECT use of tape              */

   8972  2 000056   000001 236007                    LDQ     1,DL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:78   
         2 000057   100036 552104                    STBQ    30,'04'O,PR1

      405     8973    1      IF F$DCB.ASN = %DEVICE# OR PN$.V_->FPT$OPEN_V.OPER.MNTONLY

   8973  2 000060   100032 236100                    LDQ     26,,PR1
         2 000061   777000 376007                    ANQ     -512,DL
         2 000062   003000 116007                    CMPQ    1536,DL
         2 000063   000071 600000 2                  TZE     s:8974
         2 000064   200003 473500                    LDP3    @PN$,,AUTO
         2 000065   300000 474500                    LDP4    0,,PR3
         2 000066   400000 236100                    LDQ     0,,PR4
         2 000067   001000 316007                    CANQ    512,DL
         2 000070   000074 600000 2                  TZE     s:8976

      406     8974    1       THEN CALL FTO_OPNDEV ALTRET(FREEPOOLS);

   8974  2 000071   000470 701000 2                  TSX1    FTO_OPNDEV
         2 000072   000424 702000 2                  TSX2    FREEPOOLS
         2 000073   000212 710000 2                  TRA     s:9019

      407     8975    2       ELSE DO;

      408     8976    2         IF F$DCB.ACS = %JRNL#

   8976  2 000074   100036 236100                    LDQ     30,,PR1
         2 000075   000777 376007                    ANQ     511,DL
         2 000076   000004 116007                    CMPQ    4,DL
         2 000077   000103 601000 2                  TNZ     s:8979

      409     8977    2          THEN CALL FTO_OPNJRNL ALTRET(FREEPOOLS);

   8977  2 000100   003244 701000 2                  TSX1    FTO_OPNJRNL
         2 000101   000424 702000 2                  TSX2    FREEPOOLS
         2 000102   000212 710000 2                  TRA     s:9019

      410     8978    3          ELSE DO;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:79   
      411     8979    4            DO CASE(F$DCB.FUN);

   8979  2 000103   100032 220100                    LDX0    26,,PR1
         2 000104   000777 360003                    ANX0    511,DU
         2 000105   000004 100003                    CMPX0   4,DU
         2 000106   000110 602010 2                  TNC     s:8979+5,X0
         2 000107   000142 710000 2                  TRA     s:8997
         2 000110   000142 710000 2                  TRA     s:8997
         2 000111   000140 710000 2                  TRA     s:8994
         2 000112   000140 710000 2                  TRA     s:8994
         2 000113   000114 710000 2                  TRA     s:8981

      412     8980    4             CASE(%CREATE#);               /* Create                             */

      413     8981    4               IF F$DCB.EXIST = %OLDFILE#

   8981  2 000114   100031 236100                    LDQ     25,,PR1
         2 000115   003000 376007                    ANQ     1536,DL
         2 000116   002000 116007                    CMPQ    1024,DL
         2 000117   000135 601000 2                  TNZ     s:8992

      414     8982    5                THEN DO;         /* File must be extended if it exists already   */

      415     8983    5                  CALL FTO_OPNEXISTING ALTRET(CHKERR);

   8983  2 000120   003316 701000 2                  TSX1    FTO_OPNEXISTING
         2 000121   000125 702000 2                  TSX2    CHKERR

      416     8984    5                  CREATE_OLDFILE = %YES#;

   8984  2 000122   400000 236003                    LDQ     -131072,DU
         2 000123   200011 756100                    STQ     CREATE_OLDFILE,,AUTO

      417     8985    6                  DO WHILE('0'B);

   8985  2 000124   000142 710000 2                  TRA     s:8997

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:80   
      418     8986    6   CHKERR:           ;

   8986  2 000125                       CHKERR       null
      419     8987    6                     IF B$JIT.ERR.CODE ~= %E$NOFILE

   8987  2 000125   000000 470400 xsym               LDP0    B$JIT$
         2 000126   000012 236100                    LDQ     10,,PR0
         2 000127   377770 376007                    ANQ     131064,DL
         2 000130   001610 116007                    CMPQ    904,DL
         2 000131   000424 601000 2                  TNZ     FREEPOOLS

      420     8988    6                      THEN GOTO FREEPOOLS; /* Unexpected error                   */
      421     8989    6                     CALL FTO_OPNCREATE ALTRET(FREEPOOLS);

   8989  2 000132   001175 701000 2                  TSX1    FTO_OPNCREATE
         2 000133   000424 702000 2                  TSX2    FREEPOOLS

      422     8990    6                     END;

      423     8991    5                  END;

   8991  2 000134   000142 710000 2                  TRA     s:8997

      424     8992    4                ELSE CALL FTO_OPNCREATE ALTRET(FREEPOOLS);

   8992  2 000135   001175 701000 2                  TSX1    FTO_OPNCREATE
         2 000136   000424 702000 2                  TSX2    FREEPOOLS
         2 000137   000142 710000 2                  TRA     s:8997

      425     8993    4             CASE(%IN#,%UPDATE#);          /* Input and update                   */

      426     8994    4               CALL FTO_OPNEXISTING ALTRET(FREEPOOLS);

   8994  2 000140   003316 701000 2                  TSX1    FTO_OPNEXISTING
         2 000141   000424 702000 2                  TSX2    FREEPOOLS

      427     8995    4             END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:81   

      428     8996
      429     8997    4            DO CASE(F$DCB.FUN);

   8997  2 000142   200016 470500                    LDP0    JDCB$,,AUTO
         2 000143   000032 220100                    LDX0    26,,PR0
         2 000144   000777 360003                    ANX0    511,DU
         2 000145   000004 100003                    CMPX0   4,DU
         2 000146   000150 602010 2                  TNC     s:8997+6,X0
         2 000147   000211 710000 2                  TRA     s:9010
         2 000150   000211 710000 2                  TRA     s:9010
         2 000151   000154 710000 2                  TRA     s:8999
         2 000152   000211 710000 2                  TRA     s:9010
         2 000153   000154 710000 2                  TRA     s:8999

      430     8998    4             CASE(%CREATE#,%UPDATE#); /* Need RO space for last key if keyed,sequen */

      431     8999    4               IF F$DCB.ORG = %KEYED# OR F$DCB.ORG = %INDEXED#

   8999  2 000154   000032 236100                    LDQ     26,,PR0
         2 000155   777000 376003                    ANQ     -512,DU
         2 000156   002000 116003                    CMPQ    1024,DU
         2 000157   000162 600000 2                  TZE     s:9000
         2 000160   006000 116003                    CMPQ    3072,DU
         2 000161   000202 601000 2                  TNZ     s:9006

      432     9000    4                THEN IF F$DCB.ACS = %SEQUEN#

   9000  2 000162   000036 236100                    LDQ     30,,PR0
         2 000163   000777 376007                    ANQ     511,DL
         2 000164   000001 116007                    CMPQ    1,DL
         2 000165   000212 601000 2                  TNZ     s:9019

      433     9001    5                   THEN DO;                /* Get RO space for key               */

      434     9002    5                     CALL FSA$GSP(64,F$DCB.LASTKEY$) ALTRET(FREEPOOLS);

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:82   
   9002  2 000166   200016 236100                    LDQ     JDCB$,,AUTO
         2 000167   000065 036003                    ADLQ    53,DU
         2 000170   000002 235000 3                  LDA     2
         2 000171   200052 757100                    STAQ    JRNL_OFFSET+2,,AUTO
         2 000172   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 000173   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000174   000000 701000 xent               TSX1    FSA$GSP
         2 000175   000424 702000 2                  TSX2    FREEPOOLS

      435     9003    5                     F$DCB.TAPTYP.HAVLASTKEY = %NO#;

   9003  2 000176   200016 470500                    LDP0    JDCB$,,AUTO
         2 000177   000003 236000 3                  LDQ     3
         2 000200   000067 356100                    ANSQ    55,,PR0

      436     9004    5                     END;

   9004  2 000201   000212 710000 2                  TRA     s:9019

      437     9005    4                   ELSE ;
      438     9006    4                ELSE IF F$DCB.ORG = %RELATIVE#

   9006  2 000202   005000 116003                    CMPQ    2560,DU
         2 000203   000206 601000 2                  TNZ     s:9008

      439     9007    4                   THEN F$DCB.LASTKEY = 0;

   9007  2 000204   000065 450100                    STZ     53,,PR0
         2 000205   000212 710000 2                  TRA     s:9019

      440     9008    4                   ELSE F$DCB.LASTKEY = -1;

   9008  2 000206   000001 335007                    LCA     1,DL
         2 000207   000065 755100                    STA     53,,PR0
         2 000210   000212 710000 2                  TRA     s:9019

      441     9009    4             CASE(ELSE);
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:83   

      442     9010    4               F$DCB.LASTKEY = 0;

   9010  2 000211   000065 450100                    STZ     53,,PR0

      443     9011    4             END;

      444     9012    3            END;

      445     9013    2         END;

      446     9014
      447     9015         /***
      448     9016          *** Initialize to read/write first record of file.
      449     9017          ***/
      450     9018
      451     9019    1      F$DCB.AFTRBLK = %NO#;                /* Positioned before                  */

   9019  2 000212   200016 470500                    LDP0    JDCB$,,AUTO
         2 000213   000004 236000 3                  LDQ     4
         2 000214   000064 356100                    ANSQ    52,,PR0

      452     9020    1      F$DCB.PRECNO = 1;                    /* First block                        */

   9020  2 000215   000001 235007                    LDA     1,DL
         2 000216   000072 755100                    STA     58,,PR0

      453     9021    1      F$DCB.RPOS = %YES#;                  /* Positioned to                      */

   9021  2 000217   010000 236007                    LDQ     4096,DL
         2 000220   000064 256100                    ORSQ    52,,PR0

      454     9022    1      F$DCB.CRECNO = 1;                    /* First record                       */

   9022  2 000221   000071 755100                    STA     57,,PR0

      455     9023    1      F$DCB.CRECX = F$DCB.BOL;             /* First record is just after BOL     */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:84   

   9023  2 000222   000034 720100                    LXL0    28,,PR0
         2 000223   000777 360003                    ANX0    511,DU
         2 000224   000067 440100                    SXL0    55,,PR0

      456     9024    1      F$DCB.SPAN = %NO#;                   /* Expect next record to begin span   */

   9024  2 000225   000005 236000 3                  LDQ     5
         2 000226   000064 356100                    ANSQ    52,,PR0

      457     9025    1      F$DCB.NRECX = 1;                     /* First of block                     */

   9025  2 000227   000001 221003                    LDX1    1,DU
         2 000230   000100 741100                    STX1    64,,PR0

      458     9026    1      F$DCB.CONT = %NO#;                   /* No previous continuation           */

   9026  2 000231   000006 236000 3                  LDQ     6
         2 000232   000064 356100                    ANSQ    52,,PR0

      459     9027    1      F$DCB.GDISP = 0;                     /* Nothing read/written yet           */

   9027  2 000233   000101 450100                    STZ     65,,PR0

      460     9028    1      F$DCB.BLKLEN = F$DCB.BOL;            /* Block length includes header       */

   9028  2 000234   000074 440100                    SXL0    60,,PR0

      461     9029    1      F$DCB.CBUFNUM = 0;                   /* No current buffer                  */

   9029  2 000235   000007 236000 3                  LDQ     7
         2 000236   000070 356100                    ANSQ    56,,PR0

      462     9030    1      F$DCB.NEW_FSECT = %YES#;

   9030  2 000237   000001 236003                    LDQ     1,DU
         2 000240   000064 256100                    ORSQ    52,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:85   

      463     9031    1      F$DCB.TRNC = FT_EBTRUNC#;       /* Fake empty buffer trunc to get buffer   */

   9031  2 000241   000064 236100                    LDQ     52,,PR0
         2 000242   000010 376000 3                  ANQ     8
         2 000243   000004 276007                    ORQ     4,DL
         2 000244   000064 756100                    STQ     52,,PR0

      464     9032    1      F$DCB.TAPTYP.PASTFM = %NO#;          /* Not after file mark                */

   9032  2 000245   000011 236000 3                  LDQ     9
         2 000246   000067 356100                    ANSQ    55,,PR0

      465     9033
      466     9034    1      IF F$DCB.ACS = %JRNL# AND NOT F$DCB.OWNER

   9034  2 000247   000036 236100                    LDQ     30,,PR0
         2 000250   000777 376007                    ANQ     511,DL
         2 000251   000004 116007                    CMPQ    4,DL
         2 000252   000256 601000 2                  TNZ     s:9036
         2 000253   000064 236100                    LDQ     52,,PR0
         2 000254   040000 316007                    CANQ    16384,DL
         2 000255   000263 600000 2                  TZE     s:9037

      467     9035    1       THEN ;
      468     9036    1       ELSE FT$DDT.POS = FTP_BOD#;         /* In data                            */

   9036  2 000256   200012 471500                    LDP1    DDDT$,,AUTO
         2 000257   100006 236100                    LDQ     6,,PR1
         2 000260   000012 376000 3                  ANQ     10
         2 000261   000060 276007                    ORQ     48,DL
         2 000262   100006 756100                    STQ     6,,PR1

      469     9037    1      F$DCB.MEDIA = FMTTAPE#;              /* Tape, of course                    */

   9037  2 000263   200016 470500                    LDP0    JDCB$,,AUTO
         2 000264   000005 236003                    LDQ     5,DU
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:86   
         2 000265   000103 552120                    STBQ    67,'20'O,PR0

      470     9038    1      F$DCB.IASN = %TAPE#;

   9038  2 000266   000002 236007                    LDQ     2,DL
         2 000267   000103 552104                    STBQ    67,'04'O,PR0

      471     9039
      472     9040    1      IF F$DCB.ACS = %JRNL#

   9040  2 000270   000036 236100                    LDQ     30,,PR0
         2 000271   000777 376007                    ANQ     511,DL
         2 000272   000004 116007                    CMPQ    4,DL
         2 000273   000403 601000 2                  TNZ     s:9065

      473     9041    2       THEN DO;                            /* Finish CFU initialization          */

      474     9042    2         IF F$DCB.OWNER

   9042  2 000274   000064 236100                    LDQ     52,,PR0
         2 000275   040000 316007                    CANQ    16384,DL
         2 000276   000365 600000 2                  TZE     s:9056

      475     9043    3          THEN DO;

      476     9044    3            F$DCB.CFU$->FM$CFUJ.PRECNO = 1; /* Before first block                */

   9044  2 000277   000066 471500                    LDP1    54,,PR0
         2 000300   100007 755100                    STA     7,,PR1

      477     9045    3            F$DCB.CFU$->FM$CFUJ.BLKLEN = F$DCB.BOL;

   9045  2 000301   200016 470500                    LDP0    JDCB$,,AUTO
         2 000302   000066 471500                    LDP1    54,,PR0
         2 000303   000034 720100                    LXL0    28,,PR0
         2 000304   000777 360003                    ANX0    511,DU
         2 000305   100006 740100                    STX0    6,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:87   

      478     9046    3            F$DCB.CFU$->FM$CFUJ.USER = B$JIT.USER;

   9046  2 000306   200016 470500                    LDP0    JDCB$,,AUTO
         2 000307   000066 471500                    LDP1    54,,PR0
         2 000310   000000 473400 xsym               LDP3    B$JIT$
         2 000311   300000 236100                    LDQ     0,,PR3
         2 000312   100005 552120                    STBQ    5,'20'O,PR1

      479     9047    3            CALL FMO$GETDOMAIN(I);

   9047  2 000313   200014 630500                    EPPR0   I,,AUTO
         2 000314   200052 450500                    STP0    JRNL_OFFSET+2,,AUTO
         2 000315   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 000316   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000317   000000 701000 xent               TSX1    FMO$GETDOMAIN
         2 000320   000000 011000                    NOP     0

      480     9048    3            F$DCB.CFU$->FM$CFUJ.DMAIN = I;

   9048  2 000321   200016 470500                    LDP0    JDCB$,,AUTO
         2 000322   000066 471500                    LDP1    54,,PR0
         2 000323   200014 236100                    LDQ     I,,AUTO
         2 000324   000033 736000                    QLS     27
         2 000325   100005 676100                    ERQ     5,,PR1
         2 000326   077000 376003                    ANQ     32256,DU
         2 000327   100005 656100                    ERSQ    5,,PR1

      481     9049    3            F$DCB.CFU$->FM$CFUJ.DCB# = PN$.V_->FPT$OPEN_V.DCB#;

   9049  2 000330   200016 470500                    LDP0    JDCB$,,AUTO
         2 000331   000066 471500                    LDP1    54,,PR0
         2 000332   200003 473500                    LDP3    @PN$,,AUTO
         2 000333   300000 474500                    LDP4    0,,PR3
         2 000334   400000 236100                    LDQ     0,,PR4
         2 000335   000011 736000                    QLS     9
         2 000336   100004 552140                    STBQ    4,'40'O,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:88   

      482     9050    3            F$DCB.CBUFNUM = 1;             /* Always for JRNL                    */

   9050  2 000337   200016 470500                    LDP0    JDCB$,,AUTO
         2 000340   000070 236100                    LDQ     56,,PR0
         2 000341   000007 376000 3                  ANQ     7
         2 000342   100000 276003                    ORQ     32768,DU
         2 000343   000070 756100                    STQ     56,,PR0

      483     9051    3            F$DCB.TRNC = FT_NOTRUNC#;

   9051  2 000344   000010 236000 3                  LDQ     8
         2 000345   000064 356100                    ANSQ    52,,PR0

      484     9052    3            CALL FMD$FLSHBUF(1);

   9052  2 000346   000013 630400 3                  EPPR0   11
         2 000347   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000350   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000351   000000 011000                    NOP     0

      485     9053    3            F$DCB.BFR.DA(1) = 0;

   9053  2 000352   200016 470500                    LDP0    JDCB$,,AUTO
         2 000353   000000 236003                    LDQ     0,DU
         2 000354   000116 552134                    STBQ    78,'34'O,PR0

      486     9054    3            CALL FMD$GETBUF( 1, 1, TEMP$ );

   9054  2 000355   200032 631500                    EPPR1   TEMP$,,AUTO
         2 000356   200054 451500                    STP1    JRNL_OFFSET+4,,AUTO
         2 000357   000014 237000 3                  LDAQ    12
         2 000360   200052 757100                    STAQ    JRNL_OFFSET+2,,AUTO
         2 000361   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 000362   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000363   000000 701000 xent               TSX1    FMD$GETBUF
         2 000364   000000 011000                    NOP     0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:89   

      487     9055    3            END;

      488     9056    2         CALL FMH$JGETPG(1);

   9056  2 000365   000013 630400 3                  EPPR0   11
         2 000366   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000367   000000 701000 xent               TSX1    FMH$JGETPG
         2 000370   000000 011000                    NOP     0

      489     9057    2         F$DCB.SHARED = %YES#;

   9057  2 000371   200016 470500                    LDP0    JDCB$,,AUTO
         2 000372   100000 236003                    LDQ     32768,DU
         2 000373   000064 256100                    ORSQ    52,,PR0

      490     9058    2         CALL UQB$MDEQ(F$DCB.CFU$);

   9058  2 000374   200016 236100                    LDQ     JDCB$,,AUTO
         2 000375   000066 036003                    ADLQ    54,DU
         2 000376   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 000377   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 000400   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000401   000000 701000 xent               TSX1    UQB$MDEQ
         2 000402   000000 011000                    NOP     0

      491     9059    2         END;

      492     9060
      493     9061         /***
      494     9062          *** For test open, just close file.
      495     9063          ***/
      496     9064
      497     9065    1      IF PN$.V_->FPT$OPEN_V.OPER.TEST AND F$DCB.ASN ~= %DEVICE#

   9065  2 000403   200003 470500                    LDP0    @PN$,,AUTO
         2 000404   000000 471500                    LDP1    0,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:90   
         2 000405   100000 236100                    LDQ     0,,PR1
         2 000406   020000 316007                    CANQ    8192,DL
         2 000407   000421 600000 2                  TZE     s:9067
         2 000410   200016 473500                    LDP3    JDCB$,,AUTO
         2 000411   300032 236100                    LDQ     26,,PR3
         2 000412   777000 376007                    ANQ     -512,DL
         2 000413   003000 116007                    CMPQ    1536,DL
         2 000414   000421 600000 2                  TZE     s:9067

      498     9066    1       THEN CALL FTC$DFLTCLOSE;

   9066  2 000415   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000416   000000 701000 xent               TSX1    FTC$DFLTCLOSE
         2 000417   000000 011000                    NOP     0
         2 000420   000424 710000 2                  TRA     FREEPOOLS

      499     9067    1       ELSE F$DCB.FCD = %YES#;             /* File is open                       */

   9067  2 000421   200016 473500                    LDP3    JDCB$,,AUTO
         2 000422   020000 236007                    LDQ     8192,DL
         2 000423   300031 256100                    ORSQ    25,,PR3

      500     9068
      501     9069         /***
      502     9070          *** Open is done.
      503     9071          ***/
      504     9072
      505     9073    1   FREEPOOLS:
      506     9074    1      CALL FTR$RELFPOOLS;                  /* Release all FPOOL buffers          */

   9074  2 000424   000002 631400 xsym  FREEPOOLS    EPPR1   B_VECTNIL+2
         2 000425   000000 701000 xent               TSX1    FTR$RELFPOOLS
         2 000426   000000 011000                    NOP     0

      507     9075    1      IF F$DCB.ACS ~= %JRNL#

   9075  2 000427   200016 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:91   
         2 000430   000036 236100                    LDQ     30,,PR0
         2 000431   000777 376007                    ANQ     511,DL
         2 000432   000004 116007                    CMPQ    4,DL
         2 000433   000443 600000 2                  TZE     s:9082

      508     9076    2       THEN DO;

      509     9077    2         IF NOT F$DCB.FCD

   9077  2 000434   000031 236100                    LDQ     25,,PR0
         2 000435   020000 316007                    CANQ    8192,DL
         2 000436   000451 601000 2                  TNZ     JUSTRET

      510     9078    2          THEN CALL FTR$RELCFUS;           /* Not open...release CFUs            */

   9078  2 000437   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000440   000000 701000 xent               TSX1    FTR$RELCFUS
         2 000441   000000 011000                    NOP     0

      511     9079    2          ELSE ;                           /* Open                               */
      512     9080    2         END;

   9080  2 000442   000451 710000 2                  TRA     JUSTRET

      513     9081    2       ELSE DO;

      514     9082    2         IF B$JIT.ERR

   9082  2 000443   000000 471400 xsym               LDP1    B$JIT$
         2 000444   100012 235100                    LDA     10,,PR1
         2 000445   000451 600000 2                  TZE     JUSTRET

      515     9083    3          THEN DO;                         /* Error (not open)                   */

      516     9084    3            CALL FMP$CLSERR;

   9084  2 000446   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:92   
         2 000447   000000 701000 xent               TSX1    FMP$CLSERR
         2 000450   000000 011000                    NOP     0

      517     9085    3            END;

      518     9086    2         END;

   9075  2 000451                       JUSTRET      null
      519     9087    1   JUSTRET: ;
      520     9088    1      IF CREATE_OLDFILE

   9088  2 000451   200011 234100                    SZN     CREATE_OLDFILE,,AUTO
         2 000452   000467 605000 2                  TPL     s:9098

      521     9089    2       THEN DO;                            /* Position to file's end             */

      522     9090    2         CALL FTW$WRAT( FPTPFIL, FPT_PFIL_EOF ) ALTRET(CLOSEFILE);

   9090  2 000453   000016 630400 3                  EPPR0   14
         2 000454   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000455   000000 701000 xent               TSX1    FTW$WRAT
         2 000456   000460 702000 2                  TSX2    CLOSEFILE

      523     9091    3         DO WHILE('0'B);

   9091  2 000457   000467 710000 2                  TRA     s:9098

   9090  2 000460                       CLOSEFILE    null
      524     9092    3   CLOSEFILE: ;
      525     9093    3            CALL FTC$DFLTCLOSE;

   9093  2 000460   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000461   000000 701000 xent               TSX1    FTC$DFLTCLOSE
         2 000462   000000 011000                    NOP     0

      526     9094    3            F$DCB.FCD = %NO#;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:93   
   9094  2 000463   200016 470500                    LDP0    JDCB$,,AUTO
         2 000464   000020 236000 3                  LDQ     16
         2 000465   000031 356100                    ANSQ    25,,PR0

      527     9095    3            GOTO FREEPOOLS;

   9095  2 000466   000424 710000 2                  TRA     FREEPOOLS

      528     9096    3            END;

      529     9097    2         END;
      530     9098    1      RETURN;

   9098  2 000467   000000 702200 xent               TSX2  ! X66_ARET

      531     9099
      532     9100        /*********************************************************************/
      533     9101        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:94   
      534     9102        /*********************************************************************/
      535     9103    1   FTO_OPNDEV: PROC ALTRET;

   9103  2 000470   200034 741300       FTO_OPNDEV   STX1  ! TEMP$+2,,AUTO

      536     9104        /*F*     NAME: FTO_OPNDEV
      537     9105                 PURPOSE: Open device tape/ mount only open.
      538     9106         ***/
      539     9107
      540     9108        /********************/
      541     9109
      542     9110         /***
      543     9111          *** Get initial serial number.
      544     9112          ***/
      545     9113
      546     9114    2      CALL FTO_GETSN ALTRET(JUSTALT);      /* Determine serial number            */

   9114  2 000471   005616 701000 2                  TSX1    FTO_GETSN
         2 000472   001173 702000 2                  TSX2    JUSTALT

      547     9115    2      IF FT_PROT = FT_FULLPROT#

   9115  2 000473   000000 235000 xsym               LDA     FT_PROT
         2 000474   000002 115007                    CMPA    2,DL
         2 000475   000501 601000 2                  TNZ     s:9119

      548     9116    3       THEN DO;        /* Fully protected system...must specify serial numbers   */

      549     9117    3         F$DCB.MAXVOL = 0;

   9117  2 000476   200016 470500                    LDP0    JDCB$,,AUTO
         2 000477   000000 236003                    LDQ     0,DU
         2 000500   000043 552120                    STBQ    35,'20'O,PR0

      550     9118    3         END;

      551     9119    2      IF F$DCB.PSN = ' ' AND (F$DCB.FUN ~= %CREATE# OR FT_PROT = FT_FULLPROT#)
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:95   

   9119  2 000501   200016 470500                    LDP0    JDCB$,,AUTO
         2 000502   040000 106500                    CMPC    fill='040'O
         2 000503   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 000504   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000505   000521 601000 2                  TNZ     s:9129
         2 000506   000032 236100                    LDQ     26,,PR0
         2 000507   000777 376003                    ANQ     511,DU
         2 000510   000003 116003                    CMPQ    3,DU
         2 000511   000514 601000 2                  TNZ     s:9121
         2 000512   000002 115007                    CMPA    2,DL
         2 000513   000521 601000 2                  TNZ     s:9129

      552     9120    3       THEN DO;

      553     9121    3         B$JIT.ERR = E_NOSN; /*E* ERROR: FTO-E$NOSN */

   9121  2 000514   000036 236000 1                  LDQ     E_NOSN
         2 000515   000000 471400 xsym               LDP1    B$JIT$
         2 000516   100012 756100                    STQ     10,,PR1

      554     9122    3         ALTRETURN;

   9122  2 000517   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 000520   000000 702211                    TSX2  ! 0,X1

      555     9123    3         END;
      556     9124
      557     9125         /***
      558     9126          *** Check BLKL and RECL for managed free tape (not if mount only).
      559     9127          ***/
      560     9128
      561     9129    2      IF NOT PN$.V_->FPT$OPEN_V.OPER.MNTONLY

   9129  2 000521   200003 471500                    LDP1    @PN$,,AUTO
         2 000522   100000 473500                    LDP3    0,,PR1
         2 000523   300000 236100                    LDQ     0,,PR3
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:96   
         2 000524   001000 316007                    CANQ    512,DL
         2 000525   000530 601000 2                  TNZ     s:9136

      562     9130    2       THEN CALL FTO_CHK_BLKL_RECL ALTRET(JUSTALT);

   9130  2 000526   002274 701000 2                  TSX1    FTO_CHK_BLKL_RECL
         2 000527   001173 702000 2                  TSX2    JUSTALT

      563     9131
      564     9132         /***
      565     9133          *** Set attributes and get tape.
      566     9134          ***/
      567     9135
      568     9136    2      IF F$DCB.RESNT.NUM = ' '

   9136  2 000530   200016 470500                    LDP0    JDCB$,,AUTO
         2 000531   000026 720100                    LXL0    22,,PR0
         2 000532   040040 100003                    CMPX0   16416,DU
         2 000533   000574 601000 2                  TNZ     s:9146

      569     9137    3       THEN DO;                            /* Set more accurate name             */

      570     9138    3         IF PN$.V_->FPT$OPEN_V.OPER.MNTONLY

   9138  2 000534   200003 471500                    LDP1    @PN$,,AUTO
         2 000535   100000 473500                    LDP3    0,,PR1
         2 000536   300000 236100                    LDQ     0,,PR3
         2 000537   001000 316007                    CANQ    512,DL
         2 000540   000546 600000 2                  TZE     s:9140

      571     9139    3          THEN F$DCB.RES = 'MT';

   9139  2 000541   000045 236000 1                  LDQ     E_NOFILE+1
         2 000542   777777 376003                    ANQ     -1,DU
         2 000543   040040 276007                    ORQ     16416,DL
         2 000544   000026 756100                    STQ     22,,PR0
         2 000545   000574 710000 2                  TRA     s:9146
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:97   

      572     9140    3          ELSE IF F$DCB.ASN ~= %DEVICE#

   9140  2 000546   000032 236100                    LDQ     26,,PR0
         2 000547   777000 376007                    ANQ     -512,DL
         2 000550   003000 116007                    CMPQ    1536,DL
         2 000551   000557 600000 2                  TZE     s:9142

      573     9141    3             THEN F$DCB.RES = 'LT';

   9141  2 000552   000046 236000 1                  LDQ     E_NOFILE+2
         2 000553   777777 376003                    ANQ     -1,DU
         2 000554   040040 276007                    ORQ     16416,DL
         2 000555   000026 756100                    STQ     22,,PR0
         2 000556   000574 710000 2                  TRA     s:9146

      574     9142    3             ELSE IF F$DCB.ORG = %FREE#

   9142  2 000557   000032 236100                    LDQ     26,,PR0
         2 000560   777000 376003                    ANQ     -512,DU
         2 000561   023000 116003                    CMPQ    9728,DU
         2 000562   000570 601000 2                  TNZ     s:9144

      575     9143    3                THEN F$DCB.RES = 'FT';

   9143  2 000563   000047 236000 1                  LDQ     E_NOFILE+3
         2 000564   777777 376003                    ANQ     -1,DU
         2 000565   040040 276007                    ORQ     16416,DL
         2 000566   000026 756100                    STQ     22,,PR0
         2 000567   000574 710000 2                  TRA     s:9146

      576     9144    3                ELSE F$DCB.RES = 'MT';

   9144  2 000570   000045 236000 1                  LDQ     E_NOFILE+1
         2 000571   777777 376003                    ANQ     -1,DU
         2 000572   040040 276007                    ORQ     16416,DL
         2 000573   000026 756100                    STQ     22,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:98   

      577     9145    3         END;

      578     9146    2      IF F$DCB.DENSITY = 0

   9146  2 000574   000043 236100                    LDQ     35,,PR0
         2 000575   000777 316007                    CANQ    511,DL
         2 000576   000602 601000 2                  TNZ     s:9148

      579     9147    2       THEN F$DCB.ATTR = '0'B;

   9147  2 000577   000000 220003                    LDX0    0,DU
         2 000600   000040 440100                    SXL0    32,,PR0
         2 000601   000610 710000 2                  TRA     s:9150

      580     9148    2       ELSE F$DCB.ATTR = FT_DENS(F$DCB.DENSITY);

   9148  2 000602   000043 236100                    LDQ     35,,PR0
         2 000603   000777 376007                    ANQ     511,DL
         2 000604   000001 736000                    QLS     1
         2 000605   000100 100406                    MLR     fill='000'O
         2 000606   000000 000002 1                  ADSC9   FT_DENS,Q                cn=0,n=2
         2 000607   000040 400002                    ADSC9   32,,PR0                  cn=2,n=2

      581     9149                                                /* Specify density                    */
      582     9150    2      CALL FRA$OPR ALTRET(JUSTALT);        /* Get tape                           */

   9150  2 000610   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000611   000000 701000 xent               TSX1    FRA$OPR
         2 000612   001173 702000 2                  TSX2    JUSTALT

      583     9151    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9151  2 000613   200016 470500                    LDP0    JDCB$,,AUTO
         2 000614   000051 720100                    LXL0    41,,PR0
         2 000615   000000 471400 xsym               LDP1    N$DCT$$
         2 000616   100000 473510                    LDP3    0,X0,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:99   
         2 000617   300004 236100                    LDQ     4,,PR3
         2 000620   200012 756100                    STQ     DDDT$,,AUTO

      584     9152
      585     9153        /* If this is an unprotected system and the serial number as mounted
      586     9154           by the operator does not match the VOL1.SN then we dont set
      587     9155           the DDT.SN entry as this will be needed to determine the
      588     9156           validity of the real M$OPEN (not MNTONLY) operation. */
      589     9157
      590     9158    2      IF NOT (FT_PROT = FT_UNPROT# AND F$DCB.PSN ~= FT$DDT.SN AND FT$DDT.ANST) THEN

   9158  2 000621   000000 235000 xsym               LDA     FT_PROT
         2 000622   000633 601000 2                  TNZ     s:9159
         2 000623   200012 474500                    LDP4    DDDT$,,AUTO
         2 000624   040100 106500                    CMPC    fill='040'O
         2 000625   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 000626   400002 000006                    ADSC9   2,,PR4                   cn=0,n=6
         2 000627   000633 600000 2                  TZE     s:9159
         2 000630   400006 236100                    LDQ     6,,PR4
         2 000631   400000 316007                    CANQ    -131072,DL
         2 000632   000637 601000 2                  TNZ     s:9164

      591     9159    2         FT$DDT.SN = F$DCB.PSN;            /* Set actual serial number           */

   9159  2 000633   200012 474500                    LDP4    DDDT$,,AUTO
         2 000634   040100 100500                    MLR     fill='040'O
         2 000635   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 000636   400002 000006                    ADSC9   2,,PR4                   cn=0,n=6

      592     9160
      593     9161        /* Now lets check the tape density against the drive density.
      594     9162           If they dont match then we have to altreturn */
      595     9163
      596     9164    3      IF FT$DDT.DENSITY ~= 0 AND NOT FT_DENS(FT$DDT.DENSITY)&F$DCB.ATTR THEN DO;

   9164  2 000637   400006 236100                    LDQ     6,,PR4
         2 000640   003400 316007                    CANQ    1792,DL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:100  
         2 000641   000702 600000 2                  TZE     s:9173
         2 000642   400006 236100                    LDQ     6,,PR4
         2 000643   000010 772000                    QRL     8
         2 000644   000007 376007                    ANQ     7,DL
         2 000645   200016 470500                    LDP0    JDCB$,,AUTO
         2 000646   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 000647   000040 236100                    LDQ     32,,PR0
         2 000650   000022 736000                    QLS     18
         2 000651   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 000652   200052 235100                    LDA     JRNL_OFFSET+2,,AUTO
         2 000653   000001 735000                    ALS     1
         2 000654   000100 100405                    MLR     fill='000'O
         2 000655   000000 000002 1                  ADSC9   FT_DENS,A                cn=0,n=2
         2 000656   200054 000004                    ADSC9   JRNL_OFFSET+4,,AUTO      cn=0,n=4
         2 000657   200054 236100                    LDQ     JRNL_OFFSET+4,,AUTO
         2 000660   200053 376100                    ANQ     JRNL_OFFSET+3,,AUTO
         2 000661   000702 601000 2                  TNZ     s:9173

      597     9165    3         IF F$DCB.ASN=%DEVICE# AND

   9165  2 000662   000032 236100                    LDQ     26,,PR0
         2 000663   777000 376007                    ANQ     -512,DL
         2 000664   003000 116007                    CMPQ    1536,DL
         2 000665   000676 601000 2                  TNZ     s:9170
         2 000666   000032 236100                    LDQ     26,,PR0
         2 000667   000777 376003                    ANQ     511,DU
         2 000670   000003 116003                    CMPQ    3,DU
         2 000671   000676 601000 2                  TNZ     s:9170
         2 000672   000031 236100                    LDQ     25,,PR0
         2 000673   003000 376007                    ANQ     1536,DL
         2 000674   002000 116007                    CMPQ    1024,DL
         2 000675   000702 601000 2                  TNZ     s:9173

      598     9166    3           F$DCB.FUN=%CREATE# AND
      599     9167    3           F$DCB.EXIST~=%OLDFILE#
      600     9168    3          THEN
      601     9169    3            EXIT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:101  
      602     9170    3         B$JIT.ERR = E_WRONGDENSITY;

   9170  2 000676   000043 236000 1                  LDQ     E_WRONGDENSITY
         2 000677   000000 473400 xsym               LDP3    B$JIT$
         2 000700   300012 756100                    STQ     10,,PR3

      603     9171    3         GOTO CLSTAP;

   9171  2 000701   001170 710000 2                  TRA     CLSTAP

      604     9172    3         END;
      605     9173    2      I = F$DCB.VOL;

   9173  2 000702   200016 470500                    LDP0    JDCB$,,AUTO
         2 000703   000043 236100                    LDQ     35,,PR0
         2 000704   000033 772000                    QRL     27
         2 000705   200014 756100                    STQ     I,,AUTO

      606     9174    2      CALL FTR$SETSN(I,ADDR(F$DCB.PSN)) ALTRET(NEVER0);

   9174  2 000706   200016 236100                    LDQ     JDCB$,,AUTO
         2 000707   000024 036003                    ADLQ    20,DU
         2 000710   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 000711   200052 633500                    EPPR3   JRNL_OFFSET+2,,AUTO
         2 000712   200055 453500                    STP3    JRNL_OFFSET+5,,AUTO
         2 000713   200014 635500                    EPPR5   I,,AUTO
         2 000714   200054 455500                    STP5    JRNL_OFFSET+4,,AUTO
         2 000715   200054 630500                    EPPR0   JRNL_OFFSET+4,,AUTO
         2 000716   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000717   000000 701000 xent               TSX1    FTR$SETSN
         2 000720   000721 702000 2                  TSX2    NEVER0

   9173  2 000721                       NEVER0       null
      607     9175    2   NEVER0: ;
      608     9176
      609     9177         /***
      610     9178          *** We now have the tape.  If mount only open, we're done.
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:102  
      611     9179          ***/
      612     9180
      613     9181    2      IF PN$.V_->FPT$OPEN_V.OPER.MNTONLY

   9181  2 000721   200003 470500                    LDP0    @PN$,,AUTO
         2 000722   000000 471500                    LDP1    0,,PR0
         2 000723   100000 236100                    LDQ     0,,PR1
         2 000724   001000 316007                    CANQ    512,DL
         2 000725   000777 600000 2                  TZE     s:9206

      614     9182    3       THEN DO;                            /* Just close tape                    */

      615     9183    3         IF FT$DDT.ANST                    /* Return tape type                   */

   9183  2 000726   200012 473500                    LDP3    DDDT$,,AUTO
         2 000727   300006 236100                    LDQ     6,,PR3
         2 000730   400000 316007                    CANQ    -131072,DL
         2 000731   000743 600000 2                  TZE     s:9189

      616     9184    4          THEN DO;

      617     9185    4            F$DCB.ASN = %TAPE#;

   9185  2 000732   200016 474500                    LDP4    JDCB$,,AUTO
         2 000733   002000 236007                    LDQ     1024,DL
         2 000734   400032 552110                    STBQ    26,'10'O,PR4

      618     9186    4            F$DCB.FSN = FT$DDT.FRSTFSN + 1; /* +1 since pre-FSN                  */

   9186  2 000735   300005 720100                    LXL0    5,,PR3
         2 000736   000001 621010                    EAX1    1,X0
         2 000737   400034 741100                    STX1    28,,PR4

      619     9187    4            F$DCB.FSECT = FT$DDT.FRSTFSECT;

   9187  2 000740   300007 220100                    LDX0    7,,PR3
         2 000741   400077 740100                    STX0    63,,PR4
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:103  

      620     9188    4            END;

   9188  2 000742   000746 710000 2                  TRA     s:9190

      621     9189    3          ELSE F$DCB.ASN = %DEVICE#;

   9189  2 000743   200016 474500                    LDP4    JDCB$,,AUTO
         2 000744   003000 236007                    LDQ     1536,DL
         2 000745   400032 552110                    STBQ    26,'10'O,PR4

      622     9190    3         F$DCB.DENSITY = FT$DDT.DENSITY;

   9190  2 000746   300006 236100                    LDQ     6,,PR3
         2 000747   003400 376007                    ANQ     1792,DL
         2 000750   000010 772000                    QRL     8
         2 000751   400043 552104                    STBQ    35,'04'O,PR4

      623     9191    4         IF FT$DDT.FMNEEDED THEN DO;       /* File mark needed before rewind     */

   9191  2 000752   300006 236100                    LDQ     6,,PR3
         2 000753   000200 316007                    CANQ    128,DL
         2 000754   000762 600000 2                  TZE     s:9195

      624     9192    4            FT$DDT.FMNEEDED = %NO#;

   9192  2 000755   000021 236000 3                  LDQ     17
         2 000756   300006 356100                    ANSQ    6,,PR3

      625     9193    4            CALL FTI$WRFM ALTRET(CLSTAP);

   9193  2 000757   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000760   000000 701000 xent               TSX1    FTI$WRFM
         2 000761   001170 702000 2                  TSX2    CLSTAP

      626     9194    4            END;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:104  
      627     9195    3         CALL FTI$REWIND ALTRET(CLSTAP);   /* Position to BOV                    */

   9195  2 000762   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000763   000000 701000 xent               TSX1    FTI$REWIND
         2 000764   001170 702000 2                  TSX2    CLSTAP

      628     9196    3         FT$DDT.NOTEOF = '0'B;             /* No longer in middle of file        */

   9196  2 000765   200012 470500                    LDP0    DDDT$,,AUTO
         2 000766   000022 236000 3                  LDQ     18
         2 000767   000007 356100                    ANSQ    7,,PR0

      629     9197    3         FT$DDT.FSN = FT$DDT.FRSTFSN;      /* Back to BOT                        */

   9197  2 000770   000005 720100                    LXL0    5,,PR0
         2 000771   000005 740100                    STX0    5,,PR0

      630     9198    3         CALL FRB$CLS;

   9198  2 000772   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000773   000000 701000 xent               TSX1    FRB$CLS
         2 000774   000000 011000                    NOP     0

      631     9199    3         ALTRETURN;

   9199  2 000775   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 000776   000000 702211                    TSX2  ! 0,X1

      632     9200    3         END;
      633     9201
      634     9202         /***
      635     9203          *** Do tape checks.
      636     9204          ***/
      637     9205
      638     9206    3      IF F$DCB.FUN = %CREATE# THEN DO;

   9206  2 000777   200016 473500                    LDP3    JDCB$,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:105  
         2 001000   300032 236100                    LDQ     26,,PR3
         2 001001   000777 376003                    ANQ     511,DU
         2 001002   000003 116003                    CMPQ    3,DU
         2 001003   001047 601000 2                  TNZ     s:9223

      639     9207    3         IF FT$DDT.POS = FTP_BOV# THEN     /* If at BOV, set DDT.EBCDIC.         */

   9207  2 001004   200012 474500                    LDP4    DDDT$,,AUTO
         2 001005   400006 236100                    LDQ     6,,PR4
         2 001006   000160 376007                    ANQ     112,DL
         2 001007   000020 116007                    CMPQ    16,DL
         2 001010   001016 601000 2                  TNZ     s:9210

      640     9208    3            FT$DDT.EBCDIC = F$DCB.EBCDIC;

   9208  2 001011   300031 236100                    LDQ     25,,PR3
         2 001012   400006 676100                    ERQ     6,,PR4
         2 001013   100000 376007                    ANQ     32768,DL
         2 001014   400006 656100                    ERSQ    6,,PR4
         2 001015   001035 710000 2                  TRA     s:9217

      641     9209    3          ELSE                             /* Not at BOV, can't change EBCDIC.   */
      642     9210    4            IF FT$DDT.EBCDIC ~= F$DCB.EBCDIC THEN DO; /* Tried to change EBCDIC. */

   9210  2 001016   400006 236100                    LDQ     6,,PR4
         2 001017   300031 676100                    ERQ     25,,PR3
         2 001020   100000 376007                    ANQ     32768,DL
         2 001021   001035 600000 2                  TZE     s:9217

      643     9211    4               IF FT$DDT.EBCDIC THEN

   9211  2 001022   400006 236100                    LDQ     6,,PR4
         2 001023   100000 316007                    CANQ    32768,DL
         2 001024   001031 600000 2                  TZE     s:9214

      644     9212    4                  B$JIT.ERR = E_EBCDICTAP; /*E* ERROR: FTO-E$EBCDICTAP */

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:106  
   9212  2 001025   000025 236000 1                  LDQ     E_EBCDICTAP
         2 001026   000000 475400 xsym               LDP5    B$JIT$
         2 001027   500012 756100                    STQ     10,,PR5
         2 001030   001034 710000 2                  TRA     s:9215

      645     9213    4                ELSE
      646     9214    4                  B$JIT.ERR = E_ASCIITAP;  /*E* ERROR: FTO-E$ASCIITAP */

   9214  2 001031   000020 236000 1                  LDQ     E_ASCIITAP
         2 001032   000000 475400 xsym               LDP5    B$JIT$
         2 001033   500012 756100                    STQ     10,,PR5

      647     9215    4               GOTO CLSTAP;

   9215  2 001034   001170 710000 2                  TRA     CLSTAP

      648     9216    4               END;
      649     9217    3         F$DCB.NOEOF = %YES#;              /* Always for create                  */

   9217  2 001035   200016 471500                    LDP1    JDCB$,,AUTO
         2 001036   400000 236007                    LDQ     -131072,DL
         2 001037   100064 256100                    ORSQ    52,,PR1

      650     9218    3         F$DCB.EOP = WRITEEOP#;            /* Always for create                  */

   9218  2 001040   003000 236003                    LDQ     1536,DU
         2 001041   100064 256100                    ORSQ    52,,PR1

      651     9219    3         F$DCB.FMOD = %YES#;

   9219  2 001042   040000 236003                    LDQ     16384,DU
         2 001043   100064 256100                    ORSQ    52,,PR1

      652     9220    3         F$DCB.LSTBLK = %YES#;

   9220  2 001044   000001 236007                    LDQ     1,DL
         2 001045   100064 256100                    ORSQ    52,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:107  

      653     9221    3         END;

   9221  2 001046   001051 710000 2                  TRA     s:9224

      654     9222    2       ELSE
      655     9223    2         F$DCB.NOEOF = %NO#;               /* Not output open                    */

   9223  2 001047   000023 236000 3                  LDQ     19
         2 001050   300064 356100                    ANSQ    52,,PR3

      656     9224    2      IF NOT FT$DDT.EBCDIC OR F$DCB.ANSISPANSEQ

   9224  2 001051   200012 471500                    LDP1    DDDT$,,AUTO
         2 001052   100006 236100                    LDQ     6,,PR1
         2 001053   100000 316007                    CANQ    32768,DL
         2 001054   001061 600000 2                  TZE     s:9225
         2 001055   200016 473500                    LDP3    JDCB$,,AUTO
         2 001056   300060 236100                    LDQ     48,,PR3
         2 001057   010000 316007                    CANQ    4096,DL
         2 001060   001064 600000 2                  TZE     s:9226

      657     9225    2       THEN F$DCB.REALSPAN = '1'B;

   9225  2 001061   200016 473500                    LDP3    JDCB$,,AUTO
         2 001062   002000 236007                    LDQ     1024,DL
         2 001063   300102 256100                    ORSQ    66,,PR3

      658     9226    2      CALL FTR$DPT ALTRET(CLSTAP);         /* Do density, permit, type checks    */

   9226  2 001064   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001065   000000 701000 xent               TSX1    FTR$DPT
         2 001066   001170 702000 2                  TSX2    CLSTAP

      659     9227    2      NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.POSLOST = %NO#;
              9227               /* Permit free tape I/O */

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:108  
   9227  2 001067   200016 470500                    LDP0    JDCB$,,AUTO
         2 001070   000051 720100                    LXL0    41,,PR0
         2 001071   000000 471400 xsym               LDP1    N$DCT$$
         2 001072   100000 473510                    LDP3    0,X0,PR1
         2 001073   300004 474500                    LDP4    4,,PR3
         2 001074   000024 236000 3                  LDQ     20
         2 001075   400006 356100                    ANSQ    6,,PR4

      660     9228    2      NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$->FT$DDT.NOTEOF = '0'B;
              9228               /* No longer in middle of file */

   9228  2 001076   200016 470500                    LDP0    JDCB$,,AUTO
         2 001077   000051 720100                    LXL0    41,,PR0
         2 001100   100000 473510                    LDP3    0,X0,PR1
         2 001101   300004 474500                    LDP4    4,,PR3
         2 001102   000022 236000 3                  LDQ     18
         2 001103   400007 356100                    ANSQ    7,,PR4

      661     9229
      662     9230         /***
      663     9231          *** Allow anything.
      664     9232          ***/
      665     9233
      666     9234    2      F$DCB.FFLG = '0'B;

   9234  2 001104   000000 220003                    LDX0    0,DU
         2 001105   200016 470500                    LDP0    JDCB$,,AUTO
         2 001106   000004 740100                    STX0    4,,PR0

      667     9235    2      F$DCB.FFLG.READ = %YES#;

   9235  2 001107   200016 470500                    LDP0    JDCB$,,AUTO
         2 001110   400000 236003                    LDQ     -131072,DU
         2 001111   000004 256100                    ORSQ    4,,PR0

      668     9236    2      IF F$DCB.FUN ~= %IN#

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:109  
   9236  2 001112   200016 470500                    LDP0    JDCB$,,AUTO
         2 001113   000032 236100                    LDQ     26,,PR0
         2 001114   000777 376003                    ANQ     511,DU
         2 001115   000002 116003                    CMPQ    2,DU
         2 001116   001125 600000 2                  TZE     s:9242

      669     9237    3       THEN DO;

      670     9238    3         F$DCB.FFLG.WNEW = %YES#;

   9238  2 001117   100000 236003                    LDQ     32768,DU
         2 001120   000004 256100                    ORSQ    4,,PR0

      671     9239    3         F$DCB.FFLG.UPD = %YES#;

   9239  2 001121   200016 470500                    LDP0    JDCB$,,AUTO
         2 001122   040000 236003                    LDQ     16384,DU
         2 001123   000004 256100                    ORSQ    4,,PR0

      672     9240    3         END;

   9240  2 001124   001157 710000 2                  TRA     NOUHL

      673     9241    3       ELSE DO;                            /* No user labels input               */

      674     9242    3         CALL HFF$DSIZ( POFFW(ADDR(PN$.UHL_),ADDR(PN$.V_)), I ) ALTRET(NOUHL);

   9242  2 001125   200003 236100                    LDQ     @PN$,,AUTO
         2 001126   000022 772000                    QRL     18
         2 001127   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 001130   200003 236100                    LDQ     @PN$,,AUTO
         2 001131   000002 036003                    ADLQ    2,DU
         2 001132   000022 772000                    QRL     18
         2 001133   200052 136100                    SBLQ    JRNL_OFFSET+2,,AUTO
         2 001134   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 001135   200014 633500                    EPPR3   I,,AUTO
         2 001136   200055 453500                    STP3    JRNL_OFFSET+5,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:110  
         2 001137   200053 634500                    EPPR4   JRNL_OFFSET+3,,AUTO
         2 001140   200054 454500                    STP4    JRNL_OFFSET+4,,AUTO
         2 001141   200054 630500                    EPPR0   JRNL_OFFSET+4,,AUTO
         2 001142   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001143   000000 701000 xent               TSX1    HFF$DSIZ
         2 001144   001157 702000 2                  TSX2    NOUHL

      675     9243    3         TEMP$ = PN$.UHL_;

   9243  2 001145   200003 470500                    LDP0    @PN$,,AUTO
         2 001146   000002 236100                    LDQ     2,,PR0
         2 001147   200032 756100                    STQ     TEMP$,,AUTO

      676     9244    3         IF TEMP$ ~= ADDR(NIL) AND I >= 4

   9244  2 001150   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001151   001157 600000 2                  TZE     NOUHL
         2 001152   200014 235100                    LDA     I,,AUTO
         2 001153   000004 115007                    CMPA    4,DL
         2 001154   001157 604000 2                  TMI     NOUHL

      677     9245    3          THEN TEMP$->VLP$SN_V.NUM = 0;    /* None                               */

   9245  2 001155   200032 471500                    LDP1    TEMP$,,AUTO
         2 001156   100000 450100                    STZ     0,,PR1

   9244  2 001157                       NOUHL        null
      678     9246    3   NOUHL: ;
      679     9247    3         END;

      680     9248    2      F$DCB.TAPTYP.RWASC = %YES#;

   9248  2 001157   200016 470500                    LDP0    JDCB$,,AUTO
         2 001160   000400 236003                    LDQ     256,DU
         2 001161   000067 256100                    ORSQ    55,,PR0

      681     9249    2      F$DCB.TAPTYP.CP6F = %NO#;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:111  

   9249  2 001162   000025 236000 3                  LDQ     21
         2 001163   000067 356100                    ANSQ    55,,PR0

      682     9250    2      CALL FTO_SETTAPTYP;

   9250  2 001164   005407 701000 2                  TSX1    FTO_SETTAPTYP
         2 001165   000000 011000                    NOP     0

      683     9251    2      RETURN;

   9251  2 001166   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 001167   000001 702211                    TSX2  ! 1,X1

   9249  2 001170                       CLSTAP       null
      684     9252
      685     9253    2   CLSTAP: ;
      686     9254    2      CALL FRB$CLS;

   9254  2 001170   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001171   000000 701000 xent               TSX1    FRB$CLS
         2 001172   000000 011000                    NOP     0

   9249  2 001173                       JUSTALT      null
      687     9255    2   JUSTALT: ;
      688     9256    2      ALTRETURN;

   9256  2 001173   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 001174   000000 702211                    TSX2  ! 0,X1

      689     9257
      690     9258    2   END FTO_OPNDEV;
      691     9259        /*********************************************************************/
      692     9260        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:112  
      693     9261        /*********************************************************************/
      694     9262    1   FTO_OPNCREATE: PROC ALTRET;

   9262  2 001175   200034 741300       FTO_OPNCREA* STX1  ! TEMP$+2,,AUTO

      695     9263        /*F*    NAME: FTO_OPNCREATE
      696     9264                PURPOSE: Open tape file for create.
      697     9265         ***/
      698     9266
      699     9267        /********************/
      700     9268
      701     9269         /***
      702     9270          *** Check file name, BLKL and RECL.
      703     9271          ***/
      704     9272
      705     9273    2      CALL FMN$CHKFLACN(JDCB$) ALTRET(JUSTALT); /* Check file name and account   */

   9273  2 001176   200016 630500                    EPPR0   JDCB$,,AUTO
         2 001177   200052 450500                    STP0    JRNL_OFFSET+2,,AUTO
         2 001200   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 001201   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001202   000000 701000 xent               TSX1    FMN$CHKFLACN
         2 001203   001212 702000 2                  TSX2    JUSTALT

      706     9274    2      CALL FTO_CHK_BLKL_RECL ALTRET(JUSTALT);

   9274  2 001204   002274 701000 2                  TSX1    FTO_CHK_BLKL_RECL
         2 001205   001212 702000 2                  TSX2    JUSTALT

      707     9275
      708     9276    2      CALL FTO_CREATEOPEN ALTRET(JUSTALT);

   9276  2 001206   001214 701000 2                  TSX1    FTO_CREATEOPEN
         2 001207   001212 702000 2                  TSX2    JUSTALT

      709     9277    2      RETURN;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:113  
   9277  2 001210   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 001211   000001 702211                    TSX2  ! 1,X1

   9273  2 001212                       JUSTALT      null
      710     9278
      711     9279    2   JUSTALT: ;
      712     9280    2      ALTRETURN;

   9280  2 001212   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 001213   000000 702211                    TSX2  ! 0,X1

      713     9281
      714     9282    2   END FTO_OPNCREATE;
      715     9283        /********************************************************************/
      716     9284        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:114  
      717     9285        /********************************************************************/
      718     9286    1   FTO_CREATEOPEN: PROC ALTRET;

   9286  2 001214   200036 741300       FTO_CREATEO* STX1  ! TEMP$+4,,AUTO

      719     9287        /*F*     NAME: FTO_CREATEOPEN
      720     9288                 PURPOSE: Opens tape and tape file for creation.
      721     9289         ***/
      722     9290
      723     9291        /********************/
      724     9292
      725     9293         /***
      726     9294          *** For CP-6 files, no EBCDIC translation.
      727     9295          ***/
      728     9296
      729     9297    2      CALL FTO_SETTAPTYP;                  /* Determine tape type                */

   9297  2 001215   005407 701000 2                  TSX1    FTO_SETTAPTYP
         2 001216   000000 011000                    NOP     0

      730     9298    2      IF ((NOT F$DCB.TAPTYP.RWASC) AND

   9298  2 001217   200016 470500                    LDP0    JDCB$,,AUTO
         2 001220   000067 236100                    LDQ     55,,PR0
         2 001221   000400 316003                    CANQ    256,DU
         2 001222   001232 601000 2                  TNZ     s:9304
         2 001223   000033 220100                    LDX0    27,,PR0
         2 001224   255471 100003                    CMPX0   88889,DU
         2 001225   001232 602000 2                  TNC     s:9304

      731     9299    2        (F$DCB.BLKL > 88888 )) THEN        /* CHECK IF BLKL WOULD BE TO BIG      */
      732     9300    3      DO;

      733     9301    3         B$JIT.ERR = E_BLKL;            /*E*  ERROR: FTO-E$BLKL       */

   9301  2 001226   000024 236000 1                  LDQ     E_BLKL
         2 001227   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:115  
         2 001230   100012 756100                    STQ     10,,PR1

      734     9302    3         GOTO JUSTALT;

   9302  2 001231   002272 710000 2                  TRA     JUSTALT

      735     9303    3         END;
      736     9304    2      IF F$DCB.TAPTYP.CP6F

   9304  2 001232   000200 316003                    CANQ    128,DU
         2 001233   001240 600000 2                  TZE     s:9310

      737     9305    3       THEN DO;                            /* CP6 file                           */

      738     9306    3         F$DCB.EBCDIC = %NO#;

   9306  2 001234   000005 236000 3                  LDQ     5
         2 001235   000031 356100                    ANSQ    25,,PR0

      739     9307    3         F$DCB.CNVRT = %NO#;

   9307  2 001236   000022 236000 3                  LDQ     18
         2 001237   000031 356100                    ANSQ    25,,PR0

      740     9308    3         END;

      741     9309
      742     9310    2      IF NOT F$DCB.EBCDIC OR F$DCB.ANSISPANSEQ

   9310  2 001240   000031 236100                    LDQ     25,,PR0
         2 001241   100000 316007                    CANQ    32768,DL
         2 001242   001246 600000 2                  TZE     s:9311
         2 001243   000060 236100                    LDQ     48,,PR0
         2 001244   010000 316007                    CANQ    4096,DL
         2 001245   001250 600000 2                  TZE     s:9318

      743     9311    2       THEN F$DCB.REALSPAN = '1'B;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:116  

   9311  2 001246   002000 236007                    LDQ     1024,DL
         2 001247   000102 256100                    ORSQ    66,,PR0

      744     9312
      745     9313         /***
      746     9314          *** Scratch mount implied if no SN.  Otherwise put SN list in
      747     9315          *** the CFU area.
      748     9316          ***/
      749     9317
      750     9318    2      IF F$DCB.VOL = 0                     /* Remember if initial vol specified  */

   9318  2 001250   000043 236100                    LDQ     35,,PR0
         2 001251   777000 316003                    CANQ    -512,DU
         2 001252   001256 601000 2                  TNZ     s:9320

      751     9319    2       THEN F$DCB.SEZ_OK = %NO#;

   9319  2 001253   000011 236000 3                  LDQ     9
         2 001254   000064 356100                    ANSQ    52,,PR0
         2 001255   001260 710000 2                  TRA     s:9321

      752     9320    2       ELSE F$DCB.SEZ_OK = %YES#;          /* Initial vol specified              */

   9320  2 001256   000004 236003                    LDQ     4,DU
         2 001257   000064 256100                    ORSQ    52,,PR0

      753     9321    2      CALL FTO_GETSN ALTRET(JUSTALT);      /* Determine serial number            */

   9321  2 001260   005616 701000 2                  TSX1    FTO_GETSN
         2 001261   002272 702000 2                  TSX2    JUSTALT

      754     9322    2      IF FT_PROT = FT_FULLPROT#

   9322  2 001262   000000 235000 xsym               LDA     FT_PROT
         2 001263   000002 115007                    CMPA    2,DL
         2 001264   001300 601000 2                  TNZ     s:9337
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:117  

      755     9323    3       THEN DO;                       /* Fully protected system...no scratches   */

      756     9324    3         F$DCB.MAXVOL = 0;

   9324  2 001265   200016 470500                    LDP0    JDCB$,,AUTO
         2 001266   000000 236003                    LDQ     0,DU
         2 001267   000043 552120                    STBQ    35,'20'O,PR0

      757     9325    3         IF F$DCB.PSN = ' '

   9325  2 001270   040000 106500                    CMPC    fill='040'O
         2 001271   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 001272   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001273   001300 601000 2                  TNZ     s:9337

      758     9326    4          THEN DO;                         /* No scratches                       */

      759     9327    4            B$JIT.ERR = E_NOSN; /*E* ERROR: FTO-E$NOSN */

   9327  2 001274   000036 236000 1                  LDQ     E_NOSN
         2 001275   000000 471400 xsym               LDP1    B$JIT$
         2 001276   100012 756100                    STQ     10,,PR1

      760     9328    4            GOTO JUSTALT;

   9328  2 001277   002272 710000 2                  TRA     JUSTALT

      761     9329    4            END;
      762     9330    3         END;
      763     9331
      764     9332
      765     9333         /***
      766     9334          *** Default resource is MT.
      767     9335          ***/
      768     9336
      769     9337    2      IF F$DCB.RESNT.NUM = ' ' THEN F$DCB.RES = 'LT';
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:118  

   9337  2 001300   200016 470500                    LDP0    JDCB$,,AUTO
         2 001301   000026 720100                    LXL0    22,,PR0
         2 001302   040040 100003                    CMPX0   16416,DU
         2 001303   001310 601000 2                  TNZ     s:9345

   9337  2 001304   000046 236000 1                  LDQ     E_NOFILE+2
         2 001305   777777 376003                    ANQ     -1,DU
         2 001306   040040 276007                    ORQ     16416,DL
         2 001307   000026 756100                    STQ     22,,PR0

      770     9338
      771     9339         /***
      772     9340          *** Get tape mounted; if not at beginning of set it can't be scratch
      773     9341          *** since the FSN can not be known.  The tape must be the same (EBCDIC
      774     9342          *** or ASCII) as the new file.
      775     9343          ***/
      776     9344
      777     9345    2      IF F$DCB.DENSITY = 0

   9345  2 001310   000043 236100                    LDQ     35,,PR0
         2 001311   000777 316007                    CANQ    511,DL
         2 001312   001316 601000 2                  TNZ     s:9347

      778     9346    2       THEN F$DCB.ATTR = '0'B;

   9346  2 001313   000000 220003                    LDX0    0,DU
         2 001314   000040 440100                    SXL0    32,,PR0
         2 001315   001324 710000 2                  TRA     s:9348

      779     9347    2       ELSE F$DCB.ATTR = FT_DENS(F$DCB.DENSITY);

   9347  2 001316   000043 236100                    LDQ     35,,PR0
         2 001317   000777 376007                    ANQ     511,DL
         2 001320   000001 736000                    QLS     1
         2 001321   000100 100406                    MLR     fill='000'O
         2 001322   000000 000002 1                  ADSC9   FT_DENS,Q                cn=0,n=2
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:119  
         2 001323   000040 400002                    ADSC9   32,,PR0                  cn=2,n=2

      780     9348    2      CALL FRA$OPR ALTRET(RELCFUS);        /* Get tape                           */

   9348  2 001324   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001325   000000 701000 xent               TSX1    FRA$OPR
         2 001326   002267 702000 2                  TSX2    RELCFUS

      781     9349    3      DO CASE(F$DCB.ORG);

   9349  2 001327   200016 470500                    LDP0    JDCB$,,AUTO
         2 001330   000032 236100                    LDQ     26,,PR0
         2 001331   000033 772000                    QRL     27
         2 001332   000004 136007                    SBLQ    4,DL
         2 001333   000006 116007                    CMPQ    6,DL
         2 001334   001336 602006 2                  TNC     s:9349+7,QL
         2 001335   001356 710000 2                  TRA     s:9353
         2 001336   001344 710000 2                  TRA     s:9351
         2 001337   001356 710000 2                  TRA     s:9353
         2 001340   001356 710000 2                  TRA     s:9353
         2 001341   001356 710000 2                  TRA     s:9353
         2 001342   001356 710000 2                  TRA     s:9353
         2 001343   001344 710000 2                  TRA     s:9351

      782     9350    3       CASE(%UR#,%SYMB#);

      783     9351    3         F$DCB.ATTR=F$DCB.ATTR|F$DCB.FORM$->CODE16.ATTR;

   9351  2 001344   000050 471500                    LDP1    40,,PR0
         2 001345   100003 236100                    LDQ     3,,PR1
         2 001346   000022 736000                    QLS     18
         2 001347   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 001350   000040 236100                    LDQ     32,,PR0
         2 001351   000022 736000                    QLS     18
         2 001352   200052 276100                    ORQ     JRNL_OFFSET+2,,AUTO
         2 001353   000022 772000                    QRL     18
         2 001354   000000 620006                    EAX0    0,QL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:120  
         2 001355   000040 440100                    SXL0    32,,PR0

      784     9352    3       END;

      785     9353    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9353  2 001356   000051 720100                    LXL0    41,,PR0
         2 001357   000000 471400 xsym               LDP1    N$DCT$$
         2 001360   100000 473510                    LDP3    0,X0,PR1
         2 001361   300004 236100                    LDQ     4,,PR3
         2 001362   200012 756100                    STQ     DDDT$,,AUTO

      786     9354    2      FT$DDT.SN = F$DCB.PSN;

   9354  2 001363   200012 474500                    LDP4    DDDT$,,AUTO
         2 001364   040100 100500                    MLR     fill='040'O
         2 001365   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 001366   400002 000006                    ADSC9   2,,PR4                   cn=0,n=6

      787     9355    2      I = F$DCB.VOL;

   9355  2 001367   200016 470500                    LDP0    JDCB$,,AUTO
         2 001370   000043 236100                    LDQ     35,,PR0
         2 001371   000033 772000                    QRL     27
         2 001372   200014 756100                    STQ     I,,AUTO

      788     9356    2      CALL FTR$SETSN(I,ADDR(F$DCB.PSN)) ALTRET(NEVER1);

   9356  2 001373   200016 236100                    LDQ     JDCB$,,AUTO
         2 001374   000024 036003                    ADLQ    20,DU
         2 001375   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 001376   200052 633500                    EPPR3   JRNL_OFFSET+2,,AUTO
         2 001377   200055 453500                    STP3    JRNL_OFFSET+5,,AUTO
         2 001400   200014 635500                    EPPR5   I,,AUTO
         2 001401   200054 455500                    STP5    JRNL_OFFSET+4,,AUTO
         2 001402   200054 630500                    EPPR0   JRNL_OFFSET+4,,AUTO
         2 001403   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:121  
         2 001404   000000 701000 xent               TSX1    FTR$SETSN
         2 001405   001406 702000 2                  TSX2    NEVER1

   9355  2 001406                       NEVER1       null
      789     9357    2   NEVER1: ;
      790     9358
      791     9359         /***
      792     9360          *** Create opens can not be allowed to ANSscratch or unlabelled tapes
      793     9361          *** which are not the first volume of a set since the file
      794     9362          *** sequence number can not be determined.
      795     9363          ***/
      796     9364
      797     9365    2      IF F$DCB.VOL > 1

   9365  2 001406   200016 470500                    LDP0    JDCB$,,AUTO
         2 001407   000043 236100                    LDQ     35,,PR0
         2 001410   777000 376003                    ANQ     -512,DU
         2 001411   002000 116003                    CMPQ    1024,DU
         2 001412   001425 602000 2                  TNC     s:9377
         2 001413   200012 471500                    LDP1    DDDT$,,AUTO
         2 001414   100006 236100                    LDQ     6,,PR1
         2 001415   200000 316007                    CANQ    65536,DL
         2 001416   001421 601000 2                  TNZ     s:9368
         2 001417   400000 316007                    CANQ    -131072,DL
         2 001420   001425 601000 2                  TNZ     s:9377

      798     9366    2        AND (FT$DDT.SCRTCH OR NOT FT$DDT.ANST)
      799     9367    3       THEN DO;                            /* Illegal mount of scratch tape      */

      800     9368    3         B$JIT.ERR = E_SCRORDER; /*E* ERROR: FTO-E$SCRORDER */

   9368  2 001421   000040 236000 1                  LDQ     E_SCRORDER
         2 001422   000000 473400 xsym               LDP3    B$JIT$
         2 001423   300012 756100                    STQ     10,,PR3

      801     9369    3         GOTO CLSTAP;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:122  
   9369  2 001424   002256 710000 2                  TRA     CLSTAP

      802     9370    3         END;
      803     9371
      804     9372         /*
      805     9373          * If last close left the tape in the middle of the file, space to the
      806     9374          * next beginning-of-file in the tape set.
      807     9375          */
      808     9376
      809     9377    3      IF FT$DDT.NOTEOF THEN DO;

   9377  2 001425   200012 471500                    LDP1    DDDT$,,AUTO
         2 001426   100007 236100                    LDQ     7,,PR1
         2 001427   200000 316007                    CANQ    65536,DL
         2 001430   001451 600000 2                  TZE     s:9388

      810     9378    3         FT$DDT.NOTEOF = '0'B;

   9378  2 001431   000022 236000 3                  LDQ     18
         2 001432   100007 356100                    ANSQ    7,,PR1

      811     9379    3         ALABEL = ' ';

   9379  2 001433   000026 236000 3                  LDQ     22
         2 001434   200005 756100                    STQ     ALABEL,,AUTO

      812     9380    3         CALL FTL$SPF(ALABEL) ALTRET(CLSTAP);

   9380  2 001435   200005 630500                    EPPR0   ALABEL,,AUTO
         2 001436   200052 450500                    STP0    JRNL_OFFSET+2,,AUTO
         2 001437   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 001440   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001441   000000 701000 xent               TSX1    FTL$SPF
         2 001442   002256 702000 2                  TSX2    CLSTAP

      813     9381    3         DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:123  
   9381  2 001443   200016 470500                    LDP0    JDCB$,,AUTO
         2 001444   000051 720100                    LXL0    41,,PR0
         2 001445   000000 471400 xsym               LDP1    N$DCT$$
         2 001446   100000 473510                    LDP3    0,X0,PR1
         2 001447   300004 236100                    LDQ     4,,PR3
         2 001450   200012 756100                    STQ     DDDT$,,AUTO

      814     9382    3         END;

      815     9383
      816     9384         /*
      817     9385          * Position to end of volume set if requested.
      818     9386          */
      819     9387
      820     9388    3      IF F$DCB.XTEND THEN DO;              /* Extend volume set                  */

   9388  2 001451   000031 236100                    LDQ     25,,PR0
         2 001452   000040 316007                    CANQ    32,DL
         2 001453   001465 600000 2                  TZE     s:9399

      821     9389    3         CALL FTL$PEOS ALTRET(CLSTAP);

   9389  2 001454   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001455   000000 701000 xent               TSX1    FTL$PEOS
         2 001456   002256 702000 2                  TSX2    CLSTAP

      822     9390    3         DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9390  2 001457   200016 470500                    LDP0    JDCB$,,AUTO
         2 001460   000051 720100                    LXL0    41,,PR0
         2 001461   000000 471400 xsym               LDP1    N$DCT$$
         2 001462   100000 473510                    LDP3    0,X0,PR1
         2 001463   300004 236100                    LDQ     4,,PR3
         2 001464   200012 756100                    STQ     DDDT$,,AUTO

      823     9391    3         END;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:124  
      824     9392
      825     9393         /***
      826     9394          *** Only permit writing if current position is known to be
      827     9395          *** either between the double file mark at volume end or before
      828     9396          *** the next HDR1 on the tape.
      829     9397          ***/
      830     9398
      831     9399    2      IF (FT$DDT.POS ~= FTP_HDR# AND FT$DDT.POS ~= FTP_BOV#)

   9399  2 001465   200012 471500                    LDP1    DDDT$,,AUTO
         2 001466   100006 236100                    LDQ     6,,PR1
         2 001467   000160 376007                    ANQ     112,DL
         2 001470   000040 116007                    CMPQ    32,DL
         2 001471   001474 600000 2                  TZE     s:9399+7
         2 001472   000020 116007                    CMPQ    16,DL
         2 001473   001477 601000 2                  TNZ     s:9402
         2 001474   100007 236100                    LDQ     7,,PR1
         2 001475   400000 316007                    CANQ    -131072,DL
         2 001476   001503 600000 2                  TZE     s:9411

      832     9400    2        OR FT$DDT.FUNNYPOS
      833     9401    3       THEN DO;                       /* Not positioned where writing allowed    */

      834     9402    3         B$JIT.ERR = E_FUNNYPOS; /*E* ERROR: FTO-E$FUNNYPOS */

   9402  2 001477   000027 236000 1                  LDQ     E_FUNNYPOS
         2 001500   000000 473400 xsym               LDP3    B$JIT$
         2 001501   300012 756100                    STQ     10,,PR3

      835     9403    3         GOTO CLSTAP;

   9403  2 001502   002256 710000 2                  TRA     CLSTAP

      836     9404    3         END;
      837     9405
      838     9406         /***
      839     9407          *** Only permit change of recording code (EBCDIC/ASCII) if at the
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:125  
      840     9408          *** beginning of a volume set.
      841     9409          ***/
      842     9410
      843     9411    2      IF FT$DDT.POS = FTP_BOV# AND F$DCB.VOL = 1

   9411  2 001503   100006 236100                    LDQ     6,,PR1
         2 001504   000160 376007                    ANQ     112,DL
         2 001505   000020 116007                    CMPQ    16,DL
         2 001506   001523 601000 2                  TNZ     s:9417
         2 001507   000043 236100                    LDQ     35,,PR0
         2 001510   777000 376003                    ANQ     -512,DU
         2 001511   001000 116003                    CMPQ    512,DU
         2 001512   001523 601000 2                  TNZ     s:9417

      844     9412    3       THEN DO;                       /* At beginning of set, begin 'new' set    */

      845     9413    3         FT$DDT.EBCDIC = F$DCB.EBCDIC;

   9413  2 001513   000031 236100                    LDQ     25,,PR0
         2 001514   100006 676100                    ERQ     6,,PR1
         2 001515   100000 376007                    ANQ     32768,DL
         2 001516   100006 656100                    ERSQ    6,,PR1

      846     9414    3         F$DCB.FSN = 1;                    /* Beginning of set                   */

   9414  2 001517   000001 220003                    LDX0    1,DU
         2 001520   200016 470500                    LDP0    JDCB$,,AUTO
         2 001521   000034 740100                    STX0    28,,PR0

      847     9415    3         END;

   9415  2 001522   001545 710000 2                  TRA     s:9431

      848     9416    3       ELSE DO;   /* Not at beginning of set, tape and file must use same code   */

      849     9417    3         IF FT$DDT.EBCDIC ~= F$DCB.EBCDIC

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:126  
   9417  2 001523   100006 236100                    LDQ     6,,PR1
         2 001524   000031 676100                    ERQ     25,,PR0
         2 001525   100000 376007                    ANQ     32768,DL
         2 001526   001542 600000 2                  TZE     s:9424

      850     9418    4          THEN DO;                         /* They don't use same code           */

      851     9419    4            IF FT$DDT.EBCDIC

   9419  2 001527   100006 236100                    LDQ     6,,PR1
         2 001530   100000 316007                    CANQ    32768,DL
         2 001531   001536 600000 2                  TZE     s:9421

      852     9420    4             THEN B$JIT.ERR = E_EBCDICTAP; /*E* ERROR: FTO-E$EBCDICTAP */

   9420  2 001532   000025 236000 1                  LDQ     E_EBCDICTAP
         2 001533   000000 473400 xsym               LDP3    B$JIT$
         2 001534   300012 756100                    STQ     10,,PR3
         2 001535   001541 710000 2                  TRA     s:9422

      853     9421    4             ELSE B$JIT.ERR = E_ASCIITAP; /*E* ERROR: FTO-E$ASCIITAP */

   9421  2 001536   000020 236000 1                  LDQ     E_ASCIITAP
         2 001537   000000 473400 xsym               LDP3    B$JIT$
         2 001540   300012 756100                    STQ     10,,PR3

      854     9422    4            GOTO CLSTAP;

   9422  2 001541   002256 710000 2                  TRA     CLSTAP

      855     9423    4            END;
      856     9424    3         F$DCB.FSN = FT$DDT.FSN + 1;       /* Next file in sequence              */

   9424  2 001542   100005 220100                    LDX0    5,,PR1
         2 001543   000001 621010                    EAX1    1,X0
         2 001544   000034 741100                    STX1    28,,PR0

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:127  
      857     9425    3         END;

      858     9426
      859     9427         /***
      860     9428          *** FSN must be 9999 or less.  Do checks on tape.
      861     9429          ***/
      862     9430
      863     9431    2      IF F$DCB.FSN > 9999

   9431  2 001545   000034 220100                    LDX0    28,,PR0
         2 001546   023420 100003                    CMPX0   10000,DU
         2 001547   001554 602000 2                  TNC     s:9436

      864     9432    3       THEN DO;

      865     9433    3         B$JIT.ERR = E_BADFSN; /*E* ERROR: FTO-E$BADFSN */

   9433  2 001550   000021 236000 1                  LDQ     E_BADFSN
         2 001551   000000 473400 xsym               LDP3    B$JIT$
         2 001552   300012 756100                    STQ     10,,PR3

      866     9434    3         GOTO CLSTAP;

   9434  2 001553   002256 710000 2                  TRA     CLSTAP

      867     9435    3         END;
      868     9436    2      F$DCB.NOEOF = %YES#;                 /* Indicate output tape to FTR$DPT    */

   9436  2 001554   400000 236007                    LDQ     -131072,DL
         2 001555   000064 256100                    ORSQ    52,,PR0

      869     9437    2      CALL FTR$DPT ALTRET(CLSTAP);    /* Do density, write permit, type checks   */

   9437  2 001556   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001557   000000 701000 xent               TSX1    FTR$DPT
         2 001560   002256 702000 2                  TSX2    CLSTAP

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:128  
      870     9438    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9438  2 001561   200016 470500                    LDP0    JDCB$,,AUTO
         2 001562   000051 720100                    LXL0    41,,PR0
         2 001563   000000 471400 xsym               LDP1    N$DCT$$
         2 001564   100000 473510                    LDP3    0,X0,PR1
         2 001565   300004 236100                    LDQ     4,,PR3
         2 001566   200012 756100                    STQ     DDDT$,,AUTO

      871     9439
      872     9440         /***
      873     9441          *** Build FORM area and FIT if necessary.
      874     9442          ***/
      875     9443
      876     9444    2      IF F$DCB.TAPTYP.CP6F

   9444  2 001567   000067 236100                    LDQ     55,,PR0
         2 001570   000200 316003                    CANQ    128,DU
         2 001571   001607 600000 2                  TZE     s:9454

      877     9445    3       THEN DO;                            /* Build FIT                          */

      878     9446    3         IF NOT F$DCB.BUPM&'01'B THEN F$DCB.DESC.BUPM=F$DCB.BUPM;

   9446  2 001572   000031 236100                    LDQ     25,,PR0
         2 001573   000042 736000                    QLS     34
         2 001574   200000 376003                    ANQ     65536,DU
         2 001575   001603 601000 2                  TNZ     s:9447

   9446  2 001576   000031 236100                    LDQ     25,,PR0
         2 001577   000007 736000                    QLS     7
         2 001600   000005 676100                    ERQ     5,,PR0
         2 001601   000400 376007                    ANQ     256,DL
         2 001602   000005 656100                    ERSQ    5,,PR0

      879     9447    3         CALL FMO$BLDFIT(PN$) ALTRET(CLSTAP); /* Build the FIT                   */

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:129  
   9447  2 001603   200003 630500                    EPPR0   @PN$,,AUTO
         2 001604   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001605   000000 701000 xent               TSX1    FMO$BLDFIT
         2 001606   002256 702000 2                  TSX2    CLSTAP

      880     9448    3         END;

      881     9449
      882     9450         /***
      883     9451          *** Write VOL1 if at beginning of tape.
      884     9452          ***/
      885     9453
      886     9454    2      F$DCB.FSECT = 1;                     /* First section                      */

   9454  2 001607   000001 220003                    LDX0    1,DU
         2 001610   200016 470500                    LDP0    JDCB$,,AUTO
         2 001611   000077 740100                    STX0    63,,PR0

      887     9455    2      IF FT$DDT.POS = FTP_BOV#             /* Write new labels if at BOV         */

   9455  2 001612   200012 471500                    LDP1    DDDT$,,AUTO
         2 001613   100006 236100                    LDQ     6,,PR1
         2 001614   000160 376007                    ANQ     112,DL
         2 001615   000020 116007                    CMPQ    16,DL
         2 001616   001623 600000 2                  TZE     s:9458
         2 001617   040000 106500                    CMPC    fill='040'O
         2 001620   100003 400006                    ADSC9   3,,PR1                   cn=2,n=6
         2 001621   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001622   001733 601000 2                  TNZ     s:9481

      888     9456    2        OR FT$DDT.EXPIRE = ' '             /* Detects first labeled file on PO   */
      889     9457    3       THEN DO;

      890     9458    3         IF F$DCB.VOL = 1

   9458  2 001623   000043 236100                    LDQ     35,,PR0
         2 001624   777000 376003                    ANQ     -512,DU
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:130  
         2 001625   001000 116003                    CMPQ    512,DU
         2 001626   001711 601000 2                  TNZ     s:9471

      891     9459    4          THEN DO;                         /* Beginning of set                   */

      892     9460    4            CALL SSS$SYSTIME( I );         /* Get universal time                 */

   9460  2 001627   200014 633500                    EPPR3   I,,AUTO
         2 001630   200052 453500                    STP3    JRNL_OFFSET+2,,AUTO
         2 001631   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 001632   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001633   000000 701000 xent               TSX1    SSS$SYSTIME
         2 001634   000000 011000                    NOP     0

      893     9461    4            IF F$DCB.EXPIRE = 0 THEN F$DCB.EXPIRE = B$JIT.DEFEXP;
              9461                     /* Use default if none */

   9461  2 001635   200016 470500                    LDP0    JDCB$,,AUTO
         2 001636   000035 235100                    LDA     29,,PR0
         2 001637   001644 601000 2                  TNZ     s:9462

   9461  2 001640   000000 471400 xsym               LDP1    B$JIT$
         2 001641   100221 236100                    LDQ     145,,PR1
         2 001642   000022 732000                    QRS     18
         2 001643   000035 756100                    STQ     29,,PR0

      894     9462    4            IF F$DCB.EXPIRE < 0            /* Default (0) => NEVER               */

   9462  2 001644   000035 235100                    LDA     29,,PR0
         2 001645   001653 605000 2                  TPL     s:9465

      895     9463    4             THEN FT$DDT.EXPIRE = '99365'; /* Negative means never               */

   9463  2 001646   200012 471500                    LDP1    DDDT$,,AUTO
         2 001647   040100 100400                    MLR     fill='040'O
         2 001650   000050 000005 1                  ADSC9   E_NOFILE+4               cn=0,n=5
         2 001651   100003 400006                    ADSC9   3,,PR1                   cn=2,n=6
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:131  
         2 001652   001711 710000 2                  TRA     s:9471

      896     9464    5             ELSE DO;                      /* Calculate expiration date          */

      897     9465    5               CALL XUD$UTS_ADJUST(I,I,F$DCB.EXPIRE*%UTS_CSEC_DAY#);

   9465  2 001653   000035 236100                    LDQ     29,,PR0
         2 001654   000027 402000 3                  MPY     23
         2 001655   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 001656   200052 631500                    EPPR1   JRNL_OFFSET+2,,AUTO
         2 001657   200055 451500                    STP1    JRNL_OFFSET+5,,AUTO
         2 001660   200014 633500                    EPPR3   I,,AUTO
         2 001661   200054 453500                    STP3    JRNL_OFFSET+4,,AUTO
         2 001662   200014 634500                    EPPR4   I,,AUTO
         2 001663   200053 454500                    STP4    JRNL_OFFSET+3,,AUTO
         2 001664   200053 630500                    EPPR0   JRNL_OFFSET+3,,AUTO
         2 001665   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001666   000000 701000 xent               TSX1    XUD$UTS_ADJUST
         2 001667   000000 011000                    NOP     0

      898     9466    5               CALL UMT$JDATE( FT$DDT.EXPIRE, I );

   9466  2 001670   200014 630500                    EPPR0   I,,AUTO
         2 001671   200053 450500                    STP0    JRNL_OFFSET+3,,AUTO
         2 001672   200012 236100                    LDQ     DDDT$,,AUTO
         2 001673   000030 036000 3                  ADLQ    24
         2 001674   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 001675   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 001676   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001677   000000 701000 xent               TSX1    UMT$JDATE
         2 001700   000000 011000                    NOP     0

      899     9467    5               IF FT$DDT.EXPIRE > '99364'  /* This means never                   */

   9467  2 001701   200012 470500                    LDP0    DDDT$,,AUTO
         2 001702   040100 106400                    CMPC    fill='040'O
         2 001703   000052 000005 1                  ADSC9   E_NOFILE+6               cn=0,n=5
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:132  
         2 001704   000003 400006                    ADSC9   3,,PR0                   cn=2,n=6
         2 001705   001711 603000 2                  TRC     s:9471

      900     9468    5                THEN FT$DDT.EXPIRE = '00001'; /* Avoid ambiguity, use next day   */

   9468  2 001706   040100 100400                    MLR     fill='040'O
         2 001707   000054 000005 1                  ADSC9   E_NOFILE+8               cn=0,n=5
         2 001710   000003 400006                    ADSC9   3,,PR0                   cn=2,n=6

      901     9469    5               END;

      902     9470    4            END;

      903     9471    3         FT$DDT.VOLACCESS = F$DCB.VOLACCESS; /* Remember access control          */

   9471  2 001711   200016 470500                    LDP0    JDCB$,,AUTO
         2 001712   200012 471500                    LDP1    DDDT$,,AUTO
         2 001713   000031 236100                    LDQ     25,,PR0
         2 001714   000033 772000                    QRL     27
         2 001715   100007 676100                    ERQ     7,,PR1
         2 001716   000003 376007                    ANQ     3,DL
         2 001717   100007 656100                    ERSQ    7,,PR1

      904     9472    3         FT$DDT.ACCT = B$JIT.ACCN;         /* Remember owner                     */

   9472  2 001720   000000 470400 xsym               LDP0    B$JIT$
         2 001721   040100 100500                    MLR     fill='040'O
         2 001722   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         2 001723   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8

      905     9473    3         IF FT$DDT.POS = FTP_BOV#

   9473  2 001724   100006 236100                    LDQ     6,,PR1
         2 001725   000160 376007                    ANQ     112,DL
         2 001726   000020 116007                    CMPQ    16,DL
         2 001727   001733 601000 2                  TNZ     s:9481

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:133  
      906     9474    3          THEN CALL FTL$VOL1 ALTRET(CLSTAP); /* Only if at BOV                   */

   9474  2 001730   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001731   000000 701000 xent               TSX1    FTL$VOL1
         2 001732   002256 702000 2                  TSX2    CLSTAP

      907     9475    3         END;

      908     9476
      909     9477         /***
      910     9478          *** Write HDR1 and HDR2 followed by User Header Labels.
      911     9479          ***/
      912     9480
      913     9481    2      F$DCB.PRECNO = 1;

   9481  2 001733   000001 235007                    LDA     1,DL
         2 001734   200016 470500                    LDP0    JDCB$,,AUTO
         2 001735   000072 755100                    STA     58,,PR0

      914     9482    2      F$DCB.AFTRBLK = %NO#;                /* In case of CVOL                    */

   9482  2 001736   000004 236000 3                  LDQ     4
         2 001737   000064 356100                    ANSQ    52,,PR0

      915     9483    2      BACKUP_FM_CNT = 0;                   /* Assume CVOL not needed             */

   9483  2 001740   200006 450100                    STZ     BACKUP_FM_CNT,,AUTO

      916     9484    2      IF F$DCB.ORG = %RESTRICT# AND NO_IFPARAM_RESTRICT

   9484  2 001741   000032 236100                    LDQ     26,,PR0
         2 001742   777000 376003                    ANQ     -512,DU
         2 001743   022000 116003                    CMPQ    9216,DU
         2 001744   001754 601000 2                  TNZ     s:9486
         2 001745   200020 234100                    SZN     NO_IFPARAM_RESTRICT,,AUTO
         2 001746   001754 605000 2                  TPL     s:9486

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:134  
      917     9485    2       THEN CALL FTL$LBLS( 'HDR' ) ALTRET( CLSTAP );

   9485  2 001747   000031 630400 3                  EPPR0   25
         2 001750   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001751   000000 701000 xent               TSX1    FTL$LBLS
         2 001752   002256 702000 2                  TSX2    CLSTAP
         2 001753   001766 710000 2                  TRA     s:9487

      918     9486    2       ELSE CALL FTL$LBLS( 'HDR', ADDR(NIL) ) ALTRET( CLSTAP );

   9486  2 001754   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001755   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 001756   200052 631500                    EPPR1   JRNL_OFFSET+2,,AUTO
         2 001757   200055 451500                    STP1    JRNL_OFFSET+5,,AUTO
         2 001760   000031 236000 3                  LDQ     25
         2 001761   200054 756100                    STQ     JRNL_OFFSET+4,,AUTO
         2 001762   200054 630500                    EPPR0   JRNL_OFFSET+4,,AUTO
         2 001763   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001764   000000 701000 xent               TSX1    FTL$LBLS
         2 001765   002256 702000 2                  TSX2    CLSTAP

      919     9487    2      FT$DDT.FMNEEDED = %YES#;             /* Need file marks                    */

   9487  2 001766   200012 470500                    LDP0    DDDT$,,AUTO
         2 001767   000200 236007                    LDQ     128,DL
         2 001770   000006 256100                    ORSQ    6,,PR0

      920     9488    2      FT$DDT.SCRTCH = %NO#;                /* Tape is no longer scratch          */

   9488  2 001771   000022 236000 3                  LDQ     18
         2 001772   000006 356100                    ANSQ    6,,PR0

      921     9489    2      CALL HFF$DSIZ( POFFW(ADDR(PN$.UHL_),ADDR(PN$.V_)), I ) ALTRET(NOUHL);

   9489  2 001773   200003 236100                    LDQ     @PN$,,AUTO
         2 001774   000022 772000                    QRL     18
         2 001775   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:135  
         2 001776   200003 236100                    LDQ     @PN$,,AUTO
         2 001777   000002 036003                    ADLQ    2,DU
         2 002000   000022 772000                    QRL     18
         2 002001   200052 136100                    SBLQ    JRNL_OFFSET+2,,AUTO
         2 002002   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 002003   200014 631500                    EPPR1   I,,AUTO
         2 002004   200055 451500                    STP1    JRNL_OFFSET+5,,AUTO
         2 002005   200053 633500                    EPPR3   JRNL_OFFSET+3,,AUTO
         2 002006   200054 453500                    STP3    JRNL_OFFSET+4,,AUTO
         2 002007   200054 630500                    EPPR0   JRNL_OFFSET+4,,AUTO
         2 002010   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002011   000000 701000 xent               TSX1    HFF$DSIZ
         2 002012   002033 702000 2                  TSX2    NOUHL

      922     9490    2      TEMP$ = PN$.UHL_;

   9490  2 002013   200003 470500                    LDP0    @PN$,,AUTO
         2 002014   000002 236100                    LDQ     2,,PR0
         2 002015   200032 756100                    STQ     TEMP$,,AUTO

      923     9491    2      IF TEMP$ = ADDR(NIL) THEN I = 0;     /* Might be default open              */

   9491  2 002016   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002017   002021 601000 2                  TNZ     s:9492

   9491  2 002020   200014 450100                    STZ     I,,AUTO

      924     9492    2      CALL FTL$ULBLS('UHL',TEMP$,I) ALTRET(CLSTAP);

   9492  2 002021   200014 631500                    EPPR1   I,,AUTO
         2 002022   200054 451500                    STP1    JRNL_OFFSET+4,,AUTO
         2 002023   200032 633500                    EPPR3   TEMP$,,AUTO
         2 002024   200053 453500                    STP3    JRNL_OFFSET+3,,AUTO
         2 002025   000032 236000 3                  LDQ     26
         2 002026   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 002027   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 002030   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:136  
         2 002031   000000 701000 xent               TSX1    FTL$ULBLS
         2 002032   002256 702000 2                  TSX2    CLSTAP

   9491  2 002033                       NOUHL        null
      925     9493    2   NOUHL: ;
      926     9494    2      CALL FTI$WRFM ALTRET(CLSTAP);

   9494  2 002033   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002034   000000 701000 xent               TSX1    FTI$WRFM
         2 002035   002256 702000 2                  TSX2    CLSTAP

      927     9495    2      BACKUP_FM_CNT = 2;                   /* CVOL needed if tape end            */

   9495  2 002036   000002 235007                    LDA     2,DL
         2 002037   200006 755100                    STA     BACKUP_FM_CNT,,AUTO

      928     9496    2      FT$DDT.FSN = F$DCB.FSN;              /* Restore FSN                        */

   9496  2 002040   200016 470500                    LDP0    JDCB$,,AUTO
         2 002041   000034 220100                    LDX0    28,,PR0
         2 002042   200012 471500                    LDP1    DDDT$,,AUTO
         2 002043   100005 740100                    STX0    5,,PR1

      929     9497
      930     9498         /***
      931     9499          *** Determine protection for CP-6 format files; default protection
      932     9500          *** for non CP-6 format files.
      933     9501          ***/
      934     9502
      935     9503    2      IF F$DCB.TAPTYP.CP6F

   9503  2 002044   200016 470500                    LDP0    JDCB$,,AUTO
         2 002045   000067 236100                    LDQ     55,,PR0
         2 002046   000200 316003                    CANQ    128,DU
         2 002047   002133 600000 2                  TZE     s:9519

      936     9504    3       THEN DO;                            /* CP-6 format file                   */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:137  

      937     9505    3         TEMP$ = FM$BUF$(F$DCB.BFR.BUFX(1)); /* Get pointer                      */

   9505  2 002050   000116 236100                    LDQ     78,,PR0
         2 002051   000033 772000                    QRL     27
         2 002052   000037 376007                    ANQ     31,DL
         2 002053   000000 236006 xsym               LDQ     FM$BUF$,QL
         2 002054   200032 756100                    STQ     TEMP$,,AUTO

      938     9506    3         TEMP$->FT$HDR.L1 = 16 * F$DCB.BFR1.SIZ(1); /* 4096 * #pages / 256       */

   9506  2 002055   000123 236100                    LDQ     83,,PR0
         2 002056   000016 772000                    QRL     14
         2 002057   017760 376007                    ANQ     8176,DL
         2 002060   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 002061   200032 473500                    LDP3    TEMP$,,AUTO
         2 002062   000100 101500                    MRL     fill='000'O
         2 002063   200052 000004                    ADSC9   JRNL_OFFSET+2,,AUTO      cn=0,n=4
         2 002064   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

      939     9507    3         TEMP$->FT$HDR.L2 = 0;             /* 4096 - (4096 / 256) * 256          */

   9507  2 002065   200032 470500                    LDP0    TEMP$,,AUTO
         2 002066   000100 101400                    MRL     fill='000'O
         2 002067   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         2 002070   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1

      940     9508    3         TEMP$->FT$HDR.S1 = 0;

   9508  2 002071   200032 470500                    LDP0    TEMP$,,AUTO
         2 002072   000100 101400                    MRL     fill='000'O
         2 002073   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         2 002074   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1

      941     9509    3         TEMP$->FT$HDR.S2 = 128;           /* Set FPARAM bit                     */

   9509  2 002075   200032 470500                    LDP0    TEMP$,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:138  
         2 002076   000100 101400                    MRL     fill='000'O
         2 002077   000033 000004 3                  ADSC9   27                       cn=0,n=4
         2 002100   000000 600001                    ADSC9   0,,PR0                   cn=3,n=1

      942     9510    3         F$DCB.ARS = 4096 * F$DCB.BFR1.SIZ(1);

   9510  2 002101   200016 470500                    LDP0    JDCB$,,AUTO
         2 002102   000123 236100                    LDQ     83,,PR0
         2 002103   000006 772000                    QRL     6
         2 002104   000034 376000 3                  ANQ     28
         2 002105   000000 756100                    STQ     0,,PR0

      943     9511                                                /* Write entire FIT                   */
      944     9512    3         CALL FTI$WRBIN(TEMP$) ALTRET(CLSTAP);

   9512  2 002106   200032 630500                    EPPR0   TEMP$,,AUTO
         2 002107   200052 450500                    STP0    JRNL_OFFSET+2,,AUTO
         2 002110   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 002111   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002112   000000 701000 xent               TSX1    FTI$WRBIN
         2 002113   002256 702000 2                  TSX2    CLSTAP

      945     9513    3         BACKUP_FM_CNT = 2;                /* CVOL needed if tape end            */

   9513  2 002114   000002 235007                    LDA     2,DL
         2 002115   200006 755100                    STA     BACKUP_FM_CNT,,AUTO

      946     9514    3         F$DCB.OWNER = %YES#;              /* Only protect by account            */

   9514  2 002116   200016 470500                    LDP0    JDCB$,,AUTO
         2 002117   040000 236007                    LDQ     16384,DL
         2 002120   000064 256100                    ORSQ    52,,PR0

      947     9515    3         CALL FMO$SECCHK( PN$.V_->FPT$OPEN_V, TEMP$->FPT$OPEN_V );

   9515  2 002121   200003 471500                    LDP1    @PN$,,AUTO
         2 002122   100000 473500                    LDP3    0,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:139  
         2 002123   200032 236100                    LDQ     TEMP$,,AUTO
         2 002124   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 002125   200052 453500                    STP3    JRNL_OFFSET+2,,AUTO
         2 002126   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 002127   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002130   000000 701000 xent               TSX1    FMO$SECCHK
         2 002131   000000 011000                    NOP     0

      948     9516                                                /* Pass V area and FIT TO SET FFLG    */
      949     9517    3         END;

   9517  2 002132   002146 710000 2                  TRA     s:9524

      950     9518    3       ELSE DO;                            /* No protection for non CP-6         */

      951     9519    3         F$DCB.FFLG = '0'B;

   9519  2 002133   000000 221003                    LDX1    0,DU
         2 002134   000004 741100                    STX1    4,,PR0

      952     9520    3         F$DCB.FFLG.READ = %YES#;

   9520  2 002135   200016 470500                    LDP0    JDCB$,,AUTO
         2 002136   400000 236003                    LDQ     -131072,DU
         2 002137   000004 256100                    ORSQ    4,,PR0

      953     9521    3         F$DCB.FFLG.WNEW = %YES#;

   9521  2 002140   200016 470500                    LDP0    JDCB$,,AUTO
         2 002141   100000 236003                    LDQ     32768,DU
         2 002142   000004 256100                    ORSQ    4,,PR0

      954     9522    3         F$DCB.FFLG.UPD = %YES#;

   9522  2 002143   200016 470500                    LDP0    JDCB$,,AUTO
         2 002144   040000 236003                    LDQ     16384,DU
         2 002145   000004 256100                    ORSQ    4,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:140  

      955     9523    3         END;

      956     9524    2      F$DCB.NOEOF = %YES#;                 /* Always for create                  */

   9524  2 002146   200016 470500                    LDP0    JDCB$,,AUTO
         2 002147   400000 236007                    LDQ     -131072,DL
         2 002150   000064 256100                    ORSQ    52,,PR0

      957     9525    2      F$DCB.EOP = WRITEEOP#;               /* Always for create                  */

   9525  2 002151   003000 236003                    LDQ     1536,DU
         2 002152   000064 256100                    ORSQ    52,,PR0

      958     9526    2      F$DCB.FMOD = %YES#;

   9526  2 002153   040000 236003                    LDQ     16384,DU
         2 002154   000064 256100                    ORSQ    52,,PR0

      959     9527    2      F$DCB.LSTBLK = %YES#;

   9527  2 002155   000001 236007                    LDQ     1,DL
         2 002156   000064 256100                    ORSQ    52,,PR0

      960     9528    2      IF F$DCB.EBCDIC THEN

   9528  2 002157   000031 236100                    LDQ     25,,PR0
         2 002160   100000 316007                    CANQ    32768,DL
         2 002161   002166 600000 2                  TZE     s:9536

      961     9529    2         F$DCB.STR = F$DCB.VOL - 1;

   9529  2 002162   000043 236100                    LDQ     35,,PR0
         2 002163   000033 772000                    QRL     27
         2 002164   000001 136007                    SBLQ    1,DL
         2 002165   000077 552104                    STBQ    63,'04'O,PR0

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:141  
      962     9530
      963     9531         /***
      964     9532          *** A volume change is needed if tape end was hit and the user
      965     9533          *** doesn't desire CVOL control.
      966     9534          ***/
      967     9535
      968     9536    2      IF BACKUP_FM_CNT > 0 AND NOT F$DCB.CVOL AND F$DCB.TYC.EOT(1)

   9536  2 002166   200006 235100                    LDA     BACKUP_FM_CNT,,AUTO
         2 002167   002212 604400 2                  TMOZ    s:9540
         2 002170   000031 236100                    LDQ     25,,PR0
         2 002171   000020 316007                    CANQ    16,DL
         2 002172   002212 601000 2                  TNZ     s:9540
         2 002173   000002 236100                    LDQ     2,,PR0
         2 002174   100000 316003                    CANQ    32768,DU
         2 002175   002212 600000 2                  TZE     s:9540

      969     9537    3       THEN DO;                            /* Change to next volume              */

      970     9538    3         CALL FTL$CVOL(TEMP$,ADDR(NIL),0) ALTRET(CHKVOLOUT);

   9538  2 002176   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 002177   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 002200   000035 236000 3                  LDQ     29
         2 002201   200055 756100                    STQ     JRNL_OFFSET+5,,AUTO
         2 002202   200052 631500                    EPPR1   JRNL_OFFSET+2,,AUTO
         2 002203   200054 451500                    STP1    JRNL_OFFSET+4,,AUTO
         2 002204   200032 633500                    EPPR3   TEMP$,,AUTO
         2 002205   200053 453500                    STP3    JRNL_OFFSET+3,,AUTO
         2 002206   200053 630500                    EPPR0   JRNL_OFFSET+3,,AUTO
         2 002207   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002210   000000 701000 xent               TSX1    FTL$CVOL
         2 002211   002214 702000 2                  TSX2    CHKVOLOUT

      971     9539    3         END;

      972     9540    2      RETURN;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:142  

   9540  2 002212   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 002213   000001 702211                    TSX2  ! 1,X1

   9536  2 002214                       CHKVOLOUT    null
      973     9541
      974     9542    2   CHKVOLOUT: ;
      975     9543    2      IF B$JIT.ERR.CODE = %E$VOLOUT

   9543  2 002214   000000 470400 xsym               LDP0    B$JIT$
         2 002215   000012 236100                    LDQ     10,,PR0
         2 002216   377770 376007                    ANQ     131064,DL
         2 002217   013270 116007                    CMPQ    5816,DL
         2 002220   002256 601000 2                  TNZ     CLSTAP

      976     9544    3       THEN DO;                            /* No next volume...can't CVOL        */

      977     9545    3         ERRSAV = B$JIT.ERR;

   9545  2 002221   000012 236100                    LDQ     10,,PR0
         2 002222   200013 756100                    STQ     ERRSAV,,AUTO

      978     9546    3         F$DCB.ARS = - BACKUP_FM_CNT;      /* Backup to beginning of file        */

   9546  2 002223   200016 471500                    LDP1    JDCB$,,AUTO
         2 002224   200006 335100                    LCA     BACKUP_FM_CNT,,AUTO
         2 002225   100000 755100                    STA     0,,PR1

      979     9547    3         CALL FTI$SPFILE ALTRET(CLSTAP);

   9547  2 002226   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002227   000000 701000 xent               TSX1    FTI$SPFILE
         2 002230   002256 702000 2                  TSX2    CLSTAP

      980     9548    3         F$DCB.ARS = 1;                    /* Skip file mark or VOL1             */

   9548  2 002231   000001 235007                    LDA     1,DL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:143  
         2 002232   200016 470500                    LDP0    JDCB$,,AUTO
         2 002233   000000 755100                    STA     0,,PR0

      981     9549    3         CALL FTI$SPREC ALTRET(CLSTAP);

   9549  2 002234   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002235   000000 701000 xent               TSX1    FTI$SPREC
         2 002236   002256 702000 2                  TSX2    CLSTAP

      982     9550    3         CALL FTI$WRFM ALTRET(CLSTAP);

   9550  2 002237   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002240   000000 701000 xent               TSX1    FTI$WRFM
         2 002241   002256 702000 2                  TSX2    CLSTAP

      983     9551    3         F$DCB.ARS = -1;

   9551  2 002242   000001 335007                    LCA     1,DL
         2 002243   200016 470500                    LDP0    JDCB$,,AUTO
         2 002244   000000 755100                    STA     0,,PR0

      984     9552    3         CALL FTI$SPFILE ALTRET(CLSTAP);

   9552  2 002245   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002246   000000 701000 xent               TSX1    FTI$SPFILE
         2 002247   002256 702000 2                  TSX2    CLSTAP

      985     9553    3         FT$DDT.POS = FTP_HDR#;

   9553  2 002250   200012 470500                    LDP0    DDDT$,,AUTO
         2 002251   000006 236100                    LDQ     6,,PR0
         2 002252   000012 376000 3                  ANQ     10
         2 002253   000040 276007                    ORQ     32,DL
         2 002254   000006 756100                    STQ     6,,PR0

      986     9554    3         GOTO CLSTAPERR;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:144  
   9554  2 002255   002261 710000 2                  TRA     CLSTAPERR

   9551  2 002256                       CLSTAP       null
      987     9555    3         END;
      988     9556
      989     9557         /***
      990     9558          *** Errors: ***
      991     9559          ***/
      992     9560
      993     9561    2   CLSTAP: ;
      994     9562    2      ERRSAV = B$JIT.ERR;

   9562  2 002256   000000 470400 xsym               LDP0    B$JIT$
         2 002257   000012 236100                    LDQ     10,,PR0
         2 002260   200013 756100                    STQ     ERRSAV,,AUTO

   9562  2 002261                       CLSTAPERR    null
      995     9563    2   CLSTAPERR: ;
      996     9564    2      CALL FRB$CLS;

   9564  2 002261   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002262   000000 701000 xent               TSX1    FRB$CLS
         2 002263   000000 011000                    NOP     0

      997     9565    2      B$JIT.ERR = ERRSAV;

   9565  2 002264   200013 236100                    LDQ     ERRSAV,,AUTO
         2 002265   000000 470400 xsym               LDP0    B$JIT$
         2 002266   000012 756100                    STQ     10,,PR0

      998     9566
      999     9567    2   RELCFUS:
     1000     9568    2      CALL FTR$RELCFUS;

   9568  2 002267   000002 631400 xsym  RELCFUS      EPPR1   B_VECTNIL+2
         2 002270   000000 701000 xent               TSX1    FTR$RELCFUS
         2 002271   000000 011000                    NOP     0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:145  

     1001     9569
     1002     9570    2   JUSTALT:
     1003     9571    2      ALTRETURN;

   9571  2 002272   200036 221300       JUSTALT      LDX1  ! TEMP$+4,,AUTO
         2 002273   000000 702211                    TSX2  ! 0,X1

     1004     9572
     1005     9573    2   END FTO_CREATEOPEN;
     1006     9574        /*********************************************************************/
     1007     9575        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:146  
     1008     9576        /*********************************************************************/
     1009     9577    1   FTO_CHK_BLKL_RECL: PROC ALTRET;

   9577  2 002274   200036 741300       FTO_CHK_BLK* STX1  ! TEMP$+4,,AUTO

     1010     9578        /*F*     NAME: FTO_CHK_BLKL_RECL
     1011     9579                 PURPOSE: Check (and possibly adjust) BLKL and RECL options.
     1012     9580         ***/
     1013     9581
     1014     9582        /********************/
     1015     9583
     1016     9584         /***
     1017     9585          *** Make sure format is legal for free tape.
     1018     9586          ***/
     1019     9587
     1020     9588    2      IF F$DCB.ASN = %DEVICE#

   9588  2 002275   200016 470500                    LDP0    JDCB$,,AUTO
         2 002276   000032 236100                    LDQ     26,,PR0
         2 002277   777000 376007                    ANQ     -512,DL
         2 002300   003000 116007                    CMPQ    1536,DL
         2 002301   002361 601000 2                  TNZ     s:9609

     1021     9589    3       THEN DO;

     1022     9590    4         DO CASE(F$DCB.ORG);

   9590  2 002302   000032 236100                    LDQ     26,,PR0
         2 002303   000033 772000                    QRL     27
         2 002304   000024 116007                    CMPQ    20,DL
         2 002305   002307 602006 2                  TNC     s:9590+5,QL
         2 002306   002336 710000 2                  TRA     s:9595
         2 002307   002336 710000 2                  TRA     s:9595
         2 002310   002354 710000 2                  TRA     s:9605
         2 002311   002354 710000 2                  TRA     s:9605
         2 002312   002354 710000 2                  TRA     s:9605
         2 002313   002354 710000 2                  TRA     s:9605
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:147  
         2 002314   002354 710000 2                  TRA     s:9605
         2 002315   002354 710000 2                  TRA     s:9605
         2 002316   002354 710000 2                  TRA     s:9605
         2 002317   002354 710000 2                  TRA     s:9605
         2 002320   002354 710000 2                  TRA     s:9605
         2 002321   002336 710000 2                  TRA     s:9595
         2 002322   002336 710000 2                  TRA     s:9595
         2 002323   002336 710000 2                  TRA     s:9595
         2 002324   002354 710000 2                  TRA     s:9605
         2 002325   002336 710000 2                  TRA     s:9595
         2 002326   002351 710000 2                  TRA     s:9602
         2 002327   002344 710000 2                  TRA     s:9599
         2 002330   002351 710000 2                  TRA     s:9602
         2 002331   002354 710000 2                  TRA     s:9605
         2 002332   002333 710000 2                  TRA     s:9592

     1023     9591    4          CASE(%FREE#);

     1024     9592    4            F$DCB.TAPTYP.MANAGED = %NO#;

   9592  2 002333   000036 236000 3                  LDQ     30
         2 002334   000067 356100                    ANSQ    55,,PR0

     1025     9593    4            RETURN;                        /* No BLKL checking                   */

   9593  2 002335   000001 702211                    TSX2  ! 1,X1

     1026     9594    4          CASE(ELSE);

     1027     9595    4            F$DCB.ORG = %FREE#;

   9595  2 002336   023000 236003                    LDQ     9728,DU
         2 002337   000032 552140                    STBQ    26,'40'O,PR0

     1028     9596    4            F$DCB.TAPTYP.MANAGED = %NO#;

   9596  2 002340   000036 236000 3                  LDQ     30
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:148  
         2 002341   000067 356100                    ANSQ    55,,PR0

     1029     9597    4            RETURN;                        /* No BLKL checking                   */

   9597  2 002342   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 002343   000001 702211                    TSX2  ! 1,X1

     1030     9598    4          CASE(%VARIABLE#);

     1031     9599    4            F$DCB.TAPTYP.MANAGED = %YES#;

   9599  2 002344   000010 236003                    LDQ     8,DU
         2 002345   000067 256100                    ORSQ    55,,PR0

     1032     9600    4            F$DCB.EBCDIC = %NO#;           /* Must be ANS format                 */

   9600  2 002346   000005 236000 3                  LDQ     5
         2 002347   000031 356100                    ANSQ    25,,PR0
         2 002350   002361 710000 2                  TRA     s:9609

     1033     9601    4          CASE(%FIXED#,%UNDEF#);

     1034     9602    4            F$DCB.TAPTYP.MANAGED = %YES#;

   9602  2 002351   000010 236003                    LDQ     8,DU
         2 002352   000067 256100                    ORSQ    55,,PR0
         2 002353   002361 710000 2                  TRA     s:9609

     1035     9603    4          CASE(%CONSEC#,%KEYED#,%RANDOM#,%UR#,%RELATIVE#,%INDEXED#,

     1036     9604    4              %IDS#,%RESTRICT#,%TERMINAL#,%SYMB#,%IREL#);
     1037     9605    4            B$JIT.ERR = E_NOTFREEORG; /*E* ERROR: FTO-E$NOTFREEORG */

   9605  2 002354   000037 236000 1                  LDQ     E_NOTFREEORG
         2 002355   000000 471400 xsym               LDP1    B$JIT$
         2 002356   100012 756100                    STQ     10,,PR1

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:149  
     1038     9606    4            ALTRETURN;

   9606  2 002357   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 002360   000000 702211                    TSX2  ! 0,X1

     1039     9607    4          END;

     1040     9608    3         END;
     1041     9609    2      MAXBLKL = 4096 * (B$JIT.FBUL - 2);   /* Minus 2 for label, a/m buffers     */

   9609  2 002361   000000 471400 xsym               LDP1    B$JIT$
         2 002362   100205 236100                    LDQ     133,,PR1
         2 002363   000014 736000                    QLS     12
         2 002364   000037 376000 3                  ANQ     31
         2 002365   020000 136007                    SBLQ    8192,DL
         2 002366   200017 756100                    STQ     MAXBLKL,,AUTO

     1042     9610    2      IF MAXBLKL <= 0

   9610  2 002367   002374 605400 2                  TPNZ    s:9615

     1043     9611    3       THEN DO;                            /* Not enough FPOOLs                  */

     1044     9612    3         B$JIT.ERR = E_NOFPOOL;            /*E* ERROR: FTO-E$NOFPOOL */

   9612  2 002370   000034 236000 1                  LDQ     E_NOFPOOL
         2 002371   100012 756100                    STQ     10,,PR1

     1045     9613    3         ALTRETURN;

   9613  2 002372   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 002373   000000 702211                    TSX2  ! 0,X1

     1046     9614    3         END;
     1047     9615    2      IF MAXBLKL > 99996

   9615  2 002374   303234 116007                    CMPQ    99996,DL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:150  
         2 002375   002400 604400 2                  TMOZ    s:9622

     1048     9616    2       THEN MAXBLKL = 99996;               /* Limit size to word bound < 99999   */

   9616  2 002376   303234 235007                    LDA     99996,DL
         2 002377   200017 755100                    STA     MAXBLKL,,AUTO

     1049     9617
     1050     9618         /***
     1051     9619          *** Process create open depending on file org.
     1052     9620          ***/
     1053     9621
     1054     9622    3      DO CASE(F$DCB.ORG);

   9622  2 002400   000032 236100                    LDQ     26,,PR0
         2 002401   000033 772000                    QRL     27
         2 002402   000023 116007                    CMPQ    19,DL
         2 002403   002405 602006 2                  TNC     s:9622+5,QL
         2 002404   002430 710000 2                  TRA     s:9625
         2 002405   002430 710000 2                  TRA     s:9625
         2 002406   002700 710000 2                  TRA     CONSECORG
         2 002407   002700 710000 2                  TRA     CONSECORG
         2 002410   002600 710000 2                  TRA     s:9668
         2 002411   002700 710000 2                  TRA     CONSECORG
         2 002412   002700 710000 2                  TRA     CONSECORG
         2 002413   002700 710000 2                  TRA     CONSECORG
         2 002414   002600 710000 2                  TRA     s:9668
         2 002415   002430 710000 2                  TRA     s:9625
         2 002416   002700 710000 2                  TRA     CONSECORG
         2 002417   002430 710000 2                  TRA     s:9625
         2 002420   002430 710000 2                  TRA     s:9625
         2 002421   002430 710000 2                  TRA     s:9625
         2 002422   002700 710000 2                  TRA     CONSECORG
         2 002423   002430 710000 2                  TRA     s:9625
         2 002424   002462 710000 2                  TRA     s:9641
         2 002425   002760 710000 2                  TRA     s:9714
         2 002426   002433 710000 2                  TRA     s:9629
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:151  
         2 002427   002600 710000 2                  TRA     s:9668

     1055     9623
     1056     9624    3       CASE(ELSE);

     1057     9625    3         F$DCB.ORG = %CONSEC#;

   9625  2 002430   001000 236003                    LDQ     512,DU
         2 002431   000032 552140                    STBQ    26,'40'O,PR0

     1058     9626    3         GOTO CONSECORG;

   9626  2 002432   002700 710000 2                  TRA     CONSECORG

     1059     9627
     1060     9628    3       CASE(%UNDEF#);

     1061     9629    3         F$DCB.BOL = 0;                    /* No BOL                             */

   9629  2 002433   000000 236003                    LDQ     0,DU
         2 002434   000034 552104                    STBQ    28,'04'O,PR0

     1062     9630    3         F$DCB.BLOCKED = %NO#;             /* Not blocked                        */

   9630  2 002435   000040 236000 3                  LDQ     32
         2 002436   000031 356100                    ANSQ    25,,PR0

     1063     9631    3         F$DCB.SPANNED = %NO#;             /* Not spanned                        */

   9631  2 002437   000041 236000 3                  LDQ     33
         2 002440   000031 356100                    ANSQ    25,,PR0

     1064     9632    3         IF F$DCB.RECL = 0                 /* *RECL*                             */

   9632  2 002441   000033 720100                    LXL0    27,,PR0
         2 002442   002446 601000 2                  TNZ     s:9634

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:152  
     1065     9633    3          THEN F$DCB.RECL = 80;            /* Default is 80                      */

   9633  2 002443   000120 221003                    LDX1    80,DU
         2 002444   000033 441100                    SXL1    27,,PR0
         2 002445   002457 710000 2                  TRA     s:9638

     1066     9634    3          ELSE IF F$DCB.RECL < 4

   9634  2 002446   000004 100003                    CMPX0   4,DU
         2 002447   002453 603000 2                  TRC     s:9636

     1067     9635    3             THEN F$DCB.RECL = 4;          /* Minimum                            */

   9635  2 002450   000004 221003                    LDX1    4,DU
         2 002451   000033 441100                    SXL1    27,,PR0
         2 002452   002457 710000 2                  TRA     s:9638

     1068     9636    3             ELSE IF F$DCB.RECL > 65536    /* Maximum                            */

   9636  2 002453   200001 100003                    CMPX0   65537,DU
         2 002454   002457 602000 2                  TNC     s:9638

     1069     9637    3                THEN F$DCB.RECL = 65536;

   9637  2 002455   200000 221003                    LDX1    65536,DU
         2 002456   000033 441100                    SXL1    27,,PR0

     1070     9638    3         F$DCB.BLKL = F$DCB.RECL;          /* One record per block               */

   9638  2 002457   000033 720100                    LXL0    27,,PR0
         2 002460   000033 740100                    STX0    27,,PR0
         2 002461   003240 710000 2                  TRA     s:9773

     1071     9639
     1072     9640    3       CASE(%FIXED#);

     1073     9641    3         F$DCB.BOL = 0;                    /* No BOL                             */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:153  

   9641  2 002462   000000 236003                    LDQ     0,DU
         2 002463   000034 552104                    STBQ    28,'04'O,PR0

     1074     9642    3         F$DCB.SPANNED = %NO#;             /* No spanning                        */

   9642  2 002464   000041 236000 3                  LDQ     33
         2 002465   000031 356100                    ANSQ    25,,PR0

     1075     9643    3         IF F$DCB.RECL = 0                 /* *RECL*                             */

   9643  2 002466   000033 720100                    LXL0    27,,PR0
         2 002467   002473 601000 2                  TNZ     s:9645

     1076     9644    3          THEN F$DCB.RECL = 80;            /* Default is 80                      */

   9644  2 002470   000120 221003                    LDX1    80,DU
         2 002471   000033 441100                    SXL1    27,,PR0
         2 002472   002505 710000 2                  TRA     s:9649

     1077     9645    3          ELSE IF F$DCB.RECL < 1

   9645  2 002473   002477 601000 2                  TNZ     s:9647

     1078     9646    3             THEN F$DCB.RECL = 1;          /* Minimum                            */

   9646  2 002474   000001 221003                    LDX1    1,DU
         2 002475   000033 441100                    SXL1    27,,PR0
         2 002476   002505 710000 2                  TRA     s:9649

     1079     9647    3             ELSE IF F$DCB.RECL > MAXBLKL  /* Maximum                            */

   9647  2 002477   000033 236100                    LDQ     27,,PR0
         2 002500   777777 376007                    ANQ     -1,DL
         2 002501   200017 116100                    CMPQ    MAXBLKL,,AUTO
         2 002502   002505 604400 2                  TMOZ    s:9649

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:154  
     1080     9648    3                THEN F$DCB.RECL = MAXBLKL;

   9648  2 002503   200017 721100                    LXL1    MAXBLKL,,AUTO
         2 002504   000033 441100                    SXL1    27,,PR0

     1081     9649    3         IF F$DCB.BLOCKED

   9649  2 002505   000031 236100                    LDQ     25,,PR0
         2 002506   000010 316007                    CANQ    8,DL
         2 002507   002563 600000 2                  TZE     s:9662

     1082     9650    4          THEN DO;                         /* Fixed and blocked                  */

     1083     9651    4            IF F$DCB.BLKL = 0

   9651  2 002510   000033 220100                    LDX0    27,,PR0
         2 002511   002521 601000 2                  TNZ     s:9655

     1084     9652    4             THEN IF F$DCB.EBCDIC

   9652  2 002512   100000 316007                    CANQ    32768,DL
         2 002513   002517 600000 2                  TZE     s:9654

     1085     9653    4                THEN F$DCB.BLKL = 6400;

   9653  2 002514   014400 221003                    LDX1    6400,DU
         2 002515   000033 741100                    STX1    27,,PR0
         2 002516   002521 710000 2                  TRA     s:9655

     1086     9654    4                ELSE F$DCB.BLKL = 2000;

   9654  2 002517   003720 221003                    LDX1    2000,DU
         2 002520   000033 741100                    STX1    27,,PR0

     1087     9655    4            IF F$DCB.BLKL < F$DCB.RECL

   9655  2 002521   000033 720100                    LXL0    27,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:155  
         2 002522   000033 100100                    CMPX0   27,,PR0
         2 002523   002527 602000 2                  TNC     s:9657
         2 002524   002527 600000 2                  TZE     s:9657

     1088     9656    4             THEN F$DCB.BLKL = F$DCB.RECL; /* Minimum is record length           */

   9656  2 002525   000033 740100                    STX0    27,,PR0
         2 002526   002535 710000 2                  TRA     s:9659

     1089     9657    4             ELSE IF F$DCB.BLKL > MAXBLKL  /* Maximum                            */

   9657  2 002527   000033 236100                    LDQ     27,,PR0
         2 002530   000022 772000                    QRL     18
         2 002531   200017 116100                    CMPQ    MAXBLKL,,AUTO
         2 002532   002535 604400 2                  TMOZ    s:9659

     1090     9658    4                THEN F$DCB.BLKL = MAXBLKL;

   9658  2 002533   200017 721100                    LXL1    MAXBLKL,,AUTO
         2 002534   000033 741100                    STX1    27,,PR0

     1091     9659    4           F$DCB.BLKL = ( (F$DCB.BLKL + (F$DCB.RECL - 1) ) / F$DCB.RECL) * F$DCB.RECL;
              9659                     /* Make integral */

   9659  2 002535   000033 236100                    LDQ     27,,PR0
         2 002536   000022 772000                    QRL     18
         2 002537   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 002540   000033 236100                    LDQ     27,,PR0
         2 002541   777777 376007                    ANQ     -1,DL
         2 002542   200052 036100                    ADLQ    JRNL_OFFSET+2,,AUTO
         2 002543   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 002544   000033 236100                    LDQ     27,,PR0
         2 002545   777777 376007                    ANQ     -1,DL
         2 002546   200054 756100                    STQ     JRNL_OFFSET+4,,AUTO
         2 002547   200053 236100                    LDQ     JRNL_OFFSET+3,,AUTO
         2 002550   000001 136007                    SBLQ    1,DL
         2 002551   200054 506100                    DIV     JRNL_OFFSET+4,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:156  
         2 002552   200055 756100                    STQ     JRNL_OFFSET+5,,AUTO
         2 002553   000033 236100                    LDQ     27,,PR0
         2 002554   777777 376007                    ANQ     -1,DL
         2 002555   200056 756100                    STQ     JRNL_OFFSET+6,,AUTO
         2 002556   200055 236100                    LDQ     JRNL_OFFSET+5,,AUTO
         2 002557   200056 402100                    MPY     JRNL_OFFSET+6,,AUTO
         2 002560   000000 620006                    EAX0    0,QL
         2 002561   000033 740100                    STX0    27,,PR0

     1092     9660    4            END;

   9660  2 002562   002565 710000 2                  TRA     s:9664

     1093     9661    4          ELSE DO;                         /* Fixed and not blocked              */

     1094     9662    4            F$DCB.BLKL = F$DCB.RECL;       /* One record per block               */

   9662  2 002563   000033 720100                    LXL0    27,,PR0
         2 002564   000033 740100                    STX0    27,,PR0

     1095     9663    4            END;

     1096     9664    3         IF NOT F$DCB.EBCDIC

   9664  2 002565   000031 236100                    LDQ     25,,PR0
         2 002566   100000 316007                    CANQ    32768,DL
         2 002567   003240 601000 2                  TNZ     s:9773

     1097     9665    3          THEN F$DCB.BLKL = ( (F$DCB.BLKL + 3) / 4 ) * 4;

   9665  2 002570   000033 236100                    LDQ     27,,PR0
         2 002571   000022 772000                    QRL     18
         2 002572   000003 036007                    ADLQ    3,DL
         2 002573   000002 772000                    QRL     2
         2 002574   000002 736000                    QLS     2
         2 002575   000000 621006                    EAX1    0,QL
         2 002576   000033 741100                    STX1    27,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:157  
         2 002577   003240 710000 2                  TRA     s:9773

     1098     9666
     1099     9667    3       CASE(%RANDOM#,%RESTRICT#,%IDS#);

     1100     9668    3         IF F$DCB.ORG = %RESTRICT#

   9668  2 002600   000033 736000                    QLS     27
         2 002601   022000 116003                    CMPQ    9216,DU
         2 002602   002665 601000 2                  TNZ     s:9688

     1101     9669    4          THEN DO;                    /* Make sure IFPARAM buffer is present     */

     1102     9670    4            IF NOT B$JIT.PRIV.ACTIVE & %PR_FMBLK#

   9670  2 002603   100013 236100                    LDQ     11,,PR1
         2 002604   000060 376000 1                  ANQ     E_NOFILE+12
         2 002605   002612 601000 2                  TNZ     s:9675

     1103     9671    5             THEN DO;                      /* Not allowed to access RESTRICT     */

     1104     9672    5               B$JIT.ERR = E_NORESTRICT; /*E* ERROR: FTO-E$NORESTRICT */

   9672  2 002606   000035 236000 1                  LDQ     E_NORESTRICT
         2 002607   100012 756100                    STQ     10,,PR1

     1105     9673    5               ALTRETURN;

   9673  2 002610   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 002611   000000 702211                    TSX2  ! 0,X1

     1106     9674    5               END;
     1107     9675    4            NO_IFPARAM_RESTRICT = %NO#;    /* Assume FIT specified               */

   9675  2 002612   200020 450100                    STZ     NO_IFPARAM_RESTRICT,,AUTO

     1108     9676    4            CALL HFF$DSIZ(POFFW(ADDR(PN$.IFPARAM_),ADDR(PN$.V_)),I) ALTRET(NOIFPARAM);
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:158  

   9676  2 002613   200003 236100                    LDQ     @PN$,,AUTO
         2 002614   000022 772000                    QRL     18
         2 002615   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 002616   200003 236100                    LDQ     @PN$,,AUTO
         2 002617   000013 036003                    ADLQ    11,DU
         2 002620   000022 772000                    QRL     18
         2 002621   200052 136100                    SBLQ    JRNL_OFFSET+2,,AUTO
         2 002622   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 002623   200014 633500                    EPPR3   I,,AUTO
         2 002624   200055 453500                    STP3    JRNL_OFFSET+5,,AUTO
         2 002625   200053 634500                    EPPR4   JRNL_OFFSET+3,,AUTO
         2 002626   200054 454500                    STP4    JRNL_OFFSET+4,,AUTO
         2 002627   200054 630500                    EPPR0   JRNL_OFFSET+4,,AUTO
         2 002630   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002631   000000 701000 xent               TSX1    HFF$DSIZ
         2 002632   002644 702000 2                  TSX2    NOIFPARAM

     1109     9677    4            TEMP$ = PN$.IFPARAM_;          /* Get pointer to IFPARAM             */

   9677  2 002633   200003 470500                    LDP0    @PN$,,AUTO
         2 002634   000013 236100                    LDQ     11,,PR0
         2 002635   200032 756100                    STQ     TEMP$,,AUTO

     1110     9678    4            IF TEMP$ = ADDR(NIL) THEN I = 0; /* Might be default open            */

   9678  2 002636   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002637   002641 601000 2                  TNZ     s:9679

   9678  2 002640   200014 450100                    STZ     I,,AUTO

     1111     9679    4            IF I < 4096

   9679  2 002641   200014 235100                    LDA     I,,AUTO
         2 002642   010000 115007                    CMPA    4096,DL
         2 002643   002646 605000 2                  TPL     s:9684

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:159  
     1112     9680    5             THEN DO;

   9676  2 002644                       NOIFPARAM    null
     1113     9681    5   NOIFPARAM:  ;
     1114     9682    5               NO_IFPARAM_RESTRICT = %YES#;

   9682  2 002644   400000 236003                    LDQ     -131072,DU
         2 002645   200020 756100                    STQ     NO_IFPARAM_RESTRICT,,AUTO

     1115     9683    5               END;

     1116     9684    4            IF F$DCB.BLKL < 4096

   9684  2 002646   200016 470500                    LDP0    JDCB$,,AUTO
         2 002647   000033 220100                    LDX0    27,,PR0
         2 002650   010000 100003                    CMPX0   4096,DU
         2 002651   002655 603000 2                  TRC     s:9686

     1117     9685    4             THEN F$DCB.BLKL = 4096;

   9685  2 002652   010000 221003                    LDX1    4096,DU
         2 002653   000033 741100                    STX1    27,,PR0
         2 002654   002667 710000 2                  TRA     s:9689

     1118     9686    4             ELSE F$DCB.BLKL = ((F$DCB.BLKL + 4095) / 4096) * 4096;

   9686  2 002655   000033 236100                    LDQ     27,,PR0
         2 002656   000022 772000                    QRL     18
         2 002657   007777 036007                    ADLQ    4095,DL
         2 002660   000014 772000                    QRL     12
         2 002661   000014 736000                    QLS     12
         2 002662   000000 621006                    EAX1    0,QL
         2 002663   000033 741100                    STX1    27,,PR0

     1119     9687    4            END;

   9687  2 002664   002667 710000 2                  TRA     s:9689
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:160  

     1120     9688    3          ELSE F$DCB.BLKL = 4096;

   9688  2 002665   010000 220003                    LDX0    4096,DU
         2 002666   000033 740100                    STX0    27,,PR0

     1121     9689    3         F$DCB.BOL = 0;                    /* No BOL                             */

   9689  2 002667   000000 236003                    LDQ     0,DU
         2 002670   000034 552104                    STBQ    28,'04'O,PR0

     1122     9690    3         F$DCB.BLOCKED = %NO#;             /* Not blocked                        */

   9690  2 002671   000040 236000 3                  LDQ     32
         2 002672   000031 356100                    ANSQ    25,,PR0

     1123     9691    3         F$DCB.SPANNED = %NO#;             /* Not spanned                        */

   9691  2 002673   000041 236000 3                  LDQ     33
         2 002674   000031 356100                    ANSQ    25,,PR0

     1124     9692    3         F$DCB.RECL = 4096;                /* One granule per record             */

   9692  2 002675   010000 220003                    LDX0    4096,DU
         2 002676   000033 440100                    SXL0    27,,PR0
         2 002677   003240 710000 2                  TRA     s:9773

     1125     9693
     1126     9694    3       CASE(%CONSEC#,%KEYED#,%RELATIVE#,%UR#,%INDEXED#,%SYMB#,%IREL#);

   9692  2 002700                       CONSECORG    null
     1127     9695    3   CONSECORG: ;
     1128     9696    3         F$DCB.BOL = 4;

   9696  2 002700   000004 236007                    LDQ     4,DL
         2 002701   000034 552104                    STBQ    28,'04'O,PR0

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:161  
     1129     9697    3         F$DCB.SPANNED = %YES#;            /* Always spanned                     */

   9697  2 002702   000031 256100                    ORSQ    25,,PR0

     1130     9698    3         F$DCB.BLOCKED = %YES#;            /* Always blocked                     */

   9698  2 002703   000010 236007                    LDQ     8,DL
         2 002704   000031 256100                    ORSQ    25,,PR0

     1131     9699    4         DO CASE(F$DCB.ORG);

   9699  2 002705   000032 236100                    LDQ     26,,PR0
         2 002706   000033 772000                    QRL     27
         2 002707   000004 136007                    SBLQ    4,DL
         2 002710   000006 116007                    CMPQ    6,DL
         2 002711   002713 602006 2                  TNC     s:9699+6,QL
         2 002712   002732 710000 2                  TRA     s:9705
         2 002713   002727 710000 2                  TRA     s:9703
         2 002714   002732 710000 2                  TRA     s:9705
         2 002715   002721 710000 2                  TRA     s:9701
         2 002716   002732 710000 2                  TRA     s:9705
         2 002717   002732 710000 2                  TRA     s:9705
         2 002720   002727 710000 2                  TRA     s:9703

     1132     9700    4          CASE(%INDEXED#);

     1133     9701    4            IF F$DCB.KEYL < 1 THEN F$DCB.KEYL = 1;

   9701  2 002721   000036 236100                    LDQ     30,,PR0
         2 002722   777000 316007                    CANQ    -512,DL
         2 002723   002732 601000 2                  TNZ     s:9705

   9701  2 002724   001000 236007                    LDQ     512,DL
         2 002725   000036 552110                    STBQ    30,'10'O,PR0
         2 002726   002732 710000 2                  TRA     s:9705

     1134     9702    4          CASE(%UR#,%SYMB#);
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:162  

     1135     9703    4            CALL FSF$TAPEFORM ALTRET(JUSTALT); /*Establish FORM info             */

   9703  2 002727   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002730   000000 701000 xent               TSX1    FSF$TAPEFORM
         2 002731   003242 702000 2                  TSX2    JUSTALT

     1136     9704    4          END;

     1137     9705    3         F$DCB.RECL = 0;                   /* Undetermined maximum record length */

   9705  2 002732   000000 220003                    LDX0    0,DU
         2 002733   200016 470500                    LDP0    JDCB$,,AUTO
         2 002734   000033 440100                    SXL0    27,,PR0

     1138     9706    3         IF F$DCB.BLKL < 4096

   9706  2 002735   000033 221100                    LDX1    27,,PR0
         2 002736   010000 101003                    CMPX1   4096,DU
         2 002737   002743 603000 2                  TRC     s:9708

     1139     9707    3          THEN F$DCB.BLKL = 4096;          /* Minimum                            */

   9707  2 002740   010000 222003                    LDX2    4096,DU
         2 002741   000033 742100                    STX2    27,,PR0
         2 002742   003240 710000 2                  TRA     s:9773

     1140     9708    3          ELSE IF F$DCB.BLKL > MAXBLKL

   9708  2 002743   000033 236100                    LDQ     27,,PR0
         2 002744   000022 772000                    QRL     18
         2 002745   200017 116100                    CMPQ    MAXBLKL,,AUTO
         2 002746   002752 604400 2                  TMOZ    s:9710

     1141     9709    3             THEN F$DCB.BLKL = MAXBLKL;    /* Maximum                            */

   9709  2 002747   200017 722100                    LXL2    MAXBLKL,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:163  
         2 002750   000033 742100                    STX2    27,,PR0
         2 002751   003240 710000 2                  TRA     s:9773

     1142     9710    3             ELSE F$DCB.BLKL = ( (F$DCB.BLKL + 4095) / 4096 ) * 4096;

   9710  2 002752   007777 036007                    ADLQ    4095,DL
         2 002753   000014 772000                    QRL     12
         2 002754   000014 736000                    QLS     12
         2 002755   000000 622006                    EAX2    0,QL
         2 002756   000033 742100                    STX2    27,,PR0
         2 002757   003240 710000 2                  TRA     s:9773

     1143     9711                                                /* To nearest page size               */
     1144     9712
     1145     9713    3       CASE(%VARIABLE#);

     1146     9714    3         IF F$DCB.EBCDIC

   9714  2 002760   000031 236100                    LDQ     25,,PR0
         2 002761   100000 316007                    CANQ    32768,DL
         2 002762   003072 600000 2                  TZE     s:9736

     1147     9715    4          THEN DO;                         /* V format                           */

     1148     9716    4            F$DCB.BOL = 4;

   9716  2 002763   000004 236007                    LDQ     4,DL
         2 002764   000034 552104                    STBQ    28,'04'O,PR0

     1149     9717    4            IF F$DCB.RECL = 0

   9717  2 002765   000033 720100                    LXL0    27,,PR0
         2 002766   002771 601000 2                  TNZ     s:9719

     1150     9718    4             THEN F$DCB.RECL = 80;

   9718  2 002767   000120 221003                    LDX1    80,DU
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:164  
         2 002770   000033 441100                    SXL1    27,,PR0

     1151     9719    4            F$DCB.RECL = F$DCB.RECL + 4;   /* Include control bytes              */

   9719  2 002771   000033 720100                    LXL0    27,,PR0
         2 002772   000004 621010                    EAX1    4,X0
         2 002773   000033 441100                    SXL1    27,,PR0

     1152     9720    4            IF F$DCB.RECL < 5

   9720  2 002774   000005 101003                    CMPX1   5,DU
         2 002775   003001 603000 2                  TRC     s:9722

     1153     9721    4             THEN F$DCB.RECL = 5;          /* Minimum                            */

   9721  2 002776   000005 220003                    LDX0    5,DU
         2 002777   000033 440100                    SXL0    27,,PR0
         2 003000   003017 710000 2                  TRA     s:9724

     1154     9722    4             ELSE IF F$DCB.RECL > 32768 - F$DCB.BOL

   9722  2 003001   000033 236100                    LDQ     27,,PR0
         2 003002   777777 376007                    ANQ     -1,DL
         2 003003   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003004   000034 236100                    LDQ     28,,PR0
         2 003005   000777 376007                    ANQ     511,DL
         2 003006   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 003007   100001 036007                    ADLQ    32769,DL
         2 003010   200052 116100                    CMPQ    JRNL_OFFSET+2,,AUTO
         2 003011   003017 605000 2                  TPL     s:9724

     1155     9723    4                THEN F$DCB.RECL = 32768 - F$DCB.BOL; /* Maximum                  */

   9723  2 003012   000034 720100                    LXL0    28,,PR0
         2 003013   000777 360003                    ANX0    511,DU
         2 003014   677777 620010                    EAX0    -32769,X0
         2 003015   777777 660003                    ERX0    -1,DU
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:165  
         2 003016   000033 440100                    SXL0    27,,PR0

     1156     9724    4            IF F$DCB.BLOCKED

   9724  2 003017   000031 236100                    LDQ     25,,PR0
         2 003020   000010 316007                    CANQ    8,DL
         2 003021   003061 600000 2                  TZE     s:9733

     1157     9725    5             THEN DO;

     1158     9726    5               IF F$DCB.BLKL = 0

   9726  2 003022   000033 220100                    LDX0    27,,PR0
         2 003023   003027 601000 2                  TNZ     s:9728

     1159     9727    5                THEN F$DCB.BLKL = 6400;

   9727  2 003024   014400 221003                    LDX1    6400,DU
         2 003025   000033 741100                    STX1    27,,PR0
         2 003026   003226 710000 2                  TRA     s:9768

     1160     9728    5                ELSE IF F$DCB.BLKL < F$DCB.RECL + F$DCB.BOL

   9728  2 003027   000034 236100                    LDQ     28,,PR0
         2 003030   000777 376007                    ANQ     511,DL
         2 003031   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003032   000033 236100                    LDQ     27,,PR0
         2 003033   777777 376007                    ANQ     -1,DL
         2 003034   200052 036100                    ADLQ    JRNL_OFFSET+2,,AUTO
         2 003035   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 003036   000033 236100                    LDQ     27,,PR0
         2 003037   000022 772000                    QRL     18
         2 003040   200053 116100                    CMPQ    JRNL_OFFSET+3,,AUTO
         2 003041   003053 603000 2                  TRC     s:9730

     1161     9729    5                   THEN F$DCB.BLKL = F$DCB.RECL + F$DCB.BOL; /* Minimum          */

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:166  
   9729  2 003042   000034 236100                    LDQ     28,,PR0
         2 003043   000777 376007                    ANQ     511,DL
         2 003044   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003045   000033 236100                    LDQ     27,,PR0
         2 003046   777777 376007                    ANQ     -1,DL
         2 003047   200052 036100                    ADLQ    JRNL_OFFSET+2,,AUTO
         2 003050   000000 620006                    EAX0    0,QL
         2 003051   000033 740100                    STX0    27,,PR0
         2 003052   003226 710000 2                  TRA     s:9768

     1162     9730    5                   ELSE IF F$DCB.BLKL > 32768

   9730  2 003053   000033 220100                    LDX0    27,,PR0
         2 003054   100001 100003                    CMPX0   32769,DU
         2 003055   003226 602000 2                  TNC     s:9768

     1163     9731    5                      THEN F$DCB.BLKL = 32768; /* Maximum                        */

   9731  2 003056   100000 221003                    LDX1    32768,DU
         2 003057   000033 741100                    STX1    27,,PR0

     1164     9732    5               END;

   9732  2 003060   003226 710000 2                  TRA     s:9768

     1165     9733    4             ELSE F$DCB.BLKL = F$DCB.RECL + F$DCB.BOL;

   9733  2 003061   000034 236100                    LDQ     28,,PR0
         2 003062   000777 376007                    ANQ     511,DL
         2 003063   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003064   000033 236100                    LDQ     27,,PR0
         2 003065   777777 376007                    ANQ     -1,DL
         2 003066   200052 036100                    ADLQ    JRNL_OFFSET+2,,AUTO
         2 003067   000000 620006                    EAX0    0,QL
         2 003070   000033 740100                    STX0    27,,PR0

     1166     9734    4            END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:167  

   9734  2 003071   003226 710000 2                  TRA     s:9768

     1167     9735    4          ELSE DO;                         /* D, S formats                       */

     1168     9736    4            F$DCB.BOL = 0;

   9736  2 003072   000000 236003                    LDQ     0,DU
         2 003073   000034 552104                    STBQ    28,'04'O,PR0

     1169     9737    4            IF NOT F$DCB.SPANNED

   9737  2 003074   000031 236100                    LDQ     25,,PR0
         2 003075   000004 316007                    CANQ    4,DL
         2 003076   003202 601000 2                  TNZ     s:9758

     1170     9738    5             THEN DO;                      /* D format                           */

     1171     9739    5               IF F$DCB.RECL = 0

   9739  2 003077   000033 720100                    LXL0    27,,PR0
         2 003100   003103 601000 2                  TNZ     s:9741

     1172     9740    5                THEN F$DCB.RECL = 80;

   9740  2 003101   000120 221003                    LDX1    80,DU
         2 003102   000033 441100                    SXL1    27,,PR0

     1173     9741    5               F$DCB.RECL = F$DCB.RECL + 4; /* Include control bytes             */

   9741  2 003103   000033 720100                    LXL0    27,,PR0
         2 003104   000004 621010                    EAX1    4,X0
         2 003105   000033 441100                    SXL1    27,,PR0

     1174     9742    5               IF F$DCB.RECL < 5

   9742  2 003106   000005 101003                    CMPX1   5,DU
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:168  
         2 003107   003113 603000 2                  TRC     s:9744

     1175     9743    5                THEN F$DCB.RECL = 5;       /* Minimum                            */

   9743  2 003110   000005 220003                    LDX0    5,DU
         2 003111   000033 440100                    SXL0    27,,PR0
         2 003112   003131 710000 2                  TRA     s:9746

     1176     9744    5                ELSE IF F$DCB.RECL > 9999 - F$DCB.BOL

   9744  2 003113   000033 236100                    LDQ     27,,PR0
         2 003114   777777 376007                    ANQ     -1,DL
         2 003115   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003116   000034 236100                    LDQ     28,,PR0
         2 003117   000777 376007                    ANQ     511,DL
         2 003120   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 003121   023420 036007                    ADLQ    10000,DL
         2 003122   200052 116100                    CMPQ    JRNL_OFFSET+2,,AUTO
         2 003123   003131 605000 2                  TPL     s:9746

     1177     9745    5                   THEN F$DCB.RECL = 9999 - F$DCB.BOL; /* Maximum                */

   9745  2 003124   000034 720100                    LXL0    28,,PR0
         2 003125   000777 360003                    ANX0    511,DU
         2 003126   754360 620010                    EAX0    -10000,X0
         2 003127   777777 660003                    ERX0    -1,DU
         2 003130   000033 440100                    SXL0    27,,PR0

     1178     9746    5               IF F$DCB.BLOCKED

   9746  2 003131   000031 236100                    LDQ     25,,PR0
         2 003132   000010 316007                    CANQ    8,DL
         2 003133   003171 600000 2                  TZE     s:9755

     1179     9747    6                THEN DO;

     1180     9748    6                  IF F$DCB.BLKL = 0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:169  

   9748  2 003134   000033 220100                    LDX0    27,,PR0
         2 003135   003140 601000 2                  TNZ     s:9750

     1181     9749    6                   THEN F$DCB.BLKL = 2048; /* Default                            */

   9749  2 003136   004000 221003                    LDX1    2048,DU
         2 003137   000033 741100                    STX1    27,,PR0

     1182     9750    6                  IF F$DCB.BLKL < F$DCB.RECL + F$DCB.BOL

   9750  2 003140   000034 236100                    LDQ     28,,PR0
         2 003141   000777 376007                    ANQ     511,DL
         2 003142   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003143   000033 236100                    LDQ     27,,PR0
         2 003144   777777 376007                    ANQ     -1,DL
         2 003145   200052 036100                    ADLQ    JRNL_OFFSET+2,,AUTO
         2 003146   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 003147   000033 236100                    LDQ     27,,PR0
         2 003150   000022 772000                    QRL     18
         2 003151   200053 116100                    CMPQ    JRNL_OFFSET+3,,AUTO
         2 003152   003164 603000 2                  TRC     s:9752

     1183     9751    6                   THEN F$DCB.BLKL = F$DCB.RECL + F$DCB.BOL; /* MInimum          */

   9751  2 003153   000034 236100                    LDQ     28,,PR0
         2 003154   000777 376007                    ANQ     511,DL
         2 003155   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003156   000033 236100                    LDQ     27,,PR0
         2 003157   777777 376007                    ANQ     -1,DL
         2 003160   200052 036100                    ADLQ    JRNL_OFFSET+2,,AUTO
         2 003161   000000 620006                    EAX0    0,QL
         2 003162   000033 740100                    STX0    27,,PR0
         2 003163   003226 710000 2                  TRA     s:9768

     1184     9752    6                   ELSE IF F$DCB.BLKL > MAXBLKL

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:170  
   9752  2 003164   200017 116100                    CMPQ    MAXBLKL,,AUTO
         2 003165   003226 604400 2                  TMOZ    s:9768

     1185     9753    6                      THEN F$DCB.BLKL = MAXBLKL; /* Maximum                      */

   9753  2 003166   200017 720100                    LXL0    MAXBLKL,,AUTO
         2 003167   000033 740100                    STX0    27,,PR0

     1186     9754    6                  END;

   9754  2 003170   003226 710000 2                  TRA     s:9768

     1187     9755    5                ELSE F$DCB.BLKL = F$DCB.RECL + F$DCB.BOL; /* One record/block    */

   9755  2 003171   000034 236100                    LDQ     28,,PR0
         2 003172   000777 376007                    ANQ     511,DL
         2 003173   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003174   000033 236100                    LDQ     27,,PR0
         2 003175   777777 376007                    ANQ     -1,DL
         2 003176   200052 036100                    ADLQ    JRNL_OFFSET+2,,AUTO
         2 003177   000000 620006                    EAX0    0,QL
         2 003200   000033 740100                    STX0    27,,PR0

     1188     9756    5               END;

   9756  2 003201   003226 710000 2                  TRA     s:9768

     1189     9757    5             ELSE DO;                      /* S format                           */

     1190     9758    5               IF F$DCB.RECL ~= 0          /* Zero means unlimited               */

   9758  2 003202   000033 720100                    LXL0    27,,PR0
         2 003203   003206 600000 2                  TZE     s:9760

     1191     9759    5                THEN F$DCB.RECL = F$DCB.RECL + 5; /* Include control bytes       */

   9759  2 003204   000005 621010                    EAX1    5,X0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:171  
         2 003205   000033 441100                    SXL1    27,,PR0

     1192     9760    5               IF F$DCB.BLKL = 0

   9760  2 003206   000033 220100                    LDX0    27,,PR0
         2 003207   003213 601000 2                  TNZ     s:9762

     1193     9761    5                THEN F$DCB.BLKL = 2048;    /* Default                            */

   9761  2 003210   004000 221003                    LDX1    2048,DU
         2 003211   000033 741100                    STX1    27,,PR0
         2 003212   003226 710000 2                  TRA     s:9768

     1194     9762    5                ELSE IF F$DCB.BLKL < 6

   9762  2 003213   000006 100003                    CMPX0   6,DU
         2 003214   003220 603000 2                  TRC     s:9764

     1195     9763    5                   THEN F$DCB.BLKL = 6;    /* Minimum includes SCF plus 1 byte   */

   9763  2 003215   000006 221003                    LDX1    6,DU
         2 003216   000033 741100                    STX1    27,,PR0
         2 003217   003226 710000 2                  TRA     s:9768

     1196     9764    5                   ELSE IF F$DCB.BLKL > MAXBLKL

   9764  2 003220   000033 236100                    LDQ     27,,PR0
         2 003221   000022 772000                    QRL     18
         2 003222   200017 116100                    CMPQ    MAXBLKL,,AUTO
         2 003223   003226 604400 2                  TMOZ    s:9768

     1197     9765    5                      THEN F$DCB.BLKL = MAXBLKL; /* Maximum                      */

   9765  2 003224   200017 721100                    LXL1    MAXBLKL,,AUTO
         2 003225   000033 741100                    STX1    27,,PR0

     1198     9766    5               END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:172  

     1199     9767    4            END;

     1200     9768    3         IF NOT F$DCB.EBCDIC

   9768  2 003226   000031 236100                    LDQ     25,,PR0
         2 003227   100000 316007                    CANQ    32768,DL
         2 003230   003240 601000 2                  TNZ     s:9773

     1201     9769    3          THEN F$DCB.BLKL = ( (F$DCB.BLKL + 3) / 4 ) * 4;

   9769  2 003231   000033 236100                    LDQ     27,,PR0
         2 003232   000022 772000                    QRL     18
         2 003233   000003 036007                    ADLQ    3,DL
         2 003234   000002 772000                    QRL     2
         2 003235   000002 736000                    QLS     2
         2 003236   000000 620006                    EAX0    0,QL
         2 003237   000033 740100                    STX0    27,,PR0

     1202     9770    3       END /* DO CASE(F$DCB.ORG); */ ;

     1203     9771
     1204     9772
     1205     9773    2      RETURN;

   9773  2 003240   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 003241   000001 702211                    TSX2  ! 1,X1

   9769  2 003242                       JUSTALT      null
     1206     9774
     1207     9775    2   JUSTALT: ;
     1208     9776    2      ALTRETURN;

   9776  2 003242   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 003243   000000 702211                    TSX2  ! 0,X1

     1209     9777
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:173  
     1210     9778    2   END FTO_CHK_BLKL_RECL;
     1211     9779        /*********************************************************************/
     1212     9780        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:174  
     1213     9781        /*********************************************************************/
     1214     9782    1   FTO_OPNJRNL: PROC ALTRET;

   9782  2 003244   200034 741300       FTO_OPNJRNL  STX1  ! TEMP$+2,,AUTO

     1215     9783
     1216     9784         /***
     1217     9785          *** All JRNL file attributes are fixed.
     1218     9786          ***/
     1219     9787
     1220     9788    2      F$DCB.BLKL = 4096;

   9788  2 003245   010000 220003                    LDX0    4096,DU
         2 003246   200016 470500                    LDP0    JDCB$,,AUTO
         2 003247   000033 740100                    STX0    27,,PR0

     1221     9789    2      F$DCB.RECL = 0;

   9789  2 003250   000000 221003                    LDX1    0,DU
         2 003251   000033 441100                    SXL1    27,,PR0

     1222     9790    2      F$DCB.SPANNED = %YES#;

   9790  2 003252   000004 236007                    LDQ     4,DL
         2 003253   000031 256100                    ORSQ    25,,PR0

     1223     9791    2      F$DCB.BLOCKED = %YES#;

   9791  2 003254   000010 236007                    LDQ     8,DL
         2 003255   000031 256100                    ORSQ    25,,PR0

     1224     9792    2      F$DCB.EBCDIC = %NO#;

   9792  2 003256   000005 236000 3                  LDQ     5
         2 003257   000031 356100                    ANSQ    25,,PR0

     1225     9793    2      F$DCB.BOL = 4;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:175  

   9793  2 003260   000004 236007                    LDQ     4,DL
         2 003261   000034 552104                    STBQ    28,'04'O,PR0

     1226     9794    2      IF NOT F$DCB.OWNER THEN RETURN;      /* Nothing else to do                 */

   9794  2 003262   000064 236100                    LDQ     52,,PR0
         2 003263   040000 316007                    CANQ    16384,DL
         2 003264   003267 601000 2                  TNZ     s:9800

   9794  2 003265   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 003266   000001 702211                    TSX2  ! 1,X1

     1227     9795
     1228     9796         /***
     1229     9797          *** JRNL owner.
     1230     9798          ***/
     1231     9799
     1232     9800    2      CALL FTO_CREATEOPEN ALTRET(JUSTALT);

   9800  2 003267   001214 701000 2                  TSX1    FTO_CREATEOPEN
         2 003270   003314 702000 2                  TSX2    JUSTALT

     1233     9801    2      TEMP$ = F$DCB.CFU$;                  /* Put common info in CFU             */

   9801  2 003271   200016 470500                    LDP0    JDCB$,,AUTO
         2 003272   000066 236100                    LDQ     54,,PR0
         2 003273   200032 756100                    STQ     TEMP$,,AUTO

     1234     9802    2      TEMP$->FM$CFUJ.DCTX = F$DCB.SETX;

   9802  2 003274   200032 471500                    LDP1    TEMP$,,AUTO
         2 003275   000051 236100                    LDQ     41,,PR0
         2 003276   000022 736000                    QLS     18
         2 003277   100004 552120                    STBQ    4,'20'O,PR1

     1235     9803    2      TEMP$->FM$CFUJ.VOL = F$DCB.VOL;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:176  

   9803  2 003300   200016 470500                    LDP0    JDCB$,,AUTO
         2 003301   200032 471500                    LDP1    TEMP$,,AUTO
         2 003302   000043 236100                    LDQ     35,,PR0
         2 003303   000022 772000                    QRL     18
         2 003304   100004 552110                    STBQ    4,'10'O,PR1

     1236     9804    2      TEMP$->FM$CFUJ.MAXVOL = F$DCB.MAXVOL;

   9804  2 003305   200016 470500                    LDP0    JDCB$,,AUTO
         2 003306   200032 471500                    LDP1    TEMP$,,AUTO
         2 003307   000043 236100                    LDQ     35,,PR0
         2 003310   000022 772000                    QRL     18
         2 003311   100004 552104                    STBQ    4,'04'O,PR1

     1237     9805    2      RETURN;

   9805  2 003312   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 003313   000001 702211                    TSX2  ! 1,X1

   9804  2 003314                       JUSTALT      null
     1238     9806
     1239     9807    2   JUSTALT: ;
     1240     9808    2      ALTRETURN;

   9808  2 003314   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 003315   000000 702211                    TSX2  ! 0,X1

     1241     9809
     1242     9810    2   END FTO_OPNJRNL;
     1243     9811        /*********************************************************************/
     1244     9812        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:177  
     1245     9813        /*********************************************************************/
     1246     9814    1   FTO_OPNEXISTING: PROC ALTRET;

   9814  2 003316   200034 741300       FTO_OPNEXIS* STX1  ! TEMP$+2,,AUTO

     1247     9815        /*F*     NAME: FTO_OPNEXISTING
     1248     9816                 PURPOSE: Open existing file on tape.
     1249     9817         ***/
     1250     9818
     1251     9819        /********************/
     1252     9820
     1253     9821         /***
     1254     9822          *** Get serial number of volume to open.
     1255     9823          ***/
     1256     9824
     1257     9825    2      CALL FTO_SNLIST ALTRET(JUSTALT);

   9825  2 003317   005653 701000 2                  TSX1    FTO_SNLIST
         2 003320   005353 702000 2                  TSX2    JUSTALT

     1258     9826    2      IF FT_PROT = FT_FULLPROT# THEN F$DCB.MAXVOL = 0;
              9826               /* No scratch allowed for full prot */

   9826  2 003321   000000 235000 xsym               LDA     FT_PROT
         2 003322   000002 115007                    CMPA    2,DL
         2 003323   003327 601000 2                  TNZ     s:9827

   9826  2 003324   200016 470500                    LDP0    JDCB$,,AUTO
         2 003325   000000 236003                    LDQ     0,DU
         2 003326   000043 552120                    STBQ    35,'20'O,PR0

     1259     9827    2      IF F$DCB.PSN = ' '

   9827  2 003327   200016 470500                    LDP0    JDCB$,,AUTO
         2 003330   040000 106500                    CMPC    fill='040'O
         2 003331   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 003332   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:178  
         2 003333   003341 601000 2                  TNZ     s:9838

     1260     9828    3       THEN DO;

     1261     9829    3         B$JIT.ERR = E_NOSN; /*E* ERROR: FTO-E$NOSN */

   9829  2 003334   000036 236000 1                  LDQ     E_NOSN
         2 003335   000000 471400 xsym               LDP1    B$JIT$
         2 003336   100012 756100                    STQ     10,,PR1

     1262     9830    3         ALTRETURN;

   9830  2 003337   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 003340   000000 702211                    TSX2  ! 0,X1

     1263     9831    3         END;
     1264     9832
     1265     9833         /***
     1266     9834          *** If file name and sequence number are not specified,
     1267     9835          *** NXTF must be specified.
     1268     9836          ***/
     1269     9837
     1270     9838    2      IF F$DCB.NAME.L <= 0 AND F$DCB.FSN <= 0

   9838  2 003341   000010 236100                    LDQ     8,,PR0
         2 003342   777000 316003                    CANQ    -512,DU
         2 003343   003374 601000 2                  TNZ     s:9859
         2 003344   000034 220100                    LDX0    28,,PR0
         2 003345   003374 601000 2                  TNZ     s:9859

     1271     9839    3       THEN DO;                  /* No file name or sequence number specified    */

     1272     9840    3         IF PN$.V_ ~= ADDR(NIL)

   9840  2 003346   200003 471500                    LDP1    @PN$,,AUTO
         2 003347   100000 236100                    LDQ     0,,PR1
         2 003350   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:179  
         2 003351   003367 600000 2                  TZE     s:9850

     1273     9841    4          THEN DO;

     1274     9842    4            IF (PN$.V_->FPT$OPEN_V.OPER.NXTF AND PN$.V_->FPT$OPEN_V.OPER.THISF)

   9842  2 003352   100000 473500                    LDP3    0,,PR1
         2 003353   300000 236100                    LDQ     0,,PR3
         2 003354   004000 316007                    CANQ    2048,DL
         2 003355   003360 600000 2                  TZE     s:9842+6
         2 003356   002000 316007                    CANQ    1024,DL
         2 003357   003362 601000 2                  TNZ     s:9845
         2 003360   004000 316007                    CANQ    2048,DL
         2 003361   003374 601000 2                  TNZ     s:9859

     1275     9843    4              OR NOT PN$.V_->FPT$OPEN_V.OPER.NXTF
     1276     9844    5             THEN DO;            /* File name should be specified and it isn't   */

     1277     9845    5               B$JIT.ERR = E_NOFIDTHIS; /*E* ERROR: FTO-E$NOFIDTHIS */

   9845  2 003362   000033 236000 1                  LDQ     E_NOFIDTHIS
         2 003363   000000 474400 xsym               LDP4    B$JIT$
         2 003364   400012 756100                    STQ     10,,PR4

     1278     9846    5               ALTRETURN;

   9846  2 003365   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 003366   000000 702211                    TSX2  ! 0,X1

     1279     9847    5               END;
     1280     9848    4            END;
     1281     9849    4          ELSE DO;                    /* Default open and no file specification  */

     1282     9850    4            B$JIT.ERR = E_NOFIDTHIS; /*E* ERROR: FTO-E$NOFIDTHIS */

   9850  2 003367   000033 236000 1                  LDQ     E_NOFIDTHIS
         2 003370   000000 473400 xsym               LDP3    B$JIT$
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:180  
         2 003371   300012 756100                    STQ     10,,PR3

     1283     9851    4            ALTRETURN;

   9851  2 003372   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 003373   000000 702211                    TSX2  ! 0,X1

     1284     9852    4            END;
     1285     9853    3         END;
     1286     9854
     1287     9855         /***
     1288     9856          *** Set up requested attributes and get volume.
     1289     9857          ***/
     1290     9858
     1291     9859    2      IF F$DCB.DENSITY = 0

   9859  2 003374   000043 236100                    LDQ     35,,PR0
         2 003375   000777 316007                    CANQ    511,DL
         2 003376   003402 601000 2                  TNZ     s:9861

     1292     9860    2       THEN F$DCB.ATTR = '0'B;

   9860  2 003377   000000 220003                    LDX0    0,DU
         2 003400   000040 440100                    SXL0    32,,PR0
         2 003401   003410 710000 2                  TRA     s:9862

     1293     9861    2       ELSE F$DCB.ATTR = FT_DENS(F$DCB.DENSITY);

   9861  2 003402   000043 236100                    LDQ     35,,PR0
         2 003403   000777 376007                    ANQ     511,DL
         2 003404   000001 736000                    QLS     1
         2 003405   000100 100406                    MLR     fill='000'O
         2 003406   000000 000002 1                  ADSC9   FT_DENS,Q                cn=0,n=2
         2 003407   000040 400002                    ADSC9   32,,PR0                  cn=2,n=2

     1294     9862    2      IF F$DCB.RESNT.NUM = ' ' THEN F$DCB.RES = 'LT';

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:181  
   9862  2 003410   000026 720100                    LXL0    22,,PR0
         2 003411   040040 100003                    CMPX0   16416,DU
         2 003412   003417 601000 2                  TNZ     ATTEMPT_OPEN_EXISTING

   9862  2 003413   000046 236000 1                  LDQ     E_NOFILE+2
         2 003414   777777 376003                    ANQ     -1,DU
         2 003415   040040 276007                    ORQ     16416,DL
         2 003416   000026 756100                    STQ     22,,PR0

   9862  2 003417                       ATTEMPT_OPE* null
     1295     9863
     1296     9864    2   ATTEMPT_OPEN_EXISTING: ;
     1297     9865
     1298     9866    2      CALL FRA$OPR ALTRET(JUSTALT);

   9866  2 003417   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003420   000000 701000 xent               TSX1    FRA$OPR
         2 003421   005353 702000 2                  TSX2    JUSTALT

     1299     9867    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$; /* Get DDT entry pointer       */

   9867  2 003422   200016 470500                    LDP0    JDCB$,,AUTO
         2 003423   000051 720100                    LXL0    41,,PR0
         2 003424   000000 471400 xsym               LDP1    N$DCT$$
         2 003425   100000 473510                    LDP3    0,X0,PR1
         2 003426   300004 236100                    LDQ     4,,PR3
         2 003427   200012 756100                    STQ     DDDT$,,AUTO

     1300     9868
     1301     9869        /*  If the serial number as mounted by the operator is different
     1302     9870            from the one in the VOL1 then the tape should be treated as an
     1303     9871            empty tape. If input or update then E$WRONGSN is reported.
     1304     9872            If create,oldfile then E$NOFILE is used which causes
     1305     9873            the file to be opened with create,newfile  */
     1306     9874
     1307     9875
     1308     9876    2      IF FT$DDT.POS = FTP_BOV# AND FT$DDT.ANST AND
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:182  

   9876  2 003430   200012 474500                    LDP4    DDDT$,,AUTO
         2 003431   400006 236100                    LDQ     6,,PR4
         2 003432   000160 376007                    ANQ     112,DL
         2 003433   000020 116007                    CMPQ    16,DL
         2 003434   003466 601000 2                  TNZ     s:9885
         2 003435   400006 236100                    LDQ     6,,PR4
         2 003436   400000 316007                    CANQ    -131072,DL
         2 003437   003466 600000 2                  TZE     s:9885
         2 003440   040100 106500                    CMPC    fill='040'O
         2 003441   400002 000006                    ADSC9   2,,PR4                   cn=0,n=6
         2 003442   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 003443   003466 600000 2                  TZE     s:9885
         2 003444   000000 235000 xsym               LDA     FT_PROT
         2 003445   003466 601000 2                  TNZ     s:9885

     1309     9877    3        FT$DDT.SN ~= F$DCB.PSN AND FT_PROT = FT_UNPROT# THEN DO;

     1310     9878    3         IF F$DCB.FUN = %CREATE# AND F$DCB.EXIST = %OLDFILE# THEN

   9878  2 003446   000032 236100                    LDQ     26,,PR0
         2 003447   000777 376003                    ANQ     511,DU
         2 003450   000003 116003                    CMPQ    3,DU
         2 003451   003462 601000 2                  TNZ     s:9881
         2 003452   000031 236100                    LDQ     25,,PR0
         2 003453   003000 376007                    ANQ     1536,DL
         2 003454   002000 116007                    CMPQ    1024,DL
         2 003455   003462 601000 2                  TNZ     s:9881

     1311     9879    3            B$JIT.ERR = E_NOFILE;

   9879  2 003456   000044 236000 1                  LDQ     E_NOFILE
         2 003457   000000 475400 xsym               LDP5    B$JIT$
         2 003460   500012 756100                    STQ     10,,PR5
         2 003461   003465 710000 2                  TRA     s:9882

     1312     9880    3          ELSE
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:183  
     1313     9881    3            B$JIT.ERR = E_WRONGSN;

   9881  2 003462   000042 236000 1                  LDQ     E_WRONGSN
         2 003463   000000 475400 xsym               LDP5    B$JIT$
         2 003464   500012 756100                    STQ     10,,PR5

     1314     9882    3         GOTO CLSTAP;

   9882  2 003465   005342 710000 2                  TRA     CLSTAP

     1315     9883    3         END;
     1316     9884
     1317     9885    2      FT$DDT.SN = F$DCB.PSN;               /* Set actual serial number           */

   9885  2 003466   040100 100500                    MLR     fill='040'O
         2 003467   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 003470   400002 000006                    ADSC9   2,,PR4                   cn=0,n=6

     1318     9886
     1319     9887        /* Now lets check the tape density against the drive density.
     1320     9888           If they dont match then we have to altreturn */
     1321     9889
     1322     9890    3      IF FT$DDT.DENSITY ~= 0 AND NOT FT_DENS(FT$DDT.DENSITY)&F$DCB.ATTR THEN DO;

   9890  2 003471   400006 236100                    LDQ     6,,PR4
         2 003472   003400 316007                    CANQ    1792,DL
         2 003473   003520 600000 2                  TZE     s:9895
         2 003474   400006 236100                    LDQ     6,,PR4
         2 003475   000010 772000                    QRL     8
         2 003476   000007 376007                    ANQ     7,DL
         2 003477   200016 470500                    LDP0    JDCB$,,AUTO
         2 003500   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003501   000040 236100                    LDQ     32,,PR0
         2 003502   000022 736000                    QLS     18
         2 003503   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 003504   200052 235100                    LDA     JRNL_OFFSET+2,,AUTO
         2 003505   000001 735000                    ALS     1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:184  
         2 003506   000100 100405                    MLR     fill='000'O
         2 003507   000000 000002 1                  ADSC9   FT_DENS,A                cn=0,n=2
         2 003510   200054 000004                    ADSC9   JRNL_OFFSET+4,,AUTO      cn=0,n=4
         2 003511   200054 236100                    LDQ     JRNL_OFFSET+4,,AUTO
         2 003512   200053 376100                    ANQ     JRNL_OFFSET+3,,AUTO
         2 003513   003520 601000 2                  TNZ     s:9895

     1323     9891    3         B$JIT.ERR = E_WRONGDENSITY;

   9891  2 003514   000043 236000 1                  LDQ     E_WRONGDENSITY
         2 003515   000000 473400 xsym               LDP3    B$JIT$
         2 003516   300012 756100                    STQ     10,,PR3

     1324     9892    3         GOTO CLSTAP;

   9892  2 003517   005342 710000 2                  TRA     CLSTAP

     1325     9893    3         END;
     1326     9894
     1327     9895    2      IF NOT FT$DDT.EBCDIC OR F$DCB.ANSISPANSEQ

   9895  2 003520   400006 236100                    LDQ     6,,PR4
         2 003521   100000 316007                    CANQ    32768,DL
         2 003522   003527 600000 2                  TZE     s:9896
         2 003523   200016 470500                    LDP0    JDCB$,,AUTO
         2 003524   000060 236100                    LDQ     48,,PR0
         2 003525   010000 316007                    CANQ    4096,DL
         2 003526   003532 600000 2                  TZE     s:9903

     1328     9896    2       THEN F$DCB.REALSPAN = '1'B;

   9896  2 003527   200016 470500                    LDP0    JDCB$,,AUTO
         2 003530   002000 236007                    LDQ     1024,DL
         2 003531   000102 256100                    ORSQ    66,,PR0

     1329     9897
     1330     9898         /*
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:185  
     1331     9899          * If last close left the tape in the middle of the file, space to the
     1332     9900          * next beginning-of-file in the tape set.
     1333     9901          */
     1334     9902
     1335     9903    3      IF FT$DDT.NOTEOF THEN DO;

   9903  2 003532   400007 236100                    LDQ     7,,PR4
         2 003533   200000 316007                    CANQ    65536,DL
         2 003534   003555 600000 2                  TZE     s:9910

     1336     9904    3         FT$DDT.NOTEOF = '0'B;

   9904  2 003535   000022 236000 3                  LDQ     18
         2 003536   400007 356100                    ANSQ    7,,PR4

     1337     9905    3         ALABEL = ' ';

   9905  2 003537   000026 236000 3                  LDQ     22
         2 003540   200005 756100                    STQ     ALABEL,,AUTO

     1338     9906    3         CALL FTL$SPF(ALABEL) ALTRET(CLSTAP);

   9906  2 003541   200005 630500                    EPPR0   ALABEL,,AUTO
         2 003542   200052 450500                    STP0    JRNL_OFFSET+2,,AUTO
         2 003543   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 003544   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003545   000000 701000 xent               TSX1    FTL$SPF
         2 003546   005342 702000 2                  TSX2    CLSTAP

     1339     9907    3         DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

   9907  2 003547   200016 470500                    LDP0    JDCB$,,AUTO
         2 003550   000051 720100                    LXL0    41,,PR0
         2 003551   000000 471400 xsym               LDP1    N$DCT$$
         2 003552   100000 473510                    LDP3    0,X0,PR1
         2 003553   300004 236100                    LDQ     4,,PR3
         2 003554   200012 756100                    STQ     DDDT$,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:186  

     1340     9908    3         END;

     1341     9909
     1342     9910    2      FT$DDT.FUNNYPOS = %NO#;         /* Don't care since position will be found */

   9910  2 003555   200012 473500                    LDP3    DDDT$,,AUTO
         2 003556   000023 236000 3                  LDQ     19
         2 003557   300007 356100                    ANSQ    7,,PR3

     1343     9911    3      IF FT$DDT.FMNEEDED THEN DO;     /* File mark needed before positioning     */

   9911  2 003560   300006 236100                    LDQ     6,,PR3
         2 003561   000200 316007                    CANQ    128,DL
         2 003562   003576 600000 2                  TZE     s:9917

     1344     9912    3         FT$DDT.FMNEEDED = %NO#;

   9912  2 003563   000021 236000 3                  LDQ     17
         2 003564   300006 356100                    ANSQ    6,,PR3

     1345     9913    3         CALL FTI$WRFM ALTRET(RETFSN);

   9913  2 003565   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003566   000000 701000 xent               TSX1    FTI$WRFM
         2 003567   005323 702000 2                  TSX2    RETFSN

     1346     9914    3         F$DCB.ARS = -1;

   9914  2 003570   000001 335007                    LCA     1,DL
         2 003571   200016 470500                    LDP0    JDCB$,,AUTO
         2 003572   000000 755100                    STA     0,,PR0

     1347     9915    3         CALL FTI$SPREC ALTRET(RETFSN);

   9915  2 003573   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003574   000000 701000 xent               TSX1    FTI$SPREC
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:187  
         2 003575   005323 702000 2                  TSX2    RETFSN

     1348     9916    3         END;

     1349     9917    2      I = F$DCB.VOL;

   9917  2 003576   200016 470500                    LDP0    JDCB$,,AUTO
         2 003577   000043 236100                    LDQ     35,,PR0
         2 003600   000033 772000                    QRL     27
         2 003601   200014 756100                    STQ     I,,AUTO

     1350     9918    2      CALL FTR$SETSN(I,ADDR(F$DCB.PSN)) ALTRET(NEVER2);

   9918  2 003602   200016 236100                    LDQ     JDCB$,,AUTO
         2 003603   000024 036003                    ADLQ    20,DU
         2 003604   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 003605   200052 631500                    EPPR1   JRNL_OFFSET+2,,AUTO
         2 003606   200055 451500                    STP1    JRNL_OFFSET+5,,AUTO
         2 003607   200014 633500                    EPPR3   I,,AUTO
         2 003610   200054 453500                    STP3    JRNL_OFFSET+4,,AUTO
         2 003611   200054 630500                    EPPR0   JRNL_OFFSET+4,,AUTO
         2 003612   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003613   000000 701000 xent               TSX1    FTR$SETSN
         2 003614   003615 702000 2                  TSX2    NEVER2

   9917  2 003615                       NEVER2       null
     1351     9919    2   NEVER2: ;
     1352     9920    2      CALL FTR$DPT ALTRET(CLSTAP);         /* Do write permit and type checking  */

   9920  2 003615   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003616   000000 701000 xent               TSX1    FTR$DPT
         2 003617   005342 702000 2                  TSX2    CLSTAP

     1353     9921
     1354     9922         /***
     1355     9923          *** We are now ready to attempt opening the specified file.
     1356     9924          ***/
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:188  
     1357     9925
     1358     9926    2      IF F$DCB.IGNOREFSN THEN              /* Ignore FSN/FSECT?                  */

   9926  2 003620   200016 470500                    LDP0    JDCB$,,AUTO
         2 003621   000031 234100                    SZN     25,,PR0
         2 003622   003626 605000 2                  TPL     s:9929

     1359     9927    2         F$DCB.FSECT = 0;                  /* Don't care what FSECT.             */

   9927  2 003623   000000 220003                    LDX0    0,DU
         2 003624   000077 740100                    STX0    63,,PR0
         2 003625   003630 710000 2                  TRA     s:9930

     1360     9928    2       ELSE
     1361     9929    2         F$DCB.FSECT = 1;                  /* Open first section of file         */

   9929  2 003626   000001 220003                    LDX0    1,DU
         2 003627   000077 740100                    STX0    63,,PR0

     1362     9930    2      F$DCB.EBCDIC = FT$DDT.EBCDIC;        /* Fill in DCB.EBCDIC early           */

   9930  2 003630   200012 471500                    LDP1    DDDT$,,AUTO
         2 003631   100006 236100                    LDQ     6,,PR1
         2 003632   000031 676100                    ERQ     25,,PR0
         2 003633   100000 376007                    ANQ     32768,DL
         2 003634   000031 656100                    ERSQ    25,,PR0

     1363     9931    2      IF PN$.V_ = ADDR(NIL) THEN           /* Default open                       */

   9931  2 003635   200003 473500                    LDP3    @PN$,,AUTO
         2 003636   300000 236100                    LDQ     0,,PR3
         2 003637   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003640   003663 601000 2                  TNZ     s:9940

     1364     9932    2         IF F$DCB.NAME.L <= 0 THEN

   9932  2 003641   000010 236100                    LDQ     8,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:189  
         2 003642   777000 316003                    CANQ    -512,DU
         2 003643   003657 601000 2                  TNZ     s:9938

     1365     9933    2            IF F$DCB.REALSPAN THEN

   9933  2 003644   000102 236100                    LDQ     66,,PR0
         2 003645   002000 316007                    CANQ    1024,DL
         2 003646   003653 600000 2                  TZE     s:9936

     1366     9934    2               CALL FTL$FINDSEQ ALTRET(RETFSN);

   9934  2 003647   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003650   000000 701000 xent               TSX1    FTL$FINDSEQ
         2 003651   005323 702000 2                  TSX2    RETFSN
         2 003652   004030 710000 2                  TRA     s:9998

     1367     9935    2             ELSE
     1368     9936    2               CALL FTL$FINDSEQIBM ALTRET(RETFSN);

   9936  2 003653   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003654   000000 701000 xent               TSX1    FTL$FINDSEQIBM
         2 003655   005323 702000 2                  TSX2    RETFSN
         2 003656   004030 710000 2                  TRA     s:9998

     1369     9937    2          ELSE
     1370     9938    2            CALL FTL$FINDFILE ALTRET(RETFSN);

   9938  2 003657   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003660   000000 701000 xent               TSX1    FTL$FINDFILE
         2 003661   005323 702000 2                  TSX2    RETFSN
         2 003662   004030 710000 2                  TRA     s:9998

     1371     9939    3       ELSE DO;

     1372     9940    3         IF (PN$.V_->FPT$OPEN_V.OPER.NXTF AND PN$.V_->FPT$OPEN_V.OPER.THISF) OR

   9940  2 003663   300000 474500                    LDP4    0,,PR3
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:190  
         2 003664   400000 236100                    LDQ     0,,PR4
         2 003665   004000 316007                    CANQ    2048,DL
         2 003666   003671 600000 2                  TZE     s:9940+6
         2 003667   002000 316007                    CANQ    1024,DL
         2 003670   003673 601000 2                  TNZ     s:9942
         2 003671   004000 316007                    CANQ    2048,DL
         2 003672   003737 601000 2                  TNZ     s:9962

     1373     9941    4           NOT PN$.V_->FPT$OPEN_V.OPER.NXTF THEN DO; /* Open specified file      */

     1374     9942    4            IF F$DCB.NAME.L <= 0 THEN      /* Find by sequence number            */

   9942  2 003673   000010 236100                    LDQ     8,,PR0
         2 003674   777000 316003                    CANQ    -512,DU
         2 003675   003711 601000 2                  TNZ     s:9949

     1375     9943    4               IF F$DCB.REALSPAN THEN

   9943  2 003676   000102 236100                    LDQ     66,,PR0
         2 003677   002000 316007                    CANQ    1024,DL
         2 003700   003705 600000 2                  TZE     s:9946

     1376     9944    4                  CALL FTL$FINDSEQ ALTRET(RETFSN);

   9944  2 003701   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003702   000000 701000 xent               TSX1    FTL$FINDSEQ
         2 003703   005323 702000 2                  TSX2    RETFSN
         2 003704   004030 710000 2                  TRA     s:9998

     1377     9945    4                ELSE
     1378     9946    4                  CALL FTL$FINDSEQIBM ALTRET(RETFSN);

   9946  2 003705   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003706   000000 701000 xent               TSX1    FTL$FINDSEQIBM
         2 003707   005323 702000 2                  TSX2    RETFSN
         2 003710   004030 710000 2                  TRA     s:9998

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:191  
     1379     9947                                           /* No file name...open by sequence number  */
     1380     9948    5             ELSE DO;                      /* Find file by name                  */

     1381     9949    6               IF F$DCB.FSN > 0 THEN DO;   /* First position to FSN              */

   9949  2 003711   000034 221100                    LDX1    28,,PR0
         2 003712   003733 600000 2                  TZE     s:9957

     1382     9950    6                  IF F$DCB.REALSPAN THEN

   9950  2 003713   000102 236100                    LDQ     66,,PR0
         2 003714   002000 316007                    CANQ    1024,DL
         2 003715   003722 600000 2                  TZE     s:9953

     1383     9951    6                     CALL FTL$FINDSEQ ALTRET(RETFSN);

   9951  2 003716   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003717   000000 701000 xent               TSX1    FTL$FINDSEQ
         2 003720   005323 702000 2                  TSX2    RETFSN
         2 003721   003725 710000 2                  TRA     s:9954

     1384     9952    6                   ELSE
     1385     9953    6                     CALL FTL$FINDSEQIBM ALTRET(RETFSN);

   9953  2 003722   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003723   000000 701000 xent               TSX1    FTL$FINDSEQIBM
         2 003724   005323 702000 2                  TSX2    RETFSN

     1386     9954    6                  F$DCB.ARS = -1;          /* Back up to begin search            */

   9954  2 003725   000001 335007                    LCA     1,DL
         2 003726   200016 470500                    LDP0    JDCB$,,AUTO
         2 003727   000000 755100                    STA     0,,PR0

     1387     9955    6                  CALL FTI$SPREC ALTRET(CLSTAP);

   9955  2 003730   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:192  
         2 003731   000000 701000 xent               TSX1    FTI$SPREC
         2 003732   005342 702000 2                  TSX2    CLSTAP

     1388     9956    6                  END;

     1389     9957    5               CALL FTL$FINDFILE ALTRET(RETFSN);

   9957  2 003733   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003734   000000 701000 xent               TSX1    FTL$FINDFILE
         2 003735   005323 702000 2                  TSX2    RETFSN

     1390     9958    5               END;

     1391     9959                                                /* File name is specified             */
     1392     9960    4            END;

   9960  2 003736   004030 710000 2                  TRA     s:9998

     1393     9961    4          ELSE DO;                         /* NXTF, not THISF                    */

     1394     9962    5            IF PN$.V_->FPT$OPEN_V.SRCHCOND.REV THEN DO; /* Reverse NXTF          */

   9962  2 003737   400001 236100                    LDQ     1,,PR4
         2 003740   000001 316003                    CANQ    1,DU
         2 003741   003770 600000 2                  TZE     s:9975

     1395     9963    5               I = FT$DDT.FSN - 1;

   9963  2 003742   100005 236100                    LDQ     5,,PR1
         2 003743   000022 772000                    QRL     18
         2 003744   000001 136007                    SBLQ    1,DL
         2 003745   200014 756100                    STQ     I,,AUTO

     1396     9964    6               IF I <= 0 THEN DO;          /* Beginning of set                   */

   9964  2 003746   003753 605400 2                  TPNZ    s:9968

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:193  
     1397     9965    6                  B$JIT.ERR = E_EOSET; /*E* ERROR: FTO-E$EOSET */

   9965  2 003747   000026 236000 1                  LDQ     E_EOSET
         2 003750   000000 474400 xsym               LDP4    B$JIT$
         2 003751   400012 756100                    STQ     10,,PR4

     1398     9966    6                  GOTO CLSTAP;

   9966  2 003752   005342 710000 2                  TRA     CLSTAP

     1399     9967    6                  END;
     1400     9968    5               F$DCB.FSN = I;

   9968  2 003753   000000 621006                    EAX1    0,QL
         2 003754   000034 741100                    STX1    28,,PR0

     1401     9969    5               IF F$DCB.REALSPAN THEN

   9969  2 003755   000102 236100                    LDQ     66,,PR0
         2 003756   002000 316007                    CANQ    1024,DL
         2 003757   003764 600000 2                  TZE     s:9972

     1402     9970    5                  CALL FTL$FINDSEQ ALTRET(RETFSN);

   9970  2 003760   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003761   000000 701000 xent               TSX1    FTL$FINDSEQ
         2 003762   005323 702000 2                  TSX2    RETFSN
         2 003763   004030 710000 2                  TRA     s:9998

     1403     9971    5                ELSE
     1404     9972    5                  CALL FTL$FINDSEQIBM ALTRET(RETFSN);

   9972  2 003764   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003765   000000 701000 xent               TSX1    FTL$FINDSEQIBM
         2 003766   005323 702000 2                  TSX2    RETFSN

     1405     9973    5               END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:194  

   9973  2 003767   004030 710000 2                  TRA     s:9998

     1406     9974    5             ELSE DO;                      /* Open next file                     */

     1407     9975    5               IF FT$DDT.POSLOST AND PN$.V_->FPT$OPEN_V.FINDPOS THEN

   9975  2 003770   100006 236100                    LDQ     6,,PR1
         2 003771   004000 316007                    CANQ    2048,DL
         2 003772   004002 600000 2                  TZE     s:9978
         2 003773   400000 236100                    LDQ     0,,PR4
         2 003774   000001 316007                    CANQ    1,DL
         2 003775   004002 600000 2                  TZE     s:9978

     1408     9976    5                  CALL FTL$FINDHDR1 ALTRET(RETFSN); /* Find any next file        */

   9976  2 003776   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003777   000000 701000 xent               TSX1    FTL$FINDHDR1
         2 004000   005323 702000 2                  TSX2    RETFSN
         2 004001   004030 710000 2                  TRA     s:9998

     1409     9977    6                ELSE DO;

     1410     9978    7                  IF F$DCB.IGNOREFSN THEN DO;

   9978  2 004002   000031 234100                    SZN     25,,PR0
         2 004003   004013 605000 2                  TPL     s:9983

     1411     9979    7                     F$DCB.FSN = F$DCB.FSN + 1;

   9979  2 004004   000034 221100                    LDX1    28,,PR0
         2 004005   000001 622011                    EAX2    1,X1
         2 004006   000034 742100                    STX2    28,,PR0

     1412     9980    7                     CALL FTL$FINDNEXT ALTRET(RETFSN);

   9980  2 004007   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:195  
         2 004010   000000 701000 xent               TSX1    FTL$FINDNEXT
         2 004011   005323 702000 2                  TSX2    RETFSN

     1413     9981    7                     END;

   9981  2 004012   004030 710000 2                  TRA     s:9998

     1414     9982    7                   ELSE DO;

     1415     9983    7                     F$DCB.FSN = FT$DDT.FSN + 1;

   9983  2 004013   100005 221100                    LDX1    5,,PR1
         2 004014   000001 622011                    EAX2    1,X1
         2 004015   000034 742100                    STX2    28,,PR0

     1416     9984    7                     IF F$DCB.REALSPAN THEN /* Find specific next file           */

   9984  2 004016   000102 236100                    LDQ     66,,PR0
         2 004017   002000 316007                    CANQ    1024,DL
         2 004020   004025 600000 2                  TZE     s:9987

     1417     9985    7                        CALL FTL$FINDSEQ ALTRET(RETFSN);

   9985  2 004021   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004022   000000 701000 xent               TSX1    FTL$FINDSEQ
         2 004023   005323 702000 2                  TSX2    RETFSN
         2 004024   004030 710000 2                  TRA     s:9998

     1418     9986    7                      ELSE
     1419     9987    7                        CALL FTL$FINDSEQIBM ALTRET(RETFSN);

   9987  2 004025   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004026   000000 701000 xent               TSX1    FTL$FINDSEQIBM
         2 004027   005323 702000 2                  TSX2    RETFSN

     1420     9988    7                     END;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:196  
     1421     9989    6                  END;

     1422     9990    5               END;

     1423     9991    4            END;

     1424     9992    3         END;

     1425     9993
     1426     9994         /***
     1427     9995          *** Specified file has been found. Merge information into the DCB.
     1428     9996          ***/
     1429     9997
     1430     9998    2      DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$; /* Get DDT pointer             */

   9998  2 004030   200016 470500                    LDP0    JDCB$,,AUTO
         2 004031   000051 720100                    LXL0    41,,PR0
         2 004032   000000 471400 xsym               LDP1    N$DCT$$
         2 004033   100000 473510                    LDP3    0,X0,PR1
         2 004034   300004 236100                    LDQ     4,,PR3
         2 004035   200012 756100                    STQ     DDDT$,,AUTO

     1431     9999    2      F$DCB.EBCDIC = FT$DDT.EBCDIC;

   9999  2 004036   200012 474500                    LDP4    DDDT$,,AUTO
         2 004037   400006 236100                    LDQ     6,,PR4
         2 004040   000031 676100                    ERQ     25,,PR0
         2 004041   100000 376007                    ANQ     32768,DL
         2 004042   000031 656100                    ERSQ    25,,PR0

     1432    10000    2      AFPOOL$ = FM$BUF$(F$DCB.BFR.BUFX(F$DCB.LPOOL-1));

  10000  2 004043   000067 236100                    LDQ     55,,PR0
         2 004044   000036 772000                    QRL     30
         2 004045   000007 376007                    ANQ     7,DL
         2 004046   000114 236106                    LDQ     76,QL,PR0
         2 004047   000033 772000                    QRL     27
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:197  
         2 004050   000037 376007                    ANQ     31,DL
         2 004051   000000 236006 xsym               LDQ     FM$BUF$,QL
         2 004052   200004 756100                    STQ     AFPOOL$,,AUTO

     1433    10001                                                /* Get label buffer pointer           */
     1434    10002    2      IF AFPOOL$->FT$LBL1.SYSTEM.ID = 'CP-6'

  10002  2 004053   200004 473500                    LDP3    AFPOOL$,,AUTO
         2 004054   040000 106500                    CMPC    fill='040'O
         2 004055   300017 000004                    ADSC9   15,,PR3                  cn=0,n=4
         2 004056   000061 000004 1                  ADSC9   E_NOFILE+13              cn=0,n=4
         2 004057   004063 601000 2                  TNZ     s:10004

     1435    10003    2       THEN CREATED_BY_CP6 = %YES#;

  10003  2 004060   400000 236003                    LDQ     -131072,DU
         2 004061   200007 756100                    STQ     CREATED_BY_CP6,,AUTO
         2 004062   004064 710000 2                  TRA     s:10005

     1436    10004    2       ELSE CREATED_BY_CP6 = %NO#;

  10004  2 004063   200007 450100                    STZ     CREATED_BY_CP6,,AUTO

     1437    10005    2      F$DCB.DENSITY = FT$DDT.DENSITY;      /* Pass density                       */

  10005  2 004064   400006 236100                    LDQ     6,,PR4
         2 004065   003400 376007                    ANQ     1792,DL
         2 004066   000010 772000                    QRL     8
         2 004067   000043 552104                    STBQ    35,'04'O,PR0

     1438    10006    2      CALL CHARBIN( I, AFPOOL$->FT$LBL1.FSECT ); /* Set file section #           */

  10006  2 004070   000100 305500                    DTB
         2 004071   300006 630004                    NDSC9   6,,PR3                   cn=3,s=nosgn,sf=0,n=4
         2 004072   200014 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

     1439    10007    2      F$DCB.FSECT = I;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:198  

  10007  2 004073   200014 721100                    LXL1    I,,AUTO
         2 004074   000077 741100                    STX1    63,,PR0

     1440    10008    2      CALL CHARBIN( I, AFPOOL$->FT$LBL1.FSEQU_NUM );

  10008  2 004075   000100 305500                    DTB
         2 004076   300007 630004                    NDSC9   7,,PR3                   cn=3,s=nosgn,sf=0,n=4
         2 004077   200014 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

     1441    10009    2      FILE_SEQ = I;

  10009  2 004100   200014 235100                    LDA     I,,AUTO
         2 004101   200031 755100                    STA     FILE_SEQ,,AUTO

     1442    10010    2      FT$DDT.FSN = I - 1;                  /* Set correct DDT info               */

  10010  2 004102   777777 622005                    EAX2    -1,AL
         2 004103   400005 742100                    STX2    5,,PR4

     1443    10011    2      IF F$DCB.EBCDIC THEN                 /* Remember 1st vol of file if IBM.   */

  10011  2 004104   200016 470500                    LDP0    JDCB$,,AUTO
         2 004105   000031 236100                    LDQ     25,,PR0
         2 004106   100000 316007                    CANQ    32768,DL
         2 004107   004114 600000 2                  TZE     s:10013

     1444    10012    2         F$DCB.STR = F$DCB.VOL - 1;

  10012  2 004110   000043 236100                    LDQ     35,,PR0
         2 004111   000033 772000                    QRL     27
         2 004112   000001 136007                    SBLQ    1,DL
         2 004113   000077 552104                    STBQ    63,'04'O,PR0

     1445    10013    2      FILE_NAME = AFPOOL$->FT$LBL1.FILE_ID; /* Set file id                       */

  10013  2 004114   040100 100500                    MLR     fill='040'O
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:199  
         2 004115   300001 000021                    ADSC9   1,,PR3                   cn=0,n=17
         2 004116   200021 000037                    ADSC9   FILE_NAME,,AUTO          cn=0,n=31

     1446    10014
     1447    10015         /***
     1448    10016          *** If HDR2 exists, merge its information into the DCB. Otherwise, default.
     1449    10017          ***/
     1450    10018
     1451    10019    2      TEMP$ = PINCRC( AFPOOL$, 80 );       /* Point to HDR2 (if any)             */

  10019  2 004117   200004 236100                    LDQ     AFPOOL$,,AUTO
         2 004120   000024 036003                    ADLQ    20,DU
         2 004121   200032 756100                    STQ     TEMP$,,AUTO

     1452    10020    2      IF TEMP$->FT$ANYLBL.LABEL_TYPE ~= 'HDR2' AND FT$DDT.POS = FTP_HDR#

  10020  2 004122   200032 475500                    LDP5    TEMP$,,AUTO
         2 004123   040000 106500                    CMPC    fill='040'O
         2 004124   500000 000004                    ADSC9   0,,PR5                   cn=0,n=4
         2 004125   000062 000004 1                  ADSC9   E_NOFILE+14              cn=0,n=4
         2 004126   004174 600000 2                  TZE     s:10039
         2 004127   400006 236100                    LDQ     6,,PR4
         2 004130   000160 376007                    ANQ     112,DL
         2 004131   000040 116007                    CMPQ    32,DL
         2 004132   004174 601000 2                  TNZ     s:10039

     1453    10021    3       THEN DO;                            /* No HDR2 yet and still possible     */

     1454    10022    3         CALL FTI$RDASCEBC(TEMP$) ALTRET(CLSTAP);

  10022  2 004133   200032 636500                    EPPR6   TEMP$,,AUTO
         2 004134   200052 456500                    STP6    JRNL_OFFSET+2,,AUTO
         2 004135   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 004136   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004137   000000 701000 xent               TSX1    FTI$RDASCEBC
         2 004140   005342 702000 2                  TSX2    CLSTAP

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:200  
     1455    10023    3         IF F$DCB.TYC.EOF(1)

  10023  2 004141   200016 470500                    LDP0    JDCB$,,AUTO
         2 004142   000002 236100                    LDQ     2,,PR0
         2 004143   004000 316003                    CANQ    2048,DU
         2 004144   004153 600000 2                  TZE     s:10026

     1456    10024    3          THEN FT$DDT.POS = FTP_BOD#;      /* Past fm..no HDR2                   */

  10024  2 004145   200012 471500                    LDP1    DDDT$,,AUTO
         2 004146   100006 236100                    LDQ     6,,PR1
         2 004147   000012 376000 3                  ANQ     10
         2 004150   000060 276007                    ORQ     48,DL
         2 004151   100006 756100                    STQ     6,,PR1
         2 004152   004174 710000 2                  TRA     s:10039

     1457    10025    4          ELSE DO;

     1458    10026    4            IF TEMP$->FT$ANYLBL.LABEL_TYPE = 'HDR2'

  10026  2 004153   200032 471500                    LDP1    TEMP$,,AUTO
         2 004154   040000 106500                    CMPC    fill='040'O
         2 004155   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 004156   000062 000004 1                  ADSC9   E_NOFILE+14              cn=0,n=4
         2 004157   004167 601000 2                  TNZ     s:10034

     1459    10027    5             THEN DO;                      /* Got HDR2                           */

     1460    10028    5               IF F$DCB.ARS < 80

  10028  2 004160   000000 235100                    LDA     0,,PR0
         2 004161   000120 115007                    CMPA    80,DL
         2 004162   004174 605000 2                  TPL     s:10039

     1461    10029    6                THEN DO;                   /* Bad one                            */

     1462    10030    6                  TEMP$->FT$ANYLBL.LABEL_TYPE = ' '; /* Forget it                */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:201  

  10030  2 004163   040100 100400                    MLR     fill='040'O
         2 004164   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 004165   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4

     1463    10031    6                  END;

     1464    10032    5               END;

  10032  2 004166   004174 710000 2                  TRA     s:10039

     1465    10033    5             ELSE DO;                      /* Not HDR2...probably user label     */

     1466    10034    5               F$DCB.ARS = -1;

  10034  2 004167   000001 335007                    LCA     1,DL
         2 004170   000000 755100                    STA     0,,PR0

     1467    10035    5               CALL FTI$SPREC ALTRET(CLSTAP);

  10035  2 004171   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004172   000000 701000 xent               TSX1    FTI$SPREC
         2 004173   005342 702000 2                  TSX2    CLSTAP

     1468    10036    5               END;

     1469    10037    4            END;

     1470    10038    3         END;

     1471    10039    2      F$DCB.SPANNED = %NO#;                /* Assume not spanned                 */

  10039  2 004174   200016 470500                    LDP0    JDCB$,,AUTO
         2 004175   000041 236000 3                  LDQ     33
         2 004176   000031 356100                    ANSQ    25,,PR0

     1472    10040    2      IF TEMP$->FT$ANYLBL.LABEL_TYPE = 'HDR2'
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:202  

  10040  2 004177   200032 471500                    LDP1    TEMP$,,AUTO
         2 004200   040000 106500                    CMPC    fill='040'O
         2 004201   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         2 004202   000062 000004 1                  ADSC9   E_NOFILE+14              cn=0,n=4
         2 004203   004522 601000 2                  TNZ     s:10126

     1473    10041    3       THEN DO;                            /* HDR2 exists                        */

     1474    10042    3         CALL CHARBIN( I, TEMP$->FT$LBL2.BLKL );

  10042  2 004204   000100 305500                    DTB
         2 004205   100001 230005                    NDSC9   1,,PR1                   cn=1,s=nosgn,sf=0,n=5
         2 004206   200014 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

     1475    10043    3         F$DCB.BLKL = I;

  10043  2 004207   200014 720100                    LXL0    I,,AUTO
         2 004210   000033 740100                    STX0    27,,PR0

     1476    10044    3         CALL CHARBIN( I, TEMP$->FT$LBL2.RECL );

  10044  2 004211   000100 305500                    DTB
         2 004212   100002 430005                    NDSC9   2,,PR1                   cn=2,s=nosgn,sf=0,n=5
         2 004213   200014 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

     1477    10045    3         F$DCB.RECL = I;

  10045  2 004214   200014 721100                    LXL1    I,,AUTO
         2 004215   000033 441100                    SXL1    27,,PR0

     1478    10046    3         CALL CHARBIN( I, TEMP$->FT$LBL2.BUF_OFFSET );

  10046  2 004216   000100 305500                    DTB
         2 004217   100014 430002                    NDSC9   12,,PR1                  cn=2,s=nosgn,sf=0,n=2
         2 004220   200014 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:203  
     1479    10047    3         F$DCB.BOL = I;

  10047  2 004221   200014 236100                    LDQ     I,,AUTO
         2 004222   000034 552104                    STBQ    28,'04'O,PR0

     1480    10048    3         F$DCB.BLOCKED = %YES#;            /* Assume blocking                    */

  10048  2 004223   000010 236007                    LDQ     8,DL
         2 004224   000031 256100                    ORSQ    25,,PR0

     1481    10049    3         I = ASCBIN( TEMP$->FT$LBL2.FORMAT ); /* Identify file format            */

  10049  2 004225   200032 471500                    LDP1    TEMP$,,AUTO
         2 004226   000100 101500                    MRL     fill='000'O
         2 004227   100001 000001                    ADSC9   1,,PR1                   cn=0,n=1
         2 004230   200052 000004                    ADSC9   JRNL_OFFSET+2,,AUTO      cn=0,n=4
         2 004231   200052 236100                    LDQ     JRNL_OFFSET+2,,AUTO
         2 004232   200014 756100                    STQ     I,,AUTO

     1482    10050    3         J = 0;

  10050  2 004233   200015 450100                    STZ     J,,AUTO

     1483    10051    4         DO WHILE(FT_FORMAT(J) ~= I AND J < %FT_MAXFMTS);

  10051  2 004234   004236 710000 2                  TRA     s:10053

     1484    10052    4            J = J + 1;

  10052  2 004235   200015 054100                    AOS     J,,AUTO

     1485    10053    4            END;

  10053  2 004236   200015 235100                    LDA     J,,AUTO
         2 004237   000100 101405                    MRL     fill='000'O
         2 004240   000004 000001 1                  ADSC9   FT_FORMAT,A              cn=0,n=1
         2 004241   200052 000004                    ADSC9   JRNL_OFFSET+2,,AUTO      cn=0,n=4
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:204  
         2 004242   200052 236100                    LDQ     JRNL_OFFSET+2,,AUTO
         2 004243   200014 116100                    CMPQ    I,,AUTO
         2 004244   004247 600000 2                  TZE     s:10054
         2 004245   000004 115007                    CMPA    4,DL
         2 004246   004235 604000 2                  TMI     s:10052

     1486    10054    4         DO CASE(J);

  10054  2 004247   000004 115007                    CMPA    4,DL
         2 004250   004252 602005 2                  TNC     s:10054+3,AL
         2 004251   004256 710000 2                  TRA     s:10056
         2 004252   004516 710000 2                  TRA     s:10122
         2 004253   004510 710000 2                  TRA     s:10119
         2 004254   004454 710000 2                  TRA     s:10105
         2 004255   004443 710000 2                  TRA     s:10102

     1487    10055    4          CASE(ELSE);                      /* U and CP-6 formats                 */

     1488    10056    4            IF CREATED_BY_CP6

  10056  2 004256   200007 234100                    SZN     CREATED_BY_CP6,,AUTO
         2 004257   004435 605000 2                  TPL     s:10098

     1489    10057    5             THEN DO;                      /* CP-6 created--check type           */

     1490    10058    5               I = ASCBIN( TEMP$->FT$LBL2.CP6.FILE_FORMAT ); /* Get sub-format   */

  10058  2 004260   200032 470500                    LDP0    TEMP$,,AUTO
         2 004261   000100 101500                    MRL     fill='000'O
         2 004262   000014 000001                    ADSC9   12,,PR0                  cn=0,n=1
         2 004263   200052 000004                    ADSC9   JRNL_OFFSET+2,,AUTO      cn=0,n=4
         2 004264   200052 236100                    LDQ     JRNL_OFFSET+2,,AUTO
         2 004265   200014 756100                    STQ     I,,AUTO

     1491    10059    5               IF I ~= ASCBIN( ' ' )

  10059  2 004266   000040 116007                    CMPQ    32,DL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:205  
         2 004267   004427 600000 2                  TZE     s:10093

     1492    10060    6                THEN DO;                   /* CP-6 format file                   */

     1493    10061    6                  FILE_NAME = TEMP$->FT$LBL2.CP6.FILE_ID;

  10061  2 004270   040100 100500                    MLR     fill='040'O
         2 004271   000004 200037                    ADSC9   4,,PR0                   cn=1,n=31
         2 004272   200021 000037                    ADSC9   FILE_NAME,,AUTO          cn=0,n=31

     1494    10062    6                  J = 0;

  10062  2 004273   200015 450100                    STZ     J,,AUTO

     1495    10063    7                  DO WHILE(FT_CP6FMT(J) ~= I AND J < %FT_MAXCP6FMT);

  10063  2 004274   004276 710000 2                  TRA     s:10065

     1496    10064    7                     J = J + 1;

  10064  2 004275   200015 054100                    AOS     J,,AUTO

     1497    10065    7                     END;

  10065  2 004276   200015 235100                    LDA     J,,AUTO
         2 004277   000100 101405                    MRL     fill='000'O
         2 004300   000006 000001 1                  ADSC9   FT_CP6FMT,A              cn=0,n=1
         2 004301   200052 000004                    ADSC9   JRNL_OFFSET+2,,AUTO      cn=0,n=4
         2 004302   200052 236100                    LDQ     JRNL_OFFSET+2,,AUTO
         2 004303   200014 116100                    CMPQ    I,,AUTO
         2 004304   004307 600000 2                  TZE     s:10066
         2 004305   000012 115007                    CMPA    10,DL
         2 004306   004275 604000 2                  TMI     s:10064

     1498    10066    6                  F$DCB.ORG = FT_CP6FMTORG(J); /* Determine ORG                  */

  10066  2 004307   200016 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:206  
         2 004310   000100 100405                    MLR     fill='000'O
         2 004311   000011 000001 1                  ADSC9   FT_CP6FMTORG,A           cn=0,n=1
         2 004312   000032 000001                    ADSC9   26,,PR0                  cn=0,n=1

     1499    10067    7                  DO CASE(F$DCB.ORG);

  10067  2 004313   000032 236100                    LDQ     26,,PR0
         2 004314   000033 772000                    QRL     27
         2 004315   000023 116007                    CMPQ    19,DL
         2 004316   004320 602006 2                  TNC     s:10067+5,QL
         2 004317   004410 710000 2                  TRA     s:10089
         2 004320   004410 710000 2                  TRA     s:10089
         2 004321   004343 710000 2                  TRA     s:10069
         2 004322   004343 710000 2                  TRA     s:10069
         2 004323   004372 710000 2                  TRA     s:10081
         2 004324   004343 710000 2                  TRA     s:10069
         2 004325   004343 710000 2                  TRA     s:10069
         2 004326   004343 710000 2                  TRA     s:10069
         2 004327   004372 710000 2                  TRA     s:10081
         2 004330   004410 710000 2                  TRA     s:10089
         2 004331   004343 710000 2                  TRA     s:10069
         2 004332   004410 710000 2                  TRA     s:10089
         2 004333   004410 710000 2                  TRA     s:10089
         2 004334   004410 710000 2                  TRA     s:10089
         2 004335   004343 710000 2                  TRA     s:10069
         2 004336   004410 710000 2                  TRA     s:10089
         2 004337   004410 710000 2                  TRA     s:10089
         2 004340   004410 710000 2                  TRA     s:10089
         2 004341   004410 710000 2                  TRA     s:10089
         2 004342   004375 710000 2                  TRA     s:10083

     1500    10068    7                   CASE(%CONSEC#,%KEYED#,%UR#,%INDEXED#,%RELATIVE#,%SYMB#,%IREL#);

     1501    10069    7                     J = ASCBIN(TEMP$->FT$LBL2.CP6.BLOCK_ATTR);

  10069  2 004343   200032 471500                    LDP1    TEMP$,,AUTO
         2 004344   000100 101500                    MRL     fill='000'O
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:207  
         2 004345   100014 200001                    ADSC9   12,,PR1                  cn=1,n=1
         2 004346   200052 000004                    ADSC9   JRNL_OFFSET+2,,AUTO      cn=0,n=4
         2 004347   200052 236100                    LDQ     JRNL_OFFSET+2,,AUTO
         2 004350   200015 756100                    STQ     J,,AUTO

     1502    10070    7                     IF J = ASCBIN(' ')

  10070  2 004351   000040 116007                    CMPQ    32,DL
         2 004352   004356 601000 2                  TNZ     s:10072

     1503    10071    7                      THEN F$DCB.BLOCKED = %NO#; /*   - not blocked, not spanned */

  10071  2 004353   000040 236000 3                  LDQ     32
         2 004354   000031 356100                    ANSQ    25,,PR0
         2 004355   004410 710000 2                  TRA     s:10089

     1504    10072    7                      ELSE IF J = ASCBIN('S')

  10072  2 004356   000123 116007                    CMPQ    83,DL
         2 004357   004365 601000 2                  TNZ     s:10077

     1505    10073    8                         THEN DO;          /* S - not blocked, spanned           */

     1506    10074    8                           F$DCB.BLOCKED = %NO#;

  10074  2 004360   000040 236000 3                  LDQ     32
         2 004361   000031 356100                    ANSQ    25,,PR0

     1507    10075    8                           F$DCB.SPANNED = %YES#;

  10075  2 004362   000004 236007                    LDQ     4,DL
         2 004363   000031 256100                    ORSQ    25,,PR0

     1508    10076    8                           END;

  10076  2 004364   004410 710000 2                  TRA     s:10089

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:208  
     1509    10077    7                         ELSE IF J = ASCBIN('R')

  10077  2 004365   000122 116007                    CMPQ    82,DL
         2 004366   004410 601000 2                  TNZ     s:10089

     1510    10078    7                            THEN F$DCB.SPANNED = %YES#; /* R - blocked, spanned  */

  10078  2 004367   000004 236007                    LDQ     4,DL
         2 004370   000031 256100                    ORSQ    25,,PR0
         2 004371   004410 710000 2                  TRA     s:10089

     1511    10079    7                            ELSE ;         /* B - blocked, not spanned           */
     1512    10080    7                   CASE(%RANDOM#,%IDS#);

     1513    10081    7                     F$DCB.BLOCKED = %NO#;

  10081  2 004372   000040 236000 3                  LDQ     32
         2 004373   000031 356100                    ANSQ    25,,PR0
         2 004374   004410 710000 2                  TRA     s:10089

     1514    10082    7                   CASE(%RESTRICT#);

     1515    10083    7                     F$DCB.BLOCKED = %NO#;

  10083  2 004375   000040 236000 3                  LDQ     32
         2 004376   000031 356100                    ANSQ    25,,PR0

     1516    10084    7                     F$DCB.ACS = %BLOCK#;

  10084  2 004377   000003 236007                    LDQ     3,DL
         2 004400   000036 552104                    STBQ    30,'04'O,PR0

     1517    10085    7                     IF I = ASCBIN('x')

  10085  2 004401   200014 235100                    LDA     I,,AUTO
         2 004402   000170 115007                    CMPA    120,DL
         2 004403   004407 601000 2                  TNZ     s:10087
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:209  

     1518    10086    7                      THEN NO_IFPARAM_RESTRICT = %YES#;

  10086  2 004404   400000 236003                    LDQ     -131072,DU
         2 004405   200020 756100                    STQ     NO_IFPARAM_RESTRICT,,AUTO
         2 004406   004410 710000 2                  TRA     s:10089

     1519    10087    7                      ELSE NO_IFPARAM_RESTRICT = %NO#;

  10087  2 004407   200020 450100                    STZ     NO_IFPARAM_RESTRICT,,AUTO

     1520    10088    7                   END;

     1521    10089    6                  F$DCB.BLKL = (F$DCB.BLKL * 8 + 7) / 9;

  10089  2 004410   000033 236100                    LDQ     27,,PR0
         2 004411   000017 772000                    QRL     15
         2 004412   000042 376000 3                  ANQ     34
         2 004413   000007 036007                    ADLQ    7,DL
         2 004414   000011 506007                    DIV     9,DL
         2 004415   000000 620006                    EAX0    0,QL
         2 004416   000033 740100                    STX0    27,,PR0

     1522    10090    6                  F$DCB.RECL = (F$DCB.RECL * 8 + 7) / 9;

  10090  2 004417   000033 236100                    LDQ     27,,PR0
         2 004420   000003 736000                    QLS     3
         2 004421   000042 376000 3                  ANQ     34
         2 004422   000007 036007                    ADLQ    7,DL
         2 004423   000011 506007                    DIV     9,DL
         2 004424   000000 621006                    EAX1    0,QL
         2 004425   000033 441100                    SXL1    27,,PR0

     1523    10091    6                  END;

  10091  2 004426   004541 710000 2                  TRA     s:10141

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:210  
     1524    10092    6                ELSE DO;

     1525    10093    6                  F$DCB.ORG = %UNDEF#;     /* UUUUUUUUUU                         */

  10093  2 004427   200016 471500                    LDP1    JDCB$,,AUTO
         2 004430   021000 236003                    LDQ     8704,DU
         2 004431   100032 552140                    STBQ    26,'40'O,PR1

     1526    10094    6                  F$DCB.BLKL = F$DCB.RECL;

  10094  2 004432   100033 720100                    LXL0    27,,PR1
         2 004433   100033 740100                    STX0    27,,PR1

     1527    10095    6                  END;

     1528    10096    5               END;

  10096  2 004434   004541 710000 2                  TRA     s:10141

     1529    10097    5             ELSE DO;                      /* Not CP-6 created                   */

     1530    10098    5               F$DCB.ORG = %UNDEF#;

  10098  2 004435   200016 470500                    LDP0    JDCB$,,AUTO
         2 004436   021000 236003                    LDQ     8704,DU
         2 004437   000032 552140                    STBQ    26,'40'O,PR0

     1531    10099    5               F$DCB.BLKL = F$DCB.RECL;

  10099  2 004440   000033 720100                    LXL0    27,,PR0
         2 004441   000033 740100                    STX0    27,,PR0

     1532    10100    5               END;

  10100  2 004442   004541 710000 2                  TRA     s:10141

     1533    10101    4          CASE(3);                         /* FFFFFFFFFF                         */
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:211  

     1534    10102    4            F$DCB.ORG = %FIXED#;

  10102  2 004443   200016 470500                    LDP0    JDCB$,,AUTO
         2 004444   017000 236003                    LDQ     7680,DU
         2 004445   000032 552140                    STBQ    26,'40'O,PR0

     1535    10103    4            IF F$DCB.BLKL <= F$DCB.RECL THEN F$DCB.BLOCKED = %NO#;

  10103  2 004446   000033 720100                    LXL0    27,,PR0
         2 004447   000033 100100                    CMPX0   27,,PR0
         2 004450   004541 602000 2                  TNC     s:10141

  10103  2 004451   000040 236000 3                  LDQ     32
         2 004452   000031 356100                    ANSQ    25,,PR0
         2 004453   004541 710000 2                  TRA     s:10141

     1536    10104    4          CASE(2);                         /* VVVVVVVVVV                         */

     1537    10105    4            F$DCB.ORG = %VARIABLE#;

  10105  2 004454   200016 470500                    LDP0    JDCB$,,AUTO
         2 004455   020000 236003                    LDQ     8192,DU
         2 004456   000032 552140                    STBQ    26,'40'O,PR0

     1538    10106    4            J = ASCBIN(TEMP$->FT$LBL2.OTHEROS.BLOCK_ATTR);

  10106  2 004457   200032 471500                    LDP1    TEMP$,,AUTO
         2 004460   000100 101500                    MRL     fill='000'O
         2 004461   100011 400001                    ADSC9   9,,PR1                   cn=2,n=1
         2 004462   200052 000004                    ADSC9   JRNL_OFFSET+2,,AUTO      cn=0,n=4
         2 004463   200052 236100                    LDQ     JRNL_OFFSET+2,,AUTO
         2 004464   200015 756100                    STQ     J,,AUTO

     1539    10107    4            F$DCB.BOL = 4;            /* Chris Fries says this is OK for IBM V   */

  10107  2 004465   000004 236007                    LDQ     4,DL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:212  
         2 004466   000034 552104                    STBQ    28,'04'O,PR0

     1540    10108    4            IF J = ASCBIN(' ')

  10108  2 004467   200015 235100                    LDA     J,,AUTO
         2 004470   000040 115007                    CMPA    32,DL
         2 004471   004475 601000 2                  TNZ     s:10110

     1541    10109    4             THEN F$DCB.BLOCKED = %NO#;    /*   - not blocked, not spanned       */

  10109  2 004472   000040 236000 3                  LDQ     32
         2 004473   000031 356100                    ANSQ    25,,PR0
         2 004474   004541 710000 2                  TRA     s:10141

     1542    10110    4             ELSE IF J = ASCBIN('S')

  10110  2 004475   000123 115007                    CMPA    83,DL
         2 004476   004504 601000 2                  TNZ     s:10115

     1543    10111    5                THEN DO;                   /* S - not blocked, spanned           */

     1544    10112    5                  F$DCB.BLOCKED = %NO#;

  10112  2 004477   000040 236000 3                  LDQ     32
         2 004500   000031 356100                    ANSQ    25,,PR0

     1545    10113    5                  F$DCB.SPANNED = %YES#;

  10113  2 004501   000004 236007                    LDQ     4,DL
         2 004502   000031 256100                    ORSQ    25,,PR0

     1546    10114    5                  END;

  10114  2 004503   004541 710000 2                  TRA     s:10141

     1547    10115    4                ELSE IF J = ASCBIN('R')

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:213  
  10115  2 004504   000122 115007                    CMPA    82,DL
         2 004505   004541 601000 2                  TNZ     s:10141

     1548    10116    4                   THEN F$DCB.SPANNED = %YES#; /* R - blocked, spanned           */

  10116  2 004506   000031 256100                    ORSQ    25,,PR0
         2 004507   004541 710000 2                  TRA     s:10141

     1549    10117    4                   ELSE ;                  /* B - blocked, not spanned           */
     1550    10118    4          CASE(1);                         /* SSSSSSSSSS                         */

     1551    10119    4            F$DCB.ORG = %VARIABLE#;

  10119  2 004510   200016 470500                    LDP0    JDCB$,,AUTO
         2 004511   020000 236003                    LDQ     8192,DU
         2 004512   000032 552140                    STBQ    26,'40'O,PR0

     1552    10120    4            F$DCB.SPANNED = %YES#;

  10120  2 004513   000004 236007                    LDQ     4,DL
         2 004514   000031 256100                    ORSQ    25,,PR0
         2 004515   004541 710000 2                  TRA     s:10141

     1553    10121    4          CASE(0);                         /* DDDDDDDDDD                         */

     1554    10122    4            F$DCB.ORG = %VARIABLE#;

  10122  2 004516   200016 470500                    LDP0    JDCB$,,AUTO
         2 004517   020000 236003                    LDQ     8192,DU
         2 004520   000032 552140                    STBQ    26,'40'O,PR0

     1555    10123    4          END;

     1556    10124    3         END;

  10124  2 004521   004541 710000 2                  TRA     s:10141

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:214  
     1557    10125    3       ELSE DO;                            /* HDR2 does not exist                */

     1558    10126    3         IF F$DCB.ORG = %UNDEF# OR F$DCB.ORG = %FIXED#

  10126  2 004522   000032 236100                    LDQ     26,,PR0
         2 004523   777000 376003                    ANQ     -512,DU
         2 004524   021000 116003                    CMPQ    8704,DU
         2 004525   004541 600000 2                  TZE     s:10141
         2 004526   017000 116003                    CMPQ    7680,DU
         2 004527   004541 600000 2                  TZE     s:10141

     1559    10127    3          THEN ;                           /* Believe user                       */
     1560    10128    4          ELSE DO;

     1561    10129    4            F$DCB.ORG = %UNDEF#;

  10129  2 004530   021000 236003                    LDQ     8704,DU
         2 004531   000032 552140                    STBQ    26,'40'O,PR0

     1562    10130    4            F$DCB.BOL = 0;

  10130  2 004532   000000 236003                    LDQ     0,DU
         2 004533   000034 552104                    STBQ    28,'04'O,PR0

     1563    10131    4            F$DCB.BLOCKED = %NO#;

  10131  2 004534   000040 236000 3                  LDQ     32
         2 004535   000031 356100                    ANSQ    25,,PR0

     1564    10132    4            F$DCB.BLKL = 65536;

  10132  2 004536   200000 220003                    LDX0    65536,DU
         2 004537   000033 740100                    STX0    27,,PR0

     1565    10133    4            F$DCB.RECL = 65536;

  10133  2 004540   000033 440100                    SXL0    27,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:215  

     1566    10134    4            END;

     1567    10135    3         END;

     1568    10136
     1569    10137         /***
     1570    10138          *** Get user labels if any.
     1571    10139          ***/
     1572    10140
     1573    10141    2      IF FT$DDT.POS = FTP_HDR#

  10141  2 004541   200012 470500                    LDP0    DDDT$,,AUTO
         2 004542   000006 236100                    LDQ     6,,PR0
         2 004543   000160 376007                    ANQ     112,DL
         2 004544   000040 116007                    CMPQ    32,DL
         2 004545   004622 601000 2                  TNZ     s:10154

     1574    10142    3       THEN DO;                            /* Still may have user labels         */

     1575    10143    3         CALL HFF$DSIZ( POFFW(ADDR(PN$.UHL_),ADDR(PN$.V_)), I ) ALTRET(NOUHL);

  10143  2 004546   200003 236100                    LDQ     @PN$,,AUTO
         2 004547   000022 772000                    QRL     18
         2 004550   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 004551   200003 236100                    LDQ     @PN$,,AUTO
         2 004552   000002 036003                    ADLQ    2,DU
         2 004553   000022 772000                    QRL     18
         2 004554   200052 136100                    SBLQ    JRNL_OFFSET+2,,AUTO
         2 004555   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 004556   200014 631500                    EPPR1   I,,AUTO
         2 004557   200055 451500                    STP1    JRNL_OFFSET+5,,AUTO
         2 004560   200053 633500                    EPPR3   JRNL_OFFSET+3,,AUTO
         2 004561   200054 453500                    STP3    JRNL_OFFSET+4,,AUTO
         2 004562   200054 630500                    EPPR0   JRNL_OFFSET+4,,AUTO
         2 004563   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004564   000000 701000 xent               TSX1    HFF$DSIZ
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:216  
         2 004565   004607 702000 2                  TSX2    NOUHL

     1576    10144    3         TEMP$ = PN$.UHL_;

  10144  2 004566   200003 470500                    LDP0    @PN$,,AUTO
         2 004567   000002 236100                    LDQ     2,,PR0
         2 004570   200032 756100                    STQ     TEMP$,,AUTO

     1577    10145    3         IF TEMP$ = ADDR(NIL) THEN I = 0;  /* Might be default open              */

  10145  2 004571   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 004572   004574 601000 2                  TNZ     s:10146

  10145  2 004573   200014 450100                    STZ     I,,AUTO

     1578    10146    3         CALL FTL$GETULBLS('UHL', TEMP$, I ) ALTRET(CLSTAP);

  10146  2 004574   200014 631500                    EPPR1   I,,AUTO
         2 004575   200054 451500                    STP1    JRNL_OFFSET+4,,AUTO
         2 004576   200032 633500                    EPPR3   TEMP$,,AUTO
         2 004577   200053 453500                    STP3    JRNL_OFFSET+3,,AUTO
         2 004600   000032 236000 3                  LDQ     26
         2 004601   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 004602   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 004603   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004604   000000 701000 xent               TSX1    FTL$GETULBLS
         2 004605   005342 702000 2                  TSX2    CLSTAP

     1579    10147    4         DO WHILE('0'B);

  10147  2 004606   004615 710000 2                  TRA     s:10152

  10146  2 004607                       NOUHL        null
     1580    10148    4   NOUHL:   ;
     1581    10149    4            F$DCB.ARS = 1;                 /* Position to first data record      */

  10149  2 004607   000001 235007                    LDA     1,DL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:217  
         2 004610   200016 470500                    LDP0    JDCB$,,AUTO
         2 004611   000000 755100                    STA     0,,PR0

     1582    10150    4            CALL FTI$SPFILE ALTRET(CLSTAP);

  10150  2 004612   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004613   000000 701000 xent               TSX1    FTI$SPFILE
         2 004614   005342 702000 2                  TSX2    CLSTAP

     1583    10151    4            END;

     1584    10152    3         FT$DDT.POS = FTP_BOD#;            /* Now in data area                   */

  10152  2 004615   200012 470500                    LDP0    DDDT$,,AUTO
         2 004616   000006 236100                    LDQ     6,,PR0
         2 004617   000012 376000 3                  ANQ     10
         2 004620   000060 276007                    ORQ     48,DL
         2 004621   000006 756100                    STQ     6,,PR0

     1585    10153    3         END;

     1586    10154    2      F$DCB.FSN = FILE_SEQ;                /* Return file sequence number        */

  10154  2 004622   200031 720100                    LXL0    FILE_SEQ,,AUTO
         2 004623   200016 471500                    LDP1    JDCB$,,AUTO
         2 004624   100034 740100                    STX0    28,,PR1

     1587    10155
     1588    10156         /***
     1589    10157          *** Remember creation date.
     1590    10158          ***/
     1591    10159
     1592    10160    2      IF AFPOOL$->FT$ANYLBL.LABEL_TYPE = 'HDR1' THEN

  10160  2 004625   200004 473500                    LDP3    AFPOOL$,,AUTO
         2 004626   040000 106500                    CMPC    fill='040'O
         2 004627   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:218  
         2 004630   000063 000004 1                  ADSC9   E_NOFILE+15              cn=0,n=4
         2 004631   004666 601000 2                  TNZ     s:10168

     1593    10161    3         IF AFPOOL$->FT$LBL1.CREATE_DATE ~= ' ' THEN DO;

  10161  2 004632   040000 106500                    CMPC    fill='040'O
         2 004633   300012 400005                    ADSC9   10,,PR3                  cn=2,n=5
         2 004634   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 004635   004657 600000 2                  TZE     BADDATE

     1594    10162    3            CALL FTO_CHECK_DIGITS(AFPOOL$->FT$LBL1.CREATE_DATE,5) ALTRET(BADDATE);

  10162  2 004636   000043 236000 3                  LDQ     35
         2 004637   200040 756100                    STQ     @STRING+1,,AUTO
         2 004640   200004 236100                    LDQ     AFPOOL$,,AUTO
         2 004641   000044 036000 3                  ADLQ    36
         2 004642   200037 756100                    STQ     TEMP$+5,,AUTO
         2 004643   005355 701000 2                  TSX1    FTO_CHECK_DIGITS
         2 004644   004657 702000 2                  TSX2    BADDATE

     1595    10163    3            CALL UMT$UTSJ( CREATE_DATE_UTS, AFPOOL$->FT$LBL1.CREATE_DATE );

  10163  2 004645   200004 236100                    LDQ     AFPOOL$,,AUTO
         2 004646   000044 036000 3                  ADLQ    36
         2 004647   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 004650   200010 630500                    EPPR0   CREATE_DATE_UTS,,AUTO
         2 004651   200052 450500                    STP0    JRNL_OFFSET+2,,AUTO
         2 004652   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 004653   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004654   000000 701000 xent               TSX1    UMT$UTSJ
         2 004655   000000 011000                    NOP     0

     1596    10164    3            END;

  10164  2 004656   004674 710000 2                  TRA     s:10174

     1597    10165    2          ELSE
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:219  
     1598    10166    2   BADDATE: CALL SSS$SYSTIME( CREATE_DATE_UTS );

  10166  2 004657   200010 630500       BADDATE      EPPR0   CREATE_DATE_UTS,,AUTO
         2 004660   200052 450500                    STP0    JRNL_OFFSET+2,,AUTO
         2 004661   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 004662   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004663   000000 701000 xent               TSX1    SSS$SYSTIME
         2 004664   000000 011000                    NOP     0
         2 004665   004674 710000 2                  TRA     s:10174

     1599    10167    2       ELSE
     1600    10168    2         CALL SSS$SYSTIME( CREATE_DATE_UTS );

  10168  2 004666   200010 634500                    EPPR4   CREATE_DATE_UTS,,AUTO
         2 004667   200052 454500                    STP4    JRNL_OFFSET+2,,AUTO
         2 004670   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 004671   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004672   000000 701000 xent               TSX1    SSS$SYSTIME
         2 004673   000000 011000                    NOP     0

     1601    10169
     1602    10170         /***
     1603    10171          *** For CP-6 format files, do FIT checks.
     1604    10172          ***/
     1605    10173
     1606    10174    2      CALL FTO_SETTAPTYP;                  /* Determine type of file             */

  10174  2 004674   005407 701000 2                  TSX1    FTO_SETTAPTYP
         2 004675   000000 011000                    NOP     0

     1607    10175    2      IF F$DCB.TAPTYP.CP6F

  10175  2 004676   200016 470500                    LDP0    JDCB$,,AUTO
         2 004677   000067 236100                    LDQ     55,,PR0
         2 004700   000200 316003                    CANQ    128,DU
         2 004701   004740 600000 2                  TZE     s:10190

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:220  
     1608    10176    3       THEN DO;                            /* CP-6 format                        */

     1609    10177    3         F$DCB.CNVRT = %NO#;

  10177  2 004702   000022 236000 3                  LDQ     18
         2 004703   000031 356100                    ANSQ    25,,PR0

     1610    10178    3         F$DCB.ARS = 4096;                 /* FIT size                           */

  10178  2 004704   010000 235007                    LDA     4096,DL
         2 004705   000000 755100                    STA     0,,PR0

     1611    10179    3         CALL FTI$RDBIN(AFPOOL$) ALTRET(CLSTAP);

  10179  2 004706   200004 630500                    EPPR0   AFPOOL$,,AUTO
         2 004707   200052 450500                    STP0    JRNL_OFFSET+2,,AUTO
         2 004710   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 004711   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004712   000000 701000 xent               TSX1    FTI$RDBIN
         2 004713   005342 702000 2                  TSX2    CLSTAP

     1612    10180    3         IF F$DCB.TYC.EOF(1)

  10180  2 004714   200016 470500                    LDP0    JDCB$,,AUTO
         2 004715   000002 236100                    LDQ     2,,PR0
         2 004716   004000 316003                    CANQ    2048,DU
         2 004717   004725 600000 2                  TZE     s:10185

     1613    10181    4          THEN DO;                         /* What, no FIT?                      */

     1614    10182    4            F$DCB.ARS = -1;                /* Backup                             */

  10182  2 004720   000001 335007                    LCA     1,DL
         2 004721   000000 755100                    STA     0,,PR0

     1615    10183    4            CALL FTI$SPFILE ALTRET(CLSTAP);

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:221  
  10183  2 004722   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004723   000000 701000 xent               TSX1    FTI$SPFILE
         2 004724   005342 702000 2                  TSX2    CLSTAP

     1616    10184    4            END;

     1617    10185    3         IF F$DCB.ARS > 24

  10185  2 004725   200016 470500                    LDP0    JDCB$,,AUTO
         2 004726   000000 235100                    LDA     0,,PR0
         2 004727   000030 115007                    CMPA    24,DL
         2 004730   004735 604400 2                  TMOZ    s:10187

     1618    10186    3          THEN TEMP$ = PINCRW( AFPOOL$, SIZEW(AFPOOL$->FM$GRAN) );

  10186  2 004731   200004 236100                    LDQ     AFPOOL$,,AUTO
         2 004732   000005 036003                    ADLQ    5,DU
         2 004733   200032 756100                    STQ     TEMP$,,AUTO
         2 004734   004743 710000 2                  TRA     s:10194

     1619    10187    3          ELSE TEMP$ = AFPOOL$;

  10187  2 004735   200004 236100                    LDQ     AFPOOL$,,AUTO
         2 004736   200032 756100                    STQ     TEMP$,,AUTO

     1620    10188    3         END;

  10188  2 004737   004743 710000 2                  TRA     s:10194

     1621    10189    3       ELSE DO;                            /* No FIT                             */

     1622    10190    3         J = 0;

  10190  2 004740   200015 450100                    STZ     J,,AUTO

     1623    10191    3         TEMP$ = ADDR(J);

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:222  
  10191  2 004741   200015 631500                    EPPR1   J,,AUTO
         2 004742   200032 451500                    STP1    TEMP$,,AUTO

     1624    10192    3         END;

     1625    10193
     1626    10194    2      F$DCB.OWNER = %YES#;                 /* Only protect by account            */

  10194  2 004743   040000 236007                    LDQ     16384,DL
         2 004744   000064 256100                    ORSQ    52,,PR0

     1627    10195    2      IF F$DCB.ORG = %RESTRICT#

  10195  2 004745   000032 236100                    LDQ     26,,PR0
         2 004746   777000 376003                    ANQ     -512,DU
         2 004747   022000 116003                    CMPQ    9216,DU
         2 004750   004760 601000 2                  TNZ     s:10198
         2 004751   000000 471400 xsym               LDP1    B$JIT$
         2 004752   100013 236100                    LDQ     11,,PR1
         2 004753   000060 376000 1                  ANQ     E_NOFILE+12
         2 004754   004760 601000 2                  TNZ     s:10198

     1628    10196    2        AND NOT B$JIT.PRIV.ACTIVE & %PR_FMBLK#
     1629    10197    2       THEN B$JIT.ERR = E_NORESTRICT; /*E* ERROR: FTO-E$NORESTRICT */

  10197  2 004755   000035 236000 1                  LDQ     E_NORESTRICT
         2 004756   100012 756100                    STQ     10,,PR1
         2 004757   004771 710000 2                  TRA     s:10200

     1630    10198    2       ELSE CALL FMO$SECCHK(PN$.V_->FPT$OPEN_V,TEMP$->FM$FIT);

  10198  2 004760   200003 471500                    LDP1    @PN$,,AUTO
         2 004761   100000 473500                    LDP3    0,,PR1
         2 004762   200032 236100                    LDQ     TEMP$,,AUTO
         2 004763   200053 756100                    STQ     JRNL_OFFSET+3,,AUTO
         2 004764   200052 453500                    STP3    JRNL_OFFSET+2,,AUTO
         2 004765   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:223  
         2 004766   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004767   000000 701000 xent               TSX1    FMO$SECCHK
         2 004770   000000 011000                    NOP     0

     1631    10199                                           /* Pass V area and FIT for security checks */
     1632    10200    2      IF (F$DCB.BLKL > 4096 * (B$JIT.FBUL-2)) AND NOT F$DCB.TAPTYP.USRBUF

  10200  2 004771   200016 470500                    LDP0    JDCB$,,AUTO
         2 004772   000033 236100                    LDQ     27,,PR0
         2 004773   000022 772000                    QRL     18
         2 004774   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 004775   000000 471400 xsym               LDP1    B$JIT$
         2 004776   100205 236100                    LDQ     133,,PR1
         2 004777   000014 736000                    QLS     12
         2 005000   000037 376000 3                  ANQ     31
         2 005001   020000 136007                    SBLQ    8192,DL
         2 005002   200052 116100                    CMPQ    JRNL_OFFSET+2,,AUTO
         2 005003   005011 605000 2                  TPL     s:10202
         2 005004   000067 236100                    LDQ     55,,PR0
         2 005005   000100 316003                    CANQ    64,DU
         2 005006   005011 601000 2                  TNZ     s:10202

     1633    10201    2       THEN B$JIT.ERR = E_NOFPOOL; /*E* FTO-E$NOFPOOL */

  10201  2 005007   000034 236000 1                  LDQ     E_NOFPOOL
         2 005010   100012 756100                    STQ     10,,PR1

     1634    10202    2      IF B$JIT.ERR

  10202  2 005011   100012 235100                    LDA     10,,PR1
         2 005012   005075 600000 2                  TZE     s:10234

     1635    10203    3       THEN DO;                            /* Some error...                      */

     1636    10204    3         ERRSAV = B$JIT.ERR;

  10204  2 005013   100012 236100                    LDQ     10,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:224  
         2 005014   200013 756100                    STQ     ERRSAV,,AUTO

     1637    10205    3         B$JIT.ERR = '0'B;

  10205  2 005015   100012 450100                    STZ     10,,PR1

     1638    10206    3         CALL FTC$DFLTCLOSE;               /* Close this file                    */

  10206  2 005016   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005017   000000 701000 xent               TSX1    FTC$DFLTCLOSE
         2 005020   000000 011000                    NOP     0

     1639    10207    3         B$JIT.ERR = '0'B;

  10207  2 005021   000000 470400 xsym               LDP0    B$JIT$
         2 005022   000012 450100                    STZ     10,,PR0

     1640    10208    3         IF PN$.V_->FPT$OPEN_V.OPER.NXTF AND NOT PN$.V_->FPT$OPEN_V.OPER.THISF

  10208  2 005023   200003 471500                    LDP1    @PN$,,AUTO
         2 005024   100000 473500                    LDP3    0,,PR1
         2 005025   300000 236100                    LDQ     0,,PR3
         2 005026   004000 316007                    CANQ    2048,DL
         2 005027   005036 600000 2                  TZE     s:10212
         2 005030   002000 316007                    CANQ    1024,DL
         2 005031   005036 601000 2                  TNZ     s:10212
         2 005032   200013 236100                    LDQ     ERRSAV,,AUTO
         2 005033   377770 376007                    ANQ     131064,DL
         2 005034   001610 116007                    CMPQ    904,DL
         2 005035   003417 600000 2                  TZE     ATTEMPT_OPEN_EXISTING

     1641    10209    3           AND ERRSAV.ERR# = %E$NOFILE
     1642    10210    3          THEN GOTO ATTEMPT_OPEN_EXISTING;
             10210                   /* Access not allowed...try to open next file */
     1643    10211    4          ELSE DO;

     1644    10212    4            IF ERRSAV.ERR# = %E$NOFILE
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:225  

  10212  2 005036   200013 236100                    LDQ     ERRSAV,,AUTO
         2 005037   377770 376007                    ANQ     131064,DL
         2 005040   001610 116007                    CMPQ    904,DL
         2 005041   005054 601000 2                  TNZ     s:10219

     1645    10213    5             THEN DO;                 /* Can't hide file so don't permit access  */

     1646    10214    5               F$DCB.NAME.C = ' ';

  10214  2 005042   200016 474500                    LDP4    JDCB$,,AUTO
         2 005043   040100 100400                    MLR     fill='040'O
         2 005044   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 005045   400010 200037                    ADSC9   8,,PR4                   cn=1,n=31

     1647    10215    5               F$DCB.NAME.L = 0;

  10215  2 005046   200016 473500                    LDP3    JDCB$,,AUTO
         2 005047   000000 236003                    LDQ     0,DU
         2 005050   300010 552140                    STBQ    8,'40'O,PR3

     1648    10216    5               ERRSAV = E_NOACCESS; /*E* ERROR: FTO-E$NOACCESS */

  10216  2 005051   000030 236000 1                  LDQ     E_NOACCESS
         2 005052   200013 756100                    STQ     ERRSAV,,AUTO

     1649    10217    5               END;

  10217  2 005053   005074 710000 2                  TRA     s:10226

     1650    10218    5             ELSE DO;                      /* Return name of inaccessible file   */

     1651    10219    5               CALL INDEX( J, ' ', FILE_NAME )

  10219  2 005054   000000 124500                    SCM     mask='000'O
         2 005055   200021 000037                    ADSC9   FILE_NAME,,AUTO          cn=0,n=31
         2 005056   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:226  
         2 005057   200015 000100                    ARG     J,,AUTO
         2 005060   005062 606400 2                  TTN     s:10221
         2 005061   005064 710000 2                  TRA     s:10223

     1652    10220    6                WHENALTRETURN DO;

     1653    10221    6                  J = 31;

  10221  2 005062   000037 235007                    LDA     31,DL
         2 005063   200015 755100                    STA     J,,AUTO

     1654    10222    6                  END;

     1655    10223    5               F$DCB.NAME.C = FILE_NAME;

  10223  2 005064   200016 470500                    LDP0    JDCB$,,AUTO
         2 005065   040100 100500                    MLR     fill='040'O
         2 005066   200021 000037                    ADSC9   FILE_NAME,,AUTO          cn=0,n=31
         2 005067   000010 200037                    ADSC9   8,,PR0                   cn=1,n=31

     1656    10224    5               F$DCB.NAME.L = J;

  10224  2 005070   200016 470500                    LDP0    JDCB$,,AUTO
         2 005071   200015 236100                    LDQ     J,,AUTO
         2 005072   000033 736000                    QLS     27
         2 005073   000010 552140                    STBQ    8,'40'O,PR0

     1657    10225    5               END;

     1658    10226    4            GOTO CLSTAPERR;

  10226  2 005074   005345 710000 2                  TRA     CLSTAPERR

     1659    10227    4            END;
     1660    10228    3         END;
     1661    10229
     1662    10230         /***
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:227  
     1663    10231          *** Get indexed file information if needed.
     1664    10232          ***/
     1665    10233
     1666    10234    2      IF F$DCB.ORG = %INDEXED#

  10234  2 005075   200016 470500                    LDP0    JDCB$,,AUTO
         2 005076   000032 236100                    LDQ     26,,PR0
         2 005077   777000 376003                    ANQ     -512,DU
         2 005100   006000 116003                    CMPQ    3072,DU
         2 005101   005124 601000 2                  TNZ     s:10247

     1667    10235    3       THEN DO;

     1668    10236    3         AFPOOL$ = TEMP$;

  10236  2 005102   200032 236100                    LDQ     TEMP$,,AUTO
         2 005103   200004 756100                    STQ     AFPOOL$,,AUTO

     1669    10237    3         J = 2;

  10237  2 005104   000002 235007                    LDA     2,DL
         2 005105   200015 755100                    STA     J,,AUTO

     1670    10238    3         CALL FMO$LOCCODE(AFPOOL$,J);

  10238  2 005106   200015 633500                    EPPR3   J,,AUTO
         2 005107   200053 453500                    STP3    JRNL_OFFSET+3,,AUTO
         2 005110   200004 634500                    EPPR4   AFPOOL$,,AUTO
         2 005111   200052 454500                    STP4    JRNL_OFFSET+2,,AUTO
         2 005112   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 005113   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005114   000000 701000 xent               TSX1    FMO$LOCCODE
         2 005115   000000 011000                    NOP     0

     1671    10239    3         F$DCB.KEYX = AFPOOL$->CODE02.KEYX;

  10239  2 005116   200004 470500                    LDP0    AFPOOL$,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:228  
         2 005117   000003 220100                    LDX0    3,,PR0
         2 005120   200016 471500                    LDP1    JDCB$,,AUTO
         2 005121   100036 740100                    STX0    30,,PR1

     1672    10240    3         F$DCB.KEYL = AFPOOL$->CODE02.KEYL;

  10240  2 005122   000003 236100                    LDQ     3,,PR0
         2 005123   100036 552110                    STBQ    30,'10'O,PR1

     1673    10241    3         END;

     1674    10242
     1675    10243         /***
     1676    10244          *** Set file name.
     1677    10245          ***/
     1678    10246
     1679    10247    2      CALL INDEX( J, ' ', FILE_NAME )

  10247  2 005124   000000 124500                    SCM     mask='000'O
         2 005125   200021 000037                    ADSC9   FILE_NAME,,AUTO          cn=0,n=31
         2 005126   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 005127   200015 000100                    ARG     J,,AUTO
         2 005130   005132 606400 2                  TTN     s:10249
         2 005131   005134 710000 2                  TRA     s:10251

     1680    10248    3       WHENALTRETURN DO;

     1681    10249    3         J = 31;

  10249  2 005132   000037 235007                    LDA     31,DL
         2 005133   200015 755100                    STA     J,,AUTO

     1682    10250    3         END;

     1683    10251    2      F$DCB.NAME.C = FILE_NAME;

  10251  2 005134   200016 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:229  
         2 005135   040100 100500                    MLR     fill='040'O
         2 005136   200021 000037                    ADSC9   FILE_NAME,,AUTO          cn=0,n=31
         2 005137   000010 200037                    ADSC9   8,,PR0                   cn=1,n=31

     1684    10252    2      F$DCB.NAME.L = J;

  10252  2 005140   200016 470500                    LDP0    JDCB$,,AUTO
         2 005141   200015 236100                    LDQ     J,,AUTO
         2 005142   000033 736000                    QLS     27
         2 005143   000010 552140                    STBQ    8,'40'O,PR0

     1685    10253
     1686    10254    2      IF F$DCB.TAPTYP.CP6F

  10254  2 005144   200016 470500                    LDP0    JDCB$,,AUTO
         2 005145   000067 236100                    LDQ     55,,PR0
         2 005146   000200 316003                    CANQ    128,DU
         2 005147   005171 600000 2                  TZE     s:10261

     1687    10255    3       THEN DO;

     1688    10256    3         AFPOOL$ = TEMP$;

  10256  2 005150   200032 236100                    LDQ     TEMP$,,AUTO
         2 005151   200004 756100                    STQ     AFPOOL$,,AUTO

     1689    10257    3         J = 3;

  10257  2 005152   000003 235007                    LDA     3,DL
         2 005153   200015 755100                    STA     J,,AUTO

     1690    10258    3         CALL FMO$LOCCODE( AFPOOL$, J );

  10258  2 005154   200015 631500                    EPPR1   J,,AUTO
         2 005155   200053 451500                    STP1    JRNL_OFFSET+3,,AUTO
         2 005156   200004 633500                    EPPR3   AFPOOL$,,AUTO
         2 005157   200052 453500                    STP3    JRNL_OFFSET+2,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:230  
         2 005160   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 005161   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005162   000000 701000 xent               TSX1    FMO$LOCCODE
         2 005163   000000 011000                    NOP     0

     1691    10259    3         F$DCB.TYPE = AFPOOL$->CODE03.TYPE;

  10259  2 005164   200004 470500                    LDP0    AFPOOL$,,AUTO
         2 005165   000001 720100                    LXL0    1,,PR0
         2 005166   200016 471500                    LDP1    JDCB$,,AUTO
         2 005167   100025 440100                    SXL0    21,,PR1

     1692    10260    3         END;

  10260  2 005170   005173 710000 2                  TRA     s:10267

     1693    10261    2       ELSE F$DCB.TYPE = ' ';

  10261  2 005171   040040 220003                    LDX0    16416,DU
         2 005172   000025 440100                    SXL0    21,,PR0

     1694    10262
     1695    10263         /***
     1696    10264          *** Return FIT if requested.
     1697    10265          ***/
     1698    10266
     1699    10267    2      IF PN$.FPARAM_ ~= ADDR(NIL)

  10267  2 005173   200003 470500                    LDP0    @PN$,,AUTO
         2 005174   000014 236100                    LDQ     12,,PR0
         2 005175   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 005176   005321 600000 2                  TZE     s:10292

     1700    10268    3       THEN DO;                            /* Return FIT if requested            */

     1701    10269    3         IF F$DCB.TAPTYP.CP6F

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:231  
  10269  2 005177   200016 471500                    LDP1    JDCB$,,AUTO
         2 005200   100067 236100                    LDQ     55,,PR1
         2 005201   000200 316003                    CANQ    128,DU
         2 005202   005215 600000 2                  TZE     s:10272

     1702    10270    3          THEN CALL FMO$TRNINFO( PN$.FPARAM_, TEMP$ ) ALTRET(CLSTAP);

  10270  2 005203   200032 633500                    EPPR3   TEMP$,,AUTO
         2 005204   200053 453500                    STP3    JRNL_OFFSET+3,,AUTO
         2 005205   200003 236100                    LDQ     @PN$,,AUTO
         2 005206   000014 036003                    ADLQ    12,DU
         2 005207   200052 756100                    STQ     JRNL_OFFSET+2,,AUTO
         2 005210   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 005211   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005212   000000 701000 xent               TSX1    FMO$TRNINFO
         2 005213   005342 702000 2                  TSX2    CLSTAP
         2 005214   005321 710000 2                  TRA     s:10292

     1703    10271    4          ELSE DO;                         /* Build creation only FIT            */

     1704    10272    4            AFPOOL$ = PN$.FPARAM_;

  10272  2 005215   000014 236100                    LDQ     12,,PR0
         2 005216   200004 756100                    STQ     AFPOOL$,,AUTO

     1705    10273    4            AFPOOL$->FM$FIT.CODES(0) = '0'B;

  10273  2 005217   200004 473500                    LDP3    AFPOOL$,,AUTO
         2 005220   300000 450100                    STZ     0,,PR3

     1706    10274    4            AFPOOL$->FM$FIT.CODES.CODE(0) = 1;

  10274  2 005221   200004 471500                    LDP1    AFPOOL$,,AUTO
         2 005222   100000 236100                    LDQ     0,,PR1
         2 005223   000045 376000 3                  ANQ     37
         2 005224   020000 276003                    ORQ     8192,DU
         2 005225   100000 756100                    STQ     0,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:232  

     1707    10275    4            AFPOOL$->FM$FIT.CODES.CODE(1) = 04;

  10275  2 005226   200004 471500                    LDP1    AFPOOL$,,AUTO
         2 005227   100001 236100                    LDQ     1,,PR1
         2 005230   000045 376000 3                  ANQ     37
         2 005231   100000 276003                    ORQ     32768,DU
         2 005232   100001 756100                    STQ     1,,PR1

     1708    10276    4            AFPOOL$->FM$FIT.CODES.NAW(1) = LENGTHW( CODE04 );

  10276  2 005233   200004 471500                    LDP1    AFPOOL$,,AUTO
         2 005234   100001 236100                    LDQ     1,,PR1
         2 005235   000046 376000 3                  ANQ     38
         2 005236   000054 276003                    ORQ     44,DU
         2 005237   100001 756100                    STQ     1,,PR1

     1709    10277    4            AFPOOL$->FM$FIT.CODES.NDW(1) = LENGTHW( CODE04 );

  10277  2 005240   200004 471500                    LDP1    AFPOOL$,,AUTO
         2 005241   100001 236100                    LDQ     1,,PR1
         2 005242   000047 376000 3                  ANQ     39
         2 005243   026000 276007                    ORQ     11264,DL
         2 005244   100001 756100                    STQ     1,,PR1

     1710    10278    4            AFPOOL$->FM$FIT.CODES.ITEMX(1) = 2;

  10278  2 005245   200004 471500                    LDP1    AFPOOL$,,AUTO
         2 005246   100001 236100                    LDQ     1,,PR1
         2 005247   000050 376000 3                  ANQ     40
         2 005250   000002 276007                    ORQ     2,DL
         2 005251   100001 756100                    STQ     1,,PR1

     1711    10279    4            TEMP$ = PINCRW( AFPOOL$, AFPOOL$->FM$FIT.CODES.ITEMX(1) );

  10279  2 005252   200004 471500                    LDP1    AFPOOL$,,AUTO
         2 005253   100001 720100                    LXL0    1,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:233  
         2 005254   001777 360003                    ANX0    1023,DU
         2 005255   000000 636010                    EAQ     0,X0
         2 005256   200004 036100                    ADLQ    AFPOOL$,,AUTO
         2 005257   200032 756100                    STQ     TEMP$,,AUTO

     1712    10280    4            TEMP$->CODE04.ACCESS.TIME = CREATE_DATE_UTS;

  10280  2 005260   200032 473500                    LDP3    TEMP$,,AUTO
         2 005261   200010 235100                    LDA     CREATE_DATE_UTS,,AUTO
         2 005262   300000 755100                    STA     0,,PR3

     1713    10281    4            TEMP$->CODE04.MODIFY.TIME = CREATE_DATE_UTS;

  10281  2 005263   200032 471500                    LDP1    TEMP$,,AUTO
         2 005264   200010 235100                    LDA     CREATE_DATE_UTS,,AUTO
         2 005265   100001 755100                    STA     1,,PR1

     1714    10282    4            TEMP$->CODE04.CREATION.TIME = CREATE_DATE_UTS;

  10282  2 005266   200032 471500                    LDP1    TEMP$,,AUTO
         2 005267   200010 235100                    LDA     CREATE_DATE_UTS,,AUTO
         2 005270   100002 755100                    STA     2,,PR1

     1715    10283    4            TEMP$->CODE04.SVMODIFY.TIME = 0;

  10283  2 005271   200032 471500                    LDP1    TEMP$,,AUTO
         2 005272   100010 450100                    STZ     8,,PR1

     1716    10284    4            TEMP$->CODE04.GAC.N = 0;

  10284  2 005273   200032 471500                    LDP1    TEMP$,,AUTO
         2 005274   100011 450100                    STZ     9,,PR1

     1717    10285    4            TEMP$->CODE04.GAC.TIME = 0;

  10285  2 005275   200032 471500                    LDP1    TEMP$,,AUTO
         2 005276   100012 450100                    STZ     10,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:234  

     1718    10286    4            TEMP$->CODE04.CREATOR = '0'B;

  10286  2 005277   200032 471500                    LDP1    TEMP$,,AUTO
         2 005300   000100 100400                    MLR     fill='000'O
         2 005301   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 005302   100003 000024                    ADSC9   3,,PR1                   cn=0,n=20

     1719    10287    4            TEMP$ = PINCRW( TEMP$, LENGTHW(CODE04) );

  10287  2 005303   200032 236100                    LDQ     TEMP$,,AUTO
         2 005304   000013 036003                    ADLQ    11,DU
         2 005305   200032 756100                    STQ     TEMP$,,AUTO

     1720    10288    4            AFPOOL$->FM$FIT.CODES.NAW(0) = POFFW( TEMP$, AFPOOL$ );

  10288  2 005306   200004 235100                    LDA     AFPOOL$,,AUTO
         2 005307   000022 771000                    ARL     18
         2 005310   200052 755100                    STA     JRNL_OFFSET+2,,AUTO
         2 005311   200032 236100                    LDQ     TEMP$,,AUTO
         2 005312   000022 772000                    QRL     18
         2 005313   200052 136100                    SBLQ    JRNL_OFFSET+2,,AUTO
         2 005314   200004 471500                    LDP1    AFPOOL$,,AUTO
         2 005315   000024 736000                    QLS     20
         2 005316   100000 676100                    ERQ     0,,PR1
         2 005317   007774 376003                    ANQ     4092,DU
         2 005320   100000 656100                    ERSQ    0,,PR1

     1721    10289    4            END;

     1722    10290    3         END;

     1723    10291                                                /* Return FIT if requested            */
     1724    10292    2      RETURN;

  10292  2 005321   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 005322   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:235  

  10286  2 005323                       RETFSN       null
     1725    10293
     1726    10294    2   RETFSN: ;
     1727    10295    2      IF F$DCB.SETX ~= 0 AND B$JIT.ERR.CODE = %E$EOSET

  10295  2 005323   200016 470500                    LDP0    JDCB$,,AUTO
         2 005324   000051 720100                    LXL0    41,,PR0
         2 005325   005342 600000 2                  TZE     CLSTAP
         2 005326   000000 471400 xsym               LDP1    B$JIT$
         2 005327   100012 236100                    LDQ     10,,PR1
         2 005330   377770 376007                    ANQ     131064,DL
         2 005331   013140 116007                    CMPQ    5728,DL
         2 005332   005342 601000 2                  TNZ     CLSTAP

     1728    10296    3       THEN DO;                            /* Return end of set sequence         */

     1729    10297    3         DDDT$ = NK$LDCT$(F$DCB.SETX)->NK$LDCT.DDT$;

  10297  2 005333   000000 473400 xsym               LDP3    N$DCT$$
         2 005334   300000 474510                    LDP4    0,X0,PR3
         2 005335   400004 236100                    LDQ     4,,PR4
         2 005336   200012 756100                    STQ     DDDT$,,AUTO

     1730    10298    3         F$DCB.FSN = FT$DDT.FSN; /* FSN of last (or before first) file of set    */

  10298  2 005337   200012 475500                    LDP5    DDDT$,,AUTO
         2 005340   500005 221100                    LDX1    5,,PR5
         2 005341   000034 741100                    STX1    28,,PR0

     1731    10299    3         END;

  10295  2 005342                       CLSTAP       null
     1732    10300    2   CLSTAP: ;
     1733    10301    2      ERRSAV = B$JIT.ERR;

  10301  2 005342   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:236  
         2 005343   000012 236100                    LDQ     10,,PR0
         2 005344   200013 756100                    STQ     ERRSAV,,AUTO

  10301  2 005345                       CLSTAPERR    null
     1734    10302    2   CLSTAPERR: ;
     1735    10303    2      CALL FRB$CLS;

  10303  2 005345   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005346   000000 701000 xent               TSX1    FRB$CLS
         2 005347   000000 011000                    NOP     0

     1736    10304    2      B$JIT.ERR = ERRSAV;

  10304  2 005350   200013 236100                    LDQ     ERRSAV,,AUTO
         2 005351   000000 470400 xsym               LDP0    B$JIT$
         2 005352   000012 756100                    STQ     10,,PR0

  10304  2 005353                       JUSTALT      null
     1737    10305
     1738    10306    2   JUSTALT: ;
     1739    10307    2      ALTRETURN;

  10307  2 005353   200034 221300                    LDX1  ! TEMP$+2,,AUTO
         2 005354   000000 702211                    TSX2  ! 0,X1

     1740    10308
     1741    10309    2   END FTO_OPNEXISTING;
     1742    10310        /*********************************************************************/
     1743    10311        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:237  
     1744    10312        /*********************************************************************/
     1745    10313    1   FTO_CHECK_DIGITS: PROC(STRING,LEN) ALTRET;

  10313  2 005355   200036 741300       FTO_CHECK_D* STX1  ! TEMP$+4,,AUTO

     1746    10314        /*F*    NAME: FTO_CHECK_DIGITS
     1747    10315                PURPOSE: Make sure the passed string contains only digits. */
     1748    10316
     1749    10317    2   DCL LEN UBIN;
     1750    10318    2   DCL STRING CHAR(LEN);
     1751    10319    2   DCL IX SBIN;
     1752    10320    2   DCL IC SBIN;
     1753    10321
     1754    10322    3      DO IX = LEN-1 DOWNTO 0;

  10322  2 005356   200040 470500                    LDP0    @LEN,,AUTO
         2 005357   000000 235100                    LDA     0,,PR0
         2 005360   000001 135007                    SBLA    1,DL
         2 005361   200041 755100                    STA     IX,,AUTO
         2 005362   005403 710000 2                  TRA     s:10326+2

     1755    10323    3         IC = ASCBIN(SUBSTR(STRING,IX,1)) - 48;

  10323  2 005363   200040 470500                    LDP0    @LEN,,AUTO
         2 005364   000000 720100                    LXL0    0,,PR0
         2 005365   200037 471500                    LDP1    @STRING,,AUTO
         2 005366   200041 235100                    LDA     IX,,AUTO
         2 005367   000100 101505                    MRL     fill='000'O
         2 005370   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
         2 005371   200052 000004                    ADSC9   JRNL_OFFSET+2,,AUTO      cn=0,n=4
         2 005372   200052 236100                    LDQ     JRNL_OFFSET+2,,AUTO
         2 005373   000060 136007                    SBLQ    48,DL
         2 005374   200042 756100                    STQ     IC,,AUTO

     1756    10324    3         IF IC > 9 THEN

  10324  2 005375   000011 116007                    CMPQ    9,DL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:238  
         2 005376   005401 604400 2                  TMOZ    s:10326

     1757    10325    3            ALTRETURN;

  10325  2 005377   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 005400   000000 702211                    TSX2  ! 0,X1

     1758    10326    3         END;

  10326  2 005401   000001 336007                    LCQ     1,DL
         2 005402   200041 056100                    ASQ     IX,,AUTO
         2 005403   200041 235100                    LDA     IX,,AUTO
         2 005404   005363 605000 2                  TPL     s:10323

     1759    10327    2      RETURN;

  10327  2 005405   200036 221300                    LDX1  ! TEMP$+4,,AUTO
         2 005406   000001 702211                    TSX2  ! 1,X1

     1760    10328
     1761    10329    2   END FTO_CHECK_DIGITS;
     1762    10330        /*********************************************************************/
     1763    10331        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:239  
     1764    10332        /*********************************************************************/
     1765    10333    1   FTO_SETTAPTYP: PROC;

  10333  2 005407   200040 741300       FTO_SETTAPT* STX1  ! @LEN,,AUTO

     1766    10334        /*F*    NAME: FTO_SETTAPTYP
     1767    10335                PURPOSE: Sets up DCB.TAPTYP from DCB info.
     1768    10336         ***/
     1769    10337
     1770    10338        /********************/
     1771    10339
     1772    10340    2      F$DCB.DVBYTE = '0'B;                 /* Not generally used for tapes       */

  10340  2 005410   200016 470500                    LDP0    JDCB$,,AUTO
         2 005411   000051 236000 3                  LDQ     41
         2 005412   000003 356100                    ANSQ    3,,PR0

     1773    10341    3      DO CASE(F$DCB.ORG);                  /* Depends on ORG                     */

  10341  2 005413   200016 470500                    LDP0    JDCB$,,AUTO
         2 005414   000032 236100                    LDQ     26,,PR0
         2 005415   000033 772000                    QRL     27
         2 005416   000017 136007                    SBLQ    15,DL
         2 005417   000004 116007                    CMPQ    4,DL
         2 005420   005422 602006 2                  TNC     s:10341+7,QL
         2 005421   005453 710000 2                  TRA     s:10352
         2 005422   005426 710000 2                  TRA     s:10343
         2 005423   005426 710000 2                  TRA     s:10343
         2 005424   005426 710000 2                  TRA     s:10343
         2 005425   005435 710000 2                  TRA     s:10347

     1774    10342    3       CASE(%UNDEF#,%VARIABLE#,%FIXED#);

     1775    10343    3         F$DCB.TAPTYP.RWASC = %YES#;       /* Read/write in ASCII mode           */

  10343  2 005426   000400 236003                    LDQ     256,DU
         2 005427   000067 256100                    ORSQ    55,,PR0
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:240  

     1776    10344    3         F$DCB.TAPTYP.CP6F = %NO#;         /* Not a CP-6 format                  */

  10344  2 005430   000025 236000 3                  LDQ     21
         2 005431   000067 356100                    ANSQ    55,,PR0

     1777    10345    3         F$DCB.TYPE = '  ';                /* No type                            */

  10345  2 005432   000064 220000 1                  LDX0    E_NOFILE+16
         2 005433   000025 440100                    SXL0    21,,PR0
         2 005434   005457 710000 2                  TRA     s:10355

     1778    10346    3       CASE( %RESTRICT# );

     1779    10347    3         F$DCB.TAPTYP.RWASC = %NO#;

  10347  2 005435   000052 236000 3                  LDQ     42
         2 005436   000067 356100                    ANSQ    55,,PR0

     1780    10348    3         F$DCB.TAPTYP.CP6F = ~ NO_IFPARAM_RESTRICT;

  10348  2 005437   200020 236100                    LDQ     NO_IFPARAM_RESTRICT,,AUTO
         2 005440   400000 376003                    ANQ     -131072,DU
         2 005441   400000 676003                    ERQ     -131072,DU
         2 005442   000012 772000                    QRL     10
         2 005443   000067 676100                    ERQ     55,,PR0
         2 005444   000200 376003                    ANQ     128,DU
         2 005445   000067 656100                    ERSQ    55,,PR0

     1781    10349    3         F$DCB.EBCDIC = %NO#;

  10349  2 005446   000005 236000 3                  LDQ     5
         2 005447   000031 356100                    ANSQ    25,,PR0

     1782    10350    3         F$DCB.CNVRT = %NO#;

  10350  2 005450   000022 236000 3                  LDQ     18
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:241  
         2 005451   000031 356100                    ANSQ    25,,PR0
         2 005452   005457 710000 2                  TRA     s:10355

     1783    10351    3       CASE(ELSE);

     1784    10352    3         F$DCB.TAPTYP.RWASC = %NO#;        /* Read/write binary                  */

  10352  2 005453   000052 236000 3                  LDQ     42
         2 005454   000067 356100                    ANSQ    55,,PR0

     1785    10353    3         F$DCB.TAPTYP.CP6F = %YES#;        /* CP-6 format                        */

  10353  2 005455   000200 236003                    LDQ     128,DU
         2 005456   000067 256100                    ORSQ    55,,PR0

     1786    10354    3       END;

     1787    10355    3      DO CASE(F$DCB.ORG);

  10355  2 005457   000032 236100                    LDQ     26,,PR0
         2 005460   000033 772000                    QRL     27
         2 005461   000024 116007                    CMPQ    20,DL
         2 005462   005464 602006 2                  TNC     s:10355+5,QL
         2 005463   005513 710000 2                  TRA     s:10359
         2 005464   005513 710000 2                  TRA     s:10359
         2 005465   005513 710000 2                  TRA     s:10359
         2 005466   005513 710000 2                  TRA     s:10359
         2 005467   005510 710000 2                  TRA     s:10357
         2 005470   005513 710000 2                  TRA     s:10359
         2 005471   005513 710000 2                  TRA     s:10359
         2 005472   005513 710000 2                  TRA     s:10359
         2 005473   005510 710000 2                  TRA     s:10357
         2 005474   005513 710000 2                  TRA     s:10359
         2 005475   005513 710000 2                  TRA     s:10359
         2 005476   005513 710000 2                  TRA     s:10359
         2 005477   005513 710000 2                  TRA     s:10359
         2 005500   005513 710000 2                  TRA     s:10359
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:242  
         2 005501   005513 710000 2                  TRA     s:10359
         2 005502   005513 710000 2                  TRA     s:10359
         2 005503   005513 710000 2                  TRA     s:10359
         2 005504   005513 710000 2                  TRA     s:10359
         2 005505   005510 710000 2                  TRA     s:10357
         2 005506   005510 710000 2                  TRA     s:10357
         2 005507   005510 710000 2                  TRA     s:10357

     1788    10356    3       CASE(%UNDEF#,%RANDOM#,%RESTRICT#,%IDS#,%FREE#);

     1789    10357    3         F$DCB.TAPTYP.USRBUF = %YES#;      /* Read/write user buffer             */

  10357  2 005510   000100 236003                    LDQ     64,DU
         2 005511   000067 256100                    ORSQ    55,,PR0
         2 005512   005515 710000 2                  TRA     s:10361

     1790    10358    3       CASE(ELSE);

     1791    10359    3         F$DCB.TAPTYP.USRBUF = %NO#;       /* Read/write FPOOL buffer            */

  10359  2 005513   000053 236000 3                  LDQ     43
         2 005514   000067 356100                    ANSQ    55,,PR0

     1792    10360    3       END;

     1793    10361    3      DO CASE(F$DCB.ORG);

  10361  2 005515   000032 236100                    LDQ     26,,PR0
         2 005516   000033 772000                    QRL     27
         2 005517   000023 116007                    CMPQ    19,DL
         2 005520   005522 602006 2                  TNC     s:10361+5,QL
         2 005521   005600 710000 2                  TRA     s:10374
         2 005522   005600 710000 2                  TRA     s:10374
         2 005523   005557 710000 2                  TRA     s:10367
         2 005524   005552 710000 2                  TRA     s:10365
         2 005525   005545 710000 2                  TRA     s:10363
         2 005526   005571 710000 2                  TRA     s:10371
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:243  
         2 005527   005557 710000 2                  TRA     s:10367
         2 005530   005552 710000 2                  TRA     s:10365
         2 005531   005545 710000 2                  TRA     s:10363
         2 005532   005600 710000 2                  TRA     s:10374
         2 005533   005564 710000 2                  TRA     s:10369
         2 005534   005600 710000 2                  TRA     s:10374
         2 005535   005600 710000 2                  TRA     s:10374
         2 005536   005600 710000 2                  TRA     s:10374
         2 005537   005557 710000 2                  TRA     s:10367
         2 005540   005600 710000 2                  TRA     s:10374
         2 005541   005600 710000 2                  TRA     s:10374
         2 005542   005600 710000 2                  TRA     s:10374
         2 005543   005600 710000 2                  TRA     s:10374
         2 005544   005545 710000 2                  TRA     s:10363

     1794    10362    3       CASE(%RANDOM#,%IDS#,%RESTRICT#);

     1795    10363    3         F$DCB.IORG = %RANDOM#;

  10363  2 005545   000070 236100                    LDQ     56,,PR0
         2 005546   000054 376000 3                  ANQ     44
         2 005547   003000 276003                    ORQ     1536,DU
         2 005550   000070 756100                    STQ     56,,PR0
         2 005551   005604 710000 2                  TRA     s:10376

     1796    10364    3       CASE(%KEYED#,%INDEXED#);

     1797    10365    3         F$DCB.IORG = %KEYED#;

  10365  2 005552   000070 236100                    LDQ     56,,PR0
         2 005553   000054 376000 3                  ANQ     44
         2 005554   002000 276003                    ORQ     1024,DU
         2 005555   000070 756100                    STQ     56,,PR0
         2 005556   005604 710000 2                  TRA     s:10376

     1798    10366    3       CASE(%CONSEC#,%RELATIVE#,%IREL#);

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:244  
     1799    10367    3         F$DCB.IORG = %CONSEC#;

  10367  2 005557   000070 236100                    LDQ     56,,PR0
         2 005560   000054 376000 3                  ANQ     44
         2 005561   001000 276003                    ORQ     512,DU
         2 005562   000070 756100                    STQ     56,,PR0
         2 005563   005604 710000 2                  TRA     s:10376

     1800    10368    3       CASE(%SYMB#);

     1801    10369    3         F$DCB.IORG = %SYMB#;

  10369  2 005564   000070 236100                    LDQ     56,,PR0
         2 005565   000054 376000 3                  ANQ     44
         2 005566   011000 276003                    ORQ     4608,DU
         2 005567   000070 756100                    STQ     56,,PR0
         2 005570   005604 710000 2                  TRA     s:10376

     1802    10370    3       CASE(%UR#);

     1803    10371    3         F$DCB.IORG = %UR#;

  10371  2 005571   000070 236100                    LDQ     56,,PR0
         2 005572   000054 376000 3                  ANQ     44
         2 005573   004000 276003                    ORQ     2048,DU
         2 005574   000070 756100                    STQ     56,,PR0

     1804    10372    3         F$DCB.IFMT = FMTURFILE#;

  10372  2 005575   013000 236003                    LDQ     5632,DU
         2 005576   000103 552140                    STBQ    67,'40'O,PR0
         2 005577   005604 710000 2                  TRA     s:10376

     1805    10373    3       CASE(ELSE);

     1806    10374    3         F$DCB.IORG = %UNDEF#;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:245  
  10374  2 005600   000070 236100                    LDQ     56,,PR0
         2 005601   000054 376000 3                  ANQ     44
         2 005602   021000 276003                    ORQ     8704,DU
         2 005603   000070 756100                    STQ     56,,PR0

     1807    10375    3       END;

     1808    10376    2      F$DCB.DVBYTE.BIN = ~ F$DCB.TAPTYP.RWASC;

  10376  2 005604   000067 236100                    LDQ     55,,PR0
         2 005605   000011 736000                    QLS     9
         2 005606   400000 376003                    ANQ     -131072,DU
         2 005607   400000 676003                    ERQ     -131072,DU
         2 005610   000003 772000                    QRL     3
         2 005611   000003 676100                    ERQ     3,,PR0
         2 005612   040000 376003                    ANQ     16384,DU
         2 005613   000003 656100                    ERSQ    3,,PR0

     1809    10377
     1810    10378    2      RETURN;

  10378  2 005614   200040 221300                    LDX1  ! @LEN,,AUTO
         2 005615   000001 702211                    TSX2  ! 1,X1

     1811    10379
     1812    10380    2   END FTO_SETTAPTYP;
     1813    10381        /*********************************************************************/
     1814    10382        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:246  
     1815    10383        /*********************************************************************/
     1816    10384    1   FTO_GETSN: PROC ALTRET;

  10384  2 005616   200040 741300       FTO_GETSN    STX1  ! @LEN,,AUTO

     1817    10385        /*F*     NAME: FTO_GETSN
     1818    10386                 PURPOSE: Determine initial serial number.
     1819    10387         ***/
     1820    10388
     1821    10389        /********************/
     1822    10390
     1823    10391         /***
     1824    10392          *** Scratch mount implied if no SN.  Otherwise put SN list in
     1825    10393          *** the CFU area.
     1826    10394          ***/
     1827    10395
     1828    10396    2      IF F$DCB.PSN = ' '

  10396  2 005617   200016 470500                    LDP0    JDCB$,,AUTO
         2 005620   040000 106500                    CMPC    fill='040'O
         2 005621   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 005622   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 005623   005645 601000 2                  TNZ     s:10409

     1829    10397    3       THEN DO;                            /* Scratch SN                         */

     1830    10398    3         IF F$DCB.MAXVOL > 0

  10398  2 005624   000043 236100                    LDQ     35,,PR0
         2 005625   000777 316003                    CANQ    511,DU
         2 005626   005631 600000 2                  TZE     s:10401

     1831    10399    3          THEN F$DCB.MAXVOL = F$DCB.MAXVOL - 1;

  10399  2 005627   000777 036003                    ADLQ    511,DU
         2 005630   000043 552120                    STBQ    35,'20'O,PR0

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:247  
     1832    10400                                                /* Need at least one volume           */
     1833    10401    3         IF F$DCB.VOL > 1

  10401  2 005631   000043 236100                    LDQ     35,,PR0
         2 005632   777000 376003                    ANQ     -512,DU
         2 005633   002000 116003                    CMPQ    1024,DU
         2 005634   005642 602000 2                  TNC     s:10406

     1834    10402    4          THEN DO;                         /* Don't have specified volume        */

     1835    10403    4            B$JIT.ERR = E_VOLERR; /*E* ERROR: FTO-E$VOLERR */

  10403  2 005635   000041 236000 1                  LDQ     E_VOLERR
         2 005636   000000 471400 xsym               LDP1    B$JIT$
         2 005637   100012 756100                    STQ     10,,PR1

     1836    10404    4            ALTRETURN;

  10404  2 005640   200040 221300                    LDX1  ! @LEN,,AUTO
         2 005641   000000 702211                    TSX2  ! 0,X1

     1837    10405    4            END;
     1838    10406    3          ELSE F$DCB.VOL = 1;              /* At first volume                    */

  10406  2 005642   001000 236003                    LDQ     512,DU
         2 005643   000043 552140                    STBQ    35,'40'O,PR0

     1839    10407    3         END;

  10407  2 005644   005647 710000 2                  TRA     s:10411

     1840    10408    3       ELSE DO;

     1841    10409    3         CALL FTO_SNLIST ALTRET(JUSTALT);

  10409  2 005645   005653 701000 2                  TSX1    FTO_SNLIST
         2 005646   005651 702000 2                  TSX2    JUSTALT
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:248  

     1842    10410    3         END;

     1843    10411    2      RETURN;

  10411  2 005647   200040 221300                    LDX1  ! @LEN,,AUTO
         2 005650   000001 702211                    TSX2  ! 1,X1

  10409  2 005651                       JUSTALT      null
     1844    10412
     1845    10413    2   JUSTALT: ;
     1846    10414    2      ALTRETURN;

  10414  2 005651   200040 221300                    LDX1  ! @LEN,,AUTO
         2 005652   000000 702211                    TSX2  ! 0,X1

     1847    10415
     1848    10416    2   END FTO_GETSN;
     1849    10417        /*********************************************************************/
     1850    10418        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:249  
     1851    10419        /*********************************************************************/
     1852    10420    1   FTO_SNLIST: PROC ALTRET;

  10420  2 005653   200042 741300       FTO_SNLIST   STX1  ! IC,,AUTO

     1853    10421        /*F*    NAME: FTO_SNLIST
     1854    10422                PURPOSE: Merge user specified SN list into the DCB.
     1855    10423         ***/
     1856    10424
     1857    10425         /***
     1858    10426          *** AUTO data:
     1859    10427          ***/
     1860    10428
     1861    10429    2   DCL CFUX SBIN AUTO;                /* Offset from CFU base to current CFU     */
     1862    10430    2   DCL PCFU$ PTR AUTO;                     /* Pointer to previous CFU            */
     1863    10431    2   DCL PSN CHAR(6) AUTO;                   /* Test serial number                 */
     1864    10432    2   DCL SN$ PTR AUTO;                       /* Pointer to user specified SN list  */
     1865    10433    2   DCL JRNL_OFFSET SBIN AUTO;         /* JRNL SN list doesn't include first SN   */
     1866    10434        /********************/
     1867    10435
     1868    10436         /***
     1869    10437          *** Default begin at first volume.
     1870    10438          ***/
     1871    10439
     1872    10440    2      SN$ = PN$.SN_;                       /* Get pointer to SN list             */

  10440  2 005654   200003 470500                    LDP0    @PN$,,AUTO
         2 005655   000001 236100                    LDQ     1,,PR0
         2 005656   200047 756100                    STQ     SN$,,AUTO

     1873    10441    2      IF F$DCB.VOL <= 0 THEN F$DCB.VOL = 1; /* Default first SN                  */

  10441  2 005657   200016 471500                    LDP1    JDCB$,,AUTO
         2 005660   100043 236100                    LDQ     35,,PR1
         2 005661   777000 316003                    CANQ    -512,DU
         2 005662   005665 601000 2                  TNZ     s:10447

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:250  
  10441  2 005663   001000 236003                    LDQ     512,DU
         2 005664   100043 552140                    STBQ    35,'40'O,PR1

     1874    10442
     1875    10443         /***
     1876    10444          *** If no SN list is specified, only one vol exists.
     1877    10445          ***/
     1878    10446
     1879    10447    2      IF SN$ = ADDR(NIL)

  10447  2 005665   200047 236100                    LDQ     SN$,,AUTO
         2 005666   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 005667   005702 601000 2                  TNZ     s:10461

     1880    10448    3       THEN DO;                            /* No SN list                         */

     1881    10449    3         IF F$DCB.VOL = 1

  10449  2 005670   100043 236100                    LDQ     35,,PR1
         2 005671   777000 376003                    ANQ     -512,DU
         2 005672   001000 116003                    CMPQ    512,DU
         2 005673   005675 601000 2                  TNZ     s:10452

     1882    10450    3          THEN RETURN;                     /* Primary volume is selected volume  */

  10450  2 005674   000001 702211                    TSX2  ! 1,X1

     1883    10451    4          ELSE DO;

     1884    10452    4            B$JIT.ERR = E_VOLERR; /*E* ERROR: FTO-E$VOLERR */

  10452  2 005675   000041 236000 1                  LDQ     E_VOLERR
         2 005676   000000 473400 xsym               LDP3    B$JIT$
         2 005677   300012 756100                    STQ     10,,PR3

     1885    10453    4            ALTRETURN;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:251  
  10453  2 005700   200042 221300                    LDX1  ! IC,,AUTO
         2 005701   000000 702211                    TSX2  ! 0,X1

     1886    10454    4            END;
     1887    10455    3         END;
     1888    10456
     1889    10457         /***
     1890    10458          *** If no SN list and first vol, just return.
     1891    10459          ***/
     1892    10460
     1893    10461    2      I = SN$->VLP$SN_V.NUM;

  10461  2 005702   200047 473500                    LDP3    SN$,,AUTO
         2 005703   300000 235100                    LDA     0,,PR3
         2 005704   200014 755100                    STA     I,,AUTO

     1894    10462    2      IF F$DCB.ACS = %JRNL#

  10462  2 005705   100036 236100                    LDQ     30,,PR1
         2 005706   000777 376007                    ANQ     511,DL
         2 005707   000004 116007                    CMPQ    4,DL
         2 005710   005717 601000 2                  TNZ     s:10467

     1895    10463    3       THEN DO;                            /* Skip first SN if JRNL              */

     1896    10464    3         JRNL_OFFSET = 1;

  10464  2 005711   000001 235007                    LDA     1,DL
         2 005712   200050 755100                    STA     JRNL_OFFSET,,AUTO

     1897    10465    3         SN$ = PINCRC( SN$, 6 );

  10465  2 005713   200047 236100                    LDQ     SN$,,AUTO
         2 005714   000055 036000 3                  ADLQ    45
         2 005715   200047 756100                    STQ     SN$,,AUTO

     1898    10466    3         END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:252  

  10466  2 005716   005720 710000 2                  TRA     s:10468

     1899    10467    2       ELSE JRNL_OFFSET = 0;

  10467  2 005717   200050 450100                    STZ     JRNL_OFFSET,,AUTO

     1900    10468    2      I = I - JRNL_OFFSET;

  10468  2 005720   200014 236100                    LDQ     I,,AUTO
         2 005721   200050 136100                    SBLQ    JRNL_OFFSET,,AUTO
         2 005722   200014 756100                    STQ     I,,AUTO

     1901    10469    2      IF F$DCB.VOL = 1 AND I <= 0 THEN RETURN;

  10469  2 005723   100043 236100                    LDQ     35,,PR1
         2 005724   777000 376003                    ANQ     -512,DU
         2 005725   001000 116003                    CMPQ    512,DU
         2 005726   005732 601000 2                  TNZ     s:10475
         2 005727   200014 235100                    LDA     I,,AUTO
         2 005730   005732 605400 2                  TPNZ    s:10475

  10469  2 005731   000001 702211                    TSX2  ! 1,X1

     1902    10470
     1903    10471         /***
     1904    10472          *** Account for blank serial numbers at list end as DCB.MAXVOL.
     1905    10473          ***/
     1906    10474
     1907    10475    2      I = I - 1;                           /* Index of last SN                   */

  10475  2 005732   000001 336007                    LCQ     1,DL
         2 005733   200014 056100                    ASQ     I,,AUTO

     1908    10476    2      J = 0;                               /* Non-blank SN flag                  */

  10476  2 005734   200015 450100                    STZ     J,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:253  

     1909    10477    3      DO WHILE( I >= 0  AND  J = 0 );

  10477  2 005735   005756 710000 2                  TRA     s:10484

     1910    10478    3         IF SN$->VLP$SN_V.SN(I) = ' '

  10478  2 005736   200014 236100                    LDQ     I,,AUTO
         2 005737   000006 402007                    MPY     6,DL
         2 005740   200047 470500                    LDP0    SN$,,AUTO
         2 005741   040000 106506                    CMPC    fill='040'O
         2 005742   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
         2 005743   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 005744   005754 601000 2                  TNZ     s:10483

     1911    10479    4          THEN DO;

     1912    10480    4            F$DCB.MAXVOL = F$DCB.MAXVOL + 1;

  10480  2 005745   200016 471500                    LDP1    JDCB$,,AUTO
         2 005746   100043 236100                    LDQ     35,,PR1
         2 005747   000001 036003                    ADLQ    1,DU
         2 005750   100043 552120                    STBQ    35,'20'O,PR1

     1913    10481    4            I = I - 1;

  10481  2 005751   000001 336007                    LCQ     1,DL
         2 005752   200014 056100                    ASQ     I,,AUTO

     1914    10482    4            END;

  10482  2 005753   005756 710000 2                  TRA     s:10484

     1915    10483    3          ELSE J = 1;

  10483  2 005754   000001 235007                    LDA     1,DL
         2 005755   200015 755100                    STA     J,,AUTO
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:254  

     1916    10484    3         END;

  10484  2 005756   200014 235100                    LDA     I,,AUTO
         2 005757   005762 604000 2                  TMI     s:10486
         2 005760   200015 236100                    LDQ     J,,AUTO
         2 005761   005736 600000 2                  TZE     s:10478

     1917    10485
     1918    10486    2      I = I + 1;                           /* # SNs actually in list             */

  10486  2 005762   200014 054100                    AOS     I,,AUTO

     1919    10487
     1920    10488         /***
     1921    10489          *** If the initial volume number is greater than the number
     1922    10490          *** of volumes, error.
     1923    10491          ***/
     1924    10492
     1925    10493    2      IF F$DCB.VOL > I

  10493  2 005763   200016 470500                    LDP0    JDCB$,,AUTO
         2 005764   000043 236100                    LDQ     35,,PR0
         2 005765   000033 772000                    QRL     27
         2 005766   200014 116100                    CMPQ    I,,AUTO
         2 005767   005775 604400 2                  TMOZ    s:10503

     1926    10494    3       THEN DO;                            /* Initial volume not in list         */

     1927    10495    3         B$JIT.ERR = E_VOLERR; /*E* ERROR: FTO-E$VOLERR */

  10495  2 005770   000041 236000 1                  LDQ     E_VOLERR
         2 005771   000000 471400 xsym               LDP1    B$JIT$
         2 005772   100012 756100                    STQ     10,,PR1

     1928    10496    3         ALTRETURN;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:255  
  10496  2 005773   200042 221300                    LDX1  ! IC,,AUTO
         2 005774   000000 702211                    TSX2  ! 0,X1

     1929    10497    3         END;
     1930    10498
     1931    10499         /***
     1932    10500          *** Make sure no blank or duplicate SNs are in list.
     1933    10501          ***/
     1934    10502
     1935    10503    3      DO J = 0 TO I - 2;                   /* Which SN to compare                */

  10503  2 005775   200015 450100                    STZ     J,,AUTO
         2 005776   006043 710000 2                  TRA     s:10517+1

     1936    10504    3         PSN = SN$->VLP$SN_V.SN(J);

  10504  2 005777   200015 236100                    LDQ     J,,AUTO
         2 006000   000006 402007                    MPY     6,DL
         2 006001   200047 470500                    LDP0    SN$,,AUTO
         2 006002   040100 100506                    MLR     fill='040'O
         2 006003   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
         2 006004   200045 000006                    ADSC9   PSN,,AUTO                cn=0,n=6

     1937    10505    3         IF PSN = ' '

  10505  2 006005   040000 106500                    CMPC    fill='040'O
         2 006006   200045 000006                    ADSC9   PSN,,AUTO                cn=0,n=6
         2 006007   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 006010   006016 601000 2                  TNZ     s:10510

     1938    10506    4          THEN DO;                         /* Blank SN                           */

     1939    10507    4            B$JIT.ERR = E_BRDUPSN; /*E* ERROR: FTO-E$BRDUPSN */

  10507  2 006011   000023 236000 1                  LDQ     E_BRDUPSN
         2 006012   000000 471400 xsym               LDP1    B$JIT$
         2 006013   100012 756100                    STQ     10,,PR1
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:256  

     1940    10508    4            ALTRETURN;

  10508  2 006014   200042 221300                    LDX1  ! IC,,AUTO
         2 006015   000000 702211                    TSX2  ! 0,X1

     1941    10509    4            END;
     1942    10510    4         DO CFUX = J+1 TO I-1;

  10510  2 006016   200015 235100                    LDA     J,,AUTO
         2 006017   000001 035007                    ADLA    1,DL
         2 006020   200043 755100                    STA     CFUX,,AUTO
         2 006021   006037 710000 2                  TRA     s:10516+1

     1943    10511    4            IF PSN = SN$->VLP$SN_V.SN(CFUX)

  10511  2 006022   200043 236100                    LDQ     CFUX,,AUTO
         2 006023   000006 402007                    MPY     6,DL
         2 006024   200047 470500                    LDP0    SN$,,AUTO
         2 006025   040106 106500                    CMPC    fill='040'O
         2 006026   200045 000006                    ADSC9   PSN,,AUTO                cn=0,n=6
         2 006027   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
         2 006030   006036 601000 2                  TNZ     s:10516

     1944    10512    5             THEN DO;                      /* Duplicate SN                       */

     1945    10513    5               B$JIT.ERR = E_BRDUPSN; /*E* ERROR: FTO-E$BRDUPSN */

  10513  2 006031   000023 236000 1                  LDQ     E_BRDUPSN
         2 006032   000000 471400 xsym               LDP1    B$JIT$
         2 006033   100012 756100                    STQ     10,,PR1

     1946    10514    5               ALTRETURN;

  10514  2 006034   200042 221300                    LDX1  ! IC,,AUTO
         2 006035   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:257  
     1947    10515    5               END;
     1948    10516    4            END;

  10516  2 006036   200043 054100                    AOS     CFUX,,AUTO
         2 006037   200043 236100                    LDQ     CFUX,,AUTO
         2 006040   200014 116100                    CMPQ    I,,AUTO
         2 006041   006022 604000 2                  TMI     s:10511

     1949    10517    3         END;

  10517  2 006042   200015 054100                    AOS     J,,AUTO
         2 006043   200014 236100                    LDQ     I,,AUTO
         2 006044   000002 136007                    SBLQ    2,DL
         2 006045   200015 116100                    CMPQ    J,,AUTO
         2 006046   005777 605000 2                  TPL     s:10504

     1950    10518
     1951    10519         /***
     1952    10520          *** Current SN is that specified by DCB.VOL.
     1953    10521          ***/
     1954    10522
     1955    10523    2      F$DCB.PSN = SN$->VLP$SN_V.SN(F$DCB.VOL - 1);

  10523  2 006047   200016 470500                    LDP0    JDCB$,,AUTO
         2 006050   000043 236100                    LDQ     35,,PR0
         2 006051   000033 772000                    QRL     27
         2 006052   000006 402007                    MPY     6,DL
         2 006053   200047 471500                    LDP1    SN$,,AUTO
         2 006054   040100 100506                    MLR     fill='040'O
         2 006055   177777 400006                    ADSC9   -1,Q,PR1                 cn=2,n=6
         2 006056   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6

     1956    10524    2      IF I <= 1 THEN RETURN;               /* No CFUs needed                     */

  10524  2 006057   200014 235100                    LDA     I,,AUTO
         2 006060   000001 115007                    CMPA    1,DL
         2 006061   006064 605400 2                  TPNZ    s:10530
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:258  

  10524  2 006062   200042 221300                    LDX1  ! IC,,AUTO
         2 006063   000001 702211                    TSX2  ! 1,X1

     1957    10525
     1958    10526         /***
     1959    10527          *** Create CFU SN list linked to DCB.
     1960    10528          ***/
     1961    10529
     1962    10530    2      CALL FMR$G8(PCFU$,CFUX) ALTRET(NOCFUS);

  10530  2 006064   200043 633500                    EPPR3   CFUX,,AUTO
         2 006065   200053 453500                    STP3    JRNL_OFFSET+3,,AUTO
         2 006066   200044 634500                    EPPR4   PCFU$,,AUTO
         2 006067   200052 454500                    STP4    JRNL_OFFSET+2,,AUTO
         2 006070   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 006071   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 006072   000000 701000 xent               TSX1    FMR$G8
         2 006073   006221 702000 2                  TSX2    NOCFUS

     1963    10531    2      IF F$DCB.ACS = %JRNL#

  10531  2 006074   200016 470500                    LDP0    JDCB$,,AUTO
         2 006075   000036 236100                    LDQ     30,,PR0
         2 006076   000777 376007                    ANQ     511,DL
         2 006077   000004 116007                    CMPQ    4,DL
         2 006100   006105 601000 2                  TNZ     s:10533

     1964    10532    2       THEN F$DCB.CFU$->FM$CFUJ.SNLINKX = CFUX; /* Link to CFU already there     */

  10532  2 006101   000066 471500                    LDP1    54,,PR0
         2 006102   200043 720100                    LXL0    CFUX,,AUTO
         2 006103   100006 440100                    SXL0    6,,PR1
         2 006104   006107 710000 2                  TRA     s:10534

     1965    10533    2       ELSE F$DCB.CFU$ = PCFU$;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:259  
  10533  2 006105   200044 236100                    LDQ     PCFU$,,AUTO
         2 006106   000066 756100                    STQ     54,,PR0

     1966    10534    3      DO WHILE(I > 4);                     /* Process complete SN blocks         */

  10534  2 006107   200014 235100                    LDA     I,,AUTO
         2 006110   000004 115007                    CMPA    4,DL
         2 006111   006162 604400 2                  TMOZ    s:10545

     1967    10535    3         PCFU$->FT$CFUSN.SYSID = B$JIT.SYSID; /* Remember user info              */

  10535  2 006112   000000 470400 xsym               LDP0    B$JIT$
         2 006113   200044 471500                    LDP1    PCFU$,,AUTO
         2 006114   000100 100500                    MLR     fill='000'O
         2 006115   000000 400002                    ADSC9   0,,PR0                   cn=2,n=2
         2 006116   100007 000002                    ADSC9   7,,PR1                   cn=0,n=2

     1968    10536    3         PCFU$->FT$CFUSN.DCBX = JDCB.DCBX;

  10536  2 006117   200044 471500                    LDP1    PCFU$,,AUTO
         2 006120   000100 100500                    MLR     fill='000'O
         2 006121   200016 000002                    ADSC9   JDCB$,,AUTO              cn=0,n=2
         2 006122   100007 400002                    ADSC9   7,,PR1                   cn=2,n=2

     1969    10537    3         PCFU$->FT$CFUSN.NUM = 4;          /* 4 SNs in this CFU                  */

  10537  2 006123   200044 471500                    LDP1    PCFU$,,AUTO
         2 006124   000100 101400                    MRL     fill='000'O
         2 006125   000006 000004 xsym               ADSC9   B_VECTNIL+6              cn=0,n=4
         2 006126   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

     1970    10538    3         PCFU$->FOUR_SNS.SNS = SN$->FOUR_SNS.SNS; /* Move next 4 SNs             */

  10538  2 006127   200047 470500                    LDP0    SN$,,AUTO
         2 006130   200044 471500                    LDP1    PCFU$,,AUTO
         2 006131   040100 100500                    MLR     fill='040'O
         2 006132   000001 000030                    ADSC9   1,,PR0                   cn=0,n=24
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:260  
         2 006133   100001 000030                    ADSC9   1,,PR1                   cn=0,n=24

     1971    10539    3         CALL FMR$G8(TEMP$,CFUX) ALTRET(NOTENUFCFUS); /* Get next SN CFU         */

  10539  2 006134   200043 631500                    EPPR1   CFUX,,AUTO
         2 006135   200053 451500                    STP1    JRNL_OFFSET+3,,AUTO
         2 006136   200032 633500                    EPPR3   TEMP$,,AUTO
         2 006137   200052 453500                    STP3    JRNL_OFFSET+2,,AUTO
         2 006140   200052 630500                    EPPR0   JRNL_OFFSET+2,,AUTO
         2 006141   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 006142   000000 701000 xent               TSX1    FMR$G8
         2 006143   006216 702000 2                  TSX2    NOTENUFCFUS

     1972    10540    3         PCFU$->FT$CFUSN.LINKX = CFUX;     /* Link current CFU to last           */

  10540  2 006144   200044 470500                    LDP0    PCFU$,,AUTO
         2 006145   000100 101500                    MRL     fill='000'O
         2 006146   200043 000004                    ADSC9   CFUX,,AUTO               cn=0,n=4
         2 006147   000000 400002                    ADSC9   0,,PR0                   cn=2,n=2

     1973    10541    3         PCFU$ = TEMP$;                    /* Make current CFU previous          */

  10541  2 006150   200032 236100                    LDQ     TEMP$,,AUTO
         2 006151   200044 756100                    STQ     PCFU$,,AUTO

     1974    10542    3         SN$ = PINCRW( SN$, 6 );           /* Point to next group of 4 SNs       */

  10542  2 006152   200047 236100                    LDQ     SN$,,AUTO
         2 006153   000006 036003                    ADLQ    6,DU
         2 006154   200047 756100                    STQ     SN$,,AUTO

     1975    10543    3         I = I - 4;                        /* Processed 4 more                   */

  10543  2 006155   000004 336007                    LCQ     4,DL
         2 006156   200014 056100                    ASQ     I,,AUTO

     1976    10544    3         END;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:261  

  10544  2 006157   200014 235100                    LDA     I,,AUTO
         2 006160   000004 115007                    CMPA    4,DL
         2 006161   006112 605400 2                  TPNZ    s:10535

     1977    10545    2      PCFU$->FT$CFUSN.SYSID = B$JIT.SYSID; /* Remember user info                 */

  10545  2 006162   000000 470400 xsym               LDP0    B$JIT$
         2 006163   200044 471500                    LDP1    PCFU$,,AUTO
         2 006164   000100 100500                    MLR     fill='000'O
         2 006165   000000 400002                    ADSC9   0,,PR0                   cn=2,n=2
         2 006166   100007 000002                    ADSC9   7,,PR1                   cn=0,n=2

     1978    10546    2      PCFU$->FT$CFUSN.DCBX = JDCB.DCBX;

  10546  2 006167   200044 471500                    LDP1    PCFU$,,AUTO
         2 006170   000100 100500                    MLR     fill='000'O
         2 006171   200016 000002                    ADSC9   JDCB$,,AUTO              cn=0,n=2
         2 006172   100007 400002                    ADSC9   7,,PR1                   cn=2,n=2

     1979    10547    2      PCFU$->FT$CFUSN.NUM = I;             /* Set # SNs in last CFU              */

  10547  2 006173   200044 471500                    LDP1    PCFU$,,AUTO
         2 006174   000100 101500                    MRL     fill='000'O
         2 006175   200014 000004                    ADSC9   I,,AUTO                  cn=0,n=4
         2 006176   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

     1980    10548    3      DO WHILE (I >= 1);

  10548  2 006177   200014 235100                    LDA     I,,AUTO
         2 006200   006214 604400 2                  TMOZ    s:10552

     1981    10549    3         I = I - 1;                        /* Convert # to index                 */

  10549  2 006201   000001 336007                    LCQ     1,DL
         2 006202   200014 056100                    ASQ     I,,AUTO

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:262  
     1982    10550    3         PCFU$->FT$CFUSN.SN(I) = SN$->VLP$SN_V.SN(I);

  10550  2 006203   200014 236100                    LDQ     I,,AUTO
         2 006204   000006 402007                    MPY     6,DL
         2 006205   200047 470500                    LDP0    SN$,,AUTO
         2 006206   200044 471500                    LDP1    PCFU$,,AUTO
         2 006207   040106 100506                    MLR     fill='040'O
         2 006210   000001 000006                    ADSC9   1,Q,PR0                  cn=0,n=6
         2 006211   100001 000006                    ADSC9   1,Q,PR1                  cn=0,n=6

     1983    10551    3         END;

  10551  2 006212   200014 235100                    LDA     I,,AUTO
         2 006213   006201 605400 2                  TPNZ    s:10549

     1984    10552    2      RETURN;

  10552  2 006214   200042 221300                    LDX1  ! IC,,AUTO
         2 006215   000001 702211                    TSX2  ! 1,X1

     1985    10553
     1986    10554         /***
     1987    10555          *** Not enough CFUs were available.
     1988    10556          ***/
     1989    10557
     1990    10558    2   NOTENUFCFUS:
     1991    10559    2      CALL FTR$RELCFUS;

  10559  2 006216   000002 631400 xsym  NOTENUFCFUS  EPPR1   B_VECTNIL+2
         2 006217   000000 701000 xent               TSX1    FTR$RELCFUS
         2 006220   000000 011000                    NOP     0

     1992    10560
     1993    10561    2   NOCFUS:
     1994    10562           /*E* ERROR: FTO-E$NOCFUS */
     1995    10563    2      B$JIT.ERR = E_NOCFUS;

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:263  
  10563  2 006221   000031 236000 1     NOCFUS       LDQ     E_NOCFUS
         2 006222   000000 470400 xsym               LDP0    B$JIT$
         2 006223   000012 756100                    STQ     10,,PR0

     1996    10564    2      ALTRETURN;

  10564  2 006224   200042 221300                    LDX1  ! IC,,AUTO
         2 006225   000000 702211                    TSX2  ! 0,X1

     1997    10565
     1998    10566    2   END FTO_SNLIST;
     1999    10567        %EJECT;
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:264  
     2000    10568        /***************************************************************/
     2001    10569    1   FTO$SNLIST: ENTRY(PN$);

  10569  2 006226   000000 700200 xent  FTO$SNLIST   TSX0  ! X66_AUTO_1
         2 006227   000060 000001                    ZERO    48,1

     2002    10570        /*F*  NAME: FTO$SNLIST
     2003    10571              PURPOSE:  Provide external entry to FTO_SNLIST for OD use.
     2004    10572        */
     2005    10573
     2006    10574    1      JDCB$ = B$JIT.DCB$;

  10574  2 006230   000000 470400 xsym               LDP0    B$JIT$
         2 006231   000232 236100                    LDQ     154,,PR0
         2 006232   200016 756100                    STQ     JDCB$,,AUTO

     2007    10575    1      CALL FTO_SNLIST;

  10575  2 006233   005653 701000 2                  TSX1    FTO_SNLIST
         2 006234   000000 011000                    NOP     0

     2008    10576    1      RETURN;

  10576  2 006235   000000 702200 xent               TSX2  ! X66_ARET

FT_DENS
 Sect OctLoc
   1     000   000000 000000   100000 200000   400000 040000   000000 ******    ....@..... .....

FT_FORMAT
 Sect OctLoc
   1     004   104123 126106   125*** ******                                    DSVFU...

FT_CP6FMT
 Sect OctLoc
   1     006   103113 122130   170106 111104   125123 151***                    CKRXxFIDUSi.

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:265  
FT_CP6FMTORG
 Sect OctLoc
   1     011   001002 003022   022005 006007   004011 015***                    ............

FPT_PFIL_EOF
 Sect OctLoc
   1     014   000001 777640   000016 006000   000000 000000   000000 000000    ................

E_ASCIITAP
 Sect OctLoc
   1     020   062417 413352                                                    2...

E_BADFSN
 Sect OctLoc
   1     021   062417 413122                                                    2..R

(unnamed)
 Sect OctLoc
   1     022   062417 400032                                                    2...

E_BRDUPSN
 Sect OctLoc
   1     023   062417 412772                                                    2...

E_BLKL
 Sect OctLoc
   1     024   062417 413552                                                    2...

E_EBCDICTAP
 Sect OctLoc
   1     025   062417 413342                                                    2...

E_EOSET
 Sect OctLoc
   1     026   062417 413142                                                    2..b

E_FUNNYPOS
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:266  
 Sect OctLoc
   1     027   062417 413312                                                    2...

E_NOACCESS
 Sect OctLoc
   1     030   062417 401642                                                    2...

E_NOCFUS
 Sect OctLoc
   1     031   062417 401572                                                    2...

(unnamed)
 Sect OctLoc
   1     032   062417 413362                                                    2...

E_NOFIDTHIS
 Sect OctLoc
   1     033   062417 413112                                                    2..J

E_NOFPOOL
 Sect OctLoc
   1     034   062417 413202                                                    2...

E_NORESTRICT
 Sect OctLoc
   1     035   062417 413012                                                    2...

E_NOSN
 Sect OctLoc
   1     036   062417 413062                                                    2..2

E_NOTFREEORG
 Sect OctLoc
   1     037   062417 413032                                                    2...

E_SCRORDER
 Sect OctLoc
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:267  
   1     040   062417 413422                                                    2...

E_VOLERR
 Sect OctLoc
   1     041   062417 413262                                                    2...

E_WRONGSN
 Sect OctLoc
   1     042   062417 413172                                                    2..z

E_WRONGDENSITY
 Sect OctLoc
   1     043   062417 413522                                                    2...

E_NOFILE
 Sect OctLoc
   1     044   062414 401612                                                    2...

(unnamed)
 Sect OctLoc
   1     045   115124 040040   114124 040040   106124 040040   071071 063066    MT  LT  FT  9936
   1     051   065040 040040   071071 063066   064040 040040   060060 060060    5   99364   0000
   1     055   061040 040040   110104 122040   125110 114040   200000 000000    1   HDR UHL ....
   1     061   103120 055066   110104 122062   110104 122061   040040 040040    CP-6HDR2HDR1

(unnamed)
 Sect OctLoc
   3     000   637777 777777   000000 000100   000001 006000   777737 777777    .......@........
   3     004   777777 777775   777777 677777   777777 777737   077777 777777    ............?...
   3     010   777777 777763   777773 777777   777777 777617   000003 006000    ................
   3     014   000003 006000   000003 006000   000006 006000   000014 006000    ................
   3     020   777777 757777   777777 777577   777777 577777   777777 377777    ................
   3     024   777777 773777   777577 777777   040040 040000   000040 753000    ........   .. ..
   3     030   000003 400000   000056 006000   000057 006000   000000 000200    ........./......
   3     034   000007 770000   000002 006000   777767 777777   007777 770000    ................
   3     040   777777 777767   777777 777773   000007 777770   000007 006000    ................
   3     044   000012 400000   017777 777777   770003 777777   777774 001777    ................
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:268  
   3     050   777777 776000   001777 777777   777377 777777   777677 777777    ................
   3     054   700777 777777   000001 400000                                    ........
     2009    10577
     2010    10578        /*********************************************************************/
     2011    10579    1   END FTO$OPNAT;
     2012    10580        /*********************************************************************/

PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:269  
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FT_SUBS.:E05TOU  is referenced.
   FT$RECS.:E05TOU  cannot be made into a system file and is referenced.
   FT$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FT$DDT.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   FM$CFU.:E05TOU  is referenced.
   FM_BUF_R.:E05TOU  cannot be made into a system file and is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FTO$OPNAT.
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:270  

 **** Variables and constants ****

  ****  Section 001 RoData FTO$OPNAT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    20-0-0/b STRC        r     1 E_ASCIITAP                21-0-0/b STRC        r     1 E_BADFSN
    24-0-0/b STRC        r     1 E_BLKL                    23-0-0/b STRC        r     1 E_BRDUPSN
    25-0-0/b STRC        r     1 E_EBCDICTAP               26-0-0/b STRC        r     1 E_EOSET
    27-0-0/b STRC        r     1 E_FUNNYPOS                30-0-0/b STRC        r     1 E_NOACCESS
    31-0-0/b STRC        r     1 E_NOCFUS                  33-0-0/b STRC        r     1 E_NOFIDTHIS
    44-0-0/b STRC        r     1 E_NOFILE                  34-0-0/b STRC        r     1 E_NOFPOOL
    35-0-0/b STRC        r     1 E_NORESTRICT              36-0-0/b STRC        r     1 E_NOSN
    37-0-0/b STRC        r     1 E_NOTFREEORG              40-0-0/b STRC        r     1 E_SCRORDER
    41-0-0/b STRC        r     1 E_VOLERR                  43-0-0/b STRC        r     1 E_WRONGDENSITY
    42-0-0/b STRC        r     1 E_WRONGSN                 14-0-0/d STRC(144)   r     1 FPT_PFIL_EOF
     6-0-0/b UBIN(9)     r     1 FT_CP6FMT(0:10)
    11-0-0/b UBIN(9)     r     1 FT_CP6FMTORG(0:10)
     0-0-0/b BIT (18)    r     1 FT_DENS(0:6)
     4-0-0/b UBIN(9)     r     1 FT_FORMAT(0:4)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    40-0-0/w PTR         r     1 @LEN                       3-0-0/w PTR         r     1 @PN$
    37-0-0/w PTR         r     1 @STRING                    4-0-0/w PTR         r     1 AFPOOL$
     5-0-0/c CHAR(3)     r     1 ALABEL                     6-0-0/w SBIN        r     1 BACKUP_FM_CNT
    43-0-0/w SBIN        r     1 CFUX                       7-0-0/b BIT         r     1 CREATED_BY_CP6
    10-0-0/w UBIN        r     1 CREATE_DATE_UTS           11-0-0/b BIT         r     1 CREATE_OLDFILE
    12-0-0/w PTR         r     1 DDDT$                     13-0-0/w STRC        r     1 ERRSAV
    21-0-0/w CHAR(31)    r     1 FILE_NAME                 31-0-0/w SBIN        r     1 FILE_SEQ
    14-0-0/w SBIN        r     1 I                         42-0-0/w SBIN        r     1 IC
    41-0-0/w SBIN        r     1 IX                        15-0-0/w SBIN        r     1 J
    16-0-0/w STRC        r     1 JDCB                      16-0-0/w PTR         r     1 JDCB$
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:271  
    50-0-0/w SBIN        r     1 JRNL_OFFSET               *0-0-0/w UBIN        r     1 LEN
    17-0-0/w SBIN        r     1 MAXBLKL                   20-0-0/b BIT         r     1 NO_IFPARAM_RESTRICT
    44-0-0/w PTR         r     1 PCFU$                     *0-0-0/w STRC(684)   r     1 PN$
    45-0-0/c CHAR(6)     r     1 PSN                       47-0-0/w PTR         r     1 SN$
    *0-0-0/c ACHR        r     1 STRING                    32-0-0/w PTR         r     1 TEMP$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 FM$BUF$(0:31)
     0-0-0/w SBIN        r     1 FT_PROT                    0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(135)   r     1 CODE02
     0-0-0/w STRC(324)   r     1 CODE03                     0-0-0/w STRC(396)   r     1 CODE04
     0-0-0/w STRC(1404)  r     1 CODE16                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFUJ                    0-0-0/w STRC(1116)  r     1 FM$FIT
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/c STRC(252)   r     1 FOUR_SNS
     0-0-0/d STRC(756)   r     1 FPT$OPEN_V                 0-0-0/c STRC(720)   r     1 FT$ANYLBL
     0-0-0/c STRC(288)   r     1 FT$CFUSN                   0-0-0/w STRC(288)   r     1 FT$DDT
     0-0-0/c STRC        r     1 FT$HDR                     0-0-0/c ASTR(9)     r     1 FT$KEY
     0-0-0/c STRC(720)   r     1 FT$LBL1                    0-0-0/c STRC(720)   r     1 FT$LBL2
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/d STRC(90)    r     1 VLP$SN_V


   Procedure FTO$OPNAT requires 3230 words for executable code.
   Procedure FTO$OPNAT requires 48 words of local(AUTO) storage.
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:272  

    No errors detected in file FTO$OPNAT.:E05TSI    .
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:273  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:274  
          MINI XREF LISTING

AFPOOL$
      8515**DCL     10000<<ASSIGN  10002>>IF      10006>>CALLBLT 10008>>CALLBLT 10013>>ASSIGN  10019>>ASSIGN
     10160>>IF      10161>>IF      10162>>CALL    10163>>CALL    10179<>CALL    10186>>ASSIGN  10186>>ASSIGN
     10187>>ASSIGN  10236<<ASSIGN  10238<>CALL    10239>>ASSIGN  10240>>ASSIGN  10256<<ASSIGN  10258<>CALL
     10259>>ASSIGN  10272<<ASSIGN  10273>>ASSIGN  10274>>ASSIGN  10275>>ASSIGN  10276>>ASSIGN  10277>>ASSIGN
     10278>>ASSIGN  10279>>ASSIGN  10279>>ASSIGN  10288>>ASSIGN  10288>>ASSIGN
ALABEL
      8516**DCL      9379<<ASSIGN   9380<>CALL     9905<<ASSIGN   9906<>CALL
ATTEMPT_OPEN_EXISTING IN PROCEDURE FTO_OPNEXISTING
      9862**LABEL   10210--GOTO
B$JIT.ACCN
       343**DCL      9472>>ASSIGN
B$JIT.DCB$
       440**DCL      8947>>ASSIGN  10574>>ASSIGN
B$JIT.DEFEXP
       440**DCL      9461>>ASSIGN
B$JIT.ERR
       343**DCL      9082>>IF       9121<<ASSIGN   9170<<ASSIGN   9212<<ASSIGN   9214<<ASSIGN   9301<<ASSIGN
      9327<<ASSIGN   9368<<ASSIGN   9402<<ASSIGN   9420<<ASSIGN   9421<<ASSIGN   9433<<ASSIGN   9545>>ASSIGN
      9562>>ASSIGN   9565<<ASSIGN   9605<<ASSIGN   9612<<ASSIGN   9672<<ASSIGN   9829<<ASSIGN   9845<<ASSIGN
      9850<<ASSIGN   9879<<ASSIGN   9881<<ASSIGN   9891<<ASSIGN   9965<<ASSIGN  10197<<ASSIGN  10201<<ASSIGN
     10202>>IF      10204>>ASSIGN  10205<<ASSIGN  10207<<ASSIGN  10301>>ASSIGN  10304<<ASSIGN  10403<<ASSIGN
     10452<<ASSIGN  10495<<ASSIGN  10507<<ASSIGN  10513<<ASSIGN  10563<<ASSIGN
B$JIT.ERR.CODE
       344**DCL      8987>>IF       9543>>IF      10295>>IF
B$JIT.ERR.MID
       344**DCL       344--REDEF
B$JIT.FBUL
       432**DCL      9609>>ASSIGN  10200>>IF
B$JIT.JRESPEAK
       434**DCL       435--REDEF
B$JIT.PRIV.ACTIVE
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:275  
       344**DCL      9670>>IF      10195>>IF
B$JIT.SYSID
       343**DCL     10535>>ASSIGN  10545>>ASSIGN
B$JIT.USER
       343**DCL      9046>>ASSIGN
B$JIT$
      8486**DCL       338--IMP-PTR  8947>>ASSIGN   8987>>IF       9046>>ASSIGN   9082>>IF       9121>>ASSIGN
      9170>>ASSIGN   9212>>ASSIGN   9214>>ASSIGN   9301>>ASSIGN   9327>>ASSIGN   9368>>ASSIGN   9402>>ASSIGN
      9420>>ASSIGN   9421>>ASSIGN   9433>>ASSIGN   9461>>ASSIGN   9472>>ASSIGN   9543>>IF       9545>>ASSIGN
      9562>>ASSIGN   9565>>ASSIGN   9605>>ASSIGN   9609>>ASSIGN   9612>>ASSIGN   9670>>IF       9672>>ASSIGN
      9829>>ASSIGN   9845>>ASSIGN   9850>>ASSIGN   9879>>ASSIGN   9881>>ASSIGN   9891>>ASSIGN   9965>>ASSIGN
     10195>>IF      10197>>ASSIGN  10200>>IF      10201>>ASSIGN  10202>>IF      10204>>ASSIGN  10205>>ASSIGN
     10207>>ASSIGN  10295>>IF      10301>>ASSIGN  10304>>ASSIGN  10403>>ASSIGN  10452>>ASSIGN  10495>>ASSIGN
     10507>>ASSIGN  10513>>ASSIGN  10535>>ASSIGN  10545>>ASSIGN  10563>>ASSIGN  10574>>ASSIGN
BACKUP_FM_CNT
      8517**DCL      9483<<ASSIGN   9495<<ASSIGN   9513<<ASSIGN   9536>>IF       9546>>ASSIGN
BADDATE IN PROCEDURE FTO_OPNEXISTING
     10166**LABEL   10162--CALLALT
CFUX IN PROCEDURE FTO_SNLIST
     10429**DCL     10510<<DOINDEX 10511>>IF      10530<>CALL    10532>>ASSIGN  10539<>CALL    10540>>ASSIGN
CHKERR
      8986**LABEL    8983--CALLALT
CHKVOLOUT IN PROCEDURE FTO_CREATEOPEN
      9536**LABEL    9538--CALLALT
CLOSEFILE
      9090**LABEL    9090--CALLALT
CLSTAP IN PROCEDURE FTO_CREATEOPEN
      9551**LABEL    9369--GOTO     9380--CALLALT  9389--CALLALT  9403--GOTO     9422--GOTO     9434--GOTO
      9437--CALLALT  9447--CALLALT  9474--CALLALT  9485--CALLALT  9486--CALLALT  9492--CALLALT  9494--CALLALT
      9512--CALLALT  9547--CALLALT  9549--CALLALT  9550--CALLALT  9552--CALLALT
CLSTAP IN PROCEDURE FTO_OPNDEV
      9249**LABEL    9171--GOTO     9193--CALLALT  9195--CALLALT  9215--GOTO     9226--CALLALT
CLSTAP IN PROCEDURE FTO_OPNEXISTING
     10295**LABEL    9882--GOTO     9892--GOTO     9906--CALLALT  9920--CALLALT  9955--CALLALT  9966--GOTO
     10022--CALLALT 10035--CALLALT 10146--CALLALT 10150--CALLALT 10179--CALLALT 10183--CALLALT 10270--CALLALT
CLSTAPERR IN PROCEDURE FTO_CREATEOPEN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:276  
      9562**LABEL    9554--GOTO
CLSTAPERR IN PROCEDURE FTO_OPNEXISTING
     10301**LABEL   10226--GOTO
CODE02.KEYL
      7579**DCL     10240>>ASSIGN
CODE02.KEYX
      7579**DCL     10239>>ASSIGN
CODE03.TYPE
      7584**DCL     10259>>ASSIGN
CODE04
      7591**DCL     10276--ASSIGN  10277--ASSIGN  10287--ASSIGN
CODE04.ACCESS.TIME
      7593**DCL     10280<<ASSIGN
CODE04.CREATION.TIME
      7593**DCL     10282<<ASSIGN
CODE04.CREATOR
      7593**DCL     10286<<ASSIGN
CODE04.GAC.N
      7594**DCL     10284<<ASSIGN
CODE04.GAC.TIME
      7594**DCL     10285<<ASSIGN
CODE04.MODIFY.TIME
      7593**DCL     10281<<ASSIGN
CODE04.SVMODIFY.TIME
      7594**DCL     10283<<ASSIGN
CODE16.ATTR
      7597**DCL      9351>>ASSIGN
CONSECORG IN PROCEDURE FTO_CHK_BLKL_RECL
      9692**LABEL    9626--GOTO
CREATED_BY_CP6
      8518**DCL     10003<<ASSIGN  10004<<ASSIGN  10056>>IF
CREATE_DATE_UTS
      8519**DCL     10163<>CALL    10166<>CALL    10168<>CALL    10280>>ASSIGN  10281>>ASSIGN  10282>>ASSIGN
CREATE_OLDFILE
      8520**DCL      8968<<ASSIGN   8984<<ASSIGN   9088>>IF
DDDT$
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:277  
      8521**DCL      7675--IMP-PTR  9036>>ASSIGN   9151<<ASSIGN   9158>>IF       9158>>IF       9159>>ASSIGN
      9164>>IF       9164>>IF       9183>>IF       9186>>ASSIGN   9187>>ASSIGN   9190>>ASSIGN   9191>>IF
      9192>>ASSIGN   9196>>ASSIGN   9197>>ASSIGN   9197>>ASSIGN   9207>>IF       9208>>ASSIGN   9210>>IF
      9211>>IF       9224>>IF       9353<<ASSIGN   9354>>ASSIGN   9365>>IF       9365>>IF       9377>>IF
      9378>>ASSIGN   9381<<ASSIGN   9390<<ASSIGN   9399>>IF       9399>>IF       9399>>IF       9411>>IF
      9413>>ASSIGN   9417>>IF       9419>>IF       9424>>ASSIGN   9438<<ASSIGN   9455>>IF       9455>>IF
      9463>>ASSIGN   9466>>CALL     9467>>IF       9468>>ASSIGN   9471>>ASSIGN   9472>>ASSIGN   9473>>IF
      9487>>ASSIGN   9488>>ASSIGN   9496>>ASSIGN   9553>>ASSIGN   9867<<ASSIGN   9876>>IF       9876>>IF
      9876>>IF       9885>>ASSIGN   9890>>IF       9890>>IF       9895>>IF       9903>>IF       9904>>ASSIGN
      9907<<ASSIGN   9910>>ASSIGN   9911>>IF       9912>>ASSIGN   9930>>ASSIGN   9963>>ASSIGN   9975>>IF
      9983>>ASSIGN   9998<<ASSIGN   9999>>ASSIGN  10005>>ASSIGN  10010>>ASSIGN  10020>>IF      10024>>ASSIGN
     10141>>IF      10152>>ASSIGN  10297<<ASSIGN  10298>>ASSIGN
ERRSAV
      8534**DCL      9545<<ASSIGN   9562<<ASSIGN   9565>>ASSIGN  10204<<ASSIGN  10216<<ASSIGN  10301<<ASSIGN
     10304>>ASSIGN
ERRSAV.ERR#
      8564**DCL     10208>>IF      10212>>IF
E_ASCIITAP
      8644**DCL      9214>>ASSIGN   9421>>ASSIGN
E_BADFSN
      8659**DCL      9433>>ASSIGN
E_BLKL
      8703**DCL      9301>>ASSIGN
E_BRDUPSN
      8688**DCL     10507>>ASSIGN  10513>>ASSIGN
E_EBCDICTAP
      8716**DCL      9212>>ASSIGN   9420>>ASSIGN
E_EOSET
      8731**DCL      9965>>ASSIGN
E_FUNNYPOS
      8745**DCL      9402>>ASSIGN
E_NOACCESS
      8760**DCL     10216>>ASSIGN
E_NOCFUS
      8773**DCL     10563>>ASSIGN
E_NOFIDTHIS
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:278  
      8804**DCL      9845>>ASSIGN   9850>>ASSIGN
E_NOFILE
      8933**DCL      9879>>ASSIGN
E_NOFPOOL
      8819**DCL      9612>>ASSIGN  10201>>ASSIGN
E_NORESTRICT
      8833**DCL      9672>>ASSIGN  10197>>ASSIGN
E_NOSN
      8847**DCL      9121>>ASSIGN   9327>>ASSIGN   9829>>ASSIGN
E_NOTFREEORG
      8861**DCL      9605>>ASSIGN
E_SCRORDER
      8875**DCL      9368>>ASSIGN
E_VOLERR
      8891**DCL     10403>>ASSIGN  10452>>ASSIGN  10495>>ASSIGN
E_WRONGDENSITY
      8922**DCL      9170>>ASSIGN   9891>>ASSIGN
E_WRONGSN
      8907**DCL      9881>>ASSIGN
F$DCB.ACS
      6876**DCL      8948>>IF       8969>>IF       8971<<ASSIGN   8972<<ASSIGN   8976>>IF       9000>>IF
      9034>>IF       9040>>IF       9075>>IF      10084<<ASSIGN  10462>>IF      10531>>IF
F$DCB.ACTPOS
      6884**DCL      6884--REDEF
F$DCB.AFTRBLK
      6891**DCL      9019<<ASSIGN   9482<<ASSIGN
F$DCB.ANSISPANSEQ
      6886**DCL      9224>>IF       9310>>IF       9895>>IF
F$DCB.ARS
      6859**DCL      6859--REDEF    9510<<ASSIGN   9546<<ASSIGN   9548<<ASSIGN   9551<<ASSIGN   9914<<ASSIGN
      9954<<ASSIGN  10028>>IF      10034<<ASSIGN  10149<<ASSIGN  10178<<ASSIGN  10182<<ASSIGN  10185>>IF
F$DCB.ASN
      6874**DCL      8973>>IF       9065>>IF       9140>>IF       9165>>IF       9185<<ASSIGN   9189<<ASSIGN
      9588>>IF
F$DCB.ATTR
      6877**DCL      6878--REDEF    9147<<ASSIGN   9148<<ASSIGN   9164>>IF       9346<<ASSIGN   9347<<ASSIGN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:279  
      9351<<ASSIGN   9351>>ASSIGN   9860<<ASSIGN   9861<<ASSIGN   9890>>IF
F$DCB.BFR.BUFX
      6904**DCL      9505>>ASSIGN  10000>>ASSIGN
F$DCB.BFR.DA
      6904**DCL      9053<<ASSIGN
F$DCB.BFR1.SIZ
      6904**DCL      9506>>ASSIGN   9510>>ASSIGN
F$DCB.BLKL
      6874**DCL      9298>>IF       9638<<ASSIGN   9651>>IF       9653<<ASSIGN   9654<<ASSIGN   9655>>IF
      9656<<ASSIGN   9657>>IF       9658<<ASSIGN   9659<<ASSIGN   9659>>ASSIGN   9662<<ASSIGN   9665<<ASSIGN
      9665>>ASSIGN   9684>>IF       9685<<ASSIGN   9686<<ASSIGN   9686>>ASSIGN   9688<<ASSIGN   9706>>IF
      9707<<ASSIGN   9708>>IF       9709<<ASSIGN   9710<<ASSIGN   9710>>ASSIGN   9726>>IF       9727<<ASSIGN
      9728>>IF       9729<<ASSIGN   9730>>IF       9731<<ASSIGN   9733<<ASSIGN   9748>>IF       9749<<ASSIGN
      9750>>IF       9751<<ASSIGN   9752>>IF       9753<<ASSIGN   9755<<ASSIGN   9760>>IF       9761<<ASSIGN
      9762>>IF       9763<<ASSIGN   9764>>IF       9765<<ASSIGN   9769<<ASSIGN   9769>>ASSIGN   9788<<ASSIGN
     10043<<ASSIGN  10089<<ASSIGN  10089>>ASSIGN  10094<<ASSIGN  10099<<ASSIGN  10103>>IF      10132<<ASSIGN
     10200>>IF
F$DCB.BLKLEN
      6897**DCL      9028<<ASSIGN
F$DCB.BLOCKED
      6873**DCL      9630<<ASSIGN   9649>>IF       9690<<ASSIGN   9698<<ASSIGN   9724>>IF       9746>>IF
      9791<<ASSIGN  10048<<ASSIGN  10071<<ASSIGN  10074<<ASSIGN  10081<<ASSIGN  10083<<ASSIGN  10103<<ASSIGN
     10109<<ASSIGN  10112<<ASSIGN  10131<<ASSIGN
F$DCB.BOL
      6875**DCL      9023>>ASSIGN   9028>>ASSIGN   9045>>ASSIGN   9629<<ASSIGN   9641<<ASSIGN   9689<<ASSIGN
      9696<<ASSIGN   9716<<ASSIGN   9722>>IF       9723>>ASSIGN   9728>>IF       9729>>ASSIGN   9733>>ASSIGN
      9736<<ASSIGN   9744>>IF       9745>>ASSIGN   9750>>IF       9751>>ASSIGN   9755>>ASSIGN   9793<<ASSIGN
     10047<<ASSIGN  10107<<ASSIGN  10130<<ASSIGN
F$DCB.BORROW
      6892**DCL      6892--REDEF    6892--REDEF    6892--REDEF
F$DCB.BUPM
      6873**DCL      9446>>IF       9446>>ASSIGN
F$DCB.CBUFNUM
      6895**DCL      9029<<ASSIGN   9050<<ASSIGN
F$DCB.CFU$
      6893**DCL      8950>>ASSIGN   8952<<ASSIGN   9044>>ASSIGN   9045>>ASSIGN   9046>>ASSIGN   9048>>ASSIGN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:280  
      9049>>ASSIGN   9058<>CALL     9801>>ASSIGN  10532>>ASSIGN  10533<<ASSIGN
F$DCB.CNVRT
      6871**DCL      9307<<ASSIGN  10177<<ASSIGN  10350<<ASSIGN
F$DCB.CONT
      6891**DCL      9026<<ASSIGN
F$DCB.CRECNO
      6896**DCL      9022<<ASSIGN
F$DCB.CRECX
      6895**DCL      9023<<ASSIGN
F$DCB.CVOL
      6873**DCL      9536>>IF
F$DCB.DCBNAME.L
      6906**DCL      6906--IMP-SIZ
F$DCB.DENSITY
      6879**DCL      8958>>IF       8958<<ASSIGN   9146>>IF       9148>>ASSIGN   9190<<ASSIGN   9345>>IF
      9347>>ASSIGN   9859>>IF       9861>>ASSIGN  10005<<ASSIGN
F$DCB.DESC.BUPM
      6867**DCL      9446<<ASSIGN
F$DCB.DVBYTE
      6862**DCL     10340<<ASSIGN
F$DCB.DVBYTE.BIN
      6862**DCL     10376<<ASSIGN
F$DCB.EBCDIC
      6871**DCL      9208>>ASSIGN   9210>>IF       9306<<ASSIGN   9310>>IF       9413>>ASSIGN   9417>>IF
      9528>>IF       9600<<ASSIGN   9652>>IF       9664>>IF       9714>>IF       9768>>IF       9792<<ASSIGN
      9930<<ASSIGN   9999<<ASSIGN  10011>>IF      10349<<ASSIGN
F$DCB.EOMCHAR
      6863**DCL      6863--REDEF
F$DCB.EOP
      6888**DCL      9218<<ASSIGN   9525<<ASSIGN
F$DCB.EXIST
      6872**DCL      8981>>IF       9165>>IF       9878>>IF
F$DCB.EXPIRE
      6875**DCL      9461>>IF       9461<<ASSIGN   9462>>IF       9465>>CALL
F$DCB.FCD
      6872**DCL      9067<<ASSIGN   9077>>IF       9094<<ASSIGN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:281  
F$DCB.FFLG
      6863**DCL      9234<<ASSIGN   9519<<ASSIGN
F$DCB.FFLG.READ
      6864**DCL      9235<<ASSIGN   9520<<ASSIGN
F$DCB.FFLG.UPD
      6864**DCL      9239<<ASSIGN   9522<<ASSIGN
F$DCB.FFLG.WNEW
      6864**DCL      9238<<ASSIGN   9521<<ASSIGN
F$DCB.FLDID
      6887**DCL      6887--REDEF
F$DCB.FMOD
      6888**DCL      9219<<ASSIGN   9526<<ASSIGN
F$DCB.FORM$
      6881**DCL      6881--REDEF    9351>>ASSIGN
F$DCB.FSECT
      6897**DCL      6897--REDEF    9187<<ASSIGN   9454<<ASSIGN   9927<<ASSIGN   9929<<ASSIGN  10007<<ASSIGN
F$DCB.FSN
      6874**DCL      6874--REDEF    6874--REDEF    6875--REDEF    9186<<ASSIGN   9414<<ASSIGN   9424<<ASSIGN
      9431>>IF       9496>>ASSIGN   9838>>IF       9949>>IF       9968<<ASSIGN   9979<<ASSIGN   9979>>ASSIGN
      9983<<ASSIGN  10154<<ASSIGN  10298<<ASSIGN
F$DCB.FUN
      6873**DCL      8970>>IF       8979>>DOCASE   8997>>DOCASE   9119>>IF       9165>>IF       9206>>IF
      9236>>IF       9878>>IF
F$DCB.GDISP
      6898**DCL      9027<<ASSIGN
F$DCB.HEADER$
      6880**DCL      6880--REDEF
F$DCB.IASN
      6900**DCL      9038<<ASSIGN
F$DCB.IFMT
      6899**DCL      8967<<ASSIGN  10372<<ASSIGN
F$DCB.IGNOREFSN
      6870**DCL      9926>>IF       9978>>IF
F$DCB.IORG
      6895**DCL     10363<<ASSIGN  10365<<ASSIGN  10367<<ASSIGN  10369<<ASSIGN  10371<<ASSIGN  10374<<ASSIGN
F$DCB.IXTNSIZE
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:282  
      6878**DCL      6878--REDEF
F$DCB.KEYL
      6876**DCL      9701>>IF       9701<<ASSIGN  10240<<ASSIGN
F$DCB.KEYX
      6875**DCL     10239<<ASSIGN
F$DCB.LASTKEY
      6892**DCL      9007<<ASSIGN   9008<<ASSIGN   9010<<ASSIGN
F$DCB.LASTKEY$
      6892**DCL      9002<>CALL
F$DCB.LASTSTA$
      6868**DCL      6868--REDEF
F$DCB.LPOOL
      6893**DCL     10000>>ASSIGN
F$DCB.LSTBLK
      6891**DCL      9220<<ASSIGN   9527<<ASSIGN
F$DCB.LVL
      6893**DCL      6893--REDEF
F$DCB.MAXVOL
      6879**DCL      9117<<ASSIGN   9324<<ASSIGN   9804>>ASSIGN   9826<<ASSIGN  10398>>IF      10399<<ASSIGN
     10399>>ASSIGN  10480<<ASSIGN  10480>>ASSIGN
F$DCB.MEDIA
      6899**DCL      9037<<ASSIGN
F$DCB.NAME.C
      6868**DCL      6868--REDEF   10214<<ASSIGN  10223<<ASSIGN  10251<<ASSIGN
F$DCB.NAME.L
      6868**DCL      9838>>IF       9932>>IF       9942>>IF      10215<<ASSIGN  10224<<ASSIGN  10252<<ASSIGN
F$DCB.NEW_FSECT
      6889**DCL      9030<<ASSIGN
F$DCB.NOEOF
      6889**DCL      6889--REDEF    9217<<ASSIGN   9223<<ASSIGN   9436<<ASSIGN   9524<<ASSIGN
F$DCB.NRECS
      6879**DCL      6879--REDEF
F$DCB.NRECX
      6898**DCL      6898--REDEF    9025<<ASSIGN
F$DCB.OHDR
      6890**DCL      6890--REDEF
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:283  
F$DCB.OLDIOERR
      6899**DCL      8960<<ASSIGN
F$DCB.ORG
      6873**DCL      6873--REDEF    8970>>IF       8999>>IF       8999>>IF       9006>>IF       9142>>IF
      9349>>DOCASE   9484>>IF       9590>>DOCASE   9595<<ASSIGN   9622>>DOCASE   9625<<ASSIGN   9668>>IF
      9699>>DOCASE  10066<<ASSIGN  10067>>DOCASE  10093<<ASSIGN  10098<<ASSIGN  10102<<ASSIGN  10105<<ASSIGN
     10119<<ASSIGN  10122<<ASSIGN  10126>>IF      10126>>IF      10129<<ASSIGN  10195>>IF      10234>>IF
     10341>>DOCASE  10355>>DOCASE  10361>>DOCASE
F$DCB.OWNER
      6890**DCL      8949>>IF       9034>>IF       9042>>IF       9514<<ASSIGN   9794>>IF      10194<<ASSIGN
F$DCB.PRECNO
      6896**DCL      6896--REDEF    9020<<ASSIGN   9481<<ASSIGN
F$DCB.PSN
      6869**DCL      9119>>IF       9158>>IF       9159>>ASSIGN   9174--CALL     9325>>IF       9354>>ASSIGN
      9356--CALL     9827>>IF       9876>>IF       9885>>ASSIGN   9918--CALL    10396>>IF      10523<<ASSIGN
F$DCB.RCSZ
      6901**DCL      6901--REDEF
F$DCB.REALSPAN
      6899**DCL      9225<<ASSIGN   9311<<ASSIGN   9896<<ASSIGN   9933>>IF       9943>>IF       9950>>IF
      9969>>IF       9984>>IF
F$DCB.RECL
      6874**DCL      9632>>IF       9633<<ASSIGN   9634>>IF       9635<<ASSIGN   9636>>IF       9637<<ASSIGN
      9638>>ASSIGN   9643>>IF       9644<<ASSIGN   9645>>IF       9646<<ASSIGN   9647>>IF       9648<<ASSIGN
      9655>>IF       9656>>ASSIGN   9659>>ASSIGN   9659>>ASSIGN   9659>>ASSIGN   9662>>ASSIGN   9692<<ASSIGN
      9705<<ASSIGN   9717>>IF       9718<<ASSIGN   9719<<ASSIGN   9719>>ASSIGN   9720>>IF       9721<<ASSIGN
      9722>>IF       9723<<ASSIGN   9728>>IF       9729>>ASSIGN   9733>>ASSIGN   9739>>IF       9740<<ASSIGN
      9741<<ASSIGN   9741>>ASSIGN   9742>>IF       9743<<ASSIGN   9744>>IF       9745<<ASSIGN   9750>>IF
      9751>>ASSIGN   9755>>ASSIGN   9758>>IF       9759<<ASSIGN   9759>>ASSIGN   9789<<ASSIGN  10045<<ASSIGN
     10090<<ASSIGN  10090>>ASSIGN  10094>>ASSIGN  10099>>ASSIGN  10103>>IF      10133<<ASSIGN
F$DCB.RES
      6869**DCL      6869--REDEF    9139<<ASSIGN   9141<<ASSIGN   9143<<ASSIGN   9144<<ASSIGN   9337<<ASSIGN
      9862<<ASSIGN
F$DCB.RESNT.NUM
      6870**DCL      9136>>IF       9337>>IF       9862>>IF
F$DCB.RPOS
      6890**DCL      9021<<ASSIGN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:284  
F$DCB.SETX
      6881**DCL      6881--REDEF    9151>>ASSIGN   9227>>ASSIGN   9228>>ASSIGN   9353>>ASSIGN   9381>>ASSIGN
      9390>>ASSIGN   9438>>ASSIGN   9802>>ASSIGN   9867>>ASSIGN   9907>>ASSIGN   9998>>ASSIGN  10295>>IF
     10297>>ASSIGN
F$DCB.SEZ_OK
      6889**DCL      9319<<ASSIGN   9320<<ASSIGN
F$DCB.SHARED
      6888**DCL      9057<<ASSIGN
F$DCB.SPAN
      6890**DCL      9024<<ASSIGN
F$DCB.SPANNED
      6873**DCL      9631<<ASSIGN   9642<<ASSIGN   9691<<ASSIGN   9697<<ASSIGN   9737>>IF       9790<<ASSIGN
     10039<<ASSIGN  10075<<ASSIGN  10078<<ASSIGN  10113<<ASSIGN  10116<<ASSIGN  10120<<ASSIGN
F$DCB.STR
      6897**DCL      9529<<ASSIGN  10012<<ASSIGN
F$DCB.TAB$
      6880**DCL      6881--REDEF
F$DCB.TAPTYP.CP6F
      6894**DCL      9249<<ASSIGN   9304>>IF       9444>>IF       9503>>IF      10175>>IF      10254>>IF
     10269>>IF      10344<<ASSIGN  10348<<ASSIGN  10353<<ASSIGN
F$DCB.TAPTYP.HAVLASTKEY
      6894**DCL      9003<<ASSIGN
F$DCB.TAPTYP.MANAGED
      6894**DCL      9592<<ASSIGN   9596<<ASSIGN   9599<<ASSIGN   9602<<ASSIGN
F$DCB.TAPTYP.PASTFM
      6894**DCL      9032<<ASSIGN
F$DCB.TAPTYP.RWASC
      6894**DCL      9248<<ASSIGN   9298>>IF      10343<<ASSIGN  10347<<ASSIGN  10352<<ASSIGN  10376>>ASSIGN
F$DCB.TAPTYP.USRBUF
      6894**DCL     10200>>IF      10357<<ASSIGN  10359<<ASSIGN
F$DCB.TDA
      6895**DCL      6895--REDEF
F$DCB.TRNC
      6891**DCL      9031<<ASSIGN   9051<<ASSIGN
F$DCB.TYC.EOF
      6860**DCL     10023>>IF      10180>>IF
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:285  
F$DCB.TYC.EOT
      6859**DCL      9536>>IF
F$DCB.TYPE
      6869**DCL     10259<<ASSIGN  10261<<ASSIGN  10345<<ASSIGN
F$DCB.VOL
      6879**DCL      9173>>ASSIGN   9318>>IF       9355>>ASSIGN   9365>>IF       9411>>IF       9458>>IF
      9529>>ASSIGN   9803>>ASSIGN   9917>>ASSIGN  10012>>ASSIGN  10401>>IF      10406<<ASSIGN  10441>>IF
     10441<<ASSIGN  10449>>IF      10469>>IF      10493>>IF      10523>>ASSIGN
F$DCB.VOLACCESS
      6871**DCL      9471>>ASSIGN
F$DCB.WSN
      6870**DCL      6870--REDEF
F$DCB.XTEND
      6872**DCL      9388>>IF
FILE_NAME
      8575**DCL     10013<<ASSIGN  10061<<ASSIGN  10219>>CALLBLT 10223>>ASSIGN  10247>>CALLBLT 10251>>ASSIGN
FILE_SEQ
      8576**DCL     10009<<ASSIGN  10154>>ASSIGN
FM$BUF$
      7226**DCL      9505>>ASSIGN  10000>>ASSIGN
FM$CFUJ.BLKLEN
      7277**DCL      9045<<ASSIGN
FM$CFUJ.DCB#
      7276**DCL      9049<<ASSIGN
FM$CFUJ.DCTX
      7276**DCL      9802<<ASSIGN
FM$CFUJ.DMAIN
      7277**DCL      9048<<ASSIGN
FM$CFUJ.MAXVOL
      7276**DCL      9804<<ASSIGN
FM$CFUJ.PRECNO
      7278**DCL      9044<<ASSIGN
FM$CFUJ.SNLINKX
      7277**DCL      8950<<ASSIGN  10532<<ASSIGN
FM$CFUJ.USER
      7277**DCL      9046<<ASSIGN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:286  
FM$CFUJ.VOL
      7276**DCL      9803<<ASSIGN
FM$FIT
      7575**DCL     10198<>CALL
FM$FIT.CODES
      7575**DCL     10273<<ASSIGN
FM$FIT.CODES.CODE
      7575**DCL     10274<<ASSIGN  10275<<ASSIGN
FM$FIT.CODES.ITEMX
      7575**DCL     10278<<ASSIGN  10279>>ASSIGN
FM$FIT.CODES.NAW
      7575**DCL     10276<<ASSIGN  10288<<ASSIGN
FM$FIT.CODES.NDW
      7575**DCL     10277<<ASSIGN
FM$GRAN
      7350**DCL     10186--ASSIGN
FMD$FLSHBUF
      8432**DCL-ENT  9052--CALL
FMD$GETBUF
      8433**DCL-ENT  9054--CALL
FMH$JGETPG
      8434**DCL-ENT  9056--CALL
FMN$CHKFLACN
      8435**DCL-ENT  9273--CALL
FMO$BLDFIT
      8437**DCL-ENT  9447--CALL
FMO$GETDOMAIN
      8438**DCL-ENT  9047--CALL
FMO$LOCCODE
      8439**DCL-ENT 10238--CALL    10258--CALL
FMO$SECCHK
      8440**DCL-ENT  9515--CALL    10198--CALL
FMO$TRNINFO
      8441**DCL-ENT 10270--CALL
FMP$CLSERR
      8436**DCL-ENT  9084--CALL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:287  
FMR$G8
      8442**DCL-ENT 10530--CALL    10539--CALL
FOUR_SNS.SNS
      8509**DCL     10538<<ASSIGN  10538>>ASSIGN
FPT$OPEN_V
      6790**DCL      9515<>CALL     9515<>CALL    10198<>CALL
FPT$OPEN_V.DCB#
      6790**DCL      9049>>ASSIGN
FPT$OPEN_V.FINDPOS
      6792**DCL      9975>>IF
FPT$OPEN_V.FSN
      6800**DCL      6800--REDEF    6801--REDEF
FPT$OPEN_V.OPER.MNTONLY
      6791**DCL      8973>>IF       9129>>IF       9138>>IF       9181>>IF
FPT$OPEN_V.OPER.NXTF
      6791**DCL      9842>>IF       9842>>IF       9940>>IF       9940>>IF      10208>>IF
FPT$OPEN_V.OPER.TEST
      6790**DCL      9065>>IF
FPT$OPEN_V.OPER.THISF
      6791**DCL      9842>>IF       9940>>IF      10208>>IF
FPT$OPEN_V.SRCHCOND.REV
      6793**DCL      9962>>IF
FPT_PFIL_EOF
      8638**DCL      9090<>CALL
FPT_PFIL_EOF.V
      8638**DCL      8638--DCLINIT
FRA$OPR
      8443**DCL-ENT  9150--CALL     9348--CALL     9866--CALL
FRB$CLS
      8444**DCL-ENT  9198--CALL     9254--CALL     9564--CALL    10303--CALL
FREEPOOLS
      9074**LABEL    8974--CALLALT  8977--CALLALT  8988--GOTO     8989--CALLALT  8992--CALLALT  8994--CALLALT
      9002--CALLALT  9095--GOTO
FSA$GSP
      8447**DCL-ENT  9002--CALL
FSF$TAPEFORM
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:288  
      8448**DCL-ENT  9703--CALL
FT$ANYLBL.LABEL_TYPE
      7995**DCL     10020>>IF      10026>>IF      10030<<ASSIGN  10040>>IF      10160>>IF
FT$CFUSN.DCBX
      7273**DCL     10536<<ASSIGN  10546<<ASSIGN
FT$CFUSN.LINKX
      7273**DCL     10540<<ASSIGN
FT$CFUSN.NUM
      7273**DCL     10537<<ASSIGN  10547<<ASSIGN
FT$CFUSN.SN
      7273**DCL     10550<<ASSIGN
FT$CFUSN.SYSID
      7273**DCL     10535<<ASSIGN  10545<<ASSIGN
FT$DDT.ACCT
      7676**DCL      9472<<ASSIGN
FT$DDT.ANST
      7691**DCL      9158>>IF       9183>>IF       9365>>IF       9876>>IF
FT$DDT.DENSITY
      7706**DCL      9164>>IF       9164>>IF       9190>>ASSIGN   9890>>IF       9890>>IF      10005>>ASSIGN
FT$DDT.EBCDIC
      7694**DCL      9208<<ASSIGN   9210>>IF       9211>>IF       9224>>IF       9413<<ASSIGN   9417>>IF
      9419>>IF       9895>>IF       9930>>ASSIGN   9999>>ASSIGN
FT$DDT.EXPIRE
      7684**DCL      9455>>IF       9463<<ASSIGN   9466<>CALL     9467>>IF       9468<<ASSIGN
FT$DDT.FMNEEDED
      7707**DCL      9191>>IF       9192<<ASSIGN   9487<<ASSIGN   9911>>IF       9912<<ASSIGN
FT$DDT.FRSTFSECT
      7712**DCL      9187>>ASSIGN
FT$DDT.FRSTFSN
      7687**DCL      9186>>ASSIGN   9197>>ASSIGN
FT$DDT.FSN
      7685**DCL      9197<<ASSIGN   9424>>ASSIGN   9496<<ASSIGN   9963>>ASSIGN   9983>>ASSIGN  10010<<ASSIGN
     10298>>ASSIGN
FT$DDT.FUNNYPOS
      7714**DCL      9399>>IF       9910<<ASSIGN
FT$DDT.NOTEOF
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:289  
      7722**DCL      9196<<ASSIGN   9228<<ASSIGN   9377>>IF       9378<<ASSIGN   9903>>IF       9904<<ASSIGN
FT$DDT.POS
      7709**DCL      9036<<ASSIGN   9207>>IF       9399>>IF       9399>>IF       9411>>IF       9455>>IF
      9473>>IF       9553<<ASSIGN   9876>>IF      10020>>IF      10024<<ASSIGN  10141>>IF      10152<<ASSIGN
FT$DDT.POSLOST
      7702**DCL      9227<<ASSIGN   9975>>IF
FT$DDT.SCRTCH
      7693**DCL      9365>>IF       9488<<ASSIGN
FT$DDT.SN
      7680**DCL      9158>>IF       9159<<ASSIGN   9354<<ASSIGN   9876>>IF       9885<<ASSIGN
FT$DDT.VOLACCESS
      7727**DCL      9471<<ASSIGN
FT$HDR.L1
      8021**DCL      9506<<ASSIGN
FT$HDR.L2
      8022**DCL      9507<<ASSIGN
FT$HDR.S1
      8023**DCL      9508<<ASSIGN
FT$HDR.S2
      8024**DCL      9509<<ASSIGN
FT$KEY.KL
      8063**DCL      8064--IMP-SIZ
FT$LBL1.CREATE_DATE
      7813**DCL     10161>>IF      10162<>CALL    10163<>CALL
FT$LBL1.FILE_ID
      7803**DCL     10013>>ASSIGN
FT$LBL1.FSECT
      7806**DCL     10006>>CALLBLT
FT$LBL1.FSEQU_NUM
      7808**DCL     10008>>CALLBLT
FT$LBL1.SYSTEM.ID
      7821**DCL     10002>>IF
FT$LBL1.SYSTEM_ID
      7819**DCL      7820--REDEF
FT$LBL2.BLKL
      7890**DCL     10042>>CALLBLT
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:290  
FT$LBL2.BUF_OFFSET
      7921**DCL     10046>>CALLBLT
FT$LBL2.CP6
      7892**DCL      7910--REDEF
FT$LBL2.CP6.BLOCK_ATTR
      7907**DCL     10069>>ASSIGN
FT$LBL2.CP6.FILE_FORMAT
      7896**DCL     10058>>ASSIGN
FT$LBL2.CP6.FILE_ID
      7894**DCL     10061>>ASSIGN
FT$LBL2.FORMAT
      7885**DCL     10049>>ASSIGN
FT$LBL2.OTHEROS.BLOCK_ATTR
      7917**DCL     10106>>ASSIGN
FT$LBL2.RECL
      7891**DCL     10044>>CALLBLT
FT$ULBL.LABEL_NBIN
      7986**DCL      7987--REDEF
FTC$DFLTCLOSE
      8449**DCL-ENT  9066--CALL     9093--CALL    10206--CALL
FTI$RDASCEBC
      8450**DCL-ENT 10022--CALL
FTI$RDBIN
      8451**DCL-ENT 10179--CALL
FTI$REWIND
      8452**DCL-ENT  9195--CALL
FTI$SPFILE
      8453**DCL-ENT  9547--CALL     9552--CALL    10150--CALL    10183--CALL
FTI$SPREC
      8454**DCL-ENT  9549--CALL     9915--CALL     9955--CALL    10035--CALL
FTI$WRBIN
      8455**DCL-ENT  9512--CALL
FTI$WRFM
      8456**DCL-ENT  9193--CALL     9494--CALL     9550--CALL     9913--CALL
FTL$CVOL
      8457**DCL-ENT  9538--CALL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:291  
FTL$FINDFILE
      8458**DCL-ENT  9938--CALL     9957--CALL
FTL$FINDHDR1
      8459**DCL-ENT  9976--CALL
FTL$FINDNEXT
      8460**DCL-ENT  9980--CALL
FTL$FINDSEQ
      8461**DCL-ENT  9934--CALL     9944--CALL     9951--CALL     9970--CALL     9985--CALL
FTL$FINDSEQIBM
      8462**DCL-ENT  9936--CALL     9946--CALL     9953--CALL     9972--CALL     9987--CALL
FTL$GETULBLS
      8464**DCL-ENT 10146--CALL
FTL$LBLS
      8465**DCL-ENT  9485--CALL     9486--CALL
FTL$PEOS
      8466**DCL-ENT  9389--CALL
FTL$SPF
      8467**DCL-ENT  9380--CALL     9906--CALL
FTL$ULBLS
      8468**DCL-ENT  9492--CALL
FTL$VOL1
      8469**DCL-ENT  9474--CALL
FTO_CHECK_DIGITS
     10313**PROC    10162--CALL
FTO_CHK_BLKL_RECL
      9577**PROC     9130--CALL     9274--CALL
FTO_CREATEOPEN
      9286**PROC     9276--CALL     9800--CALL
FTO_GETSN
     10384**PROC     9114--CALL     9321--CALL
FTO_OPNCREATE
      9262**PROC     8989--CALL     8992--CALL
FTO_OPNDEV
      9103**PROC     8974--CALL
FTO_OPNEXISTING
      9814**PROC     8983--CALL     8994--CALL
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:292  
FTO_OPNJRNL
      9782**PROC     8977--CALL
FTO_SETTAPTYP
     10333**PROC     9250--CALL     9297--CALL    10174--CALL
FTO_SNLIST
     10420**PROC     9825--CALL    10409--CALL    10575--CALL
FTR$DPT
      8471**DCL-ENT  9226--CALL     9437--CALL     9920--CALL
FTR$RELCFUS
      8472**DCL-ENT  9078--CALL     9568--CALL    10559--CALL
FTR$RELFPOOLS
      8473**DCL-ENT  9074--CALL
FTR$SETSN
      8474**DCL-ENT  9174--CALL     9356--CALL     9918--CALL
FTW$WRAT
      8475**DCL-ENT  9090--CALL
FT_CP6FMT
      8602**DCL     10063>>DOWHILE
FT_CP6FMTORG
      8614**DCL     10066>>ASSIGN
FT_DENS
      8584**DCL      9148>>ASSIGN   9164>>IF       9347>>ASSIGN   9861>>ASSIGN   9890>>IF
FT_FORMAT
      8594**DCL     10051>>DOWHILE
FT_PROT
      8488**DCL      9115>>IF       9119>>IF       9158>>IF       9322>>IF       9826>>IF       9876>>IF
HFF$DSIZ
      8476**DCL-ENT  9242--CALL     9489--CALL     9676--CALL    10143--CALL
I
      8567**DCL      9047<>CALL     9048>>ASSIGN   9173<<ASSIGN   9174<>CALL     9242<>CALL     9244>>IF
      9355<<ASSIGN   9356<>CALL     9460<>CALL     9465<>CALL     9465<>CALL     9466<>CALL     9489<>CALL
      9491<<ASSIGN   9492<>CALL     9676<>CALL     9678<<ASSIGN   9679>>IF       9917<<ASSIGN   9918<>CALL
      9963<<ASSIGN   9964>>IF       9968>>ASSIGN  10006<<CALLBLT 10007>>ASSIGN  10008<<CALLBLT 10009>>ASSIGN
     10010>>ASSIGN  10042<<CALLBLT 10043>>ASSIGN  10044<<CALLBLT 10045>>ASSIGN  10046<<CALLBLT 10047>>ASSIGN
     10049<<ASSIGN  10051>>DOWHILE 10058<<ASSIGN  10059>>IF      10063>>DOWHILE 10085>>IF      10143<>CALL
     10145<<ASSIGN  10146<>CALL    10461<<ASSIGN  10468<<ASSIGN  10468>>ASSIGN  10469>>IF      10475<<ASSIGN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:293  
     10475>>ASSIGN  10477>>DOWHILE 10478>>IF      10481<<ASSIGN  10481>>ASSIGN  10486<<ASSIGN  10486>>ASSIGN
     10493>>IF      10503>>DOINDEX 10510>>DOINDEX 10524>>IF      10534>>DOWHILE 10543<<ASSIGN  10543>>ASSIGN
     10547>>ASSIGN  10548>>DOWHILE 10549<<ASSIGN  10549>>ASSIGN  10550>>ASSIGN  10550>>ASSIGN
IC IN PROCEDURE FTO_CHECK_DIGITS
     10320**DCL     10323<<ASSIGN  10324>>IF
IX IN PROCEDURE FTO_CHECK_DIGITS
     10319**DCL     10322<<DOINDEX 10323>>ASSIGN
J
      8568**DCL     10050<<ASSIGN  10051>>DOWHILE 10051>>DOWHILE 10052<<ASSIGN  10052>>ASSIGN  10054>>DOCASE
     10062<<ASSIGN  10063>>DOWHILE 10063>>DOWHILE 10064<<ASSIGN  10064>>ASSIGN  10066>>ASSIGN  10069<<ASSIGN
     10070>>IF      10072>>IF      10077>>IF      10106<<ASSIGN  10108>>IF      10110>>IF      10115>>IF
     10190<<ASSIGN  10191--ASSIGN  10219<<CALLBLT 10221<<ASSIGN  10224>>ASSIGN  10237<<ASSIGN  10238<>CALL
     10247<<CALLBLT 10249<<ASSIGN  10252>>ASSIGN  10257<<ASSIGN  10258<>CALL    10476<<ASSIGN  10477>>DOWHILE
     10483<<ASSIGN  10503<<DOINDEX 10504>>ASSIGN  10510>>DOINDEX
JDCB.DCBX
      8571**DCL     10536>>ASSIGN  10546>>ASSIGN
JDCB$
      8569**DCL      6859--IMP-PTR  8570--REDEF    8947<<ASSIGN   8948>>IF       8949>>IF       8950>>ASSIGN
      8952>>ASSIGN   8958>>IF       8958>>ASSIGN   8960>>ASSIGN   8967>>ASSIGN   8969>>IF       8970>>IF
      8970>>IF       8971>>ASSIGN   8972>>ASSIGN   8973>>IF       8976>>IF       8979>>DOCASE   8981>>IF
      8997>>DOCASE   8999>>IF       8999>>IF       9000>>IF       9002>>CALL     9003>>ASSIGN   9006>>IF
      9007>>ASSIGN   9008>>ASSIGN   9010>>ASSIGN   9019>>ASSIGN   9020>>ASSIGN   9021>>ASSIGN   9022>>ASSIGN
      9023>>ASSIGN   9023>>ASSIGN   9024>>ASSIGN   9025>>ASSIGN   9026>>ASSIGN   9027>>ASSIGN   9028>>ASSIGN
      9028>>ASSIGN   9029>>ASSIGN   9030>>ASSIGN   9031>>ASSIGN   9032>>ASSIGN   9034>>IF       9034>>IF
      9037>>ASSIGN   9038>>ASSIGN   9040>>IF       9042>>IF       9044>>ASSIGN   9045>>ASSIGN   9045>>ASSIGN
      9046>>ASSIGN   9048>>ASSIGN   9049>>ASSIGN   9050>>ASSIGN   9051>>ASSIGN   9053>>ASSIGN   9057>>ASSIGN
      9058>>CALL     9065>>IF       9067>>ASSIGN   9075>>IF       9077>>IF       9094>>ASSIGN   9117>>ASSIGN
      9119>>IF       9119>>IF       9136>>IF       9139>>ASSIGN   9140>>IF       9141>>ASSIGN   9142>>IF
      9143>>ASSIGN   9144>>ASSIGN   9146>>IF       9147>>ASSIGN   9148>>ASSIGN   9148>>ASSIGN   9151>>ASSIGN
      9158>>IF       9159>>ASSIGN   9164>>IF       9165>>IF       9165>>IF       9165>>IF       9173>>ASSIGN
      9174>>CALL     9185>>ASSIGN   9186>>ASSIGN   9187>>ASSIGN   9189>>ASSIGN   9190>>ASSIGN   9206>>IF
      9208>>ASSIGN   9210>>IF       9217>>ASSIGN   9218>>ASSIGN   9219>>ASSIGN   9220>>ASSIGN   9223>>ASSIGN
      9224>>IF       9225>>ASSIGN   9227>>ASSIGN   9228>>ASSIGN   9234>>ASSIGN   9235>>ASSIGN   9236>>IF
      9238>>ASSIGN   9239>>ASSIGN   9248>>ASSIGN   9249>>ASSIGN   9273<>CALL     9298>>IF       9298>>IF
      9304>>IF       9306>>ASSIGN   9307>>ASSIGN   9310>>IF       9310>>IF       9311>>ASSIGN   9318>>IF
      9319>>ASSIGN   9320>>ASSIGN   9324>>ASSIGN   9325>>IF       9337>>IF       9337>>ASSIGN   9345>>IF
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:294  
      9346>>ASSIGN   9347>>ASSIGN   9347>>ASSIGN   9349>>DOCASE   9351>>ASSIGN   9351>>ASSIGN   9351>>ASSIGN
      9353>>ASSIGN   9354>>ASSIGN   9355>>ASSIGN   9356>>CALL     9365>>IF       9381>>ASSIGN   9388>>IF
      9390>>ASSIGN   9411>>IF       9413>>ASSIGN   9414>>ASSIGN   9417>>IF       9424>>ASSIGN   9431>>IF
      9436>>ASSIGN   9438>>ASSIGN   9444>>IF       9446>>IF       9446>>ASSIGN   9446>>ASSIGN   9454>>ASSIGN
      9458>>IF       9461>>IF       9461>>ASSIGN   9462>>IF       9465>>CALL     9471>>ASSIGN   9481>>ASSIGN
      9482>>ASSIGN   9484>>IF       9496>>ASSIGN   9503>>IF       9505>>ASSIGN   9506>>ASSIGN   9510>>ASSIGN
      9510>>ASSIGN   9514>>ASSIGN   9519>>ASSIGN   9520>>ASSIGN   9521>>ASSIGN   9522>>ASSIGN   9524>>ASSIGN
      9525>>ASSIGN   9526>>ASSIGN   9527>>ASSIGN   9528>>IF       9529>>ASSIGN   9529>>ASSIGN   9536>>IF
      9536>>IF       9546>>ASSIGN   9548>>ASSIGN   9551>>ASSIGN   9588>>IF       9590>>DOCASE   9592>>ASSIGN
      9595>>ASSIGN   9596>>ASSIGN   9599>>ASSIGN   9600>>ASSIGN   9602>>ASSIGN   9622>>DOCASE   9625>>ASSIGN
      9629>>ASSIGN   9630>>ASSIGN   9631>>ASSIGN   9632>>IF       9633>>ASSIGN   9634>>IF       9635>>ASSIGN
      9636>>IF       9637>>ASSIGN   9638>>ASSIGN   9638>>ASSIGN   9641>>ASSIGN   9642>>ASSIGN   9643>>IF
      9644>>ASSIGN   9645>>IF       9646>>ASSIGN   9647>>IF       9648>>ASSIGN   9649>>IF       9651>>IF
      9652>>IF       9653>>ASSIGN   9654>>ASSIGN   9655>>IF       9655>>IF       9656>>ASSIGN   9656>>ASSIGN
      9657>>IF       9658>>ASSIGN   9659>>ASSIGN   9659>>ASSIGN   9659>>ASSIGN   9659>>ASSIGN   9659>>ASSIGN
      9662>>ASSIGN   9662>>ASSIGN   9664>>IF       9665>>ASSIGN   9665>>ASSIGN   9668>>IF       9684>>IF
      9685>>ASSIGN   9686>>ASSIGN   9686>>ASSIGN   9688>>ASSIGN   9689>>ASSIGN   9690>>ASSIGN   9691>>ASSIGN
      9692>>ASSIGN   9696>>ASSIGN   9697>>ASSIGN   9698>>ASSIGN   9699>>DOCASE   9701>>IF       9701>>ASSIGN
      9705>>ASSIGN   9706>>IF       9707>>ASSIGN   9708>>IF       9709>>ASSIGN   9710>>ASSIGN   9710>>ASSIGN
      9714>>IF       9716>>ASSIGN   9717>>IF       9718>>ASSIGN   9719>>ASSIGN   9719>>ASSIGN   9720>>IF
      9721>>ASSIGN   9722>>IF       9722>>IF       9723>>ASSIGN   9723>>ASSIGN   9724>>IF       9726>>IF
      9727>>ASSIGN   9728>>IF       9728>>IF       9728>>IF       9729>>ASSIGN   9729>>ASSIGN   9729>>ASSIGN
      9730>>IF       9731>>ASSIGN   9733>>ASSIGN   9733>>ASSIGN   9733>>ASSIGN   9736>>ASSIGN   9737>>IF
      9739>>IF       9740>>ASSIGN   9741>>ASSIGN   9741>>ASSIGN   9742>>IF       9743>>ASSIGN   9744>>IF
      9744>>IF       9745>>ASSIGN   9745>>ASSIGN   9746>>IF       9748>>IF       9749>>ASSIGN   9750>>IF
      9750>>IF       9750>>IF       9751>>ASSIGN   9751>>ASSIGN   9751>>ASSIGN   9752>>IF       9753>>ASSIGN
      9755>>ASSIGN   9755>>ASSIGN   9755>>ASSIGN   9758>>IF       9759>>ASSIGN   9759>>ASSIGN   9760>>IF
      9761>>ASSIGN   9762>>IF       9763>>ASSIGN   9764>>IF       9765>>ASSIGN   9768>>IF       9769>>ASSIGN
      9769>>ASSIGN   9788>>ASSIGN   9789>>ASSIGN   9790>>ASSIGN   9791>>ASSIGN   9792>>ASSIGN   9793>>ASSIGN
      9794>>IF       9801>>ASSIGN   9802>>ASSIGN   9803>>ASSIGN   9804>>ASSIGN   9826>>ASSIGN   9827>>IF
      9838>>IF       9838>>IF       9859>>IF       9860>>ASSIGN   9861>>ASSIGN   9861>>ASSIGN   9862>>IF
      9862>>ASSIGN   9867>>ASSIGN   9876>>IF       9878>>IF       9878>>IF       9885>>ASSIGN   9890>>IF
      9895>>IF       9896>>ASSIGN   9907>>ASSIGN   9914>>ASSIGN   9917>>ASSIGN   9918>>CALL     9926>>IF
      9927>>ASSIGN   9929>>ASSIGN   9930>>ASSIGN   9932>>IF       9933>>IF       9942>>IF       9943>>IF
      9949>>IF       9950>>IF       9954>>ASSIGN   9968>>ASSIGN   9969>>IF       9978>>IF       9979>>ASSIGN
      9979>>ASSIGN   9983>>ASSIGN   9984>>IF       9998>>ASSIGN   9999>>ASSIGN  10000>>ASSIGN  10000>>ASSIGN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:295  
     10005>>ASSIGN  10007>>ASSIGN  10011>>IF      10012>>ASSIGN  10012>>ASSIGN  10023>>IF      10028>>IF
     10034>>ASSIGN  10039>>ASSIGN  10043>>ASSIGN  10045>>ASSIGN  10047>>ASSIGN  10048>>ASSIGN  10066>>ASSIGN
     10067>>DOCASE  10071>>ASSIGN  10074>>ASSIGN  10075>>ASSIGN  10078>>ASSIGN  10081>>ASSIGN  10083>>ASSIGN
     10084>>ASSIGN  10089>>ASSIGN  10089>>ASSIGN  10090>>ASSIGN  10090>>ASSIGN  10093>>ASSIGN  10094>>ASSIGN
     10094>>ASSIGN  10098>>ASSIGN  10099>>ASSIGN  10099>>ASSIGN  10102>>ASSIGN  10103>>IF      10103>>IF
     10103>>ASSIGN  10105>>ASSIGN  10107>>ASSIGN  10109>>ASSIGN  10112>>ASSIGN  10113>>ASSIGN  10116>>ASSIGN
     10119>>ASSIGN  10120>>ASSIGN  10122>>ASSIGN  10126>>IF      10126>>IF      10129>>ASSIGN  10130>>ASSIGN
     10131>>ASSIGN  10132>>ASSIGN  10133>>ASSIGN  10149>>ASSIGN  10154>>ASSIGN  10175>>IF      10177>>ASSIGN
     10178>>ASSIGN  10180>>IF      10182>>ASSIGN  10185>>IF      10194>>ASSIGN  10195>>IF      10200>>IF
     10200>>IF      10214>>ASSIGN  10215>>ASSIGN  10223>>ASSIGN  10224>>ASSIGN  10234>>IF      10239>>ASSIGN
     10240>>ASSIGN  10251>>ASSIGN  10252>>ASSIGN  10254>>IF      10259>>ASSIGN  10261>>ASSIGN  10269>>IF
     10295>>IF      10297>>ASSIGN  10298>>ASSIGN  10340>>ASSIGN  10341>>DOCASE  10343>>ASSIGN  10344>>ASSIGN
     10345>>ASSIGN  10347>>ASSIGN  10348>>ASSIGN  10349>>ASSIGN  10350>>ASSIGN  10352>>ASSIGN  10353>>ASSIGN
     10355>>DOCASE  10357>>ASSIGN  10359>>ASSIGN  10361>>DOCASE  10363>>ASSIGN  10365>>ASSIGN  10367>>ASSIGN
     10369>>ASSIGN  10371>>ASSIGN  10372>>ASSIGN  10374>>ASSIGN  10376>>ASSIGN  10376>>ASSIGN  10396>>IF
     10398>>IF      10399>>ASSIGN  10399>>ASSIGN  10401>>IF      10406>>ASSIGN  10441>>IF      10441>>ASSIGN
     10449>>IF      10462>>IF      10469>>IF      10480>>ASSIGN  10480>>ASSIGN  10493>>IF      10523>>ASSIGN
     10523>>ASSIGN  10531>>IF      10532>>ASSIGN  10533>>ASSIGN  10574<<ASSIGN
JRNL_OFFSET IN PROCEDURE FTO_SNLIST
     10433**DCL     10464<<ASSIGN  10467<<ASSIGN  10468>>ASSIGN
JUSTALT IN PROCEDURE FTO_CHK_BLKL_RECL
      9769**LABEL    9703--CALLALT
JUSTALT IN PROCEDURE FTO_CREATEOPEN
      9571**LABEL    9302--GOTO     9321--CALLALT  9328--GOTO
JUSTALT IN PROCEDURE FTO_GETSN
     10409**LABEL   10409--CALLALT
JUSTALT IN PROCEDURE FTO_OPNCREATE
      9273**LABEL    9273--CALLALT  9274--CALLALT  9276--CALLALT
JUSTALT IN PROCEDURE FTO_OPNDEV
      9249**LABEL    9114--CALLALT  9130--CALLALT  9150--CALLALT
JUSTALT IN PROCEDURE FTO_OPNEXISTING
     10304**LABEL    9825--CALLALT  9866--CALLALT
JUSTALT IN PROCEDURE FTO_OPNJRNL
      9804**LABEL    9800--CALLALT
LEN IN PROCEDURE FTO_CHECK_DIGITS
     10317**DCL     10313--PROC    10318--IMP-SIZ 10322>>DOINDEX 10323>>ASSIGN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:296  
MAXBLKL
      8573**DCL      9609<<ASSIGN   9610>>IF       9615>>IF       9616<<ASSIGN   9647>>IF       9648>>ASSIGN
      9657>>IF       9658>>ASSIGN   9708>>IF       9709>>ASSIGN   9752>>IF       9753>>ASSIGN   9764>>IF
      9765>>ASSIGN
N$DCT$$
      8300**DCL      8300--IMP-PTR  9151>>ASSIGN   9227>>ASSIGN   9228>>ASSIGN   9353>>ASSIGN   9381>>ASSIGN
      9390>>ASSIGN   9438>>ASSIGN   9867>>ASSIGN   9907>>ASSIGN   9998>>ASSIGN  10297>>ASSIGN
NEVER0 IN PROCEDURE FTO_OPNDEV
      9173**LABEL    9174--CALLALT
NEVER1 IN PROCEDURE FTO_CREATEOPEN
      9355**LABEL    9356--CALLALT
NEVER2 IN PROCEDURE FTO_OPNEXISTING
      9917**LABEL    9918--CALLALT
NK$LDCT.DDT$
      8262**DCL      8262--REDEF    9151>>ASSIGN   9227>>ASSIGN   9228>>ASSIGN   9353>>ASSIGN   9381>>ASSIGN
      9390>>ASSIGN   9438>>ASSIGN   9867>>ASSIGN   9907>>ASSIGN   9998>>ASSIGN  10297>>ASSIGN
NK$LDCT.IOQ$
      8261**DCL      8262--REDEF
NK$LDCT.LDCTX
      8263**DCL      8263--REDEF
NK$LDCT.LKFLG.ABORTED
      8275**DCL      8276--REDEF
NK$LDCT.RLCID.LDCTX
      8285**DCL      8285--REDEF
NK$LDCT.STA$
      8281**DCL      8282--REDEF
NK$LDCT.SYMB$
      8260**DCL      8260--REDEF    8260--REDEF    8261--REDEF
NK$LDCT$
      8300**DCL      9151>>ASSIGN   9227>>ASSIGN   9228>>ASSIGN   9353>>ASSIGN   9381>>ASSIGN   9390>>ASSIGN
      9438>>ASSIGN   9867>>ASSIGN   9907>>ASSIGN   9998>>ASSIGN  10297>>ASSIGN
NOCFUS IN PROCEDURE FTO_SNLIST
     10563**LABEL   10530--CALLALT
NOIFPARAM IN PROCEDURE FTO_CHK_BLKL_RECL
      9676**LABEL    9676--CALLALT
NOTENUFCFUS IN PROCEDURE FTO_SNLIST
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:297  
     10559**LABEL   10539--CALLALT
NOUHL IN PROCEDURE FTO_CREATEOPEN
      9491**LABEL    9489--CALLALT
NOUHL IN PROCEDURE FTO_OPNDEV
      9244**LABEL    9242--CALLALT
NOUHL IN PROCEDURE FTO_OPNEXISTING
     10146**LABEL   10143--CALLALT
NO_IFPARAM_RESTRICT
      8574**DCL      9484>>IF       9675<<ASSIGN   9682<<ASSIGN  10086<<ASSIGN  10087<<ASSIGN  10348>>ASSIGN
PCFU$ IN PROCEDURE FTO_SNLIST
     10430**DCL     10530<>CALL    10533>>ASSIGN  10535>>ASSIGN  10536>>ASSIGN  10537>>ASSIGN  10538>>ASSIGN
     10540>>ASSIGN  10541<<ASSIGN  10545>>ASSIGN  10546>>ASSIGN  10547>>ASSIGN  10550>>ASSIGN
PN$
      8495**DCL         9--PROC     9447<>CALL    10569--ENTRY
PN$.ACSVEH_
      8496**DCL      8496--REDEF
PN$.ALTKEYS_
      8498**DCL      8498--REDEF    8498--REDEF
PN$.FPARAM_
      8497**DCL     10267>>IF      10270<>CALL    10272>>ASSIGN
PN$.HDR_
      8497**DCL      8497--REDEF
PN$.IFPARAM_
      8496**DCL      9676--CALL     9677>>ASSIGN
PN$.SN_
      8495**DCL     10440>>ASSIGN
PN$.TAB_
      8497**DCL      8497--REDEF
PN$.UHL_
      8495**DCL      8495--REDEF    8495--REDEF    9242--CALL     9243>>ASSIGN   9489--CALL     9490>>ASSIGN
     10143--CALL    10144>>ASSIGN
PN$.V_
      8495**DCL      8973>>IF       9049>>ASSIGN   9065>>IF       9129>>IF       9138>>IF       9181>>IF
      9242--CALL     9489--CALL     9515>>CALL     9676--CALL     9840>>IF       9842>>IF       9842>>IF
      9842>>IF       9931>>IF       9940>>IF       9940>>IF       9940>>IF       9962>>IF       9975>>IF
     10143--CALL    10198>>CALL    10208>>IF      10208>>IF
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:298  
PN$.WSN_
      8497**DCL      8497--REDEF
PSN IN PROCEDURE FTO_SNLIST
     10431**DCL     10504<<ASSIGN  10505>>IF      10511>>IF
RELCFUS IN PROCEDURE FTO_CREATEOPEN
      9568**LABEL    9348--CALLALT
RETFSN IN PROCEDURE FTO_OPNEXISTING
     10286**LABEL    9913--CALLALT  9915--CALLALT  9934--CALLALT  9936--CALLALT  9938--CALLALT  9944--CALLALT
      9946--CALLALT  9951--CALLALT  9953--CALLALT  9957--CALLALT  9970--CALLALT  9972--CALLALT  9976--CALLALT
      9980--CALLALT  9985--CALLALT  9987--CALLALT
SN$ IN PROCEDURE FTO_SNLIST
     10432**DCL     10440<<ASSIGN  10447>>IF      10461>>ASSIGN  10465<<ASSIGN  10465>>ASSIGN  10478>>IF
     10504>>ASSIGN  10511>>IF      10523>>ASSIGN  10538>>ASSIGN  10542<<ASSIGN  10542>>ASSIGN  10550>>ASSIGN
SSS$SYSTIME
      8477**DCL-ENT  9460--CALL    10166--CALL    10168--CALL
STRING IN PROCEDURE FTO_CHECK_DIGITS
     10318**DCL     10313--PROC    10323>>ASSIGN
TEMP$
      8577**DCL      9054<>CALL     9243<<ASSIGN   9244>>IF       9245>>ASSIGN   9490<<ASSIGN   9491>>IF
      9492<>CALL     9505<<ASSIGN   9506>>ASSIGN   9507>>ASSIGN   9508>>ASSIGN   9509>>ASSIGN   9512<>CALL
      9515>>CALL     9538<>CALL     9677<<ASSIGN   9678>>IF       9801<<ASSIGN   9802>>ASSIGN   9803>>ASSIGN
      9804>>ASSIGN  10019<<ASSIGN  10020>>IF      10022<>CALL    10026>>IF      10030>>ASSIGN  10040>>IF
     10042>>CALLBLT 10044>>CALLBLT 10046>>CALLBLT 10049>>ASSIGN  10058>>ASSIGN  10061>>ASSIGN  10069>>ASSIGN
     10106>>ASSIGN  10144<<ASSIGN  10145>>IF      10146<>CALL    10186<<ASSIGN  10187<<ASSIGN  10191<<ASSIGN
     10198>>CALL    10236>>ASSIGN  10256>>ASSIGN  10270<>CALL    10279<<ASSIGN  10280>>ASSIGN  10281>>ASSIGN
     10282>>ASSIGN  10283>>ASSIGN  10284>>ASSIGN  10285>>ASSIGN  10286>>ASSIGN  10287<<ASSIGN  10287>>ASSIGN
     10288>>ASSIGN  10539<>CALL    10541>>ASSIGN
UMT$JDATE
      8478**DCL-ENT  9466--CALL
UMT$UTSJ
      8479**DCL-ENT 10163--CALL
UQB$MDEQ
      8480**DCL-ENT  9058--CALL
VLP$SN_V.NUM
      6805**DCL      9245<<ASSIGN  10461>>ASSIGN
VLP$SN_V.SN
PL6.E3A0      #001=FTO$OPNAT File=FTO$OPNAT.:E05TSI                              TUE 07/29/97 18:01 Page:299  
      6805**DCL     10478>>IF      10504>>ASSIGN  10511>>IF      10523>>ASSIGN  10550>>ASSIGN
XUD$UTS_ADJUST
      8403**DCL-ENT  9465--CALL
