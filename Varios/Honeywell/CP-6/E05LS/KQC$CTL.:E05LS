VERSION E05

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:1    
        1        1        /*M* KQC$CTL COMGROUP control routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQC$CTL
       10       10             PURPOSE:      To provide comgroup functions related to
       11       11                           the control services provided to the AU
       12       12        */
       13       13        /**/
       14       14        KQC$CGCTL: PROC (PARM$,PARM) ALTRET;
       15       15        /**/
       16       16
       17       17
       18       18
       19       19        /**/
       20       20        /* INCLUDES */
       21       21        /**/
       22       22        %INCLUDE KQ_SUBS_C;
       23      322        %INCLUDE KQ_MAC_C;
       24     2872        %INCLUDE HF_LOCK_C;
       25     2886        %INCLUDE KQ_DATA_R;
       26     3718        %INCLUDE CP_6_SUBS;
       27     4258        %INCLUDE KC$CP6V_C;
       28     4378        %INCLUDE B$JIT_C;
       29     4692        %INCLUDE UD_SEV_C;
       30     4706        %INCLUDE KQ_ERRORS_C;
       31     4754        %INCLUDE KC_ERRORS_C;
       32     4801        %INCLUDE UD_ERRORS_C;
       33     4843        %INCLUDE KC_CP6;
       34     5403        %INCLUDE KI$CP6V_C;
       35     5842        %INCLUDE KI_CP6;
       36     6938        %INCLUDE KC$CGBLK;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:2    
       37     6986        %INCLUDE F$DCB;
       38     7035        %INCLUDE EL_SUBS_C;
       39     7119        %INCLUDE NK_SUBS;
       40     7144        %INCLUDE SS_SCHED_C;
       41     7377        %INCLUDE KC_DATA_R;
       42     7390
       43     7391
       44     7392
       45     7393        /**/
       46     7394        /* PARAMETERS */
       47     7395        /**/
       48     7396    1   DCL PARM$ PTR;
       49     7397    1   DCL PARM UBIN WORD ALIGNED;
       50     7398    1   DCL PARMR BIT(36) ALIGNED;
       51     7399
       52     7400
       53     7401
       54     7402        /**/
       55     7403        /* MACROS */
       56     7404        /**/
       57     7405        %MACRO $ERROR (NAME=GORGO,CODE=0,SEV=SEV_ERROR#);
       58     7406        DCL 1 NAME CONSTANT ALIGNED,
       59     7407              2 * BIT(18) UNAL INIT('132103'O),
       60     7408              2 * UBIN(15) UNAL INIT(CODE),
       61     7409              2 * UBIN(3) UNAL INIT(SEV);
       62     7410        %MEND;
       63     7411
       64     7412
       65     7413
       66     7414        /**/
       67     7415        /* BASED STRUCTURES */
       68     7416        /**/
       69     7417        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
       70     8156        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
       71     8495        %KQ_MTYP (FPTN=KQ$MTYP,STCLASS="BASED(MTYP$)");
       72     8569        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS="BASED(QTN$)");
       73     9042        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:3    
       74     9080        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED(RBLK$)");
       75     9266        %FPT$CGCTL_V    (FPTN=FPT$CGCTL ,BASED="BASED(B$PS0$)");
       76     9270        %VLP$CGTYPL_V   (FPTN=VLP$CGTYPL,BASED="BASED(B$PS1$)",NTYP=1);
       77     9275        %VLP$CGSTAL_V   (FPTN=VLP$CGSTAL,BASED="BASED(B$PS2$)",NSTA=1);
       78     9279        %VLP$CGCP_V     (FPTN=VLP$CGCP  ,BASED="BASED(B$PS3$)");
       79     9298        %VLP$SETSTA_V   (FPTN=VLP$SETSTA,BASED="BASED(B$PS4$)");
       80     9310        %VLP$CGQL_V     (FPTN=VLP$CGQL  ,BASED="BASED(B$PS5$)",NLIST=1);
       81     9314        %VLP$STATION_V (FPTN=VLP$STATION,BASED="BASED(B$PS7$)");
       82     9326        %VLP_JRNLFIDV (FPTN=VLP$JRNLFIDV,STCLASS=BASED);
       83     9333        %FPT$ACTIVATE_V (FPTN=FPT$ACTIVATE);
       84     9339    1   DCL B$$BIT36 BIT(36) BASED ALIGNED;
       85     9340    1   DCL B$$CHARS CHAR(I) BASED CALIGNED;
       86     9341    1   DCL 1 VTXTC BASED ALIGNED,
       87     9342    1         2 CNT UBIN BYTE UNAL,
       88     9343    1         2 TXT CHAR(VTXTC.CNT);
       89     9344        %B$JIT0;
       90     9433        %U$JIT1X;
       91     9436        %M$JIT2X;
       92     9439        %F$JIT3;
       93     9444        %A$JIT6X;
       94     9447
       95     9448
       96     9449
       97     9450        /**/
       98     9451        /* AUTO */
       99     9452        /**/
      100     9453    1   DCL CG$ PTR;
      101     9454    1   DCL LDCT$ PTR;
      102     9455    1   DCL KEY CHAR(8) ALIGNED;
      103     9456    1   DCL KEYR REDEF KEY BIT(72) ALIGNED;
      104     9457    1   DCL ACTCNT UBIN WORD;
      105     9458    1   DCL STA$ PTR;
      106     9459    1   DCL MYSTA$ PTR;
      107     9460    1   DCL MTYP$ PTR;
      108     9461    1   DCL QTN$ PTR;
      109     9462    1   DCL DSIZ SBIN;
      110     9463    1   DCL NTYP SBIN;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:4    
      111     9464    1   DCL TYPX SBIN;
      112     9465    1   DCL PRIO UBIN;
      113     9466    1   DCL STAX SBIN;
      114     9467    1   DCL NSTA SBIN;
      115     9468        %VLP$CGCP_V (FPTN=CGCP,BASED=AUTO);
      116     9487        %VLP$SETSTA_V (FPTN=SETSTA,BASED=AUTO);
      117     9499        %KC$CGID (FPTN=ACGID,STCLASS="");
      118     9525    1   DCL P$ PTR;
      119     9526    1   DCL RBLK$ PTR;
      120     9527    1   DCL JFLG UBIN;
      121     9528    1   DCL PP$ PTR;
      122     9529    1   DCL QLIST UBIN;
      123     9530    1   DCL NQ SBIN;
      124     9531    1   DCL DCB$ PTR;
      125     9532    1   DCL DFCHK UBIN;
      126     9533    1   DCL FLINK$ PTR;
      127     9534    1   DCL I UBIN;
      128     9535    1   DCL TOKFLG UBIN WORD;
      129     9536    1   DCL JNAME CHAR(8);
      130     9537
      131     9538
      132     9539
      133     9540        /**/
      134     9541        /* CONSTANT */
      135     9542        /**/
      136     9543        %$ERROR (NAME=E_BCGPRI,CODE=%E$BCGPRI);
      137     9549        %$ERROR (NAME=E_NOMEM,CODE=%E$NOMEM);
      138     9555        %$ERROR (NAME=E_CGTTRP,CODE=%E$CGTTRP);
      139     9561        %$ERROR (NAME=E_CGSTRP,CODE=%E$CGSTRP);
      140     9567        %$ERROR (NAME=E_CGIQLS,CODE=%E$CGIQLS);
      141     9573        %$ERROR (NAME=E_CGCDXT,CODE=%E$CGCDXT);
      142     9579        %$ERROR (NAME=E_CGCDDT,CODE=%E$CGCDDT);
      143     9585        %$ERROR (NAME=E_CGCDCS,CODE=%E$CGCDCS);
      144     9591        %$ERROR (NAME=E_CGUAFC,CODE=%E$CGUAFC);
      145     9597        %$ERROR (NAME=E_CGAFNT,CODE=%E$CGAFNT);
      146     9603        %$ERROR (NAME=E_CGAFNS,CODE=%E$CGAFNS);
      147     9609        %$ERROR (NAME=E_CGCDAN,CODE=%E$CGCDAN);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:5    
      148     9615        %$ERROR (NAME=E_CGMSDT,CODE=%E$CGMSDT);
      149     9621        %$ERROR (NAME=E_CGMPEN,CODE=%E$CGMPEN);
      150     9627        %$ERROR (NAME=E_TYPCHR,CODE=%E$TYPCHAR);
      151     9633        %$ERROR (NAME=E_STACHR,CODE=%E$STACHAR);
      152     9639        %$ERROR (NAME=E_BDJFID,CODE=%E$BDJFID);
      153     9645        %KC$CGID (FPTN=CCGID,STCLASS=CONSTANT);
      154     9671
      155     9672
      156     9673
      157     9674        /**/
      158     9675        /* REFS */
      159     9676        /**/
      160     9677    1   DCL ELA$SYSLOG    ENTRY(6) ALTRET;
      161     9678    1   DCL HFF$ERASE     ENTRY(1) ALTRET;
      162     9679    1   DCL HFF$NIL       ENTRY(1) ALTRET;
      163     9680    1   DCL HFF$NILERASE  ENTRY(1) ALTRET;
      164     9681    1   DCL HFF$DSIZ      ENTRY(2) ALTRET;
      165     9682    1   DCL HFF$PTPRES    ENTRY(1) ALTRET;
      166     9683    1   DCL HFF$TRAPALT   ENTRY(1) ALTRET;
      167     9684    1   DCL KCL$HOOKUPH  ENTRY ALTRET;
      168     9685    1   DCL KCL$HOOKUPM   ENTRY(1) ALTRET;
      169     9686    1   DCL KCL$HOOKUPMB  ENTRY ALTRET;
      170     9687    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      171     9688    1   DCL KQC$TELLJ     ENTRY(1) ALTRET;
      172     9689    1   DCL KQL$DELMLH    ENTRY(2) ALTRET;
      173     9690    1   DCL KQL$QXFDUN    ENTRY(1) ALTRET;
      174     9691    1   DCL KQM$GETB      ENTRY(3) ALTRET;
      175     9692    1   DCL KQM$GETDFR    ENTRY(3) ALTRET;
      176     9693    1   DCL KQM$GETMIN    ENTRY(3) ALTRET;
      177     9694    1   DCL KQM$MOREPG    ENTRY(1) ALTRET;
      178     9695    1   DCL KQM$RELB      ENTRY(3) ALTRET;
      179     9696    1   DCL KQQ$ACT       ENTRY(2) ALTRET;
      180     9697    1   DCL KQR$GETQUEUE  ENTRY(1) ALTRET;
      181     9698    1   DCL KQT$DELSTA    ENTRY(2) ALTRET;
      182     9699    1   DCL KQT$DELTYP    ENTRY(2) ALTRET;
      183     9700    1   DCL KQT$GETSTA    ENTRY(3) ALTRET;
      184     9701    1   DCL KQT$GETTYP    ENTRY(3) ALTRET;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:6    
      185     9702    1   DCL KQT$LBT       ENTRY(1) ALTRET;
      186     9703    1   DCL KQT$MOVQTN    ENTRY(2) ALTRET;
      187     9704    1   DCL KQT$UBT       ENTRY(1) ALTRET;
      188     9705    1   DCL KQT$VALREADS  ENTRY(1) ALTRET;
      189     9706    1   DCL SSR$REG       ENTRY(3) ALTRET;
      190     9707    1   DCL SSR$RUE       ENTRY(4);
      191     9708    1   DCL B$PS0$ PTR SYMREF READONLY;
      192     9709    1   DCL B$PS1$ PTR SYMREF READONLY;
      193     9710    1   DCL B$PS2$ PTR SYMREF READONLY;
      194     9711    1   DCL B$PS3$ PTR SYMREF READONLY;
      195     9712    1   DCL B$PS4$ PTR SYMREF READONLY;
      196     9713    1   DCL B$PS5$ PTR SYMREF READONLY;
      197     9714    1   DCL B$PS6$ PTR SYMREF READONLY;
      198     9715    1   DCL B$PS7$ PTR SYMREF READONLY;
      199     9716    1   DCL B$PS8$ PTR SYMREF READONLY;
      200     9717    1   DCL B$PS9$ PTR SYMREF READONLY;
      201     9718    1   DCL B$PS10$ PTR SYMREF READONLY;
      202     9719    1   DCL B$JIT$ PTR SYMREF;
      203     9720        %VLP_STATION (FPTN=KC_VLPSTATION,STCLASS=SYMREF);
      204     9747
      205     9748
      206     9749
      207     9750        /**/
      208     9751        /* SUBS */
      209     9752        /**/
      210     9753        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      211     9754        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
      212     9755        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      213     9756        %SUB KQ$DTREE="CG$->KQ$CG.DTREE";
      214     9757        %EQU_CG;
      215     9805        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:7    
      216     9806        /**/
      217     9807        /*F* NAME:         KQC$CGCTL
      218     9808             PURPOSE:      To process the M$CGCTL PMME
      219     9809             CALL:         KQC$CGCTL (MYSTA$)
      220     9810             DESCRIPTION:  Enter here from KCP$PMME after verifying that
      221     9811                           the PMME issuer is indeed the AU.
      222     9812        KQC$CGCTL: ENTRY (PARM$) ALTRET;
      223     9813        */
      224     9814        /**/
      225     9815    1         MYSTA$=PARM$;
      226     9816    1         CG$=MYSTA$->KQ$STA.CG$;
      227     9817    1         QLIST=0;
      228     9818    1         CALL HFF$DSIZ (5,DSIZ) ALTRET(NOQL);
      229     9819    1         NQ=DSIZ/LENGTHC(VLP$CGQL.LIST(0));
      230     9820    1         QLIST=1;
      231     9821    1         JFLG=0;
      232     9822    1   NOQL: ;
      233     9823        /**/
      234     9824
      235     9825                 /****************************************
      236     9826                  *                                      *
      237     9827                  *        PROCESS SPECIAL STATIONS      *
      238     9828                  *                                      *
      239     9829                  ****************************************/
      240     9830
      241     9831    1         CALL SPCLSTA (B$PS8$,CG$->KQ$CG.HOLDSTA$) ALTRET(ERROR);
      242     9832    1         IF CG$->KQ$CG.JRNLSTA$ ~= ADDR(NIL) THEN
      243     9833    1          JNAME=CG$->KQ$CG.JRNLSTA$->KQ$STA.BTN.KEY;
      244     9834    1         ELSE JNAME=' ';
      245     9835    1         CALL SPCLSTA (B$PS9$,CG$->KQ$CG.JRNLSTA$) ALTRET(ERROR);
      246     9836    1         IF CG$->KQ$CG.JRNLSTA$ ~= ADDR(NIL) THEN
      247     9837    1          IF JNAME ~= CG$->KQ$CG.JRNLSTA$->KQ$STA.BTN.KEY THEN JFLG=1;
      248     9838    1          ELSE;
      249     9839    1         ELSE IF JNAME ~= ' ' THEN JFLG=1;
      250     9840
      251     9841                 /****************************************
      252     9842                  *                                      *
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:8    
      253     9843                  *        PROCESS JOURNAL FID           *
      254     9844                  *                                      *
      255     9845                  ****************************************/
      256     9846
      257     9847    1         CALL HFF$ERASE (B$PS10$) ALTRET(JFERASE);
      258     9848    1         GOTO CHKJF;
      259     9849    1   JFERASE:;
      260     9850    1         CALL RELJF ALTRET(ERROR);
      261     9851    1         GOTO NOJF;
      262     9852    1   CHKJF: ;
      263     9853    1         CALL HFF$DSIZ (B$PS10$,I);
      264     9854    1         IF I ~= 0 THEN
      265     9855    2           DO;
      266     9856    2           IF I <= SIZEC(VLP$JRNLFIDV.L#)
      267     9857    2           OR I > KQ_MCMAX# THEN
      268     9858    3             DO;
      269     9859    3   BDJFID:   ;
      270     9860    3             B$JIT.ERR=E_BDJFID;
      271     9861        /*E* ERROR:   KQC-E$BDJFID-E
      272     9862             MESSAGE: Bad JRNLFID passed to M$CGCTL
      273     9863             MESSAGE1: The JRNLFID parameter in your M$CGCTL service is
      274     9864                       inaccessible or too small, or too large.
      275     9865        */
      276     9866    3             GOTO ERROR;
      277     9867    3             END;
      278     9868    2           CALL HFF$PTPRES (B$PS10$) ALTRET(BDJFID);
      279     9869    2           IF I < SIZEC(B$PS10$->VLP$JRNLFIDV) THEN GOTO BDJFID;
      280     9870    2           CALL GETJF ALTRET(ERROR);
      281     9871    2           END;
      282     9872    1   NOJF: ;
      283     9873        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:9    
      284     9874        /**/
      285     9875
      286     9876                 /****************************************
      287     9877                  *                                      *
      288     9878                  *        PROCESS CONTROL PARAMS        *
      289     9879                  *                                      *
      290     9880                  ****************************************/
      291     9881
      292     9882    1         CALL HFF$NILERASE (3) ALTRET(NOCTL);
      293     9883    1         PRIO=VLP$CGCP.STAPRIO;
      294     9884    1         CALL CHKPRI ALTRET(ERROR);
      295     9885    1         PRIO=VLP$CGCP.TYPPRIO;
      296     9886    1         CALL CHKPRI ALTRET(ERROR);
      297     9887    1         CGCP=VLP$CGCP;
      298     9888    1         CALL CHKTYP (CGCP.DMTYP) ALTRET (ERROR);
      299     9889    1         CALL CHKTYP (CGCP.TMTYP) ALTRET (ERROR);
      300     9890    1         IF CGCP.DEFERBLKS > 200 THEN CGCP.DEFERBLKS=200;
      301     9891    1         ELSE IF CGCP.DEFERBLKS < 5 THEN CGCP.DEFERBLKS=5;
      302     9892    1         IF CGCP.MINRD < 2 THEN CGCP.MINRD=2;
      303     9893    1         IF CGCP.MAXRD < 3 THEN CGCP.MAXRD=3;
      304     9894    1         IF CGCP.MINRD > CGCP.MAXRD THEN CGCP.MAXRD=CGCP.MINRD;
      305     9895    1         IF CGCP.MINPG < 2 THEN CGCP.MINPG=2;
      306     9896    1         IF CGCP.MAXPG < 3 THEN CGCP.MAXPG=3;
      307     9897    1         IF CGCP.MINPG > CGCP.MAXPG THEN CGCP.MAXPG=CGCP.MINPG;
      308     9898    1         IF CGCP.SECURE THEN
      309     9899    2           DO;
      310     9900    2           CGCP.WAS='1'B;
      311     9901    2           CGCP.SMD='1'B;
      312     9902    2           END;
      313     9903    1         ELSE IF CGCP.SMD = '0'B THEN CGCP.WAS='0'B;
      314     9904    1         IF NOT CGCP.CONMSG THEN
      315     9905    2           DO;
      316     9906    2           CGCP.DSCREQ='0'B;
      317     9907    2           CGCP.DCBCONWA='0'B;
      318     9908    2           END;
      319     9909    1         IF CGCP.MAXMC > KQ_MCMAX# THEN
      320     9910    1          CGCP.MAXMC = KQ_MCMAX#;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:10   
      321     9911    1         IF CGCP.TRMRDSIZ = 0 OR CGCP.TRMRDSIZ > CGCP.MAXMC THEN CGCP.TRMRDSIZ=CGCP.
              9911                  MAXMC;
      322     9912    1         IF CGCP.JOURNAL ~= CG$->KQ$CG.AUCTL.JOURNAL THEN JFLG=1;
      323     9913    1         IF KQ$CG.AUCTL.TERMCONLGL = '0'B AND CGCP.TERMCONLGL THEN TOKFLG=0;
      324     9914    1         ELSE TOKFLG=1;
      325     9915        /**/
      326     9916              %LOCK (G=KQ$DTREE.GATE);
      327     9919    1         IF CGCP.MAXPG > CG$->KQ$CG.NGAVAL THEN
      328     9920    2           DO;
      329     9921                %UNLOCK (G=KQ$DTREE.GATE);
      330     9924    2           B$JIT.ERR=E_CGMPEN;
      331     9925        /*E* ERROR:   KQC-E$CGMPEN-E
      332     9926             MESSAGE: Your file is too small for that MAXPG value
      333     9927             MESSAGE1: A comgroup file must always have MAXPG free granules
      334     9928                       in it, for system recovery processing.  This error
      335     9929                       results from attempting to increase MAXPG when the
      336     9930                       file has too few free granules. */
      337     9931    2           GOTO ERROR;
      338     9932    2           END;
      339     9933    1         IF (CGCP.DISKWARN > 0) AND (CGCP.REDISKWARN < 2)
      340     9934    1         THEN CGCP.REDISKWARN = MAXIMUM (2,CGCP.DISKWARN/4);
      341     9935
      342     9936              /* REcalculate KQ$CG.TRIGGER when CGCP changes */
      343     9937    1         KQ$CG.TRIGGER = CGCP.DISKWARN + CGCP.MAXPG;
      344     9938    1         I=CG$->KQ$CG.NGAVAL-CG$->KQ$CG.AUCTL.MAXPG;
      345     9939    1         IF I >= CGCP.DISKWARN THEN
      346     9940    1          IF CG$->KQ$CG.NGAVAL-CGCP.MAXPG < CGCP.DISKWARN THEN
      347     9941    2            DO;
      348     9942                 %LOCK (G=CG$->KQ$CG.GATE.CG);
      349     9945    2            CG$->KQ$CG.DELAY.DISKWARN='1'B;
      350     9946    2            CG$->KQ$CG.TRIGGERED='1'B;
      351     9947                 %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      352     9950    2            END;
      353     9951    1         I=CG$->KQ$CG.MMD.MAXBPG;
      354     9952    1         CG$->KQ$CG.AUCTL=CGCP;
      355     9953              %UNLOCK (G=KQ$DTREE.GATE);
      356     9956        /**/
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:11   
      357     9957    1         CALL CXTSET ALTRET(ERROR);
      358     9958    1         IF CG$->KQ$CG.MMD.MAXBPG > I THEN
      359     9959    1          CALL KQM$MOREPG (CG$->KQ$CG);
      360     9960    1         DCB$=B$JIT$->B$JIT.DCB$;
      361     9961    1         IF DCB$->F$DCB.ACCT=':SYS' THEN
      362     9962    2           DO;
      363     9963    2           IF ADDR(DCB$->F$DCB.NAME)->VTXTC.TXT='CSCG' THEN CALL KCL$HOOKUPM;
      364     9964    2           ELSE IF ADDR(DCB$->F$DCB.NAME)->VTXTC.TXT='OCCG' THEN CALL KCL$HOOKUPH;
      365     9965    2            ELSE IF ADDR(DCB$->F$DCB.NAME)->VTXTC.TXT='HLPCG' THEN
      366     9966    3               DO;
      367     9967    3               CALL KCL$HOOKUPMB;
      368     9968    3               TOKFLG=1;
      369     9969    3               END;
      370     9970    2           END;
      371     9971    1         IF TOKFLG=0 THEN CALL TRMGO;  /* CONNECT WAITING TERMS */
      372     9972    1   NOCTL:;
      373     9973        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:12   
      374     9974
      375     9975                 /****************************************
      376     9976                  *                                      *
      377     9977                  *        PROCESS TYP LIST              *
      378     9978                  *                                      *
      379     9979                  ****************************************/
      380     9980
      381     9981    1         CALL HFF$DSIZ (1,DSIZ) ALTRET(NOTYPL);
      382     9982    1         NTYP=(DSIZ-4)/LENGTHC(VLP$CGTYPL.LIST(0));
      383     9983    1         IF NTYP = 0 THEN GOTO NOTYPL;
      384     9984    1         IF  QLIST ~= 0
      385     9985    1         AND CG$->KQ$CG.QISS = '0'B THEN
      386     9986    1          IF NQ < NTYP THEN
      387     9987    2            DO;
      388     9988    2   IQLS:    ;
      389     9989    2            B$JIT.ERR=E_CGIQLS;
      390     9990        /*E* ERROR:   KQC-E$CGIQLS-E
      391     9991             MESSAGE: Insufficient QLIST area space for M$CGCTL
      392     9992             MESSAGE1: The QLIST area specified by your M$CGCTL service
      393     9993                       is not as long as the list (STALIST or TYPLIST) it
      394     9994                       is parallel to. */
      395     9995    2            GOTO ERROR;
      396     9996    2            END;
      397     9997    2           DO CASE (FPT$CGCTL.TYPFC);
      398     9998
      399     9999                           /******************************
      400    10000                            *        SETLIST             *
      401    10001                            ******************************/
      402    10002    2             CASE (%CG_CTLFC_SETLIST#);
      403    10003    2               CALL TLOCK;
      404    10004    2               DFCHK=0;
      405    10005    2               MTYP$=KQ$TTREE.HEAD$;
      406    10006    3                 DO WHILE (MTYP$ ~= ADDR(NIL));
      407    10007    3                 MTYP$->KQ$MTYP.DFCHK='0'B;
      408    10008    3                 MTYP$=MTYP$->KQ$MTYP.BTN.FLINK$;
      409    10009    3                 END;
      410    10010    2               CALL TUNLOCK;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:13   
      411    10011    2               GOTO ADDTYP0;
      412    10012
      413    10013                           /******************************
      414    10014                            *          ADD               *
      415    10015                            ******************************/
      416    10016    2             CASE (%CG_CTLFC_ADD#);
      417    10017    2   ADDTYP0:    ;
      418    10018    2               CALL HFF$TRAPALT ALTRET(TYPTRAP);
      419    10019    3                 DO TYPX = 0 TO NTYP-1;
      420    10020    3                 CALL TLOCK;
      421    10021    3                 KEY=VLP$CGTYPL.LIST.NAME(TYPX);
      422    10022    3                 CALL KQB$SRCH (KQ$TTREE,KEY,MTYP$) ALTRET(NOTYP0);
      423    10023    3                 GOTO GOTTYP0;
      424    10024    3   NOTYP0:       ;
      425    10025    3                 CALL INDEX (I,SUBSTR(KEY,0,1),KC_LGL1ST) ALTRET(BADTYPCHR);
      426    10026    3                 MTYP$=MYSTA$;
      427    10027    3                 CALL KQT$GETTYP (CG$->KQ$CG,MTYP$,KEY) ALTRET(NOTYPMEM);
      428    10028    3   GOTTYP0:      ;
      429    10029    3                 IF KEY = CG$->KQ$CG.AUCTL.DMTYP THEN DFCHK=DFCHK+1;
      430    10030    3                 IF KEY = CG$->KQ$CG.AUCTL.TMTYP THEN DFCHK=DFCHK+1;
      431    10031    3                 MTYP$->KQ$MTYP.DFCHK='1'B;
      432    10032    3                 MTYP$->KQ$MTYP.PERM=VLP$CGTYPL.LIST.PERM(TYPX);
      433    10033    3                 MTYP$->KQ$MTYP.JOURNAL=VLP$CGTYPL.LIST.JOURNAL(TYPX);
      434    10034    3                 MTYP$->KQ$MTYP.ONEREPORT=VLP$CGTYPL.LIST.ONEREPORT(TYPX);
      435    10035    3                 MTYP$->KQ$MTYP.MAXLATCH=VLP$CGTYPL.LIST.MAXLATCH(TYPX);
      436    10036    3                 PRIO=VLP$CGTYPL.LIST.PRIO(TYPX);
      437    10037    3                 CALL CHKPRI ALTRET(TYPALT);
      438    10038    3                 MTYP$->KQ$MTYP.MPRIO=PRIO;
      439    10039    3                 IF CG$->KQ$CG.QISS = '0'B THEN
      440    10040    4                   DO;
      441    10041    4                   IF QLIST ~= 0 THEN
      442    10042    4                    MTYP$->KQ$QTN.AUTORCVR=VLP$CGQL.LIST.AUTORCVR(TYPX);
      443    10043    4                   CALL SETPRIO (MTYP$);
      444    10044    4                   CALL SETMXACT (MTYP$,TYPX);
      445    10045    4                   END;
      446    10046    3                 CALL TUNLOCK;
      447    10047    3                 END;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:14   
      448    10048    2               CALL HFF$TRAPALT;
      449    10049    2               IF FPT$CGCTL.TYPFC = %CG_CTLFC_SETLIST# THEN
      450    10050    3                 DO;
      451    10051    3                 IF DFCHK < 2 THEN
      452    10052    4                   DO;
      453    10053    4                   B$JIT.ERR=E_CGMSDT;
      454    10054        /*E* ERROR:   KQC-E$CGMSDT-E
      455    10055             MESSAGE: M$CGCTL SET TYPE LIST must set the default types
      456    10056             MESSAGE1: The message type list supplied with M$CGCTL was
      457    10057                       supposed to be the entire list (TYPFC=SETLIST),
      458    10058                       yet did not include the default TERMINAL and
      459    10059                       DCB message types (VLP_CGCP.TMTYP, VLP_CGCP.DMTYP).
      460    10060                       This is not legal, and, while the supplied list
      461    10061                       has been added, none of those types not in the
      462    10062                       list have been deleted. */
      463    10063    4                   GOTO ERROR;
      464    10064    4                   END;
      465    10065    3                 IF CG$->KQ$CG.AUCTL.XTYPLGL = '0'B THEN
      466    10066    4                   DO;
      467    10067    4                   CALL TLOCK;
      468    10068    4                   MTYP$=KQ$TTREE.HEAD$;
      469    10069    5                     DO WHILE (MTYP$ ~= ADDR(NIL));
      470    10070    5                     IF MTYP$->KQ$MTYP.DFCHK = '0'B THEN
      471    10071    6                       DO;
      472    10072    6                       FLINK$=MTYP$->KQ$MTYP.BTN.FLINK$;
      473    10073    6                       CALL DELTYP ALTRET(ERROR);
      474    10074    6                       MTYP$=FLINK$;
      475    10075    6                       END;
      476    10076    5                     ELSE MTYP$=MTYP$->KQ$MTYP.BTN.FLINK$;
      477    10077    5                     END;
      478    10078    4                   CALL TUNLOCK;
      479    10079    4                   END;
      480    10080    3                 END;
      481    10081
      482    10082                           /******************************
      483    10083                            *          DELETE            *
      484    10084                            ******************************/
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:15   
      485    10085    2             CASE (%CG_CTLFC_DELETE#);
      486    10086    3                 DO TYPX = 0 TO NTYP-1;
      487    10087    3                 CALL TLOCK;
      488    10088    3                 CALL HFF$TRAPALT ALTRET(TYPTRAPB);
      489    10089    3                 KEY=VLP$CGTYPL.LIST.NAME(TYPX);
      490    10090    3                 CALL KQB$SRCH (KQ$TTREE,KEY,MTYP$) ALTRET(NOTYP1);
      491    10091    3                 IF KEY = CG$->KQ$CG.AUCTL.DMTYP
      492    10092    3                 OR KEY = CG$->KQ$CG.AUCTL.TMTYP THEN
      493    10093    4                   DO;
      494    10094    4                   B$JIT.ERR=E_CGCDDT;
      495    10095        /*E* ERROR:   KQC-E$CGCDDT-E
      496    10096             MESSAGE: M$CGCTL cannot delete a default message type
      497    10097             MESSAGE1: You specified a message type for deletion which
      498    10098                       was the default type for messages from terminals
      499    10099                       or DCBs.  This is illegal. */
      500    10100    4                   CALL TUNLOCK;
      501    10101    4                   GOTO ERROR;
      502    10102    4                   END;
      503    10103    3                 CALL DELTYP ALTRET(ERROR);
      504    10104    3   NOTYP1:       ;
      505    10105    3                 CALL TUNLOCK;
      506    10106    3                 END;
      507    10107    2               CALL HFF$TRAPALT;
      508    10108
      509    10109                           /******************************
      510    10110                            *        CHANGE ATTRS        *
      511    10111                            ******************************/
      512    10112    2             CASE (%CG_CTLFC_CHGATTR#);
      513    10113    2               CALL HFF$TRAPALT ALTRET(TYPTRAP);
      514    10114    3                 DO TYPX = 0 TO NTYP-1;
      515    10115    3                 CALL TLOCK;
      516    10116    3                 KEY=VLP$CGTYPL.LIST.NAME(TYPX);
      517    10117    3                 CALL KQB$SRCH (KQ$TTREE,KEY,MTYP$) ALTRET(NOTYP2);
      518    10118    3                 IF FPT$CGCTL.ATTRS.PERM THEN
      519    10119    3                  MTYP$->KQ$MTYP.PERM=VLP$CGTYPL.LIST.PERM(TYPX);
      520    10120    3                 IF FPT$CGCTL.ATTRS.JOURNAL THEN
      521    10121    3                  MTYP$->KQ$MTYP.JOURNAL=VLP$CGTYPL.LIST.JOURNAL(TYPX);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:16   
      522    10122    3                 IF FPT$CGCTL.ATTRS.ONEREPORT THEN
      523    10123    3                  MTYP$->KQ$MTYP.ONEREPORT=VLP$CGTYPL.LIST.ONEREPORT(TYPX);
      524    10124    3                 IF FPT$CGCTL.ATTRS.MAXLATCH THEN
      525    10125    3                  MTYP$->KQ$MTYP.MAXLATCH=VLP$CGTYPL.LIST.MAXLATCH(TYPX);
      526    10126    3                 IF FPT$CGCTL.ATTRS.PRIO THEN
      527    10127    4                   DO;
      528    10128    4                   PRIO=VLP$CGTYPL.LIST.PRIO(TYPX);
      529    10129    4                   CALL CHKPRI ALTRET(TYPALT);
      530    10130    4                   MTYP$->KQ$MTYP.MPRIO=PRIO;
      531    10131    4                   IF CG$->KQ$CG.QISS = '0'B THEN CALL SETPRIO (MTYP$);
      532    10132    4                   END;
      533    10133    3                 IF  FPT$CGCTL.ATTRS.MXACT
      534    10134    3                 AND CG$->KQ$CG.QISS = '0'B THEN
      535    10135    3                  CALL SETMXACT (MTYP$,TYPX);
      536    10136    3                 CALL TUNLOCK;
      537    10137    3                 END;
      538    10138    2               CALL HFF$TRAPALT;
      539    10139
      540    10140    2             CASE (ELSE);
      541    10141    2   BADOPT:     ;
      542    10142    2               B$JIT.ERR=E_CGUAFC;
      543    10143        /*E* ERROR:   KQC-E$CGUAFC-E
      544    10144             MESSAGE: Unknown M$CGCTL function code
      545    10145             MESSAGE1: The STAFC or TYPFC code in your M$CGCTL FPT is
      546    10146                       unknown. */
      547    10147    2               GOTO ERROR;
      548    10148
      549    10149
      550    10150    2           END; /*CASE FPT$CGCTL.TYPFC */
      551    10151    1         GOTO NOTYPL;
      552    10152    1   BADTYPCHR:;
      553    10153    1         B$JIT.ERR=E_TYPCHR;
      554    10154        /*E* ERROR:   KQC-E$TYPCHAR-E
      555    10155             MESSAGE: Illegal character in message type on M$CGCTL
      556    10156             MESSAGE1: A message type supplied to M$CGCTL had an illegal
      557    10157                       first character. */
      558    10158    1         GOTO TYPALT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:17   
      559    10159    1   NOTYP2:;
      560    10160    1         B$JIT.ERR=E_CGAFNT;
      561    10161        /*E* ERROR:   KQC-E$CGAFNT
      562    10162             MESSAGE: M$CGCTL can't find that message type
      563    10163             MESSAGE1: One of the message types specified in your M$CGCTL
      564    10164                       service's TYPLIST could not be found. */
      565    10165    1   TYPALT:;
      566    10166    1         CALL TUNLOCK;
      567    10167    1   ERROR:;
      568    10168    1         CALL KQT$VALREADS (CG$->KQ$CG);
      569    10169    1   ALTRT:;
      570    10170    1         ALTRETURN;
      571    10171    1   NOTYPMEM:;
      572    10172    1   NOMEM:;
      573    10173    1         CALL SETNOMEM;
      574    10174    1         GOTO ERROR;
      575    10175    1   TYPTRAPB:;
      576    10176    1   TYPTRAP:;
      577    10177    1         CALL TUNLOCK;
      578    10178    1   TYPTRAP0:;
      579    10179    1         B$JIT.ERR=E_CGTTRP;
      580    10180        /*E* ERROR:   KQC-E$CGTTRP-E
      581    10181             MESSAGE: Bad TYPLIST or QLIST area specified by M$CGCTL
      582    10182             MESSAGE1: Either the TYPLIST or QLIST area specified by your
      583    10183                       M$CGCTL service is inaccessible. */
      584    10184    1         GOTO ERROR;
      585    10185    1   NOTYPL:;
      586    10186        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:18   
      587    10187        /**/
      588    10188
      589    10189                 /****************************************
      590    10190                  *                                      *
      591    10191                  *        PROCESS STA LIST              *
      592    10192                  *                                      *
      593    10193                  ****************************************/
      594    10194
      595    10195    1         CALL HFF$DSIZ (2,DSIZ) ALTRET(NOSTAL);
      596    10196    1         NSTA=(DSIZ-4)/LENGTHC(VLP$CGSTAL.LIST(0));
      597    10197    1         IF NSTA = 0 THEN GOTO NOSTAL;
      598    10198    1         IF  QLIST ~= 0
      599    10199    1         AND CG$->KQ$CG.QISS THEN
      600    10200    1          IF NQ < NSTA THEN GOTO IQLS;
      601    10201    2           DO CASE (FPT$CGCTL.STAFC);
      602    10202
      603    10203                           /******************************
      604    10204                            *        SETLIST             *
      605    10205                            ******************************/
      606    10206    2             CASE (%CG_CTLFC_SETLIST#);
      607    10207    2               CALL SLOCK;
      608    10208    2               DFCHK=0;
      609    10209    2               STA$=KQ$STREE.HEAD$;
      610    10210    3                 DO WHILE (STA$ ~= ADDR(NIL));
      611    10211    3                 STA$->KQ$STA.DFCHK='0'B;
      612    10212    3                 STA$=STA$->KQ$STA.BTN.FLINK$;
      613    10213    3                 END;
      614    10214    2               CALL SUNLOCK;
      615    10215    2               GOTO ADDSTA0;
      616    10216
      617    10217                           /******************************
      618    10218                            *          ADD               *
      619    10219                            ******************************/
      620    10220    2             CASE (%CG_CTLFC_ADD#);
      621    10221    2   ADDSTA0:    ;
      622    10222    2               CALL HFF$TRAPALT ALTRET(STATRAP);
      623    10223    3                 DO STAX = 0 TO NSTA-1;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:19   
      624    10224    3                 CALL SLOCK;
      625    10225    3                 KEY=VLP$CGSTAL.LIST.NAME(STAX);
      626    10226    3                 CALL KQB$SRCH (KQ$STREE,KEY,STA$) ALTRET(NOSTA0);
      627    10227    3                 GOTO GOTSTA0;
      628    10228    3   NOSTA0:       ;
      629    10229    3                 CALL INDEX (I,SUBSTR(KEY,0,1),KC_LGL1ST) ALTRET(BADSTACHR);
      630    10230    3                 STA$=MYSTA$;
      631    10231    3                 CALL KQT$GETSTA (CG$->KQ$CG,STA$,KEY) ALTRET(NOMEM);
      632    10232    3   GOTSTA0:      ;
      633    10233                      %LOCK (G=STA$->KQ$STA.GATE);
      634    10236    3                 STA$->KQ$STA.DFCHK='1'B;
      635    10237    3                 STA$->KQ$STA.AUP=VLP$CGSTAL.LIST.AUP(STAX);
      636    10238    3                 STA$->KQ$STA.PERM=VLP$CGSTAL.LIST.PERM(STAX);
      637    10239    3                 PRIO=VLP$CGSTAL.LIST.PRIO(STAX);
      638    10240    3                 CALL CHKPRI ALTRET(STAALT0);
      639    10241    3                 STA$->KQ$STA.MPRIO=PRIO;
      640    10242                      %UNLOCK (G=STA$->KQ$STA.GATE);
      641    10245    3                 IF CG$->KQ$CG.QISS THEN
      642    10246    4                   DO;
      643    10247    4                   IF QLIST ~= 0 THEN
      644    10248    4                    STA$->KQ$QTN.AUTORCVR=VLP$CGQL.LIST.AUTORCVR(STAX);
      645    10249    4                   CALL SETPRIO (STA$);
      646    10250    4                   CALL SETMXACT (STA$,STAX);
      647    10251    4                   END;
      648    10252    3                 CALL SUNLOCK;
      649    10253    3                 END;
      650    10254    2               CALL HFF$TRAPALT;
      651    10255    2               IF FPT$CGCTL.STAFC = %CG_CTLFC_SETLIST# THEN
      652    10256    2                IF CG$->KQ$CG.AUCTL.XSTALGL = '0'B THEN
      653    10257    3                  DO;
      654    10258    3                  CALL SLOCK;
      655    10259    3                  STA$=KQ$STREE.HEAD$;
      656    10260    4                    DO WHILE (STA$ ~= ADDR(NIL));
      657    10261    4                    IF  STA$->KQ$STA.DFCHK = '0'B
      658    10262    4                    AND NOT STA$->KQ$STA.SPECIAL THEN
      659    10263    5                      DO;
      660    10264    5                      FLINK$=STA$->KQ$STA.BTN.FLINK$;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:20   
      661    10265    5                      CALL DELSTA ALTRET(ERROR);
      662    10266    5                      STA$=FLINK$;
      663    10267    5                      END;
      664    10268    4                    ELSE STA$=STA$->KQ$STA.BTN.FLINK$;
      665    10269    4                    END;
      666    10270    3                  CALL SUNLOCK;
      667    10271    3                  END;
      668    10272
      669    10273                           /******************************
      670    10274                            *          DELETE            *
      671    10275                            ******************************/
      672    10276    2             CASE (%CG_CTLFC_DELETE#);
      673    10277    3                 DO STAX = 0 TO NSTA-1;
      674    10278    3                 CALL SLOCK;
      675    10279    3                 CALL HFF$TRAPALT ALTRET(STATRAPB);
      676    10280    3                 KEY=VLP$CGSTAL.LIST.NAME(STAX);
      677    10281    3                 CALL KQB$SRCH (KQ$STREE,KEY,STA$) ALTRET(NOSTA1);
      678    10282    3                 IF NOT STA$->KQ$STA.SPECIAL THEN
      679    10283    3                  CALL DELSTA ALTRET(ERROR);
      680    10284    3   NOSTA1:       ;
      681    10285    3                 CALL SUNLOCK;
      682    10286    3                 END;
      683    10287    2               CALL HFF$TRAPALT;
      684    10288
      685    10289                           /******************************
      686    10290                            *        CHANGE ATTRS        *
      687    10291                            ******************************/
      688    10292    2             CASE (%CG_CTLFC_CHGATTR#);
      689    10293    2               CALL HFF$TRAPALT ALTRET(STATRAPB);
      690    10294    3                 DO STAX = 0 TO NSTA-1;
      691    10295    3                 CALL SLOCK;
      692    10296    3                 KEY=VLP$CGSTAL.LIST.NAME(STAX);
      693    10297    3                 CALL KQB$SRCH (KQ$STREE,KEY,STA$) ALTRET(NOSTA2);
      694    10298                      %LOCK (G=STA$->KQ$STA.GATE);
      695    10301    3                 IF FPT$CGCTL.ATTRS.PERM THEN
      696    10302    3                  STA$->KQ$STA.PERM=VLP$CGSTAL.LIST.PERM(STAX);
      697    10303    3                 IF FPT$CGCTL.ATTRS.AUP THEN
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:21   
      698    10304    3                  STA$->KQ$STA.AUP=VLP$CGSTAL.LIST.AUP(STAX);
      699    10305                      %UNLOCK (G=STA$->KQ$STA.GATE);
      700    10308    3                 IF FPT$CGCTL.ATTRS.PRIO THEN
      701    10309    4                   DO;
      702    10310    4                   PRIO=VLP$CGSTAL.LIST.PRIO(STAX);
      703    10311    4                   CALL CHKPRI ALTRET(STAALT);
      704    10312                        %LOCK (G=STA$->KQ$STA.GATE);
      705    10315    4                   STA$->KQ$STA.MPRIO=PRIO;
      706    10316                        %UNLOCK (G=STA$->KQ$STA.GATE);
      707    10319    4                   IF CG$->KQ$CG.QISS THEN CALL SETPRIO (STA$);
      708    10320    4                   END;
      709    10321    3                 IF  FPT$CGCTL.ATTRS.MXACT
      710    10322    3                 AND CG$->KQ$CG.QISS THEN
      711    10323    3                  CALL SETMXACT (STA$,STAX);
      712    10324    3                 CALL SUNLOCK;
      713    10325    3                 END;
      714    10326    2               CALL HFF$TRAPALT;
      715    10327
      716    10328    2             CASE (ELSE);
      717    10329    2               GOTO BADOPT;
      718    10330
      719    10331    2           END; /*CASE FPT$CGCTL.STAFC */
      720    10332    1         GOTO NOSTAL;
      721    10333    1   BADSTACHR:;
      722    10334    1         CALL SETBSC;
      723    10335    1         GOTO STAALT;
      724    10336    1   NOSTA2:;
      725    10337    1         B$JIT.ERR=E_CGAFNS;
      726    10338        /*E* ERROR:   KQC-E$CGAFNS
      727    10339             MESSAGE: M$CGCTL can't find that station
      728    10340             MESSAGE1: One of the stations specified in your M$CGCTL
      729    10341                       service's STALIST could not be found. */
      730    10342    1   STAALT:;
      731    10343    1         CALL SUNLOCK;
      732    10344    1         GOTO ERROR;
      733    10345    1   STAALT0:;
      734    10346              %UNLOCK (G=STA$->KQ$STA.GATE);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:22   
      735    10349    1         GOTO STAALT;
      736    10350    1   STATRAPB:;
      737    10351    1   STATRAP:;
      738    10352    1         CALL SUNLOCK;
      739    10353    1   STATRAP0:;
      740    10354    1         B$JIT.ERR=E_CGSTRP;
      741    10355        /*E* ERROR:   KQC-E$CGSTRP-E
      742    10356             MESSAGE: Bad STALIST or QLIST area specified by M$CGCTL
      743    10357             MESSAGE1: Either the STALIST or QLIST area specified by your
      744    10358                       M$CGCTL service is inaccessible. */
      745    10359    1         GOTO ERROR;
      746    10360    1   NOSTAL:;
      747    10361        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:23   
      748    10362        /**/
      749    10363
      750    10364                 /****************************************
      751    10365                  *                                      *
      752    10366                  *        PROCESS VLP_SETSTA            *
      753    10367                  *                                      *
      754    10368                  ****************************************/
      755    10369
      756    10370    1         CALL HFF$NILERASE (4) ALTRET(NOSETSTA);
      757    10371    1         SETSTA=VLP$SETSTA;
      758    10372              %LOCK (G=CG$->KQ$CG.GATE.CG);
      759    10375    1         CG$->KQ$CG.SETSTA=SETSTA;
      760    10376              %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      761    10379    1   NOSETSTA:;
      762    10380    1   PMMEND:;
      763    10381    1         IF JFLG ~= 0 THEN CALL KQC$TELLJ (CG$->KQ$CG.CFU$) ALTRET(ERROR);
      764    10382    1         CALL KQT$VALREADS (CG$->KQ$CG);
      765    10383    1         RETURN;
      766    10384        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:24   
      767    10385        /**/
      768    10386        /*F* NAME:         KQC$CXTSET
      769    10387             PURPOSE:      To set up a context block during initial create
      770    10388                           open
      771    10389             DESCRIPTION:  Calls CXTSET to merge the control params through
      772    10390                           the context block.
      773    10391        */
      774    10392    1   KQC$CXTSET: ENTRY (PARM$) ALTRET; /* !!Doesn't ALTRET!! */
      775    10393        /**/
      776    10394    1         CG$=PARM$;
      777    10395    1         CALL CXTSET;
      778    10396    1         RETURN;
      779    10397        /**/
      780    10398        /*F* NAME:         KQC$CXTSET1
      781    10399             PURPOSE:      To ensure the default types are present
      782    10400             CALL:         KQC$CXTSET1 (MYSTA$)
      783    10401             DESCRIPTION:  Gets them if not there.  Returns B$JIT.ERR
      784    10402                           set if they are illegal, or if no memory
      785    10403                           is available.
      786    10404        */
      787    10405    1   KQC$CXTSET1: ENTRY (PARM$) ALTRET;
      788    10406        /**/
      789    10407    1         MYSTA$=PARM$;
      790    10408    1         CG$=MYSTA$->KQ$STA.CG$;
      791    10409    1         CALL CHKTYP (CG$->KQ$CG.AUCTL.DMTYP) ALTRET(ALTRT);
      792    10410    1         CALL CHKTYP (CG$->KQ$CG.AUCTL.TMTYP) ALTRET(ALTRT);
      793    10411    1   RTN:  ;
      794    10412    1         RETURN;
      795    10413        /**/
      796    10414        /*F* NAME:         KQC$TRMCK
      797    10415             PURPOSE:      To connect waiting terminals when a comgroup is
      798    10416                           opened update with terminal connect legal
      799    10417             CALL:         KQC$TRMCK (CG$)
      800    10418             DESCRIPTION:  Calls TRMGO to tell communications accounting in
      801    10419                           ELF to connect the devices if TERMCONLGL is
      802    10420                           set in the comgroup context block.  If it is
      803    10421                           not, the M$CGCTL PMME will tell ELF when terminals
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:25   
      804    10422                           are allowed.
      805    10423                           Must be called on behalf of user.
      806    10424        */
      807    10425    1   KQC$TRMCK: ENTRY (PARM$) ALTRET; /* !!Doesn't ALTRET!! */
      808    10426        /**/
      809    10427    1         CG$=PARM$;
      810    10428    1         IF KQ$CG.AUCTL.TERMCONLGL THEN CALL TRMGO;
      811    10429    1         RETURN;
      812    10430        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:26   
      813    10431        /**/
      814    10432        /*********************************************************************************
      815    10433        *                                                                                *
      816    10434        *   SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS    *
      817    10435        *  S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S   *
      818    10436        *  S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S       *
      819    10437        *   SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS    *
      820    10438        *      S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S   *
      821    10439        *  S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S   *
      822    10440        *   SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS    *
      823    10441        *                                                                                *
      824    10442        *********************************************************************************/
      825    10443
      826    10444        /****************************************************************
      827    10445        *****************************************************************/
      828    10446        /*D* NAME:         TLOCK, TUNLOCK, SLOCK, SUNLOCK
      829    10447             PURPOSE:      To lock and unlock the T- and S-tree gates
      830    10448        */
      831    10449    1   TLOCK: PROC;
      832    10450        %LOCK (G=KQ$TTREE.GATE);
      833    10453    2         RETURN;
      834    10454    2   TUNLOCK: ENTRY;
      835    10455              %UNLOCK (G=KQ$TTREE.GATE);
      836    10458    2         RETURN;
      837    10459    2   SLOCK: ENTRY;
      838    10460              %LOCK (G=KQ$STREE.GATE);
      839    10463    2         RETURN;
      840    10464    2   SUNLOCK: ENTRY;
      841    10465              %UNLOCK (G=KQ$STREE.GATE);
      842    10468    2         RETURN;
      843    10469    2   END TLOCK;
      844    10470        /****************************************************************
      845    10471        *****************************************************************/
      846    10472        /*D* NAME:         DELTYP
      847    10473             PURPOSE:      To delete a message type
      848    10474             DESCRIPTION:  Called with T-tree gate locked.  Exits when
      849    10475                           done with T-tree gate locked, unless error
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:27   
      850    10476                           (ALTRET with gate unlocked, B$JIT.ERR set).
      851    10477        */
      852    10478    1   DELTYP: PROC ALTRET;
      853    10479    2         IF CG$->KQ$CG.QISS = '0'B THEN
      854    10480    3           DO;
      855    10481    3           CALL TUNLOCK;
      856    10482    3           CALL KQR$GETQUEUE (MYSTA$->KQ$STA);
      857    10483    3           END;
      858    10484    2   T0:   ;
      859    10485    2         IF CG$->KQ$CG.QISS = '0'B THEN
      860    10486    2          IF MTYP$->KQ$QTN.CNACT ~= 0 THEN
      861    10487    3            DO;
      862    10488    3   CDAN:    ;
      863    10489    3            B$JIT.ERR=E_CGCDAN;
      864    10490        /*E* ERROR:   KQC-E$CGCDAN-E
      865    10491             MESSAGE: M$CGCTL cannot delete an active queue node
      866    10492             MESSAGE1: You cannot delete a message-type/station from the
      867    10493                       list of legal queue keys when messages of that key
      868    10494                       are active. */
      869    10495    3            CALL KQL$QXFDUN (MYSTA$->KQ$STA);
      870    10496    3            ALTRETURN;
      871    10497    3            END;
      872    10498    2         MTYP$->KQ$MTYP.PERM='0'B;
      873    10499    2         IF CG$->KQ$CG.QISS = '0'B THEN
      874    10500    2          IF MTYP$->KQ$QTN.LOCKCNT ~= 0 THEN
      875    10501    3            DO;
      876    10502    3            MTYP$->KQ$QTN.LOCKCNT=MTYP$->KQ$QTN.LOCKCNT+1;
      877    10503    3            CALL TUNLOCK;
      878    10504    3            CALL SSR$REG (%SS_SL,,1);
      879    10505    3            CALL TLOCK;
      880    10506    3            MTYP$->KQ$QTN.LOCKCNT=MTYP$->KQ$QTN.LOCKCNT-1;
      881    10507    3            GOTO T0;
      882    10508    3            END;
      883    10509    2          ELSE
      884    10510    2           CALL KQL$DELMLH (CG$->KQ$CG,ADDR(MTYP$->KQ$QTN.MLH));
      885    10511    2         CALL KQT$DELTYP (CG$->KQ$CG,MTYP$);
      886    10512    2         IF CG$->KQ$CG.QISS = '0'B THEN
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:28   
      887    10513    3           DO;
      888    10514    3           CALL KQL$QXFDUN (MYSTA$->KQ$STA);
      889    10515    3           CALL TLOCK;
      890    10516    3           END;
      891    10517    2         RETURN;
      892    10518        /**/
      893    10519        /*D* NAME:         DELSTA
      894    10520             PURPOSE:      To delete a station
      895    10521        */
      896    10522    2   DELSTA: ENTRY ALTRET;
      897    10523    2         IF CG$->KQ$CG.QISS THEN
      898    10524    3           DO;
      899    10525    3           CALL SUNLOCK;
      900    10526    3           CALL KQR$GETQUEUE (MYSTA$->KQ$STA);
      901    10527    3           END;
      902    10528              %LOCK (G=STA$->KQ$STA.GATE);
      903    10531    2   S0:   ;
      904    10532    2         IF STA$->KQ$STA.LDCT$ ~= ADDR(NIL) THEN
      905    10533    3           DO;
      906    10534                %UNLOCK (G=STA$->KQ$STA.GATE);
      907    10537    3           B$JIT.ERR=E_CGCDCS;
      908    10538        /*E* ERROR:   KQC-E$CGCDCS-E
      909    10539             MESSAGE: M$CGCTL cannot delete a connected station */
      910    10540    3           IF CG$->KQ$CG.QISS THEN CALL KQL$QXFDUN (MYSTA$->KQ$STA);
      911    10541    3           ELSE CALL SUNLOCK;
      912    10542    3           ALTRETURN;
      913    10543    3           END;
      914    10544    2         IF CG$->KQ$CG.QISS THEN
      915    10545    2          IF STA$->KQ$QTN.CNACT ~= 0 THEN GOTO CDAN;
      916    10546    2          ELSE
      917    10547    2           IF STA$->KQ$QTN.LOCKCNT ~= 0 THEN
      918    10548    3             DO;
      919    10549    3   S1:       STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
      920    10550                  %UNLOCK (G=STA$->KQ$STA.GATE);
      921    10553    3             CALL SUNLOCK;
      922    10554    3             CALL SSR$REG (%SS_SL,,1);
      923    10555    3             CALL SLOCK;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:29   
      924    10556                  %LOCK (G=STA$->KQ$STA.GATE);
      925    10559    3             STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;
      926    10560    3             GOTO S0;
      927    10561    3             END;
      928    10562    2         IF STA$->KQ$STA.LOCKCNT ~= 0 THEN GOTO S1;
      929    10563    2         STA$->KQ$STA.PERM='0'B;
      930    10564    2         IF CG$->KQ$CG.QISS THEN
      931    10565    2          CALL KQL$DELMLH (CG$->KQ$CG,ADDR(STA$->KQ$QTN.MLH));
      932    10566    2         CALL KQL$DELMLH (CG$->KQ$CG,ADDR(STA$->KQ$STA.MLH));
      933    10567              %UNLOCK (G=STA$->KQ$STA.GATE);
      934    10570    2         CALL KQT$DELSTA (CG$->KQ$CG,STA$);
      935    10571    2         IF CG$->KQ$CG.QISS THEN
      936    10572    3           DO;
      937    10573    3           CALL KQL$QXFDUN (MYSTA$->KQ$STA);
      938    10574    3           CALL SLOCK;
      939    10575    3           END;
      940    10576    2         RETURN;
      941    10577    2   END DELTYP;
      942    10578        /****************************************************************
      943    10579        *****************************************************************/
      944    10580        /*D* NAME:         CHKPRI
      945    10581             PURPOSE:      To see if a prio is legal
      946    10582             DESCRIPTION:  ALTRETs if not with JIT.ERR set
      947    10583        */
      948    10584    1   CHKPRI: PROC ALTRET;
      949    10585    2         IF PRIO > %KQ_MPMAX#
      950    10586    2         OR PRIO = 0 THEN
      951    10587    3           DO;
      952    10588    3           B$JIT.ERR=E_BCGPRI;
      953    10589        /*E* ERROR:   KQC-E$BCGPRI-E
      954    10590             MESSAGE: Illegal M$CGCTL priority setting
      955    10591             MESSAGE1: Your M$CGCTL service attempted to set a default or
      956    10592                       station or message type priority to an illegal value. */
      957    10593    3           ALTRETURN;
      958    10594    3           END;
      959    10595    2         RETURN;
      960    10596    2   END CHKPRI;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:30   
      961    10597        /****************************************************************
      962    10598        *****************************************************************/
      963    10599        /*D* NAME:         CHKTYP
      964    10600             PURPOSE:      To validate a default message type
      965    10601             DESCRIPTION:  If the passed type is not in the message type
      966    10602                           tree, then if XTYPLGL is reset, we ALTRET with
      967    10603                           JIT.ERR set; else (xtra's OK) and its not a '*' type
      968    10604                           we make one and return unless no mem in which case
      969    10605                           ALTRET with JIT.ERR set to nomem.  Else (it's there
      970    10606                           or '*' type), return. Note that '*AUEV' types will
      971    10607                           get rejected.
      972    10608        */
      973    10609    1   CHKTYP: PROC (TKEY) ALTRET;
      974    10610        /**/
      975    10611    2   DCL TKEY CHAR(8) UNAL;
      976    10612        /**/
      977    10613    2         CALL TLOCK;
      978    10614    2         CALL KQB$SRCH (KQ$TTREE,TKEY,MTYP$) ALTRET(NOTYP);
      979    10615    2   RTN:  ;
      980    10616    2         CALL TUNLOCK;
      981    10617    2         RETURN;
      982    10618    2   NOTYP:;
      983    10619    2         IF CG$->KQ$CG.AUCTL.XTYPLGL = '0'B THEN
      984    10620    3           DO;
      985    10621    3           CALL TUNLOCK;
      986    10622    3           B$JIT.ERR=E_CGCDXT;
      987    10623        /*E* ERROR:   KQC-E$CGCDXT-E
      988    10624             MESSAGE: Default message type unknown and illegal to add it
      989    10625             MESSAGE1: The default message type specified in VLP_CGCP in
      990    10626                       M$CGCTL was not in the comgroup's list, and it
      991    10627                       could not be added because VLP_CGCP.XTYPLGL was
      992    10628                       reset. */
      993    10629    3           ALTRETURN;
      994    10630    3           END;
      995    10631    2         IF SUBSTR(TKEY,0,1)='*' AND TKEY~='*AUEV' THEN GOTO RTN;
      996    10632    2         IF TKEY ~= ' ' THEN
      997    10633    2          CALL INDEX (I,SUBSTR(TKEY,0,1),KC_LGL1ST) ALTRET(BADTYP);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:31   
      998    10634    2         MTYP$=MYSTA$;
      999    10635    2         CALL KQT$GETTYP (CG$->KQ$CG,MTYP$,TKEY) ALTRET(NOMEM);
     1000    10636    2         GOTO RTN;
     1001    10637    2   BADTYP:;
     1002    10638    2         CALL TUNLOCK;
     1003    10639    2         B$JIT.ERR=E_TYPCHR;
     1004    10640    2         ALTRETURN;
     1005    10641    2   NOMEM:;
     1006    10642    2   SETNOMEM: ENTRY ALTRET;
     1007    10643    2         B$JIT.ERR=E_NOMEM;
     1008    10644        /*E* ERROR:   KQC-E$NOMEM-E
     1009    10645             MESSAGE: Insufficient comgroup memory available
     1010    10646             MESSAGE1: Your comgroup has insufficient memory available for
     1011    10647                       the additions you requested via M$CGCTL, or for
     1012    10648                       its initial creation via M$OPEN. */
     1013    10649    2         ALTRETURN;
     1014    10650    2   END CHKTYP;
     1015    10651        /****************************************************************
     1016    10652        *****************************************************************/
     1017    10653        /*D* NAME:         SPCLSTA
     1018    10654             PURPOSE:      To build a special station for M$CGCTL
     1019    10655             CALL:         SPCLSTA (B$PSN$,STAPTR$)
     1020    10656
     1021    10657                            where B$PSN$ points to a VLP_STATION
     1022    10658                            in which STATION is the desired name.
     1023    10659             DESCRIPTION:  Gets a station block and puts it into
     1024    10660                           the tree with the passed name, then
     1025    10661                           sets the passed pointer to that station.
     1026    10662                           If STAPTR$ ~= ADDR(NIL) then it is assumed
     1027    10663                           to point to a KQ$STA, in which the SPECIAL
     1028    10664                           bit is reset.
     1029    10665                           The SPECIAL bit is set in the new KQ$STA.
     1030    10666                           ALTRETs with B$JIT.ERR set if anything
     1031    10667                           goes wrong.
     1032    10668        */
     1033    10669    1   SPCLSTA: PROC (PS$,STAPTR$) ALTRET;
     1034    10670        /**/
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:32   
     1035    10671    2   DCL PS$ PTR;
     1036    10672    2   DCL STAPTR$ PTR;
     1037    10673        /**/
     1038    10674    2         CALL HFF$NIL (PS$) ALTRET(RTN);
     1039    10675    2         CALL HFF$ERASE (PS$) ALTRET(ERASEIT);
     1040    10676    2         KEY=PS$->VLP$STATION.STATION;
     1041    10677    2         IF KEY ~= ' ' THEN
     1042    10678    3           DO;
     1043    10679    3           CALL SLOCK;
     1044    10680    3           CALL INDEX (I,SUBSTR(KEY,0,1),KC_LGL1ST) ALTRET(BADSTACHR);
     1045    10681    3           STA$=MYSTA$;
     1046    10682    3           CALL KQT$GETSTA (CG$->KQ$CG,STA$,KEY) ALTRET(NOMEM);
     1047    10683    3           IF  STAPTR$ ~= ADDR(NIL)
     1048    10684    3           AND STAPTR$ ~= STA$ THEN
     1049    10685    4             DO;
     1050    10686                  %LOCK (G=STAPTR$->KQ$STA.GATE);
     1051    10689    4             STAPTR$->KQ$STA.SPECIAL='0'B;
     1052    10690                  %UNLOCK (G=STAPTR$->KQ$STA.GATE);
     1053    10693    4             END;
     1054    10694                %LOCK (G=STA$->KQ$STA.GATE);
     1055    10697    3           STA$->KQ$STA.SPECIAL='1'B;
     1056    10698                %UNLOCK (G=STA$->KQ$STA.GATE);
     1057    10701    3           IF CG$->KQ$CG.QISS THEN
     1058    10702    4             DO;
     1059    10703    4             PRIO=STA$->KQ$STA.MPRIO;
     1060    10704    4             CALL SETPRIO (STA$);
     1061    10705    4             END;
     1062    10706    3           STAPTR$=STA$;
     1063    10707    3           CALL SUNLOCK;
     1064    10708    3           END;
     1065    10709    2   RTN:  ;
     1066    10710    2         RETURN;
     1067    10711    2   ERASEIT:;
     1068    10712    2         CALL SLOCK;
     1069    10713    2         IF STAPTR$ ~= ADDR(NIL) THEN
     1070    10714    3           DO;
     1071    10715                %LOCK (G=STAPTR$->KQ$STA.GATE);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:33   
     1072    10718    3           STAPTR$->KQ$STA.SPECIAL='0'B;
     1073    10719                %UNLOCK (G=STAPTR$->KQ$STA.GATE);
     1074    10722    3           STAPTR$=ADDR(NIL);
     1075    10723    3           END;
     1076    10724    2         CALL SUNLOCK;
     1077    10725    2         RETURN;
     1078    10726        /**/
     1079    10727    2   BADSTACHR:;
     1080    10728    2         CALL SUNLOCK;
     1081    10729        /**/
     1082    10730    2   SETBSC: ENTRY ALTRET;
     1083    10731        /**/
     1084    10732    2         B$JIT.ERR=E_STACHR;
     1085    10733        /*E* ERROR:   KQC-E$STACHAR-E
     1086    10734             MESSAGE: Illegal character in station name on M$CGCTL
     1087    10735             MESSAGE1: A station name supplied to M$CGCTL had an illegal
     1088    10736                       first character. */
     1089    10737    2         ALTRETURN;
     1090    10738        /**/
     1091    10739    2   NOMEM:;
     1092    10740    2         CALL SETNOMEM;
     1093    10741    2         ALTRETURN;
     1094    10742    2   END SPCLSTA;
     1095    10743        /****************************************************************
     1096    10744        *****************************************************************/
     1097    10745        /*D* NAME:         TRMGO
     1098    10746             PURPOSE:      To tell ELF when terminal connects become legal
     1099    10747                           on a comgroup so that waiting terms connect.
     1100    10748             DESCRIPTION:  Error logs a message with type EL_CGTOK,
     1101    10749                           and file = 2 (communication accounting)
     1102    10750                           containing a KC$CGID block built from the
     1103    10751                           NAME, ACCOUNT and PSN from the AU's DCB.e.
     1104    10752                           If the errlog buffs are full sleep for 3 secs.
     1105    10753        */
     1106    10754    1   TRMGO: PROC ALTRET;
     1107    10755        /**/
     1108    10756    2         DCB$=B$JIT.DCB$;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:34   
     1109    10757    2         ACGID=CCGID;
     1110    10758    2         ACGID.ACCT#=DCB$->F$DCB.ACCT;
     1111    10759    2         ACGID.PSN#=DCB$->F$DCB.PSN;
     1112    10760    2         ACGID.NAME#.CNT=DCB$->F$DCB.NAME.L;
     1113    10761    2         ACGID.NAME#.TXT=ADDR(DCB$->F$DCB.NAME)->VTXTC.TXT;
     1114    10762    2   TELLELF:;
     1115    10763    2         CALL ELA$SYSLOG (EL_CGTOK,ACGID,SIZEW(ACGID),'0'B,2,TOKFLG) ALTRET (ELFWT);
     1116    10764    2         RETURN;
     1117    10765    2   ELFWT:;
     1118    10766    2         CALL SSR$REG (%SS_SL,ADDR(NIL),3);
     1119    10767    2         GOTO TELLELF;
     1120    10768    2   END TRMGO;
     1121    10769        /****************************************************************
     1122    10770        *****************************************************************/
     1123    10771        /*D* NAME:         CXTSET
     1124    10772             PURPOSE:      To set up a context block after AUCTL has
     1125    10773                           been filled in
     1126    10774             DESCRIPTION:  Takes the AU-specified control params in
     1127    10775                           CG$->KQ$CG.AUCTL, and sets the other control params
     1128    10776                           in the context block appropriately.
     1129    10777                           Gets AUCTL.MINPG pages;
     1130    10778                           Gets AUCTL.DEFERBLKS defer blocks;
     1131    10779                           ALTRETs if unable with B$JIT.ERR set.
     1132    10780        */
     1133    10781    1   CXTSET: PROC ALTRET;
     1134    10782        /**/
     1135    10783    2   DCL ERR UBIN;
     1136    10784    2   DCL I UBIN WORD;
     1137    10785    2   DCL J UBIN;
     1138    10786        /**/
     1139    10787    2         J=CG$->KQ$CG.AUCTL.DATAPGS;
     1140    10788    2         IF J = 0 THEN J=1; ELSE IF J > 99 THEN J=99;
     1141    10789    2         I=(CG$->KQ$CG.AUCTL.MAXPG*J)/100;
     1142    10790    2         IF I < 2 THEN I=2;
     1143    10791    2         IF I >= CG$->KQ$CG.AUCTL.MAXPG THEN I=CG$->KQ$CG.AUCTL.MAXPG-1;
     1144    10792    2         CG$->KQ$CG.MAXDATAPGS=I;
     1145    10793    2         CG$->KQ$CG.MMD.MAXBPG=CG$->KQ$CG.AUCTL.MAXPG-I;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:35   
     1146    10794    2         I=(CG$->KQ$CG.AUCTL.MINPG*J)/100;
     1147    10795    2         IF I = 0 THEN I=1;
     1148    10796    2         IF I >= CG$->KQ$CG.AUCTL.MINPG THEN I=CG$->KQ$CG.AUCTL.MINPG-1;
     1149    10797    2         CG$->KQ$CG.MINDATAPGS=I;
     1150    10798    2         CG$->KQ$CG.MMD.MINBPG=CG$->KQ$CG.AUCTL.MINPG-I;
     1151    10799    2         IF CG$->KQ$CG.QISS THEN
     1152    10800    3           DO;
     1153    10801    3           CG$->KQ$CG.QUEUE.QTREE$=ADDR(CG$->KQ$CG.STREE);
     1154    10802    3           CG$->KQ$CG.XQTNLGL=CG$->KQ$CG.AUCTL.XSTALGL;
     1155    10803    3           CG$->KQ$CG.XOTNLGL=CG$->KQ$CG.AUCTL.XTYPLGL;
     1156    10804    3           END;
     1157    10805    2         ELSE
     1158    10806    3           DO;
     1159    10807    3           CG$->KQ$CG.QUEUE.QTREE$=ADDR(KQ$TTREE);
     1160    10808    3           CG$->KQ$CG.XQTNLGL=CG$->KQ$CG.AUCTL.XTYPLGL;
     1161    10809    3           CG$->KQ$CG.XOTNLGL=CG$->KQ$CG.AUCTL.XSTALGL;
     1162    10810    3           END;
     1163    10811    2         CG$->KQ$CG.FORCECNT=CG$->KQ$CG.AUCTL.WRITETIME;
     1164    10812    2         CALL KQM$GETMIN (CG$->KQ$CG,,ERR) ALTRET(ALTRT);
     1165    10813    2         CALL KQM$GETDFR (CG$->KQ$CG,,ERR) ALTRET(ALTRT);
     1166    10814    2         RETURN;
     1167    10815    2   ALTRT:;
     1168    10816    2         ALTRETURN;
     1169    10817    2   END CXTSET;
     1170    10818        /****************************************************************
     1171    10819        *****************************************************************/
     1172    10820        /*D* NAME:         SETPRIO
     1173    10821             PURPOSE:      To set the prio of a Q node
     1174    10822        */
     1175    10823    1   SETPRIO: PROC (QTN$);
     1176    10824        /**/
     1177    10825    2   DCL QTN$ PTR;
     1178    10826        /**/
     1179    10827    2         QTN$->KQ$QTN.MPRIO=PRIO;
     1180    10828    2         CALL KQT$MOVQTN (CG$->KQ$CG,QTN$);
     1181    10829    2         RETURN;
     1182    10830    2   END SETPRIO;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:36   
     1183    10831        /****************************************************************
     1184    10832        *****************************************************************/
     1185    10833        /*D* NAME:         SETMXACT
     1186    10834             PURPOSE:      To adjust MXACT in a Q-tree node
     1187    10835             DESCRIPTION:  Entered with Q-tree locked - returns same but
     1188    10836                           may have unlocked it.
     1189    10837        */
     1190    10838    1   SETMXACT: PROC (QTN$,QX);
     1191    10839        /**/
     1192    10840    2   DCL QTN$ PTR;
     1193    10841    2   DCL QX UBIN WORD;
     1194    10842    2   DCL I SBIN WORD ALIGNED;
     1195    10843        /**/
     1196    10844    2         I=QTN$->KQ$QTN.MXACT;
     1197    10845    2         IF QLIST ~= 0 THEN
     1198    10846    2          QTN$->KQ$QTN.MXACT=VLP$CGQL.LIST.MXACT(QX);
     1199    10847    2         IF I >= QTN$->KQ$QTN.MXACT
     1200    10848    2         OR QTN$->KQ$QTN.CNACT >= QTN$->KQ$QTN.MXACT THEN RETURN;
     1201    10849    2         CALL KQQ$ACT (CG$->KQ$CG,QTN$);
     1202    10850              %LOCK (G=KQ$QTREE.GATE);
     1203    10853    2         RETURN;
     1204    10854    2   END SETMXACT;
     1205    10855        /****************************************************************
     1206    10856        *****************************************************************/
     1207    10857        /*D* NAME:         RELJF
     1208    10858             PURPOSE:      To delete the journal FID
     1209    10859             DESCRIPTION:  The journal FID area of memory is released,
     1210    10860                           and KQ$CG.JRNLFID$ is set to NIL.  If necessary,
     1211    10861                           the JOURNAL GHOST is told that the FID has changed.
     1212    10862
     1213    10863                           ALTRETs with JIT.ERR set if anything goes wrong.
     1214    10864        */
     1215    10865    1   RELJF: PROC ALTRET;
     1216    10866        /**/
     1217    10867        %VLP_JRNLFIDV (FPTN=KQ$JFID,STCLASS="BASED DALIGNED");
     1218    10874    2   DCL K UBIN;
     1219    10875    2   DCL J$ PTR;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:37   
     1220    10876        /**/
     1221    10877    2         IF CG$->KQ$CG.JRNLFID$ = ADDR(NIL) THEN RETURN;
     1222    10878    2         P$=CG$->KQ$CG.JRNLFID$;
     1223    10879              %LOCK (G=CG$->KQ$CG.GATE.MISC);
     1224    10882    2         CG$->KQ$CG.JRNLFID$=ADDR(NIL);
     1225    10883    2         CALL RELIT;
     1226    10884              %UNLOCK (G=CG$->KQ$CG.GATE.MISC);
     1227    10887    2         CALL KQC$TELLJ (CG$->KQ$CG.CFU$) ALTRET(ALTRT);
     1228    10888    2         RETURN;
     1229    10889        /**/
     1230    10890        /*D* NAME:         GETJF
     1231    10891             PURPOSE:      To set a new journal FID
     1232    10892             DESCRIPTION:  The JRNLFID parameter in the paremeter stack
     1233    10893                           is to become the new journal FID for the comgroup.
     1234    10894                           If there is a current one and it's the same,
     1235    10895                           just return.  Else release the old one and allocate
     1236    10896                           space for a new one, filling it with the passed
     1237    10897                           param.  If the JOURNAL GHOST needs to be told,
     1238    10898                           then JFLG gets set.
     1239    10899
     1240    10900                           ALRETs with JIT.ERR set if anything goes wrong.
     1241    10901        */
     1242    10902    2   GETJF: ENTRY ALTRET;
     1243    10903        /**/
     1244    10904    2         P$=CG$->KQ$CG.JRNLFID$;
     1245    10905    2         IF P$ ~= ADDR(NIL) THEN
     1246    10906    3           DO;
     1247    10907    3           IF P$->KQ$JFID.JRNLFID# = B$PS10$->VLP$JRNLFIDV.JRNLFID# THEN
     1248    10908    3            RETURN;
     1249    10909    3           CALL GETIT ALTRET(ALTRT);
     1250    10910                %LOCK (G=CG$->KQ$CG.GATE.MISC);
     1251    10913    3           CG$->KQ$CG.JRNLFID$=J$;
     1252    10914    3           CALL RELIT;
     1253    10915                %UNLOCK (G=CG$->KQ$CG.GATE.MISC);
     1254    10918    3           END;
     1255    10919    2         ELSE
     1256    10920    3           DO;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:38   
     1257    10921    3           CALL GETIT ALTRET(ALTRT);
     1258    10922    3           CG$->KQ$CG.JRNLFID$=J$;
     1259    10923    3           END;
     1260    10924    2         JFLG=1;
     1261    10925    2         RETURN;
     1262    10926    2   ALTRT:;
     1263    10927    2         ALTRETURN;
     1264    10928        /**/
     1265    10929    2   RELIT: PROC;
     1266    10930        /**/
     1267    10931    3         K=SIZEW(P$->KQ$JFID);
     1268    10932    3         CALL KQM$RELB (CG$->KQ$CG,P$,K);
     1269    10933    3         RETURN;
     1270    10934    3   END RELIT;
     1271    10935        /**/
     1272    10936    2   GETIT: PROC ALTRET;
     1273    10937        /**/
     1274    10938    3         I=SIZEC(B$PS10$->VLP$JRNLFIDV);
     1275    10939    3         K=(((I+7)/8)*8)/4;  /* Round up to doubleword */
     1276    10940    3         CALL KQM$GETB (CG$->KQ$CG,J$,K) ALTRET(NONE);
     1277    10941    3         J$->B$$CHARS=B$PS10$->B$$CHARS;
     1278    10942    3         RETURN;
     1279    10943    3   NONE: ;
     1280    10944    3         CALL SETNOMEM;
     1281    10945    3         ALTRETURN;
     1282    10946    3   END GETIT;
     1283    10947    2   END RELJF;
     1284    10948    1   END KQC$CGCTL;
     1285    10949        %EOD;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:39   
--  Include file information  --

   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQC$CGCTL.

   Procedure KQC$CGCTL requires 2133 words for executable code.
   Procedure KQC$CGCTL requires 96 words of local(AUTO) storage.

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:40   

 Object Unit name= KQC$CGCTL                                  File name= KQC$CTL.:E05TOU
 UTS= JUL 30 '97 01:24:44.88 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     36     44  KQC$CGCTL
    1   Proc  even  none  2133   4125  KQC$CGCTL
    2  RoData even  none    25     31  KQC$CGCTL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KQC$CGCTL
     1   2315          yes     yes      Std        1  KQC$CXTSET
     1   2325          yes     yes      Std        1  KQC$CXTSET1
     1   2347          yes     yes      Std        1  KQC$TRMCK
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:41   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 HFF$DSIZ
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 KQT$GETTYP
 yes     yes           Std       1 HFF$NILERASE
 yes     yes           Std       1 KCL$HOOKUPM
 yes     yes           Std       3 KQT$GETSTA
 yes     yes           Std       0 KCL$HOOKUPMB
 yes     yes           Std       1 HFF$ERASE
 yes     yes           Std       1 HFF$TRAPALT
 yes     yes           Std       3 KQB$SRCH
 yes     yes           Std       1 HFF$PTPRES
 yes     yes           Std       0 KCL$HOOKUPH
         yes           Std       1 HFC$LOCK
 yes     yes           Std       1 KQT$VALREADS
 yes     yes           Std       1 KQC$TELLJ
 yes     yes           Std       1 KQM$MOREPG
 yes     yes           Std       1 KQR$GETQUEUE
 yes     yes           Std       1 KQL$QXFDUN
 yes     yes           Std       3 SSR$REG
 yes     yes           Std       2 KQL$DELMLH
 yes     yes           Std       2 KQT$DELSTA
 yes     yes           Std       2 KQT$DELTYP
 yes     yes           Std       1 HFF$NIL
 yes     yes           Std       6 ELA$SYSLOG
 yes     yes           Std       3 KQM$GETMIN
 yes     yes           Std       3 KQM$GETDFR
 yes     yes           Std       2 KQT$MOVQTN
 yes     yes           Std       2 KQQ$ACT
 yes     yes           Std       3 KQM$RELB
 yes     yes           Std       3 KQM$GETB
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:42   
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KC_LGL1ST                        r    B$PS0$                           r    B$PS1$
r    B$PS2$                           r    B$PS3$                           r    B$PS4$
r    B$PS5$                           r    B$PS7$                           r    B$PS8$
r    B$PS9$                           r    B$PS10$                               B$JIT$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:43   


        1        1        /*M* KQC$CTL COMGROUP control routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQC$CTL
       10       10             PURPOSE:      To provide comgroup functions related to
       11       11                           the control services provided to the AU
       12       12        */
       13       13        /**/
       14       14        KQC$CGCTL: PROC (PARM$,PARM) ALTRET;

     14  1 000000   000000 700200 xent  KQC$CGCTL    TSX0  ! X66_AUTO_2
         1 000001   000140 000002                    ZERO    96,2

       15       15        /**/
       16       16
       17       17
       18       18
       19       19        /**/
       20       20        /* INCLUDES */
       21       21        /**/
       22       22        %INCLUDE KQ_SUBS_C;
       23      322        %INCLUDE KQ_MAC_C;
       24     2872        %INCLUDE HF_LOCK_C;
       25     2886        %INCLUDE KQ_DATA_R;
       26     3718        %INCLUDE CP_6_SUBS;
       27     4258        %INCLUDE KC$CP6V_C;
       28     4378        %INCLUDE B$JIT_C;
       29     4692        %INCLUDE UD_SEV_C;
       30     4706        %INCLUDE KQ_ERRORS_C;
       31     4754        %INCLUDE KC_ERRORS_C;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:44   
       32     4801        %INCLUDE UD_ERRORS_C;
       33     4843        %INCLUDE KC_CP6;
       34     5403        %INCLUDE KI$CP6V_C;
       35     5842        %INCLUDE KI_CP6;
       36     6938        %INCLUDE KC$CGBLK;
       37     6986        %INCLUDE F$DCB;
       38     7035        %INCLUDE EL_SUBS_C;
       39     7119        %INCLUDE NK_SUBS;
       40     7144        %INCLUDE SS_SCHED_C;
       41     7377        %INCLUDE KC_DATA_R;
       42     7390
       43     7391
       44     7392
       45     7393        /**/
       46     7394        /* PARAMETERS */
       47     7395        /**/
       48     7396    1   DCL PARM$ PTR;
       49     7397    1   DCL PARM UBIN WORD ALIGNED;
       50     7398    1   DCL PARMR BIT(36) ALIGNED;
       51     7399
       52     7400
       53     7401
       54     7402        /**/
       55     7403        /* MACROS */
       56     7404        /**/
       57     7405        %MACRO $ERROR (NAME=GORGO,CODE=0,SEV=SEV_ERROR#);
       58     7406        DCL 1 NAME CONSTANT ALIGNED,
       59     7407              2 * BIT(18) UNAL INIT('132103'O),
       60     7408              2 * UBIN(15) UNAL INIT(CODE),
       61     7409              2 * UBIN(3) UNAL INIT(SEV);
       62     7410        %MEND;
       63     7411
       64     7412
       65     7413
       66     7414        /**/
       67     7415        /* BASED STRUCTURES */
       68     7416        /**/
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:45   
       69     7417        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
       70     8156        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
       71     8495        %KQ_MTYP (FPTN=KQ$MTYP,STCLASS="BASED(MTYP$)");
       72     8569        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS="BASED(QTN$)");
       73     9042        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
       74     9080        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED(RBLK$)");
       75     9266        %FPT$CGCTL_V    (FPTN=FPT$CGCTL ,BASED="BASED(B$PS0$)");
       76     9270        %VLP$CGTYPL_V   (FPTN=VLP$CGTYPL,BASED="BASED(B$PS1$)",NTYP=1);
       77     9275        %VLP$CGSTAL_V   (FPTN=VLP$CGSTAL,BASED="BASED(B$PS2$)",NSTA=1);
       78     9279        %VLP$CGCP_V     (FPTN=VLP$CGCP  ,BASED="BASED(B$PS3$)");
       79     9298        %VLP$SETSTA_V   (FPTN=VLP$SETSTA,BASED="BASED(B$PS4$)");
       80     9310        %VLP$CGQL_V     (FPTN=VLP$CGQL  ,BASED="BASED(B$PS5$)",NLIST=1);
       81     9314        %VLP$STATION_V (FPTN=VLP$STATION,BASED="BASED(B$PS7$)");
       82     9326        %VLP_JRNLFIDV (FPTN=VLP$JRNLFIDV,STCLASS=BASED);
       83     9333        %FPT$ACTIVATE_V (FPTN=FPT$ACTIVATE);
       84     9339    1   DCL B$$BIT36 BIT(36) BASED ALIGNED;
       85     9340    1   DCL B$$CHARS CHAR(I) BASED CALIGNED;
       86     9341    1   DCL 1 VTXTC BASED ALIGNED,
       87     9342    1         2 CNT UBIN BYTE UNAL,
       88     9343    1         2 TXT CHAR(VTXTC.CNT);
       89     9344        %B$JIT0;
       90     9433        %U$JIT1X;
       91     9436        %M$JIT2X;
       92     9439        %F$JIT3;
       93     9444        %A$JIT6X;
       94     9447
       95     9448
       96     9449
       97     9450        /**/
       98     9451        /* AUTO */
       99     9452        /**/
      100     9453    1   DCL CG$ PTR;
      101     9454    1   DCL LDCT$ PTR;
      102     9455    1   DCL KEY CHAR(8) ALIGNED;
      103     9456    1   DCL KEYR REDEF KEY BIT(72) ALIGNED;
      104     9457    1   DCL ACTCNT UBIN WORD;
      105     9458    1   DCL STA$ PTR;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:46   
      106     9459    1   DCL MYSTA$ PTR;
      107     9460    1   DCL MTYP$ PTR;
      108     9461    1   DCL QTN$ PTR;
      109     9462    1   DCL DSIZ SBIN;
      110     9463    1   DCL NTYP SBIN;
      111     9464    1   DCL TYPX SBIN;
      112     9465    1   DCL PRIO UBIN;
      113     9466    1   DCL STAX SBIN;
      114     9467    1   DCL NSTA SBIN;
      115     9468        %VLP$CGCP_V (FPTN=CGCP,BASED=AUTO);
      116     9487        %VLP$SETSTA_V (FPTN=SETSTA,BASED=AUTO);
      117     9499        %KC$CGID (FPTN=ACGID,STCLASS="");
      118     9525    1   DCL P$ PTR;
      119     9526    1   DCL RBLK$ PTR;
      120     9527    1   DCL JFLG UBIN;
      121     9528    1   DCL PP$ PTR;
      122     9529    1   DCL QLIST UBIN;
      123     9530    1   DCL NQ SBIN;
      124     9531    1   DCL DCB$ PTR;
      125     9532    1   DCL DFCHK UBIN;
      126     9533    1   DCL FLINK$ PTR;
      127     9534    1   DCL I UBIN;
      128     9535    1   DCL TOKFLG UBIN WORD;
      129     9536    1   DCL JNAME CHAR(8);
      130     9537
      131     9538
      132     9539
      133     9540        /**/
      134     9541        /* CONSTANT */
      135     9542        /**/
      136     9543        %$ERROR (NAME=E_BCGPRI,CODE=%E$BCGPRI);
      137     9549        %$ERROR (NAME=E_NOMEM,CODE=%E$NOMEM);
      138     9555        %$ERROR (NAME=E_CGTTRP,CODE=%E$CGTTRP);
      139     9561        %$ERROR (NAME=E_CGSTRP,CODE=%E$CGSTRP);
      140     9567        %$ERROR (NAME=E_CGIQLS,CODE=%E$CGIQLS);
      141     9573        %$ERROR (NAME=E_CGCDXT,CODE=%E$CGCDXT);
      142     9579        %$ERROR (NAME=E_CGCDDT,CODE=%E$CGCDDT);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:47   
      143     9585        %$ERROR (NAME=E_CGCDCS,CODE=%E$CGCDCS);
      144     9591        %$ERROR (NAME=E_CGUAFC,CODE=%E$CGUAFC);
      145     9597        %$ERROR (NAME=E_CGAFNT,CODE=%E$CGAFNT);
      146     9603        %$ERROR (NAME=E_CGAFNS,CODE=%E$CGAFNS);
      147     9609        %$ERROR (NAME=E_CGCDAN,CODE=%E$CGCDAN);
      148     9615        %$ERROR (NAME=E_CGMSDT,CODE=%E$CGMSDT);
      149     9621        %$ERROR (NAME=E_CGMPEN,CODE=%E$CGMPEN);
      150     9627        %$ERROR (NAME=E_TYPCHR,CODE=%E$TYPCHAR);
      151     9633        %$ERROR (NAME=E_STACHR,CODE=%E$STACHAR);
      152     9639        %$ERROR (NAME=E_BDJFID,CODE=%E$BDJFID);
      153     9645        %KC$CGID (FPTN=CCGID,STCLASS=CONSTANT);
      154     9671
      155     9672
      156     9673
      157     9674        /**/
      158     9675        /* REFS */
      159     9676        /**/
      160     9677    1   DCL ELA$SYSLOG    ENTRY(6) ALTRET;
      161     9678    1   DCL HFF$ERASE     ENTRY(1) ALTRET;
      162     9679    1   DCL HFF$NIL       ENTRY(1) ALTRET;
      163     9680    1   DCL HFF$NILERASE  ENTRY(1) ALTRET;
      164     9681    1   DCL HFF$DSIZ      ENTRY(2) ALTRET;
      165     9682    1   DCL HFF$PTPRES    ENTRY(1) ALTRET;
      166     9683    1   DCL HFF$TRAPALT   ENTRY(1) ALTRET;
      167     9684    1   DCL KCL$HOOKUPH  ENTRY ALTRET;
      168     9685    1   DCL KCL$HOOKUPM   ENTRY(1) ALTRET;
      169     9686    1   DCL KCL$HOOKUPMB  ENTRY ALTRET;
      170     9687    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      171     9688    1   DCL KQC$TELLJ     ENTRY(1) ALTRET;
      172     9689    1   DCL KQL$DELMLH    ENTRY(2) ALTRET;
      173     9690    1   DCL KQL$QXFDUN    ENTRY(1) ALTRET;
      174     9691    1   DCL KQM$GETB      ENTRY(3) ALTRET;
      175     9692    1   DCL KQM$GETDFR    ENTRY(3) ALTRET;
      176     9693    1   DCL KQM$GETMIN    ENTRY(3) ALTRET;
      177     9694    1   DCL KQM$MOREPG    ENTRY(1) ALTRET;
      178     9695    1   DCL KQM$RELB      ENTRY(3) ALTRET;
      179     9696    1   DCL KQQ$ACT       ENTRY(2) ALTRET;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:48   
      180     9697    1   DCL KQR$GETQUEUE  ENTRY(1) ALTRET;
      181     9698    1   DCL KQT$DELSTA    ENTRY(2) ALTRET;
      182     9699    1   DCL KQT$DELTYP    ENTRY(2) ALTRET;
      183     9700    1   DCL KQT$GETSTA    ENTRY(3) ALTRET;
      184     9701    1   DCL KQT$GETTYP    ENTRY(3) ALTRET;
      185     9702    1   DCL KQT$LBT       ENTRY(1) ALTRET;
      186     9703    1   DCL KQT$MOVQTN    ENTRY(2) ALTRET;
      187     9704    1   DCL KQT$UBT       ENTRY(1) ALTRET;
      188     9705    1   DCL KQT$VALREADS  ENTRY(1) ALTRET;
      189     9706    1   DCL SSR$REG       ENTRY(3) ALTRET;
      190     9707    1   DCL SSR$RUE       ENTRY(4);
      191     9708    1   DCL B$PS0$ PTR SYMREF READONLY;
      192     9709    1   DCL B$PS1$ PTR SYMREF READONLY;
      193     9710    1   DCL B$PS2$ PTR SYMREF READONLY;
      194     9711    1   DCL B$PS3$ PTR SYMREF READONLY;
      195     9712    1   DCL B$PS4$ PTR SYMREF READONLY;
      196     9713    1   DCL B$PS5$ PTR SYMREF READONLY;
      197     9714    1   DCL B$PS6$ PTR SYMREF READONLY;
      198     9715    1   DCL B$PS7$ PTR SYMREF READONLY;
      199     9716    1   DCL B$PS8$ PTR SYMREF READONLY;
      200     9717    1   DCL B$PS9$ PTR SYMREF READONLY;
      201     9718    1   DCL B$PS10$ PTR SYMREF READONLY;
      202     9719    1   DCL B$JIT$ PTR SYMREF;
      203     9720        %VLP_STATION (FPTN=KC_VLPSTATION,STCLASS=SYMREF);
      204     9747
      205     9748
      206     9749
      207     9750        /**/
      208     9751        /* SUBS */
      209     9752        /**/
      210     9753        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      211     9754        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
      212     9755        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      213     9756        %SUB KQ$DTREE="CG$->KQ$CG.DTREE";
      214     9757        %EQU_CG;
      215     9805        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:49   
      216     9806        /**/
      217     9807        /*F* NAME:         KQC$CGCTL
      218     9808             PURPOSE:      To process the M$CGCTL PMME
      219     9809             CALL:         KQC$CGCTL (MYSTA$)
      220     9810             DESCRIPTION:  Enter here from KCP$PMME after verifying that
      221     9811                           the PMME issuer is indeed the AU.
      222     9812        KQC$CGCTL: ENTRY (PARM$) ALTRET;
      223     9813        */
      224     9814        /**/
      225     9815    1         MYSTA$=PARM$;

   9815  1 000002   200003 470500                    LDP0    @PARM$,,AUTO
         1 000003   000000 236100                    LDQ     0,,PR0
         1 000004   200014 756100                    STQ     MYSTA$,,AUTO

      226     9816    1         CG$=MYSTA$->KQ$STA.CG$;

   9816  1 000005   200014 471500                    LDP1    MYSTA$,,AUTO
         1 000006   100007 236100                    LDQ     7,,PR1
         1 000007   200006 756100                    STQ     CG$,,AUTO

      227     9817    1         QLIST=0;

   9817  1 000010   200106 450100                    STZ     QLIST,,AUTO

      228     9818    1         CALL HFF$DSIZ (5,DSIZ) ALTRET(NOQL);

   9818  1 000011   200017 633500                    EPPR3   DSIZ,,AUTO
         1 000012   200133 453500                    STP3    @TKEY+4,,AUTO
         1 000013   000000 236000 2                  LDQ     0
         1 000014   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000015   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000016   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000017   000000 701000 xent               TSX1    HFF$DSIZ
         1 000020   000027 702000 1                  TSX2    NOQL

      229     9819    1         NQ=DSIZ/LENGTHC(VLP$CGQL.LIST(0));
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:50   

   9819  1 000021   200017 236100                    LDQ     DSIZ,,AUTO
         1 000022   000044 506007                    DIV     36,DL
         1 000023   200107 756100                    STQ     NQ,,AUTO

      230     9820    1         QLIST=1;

   9820  1 000024   000001 235007                    LDA     1,DL
         1 000025   200106 755100                    STA     QLIST,,AUTO

      231     9821    1         JFLG=0;

   9821  1 000026   200104 450100                    STZ     JFLG,,AUTO

   9821  1 000027                       NOQL         null
      232     9822    1   NOQL: ;
      233     9823        /**/
      234     9824
      235     9825                 /****************************************
      236     9826                  *                                      *
      237     9827                  *        PROCESS SPECIAL STATIONS      *
      238     9828                  *                                      *
      239     9829                  ****************************************/
      240     9830
      241     9831    1         CALL SPCLSTA (B$PS8$,CG$->KQ$CG.HOLDSTA$) ALTRET(ERROR);

   9831  1 000027   200006 236100                    LDQ     CG$,,AUTO
         1 000030   000124 036003                    ADLQ    84,DU
         1 000031   200122 756100                    STQ     K+1,,AUTO
         1 000032   000001 236000 2                  LDQ     1
         1 000033   200121 756100                    STQ     JNAME+4,,AUTO
         1 000034   003136 701000 1                  TSX1    SPCLSTA
         1 000035   001423 702000 1                  TSX2    ERROR

      242     9832    1         IF CG$->KQ$CG.JRNLSTA$ ~= ADDR(NIL) THEN

   9832  1 000036   200006 470500                    LDP0    CG$,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:51   
         1 000037   000210 236100                    LDQ     136,,PR0
         1 000040   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000041   000047 600000 1                  TZE     s:9834

      243     9833    1          JNAME=CG$->KQ$CG.JRNLSTA$->KQ$STA.BTN.KEY;

   9833  1 000042   000210 471500                    LDP1    136,,PR0
         1 000043   040100 100500                    MLR     fill='040'O
         1 000044   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 000045   200115 000010                    ADSC9   JNAME,,AUTO              cn=0,n=8
         1 000046   000053 710000 1                  TRA     s:9835

      244     9834    1         ELSE JNAME=' ';

   9834  1 000047   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000050   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000051   200115 755100                    STA     JNAME,,AUTO
         1 000052   200116 756100                    STQ     JNAME+1,,AUTO

      245     9835    1         CALL SPCLSTA (B$PS9$,CG$->KQ$CG.JRNLSTA$) ALTRET(ERROR);

   9835  1 000053   200006 236100                    LDQ     CG$,,AUTO
         1 000054   000210 036003                    ADLQ    136,DU
         1 000055   200122 756100                    STQ     K+1,,AUTO
         1 000056   000002 236000 2                  LDQ     2
         1 000057   200121 756100                    STQ     JNAME+4,,AUTO
         1 000060   003136 701000 1                  TSX1    SPCLSTA
         1 000061   001423 702000 1                  TSX2    ERROR

      246     9836    1         IF CG$->KQ$CG.JRNLSTA$ ~= ADDR(NIL) THEN

   9836  1 000062   200006 470500                    LDP0    CG$,,AUTO
         1 000063   000210 236100                    LDQ     136,,PR0
         1 000064   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000065   000076 600000 1                  TZE     s:9839

      247     9837    1          IF JNAME ~= CG$->KQ$CG.JRNLSTA$->KQ$STA.BTN.KEY THEN JFLG=1;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:52   

   9837  1 000066   000210 471500                    LDP1    136,,PR0
         1 000067   040100 106500                    CMPC    fill='040'O
         1 000070   200115 000010                    ADSC9   JNAME,,AUTO              cn=0,n=8
         1 000071   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 000072   000104 600000 1                  TZE     s:9847

   9837  1 000073   000001 235007                    LDA     1,DL
         1 000074   200104 755100                    STA     JFLG,,AUTO
         1 000075   000104 710000 1                  TRA     s:9847

      248     9838    1          ELSE;
      249     9839    1         ELSE IF JNAME ~= ' ' THEN JFLG=1;

   9839  1 000076   040000 106500                    CMPC    fill='040'O
         1 000077   200115 000010                    ADSC9   JNAME,,AUTO              cn=0,n=8
         1 000100   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000101   000104 600000 1                  TZE     s:9847

   9839  1 000102   000001 235007                    LDA     1,DL
         1 000103   200104 755100                    STA     JFLG,,AUTO

      250     9840
      251     9841                 /****************************************
      252     9842                  *                                      *
      253     9843                  *        PROCESS JOURNAL FID           *
      254     9844                  *                                      *
      255     9845                  ****************************************/
      256     9846
      257     9847    1         CALL HFF$ERASE (B$PS10$) ALTRET(JFERASE);

   9847  1 000104   000003 630400 2                  EPPR0   3
         1 000105   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000106   000000 701000 xent               TSX1    HFF$ERASE
         1 000107   000111 702000 1                  TSX2    JFERASE

      258     9848    1         GOTO CHKJF;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:53   

   9848  1 000110   000114 710000 1                  TRA     CHKJF

   9847  1 000111                       JFERASE      null
      259     9849    1   JFERASE:;
      260     9850    1         CALL RELJF ALTRET(ERROR);

   9850  1 000111   003704 701000 1                  TSX1    RELJF
         1 000112   001423 702000 1                  TSX2    ERROR

      261     9851    1         GOTO NOJF;

   9851  1 000113   000157 710000 1                  TRA     NOJF

   9847  1 000114                       CHKJF        null
      262     9852    1   CHKJF: ;
      263     9853    1         CALL HFF$DSIZ (B$PS10$,I);

   9853  1 000114   200113 630500                    EPPR0   I,,AUTO
         1 000115   200133 450500                    STP0    @TKEY+4,,AUTO
         1 000116   000003 236000 2                  LDQ     3
         1 000117   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000120   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000121   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000122   000000 701000 xent               TSX1    HFF$DSIZ
         1 000123   000000 011000                    NOP     0

      264     9854    1         IF I ~= 0 THEN

   9854  1 000124   200113 235100                    LDA     I,,AUTO
         1 000125   000157 600000 1                  TZE     NOJF

      265     9855    2           DO;

      266     9856    2           IF I <= SIZEC(VLP$JRNLFIDV.L#)

   9856  1 000126   000003 115007                    CMPA    3,DL
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:54   
         1 000127   000132 602000 1                  TNC     BDJFID
         1 000130   007401 115007                    CMPA    3841,DL
         1 000131   000136 602000 1                  TNC     s:9868

      267     9857    2           OR I > KQ_MCMAX# THEN
      268     9858    3             DO;

      269     9859    3   BDJFID:   ;

   9859  1 000132                       BDJFID       null
      270     9860    3             B$JIT.ERR=E_BDJFID;

   9860  1 000132   000020 236000 0                  LDQ     E_BDJFID
         1 000133   000000 470400 xsym               LDP0    B$JIT$
         1 000134   000012 756100                    STQ     10,,PR0

      271     9861        /*E* ERROR:   KQC-E$BDJFID-E
      272     9862             MESSAGE: Bad JRNLFID passed to M$CGCTL
      273     9863             MESSAGE1: The JRNLFID parameter in your M$CGCTL service is
      274     9864                       inaccessible or too small, or too large.
      275     9865        */
      276     9866    3             GOTO ERROR;

   9866  1 000135   001423 710000 1                  TRA     ERROR

      277     9867    3             END;
      278     9868    2           CALL HFF$PTPRES (B$PS10$) ALTRET(BDJFID);

   9868  1 000136   000003 630400 2                  EPPR0   3
         1 000137   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000140   000000 701000 xent               TSX1    HFF$PTPRES
         1 000141   000132 702000 1                  TSX2    BDJFID

      279     9869    2           IF I < SIZEC(B$PS10$->VLP$JRNLFIDV) THEN GOTO BDJFID;

   9869  1 000142   000000 470400 xsym               LDP0    B$PS10$
         1 000143   000100 100500                    MLR     fill='000'O
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:55   
         1 000144   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         1 000145   200132 000004                    ADSC9   @TKEY+3,,AUTO            cn=0,n=4
         1 000146   200132 220100                    LDX0    @TKEY+3,,AUTO
         1 000147   000002 621010                    EAX1    2,X0
         1 000150   000000 636011                    EAQ     0,X1
         1 000151   000022 772000                    QRL     18
         1 000152   200113 116100                    CMPQ    I,,AUTO
         1 000153   000155 600000 1                  TZE     s:9870
         1 000154   000132 603000 1                  TRC     BDJFID

      280     9870    2           CALL GETJF ALTRET(ERROR);

   9870  1 000155   003747 701000 1                  TSX1    GETJF
         1 000156   001423 702000 1                  TSX2    ERROR

      281     9871    2           END;

   9869  1 000157                       NOJF         null
      282     9872    1   NOJF: ;
      283     9873        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:56   
      284     9874        /**/
      285     9875
      286     9876                 /****************************************
      287     9877                  *                                      *
      288     9878                  *        PROCESS CONTROL PARAMS        *
      289     9879                  *                                      *
      290     9880                  ****************************************/
      291     9881
      292     9882    1         CALL HFF$NILERASE (3) ALTRET(NOCTL);

   9882  1 000157   000004 630400 2                  EPPR0   4
         1 000160   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000161   000000 701000 xent               TSX1    HFF$NILERASE
         1 000162   000574 702000 1                  TSX2    NOCTL

      293     9883    1         PRIO=VLP$CGCP.STAPRIO;

   9883  1 000163   000000 470400 xsym               LDP0    B$PS3$
         1 000164   000004 236100                    LDQ     4,,PR0
         1 000165   000011 772000                    QRL     9
         1 000166   000777 376007                    ANQ     511,DL
         1 000167   200022 756100                    STQ     PRIO,,AUTO

      294     9884    1         CALL CHKPRI ALTRET(ERROR);

   9884  1 000170   003010 701000 1                  TSX1    CHKPRI
         1 000171   001423 702000 1                  TSX2    ERROR

      295     9885    1         PRIO=VLP$CGCP.TYPPRIO;

   9885  1 000172   000000 470400 xsym               LDP0    B$PS3$
         1 000173   000004 236100                    LDQ     4,,PR0
         1 000174   000777 376007                    ANQ     511,DL
         1 000175   200022 756100                    STQ     PRIO,,AUTO

      296     9886    1         CALL CHKPRI ALTRET(ERROR);

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:57   
   9886  1 000176   003010 701000 1                  TSX1    CHKPRI
         1 000177   001423 702000 1                  TSX2    ERROR

      297     9887    1         CGCP=VLP$CGCP;

   9887  1 000200   000000 470400 xsym               LDP0    B$PS3$
         1 000201   000100 100500                    MLR     fill='000'O
         1 000202   000000 000120                    ADSC9   0,,PR0                   cn=0,n=80
         1 000203   200026 000120                    ADSC9   CGCP,,AUTO               cn=0,n=80

      298     9888    1         CALL CHKTYP (CGCP.DMTYP) ALTRET (ERROR);

   9888  1 000204   200030 631500                    EPPR1   CGCP+2,,AUTO
         1 000205   200127 451500                    STP1    @QTN$+2,,AUTO
         1 000206   003024 701000 1                  TSX1    CHKTYP
         1 000207   001423 702000 1                  TSX2    ERROR

      299     9889    1         CALL CHKTYP (CGCP.TMTYP) ALTRET (ERROR);

   9889  1 000210   200026 630500                    EPPR0   CGCP,,AUTO
         1 000211   200127 450500                    STP0    @QTN$+2,,AUTO
         1 000212   003024 701000 1                  TSX1    CHKTYP
         1 000213   001423 702000 1                  TSX2    ERROR

      300     9890    1         IF CGCP.DEFERBLKS > 200 THEN CGCP.DEFERBLKS=200;

   9890  1 000214   200036 236100                    LDQ     CGCP+8,,AUTO
         1 000215   000777 376003                    ANQ     511,DU
         1 000216   000311 116003                    CMPQ    201,DU
         1 000217   000223 602000 1                  TNC     s:9891

   9890  1 000220   000310 236003                    LDQ     200,DU
         1 000221   200036 552120                    STBQ    CGCP+8,'20'O,AUTO
         1 000222   000227 710000 1                  TRA     s:9892

      301     9891    1         ELSE IF CGCP.DEFERBLKS < 5 THEN CGCP.DEFERBLKS=5;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:58   
   9891  1 000223   000005 116003                    CMPQ    5,DU
         1 000224   000227 603000 1                  TRC     s:9892

   9891  1 000225   000005 236003                    LDQ     5,DU
         1 000226   200036 552120                    STBQ    CGCP+8,'20'O,AUTO

      302     9892    1         IF CGCP.MINRD < 2 THEN CGCP.MINRD=2;

   9892  1 000227   200041 220100                    LDX0    CGCP+11,,AUTO
         1 000230   000002 100003                    CMPX0   2,DU
         1 000231   000234 603000 1                  TRC     s:9893

   9892  1 000232   000002 221003                    LDX1    2,DU
         1 000233   200041 741100                    STX1    CGCP+11,,AUTO

      303     9893    1         IF CGCP.MAXRD < 3 THEN CGCP.MAXRD=3;

   9893  1 000234   200041 720100                    LXL0    CGCP+11,,AUTO
         1 000235   000003 100003                    CMPX0   3,DU
         1 000236   000241 603000 1                  TRC     s:9894

   9893  1 000237   000003 221003                    LDX1    3,DU
         1 000240   200041 441100                    SXL1    CGCP+11,,AUTO

      304     9894    1         IF CGCP.MINRD > CGCP.MAXRD THEN CGCP.MAXRD=CGCP.MINRD;

   9894  1 000241   200041 720100                    LXL0    CGCP+11,,AUTO
         1 000242   200041 100100                    CMPX0   CGCP+11,,AUTO
         1 000243   000246 603000 1                  TRC     s:9895

   9894  1 000244   200041 221100                    LDX1    CGCP+11,,AUTO
         1 000245   200041 441100                    SXL1    CGCP+11,,AUTO

      305     9895    1         IF CGCP.MINPG < 2 THEN CGCP.MINPG=2;

   9895  1 000246   200032 220100                    LDX0    CGCP+4,,AUTO
         1 000247   000002 100003                    CMPX0   2,DU
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:59   
         1 000250   000253 603000 1                  TRC     s:9896

   9895  1 000251   000002 221003                    LDX1    2,DU
         1 000252   200032 741100                    STX1    CGCP+4,,AUTO

      306     9896    1         IF CGCP.MAXPG < 3 THEN CGCP.MAXPG=3;

   9896  1 000253   200034 220100                    LDX0    CGCP+6,,AUTO
         1 000254   000003 100003                    CMPX0   3,DU
         1 000255   000260 603000 1                  TRC     s:9897

   9896  1 000256   000003 221003                    LDX1    3,DU
         1 000257   200034 741100                    STX1    CGCP+6,,AUTO

      307     9897    1         IF CGCP.MINPG > CGCP.MAXPG THEN CGCP.MAXPG=CGCP.MINPG;

   9897  1 000260   200034 220100                    LDX0    CGCP+6,,AUTO
         1 000261   200032 100100                    CMPX0   CGCP+4,,AUTO
         1 000262   000265 603000 1                  TRC     s:9898

   9897  1 000263   200032 221100                    LDX1    CGCP+4,,AUTO
         1 000264   200034 741100                    STX1    CGCP+6,,AUTO

      308     9898    1         IF CGCP.SECURE THEN

   9898  1 000265   200037 236100                    LDQ     CGCP+9,,AUTO
         1 000266   000001 316003                    CANQ    1,DU
         1 000267   000275 600000 1                  TZE     s:9903

      309     9899    2           DO;

      310     9900    2           CGCP.WAS='1'B;

   9900  1 000270   000010 236007                    LDQ     8,DL
         1 000271   200034 256100                    ORSQ    CGCP+6,,AUTO

      311     9901    2           CGCP.SMD='1'B;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:60   

   9901  1 000272   000002 236007                    LDQ     2,DL
         1 000273   200034 256100                    ORSQ    CGCP+6,,AUTO

      312     9902    2           END;

   9902  1 000274   000302 710000 1                  TRA     s:9904

      313     9903    1         ELSE IF CGCP.SMD = '0'B THEN CGCP.WAS='0'B;

   9903  1 000275   200034 236100                    LDQ     CGCP+6,,AUTO
         1 000276   000002 316007                    CANQ    2,DL
         1 000277   000302 601000 1                  TNZ     s:9904

   9903  1 000300   000005 236000 2                  LDQ     5
         1 000301   200034 356100                    ANSQ    CGCP+6,,AUTO

      314     9904    1         IF NOT CGCP.CONMSG THEN

   9904  1 000302   200034 236100                    LDQ     CGCP+6,,AUTO
         1 000303   400000 316007                    CANQ    -131072,DL
         1 000304   000311 601000 1                  TNZ     s:9909

      315     9905    2           DO;

      316     9906    2           CGCP.DSCREQ='0'B;

   9906  1 000305   000006 236000 2                  LDQ     6
         1 000306   200037 356100                    ANSQ    CGCP+9,,AUTO

      317     9907    2           CGCP.DCBCONWA='0'B;

   9907  1 000307   000007 236000 2                  LDQ     7
         1 000310   200037 356100                    ANSQ    CGCP+9,,AUTO

      318     9908    2           END;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:61   
      319     9909    1         IF CGCP.MAXMC > KQ_MCMAX# THEN

   9909  1 000311   200035 235100                    LDA     CGCP+7,,AUTO
         1 000312   007401 115007                    CMPA    3841,DL
         1 000313   000316 602000 1                  TNC     s:9911

      320     9910    1          CGCP.MAXMC = KQ_MCMAX#;

   9910  1 000314   007400 236007                    LDQ     3840,DL
         1 000315   200035 756100                    STQ     CGCP+7,,AUTO

      321     9911    1         IF CGCP.TRMRDSIZ = 0 OR CGCP.TRMRDSIZ > CGCP.MAXMC THEN CGCP.TRMRDSIZ=CGCP.
              9911                  MAXMC;

   9911  1 000316   200037 720100                    LXL0    CGCP+9,,AUTO
         1 000317   000325 600000 1                  TZE     s:9911+7
         1 000320   200037 236100                    LDQ     CGCP+9,,AUTO
         1 000321   777777 376007                    ANQ     -1,DL
         1 000322   200035 116100                    CMPQ    CGCP+7,,AUTO
         1 000323   000327 602000 1                  TNC     s:9912
         1 000324   000327 600000 1                  TZE     s:9912

   9911  1 000325   200035 721100                    LXL1    CGCP+7,,AUTO
         1 000326   200037 441100                    SXL1    CGCP+9,,AUTO

      322     9912    1         IF CGCP.JOURNAL ~= CG$->KQ$CG.AUCTL.JOURNAL THEN JFLG=1;

   9912  1 000327   200006 470500                    LDP0    CG$,,AUTO
         1 000330   200037 236100                    LDQ     CGCP+9,,AUTO
         1 000331   000136 676100                    ERQ     94,,PR0
         1 000332   000400 376003                    ANQ     256,DU
         1 000333   000336 600000 1                  TZE     s:9913

   9912  1 000334   000001 235007                    LDA     1,DL
         1 000335   200104 755100                    STA     JFLG,,AUTO

      323     9913    1         IF KQ$CG.AUCTL.TERMCONLGL = '0'B AND CGCP.TERMCONLGL THEN TOKFLG=0;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:62   

   9913  1 000336   000136 236100                    LDQ     94,,PR0
         1 000337   000010 316003                    CANQ    8,DU
         1 000340   000346 601000 1                  TNZ     s:9914
         1 000341   200037 236100                    LDQ     CGCP+9,,AUTO
         1 000342   000010 316003                    CANQ    8,DU
         1 000343   000346 600000 1                  TZE     s:9914

   9913  1 000344   200114 450100                    STZ     TOKFLG,,AUTO
         1 000345   000350 710000 1                  TRA     s:9917

      324     9914    1         ELSE TOKFLG=1;

   9914  1 000346   000001 235007                    LDA     1,DL
         1 000347   200114 755100                    STA     TOKFLG,,AUTO

      325     9915        /**/
      326     9916              %LOCK (G=KQ$DTREE.GATE);

   9917  1 000350   200006 236100                    LDQ     CG$,,AUTO
         1 000351   000231 036003                    ADLQ    153,DU
         1 000352   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000353   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000354   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000355   000000 701000 xent               TSX1    HFC$LOCK
         1 000356   000000 011000                    NOP     0

      327     9919    1         IF CGCP.MAXPG > CG$->KQ$CG.NGAVAL THEN

   9919  1 000357   200006 470500                    LDP0    CG$,,AUTO
         1 000360   200034 236100                    LDQ     CGCP+6,,AUTO
         1 000361   000022 772000                    QRL     18
         1 000362   000217 116100                    CMPQ    143,,PR0
         1 000363   000400 602000 1                  TNC     s:9933
         1 000364   000400 600000 1                  TZE     s:9933

      328     9920    2           DO;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:63   

      329     9921                %UNLOCK (G=KQ$DTREE.GATE);

   9922  1 000365   200006 236100                    LDQ     CG$,,AUTO
         1 000366   000231 036003                    ADLQ    153,DU
         1 000367   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000370   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000372   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000373   000000 011000                    NOP     0

      330     9924    2           B$JIT.ERR=E_CGMPEN;

   9924  1 000374   000015 236000 0                  LDQ     E_CGMPEN
         1 000375   000000 470400 xsym               LDP0    B$JIT$
         1 000376   000012 756100                    STQ     10,,PR0

      331     9925        /*E* ERROR:   KQC-E$CGMPEN-E
      332     9926             MESSAGE: Your file is too small for that MAXPG value
      333     9927             MESSAGE1: A comgroup file must always have MAXPG free granules
      334     9928                       in it, for system recovery processing.  This error
      335     9929                       results from attempting to increase MAXPG when the
      336     9930                       file has too few free granules. */
      337     9931    2           GOTO ERROR;

   9931  1 000377   001423 710000 1                  TRA     ERROR

      338     9932    2           END;
      339     9933    1         IF (CGCP.DISKWARN > 0) AND (CGCP.REDISKWARN < 2)

   9933  1 000400   200040 220100                    LDX0    CGCP+10,,AUTO
         1 000401   000415 600000 1                  TZE     s:9937
         1 000402   200042 221100                    LDX1    CGCP+12,,AUTO
         1 000403   000002 101003                    CMPX1   2,DU
         1 000404   000415 603000 1                  TRC     s:9937

      340     9934    1         THEN CGCP.REDISKWARN = MAXIMUM (2,CGCP.DISKWARN/4);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:64   

   9934  1 000405   200040 236100                    LDQ     CGCP+10,,AUTO
         1 000406   000022 772000                    QRL     18
         1 000407   000002 772000                    QRL     2
         1 000410   000002 116007                    CMPQ    2,DL
         1 000411   000413 603000 1                  TRC     s:9934+6
         1 000412   000002 236007                    LDQ     2,DL
         1 000413   000000 622006                    EAX2    0,QL
         1 000414   200042 742100                    STX2    CGCP+12,,AUTO

      341     9935
      342     9936              /* REcalculate KQ$CG.TRIGGER when CGCP changes */
      343     9937    1         KQ$CG.TRIGGER = CGCP.DISKWARN + CGCP.MAXPG;

   9937  1 000415   200034 235100                    LDA     CGCP+6,,AUTO
         1 000416   000022 771000                    ARL     18
         1 000417   200132 755100                    STA     @TKEY+3,,AUTO
         1 000420   200040 236100                    LDQ     CGCP+10,,AUTO
         1 000421   000022 772000                    QRL     18
         1 000422   200132 036100                    ADLQ    @TKEY+3,,AUTO
         1 000423   000224 756100                    STQ     148,,PR0

      344     9938    1         I=CG$->KQ$CG.NGAVAL-CG$->KQ$CG.AUCTL.MAXPG;

   9938  1 000424   000133 236100                    LDQ     91,,PR0
         1 000425   000022 772000                    QRL     18
         1 000426   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000427   000217 236100                    LDQ     143,,PR0
         1 000430   200132 136100                    SBLQ    @TKEY+3,,AUTO
         1 000431   200113 756100                    STQ     I,,AUTO

      345     9939    1         IF I >= CGCP.DISKWARN THEN

   9939  1 000432   200040 236100                    LDQ     CGCP+10,,AUTO
         1 000433   000022 772000                    QRL     18
         1 000434   200113 116100                    CMPQ    I,,AUTO
         1 000435   000437 600000 1                  TZE     s:9940
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:65   
         1 000436   000472 603000 1                  TRC     s:9951

      346     9940    1          IF CG$->KQ$CG.NGAVAL-CGCP.MAXPG < CGCP.DISKWARN THEN

   9940  1 000437   200132 755100                    STA     @TKEY+3,,AUTO
         1 000440   000217 236100                    LDQ     143,,PR0
         1 000441   200132 136100                    SBLQ    @TKEY+3,,AUTO
         1 000442   200040 235100                    LDA     CGCP+10,,AUTO
         1 000443   000022 771000                    ARL     18
         1 000444   200133 755100                    STA     @TKEY+4,,AUTO
         1 000445   200133 116100                    CMPQ    @TKEY+4,,AUTO
         1 000446   000472 605000 1                  TPL     s:9951

      347     9941    2            DO;

      348     9942                 %LOCK (G=CG$->KQ$CG.GATE.CG);

   9943  1 000447   200006 236100                    LDQ     CG$,,AUTO
         1 000450   000107 036003                    ADLQ    71,DU
         1 000451   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000452   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000453   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000454   000000 701000 xent               TSX1    HFC$LOCK
         1 000455   000000 011000                    NOP     0

      349     9945    2            CG$->KQ$CG.DELAY.DISKWARN='1'B;

   9945  1 000456   200006 470500                    LDP0    CG$,,AUTO
         1 000457   001000 236003                    LDQ     512,DU
         1 000460   000020 256100                    ORSQ    16,,PR0

      350     9946    2            CG$->KQ$CG.TRIGGERED='1'B;

   9946  1 000461   000400 236007                    LDQ     256,DL
         1 000462   000216 256100                    ORSQ    142,,PR0

      351     9947                 %UNLOCK (G=CG$->KQ$CG.GATE.CG);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:66   

   9948  1 000463   200006 236100                    LDQ     CG$,,AUTO
         1 000464   000107 036003                    ADLQ    71,DU
         1 000465   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000466   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000467   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000470   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000471   000000 011000                    NOP     0

      352     9950    2            END;

      353     9951    1         I=CG$->KQ$CG.MMD.MAXBPG;

   9951  1 000472   200006 470500                    LDP0    CG$,,AUTO
         1 000473   000010 236100                    LDQ     8,,PR0
         1 000474   777777 376007                    ANQ     -1,DL
         1 000475   200113 756100                    STQ     I,,AUTO

      354     9952    1         CG$->KQ$CG.AUCTL=CGCP;

   9952  1 000476   000100 100500                    MLR     fill='000'O
         1 000477   200026 000120                    ADSC9   CGCP,,AUTO               cn=0,n=80
         1 000500   000125 000120                    ADSC9   85,,PR0                  cn=0,n=80

      355     9953              %UNLOCK (G=KQ$DTREE.GATE);

   9954  1 000501   200006 236100                    LDQ     CG$,,AUTO
         1 000502   000231 036003                    ADLQ    153,DU
         1 000503   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000504   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000505   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000506   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000507   000000 011000                    NOP     0

      356     9956        /**/
      357     9957    1         CALL CXTSET ALTRET(ERROR);

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:67   
   9957  1 000510   003434 701000 1                  TSX1    CXTSET
         1 000511   001423 702000 1                  TSX2    ERROR

      358     9958    1         IF CG$->KQ$CG.MMD.MAXBPG > I THEN

   9958  1 000512   200006 470500                    LDP0    CG$,,AUTO
         1 000513   000010 236100                    LDQ     8,,PR0
         1 000514   777777 376007                    ANQ     -1,DL
         1 000515   200113 116100                    CMPQ    I,,AUTO
         1 000516   000524 602000 1                  TNC     s:9960
         1 000517   000524 600000 1                  TZE     s:9960

      359     9959    1          CALL KQM$MOREPG (CG$->KQ$CG);

   9959  1 000520   200006 630500                    EPPR0   CG$,,AUTO
         1 000521   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000522   000000 701000 xent               TSX1    KQM$MOREPG
         1 000523   000000 011000                    NOP     0

      360     9960    1         DCB$=B$JIT$->B$JIT.DCB$;

   9960  1 000524   000000 470400 xsym               LDP0    B$JIT$
         1 000525   000232 236100                    LDQ     154,,PR0
         1 000526   200110 756100                    STQ     DCB$,,AUTO

      361     9961    1         IF DCB$->F$DCB.ACCT=':SYS' THEN

   9961  1 000527   200110 471500                    LDP1    DCB$,,AUTO
         1 000530   040000 106500                    CMPC    fill='040'O
         1 000531   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         1 000532   000035 000004 0                  ADSC9   CCGID+12                 cn=0,n=4
         1 000533   000570 601000 1                  TNZ     s:9971

      362     9962    2           DO;

      363     9963    2           IF ADDR(DCB$->F$DCB.NAME)->VTXTC.TXT='CSCG' THEN CALL KCL$HOOKUPM;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:68   
   9963  1 000534   100010 236100                    LDQ     8,,PR1
         1 000535   000033 772000                    QRL     27
         1 000536   000000 620006                    EAX0    0,QL
         1 000537   040000 106540                    CMPC    fill='040'O
         1 000540   100010 200010                    ADSC9   8,,PR1                   cn=1,n=*X0
         1 000541   000036 000004 0                  ADSC9   CCGID+13                 cn=0,n=4
         1 000542   000547 601000 1                  TNZ     s:9964

   9963  1 000543   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000544   000000 701000 xent               TSX1    KCL$HOOKUPM
         1 000545   000000 011000                    NOP     0
         1 000546   000570 710000 1                  TRA     s:9971

      364     9964    2           ELSE IF ADDR(DCB$->F$DCB.NAME)->VTXTC.TXT='OCCG' THEN CALL KCL$HOOKUPH;

   9964  1 000547   040000 106540                    CMPC    fill='040'O
         1 000550   100010 200010                    ADSC9   8,,PR1                   cn=1,n=*X0
         1 000551   000037 000004 0                  ADSC9   CCGID+14                 cn=0,n=4
         1 000552   000557 601000 1                  TNZ     s:9965

   9964  1 000553   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000554   000000 701000 xent               TSX1    KCL$HOOKUPH
         1 000555   000000 011000                    NOP     0
         1 000556   000570 710000 1                  TRA     s:9971

      365     9965    2            ELSE IF ADDR(DCB$->F$DCB.NAME)->VTXTC.TXT='HLPCG' THEN

   9965  1 000557   040000 106540                    CMPC    fill='040'O
         1 000560   100010 200010                    ADSC9   8,,PR1                   cn=1,n=*X0
         1 000561   000040 000005 0                  ADSC9   CCGID+15                 cn=0,n=5
         1 000562   000570 601000 1                  TNZ     s:9971

      366     9966    3               DO;

      367     9967    3               CALL KCL$HOOKUPMB;

   9967  1 000563   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:69   
         1 000564   000000 701000 xent               TSX1    KCL$HOOKUPMB
         1 000565   000000 011000                    NOP     0

      368     9968    3               TOKFLG=1;

   9968  1 000566   000001 235007                    LDA     1,DL
         1 000567   200114 755100                    STA     TOKFLG,,AUTO

      369     9969    3               END;

      370     9970    2           END;

      371     9971    1         IF TOKFLG=0 THEN CALL TRMGO;  /* CONNECT WAITING TERMS */

   9971  1 000570   200114 235100                    LDA     TOKFLG,,AUTO
         1 000571   000574 601000 1                  TNZ     NOCTL

   9971  1 000572   003352 701000 1                  TSX1    TRMGO
         1 000573   000000 011000                    NOP     0

   9971  1 000574                       NOCTL        null
      372     9972    1   NOCTL:;
      373     9973        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:70   
      374     9974
      375     9975                 /****************************************
      376     9976                  *                                      *
      377     9977                  *        PROCESS TYP LIST              *
      378     9978                  *                                      *
      379     9979                  ****************************************/
      380     9980
      381     9981    1         CALL HFF$DSIZ (1,DSIZ) ALTRET(NOTYPL);

   9981  1 000574   200017 630500                    EPPR0   DSIZ,,AUTO
         1 000575   200133 450500                    STP0    @TKEY+4,,AUTO
         1 000576   000010 236000 2                  LDQ     8
         1 000577   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000600   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000601   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000602   000000 701000 xent               TSX1    HFF$DSIZ
         1 000603   001441 702000 1                  TSX2    NOTYPL

      382     9982    1         NTYP=(DSIZ-4)/LENGTHC(VLP$CGTYPL.LIST(0));

   9982  1 000604   200017 236100                    LDQ     DSIZ,,AUTO
         1 000605   000004 136007                    SBLQ    4,DL
         1 000606   000034 506007                    DIV     28,DL
         1 000607   200020 756100                    STQ     NTYP,,AUTO

      383     9983    1         IF NTYP = 0 THEN GOTO NOTYPL;

   9983  1 000610   000000 116003                    CMPQ    0,DU
         1 000611   001441 600000 1                  TZE     NOTYPL

      384     9984    1         IF  QLIST ~= 0

   9984  1 000612   200106 235100                    LDA     QLIST,,AUTO
         1 000613   000625 600000 1                  TZE     s:9997
         1 000614   200006 470500                    LDP0    CG$,,AUTO
         1 000615   000106 235100                    LDA     70,,PR0
         1 000616   000625 601000 1                  TNZ     s:9997
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:71   

      385     9985    1         AND CG$->KQ$CG.QISS = '0'B THEN
      386     9986    1          IF NQ < NTYP THEN

   9986  1 000617   200107 116100                    CMPQ    NQ,,AUTO
         1 000620   000625 604400 1                  TMOZ    s:9997

      387     9987    2            DO;

   9983  1 000621                       IQLS         null
      388     9988    2   IQLS:    ;
      389     9989    2            B$JIT.ERR=E_CGIQLS;

   9989  1 000621   000004 236000 0                  LDQ     E_CGIQLS
         1 000622   000000 470400 xsym               LDP0    B$JIT$
         1 000623   000012 756100                    STQ     10,,PR0

      390     9990        /*E* ERROR:   KQC-E$CGIQLS-E
      391     9991             MESSAGE: Insufficient QLIST area space for M$CGCTL
      392     9992             MESSAGE1: The QLIST area specified by your M$CGCTL service
      393     9993                       is not as long as the list (STALIST or TYPLIST) it
      394     9994                       is parallel to. */
      395     9995    2            GOTO ERROR;

   9995  1 000624   001423 710000 1                  TRA     ERROR

      396     9996    2            END;
      397     9997    2           DO CASE (FPT$CGCTL.TYPFC);

   9997  1 000625   000000 470400 xsym               LDP0    B$PS0$
         1 000626   000000 236100                    LDQ     0,,PR0
         1 000627   000003 772000                    QRL     3
         1 000630   000007 376007                    ANQ     7,DL
         1 000631   000005 116007                    CMPQ    5,DL
         1 000632   000634 602006 1                  TNC     s:9997+7,QL
         1 000633   001405 710000 1                  TRA     BADOPT
         1 000634   001405 710000 1                  TRA     BADOPT
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:72   
         1 000635   001223 710000 1                  TRA     s:10113
         1 000636   000663 710000 1                  TRA     ADDTYP0
         1 000637   001140 710000 1                  TRA     s:10086
         1 000640   000641 710000 1                  TRA     s:10003

      398     9998
      399     9999                           /******************************
      400    10000                            *        SETLIST             *
      401    10001                            ******************************/
      402    10002    2             CASE (%CG_CTLFC_SETLIST#);

      403    10003    2               CALL TLOCK;

  10003  1 000641   002363 701000 1                  TSX1    TLOCK
         1 000642   000000 011000                    NOP     0

      404    10004    2               DFCHK=0;

  10004  1 000643   200111 450100                    STZ     DFCHK,,AUTO

      405    10005    2               MTYP$=KQ$TTREE.HEAD$;

  10005  1 000644   200006 470500                    LDP0    CG$,,AUTO
         1 000645   000073 236100                    LDQ     59,,PR0
         1 000646   200015 756100                    STQ     MTYP$,,AUTO

      406    10006    3                 DO WHILE (MTYP$ ~= ADDR(NIL));

  10006  1 000647   000656 710000 1                  TRA     s:10009

      407    10007    3                 MTYP$->KQ$MTYP.DFCHK='0'B;

  10007  1 000650   200015 470500                    LDP0    MTYP$,,AUTO
         1 000651   000011 236000 2                  LDQ     9
         1 000652   000007 356100                    ANSQ    7,,PR0

      408    10008    3                 MTYP$=MTYP$->KQ$MTYP.BTN.FLINK$;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:73   

  10008  1 000653   200015 470500                    LDP0    MTYP$,,AUTO
         1 000654   000004 236100                    LDQ     4,,PR0
         1 000655   200015 756100                    STQ     MTYP$,,AUTO

      409    10009    3                 END;

  10009  1 000656   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000657   000650 601000 1                  TNZ     s:10007

      410    10010    2               CALL TUNLOCK;

  10010  1 000660   002375 701000 1                  TSX1    TUNLOCK
         1 000661   000000 011000                    NOP     0

      411    10011    2               GOTO ADDTYP0;

  10011  1 000662   000663 710000 1                  TRA     ADDTYP0

      412    10012
      413    10013                           /******************************
      414    10014                            *          ADD               *
      415    10015                            ******************************/
      416    10016    2             CASE (%CG_CTLFC_ADD#);

  10007  1 000663                       ADDTYP0      null
      417    10017    2   ADDTYP0:    ;
      418    10018    2               CALL HFF$TRAPALT ALTRET(TYPTRAP);

  10018  1 000663   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000664   000000 701000 xent               TSX1    HFF$TRAPALT
         1 000665   001433 702000 1                  TSX2    TYPTRAPB

      419    10019    3                 DO TYPX = 0 TO NTYP-1;

  10019  1 000666   200021 450100                    STZ     TYPX,,AUTO
         1 000667   001062 710000 1                  TRA     s:10047+1
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:74   

      420    10020    3                 CALL TLOCK;

  10020  1 000670   002363 701000 1                  TSX1    TLOCK
         1 000671   000000 011000                    NOP     0

      421    10021    3                 KEY=VLP$CGTYPL.LIST.NAME(TYPX);

  10021  1 000672   200021 236100                    LDQ     TYPX,,AUTO
         1 000673   000034 402007                    MPY     28,DL
         1 000674   000000 470400 xsym               LDP0    B$PS1$
         1 000675   040100 100506                    MLR     fill='040'O
         1 000676   000001 000010                    ADSC9   1,Q,PR0                  cn=0,n=8
         1 000677   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

      422    10022    3                 CALL KQB$SRCH (KQ$TTREE,KEY,MTYP$) ALTRET(NOTYP0);

  10022  1 000700   200015 631500                    EPPR1   MTYP$,,AUTO
         1 000701   200134 451500                    STP1    @TKEY+5,,AUTO
         1 000702   200010 633500                    EPPR3   KEY,,AUTO
         1 000703   200133 453500                    STP3    @TKEY+4,,AUTO
         1 000704   200006 236100                    LDQ     CG$,,AUTO
         1 000705   000067 036003                    ADLQ    55,DU
         1 000706   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000707   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000710   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000711   000000 701000 xent               TSX1    KQB$SRCH
         1 000712   000714 702000 1                  TSX2    NOTYP0

      423    10023    3                 GOTO GOTTYP0;

  10023  1 000713   000735 710000 1                  TRA     GOTTYP0

  10021  1 000714                       NOTYP0       null
      424    10024    3   NOTYP0:       ;
      425    10025    3                 CALL INDEX (I,SUBSTR(KEY,0,1),KC_LGL1ST) ALTRET(BADTYPCHR);

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:75   
  10025  1 000714   000100 124400                    SCM     mask='000'O
         1 000715   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000716   200010 000001                    ADSC9   KEY,,AUTO                cn=0,n=1
         1 000717   200113 000100                    ARG     I,,AUTO
         1 000720   001412 606400 1                  TTN     BADTYPCHR

      426    10026    3                 MTYP$=MYSTA$;

  10026  1 000721   200014 236100                    LDQ     MYSTA$,,AUTO
         1 000722   200015 756100                    STQ     MTYP$,,AUTO

      427    10027    3                 CALL KQT$GETTYP (CG$->KQ$CG,MTYP$,KEY) ALTRET(NOTYPMEM);

  10027  1 000723   200010 630500                    EPPR0   KEY,,AUTO
         1 000724   200134 450500                    STP0    @TKEY+5,,AUTO
         1 000725   200015 631500                    EPPR1   MTYP$,,AUTO
         1 000726   200133 451500                    STP1    @TKEY+4,,AUTO
         1 000727   200006 236100                    LDQ     CG$,,AUTO
         1 000730   200132 756100                    STQ     @TKEY+3,,AUTO
         1 000731   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 000732   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000733   000000 701000 xent               TSX1    KQT$GETTYP
         1 000734   001430 702000 1                  TSX2    NOTYPMEM

  10026  1 000735                       GOTTYP0      null
      428    10028    3   GOTTYP0:      ;
      429    10029    3                 IF KEY = CG$->KQ$CG.AUCTL.DMTYP THEN DFCHK=DFCHK+1;

  10029  1 000735   200006 470500                    LDP0    CG$,,AUTO
         1 000736   040100 106500                    CMPC    fill='040'O
         1 000737   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8
         1 000740   000127 000010                    ADSC9   87,,PR0                  cn=0,n=8
         1 000741   000745 601000 1                  TNZ     s:10030

  10029  1 000742   200111 235100                    LDA     DFCHK,,AUTO
         1 000743   000001 035007                    ADLA    1,DL
         1 000744   200111 755100                    STA     DFCHK,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:76   

      430    10030    3                 IF KEY = CG$->KQ$CG.AUCTL.TMTYP THEN DFCHK=DFCHK+1;

  10030  1 000745   040100 106500                    CMPC    fill='040'O
         1 000746   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8
         1 000747   000125 000010                    ADSC9   85,,PR0                  cn=0,n=8
         1 000750   000754 601000 1                  TNZ     s:10031

  10030  1 000751   200111 235100                    LDA     DFCHK,,AUTO
         1 000752   000001 035007                    ADLA    1,DL
         1 000753   200111 755100                    STA     DFCHK,,AUTO

      431    10031    3                 MTYP$->KQ$MTYP.DFCHK='1'B;

  10031  1 000754   200015 471500                    LDP1    MTYP$,,AUTO
         1 000755   000100 236003                    LDQ     64,DU
         1 000756   100007 256100                    ORSQ    7,,PR1

      432    10032    3                 MTYP$->KQ$MTYP.PERM=VLP$CGTYPL.LIST.PERM(TYPX);

  10032  1 000757   200015 471500                    LDP1    MTYP$,,AUTO
         1 000760   200021 236100                    LDQ     TYPX,,AUTO
         1 000761   000007 402007                    MPY     7,DL
         1 000762   000000 473400 xsym               LDP3    B$PS1$
         1 000763   300003 236106                    LDQ     3,QL,PR3
         1 000764   000003 772000                    QRL     3
         1 000765   100007 676100                    ERQ     7,,PR1
         1 000766   000040 376003                    ANQ     32,DU
         1 000767   100007 656100                    ERSQ    7,,PR1

      433    10033    3                 MTYP$->KQ$MTYP.JOURNAL=VLP$CGTYPL.LIST.JOURNAL(TYPX);

  10033  1 000770   200015 471500                    LDP1    MTYP$,,AUTO
         1 000771   200021 236100                    LDQ     TYPX,,AUTO
         1 000772   000007 402007                    MPY     7,DL
         1 000773   300003 236106                    LDQ     3,QL,PR3
         1 000774   000001 736000                    QLS     1
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:77   
         1 000775   100007 676100                    ERQ     7,,PR1
         1 000776   000400 376003                    ANQ     256,DU
         1 000777   100007 656100                    ERSQ    7,,PR1

      434    10034    3                 MTYP$->KQ$MTYP.ONEREPORT=VLP$CGTYPL.LIST.ONEREPORT(TYPX);

  10034  1 001000   200015 471500                    LDP1    MTYP$,,AUTO
         1 001001   200021 236100                    LDQ     TYPX,,AUTO
         1 001002   000007 402007                    MPY     7,DL
         1 001003   300003 236106                    LDQ     3,QL,PR3
         1 001004   000001 736000                    QLS     1
         1 001005   100007 676100                    ERQ     7,,PR1
         1 001006   000200 376003                    ANQ     128,DU
         1 001007   100007 656100                    ERSQ    7,,PR1

      435    10035    3                 MTYP$->KQ$MTYP.MAXLATCH=VLP$CGTYPL.LIST.MAXLATCH(TYPX);

  10035  1 001010   200021 236100                    LDQ     TYPX,,AUTO
         1 001011   000007 402007                    MPY     7,DL
         1 001012   300005 220106                    LDX0    5,QL,PR3
         1 001013   200015 471500                    LDP1    MTYP$,,AUTO
         1 001014   100007 440100                    SXL0    7,,PR1

      436    10036    3                 PRIO=VLP$CGTYPL.LIST.PRIO(TYPX);

  10036  1 001015   200021 236100                    LDQ     TYPX,,AUTO
         1 001016   000007 402007                    MPY     7,DL
         1 001017   300003 236106                    LDQ     3,QL,PR3
         1 001020   000033 772000                    QRL     27
         1 001021   200022 756100                    STQ     PRIO,,AUTO

      437    10037    3                 CALL CHKPRI ALTRET(TYPALT);

  10037  1 001022   003010 701000 1                  TSX1    CHKPRI
         1 001023   001421 702000 1                  TSX2    TYPALT

      438    10038    3                 MTYP$->KQ$MTYP.MPRIO=PRIO;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:78   

  10038  1 001024   200015 470500                    LDP0    MTYP$,,AUTO
         1 001025   200022 236100                    LDQ     PRIO,,AUTO
         1 001026   000033 736000                    QLS     27
         1 001027   000007 552140                    STBQ    7,'40'O,PR0

      439    10039    3                 IF CG$->KQ$CG.QISS = '0'B THEN

  10039  1 001030   200006 470500                    LDP0    CG$,,AUTO
         1 001031   000106 235100                    LDA     70,,PR0
         1 001032   001057 601000 1                  TNZ     s:10046

      440    10040    4                   DO;

      441    10041    4                   IF QLIST ~= 0 THEN

  10041  1 001033   200106 236100                    LDQ     QLIST,,AUTO
         1 001034   001045 600000 1                  TZE     s:10043

      442    10042    4                    MTYP$->KQ$QTN.AUTORCVR=VLP$CGQL.LIST.AUTORCVR(TYPX);

  10042  1 001035   200015 471500                    LDP1    MTYP$,,AUTO
         1 001036   200021 236100                    LDQ     TYPX,,AUTO
         1 001037   000011 402007                    MPY     9,DL
         1 001040   000000 473400 xsym               LDP3    B$PS5$
         1 001041   300003 236106                    LDQ     3,QL,PR3
         1 001042   100050 676100                    ERQ     40,,PR1
         1 001043   400000 376003                    ANQ     -131072,DU
         1 001044   100050 656100                    ERSQ    40,,PR1

      443    10043    4                   CALL SETPRIO (MTYP$);

  10043  1 001045   200015 631500                    EPPR1   MTYP$,,AUTO
         1 001046   200125 451500                    STP1    I+2,,AUTO
         1 001047   003617 701000 1                  TSX1    SETPRIO
         1 001050   000000 011000                    NOP     0

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:79   
      444    10044    4                   CALL SETMXACT (MTYP$,TYPX);

  10044  1 001051   200021 630500                    EPPR0   TYPX,,AUTO
         1 001052   200122 450500                    STP0    K+1,,AUTO
         1 001053   200015 631500                    EPPR1   MTYP$,,AUTO
         1 001054   200121 451500                    STP1    JNAME+4,,AUTO
         1 001055   003636 701000 1                  TSX1    SETMXACT
         1 001056   000000 011000                    NOP     0

      445    10045    4                   END;

      446    10046    3                 CALL TUNLOCK;

  10046  1 001057   002375 701000 1                  TSX1    TUNLOCK
         1 001060   000000 011000                    NOP     0

      447    10047    3                 END;

  10047  1 001061   200021 054100                    AOS     TYPX,,AUTO
         1 001062   200021 236100                    LDQ     TYPX,,AUTO
         1 001063   200020 116100                    CMPQ    NTYP,,AUTO
         1 001064   000670 604000 1                  TMI     s:10020

      448    10048    2               CALL HFF$TRAPALT;

  10048  1 001065   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001066   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001067   000000 011000                    NOP     0

      449    10049    2               IF FPT$CGCTL.TYPFC = %CG_CTLFC_SETLIST# THEN

  10049  1 001070   000000 470400 xsym               LDP0    B$PS0$
         1 001071   000000 236100                    LDQ     0,,PR0
         1 001072   000070 376007                    ANQ     56,DL
         1 001073   000040 116007                    CMPQ    32,DL
         1 001074   001411 601000 1                  TNZ     s:10151

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:80   
      450    10050    3                 DO;

      451    10051    3                 IF DFCHK < 2 THEN

  10051  1 001075   200111 235100                    LDA     DFCHK,,AUTO
         1 001076   000002 115007                    CMPA    2,DL
         1 001077   001104 603000 1                  TRC     s:10065

      452    10052    4                   DO;

      453    10053    4                   B$JIT.ERR=E_CGMSDT;

  10053  1 001100   000014 236000 0                  LDQ     E_CGMSDT
         1 001101   000000 471400 xsym               LDP1    B$JIT$
         1 001102   100012 756100                    STQ     10,,PR1

      454    10054        /*E* ERROR:   KQC-E$CGMSDT-E
      455    10055             MESSAGE: M$CGCTL SET TYPE LIST must set the default types
      456    10056             MESSAGE1: The message type list supplied with M$CGCTL was
      457    10057                       supposed to be the entire list (TYPFC=SETLIST),
      458    10058                       yet did not include the default TERMINAL and
      459    10059                       DCB message types (VLP_CGCP.TMTYP, VLP_CGCP.DMTYP).
      460    10060                       This is not legal, and, while the supplied list
      461    10061                       has been added, none of those types not in the
      462    10062                       list have been deleted. */
      463    10063    4                   GOTO ERROR;

  10063  1 001103   001423 710000 1                  TRA     ERROR

      464    10064    4                   END;
      465    10065    3                 IF CG$->KQ$CG.AUCTL.XTYPLGL = '0'B THEN

  10065  1 001104   200006 471500                    LDP1    CG$,,AUTO
         1 001105   100133 236100                    LDQ     91,,PR1
         1 001106   000001 316007                    CANQ    1,DL
         1 001107   001411 601000 1                  TNZ     s:10151

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:81   
      466    10066    4                   DO;

      467    10067    4                   CALL TLOCK;

  10067  1 001110   002363 701000 1                  TSX1    TLOCK
         1 001111   000000 011000                    NOP     0

      468    10068    4                   MTYP$=KQ$TTREE.HEAD$;

  10068  1 001112   200006 470500                    LDP0    CG$,,AUTO
         1 001113   000073 236100                    LDQ     59,,PR0
         1 001114   200015 756100                    STQ     MTYP$,,AUTO

      469    10069    5                     DO WHILE (MTYP$ ~= ADDR(NIL));

  10069  1 001115   001133 710000 1                  TRA     s:10077

      470    10070    5                     IF MTYP$->KQ$MTYP.DFCHK = '0'B THEN

  10070  1 001116   200015 470500                    LDP0    MTYP$,,AUTO
         1 001117   000007 236100                    LDQ     7,,PR0
         1 001120   000100 316003                    CANQ    64,DU
         1 001121   001131 601000 1                  TNZ     s:10076

      471    10071    6                       DO;

      472    10072    6                       FLINK$=MTYP$->KQ$MTYP.BTN.FLINK$;

  10072  1 001122   000004 236100                    LDQ     4,,PR0
         1 001123   200112 756100                    STQ     FLINK$,,AUTO

      473    10073    6                       CALL DELTYP ALTRET(ERROR);

  10073  1 001124   002433 701000 1                  TSX1    DELTYP
         1 001125   001423 702000 1                  TSX2    ERROR

      474    10074    6                       MTYP$=FLINK$;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:82   

  10074  1 001126   200112 236100                    LDQ     FLINK$,,AUTO
         1 001127   200015 756100                    STQ     MTYP$,,AUTO

      475    10075    6                       END;

  10075  1 001130   001133 710000 1                  TRA     s:10077

      476    10076    5                     ELSE MTYP$=MTYP$->KQ$MTYP.BTN.FLINK$;

  10076  1 001131   000004 236100                    LDQ     4,,PR0
         1 001132   200015 756100                    STQ     MTYP$,,AUTO

      477    10077    5                     END;

  10077  1 001133   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001134   001116 601000 1                  TNZ     s:10070

      478    10078    4                   CALL TUNLOCK;

  10078  1 001135   002375 701000 1                  TSX1    TUNLOCK
         1 001136   000000 011000                    NOP     0

      479    10079    4                   END;

      480    10080    3                 END;

  10080  1 001137   001411 710000 1                  TRA     s:10151

      481    10081
      482    10082                           /******************************
      483    10083                            *          DELETE            *
      484    10084                            ******************************/
      485    10085    2             CASE (%CG_CTLFC_DELETE#);

      486    10086    3                 DO TYPX = 0 TO NTYP-1;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:83   
  10086  1 001140   200021 450100                    STZ     TYPX,,AUTO
         1 001141   001214 710000 1                  TRA     s:10106+1

      487    10087    3                 CALL TLOCK;

  10087  1 001142   002363 701000 1                  TSX1    TLOCK
         1 001143   000000 011000                    NOP     0

      488    10088    3                 CALL HFF$TRAPALT ALTRET(TYPTRAPB);

  10088  1 001144   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001145   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001146   001433 702000 1                  TSX2    TYPTRAPB

      489    10089    3                 KEY=VLP$CGTYPL.LIST.NAME(TYPX);

  10089  1 001147   200021 236100                    LDQ     TYPX,,AUTO
         1 001150   000034 402007                    MPY     28,DL
         1 001151   000000 470400 xsym               LDP0    B$PS1$
         1 001152   040100 100506                    MLR     fill='040'O
         1 001153   000001 000010                    ADSC9   1,Q,PR0                  cn=0,n=8
         1 001154   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

      490    10090    3                 CALL KQB$SRCH (KQ$TTREE,KEY,MTYP$) ALTRET(NOTYP1);

  10090  1 001155   200015 631500                    EPPR1   MTYP$,,AUTO
         1 001156   200134 451500                    STP1    @TKEY+5,,AUTO
         1 001157   200010 633500                    EPPR3   KEY,,AUTO
         1 001160   200133 453500                    STP3    @TKEY+4,,AUTO
         1 001161   200006 236100                    LDQ     CG$,,AUTO
         1 001162   000067 036003                    ADLQ    55,DU
         1 001163   200132 756100                    STQ     @TKEY+3,,AUTO
         1 001164   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 001165   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001166   000000 701000 xent               TSX1    KQB$SRCH
         1 001167   001211 702000 1                  TSX2    NOTYP1

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:84   
      491    10091    3                 IF KEY = CG$->KQ$CG.AUCTL.DMTYP

  10091  1 001170   200006 470500                    LDP0    CG$,,AUTO
         1 001171   040100 106500                    CMPC    fill='040'O
         1 001172   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8
         1 001173   000127 000010                    ADSC9   87,,PR0                  cn=0,n=8
         1 001174   001201 600000 1                  TZE     s:10094
         1 001175   040100 106500                    CMPC    fill='040'O
         1 001176   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8
         1 001177   000125 000010                    ADSC9   85,,PR0                  cn=0,n=8
         1 001200   001207 601000 1                  TNZ     s:10103

      492    10092    3                 OR KEY = CG$->KQ$CG.AUCTL.TMTYP THEN
      493    10093    4                   DO;

      494    10094    4                   B$JIT.ERR=E_CGCDDT;

  10094  1 001201   000006 236000 0                  LDQ     E_CGCDDT
         1 001202   000000 471400 xsym               LDP1    B$JIT$
         1 001203   100012 756100                    STQ     10,,PR1

      495    10095        /*E* ERROR:   KQC-E$CGCDDT-E
      496    10096             MESSAGE: M$CGCTL cannot delete a default message type
      497    10097             MESSAGE1: You specified a message type for deletion which
      498    10098                       was the default type for messages from terminals
      499    10099                       or DCBs.  This is illegal. */
      500    10100    4                   CALL TUNLOCK;

  10100  1 001204   002375 701000 1                  TSX1    TUNLOCK
         1 001205   000000 011000                    NOP     0

      501    10101    4                   GOTO ERROR;

  10101  1 001206   001423 710000 1                  TRA     ERROR

      502    10102    4                   END;
      503    10103    3                 CALL DELTYP ALTRET(ERROR);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:85   

  10103  1 001207   002433 701000 1                  TSX1    DELTYP
         1 001210   001423 702000 1                  TSX2    ERROR

  10091  1 001211                       NOTYP1       null
      504    10104    3   NOTYP1:       ;
      505    10105    3                 CALL TUNLOCK;

  10105  1 001211   002375 701000 1                  TSX1    TUNLOCK
         1 001212   000000 011000                    NOP     0

      506    10106    3                 END;

  10106  1 001213   200021 054100                    AOS     TYPX,,AUTO
         1 001214   200021 236100                    LDQ     TYPX,,AUTO
         1 001215   200020 116100                    CMPQ    NTYP,,AUTO
         1 001216   001142 604000 1                  TMI     s:10087

      507    10107    2               CALL HFF$TRAPALT;

  10107  1 001217   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001220   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001221   000000 011000                    NOP     0
         1 001222   001411 710000 1                  TRA     s:10151

      508    10108
      509    10109                           /******************************
      510    10110                            *        CHANGE ATTRS        *
      511    10111                            ******************************/
      512    10112    2             CASE (%CG_CTLFC_CHGATTR#);

      513    10113    2               CALL HFF$TRAPALT ALTRET(TYPTRAP);

  10113  1 001223   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001224   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001225   001433 702000 1                  TSX2    TYPTRAPB

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:86   
      514    10114    3                 DO TYPX = 0 TO NTYP-1;

  10114  1 001226   200021 450100                    STZ     TYPX,,AUTO
         1 001227   001376 710000 1                  TRA     s:10137+1

      515    10115    3                 CALL TLOCK;

  10115  1 001230   002363 701000 1                  TSX1    TLOCK
         1 001231   000000 011000                    NOP     0

      516    10116    3                 KEY=VLP$CGTYPL.LIST.NAME(TYPX);

  10116  1 001232   200021 236100                    LDQ     TYPX,,AUTO
         1 001233   000034 402007                    MPY     28,DL
         1 001234   000000 470400 xsym               LDP0    B$PS1$
         1 001235   040100 100506                    MLR     fill='040'O
         1 001236   000001 000010                    ADSC9   1,Q,PR0                  cn=0,n=8
         1 001237   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

      517    10117    3                 CALL KQB$SRCH (KQ$TTREE,KEY,MTYP$) ALTRET(NOTYP2);

  10117  1 001240   200015 631500                    EPPR1   MTYP$,,AUTO
         1 001241   200134 451500                    STP1    @TKEY+5,,AUTO
         1 001242   200010 633500                    EPPR3   KEY,,AUTO
         1 001243   200133 453500                    STP3    @TKEY+4,,AUTO
         1 001244   200006 236100                    LDQ     CG$,,AUTO
         1 001245   000067 036003                    ADLQ    55,DU
         1 001246   200132 756100                    STQ     @TKEY+3,,AUTO
         1 001247   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 001250   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001251   000000 701000 xent               TSX1    KQB$SRCH
         1 001252   001416 702000 1                  TSX2    NOTYP2

      518    10118    3                 IF FPT$CGCTL.ATTRS.PERM THEN

  10118  1 001253   000000 470400 xsym               LDP0    B$PS0$
         1 001254   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:87   
         1 001255   100000 316003                    CANQ    32768,DU
         1 001256   001270 600000 1                  TZE     s:10120

      519    10119    3                  MTYP$->KQ$MTYP.PERM=VLP$CGTYPL.LIST.PERM(TYPX);

  10119  1 001257   200015 471500                    LDP1    MTYP$,,AUTO
         1 001260   200021 236100                    LDQ     TYPX,,AUTO
         1 001261   000007 402007                    MPY     7,DL
         1 001262   000000 473400 xsym               LDP3    B$PS1$
         1 001263   300003 236106                    LDQ     3,QL,PR3
         1 001264   000003 772000                    QRL     3
         1 001265   100007 676100                    ERQ     7,,PR1
         1 001266   000040 376003                    ANQ     32,DU
         1 001267   100007 656100                    ERSQ    7,,PR1

      520    10120    3                 IF FPT$CGCTL.ATTRS.JOURNAL THEN

  10120  1 001270   000001 236100                    LDQ     1,,PR0
         1 001271   020000 316003                    CANQ    8192,DU
         1 001272   001304 600000 1                  TZE     s:10122

      521    10121    3                  MTYP$->KQ$MTYP.JOURNAL=VLP$CGTYPL.LIST.JOURNAL(TYPX);

  10121  1 001273   200015 471500                    LDP1    MTYP$,,AUTO
         1 001274   200021 236100                    LDQ     TYPX,,AUTO
         1 001275   000007 402007                    MPY     7,DL
         1 001276   000000 473400 xsym               LDP3    B$PS1$
         1 001277   300003 236106                    LDQ     3,QL,PR3
         1 001300   000001 736000                    QLS     1
         1 001301   100007 676100                    ERQ     7,,PR1
         1 001302   000400 376003                    ANQ     256,DU
         1 001303   100007 656100                    ERSQ    7,,PR1

      522    10122    3                 IF FPT$CGCTL.ATTRS.ONEREPORT THEN

  10122  1 001304   000001 236100                    LDQ     1,,PR0
         1 001305   010000 316003                    CANQ    4096,DU
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:88   
         1 001306   001320 600000 1                  TZE     s:10124

      523    10123    3                  MTYP$->KQ$MTYP.ONEREPORT=VLP$CGTYPL.LIST.ONEREPORT(TYPX);

  10123  1 001307   200015 471500                    LDP1    MTYP$,,AUTO
         1 001310   200021 236100                    LDQ     TYPX,,AUTO
         1 001311   000007 402007                    MPY     7,DL
         1 001312   000000 473400 xsym               LDP3    B$PS1$
         1 001313   300003 236106                    LDQ     3,QL,PR3
         1 001314   000001 736000                    QLS     1
         1 001315   100007 676100                    ERQ     7,,PR1
         1 001316   000200 376003                    ANQ     128,DU
         1 001317   100007 656100                    ERSQ    7,,PR1

      524    10124    3                 IF FPT$CGCTL.ATTRS.MAXLATCH THEN

  10124  1 001320   000001 236100                    LDQ     1,,PR0
         1 001321   004000 316003                    CANQ    2048,DU
         1 001322   001331 600000 1                  TZE     s:10126

      525    10125    3                  MTYP$->KQ$MTYP.MAXLATCH=VLP$CGTYPL.LIST.MAXLATCH(TYPX);

  10125  1 001323   200021 236100                    LDQ     TYPX,,AUTO
         1 001324   000007 402007                    MPY     7,DL
         1 001325   000000 471400 xsym               LDP1    B$PS1$
         1 001326   100005 220106                    LDX0    5,QL,PR1
         1 001327   200015 473500                    LDP3    MTYP$,,AUTO
         1 001330   300007 440100                    SXL0    7,,PR3

      526    10126    3                 IF FPT$CGCTL.ATTRS.PRIO THEN

  10126  1 001331   000001 234100                    SZN     1,,PR0
         1 001332   001356 605000 1                  TPL     s:10133

      527    10127    4                   DO;

      528    10128    4                   PRIO=VLP$CGTYPL.LIST.PRIO(TYPX);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:89   

  10128  1 001333   200021 236100                    LDQ     TYPX,,AUTO
         1 001334   000007 402007                    MPY     7,DL
         1 001335   000000 471400 xsym               LDP1    B$PS1$
         1 001336   100003 236106                    LDQ     3,QL,PR1
         1 001337   000033 772000                    QRL     27
         1 001340   200022 756100                    STQ     PRIO,,AUTO

      529    10129    4                   CALL CHKPRI ALTRET(TYPALT);

  10129  1 001341   003010 701000 1                  TSX1    CHKPRI
         1 001342   001421 702000 1                  TSX2    TYPALT

      530    10130    4                   MTYP$->KQ$MTYP.MPRIO=PRIO;

  10130  1 001343   200015 470500                    LDP0    MTYP$,,AUTO
         1 001344   200022 236100                    LDQ     PRIO,,AUTO
         1 001345   000033 736000                    QLS     27
         1 001346   000007 552140                    STBQ    7,'40'O,PR0

      531    10131    4                   IF CG$->KQ$CG.QISS = '0'B THEN CALL SETPRIO (MTYP$);

  10131  1 001347   200006 470500                    LDP0    CG$,,AUTO
         1 001350   000106 235100                    LDA     70,,PR0
         1 001351   001356 601000 1                  TNZ     s:10133

  10131  1 001352   200015 631500                    EPPR1   MTYP$,,AUTO
         1 001353   200125 451500                    STP1    I+2,,AUTO
         1 001354   003617 701000 1                  TSX1    SETPRIO
         1 001355   000000 011000                    NOP     0

      532    10132    4                   END;

      533    10133    3                 IF  FPT$CGCTL.ATTRS.MXACT

  10133  1 001356   000000 470400 xsym               LDP0    B$PS0$
         1 001357   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:90   
         1 001360   200000 316003                    CANQ    65536,DU
         1 001361   001373 600000 1                  TZE     s:10136
         1 001362   200006 471500                    LDP1    CG$,,AUTO
         1 001363   100106 235100                    LDA     70,,PR1
         1 001364   001373 601000 1                  TNZ     s:10136

      534    10134    3                 AND CG$->KQ$CG.QISS = '0'B THEN
      535    10135    3                  CALL SETMXACT (MTYP$,TYPX);

  10135  1 001365   200021 633500                    EPPR3   TYPX,,AUTO
         1 001366   200122 453500                    STP3    K+1,,AUTO
         1 001367   200015 634500                    EPPR4   MTYP$,,AUTO
         1 001370   200121 454500                    STP4    JNAME+4,,AUTO
         1 001371   003636 701000 1                  TSX1    SETMXACT
         1 001372   000000 011000                    NOP     0

      536    10136    3                 CALL TUNLOCK;

  10136  1 001373   002375 701000 1                  TSX1    TUNLOCK
         1 001374   000000 011000                    NOP     0

      537    10137    3                 END;

  10137  1 001375   200021 054100                    AOS     TYPX,,AUTO
         1 001376   200021 236100                    LDQ     TYPX,,AUTO
         1 001377   200020 116100                    CMPQ    NTYP,,AUTO
         1 001400   001230 604000 1                  TMI     s:10115

      538    10138    2               CALL HFF$TRAPALT;

  10138  1 001401   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001402   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001403   000000 011000                    NOP     0
         1 001404   001411 710000 1                  TRA     s:10151

      539    10139
      540    10140    2             CASE (ELSE);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:91   

  10140  1 001405                       BADOPT       null
      541    10141    2   BADOPT:     ;
      542    10142    2               B$JIT.ERR=E_CGUAFC;

  10142  1 001405   000010 236000 0                  LDQ     E_CGUAFC
         1 001406   000000 470400 xsym               LDP0    B$JIT$
         1 001407   000012 756100                    STQ     10,,PR0

      543    10143        /*E* ERROR:   KQC-E$CGUAFC-E
      544    10144             MESSAGE: Unknown M$CGCTL function code
      545    10145             MESSAGE1: The STAFC or TYPFC code in your M$CGCTL FPT is
      546    10146                       unknown. */
      547    10147    2               GOTO ERROR;

  10147  1 001410   001423 710000 1                  TRA     ERROR

      548    10148
      549    10149
      550    10150    2           END; /*CASE FPT$CGCTL.TYPFC */

      551    10151    1         GOTO NOTYPL;

  10151  1 001411   001441 710000 1                  TRA     NOTYPL

  10142  1 001412                       BADTYPCHR    null
      552    10152    1   BADTYPCHR:;
      553    10153    1         B$JIT.ERR=E_TYPCHR;

  10153  1 001412   000016 236000 0                  LDQ     E_TYPCHR
         1 001413   000000 470400 xsym               LDP0    B$JIT$
         1 001414   000012 756100                    STQ     10,,PR0

      554    10154        /*E* ERROR:   KQC-E$TYPCHAR-E
      555    10155             MESSAGE: Illegal character in message type on M$CGCTL
      556    10156             MESSAGE1: A message type supplied to M$CGCTL had an illegal
      557    10157                       first character. */
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:92   
      558    10158    1         GOTO TYPALT;

  10158  1 001415   001421 710000 1                  TRA     TYPALT

  10153  1 001416                       NOTYP2       null
      559    10159    1   NOTYP2:;
      560    10160    1         B$JIT.ERR=E_CGAFNT;

  10160  1 001416   000011 236000 0                  LDQ     E_CGAFNT
         1 001417   000000 470400 xsym               LDP0    B$JIT$
         1 001420   000012 756100                    STQ     10,,PR0

  10160  1 001421                       TYPALT       null
      561    10161        /*E* ERROR:   KQC-E$CGAFNT
      562    10162             MESSAGE: M$CGCTL can't find that message type
      563    10163             MESSAGE1: One of the message types specified in your M$CGCTL
      564    10164                       service's TYPLIST could not be found. */
      565    10165    1   TYPALT:;
      566    10166    1         CALL TUNLOCK;

  10166  1 001421   002375 701000 1                  TSX1    TUNLOCK
         1 001422   000000 011000                    NOP     0

  10160  1 001423                       ERROR        null
      567    10167    1   ERROR:;
      568    10168    1         CALL KQT$VALREADS (CG$->KQ$CG);

  10168  1 001423   200006 630500                    EPPR0   CG$,,AUTO
         1 001424   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001425   000000 701000 xent               TSX1    KQT$VALREADS
         1 001426   000000 011000                    NOP     0

  10160  1 001427                       ALTRT        null
      569    10169    1   ALTRT:;
      570    10170    1         ALTRETURN;

  10170  1 001427   000000 702200 xent               TSX2  ! X66_AALT
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:93   

  10160  1 001430                       NOTYPMEM     null
  10160  1 001430                       NOMEM        null
      571    10171    1   NOTYPMEM:;
      572    10172    1   NOMEM:;
      573    10173    1         CALL SETNOMEM;

  10173  1 001430   003130 701000 1                  TSX1    SETNOMEM
         1 001431   000000 011000                    NOP     0

      574    10174    1         GOTO ERROR;

  10174  1 001432   001423 710000 1                  TRA     ERROR

  10160  1 001433                       TYPTRAPB     null
  10160  1 001433                       TYPTRAP      null
      575    10175    1   TYPTRAPB:;
      576    10176    1   TYPTRAP:;
      577    10177    1         CALL TUNLOCK;

  10177  1 001433   002375 701000 1                  TSX1    TUNLOCK
         1 001434   000000 011000                    NOP     0

  10160  1 001435                       TYPTRAP0     null
      578    10178    1   TYPTRAP0:;
      579    10179    1         B$JIT.ERR=E_CGTTRP;

  10179  1 001435   000002 236000 0                  LDQ     E_CGTTRP
         1 001436   000000 470400 xsym               LDP0    B$JIT$
         1 001437   000012 756100                    STQ     10,,PR0

      580    10180        /*E* ERROR:   KQC-E$CGTTRP-E
      581    10181             MESSAGE: Bad TYPLIST or QLIST area specified by M$CGCTL
      582    10182             MESSAGE1: Either the TYPLIST or QLIST area specified by your
      583    10183                       M$CGCTL service is inaccessible. */
      584    10184    1         GOTO ERROR;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:94   
  10184  1 001440   001423 710000 1                  TRA     ERROR

  10179  1 001441                       NOTYPL       null
      585    10185    1   NOTYPL:;
      586    10186        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:95   
      587    10187        /**/
      588    10188
      589    10189                 /****************************************
      590    10190                  *                                      *
      591    10191                  *        PROCESS STA LIST              *
      592    10192                  *                                      *
      593    10193                  ****************************************/
      594    10194
      595    10195    1         CALL HFF$DSIZ (2,DSIZ) ALTRET(NOSTAL);

  10195  1 001441   200017 630500                    EPPR0   DSIZ,,AUTO
         1 001442   200133 450500                    STP0    @TKEY+4,,AUTO
         1 001443   000012 236000 2                  LDQ     10
         1 001444   200132 756100                    STQ     @TKEY+3,,AUTO
         1 001445   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 001446   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001447   000000 701000 xent               TSX1    HFF$DSIZ
         1 001450   002245 702000 1                  TSX2    NOSTAL

      596    10196    1         NSTA=(DSIZ-4)/LENGTHC(VLP$CGSTAL.LIST(0));

  10196  1 001451   200017 236100                    LDQ     DSIZ,,AUTO
         1 001452   000004 136007                    SBLQ    4,DL
         1 001453   000040 506007                    DIV     32,DL
         1 001454   200024 756100                    STQ     NSTA,,AUTO

      597    10197    1         IF NSTA = 0 THEN GOTO NOSTAL;

  10197  1 001455   000000 116003                    CMPQ    0,DU
         1 001456   002245 600000 1                  TZE     NOSTAL

      598    10198    1         IF  QLIST ~= 0

  10198  1 001457   200106 235100                    LDA     QLIST,,AUTO
         1 001460   001466 600000 1                  TZE     s:10201
         1 001461   200006 470500                    LDP0    CG$,,AUTO
         1 001462   000106 235100                    LDA     70,,PR0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:96   
         1 001463   001466 600000 1                  TZE     s:10201

      599    10199    1         AND CG$->KQ$CG.QISS THEN
      600    10200    1          IF NQ < NSTA THEN GOTO IQLS;

  10200  1 001464   200107 116100                    CMPQ    NQ,,AUTO
         1 001465   000621 605400 1                  TPNZ    IQLS

      601    10201    2           DO CASE (FPT$CGCTL.STAFC);

  10201  1 001466   000000 470400 xsym               LDP0    B$PS0$
         1 001467   000000 720100                    LXL0    0,,PR0
         1 001470   000007 360003                    ANX0    7,DU
         1 001471   000005 100003                    CMPX0   5,DU
         1 001472   001474 602010 1                  TNC     s:10201+6,X0
         1 001473   002214 710000 1                  TRA     s:10329
         1 001474   002214 710000 1                  TRA     s:10329
         1 001475   002022 710000 1                  TRA     s:10293
         1 001476   001522 710000 1                  TRA     ADDSTA0
         1 001477   001752 710000 1                  TRA     s:10277
         1 001500   001501 710000 1                  TRA     s:10207

      602    10202
      603    10203                           /******************************
      604    10204                            *        SETLIST             *
      605    10205                            ******************************/
      606    10206    2             CASE (%CG_CTLFC_SETLIST#);

      607    10207    2               CALL SLOCK;

  10207  1 001501   002407 701000 1                  TSX1    SLOCK
         1 001502   000000 011000                    NOP     0

      608    10208    2               DFCHK=0;

  10208  1 001503   200111 450100                    STZ     DFCHK,,AUTO

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:97   
      609    10209    2               STA$=KQ$STREE.HEAD$;

  10209  1 001504   200006 470500                    LDP0    CG$,,AUTO
         1 001505   000101 236100                    LDQ     65,,PR0
         1 001506   200013 756100                    STQ     STA$,,AUTO

      610    10210    3                 DO WHILE (STA$ ~= ADDR(NIL));

  10210  1 001507   001515 710000 1                  TRA     s:10213

      611    10211    3                 STA$->KQ$STA.DFCHK='0'B;

  10211  1 001510   200013 470500                    LDP0    STA$,,AUTO
         1 001511   000013 236000 2                  LDQ     11
         1 001512   000020 356100                    ANSQ    16,,PR0

      612    10212    3                 STA$=STA$->KQ$STA.BTN.FLINK$;

  10212  1 001513   000004 236100                    LDQ     4,,PR0
         1 001514   200013 756100                    STQ     STA$,,AUTO

      613    10213    3                 END;

  10213  1 001515   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001516   001510 601000 1                  TNZ     s:10211

      614    10214    2               CALL SUNLOCK;

  10214  1 001517   002421 701000 1                  TSX1    SUNLOCK
         1 001520   000000 011000                    NOP     0

      615    10215    2               GOTO ADDSTA0;

  10215  1 001521   001522 710000 1                  TRA     ADDSTA0

      616    10216
      617    10217                           /******************************
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:98   
      618    10218                            *          ADD               *
      619    10219                            ******************************/
      620    10220    2             CASE (%CG_CTLFC_ADD#);

  10211  1 001522                       ADDSTA0      null
      621    10221    2   ADDSTA0:    ;
      622    10222    2               CALL HFF$TRAPALT ALTRET(STATRAP);

  10222  1 001522   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001523   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001524   002237 702000 1                  TSX2    STATRAPB

      623    10223    3                 DO STAX = 0 TO NSTA-1;

  10223  1 001525   200023 450100                    STZ     STAX,,AUTO
         1 001526   001701 710000 1                  TRA     s:10253+1

      624    10224    3                 CALL SLOCK;

  10224  1 001527   002407 701000 1                  TSX1    SLOCK
         1 001530   000000 011000                    NOP     0

      625    10225    3                 KEY=VLP$CGSTAL.LIST.NAME(STAX);

  10225  1 001531   200023 235100                    LDA     STAX,,AUTO
         1 001532   000005 735000                    ALS     5
         1 001533   000000 470400 xsym               LDP0    B$PS2$
         1 001534   040100 100505                    MLR     fill='040'O
         1 001535   000001 000010                    ADSC9   1,A,PR0                  cn=0,n=8
         1 001536   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

      626    10226    3                 CALL KQB$SRCH (KQ$STREE,KEY,STA$) ALTRET(NOSTA0);

  10226  1 001537   200013 631500                    EPPR1   STA$,,AUTO
         1 001540   200134 451500                    STP1    @TKEY+5,,AUTO
         1 001541   200010 633500                    EPPR3   KEY,,AUTO
         1 001542   200133 453500                    STP3    @TKEY+4,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:99   
         1 001543   200006 236100                    LDQ     CG$,,AUTO
         1 001544   000075 036003                    ADLQ    61,DU
         1 001545   200132 756100                    STQ     @TKEY+3,,AUTO
         1 001546   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 001547   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001550   000000 701000 xent               TSX1    KQB$SRCH
         1 001551   001553 702000 1                  TSX2    NOSTA0

      627    10227    3                 GOTO GOTSTA0;

  10227  1 001552   001574 710000 1                  TRA     GOTSTA0

  10225  1 001553                       NOSTA0       null
      628    10228    3   NOSTA0:       ;
      629    10229    3                 CALL INDEX (I,SUBSTR(KEY,0,1),KC_LGL1ST) ALTRET(BADSTACHR);

  10229  1 001553   000100 124400                    SCM     mask='000'O
         1 001554   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 001555   200010 000001                    ADSC9   KEY,,AUTO                cn=0,n=1
         1 001556   200113 000100                    ARG     I,,AUTO
         1 001557   002216 606400 1                  TTN     BADSTACHR

      630    10230    3                 STA$=MYSTA$;

  10230  1 001560   200014 236100                    LDQ     MYSTA$,,AUTO
         1 001561   200013 756100                    STQ     STA$,,AUTO

      631    10231    3                 CALL KQT$GETSTA (CG$->KQ$CG,STA$,KEY) ALTRET(NOMEM);

  10231  1 001562   200010 630500                    EPPR0   KEY,,AUTO
         1 001563   200134 450500                    STP0    @TKEY+5,,AUTO
         1 001564   200013 631500                    EPPR1   STA$,,AUTO
         1 001565   200133 451500                    STP1    @TKEY+4,,AUTO
         1 001566   200006 236100                    LDQ     CG$,,AUTO
         1 001567   200132 756100                    STQ     @TKEY+3,,AUTO
         1 001570   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 001571   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:100  
         1 001572   000000 701000 xent               TSX1    KQT$GETSTA
         1 001573   001430 702000 1                  TSX2    NOTYPMEM

  10230  1 001574                       GOTSTA0      null
      632    10232    3   GOTSTA0:      ;
      633    10233                      %LOCK (G=STA$->KQ$STA.GATE);

  10234  1 001574   200013 236100                    LDQ     STA$,,AUTO
         1 001575   000016 036003                    ADLQ    14,DU
         1 001576   200132 756100                    STQ     @TKEY+3,,AUTO
         1 001577   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 001600   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001601   000000 701000 xent               TSX1    HFC$LOCK
         1 001602   000000 011000                    NOP     0

      634    10236    3                 STA$->KQ$STA.DFCHK='1'B;

  10236  1 001603   200013 470500                    LDP0    STA$,,AUTO
         1 001604   001000 236003                    LDQ     512,DU
         1 001605   000020 256100                    ORSQ    16,,PR0

      635    10237    3                 STA$->KQ$STA.AUP=VLP$CGSTAL.LIST.AUP(STAX);

  10237  1 001606   200023 235100                    LDA     STAX,,AUTO
         1 001607   000003 735000                    ALS     3
         1 001610   000000 471400 xsym               LDP1    B$PS2$
         1 001611   100003 236105                    LDQ     3,AL,PR1
         1 001612   000006 772000                    QRL     6
         1 001613   000023 676100                    ERQ     19,,PR0
         1 001614   400000 376007                    ANQ     -131072,DL
         1 001615   000023 656100                    ERSQ    19,,PR0

      636    10238    3                 STA$->KQ$STA.PERM=VLP$CGSTAL.LIST.PERM(STAX);

  10238  1 001616   200023 235100                    LDA     STAX,,AUTO
         1 001617   000003 735000                    ALS     3
         1 001620   100003 236105                    LDQ     3,AL,PR1
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:101  
         1 001621   000005 736000                    QLS     5
         1 001622   000020 676100                    ERQ     16,,PR0
         1 001623   020000 376003                    ANQ     8192,DU
         1 001624   000020 656100                    ERSQ    16,,PR0

      637    10239    3                 PRIO=VLP$CGSTAL.LIST.PRIO(STAX);

  10239  1 001625   200023 235100                    LDA     STAX,,AUTO
         1 001626   000003 735000                    ALS     3
         1 001627   100003 236105                    LDQ     3,AL,PR1
         1 001630   000033 772000                    QRL     27
         1 001631   200022 756100                    STQ     PRIO,,AUTO

      638    10240    3                 CALL CHKPRI ALTRET(STAALT0);

  10240  1 001632   003010 701000 1                  TSX1    CHKPRI
         1 001633   002227 702000 1                  TSX2    STAALT0

      639    10241    3                 STA$->KQ$STA.MPRIO=PRIO;

  10241  1 001634   200013 470500                    LDP0    STA$,,AUTO
         1 001635   200022 236100                    LDQ     PRIO,,AUTO
         1 001636   000022 736000                    QLS     18
         1 001637   000015 552120                    STBQ    13,'20'O,PR0

      640    10242                      %UNLOCK (G=STA$->KQ$STA.GATE);

  10243  1 001640   200013 236100                    LDQ     STA$,,AUTO
         1 001641   000016 036003                    ADLQ    14,DU
         1 001642   200132 756100                    STQ     @TKEY+3,,AUTO
         1 001643   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 001644   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001645   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001646   000000 011000                    NOP     0

      641    10245    3                 IF CG$->KQ$CG.QISS THEN

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:102  
  10245  1 001647   200006 470500                    LDP0    CG$,,AUTO
         1 001650   000106 235100                    LDA     70,,PR0
         1 001651   001676 600000 1                  TZE     s:10252

      642    10246    4                   DO;

      643    10247    4                   IF QLIST ~= 0 THEN

  10247  1 001652   200106 236100                    LDQ     QLIST,,AUTO
         1 001653   001664 600000 1                  TZE     s:10249

      644    10248    4                    STA$->KQ$QTN.AUTORCVR=VLP$CGQL.LIST.AUTORCVR(STAX);

  10248  1 001654   200013 471500                    LDP1    STA$,,AUTO
         1 001655   200023 236100                    LDQ     STAX,,AUTO
         1 001656   000011 402007                    MPY     9,DL
         1 001657   000000 473400 xsym               LDP3    B$PS5$
         1 001660   300003 236106                    LDQ     3,QL,PR3
         1 001661   100050 676100                    ERQ     40,,PR1
         1 001662   400000 376003                    ANQ     -131072,DU
         1 001663   100050 656100                    ERSQ    40,,PR1

      645    10249    4                   CALL SETPRIO (STA$);

  10249  1 001664   200013 631500                    EPPR1   STA$,,AUTO
         1 001665   200125 451500                    STP1    I+2,,AUTO
         1 001666   003617 701000 1                  TSX1    SETPRIO
         1 001667   000000 011000                    NOP     0

      646    10250    4                   CALL SETMXACT (STA$,STAX);

  10250  1 001670   200023 630500                    EPPR0   STAX,,AUTO
         1 001671   200122 450500                    STP0    K+1,,AUTO
         1 001672   200013 631500                    EPPR1   STA$,,AUTO
         1 001673   200121 451500                    STP1    JNAME+4,,AUTO
         1 001674   003636 701000 1                  TSX1    SETMXACT
         1 001675   000000 011000                    NOP     0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:103  

      647    10251    4                   END;

      648    10252    3                 CALL SUNLOCK;

  10252  1 001676   002421 701000 1                  TSX1    SUNLOCK
         1 001677   000000 011000                    NOP     0

      649    10253    3                 END;

  10253  1 001700   200023 054100                    AOS     STAX,,AUTO
         1 001701   200023 236100                    LDQ     STAX,,AUTO
         1 001702   200024 116100                    CMPQ    NSTA,,AUTO
         1 001703   001527 604000 1                  TMI     s:10224

      650    10254    2               CALL HFF$TRAPALT;

  10254  1 001704   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001705   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001706   000000 011000                    NOP     0

      651    10255    2               IF FPT$CGCTL.STAFC = %CG_CTLFC_SETLIST# THEN

  10255  1 001707   000000 470400 xsym               LDP0    B$PS0$
         1 001710   000000 236100                    LDQ     0,,PR0
         1 001711   000007 376007                    ANQ     7,DL
         1 001712   000004 116007                    CMPQ    4,DL
         1 001713   002215 601000 1                  TNZ     s:10332

      652    10256    2                IF CG$->KQ$CG.AUCTL.XSTALGL = '0'B THEN

  10256  1 001714   200006 471500                    LDP1    CG$,,AUTO
         1 001715   100133 236100                    LDQ     91,,PR1
         1 001716   000020 316007                    CANQ    16,DL
         1 001717   002215 601000 1                  TNZ     s:10332

      653    10257    3                  DO;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:104  

      654    10258    3                  CALL SLOCK;

  10258  1 001720   002407 701000 1                  TSX1    SLOCK
         1 001721   000000 011000                    NOP     0

      655    10259    3                  STA$=KQ$STREE.HEAD$;

  10259  1 001722   200006 470500                    LDP0    CG$,,AUTO
         1 001723   000101 236100                    LDQ     65,,PR0
         1 001724   200013 756100                    STQ     STA$,,AUTO

      656    10260    4                    DO WHILE (STA$ ~= ADDR(NIL));

  10260  1 001725   001745 710000 1                  TRA     s:10269

      657    10261    4                    IF  STA$->KQ$STA.DFCHK = '0'B

  10261  1 001726   200013 470500                    LDP0    STA$,,AUTO
         1 001727   000020 430100                    FSZN    16,,PR0
         1 001730   001743 604000 1                  TMI     s:10268
         1 001731   000023 236100                    LDQ     19,,PR0
         1 001732   200000 316007                    CANQ    65536,DL
         1 001733   001743 601000 1                  TNZ     s:10268

      658    10262    4                    AND NOT STA$->KQ$STA.SPECIAL THEN
      659    10263    5                      DO;

      660    10264    5                      FLINK$=STA$->KQ$STA.BTN.FLINK$;

  10264  1 001734   000004 236100                    LDQ     4,,PR0
         1 001735   200112 756100                    STQ     FLINK$,,AUTO

      661    10265    5                      CALL DELSTA ALTRET(ERROR);

  10265  1 001736   002572 701000 1                  TSX1    DELSTA
         1 001737   001423 702000 1                  TSX2    ERROR
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:105  

      662    10266    5                      STA$=FLINK$;

  10266  1 001740   200112 236100                    LDQ     FLINK$,,AUTO
         1 001741   200013 756100                    STQ     STA$,,AUTO

      663    10267    5                      END;

  10267  1 001742   001745 710000 1                  TRA     s:10269

      664    10268    4                    ELSE STA$=STA$->KQ$STA.BTN.FLINK$;

  10268  1 001743   000004 236100                    LDQ     4,,PR0
         1 001744   200013 756100                    STQ     STA$,,AUTO

      665    10269    4                    END;

  10269  1 001745   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001746   001726 601000 1                  TNZ     s:10261

      666    10270    3                  CALL SUNLOCK;

  10270  1 001747   002421 701000 1                  TSX1    SUNLOCK
         1 001750   000000 011000                    NOP     0

      667    10271    3                  END;

  10271  1 001751   002215 710000 1                  TRA     s:10332

      668    10272
      669    10273                           /******************************
      670    10274                            *          DELETE            *
      671    10275                            ******************************/
      672    10276    2             CASE (%CG_CTLFC_DELETE#);

      673    10277    3                 DO STAX = 0 TO NSTA-1;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:106  
  10277  1 001752   200023 450100                    STZ     STAX,,AUTO
         1 001753   002013 710000 1                  TRA     s:10286+1

      674    10278    3                 CALL SLOCK;

  10278  1 001754   002407 701000 1                  TSX1    SLOCK
         1 001755   000000 011000                    NOP     0

      675    10279    3                 CALL HFF$TRAPALT ALTRET(STATRAPB);

  10279  1 001756   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001757   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001760   002237 702000 1                  TSX2    STATRAPB

      676    10280    3                 KEY=VLP$CGSTAL.LIST.NAME(STAX);

  10280  1 001761   200023 235100                    LDA     STAX,,AUTO
         1 001762   000005 735000                    ALS     5
         1 001763   000000 470400 xsym               LDP0    B$PS2$
         1 001764   040100 100505                    MLR     fill='040'O
         1 001765   000001 000010                    ADSC9   1,A,PR0                  cn=0,n=8
         1 001766   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

      677    10281    3                 CALL KQB$SRCH (KQ$STREE,KEY,STA$) ALTRET(NOSTA1);

  10281  1 001767   200013 631500                    EPPR1   STA$,,AUTO
         1 001770   200134 451500                    STP1    @TKEY+5,,AUTO
         1 001771   200010 633500                    EPPR3   KEY,,AUTO
         1 001772   200133 453500                    STP3    @TKEY+4,,AUTO
         1 001773   200006 236100                    LDQ     CG$,,AUTO
         1 001774   000075 036003                    ADLQ    61,DU
         1 001775   200132 756100                    STQ     @TKEY+3,,AUTO
         1 001776   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 001777   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002000   000000 701000 xent               TSX1    KQB$SRCH
         1 002001   002010 702000 1                  TSX2    NOSTA1

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:107  
      678    10282    3                 IF NOT STA$->KQ$STA.SPECIAL THEN

  10282  1 002002   200013 470500                    LDP0    STA$,,AUTO
         1 002003   000023 236100                    LDQ     19,,PR0
         1 002004   200000 316007                    CANQ    65536,DL
         1 002005   002010 601000 1                  TNZ     NOSTA1

      679    10283    3                  CALL DELSTA ALTRET(ERROR);

  10283  1 002006   002572 701000 1                  TSX1    DELSTA
         1 002007   001423 702000 1                  TSX2    ERROR

  10282  1 002010                       NOSTA1       null
      680    10284    3   NOSTA1:       ;
      681    10285    3                 CALL SUNLOCK;

  10285  1 002010   002421 701000 1                  TSX1    SUNLOCK
         1 002011   000000 011000                    NOP     0

      682    10286    3                 END;

  10286  1 002012   200023 054100                    AOS     STAX,,AUTO
         1 002013   200023 236100                    LDQ     STAX,,AUTO
         1 002014   200024 116100                    CMPQ    NSTA,,AUTO
         1 002015   001754 604000 1                  TMI     s:10278

      683    10287    2               CALL HFF$TRAPALT;

  10287  1 002016   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002017   000000 701000 xent               TSX1    HFF$TRAPALT
         1 002020   000000 011000                    NOP     0
         1 002021   002215 710000 1                  TRA     s:10332

      684    10288
      685    10289                           /******************************
      686    10290                            *        CHANGE ATTRS        *
      687    10291                            ******************************/
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:108  
      688    10292    2             CASE (%CG_CTLFC_CHGATTR#);

      689    10293    2               CALL HFF$TRAPALT ALTRET(STATRAPB);

  10293  1 002022   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002023   000000 701000 xent               TSX1    HFF$TRAPALT
         1 002024   002237 702000 1                  TSX2    STATRAPB

      690    10294    3                 DO STAX = 0 TO NSTA-1;

  10294  1 002025   200023 450100                    STZ     STAX,,AUTO
         1 002026   002205 710000 1                  TRA     s:10325+1

      691    10295    3                 CALL SLOCK;

  10295  1 002027   002407 701000 1                  TSX1    SLOCK
         1 002030   000000 011000                    NOP     0

      692    10296    3                 KEY=VLP$CGSTAL.LIST.NAME(STAX);

  10296  1 002031   200023 235100                    LDA     STAX,,AUTO
         1 002032   000005 735000                    ALS     5
         1 002033   000000 470400 xsym               LDP0    B$PS2$
         1 002034   040100 100505                    MLR     fill='040'O
         1 002035   000001 000010                    ADSC9   1,A,PR0                  cn=0,n=8
         1 002036   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

      693    10297    3                 CALL KQB$SRCH (KQ$STREE,KEY,STA$) ALTRET(NOSTA2);

  10297  1 002037   200013 631500                    EPPR1   STA$,,AUTO
         1 002040   200134 451500                    STP1    @TKEY+5,,AUTO
         1 002041   200010 633500                    EPPR3   KEY,,AUTO
         1 002042   200133 453500                    STP3    @TKEY+4,,AUTO
         1 002043   200006 236100                    LDQ     CG$,,AUTO
         1 002044   000075 036003                    ADLQ    61,DU
         1 002045   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002046   200132 630500                    EPPR0   @TKEY+3,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:109  
         1 002047   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002050   000000 701000 xent               TSX1    KQB$SRCH
         1 002051   002221 702000 1                  TSX2    NOSTA2

      694    10298                      %LOCK (G=STA$->KQ$STA.GATE);

  10299  1 002052   200013 236100                    LDQ     STA$,,AUTO
         1 002053   000016 036003                    ADLQ    14,DU
         1 002054   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002055   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002056   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002057   000000 701000 xent               TSX1    HFC$LOCK
         1 002060   000000 011000                    NOP     0

      695    10301    3                 IF FPT$CGCTL.ATTRS.PERM THEN

  10301  1 002061   000000 470400 xsym               LDP0    B$PS0$
         1 002062   000001 236100                    LDQ     1,,PR0
         1 002063   100000 316003                    CANQ    32768,DU
         1 002064   002076 600000 1                  TZE     s:10303

      696    10302    3                  STA$->KQ$STA.PERM=VLP$CGSTAL.LIST.PERM(STAX);

  10302  1 002065   200013 471500                    LDP1    STA$,,AUTO
         1 002066   200023 235100                    LDA     STAX,,AUTO
         1 002067   000003 735000                    ALS     3
         1 002070   000000 473400 xsym               LDP3    B$PS2$
         1 002071   300003 236105                    LDQ     3,AL,PR3
         1 002072   000005 736000                    QLS     5
         1 002073   100020 676100                    ERQ     16,,PR1
         1 002074   020000 376003                    ANQ     8192,DU
         1 002075   100020 656100                    ERSQ    16,,PR1

      697    10303    3                 IF FPT$CGCTL.ATTRS.AUP THEN

  10303  1 002076   000001 236100                    LDQ     1,,PR0
         1 002077   040000 316003                    CANQ    16384,DU
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:110  
         1 002100   002112 600000 1                  TZE     s:10306

      698    10304    3                  STA$->KQ$STA.AUP=VLP$CGSTAL.LIST.AUP(STAX);

  10304  1 002101   200013 471500                    LDP1    STA$,,AUTO
         1 002102   200023 235100                    LDA     STAX,,AUTO
         1 002103   000003 735000                    ALS     3
         1 002104   000000 473400 xsym               LDP3    B$PS2$
         1 002105   300003 236105                    LDQ     3,AL,PR3
         1 002106   000006 772000                    QRL     6
         1 002107   100023 676100                    ERQ     19,,PR1
         1 002110   400000 376007                    ANQ     -131072,DL
         1 002111   100023 656100                    ERSQ    19,,PR1

      699    10305                      %UNLOCK (G=STA$->KQ$STA.GATE);

  10306  1 002112   200013 236100                    LDQ     STA$,,AUTO
         1 002113   000016 036003                    ADLQ    14,DU
         1 002114   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002115   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002116   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002117   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002120   000000 011000                    NOP     0

      700    10308    3                 IF FPT$CGCTL.ATTRS.PRIO THEN

  10308  1 002121   000000 470400 xsym               LDP0    B$PS0$
         1 002122   000001 234100                    SZN     1,,PR0
         1 002123   002165 605000 1                  TPL     s:10321

      701    10309    4                   DO;

      702    10310    4                   PRIO=VLP$CGSTAL.LIST.PRIO(STAX);

  10310  1 002124   200023 235100                    LDA     STAX,,AUTO
         1 002125   000003 735000                    ALS     3
         1 002126   000000 471400 xsym               LDP1    B$PS2$
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:111  
         1 002127   100003 236105                    LDQ     3,AL,PR1
         1 002130   000033 772000                    QRL     27
         1 002131   200022 756100                    STQ     PRIO,,AUTO

      703    10311    4                   CALL CHKPRI ALTRET(STAALT);

  10311  1 002132   003010 701000 1                  TSX1    CHKPRI
         1 002133   002224 702000 1                  TSX2    STAALT

      704    10312                        %LOCK (G=STA$->KQ$STA.GATE);

  10313  1 002134   200013 236100                    LDQ     STA$,,AUTO
         1 002135   000016 036003                    ADLQ    14,DU
         1 002136   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002137   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002140   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002141   000000 701000 xent               TSX1    HFC$LOCK
         1 002142   000000 011000                    NOP     0

      705    10315    4                   STA$->KQ$STA.MPRIO=PRIO;

  10315  1 002143   200013 470500                    LDP0    STA$,,AUTO
         1 002144   200022 236100                    LDQ     PRIO,,AUTO
         1 002145   000022 736000                    QLS     18
         1 002146   000015 552120                    STBQ    13,'20'O,PR0

      706    10316                        %UNLOCK (G=STA$->KQ$STA.GATE);

  10317  1 002147   200013 236100                    LDQ     STA$,,AUTO
         1 002150   000016 036003                    ADLQ    14,DU
         1 002151   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002152   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002153   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002154   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002155   000000 011000                    NOP     0

      707    10319    4                   IF CG$->KQ$CG.QISS THEN CALL SETPRIO (STA$);
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:112  

  10319  1 002156   200006 470500                    LDP0    CG$,,AUTO
         1 002157   000106 235100                    LDA     70,,PR0
         1 002160   002165 600000 1                  TZE     s:10321

  10319  1 002161   200013 631500                    EPPR1   STA$,,AUTO
         1 002162   200125 451500                    STP1    I+2,,AUTO
         1 002163   003617 701000 1                  TSX1    SETPRIO
         1 002164   000000 011000                    NOP     0

      708    10320    4                   END;

      709    10321    3                 IF  FPT$CGCTL.ATTRS.MXACT

  10321  1 002165   000000 470400 xsym               LDP0    B$PS0$
         1 002166   000001 236100                    LDQ     1,,PR0
         1 002167   200000 316003                    CANQ    65536,DU
         1 002170   002202 600000 1                  TZE     s:10324
         1 002171   200006 471500                    LDP1    CG$,,AUTO
         1 002172   100106 235100                    LDA     70,,PR1
         1 002173   002202 600000 1                  TZE     s:10324

      710    10322    3                 AND CG$->KQ$CG.QISS THEN
      711    10323    3                  CALL SETMXACT (STA$,STAX);

  10323  1 002174   200023 633500                    EPPR3   STAX,,AUTO
         1 002175   200122 453500                    STP3    K+1,,AUTO
         1 002176   200013 634500                    EPPR4   STA$,,AUTO
         1 002177   200121 454500                    STP4    JNAME+4,,AUTO
         1 002200   003636 701000 1                  TSX1    SETMXACT
         1 002201   000000 011000                    NOP     0

      712    10324    3                 CALL SUNLOCK;

  10324  1 002202   002421 701000 1                  TSX1    SUNLOCK
         1 002203   000000 011000                    NOP     0

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:113  
      713    10325    3                 END;

  10325  1 002204   200023 054100                    AOS     STAX,,AUTO
         1 002205   200023 236100                    LDQ     STAX,,AUTO
         1 002206   200024 116100                    CMPQ    NSTA,,AUTO
         1 002207   002027 604000 1                  TMI     s:10295

      714    10326    2               CALL HFF$TRAPALT;

  10326  1 002210   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002211   000000 701000 xent               TSX1    HFF$TRAPALT
         1 002212   000000 011000                    NOP     0
         1 002213   002215 710000 1                  TRA     s:10332

      715    10327
      716    10328    2             CASE (ELSE);

      717    10329    2               GOTO BADOPT;

  10329  1 002214   001405 710000 1                  TRA     BADOPT

      718    10330
      719    10331    2           END; /*CASE FPT$CGCTL.STAFC */

      720    10332    1         GOTO NOSTAL;

  10332  1 002215   002245 710000 1                  TRA     NOSTAL

  10329  1 002216                       BADSTACHR    null
      721    10333    1   BADSTACHR:;
      722    10334    1         CALL SETBSC;

  10334  1 002216   003340 701000 1                  TSX1    SETBSC
         1 002217   000000 011000                    NOP     0

      723    10335    1         GOTO STAALT;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:114  
  10335  1 002220   002224 710000 1                  TRA     STAALT

  10329  1 002221                       NOSTA2       null
      724    10336    1   NOSTA2:;
      725    10337    1         B$JIT.ERR=E_CGAFNS;

  10337  1 002221   000012 236000 0                  LDQ     E_CGAFNS
         1 002222   000000 470400 xsym               LDP0    B$JIT$
         1 002223   000012 756100                    STQ     10,,PR0

  10337  1 002224                       STAALT       null
      726    10338        /*E* ERROR:   KQC-E$CGAFNS
      727    10339             MESSAGE: M$CGCTL can't find that station
      728    10340             MESSAGE1: One of the stations specified in your M$CGCTL
      729    10341                       service's STALIST could not be found. */
      730    10342    1   STAALT:;
      731    10343    1         CALL SUNLOCK;

  10343  1 002224   002421 701000 1                  TSX1    SUNLOCK
         1 002225   000000 011000                    NOP     0

      732    10344    1         GOTO ERROR;

  10344  1 002226   001423 710000 1                  TRA     ERROR

  10337  1 002227                       STAALT0      null
      733    10345    1   STAALT0:;
      734    10346              %UNLOCK (G=STA$->KQ$STA.GATE);

  10347  1 002227   200013 236100                    LDQ     STA$,,AUTO
         1 002230   000016 036003                    ADLQ    14,DU
         1 002231   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002232   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002233   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002234   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002235   000000 011000                    NOP     0

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:115  
      735    10349    1         GOTO STAALT;

  10349  1 002236   002224 710000 1                  TRA     STAALT

  10337  1 002237                       STATRAPB     null
  10337  1 002237                       STATRAP      null
      736    10350    1   STATRAPB:;
      737    10351    1   STATRAP:;
      738    10352    1         CALL SUNLOCK;

  10352  1 002237   002421 701000 1                  TSX1    SUNLOCK
         1 002240   000000 011000                    NOP     0

  10337  1 002241                       STATRAP0     null
      739    10353    1   STATRAP0:;
      740    10354    1         B$JIT.ERR=E_CGSTRP;

  10354  1 002241   000003 236000 0                  LDQ     E_CGSTRP
         1 002242   000000 470400 xsym               LDP0    B$JIT$
         1 002243   000012 756100                    STQ     10,,PR0

      741    10355        /*E* ERROR:   KQC-E$CGSTRP-E
      742    10356             MESSAGE: Bad STALIST or QLIST area specified by M$CGCTL
      743    10357             MESSAGE1: Either the STALIST or QLIST area specified by your
      744    10358                       M$CGCTL service is inaccessible. */
      745    10359    1         GOTO ERROR;

  10359  1 002244   001423 710000 1                  TRA     ERROR

  10354  1 002245                       NOSTAL       null
      746    10360    1   NOSTAL:;
      747    10361        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:116  
      748    10362        /**/
      749    10363
      750    10364                 /****************************************
      751    10365                  *                                      *
      752    10366                  *        PROCESS VLP_SETSTA            *
      753    10367                  *                                      *
      754    10368                  ****************************************/
      755    10369
      756    10370    1         CALL HFF$NILERASE (4) ALTRET(NOSETSTA);

  10370  1 002245   000014 630400 2                  EPPR0   12
         1 002246   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002247   000000 701000 xent               TSX1    HFF$NILERASE
         1 002250   002277 702000 1                  TSX2    NOSETSTA

      757    10371    1         SETSTA=VLP$SETSTA;

  10371  1 002251   000000 470400 xsym               LDP0    B$PS4$
         1 002252   000100 100500                    MLR     fill='000'O
         1 002253   000000 000060                    ADSC9   0,,PR0                   cn=0,n=48
         1 002254   200052 000060                    ADSC9   SETSTA,,AUTO             cn=0,n=48

      758    10372              %LOCK (G=CG$->KQ$CG.GATE.CG);

  10373  1 002255   200006 236100                    LDQ     CG$,,AUTO
         1 002256   000107 036003                    ADLQ    71,DU
         1 002257   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002260   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002261   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002262   000000 701000 xent               TSX1    HFC$LOCK
         1 002263   000000 011000                    NOP     0

      759    10375    1         CG$->KQ$CG.SETSTA=SETSTA;

  10375  1 002264   200006 470500                    LDP0    CG$,,AUTO
         1 002265   000100 100500                    MLR     fill='000'O
         1 002266   200052 000060                    ADSC9   SETSTA,,AUTO             cn=0,n=48
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:117  
         1 002267   000151 000060                    ADSC9   105,,PR0                 cn=0,n=48

      760    10376              %UNLOCK (G=CG$->KQ$CG.GATE.CG);

  10377  1 002270   200006 236100                    LDQ     CG$,,AUTO
         1 002271   000107 036003                    ADLQ    71,DU
         1 002272   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002273   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002274   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002275   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002276   000000 011000                    NOP     0

  10375  1 002277                       NOSETSTA     null
  10375  1 002277                       PMMEND       null
      761    10379    1   NOSETSTA:;
      762    10380    1   PMMEND:;
      763    10381    1         IF JFLG ~= 0 THEN CALL KQC$TELLJ (CG$->KQ$CG.CFU$) ALTRET(ERROR);

  10381  1 002277   200104 235100                    LDA     JFLG,,AUTO
         1 002300   002310 600000 1                  TZE     s:10382

  10381  1 002301   200006 236100                    LDQ     CG$,,AUTO
         1 002302   000214 036003                    ADLQ    140,DU
         1 002303   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002304   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002305   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002306   000000 701000 xent               TSX1    KQC$TELLJ
         1 002307   001423 702000 1                  TSX2    ERROR

      764    10382    1         CALL KQT$VALREADS (CG$->KQ$CG);

  10382  1 002310   200006 630500                    EPPR0   CG$,,AUTO
         1 002311   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002312   000000 701000 xent               TSX1    KQT$VALREADS
         1 002313   000000 011000                    NOP     0

      765    10383    1         RETURN;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:118  

  10383  1 002314   000000 702200 xent               TSX2  ! X66_ARET

      766    10384        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:119  
      767    10385        /**/
      768    10386        /*F* NAME:         KQC$CXTSET
      769    10387             PURPOSE:      To set up a context block during initial create
      770    10388                           open
      771    10389             DESCRIPTION:  Calls CXTSET to merge the control params through
      772    10390                           the context block.
      773    10391        */
      774    10392    1   KQC$CXTSET: ENTRY (PARM$) ALTRET; /* !!Doesn't ALTRET!! */

  10392  1 002315   000000 700200 xent  KQC$CXTSET   TSX0  ! X66_AUTO_2
         1 002316   000140 000002                    ZERO    96,2

      775    10393        /**/
      776    10394    1         CG$=PARM$;

  10394  1 002317   200003 470500                    LDP0    @PARM$,,AUTO
         1 002320   000000 236100                    LDQ     0,,PR0
         1 002321   200006 756100                    STQ     CG$,,AUTO

      777    10395    1         CALL CXTSET;

  10395  1 002322   003434 701000 1                  TSX1    CXTSET
         1 002323   000000 011000                    NOP     0

      778    10396    1         RETURN;

  10396  1 002324   000000 702200 xent               TSX2  ! X66_ARET

      779    10397        /**/
      780    10398        /*F* NAME:         KQC$CXTSET1
      781    10399             PURPOSE:      To ensure the default types are present
      782    10400             CALL:         KQC$CXTSET1 (MYSTA$)
      783    10401             DESCRIPTION:  Gets them if not there.  Returns B$JIT.ERR
      784    10402                           set if they are illegal, or if no memory
      785    10403                           is available.
      786    10404        */
      787    10405    1   KQC$CXTSET1: ENTRY (PARM$) ALTRET;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:120  

  10405  1 002325   000000 700200 xent  KQC$CXTSET1  TSX0  ! X66_AUTO_2
         1 002326   000140 000002                    ZERO    96,2

      788    10406        /**/
      789    10407    1         MYSTA$=PARM$;

  10407  1 002327   200003 470500                    LDP0    @PARM$,,AUTO
         1 002330   000000 236100                    LDQ     0,,PR0
         1 002331   200014 756100                    STQ     MYSTA$,,AUTO

      790    10408    1         CG$=MYSTA$->KQ$STA.CG$;

  10408  1 002332   200014 471500                    LDP1    MYSTA$,,AUTO
         1 002333   100007 236100                    LDQ     7,,PR1
         1 002334   200006 756100                    STQ     CG$,,AUTO

      791    10409    1         CALL CHKTYP (CG$->KQ$CG.AUCTL.DMTYP) ALTRET(ALTRT);

  10409  1 002335   000127 036003                    ADLQ    87,DU
         1 002336   200127 756100                    STQ     @QTN$+2,,AUTO
         1 002337   003024 701000 1                  TSX1    CHKTYP
         1 002340   001427 702000 1                  TSX2    ALTRT

      792    10410    1         CALL CHKTYP (CG$->KQ$CG.AUCTL.TMTYP) ALTRET(ALTRT);

  10410  1 002341   200006 236100                    LDQ     CG$,,AUTO
         1 002342   000125 036003                    ADLQ    85,DU
         1 002343   200127 756100                    STQ     @QTN$+2,,AUTO
         1 002344   003024 701000 1                  TSX1    CHKTYP
         1 002345   001427 702000 1                  TSX2    ALTRT

  10408  1 002346                       RTN          null
      793    10411    1   RTN:  ;
      794    10412    1         RETURN;

  10412  1 002346   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:121  

      795    10413        /**/
      796    10414        /*F* NAME:         KQC$TRMCK
      797    10415             PURPOSE:      To connect waiting terminals when a comgroup is
      798    10416                           opened update with terminal connect legal
      799    10417             CALL:         KQC$TRMCK (CG$)
      800    10418             DESCRIPTION:  Calls TRMGO to tell communications accounting in
      801    10419                           ELF to connect the devices if TERMCONLGL is
      802    10420                           set in the comgroup context block.  If it is
      803    10421                           not, the M$CGCTL PMME will tell ELF when terminals
      804    10422                           are allowed.
      805    10423                           Must be called on behalf of user.
      806    10424        */
      807    10425    1   KQC$TRMCK: ENTRY (PARM$) ALTRET; /* !!Doesn't ALTRET!! */

  10425  1 002347   000000 700200 xent  KQC$TRMCK    TSX0  ! X66_AUTO_2
         1 002350   000140 000002                    ZERO    96,2

      808    10426        /**/
      809    10427    1         CG$=PARM$;

  10427  1 002351   200003 470500                    LDP0    @PARM$,,AUTO
         1 002352   000000 236100                    LDQ     0,,PR0
         1 002353   200006 756100                    STQ     CG$,,AUTO

      810    10428    1         IF KQ$CG.AUCTL.TERMCONLGL THEN CALL TRMGO;

  10428  1 002354   200006 471500                    LDP1    CG$,,AUTO
         1 002355   100136 236100                    LDQ     94,,PR1
         1 002356   000010 316003                    CANQ    8,DU
         1 002357   002362 600000 1                  TZE     s:10429

  10428  1 002360   003352 701000 1                  TSX1    TRMGO
         1 002361   000000 011000                    NOP     0

      811    10429    1         RETURN;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:122  
  10429  1 002362   000000 702200 xent               TSX2  ! X66_ARET

      812    10430        %EJECT;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:123  
      813    10431        /**/
      814    10432        /*********************************************************************************
      815    10433        *                                                                                *
      816    10434        *   SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS    *
      817    10435        *  S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S   *
      818    10436        *  S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S       *
      819    10437        *   SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS    *
      820    10438        *      S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S   *
      821    10439        *  S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S   *
      822    10440        *   SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS    *
      823    10441        *                                                                                *
      824    10442        *********************************************************************************/
      825    10443
      826    10444        /****************************************************************
      827    10445        *****************************************************************/
      828    10446        /*D* NAME:         TLOCK, TUNLOCK, SLOCK, SUNLOCK
      829    10447             PURPOSE:      To lock and unlock the T- and S-tree gates
      830    10448        */
      831    10449    1   TLOCK: PROC;

  10449  1 002363   200130 741300       TLOCK        STX1  ! @TKEY+1,,AUTO

      832    10450        %LOCK (G=KQ$TTREE.GATE);

  10451  1 002364   200006 236100                    LDQ     CG$,,AUTO
         1 002365   000067 036003                    ADLQ    55,DU
         1 002366   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002367   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002370   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002371   000000 701000 xent               TSX1    HFC$LOCK
         1 002372   000000 011000                    NOP     0

      833    10453    2         RETURN;

  10453  1 002373   200130 221300                    LDX1  ! @TKEY+1,,AUTO
         1 002374   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:124  
      834    10454    2   TUNLOCK: ENTRY;

  10454  1 002375   200130 741300       TUNLOCK      STX1  ! @TKEY+1,,AUTO

      835    10455              %UNLOCK (G=KQ$TTREE.GATE);

  10456  1 002376   200006 236100                    LDQ     CG$,,AUTO
         1 002377   000067 036003                    ADLQ    55,DU
         1 002400   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002401   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002402   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002403   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002404   000000 011000                    NOP     0

      836    10458    2         RETURN;

  10458  1 002405   200130 221300                    LDX1  ! @TKEY+1,,AUTO
         1 002406   000001 702211                    TSX2  ! 1,X1

      837    10459    2   SLOCK: ENTRY;

  10459  1 002407   200130 741300       SLOCK        STX1  ! @TKEY+1,,AUTO

      838    10460              %LOCK (G=KQ$STREE.GATE);

  10461  1 002410   200006 236100                    LDQ     CG$,,AUTO
         1 002411   000075 036003                    ADLQ    61,DU
         1 002412   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002413   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002414   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002415   000000 701000 xent               TSX1    HFC$LOCK
         1 002416   000000 011000                    NOP     0

      839    10463    2         RETURN;

  10463  1 002417   200130 221300                    LDX1  ! @TKEY+1,,AUTO
         1 002420   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:125  

      840    10464    2   SUNLOCK: ENTRY;

  10464  1 002421   200130 741300       SUNLOCK      STX1  ! @TKEY+1,,AUTO

      841    10465              %UNLOCK (G=KQ$STREE.GATE);

  10466  1 002422   200006 236100                    LDQ     CG$,,AUTO
         1 002423   000075 036003                    ADLQ    61,DU
         1 002424   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002425   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002426   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002427   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002430   000000 011000                    NOP     0

      842    10468    2         RETURN;

  10468  1 002431   200130 221300                    LDX1  ! @TKEY+1,,AUTO
         1 002432   000001 702211                    TSX2  ! 1,X1

      843    10469    2   END TLOCK;
      844    10470        /****************************************************************
      845    10471        *****************************************************************/
      846    10472        /*D* NAME:         DELTYP
      847    10473             PURPOSE:      To delete a message type
      848    10474             DESCRIPTION:  Called with T-tree gate locked.  Exits when
      849    10475                           done with T-tree gate locked, unless error
      850    10476                           (ALTRET with gate unlocked, B$JIT.ERR set).
      851    10477        */
      852    10478    1   DELTYP: PROC ALTRET;

  10478  1 002433   200120 741300       DELTYP       STX1  ! JNAME+3,,AUTO

      853    10479    2         IF CG$->KQ$CG.QISS = '0'B THEN

  10479  1 002434   200006 470500                    LDP0    CG$,,AUTO
         1 002435   000106 235100                    LDA     70,,PR0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:126  
         1 002436   002445 601000 1                  TNZ     T0

      854    10480    3           DO;

      855    10481    3           CALL TUNLOCK;

  10481  1 002437   002375 701000 1                  TSX1    TUNLOCK
         1 002440   000000 011000                    NOP     0

      856    10482    3           CALL KQR$GETQUEUE (MYSTA$->KQ$STA);

  10482  1 002441   200014 630500                    EPPR0   MYSTA$,,AUTO
         1 002442   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002443   000000 701000 xent               TSX1    KQR$GETQUEUE
         1 002444   000000 011000                    NOP     0

      857    10483    3           END;

  10479  1 002445                       T0           null
      858    10484    2   T0:   ;
      859    10485    2         IF CG$->KQ$CG.QISS = '0'B THEN

  10485  1 002445   200006 470500                    LDP0    CG$,,AUTO
         1 002446   000106 235100                    LDA     70,,PR0
         1 002447   002464 601000 1                  TNZ     s:10498

      860    10486    2          IF MTYP$->KQ$QTN.CNACT ~= 0 THEN

  10486  1 002450   200015 471500                    LDP1    MTYP$,,AUTO
         1 002451   100044 235100                    LDA     36,,PR1
         1 002452   002464 600000 1                  TZE     s:10498

      861    10487    3            DO;

      862    10488    3   CDAN:    ;

  10488  1 002453                       CDAN         null
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:127  
      863    10489    3            B$JIT.ERR=E_CGCDAN;

  10489  1 002453   000013 236000 0                  LDQ     E_CGCDAN
         1 002454   000000 470400 xsym               LDP0    B$JIT$
         1 002455   000012 756100                    STQ     10,,PR0

      864    10490        /*E* ERROR:   KQC-E$CGCDAN-E
      865    10491             MESSAGE: M$CGCTL cannot delete an active queue node
      866    10492             MESSAGE1: You cannot delete a message-type/station from the
      867    10493                       list of legal queue keys when messages of that key
      868    10494                       are active. */
      869    10495    3            CALL KQL$QXFDUN (MYSTA$->KQ$STA);

  10495  1 002456   200014 630500                    EPPR0   MYSTA$,,AUTO
         1 002457   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002460   000000 701000 xent               TSX1    KQL$QXFDUN
         1 002461   000000 011000                    NOP     0

      870    10496    3            ALTRETURN;

  10496  1 002462   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 002463   000000 702211                    TSX2  ! 0,X1

      871    10497    3            END;
      872    10498    2         MTYP$->KQ$MTYP.PERM='0'B;

  10498  1 002464   200015 471500                    LDP1    MTYP$,,AUTO
         1 002465   000015 236000 2                  LDQ     13
         1 002466   100007 356100                    ANSQ    7,,PR1

      873    10499    2         IF CG$->KQ$CG.QISS = '0'B THEN

  10499  1 002467   000106 235100                    LDA     70,,PR0
         1 002470   002547 601000 1                  TNZ     s:10511

      874    10500    2          IF MTYP$->KQ$QTN.LOCKCNT ~= 0 THEN

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:128  
  10500  1 002471   200015 471500                    LDP1    MTYP$,,AUTO
         1 002472   100050 236100                    LDQ     40,,PR1
         1 002473   177000 316003                    CANQ    65024,DU
         1 002474   002534 600000 1                  TZE     s:10510

      875    10501    3            DO;

      876    10502    3            MTYP$->KQ$QTN.LOCKCNT=MTYP$->KQ$QTN.LOCKCNT+1;

  10502  1 002475   100050 236100                    LDQ     40,,PR1
         1 002476   000033 772000                    QRL     27
         1 002477   000177 376007                    ANQ     127,DL
         1 002500   000001 036007                    ADLQ    1,DL
         1 002501   000033 736000                    QLS     27
         1 002502   100050 676100                    ERQ     40,,PR1
         1 002503   177000 376003                    ANQ     65024,DU
         1 002504   100050 656100                    ERSQ    40,,PR1

      877    10503    3            CALL TUNLOCK;

  10503  1 002505   002375 701000 1                  TSX1    TUNLOCK
         1 002506   000000 011000                    NOP     0

      878    10504    3            CALL SSR$REG (%SS_SL,,1);

  10504  1 002507   000010 236000 2                  LDQ     8
         1 002510   200134 756100                    STQ     @TKEY+5,,AUTO
         1 002511   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002512   000017 235000 2                  LDA     15
         1 002513   200132 757100                    STAQ    @TKEY+3,,AUTO
         1 002514   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002515   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002516   000000 701000 xent               TSX1    SSR$REG
         1 002517   000000 011000                    NOP     0

      879    10505    3            CALL TLOCK;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:129  
  10505  1 002520   002363 701000 1                  TSX1    TLOCK
         1 002521   000000 011000                    NOP     0

      880    10506    3            MTYP$->KQ$QTN.LOCKCNT=MTYP$->KQ$QTN.LOCKCNT-1;

  10506  1 002522   200015 470500                    LDP0    MTYP$,,AUTO
         1 002523   000050 236100                    LDQ     40,,PR0
         1 002524   000033 772000                    QRL     27
         1 002525   000177 376007                    ANQ     127,DL
         1 002526   000001 136007                    SBLQ    1,DL
         1 002527   000033 736000                    QLS     27
         1 002530   000050 676100                    ERQ     40,,PR0
         1 002531   177000 376003                    ANQ     65024,DU
         1 002532   000050 656100                    ERSQ    40,,PR0

      881    10507    3            GOTO T0;

  10507  1 002533   002445 710000 1                  TRA     T0

      882    10508    3            END;
      883    10509    2          ELSE
      884    10510    2           CALL KQL$DELMLH (CG$->KQ$CG,ADDR(MTYP$->KQ$QTN.MLH));

  10510  1 002534   200015 236100                    LDQ     MTYP$,,AUTO
         1 002535   000055 036003                    ADLQ    45,DU
         1 002536   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002537   200132 633500                    EPPR3   @TKEY+3,,AUTO
         1 002540   200135 453500                    STP3    @TKEY+6,,AUTO
         1 002541   200006 236100                    LDQ     CG$,,AUTO
         1 002542   200134 756100                    STQ     @TKEY+5,,AUTO
         1 002543   200134 630500                    EPPR0   @TKEY+5,,AUTO
         1 002544   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002545   000000 701000 xent               TSX1    KQL$DELMLH
         1 002546   000000 011000                    NOP     0

      885    10511    2         CALL KQT$DELTYP (CG$->KQ$CG,MTYP$);

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:130  
  10511  1 002547   200015 630500                    EPPR0   MTYP$,,AUTO
         1 002550   200133 450500                    STP0    @TKEY+4,,AUTO
         1 002551   200006 236100                    LDQ     CG$,,AUTO
         1 002552   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002553   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002554   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002555   000000 701000 xent               TSX1    KQT$DELTYP
         1 002556   000000 011000                    NOP     0

      886    10512    2         IF CG$->KQ$CG.QISS = '0'B THEN

  10512  1 002557   200006 470500                    LDP0    CG$,,AUTO
         1 002560   000106 235100                    LDA     70,,PR0
         1 002561   002570 601000 1                  TNZ     s:10517

      887    10513    3           DO;

      888    10514    3           CALL KQL$QXFDUN (MYSTA$->KQ$STA);

  10514  1 002562   200014 630500                    EPPR0   MYSTA$,,AUTO
         1 002563   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002564   000000 701000 xent               TSX1    KQL$QXFDUN
         1 002565   000000 011000                    NOP     0

      889    10515    3           CALL TLOCK;

  10515  1 002566   002363 701000 1                  TSX1    TLOCK
         1 002567   000000 011000                    NOP     0

      890    10516    3           END;

      891    10517    2         RETURN;

  10517  1 002570   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 002571   000001 702211                    TSX2  ! 1,X1

      892    10518        /**/
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:131  
      893    10519        /*D* NAME:         DELSTA
      894    10520             PURPOSE:      To delete a station
      895    10521        */
      896    10522    2   DELSTA: ENTRY ALTRET;

  10522  1 002572   200120 741300       DELSTA       STX1  ! JNAME+3,,AUTO

      897    10523    2         IF CG$->KQ$CG.QISS THEN

  10523  1 002573   200006 470500                    LDP0    CG$,,AUTO
         1 002574   000106 235100                    LDA     70,,PR0
         1 002575   002604 600000 1                  TZE     s:10529

      898    10524    3           DO;

      899    10525    3           CALL SUNLOCK;

  10525  1 002576   002421 701000 1                  TSX1    SUNLOCK
         1 002577   000000 011000                    NOP     0

      900    10526    3           CALL KQR$GETQUEUE (MYSTA$->KQ$STA);

  10526  1 002600   200014 630500                    EPPR0   MYSTA$,,AUTO
         1 002601   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002602   000000 701000 xent               TSX1    KQR$GETQUEUE
         1 002603   000000 011000                    NOP     0

      901    10527    3           END;

      902    10528              %LOCK (G=STA$->KQ$STA.GATE);

  10529  1 002604   200013 236100                    LDQ     STA$,,AUTO
         1 002605   000016 036003                    ADLQ    14,DU
         1 002606   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002607   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002610   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002611   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:132  
         1 002612   000000 011000                    NOP     0

  10523  1 002613                       S0           null
      903    10531    2   S0:   ;
      904    10532    2         IF STA$->KQ$STA.LDCT$ ~= ADDR(NIL) THEN

  10532  1 002613   200013 470500                    LDP0    STA$,,AUTO
         1 002614   000010 236100                    LDQ     8,,PR0
         1 002615   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002616   002645 600000 1                  TZE     s:10544

      905    10533    3           DO;

      906    10534                %UNLOCK (G=STA$->KQ$STA.GATE);

  10535  1 002617   200013 236100                    LDQ     STA$,,AUTO
         1 002620   000016 036003                    ADLQ    14,DU
         1 002621   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002622   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002623   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002624   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002625   000000 011000                    NOP     0

      907    10537    3           B$JIT.ERR=E_CGCDCS;

  10537  1 002626   000007 236000 0                  LDQ     E_CGCDCS
         1 002627   000000 470400 xsym               LDP0    B$JIT$
         1 002630   000012 756100                    STQ     10,,PR0

      908    10538        /*E* ERROR:   KQC-E$CGCDCS-E
      909    10539             MESSAGE: M$CGCTL cannot delete a connected station */
      910    10540    3           IF CG$->KQ$CG.QISS THEN CALL KQL$QXFDUN (MYSTA$->KQ$STA);

  10540  1 002631   200006 471500                    LDP1    CG$,,AUTO
         1 002632   100106 235100                    LDA     70,,PR1
         1 002633   002641 600000 1                  TZE     s:10541

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:133  
  10540  1 002634   200014 630500                    EPPR0   MYSTA$,,AUTO
         1 002635   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002636   000000 701000 xent               TSX1    KQL$QXFDUN
         1 002637   000000 011000                    NOP     0
         1 002640   002643 710000 1                  TRA     s:10542

      911    10541    3           ELSE CALL SUNLOCK;

  10541  1 002641   002421 701000 1                  TSX1    SUNLOCK
         1 002642   000000 011000                    NOP     0

      912    10542    3           ALTRETURN;

  10542  1 002643   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 002644   000000 702211                    TSX2  ! 0,X1

      913    10543    3           END;
      914    10544    2         IF CG$->KQ$CG.QISS THEN

  10544  1 002645   200006 471500                    LDP1    CG$,,AUTO
         1 002646   100106 235100                    LDA     70,,PR1
         1 002647   002721 600000 1                  TZE     s:10562

      915    10545    2          IF STA$->KQ$QTN.CNACT ~= 0 THEN GOTO CDAN;

  10545  1 002650   000044 235100                    LDA     36,,PR0
         1 002651   002453 601000 1                  TNZ     CDAN

      916    10546    2          ELSE
      917    10547    2           IF STA$->KQ$QTN.LOCKCNT ~= 0 THEN

  10547  1 002652   000050 236100                    LDQ     40,,PR0
         1 002653   177000 316003                    CANQ    65024,DU
         1 002654   002721 600000 1                  TZE     s:10562

      918    10548    3             DO;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:134  
      919    10549    3   S1:       STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

  10549  1 002655   200013 470500       S1           LDP0    STA$,,AUTO
         1 002656   000020 236100                    LDQ     16,,PR0
         1 002657   000001 036007                    ADLQ    1,DL
         1 002660   000020 552104                    STBQ    16,'04'O,PR0

      920    10550                  %UNLOCK (G=STA$->KQ$STA.GATE);

  10551  1 002661   200013 236100                    LDQ     STA$,,AUTO
         1 002662   000016 036003                    ADLQ    14,DU
         1 002663   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002664   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002665   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002666   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002667   000000 011000                    NOP     0

      921    10553    3             CALL SUNLOCK;

  10553  1 002670   002421 701000 1                  TSX1    SUNLOCK
         1 002671   000000 011000                    NOP     0

      922    10554    3             CALL SSR$REG (%SS_SL,,1);

  10554  1 002672   000010 236000 2                  LDQ     8
         1 002673   200134 756100                    STQ     @TKEY+5,,AUTO
         1 002674   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002675   000017 235000 2                  LDA     15
         1 002676   200132 757100                    STAQ    @TKEY+3,,AUTO
         1 002677   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002700   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002701   000000 701000 xent               TSX1    SSR$REG
         1 002702   000000 011000                    NOP     0

      923    10555    3             CALL SLOCK;

  10555  1 002703   002407 701000 1                  TSX1    SLOCK
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:135  
         1 002704   000000 011000                    NOP     0

      924    10556                  %LOCK (G=STA$->KQ$STA.GATE);

  10557  1 002705   200013 236100                    LDQ     STA$,,AUTO
         1 002706   000016 036003                    ADLQ    14,DU
         1 002707   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002710   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002711   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002712   000000 701000 xent               TSX1    HFC$LOCK
         1 002713   000000 011000                    NOP     0

      925    10559    3             STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;

  10559  1 002714   200013 470500                    LDP0    STA$,,AUTO
         1 002715   000020 236100                    LDQ     16,,PR0
         1 002716   000777 036007                    ADLQ    511,DL
         1 002717   000020 552104                    STBQ    16,'04'O,PR0

      926    10560    3             GOTO S0;

  10560  1 002720   002613 710000 1                  TRA     S0

      927    10561    3             END;
      928    10562    2         IF STA$->KQ$STA.LOCKCNT ~= 0 THEN GOTO S1;

  10562  1 002721   000020 236100                    LDQ     16,,PR0
         1 002722   000777 316007                    CANQ    511,DL
         1 002723   002655 601000 1                  TNZ     S1

      929    10563    2         STA$->KQ$STA.PERM='0'B;

  10563  1 002724   000020 236000 2                  LDQ     16
         1 002725   000020 356100                    ANSQ    16,,PR0

      930    10564    2         IF CG$->KQ$CG.QISS THEN

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:136  
  10564  1 002726   100106 235100                    LDA     70,,PR1
         1 002727   002743 600000 1                  TZE     s:10566

      931    10565    2          CALL KQL$DELMLH (CG$->KQ$CG,ADDR(STA$->KQ$QTN.MLH));

  10565  1 002730   200013 236100                    LDQ     STA$,,AUTO
         1 002731   000055 036003                    ADLQ    45,DU
         1 002732   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002733   200132 633500                    EPPR3   @TKEY+3,,AUTO
         1 002734   200135 453500                    STP3    @TKEY+6,,AUTO
         1 002735   200006 236100                    LDQ     CG$,,AUTO
         1 002736   200134 756100                    STQ     @TKEY+5,,AUTO
         1 002737   200134 630500                    EPPR0   @TKEY+5,,AUTO
         1 002740   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002741   000000 701000 xent               TSX1    KQL$DELMLH
         1 002742   000000 011000                    NOP     0

      932    10566    2         CALL KQL$DELMLH (CG$->KQ$CG,ADDR(STA$->KQ$STA.MLH));

  10566  1 002743   200013 236100                    LDQ     STA$,,AUTO
         1 002744   000034 036003                    ADLQ    28,DU
         1 002745   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002746   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002747   200135 450500                    STP0    @TKEY+6,,AUTO
         1 002750   200006 236100                    LDQ     CG$,,AUTO
         1 002751   200134 756100                    STQ     @TKEY+5,,AUTO
         1 002752   200134 630500                    EPPR0   @TKEY+5,,AUTO
         1 002753   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002754   000000 701000 xent               TSX1    KQL$DELMLH
         1 002755   000000 011000                    NOP     0

      933    10567              %UNLOCK (G=STA$->KQ$STA.GATE);

  10568  1 002756   200013 236100                    LDQ     STA$,,AUTO
         1 002757   000016 036003                    ADLQ    14,DU
         1 002760   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002761   200132 630500                    EPPR0   @TKEY+3,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:137  
         1 002762   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002763   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002764   000000 011000                    NOP     0

      934    10570    2         CALL KQT$DELSTA (CG$->KQ$CG,STA$);

  10570  1 002765   200013 630500                    EPPR0   STA$,,AUTO
         1 002766   200133 450500                    STP0    @TKEY+4,,AUTO
         1 002767   200006 236100                    LDQ     CG$,,AUTO
         1 002770   200132 756100                    STQ     @TKEY+3,,AUTO
         1 002771   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 002772   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002773   000000 701000 xent               TSX1    KQT$DELSTA
         1 002774   000000 011000                    NOP     0

      935    10571    2         IF CG$->KQ$CG.QISS THEN

  10571  1 002775   200006 470500                    LDP0    CG$,,AUTO
         1 002776   000106 235100                    LDA     70,,PR0
         1 002777   003006 600000 1                  TZE     s:10576

      936    10572    3           DO;

      937    10573    3           CALL KQL$QXFDUN (MYSTA$->KQ$STA);

  10573  1 003000   200014 630500                    EPPR0   MYSTA$,,AUTO
         1 003001   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003002   000000 701000 xent               TSX1    KQL$QXFDUN
         1 003003   000000 011000                    NOP     0

      938    10574    3           CALL SLOCK;

  10574  1 003004   002407 701000 1                  TSX1    SLOCK
         1 003005   000000 011000                    NOP     0

      939    10575    3           END;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:138  
      940    10576    2         RETURN;

  10576  1 003006   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003007   000001 702211                    TSX2  ! 1,X1

      941    10577    2   END DELTYP;
      942    10578        /****************************************************************
      943    10579        *****************************************************************/
      944    10580        /*D* NAME:         CHKPRI
      945    10581             PURPOSE:      To see if a prio is legal
      946    10582             DESCRIPTION:  ALTRETs if not with JIT.ERR set
      947    10583        */
      948    10584    1   CHKPRI: PROC ALTRET;

  10584  1 003010   200120 741300       CHKPRI       STX1  ! JNAME+3,,AUTO

      949    10585    2         IF PRIO > %KQ_MPMAX#

  10585  1 003011   200022 235100                    LDA     PRIO,,AUTO
         1 003012   000765 115007                    CMPA    501,DL
         1 003013   003016 603000 1                  TRC     s:10588
         1 003014   000000 115003                    CMPA    0,DU
         1 003015   003023 601000 1                  TNZ     s:10595

      950    10586    2         OR PRIO = 0 THEN
      951    10587    3           DO;

      952    10588    3           B$JIT.ERR=E_BCGPRI;

  10588  1 003016   000000 236000 0                  LDQ     E_BCGPRI
         1 003017   000000 470400 xsym               LDP0    B$JIT$
         1 003020   000012 756100                    STQ     10,,PR0

      953    10589        /*E* ERROR:   KQC-E$BCGPRI-E
      954    10590             MESSAGE: Illegal M$CGCTL priority setting
      955    10591             MESSAGE1: Your M$CGCTL service attempted to set a default or
      956    10592                       station or message type priority to an illegal value. */
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:139  
      957    10593    3           ALTRETURN;

  10593  1 003021   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003022   000000 702211                    TSX2  ! 0,X1

      958    10594    3           END;
      959    10595    2         RETURN;

  10595  1 003023   000001 702211                    TSX2  ! 1,X1

      960    10596    2   END CHKPRI;
      961    10597        /****************************************************************
      962    10598        *****************************************************************/
      963    10599        /*D* NAME:         CHKTYP
      964    10600             PURPOSE:      To validate a default message type
      965    10601             DESCRIPTION:  If the passed type is not in the message type
      966    10602                           tree, then if XTYPLGL is reset, we ALTRET with
      967    10603                           JIT.ERR set; else (xtra's OK) and its not a '*' type
      968    10604                           we make one and return unless no mem in which case
      969    10605                           ALTRET with JIT.ERR set to nomem.  Else (it's there
      970    10606                           or '*' type), return. Note that '*AUEV' types will
      971    10607                           get rejected.
      972    10608        */
      973    10609    1   CHKTYP: PROC (TKEY) ALTRET;

  10609  1 003024   200126 741300       CHKTYP       STX1  ! @QTN$+1,,AUTO

      974    10610        /**/
      975    10611    2   DCL TKEY CHAR(8) UNAL;
      976    10612        /**/
      977    10613    2         CALL TLOCK;

  10613  1 003025   002363 701000 1                  TSX1    TLOCK
         1 003026   000000 011000                    NOP     0

      978    10614    2         CALL KQB$SRCH (KQ$TTREE,TKEY,MTYP$) ALTRET(NOTYP);

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:140  
  10614  1 003027   200015 630500                    EPPR0   MTYP$,,AUTO
         1 003030   200134 450500                    STP0    @TKEY+5,,AUTO
         1 003031   200127 236100                    LDQ     @TKEY,,AUTO
         1 003032   200133 756100                    STQ     @TKEY+4,,AUTO
         1 003033   200006 236100                    LDQ     CG$,,AUTO
         1 003034   000067 036003                    ADLQ    55,DU
         1 003035   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003036   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003037   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003040   000000 701000 xent               TSX1    KQB$SRCH
         1 003041   003046 702000 1                  TSX2    NOTYP

  10613  1 003042                       RTN          null
      979    10615    2   RTN:  ;
      980    10616    2         CALL TUNLOCK;

  10616  1 003042   002375 701000 1                  TSX1    TUNLOCK
         1 003043   000000 011000                    NOP     0

      981    10617    2         RETURN;

  10617  1 003044   200126 221300                    LDX1  ! @QTN$+1,,AUTO
         1 003045   000001 702211                    TSX2  ! 1,X1

  10613  1 003046                       NOTYP        null
      982    10618    2   NOTYP:;
      983    10619    2         IF CG$->KQ$CG.AUCTL.XTYPLGL = '0'B THEN

  10619  1 003046   200006 470500                    LDP0    CG$,,AUTO
         1 003047   000133 236100                    LDQ     91,,PR0
         1 003050   000001 316007                    CANQ    1,DL
         1 003051   003061 601000 1                  TNZ     s:10631

      984    10620    3           DO;

      985    10621    3           CALL TUNLOCK;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:141  
  10621  1 003052   002375 701000 1                  TSX1    TUNLOCK
         1 003053   000000 011000                    NOP     0

      986    10622    3           B$JIT.ERR=E_CGCDXT;

  10622  1 003054   000005 236000 0                  LDQ     E_CGCDXT
         1 003055   000000 470400 xsym               LDP0    B$JIT$
         1 003056   000012 756100                    STQ     10,,PR0

      987    10623        /*E* ERROR:   KQC-E$CGCDXT-E
      988    10624             MESSAGE: Default message type unknown and illegal to add it
      989    10625             MESSAGE1: The default message type specified in VLP_CGCP in
      990    10626                       M$CGCTL was not in the comgroup's list, and it
      991    10627                       could not be added because VLP_CGCP.XTYPLGL was
      992    10628                       reset. */
      993    10629    3           ALTRETURN;

  10629  1 003057   200126 221300                    LDX1  ! @QTN$+1,,AUTO
         1 003060   000000 702211                    TSX2  ! 0,X1

      994    10630    3           END;
      995    10631    2         IF SUBSTR(TKEY,0,1)='*' AND TKEY~='*AUEV' THEN GOTO RTN;

  10631  1 003061   200127 471500                    LDP1    @TKEY,,AUTO
         1 003062   040000 106500                    CMPC    fill='040'O
         1 003063   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 003064   000021 000001 2                  ADSC9   17                       cn=0,n=1
         1 003065   003072 601000 1                  TNZ     s:10632
         1 003066   040000 106500                    CMPC    fill='040'O
         1 003067   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 003070   000042 000005 0                  ADSC9   CCGID+17                 cn=0,n=5
         1 003071   003042 601000 1                  TNZ     RTN

      996    10632    2         IF TKEY ~= ' ' THEN

  10632  1 003072   040000 106500                    CMPC    fill='040'O
         1 003073   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:142  
         1 003074   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 003075   003103 600000 1                  TZE     s:10634

      997    10633    2          CALL INDEX (I,SUBSTR(TKEY,0,1),KC_LGL1ST) ALTRET(BADTYP);

  10633  1 003076   000100 124400                    SCM     mask='000'O
         1 003077   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 003100   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 003101   200113 000100                    ARG     I,,AUTO
         1 003102   003120 606400 1                  TTN     BADTYP

      998    10634    2         MTYP$=MYSTA$;

  10634  1 003103   200014 236100                    LDQ     MYSTA$,,AUTO
         1 003104   200015 756100                    STQ     MTYP$,,AUTO

      999    10635    2         CALL KQT$GETTYP (CG$->KQ$CG,MTYP$,TKEY) ALTRET(NOMEM);

  10635  1 003105   200127 236100                    LDQ     @TKEY,,AUTO
         1 003106   200134 756100                    STQ     @TKEY+5,,AUTO
         1 003107   200015 633500                    EPPR3   MTYP$,,AUTO
         1 003110   200133 453500                    STP3    @TKEY+4,,AUTO
         1 003111   200006 236100                    LDQ     CG$,,AUTO
         1 003112   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003113   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003114   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003115   000000 701000 xent               TSX1    KQT$GETTYP
         1 003116   003127 702000 1                  TSX2    NOMEM

     1000    10636    2         GOTO RTN;

  10636  1 003117   003042 710000 1                  TRA     RTN

  10634  1 003120                       BADTYP       null
     1001    10637    2   BADTYP:;
     1002    10638    2         CALL TUNLOCK;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:143  
  10638  1 003120   002375 701000 1                  TSX1    TUNLOCK
         1 003121   000000 011000                    NOP     0

     1003    10639    2         B$JIT.ERR=E_TYPCHR;

  10639  1 003122   000016 236000 0                  LDQ     E_TYPCHR
         1 003123   000000 470400 xsym               LDP0    B$JIT$
         1 003124   000012 756100                    STQ     10,,PR0

     1004    10640    2         ALTRETURN;

  10640  1 003125   200126 221300                    LDX1  ! @QTN$+1,,AUTO
         1 003126   000000 702211                    TSX2  ! 0,X1

  10639  1 003127   003131 710000 1     NOMEM        TRA     s:10643

     1005    10641    2   NOMEM:;
     1006    10642    2   SETNOMEM: ENTRY ALTRET;

  10642  1 003130   200126 741300       SETNOMEM     STX1  ! @QTN$+1,,AUTO

     1007    10643    2         B$JIT.ERR=E_NOMEM;

  10643  1 003131   000001 236000 0                  LDQ     E_NOMEM
         1 003132   000000 470400 xsym               LDP0    B$JIT$
         1 003133   000012 756100                    STQ     10,,PR0

     1008    10644        /*E* ERROR:   KQC-E$NOMEM-E
     1009    10645             MESSAGE: Insufficient comgroup memory available
     1010    10646             MESSAGE1: Your comgroup has insufficient memory available for
     1011    10647                       the additions you requested via M$CGCTL, or for
     1012    10648                       its initial creation via M$OPEN. */
     1013    10649    2         ALTRETURN;

  10649  1 003134   200126 221300                    LDX1  ! @QTN$+1,,AUTO
         1 003135   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:144  
     1014    10650    2   END CHKTYP;
     1015    10651        /****************************************************************
     1016    10652        *****************************************************************/
     1017    10653        /*D* NAME:         SPCLSTA
     1018    10654             PURPOSE:      To build a special station for M$CGCTL
     1019    10655             CALL:         SPCLSTA (B$PSN$,STAPTR$)
     1020    10656
     1021    10657                            where B$PSN$ points to a VLP_STATION
     1022    10658                            in which STATION is the desired name.
     1023    10659             DESCRIPTION:  Gets a station block and puts it into
     1024    10660                           the tree with the passed name, then
     1025    10661                           sets the passed pointer to that station.
     1026    10662                           If STAPTR$ ~= ADDR(NIL) then it is assumed
     1027    10663                           to point to a KQ$STA, in which the SPECIAL
     1028    10664                           bit is reset.
     1029    10665                           The SPECIAL bit is set in the new KQ$STA.
     1030    10666                           ALTRETs with B$JIT.ERR set if anything
     1031    10667                           goes wrong.
     1032    10668        */
     1033    10669    1   SPCLSTA: PROC (PS$,STAPTR$) ALTRET;

  10669  1 003136   200120 741300       SPCLSTA      STX1  ! JNAME+3,,AUTO

     1034    10670        /**/
     1035    10671    2   DCL PS$ PTR;
     1036    10672    2   DCL STAPTR$ PTR;
     1037    10673        /**/
     1038    10674    2         CALL HFF$NIL (PS$) ALTRET(RTN);

  10674  1 003137   200121 630500                    EPPR0   @PS$,,AUTO
         1 003140   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003141   000000 701000 xent               TSX1    HFF$NIL
         1 003142   003274 702000 1                  TSX2    RTN

     1039    10675    2         CALL HFF$ERASE (PS$) ALTRET(ERASEIT);

  10675  1 003143   200121 630500                    EPPR0   @PS$,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:145  
         1 003144   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003145   000000 701000 xent               TSX1    HFF$ERASE
         1 003146   003276 702000 1                  TSX2    ERASEIT

     1040    10676    2         KEY=PS$->VLP$STATION.STATION;

  10676  1 003147   200121 470500                    LDP0    @PS$,,AUTO
         1 003150   000000 471500                    LDP1    0,,PR0
         1 003151   040100 100500                    MLR     fill='040'O
         1 003152   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 003153   200010 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

     1041    10677    2         IF KEY ~= ' ' THEN

  10677  1 003154   200010 237100                    LDAQ    KEY,,AUTO
         1 003155   000022 117000 2                  CMPAQ   18
         1 003156   003274 600000 1                  TZE     RTN

     1042    10678    3           DO;

     1043    10679    3           CALL SLOCK;

  10679  1 003157   002407 701000 1                  TSX1    SLOCK
         1 003160   000000 011000                    NOP     0

     1044    10680    3           CALL INDEX (I,SUBSTR(KEY,0,1),KC_LGL1ST) ALTRET(BADSTACHR);

  10680  1 003161   000100 124400                    SCM     mask='000'O
         1 003162   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 003163   200010 000001                    ADSC9   KEY,,AUTO                cn=0,n=1
         1 003164   200113 000100                    ARG     I,,AUTO
         1 003165   003335 606400 1                  TTN     BADSTACHR

     1045    10681    3           STA$=MYSTA$;

  10681  1 003166   200014 236100                    LDQ     MYSTA$,,AUTO
         1 003167   200013 756100                    STQ     STA$,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:146  

     1046    10682    3           CALL KQT$GETSTA (CG$->KQ$CG,STA$,KEY) ALTRET(NOMEM);

  10682  1 003170   200010 630500                    EPPR0   KEY,,AUTO
         1 003171   200134 450500                    STP0    @TKEY+5,,AUTO
         1 003172   200013 631500                    EPPR1   STA$,,AUTO
         1 003173   200133 451500                    STP1    @TKEY+4,,AUTO
         1 003174   200006 236100                    LDQ     CG$,,AUTO
         1 003175   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003176   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003177   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003200   000000 701000 xent               TSX1    KQT$GETSTA
         1 003201   003346 702000 1                  TSX2    NOMEM

     1047    10683    3           IF  STAPTR$ ~= ADDR(NIL)

  10683  1 003202   200122 470500                    LDP0    @STAPTR$,,AUTO
         1 003203   000000 236100                    LDQ     0,,PR0
         1 003204   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003205   003232 600000 1                  TZE     s:10695
         1 003206   200013 116100                    CMPQ    STA$,,AUTO
         1 003207   003232 600000 1                  TZE     s:10695

     1048    10684    3           AND STAPTR$ ~= STA$ THEN
     1049    10685    4             DO;

     1050    10686                  %LOCK (G=STAPTR$->KQ$STA.GATE);

  10687  1 003210   000000 471500                    LDP1    0,,PR0
         1 003211   100016 633500                    EPPR3   14,,PR1
         1 003212   200132 453500                    STP3    @TKEY+3,,AUTO
         1 003213   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003214   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003215   000000 701000 xent               TSX1    HFC$LOCK
         1 003216   000000 011000                    NOP     0

     1051    10689    4             STAPTR$->KQ$STA.SPECIAL='0'B;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:147  

  10689  1 003217   200122 470500                    LDP0    @STAPTR$,,AUTO
         1 003220   000000 471500                    LDP1    0,,PR0
         1 003221   000024 236000 2                  LDQ     20
         1 003222   100023 356100                    ANSQ    19,,PR1

     1052    10690                  %UNLOCK (G=STAPTR$->KQ$STA.GATE);

  10691  1 003223   000000 471500                    LDP1    0,,PR0
         1 003224   100016 633500                    EPPR3   14,,PR1
         1 003225   200132 453500                    STP3    @TKEY+3,,AUTO
         1 003226   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003227   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003230   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003231   000000 011000                    NOP     0

     1053    10693    4             END;

     1054    10694                %LOCK (G=STA$->KQ$STA.GATE);

  10695  1 003232   200013 236100                    LDQ     STA$,,AUTO
         1 003233   000016 036003                    ADLQ    14,DU
         1 003234   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003235   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003236   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003237   000000 701000 xent               TSX1    HFC$LOCK
         1 003240   000000 011000                    NOP     0

     1055    10697    3           STA$->KQ$STA.SPECIAL='1'B;

  10697  1 003241   200013 470500                    LDP0    STA$,,AUTO
         1 003242   200000 236007                    LDQ     65536,DL
         1 003243   000023 256100                    ORSQ    19,,PR0

     1056    10698                %UNLOCK (G=STA$->KQ$STA.GATE);

  10699  1 003244   200013 236100                    LDQ     STA$,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:148  
         1 003245   000016 036003                    ADLQ    14,DU
         1 003246   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003247   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003250   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003251   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003252   000000 011000                    NOP     0

     1057    10701    3           IF CG$->KQ$CG.QISS THEN

  10701  1 003253   200006 470500                    LDP0    CG$,,AUTO
         1 003254   000106 235100                    LDA     70,,PR0
         1 003255   003267 600000 1                  TZE     s:10706

     1058    10702    4             DO;

     1059    10703    4             PRIO=STA$->KQ$STA.MPRIO;

  10703  1 003256   200013 471500                    LDP1    STA$,,AUTO
         1 003257   100015 236100                    LDQ     13,,PR1
         1 003260   000022 772000                    QRL     18
         1 003261   000777 376007                    ANQ     511,DL
         1 003262   200022 756100                    STQ     PRIO,,AUTO

     1060    10704    4             CALL SETPRIO (STA$);

  10704  1 003263   200013 633500                    EPPR3   STA$,,AUTO
         1 003264   200125 453500                    STP3    I+2,,AUTO
         1 003265   003617 701000 1                  TSX1    SETPRIO
         1 003266   000000 011000                    NOP     0

     1061    10705    4             END;

     1062    10706    3           STAPTR$=STA$;

  10706  1 003267   200013 236100                    LDQ     STA$,,AUTO
         1 003270   200122 470500                    LDP0    @STAPTR$,,AUTO
         1 003271   000000 756100                    STQ     0,,PR0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:149  

     1063    10707    3           CALL SUNLOCK;

  10707  1 003272   002421 701000 1                  TSX1    SUNLOCK
         1 003273   000000 011000                    NOP     0

     1064    10708    3           END;

  10707  1 003274                       RTN          null
     1065    10709    2   RTN:  ;
     1066    10710    2         RETURN;

  10710  1 003274   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003275   000001 702211                    TSX2  ! 1,X1

  10707  1 003276                       ERASEIT      null
     1067    10711    2   ERASEIT:;
     1068    10712    2         CALL SLOCK;

  10712  1 003276   002407 701000 1                  TSX1    SLOCK
         1 003277   000000 011000                    NOP     0

     1069    10713    2         IF STAPTR$ ~= ADDR(NIL) THEN

  10713  1 003300   200122 470500                    LDP0    @STAPTR$,,AUTO
         1 003301   000000 236100                    LDQ     0,,PR0
         1 003302   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003303   003331 600000 1                  TZE     s:10724

     1070    10714    3           DO;

     1071    10715                %LOCK (G=STAPTR$->KQ$STA.GATE);

  10716  1 003304   000000 471500                    LDP1    0,,PR0
         1 003305   100016 633500                    EPPR3   14,,PR1
         1 003306   200132 453500                    STP3    @TKEY+3,,AUTO
         1 003307   200132 630500                    EPPR0   @TKEY+3,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:150  
         1 003310   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003311   000000 701000 xent               TSX1    HFC$LOCK
         1 003312   000000 011000                    NOP     0

     1072    10718    3           STAPTR$->KQ$STA.SPECIAL='0'B;

  10718  1 003313   200122 470500                    LDP0    @STAPTR$,,AUTO
         1 003314   000000 471500                    LDP1    0,,PR0
         1 003315   000024 236000 2                  LDQ     20
         1 003316   100023 356100                    ANSQ    19,,PR1

     1073    10719                %UNLOCK (G=STAPTR$->KQ$STA.GATE);

  10720  1 003317   000000 471500                    LDP1    0,,PR0
         1 003320   100016 633500                    EPPR3   14,,PR1
         1 003321   200132 453500                    STP3    @TKEY+3,,AUTO
         1 003322   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003323   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003324   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003325   000000 011000                    NOP     0

     1074    10722    3           STAPTR$=ADDR(NIL);

  10722  1 003326   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003327   200122 470500                    LDP0    @STAPTR$,,AUTO
         1 003330   000000 756100                    STQ     0,,PR0

     1075    10723    3           END;

     1076    10724    2         CALL SUNLOCK;

  10724  1 003331   002421 701000 1                  TSX1    SUNLOCK
         1 003332   000000 011000                    NOP     0

     1077    10725    2         RETURN;

  10725  1 003333   200120 221300                    LDX1  ! JNAME+3,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:151  
         1 003334   000001 702211                    TSX2  ! 1,X1

     1078    10726        /**/
     1079    10727    2   BADSTACHR:;

  10727  1 003335                       BADSTACHR    null
     1080    10728    2         CALL SUNLOCK;

  10728  1 003335   002421 701000 1                  TSX1    SUNLOCK
         1 003336   000000 011000                    NOP     0
         1 003337   003341 710000 1                  TRA     s:10732

     1081    10729        /**/
     1082    10730    2   SETBSC: ENTRY ALTRET;

  10730  1 003340   200120 741300       SETBSC       STX1  ! JNAME+3,,AUTO

     1083    10731        /**/
     1084    10732    2         B$JIT.ERR=E_STACHR;

  10732  1 003341   000017 236000 0                  LDQ     E_STACHR
         1 003342   000000 470400 xsym               LDP0    B$JIT$
         1 003343   000012 756100                    STQ     10,,PR0

     1085    10733        /*E* ERROR:   KQC-E$STACHAR-E
     1086    10734             MESSAGE: Illegal character in station name on M$CGCTL
     1087    10735             MESSAGE1: A station name supplied to M$CGCTL had an illegal
     1088    10736                       first character. */
     1089    10737    2         ALTRETURN;

  10737  1 003344   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003345   000000 702211                    TSX2  ! 0,X1

  10732  1 003346                       NOMEM        null
     1090    10738        /**/
     1091    10739    2   NOMEM:;
     1092    10740    2         CALL SETNOMEM;
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:152  

  10740  1 003346   003130 701000 1                  TSX1    SETNOMEM
         1 003347   000000 011000                    NOP     0

     1093    10741    2         ALTRETURN;

  10741  1 003350   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003351   000000 702211                    TSX2  ! 0,X1

     1094    10742    2   END SPCLSTA;
     1095    10743        /****************************************************************
     1096    10744        *****************************************************************/
     1097    10745        /*D* NAME:         TRMGO
     1098    10746             PURPOSE:      To tell ELF when terminal connects become legal
     1099    10747                           on a comgroup so that waiting terms connect.
     1100    10748             DESCRIPTION:  Error logs a message with type EL_CGTOK,
     1101    10749                           and file = 2 (communication accounting)
     1102    10750                           containing a KC$CGID block built from the
     1103    10751                           NAME, ACCOUNT and PSN from the AU's DCB.e.
     1104    10752                           If the errlog buffs are full sleep for 3 secs.
     1105    10753        */
     1106    10754    1   TRMGO: PROC ALTRET;

  10754  1 003352   200120 741300       TRMGO        STX1  ! JNAME+3,,AUTO

     1107    10755        /**/
     1108    10756    2         DCB$=B$JIT.DCB$;

  10756  1 003353   000000 470400 xsym               LDP0    B$JIT$
         1 003354   000232 236100                    LDQ     154,,PR0
         1 003355   200110 756100                    STQ     DCB$,,AUTO

     1109    10757    2         ACGID=CCGID;

  10757  1 003356   000100 100400                    MLR     fill='000'O
         1 003357   000021 000060 0                  ADSC9   CCGID                    cn=0,n=48
         1 003360   200066 000060                    ADSC9   ACGID,,AUTO              cn=0,n=48
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:153  

     1110    10758    2         ACGID.ACCT#=DCB$->F$DCB.ACCT;

  10758  1 003361   200110 471500                    LDP1    DCB$,,AUTO
         1 003362   100020 237100                    LDAQ    16,,PR1
         1 003363   200066 757100                    STAQ    ACGID,,AUTO

     1111    10759    2         ACGID.PSN#=DCB$->F$DCB.PSN;

  10759  1 003364   040100 100500                    MLR     fill='040'O
         1 003365   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
         1 003366   200070 000006                    ADSC9   ACGID+2,,AUTO            cn=0,n=6

     1112    10760    2         ACGID.NAME#.CNT=DCB$->F$DCB.NAME.L;

  10760  1 003367   100010 236100                    LDQ     8,,PR1
         1 003370   200072 552140                    STBQ    ACGID+4,'40'O,AUTO

     1113    10761    2         ACGID.NAME#.TXT=ADDR(DCB$->F$DCB.NAME)->VTXTC.TXT;

  10761  1 003371   100010 236100                    LDQ     8,,PR1
         1 003372   000033 772000                    QRL     27
         1 003373   000000 620006                    EAX0    0,QL
         1 003374   040100 100540                    MLR     fill='040'O
         1 003375   100010 200010                    ADSC9   8,,PR1                   cn=1,n=*X0
         1 003376   200072 200037                    ADSC9   ACGID+4,,AUTO            cn=1,n=31

  10761  1 003377                       TELLELF      null
     1114    10762    2   TELLELF:;
     1115    10763    2         CALL ELA$SYSLOG (EL_CGTOK,ACGID,SIZEW(ACGID),'0'B,2,TOKFLG) ALTRET (ELFWT);

  10763  1 003377   200114 630500                    EPPR0   TOKFLG,,AUTO
         1 003400   200137 450500                    STP0    @TKEY+8,,AUTO
         1 003401   000012 236000 2                  LDQ     10
         1 003402   200136 756100                    STQ     @TKEY+7,,AUTO
         1 003403   000026 237000 2                  LDAQ    22
         1 003404   200134 757100                    STAQ    @TKEY+5,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:154  
         1 003405   200066 631500                    EPPR1   ACGID,,AUTO
         1 003406   200133 451500                    STP1    @TKEY+4,,AUTO
         1 003407   000030 236000 2                  LDQ     24
         1 003410   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003411   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003412   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 003413   000000 701000 xent               TSX1    ELA$SYSLOG
         1 003414   003417 702000 1                  TSX2    ELFWT

     1116    10764    2         RETURN;

  10764  1 003415   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003416   000001 702211                    TSX2  ! 1,X1

  10761  1 003417                       ELFWT        null
     1117    10765    2   ELFWT:;
     1118    10766    2         CALL SSR$REG (%SS_SL,ADDR(NIL),3);

  10766  1 003417   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003420   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003421   000004 236000 2                  LDQ     4
         1 003422   200135 756100                    STQ     @TKEY+6,,AUTO
         1 003423   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003424   200134 450500                    STP0    @TKEY+5,,AUTO
         1 003425   000017 236000 2                  LDQ     15
         1 003426   200133 756100                    STQ     @TKEY+4,,AUTO
         1 003427   200133 630500                    EPPR0   @TKEY+4,,AUTO
         1 003430   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003431   000000 701000 xent               TSX1    SSR$REG
         1 003432   000000 011000                    NOP     0

     1119    10767    2         GOTO TELLELF;

  10767  1 003433   003377 710000 1                  TRA     TELLELF

     1120    10768    2   END TRMGO;
     1121    10769        /****************************************************************
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:155  
     1122    10770        *****************************************************************/
     1123    10771        /*D* NAME:         CXTSET
     1124    10772             PURPOSE:      To set up a context block after AUCTL has
     1125    10773                           been filled in
     1126    10774             DESCRIPTION:  Takes the AU-specified control params in
     1127    10775                           CG$->KQ$CG.AUCTL, and sets the other control params
     1128    10776                           in the context block appropriately.
     1129    10777                           Gets AUCTL.MINPG pages;
     1130    10778                           Gets AUCTL.DEFERBLKS defer blocks;
     1131    10779                           ALTRETs if unable with B$JIT.ERR set.
     1132    10780        */
     1133    10781    1   CXTSET: PROC ALTRET;

  10781  1 003434   200120 741300       CXTSET       STX1  ! JNAME+3,,AUTO

     1134    10782        /**/
     1135    10783    2   DCL ERR UBIN;
     1136    10784    2   DCL I UBIN WORD;
     1137    10785    2   DCL J UBIN;
     1138    10786        /**/
     1139    10787    2         J=CG$->KQ$CG.AUCTL.DATAPGS;

  10787  1 003435   200006 470500                    LDP0    CG$,,AUTO
         1 003436   000135 236100                    LDQ     93,,PR0
         1 003437   000011 772000                    QRL     9
         1 003440   000777 376007                    ANQ     511,DL
         1 003441   200123 756100                    STQ     J,,AUTO

     1140    10788    2         IF J = 0 THEN J=1; ELSE IF J > 99 THEN J=99;

  10788  1 003442   003446 601000 1                  TNZ     s:10788+4

  10788  1 003443   000001 235007                    LDA     1,DL
         1 003444   200123 755100                    STA     J,,AUTO
         1 003445   003452 710000 1                  TRA     s:10789

  10788  1 003446   000144 116007                    CMPQ    100,DL
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:156  
         1 003447   003452 602000 1                  TNC     s:10789

  10788  1 003450   000143 235007                    LDA     99,DL
         1 003451   200123 755100                    STA     J,,AUTO

     1141    10789    2         I=(CG$->KQ$CG.AUCTL.MAXPG*J)/100;

  10789  1 003452   000133 236100                    LDQ     91,,PR0
         1 003453   000022 772000                    QRL     18
         1 003454   200123 402100                    MPY     J,,AUTO
         1 003455   000001 772000                    QRL     1
         1 003456   000062 506007                    DIV     50,DL
         1 003457   200122 756100                    STQ     I,,AUTO

     1142    10790    2         IF I < 2 THEN I=2;

  10790  1 003460   000002 116007                    CMPQ    2,DL
         1 003461   003464 603000 1                  TRC     s:10791

  10790  1 003462   000002 235007                    LDA     2,DL
         1 003463   200122 755100                    STA     I,,AUTO

     1143    10791    2         IF I >= CG$->KQ$CG.AUCTL.MAXPG THEN I=CG$->KQ$CG.AUCTL.MAXPG-1;

  10791  1 003464   000133 236100                    LDQ     91,,PR0
         1 003465   000022 772000                    QRL     18
         1 003466   200122 116100                    CMPQ    I,,AUTO
         1 003467   003471 600000 1                  TZE     s:10791+5
         1 003470   003473 603000 1                  TRC     s:10792

  10791  1 003471   000001 136007                    SBLQ    1,DL
         1 003472   200122 756100                    STQ     I,,AUTO

     1144    10792    2         CG$->KQ$CG.MAXDATAPGS=I;

  10792  1 003473   200122 720100                    LXL0    I,,AUTO
         1 003474   000241 740100                    STX0    161,,PR0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:157  

     1145    10793    2         CG$->KQ$CG.MMD.MAXBPG=CG$->KQ$CG.AUCTL.MAXPG-I;

  10793  1 003475   000133 236100                    LDQ     91,,PR0
         1 003476   000022 772000                    QRL     18
         1 003477   200122 136100                    SBLQ    I,,AUTO
         1 003500   000000 622006                    EAX2    0,QL
         1 003501   000010 442100                    SXL2    8,,PR0

     1146    10794    2         I=(CG$->KQ$CG.AUCTL.MINPG*J)/100;

  10794  1 003502   000131 236100                    LDQ     89,,PR0
         1 003503   000022 772000                    QRL     18
         1 003504   200123 402100                    MPY     J,,AUTO
         1 003505   000001 772000                    QRL     1
         1 003506   000062 506007                    DIV     50,DL
         1 003507   200122 756100                    STQ     I,,AUTO

     1147    10795    2         IF I = 0 THEN I=1;

  10795  1 003510   000000 116003                    CMPQ    0,DU
         1 003511   003514 601000 1                  TNZ     s:10796

  10795  1 003512   000001 235007                    LDA     1,DL
         1 003513   200122 755100                    STA     I,,AUTO

     1148    10796    2         IF I >= CG$->KQ$CG.AUCTL.MINPG THEN I=CG$->KQ$CG.AUCTL.MINPG-1;

  10796  1 003514   000131 236100                    LDQ     89,,PR0
         1 003515   000022 772000                    QRL     18
         1 003516   200122 116100                    CMPQ    I,,AUTO
         1 003517   003521 600000 1                  TZE     s:10796+5
         1 003520   003523 603000 1                  TRC     s:10797

  10796  1 003521   000001 136007                    SBLQ    1,DL
         1 003522   200122 756100                    STQ     I,,AUTO

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:158  
     1149    10797    2         CG$->KQ$CG.MINDATAPGS=I;

  10797  1 003523   200122 721100                    LXL1    I,,AUTO
         1 003524   000242 741100                    STX1    162,,PR0

     1150    10798    2         CG$->KQ$CG.MMD.MINBPG=CG$->KQ$CG.AUCTL.MINPG-I;

  10798  1 003525   000131 236100                    LDQ     89,,PR0
         1 003526   000022 772000                    QRL     18
         1 003527   200122 136100                    SBLQ    I,,AUTO
         1 003530   000000 623006                    EAX3    0,QL
         1 003531   000011 443100                    SXL3    9,,PR0

     1151    10799    2         IF CG$->KQ$CG.QISS THEN

  10799  1 003532   000106 235100                    LDA     70,,PR0
         1 003533   003551 600000 1                  TZE     s:10807

     1152    10800    3           DO;

     1153    10801    3           CG$->KQ$CG.QUEUE.QTREE$=ADDR(CG$->KQ$CG.STREE);

  10801  1 003534   200006 236100                    LDQ     CG$,,AUTO
         1 003535   000075 036003                    ADLQ    61,DU
         1 003536   000057 756100                    STQ     47,,PR0

     1154    10802    3           CG$->KQ$CG.XQTNLGL=CG$->KQ$CG.AUCTL.XSTALGL;

  10802  1 003537   000133 236100                    LDQ     91,,PR0
         1 003540   000003 772000                    QRL     3
         1 003541   000105 676100                    ERQ     69,,PR0
         1 003542   000002 376007                    ANQ     2,DL
         1 003543   000105 656100                    ERSQ    69,,PR0

     1155    10803    3           CG$->KQ$CG.XOTNLGL=CG$->KQ$CG.AUCTL.XTYPLGL;

  10803  1 003544   000133 236100                    LDQ     91,,PR0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:159  
         1 003545   000105 676100                    ERQ     69,,PR0
         1 003546   000001 376007                    ANQ     1,DL
         1 003547   000105 656100                    ERSQ    69,,PR0

     1156    10804    3           END;

  10804  1 003550   003566 710000 1                  TRA     s:10811

     1157    10805    2         ELSE
     1158    10806    3           DO;

     1159    10807    3           CG$->KQ$CG.QUEUE.QTREE$=ADDR(KQ$TTREE);

  10807  1 003551   200006 236100                    LDQ     CG$,,AUTO
         1 003552   000067 036003                    ADLQ    55,DU
         1 003553   000057 756100                    STQ     47,,PR0

     1160    10808    3           CG$->KQ$CG.XQTNLGL=CG$->KQ$CG.AUCTL.XTYPLGL;

  10808  1 003554   000133 236100                    LDQ     91,,PR0
         1 003555   000001 736000                    QLS     1
         1 003556   000105 676100                    ERQ     69,,PR0
         1 003557   000002 376007                    ANQ     2,DL
         1 003560   000105 656100                    ERSQ    69,,PR0

     1161    10809    3           CG$->KQ$CG.XOTNLGL=CG$->KQ$CG.AUCTL.XSTALGL;

  10809  1 003561   000133 236100                    LDQ     91,,PR0
         1 003562   000004 772000                    QRL     4
         1 003563   000105 676100                    ERQ     69,,PR0
         1 003564   000001 376007                    ANQ     1,DL
         1 003565   000105 656100                    ERSQ    69,,PR0

     1162    10810    3           END;

     1163    10811    2         CG$->KQ$CG.FORCECNT=CG$->KQ$CG.AUCTL.WRITETIME;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:160  
  10811  1 003566   000135 236100                    LDQ     93,,PR0
         1 003567   000033 736000                    QLS     27
         1 003570   000237 552140                    STBQ    159,'40'O,PR0

     1164    10812    2         CALL KQM$GETMIN (CG$->KQ$CG,,ERR) ALTRET(ALTRT);

  10812  1 003571   200121 631500                    EPPR1   ERR,,AUTO
         1 003572   200134 451500                    STP1    @TKEY+5,,AUTO
         1 003573   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003574   200006 235100                    LDA     CG$,,AUTO
         1 003575   200132 757100                    STAQ    @TKEY+3,,AUTO
         1 003576   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003577   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003600   000000 701000 xent               TSX1    KQM$GETMIN
         1 003601   003615 702000 1                  TSX2    ALTRT

     1165    10813    2         CALL KQM$GETDFR (CG$->KQ$CG,,ERR) ALTRET(ALTRT);

  10813  1 003602   200121 630500                    EPPR0   ERR,,AUTO
         1 003603   200134 450500                    STP0    @TKEY+5,,AUTO
         1 003604   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003605   200006 235100                    LDA     CG$,,AUTO
         1 003606   200132 757100                    STAQ    @TKEY+3,,AUTO
         1 003607   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003610   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003611   000000 701000 xent               TSX1    KQM$GETDFR
         1 003612   003615 702000 1                  TSX2    ALTRT

     1166    10814    2         RETURN;

  10814  1 003613   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003614   000001 702211                    TSX2  ! 1,X1

  10811  1 003615                       ALTRT        null
     1167    10815    2   ALTRT:;
     1168    10816    2         ALTRETURN;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:161  
  10816  1 003615   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003616   000000 702211                    TSX2  ! 0,X1

     1169    10817    2   END CXTSET;
     1170    10818        /****************************************************************
     1171    10819        *****************************************************************/
     1172    10820        /*D* NAME:         SETPRIO
     1173    10821             PURPOSE:      To set the prio of a Q node
     1174    10822        */
     1175    10823    1   SETPRIO: PROC (QTN$);

  10823  1 003617   200124 741300       SETPRIO      STX1  ! I+1,,AUTO

     1176    10824        /**/
     1177    10825    2   DCL QTN$ PTR;
     1178    10826        /**/
     1179    10827    2         QTN$->KQ$QTN.MPRIO=PRIO;

  10827  1 003620   200125 470500                    LDP0    @QTN$,,AUTO
         1 003621   000000 471500                    LDP1    0,,PR0
         1 003622   200022 236100                    LDQ     PRIO,,AUTO
         1 003623   000022 736000                    QLS     18
         1 003624   100050 552120                    STBQ    40,'20'O,PR1

     1180    10828    2         CALL KQT$MOVQTN (CG$->KQ$CG,QTN$);

  10828  1 003625   200125 236100                    LDQ     @QTN$,,AUTO
         1 003626   200006 235100                    LDA     CG$,,AUTO
         1 003627   200132 757100                    STAQ    @TKEY+3,,AUTO
         1 003630   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003631   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003632   000000 701000 xent               TSX1    KQT$MOVQTN
         1 003633   000000 011000                    NOP     0

     1181    10829    2         RETURN;

  10829  1 003634   200124 221300                    LDX1  ! I+1,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:162  
         1 003635   000001 702211                    TSX2  ! 1,X1

     1182    10830    2   END SETPRIO;
     1183    10831        /****************************************************************
     1184    10832        *****************************************************************/
     1185    10833        /*D* NAME:         SETMXACT
     1186    10834             PURPOSE:      To adjust MXACT in a Q-tree node
     1187    10835             DESCRIPTION:  Entered with Q-tree locked - returns same but
     1188    10836                           may have unlocked it.
     1189    10837        */
     1190    10838    1   SETMXACT: PROC (QTN$,QX);

  10838  1 003636   200120 741300       SETMXACT     STX1  ! JNAME+3,,AUTO

     1191    10839        /**/
     1192    10840    2   DCL QTN$ PTR;
     1193    10841    2   DCL QX UBIN WORD;
     1194    10842    2   DCL I SBIN WORD ALIGNED;
     1195    10843        /**/
     1196    10844    2         I=QTN$->KQ$QTN.MXACT;

  10844  1 003637   200121 470500                    LDP0    @QTN$,,AUTO
         1 003640   000000 471500                    LDP1    0,,PR0
         1 003641   100045 235100                    LDA     37,,PR1
         1 003642   200123 755100                    STA     I,,AUTO

     1197    10845    2         IF QLIST ~= 0 THEN

  10845  1 003643   200106 236100                    LDQ     QLIST,,AUTO
         1 003644   003653 600000 1                  TZE     s:10847

     1198    10846    2          QTN$->KQ$QTN.MXACT=VLP$CGQL.LIST.MXACT(QX);

  10846  1 003645   200122 473500                    LDP3    @QX,,AUTO
         1 003646   300000 236100                    LDQ     0,,PR3
         1 003647   000011 402007                    MPY     9,DL
         1 003650   000000 474400 xsym               LDP4    B$PS5$
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:163  
         1 003651   400000 235106                    LDA     0,QL,PR4
         1 003652   100045 755100                    STA     37,,PR1

     1199    10847    2         IF I >= QTN$->KQ$QTN.MXACT

  10847  1 003653   000000 471500                    LDP1    0,,PR0
         1 003654   200123 236100                    LDQ     I,,AUTO
         1 003655   100045 116100                    CMPQ    37,,PR1
         1 003656   003662 605000 1                  TPL     s:10848
         1 003657   100044 236100                    LDQ     36,,PR1
         1 003660   100045 116100                    CMPQ    37,,PR1
         1 003661   003664 604000 1                  TMI     s:10849

     1200    10848    2         OR QTN$->KQ$QTN.CNACT >= QTN$->KQ$QTN.MXACT THEN RETURN;

  10848  1 003662   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003663   000001 702211                    TSX2  ! 1,X1

     1201    10849    2         CALL KQQ$ACT (CG$->KQ$CG,QTN$);

  10849  1 003664   200121 236100                    LDQ     @QTN$,,AUTO
         1 003665   200006 235100                    LDA     CG$,,AUTO
         1 003666   200132 757100                    STAQ    @TKEY+3,,AUTO
         1 003667   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003670   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003671   000000 701000 xent               TSX1    KQQ$ACT
         1 003672   000000 011000                    NOP     0

     1202    10850              %LOCK (G=KQ$QTREE.GATE);

  10851  1 003673   200006 470500                    LDP0    CG$,,AUTO
         1 003674   000057 471500                    LDP1    47,,PR0
         1 003675   200132 451500                    STP1    @TKEY+3,,AUTO
         1 003676   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003677   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003700   000000 701000 xent               TSX1    HFC$LOCK
         1 003701   000000 011000                    NOP     0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:164  

     1203    10853    2         RETURN;

  10853  1 003702   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003703   000001 702211                    TSX2  ! 1,X1

     1204    10854    2   END SETMXACT;
     1205    10855        /****************************************************************
     1206    10856        *****************************************************************/
     1207    10857        /*D* NAME:         RELJF
     1208    10858             PURPOSE:      To delete the journal FID
     1209    10859             DESCRIPTION:  The journal FID area of memory is released,
     1210    10860                           and KQ$CG.JRNLFID$ is set to NIL.  If necessary,
     1211    10861                           the JOURNAL GHOST is told that the FID has changed.
     1212    10862
     1213    10863                           ALTRETs with JIT.ERR set if anything goes wrong.
     1214    10864        */
     1215    10865    1   RELJF: PROC ALTRET;

  10865  1 003704   200120 741300       RELJF        STX1  ! JNAME+3,,AUTO

     1216    10866        /**/
     1217    10867        %VLP_JRNLFIDV (FPTN=KQ$JFID,STCLASS="BASED DALIGNED");
     1218    10874    2   DCL K UBIN;
     1219    10875    2   DCL J$ PTR;
     1220    10876        /**/
     1221    10877    2         IF CG$->KQ$CG.JRNLFID$ = ADDR(NIL) THEN RETURN;

  10877  1 003705   200006 470500                    LDP0    CG$,,AUTO
         1 003706   000223 236100                    LDQ     147,,PR0
         1 003707   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003710   003712 601000 1                  TNZ     s:10878

  10877  1 003711   000001 702211                    TSX2  ! 1,X1

     1222    10878    2         P$=CG$->KQ$CG.JRNLFID$;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:165  
  10878  1 003712   200102 756100                    STQ     P$,,AUTO

     1223    10879              %LOCK (G=CG$->KQ$CG.GATE.MISC);

  10880  1 003713   200006 236100                    LDQ     CG$,,AUTO
         1 003714   000111 036003                    ADLQ    73,DU
         1 003715   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003716   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003717   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003720   000000 701000 xent               TSX1    HFC$LOCK
         1 003721   000000 011000                    NOP     0

     1224    10882    2         CG$->KQ$CG.JRNLFID$=ADDR(NIL);

  10882  1 003722   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003723   200006 470500                    LDP0    CG$,,AUTO
         1 003724   000223 756100                    STQ     147,,PR0

     1225    10883    2         CALL RELIT;

  10883  1 003725   004032 701000 1                  TSX1    RELIT
         1 003726   000000 011000                    NOP     0

     1226    10884              %UNLOCK (G=CG$->KQ$CG.GATE.MISC);

  10885  1 003727   200006 236100                    LDQ     CG$,,AUTO
         1 003730   000111 036003                    ADLQ    73,DU
         1 003731   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003732   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003733   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003734   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003735   000000 011000                    NOP     0

     1227    10887    2         CALL KQC$TELLJ (CG$->KQ$CG.CFU$) ALTRET(ALTRT);

  10887  1 003736   200006 236100                    LDQ     CG$,,AUTO
         1 003737   000214 036003                    ADLQ    140,DU
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:166  
         1 003740   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003741   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003742   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003743   000000 701000 xent               TSX1    KQC$TELLJ
         1 003744   004030 702000 1                  TSX2    ALTRT

     1228    10888    2         RETURN;

  10888  1 003745   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 003746   000001 702211                    TSX2  ! 1,X1

     1229    10889        /**/
     1230    10890        /*D* NAME:         GETJF
     1231    10891             PURPOSE:      To set a new journal FID
     1232    10892             DESCRIPTION:  The JRNLFID parameter in the paremeter stack
     1233    10893                           is to become the new journal FID for the comgroup.
     1234    10894                           If there is a current one and it's the same,
     1235    10895                           just return.  Else release the old one and allocate
     1236    10896                           space for a new one, filling it with the passed
     1237    10897                           param.  If the JOURNAL GHOST needs to be told,
     1238    10898                           then JFLG gets set.
     1239    10899
     1240    10900                           ALRETs with JIT.ERR set if anything goes wrong.
     1241    10901        */
     1242    10902    2   GETJF: ENTRY ALTRET;

  10902  1 003747   200120 741300       GETJF        STX1  ! JNAME+3,,AUTO

     1243    10903        /**/
     1244    10904    2         P$=CG$->KQ$CG.JRNLFID$;

  10904  1 003750   200006 470500                    LDP0    CG$,,AUTO
         1 003751   000223 236100                    LDQ     147,,PR0
         1 003752   200102 756100                    STQ     P$,,AUTO

     1245    10905    2         IF P$ ~= ADDR(NIL) THEN

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:167  
  10905  1 003753   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003754   004017 600000 1                  TZE     s:10921

     1246    10906    3           DO;

     1247    10907    3           IF P$->KQ$JFID.JRNLFID# = B$PS10$->VLP$JRNLFIDV.JRNLFID# THEN

  10907  1 003755   200102 471500                    LDP1    P$,,AUTO
         1 003756   100000 220100                    LDX0    0,,PR1
         1 003757   000000 473400 xsym               LDP3    B$PS10$
         1 003760   000100 100500                    MLR     fill='000'O
         1 003761   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2
         1 003762   200132 000004                    ADSC9   @TKEY+3,,AUTO            cn=0,n=4
         1 003763   200132 222100                    LDX2    @TKEY+3,,AUTO
         1 003764   040140 106540                    CMPC    fill='040'O
         1 003765   100000 400010                    ADSC9   0,,PR1                   cn=2,n=*X0
         1 003766   300000 400012                    ADSC9   0,,PR3                   cn=2,n=*X2
         1 003767   003771 601000 1                  TNZ     s:10909

     1248    10908    3            RETURN;

  10908  1 003770   000001 702211                    TSX2  ! 1,X1

     1249    10909    3           CALL GETIT ALTRET(ALTRT);

  10909  1 003771   004060 701000 1                  TSX1    GETIT
         1 003772   004030 702000 1                  TSX2    ALTRT

     1250    10910                %LOCK (G=CG$->KQ$CG.GATE.MISC);

  10911  1 003773   200006 236100                    LDQ     CG$,,AUTO
         1 003774   000111 036003                    ADLQ    73,DU
         1 003775   200132 756100                    STQ     @TKEY+3,,AUTO
         1 003776   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 003777   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004000   000000 701000 xent               TSX1    HFC$LOCK
         1 004001   000000 011000                    NOP     0
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:168  

     1251    10913    3           CG$->KQ$CG.JRNLFID$=J$;

  10913  1 004002   200122 236100                    LDQ     J$,,AUTO
         1 004003   200006 470500                    LDP0    CG$,,AUTO
         1 004004   000223 756100                    STQ     147,,PR0

     1252    10914    3           CALL RELIT;

  10914  1 004005   004032 701000 1                  TSX1    RELIT
         1 004006   000000 011000                    NOP     0

     1253    10915                %UNLOCK (G=CG$->KQ$CG.GATE.MISC);

  10916  1 004007   200006 236100                    LDQ     CG$,,AUTO
         1 004010   000111 036003                    ADLQ    73,DU
         1 004011   200132 756100                    STQ     @TKEY+3,,AUTO
         1 004012   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 004013   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004014   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004015   000000 011000                    NOP     0

     1254    10918    3           END;

  10918  1 004016   004024 710000 1                  TRA     s:10924

     1255    10919    2         ELSE
     1256    10920    3           DO;

     1257    10921    3           CALL GETIT ALTRET(ALTRT);

  10921  1 004017   004060 701000 1                  TSX1    GETIT
         1 004020   004030 702000 1                  TSX2    ALTRT

     1258    10922    3           CG$->KQ$CG.JRNLFID$=J$;

  10922  1 004021   200122 236100                    LDQ     J$,,AUTO
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:169  
         1 004022   200006 470500                    LDP0    CG$,,AUTO
         1 004023   000223 756100                    STQ     147,,PR0

     1259    10923    3           END;

     1260    10924    2         JFLG=1;

  10924  1 004024   000001 235007                    LDA     1,DL
         1 004025   200104 755100                    STA     JFLG,,AUTO

     1261    10925    2         RETURN;

  10925  1 004026   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 004027   000001 702211                    TSX2  ! 1,X1

  10924  1 004030                       ALTRT        null
     1262    10926    2   ALTRT:;
     1263    10927    2         ALTRETURN;

  10927  1 004030   200120 221300                    LDX1  ! JNAME+3,,AUTO
         1 004031   000000 702211                    TSX2  ! 0,X1

     1264    10928        /**/
     1265    10929    2   RELIT: PROC;

  10929  1 004032   200124 741300       RELIT        STX1  ! I+1,,AUTO

     1266    10930        /**/
     1267    10931    3         K=SIZEW(P$->KQ$JFID);

  10931  1 004033   200102 470500                    LDP0    P$,,AUTO
         1 004034   000000 220100                    LDX0    0,,PR0
         1 004035   000002 622010                    EAX2    2,X0
         1 004036   000000 636012                    EAQ     0,X2
         1 004037   000022 772000                    QRL     18
         1 004040   000011 402007                    MPY     9,DL
         1 004041   000043 036007                    ADLQ    35,DL
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:170  
         1 004042   000044 506007                    DIV     36,DL
         1 004043   200121 756100                    STQ     K,,AUTO

     1268    10932    3         CALL KQM$RELB (CG$->KQ$CG,P$,K);

  10932  1 004044   200121 631500                    EPPR1   K,,AUTO
         1 004045   200134 451500                    STP1    @TKEY+5,,AUTO
         1 004046   200102 633500                    EPPR3   P$,,AUTO
         1 004047   200133 453500                    STP3    @TKEY+4,,AUTO
         1 004050   200006 236100                    LDQ     CG$,,AUTO
         1 004051   200132 756100                    STQ     @TKEY+3,,AUTO
         1 004052   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 004053   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004054   000000 701000 xent               TSX1    KQM$RELB
         1 004055   000000 011000                    NOP     0

     1269    10933    3         RETURN;

  10933  1 004056   200124 221300                    LDX1  ! I+1,,AUTO
         1 004057   000001 702211                    TSX2  ! 1,X1

     1270    10934    3   END RELIT;
     1271    10935        /**/
     1272    10936    2   GETIT: PROC ALTRET;

  10936  1 004060   200124 741300       GETIT        STX1  ! I+1,,AUTO

     1273    10937        /**/
     1274    10938    3         I=SIZEC(B$PS10$->VLP$JRNLFIDV);

  10938  1 004061   000000 470400 xsym               LDP0    B$PS10$
         1 004062   000100 100500                    MLR     fill='000'O
         1 004063   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         1 004064   200132 000004                    ADSC9   @TKEY+3,,AUTO            cn=0,n=4
         1 004065   200132 220100                    LDX0    @TKEY+3,,AUTO
         1 004066   000002 622010                    EAX2    2,X0
         1 004067   000000 635012                    EAA     0,X2
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:171  
         1 004070   000022 771000                    ARL     18
         1 004071   200113 755100                    STA     I,,AUTO

     1275    10939    3         K=(((I+7)/8)*8)/4;  /* Round up to doubleword */

  10939  1 004072   200113 236100                    LDQ     I,,AUTO
         1 004073   000007 036007                    ADLQ    7,DL
         1 004074   000003 772000                    QRL     3
         1 004075   000001 736000                    QLS     1
         1 004076   200121 756100                    STQ     K,,AUTO

     1276    10940    3         CALL KQM$GETB (CG$->KQ$CG,J$,K) ALTRET(NONE);

  10940  1 004077   200121 631500                    EPPR1   K,,AUTO
         1 004100   200134 451500                    STP1    @TKEY+5,,AUTO
         1 004101   200122 633500                    EPPR3   J$,,AUTO
         1 004102   200133 453500                    STP3    @TKEY+4,,AUTO
         1 004103   200006 236100                    LDQ     CG$,,AUTO
         1 004104   200132 756100                    STQ     @TKEY+3,,AUTO
         1 004105   200132 630500                    EPPR0   @TKEY+3,,AUTO
         1 004106   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004107   000000 701000 xent               TSX1    KQM$GETB
         1 004110   004121 702000 1                  TSX2    NONE

     1277    10941    3         J$->B$$CHARS=B$PS10$->B$$CHARS;

  10941  1 004111   000000 470400 xsym               LDP0    B$PS10$
         1 004112   200113 720100                    LXL0    I,,AUTO
         1 004113   200122 471500                    LDP1    J$,,AUTO
         1 004114   040140 100540                    MLR     fill='040'O
         1 004115   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 004116   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     1278    10942    3         RETURN;

  10942  1 004117   200124 221300                    LDX1  ! I+1,,AUTO
         1 004120   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:172  

  10941  1 004121                       NONE         null
     1279    10943    3   NONE: ;
     1280    10944    3         CALL SETNOMEM;

  10944  1 004121   003130 701000 1                  TSX1    SETNOMEM
         1 004122   000000 011000                    NOP     0

     1281    10945    3         ALTRETURN;

  10945  1 004123   200124 221300                    LDX1  ! I+1,,AUTO
         1 004124   000000 702211                    TSX2  ! 0,X1

E_BCGPRI
 Sect OctLoc
   0     000   132103 021664                                                    ZC..

E_NOMEM
 Sect OctLoc
   0     001   132103 015444                                                    ZC..

E_CGTTRP
 Sect OctLoc
   0     002   132103 021774                                                    ZC..

E_CGSTRP
 Sect OctLoc
   0     003   132103 022004                                                    ZC..

E_CGIQLS
 Sect OctLoc
   0     004   132103 021764                                                    ZC..

E_CGCDXT
 Sect OctLoc
   0     005   132103 021704                                                    ZC..

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:173  
E_CGCDDT
 Sect OctLoc
   0     006   132103 021674                                                    ZC..

E_CGCDCS
 Sect OctLoc
   0     007   132103 021734                                                    ZC..

E_CGUAFC
 Sect OctLoc
   0     010   132103 021714                                                    ZC..

E_CGAFNT
 Sect OctLoc
   0     011   132103 022014                                                    ZC..

E_CGAFNS
 Sect OctLoc
   0     012   132103 022024                                                    ZC..

E_CGCDAN
 Sect OctLoc
   0     013   132103 021724                                                    ZC..

E_CGMSDT
 Sect OctLoc
   0     014   132103 021634                                                    ZC..

E_CGMPEN
 Sect OctLoc
   0     015   132103 022044                                                    ZC.$

E_TYPCHR
 Sect OctLoc
   0     016   132103 015374                                                    ZC..

E_STACHR
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:174  
 Sect OctLoc
   0     017   132103 015364                                                    ZC..

E_BDJFID
 Sect OctLoc
   0     020   132103 022474                                                    ZC..

CCGID
 Sect OctLoc
   0     021   072123 131123   040040 040040   040040 040040   040040 000000    :SYS          ..
   0     025   001040 040040   040040 040040   040040 040040   040040 040040    .
   0     031   040040 040040   040040 040040   040040 040040   040040 040040

(unnamed)
 Sect OctLoc
   0     035   072123 131123   103123 103107   117103 103107   110114 120103    :SYSCSCGOCCGHLPC
   0     041   107040 040040   052101 125105   126040 040040                    G   *AUEV

(unnamed)
 Sect OctLoc
   2     000   000007 006000   000000 006000   000000 006000   000000 006000    ................
   2     004   000005 006000   777777 777767   775777 777777   773777 777777    ................
   2     010   000003 006000   777677 777777   000004 006000   776777 777777    ................
   2     014   000006 006000   777737 777777   000000 000031   000016 006000    ................
   2     020   757777 777777   052040 040040   040040 040040   040040 040040    ....*
   2     024   777777 577777   000000 000014   000025 006000   000002 006000    ................
   2     030   000010 006000                                                    ....
     1282    10946    3   END GETIT;
     1283    10947    2   END RELJF;
     1284    10948    1   END KQC$CGCTL;
     1285    10949        %EOD;

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:175  
--  Include file information  --

   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQC$CGCTL.
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:176  

 **** Variables and constants ****

  ****  Section 000 RoData KQC$CGCTL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    21-0-0/w STRC(432)   r     1 CCGID                      0-0-0/w STRC        r     1 E_BCGPRI
    20-0-0/w STRC        r     1 E_BDJFID                  12-0-0/w STRC        r     1 E_CGAFNS
    11-0-0/w STRC        r     1 E_CGAFNT                  13-0-0/w STRC        r     1 E_CGCDAN
     7-0-0/w STRC        r     1 E_CGCDCS                   6-0-0/w STRC        r     1 E_CGCDDT
     5-0-0/w STRC        r     1 E_CGCDXT                   4-0-0/w STRC        r     1 E_CGIQLS
    15-0-0/w STRC        r     1 E_CGMPEN                  14-0-0/w STRC        r     1 E_CGMSDT
     3-0-0/w STRC        r     1 E_CGSTRP                   2-0-0/w STRC        r     1 E_CGTTRP
    10-0-0/w STRC        r     1 E_CGUAFC                   1-0-0/w STRC        r     1 E_NOMEM
    17-0-0/w STRC        r     1 E_STACHR                  16-0-0/w STRC        r     1 E_TYPCHR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PARM                      3-0-0/w PTR         r     1 @PARM$
   121-0-0/w PTR         r     1 @PS$                     125-0-0/w PTR         r     1 @QTN$
   121-0-0/w PTR         r     1 @QTN$                    122-0-0/w PTR         r     1 @QX
   122-0-0/w PTR         r     1 @STAPTR$                 127-0-0/w PTR         r     1 @TKEY
    66-0-0/w STRC(432)   r     1 ACGID                      6-0-0/w PTR         r     1 CG$
    26-0-0/d STRC(720)   r     1 CGCP                     110-0-0/w PTR         r     1 DCB$
   111-0-0/w UBIN        r     1 DFCHK                     17-0-0/w SBIN        r     1 DSIZ
   121-0-0/w UBIN        r     1 ERR                      112-0-0/w PTR         r     1 FLINK$
   113-0-0/w UBIN        r     1 I                        122-0-0/w UBIN        r     1 I
   123-0-0/w SBIN        r     1 I                        123-0-0/w UBIN        r     1 J
   122-0-0/w PTR         r     1 J$                       104-0-0/w UBIN        r     1 JFLG
   115-0-0/c CHAR(8)     r     1 JNAME                    121-0-0/w UBIN        r     1 K
    10-0-0/w CHAR(8)     r     1 KEY                       15-0-0/w PTR         r     1 MTYP$
    14-0-0/w PTR         r     1 MYSTA$                   107-0-0/w SBIN        r     1 NQ
    24-0-0/w SBIN        r     1 NSTA                      20-0-0/w SBIN        r     1 NTYP
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:177  
   102-0-0/w PTR         r     1 P$                        *0-0-0/w UBIN        r     1 PARM
    *0-0-0/w PTR         r     1 PARM$                     22-0-0/w UBIN        r     1 PRIO
    *0-0-0/w PTR         r     1 PS$                      106-0-0/w UBIN        r     1 QLIST
    16-0-0/w PTR         r     1 QTN$                      *0-0-0/w PTR         r     1 QTN$
    *0-0-0/w PTR         r     1 QTN$                      *0-0-0/w UBIN        r     1 QX
   103-0-0/w PTR         r     1 RBLK$                     52-0-0/w STRC(432)   r     1 SETSTA
    13-0-0/w PTR         r     1 STA$                      *0-0-0/w PTR         r     1 STAPTR$
    23-0-0/w SBIN        r     1 STAX                      *0-0-0/c CHAR(8)     r     1 TKEY
   114-0-0/w UBIN        r     1 TOKFLG                    21-0-0/w SBIN        r     1 TYPX

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$PS10$
     0-0-0/w PTR         r     1 B$PS2$                     0-0-0/w PTR         r     1 B$PS3$
     0-0-0/w PTR         r     1 B$PS4$                     0-0-0/w PTR         r     1 B$PS5$
     0-0-0/w PTR         r     1 B$PS7$                     0-0-0/w PTR         r     1 B$PS8$
     0-0-0/w PTR         r     1 B$PS9$                     0-0-0/c CHAR(68)    r     1 KC_LGL1ST

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 B$$CHARS                   0-0-0/d STRC(7560)  r     1 B$JIT
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/d STRC(396)   r     1 FPT$CGCTL
     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d ASTR(18)    r     1 KQ$JFID
     0-0-0/d STRC(360)   r     1 KQ$MTYP                    0-0-0/d STRC(1908)  r     1 KQ$QTN
     0-0-0/d STRC(1296)  r     1 KQ$STA                     0-0-0/w STRC(216)   r     1 KQ$THDR
     0-0-0/d STRC(720)   r     1 VLP$CGCP                   0-0-0/d STRC(324)   r     1 VLP$CGQL
     0-0-0/d STRC(324)   r     1 VLP$CGSTAL                 0-0-0/d STRC(288)   r     1 VLP$CGTYPL
     0-0-0/c ASTR(18)    r     1 VLP$JRNLFIDV               0-0-0/w STRC(432)   r     1 VLP$SETSTA
     0-0-0/w STRC(288)   r     1 VLP$STATION                0-0-0/w ASTR(9)     r     1 VTXTC

PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:178  

   Procedure KQC$CGCTL requires 2133 words for executable code.
   Procedure KQC$CGCTL requires 96 words of local(AUTO) storage.
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:179  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:180  
          MINI XREF LISTING

ACGID
      9514**DCL     10757<<ASSIGN  10763<>CALL    10763--CALL
ACGID.ACCT#
      9518**DCL     10758<<ASSIGN
ACGID.NAME#.CNT
      9522**DCL     10760<<ASSIGN
ACGID.NAME#.TXT
      9523**DCL     10761<<ASSIGN
ACGID.PSN#
      9519**DCL     10759<<ASSIGN
ADDSTA0
     10211**LABEL   10215--GOTO
ADDTYP0
     10007**LABEL   10011--GOTO
ALTRT
     10160**LABEL   10409--CALLALT 10410--CALLALT
ALTRT IN PROCEDURE CXTSET
     10811**LABEL   10812--CALLALT 10813--CALLALT
ALTRT IN PROCEDURE RELJF
     10924**LABEL   10887--CALLALT 10909--CALLALT 10921--CALLALT
B$$CHARS
      9340**DCL     10941<<ASSIGN  10941>>ASSIGN
B$JIT.DCB$
      9440**DCL      9960>>ASSIGN  10756>>ASSIGN
B$JIT.ERR
      9350**DCL      9860<<ASSIGN   9924<<ASSIGN   9989<<ASSIGN  10053<<ASSIGN  10094<<ASSIGN  10142<<ASSIGN
     10153<<ASSIGN  10160<<ASSIGN  10179<<ASSIGN  10337<<ASSIGN  10354<<ASSIGN  10489<<ASSIGN  10537<<ASSIGN
     10588<<ASSIGN  10622<<ASSIGN  10639<<ASSIGN  10643<<ASSIGN  10732<<ASSIGN
B$JIT.ERR.MID
      9351**DCL      9351--REDEF
B$JIT$
      9719**DCL      9345--IMP-PTR  9860>>ASSIGN   9924>>ASSIGN   9960>>ASSIGN   9989>>ASSIGN  10053>>ASSIGN
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:181  
     10094>>ASSIGN  10142>>ASSIGN  10153>>ASSIGN  10160>>ASSIGN  10179>>ASSIGN  10337>>ASSIGN  10354>>ASSIGN
     10489>>ASSIGN  10537>>ASSIGN  10588>>ASSIGN  10622>>ASSIGN  10639>>ASSIGN  10643>>ASSIGN  10732>>ASSIGN
     10756>>ASSIGN
B$PS0$
      9708**DCL      9267--IMP-PTR  9997>>DOCASE  10049>>IF      10118>>IF      10120>>IF      10122>>IF
     10124>>IF      10126>>IF      10133>>IF      10201>>DOCASE  10255>>IF      10301>>IF      10303>>IF
     10308>>IF      10321>>IF
B$PS1$
      9709**DCL      9271--IMP-PTR 10021>>ASSIGN  10032>>ASSIGN  10033>>ASSIGN  10034>>ASSIGN  10035>>ASSIGN
     10036>>ASSIGN  10089>>ASSIGN  10116>>ASSIGN  10119>>ASSIGN  10121>>ASSIGN  10123>>ASSIGN  10125>>ASSIGN
     10128>>ASSIGN
B$PS10$
      9718**DCL      9847<>CALL     9853<>CALL     9868<>CALL     9869>>IF       9869>>IF      10907>>IF
     10907>>IF      10938>>ASSIGN  10938>>ASSIGN  10941>>ASSIGN
B$PS2$
      9710**DCL      9276--IMP-PTR 10225>>ASSIGN  10237>>ASSIGN  10238>>ASSIGN  10239>>ASSIGN  10280>>ASSIGN
     10296>>ASSIGN  10302>>ASSIGN  10304>>ASSIGN  10310>>ASSIGN
B$PS3$
      9711**DCL      9281--IMP-PTR  9883>>ASSIGN   9885>>ASSIGN   9887>>ASSIGN
B$PS4$
      9712**DCL      9300--IMP-PTR 10371>>ASSIGN
B$PS5$
      9713**DCL      9311--IMP-PTR 10042>>ASSIGN  10248>>ASSIGN  10846>>ASSIGN
B$PS7$
      9715**DCL      9316--IMP-PTR
B$PS8$
      9716**DCL      9831<>CALL
B$PS9$
      9717**DCL      9835<>CALL
BADOPT
     10140**LABEL   10329--GOTO
BADSTACHR
     10329**LABEL   10229--CALLALT
BADSTACHR IN PROCEDURE SPCLSTA
     10727**LABEL   10680--CALLALT
BADTYP IN PROCEDURE CHKTYP
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:182  
     10634**LABEL   10633--CALLALT
BADTYPCHR
     10142**LABEL   10025--CALLALT
BDJFID
      9859**LABEL    9868--CALLALT  9869--GOTO
CCGID
      9660**DCL     10757>>ASSIGN
CDAN IN PROCEDURE DELTYP
     10488**LABEL   10545--GOTO
CG$
      9453**DCL      7432--IMP-PTR  9816<<ASSIGN   9831>>CALL     9832>>IF       9833>>ASSIGN   9835>>CALL
      9836>>IF       9837>>IF       9912>>IF       9913>>IF       9917>>CALL     9919>>IF       9922>>CALL
      9937>>ASSIGN   9938>>ASSIGN   9938>>ASSIGN   9940>>IF       9943>>CALL     9945>>ASSIGN   9946>>ASSIGN
      9948>>CALL     9951>>ASSIGN   9952>>ASSIGN   9954>>CALL     9958>>IF       9959>>CALL     9984>>IF
     10005>>ASSIGN  10022>>CALL    10027>>CALL    10029>>IF      10030>>IF      10039>>IF      10065>>IF
     10068>>ASSIGN  10090>>CALL    10091>>IF      10091>>IF      10117>>CALL    10131>>IF      10133>>IF
     10168>>CALL    10198>>IF      10209>>ASSIGN  10226>>CALL    10231>>CALL    10245>>IF      10256>>IF
     10259>>ASSIGN  10281>>CALL    10297>>CALL    10319>>IF      10321>>IF      10373>>CALL    10375>>ASSIGN
     10377>>CALL    10381>>CALL    10382>>CALL    10394<<ASSIGN  10408<<ASSIGN  10409>>CALL    10410>>CALL
     10427<<ASSIGN  10428>>IF      10451>>CALL    10456>>CALL    10461>>CALL    10466>>CALL    10479>>IF
     10485>>IF      10499>>IF      10510>>CALL    10511>>CALL    10512>>IF      10523>>IF      10540>>IF
     10544>>IF      10564>>IF      10565>>CALL    10566>>CALL    10570>>CALL    10571>>IF      10614>>CALL
     10619>>IF      10635>>CALL    10682>>CALL    10701>>IF      10787>>ASSIGN  10789>>ASSIGN  10791>>IF
     10791>>ASSIGN  10792>>ASSIGN  10793>>ASSIGN  10793>>ASSIGN  10794>>ASSIGN  10796>>IF      10796>>ASSIGN
     10797>>ASSIGN  10798>>ASSIGN  10798>>ASSIGN  10799>>IF      10801>>ASSIGN  10801>>ASSIGN  10802>>ASSIGN
     10802>>ASSIGN  10803>>ASSIGN  10803>>ASSIGN  10807>>ASSIGN  10807>>ASSIGN  10808>>ASSIGN  10808>>ASSIGN
     10809>>ASSIGN  10809>>ASSIGN  10811>>ASSIGN  10811>>ASSIGN  10812>>CALL    10813>>CALL    10828>>CALL
     10849>>CALL    10851>>CALL    10877>>IF      10878>>ASSIGN  10880>>CALL    10882>>ASSIGN  10885>>CALL
     10887>>CALL    10904>>ASSIGN  10911>>CALL    10913>>ASSIGN  10916>>CALL    10922>>ASSIGN  10932>>CALL
     10940>>CALL
CGCP
      9470**DCL      9887<<ASSIGN   9952>>ASSIGN
CGCP.CONMSG
      9475**DCL      9904>>IF
CGCP.DCBCONWA
      9481**DCL      9907<<ASSIGN
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:183  
CGCP.DEFERBLKS
      9479**DCL      9890>>IF       9890<<ASSIGN   9891>>IF       9891<<ASSIGN
CGCP.DISKWARN
      9484**DCL      9933>>IF       9934>>ASSIGN   9937>>ASSIGN   9939>>IF       9940>>IF
CGCP.DMTYP
      9474**DCL      9888<>CALL
CGCP.DSCREQ
      9481**DCL      9906<<ASSIGN
CGCP.DVBYTE.REREAD
      9478**DCL      9479--REDEF
CGCP.JOURNAL
      9482**DCL      9912>>IF
CGCP.MAXMC
      9478**DCL      9909>>IF       9910<<ASSIGN   9911>>IF       9911>>ASSIGN
CGCP.MAXPG
      9475**DCL      9896>>IF       9896<<ASSIGN   9897>>IF       9897<<ASSIGN   9919>>IF       9937>>ASSIGN
      9940>>IF
CGCP.MAXRD
      9484**DCL      9893>>IF       9893<<ASSIGN   9894>>IF       9894<<ASSIGN
CGCP.MINPG
      9474**DCL      9895>>IF       9895<<ASSIGN   9897>>IF       9897>>ASSIGN
CGCP.MINRD
      9484**DCL      9892>>IF       9892<<ASSIGN   9894>>IF       9894>>ASSIGN
CGCP.REDISKWARN
      9485**DCL      9933>>IF       9934<<ASSIGN
CGCP.SECURE
      9483**DCL      9898>>IF
CGCP.SMD
      9477**DCL      9901<<ASSIGN   9903>>IF
CGCP.TERMCONLGL
      9483**DCL      9913>>IF
CGCP.TMTYP
      9474**DCL      9889<>CALL
CGCP.TRMRDSIZ
      9483**DCL      9911>>IF       9911>>IF       9911<<ASSIGN
CGCP.WAS
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:184  
      9477**DCL      9900<<ASSIGN   9903<<ASSIGN
CHKJF
      9847**LABEL    9848--GOTO
CHKPRI
     10584**PROC     9884--CALL     9886--CALL    10037--CALL    10129--CALL    10240--CALL    10311--CALL
CHKTYP
     10609**PROC     9888--CALL     9889--CALL    10409--CALL    10410--CALL
CXTSET
     10781**PROC     9957--CALL    10395--CALL
DCB$
      9531**DCL      9960<<ASSIGN   9961>>IF       9963>>IF       9963>>IF       9964>>IF       9964>>IF
      9965>>IF       9965>>IF      10756<<ASSIGN  10758>>ASSIGN  10759>>ASSIGN  10760>>ASSIGN  10761>>ASSIGN
     10761>>ASSIGN
DELSTA IN PROCEDURE DELTYP
     10522**ENTRY   10265--CALL    10283--CALL
DELTYP
     10478**PROC    10073--CALL    10103--CALL
DFCHK
      9532**DCL     10004<<ASSIGN  10029<<ASSIGN  10029>>ASSIGN  10030<<ASSIGN  10030>>ASSIGN  10051>>IF
     10208<<ASSIGN
DSIZ
      9462**DCL      9818<>CALL     9819>>ASSIGN   9981<>CALL     9982>>ASSIGN  10195<>CALL    10196>>ASSIGN
ELA$SYSLOG
      9677**DCL-ENT 10763--CALL
ELFWT IN PROCEDURE TRMGO
     10761**LABEL   10763--CALLALT
ERASEIT IN PROCEDURE SPCLSTA
     10707**LABEL   10675--CALLALT
ERR IN PROCEDURE CXTSET
     10783**DCL     10812<>CALL    10813<>CALL
ERROR
     10160**LABEL    9831--CALLALT  9835--CALLALT  9850--CALLALT  9866--GOTO     9870--CALLALT  9884--CALLALT
      9886--CALLALT  9888--CALLALT  9889--CALLALT  9931--GOTO     9957--CALLALT  9995--GOTO    10063--GOTO
     10073--CALLALT 10101--GOTO    10103--CALLALT 10147--GOTO    10174--GOTO    10184--GOTO    10265--CALLALT
     10283--CALLALT 10344--GOTO    10359--GOTO    10381--CALLALT
E_BCGPRI
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:185  
      9544**DCL     10588>>ASSIGN
E_BDJFID
      9640**DCL      9860>>ASSIGN
E_CGAFNS
      9604**DCL     10337>>ASSIGN
E_CGAFNT
      9598**DCL     10160>>ASSIGN
E_CGCDAN
      9610**DCL     10489>>ASSIGN
E_CGCDCS
      9586**DCL     10537>>ASSIGN
E_CGCDDT
      9580**DCL     10094>>ASSIGN
E_CGCDXT
      9574**DCL     10622>>ASSIGN
E_CGIQLS
      9568**DCL      9989>>ASSIGN
E_CGMPEN
      9622**DCL      9924>>ASSIGN
E_CGMSDT
      9616**DCL     10053>>ASSIGN
E_CGSTRP
      9562**DCL     10354>>ASSIGN
E_CGTTRP
      9556**DCL     10179>>ASSIGN
E_CGUAFC
      9592**DCL     10142>>ASSIGN
E_NOMEM
      9550**DCL     10643>>ASSIGN
E_STACHR
      9634**DCL     10732>>ASSIGN
E_TYPCHR
      9628**DCL     10153>>ASSIGN  10639>>ASSIGN
F$DCB.ACCT
      6997**DCL      9961>>IF      10758>>ASSIGN
F$DCB.ACTPOS
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:186  
      7012**DCL      7012--REDEF
F$DCB.ARS
      6987**DCL      6987--REDEF
F$DCB.ATTR
      7005**DCL      7006--REDEF
F$DCB.BORROW
      7020**DCL      7020--REDEF    7020--REDEF    7020--REDEF
F$DCB.DCBNAME.L
      7034**DCL      7034--IMP-SIZ
F$DCB.EOMCHAR
      6991**DCL      6991--REDEF
F$DCB.FLDID
      7015**DCL      7015--REDEF
F$DCB.FORM$
      7009**DCL      7009--REDEF
F$DCB.FSECT
      7025**DCL      7025--REDEF
F$DCB.FSN
      7002**DCL      7002--REDEF    7002--REDEF    7003--REDEF
F$DCB.HEADER$
      7008**DCL      7008--REDEF
F$DCB.IXTNSIZE
      7006**DCL      7006--REDEF
F$DCB.LASTSTA$
      6996**DCL      6996--REDEF
F$DCB.LVL
      7021**DCL      7021--REDEF
F$DCB.NAME
      6996**DCL      9963--IF       9963--IF       9964--IF       9964--IF       9965--IF       9965--IF
     10761--ASSIGN  10761--ASSIGN
F$DCB.NAME.C
      6996**DCL      6996--REDEF
F$DCB.NAME.L
      6996**DCL     10760>>ASSIGN
F$DCB.NOEOF
      7017**DCL      7017--REDEF
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:187  
F$DCB.NRECS
      7007**DCL      7007--REDEF
F$DCB.NRECX
      7026**DCL      7026--REDEF
F$DCB.OHDR
      7018**DCL      7018--REDEF
F$DCB.ORG
      7001**DCL      7001--REDEF
F$DCB.PRECNO
      7024**DCL      7024--REDEF
F$DCB.PSN
      6997**DCL     10759>>ASSIGN
F$DCB.RCSZ
      7029**DCL      7029--REDEF
F$DCB.RES
      6997**DCL      6997--REDEF
F$DCB.SETX
      7009**DCL      7009--REDEF
F$DCB.TAB$
      7008**DCL      7009--REDEF
F$DCB.TDA
      7023**DCL      7023--REDEF
F$DCB.WSN
      6998**DCL      6998--REDEF
FLINK$
      9533**DCL     10072<<ASSIGN  10074>>ASSIGN  10264<<ASSIGN  10266>>ASSIGN
FPT$ACTIVATE.DVBYTE.REREAD
      9334**DCL      9334--REDEF
FPT$CGCTL.ATTRS.AUP
      9268**DCL     10303>>IF
FPT$CGCTL.ATTRS.JOURNAL
      9268**DCL     10120>>IF
FPT$CGCTL.ATTRS.MAXLATCH
      9268**DCL     10124>>IF
FPT$CGCTL.ATTRS.MXACT
      9267**DCL     10133>>IF      10321>>IF
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:188  
FPT$CGCTL.ATTRS.ONEREPORT
      9268**DCL     10122>>IF
FPT$CGCTL.ATTRS.PERM
      9268**DCL     10118>>IF      10301>>IF
FPT$CGCTL.ATTRS.PRIO
      9267**DCL     10126>>IF      10308>>IF
FPT$CGCTL.STAFC
      9267**DCL     10201>>DOCASE  10255>>IF
FPT$CGCTL.TYPFC
      9267**DCL      9997>>DOCASE  10049>>IF
GETIT IN PROCEDURE RELJF
     10936**PROC    10909--CALL    10921--CALL
GETJF IN PROCEDURE RELJF
     10902**ENTRY    9870--CALL
GOTSTA0
     10230**LABEL   10227--GOTO
GOTTYP0
     10026**LABEL   10023--GOTO
HFC$LOCK
      2885**DCL-ENT  9917--CALL     9943--CALL    10234--CALL    10299--CALL    10313--CALL    10373--CALL
     10451--CALL    10461--CALL    10529--CALL    10557--CALL    10687--CALL    10695--CALL    10716--CALL
     10851--CALL    10880--CALL    10911--CALL
HFC$UNLOCK
      2885**DCL-ENT  9922--CALL     9948--CALL     9954--CALL    10243--CALL    10306--CALL    10317--CALL
     10347--CALL    10377--CALL    10456--CALL    10466--CALL    10535--CALL    10551--CALL    10568--CALL
     10691--CALL    10699--CALL    10720--CALL    10885--CALL    10916--CALL
HFF$DSIZ
      9681**DCL-ENT  9818--CALL     9853--CALL     9981--CALL    10195--CALL
HFF$ERASE
      9678**DCL-ENT  9847--CALL    10675--CALL
HFF$NIL
      9679**DCL-ENT 10674--CALL
HFF$NILERASE
      9680**DCL-ENT  9882--CALL    10370--CALL
HFF$PTPRES
      9682**DCL-ENT  9868--CALL
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:189  
HFF$TRAPALT
      9683**DCL-ENT 10018--CALL    10048--CALL    10088--CALL    10107--CALL    10113--CALL    10138--CALL
     10222--CALL    10254--CALL    10279--CALL    10287--CALL    10293--CALL    10326--CALL
I
      9534**DCL      9340--IMP-SIZ  9853<>CALL     9854>>IF       9856>>IF       9856>>IF       9869>>IF
      9938<<ASSIGN   9939>>IF       9951<<ASSIGN   9958>>IF      10025<<CALLBLT 10229<<CALLBLT 10633<<CALLBLT
     10680<<CALLBLT 10938<<ASSIGN  10939>>ASSIGN  10941>>ASSIGN  10941>>ASSIGN
I IN PROCEDURE CXTSET
     10784**DCL     10789<<ASSIGN  10790>>IF      10790<<ASSIGN  10791>>IF      10791<<ASSIGN  10792>>ASSIGN
     10793>>ASSIGN  10794<<ASSIGN  10795>>IF      10795<<ASSIGN  10796>>IF      10796<<ASSIGN  10797>>ASSIGN
     10798>>ASSIGN
I IN PROCEDURE SETMXACT
     10842**DCL     10844<<ASSIGN  10847>>IF
IQLS
      9983**LABEL   10200--GOTO
J IN PROCEDURE CXTSET
     10785**DCL     10787<<ASSIGN  10788>>IF      10788<<ASSIGN  10788>>IF      10788<<ASSIGN  10789>>ASSIGN
     10794>>ASSIGN
J$ IN PROCEDURE RELJF
     10875**DCL     10913>>ASSIGN  10922>>ASSIGN  10940<>CALL    10941>>ASSIGN
JFERASE
      9847**LABEL    9847--CALLALT
JFLG
      9527**DCL      9821<<ASSIGN   9837<<ASSIGN   9839<<ASSIGN   9912<<ASSIGN  10381>>IF      10924<<ASSIGN
JNAME
      9536**DCL      9833<<ASSIGN   9834<<ASSIGN   9837>>IF       9839>>IF
K IN PROCEDURE RELJF
     10874**DCL     10931<<ASSIGN  10932<>CALL    10939<<ASSIGN  10940<>CALL
KCL$HOOKUPH
      9684**DCL-ENT  9964--CALL
KCL$HOOKUPM
      9685**DCL-ENT  9963--CALL
KCL$HOOKUPMB
      9686**DCL-ENT  9967--CALL
KC_LGL1ST
      7387**DCL     10025>>CALLBLT 10229>>CALLBLT 10633>>CALLBLT 10680>>CALLBLT
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:190  
KC_VLPSTATION.MSGIDXT
      9742**DCL      9745--REDEF
KEY
      9455**DCL      9456--REDEF   10021<<ASSIGN  10022<>CALL    10025>>CALLBLT 10027<>CALL    10029>>IF
     10030>>IF      10089<<ASSIGN  10090<>CALL    10091>>IF      10091>>IF      10116<<ASSIGN  10117<>CALL
     10225<<ASSIGN  10226<>CALL    10229>>CALLBLT 10231<>CALL    10280<<ASSIGN  10281<>CALL    10296<<ASSIGN
     10297<>CALL    10676<<ASSIGN  10677>>IF      10680>>CALLBLT 10682<>CALL
KQ$CG
      7432**DCL      9959<>CALL    10027<>CALL    10168<>CALL    10231<>CALL    10382<>CALL    10510<>CALL
     10511<>CALL    10565<>CALL    10566<>CALL    10570<>CALL    10635<>CALL    10682<>CALL    10812<>CALL
     10813<>CALL    10828<>CALL    10849<>CALL    10932<>CALL    10940<>CALL
KQ$CG.AUCTL
      7869**DCL      9952<<ASSIGN
KQ$CG.AUCTL.DATAPGS
      7877**DCL     10787>>ASSIGN
KQ$CG.AUCTL.DMTYP
      7871**DCL     10029>>IF      10091>>IF      10409<>CALL
KQ$CG.AUCTL.DVBYTE.REREAD
      7875**DCL      7876--REDEF
KQ$CG.AUCTL.JOURNAL
      7879**DCL      9912>>IF
KQ$CG.AUCTL.MAXPG
      7872**DCL      9938>>ASSIGN  10789>>ASSIGN  10791>>IF      10791>>ASSIGN  10793>>ASSIGN
KQ$CG.AUCTL.MINPG
      7871**DCL     10794>>ASSIGN  10796>>IF      10796>>ASSIGN  10798>>ASSIGN
KQ$CG.AUCTL.TERMCONLGL
      7880**DCL      9913>>IF      10428>>IF
KQ$CG.AUCTL.TMTYP
      7871**DCL     10030>>IF      10091>>IF      10410<>CALL
KQ$CG.AUCTL.WRITETIME
      7877**DCL     10811>>ASSIGN
KQ$CG.AUCTL.XSTALGL
      7874**DCL     10256>>IF      10802>>ASSIGN  10809>>ASSIGN
KQ$CG.AUCTL.XTYPLGL
      7875**DCL     10065>>IF      10619>>IF      10803>>ASSIGN  10808>>ASSIGN
KQ$CG.CFU$
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:191  
      7943**DCL     10381<>CALL    10887<>CALL
KQ$CG.DELAY.DISKWARN
      7519**DCL      9945<<ASSIGN
KQ$CG.DTREE.GATE
      8017**DCL      9917<>CALL     9922<>CALL     9954<>CALL
KQ$CG.FORCECNT
      8038**DCL     10811<<ASSIGN
KQ$CG.GATE.CG
      7822**DCL      9943<>CALL     9948<>CALL    10373<>CALL    10377<>CALL
KQ$CG.GATE.MISC
      7824**DCL     10880<>CALL    10885<>CALL    10911<>CALL    10916<>CALL
KQ$CG.HOLDSTA$
      7862**DCL      9831<>CALL
KQ$CG.JRNLFID$
      7965**DCL     10877>>IF      10878>>ASSIGN  10882<<ASSIGN  10904>>ASSIGN  10913<<ASSIGN  10922<<ASSIGN
KQ$CG.JRNLSTA$
      7935**DCL      9832>>IF       9833>>ASSIGN   9835<>CALL     9836>>IF       9837>>IF
KQ$CG.MAXDATAPGS
      8049**DCL     10792<<ASSIGN
KQ$CG.MINDATAPGS
      8054**DCL     10797<<ASSIGN
KQ$CG.MMD.MAXBPG
      7460**DCL      9951>>ASSIGN   9958>>IF      10793<<ASSIGN
KQ$CG.MMD.MINBPG
      7472**DCL     10798<<ASSIGN
KQ$CG.NGAVAL
      7957**DCL      9919>>IF       9938>>ASSIGN   9940>>IF
KQ$CG.QISS
      7818**DCL      9984>>IF      10039>>IF      10131>>IF      10133>>IF      10198>>IF      10245>>IF
     10319>>IF      10321>>IF      10479>>IF      10485>>IF      10499>>IF      10512>>IF      10523>>IF
     10540>>IF      10544>>IF      10564>>IF      10571>>IF      10701>>IF      10799>>IF
KQ$CG.QUEUE.QTREE$
      7654**DCL     10801<<ASSIGN  10807<<ASSIGN  10851>>CALL
KQ$CG.SETSTA
      7902**DCL     10375<<ASSIGN
KQ$CG.STREE
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:192  
      7764**DCL     10226<>CALL    10281<>CALL    10297<>CALL    10801--ASSIGN
KQ$CG.STREE.GATE
      7766**DCL     10461<>CALL    10466<>CALL
KQ$CG.STREE.HEAD$
      7774**DCL     10209>>ASSIGN  10259>>ASSIGN
KQ$CG.TRIGGER
      7969**DCL      9937<<ASSIGN
KQ$CG.TRIGGERED
      7951**DCL      9946<<ASSIGN
KQ$CG.TTREE
      7725**DCL     10022<>CALL    10090<>CALL    10117<>CALL    10614<>CALL    10807--ASSIGN
KQ$CG.TTREE.GATE
      7727**DCL     10451<>CALL    10456<>CALL
KQ$CG.TTREE.HEAD$
      7735**DCL     10005>>ASSIGN  10068>>ASSIGN
KQ$CG.XOTNLGL
      7815**DCL     10803<<ASSIGN  10809<<ASSIGN
KQ$CG.XQTNLGL
      7811**DCL     10802<<ASSIGN  10808<<ASSIGN
KQ$JFID IN PROCEDURE RELJF
     10872**DCL     10931--ASSIGN
KQ$JFID.JRNLFID# IN PROCEDURE RELJF
     10872**DCL     10907>>IF
KQ$JFID.L# IN PROCEDURE RELJF
     10872**DCL     10872--IMP-SIZ 10907>>IF      10931>>ASSIGN
KQ$MTYP.BTN.FLINK$
      8538**DCL     10008>>ASSIGN  10072>>ASSIGN  10076>>ASSIGN
KQ$MTYP.DFCHK
      8554**DCL     10007<<ASSIGN  10031<<ASSIGN  10070>>IF
KQ$MTYP.JOURNAL
      8548**DCL     10033<<ASSIGN  10121<<ASSIGN
KQ$MTYP.MAXLATCH
      8559**DCL     10035<<ASSIGN  10125<<ASSIGN
KQ$MTYP.MPRIO
      8544**DCL     10038<<ASSIGN  10130<<ASSIGN
KQ$MTYP.ONEREPORT
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:193  
      8551**DCL     10034<<ASSIGN  10123<<ASSIGN
KQ$MTYP.PERM
      8556**DCL     10032<<ASSIGN  10119<<ASSIGN  10498<<ASSIGN
KQ$QTN.AUTORCVR
      8939**DCL     10042<<ASSIGN  10248<<ASSIGN
KQ$QTN.CNACT
      8925**DCL     10486>>IF      10545>>IF      10847>>IF
KQ$QTN.LOCKCNT
      8944**DCL     10500>>IF      10502<<ASSIGN  10502>>ASSIGN  10506<<ASSIGN  10506>>ASSIGN  10547>>IF
KQ$QTN.MLH
      8986**DCL     10510--CALL    10565--CALL
KQ$QTN.MPRIO
      8947**DCL     10827<<ASSIGN
KQ$QTN.MXACT
      8928**DCL      8930--REDEF   10844>>ASSIGN  10846<<ASSIGN  10847>>IF      10847>>IF
KQ$QTN.STA.ACTTYC
      8650**DCL      8654--REDEF
KQ$QTN.STA.DCBLNK$
      8657**DCL      8660--REDEF    8664--REDEF
KQ$QTN.STA.EVCNT
      8743**DCL      8746--REDEF
KQ$QTN.STA.EVNT
      8709**DCL      8713--REDEF    8716--REDEF
KQ$QTN.STA.OPNBLKED
      8770**DCL      8773--REDEF
KQ$QTN.STA.OPNREJ
      8776**DCL      8778--REDEF
KQ$QTN.STA.SUCCREAD
      8699**DCL      8703--REDEF
KQ$QTN.STA.TCOUNT
      8828**DCL      8834--REDEF
KQ$QTN.STA.VGOT$
      8813**DCL      8817--REDEF    8821--REDEF
KQ$RBLK.BUF$
      9215**DCL      9217--REDEF
KQ$RBLK.CNACTD
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:194  
      9129**DCL      9138--REDEF
KQ$RBLK.DBLKX
      9235**DCL      9239--REDEF
KQ$RBLK.EOFNONE
      9107**DCL      9110--REDEF
KQ$RBLK.FROMQ
      9113**DCL      9116--REDEF
KQ$RBLK.KEY1R
      9154**DCL      9155--REDEF
KQ$RBLK.KEY2R
      9159**DCL      9160--REDEF
KQ$RBLK.LATCH
      9102**DCL      9104--REDEF
KQ$RBLK.LWRITES$
      9246**DCL      9250--REDEF
KQ$STA
      8170**DCL     10482<>CALL    10495<>CALL    10514<>CALL    10526<>CALL    10540<>CALL    10573<>CALL
KQ$STA.ACTTYC
      8222**DCL      8226--REDEF
KQ$STA.AUP
      8324**DCL     10237<<ASSIGN  10304<<ASSIGN
KQ$STA.BTN.FLINK$
      8204**DCL     10212>>ASSIGN  10264>>ASSIGN  10268>>ASSIGN
KQ$STA.BTN.KEY
      8206**DCL      9833>>ASSIGN   9837>>IF
KQ$STA.CG$
      8209**DCL      9816>>ASSIGN  10408>>ASSIGN
KQ$STA.DCBLNK$
      8229**DCL      8232--REDEF    8236--REDEF
KQ$STA.DFCHK
      8293**DCL     10211<<ASSIGN  10236<<ASSIGN  10261>>IF
KQ$STA.EVCNT
      8315**DCL      8318--REDEF
KQ$STA.EVNT
      8281**DCL      8285--REDEF    8288--REDEF
KQ$STA.GATE
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:195  
      8248**DCL     10234<>CALL    10243<>CALL    10299<>CALL    10306<>CALL    10313<>CALL    10317<>CALL
     10347<>CALL    10529<>CALL    10535<>CALL    10551<>CALL    10557<>CALL    10568<>CALL    10687<>CALL
     10691<>CALL    10695<>CALL    10699<>CALL    10716<>CALL    10720<>CALL
KQ$STA.LDCT$
      8211**DCL     10532>>IF
KQ$STA.LOCKCNT
      8304**DCL     10549<<ASSIGN  10549>>ASSIGN  10559<<ASSIGN  10559>>ASSIGN  10562>>IF
KQ$STA.MLH
      8438**DCL     10566--CALL
KQ$STA.MPRIO
      8243**DCL     10241<<ASSIGN  10315<<ASSIGN  10703>>ASSIGN
KQ$STA.OPNBLKED
      8342**DCL      8345--REDEF
KQ$STA.OPNREJ
      8348**DCL      8350--REDEF
KQ$STA.PERM
      8268**DCL     10238<<ASSIGN  10302<<ASSIGN  10563<<ASSIGN
KQ$STA.SPECIAL
      8329**DCL     10261>>IF      10282>>IF      10689<<ASSIGN  10697<<ASSIGN  10718<<ASSIGN
KQ$STA.SUCCREAD
      8271**DCL      8275--REDEF
KQ$STA.TCOUNT
      8400**DCL      8406--REDEF
KQ$STA.VGOT$
      8385**DCL      8389--REDEF    8393--REDEF
KQ$THDR.GATE
      9060**DCL     10851<>CALL
KQB$SRCH
      9687**DCL-ENT 10022--CALL    10090--CALL    10117--CALL    10226--CALL    10281--CALL    10297--CALL
     10614--CALL
KQC$TELLJ
      9688**DCL-ENT 10381--CALL    10887--CALL
KQL$DELMLH
      9689**DCL-ENT 10510--CALL    10565--CALL    10566--CALL
KQL$QXFDUN
      9690**DCL-ENT 10495--CALL    10514--CALL    10540--CALL    10573--CALL
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:196  
KQM$GETB
      9691**DCL-ENT 10940--CALL
KQM$GETDFR
      9692**DCL-ENT 10813--CALL
KQM$GETMIN
      9693**DCL-ENT 10812--CALL
KQM$MOREPG
      9694**DCL-ENT  9959--CALL
KQM$RELB
      9695**DCL-ENT 10932--CALL
KQQ$ACT
      9696**DCL-ENT 10849--CALL
KQR$GETQUEUE
      9697**DCL-ENT 10482--CALL    10526--CALL
KQT$DELSTA
      9698**DCL-ENT 10570--CALL
KQT$DELTYP
      9699**DCL-ENT 10511--CALL
KQT$GETSTA
      9700**DCL-ENT 10231--CALL    10682--CALL
KQT$GETTYP
      9701**DCL-ENT 10027--CALL    10635--CALL
KQT$MOVQTN
      9703**DCL-ENT 10828--CALL
KQT$VALREADS
      9705**DCL-ENT 10168--CALL    10382--CALL
KQ_IMBLK.DVE.EOMCHAR
      3560**DCL      3562--REDEF
KQ_IMBLK.KEY1
      3486**DCL      3488--REDEF
KQ_IMBLK.KEY2
      3495**DCL      3513--REDEF
KQ_IMBLK.LNK$
      3460**DCL      3462--REDEF    3468--REDEF    3472--REDEF
KQ_IMBLK.TYC
      3609**DCL      3611--REDEF
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:197  
KQ_IMBLK.XSP.MREQ$
      3515**DCL      3519--REDEF
KQ_IRBLK.BUF$
      3064**DCL      3066--REDEF
KQ_IRBLK.CNACTD
      2978**DCL      2987--REDEF
KQ_IRBLK.DBLKX
      3084**DCL      3088--REDEF
KQ_IRBLK.EOFNONE
      2956**DCL      2959--REDEF
KQ_IRBLK.FROMQ
      2962**DCL      2965--REDEF
KQ_IRBLK.KEY1R
      3003**DCL      3004--REDEF
KQ_IRBLK.KEY2R
      3008**DCL      3009--REDEF
KQ_IRBLK.LATCH
      2951**DCL      2953--REDEF
KQ_IRBLK.LWRITES$
      3095**DCL      3099--REDEF
KQ_IRBLKT.CNACTD
      3164**DCL      3173--REDEF
KQ_IRBLKT.DBLK$
      3227**DCL      3231--REDEF    3234--REDEF
KQ_IRBLKT.EOFNONE
      3142**DCL      3145--REDEF
KQ_IRBLKT.FROMQ
      3148**DCL      3151--REDEF
KQ_IRBLKT.KEY1R
      3189**DCL      3190--REDEF
KQ_IRBLKT.KEY2R
      3194**DCL      3195--REDEF
KQ_IRBLKT.LATCH
      3137**DCL      3139--REDEF
MTYP$
      9460**DCL      8508--IMP-PTR 10005<<ASSIGN  10006>>DOWHILE 10007>>ASSIGN  10008<<ASSIGN  10008>>ASSIGN
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:198  
     10022<>CALL    10026<<ASSIGN  10027<>CALL    10031>>ASSIGN  10032>>ASSIGN  10033>>ASSIGN  10034>>ASSIGN
     10035>>ASSIGN  10038>>ASSIGN  10042>>ASSIGN  10043<>CALL    10044<>CALL    10068<<ASSIGN  10069>>DOWHILE
     10070>>IF      10072>>ASSIGN  10074<<ASSIGN  10076<<ASSIGN  10076>>ASSIGN  10090<>CALL    10117<>CALL
     10119>>ASSIGN  10121>>ASSIGN  10123>>ASSIGN  10125>>ASSIGN  10130>>ASSIGN  10131<>CALL    10135<>CALL
     10486>>IF      10498>>ASSIGN  10500>>IF      10502>>ASSIGN  10502>>ASSIGN  10506>>ASSIGN  10506>>ASSIGN
     10510>>CALL    10511<>CALL    10614<>CALL    10634<<ASSIGN  10635<>CALL
MYSTA$
      9459**DCL      9815<<ASSIGN   9816>>ASSIGN  10026>>ASSIGN  10230>>ASSIGN  10407<<ASSIGN  10408>>ASSIGN
     10482>>CALL    10495>>CALL    10514>>CALL    10526>>CALL    10540>>CALL    10573>>CALL    10634>>ASSIGN
     10681>>ASSIGN
NOCTL
      9971**LABEL    9882--CALLALT
NOJF
      9869**LABEL    9851--GOTO
NOMEM
     10160**LABEL   10231--CALLALT
NOMEM IN PROCEDURE CHKTYP
     10639**LABEL   10635--CALLALT
NOMEM IN PROCEDURE SPCLSTA
     10732**LABEL   10682--CALLALT
NONE IN PROCEDURE GETIT
     10941**LABEL   10940--CALLALT
NOQL
      9821**LABEL    9818--CALLALT
NOSETSTA
     10375**LABEL   10370--CALLALT
NOSTA0
     10225**LABEL   10226--CALLALT
NOSTA1
     10282**LABEL   10281--CALLALT
NOSTA2
     10329**LABEL   10297--CALLALT
NOSTAL
     10354**LABEL   10195--CALLALT 10197--GOTO    10332--GOTO
NOTYP IN PROCEDURE CHKTYP
     10613**LABEL   10614--CALLALT
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:199  
NOTYP0
     10021**LABEL   10022--CALLALT
NOTYP1
     10091**LABEL   10090--CALLALT
NOTYP2
     10153**LABEL   10117--CALLALT
NOTYPL
     10179**LABEL    9981--CALLALT  9983--GOTO    10151--GOTO
NOTYPMEM
     10160**LABEL   10027--CALLALT
NQ
      9530**DCL      9819<<ASSIGN   9986>>IF      10200>>IF
NSTA
      9467**DCL     10196<<ASSIGN  10197>>IF      10200>>IF      10223>>DOINDEX 10277>>DOINDEX 10294>>DOINDEX
NTYP
      9463**DCL      9982<<ASSIGN   9983>>IF       9986>>IF      10019>>DOINDEX 10086>>DOINDEX 10114>>DOINDEX
P$
      9525**DCL     10878<<ASSIGN  10904<<ASSIGN  10905>>IF      10907>>IF      10907>>IF      10931>>ASSIGN
     10931>>ASSIGN  10932<>CALL
PARM
      7397**DCL        14--PROC
PARM$
      7396**DCL        14--PROC     9815>>ASSIGN  10392--ENTRY   10394>>ASSIGN  10405--ENTRY   10407>>ASSIGN
     10425--ENTRY   10427>>ASSIGN
PRIO
      9465**DCL      9883<<ASSIGN   9885<<ASSIGN  10036<<ASSIGN  10038>>ASSIGN  10128<<ASSIGN  10130>>ASSIGN
     10239<<ASSIGN  10241>>ASSIGN  10310<<ASSIGN  10315>>ASSIGN  10585>>IF      10585>>IF      10703<<ASSIGN
     10827>>ASSIGN
PS$ IN PROCEDURE SPCLSTA
     10671**DCL     10669--PROC    10674<>CALL    10675<>CALL    10676>>ASSIGN
QLIST
      9529**DCL      9817<<ASSIGN   9820<<ASSIGN   9984>>IF      10041>>IF      10198>>IF      10247>>IF
     10845>>IF
QTN$
      9461**DCL      8582--IMP-PTR
QTN$ IN PROCEDURE SETMXACT
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:200  
     10840**DCL     10838--PROC    10844>>ASSIGN  10846>>ASSIGN  10847>>IF      10847>>IF      10847>>IF
     10849<>CALL
QTN$ IN PROCEDURE SETPRIO
     10825**DCL     10823--PROC    10827>>ASSIGN  10828<>CALL
QX IN PROCEDURE SETMXACT
     10841**DCL     10838--PROC    10846>>ASSIGN
RBLK$
      9526**DCL      9093--IMP-PTR
RELIT IN PROCEDURE RELJF
     10929**PROC    10883--CALL    10914--CALL
RELJF
     10865**PROC     9850--CALL
RTN IN PROCEDURE CHKTYP
     10613**LABEL   10631--GOTO    10636--GOTO
RTN IN PROCEDURE SPCLSTA
     10707**LABEL   10674--CALLALT
S0 IN PROCEDURE DELTYP
     10523**LABEL   10560--GOTO
S1 IN PROCEDURE DELTYP
     10549**LABEL   10562--GOTO
SETBSC IN PROCEDURE SPCLSTA
     10730**ENTRY   10334--CALL
SETMXACT
     10838**PROC    10044--CALL    10135--CALL    10250--CALL    10323--CALL
SETNOMEM IN PROCEDURE CHKTYP
     10642**ENTRY   10173--CALL    10740--CALL    10944--CALL
SETPRIO
     10823**PROC    10043--CALL    10131--CALL    10249--CALL    10319--CALL    10704--CALL
SETSTA
      9489**DCL     10371<<ASSIGN  10375>>ASSIGN
SLOCK IN PROCEDURE TLOCK
     10459**ENTRY   10207--CALL    10224--CALL    10258--CALL    10278--CALL    10295--CALL    10555--CALL
     10574--CALL    10679--CALL    10712--CALL
SPCLSTA
     10669**PROC     9831--CALL     9835--CALL
SSR$REG
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:201  
      9706**DCL-ENT 10504--CALL    10554--CALL    10766--CALL
STA$
      9458**DCL      8170--IMP-PTR 10209<<ASSIGN  10210>>DOWHILE 10211>>ASSIGN  10212<<ASSIGN  10212>>ASSIGN
     10226<>CALL    10230<<ASSIGN  10231<>CALL    10234>>CALL    10236>>ASSIGN  10237>>ASSIGN  10238>>ASSIGN
     10241>>ASSIGN  10243>>CALL    10248>>ASSIGN  10249<>CALL    10250<>CALL    10259<<ASSIGN  10260>>DOWHILE
     10261>>IF      10261>>IF      10264>>ASSIGN  10266<<ASSIGN  10268<<ASSIGN  10268>>ASSIGN  10281<>CALL
     10282>>IF      10297<>CALL    10299>>CALL    10302>>ASSIGN  10304>>ASSIGN  10306>>CALL    10313>>CALL
     10315>>ASSIGN  10317>>CALL    10319<>CALL    10323<>CALL    10347>>CALL    10529>>CALL    10532>>IF
     10535>>CALL    10545>>IF      10547>>IF      10549>>ASSIGN  10549>>ASSIGN  10551>>CALL    10557>>CALL
     10559>>ASSIGN  10559>>ASSIGN  10562>>IF      10563>>ASSIGN  10565>>CALL    10566>>CALL    10568>>CALL
     10570<>CALL    10681<<ASSIGN  10682<>CALL    10683>>IF      10695>>CALL    10697>>ASSIGN  10699>>CALL
     10703>>ASSIGN  10704<>CALL    10706>>ASSIGN
STAALT
     10337**LABEL   10311--CALLALT 10335--GOTO    10349--GOTO
STAALT0
     10337**LABEL   10240--CALLALT
STAPTR$ IN PROCEDURE SPCLSTA
     10672**DCL     10669--PROC    10683>>IF      10683>>IF      10687>>CALL    10689>>ASSIGN  10691>>CALL
     10706<<ASSIGN  10713>>IF      10716>>CALL    10718>>ASSIGN  10720>>CALL    10722<<ASSIGN
STATRAP
     10337**LABEL   10222--CALLALT
STATRAPB
     10337**LABEL   10279--CALLALT 10293--CALLALT
STAX
      9466**DCL     10223<<DOINDEX 10225>>ASSIGN  10237>>ASSIGN  10238>>ASSIGN  10239>>ASSIGN  10248>>ASSIGN
     10250<>CALL    10277<<DOINDEX 10280>>ASSIGN  10294<<DOINDEX 10296>>ASSIGN  10302>>ASSIGN  10304>>ASSIGN
     10310>>ASSIGN  10323<>CALL
SUNLOCK IN PROCEDURE TLOCK
     10464**ENTRY   10214--CALL    10252--CALL    10270--CALL    10285--CALL    10324--CALL    10343--CALL
     10352--CALL    10525--CALL    10541--CALL    10553--CALL    10707--CALL    10724--CALL    10728--CALL
T0 IN PROCEDURE DELTYP
     10479**LABEL   10507--GOTO
TELLELF IN PROCEDURE TRMGO
     10761**LABEL   10767--GOTO
TKEY IN PROCEDURE CHKTYP
     10611**DCL     10609--PROC    10614<>CALL    10631>>IF      10631>>IF      10632>>IF      10633>>CALLBLT
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:202  
     10635<>CALL
TLOCK
     10449**PROC    10003--CALL    10020--CALL    10067--CALL    10087--CALL    10115--CALL    10505--CALL
     10515--CALL    10613--CALL
TOKFLG
      9535**DCL      9913<<ASSIGN   9914<<ASSIGN   9968<<ASSIGN   9971>>IF      10763<>CALL
TRMGO
     10754**PROC     9971--CALL    10428--CALL
TUNLOCK IN PROCEDURE TLOCK
     10454**ENTRY   10010--CALL    10046--CALL    10078--CALL    10100--CALL    10105--CALL    10136--CALL
     10166--CALL    10177--CALL    10481--CALL    10503--CALL    10616--CALL    10621--CALL    10638--CALL
TYPALT
     10160**LABEL   10037--CALLALT 10129--CALLALT 10158--GOTO
TYPTRAP
     10160**LABEL   10018--CALLALT 10113--CALLALT
TYPTRAPB
     10160**LABEL   10088--CALLALT
TYPX
      9464**DCL     10019<<DOINDEX 10021>>ASSIGN  10032>>ASSIGN  10033>>ASSIGN  10034>>ASSIGN  10035>>ASSIGN
     10036>>ASSIGN  10042>>ASSIGN  10044<>CALL    10086<<DOINDEX 10089>>ASSIGN  10114<<DOINDEX 10116>>ASSIGN
     10119>>ASSIGN  10121>>ASSIGN  10123>>ASSIGN  10125>>ASSIGN  10128>>ASSIGN  10135<>CALL
VLP$CGCP
      9281**DCL      9887>>ASSIGN
VLP$CGCP.DVBYTE.REREAD
      9289**DCL      9290--REDEF
VLP$CGCP.STAPRIO
      9285**DCL      9883>>ASSIGN
VLP$CGCP.TYPPRIO
      9285**DCL      9885>>ASSIGN
VLP$CGQL.LIST
      9311**DCL      9819--ASSIGN
VLP$CGQL.LIST.AUTORCVR
      9311**DCL     10042>>ASSIGN  10248>>ASSIGN
VLP$CGQL.LIST.MXACT
      9311**DCL     10846>>ASSIGN
VLP$CGSTAL.LIST
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:203  
      9276**DCL     10196--ASSIGN
VLP$CGSTAL.LIST.AUP
      9277**DCL     10237>>ASSIGN  10304>>ASSIGN
VLP$CGSTAL.LIST.NAME
      9276**DCL     10225>>ASSIGN  10280>>ASSIGN  10296>>ASSIGN
VLP$CGSTAL.LIST.PERM
      9276**DCL     10238>>ASSIGN  10302>>ASSIGN
VLP$CGSTAL.LIST.PRIO
      9276**DCL     10239>>ASSIGN  10310>>ASSIGN
VLP$CGTYPL.LIST
      9271**DCL      9982--ASSIGN
VLP$CGTYPL.LIST.JOURNAL
      9271**DCL     10033>>ASSIGN  10121>>ASSIGN
VLP$CGTYPL.LIST.MAXLATCH
      9272**DCL     10035>>ASSIGN  10125>>ASSIGN
VLP$CGTYPL.LIST.NAME
      9271**DCL     10021>>ASSIGN  10089>>ASSIGN  10116>>ASSIGN
VLP$CGTYPL.LIST.ONEREPORT
      9272**DCL     10034>>ASSIGN  10123>>ASSIGN
VLP$CGTYPL.LIST.PERM
      9271**DCL     10032>>ASSIGN  10119>>ASSIGN
VLP$CGTYPL.LIST.PRIO
      9271**DCL     10036>>ASSIGN  10128>>ASSIGN
VLP$JRNLFIDV
      9331**DCL      9869--IF      10938--ASSIGN
VLP$JRNLFIDV.JRNLFID#
      9331**DCL     10907>>IF
VLP$JRNLFIDV.L#
      9331**DCL      9331--IMP-SIZ  9856--IF       9869>>IF      10907>>IF      10938>>ASSIGN
VLP$SETSTA
      9300**DCL     10371>>ASSIGN
VLP$STATION.MSGIDXT
      9322**DCL      9324--REDEF
VLP$STATION.STATION
      9320**DCL     10676>>ASSIGN
VTXTC.CNT
PL6.E3A0      #001=KQC$CGCTL File=KQC$CTL.:E05TSI                                WED 07/30/97 01:24 Page:204  
      9342**DCL      9343--IMP-SIZ  9963>>IF       9964>>IF       9965>>IF      10761>>ASSIGN
VTXTC.TXT
      9343**DCL      9963>>IF       9964>>IF       9965>>IF      10761>>ASSIGN

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:205  
     1286        1        /*T***********************************************************/
     1287        2        /*T*                                                         */
     1288        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1289        4        /*T*                                                         */
     1290        5        /*T***********************************************************/
     1291        6        %EJECT;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:206  
     1292        7        /**/
     1293        8        /*F* NAME:         KQC$ACTSTA
     1294        9             PURPOSE:      To activate a station
     1295       10             CALL:         KQC$ACTSTA (KQ$STA,FPT_ACTIVATE.V)   ...FPT optional
     1296       11             INPUT:        KQ$STA.LOCKCNT counted up
     1297       12                           KQ$STA.GATE unlocked
     1298       13             DESCRIPTION:  Activates the
     1299       14                           station, and does what the FPT says.
     1300       15                           Must be called on behalf of user.
     1301       16                           Does not count down LOCKCNT.
     1302       17
     1303       18                           Calls KCD$ACTRM if TERMINAL.
     1304       19        */
     1305       20        KQC$ACTSTA: PROC (PARM$,PARM) ALTRET; /* !!Doesn't ALTRET!! */
     1306       21        /**/
     1307       22        /**/
     1308       23
     1309       24
     1310       25
     1311       26        /**/
     1312       27        /* INCLUDES */
     1313       28        /**/
     1314       29        %INCLUDE KQ_SUBS_C;
     1315      329        %INCLUDE KQ_MAC_C;
     1316     2879        %INCLUDE HF_LOCK_C;
     1317     2893        %INCLUDE KQ_DATA_R;
     1318     3725        %INCLUDE CP_6_SUBS;
     1319     4265        %INCLUDE NK$LDCT;
     1320     4367        %INCLUDE KC$CP6V_C;
     1321     4487        %INCLUDE KC_CP6;
     1322     5047        %INCLUDE N$REQ;
     1323     5121        %INCLUDE KC_DATA_R;
     1324     5134        %INCLUDE NK_SUBS;
     1325     5159        %INCLUDE SS_SCHED_C;
     1326     5392
     1327     5393
     1328     5394
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:207  
     1329     5395        /**/
     1330     5396        /* PARAMETERS */
     1331     5397        /**/
     1332     5398    1   DCL PARM$ PTR;
     1333     5399    1   DCL PARM UBIN WORD ALIGNED;
     1334     5400    1   DCL PARMR BIT(36) ALIGNED;
     1335     5401
     1336     5402
     1337     5403
     1338     5404        /**/
     1339     5405        /* BASED STRUCTURES */
     1340     5406        /**/
     1341     5407        %NK$LDCT;
     1342     5453        %N$REQ;
     1343     5511        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
     1344     6250        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
     1345     6589        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
     1346     6627        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS=BASED);
     1347     6813        %FPT$ACTIVATE_V (FPTN=FPT$ACTIVATE);
     1348     6819    1   DCL B$$BIT36 BIT(36) BASED ALIGNED;
     1349     6820
     1350     6821
     1351     6822
     1352     6823        /**/
     1353     6824        /* AUTO */
     1354     6825        /**/
     1355     6826    1   DCL CG$ PTR;
     1356     6827    1   DCL LDCT$ PTR;
     1357     6828    1   DCL SAVLDCT$ PTR;
     1358     6829    1   DCL STA$ PTR;
     1359     6830    1   DCL FPT$ PTR;
     1360     6831
     1361     6832
     1362     6833
     1363     6834        /**/
     1364     6835        /* REFS */
     1365     6836        /**/
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:208  
     1366     6837    1   DCL KCD$ACTRM     ENTRY(1);
     1367     6838    1   DCL KCD$DACDSC    ENTRY(1);
     1368     6839    1   DCL KCD$DACTRM    ENTRY(1);
     1369     6840    1   DCL KCD$RELTRM    ENTRY(1);
     1370     6841    1   DCL KQG$DACT      ENTRY(1) ALTRET;
     1371     6842    1   DCL KQL$DELMLH    ENTRY(2) ALTRET;
     1372     6843    1   DCL KQR$VALIDATE  ENTRY(1) ALTRET;
     1373     6844    1   DCL KQT$LBT       ENTRY(1) ALTRET;
     1374     6845    1   DCL KQT$UBT       ENTRY(1) ALTRET;
     1375     6846    1   DCL KQT$VALREADS  ENTRY(1) ALTRET;
     1376     6847    1   DCL SSR$RUE       ENTRY(4);
     1377     6848    1   DCL KIS$OSI_DACT  ENTRY(1);
     1378     6849
     1379     6850
     1380     6851
     1381     6852        /**/
     1382     6853        /* SUBS */
     1383     6854        /**/
     1384     6855        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
     1385     6856        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
     1386     6857        %SUB KQ$STREE="CG$->KQ$CG.STREE";
     1387     6858        %SUB KQ$DTREE="CG$->KQ$CG.DTREE";
     1388     6859        %EQU_CG;
     1389     6907        %EJECT;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:209  
     1390     6908    1         CALL SETUP;
     1391     6909    1         CALL ACT;
     1392     6910    1         RETURN;
     1393     6911        /**/
     1394     6912        /*F* NAME:         KQC$DACTSTA
     1395     6913             PURPOSE:      To deactivate a station
     1396     6914             CALL:         KQC$DACTSTA (KQ$STA,FPT_ACTIVATE.V)   ...FPT optional
     1397     6915             INPUT:        See KQC$ACTSTA
     1398     6916             DESCRIPTION:  Called as KQC$ACTSTA.  Deactivates
     1399     6917                           the station, aborting its current read if there
     1400     6918                           is one pending.  Validates every DCB read if
     1401     6919                           RAS is zero.
     1402     6920        */
     1403     6921    1   KQC$DACTSTA: ENTRY (PARM$,PARM) ALTRET; /* !!Doesn't ALTRET!! */
     1404     6922        /**/
     1405     6923    1         CALL SETUP;
     1406     6924    1         CALL DACT;
     1407     6925    1         RETURN;
     1408     6926        /**/
     1409     6927        /*F* NAME:         KQC$DISCSTA
     1410     6928             PURPOSE:      To deactivate-disconnect a station
     1411     6929             CALL:         KQC$DISCSTA (KQ$STA,FPT_ACTIVATE.V)   ...FPT optional
     1412     6930             INPUT:        See KQC$ACTSTA
     1413     6931             DESCTRIPTION: Called as KQC$DACTSTA.  First does what that
     1414     6932                           does (i.e. deactivate).  Then, for remote terminals
     1415     6933                           only, sends the message to the FEP to please pretend
     1416     6934                           the thing disconnected.  ALTRETs if local TERMINAL.
     1417     6935        */
     1418     6936    1   KQC$DISCSTA: ENTRY (PARM$,PARM) ALTRET;
     1419     6937        /**/
     1420     6938    1         CALL SETUP;
     1421     6939    1         CALL DISC ALTRET(ALTRT);
     1422     6940    1         RETURN;
     1423     6941    1   ALTRT:ALTRETURN;
     1424     6942        /**/
     1425     6943        /*F* NAME:         KQC$CLOSESTA
     1426     6944             PURPOSE:      To get rid of a station
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:210  
     1427     6945             CALL:         KQC$CLOSESTA (KQ$STA)
     1428     6946             INPUT:        See KQC$ACTSTA
     1429     6947             DESCRIPTION:  If the station is a DCB then it is deactivated.
     1430     6948                           Otherwise, KCD$RELTRM is called to put the terminal
     1431     6949                           in limbo.  Used when the comgroup is being shut
     1432     6950                           down due to the last DCB going away, and we want
     1433     6951                           to put terminals in limbo as opposed to disconnecting
     1434     6952                           them.  KCD$RELTRM makes it look to the comgroup as
     1435     6953                           if the thing is disconnecting (i.e. call KQP$DISC).
     1436     6954        */
     1437     6955    1   KQC$CLOSESTA: ENTRY (PARM$) ALTRET; /* !!Doesn't ALTRET!! */
     1438     6956        /**/
     1439     6957    1         CALL SETUP;
     1440     6958    1         CALL CLOSESTA;
     1441     6959    1         RETURN;
     1442     6960        /**/
     1443     6961        /*F* NAME:         KQC$ABTRD
     1444     6962             PURPOSE:      To abort a station's outstanding read, if any
     1445     6963             CALL:         KQC$ATBRD (KQ$STA,FPT_ACTIVATE.V)
     1446     6964             DESCRIPTION:  The station's pending read, if any, is to be
     1447     6965                           aborted with the passed TYC.
     1448     6966        */
     1449     6967    1   KQC$ABTRD: ENTRY (PARM$,PARM) ALTRET; /* !!Doesn't ALTRET!! */
     1450     6968        /**/
     1451     6969    1         CALL SETUP;
     1452     6970    1         CALL ABTRDP (ADDR(PARM)->B$$BIT36);
     1453     6971    1         RETURN;
     1454     6972        /**/
     1455     6973    1   SETUP: PROC;
     1456     6974    2         STA$=ADDR(PARM$);
     1457     6975    2         CG$=STA$->KQ$STA.CG$;
     1458     6976    2         IF STA$->KQ$STA.SAVIDSC
     1459     6977    2         THEN SAVLDCT$=ADDR(NIL);
     1460     6978    2         ELSE SAVLDCT$=STA$->KQ$STA.SAVLDCT$;
     1461     6979    2         IF STA$->KQ$STA.IDSC THEN LDCT$=ADDR(NIL);
     1462     6980    3         ELSE DO;
     1463     6981    3           LDCT$=STA$->KQ$STA.LDCT$;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:211  
     1464     6982    3           IF STA$->KQ$STA.TERM='1'B AND LDCT$ ~= ADDR(NIL)
     1465     6983    3           AND LDCT$->NK$LDCT.RLCID.LDCTX = 0
     1466     6984    3           THEN LDCT$=ADDR(NIL);        /* A connecting terminal...           */
     1467     6985    3           END;
     1468     6986    2         FPT$=ADDR(PARM);
     1469     6987    2         RETURN;
     1470     6988    2   END SETUP;
     1471     6989        %EJECT;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:212  
     1472     6990        /****************************************************************
     1473     6991        *****************************************************************/
     1474     6992        /*D* NAME:         ACT
     1475     6993             PURPOSE:      To activate a station
     1476     6994             INPUT:        See KQC$ACTSTA
     1477     6995             DESCRIPTION:  STA$, LDCT$ point to the station.  FPT$ points
     1478     6996                           to an ACTIVATE FPT.
     1479     6997                           LDCT$ may be ADDR(NIL).
     1480     6998        */
     1481     6999    1   ACT:  PROC;
     1482     7000    2         IF FPT$ ~= ADDR(NIL) THEN
     1483     7001    2          IF FPT$->FPT$ACTIVATE.FLUSH THEN CALL FLUSHC;
     1484     7002    2         IF LDCT$ = ADDR(NIL) THEN RETURN;
     1485     7003    2         IF LDCT$->NK$LDCT.RESCOD ~= NK_CGDCB THEN
     1486     7004    3           DO;
     1487     7005    3           IF FPT$ ~= ADDR(NIL) THEN
     1488     7006    4             DO;
     1489     7007                  %LOCK (G=STA$->KQ$STA.GATE);
     1490     7010    4             STA$->KQ$STA.DVBYTE=FPT$->FPT$ACTIVATE.DVBYTE;
     1491     7011                  %UNLOCK (G=STA$->KQ$STA.GATE);
     1492     7014    4             END;
     1493     7015    3           CALL KCD$ACTRM (LDCT$->NK$LDCT);
     1494     7016    3           END;
     1495     7017    2         ELSE
     1496     7018    3           DO;
     1497     7019                %LOCK (G=STA$->KQ$STA.GATE);
     1498     7022    3           LDCT$->NK$LDCT.LKFLG.ACTIVE='1'B;
     1499     7023    3           IF FPT$ ~= ADDR(NIL) THEN
     1500     7024    3            IF FPT$->FPT$ACTIVATE.ABTREAD THEN
     1501     7025    4              DO;
     1502     7026    4              STA$->KQ$STA.ABTET=FPT$->FPT$ACTIVATE.ABTET;
     1503     7027                   %UNLOCK (G=STA$->KQ$STA.GATE);
     1504     7030    4              CALL ABTRD (FPT$->FPT$ACTIVATE.ABTREAD);
     1505     7031                   %LOCK (G=STA$->KQ$STA.GATE);
     1506     7034    4              GOTO OPNCHK;
     1507     7035    4              END;
     1508     7036    3           STA$->KQ$STA.ACTTYC='0'B;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:213  
     1509     7037    3           STA$->KQ$STA.ABTET='0'B;
     1510     7038    3   OPNCHK: ;
     1511     7039    3           IF STA$->KQ$STA.OPNBLKED THEN
     1512     7040    4             DO;
     1513     7041    4             STA$->KQ$STA.OPNBLKED='0'B;
     1514     7042                  %UNLOCK (G=STA$->KQ$STA.GATE);
     1515     7045    4             CALL SSR$RUE (%SS_UQA,STA$->KQ$STA.USR#);
     1516     7046    4             END;
     1517     7047    3           ELSE
     1518     7048    4             DO;
     1519     7049                  %UNLOCK (G=STA$->KQ$STA.GATE);
     1520     7052    4             END;
     1521     7053    3           END;
     1522     7054    2         RETURN;
     1523     7055    2   END ACT;
     1524     7056        /****************************************************************
     1525     7057        *****************************************************************/
     1526     7058        /*D* NAME:         ABTRD
     1527     7059             PURPOSE:      To abort a DCB station's read
     1528     7060             DESCRIPTION:  The station's next or pending read is aborted
     1529     7061                           with tyc ABTTYC.
     1530     7062        */
     1531     7063    1   ABTRD: PROC (ABTTYC);
     1532     7064        /**/
     1533     7065    2   DCL ABTTYC BIT(36) ALIGNED;
     1534     7066    2   DCL PEND UBIN;
     1535     7067        /**/
     1536     7068    2         PEND=0;
     1537     7069    2         GOTO ABT;
     1538     7070        /**/
     1539     7071        /*D* NAME:         ABTRDP
     1540     7072             PURPOSE:      To abort a station's pending read, if any
     1541     7073             DESCRIPTION:  If the station has a read pending, then it is
     1542     7074                           aborted with the passed TYC;
     1543     7075        */
     1544     7076    2   ABTRDP: ENTRY (ABTTYC);
     1545     7077        /**/
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:214  
     1546     7078    2         PEND=1;
     1547     7079    2   ABT:  ;
     1548     7080    2         CALL KQT$LBT (CG$->KQ$CG);
     1549     7081              %LOCK (G=STA$->KQ$STA.GATE);
     1550     7084    2         IF NOT STA$->KQ$STA.IDSC THEN
     1551     7085    3           DO;
     1552     7086    3           IF PEND = 0 THEN STA$->KQ$STA.ACTTYC=ABTTYC;
     1553     7087    3           IF STA$->KQ$STA.RBLK$ ~= ADDR(NIL) THEN
     1554     7088    3            IF STA$->KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_PEND# THEN
     1555     7089    4              DO;
     1556     7090    4              STA$->KQ$STA.ACTTYC=ABTTYC;
     1557     7091    4              CALL KQR$VALIDATE (LDCT$->NK$LDCT.IOQ$->N$REQ);
     1558     7092    4              RETURN;
     1559     7093    4              END;
     1560     7094    3           END;
     1561     7095              %UNLOCK (G=STA$->KQ$STA.GATE);
     1562     7098    2         CALL KQT$UBT (CG$->KQ$CG);
     1563     7099    2         RETURN;
     1564     7100    2   END ABTRD;
     1565     7101        /****************************************************************
     1566     7102        *****************************************************************/
     1567     7103        /*D* NAME:    FLUSHC
     1568     7104             PURPOSE: To flush the queue of messages bound for STA$ if
     1569     7105                           the FPT says FLUSH.
     1570     7106        */
     1571     7107    1   FLUSHC: PROC;
     1572     7108        /**/
     1573     7109    2         IF FPT$ = ADDR(NIL) THEN RETURN;
     1574     7110    2         IF NOT FPT$->FPT$ACTIVATE.FLUSH THEN RETURN;
     1575     7111              %LOCK (G=STA$->KQ$STA.GATE);
     1576     7114    2         CALL KQL$DELMLH (CG$->KQ$CG,ADDR(STA$->KQ$STA.MLH));
     1577     7115              %UNLOCK (G=STA$->KQ$STA.GATE);
     1578     7118    2         RETURN;
     1579     7119    2   END FLUSHC;
     1580     7120        /****************************************************************
     1581     7121        *****************************************************************/
     1582     7122        /*D* NAME:         DACT
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:215  
     1583     7123             PURPOSE:      To deactivate a station
     1584     7124             INPUT:        See KQC$ACTSTA
     1585     7125             DESCRIPTION:  STA$, LDCT$ point to the station, FPT$ as for ACT.
     1586     7126                           Note LDCT$ may be NIL (i.e. station may not be
     1587     7127                           connected).
     1588     7128
     1589     7129                           For DCBs, ACTIVE is reset, we call ABTRDP with
     1590     7130                           DACT TYC, and then do FLUSH if required.
     1591     7131                           For TERMs, we call KCD$DACTRM to deactivate it,
     1592     7132                           and KQG$DACT to clean up the pending GET, and
     1593     7133                           then FLUSH if required.
     1594     7134        */
     1595     7135    1   DACT: PROC;
     1596     7136    2         IF LDCT$ ~= ADDR(NIL) THEN
     1597     7137    3           DO;
     1598     7138    3           IF LDCT$->NK$LDCT.RESCOD = NK_CGDCB THEN
     1599     7139    4             DO;
     1600     7140                  %LOCK (G=STA$->KQ$STA.GATE);
     1601     7143    4             STA$->KQ$STA.ACTTYC='0'B;
     1602     7144    4             STA$->KQ$STA.ABTET='0'B;
     1603     7145    4             LDCT$->NK$LDCT.LKFLG.ACTIVE='0'B;
     1604     7146    4             IF STA$->KQ$STA.OPNBLKED THEN
     1605     7147    5               DO;
     1606     7148    5               STA$->KQ$STA.OPNBLKED='0'B;
     1607     7149    5               STA$->KQ$STA.OPNREJ='1'B;
     1608     7150                    %UNLOCK (G=STA$->KQ$STA.GATE);
     1609     7153    5               CALL SSR$RUE (%SS_UQA,STA$->KQ$STA.USR#);
     1610     7154    5               END;
     1611     7155    4             ELSE
     1612     7156    5               DO;
     1613     7157                    %UNLOCK (G=STA$->KQ$STA.GATE);
     1614     7160    5               END;
     1615     7161    4             CALL ABTRDP (%TYC_DACT);
     1616     7162    4             END;
     1617     7163    3           ELSE IF LDCT$->NK$LDCT.LKFLG.ACTIVE THEN
     1618     7164    4              DO;
     1619     7165    4              CALL KCD$DACTRM (LDCT$->NK$LDCT);
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:216  
     1620     7166    4              CALL KQG$DACT (LDCT$->NK$LDCT);
     1621     7167    4              END;
     1622     7168    3           CALL KQT$VALREADS (CG$->KQ$CG);
     1623     7169    3           END;
     1624     7170    2         CALL FLUSHC;
     1625     7171    2         RETURN;
     1626     7172    2   END DACT;
     1627     7173        /****************************************************************
     1628     7174        *****************************************************************/
     1629     7175        /*D* NAME:         DISC
     1630     7176             PURPOSE:      To deactivate-disconnect a station
     1631     7177             INPUT:        See KQC$ACTSTA
     1632     7178             DESCRIPTION:  Calls DACT, then sends FEP msg if remote TERM;
     1633     7179                           ALTRETs if local TERM; does zip else for DCB.
     1634     7180        */
     1635     7181    1   DISC: PROC ALTRET;
     1636     7182    2         IF SAVLDCT$~=ADDR(NIL)
     1637     7183    2         THEN CALL KCD$DACDSC(SAVLDCT$->NK$LDCT);
     1638     7184    2         IF LDCT$ ~= ADDR(NIL) THEN
     1639     7185    3           DO;
     1640     7186    3           IF LDCT$->NK$LDCT.RESCOD = NK_CGDCB THEN
     1641     7187    4             DO;
     1642     7188    4             CALL DACT;
     1643     7189    4             RETURN;
     1644     7190    4             END;
     1645     7191    3           IF LDCT$->NK$LDCT.RLCID.NODE = 0 THEN
     1646     7192    4             DO;
     1647     7193    4             CALL DACT;
     1648     7194    4             ALTRETURN;
     1649     7195    4             END;
     1650     7196    3           CALL KCD$DACDSC (LDCT$->NK$LDCT);
     1651     7197    3           CALL KQT$VALREADS (CG$->KQ$CG);
     1652     7198    3           END;
     1653     7199    2         CALL FLUSHC;
     1654     7200    2         RETURN;
     1655     7201    2   END DISC;
     1656     7202        /****************************************************************
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:217  
     1657     7203        *****************************************************************/
     1658     7204        /*D* NAME:         CLOSESTA
     1659     7205             PURPOSE:      To 'close' a station
     1660     7206             INPUT:        See KQC$ACTSTA
     1661     7207             DESCRIPTION:  STA$ points to the station.  See *F* for KQC$CLOSESTA.
     1662     7208        */
     1663     7209    1   CLOSESTA: PROC;
     1664     7210    2         IF SAVLDCT$~=ADDR(NIL)
     1665     7211    2         THEN CALL KCD$RELTRM(SAVLDCT$->NK$LDCT);
     1666     7212    2         IF LDCT$ ~= ADDR(NIL) THEN
     1667     7213    3           DO;
     1668     7214    3           IF LDCT$->NK$LDCT.RESCOD = NK_CGDCB THEN CALL DACT;
     1669     7215    3           ELSE
     1670     7216    4            IF LDCT$->NK$LDCT.RESCOD = NK_OSISTA THEN DO;
     1671     7217                   /* 'close' of NK_OSISTA means abort GET then disconnect */
     1672     7218    4              CALL KQG$DACT (LDCT$->NK$LDCT);
     1673     7219    4              CALL KQT$VALREADS (CG$->KQ$CG);
     1674     7220    4              CALL KIS$OSI_DACT (LDCT$->NK$LDCT);  /* releases LDCT */
     1675     7221    4              CG$->KQ$CG.STATS.NUMTERMS = CG$->KQ$CG.STATS.NUMTERMS - 1;
     1676     7222    4              END;
     1677     7223    3            ELSE
     1678     7224    4              DO;
     1679     7225    4              CALL KCD$RELTRM (LDCT$->NK$LDCT);
     1680     7226    4              CALL KQT$VALREADS (CG$->KQ$CG);
     1681     7227    4              END;
     1682     7228    3           END;
     1683     7229    2         RETURN;
     1684     7230    2   END CLOSESTA;
     1685     7231    1   END KQC$ACTSTA;
     1686     7232        %EOD;

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:218  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQC$ACTSTA.

   Procedure KQC$ACTSTA requires 454 words for executable code.
   Procedure KQC$ACTSTA requires 24 words of local(AUTO) storage.

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:219  

 Object Unit name= KQC$ACTSTA                                 File name= KQC$CTL.:E05TOU
 UTS= JUL 30 '97 01:27:04.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  KQC$ACTSTA
    1   Proc  even  none   454    706  KQC$ACTSTA
    2  RoData even  none     7      7  KQC$ACTSTA

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KQC$ACTSTA
     1      7          yes     yes      Std        2  KQC$DACTSTA
     1     16          yes     yes      Std        2  KQC$DISCSTA
     1     26          yes     yes      Std        1  KQC$CLOSESTA
     1     35          yes     yes      Std        2  KQC$ABTRD
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:220  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
         yes           Std       1 KCD$ACTRM
         yes           Std       4 SSR$RUE
 yes     yes           Std       1 KQT$LBT
 yes     yes           Std       1 KQR$VALIDATE
 yes     yes           Std       1 KQT$UBT
 yes     yes           Std       2 KQL$DELMLH
         yes           Std       1 KCD$DACTRM
 yes     yes           Std       1 KQG$DACT
 yes     yes           Std       1 KQT$VALREADS
         yes           Std       1 KCD$DACDSC
         yes           Std       1 KCD$RELTRM
         yes           Std       1 KIS$OSI_DACT
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:221  


     1286        1        /*T***********************************************************/
     1287        2        /*T*                                                         */
     1288        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1289        4        /*T*                                                         */
     1290        5        /*T***********************************************************/
     1291        6        %EJECT;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:222  
     1292        7        /**/
     1293        8        /*F* NAME:         KQC$ACTSTA
     1294        9             PURPOSE:      To activate a station
     1295       10             CALL:         KQC$ACTSTA (KQ$STA,FPT_ACTIVATE.V)   ...FPT optional
     1296       11             INPUT:        KQ$STA.LOCKCNT counted up
     1297       12                           KQ$STA.GATE unlocked
     1298       13             DESCRIPTION:  Activates the
     1299       14                           station, and does what the FPT says.
     1300       15                           Must be called on behalf of user.
     1301       16                           Does not count down LOCKCNT.
     1302       17
     1303       18                           Calls KCD$ACTRM if TERMINAL.
     1304       19        */
     1305       20        KQC$ACTSTA: PROC (PARM$,PARM) ALTRET; /* !!Doesn't ALTRET!! */

     20  1 000000   000000 700200 xent  KQC$ACTSTA   TSX0  ! X66_AUTO_2
         1 000001   000030 000002                    ZERO    24,2

     1306       21        /**/
     1307       22        /**/
     1308       23
     1309       24
     1310       25
     1311       26        /**/
     1312       27        /* INCLUDES */
     1313       28        /**/
     1314       29        %INCLUDE KQ_SUBS_C;
     1315      329        %INCLUDE KQ_MAC_C;
     1316     2879        %INCLUDE HF_LOCK_C;
     1317     2893        %INCLUDE KQ_DATA_R;
     1318     3725        %INCLUDE CP_6_SUBS;
     1319     4265        %INCLUDE NK$LDCT;
     1320     4367        %INCLUDE KC$CP6V_C;
     1321     4487        %INCLUDE KC_CP6;
     1322     5047        %INCLUDE N$REQ;
     1323     5121        %INCLUDE KC_DATA_R;
     1324     5134        %INCLUDE NK_SUBS;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:223  
     1325     5159        %INCLUDE SS_SCHED_C;
     1326     5392
     1327     5393
     1328     5394
     1329     5395        /**/
     1330     5396        /* PARAMETERS */
     1331     5397        /**/
     1332     5398    1   DCL PARM$ PTR;
     1333     5399    1   DCL PARM UBIN WORD ALIGNED;
     1334     5400    1   DCL PARMR BIT(36) ALIGNED;
     1335     5401
     1336     5402
     1337     5403
     1338     5404        /**/
     1339     5405        /* BASED STRUCTURES */
     1340     5406        /**/
     1341     5407        %NK$LDCT;
     1342     5453        %N$REQ;
     1343     5511        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
     1344     6250        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
     1345     6589        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
     1346     6627        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS=BASED);
     1347     6813        %FPT$ACTIVATE_V (FPTN=FPT$ACTIVATE);
     1348     6819    1   DCL B$$BIT36 BIT(36) BASED ALIGNED;
     1349     6820
     1350     6821
     1351     6822
     1352     6823        /**/
     1353     6824        /* AUTO */
     1354     6825        /**/
     1355     6826    1   DCL CG$ PTR;
     1356     6827    1   DCL LDCT$ PTR;
     1357     6828    1   DCL SAVLDCT$ PTR;
     1358     6829    1   DCL STA$ PTR;
     1359     6830    1   DCL FPT$ PTR;
     1360     6831
     1361     6832
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:224  
     1362     6833
     1363     6834        /**/
     1364     6835        /* REFS */
     1365     6836        /**/
     1366     6837    1   DCL KCD$ACTRM     ENTRY(1);
     1367     6838    1   DCL KCD$DACDSC    ENTRY(1);
     1368     6839    1   DCL KCD$DACTRM    ENTRY(1);
     1369     6840    1   DCL KCD$RELTRM    ENTRY(1);
     1370     6841    1   DCL KQG$DACT      ENTRY(1) ALTRET;
     1371     6842    1   DCL KQL$DELMLH    ENTRY(2) ALTRET;
     1372     6843    1   DCL KQR$VALIDATE  ENTRY(1) ALTRET;
     1373     6844    1   DCL KQT$LBT       ENTRY(1) ALTRET;
     1374     6845    1   DCL KQT$UBT       ENTRY(1) ALTRET;
     1375     6846    1   DCL KQT$VALREADS  ENTRY(1) ALTRET;
     1376     6847    1   DCL SSR$RUE       ENTRY(4);
     1377     6848    1   DCL KIS$OSI_DACT  ENTRY(1);
     1378     6849
     1379     6850
     1380     6851
     1381     6852        /**/
     1382     6853        /* SUBS */
     1383     6854        /**/
     1384     6855        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
     1385     6856        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
     1386     6857        %SUB KQ$STREE="CG$->KQ$CG.STREE";
     1387     6858        %SUB KQ$DTREE="CG$->KQ$CG.DTREE";
     1388     6859        %EQU_CG;
     1389     6907        %EJECT;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:225  
     1390     6908    1         CALL SETUP;

   6908  1 000002   000046 701000 1                  TSX1    SETUP
         1 000003   000000 011000                    NOP     0

     1391     6909    1         CALL ACT;

   6909  1 000004   000111 701000 1                  TSX1    ACT
         1 000005   000000 011000                    NOP     0

     1392     6910    1         RETURN;

   6910  1 000006   000000 702200 xent               TSX2  ! X66_ARET

     1393     6911        /**/
     1394     6912        /*F* NAME:         KQC$DACTSTA
     1395     6913             PURPOSE:      To deactivate a station
     1396     6914             CALL:         KQC$DACTSTA (KQ$STA,FPT_ACTIVATE.V)   ...FPT optional
     1397     6915             INPUT:        See KQC$ACTSTA
     1398     6916             DESCRIPTION:  Called as KQC$ACTSTA.  Deactivates
     1399     6917                           the station, aborting its current read if there
     1400     6918                           is one pending.  Validates every DCB read if
     1401     6919                           RAS is zero.
     1402     6920        */
     1403     6921    1   KQC$DACTSTA: ENTRY (PARM$,PARM) ALTRET; /* !!Doesn't ALTRET!! */

   6921  1 000007   000000 700200 xent  KQC$DACTSTA  TSX0  ! X66_AUTO_2
         1 000010   000030 000002                    ZERO    24,2

     1404     6922        /**/
     1405     6923    1         CALL SETUP;

   6923  1 000011   000046 701000 1                  TSX1    SETUP
         1 000012   000000 011000                    NOP     0

     1406     6924    1         CALL DACT;

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:226  
   6924  1 000013   000443 701000 1                  TSX1    DACT
         1 000014   000000 011000                    NOP     0

     1407     6925    1         RETURN;

   6925  1 000015   000000 702200 xent               TSX2  ! X66_ARET

     1408     6926        /**/
     1409     6927        /*F* NAME:         KQC$DISCSTA
     1410     6928             PURPOSE:      To deactivate-disconnect a station
     1411     6929             CALL:         KQC$DISCSTA (KQ$STA,FPT_ACTIVATE.V)   ...FPT optional
     1412     6930             INPUT:        See KQC$ACTSTA
     1413     6931             DESCTRIPTION: Called as KQC$DACTSTA.  First does what that
     1414     6932                           does (i.e. deactivate).  Then, for remote terminals
     1415     6933                           only, sends the message to the FEP to please pretend
     1416     6934                           the thing disconnected.  ALTRETs if local TERMINAL.
     1417     6935        */
     1418     6936    1   KQC$DISCSTA: ENTRY (PARM$,PARM) ALTRET;

   6936  1 000016   000000 700200 xent  KQC$DISCSTA  TSX0  ! X66_AUTO_2
         1 000017   000030 000002                    ZERO    24,2

     1419     6937        /**/
     1420     6938    1         CALL SETUP;

   6938  1 000020   000046 701000 1                  TSX1    SETUP
         1 000021   000000 011000                    NOP     0

     1421     6939    1         CALL DISC ALTRET(ALTRT);

   6939  1 000022   000560 701000 1                  TSX1    DISC
         1 000023   000025 702000 1                  TSX2    ALTRT

     1422     6940    1         RETURN;

   6940  1 000024   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:227  
     1423     6941    1   ALTRT:ALTRETURN;

   6941  1 000025   000000 702200 xent  ALTRT        TSX2  ! X66_AALT

     1424     6942        /**/
     1425     6943        /*F* NAME:         KQC$CLOSESTA
     1426     6944             PURPOSE:      To get rid of a station
     1427     6945             CALL:         KQC$CLOSESTA (KQ$STA)
     1428     6946             INPUT:        See KQC$ACTSTA
     1429     6947             DESCRIPTION:  If the station is a DCB then it is deactivated.
     1430     6948                           Otherwise, KCD$RELTRM is called to put the terminal
     1431     6949                           in limbo.  Used when the comgroup is being shut
     1432     6950                           down due to the last DCB going away, and we want
     1433     6951                           to put terminals in limbo as opposed to disconnecting
     1434     6952                           them.  KCD$RELTRM makes it look to the comgroup as
     1435     6953                           if the thing is disconnecting (i.e. call KQP$DISC).
     1436     6954        */
     1437     6955    1   KQC$CLOSESTA: ENTRY (PARM$) ALTRET; /* !!Doesn't ALTRET!! */

   6955  1 000026   000000 700200 xent  KQC$CLOSESTA TSX0  ! X66_AUTO_2
         1 000027   000030 000002                    ZERO    24,2

     1438     6956        /**/
     1439     6957    1         CALL SETUP;

   6957  1 000030   000046 701000 1                  TSX1    SETUP
         1 000031   000000 011000                    NOP     0

     1440     6958    1         CALL CLOSESTA;

   6958  1 000032   000627 701000 1                  TSX1    CLOSESTA
         1 000033   000000 011000                    NOP     0

     1441     6959    1         RETURN;

   6959  1 000034   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:228  
     1442     6960        /**/
     1443     6961        /*F* NAME:         KQC$ABTRD
     1444     6962             PURPOSE:      To abort a station's outstanding read, if any
     1445     6963             CALL:         KQC$ATBRD (KQ$STA,FPT_ACTIVATE.V)
     1446     6964             DESCRIPTION:  The station's pending read, if any, is to be
     1447     6965                           aborted with the passed TYC.
     1448     6966        */
     1449     6967    1   KQC$ABTRD: ENTRY (PARM$,PARM) ALTRET; /* !!Doesn't ALTRET!! */

   6967  1 000035   000000 700200 xent  KQC$ABTRD    TSX0  ! X66_AUTO_2
         1 000036   000030 000002                    ZERO    24,2

     1450     6968        /**/
     1451     6969    1         CALL SETUP;

   6969  1 000037   000046 701000 1                  TSX1    SETUP
         1 000040   000000 011000                    NOP     0

     1452     6970    1         CALL ABTRDP (ADDR(PARM)->B$$BIT36);

   6970  1 000041   200004 236100                    LDQ     @PARM,,AUTO
         1 000042   200021 756100                    STQ     FPT$+7,,AUTO
         1 000043   000310 701000 1                  TSX1    ABTRDP
         1 000044   000000 011000                    NOP     0

     1453     6971    1         RETURN;

   6971  1 000045   000000 702200 xent               TSX2  ! X66_ARET

     1454     6972        /**/
     1455     6973    1   SETUP: PROC;

   6973  1 000046   200014 741300       SETUP        STX1  ! FPT$+2,,AUTO

     1456     6974    2         STA$=ADDR(PARM$);

   6974  1 000047   200003 236100                    LDQ     @PARM$,,AUTO
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:229  
         1 000050   200011 756100                    STQ     STA$,,AUTO

     1457     6975    2         CG$=STA$->KQ$STA.CG$;

   6975  1 000051   200011 470500                    LDP0    STA$,,AUTO
         1 000052   000007 236100                    LDQ     7,,PR0
         1 000053   200006 756100                    STQ     CG$,,AUTO

     1458     6976    2         IF STA$->KQ$STA.SAVIDSC

   6976  1 000054   000023 236100                    LDQ     19,,PR0
         1 000055   000400 316007                    CANQ    256,DL
         1 000056   000062 600000 1                  TZE     s:6978

     1459     6977    2         THEN SAVLDCT$=ADDR(NIL);

   6977  1 000057   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000060   200010 756100                    STQ     SAVLDCT$,,AUTO
         1 000061   000064 710000 1                  TRA     s:6979

     1460     6978    2         ELSE SAVLDCT$=STA$->KQ$STA.SAVLDCT$;

   6978  1 000062   000031 236100                    LDQ     25,,PR0
         1 000063   200010 756100                    STQ     SAVLDCT$,,AUTO

     1461     6979    2         IF STA$->KQ$STA.IDSC THEN LDCT$=ADDR(NIL);

   6979  1 000064   000020 234100                    SZN     16,,PR0
         1 000065   000071 605000 1                  TPL     s:6981

   6979  1 000066   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000067   200007 756100                    STQ     LDCT$,,AUTO
         1 000070   000106 710000 1                  TRA     s:6986

     1462     6980    3         ELSE DO;

     1463     6981    3           LDCT$=STA$->KQ$STA.LDCT$;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:230  

   6981  1 000071   000010 236100                    LDQ     8,,PR0
         1 000072   200007 756100                    STQ     LDCT$,,AUTO

     1464     6982    3           IF STA$->KQ$STA.TERM='1'B AND LDCT$ ~= ADDR(NIL)

   6982  1 000073   000020 236100                    LDQ     16,,PR0
         1 000074   040000 316003                    CANQ    16384,DU
         1 000075   000106 600000 1                  TZE     s:6986
         1 000076   200007 236100                    LDQ     LDCT$,,AUTO
         1 000077   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000100   000106 600000 1                  TZE     s:6986
         1 000101   200007 471500                    LDP1    LDCT$,,AUTO
         1 000102   100015 720100                    LXL0    13,,PR1
         1 000103   000106 601000 1                  TNZ     s:6986

     1465     6983    3           AND LDCT$->NK$LDCT.RLCID.LDCTX = 0
     1466     6984    3           THEN LDCT$=ADDR(NIL);        /* A connecting terminal...           */

   6984  1 000104   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000105   200007 756100                    STQ     LDCT$,,AUTO

     1467     6985    3           END;

     1468     6986    2         FPT$=ADDR(PARM);

   6986  1 000106   200004 236100                    LDQ     @PARM,,AUTO
         1 000107   200012 756100                    STQ     FPT$,,AUTO

     1469     6987    2         RETURN;

   6987  1 000110   000001 702211                    TSX2  ! 1,X1

     1470     6988    2   END SETUP;
     1471     6989        %EJECT;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:231  
     1472     6990        /****************************************************************
     1473     6991        *****************************************************************/
     1474     6992        /*D* NAME:         ACT
     1475     6993             PURPOSE:      To activate a station
     1476     6994             INPUT:        See KQC$ACTSTA
     1477     6995             DESCRIPTION:  STA$, LDCT$ point to the station.  FPT$ points
     1478     6996                           to an ACTIVATE FPT.
     1479     6997                           LDCT$ may be ADDR(NIL).
     1480     6998        */
     1481     6999    1   ACT:  PROC;

   6999  1 000111   200014 741300       ACT          STX1  ! FPT$+2,,AUTO

     1482     7000    2         IF FPT$ ~= ADDR(NIL) THEN

   7000  1 000112   200012 236100                    LDQ     FPT$,,AUTO
         1 000113   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000114   000123 600000 1                  TZE     s:7002

     1483     7001    2          IF FPT$->FPT$ACTIVATE.FLUSH THEN CALL FLUSHC;

   7001  1 000115   200012 470500                    LDP0    FPT$,,AUTO
         1 000116   000002 236100                    LDQ     2,,PR0
         1 000117   200000 316003                    CANQ    65536,DU
         1 000120   000123 600000 1                  TZE     s:7002

   7001  1 000121   000376 701000 1                  TSX1    FLUSHC
         1 000122   000000 011000                    NOP     0

     1484     7002    2         IF LDCT$ = ADDR(NIL) THEN RETURN;

   7002  1 000123   200007 236100                    LDQ     LDCT$,,AUTO
         1 000124   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000125   000130 601000 1                  TNZ     s:7003

   7002  1 000126   200014 221300                    LDX1  ! FPT$+2,,AUTO
         1 000127   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:232  

     1485     7003    2         IF LDCT$->NK$LDCT.RESCOD ~= NK_CGDCB THEN

   7003  1 000130   200007 470500                    LDP0    LDCT$,,AUTO
         1 000131   000006 236100                    LDQ     6,,PR0
         1 000132   000017 376007                    ANQ     15,DL
         1 000133   000004 116007                    CMPQ    4,DL
         1 000134   000170 600000 1                  TZE     s:7020

     1486     7004    3           DO;

     1487     7005    3           IF FPT$ ~= ADDR(NIL) THEN

   7005  1 000135   200012 236100                    LDQ     FPT$,,AUTO
         1 000136   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000137   000163 600000 1                  TZE     s:7015

     1488     7006    4             DO;

     1489     7007                  %LOCK (G=STA$->KQ$STA.GATE);

   7008  1 000140   200011 236100                    LDQ     STA$,,AUTO
         1 000141   000016 036003                    ADLQ    14,DU
         1 000142   200024 756100                    STQ     PEND+2,,AUTO
         1 000143   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000144   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000145   000000 701000 xent               TSX1    HFC$LOCK
         1 000146   000000 011000                    NOP     0

     1490     7010    4             STA$->KQ$STA.DVBYTE=FPT$->FPT$ACTIVATE.DVBYTE;

   7010  1 000147   200011 470500                    LDP0    STA$,,AUTO
         1 000150   200012 471500                    LDP1    FPT$,,AUTO
         1 000151   100000 236100                    LDQ     0,,PR1
         1 000152   000022 736000                    QLS     18
         1 000153   000023 552120                    STBQ    19,'20'O,PR0

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:233  
     1491     7011                  %UNLOCK (G=STA$->KQ$STA.GATE);

   7012  1 000154   200011 236100                    LDQ     STA$,,AUTO
         1 000155   000016 036003                    ADLQ    14,DU
         1 000156   200024 756100                    STQ     PEND+2,,AUTO
         1 000157   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000160   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000161   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000162   000000 011000                    NOP     0

     1492     7014    4             END;

     1493     7015    3           CALL KCD$ACTRM (LDCT$->NK$LDCT);

   7015  1 000163   200007 630500                    EPPR0   LDCT$,,AUTO
         1 000164   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000165   000000 701000 xent               TSX1    KCD$ACTRM
         1 000166   000000 011000                    NOP     0

     1494     7016    3           END;

   7016  1 000167   000303 710000 1                  TRA     s:7054

     1495     7017    2         ELSE
     1496     7018    3           DO;

     1497     7019                %LOCK (G=STA$->KQ$STA.GATE);

   7020  1 000170   200011 236100                    LDQ     STA$,,AUTO
         1 000171   000016 036003                    ADLQ    14,DU
         1 000172   200024 756100                    STQ     PEND+2,,AUTO
         1 000173   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000174   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000175   000000 701000 xent               TSX1    HFC$LOCK
         1 000176   000000 011000                    NOP     0

     1498     7022    3           LDCT$->NK$LDCT.LKFLG.ACTIVE='1'B;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:234  

   7022  1 000177   200007 470500                    LDP0    LDCT$,,AUTO
         1 000200   000040 236003                    LDQ     32,DU
         1 000201   000011 256100                    ORSQ    9,,PR0

     1499     7023    3           IF FPT$ ~= ADDR(NIL) THEN

   7023  1 000202   200012 236100                    LDQ     FPT$,,AUTO
         1 000203   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000204   000242 600000 1                  TZE     s:7036

     1500     7024    3            IF FPT$->FPT$ACTIVATE.ABTREAD THEN

   7024  1 000205   200012 471500                    LDP1    FPT$,,AUTO
         1 000206   100001 235100                    LDA     1,,PR1
         1 000207   000242 600000 1                  TZE     s:7036

     1501     7025    4              DO;

     1502     7026    4              STA$->KQ$STA.ABTET=FPT$->FPT$ACTIVATE.ABTET;

   7026  1 000210   200011 473500                    LDP3    STA$,,AUTO
         1 000211   100002 236100                    LDQ     2,,PR1
         1 000212   000005 772000                    QRL     5
         1 000213   300020 676100                    ERQ     16,,PR3
         1 000214   002000 376003                    ANQ     1024,DU
         1 000215   300020 656100                    ERSQ    16,,PR3

     1503     7027                   %UNLOCK (G=STA$->KQ$STA.GATE);

   7028  1 000216   200011 236100                    LDQ     STA$,,AUTO
         1 000217   000016 036003                    ADLQ    14,DU
         1 000220   200024 756100                    STQ     PEND+2,,AUTO
         1 000221   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000222   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000223   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000224   000000 011000                    NOP     0
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:235  

     1504     7030    4              CALL ABTRD (FPT$->FPT$ACTIVATE.ABTREAD);

   7030  1 000225   200012 236100                    LDQ     FPT$,,AUTO
         1 000226   000001 036003                    ADLQ    1,DU
         1 000227   200021 756100                    STQ     FPT$+7,,AUTO
         1 000230   000305 701000 1                  TSX1    ABTRD
         1 000231   000000 011000                    NOP     0

     1505     7031                   %LOCK (G=STA$->KQ$STA.GATE);

   7032  1 000232   200011 236100                    LDQ     STA$,,AUTO
         1 000233   000016 036003                    ADLQ    14,DU
         1 000234   200024 756100                    STQ     PEND+2,,AUTO
         1 000235   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000236   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000237   000000 701000 xent               TSX1    HFC$LOCK
         1 000240   000000 011000                    NOP     0

     1506     7034    4              GOTO OPNCHK;

   7034  1 000241   000246 710000 1                  TRA     OPNCHK

     1507     7035    4              END;
     1508     7036    3           STA$->KQ$STA.ACTTYC='0'B;

   7036  1 000242   200011 471500                    LDP1    STA$,,AUTO
         1 000243   100013 450100                    STZ     11,,PR1

     1509     7037    3           STA$->KQ$STA.ABTET='0'B;

   7037  1 000244   000000 236000 2                  LDQ     0
         1 000245   100020 356100                    ANSQ    16,,PR1

   7037  1 000246                       OPNCHK       null
     1510     7038    3   OPNCHK: ;
     1511     7039    3           IF STA$->KQ$STA.OPNBLKED THEN
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:236  

   7039  1 000246   200011 470500                    LDP0    STA$,,AUTO
         1 000247   000023 236100                    LDQ     19,,PR0
         1 000250   020000 316007                    CANQ    8192,DL
         1 000251   000274 600000 1                  TZE     s:7050

     1512     7040    4             DO;

     1513     7041    4             STA$->KQ$STA.OPNBLKED='0'B;

   7041  1 000252   000001 236000 2                  LDQ     1
         1 000253   000023 356100                    ANSQ    19,,PR0

     1514     7042                  %UNLOCK (G=STA$->KQ$STA.GATE);

   7043  1 000254   200011 236100                    LDQ     STA$,,AUTO
         1 000255   000016 036003                    ADLQ    14,DU
         1 000256   200024 756100                    STQ     PEND+2,,AUTO
         1 000257   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000260   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000261   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000262   000000 011000                    NOP     0

     1515     7045    4             CALL SSR$RUE (%SS_UQA,STA$->KQ$STA.USR#);

   7045  1 000263   200011 236100                    LDQ     STA$,,AUTO
         1 000264   000003 036000 2                  ADLQ    3
         1 000265   000004 235000 2                  LDA     4
         1 000266   200024 757100                    STAQ    PEND+2,,AUTO
         1 000267   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000270   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000271   000000 701000 xent               TSX1    SSR$RUE
         1 000272   000000 011000                    NOP     0

     1516     7046    4             END;

   7046  1 000273   000303 710000 1                  TRA     s:7054
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:237  

     1517     7047    3           ELSE
     1518     7048    4             DO;

     1519     7049                  %UNLOCK (G=STA$->KQ$STA.GATE);

   7050  1 000274   200011 236100                    LDQ     STA$,,AUTO
         1 000275   000016 036003                    ADLQ    14,DU
         1 000276   200024 756100                    STQ     PEND+2,,AUTO
         1 000277   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000300   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000301   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000302   000000 011000                    NOP     0

     1520     7052    4             END;

     1521     7053    3           END;

     1522     7054    2         RETURN;

   7054  1 000303   200014 221300                    LDX1  ! FPT$+2,,AUTO
         1 000304   000001 702211                    TSX2  ! 1,X1

     1523     7055    2   END ACT;
     1524     7056        /****************************************************************
     1525     7057        *****************************************************************/
     1526     7058        /*D* NAME:         ABTRD
     1527     7059             PURPOSE:      To abort a DCB station's read
     1528     7060             DESCRIPTION:  The station's next or pending read is aborted
     1529     7061                           with tyc ABTTYC.
     1530     7062        */
     1531     7063    1   ABTRD: PROC (ABTTYC);

   7063  1 000305   200020 741300       ABTRD        STX1  ! FPT$+6,,AUTO

     1532     7064        /**/
     1533     7065    2   DCL ABTTYC BIT(36) ALIGNED;
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:238  
     1534     7066    2   DCL PEND UBIN;
     1535     7067        /**/
     1536     7068    2         PEND=0;

   7068  1 000306   200022 450100                    STZ     PEND,,AUTO

     1537     7069    2         GOTO ABT;

   7069  1 000307   000313 710000 1                  TRA     ABT

     1538     7070        /**/
     1539     7071        /*D* NAME:         ABTRDP
     1540     7072             PURPOSE:      To abort a station's pending read, if any
     1541     7073             DESCRIPTION:  If the station has a read pending, then it is
     1542     7074                           aborted with the passed TYC;
     1543     7075        */
     1544     7076    2   ABTRDP: ENTRY (ABTTYC);

   7076  1 000310   200020 741300       ABTRDP       STX1  ! FPT$+6,,AUTO

     1545     7077        /**/
     1546     7078    2         PEND=1;

   7078  1 000311   000001 235007                    LDA     1,DL
         1 000312   200022 755100                    STA     PEND,,AUTO

   7078  1 000313                       ABT          null
     1547     7079    2   ABT:  ;
     1548     7080    2         CALL KQT$LBT (CG$->KQ$CG);

   7080  1 000313   200006 630500                    EPPR0   CG$,,AUTO
         1 000314   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000315   000000 701000 xent               TSX1    KQT$LBT
         1 000316   000000 011000                    NOP     0

     1549     7081              %LOCK (G=STA$->KQ$STA.GATE);

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:239  
   7082  1 000317   200011 236100                    LDQ     STA$,,AUTO
         1 000320   000016 036003                    ADLQ    14,DU
         1 000321   200024 756100                    STQ     PEND+2,,AUTO
         1 000322   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000323   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000324   000000 701000 xent               TSX1    HFC$LOCK
         1 000325   000000 011000                    NOP     0

     1550     7084    2         IF NOT STA$->KQ$STA.IDSC THEN

   7084  1 000326   200011 470500                    LDP0    STA$,,AUTO
         1 000327   000020 234100                    SZN     16,,PR0
         1 000330   000361 604000 1                  TMI     s:7096

     1551     7085    3           DO;

     1552     7086    3           IF PEND = 0 THEN STA$->KQ$STA.ACTTYC=ABTTYC;

   7086  1 000331   200022 235100                    LDA     PEND,,AUTO
         1 000332   000336 601000 1                  TNZ     s:7087

   7086  1 000333   200021 471500                    LDP1    @ABTTYC,,AUTO
         1 000334   100000 236100                    LDQ     0,,PR1
         1 000335   000013 756100                    STQ     11,,PR0

     1553     7087    3           IF STA$->KQ$STA.RBLK$ ~= ADDR(NIL) THEN

   7087  1 000336   000011 236100                    LDQ     9,,PR0
         1 000337   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000340   000361 600000 1                  TZE     s:7096

     1554     7088    3            IF STA$->KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_PEND# THEN

   7088  1 000341   000011 471500                    LDP1    9,,PR0
         1 000342   100001 220100                    LDX0    1,,PR1
         1 000343   000002 100003                    CMPX0   2,DU
         1 000344   000361 601000 1                  TNZ     s:7096
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:240  

     1555     7089    4              DO;

     1556     7090    4              STA$->KQ$STA.ACTTYC=ABTTYC;

   7090  1 000345   200021 473500                    LDP3    @ABTTYC,,AUTO
         1 000346   300000 236100                    LDQ     0,,PR3
         1 000347   000013 756100                    STQ     11,,PR0

     1557     7091    4              CALL KQR$VALIDATE (LDCT$->NK$LDCT.IOQ$->N$REQ);

   7091  1 000350   200007 474500                    LDP4    LDCT$,,AUTO
         1 000351   400001 475500                    LDP5    1,,PR4
         1 000352   200024 455500                    STP5    PEND+2,,AUTO
         1 000353   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000354   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000355   000000 701000 xent               TSX1    KQR$VALIDATE
         1 000356   000000 011000                    NOP     0

     1558     7092    4              RETURN;

   7092  1 000357   200020 221300                    LDX1  ! FPT$+6,,AUTO
         1 000360   000001 702211                    TSX2  ! 1,X1

     1559     7093    4              END;
     1560     7094    3           END;
     1561     7095              %UNLOCK (G=STA$->KQ$STA.GATE);

   7096  1 000361   200011 236100                    LDQ     STA$,,AUTO
         1 000362   000016 036003                    ADLQ    14,DU
         1 000363   200024 756100                    STQ     PEND+2,,AUTO
         1 000364   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000365   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000366   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000367   000000 011000                    NOP     0

     1562     7098    2         CALL KQT$UBT (CG$->KQ$CG);
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:241  

   7098  1 000370   200006 630500                    EPPR0   CG$,,AUTO
         1 000371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000372   000000 701000 xent               TSX1    KQT$UBT
         1 000373   000000 011000                    NOP     0

     1563     7099    2         RETURN;

   7099  1 000374   200020 221300                    LDX1  ! FPT$+6,,AUTO
         1 000375   000001 702211                    TSX2  ! 1,X1

     1564     7100    2   END ABTRD;
     1565     7101        /****************************************************************
     1566     7102        *****************************************************************/
     1567     7103        /*D* NAME:    FLUSHC
     1568     7104             PURPOSE: To flush the queue of messages bound for STA$ if
     1569     7105                           the FPT says FLUSH.
     1570     7106        */
     1571     7107    1   FLUSHC: PROC;

   7107  1 000376   200020 741300       FLUSHC       STX1  ! FPT$+6,,AUTO

     1572     7108        /**/
     1573     7109    2         IF FPT$ = ADDR(NIL) THEN RETURN;

   7109  1 000377   200012 236100                    LDQ     FPT$,,AUTO
         1 000400   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000401   000403 601000 1                  TNZ     s:7110

   7109  1 000402   000001 702211                    TSX2  ! 1,X1

     1574     7110    2         IF NOT FPT$->FPT$ACTIVATE.FLUSH THEN RETURN;

   7110  1 000403   200012 470500                    LDP0    FPT$,,AUTO
         1 000404   000002 236100                    LDQ     2,,PR0
         1 000405   200000 316003                    CANQ    65536,DU
         1 000406   000410 601000 1                  TNZ     s:7112
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:242  

   7110  1 000407   000001 702211                    TSX2  ! 1,X1

     1575     7111              %LOCK (G=STA$->KQ$STA.GATE);

   7112  1 000410   200011 236100                    LDQ     STA$,,AUTO
         1 000411   000016 036003                    ADLQ    14,DU
         1 000412   200024 756100                    STQ     PEND+2,,AUTO
         1 000413   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000414   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000415   000000 701000 xent               TSX1    HFC$LOCK
         1 000416   000000 011000                    NOP     0

     1576     7114    2         CALL KQL$DELMLH (CG$->KQ$CG,ADDR(STA$->KQ$STA.MLH));

   7114  1 000417   200011 236100                    LDQ     STA$,,AUTO
         1 000420   000034 036003                    ADLQ    28,DU
         1 000421   200024 756100                    STQ     PEND+2,,AUTO
         1 000422   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000423   200027 450500                    STP0    PEND+5,,AUTO
         1 000424   200006 236100                    LDQ     CG$,,AUTO
         1 000425   200026 756100                    STQ     PEND+4,,AUTO
         1 000426   200026 630500                    EPPR0   PEND+4,,AUTO
         1 000427   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000430   000000 701000 xent               TSX1    KQL$DELMLH
         1 000431   000000 011000                    NOP     0

     1577     7115              %UNLOCK (G=STA$->KQ$STA.GATE);

   7116  1 000432   200011 236100                    LDQ     STA$,,AUTO
         1 000433   000016 036003                    ADLQ    14,DU
         1 000434   200024 756100                    STQ     PEND+2,,AUTO
         1 000435   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000436   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000437   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000440   000000 011000                    NOP     0

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:243  
     1578     7118    2         RETURN;

   7118  1 000441   200020 221300                    LDX1  ! FPT$+6,,AUTO
         1 000442   000001 702211                    TSX2  ! 1,X1

     1579     7119    2   END FLUSHC;
     1580     7120        /****************************************************************
     1581     7121        *****************************************************************/
     1582     7122        /*D* NAME:         DACT
     1583     7123             PURPOSE:      To deactivate a station
     1584     7124             INPUT:        See KQC$ACTSTA
     1585     7125             DESCRIPTION:  STA$, LDCT$ point to the station, FPT$ as for ACT.
     1586     7126                           Note LDCT$ may be NIL (i.e. station may not be
     1587     7127                           connected).
     1588     7128
     1589     7129                           For DCBs, ACTIVE is reset, we call ABTRDP with
     1590     7130                           DACT TYC, and then do FLUSH if required.
     1591     7131                           For TERMs, we call KCD$DACTRM to deactivate it,
     1592     7132                           and KQG$DACT to clean up the pending GET, and
     1593     7133                           then FLUSH if required.
     1594     7134        */
     1595     7135    1   DACT: PROC;

   7135  1 000443   200016 741300       DACT         STX1  ! FPT$+4,,AUTO

     1596     7136    2         IF LDCT$ ~= ADDR(NIL) THEN

   7136  1 000444   200007 236100                    LDQ     LDCT$,,AUTO
         1 000445   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000446   000554 600000 1                  TZE     s:7170

     1597     7137    3           DO;

     1598     7138    3           IF LDCT$->NK$LDCT.RESCOD = NK_CGDCB THEN

   7138  1 000447   200007 470500                    LDP0    LDCT$,,AUTO
         1 000450   000006 236100                    LDQ     6,,PR0
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:244  
         1 000451   000017 376007                    ANQ     15,DL
         1 000452   000004 116007                    CMPQ    4,DL
         1 000453   000535 601000 1                  TNZ     s:7163

     1599     7139    4             DO;

     1600     7140                  %LOCK (G=STA$->KQ$STA.GATE);

   7141  1 000454   200011 236100                    LDQ     STA$,,AUTO
         1 000455   000016 036003                    ADLQ    14,DU
         1 000456   200024 756100                    STQ     PEND+2,,AUTO
         1 000457   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000460   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000461   000000 701000 xent               TSX1    HFC$LOCK
         1 000462   000000 011000                    NOP     0

     1601     7143    4             STA$->KQ$STA.ACTTYC='0'B;

   7143  1 000463   200011 470500                    LDP0    STA$,,AUTO
         1 000464   000013 450100                    STZ     11,,PR0

     1602     7144    4             STA$->KQ$STA.ABTET='0'B;

   7144  1 000465   000000 236000 2                  LDQ     0
         1 000466   000020 356100                    ANSQ    16,,PR0

     1603     7145    4             LDCT$->NK$LDCT.LKFLG.ACTIVE='0'B;

   7145  1 000467   200007 471500                    LDP1    LDCT$,,AUTO
         1 000470   000005 236000 2                  LDQ     5
         1 000471   100011 356100                    ANSQ    9,,PR1

     1604     7146    4             IF STA$->KQ$STA.OPNBLKED THEN

   7146  1 000472   000023 236100                    LDQ     19,,PR0
         1 000473   020000 316007                    CANQ    8192,DL
         1 000474   000521 600000 1                  TZE     s:7158
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:245  

     1605     7147    5               DO;

     1606     7148    5               STA$->KQ$STA.OPNBLKED='0'B;

   7148  1 000475   000001 236000 2                  LDQ     1
         1 000476   000023 356100                    ANSQ    19,,PR0

     1607     7149    5               STA$->KQ$STA.OPNREJ='1'B;

   7149  1 000477   010000 236007                    LDQ     4096,DL
         1 000500   000023 256100                    ORSQ    19,,PR0

     1608     7150                    %UNLOCK (G=STA$->KQ$STA.GATE);

   7151  1 000501   200011 236100                    LDQ     STA$,,AUTO
         1 000502   000016 036003                    ADLQ    14,DU
         1 000503   200024 756100                    STQ     PEND+2,,AUTO
         1 000504   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000505   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000506   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000507   000000 011000                    NOP     0

     1609     7153    5               CALL SSR$RUE (%SS_UQA,STA$->KQ$STA.USR#);

   7153  1 000510   200011 236100                    LDQ     STA$,,AUTO
         1 000511   000003 036000 2                  ADLQ    3
         1 000512   000004 235000 2                  LDA     4
         1 000513   200024 757100                    STAQ    PEND+2,,AUTO
         1 000514   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000515   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000516   000000 701000 xent               TSX1    SSR$RUE
         1 000517   000000 011000                    NOP     0

     1610     7154    5               END;

   7154  1 000520   000530 710000 1                  TRA     s:7161
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:246  

     1611     7155    4             ELSE
     1612     7156    5               DO;

     1613     7157                    %UNLOCK (G=STA$->KQ$STA.GATE);

   7158  1 000521   200011 236100                    LDQ     STA$,,AUTO
         1 000522   000016 036003                    ADLQ    14,DU
         1 000523   200024 756100                    STQ     PEND+2,,AUTO
         1 000524   200024 630500                    EPPR0   PEND+2,,AUTO
         1 000525   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000526   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000527   000000 011000                    NOP     0

     1614     7160    5               END;

     1615     7161    4             CALL ABTRDP (%TYC_DACT);

   7161  1 000530   000006 236000 2                  LDQ     6
         1 000531   200021 756100                    STQ     @ABTTYC,,AUTO
         1 000532   000310 701000 1                  TSX1    ABTRDP
         1 000533   000000 011000                    NOP     0

     1616     7162    4             END;

   7162  1 000534   000550 710000 1                  TRA     s:7168

     1617     7163    3           ELSE IF LDCT$->NK$LDCT.LKFLG.ACTIVE THEN

   7163  1 000535   000011 236100                    LDQ     9,,PR0
         1 000536   000040 316003                    CANQ    32,DU
         1 000537   000550 600000 1                  TZE     s:7168

     1618     7164    4              DO;

     1619     7165    4              CALL KCD$DACTRM (LDCT$->NK$LDCT);

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:247  
   7165  1 000540   200007 630500                    EPPR0   LDCT$,,AUTO
         1 000541   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000542   000000 701000 xent               TSX1    KCD$DACTRM
         1 000543   000000 011000                    NOP     0

     1620     7166    4              CALL KQG$DACT (LDCT$->NK$LDCT);

   7166  1 000544   200007 630500                    EPPR0   LDCT$,,AUTO
         1 000545   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000546   000000 701000 xent               TSX1    KQG$DACT
         1 000547   000000 011000                    NOP     0

     1621     7167    4              END;

     1622     7168    3           CALL KQT$VALREADS (CG$->KQ$CG);

   7168  1 000550   200006 630500                    EPPR0   CG$,,AUTO
         1 000551   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000552   000000 701000 xent               TSX1    KQT$VALREADS
         1 000553   000000 011000                    NOP     0

     1623     7169    3           END;

     1624     7170    2         CALL FLUSHC;

   7170  1 000554   000376 701000 1                  TSX1    FLUSHC
         1 000555   000000 011000                    NOP     0

     1625     7171    2         RETURN;

   7171  1 000556   200016 221300                    LDX1  ! FPT$+4,,AUTO
         1 000557   000001 702211                    TSX2  ! 1,X1

     1626     7172    2   END DACT;
     1627     7173        /****************************************************************
     1628     7174        *****************************************************************/
     1629     7175        /*D* NAME:         DISC
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:248  
     1630     7176             PURPOSE:      To deactivate-disconnect a station
     1631     7177             INPUT:        See KQC$ACTSTA
     1632     7178             DESCRIPTION:  Calls DACT, then sends FEP msg if remote TERM;
     1633     7179                           ALTRETs if local TERM; does zip else for DCB.
     1634     7180        */
     1635     7181    1   DISC: PROC ALTRET;

   7181  1 000560   200014 741300       DISC         STX1  ! FPT$+2,,AUTO

     1636     7182    2         IF SAVLDCT$~=ADDR(NIL)

   7182  1 000561   200010 236100                    LDQ     SAVLDCT$,,AUTO
         1 000562   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000563   000570 600000 1                  TZE     s:7184

     1637     7183    2         THEN CALL KCD$DACDSC(SAVLDCT$->NK$LDCT);

   7183  1 000564   200010 630500                    EPPR0   SAVLDCT$,,AUTO
         1 000565   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000566   000000 701000 xent               TSX1    KCD$DACDSC
         1 000567   000000 011000                    NOP     0

     1638     7184    2         IF LDCT$ ~= ADDR(NIL) THEN

   7184  1 000570   200007 236100                    LDQ     LDCT$,,AUTO
         1 000571   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000572   000623 600000 1                  TZE     s:7199

     1639     7185    3           DO;

     1640     7186    3           IF LDCT$->NK$LDCT.RESCOD = NK_CGDCB THEN

   7186  1 000573   200007 470500                    LDP0    LDCT$,,AUTO
         1 000574   000006 236100                    LDQ     6,,PR0
         1 000575   000017 376007                    ANQ     15,DL
         1 000576   000004 116007                    CMPQ    4,DL
         1 000577   000604 601000 1                  TNZ     s:7191
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:249  

     1641     7187    4             DO;

     1642     7188    4             CALL DACT;

   7188  1 000600   000443 701000 1                  TSX1    DACT
         1 000601   000000 011000                    NOP     0

     1643     7189    4             RETURN;

   7189  1 000602   200014 221300                    LDX1  ! FPT$+2,,AUTO
         1 000603   000001 702211                    TSX2  ! 1,X1

     1644     7190    4             END;
     1645     7191    3           IF LDCT$->NK$LDCT.RLCID.NODE = 0 THEN

   7191  1 000604   000015 236100                    LDQ     13,,PR0
         1 000605   777000 316003                    CANQ    -512,DU
         1 000606   000613 601000 1                  TNZ     s:7196

     1646     7192    4             DO;

     1647     7193    4             CALL DACT;

   7193  1 000607   000443 701000 1                  TSX1    DACT
         1 000610   000000 011000                    NOP     0

     1648     7194    4             ALTRETURN;

   7194  1 000611   200014 221300                    LDX1  ! FPT$+2,,AUTO
         1 000612   000000 702211                    TSX2  ! 0,X1

     1649     7195    4             END;
     1650     7196    3           CALL KCD$DACDSC (LDCT$->NK$LDCT);

   7196  1 000613   200007 630500                    EPPR0   LDCT$,,AUTO
         1 000614   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:250  
         1 000615   000000 701000 xent               TSX1    KCD$DACDSC
         1 000616   000000 011000                    NOP     0

     1651     7197    3           CALL KQT$VALREADS (CG$->KQ$CG);

   7197  1 000617   200006 630500                    EPPR0   CG$,,AUTO
         1 000620   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000621   000000 701000 xent               TSX1    KQT$VALREADS
         1 000622   000000 011000                    NOP     0

     1652     7198    3           END;

     1653     7199    2         CALL FLUSHC;

   7199  1 000623   000376 701000 1                  TSX1    FLUSHC
         1 000624   000000 011000                    NOP     0

     1654     7200    2         RETURN;

   7200  1 000625   200014 221300                    LDX1  ! FPT$+2,,AUTO
         1 000626   000001 702211                    TSX2  ! 1,X1

     1655     7201    2   END DISC;
     1656     7202        /****************************************************************
     1657     7203        *****************************************************************/
     1658     7204        /*D* NAME:         CLOSESTA
     1659     7205             PURPOSE:      To 'close' a station
     1660     7206             INPUT:        See KQC$ACTSTA
     1661     7207             DESCRIPTION:  STA$ points to the station.  See *F* for KQC$CLOSESTA.
     1662     7208        */
     1663     7209    1   CLOSESTA: PROC;

   7209  1 000627   200014 741300       CLOSESTA     STX1  ! FPT$+2,,AUTO

     1664     7210    2         IF SAVLDCT$~=ADDR(NIL)

   7210  1 000630   200010 236100                    LDQ     SAVLDCT$,,AUTO
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:251  
         1 000631   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000632   000637 600000 1                  TZE     s:7212

     1665     7211    2         THEN CALL KCD$RELTRM(SAVLDCT$->NK$LDCT);

   7211  1 000633   200010 630500                    EPPR0   SAVLDCT$,,AUTO
         1 000634   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000635   000000 701000 xent               TSX1    KCD$RELTRM
         1 000636   000000 011000                    NOP     0

     1666     7212    2         IF LDCT$ ~= ADDR(NIL) THEN

   7212  1 000637   200007 236100                    LDQ     LDCT$,,AUTO
         1 000640   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000641   000704 600000 1                  TZE     s:7229

     1667     7213    3           DO;

     1668     7214    3           IF LDCT$->NK$LDCT.RESCOD = NK_CGDCB THEN CALL DACT;

   7214  1 000642   200007 470500                    LDP0    LDCT$,,AUTO
         1 000643   000006 236100                    LDQ     6,,PR0
         1 000644   000017 376007                    ANQ     15,DL
         1 000645   000004 116007                    CMPQ    4,DL
         1 000646   000652 601000 1                  TNZ     s:7216

   7214  1 000647   000443 701000 1                  TSX1    DACT
         1 000650   000000 011000                    NOP     0
         1 000651   000704 710000 1                  TRA     s:7229

     1669     7215    3           ELSE
     1670     7216    4            IF LDCT$->NK$LDCT.RESCOD = NK_OSISTA THEN DO;

   7216  1 000652   000015 116007                    CMPQ    13,DL
         1 000653   000674 601000 1                  TNZ     s:7225

     1671     7217                   /* 'close' of NK_OSISTA means abort GET then disconnect */
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:252  
     1672     7218    4              CALL KQG$DACT (LDCT$->NK$LDCT);

   7218  1 000654   200007 630500                    EPPR0   LDCT$,,AUTO
         1 000655   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000656   000000 701000 xent               TSX1    KQG$DACT
         1 000657   000000 011000                    NOP     0

     1673     7219    4              CALL KQT$VALREADS (CG$->KQ$CG);

   7219  1 000660   200006 630500                    EPPR0   CG$,,AUTO
         1 000661   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000662   000000 701000 xent               TSX1    KQT$VALREADS
         1 000663   000000 011000                    NOP     0

     1674     7220    4              CALL KIS$OSI_DACT (LDCT$->NK$LDCT);  /* releases LDCT */

   7220  1 000664   200007 630500                    EPPR0   LDCT$,,AUTO
         1 000665   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000666   000000 701000 xent               TSX1    KIS$OSI_DACT
         1 000667   000000 011000                    NOP     0

     1675     7221    4              CG$->KQ$CG.STATS.NUMTERMS = CG$->KQ$CG.STATS.NUMTERMS - 1;

   7221  1 000670   200006 470500                    LDP0    CG$,,AUTO
         1 000671   000001 336007                    LCQ     1,DL
         1 000672   000174 056100                    ASQ     124,,PR0

     1676     7222    4              END;

   7222  1 000673   000704 710000 1                  TRA     s:7229

     1677     7223    3            ELSE
     1678     7224    4              DO;

     1679     7225    4              CALL KCD$RELTRM (LDCT$->NK$LDCT);

   7225  1 000674   200007 630500                    EPPR0   LDCT$,,AUTO
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:253  
         1 000675   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000676   000000 701000 xent               TSX1    KCD$RELTRM
         1 000677   000000 011000                    NOP     0

     1680     7226    4              CALL KQT$VALREADS (CG$->KQ$CG);

   7226  1 000700   200006 630500                    EPPR0   CG$,,AUTO
         1 000701   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000702   000000 701000 xent               TSX1    KQT$VALREADS
         1 000703   000000 011000                    NOP     0

     1681     7227    4              END;

     1682     7228    3           END;

     1683     7229    2         RETURN;

   7229  1 000704   200014 221300                    LDX1  ! FPT$+2,,AUTO
         1 000705   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   0     000   000020 000000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   775777 777777   777777 757777   000000 000034   000020 400000    ................
   2     004   000002 006000   777737 777777   000000 006000                    ............
     1684     7230    2   END CLOSESTA;
     1685     7231    1   END KQC$ACTSTA;
     1686     7232        %EOD;

PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:254  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQC$ACTSTA.
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:255  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    21-0-0/w PTR         r     1 @ABTTYC                    4-0-0/w PTR         r     1 @PARM
     3-0-0/w PTR         r     1 @PARM$                    *0-0-0/w BIT         r     1 ABTTYC
     6-0-0/w PTR         r     1 CG$                       12-0-0/w PTR         r     1 FPT$
     7-0-0/w PTR         r     1 LDCT$                     *0-0-0/w UBIN        r     1 PARM
    *0-0-0/w PTR         r     1 PARM$                     22-0-0/w UBIN        r     1 PEND
    10-0-0/w PTR         r     1 SAVLDCT$                  11-0-0/w PTR         r     1 STA$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w BIT         r     1 B$$BIT36                   0-0-0/d STRC(288)   r     1 FPT$ACTIVATE
     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d STRC(648)   r     1 KQ$RBLK
     0-0-0/d STRC(1296)  r     1 KQ$STA                     0-0-0/d STRC(1080)  r     1 N$REQ
     0-0-0/d STRC(864)   r     1 NK$LDCT


   Procedure KQC$ACTSTA requires 454 words for executable code.
   Procedure KQC$ACTSTA requires 24 words of local(AUTO) storage.
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:256  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:257  
          MINI XREF LISTING

ABT IN PROCEDURE ABTRD
      7078**LABEL    7069--GOTO
ABTRD
      7063**PROC     7030--CALL
ABTRDP IN PROCEDURE ABTRD
      7076**ENTRY    6970--CALL     7161--CALL
ABTTYC IN PROCEDURE ABTRD
      7065**DCL      7063--PROC     7076--ENTRY    7086>>ASSIGN   7090>>ASSIGN
ACT
      6999**PROC     6909--CALL
ALTRT
      6941**LABEL    6939--CALLALT
B$$BIT36
      6819**DCL      6970<>CALL
CG$
      6826**DCL      5526--IMP-PTR  6975<<ASSIGN   7080>>CALL     7098>>CALL     7114>>CALL     7168>>CALL
      7197>>CALL     7219>>CALL     7221>>ASSIGN   7221>>ASSIGN   7226>>CALL
CLOSESTA
      7209**PROC     6958--CALL
DACT
      7135**PROC     6924--CALL     7188--CALL     7193--CALL     7214--CALL
DISC
      7181**PROC     6939--CALL
FLUSHC
      7107**PROC     7001--CALL     7170--CALL     7199--CALL
FPT$
      6830**DCL      6986<<ASSIGN   7000>>IF       7001>>IF       7005>>IF       7010>>ASSIGN   7023>>IF
      7024>>IF       7026>>ASSIGN   7030>>CALL     7109>>IF       7110>>IF
FPT$ACTIVATE.ABTET
      6815**DCL      7026>>ASSIGN
FPT$ACTIVATE.ABTREAD
      6815**DCL      7024>>IF       7030<>CALL
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:258  
FPT$ACTIVATE.DVBYTE
      6814**DCL      7010>>ASSIGN
FPT$ACTIVATE.DVBYTE.REREAD
      6814**DCL      6814--REDEF
FPT$ACTIVATE.FLUSH
      6815**DCL      7001>>IF       7110>>IF
HFC$LOCK
      2892**DCL-ENT  7008--CALL     7020--CALL     7032--CALL     7082--CALL     7112--CALL     7141--CALL
HFC$UNLOCK
      2892**DCL-ENT  7012--CALL     7028--CALL     7043--CALL     7050--CALL     7096--CALL     7116--CALL
      7151--CALL     7158--CALL
KCD$ACTRM
      6837**DCL-ENT  7015--CALL
KCD$DACDSC
      6838**DCL-ENT  7183--CALL     7196--CALL
KCD$DACTRM
      6839**DCL-ENT  7165--CALL
KCD$RELTRM
      6840**DCL-ENT  7211--CALL     7225--CALL
KIS$OSI_DACT
      6848**DCL-ENT  7220--CALL
KQ$CG
      5526**DCL      7080<>CALL     7098<>CALL     7114<>CALL     7168<>CALL     7197<>CALL     7219<>CALL
      7226<>CALL
KQ$CG.AUCTL.DVBYTE.REREAD
      5969**DCL      5970--REDEF
KQ$CG.STATS.NUMTERMS
      6019**DCL      7221<<ASSIGN   7221>>ASSIGN
KQ$RBLK.BUF$
      6762**DCL      6764--REDEF
KQ$RBLK.CNACTD
      6676**DCL      6685--REDEF
KQ$RBLK.DBLKX
      6782**DCL      6786--REDEF
KQ$RBLK.EOFNONE
      6654**DCL      6657--REDEF
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:259  
KQ$RBLK.FROMQ
      6660**DCL      6663--REDEF
KQ$RBLK.KEY1R
      6701**DCL      6702--REDEF
KQ$RBLK.KEY2R
      6706**DCL      6707--REDEF
KQ$RBLK.LATCH
      6649**DCL      6651--REDEF
KQ$RBLK.LWRITES$
      6793**DCL      6797--REDEF
KQ$RBLK.STATE
      6646**DCL      7088>>IF
KQ$STA.ABTET
      6382**DCL      7026<<ASSIGN   7037<<ASSIGN   7144<<ASSIGN
KQ$STA.ACTTYC
      6316**DCL      6320--REDEF    7036<<ASSIGN   7086<<ASSIGN   7090<<ASSIGN   7143<<ASSIGN
KQ$STA.CG$
      6303**DCL      6975>>ASSIGN
KQ$STA.DCBLNK$
      6323**DCL      6326--REDEF    6330--REDEF
KQ$STA.DVBYTE
      6415**DCL      7010<<ASSIGN
KQ$STA.EVCNT
      6409**DCL      6412--REDEF
KQ$STA.EVNT
      6375**DCL      6379--REDEF    6382--REDEF
KQ$STA.GATE
      6342**DCL      7008<>CALL     7012<>CALL     7020<>CALL     7028<>CALL     7032<>CALL     7043<>CALL
      7050<>CALL     7082<>CALL     7096<>CALL     7112<>CALL     7116<>CALL     7141<>CALL     7151<>CALL
      7158<>CALL
KQ$STA.IDSC
      6344**DCL      6979>>IF       7084>>IF
KQ$STA.LDCT$
      6305**DCL      6981>>ASSIGN
KQ$STA.MLH
      6532**DCL      7114--CALL
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:260  
KQ$STA.OPNBLKED
      6436**DCL      6439--REDEF    7039>>IF       7041<<ASSIGN   7146>>IF       7148<<ASSIGN
KQ$STA.OPNREJ
      6442**DCL      6444--REDEF    7149<<ASSIGN
KQ$STA.RBLK$
      6307**DCL      7087>>IF       7088>>IF
KQ$STA.SAVIDSC
      6463**DCL      6976>>IF
KQ$STA.SAVLDCT$
      6503**DCL      6978>>ASSIGN
KQ$STA.SUCCREAD
      6365**DCL      6369--REDEF
KQ$STA.TCOUNT
      6494**DCL      6500--REDEF
KQ$STA.TERM
      6360**DCL      6982>>IF
KQ$STA.USR#
      6395**DCL      7045<>CALL     7153<>CALL
KQ$STA.VGOT$
      6479**DCL      6483--REDEF    6487--REDEF
KQG$DACT
      6841**DCL-ENT  7166--CALL     7218--CALL
KQL$DELMLH
      6842**DCL-ENT  7114--CALL
KQR$VALIDATE
      6843**DCL-ENT  7091--CALL
KQT$LBT
      6844**DCL-ENT  7080--CALL
KQT$UBT
      6845**DCL-ENT  7098--CALL
KQT$VALREADS
      6846**DCL-ENT  7168--CALL     7197--CALL     7219--CALL     7226--CALL
KQ_IMBLK.DVE.EOMCHAR
      3567**DCL      3569--REDEF
KQ_IMBLK.KEY1
      3493**DCL      3495--REDEF
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:261  
KQ_IMBLK.KEY2
      3502**DCL      3520--REDEF
KQ_IMBLK.LNK$
      3467**DCL      3469--REDEF    3475--REDEF    3479--REDEF
KQ_IMBLK.TYC
      3616**DCL      3618--REDEF
KQ_IMBLK.XSP.MREQ$
      3522**DCL      3526--REDEF
KQ_IRBLK.BUF$
      3071**DCL      3073--REDEF
KQ_IRBLK.CNACTD
      2985**DCL      2994--REDEF
KQ_IRBLK.DBLKX
      3091**DCL      3095--REDEF
KQ_IRBLK.EOFNONE
      2963**DCL      2966--REDEF
KQ_IRBLK.FROMQ
      2969**DCL      2972--REDEF
KQ_IRBLK.KEY1R
      3010**DCL      3011--REDEF
KQ_IRBLK.KEY2R
      3015**DCL      3016--REDEF
KQ_IRBLK.LATCH
      2958**DCL      2960--REDEF
KQ_IRBLK.LWRITES$
      3102**DCL      3106--REDEF
KQ_IRBLKT.CNACTD
      3171**DCL      3180--REDEF
KQ_IRBLKT.DBLK$
      3234**DCL      3238--REDEF    3241--REDEF
KQ_IRBLKT.EOFNONE
      3149**DCL      3152--REDEF
KQ_IRBLKT.FROMQ
      3155**DCL      3158--REDEF
KQ_IRBLKT.KEY1R
      3196**DCL      3197--REDEF
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:262  
KQ_IRBLKT.KEY2R
      3201**DCL      3202--REDEF
KQ_IRBLKT.LATCH
      3144**DCL      3146--REDEF
LDCT$
      6827**DCL      6979<<ASSIGN   6981<<ASSIGN   6982>>IF       6982>>IF       6984<<ASSIGN   7002>>IF
      7003>>IF       7015>>CALL     7022>>ASSIGN   7091>>CALL     7136>>IF       7138>>IF       7145>>ASSIGN
      7163>>IF       7165>>CALL     7166>>CALL     7184>>IF       7186>>IF       7191>>IF       7196>>CALL
      7212>>IF       7214>>IF       7216>>IF       7218>>CALL     7220>>CALL     7225>>CALL
N$REQ
      5462**DCL      7091<>CALL
N$REQ.BUFADDR
      5471**DCL      5472--REDEF    5472--REDEF
N$REQ.DLA.DRELADDR
      5463**DCL      5463--REDEF
N$REQ.DVE.EOMCHAR
      5500**DCL      5501--REDEF
N$REQ.EAINFO
      5494**DCL      5494--REDEF
N$REQ.EAINFOX
      5494**DCL      5495--REDEF
N$REQ.EVNTINFO
      5495**DCL      5495--REDEF
N$REQ.STATUS
      5476**DCL      5482--REDEF
NK$LDCT
      5420**DCL      7015<>CALL     7165<>CALL     7166<>CALL     7183<>CALL     7196<>CALL     7211<>CALL
      7218<>CALL     7220<>CALL     7225<>CALL
NK$LDCT.DDT$
      5422**DCL      5422--REDEF
NK$LDCT.IOQ$
      5421**DCL      5422--REDEF    7091>>CALL
NK$LDCT.LDCTX
      5423**DCL      5423--REDEF
NK$LDCT.LKFLG.ABORTED
      5435**DCL      5436--REDEF
PL6.E3A0      #002=KQC$ACTSTA File=KQC$CTL.:E05TSI                               WED 07/30/97 01:27 Page:263  
NK$LDCT.LKFLG.ACTIVE
      5439**DCL      7022<<ASSIGN   7145<<ASSIGN   7163>>IF
NK$LDCT.RESCOD
      5428**DCL      7003>>IF       7138>>IF       7186>>IF       7214>>IF       7216>>IF
NK$LDCT.RLCID.LDCTX
      5445**DCL      5445--REDEF    6982>>IF
NK$LDCT.RLCID.NODE
      5444**DCL      7191>>IF
NK$LDCT.STA$
      5441**DCL      5442--REDEF
NK$LDCT.SYMB$
      5420**DCL      5420--REDEF    5420--REDEF    5421--REDEF
OPNCHK IN PROCEDURE ACT
      7037**LABEL    7034--GOTO
PARM
      5399**DCL        20--PROC     6921--ENTRY    6936--ENTRY    6967--ENTRY    6970--CALL     6986--ASSIGN
PARM$
      5398**DCL        20--PROC     6921--ENTRY    6936--ENTRY    6955--ENTRY    6967--ENTRY    6974--ASSIGN
PEND IN PROCEDURE ABTRD
      7066**DCL      7068<<ASSIGN   7078<<ASSIGN   7086>>IF
SAVLDCT$
      6828**DCL      6977<<ASSIGN   6978<<ASSIGN   7182>>IF       7183>>CALL     7210>>IF       7211>>CALL
SETUP
      6973**PROC     6908--CALL     6923--CALL     6938--CALL     6957--CALL     6969--CALL
SSR$RUE
      6847**DCL-ENT  7045--CALL     7153--CALL
STA$
      6829**DCL      6264--IMP-PTR  6974<<ASSIGN   6975>>ASSIGN   6976>>IF       6978>>ASSIGN   6979>>IF
      6981>>ASSIGN   6982>>IF       7008>>CALL     7010>>ASSIGN   7012>>CALL     7020>>CALL     7026>>ASSIGN
      7028>>CALL     7032>>CALL     7036>>ASSIGN   7037>>ASSIGN   7039>>IF       7041>>ASSIGN   7043>>CALL
      7045>>CALL     7050>>CALL     7082>>CALL     7084>>IF       7086>>ASSIGN   7087>>IF       7088>>IF
      7090>>ASSIGN   7096>>CALL     7112>>CALL     7114>>CALL     7116>>CALL     7141>>CALL     7143>>ASSIGN
      7144>>ASSIGN   7146>>IF       7148>>ASSIGN   7149>>ASSIGN   7151>>CALL     7153>>CALL     7158>>CALL

PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:264  
     1687        1        /*T***********************************************************/
     1688        2        /*T*                                                         */
     1689        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1690        4        /*T*                                                         */
     1691        5        /*T***********************************************************/
     1692        6        /**/
     1693        7        /*F* NAME:         KQC$TELLJ
     1694        8             PURPOSE:      To tell the system JOURNAL GHOST about a
     1695        9                           change in a comgroup's journalling parameters.
     1696       10             CALL:         KQC$TELLJ (KQ$CG) ALTRET(DIDNTWORK)
     1697       11             ENVIRONMENT:  User
     1698       12             INPUT:        B$JIT.DCB$ points to a DCB open to the
     1699       13                           comgroup.
     1700       14             DESCRIPTION:  If the comgroup is being journaled by the
     1701       15                           journal ghost, then he is told via the CSCG
     1702       16                           that something has changed.  We await
     1703       17                           his response, and ALTRET with JIT.ERR set
     1704       18                           if anything has gone wrong.
     1705       19        */
     1706       20        /**/
     1707       21        KQC$TELLJ: PROC (CFU$) ALTRET;
     1708       22        /**/
     1709       23
     1710       24
     1711       25
     1712       26        /**/
     1713       27        /* INCLUDES */
     1714       28        /**/
     1715       29        %INCLUDE KQ_SUBS_C;
     1716      329        %INCLUDE KQ_MAC_C;
     1717     2879        %INCLUDE HF_LOCK_C;
     1718     2893        %INCLUDE KQ_DATA_R;
     1719     3725        %INCLUDE CP_6_SUBS;
     1720     4265        %INCLUDE KC$CP6V_C;
     1721     4385        %INCLUDE B$JIT_C;
     1722     4699        %INCLUDE KC_CP6;
     1723     5259        %INCLUDE KI$CP6V_C;
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:265  
     1724     5698        %INCLUDE KI_CP6;
     1725     6794        %INCLUDE KC$CGBLK;
     1726     6842        %INCLUDE F$DCB;
     1727     6891        %INCLUDE KC_DATA_R;
     1728     6904        %INCLUDE JG_EVID_C;
     1729     7129        %INCLUDE FJM_MACROS_C;
     1730     7268
     1731     7269
     1732     7270
     1733     7271        /**/
     1734     7272        /* PARAMETERS */
     1735     7273        /**/
     1736     7274    1   DCL CFU$ PTR;
     1737     7275
     1738     7276
     1739     7277
     1740     7278        /**/
     1741     7279        /* BASED STRUCTURES */
     1742     7280        /**/
     1743     7281        %B$JIT0;
     1744     7370        %U$JIT1X;
     1745     7373        %M$JIT2X;
     1746     7376        %F$JIT3;
     1747     7381        %A$JIT6X;
     1748     7384
     1749     7385
     1750     7386
     1751     7387        /**/
     1752     7388        /* AUTO */
     1753     7389        /**/
     1754     7390    1   DCL I UBIN;
     1755     7391    1   DCL JDCB$ PTR;
     1756     7392        %FJ$OPNANSWR (STCLASS=AUTO);
     1757     7402        %FJ$CITE (STCLASS=AUTO,TYP=JRNL);
     1758     7475
     1759     7476
     1760     7477
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:266  
     1761     7478        /**/
     1762     7479        /* CONSTANT */
     1763     7480        /**/
     1764     7481
     1765     7482        /**/
     1766     7483        /* SYMREFS */
     1767     7484        /**/
     1768     7485    1   DCL B$JIT$ PTR SYMREF;
     1769     7486    1   DCL J_JAYS CHAR(8) SYMREF READONLY;
     1770     7487
     1771     7488
     1772     7489
     1773     7490        /**/
     1774     7491        /* ENTREFS */
     1775     7492        /**/
     1776     7493    1   DCL KUR$RESUS     ENTRY(5);
     1777     7494
     1778     7495
     1779     7496
     1780     7497        /**/
     1781     7498        /* SUBS */
     1782     7499        /**/
     1783     7500        %EQU_CG;
     1784     7548        %EJECT;
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:267  
     1785     7549        /**/
     1786     7550    1         JDCB$=B$JIT$->B$JIT.DCB$;
     1787     7551    1         IF JDCB$->F$DCB.GHSTACS = %JRNLOPN# THEN
     1788     7552    2           DO;
     1789     7553    2           FJ$CITE.CODE=%FJ_CGOPN#;
     1790     7554    2           FJ$CITE.P$=CFU$;
     1791     7555    2           FJ$CITE.DCB$=JDCB$;
     1792     7556    2           FJ$CITE.USER#=B$JIT$->B$JIT.USER;
     1793     7557    2           FJ$CITE.ACCN=B$JIT$->B$JIT.ACCN;
     1794     7558    2           FJ$CITE.FACCN=B$JIT$->B$JIT.FACCN;
     1795     7559    2           FJ$CITE.UNAME=B$JIT$->B$JIT.UNAME;
     1796     7560    2           FJ$CITE.PRIV=B$JIT$->B$JIT.PRIV.ACTIVE;
     1797     7561    2           I=LENGTHC(FJ$OPNANSWR);
     1798     7562    2           CALL KUR$RESUS (FJ$CITE,LENGTHC(FJ$CITE),J_JAYS,FJ$OPNANSWR,I);
     1799     7563    2           IF FJ$OPNANSWR.ERR ~= '0'B THEN
     1800     7564    3             DO;
     1801     7565    3             B$JIT$->B$JIT.ERR=FJ$OPNANSWR.ERR;
     1802     7566    3             ALTRETURN;
     1803     7567    3             END;
     1804     7568    2           END;
     1805     7569    1         RETURN;
     1806     7570    1   END KQC$TELLJ;

PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:268  
--  Include file information  --

   FJM_MACROS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQC$TELLJ.

   Procedure KQC$TELLJ requires 54 words for executable code.
   Procedure KQC$TELLJ requires 30 words of local(AUTO) storage.

    No errors detected in file KQC$CTL.:E05TSI    .

PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:269  

 Object Unit name= KQC$TELLJ                                  File name= KQC$CTL.:E05TOU
 UTS= JUL 30 '97 01:27:59.52 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    54     66  KQC$TELLJ
    1  RoData even  none     3      3  KQC$TELLJ

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  KQC$TELLJ

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       5 KUR$RESUS
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                           r    J_JAYS                                B_VECTNIL
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:270  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:271  


     1687        1        /*T***********************************************************/
     1688        2        /*T*                                                         */
     1689        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1690        4        /*T*                                                         */
     1691        5        /*T***********************************************************/
     1692        6        /**/
     1693        7        /*F* NAME:         KQC$TELLJ
     1694        8             PURPOSE:      To tell the system JOURNAL GHOST about a
     1695        9                           change in a comgroup's journalling parameters.
     1696       10             CALL:         KQC$TELLJ (KQ$CG) ALTRET(DIDNTWORK)
     1697       11             ENVIRONMENT:  User
     1698       12             INPUT:        B$JIT.DCB$ points to a DCB open to the
     1699       13                           comgroup.
     1700       14             DESCRIPTION:  If the comgroup is being journaled by the
     1701       15                           journal ghost, then he is told via the CSCG
     1702       16                           that something has changed.  We await
     1703       17                           his response, and ALTRET with JIT.ERR set
     1704       18                           if anything has gone wrong.
     1705       19        */
     1706       20        /**/
     1707       21        KQC$TELLJ: PROC (CFU$) ALTRET;

     21  0 000000   000000 700200 xent  KQC$TELLJ    TSX0  ! X66_AUTO_1
         0 000001   000036 000001                    ZERO    30,1

     1708       22        /**/
     1709       23
     1710       24
     1711       25
     1712       26        /**/
     1713       27        /* INCLUDES */
     1714       28        /**/
     1715       29        %INCLUDE KQ_SUBS_C;
     1716      329        %INCLUDE KQ_MAC_C;
     1717     2879        %INCLUDE HF_LOCK_C;
     1718     2893        %INCLUDE KQ_DATA_R;
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:272  
     1719     3725        %INCLUDE CP_6_SUBS;
     1720     4265        %INCLUDE KC$CP6V_C;
     1721     4385        %INCLUDE B$JIT_C;
     1722     4699        %INCLUDE KC_CP6;
     1723     5259        %INCLUDE KI$CP6V_C;
     1724     5698        %INCLUDE KI_CP6;
     1725     6794        %INCLUDE KC$CGBLK;
     1726     6842        %INCLUDE F$DCB;
     1727     6891        %INCLUDE KC_DATA_R;
     1728     6904        %INCLUDE JG_EVID_C;
     1729     7129        %INCLUDE FJM_MACROS_C;
     1730     7268
     1731     7269
     1732     7270
     1733     7271        /**/
     1734     7272        /* PARAMETERS */
     1735     7273        /**/
     1736     7274    1   DCL CFU$ PTR;
     1737     7275
     1738     7276
     1739     7277
     1740     7278        /**/
     1741     7279        /* BASED STRUCTURES */
     1742     7280        /**/
     1743     7281        %B$JIT0;
     1744     7370        %U$JIT1X;
     1745     7373        %M$JIT2X;
     1746     7376        %F$JIT3;
     1747     7381        %A$JIT6X;
     1748     7384
     1749     7385
     1750     7386
     1751     7387        /**/
     1752     7388        /* AUTO */
     1753     7389        /**/
     1754     7390    1   DCL I UBIN;
     1755     7391    1   DCL JDCB$ PTR;
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:273  
     1756     7392        %FJ$OPNANSWR (STCLASS=AUTO);
     1757     7402        %FJ$CITE (STCLASS=AUTO,TYP=JRNL);
     1758     7475
     1759     7476
     1760     7477
     1761     7478        /**/
     1762     7479        /* CONSTANT */
     1763     7480        /**/
     1764     7481
     1765     7482        /**/
     1766     7483        /* SYMREFS */
     1767     7484        /**/
     1768     7485    1   DCL B$JIT$ PTR SYMREF;
     1769     7486    1   DCL J_JAYS CHAR(8) SYMREF READONLY;
     1770     7487
     1771     7488
     1772     7489
     1773     7490        /**/
     1774     7491        /* ENTREFS */
     1775     7492        /**/
     1776     7493    1   DCL KUR$RESUS     ENTRY(5);
     1777     7494
     1778     7495
     1779     7496
     1780     7497        /**/
     1781     7498        /* SUBS */
     1782     7499        /**/
     1783     7500        %EQU_CG;
     1784     7548        %EJECT;
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:274  
     1785     7549        /**/
     1786     7550    1         JDCB$=B$JIT$->B$JIT.DCB$;

   7550  0 000002   000000 470400 xsym               LDP0    B$JIT$
         0 000003   000232 236100                    LDQ     154,,PR0
         0 000004   200005 756100                    STQ     JDCB$,,AUTO

     1787     7551    1         IF JDCB$->F$DCB.GHSTACS = %JRNLOPN# THEN

   7551  0 000005   200005 471500                    LDP1    JDCB$,,AUTO
         0 000006   100052 236100                    LDQ     42,,PR1
         0 000007   000017 376003                    ANQ     15,DU
         0 000010   000002 116003                    CMPQ    2,DU
         0 000011   000065 601000 0                  TNZ     s:7569

     1788     7552    2           DO;

     1789     7553    2           FJ$CITE.CODE=%FJ_CGOPN#;

   7553  0 000012   000000 220003                    LDX0    0,DU
         0 000013   200015 740100                    STX0    FJ$CITE,,AUTO

     1790     7554    2           FJ$CITE.P$=CFU$;

   7554  0 000014   200003 473500                    LDP3    @CFU$,,AUTO
         0 000015   300000 236100                    LDQ     0,,PR3
         0 000016   200016 756100                    STQ     FJ$CITE+1,,AUTO

     1791     7555    2           FJ$CITE.DCB$=JDCB$;

   7555  0 000017   200005 236100                    LDQ     JDCB$,,AUTO
         0 000020   200017 756100                    STQ     FJ$CITE+2,,AUTO

     1792     7556    2           FJ$CITE.USER#=B$JIT$->B$JIT.USER;

   7556  0 000021   000000 221100                    LDX1    0,,PR0
         0 000022   000777 361003                    ANX1    511,DU
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:275  
         0 000023   200015 441100                    SXL1    FJ$CITE,,AUTO

     1793     7557    2           FJ$CITE.ACCN=B$JIT$->B$JIT.ACCN;

   7557  0 000024   040100 100500                    MLR     fill='040'O
         0 000025   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         0 000026   200020 000010                    ADSC9   FJ$CITE+3,,AUTO          cn=0,n=8

     1794     7558    2           FJ$CITE.FACCN=B$JIT$->B$JIT.FACCN;

   7558  0 000027   000006 237100                    LDAQ    6,,PR0
         0 000030   200025 755100                    STA     FJ$CITE+8,,AUTO
         0 000031   200026 756100                    STQ     FJ$CITE+9,,AUTO

     1795     7559    2           FJ$CITE.UNAME=B$JIT$->B$JIT.UNAME;

   7559  0 000032   040100 100500                    MLR     fill='040'O
         0 000033   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12
         0 000034   200022 000014                    ADSC9   FJ$CITE+5,,AUTO          cn=0,n=12

     1796     7560    2           FJ$CITE.PRIV=B$JIT$->B$JIT.PRIV.ACTIVE;

   7560  0 000035   000013 236100                    LDQ     11,,PR0
         0 000036   200027 756100                    STQ     FJ$CITE+10,,AUTO

     1797     7561    2           I=LENGTHC(FJ$OPNANSWR);

   7561  0 000037   000034 235007                    LDA     28,DL
         0 000040   200004 755100                    STA     I,,AUTO

     1798     7562    2           CALL KUR$RESUS (FJ$CITE,LENGTHC(FJ$CITE),J_JAYS,FJ$OPNANSWR,I);

   7562  0 000041   200004 634500                    EPPR4   I,,AUTO
         0 000042   200034 454500                    STP4    FJ$CITE+15,,AUTO
         0 000043   200006 635500                    EPPR5   FJ$OPNANSWR,,AUTO
         0 000044   200033 455500                    STP5    FJ$CITE+14,,AUTO
         0 000045   000001 236000 1                  LDQ     1
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:276  
         0 000046   200032 756100                    STQ     FJ$CITE+13,,AUTO
         0 000047   000002 236000 1                  LDQ     2
         0 000050   200031 756100                    STQ     FJ$CITE+12,,AUTO
         0 000051   200015 636500                    EPPR6   FJ$CITE,,AUTO
         0 000052   200030 456500                    STP6    FJ$CITE+11,,AUTO
         0 000053   200030 630500                    EPPR0   FJ$CITE+11,,AUTO
         0 000054   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000055   000000 701000 xent               TSX1    KUR$RESUS
         0 000056   000000 011000                    NOP     0

     1799     7563    2           IF FJ$OPNANSWR.ERR ~= '0'B THEN

   7563  0 000057   200006 235100                    LDA     FJ$OPNANSWR,,AUTO
         0 000060   000065 600000 0                  TZE     s:7569

     1800     7564    3             DO;

     1801     7565    3             B$JIT$->B$JIT.ERR=FJ$OPNANSWR.ERR;

   7565  0 000061   200006 236100                    LDQ     FJ$OPNANSWR,,AUTO
         0 000062   000000 470400 xsym               LDP0    B$JIT$
         0 000063   000012 756100                    STQ     10,,PR0

     1802     7566    3             ALTRETURN;

   7566  0 000064   000000 702200 xent               TSX2  ! X66_AALT

     1803     7567    3             END;
     1804     7568    2           END;
     1805     7569    1         RETURN;

   7569  0 000065   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000000 000054   000000 006000   000000 006000                    ...,........
     1806     7570    1   END KQC$TELLJ;
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:277  

PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:278  
--  Include file information  --

   FJM_MACROS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQC$TELLJ.
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:279  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @CFU$                     *0-0-0/w PTR         r     1 CFU$
    15-0-0/w STRC(396)   r     1 FJ$CITE                    6-0-0/w STRC(252)   r     1 FJ$OPNANSWR
     4-0-0/w UBIN        r     1 I                          5-0-0/w PTR         r     1 JDCB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/c CHAR(8)     r     1 J_JAYS

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(7560)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB


   Procedure KQC$TELLJ requires 54 words for executable code.
   Procedure KQC$TELLJ requires 30 words of local(AUTO) storage.

    No errors detected in file KQC$CTL.:E05TSI    .
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:280  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:281  
          MINI XREF LISTING

B$JIT.ACCN
      7287**DCL      7557>>ASSIGN
B$JIT.DCB$
      7377**DCL      7550>>ASSIGN
B$JIT.ERR
      7287**DCL      7565<<ASSIGN
B$JIT.ERR.MID
      7288**DCL      7288--REDEF
B$JIT.FACCN
      7287**DCL      7558>>ASSIGN
B$JIT.PRIV.ACTIVE
      7288**DCL      7560>>ASSIGN
B$JIT.UNAME
      7287**DCL      7559>>ASSIGN
B$JIT.USER
      7287**DCL      7556>>ASSIGN
B$JIT$
      7485**DCL      7282--IMP-PTR  7550>>ASSIGN   7556>>ASSIGN   7557>>ASSIGN   7558>>ASSIGN   7559>>ASSIGN
      7560>>ASSIGN   7565>>ASSIGN
CFU$
      7274**DCL        21--PROC     7554>>ASSIGN
F$DCB.ACTPOS
      6868**DCL      6868--REDEF
F$DCB.ARS
      6843**DCL      6843--REDEF
F$DCB.ATTR
      6861**DCL      6862--REDEF
F$DCB.BORROW
      6876**DCL      6876--REDEF    6876--REDEF    6876--REDEF
F$DCB.DCBNAME.L
      6890**DCL      6890--IMP-SIZ
F$DCB.EOMCHAR
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:282  
      6847**DCL      6847--REDEF
F$DCB.FLDID
      6871**DCL      6871--REDEF
F$DCB.FORM$
      6865**DCL      6865--REDEF
F$DCB.FSECT
      6881**DCL      6881--REDEF
F$DCB.FSN
      6858**DCL      6858--REDEF    6858--REDEF    6859--REDEF
F$DCB.GHSTACS
      6866**DCL      7551>>IF
F$DCB.HEADER$
      6864**DCL      6864--REDEF
F$DCB.IXTNSIZE
      6862**DCL      6862--REDEF
F$DCB.LASTSTA$
      6852**DCL      6852--REDEF
F$DCB.LVL
      6877**DCL      6877--REDEF
F$DCB.NAME.C
      6852**DCL      6852--REDEF
F$DCB.NOEOF
      6873**DCL      6873--REDEF
F$DCB.NRECS
      6863**DCL      6863--REDEF
F$DCB.NRECX
      6882**DCL      6882--REDEF
F$DCB.OHDR
      6874**DCL      6874--REDEF
F$DCB.ORG
      6857**DCL      6857--REDEF
F$DCB.PRECNO
      6880**DCL      6880--REDEF
F$DCB.RCSZ
      6885**DCL      6885--REDEF
F$DCB.RES
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:283  
      6853**DCL      6853--REDEF
F$DCB.SETX
      6865**DCL      6865--REDEF
F$DCB.TAB$
      6864**DCL      6865--REDEF
F$DCB.TDA
      6879**DCL      6879--REDEF
F$DCB.WSN
      6854**DCL      6854--REDEF
FJ$CITE
      7415**DCL      7562<>CALL     7562--CALL
FJ$CITE.ACCN
      7424**DCL      7557<<ASSIGN
FJ$CITE.CODE
      7416**DCL      7553<<ASSIGN
FJ$CITE.DCB$
      7423**DCL      7555<<ASSIGN
FJ$CITE.FACCN
      7426**DCL      7558<<ASSIGN
FJ$CITE.P$
      7422**DCL      7554<<ASSIGN
FJ$CITE.PRIV
      7427**DCL      7560<<ASSIGN
FJ$CITE.UNAME
      7425**DCL      7559<<ASSIGN
FJ$CITE.USER#
      7421**DCL      7556<<ASSIGN
FJ$OPNANSWR
      7393**DCL      7561--ASSIGN   7562<>CALL
FJ$OPNANSWR.ERR
      7394**DCL      7563>>IF       7565>>ASSIGN
I
      7390**DCL      7561<<ASSIGN   7562<>CALL
JDCB$
      7391**DCL      7550<<ASSIGN   7551>>IF       7555>>ASSIGN
J_JAYS
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:284  
      7486**DCL      7562<>CALL
KQ_IMBLK.DVE.EOMCHAR
      3567**DCL      3569--REDEF
KQ_IMBLK.KEY1
      3493**DCL      3495--REDEF
KQ_IMBLK.KEY2
      3502**DCL      3520--REDEF
KQ_IMBLK.LNK$
      3467**DCL      3469--REDEF    3475--REDEF    3479--REDEF
KQ_IMBLK.TYC
      3616**DCL      3618--REDEF
KQ_IMBLK.XSP.MREQ$
      3522**DCL      3526--REDEF
KQ_IRBLK.BUF$
      3071**DCL      3073--REDEF
KQ_IRBLK.CNACTD
      2985**DCL      2994--REDEF
KQ_IRBLK.DBLKX
      3091**DCL      3095--REDEF
KQ_IRBLK.EOFNONE
      2963**DCL      2966--REDEF
KQ_IRBLK.FROMQ
      2969**DCL      2972--REDEF
KQ_IRBLK.KEY1R
      3010**DCL      3011--REDEF
KQ_IRBLK.KEY2R
      3015**DCL      3016--REDEF
KQ_IRBLK.LATCH
      2958**DCL      2960--REDEF
KQ_IRBLK.LWRITES$
      3102**DCL      3106--REDEF
KQ_IRBLKT.CNACTD
      3171**DCL      3180--REDEF
KQ_IRBLKT.DBLK$
      3234**DCL      3238--REDEF    3241--REDEF
KQ_IRBLKT.EOFNONE
PL6.E3A0      #003=KQC$TELLJ File=KQC$CTL.:E05TSI                                WED 07/30/97 01:27 Page:285  
      3149**DCL      3152--REDEF
KQ_IRBLKT.FROMQ
      3155**DCL      3158--REDEF
KQ_IRBLKT.KEY1R
      3196**DCL      3197--REDEF
KQ_IRBLKT.KEY2R
      3201**DCL      3202--REDEF
KQ_IRBLKT.LATCH
      3144**DCL      3146--REDEF
KUR$RESUS
      7493**DCL-ENT  7562--CALL
