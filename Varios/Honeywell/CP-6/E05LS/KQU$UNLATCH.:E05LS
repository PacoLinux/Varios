VERSION E05

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:1    
        1        1        /*M* KQU$UNLATCH UNLATCH routines for COMGROUP */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQU$UNLATCH
       10       10             PURPOSE:      To provide UNLATCH and DELETE functions for
       11       11                           COMGROUP messages.
       12       12             DESCRIPTION:  Contains routines to delete (in various ways)
       13       13                           messages in a COMGROUP.
       14       14        */
       15       15        /**/
       16       16        /*F* NAME:         KQU$UNLATCH
       17       17             PURPOSE:      To unlatch COMGROUP messages
       18       18             DESCRIPTION:  Called on behalf of a station to either
       19       19                            - dispose of the last latched message written
       20       20                              thru this station
       21       21
       22       22                           or
       23       23
       24       24                            - dispose of the latched input message curently
       25       25                              held by this station, as well as all latched
       26       26                              messages attached to it.
       27       27
       28       28                           The choices for an input message are delete, rerun
       29       29                           (put back to be read by somebody else), or put in
       30       30                           'hold' status to be played with by the AU.
       31       31
       32       32                           The choices for a latched write are delete or send
       33       33                           (actually dispatch to its destination).
       34       34
       35       35                           When a station has a read latched and it writes a
       36       36                           message with latch, the message goes on the tail
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:2    
       37       37                           of the chain headed by KQ$RBLK.LWRITES$ (after the
       38       38                           data has been written into the comgroup).  Thus
       39       39                           KQ$RBLK.LWRITES$ is a chain of MBLKs each pointing
       40       40                           to the DBLK(s) containing the message data.
       41       41
       42       42                           The options for the unlatch are passed in an
       43       43                           M$UNLATCH FPT V-area called FPT_UNLATCH; if
       44       44                           FPT_UNLATCH.INPUT is zero, then only the last latched
       45       45                           write is to be mucked with (as specified by FPT_
       46       46                           UNLATCH.OUTPUT), else INPUT says what to do with the
       47       47                           latched input, and OUTPUT says what to do with all
       48       48                           the output messages.  The ALTRET is taken if an
       49       49                           error occurs (see the *E*'s), with ERR set.
       50       50        */
       51       51        /**/
       52       52        KQU$UNLATCH: PROC (KQ$STA,FPT_UNLATCH,ERR) ALTRET;
       53       53        /**/
       54       54
       55       55
       56       56
       57       57        /**/
       58       58        /* INCLUDES */
       59       59        /**/
       60       60        %INCLUDE KQ_SUBS_C;
       61      360        %INCLUDE KQ_MAC_C;
       62     2910        %INCLUDE HF_LOCK_C;
       63     2924        %INCLUDE KQ_DATA_R;
       64     3756        %INCLUDE KQ_ERRORS_C;
       65     3804        %INCLUDE KC$CP6V_C;
       66     3924        %INCLUDE CP_6_SUBS;
       67     4464        %INCLUDE UD_SEV_C;
       68     4478        %INCLUDE KC_CP6;
       69     5038        %INCLUDE NK$LDCT;
       70     5140        %INCLUDE B$JIT_C;
       71     5454
       72     5455
       73     5456
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:3    
       74     5457        /**/
       75     5458        /* MACROS */
       76     5459        /**/
       77     5460        %MACRO $ERROR (NAME=GORGO,CODE=0,SEV=SEV_ERROR#);
       78     5461        DCL 1 NAME CONSTANT ALIGNED,
       79     5462              2 * BIT(18) UNAL INIT('132125'O),
       80     5463              2 * UBIN(15) UNAL INIT(CODE),
       81     5464              2 * UBIN(3) UNAL INIT(SEV);
       82     5465        %MEND;
       83     5466
       84     5467
       85     5468
       86     5469        /**/
       87     5470        /* PARAMETERS */
       88     5471        /**/
       89     5472        %KQ_STA (FPTN=KQ$STA,STCLASS="");
       90     5811        %FPT$UNLATCH_V (FPTN=FPT_UNLATCH,BASED="");
       91     5815    1   DCL ERR BIT(36) ALIGNED;
       92     5816
       93     5817
       94     5818
       95     5819        /**/
       96     5820        /* BASED STRUCTURES */
       97     5821        /**/
       98     5822        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
       99     6561        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED(RBLK$)");
      100     6747        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)");
      101     7017        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
      102     7055        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS="BASED(QTN$)");
      103     7528        %NK$LDCT;
      104     7574        %B$JIT0;
      105     7663        %U$JIT1X;
      106     7666        %M$JIT2X;
      107     7669        %F$JIT3;
      108     7674        %A$JIT6X;
      109     7677    1   DCL B$$PTR PTR BASED ALIGNED;
      110     7678    1   DCL 1 B$$PTRR BASED ALIGNED,
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:4    
      111     7679    1         2 DSP UBIN(18) UNAL,
      112     7680    1         2 *   UBIN(18) UNAL;
      113     7681
      114     7682
      115     7683
      116     7684        /**/
      117     7685        /* AUTO */
      118     7686        /**/
      119     7687    1   DCL QTN$ PTR;
      120     7688    1   DCL RELIT UBIN;
      121     7689    1   DCL RBLK$ PTR;
      122     7690    1   DCL MBLK$ PTR;
      123     7691    1   DCL I UBIN;
      124     7692    1   DCL CG$ PTR;
      125     7693    1   DCL P$ PTR;
      126     7694    1   DCL DBLK$ PTR;
      127     7695    1   DCL DBLK$R REDEF DBLK$ UBIN;
      128     7696    1   DCL DDA UBIN;
      129     7697    1   DCL CWMBLK$ PTR;
      130     7698    1   DCL DOACT UBIN;
      131     7699
      132     7700
      133     7701
      134     7702        /**/
      135     7703        /* CONSTANT */
      136     7704        /**/
      137     7705        %$ERROR (NAME=E_CGNTUL,CODE=%E$CGNTUL);
      138     7711        %$ERROR (NAME=E_BCGULO,CODE=%E$BCGULO);
      139     7717        %$ERROR (NAME=E_MULDCW,CODE=%E$MULDCW);
      140     7723        %$ERROR (NAME=E_CULUSR,CODE=%E$CULUSR);
      141     7729        %$ERROR (NAME=E_CULRAUEVR,CODE=%E$CULRAUEVR);
      142     7735
      143     7736
      144     7737
      145     7738        /**/
      146     7739        /* REFS */
      147     7740        /**/
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:5    
      148     7741    1   DCL KCA$TELLAUR   ENTRY(3) ALTRET;
      149     7742    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      150     7743    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
      151     7744    1   DCL KQD$RENEGE    ENTRY(3) ALTRET;
      152     7745    1   DCL KQM$GETBR     ENTRY(3) ALTRET;
      153     7746    1   DCL KQM$GETMBLK   ENTRY(3) ALTRET;
      154     7747    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      155     7748    1   DCL KQM$RELRBLK   ENTRY(2) ALTRET;
      156     7749    1   DCL KQP$INCMP     ENTRY(1) ALTRET;
      157     7750    1   DCL KQQ$ACT       ENTRY(2) ALTRET;
      158     7751    1   DCL KQW$HOLD      ENTRY(1) ALTRET;
      159     7752    1   DCL KQW$SEND      ENTRY(1) ALTRET;
      160     7753    1   DCL KQW$SENDNA    ENTRY(1) ALTRET;
      161     7754    1   DCL SSS$CURTIME   ENTRY(1);
      162     7755    1   DCL SC_CGLRKL      ENTRY    CONV(2,0);
      163     7756    1   DCL SC_CGCALZ      ENTRY    CONV(2,0);
      164     7757    1   DCL SC_CGBADRBLK   ENTRY    CONV(2,0);
      165     7758    1   DCL B$JIT$ PTR SYMREF;
      166     7759
      167     7760
      168     7761
      169     7762        /**/
      170     7763        /* SUBS */
      171     7764        /**/
      172     7765        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      173     7766        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
      174     7767        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      175     7768        %EQU_CG;
      176     7816        %EJECT;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:6    
      177     7817    2           DO CASE (FPT_UNLATCH.OUTPUT);
      178     7818    2             CASE (%SEND#,%DELETE#);
      179     7819    2             CASE (ELSE);
      180     7820    2               GOTO BADOPT;
      181     7821    2           END;
      182     7822    1         RELIT=1;
      183     7823    1         GOTO UNL;
      184     7824        /**/
      185     7825        /*F* NAME:         KQU$UNLATCHF
      186     7826             PURPOSE:      To unlatch a latched input message
      187     7827             DESCRIPTION:  Called from KQR$READ when a read finds a
      188     7828                           successfully-completed lastched input message.
      189     7829                           The input is to be deleted, and the outputs
      190     7830                           sent.  The only error that can occur is if the
      191     7831                           station has a latched continued write in
      192     7832                           progress.
      193     7833                           Sometimes, we don't crank CNACT down in the Q-tree node
      194     7834                           where the input message (if any) came from.  Upon
      195     7835                           return, RLBK.CNACTD is set iff it was cranked down.
      196     7836                           Sets RBLK.QTN$ to the node's address iff the
      197     7837                           input msg came from a node (else sets it NIL).
      198     7838                           LATCHCNT will not be incremented; the caller is
      199     7839                           expected to do this.
      200     7840        */
      201     7841    1   KQU$UNLATCHF: ENTRY (KQ$STA,FPT_UNLATCH,ERR) ALTRET;
      202     7842        /**/
      203     7843    1         RELIT=0;
      204     7844    1         RBLK$=KQ$STA.RBLK$;
      205     7845    1         CG$=KQ$STA.CG$;
      206     7846    1         DOACT=0;
      207     7847    1         GOTO DELIN;
      208     7848    1   UNL:  ;
      209     7849    1         DOACT=1;
      210     7850              %LOCK (G=KQ$STA.GATE);
      211     7853    1         RBLK$=KQ$STA.RBLK$;
      212     7854    1         IF RBLK$ = ADDR(NIL) THEN GOTO NTULU;
      213     7855    1         IF RBLK$->KQ$RBLK.STATE ~= KQRS_COMP#
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:7    
      214     7856    1         OR RBLK$->KQ$RBLK.MBLK$ = ADDR(NIL)
      215     7857    1         OR RBLK$->KQ$RBLK.LATCH = '0'B THEN
      216     7858    2           DO;
      217     7859    2   NTULU:  ;
      218     7860                %UNLOCK (G=KQ$STA.GATE);
      219     7863    2   NTUL:   ;
      220     7864    2           ERR=E_CGNTUL;
      221     7865        /*E* ERROR:   KQU-E$CGNTUL-E
      222     7866             MESSAGE: Nothing to UNLATCH
      223     7867             MESSAGE1: You have no LATCHed message of the type you attempted
      224     7868                       to UNLATCH. */
      225     7869    2           ALTRETURN;
      226     7870    2           END;
      227     7871
      228     7872              %UNLOCK (G=KQ$STA.GATE);
      229     7875    1         CG$=KQ$STA.CG$;
      230     7876        %EJECT;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:8    
      231     7877        /*************************************************
      232     7878         *                                               *
      233     7879         *                                               *
      234     7880         *            DECIDE WHETHER THIS IS             *
      235     7881         *            LAST OUTPUT MESSAGE, OR            *
      236     7882         *            INPUT MESSAGE & ALL OUTPUTS.       *
      237     7883         *                                               *
      238     7884         *                                               *
      239     7885         *************************************************/
      240     7886
      241     7887    2           DO CASE (FPT_UNLATCH.INPUT);
      242     7888
      243     7889    2             CASE (ELSE);
      244     7890    2   BADOPT:     ;
      245     7891    2               ERR=E_BCGULO;
      246     7892        /*E* ERROR:   KQU-E$BCGULO-E
      247     7893             MESSAGE: Illegal option on M$UNLATCH
      248     7894             MESSAGE1: One of the INPUT or OUTPUT fields in your M$UNLATCH FPT
      249     7895                       contained an unknown disposition code, or you
      250     7896                       illegally specified INPUT = HOLD/RERUN and
      251     7897                       OUTPUT ~= DELETE. */
      252     7898    2   ALTRT:      ALTRETURN;
      253     7899
      254     7900        /*************************************************
      255     7901         *                                               *
      256     7902         *            UNLATCH LAST LATCHED OUTPUT        *
      257     7903         *                                               *
      258     7904         *************************************************/
      259     7905    2             CASE (0);
      260     7906    2               CALL GETCLW ALTRET(DOLW);
      261     7907    2               IF NOT MBLK$->KQ$MBLK.LATCH THEN
      262     7908    2                GOTO MULDCW;
      263     7909    2               IF  NOT MBLK$->KQ$MBLK.FORCECONT
      264     7910    2               AND FPT_UNLATCH.OUTPUT ~= %DELETE# THEN
      265     7911    3                 DO;
      266     7912    3   MULDCW:       ;
      267     7913    3                 ERR=E_MULDCW;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:9    
      268     7914        /*E* ERROR:   KQU-E$MULDCW-E
      269     7915             MESSAGE: You can only UNLATCH DELETE a continued, LATCHed write
      270     7916             MESSAGE1: Your DCB has a LATCHed continued output message
      271     7917                       waiting for the next segment to be written.  Since this
      272     7918                       is your most recent LATCHed output, it clearly cannot
      273     7919                       be sent yet; M$UNLATCH can only delete it. */
      274     7920    3                 ALTRETURN;
      275     7921    3                 END;
      276     7922    2               CALL DUMPWR;
      277     7923    2               RETURN;
      278     7924    2   DOLW:       ;
      279     7925    2               IF RBLK$->KQ$RBLK.LWRITES$ = ADDR(NIL) THEN GOTO NTUL;
      280     7926    2               MBLK$=RBLK$->KQ$RBLK.LWTL$;
      281     7927    2               IF ADDR(MBLK$->KQ$MBLK.DCB$)->B$$PTRR.DSP ~= ADDR(B$JIT.DCB$)->B$$PTRR.
              7927                        DSP THEN
      282     7928    2                GOTO NTUL;
      283     7929    2               IF MBLK$ = RBLK$->KQ$RBLK.LWRITES$ THEN
      284     7930    3                 DO INHIBIT;
      285     7931    3                 P$=ADDR(RBLK$->KQ$RBLK.LWRITES$);
      286     7932    3                 CALL DUMPWR;
      287     7933    3                 RETURN;
      288     7934    3                 END;
      289     7935    2               P$=RBLK$->KQ$RBLK.LWRITES$;
      290     7936    3                 DO FOREVER;
      291     7937    3                 IF P$->KQ$MBLK.LNK$ = MBLK$ THEN
      292     7938    4                   DO INHIBIT;
      293     7939    4                   RBLK$->KQ$RBLK.LWTL$=P$;
      294     7940    4                   P$=ADDR(P$->KQ$MBLK.LNK$);
      295     7941    4                   CALL DUMPWR;
      296     7942    4                   RETURN;
      297     7943    4                   END;
      298     7944    3                 P$=P$->KQ$MBLK.LNK$;
      299     7945    3                 END;
      300     7946
      301     7947        /*************************************************
      302     7948         *                                               *
      303     7949         *            UNLATCH INPUT & ALL OUTPUTS        *
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:10   
      304     7950         *                                               *
      305     7951         *************************************************/
      306     7952    2             CASE (%HOLD#,%RERUN#);
      307     7953    2               IF FPT_UNLATCH.OUTPUT ~= %DELETE# THEN GOTO BADOPT;
      308     7954    2               MBLK$=RBLK$->KQ$RBLK.MBLK$;
      309     7955    2               IF FPT_UNLATCH.INPUT = %RERUN# THEN
      310     7956    2                IF (CG$->KQ$CG.QISS AND MBLK$->KQ$MBLK.KEY2='*AUEV') OR
      311     7957    2                (NOT CG$->KQ$CG.QISS AND MBLK$->KQ$MBLK.KEY1='*AUEV') THEN
      312     7958    3                  DO;
      313     7959    3                  ERR=E_CULRAUEVR;
      314     7960        /*E* ERROR:   KQU-E$CULRAUEVR-E
      315     7961             MESSAGE: Can't UNLATCH RERUN an input with msgtyp *AUEV
      316     7962             MESSAGE1: You cannot UNLATCH RERUN an input message read with
      317     7963                       latch if its message type is *AUEV.  Since this message
      318     7964                       is sent to you, it clearly should not be rerun; M$UNLATCH
      319     7965                       can only delete it or place it in hold status.  */
      320     7966    3                  ALTRETURN;
      321     7967    3                  END;
      322     7968    2               GOTO DELIN;
      323     7969
      324     7970    2             CASE (%DELETE#);
      325     7971    2               MBLK$=RBLK$->KQ$RBLK.MBLK$;
      326     7972                    /* WE DON'T CARE IF A *AUEV MESSAGE IS SUCCESSFULLY READ */
      327     7973    2               IF RBLK$->KQ$RBLK.CS = '0'B AND NOT
      328     7974    2               ((CG$->KQ$CG.QISS AND MBLK$->KQ$MBLK.KEY2='*AUEV') OR
      329     7975    2               (NOT CG$->KQ$CG.QISS AND MBLK$->KQ$MBLK.KEY1='*AUEV')) THEN
      330     7976    3                 DO;
      331     7977    3                 ERR=E_CULUSR;
      332     7978        /*E* ERROR:   KQU-E$CULUSR
      333     7979             MESSAGE: Can't UNLATCH DELETE an input until successfully read
      334     7980             MESSAGE1: You cannot UNLATCH DELETE an input message read with
      335     7981                       latch until it has been successfully read. */
      336     7982    3                 ALTRETURN;
      337     7983    3                 END;
      338     7984    2   DELIN:      ;
      339     7985    2               MBLK$=KQ$STA.MBLK$;
      340     7986    2               IF FPT_UNLATCH.OUTPUT ~= %DELETE# THEN
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:11   
      341     7987    3                 DO WHILE (MBLK$ ~= ADDR(NIL));
      342     7988    3                 IF MBLK$->KQ$MBLK.LATCH THEN
      343     7989    3                  IF NOT MBLK$->KQ$MBLK.FORCECONT THEN GOTO MULDCW;
      344     7990    3                 MBLK$=MBLK$->KQ$MBLK.LNK$;
      345     7991    3                 END;
      346     7992    2   DOLW1:      ;
      347     7993    2               IF RBLK$->KQ$RBLK.FROMQ = '0'B THEN RBLK$->KQ$RBLK.QTN$=ADDR(NIL);
      348     7994    2               ELSE
      349     7995    3                 DO;
      350     7996    3                 MBLK$=RBLK$->KQ$RBLK.MBLK$;
      351     7997                      %LOCK (G=KQ$QTREE.GATE);
      352     8000    3                 QTN$=RBLK$->KQ$RBLK.QTN$;
      353     8001    3                 IF QTN$->KQ$QTN.STA.BTN.KEY ~= MBLK$->KQ$MBLK.KEY1 THEN
      354     8002    3                  CALL SC_CGLRKL;
      355     8003        /*S* SCREECH_CODE: KQU-S$CGLRKL
      356     8004             TYPE:         SCREECH
      357     8005             MESSAGE:      COMGROUP LATCHed read key lost
      358     8006             REMARKS:      This SCREECH occurs when an input message that came
      359     8007                           from the queue is unlatched, but the Q-tree node
      360     8008                           it came from is not there.  If the
      361     8009                           Q-tree is the msg type tree, then most likely the
      362     8010                           message MBLK (which contains the key) has been
      363     8011                           clobbered, for T-tree nodes rarely get deleted.  If
      364     8012                           the Q-tree is the station tree, then someone has
      365     8013                           deleted a station when current number active was
      366     8014                           nonzero (either that or current number active was
      367     8015                           incorrectly zero). */
      368     8016    3                 IF  QTN$->KQ$QTN.MXACT < 100
      369     8017    3                 AND DOACT = 0 THEN
      370     8018                                /* KQU$UNLATCHF - don't update CNACT */
      371     8019    3                  QTN$->KQ$QTN.CRASHACT=QTN$->KQ$QTN.CRASHACT+1; /* For RECOVERY */
      372     8020    3                 ELSE IF NOT RBLK$->KQ$RBLK.CNACTD THEN
      373     8021    4                    DO;
      374     8022                                /* Update CNACT in Q-tree node where this
      375     8023                                   message came from */
      376     8024    4                    QTN$->KQ$QTN.CNACT=QTN$->KQ$QTN.CNACT-1;
      377     8025                                /* If we crash while handling the outputs,
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:12   
      378     8026                                   don't want to decrement CNACT again when
      379     8027                                   the comgroup is re-opened */
      380     8028    4                    RBLK$->KQ$RBLK.CNACTD='1'B;
      381     8029    4                    IF QTN$->KQ$QTN.CNACT < 0 THEN CALL SC_CGCALZ;
      382     8030        /*S* SCREECH_CODE: KQU-S$CGCALZ
      383     8031             TYPE:         SCREECH
      384     8032             MESSAGE:      COMGROUP QUEUE active count negative
      385     8033             REMARKS:      This SCREECH occurs when an input message that
      386     8034                           came from the queue is unlatched, and the current
      387     8035                           number active count for the Q-tree node it came
      388     8036                           from was zero. */
      389     8037    4                    IF QTN$->KQ$QTN.CNACT = QTN$->KQ$QTN.MXACT -1 THEN
      390     8038    5                      DO;
      391     8039    5                      CALL KQQ$ACT (CG$->KQ$CG,QTN$);
      392     8040    5                      GOTO UNL1;
      393     8041    5                      END;
      394     8042    4                    END;
      395     8043                      %UNLOCK (G=KQ$QTREE.GATE);
      396     8046    3                 END;
      397     8047    2   UNL1:       ;
      398     8048    2               IF FPT_UNLATCH.INPUT = %DELETE# THEN
      399     8049                                /* Set state so that if we crash while handling
      400     8050                                   the outputs, we'll remember the successful
      401     8051                                   unlatch was issued */
      402     8052    2                RBLK$->KQ$RBLK.STATE=KQRS_UNLA#;
      403     8053                                /* Now dump the outputs */
      404     8054    2               P$=ADDR(KQ$STA.MBLK$);
      405     8055    2               MBLK$=KQ$STA.MBLK$;
      406     8056    3                 DO WHILE (MBLK$ ~= ADDR(NIL));
      407     8057    3                 IF MBLK$->KQ$MBLK.LATCH THEN CALL DUMPWR;
      408     8058    3                 ELSE P$=ADDR(MBLK$->KQ$MBLK.LNK$);
      409     8059    3                 MBLK$=P$->B$$PTR;
      410     8060    3                 END;
      411     8061    2               P$=ADDR(RBLK$->KQ$RBLK.LWRITES$);
      412     8062    2               MBLK$=RBLK$->KQ$RBLK.LWRITES$;
      413     8063    3                 DO WHILE (MBLK$ ~= ADDR(NIL));
      414     8064    3                 CALL DUMPWR;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:13   
      415     8065    3                 MBLK$=RBLK$->KQ$RBLK.LWRITES$;
      416     8066    3                 END;
      417     8067    2               CALL DUMPRD;
      418     8068    2               RBLK$->KQ$RBLK.STATE=KQRS_COMP#;
      419     8069    2               IF RELIT = 1 THEN
      420     8070    3                 DO;
      421     8071                      %LOCK (G=KQ$STA.GATE);
      422     8074    3                 IF RBLK$ ~= KQ$STA.RBLK$ THEN
      423     8075    4                   DO;
      424     8076    4                   CALL SC_CGBADRBLK;
      425     8077        /*S* SCREECH_CODE: KQU-S$CGBADRBLK
      426     8078             TYPE:         SNAP
      427     8079             MESSAGE:      RBLK pointer modified during UNLATCH
      428     8080             REMARKS:      This SNAP occurs when we have discovered that someone, on
      429     8081                           another CPU, has modified KQ$STA.RBLK$ while we're using it.
      430     8082                           The above code makes a lot of assumptions (by never locking
      431     8083                           the station gate) that no one else is looking at this station's
      432     8084                           RBLK.  (The following lock exists because KQT$VALREAD does
      433     8085                           look at the station's RBLK$ so we can't delete it out from
      434     8086                           underneath him!)  If this snap ever occurs, we need to see
      435     8087                           who else is messing with the RBLK.  By going around the
      436     8088                           normal code here, we may avoid breaking some chains.  */
      437     8089                        %UNLOCK (G=KQ$STA.GATE);
      438     8092    4                   END;
      439     8093    3                 ELSE
      440     8094    4                   DO;
      441     8095    4                   KQ$STA.RBLK$ = ADDR(NIL);
      442     8096                        %UNLOCK (G=KQ$STA.GATE);
      443     8099    5                     DO INHIBIT;
      444     8100    5                     CALL KQM$RELRBLK (CG$->KQ$CG,RBLK$);
      445     8101    5                     END;
      446     8102    4                   END;
      447     8103    3                 END;
      448     8104    2               IF DOACT ~= 0 THEN
      449     8105    3                 DO;
      450     8106                      %LOCK (G=KQ$STA.GATE);
      451     8109    3                 KQ$STA.LATCHCNT=KQ$STA.LATCHCNT+1;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:14   
      452     8110                      %UNLOCK (G=KQ$STA.GATE);
      453     8113    3                 END;
      454     8114
      455     8115    2           END; /* CASE FPT_UNLATCH.INPUT */
      456     8116    1         RETURN;
      457     8117        %EJECT;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:15   
      458     8118        /****************************************************************
      459     8119        *****************************************************************/
      460     8120        /*D* NAME:         DUMPRD
      461     8121             PURPOSE:      To dispose of a latched input message
      462     8122             DESCRIPTION:  The station's currently-latched input is
      463     8123                           disposed of according to FPT_UNLATCH.INPUT.
      464     8124        */
      465     8125    1   DUMPRD: PROC ALTRET;
      466     8126    2         MBLK$=RBLK$->KQ$RBLK.MBLK$;
      467     8127    3           DO CASE (FPT_UNLATCH.INPUT);
      468     8128
      469     8129    3             CASE (%RERUN#);
      470     8130    3               IF FPT_UNLATCH.TELLAU & '1'B THEN
      471     8131    3                CALL TELLAU (%CG_UNLR#);
      472     8132    3               IF FPT_UNLATCH.TELLOS & '1'B THEN CALL TELLOS;
      473     8133    3               IF MBLK$->KQ$MBLK.DDA ~= 0 THEN
      474     8134    4                 DO;
      475     8135    4                 DBLK$R=MBLK$->KQ$MBLK.STAMP;
      476     8136    4                 CALL KQD$RENEGE (CG$->KQ$CG,DBLK$,MBLK$->KQ$MBLK.DDA);
      477     8137    4                 END;
      478     8138        /**/
      479     8139    3               IF  FPT_UNLATCH.JOURNALED
      480     8140    3               AND ADDR(KQ$STA) = CG$->KQ$CG.JRNLSTA$ THEN
      481     8141    3                CALL INCMP;
      482     8142        /**/
      483     8143    4                 DO INHIBIT;
      484     8144    4                 RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);
      485     8145    4                 MBLK$->KQ$MBLK.RBLK = '0'B;
      486     8146    4                 RBLK$->KQ$RBLK.NCDDA=0;
      487     8147    4                 GOTO SEND;
      488     8148    4                 END;
      489     8149
      490     8150    3             CASE (%HOLD#);
      491     8151    3               IF FPT_UNLATCH.TELLAU & '11'B THEN
      492     8152    3                CALL TELLAU (%CG_UNLH#);
      493     8153    3               IF FPT_UNLATCH.TELLOS & '11'B THEN CALL TELLOS;
      494     8154    3               IF MBLK$->KQ$MBLK.DDA ~= 0 THEN
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:16   
      495     8155    4                 DO;
      496     8156    4                 DBLK$R=MBLK$->KQ$MBLK.STAMP;
      497     8157    4                 CALL KQD$RENEGE (CG$->KQ$CG,DBLK$,MBLK$->KQ$MBLK.DDA);
      498     8158    4                 END;
      499     8159    4                 DO INHIBIT;
      500     8160    4                 RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);
      501     8161    4                 MBLK$->KQ$MBLK.RBLK = '0'B;
      502     8162    4                 RBLK$->KQ$RBLK.NCDDA=0;
      503     8163    4                 CWMBLK$=KQ$STA.MBLK$;
      504     8164    4                 KQ$STA.MBLK$=MBLK$;
      505     8165    4                 CALL KQW$HOLD (KQ$STA);
      506     8166    4                 KQ$STA.MBLK$=CWMBLK$;
      507     8167    4                 END;
      508     8168
      509     8169    3             CASE (%DELETE#);
      510     8170    3               IF FPT_UNLATCH.TELLAU & '1'B THEN
      511     8171    3                CALL TELLAU (%CG_UNLD#);
      512     8172    3               IF FPT_UNLATCH.TELLOS & '1'B THEN CALL TELLOS;
      513     8173    4                 DO INHIBIT;
      514     8174    4                 MBLK$->KQ$MBLK.DDA=RBLK$->KQ$RBLK.NCDDA;
      515     8175    4                 RBLK$->KQ$RBLK.NCDDA=0;
      516     8176    4                 RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);
      517     8177    4                 MBLK$->KQ$MBLK.RBLK = '0'B;
      518     8178    4                 CALL DELMSG;
      519     8179    4                 END;
      520     8180
      521     8181    3           END; /* CASE FPT_UNLATCH.INPUT */
      522     8182    2         RETURN;
      523     8183        /****************************************************************
      524     8184        *****************************************************************/
      525     8185        /*D* NAME:         DUMPWR
      526     8186             PURPOSE:      To dispose of a latched output msg
      527     8187             DESCRIPTION:  MBLK$ points to the output msg to be gotten rid
      528     8188                           of, and P$ points to the link which must be set
      529     8189                           to the message's link.  The message is disposed
      530     8190                           of according to FPT_UNLATCH.OUTPUT.
      531     8191        */
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:17   
      532     8192    2   DUMPWR: ENTRY ALTRET;
      533     8193
      534     8194    3           DO CASE (FPT_UNLATCH.OUTPUT);
      535     8195
      536     8196    3             CASE (%DELETE#);
      537     8197    4                 DO INHIBIT;
      538     8198    4                 P$->B$$PTR=MBLK$->KQ$MBLK.LNK$;
      539     8199    4                 CALL DELMSG;
      540     8200    4                 END;
      541     8201
      542     8202    3             CASE (%SEND#);
      543     8203    4                 DO INHIBIT;
      544     8204    4                 P$->B$$PTR=MBLK$->KQ$MBLK.LNK$;
      545     8205    4                 MBLK$->KQ$MBLK.TYC='0'B;
      546     8206    4                 MBLK$->KQ$MBLK.DVE.DVBYTE=MBLK$->KQ$MBLK.DVE.DVBYTE & (~%DVBYTE_CONT#)
              8206                          ;
      547     8207    4   SEND:         ;
      548     8208    4                 CWMBLK$=KQ$STA.MBLK$;
      549     8209    4                 KQ$STA.MBLK$=MBLK$;
      550     8210    4                 CALL KQW$SEND (KQ$STA);
      551     8211    4                 KQ$STA.MBLK$=CWMBLK$;
      552     8212    4                 END;
      553     8213
      554     8214    3           END; /* CASE FPT_UNLATCH.OUTPUT */
      555     8215    2         RETURN;
      556     8216    2   END DUMPRD;
      557     8217        /**/
      558     8218        /****************************************************************
      559     8219        *****************************************************************/
      560     8220        /*D* NAME:         TELLOS
      561     8221             PURPOSE:      To send '*RESPX' to the origin station of a latched
      562     8222                           input
      563     8223             DESCRIPTION:  A message of type '*RESPX', and no data, is sent
      564     8224                           the the station that sent the message pointed to
      565     8225                           by MBLK$
      566     8226        */
      567     8227    1   TELLOS: PROC;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:18   
      568     8228        /**/
      569     8229    2   DCL TMBLK$ PTR;
      570     8230        /**/
      571     8231    2         CALL KQM$GETMBLK (CG$->KQ$CG,TMBLK$,I) ALTRET(T0);
      572     8232    2         GOTO T1;
      573     8233    2   T0:   I=KQMR_MBLK#;
      574     8234    2         TMBLK$=ADDR(KQ$STA);
      575     8235    2         CALL KQM$GETBR (CG$->KQ$CG,TMBLK$,I) ALTRET(RTN);
      576     8236    2   T1:   ;
      577     8237    2         TMBLK$->KQ$MBLK.STAR='1'B;
      578     8238    2         IF CG$->KQ$CG.QISS THEN
      579     8239    3           DO;
      580     8240    3           TMBLK$->KQ$MBLK.KEY1=KQ$STA.BTN.KEY;
      581     8241    3           TMBLK$->KQ$MBLK.KEY2='*RESPX';
      582     8242    3           TMBLK$->KQ$MBLK.DSTA=MBLK$->KQ$MBLK.KEY1;
      583     8243    3           END;
      584     8244    2         ELSE
      585     8245    3           DO;
      586     8246    3           TMBLK$->KQ$MBLK.KEY1='*RESPX';
      587     8247    3           TMBLK$->KQ$MBLK.KEY2=KQ$STA.BTN.KEY;
      588     8248    3           TMBLK$->KQ$MBLK.DSTA=MBLK$->KQ$MBLK.KEY2;
      589     8249    3           END;
      590     8250    2         TMBLK$->KQ$MBLK.MID.PRIMARY=MBLK$->KQ$MBLK.MID.PRIMARY;
      591     8251    2         TMBLK$->KQ$MBLK.MID.XT     =BITBIN('777777777777'O);
      592     8252    2         CWMBLK$=KQ$STA.MBLK$;
      593     8253    2         KQ$STA.MBLK$=TMBLK$;
      594     8254    2         CALL KQW$SENDNA (KQ$STA);
      595     8255    2         KQ$STA.MBLK$=CWMBLK$;
      596     8256    2   RTN:  RETURN;
      597     8257    2   END TELLOS;
      598     8258        /**/
      599     8259        /****************************************************************
      600     8260        *****************************************************************/
      601     8261        /*D* NAME:         TELLAU
      602     8262             PURPOSE:      To send a message to the AU
      603     8263        */
      604     8264    1   TELLAU: PROC (CODE);
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:19   
      605     8265        /**/
      606     8266    2   DCL CODE UBIN WORD;
      607     8267        /**/
      608     8268    2         CALL KCA$TELLAUR (KQ$STA,CODE,MBLK$->KQ$MBLK);
      609     8269    2         RETURN;
      610     8270    2   END TELLAU;
      611     8271        /**/
      612     8272        /****************************************************************
      613     8273        *****************************************************************/
      614     8274        /*D* NAME:         INCMP
      615     8275             PURPOSE:      To process release by the journaller of a
      616     8276                           journaled message
      617     8277             DESCRIPTION:  The JRNLD flag is set in the message, and the
      618     8278                           originating TERMINAL (if any) is told about
      619     8279                           the MSGID if he in fact wants to be.
      620     8280        */
      621     8281    1   INCMP: PROC;
      622     8282        /**/
      623     8283        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      624     8622    2   DCL OSTA$ PTR;
      625     8623        /**/
      626     8624    2         MBLK$->KQ$MBLK.JRNLD='1'B;
      627     8625    2         IF NOT MBLK$->KQ$MBLK.DVE.DVBYTE & %DVBYTE_RRR# THEN RETURN;
      628     8626              %LOCK (G=KQ$STREE.GATE);
      629     8629    2         IF CG$->KQ$CG.QISS THEN
      630     8630    2          CALL KQB$SRCH (KQ$STREE,MBLK$->KQ$MBLK.KEY1,OSTA$) ALTRET(J0);
      631     8631    2         ELSE
      632     8632    2          CALL KQB$SRCH (KQ$STREE,MBLK$->KQ$MBLK.KEY2,OSTA$) ALTRET(J0);
      633     8633              %LOCK (G=OSTA$->KQ$STA.GATE);
      634     8636              %UNLOCK (G=KQ$STREE.GATE);
      635     8639    2         IF  OSTA$->KQ$STA.IDSC = '0'B
      636     8640    2         AND OSTA$->KQ$STA.TERM
      637     8641    2         AND OSTA$->KQ$STA.LDCT$ ~= ADDR(NIL)
      638     8642    2         AND OSTA$->KQ$STA.JRNLW
      639     8643    2         AND OSTA$->KQ$STA.JMSGID = MBLK$->KQ$MBLK.MID.PRIMARY THEN
      640     8644    3           DO;
      641     8645    3           OSTA$->KQ$STA.LOCKCNT=OSTA$->KQ$STA.LOCKCNT+1;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:20   
      642     8646    3           CALL KQP$INCMP (OSTA$->KQ$STA);
      643     8647    3           END;
      644     8648    2         ELSE
      645     8649    3           DO;
      646     8650                %UNLOCK (G=OSTA$->KQ$STA.GATE);
      647     8653    3           END;
      648     8654    2         RETURN;
      649     8655    2   J0:   ;
      650     8656              %UNLOCK (G=KQ$STREE.GATE);
      651     8659    2         RETURN;
      652     8660    2   END INCMP;
      653     8661        /****************************************************************
      654     8662        *****************************************************************/
      655     8663        /*D* NAME:         GETCLW
      656     8664             PURPOSE:      To find a continued latched write
      657     8665             DESCRIPTION:  Searches the chain of outstanding continued
      658     8666                           writes for one from the JIT DCB.  If it
      659     8667                           finds it then RETURN with MBLK$ pointing to
      660     8668                           the MBLK, and P$ pointing to the link word
      661     8669                           to be used for removal.  Else ALTRETs.
      662     8670        */
      663     8671    1   GETCLW: PROC ALTRET;
      664     8672        /**/
      665     8673    2         MBLK$=KQ$STA.MBLK$;
      666     8674    2         P$=ADDR(KQ$STA.MBLK$);
      667     8675    3           DO WHILE (MBLK$ ~= ADDR(NIL));
      668     8676    3           IF ADDR(MBLK$->KQ$MBLK.DCB$)->B$$PTRR.DSP = ADDR(B$JIT.DCB$)->B$$PTRR.DSP
              8676                    THEN
      669     8677    3            RETURN;
      670     8678    3           P$=ADDR(MBLK$->KQ$MBLK.LNK$);
      671     8679    3           MBLK$=MBLK$->KQ$MBLK.LNK$;
      672     8680    3           END;
      673     8681    2         ALTRETURN;
      674     8682    2   END GETCLW;
      675     8683        %EJECT;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:21   
      676     8684        /*F* NAME:         KQU$DELREAD
      677     8685             PURPOSE:      To delete a COMGROUP message
      678     8686             DESCRIPTION:  The first parameter is the station on whose behalf
      679     8687                           the message is being deleted.  The message to
      680     8688                           delete is pointed to by the RBLK indicated in
      681     8689                           KQ$STA.RBLK$.  The message is deleted by placing
      682     8690                           it on the delete queue and NILing out the RBLK
      683     8691                           pointer to it.
      684     8692
      685     8693                           The RBLK's NCDDA is held to be the first chunk
      686     8694                           of the message that is to be deleted.  To do
      687     8695                           this, NCDDA is stored in KQ$MBLK.DDA, and
      688     8696                           NCDDA is zeroed.
      689     8697        */
      690     8698    1   KQU$DELREAD: ENTRY(KQ$STA) ALTRET; /* !!Doesn't ALTRET!! */
      691     8699        /**/
      692     8700    1         RBLK$=KQ$STA.RBLK$;
      693     8701    1         CG$=KQ$STA.CG$;
      694     8702    2           DO INHIBIT;
      695     8703    2           MBLK$=RBLK$->KQ$RBLK.MBLK$;
      696     8704    2           RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);
      697     8705    2           IF MBLK$ = ADDR(NIL) THEN RETURN;
      698     8706    2           MBLK$->KQ$MBLK.RBLK = '0'B;
      699     8707    2           MBLK$->KQ$MBLK.DDA=RBLK$->KQ$RBLK.NCDDA;
      700     8708    2           RBLK$->KQ$RBLK.NCDDA=0;
      701     8709    2           CALL DELMSG;
      702     8710    2           END;
      703     8711    1         RETURN;
      704     8712        /*F* NAME:         KQU$DELETE
      705     8713             PURPOSE:      To delete a COMGROUP message
      706     8714             DESCRIPTION:  Called on behalf of a station to delete a message.
      707     8715                           The MBLK to delete is in KQ$STA.MBLK$, which is
      708     8716                           set to NIL.  If the data can be fetched and deleted
      709     8717                           now, this is done and the MBLK released, else the
      710     8718                           MBLK is placed on the delete queue.
      711     8719        */
      712     8720    1   KQU$DELETE: ENTRY (KQ$STA) ALTRET; /* !!Doesn't ALTRET!! */
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:22   
      713     8721        /**/
      714     8722    1         CG$=KQ$STA.CG$;
      715     8723    2           DO INHIBIT;
      716     8724    2           MBLK$=KQ$STA.MBLK$;
      717     8725    2           KQ$STA.MBLK$=ADDR(NIL);
      718     8726    2           CALL DELMSG;
      719     8727    2           END;
      720     8728    1         RETURN;
      721     8729        /**/
      722     8730        /*F* NAME:         KQU$DELMSG
      723     8731             PURPOSE:      To delete a COMGROUP message
      724     8732             CALL:         KQU$DELMSG (KQ$CG,KQ$MBLK);
      725     8733             DESCRIPTION:  The message described by KQ$MBLK is deleted.
      726     8734        */
      727     8735    1   KQU$DELMSG: ENTRY (KQ$STA,FPT_UNLATCH) ALTRET; /* !!Doesn't ALTRET!! */
      728     8736        /**/
      729     8737    2           DO INHIBIT;
      730     8738    2           CG$=ADDR(KQ$STA);
      731     8739    2           MBLK$=ADDR(FPT_UNLATCH);
      732     8740    2           CALL DELMSG;
      733     8741    2           END;
      734     8742    1         RETURN;
      735     8743        /*D* NAME:         DELMSG
      736     8744             PURPOSE:      To delete a message
      737     8745             DESCRIPTION:  The MBLK to delete is MBLK$.  The message
      738     8746                           is gotten rid of either by deleting the DBLKs
      739     8747                           and releasing the MBLK, or by placing the MBLK on
      740     8748                           the delete queue.
      741     8749        */
      742     8750    1   DELMSG: PROC;
      743     8751    3           DO INHIBIT;
      744     8752    3           IF NOT MBLK$->KQ$MBLK.JRNLD THEN
      745     8753    4             DO;
      746     8754    4             IF MBLK$->KQ$MBLK.DDA ~= 0 THEN
      747     8755    4              CALL DELDDA ALTRET(DEL0);
      748     8756    4             CALL KQM$RELMBLK (CG$->KQ$CG,MBLK$);
      749     8757    4             RETURN;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:23   
      750     8758    4             END;
      751     8759    3   DEL0:   ;
      752     8760                %LOCK (G=CG$->KQ$CG.GATE.MISC);
      753     8763    3           MBLK$->KQ$MBLK.LNK$=CG$->KQ$CG.DELMSG$;
      754     8764    3           CG$->KQ$CG.DELMSG$=MBLK$;
      755     8765    4             DO WHILE (CG$->KQ$CG.DELMSG$ ~= ADDR(NIL));
      756     8766    4             MBLK$=CG$->KQ$CG.DELMSG$;
      757     8767    4             IF MBLK$->KQ$MBLK.JRNLD
      758     8768    4             OR MBLK$->KQ$MBLK.SUPER THEN GOTO DEL1;
      759     8769    4             IF MBLK$->KQ$MBLK.DDA ~= 0 THEN
      760     8770    4              CALL DELDDA ALTRET(DEL1);
      761     8771    4             CG$->KQ$CG.DELMSG$=MBLK$->KQ$MBLK.LNK$;
      762     8772    4             CALL KQM$RELMBLK (CG$->KQ$CG,MBLK$);
      763     8773    4             END;
      764     8774    3   DEL1:   ;
      765     8775                %UNLOCK (G=CG$->KQ$CG.GATE.MISC);
      766     8778    3           RETURN;
      767     8779    3           END; /*INHIBIT*/
      768     8780        /**/
      769     8781    2   DELDDA: PROC ALTRET;
      770     8782        /**/
      771     8783    4           DO INHIBIT;
      772     8784    4           DBLK$R=MBLK$->KQ$MBLK.STAMP;
      773     8785    4           DDA=MBLK$->KQ$MBLK.DDA;
      774     8786    4           CALL KQD$DELDDA (CG$->KQ$CG,DBLK$,DDA) ALTRET(D1);
      775     8787    4           RETURN;
      776     8788    4   D1:     IF DDA ~= %KQDE_NDFRBLK THEN RETURN;
      777     8789    4           ALTRETURN;
      778     8790    4           END; /* Inhibit */
      779     8791    3   END DELDDA;
      780     8792    2   END DELMSG;
      781     8793    1   END KQU$UNLATCH;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:24   
--  Include file information  --

   B$JIT_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQU$UNLATCH.

   Procedure KQU$UNLATCH requires 962 words for executable code.
   Procedure KQU$UNLATCH requires 28 words of local(AUTO) storage.

    No errors detected in file KQU$UNLATCH.:E05TSI    .

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:25   

 Object Unit name= KQU$UNLATCH                                File name= KQU$UNLATCH.:E05TOU
 UTS= JUL 30 '97 01:37:43.96 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      9     11  KQU$UNLATCH
    1   Proc  even  none   962   1702  KQU$UNLATCH
    2  RoData even  none     4      4  KQU$UNLATCH

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  KQU$UNLATCH
     1     17          yes     yes      Std        3  KQU$UNLATCHF
     1   1455          yes     yes      Std        1  KQU$DELREAD
     1   1511          yes     yes      Std        1  KQU$DELETE
     1   1525          yes     yes      Std        2  KQU$DELMSG
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:26   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       2 KQM$RELRBLK
 yes     yes           Std       2 KQQ$ACT
 yes     yes           Std       3 KQD$RENEGE
 yes     yes           Std       1 KQW$SEND
 yes     yes           Std       1 KQW$HOLD
 yes     yes           Std       3 KQM$GETMBLK
 yes     yes           Std       3 KQM$GETBR
 yes     yes           Std       1 KQW$SENDNA
 yes     yes           Std       3 KCA$TELLAUR
 yes     yes           Std       3 KQB$SRCH
 yes     yes           Std       1 KQP$INCMP
 yes     yes           Std       2 KQM$RELMBLK
 yes     yes           Std       3 KQD$DELDDA
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_CGBADRBLK                          SC_CGLRKL                             SC_CGCALZ
     B$JIT$                                B_VECTNIL
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:27   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:28   


        1        1        /*M* KQU$UNLATCH UNLATCH routines for COMGROUP */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQU$UNLATCH
       10       10             PURPOSE:      To provide UNLATCH and DELETE functions for
       11       11                           COMGROUP messages.
       12       12             DESCRIPTION:  Contains routines to delete (in various ways)
       13       13                           messages in a COMGROUP.
       14       14        */
       15       15        /**/
       16       16        /*F* NAME:         KQU$UNLATCH
       17       17             PURPOSE:      To unlatch COMGROUP messages
       18       18             DESCRIPTION:  Called on behalf of a station to either
       19       19                            - dispose of the last latched message written
       20       20                              thru this station
       21       21
       22       22                           or
       23       23
       24       24                            - dispose of the latched input message curently
       25       25                              held by this station, as well as all latched
       26       26                              messages attached to it.
       27       27
       28       28                           The choices for an input message are delete, rerun
       29       29                           (put back to be read by somebody else), or put in
       30       30                           'hold' status to be played with by the AU.
       31       31
       32       32                           The choices for a latched write are delete or send
       33       33                           (actually dispatch to its destination).
       34       34
       35       35                           When a station has a read latched and it writes a
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:29   
       36       36                           message with latch, the message goes on the tail
       37       37                           of the chain headed by KQ$RBLK.LWRITES$ (after the
       38       38                           data has been written into the comgroup).  Thus
       39       39                           KQ$RBLK.LWRITES$ is a chain of MBLKs each pointing
       40       40                           to the DBLK(s) containing the message data.
       41       41
       42       42                           The options for the unlatch are passed in an
       43       43                           M$UNLATCH FPT V-area called FPT_UNLATCH; if
       44       44                           FPT_UNLATCH.INPUT is zero, then only the last latched
       45       45                           write is to be mucked with (as specified by FPT_
       46       46                           UNLATCH.OUTPUT), else INPUT says what to do with the
       47       47                           latched input, and OUTPUT says what to do with all
       48       48                           the output messages.  The ALTRET is taken if an
       49       49                           error occurs (see the *E*'s), with ERR set.
       50       50        */
       51       51        /**/
       52       52        KQU$UNLATCH: PROC (KQ$STA,FPT_UNLATCH,ERR) ALTRET;

     52  1 000000   000000 700200 xent  KQU$UNLATCH  TSX0  ! X66_AUTO_3
         1 000001   000034 000003                    ZERO    28,3

       53       53        /**/
       54       54
       55       55
       56       56
       57       57        /**/
       58       58        /* INCLUDES */
       59       59        /**/
       60       60        %INCLUDE KQ_SUBS_C;
       61      360        %INCLUDE KQ_MAC_C;
       62     2910        %INCLUDE HF_LOCK_C;
       63     2924        %INCLUDE KQ_DATA_R;
       64     3756        %INCLUDE KQ_ERRORS_C;
       65     3804        %INCLUDE KC$CP6V_C;
       66     3924        %INCLUDE CP_6_SUBS;
       67     4464        %INCLUDE UD_SEV_C;
       68     4478        %INCLUDE KC_CP6;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:30   
       69     5038        %INCLUDE NK$LDCT;
       70     5140        %INCLUDE B$JIT_C;
       71     5454
       72     5455
       73     5456
       74     5457        /**/
       75     5458        /* MACROS */
       76     5459        /**/
       77     5460        %MACRO $ERROR (NAME=GORGO,CODE=0,SEV=SEV_ERROR#);
       78     5461        DCL 1 NAME CONSTANT ALIGNED,
       79     5462              2 * BIT(18) UNAL INIT('132125'O),
       80     5463              2 * UBIN(15) UNAL INIT(CODE),
       81     5464              2 * UBIN(3) UNAL INIT(SEV);
       82     5465        %MEND;
       83     5466
       84     5467
       85     5468
       86     5469        /**/
       87     5470        /* PARAMETERS */
       88     5471        /**/
       89     5472        %KQ_STA (FPTN=KQ$STA,STCLASS="");
       90     5811        %FPT$UNLATCH_V (FPTN=FPT_UNLATCH,BASED="");
       91     5815    1   DCL ERR BIT(36) ALIGNED;
       92     5816
       93     5817
       94     5818
       95     5819        /**/
       96     5820        /* BASED STRUCTURES */
       97     5821        /**/
       98     5822        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
       99     6561        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED(RBLK$)");
      100     6747        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)");
      101     7017        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
      102     7055        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS="BASED(QTN$)");
      103     7528        %NK$LDCT;
      104     7574        %B$JIT0;
      105     7663        %U$JIT1X;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:31   
      106     7666        %M$JIT2X;
      107     7669        %F$JIT3;
      108     7674        %A$JIT6X;
      109     7677    1   DCL B$$PTR PTR BASED ALIGNED;
      110     7678    1   DCL 1 B$$PTRR BASED ALIGNED,
      111     7679    1         2 DSP UBIN(18) UNAL,
      112     7680    1         2 *   UBIN(18) UNAL;
      113     7681
      114     7682
      115     7683
      116     7684        /**/
      117     7685        /* AUTO */
      118     7686        /**/
      119     7687    1   DCL QTN$ PTR;
      120     7688    1   DCL RELIT UBIN;
      121     7689    1   DCL RBLK$ PTR;
      122     7690    1   DCL MBLK$ PTR;
      123     7691    1   DCL I UBIN;
      124     7692    1   DCL CG$ PTR;
      125     7693    1   DCL P$ PTR;
      126     7694    1   DCL DBLK$ PTR;
      127     7695    1   DCL DBLK$R REDEF DBLK$ UBIN;
      128     7696    1   DCL DDA UBIN;
      129     7697    1   DCL CWMBLK$ PTR;
      130     7698    1   DCL DOACT UBIN;
      131     7699
      132     7700
      133     7701
      134     7702        /**/
      135     7703        /* CONSTANT */
      136     7704        /**/
      137     7705        %$ERROR (NAME=E_CGNTUL,CODE=%E$CGNTUL);
      138     7711        %$ERROR (NAME=E_BCGULO,CODE=%E$BCGULO);
      139     7717        %$ERROR (NAME=E_MULDCW,CODE=%E$MULDCW);
      140     7723        %$ERROR (NAME=E_CULUSR,CODE=%E$CULUSR);
      141     7729        %$ERROR (NAME=E_CULRAUEVR,CODE=%E$CULRAUEVR);
      142     7735
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:32   
      143     7736
      144     7737
      145     7738        /**/
      146     7739        /* REFS */
      147     7740        /**/
      148     7741    1   DCL KCA$TELLAUR   ENTRY(3) ALTRET;
      149     7742    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      150     7743    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
      151     7744    1   DCL KQD$RENEGE    ENTRY(3) ALTRET;
      152     7745    1   DCL KQM$GETBR     ENTRY(3) ALTRET;
      153     7746    1   DCL KQM$GETMBLK   ENTRY(3) ALTRET;
      154     7747    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      155     7748    1   DCL KQM$RELRBLK   ENTRY(2) ALTRET;
      156     7749    1   DCL KQP$INCMP     ENTRY(1) ALTRET;
      157     7750    1   DCL KQQ$ACT       ENTRY(2) ALTRET;
      158     7751    1   DCL KQW$HOLD      ENTRY(1) ALTRET;
      159     7752    1   DCL KQW$SEND      ENTRY(1) ALTRET;
      160     7753    1   DCL KQW$SENDNA    ENTRY(1) ALTRET;
      161     7754    1   DCL SSS$CURTIME   ENTRY(1);
      162     7755    1   DCL SC_CGLRKL      ENTRY    CONV(2,0);
      163     7756    1   DCL SC_CGCALZ      ENTRY    CONV(2,0);
      164     7757    1   DCL SC_CGBADRBLK   ENTRY    CONV(2,0);
      165     7758    1   DCL B$JIT$ PTR SYMREF;
      166     7759
      167     7760
      168     7761
      169     7762        /**/
      170     7763        /* SUBS */
      171     7764        /**/
      172     7765        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      173     7766        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
      174     7767        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      175     7768        %EQU_CG;
      176     7816        %EJECT;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:33   
      177     7817    2           DO CASE (FPT_UNLATCH.OUTPUT);

   7817  1 000002   200004 470500                    LDP0    @FPT_UNLATCH,,AUTO
         1 000003   000000 720100                    LXL0    0,,PR0
         1 000004   000777 360003                    ANX0    511,DU
         1 000005   000003 100003                    CMPX0   3,DU
         1 000006   000010 602010 1                  TNC     s:7817+6,X0
         1 000007   000013 710000 1                  TRA     s:7820
         1 000010   000013 710000 1                  TRA     s:7820
         1 000011   000014 710000 1                  TRA     s:7822
         1 000012   000014 710000 1                  TRA     s:7822

      178     7818    2             CASE (%SEND#,%DELETE#);

      179     7819    2             CASE (ELSE);

      180     7820    2               GOTO BADOPT;

   7820  1 000013   000120 710000 1                  TRA     BADOPT

      181     7821    2           END;

      182     7822    1         RELIT=1;

   7822  1 000014   000001 235007                    LDA     1,DL
         1 000015   200007 755100                    STA     RELIT,,AUTO

      183     7823    1         GOTO UNL;

   7823  1 000016   000031 710000 1                  TRA     UNL

      184     7824        /**/
      185     7825        /*F* NAME:         KQU$UNLATCHF
      186     7826             PURPOSE:      To unlatch a latched input message
      187     7827             DESCRIPTION:  Called from KQR$READ when a read finds a
      188     7828                           successfully-completed lastched input message.
      189     7829                           The input is to be deleted, and the outputs
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:34   
      190     7830                           sent.  The only error that can occur is if the
      191     7831                           station has a latched continued write in
      192     7832                           progress.
      193     7833                           Sometimes, we don't crank CNACT down in the Q-tree node
      194     7834                           where the input message (if any) came from.  Upon
      195     7835                           return, RLBK.CNACTD is set iff it was cranked down.
      196     7836                           Sets RBLK.QTN$ to the node's address iff the
      197     7837                           input msg came from a node (else sets it NIL).
      198     7838                           LATCHCNT will not be incremented; the caller is
      199     7839                           expected to do this.
      200     7840        */
      201     7841    1   KQU$UNLATCHF: ENTRY (KQ$STA,FPT_UNLATCH,ERR) ALTRET;

   7841  1 000017   000000 700200 xent  KQU$UNLATCHF TSX0  ! X66_AUTO_3
         1 000020   000034 000003                    ZERO    28,3

      202     7842        /**/
      203     7843    1         RELIT=0;

   7843  1 000021   200007 450100                    STZ     RELIT,,AUTO

      204     7844    1         RBLK$=KQ$STA.RBLK$;

   7844  1 000022   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 000023   000011 236100                    LDQ     9,,PR0
         1 000024   200010 756100                    STQ     RBLK$,,AUTO

      205     7845    1         CG$=KQ$STA.CG$;

   7845  1 000025   000007 236100                    LDQ     7,,PR0
         1 000026   200013 756100                    STQ     CG$,,AUTO

      206     7846    1         DOACT=0;

   7846  1 000027   200020 450100                    STZ     DOACT,,AUTO

      207     7847    1         GOTO DELIN;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:35   

   7847  1 000030   000305 710000 1                  TRA     DELIN

   7846  1 000031                       UNL          null
      208     7848    1   UNL:  ;
      209     7849    1         DOACT=1;

   7849  1 000031   200020 755100                    STA     DOACT,,AUTO

      210     7850              %LOCK (G=KQ$STA.GATE);

   7851  1 000032   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000033   000016 036003                    ADLQ    14,DU
         1 000034   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000035   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000036   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000037   000000 701000 xent               TSX1    HFC$LOCK
         1 000040   000000 011000                    NOP     0

      211     7853    1         RBLK$=KQ$STA.RBLK$;

   7853  1 000041   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 000042   000011 236100                    LDQ     9,,PR0
         1 000043   200010 756100                    STQ     RBLK$,,AUTO

      212     7854    1         IF RBLK$ = ADDR(NIL) THEN GOTO NTULU;

   7854  1 000044   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000045   000060 600000 1                  TZE     NTULU

      213     7855    1         IF RBLK$->KQ$RBLK.STATE ~= KQRS_COMP#

   7855  1 000046   200010 471500                    LDP1    RBLK$,,AUTO
         1 000047   100001 220100                    LDX0    1,,PR1
         1 000050   000001 100003                    CMPX0   1,DU
         1 000051   000060 601000 1                  TNZ     NTULU
         1 000052   100000 236100                    LDQ     0,,PR1
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:36   
         1 000053   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000054   000060 600000 1                  TZE     NTULU
         1 000055   100001 236100                    LDQ     1,,PR1
         1 000056   400000 316007                    CANQ    -131072,DL
         1 000057   000073 601000 1                  TNZ     s:7873

      214     7856    1         OR RBLK$->KQ$RBLK.MBLK$ = ADDR(NIL)
      215     7857    1         OR RBLK$->KQ$RBLK.LATCH = '0'B THEN
      216     7858    2           DO;

   7857  1 000060                       NTULU        null
      217     7859    2   NTULU:  ;
      218     7860                %UNLOCK (G=KQ$STA.GATE);

   7861  1 000060   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000061   000016 036003                    ADLQ    14,DU
         1 000062   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000063   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000064   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000065   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000066   000000 011000                    NOP     0

   7855  1 000067                       NTUL         null
      219     7863    2   NTUL:   ;
      220     7864    2           ERR=E_CGNTUL;

   7864  1 000067   000000 236000 0                  LDQ     E_CGNTUL
         1 000070   200005 470500                    LDP0    @ERR,,AUTO
         1 000071   000000 756100                    STQ     0,,PR0

      221     7865        /*E* ERROR:   KQU-E$CGNTUL-E
      222     7866             MESSAGE: Nothing to UNLATCH
      223     7867             MESSAGE1: You have no LATCHed message of the type you attempted
      224     7868                       to UNLATCH. */
      225     7869    2           ALTRETURN;

   7869  1 000072   000000 702200 xent               TSX2  ! X66_AALT
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:37   

      226     7870    2           END;
      227     7871
      228     7872              %UNLOCK (G=KQ$STA.GATE);

   7873  1 000073   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000074   000016 036003                    ADLQ    14,DU
         1 000075   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000076   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000077   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000100   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000101   000000 011000                    NOP     0

      229     7875    1         CG$=KQ$STA.CG$;

   7875  1 000102   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 000103   000007 236100                    LDQ     7,,PR0
         1 000104   200013 756100                    STQ     CG$,,AUTO

      230     7876        %EJECT;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:38   
      231     7877        /*************************************************
      232     7878         *                                               *
      233     7879         *                                               *
      234     7880         *            DECIDE WHETHER THIS IS             *
      235     7881         *            LAST OUTPUT MESSAGE, OR            *
      236     7882         *            INPUT MESSAGE & ALL OUTPUTS.       *
      237     7883         *                                               *
      238     7884         *                                               *
      239     7885         *************************************************/
      240     7886
      241     7887    2           DO CASE (FPT_UNLATCH.INPUT);

   7887  1 000105   200004 471500                    LDP1    @FPT_UNLATCH,,AUTO
         1 000106   100000 236100                    LDQ     0,,PR1
         1 000107   000011 772000                    QRL     9
         1 000110   000777 376007                    ANQ     511,DL
         1 000111   000004 116007                    CMPQ    4,DL
         1 000112   000114 602006 1                  TNC     s:7887+7,QL
         1 000113   000120 710000 1                  TRA     BADOPT
         1 000114   000124 710000 1                  TRA     s:7906
         1 000115   000215 710000 1                  TRA     s:7953
         1 000116   000254 710000 1                  TRA     s:7971
         1 000117   000215 710000 1                  TRA     s:7953

      242     7888
      243     7889    2             CASE (ELSE);

   7864  1 000120                       BADOPT       null
      244     7890    2   BADOPT:     ;
      245     7891    2               ERR=E_BCGULO;

   7891  1 000120   000001 236000 0                  LDQ     E_BCGULO
         1 000121   200005 470500                    LDP0    @ERR,,AUTO
         1 000122   000000 756100                    STQ     0,,PR0

      246     7892        /*E* ERROR:   KQU-E$BCGULO-E
      247     7893             MESSAGE: Illegal option on M$UNLATCH
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:39   
      248     7894             MESSAGE1: One of the INPUT or OUTPUT fields in your M$UNLATCH FPT
      249     7895                       contained an unknown disposition code, or you
      250     7896                       illegally specified INPUT = HOLD/RERUN and
      251     7897                       OUTPUT ~= DELETE. */
      252     7898    2   ALTRT:      ALTRETURN;

   7898  1 000123   000000 702200 xent  ALTRT        TSX2  ! X66_AALT

      253     7899
      254     7900        /*************************************************
      255     7901         *                                               *
      256     7902         *            UNLATCH LAST LATCHED OUTPUT        *
      257     7903         *                                               *
      258     7904         *************************************************/
      259     7905    2             CASE (0);

      260     7906    2               CALL GETCLW ALTRET(DOLW);

   7906  1 000124   001425 701000 1                  TSX1    GETCLW
         1 000125   000150 702000 1                  TSX2    DOLW

      261     7907    2               IF NOT MBLK$->KQ$MBLK.LATCH THEN

   7907  1 000126   200011 470500                    LDP0    MBLK$,,AUTO
         1 000127   000010 236100                    LDQ     8,,PR0
         1 000130   200000 316003                    CANQ    65536,DU
         1 000131   000141 600000 1                  TZE     MULDCW

      262     7908    2                GOTO MULDCW;
      263     7909    2               IF  NOT MBLK$->KQ$MBLK.FORCECONT

   7909  1 000132   000200 316007                    CANQ    128,DL
         1 000133   000145 601000 1                  TNZ     s:7922
         1 000134   200004 471500                    LDP1    @FPT_UNLATCH,,AUTO
         1 000135   100000 236100                    LDQ     0,,PR1
         1 000136   000777 376007                    ANQ     511,DL
         1 000137   000002 116007                    CMPQ    2,DL
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:40   
         1 000140   000145 600000 1                  TZE     s:7922

      264     7910    2               AND FPT_UNLATCH.OUTPUT ~= %DELETE# THEN
      265     7911    3                 DO;

      266     7912    3   MULDCW:       ;

   7912  1 000141                       MULDCW       null
      267     7913    3                 ERR=E_MULDCW;

   7913  1 000141   000002 236000 0                  LDQ     E_MULDCW
         1 000142   200005 470500                    LDP0    @ERR,,AUTO
         1 000143   000000 756100                    STQ     0,,PR0

      268     7914        /*E* ERROR:   KQU-E$MULDCW-E
      269     7915             MESSAGE: You can only UNLATCH DELETE a continued, LATCHed write
      270     7916             MESSAGE1: Your DCB has a LATCHed continued output message
      271     7917                       waiting for the next segment to be written.  Since this
      272     7918                       is your most recent LATCHed output, it clearly cannot
      273     7919                       be sent yet; M$UNLATCH can only delete it. */
      274     7920    3                 ALTRETURN;

   7920  1 000144   000000 702200 xent               TSX2  ! X66_AALT

      275     7921    3                 END;
      276     7922    2               CALL DUMPWR;

   7922  1 000145   001046 701000 1                  TSX1    DUMPWR
         1 000146   000000 011000                    NOP     0

      277     7923    2               RETURN;

   7923  1 000147   000000 702200 xent               TSX2  ! X66_ARET

   7909  1 000150                       DOLW         null
      278     7924    2   DOLW:       ;
      279     7925    2               IF RBLK$->KQ$RBLK.LWRITES$ = ADDR(NIL) THEN GOTO NTUL;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:41   

   7925  1 000150   200010 470500                    LDP0    RBLK$,,AUTO
         1 000151   000020 236100                    LDQ     16,,PR0
         1 000152   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000153   000067 600000 1                  TZE     NTUL

      280     7926    2               MBLK$=RBLK$->KQ$RBLK.LWTL$;

   7926  1 000154   000013 236100                    LDQ     11,,PR0
         1 000155   200011 756100                    STQ     MBLK$,,AUTO

      281     7927    2               IF ADDR(MBLK$->KQ$MBLK.DCB$)->B$$PTRR.DSP ~= ADDR(B$JIT.DCB$)->B$$PTRR.
              7927                        DSP THEN

   7927  1 000156   200011 471500                    LDP1    MBLK$,,AUTO
         1 000157   100013 220100                    LDX0    11,,PR1
         1 000160   000000 473400 xsym               LDP3    B$JIT$
         1 000161   300232 100100                    CMPX0   154,,PR3
         1 000162   000067 601000 1                  TNZ     NTUL

      282     7928    2                GOTO NTUL;
      283     7929    2               IF MBLK$ = RBLK$->KQ$RBLK.LWRITES$ THEN

   7929  1 000163   000020 116100                    CMPQ    16,,PR0
         1 000164   000173 601000 1                  TNZ     s:7935

      284     7930    3                 DO INHIBIT;

      285     7931    3                 P$=ADDR(RBLK$->KQ$RBLK.LWRITES$);

   7931  1 000165   200010 236300                    LDQ   ! RBLK$,,AUTO
         1 000166   000020 036203                    ADLQ  ! 16,DU
         1 000167   200014 756300                    STQ   ! P$,,AUTO

      286     7932    3                 CALL DUMPWR;

   7932  1 000170   001046 701200 1                  TSX1  ! DUMPWR
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:42   
         1 000171   000000 011200                    NOP   ! 0

      287     7933    3                 RETURN;

   7933  1 000172   000000 702200 xent               TSX2  ! X66_ARET

      288     7934    3                 END;

      289     7935    2               P$=RBLK$->KQ$RBLK.LWRITES$;

   7935  1 000173   200010 470500                    LDP0    RBLK$,,AUTO
         1 000174   000020 236100                    LDQ     16,,PR0
         1 000175   200014 756100                    STQ     P$,,AUTO

      290     7936    3                 DO FOREVER;

      291     7937    3                 IF P$->KQ$MBLK.LNK$ = MBLK$ THEN

   7937  1 000176   200014 470500                    LDP0    P$,,AUTO
         1 000177   000000 236100                    LDQ     0,,PR0
         1 000200   200011 116100                    CMPQ    MBLK$,,AUTO
         1 000201   000211 601000 1                  TNZ     s:7944

      292     7938    4                   DO INHIBIT;

      293     7939    4                   RBLK$->KQ$RBLK.LWTL$=P$;

   7939  1 000202   200014 236300                    LDQ   ! P$,,AUTO
         1 000203   200010 471700                    LDP1  ! RBLK$,,AUTO
         1 000204   100013 756300                    STQ   ! 11,,PR1

      294     7940    4                   P$=ADDR(P$->KQ$MBLK.LNK$);

   7940  1 000205   200014 756300                    STQ   ! P$,,AUTO

      295     7941    4                   CALL DUMPWR;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:43   
   7941  1 000206   001046 701200 1                  TSX1  ! DUMPWR
         1 000207   000000 011200                    NOP   ! 0

      296     7942    4                   RETURN;

   7942  1 000210   000000 702200 xent               TSX2  ! X66_ARET

      297     7943    4                   END;

      298     7944    3                 P$=P$->KQ$MBLK.LNK$;

   7944  1 000211   200014 470500                    LDP0    P$,,AUTO
         1 000212   000000 236100                    LDQ     0,,PR0
         1 000213   200014 756100                    STQ     P$,,AUTO

      299     7945    3                 END;

   7945  1 000214   000176 710000 1                  TRA     s:7937

      300     7946
      301     7947        /*************************************************
      302     7948         *                                               *
      303     7949         *            UNLATCH INPUT & ALL OUTPUTS        *
      304     7950         *                                               *
      305     7951         *************************************************/
      306     7952    2             CASE (%HOLD#,%RERUN#);

      307     7953    2               IF FPT_UNLATCH.OUTPUT ~= %DELETE# THEN GOTO BADOPT;

   7953  1 000215   100000 236100                    LDQ     0,,PR1
         1 000216   000777 376007                    ANQ     511,DL
         1 000217   000002 116007                    CMPQ    2,DL
         1 000220   000120 601000 1                  TNZ     BADOPT

      308     7954    2               MBLK$=RBLK$->KQ$RBLK.MBLK$;

   7954  1 000221   200010 473500                    LDP3    RBLK$,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:44   
         1 000222   300000 236100                    LDQ     0,,PR3
         1 000223   200011 756100                    STQ     MBLK$,,AUTO

      309     7955    2               IF FPT_UNLATCH.INPUT = %RERUN# THEN

   7955  1 000224   100000 236100                    LDQ     0,,PR1
         1 000225   777000 376007                    ANQ     -512,DL
         1 000226   003000 116007                    CMPQ    1536,DL
         1 000227   000253 601000 1                  TNZ     s:7968

      310     7956    2                IF (CG$->KQ$CG.QISS AND MBLK$->KQ$MBLK.KEY2='*AUEV') OR

   7956  1 000230   200013 474500                    LDP4    CG$,,AUTO
         1 000231   400106 235100                    LDA     70,,PR4
         1 000232   000240 600000 1                  TZE     s:7956+8
         1 000233   200011 475500                    LDP5    MBLK$,,AUTO
         1 000234   040000 106500                    CMPC    fill='040'O
         1 000235   500004 000010                    ADSC9   4,,PR5                   cn=0,n=8
         1 000236   000005 000005 0                  ADSC9   E_CULRAUEVR+1            cn=0,n=5
         1 000237   000247 600000 1                  TZE     s:7959
         1 000240   000000 115003                    CMPA    0,DU
         1 000241   000253 601000 1                  TNZ     s:7968
         1 000242   200011 475500                    LDP5    MBLK$,,AUTO
         1 000243   040000 106500                    CMPC    fill='040'O
         1 000244   500002 000010                    ADSC9   2,,PR5                   cn=0,n=8
         1 000245   000005 000005 0                  ADSC9   E_CULRAUEVR+1            cn=0,n=5
         1 000246   000253 601000 1                  TNZ     s:7968

      311     7957    2                (NOT CG$->KQ$CG.QISS AND MBLK$->KQ$MBLK.KEY1='*AUEV') THEN
      312     7958    3                  DO;

      313     7959    3                  ERR=E_CULRAUEVR;

   7959  1 000247   000004 236000 0                  LDQ     E_CULRAUEVR
         1 000250   200005 476500                    LDP6    @ERR,,AUTO
         1 000251   600000 756100                    STQ     0,,PR6

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:45   
      314     7960        /*E* ERROR:   KQU-E$CULRAUEVR-E
      315     7961             MESSAGE: Can't UNLATCH RERUN an input with msgtyp *AUEV
      316     7962             MESSAGE1: You cannot UNLATCH RERUN an input message read with
      317     7963                       latch if its message type is *AUEV.  Since this message
      318     7964                       is sent to you, it clearly should not be rerun; M$UNLATCH
      319     7965                       can only delete it or place it in hold status.  */
      320     7966    3                  ALTRETURN;

   7966  1 000252   000000 702200 xent               TSX2  ! X66_AALT

      321     7967    3                  END;
      322     7968    2               GOTO DELIN;

   7968  1 000253   000305 710000 1                  TRA     DELIN

      323     7969
      324     7970    2             CASE (%DELETE#);

      325     7971    2               MBLK$=RBLK$->KQ$RBLK.MBLK$;

   7971  1 000254   200010 473500                    LDP3    RBLK$,,AUTO
         1 000255   300000 236100                    LDQ     0,,PR3
         1 000256   200011 756100                    STQ     MBLK$,,AUTO

      326     7972                    /* WE DON'T CARE IF A *AUEV MESSAGE IS SUCCESSFULLY READ */
      327     7973    2               IF RBLK$->KQ$RBLK.CS = '0'B AND NOT

   7973  1 000257   300001 236100                    LDQ     1,,PR3
         1 000260   040000 316007                    CANQ    16384,DL
         1 000261   000305 601000 1                  TNZ     DELIN
         1 000262   200013 474500                    LDP4    CG$,,AUTO
         1 000263   400106 235100                    LDA     70,,PR4
         1 000264   000272 600000 1                  TZE     s:7973+11
         1 000265   200011 475500                    LDP5    MBLK$,,AUTO
         1 000266   040000 106500                    CMPC    fill='040'O
         1 000267   500004 000010                    ADSC9   4,,PR5                   cn=0,n=8
         1 000270   000005 000005 0                  ADSC9   E_CULRAUEVR+1            cn=0,n=5
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:46   
         1 000271   000305 600000 1                  TZE     DELIN
         1 000272   000000 115003                    CMPA    0,DU
         1 000273   000301 601000 1                  TNZ     s:7977
         1 000274   200011 475500                    LDP5    MBLK$,,AUTO
         1 000275   040000 106500                    CMPC    fill='040'O
         1 000276   500002 000010                    ADSC9   2,,PR5                   cn=0,n=8
         1 000277   000005 000005 0                  ADSC9   E_CULRAUEVR+1            cn=0,n=5
         1 000300   000305 600000 1                  TZE     DELIN

      328     7974    2               ((CG$->KQ$CG.QISS AND MBLK$->KQ$MBLK.KEY2='*AUEV') OR
      329     7975    2               (NOT CG$->KQ$CG.QISS AND MBLK$->KQ$MBLK.KEY1='*AUEV')) THEN
      330     7976    3                 DO;

      331     7977    3                 ERR=E_CULUSR;

   7977  1 000301   000003 236000 0                  LDQ     E_CULUSR
         1 000302   200005 475500                    LDP5    @ERR,,AUTO
         1 000303   500000 756100                    STQ     0,,PR5

      332     7978        /*E* ERROR:   KQU-E$CULUSR
      333     7979             MESSAGE: Can't UNLATCH DELETE an input until successfully read
      334     7980             MESSAGE1: You cannot UNLATCH DELETE an input message read with
      335     7981                       latch until it has been successfully read. */
      336     7982    3                 ALTRETURN;

   7982  1 000304   000000 702200 xent               TSX2  ! X66_AALT

   7982  1 000305                       DELIN        null
      337     7983    3                 END;
      338     7984    2   DELIN:      ;
      339     7985    2               MBLK$=KQ$STA.MBLK$;

   7985  1 000305   000012 236100                    LDQ     10,,PR0
         1 000306   200011 756100                    STQ     MBLK$,,AUTO

      340     7986    2               IF FPT_UNLATCH.OUTPUT ~= %DELETE# THEN

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:47   
   7986  1 000307   200004 471500                    LDP1    @FPT_UNLATCH,,AUTO
         1 000310   100000 236100                    LDQ     0,,PR1
         1 000311   000777 376007                    ANQ     511,DL
         1 000312   000002 116007                    CMPQ    2,DL
         1 000313   000330 600000 1                  TZE     DOLW1

      341     7987    3                 DO WHILE (MBLK$ ~= ADDR(NIL));

   7987  1 000314   000325 710000 1                  TRA     s:7991

      342     7988    3                 IF MBLK$->KQ$MBLK.LATCH THEN

   7988  1 000315   200011 470500                    LDP0    MBLK$,,AUTO
         1 000316   000010 236100                    LDQ     8,,PR0
         1 000317   200000 316003                    CANQ    65536,DU
         1 000320   000323 600000 1                  TZE     s:7990

      343     7989    3                  IF NOT MBLK$->KQ$MBLK.FORCECONT THEN GOTO MULDCW;

   7989  1 000321   000200 316007                    CANQ    128,DL
         1 000322   000141 600000 1                  TZE     MULDCW

      344     7990    3                 MBLK$=MBLK$->KQ$MBLK.LNK$;

   7990  1 000323   000000 236100                    LDQ     0,,PR0
         1 000324   200011 756100                    STQ     MBLK$,,AUTO

      345     7991    3                 END;

   7991  1 000325   200011 236100                    LDQ     MBLK$,,AUTO
         1 000326   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000327   000315 601000 1                  TNZ     s:7988

   7986  1 000330                       DOLW1        null
      346     7992    2   DOLW1:      ;
      347     7993    2               IF RBLK$->KQ$RBLK.FROMQ = '0'B THEN RBLK$->KQ$RBLK.QTN$=ADDR(NIL);

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:48   
   7993  1 000330   200010 470500                    LDP0    RBLK$,,AUTO
         1 000331   000001 236100                    LDQ     1,,PR0
         1 000332   100000 316007                    CANQ    32768,DL
         1 000333   000337 601000 1                  TNZ     s:7996

   7993  1 000334   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000335   000021 756100                    STQ     17,,PR0
         1 000336   000437 710000 1                  TRA     UNL1

      348     7994    2               ELSE
      349     7995    3                 DO;

      350     7996    3                 MBLK$=RBLK$->KQ$RBLK.MBLK$;

   7996  1 000337   000000 236100                    LDQ     0,,PR0
         1 000340   200011 756100                    STQ     MBLK$,,AUTO

      351     7997                      %LOCK (G=KQ$QTREE.GATE);

   7998  1 000341   200013 471500                    LDP1    CG$,,AUTO
         1 000342   100057 473500                    LDP3    47,,PR1
         1 000343   200030 453500                    STP3    OSTA$+3,,AUTO
         1 000344   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000345   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000346   000000 701000 xent               TSX1    HFC$LOCK
         1 000347   000000 011000                    NOP     0

      352     8000    3                 QTN$=RBLK$->KQ$RBLK.QTN$;

   8000  1 000350   200010 470500                    LDP0    RBLK$,,AUTO
         1 000351   000021 236100                    LDQ     17,,PR0
         1 000352   200006 756100                    STQ     QTN$,,AUTO

      353     8001    3                 IF QTN$->KQ$QTN.STA.BTN.KEY ~= MBLK$->KQ$MBLK.KEY1 THEN

   8001  1 000353   200006 471500                    LDP1    QTN$,,AUTO
         1 000354   200011 473500                    LDP3    MBLK$,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:49   
         1 000355   040100 106500                    CMPC    fill='040'O
         1 000356   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 000357   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8
         1 000360   000363 600000 1                  TZE     s:8016

      354     8002    3                  CALL SC_CGLRKL;

   8002  1 000361   000000 713400 xsym               CLIMB   SC_CGLRKL
         1 000362   000000 600000 xsid               climb   nvectors=         0

      355     8003        /*S* SCREECH_CODE: KQU-S$CGLRKL
      356     8004             TYPE:         SCREECH
      357     8005             MESSAGE:      COMGROUP LATCHed read key lost
      358     8006             REMARKS:      This SCREECH occurs when an input message that came
      359     8007                           from the queue is unlatched, but the Q-tree node
      360     8008                           it came from is not there.  If the
      361     8009                           Q-tree is the msg type tree, then most likely the
      362     8010                           message MBLK (which contains the key) has been
      363     8011                           clobbered, for T-tree nodes rarely get deleted.  If
      364     8012                           the Q-tree is the station tree, then someone has
      365     8013                           deleted a station when current number active was
      366     8014                           nonzero (either that or current number active was
      367     8015                           incorrectly zero). */
      368     8016    3                 IF  QTN$->KQ$QTN.MXACT < 100

   8016  1 000363   200006 470500                    LDP0    QTN$,,AUTO
         1 000364   000045 235100                    LDA     37,,PR0
         1 000365   000144 115007                    CMPA    100,DL
         1 000366   000375 605000 1                  TPL     s:8020
         1 000367   200020 236100                    LDQ     DOACT,,AUTO
         1 000370   000375 601000 1                  TNZ     s:8020

      369     8017    3                 AND DOACT = 0 THEN
      370     8018                                /* KQU$UNLATCHF - don't update CNACT */
      371     8019    3                  QTN$->KQ$QTN.CRASHACT=QTN$->KQ$QTN.CRASHACT+1; /* For RECOVERY */

   8019  1 000371   000050 720100                    LXL0    40,,PR0
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:50   
         1 000372   000001 621010                    EAX1    1,X0
         1 000373   000050 441100                    SXL1    40,,PR0
         1 000374   000430 710000 1                  TRA     s:8044

      372     8020    3                 ELSE IF NOT RBLK$->KQ$RBLK.CNACTD THEN

   8020  1 000375   200010 471500                    LDP1    RBLK$,,AUTO
         1 000376   100001 236100                    LDQ     1,,PR1
         1 000377   010000 316007                    CANQ    4096,DL
         1 000400   000430 601000 1                  TNZ     s:8044

      373     8021    4                    DO;

      374     8022                                /* Update CNACT in Q-tree node where this
      375     8023                                   message came from */
      376     8024    4                    QTN$->KQ$QTN.CNACT=QTN$->KQ$QTN.CNACT-1;

   8024  1 000401   000001 336007                    LCQ     1,DL
         1 000402   000044 056100                    ASQ     36,,PR0

      377     8025                                /* If we crash while handling the outputs,
      378     8026                                   don't want to decrement CNACT again when
      379     8027                                   the comgroup is re-opened */
      380     8028    4                    RBLK$->KQ$RBLK.CNACTD='1'B;

   8028  1 000403   010000 236007                    LDQ     4096,DL
         1 000404   100001 256100                    ORSQ    1,,PR1

      381     8029    4                    IF QTN$->KQ$QTN.CNACT < 0 THEN CALL SC_CGCALZ;

   8029  1 000405   200006 470500                    LDP0    QTN$,,AUTO
         1 000406   000044 235100                    LDA     36,,PR0
         1 000407   000412 605000 1                  TPL     s:8037

   8029  1 000410   000000 713400 xsym               CLIMB   SC_CGCALZ
         1 000411   000000 600000 xsid               climb   nvectors=         0

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:51   
      382     8030        /*S* SCREECH_CODE: KQU-S$CGCALZ
      383     8031             TYPE:         SCREECH
      384     8032             MESSAGE:      COMGROUP QUEUE active count negative
      385     8033             REMARKS:      This SCREECH occurs when an input message that
      386     8034                           came from the queue is unlatched, and the current
      387     8035                           number active count for the Q-tree node it came
      388     8036                           from was zero. */
      389     8037    4                    IF QTN$->KQ$QTN.CNACT = QTN$->KQ$QTN.MXACT -1 THEN

   8037  1 000412   200006 470500                    LDP0    QTN$,,AUTO
         1 000413   000045 236100                    LDQ     37,,PR0
         1 000414   000001 136007                    SBLQ    1,DL
         1 000415   000044 116100                    CMPQ    36,,PR0
         1 000416   000430 601000 1                  TNZ     s:8044

      390     8038    5                      DO;

      391     8039    5                      CALL KQQ$ACT (CG$->KQ$CG,QTN$);

   8039  1 000417   200006 631500                    EPPR1   QTN$,,AUTO
         1 000420   200031 451500                    STP1    OSTA$+4,,AUTO
         1 000421   200013 236100                    LDQ     CG$,,AUTO
         1 000422   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000423   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000424   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000425   000000 701000 xent               TSX1    KQQ$ACT
         1 000426   000000 011000                    NOP     0

      392     8040    5                      GOTO UNL1;

   8040  1 000427   000437 710000 1                  TRA     UNL1

      393     8041    5                      END;
      394     8042    4                    END;
      395     8043                      %UNLOCK (G=KQ$QTREE.GATE);

   8044  1 000430   200013 471500                    LDP1    CG$,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:52   
         1 000431   100057 473500                    LDP3    47,,PR1
         1 000432   200030 453500                    STP3    OSTA$+3,,AUTO
         1 000433   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000434   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000435   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000436   000000 011000                    NOP     0

      396     8046    3                 END;

   8037  1 000437                       UNL1         null
      397     8047    2   UNL1:       ;
      398     8048    2               IF FPT_UNLATCH.INPUT = %DELETE# THEN

   8048  1 000437   200004 470500                    LDP0    @FPT_UNLATCH,,AUTO
         1 000440   000000 236100                    LDQ     0,,PR0
         1 000441   777000 376007                    ANQ     -512,DL
         1 000442   002000 116007                    CMPQ    1024,DL
         1 000443   000447 601000 1                  TNZ     s:8054

      399     8049                                /* Set state so that if we crash while handling
      400     8050                                   the outputs, we'll remember the successful
      401     8051                                   unlatch was issued */
      402     8052    2                RBLK$->KQ$RBLK.STATE=KQRS_UNLA#;

   8052  1 000444   000007 220003                    LDX0    7,DU
         1 000445   200010 471500                    LDP1    RBLK$,,AUTO
         1 000446   100001 740100                    STX0    1,,PR1

      403     8053                                /* Now dump the outputs */
      404     8054    2               P$=ADDR(KQ$STA.MBLK$);

   8054  1 000447   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000450   000012 036003                    ADLQ    10,DU
         1 000451   200014 756100                    STQ     P$,,AUTO

      405     8055    2               MBLK$=KQ$STA.MBLK$;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:53   
   8055  1 000452   200003 471500                    LDP1    @KQ$STA,,AUTO
         1 000453   100012 236100                    LDQ     10,,PR1
         1 000454   200011 756100                    STQ     MBLK$,,AUTO

      406     8056    3                 DO WHILE (MBLK$ ~= ADDR(NIL));

   8056  1 000455   000472 710000 1                  TRA     s:8060

      407     8057    3                 IF MBLK$->KQ$MBLK.LATCH THEN CALL DUMPWR;

   8057  1 000456   200011 470500                    LDP0    MBLK$,,AUTO
         1 000457   000010 236100                    LDQ     8,,PR0
         1 000460   200000 316003                    CANQ    65536,DU
         1 000461   000465 600000 1                  TZE     s:8058

   8057  1 000462   001046 701000 1                  TSX1    DUMPWR
         1 000463   000000 011000                    NOP     0
         1 000464   000467 710000 1                  TRA     s:8059

      408     8058    3                 ELSE P$=ADDR(MBLK$->KQ$MBLK.LNK$);

   8058  1 000465   200011 236100                    LDQ     MBLK$,,AUTO
         1 000466   200014 756100                    STQ     P$,,AUTO

      409     8059    3                 MBLK$=P$->B$$PTR;

   8059  1 000467   200014 470500                    LDP0    P$,,AUTO
         1 000470   000000 236100                    LDQ     0,,PR0
         1 000471   200011 756100                    STQ     MBLK$,,AUTO

      410     8060    3                 END;

   8060  1 000472   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000473   000456 601000 1                  TNZ     s:8057

      411     8061    2               P$=ADDR(RBLK$->KQ$RBLK.LWRITES$);

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:54   
   8061  1 000474   200010 236100                    LDQ     RBLK$,,AUTO
         1 000475   000020 036003                    ADLQ    16,DU
         1 000476   200014 756100                    STQ     P$,,AUTO

      412     8062    2               MBLK$=RBLK$->KQ$RBLK.LWRITES$;

   8062  1 000477   200010 470500                    LDP0    RBLK$,,AUTO
         1 000500   000020 236100                    LDQ     16,,PR0
         1 000501   200011 756100                    STQ     MBLK$,,AUTO

      413     8063    3                 DO WHILE (MBLK$ ~= ADDR(NIL));

   8063  1 000502   000510 710000 1                  TRA     s:8066

      414     8064    3                 CALL DUMPWR;

   8064  1 000503   001046 701000 1                  TSX1    DUMPWR
         1 000504   000000 011000                    NOP     0

      415     8065    3                 MBLK$=RBLK$->KQ$RBLK.LWRITES$;

   8065  1 000505   200010 470500                    LDP0    RBLK$,,AUTO
         1 000506   000020 236100                    LDQ     16,,PR0
         1 000507   200011 756100                    STQ     MBLK$,,AUTO

      416     8066    3                 END;

   8066  1 000510   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000511   000503 601000 1                  TNZ     s:8064

      417     8067    2               CALL DUMPRD;

   8067  1 000512   000615 701000 1                  TSX1    DUMPRD
         1 000513   000000 011000                    NOP     0

      418     8068    2               RBLK$->KQ$RBLK.STATE=KQRS_COMP#;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:55   
   8068  1 000514   000001 220003                    LDX0    1,DU
         1 000515   200010 470500                    LDP0    RBLK$,,AUTO
         1 000516   000001 740100                    STX0    1,,PR0

      419     8069    2               IF RELIT = 1 THEN

   8069  1 000517   200007 235100                    LDA     RELIT,,AUTO
         1 000520   000001 115007                    CMPA    1,DL
         1 000521   000570 601000 1                  TNZ     s:8104

      420     8070    3                 DO;

      421     8071                      %LOCK (G=KQ$STA.GATE);

   8072  1 000522   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000523   000016 036003                    ADLQ    14,DU
         1 000524   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000525   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000526   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000527   000000 701000 xent               TSX1    HFC$LOCK
         1 000530   000000 011000                    NOP     0

      422     8074    3                 IF RBLK$ ~= KQ$STA.RBLK$ THEN

   8074  1 000531   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 000532   200010 236100                    LDQ     RBLK$,,AUTO
         1 000533   000011 116100                    CMPQ    9,,PR0
         1 000534   000547 600000 1                  TZE     s:8095

      423     8075    4                   DO;

      424     8076    4                   CALL SC_CGBADRBLK;

   8076  1 000535   000000 713400 xsym               CLIMB   SC_CGBADRBLK
         1 000536   000000 600000 xsid               climb   nvectors=         0

      425     8077        /*S* SCREECH_CODE: KQU-S$CGBADRBLK
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:56   
      426     8078             TYPE:         SNAP
      427     8079             MESSAGE:      RBLK pointer modified during UNLATCH
      428     8080             REMARKS:      This SNAP occurs when we have discovered that someone, on
      429     8081                           another CPU, has modified KQ$STA.RBLK$ while we're using it.
      430     8082                           The above code makes a lot of assumptions (by never locking
      431     8083                           the station gate) that no one else is looking at this station's
      432     8084                           RBLK.  (The following lock exists because KQT$VALREAD does
      433     8085                           look at the station's RBLK$ so we can't delete it out from
      434     8086                           underneath him!)  If this snap ever occurs, we need to see
      435     8087                           who else is messing with the RBLK.  By going around the
      436     8088                           normal code here, we may avoid breaking some chains.  */
      437     8089                        %UNLOCK (G=KQ$STA.GATE);

   8090  1 000537   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000540   000016 036003                    ADLQ    14,DU
         1 000541   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000542   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000543   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000544   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000545   000000 011000                    NOP     0

      438     8092    4                   END;

   8092  1 000546   000570 710000 1                  TRA     s:8104

      439     8093    3                 ELSE
      440     8094    4                   DO;

      441     8095    4                   KQ$STA.RBLK$ = ADDR(NIL);

   8095  1 000547   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000550   000011 756100                    STQ     9,,PR0

      442     8096                        %UNLOCK (G=KQ$STA.GATE);

   8097  1 000551   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000552   000016 036003                    ADLQ    14,DU
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:57   
         1 000553   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000554   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000555   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000556   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000557   000000 011000                    NOP     0

      443     8099    5                     DO INHIBIT;

      444     8100    5                     CALL KQM$RELRBLK (CG$->KQ$CG,RBLK$);

   8100  1 000560   200010 630700                    EPPR0 ! RBLK$,,AUTO
         1 000561   200031 450700                    STP0  ! OSTA$+4,,AUTO
         1 000562   200013 236300                    LDQ   ! CG$,,AUTO
         1 000563   200030 756300                    STQ   ! OSTA$+3,,AUTO
         1 000564   200030 630700                    EPPR0 ! OSTA$+3,,AUTO
         1 000565   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 000566   000000 701200 xent               TSX1  ! KQM$RELRBLK
         1 000567   000000 011200                    NOP   ! 0

      445     8101    5                     END;

      446     8102    4                   END;

      447     8103    3                 END;

      448     8104    2               IF DOACT ~= 0 THEN

   8104  1 000570   200020 235100                    LDA     DOACT,,AUTO
         1 000571   000614 600000 1                  TZE     s:8116

      449     8105    3                 DO;

      450     8106                      %LOCK (G=KQ$STA.GATE);

   8107  1 000572   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000573   000016 036003                    ADLQ    14,DU
         1 000574   200030 756100                    STQ     OSTA$+3,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:58   
         1 000575   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000576   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000577   000000 701000 xent               TSX1    HFC$LOCK
         1 000600   000000 011000                    NOP     0

      451     8109    3                 KQ$STA.LATCHCNT=KQ$STA.LATCHCNT+1;

   8109  1 000601   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 000602   000015 236100                    LDQ     13,,PR0
         1 000603   001000 036003                    ADLQ    512,DU
         1 000604   000015 552140                    STBQ    13,'40'O,PR0

      452     8110                      %UNLOCK (G=KQ$STA.GATE);

   8111  1 000605   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000606   000016 036003                    ADLQ    14,DU
         1 000607   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000610   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000611   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000612   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000613   000000 011000                    NOP     0

      453     8113    3                 END;

      454     8114
      455     8115    2           END; /* CASE FPT_UNLATCH.INPUT */

      456     8116    1         RETURN;

   8116  1 000614   000000 702200 xent               TSX2  ! X66_ARET

      457     8117        %EJECT;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:59   
      458     8118        /****************************************************************
      459     8119        *****************************************************************/
      460     8120        /*D* NAME:         DUMPRD
      461     8121             PURPOSE:      To dispose of a latched input message
      462     8122             DESCRIPTION:  The station's currently-latched input is
      463     8123                           disposed of according to FPT_UNLATCH.INPUT.
      464     8124        */
      465     8125    1   DUMPRD: PROC ALTRET;

   8125  1 000615   200022 741300       DUMPRD       STX1  ! DOACT+2,,AUTO

      466     8126    2         MBLK$=RBLK$->KQ$RBLK.MBLK$;

   8126  1 000616   200010 470500                    LDP0    RBLK$,,AUTO
         1 000617   000000 236100                    LDQ     0,,PR0
         1 000620   200011 756100                    STQ     MBLK$,,AUTO

      467     8127    3           DO CASE (FPT_UNLATCH.INPUT);

   8127  1 000621   200004 471500                    LDP1    @FPT_UNLATCH,,AUTO
         1 000622   100000 236100                    LDQ     0,,PR1
         1 000623   000011 772000                    QRL     9
         1 000624   000777 376007                    ANQ     511,DL
         1 000625   000004 116007                    CMPQ    4,DL
         1 000626   000630 602006 1                  TNC     s:8127+7,QL
         1 000627   001044 710000 1                  TRA     s:8182
         1 000630   001044 710000 1                  TRA     s:8182
         1 000631   000721 710000 1                  TRA     s:8151
         1 000632   001007 710000 1                  TRA     s:8170
         1 000633   000634 710000 1                  TRA     s:8130

      468     8128
      469     8129    3             CASE (%RERUN#);

      470     8130    3               IF FPT_UNLATCH.TELLAU & '1'B THEN

   8130  1 000634   100001 236100                    LDQ     1,,PR1
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:60   
         1 000635   600000 376003                    ANQ     -65536,DU
         1 000636   400000 376003                    ANQ     -131072,DU
         1 000637   000644 600000 1                  TZE     s:8132

      471     8131    3                CALL TELLAU (%CG_UNLR#);

   8131  1 000640   000000 236000 2                  LDQ     0
         1 000641   200025 756100                    STQ     DOACT+5,,AUTO
         1 000642   001242 701000 1                  TSX1    TELLAU
         1 000643   000000 011000                    NOP     0

      472     8132    3               IF FPT_UNLATCH.TELLOS & '1'B THEN CALL TELLOS;

   8132  1 000644   200004 470500                    LDP0    @FPT_UNLATCH,,AUTO
         1 000645   000001 236100                    LDQ     1,,PR0
         1 000646   000002 736000                    QLS     2
         1 000647   600000 376003                    ANQ     -65536,DU
         1 000650   400000 376003                    ANQ     -131072,DU
         1 000651   000654 600000 1                  TZE     s:8133

   8132  1 000652   001121 701000 1                  TSX1    TELLOS
         1 000653   000000 011000                    NOP     0

      473     8133    3               IF MBLK$->KQ$MBLK.DDA ~= 0 THEN

   8133  1 000654   200011 470500                    LDP0    MBLK$,,AUTO
         1 000655   000006 235100                    LDA     6,,PR0
         1 000656   000675 600000 1                  TZE     s:8139

      474     8134    4                 DO;

      475     8135    4                 DBLK$R=MBLK$->KQ$MBLK.STAMP;

   8135  1 000657   000001 236100                    LDQ     1,,PR0
         1 000660   777777 376007                    ANQ     -1,DL
         1 000661   200015 756100                    STQ     DBLK$,,AUTO

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:61   
      476     8136    4                 CALL KQD$RENEGE (CG$->KQ$CG,DBLK$,MBLK$->KQ$MBLK.DDA);

   8136  1 000662   200011 236100                    LDQ     MBLK$,,AUTO
         1 000663   000006 036003                    ADLQ    6,DU
         1 000664   200032 756100                    STQ     OSTA$+5,,AUTO
         1 000665   200015 631500                    EPPR1   DBLK$,,AUTO
         1 000666   200031 451500                    STP1    OSTA$+4,,AUTO
         1 000667   200013 236100                    LDQ     CG$,,AUTO
         1 000670   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000671   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000672   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000673   000000 701000 xent               TSX1    KQD$RENEGE
         1 000674   000000 011000                    NOP     0

      477     8137    4                 END;

      478     8138        /**/
      479     8139    3               IF  FPT_UNLATCH.JOURNALED

   8139  1 000675   200004 470500                    LDP0    @FPT_UNLATCH,,AUTO
         1 000676   000001 236100                    LDQ     1,,PR0
         1 000677   020000 316003                    CANQ    8192,DU
         1 000700   000707 600000 1                  TZE     s:8144
         1 000701   200013 471500                    LDP1    CG$,,AUTO
         1 000702   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 000703   100210 116100                    CMPQ    136,,PR1
         1 000704   000707 601000 1                  TNZ     s:8144

      480     8140    3               AND ADDR(KQ$STA) = CG$->KQ$CG.JRNLSTA$ THEN
      481     8141    3                CALL INCMP;

   8141  1 000705   001256 701000 1                  TSX1    INCMP
         1 000706   000000 011000                    NOP     0

      482     8142        /**/
      483     8143    4                 DO INHIBIT;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:62   
      484     8144    4                 RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);

   8144  1 000707   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 000710   200010 470700                    LDP0  ! RBLK$,,AUTO
         1 000711   000000 756300                    STQ   ! 0,,PR0

      485     8145    4                 MBLK$->KQ$MBLK.RBLK = '0'B;

   8145  1 000712   200011 470700                    LDP0  ! MBLK$,,AUTO
         1 000713   000001 236200 2                  LDQ   ! 1
         1 000714   000010 356300                    ANSQ  ! 8,,PR0

      486     8146    4                 RBLK$->KQ$RBLK.NCDDA=0;

   8146  1 000715   200010 470700                    LDP0  ! RBLK$,,AUTO
         1 000716   000011 450300                    STZ   ! 9,,PR0

      487     8147    4                 GOTO SEND;

   8147  1 000717   001103 710200 1                  TRA   ! SEND

      488     8148    4                 END;

   8148  1 000720   001044 710000 1                  TRA     s:8182

      489     8149
      490     8150    3             CASE (%HOLD#);

      491     8151    3               IF FPT_UNLATCH.TELLAU & '11'B THEN

   8151  1 000721   100001 236100                    LDQ     1,,PR1
         1 000722   600000 376003                    ANQ     -65536,DU
         1 000723   600000 376003                    ANQ     -65536,DU
         1 000724   000731 600000 1                  TZE     s:8153

      492     8152    3                CALL TELLAU (%CG_UNLH#);

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:63   
   8152  1 000725   000002 236000 2                  LDQ     2
         1 000726   200025 756100                    STQ     DOACT+5,,AUTO
         1 000727   001242 701000 1                  TSX1    TELLAU
         1 000730   000000 011000                    NOP     0

      493     8153    3               IF FPT_UNLATCH.TELLOS & '11'B THEN CALL TELLOS;

   8153  1 000731   200004 470500                    LDP0    @FPT_UNLATCH,,AUTO
         1 000732   000001 236100                    LDQ     1,,PR0
         1 000733   000002 736000                    QLS     2
         1 000734   600000 376003                    ANQ     -65536,DU
         1 000735   600000 376003                    ANQ     -65536,DU
         1 000736   000741 600000 1                  TZE     s:8154

   8153  1 000737   001121 701000 1                  TSX1    TELLOS
         1 000740   000000 011000                    NOP     0

      494     8154    3               IF MBLK$->KQ$MBLK.DDA ~= 0 THEN

   8154  1 000741   200011 470500                    LDP0    MBLK$,,AUTO
         1 000742   000006 235100                    LDA     6,,PR0
         1 000743   000762 600000 1                  TZE     s:8160

      495     8155    4                 DO;

      496     8156    4                 DBLK$R=MBLK$->KQ$MBLK.STAMP;

   8156  1 000744   000001 236100                    LDQ     1,,PR0
         1 000745   777777 376007                    ANQ     -1,DL
         1 000746   200015 756100                    STQ     DBLK$,,AUTO

      497     8157    4                 CALL KQD$RENEGE (CG$->KQ$CG,DBLK$,MBLK$->KQ$MBLK.DDA);

   8157  1 000747   200011 236100                    LDQ     MBLK$,,AUTO
         1 000750   000006 036003                    ADLQ    6,DU
         1 000751   200032 756100                    STQ     OSTA$+5,,AUTO
         1 000752   200015 631500                    EPPR1   DBLK$,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:64   
         1 000753   200031 451500                    STP1    OSTA$+4,,AUTO
         1 000754   200013 236100                    LDQ     CG$,,AUTO
         1 000755   200030 756100                    STQ     OSTA$+3,,AUTO
         1 000756   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 000757   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000760   000000 701000 xent               TSX1    KQD$RENEGE
         1 000761   000000 011000                    NOP     0

      498     8158    4                 END;

      499     8159    4                 DO INHIBIT;

      500     8160    4                 RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);

   8160  1 000762   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 000763   200010 470700                    LDP0  ! RBLK$,,AUTO
         1 000764   000000 756300                    STQ   ! 0,,PR0

      501     8161    4                 MBLK$->KQ$MBLK.RBLK = '0'B;

   8161  1 000765   200011 470700                    LDP0  ! MBLK$,,AUTO
         1 000766   000001 236200 2                  LDQ   ! 1
         1 000767   000010 356300                    ANSQ  ! 8,,PR0

      502     8162    4                 RBLK$->KQ$RBLK.NCDDA=0;

   8162  1 000770   200010 470700                    LDP0  ! RBLK$,,AUTO
         1 000771   000011 450300                    STZ   ! 9,,PR0

      503     8163    4                 CWMBLK$=KQ$STA.MBLK$;

   8163  1 000772   200003 471700                    LDP1  ! @KQ$STA,,AUTO
         1 000773   100012 236300                    LDQ   ! 10,,PR1
         1 000774   200017 756300                    STQ   ! CWMBLK$,,AUTO

      504     8164    4                 KQ$STA.MBLK$=MBLK$;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:65   
   8164  1 000775   200011 236300                    LDQ   ! MBLK$,,AUTO
         1 000776   100012 756300                    STQ   ! 10,,PR1

      505     8165    4                 CALL KQW$HOLD (KQ$STA);

   8165  1 000777   200003 630700                    EPPR0 ! @KQ$STA,,AUTO
         1 001000   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001001   000000 701200 xent               TSX1  ! KQW$HOLD
         1 001002   000000 011200                    NOP   ! 0

      506     8166    4                 KQ$STA.MBLK$=CWMBLK$;

   8166  1 001003   200017 236300                    LDQ   ! CWMBLK$,,AUTO
         1 001004   200003 470700                    LDP0  ! @KQ$STA,,AUTO
         1 001005   000012 756300                    STQ   ! 10,,PR0

      507     8167    4                 END;

   8167  1 001006   001044 710000 1                  TRA     s:8182

      508     8168
      509     8169    3             CASE (%DELETE#);

      510     8170    3               IF FPT_UNLATCH.TELLAU & '1'B THEN

   8170  1 001007   100001 236100                    LDQ     1,,PR1
         1 001010   600000 376003                    ANQ     -65536,DU
         1 001011   400000 376003                    ANQ     -131072,DU
         1 001012   001017 600000 1                  TZE     s:8172

      511     8171    3                CALL TELLAU (%CG_UNLD#);

   8171  1 001013   000003 236000 2                  LDQ     3
         1 001014   200025 756100                    STQ     DOACT+5,,AUTO
         1 001015   001242 701000 1                  TSX1    TELLAU
         1 001016   000000 011000                    NOP     0

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:66   
      512     8172    3               IF FPT_UNLATCH.TELLOS & '1'B THEN CALL TELLOS;

   8172  1 001017   200004 470500                    LDP0    @FPT_UNLATCH,,AUTO
         1 001020   000001 236100                    LDQ     1,,PR0
         1 001021   000002 736000                    QLS     2
         1 001022   600000 376003                    ANQ     -65536,DU
         1 001023   400000 376003                    ANQ     -131072,DU
         1 001024   001027 600000 1                  TZE     s:8174

   8172  1 001025   001121 701000 1                  TSX1    TELLOS
         1 001026   000000 011000                    NOP     0

      513     8173    4                 DO INHIBIT;

      514     8174    4                 MBLK$->KQ$MBLK.DDA=RBLK$->KQ$RBLK.NCDDA;

   8174  1 001027   200010 470700                    LDP0  ! RBLK$,,AUTO
         1 001030   200011 471700                    LDP1  ! MBLK$,,AUTO
         1 001031   000011 235300                    LDA   ! 9,,PR0
         1 001032   100006 755300                    STA   ! 6,,PR1

      515     8175    4                 RBLK$->KQ$RBLK.NCDDA=0;

   8175  1 001033   200010 470700                    LDP0  ! RBLK$,,AUTO
         1 001034   000011 450300                    STZ   ! 9,,PR0

      516     8176    4                 RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);

   8176  1 001035   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 001036   000000 756300                    STQ   ! 0,,PR0

      517     8177    4                 MBLK$->KQ$MBLK.RBLK = '0'B;

   8177  1 001037   200011 470700                    LDP0  ! MBLK$,,AUTO
         1 001040   000001 236200 2                  LDQ   ! 1
         1 001041   000010 356300                    ANSQ  ! 8,,PR0

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:67   
      518     8178    4                 CALL DELMSG;

   8178  1 001042   001536 701200 1                  TSX1  ! DELMSG
         1 001043   000000 011200                    NOP   ! 0

      519     8179    4                 END;

      520     8180
      521     8181    3           END; /* CASE FPT_UNLATCH.INPUT */

      522     8182    2         RETURN;

   8182  1 001044   200022 221300                    LDX1  ! DOACT+2,,AUTO
         1 001045   000001 702211                    TSX2  ! 1,X1

      523     8183        /****************************************************************
      524     8184        *****************************************************************/
      525     8185        /*D* NAME:         DUMPWR
      526     8186             PURPOSE:      To dispose of a latched output msg
      527     8187             DESCRIPTION:  MBLK$ points to the output msg to be gotten rid
      528     8188                           of, and P$ points to the link which must be set
      529     8189                           to the message's link.  The message is disposed
      530     8190                           of according to FPT_UNLATCH.OUTPUT.
      531     8191        */
      532     8192    2   DUMPWR: ENTRY ALTRET;

   8192  1 001046   200022 741300       DUMPWR       STX1  ! DOACT+2,,AUTO

      533     8193
      534     8194    3           DO CASE (FPT_UNLATCH.OUTPUT);

   8194  1 001047   200004 470500                    LDP0    @FPT_UNLATCH,,AUTO
         1 001050   000000 720100                    LXL0    0,,PR0
         1 001051   000777 360003                    ANX0    511,DU
         1 001052   000003 100003                    CMPX0   3,DU
         1 001053   001055 602010 1                  TNC     s:8194+6,X0
         1 001054   001117 710000 1                  TRA     s:8215
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:68   
         1 001055   001117 710000 1                  TRA     s:8215
         1 001056   001067 710000 1                  TRA     s:8204
         1 001057   001060 710000 1                  TRA     s:8198

      535     8195
      536     8196    3             CASE (%DELETE#);

      537     8197    4                 DO INHIBIT;

      538     8198    4                 P$->B$$PTR=MBLK$->KQ$MBLK.LNK$;

   8198  1 001060   200011 471700                    LDP1  ! MBLK$,,AUTO
         1 001061   100000 236300                    LDQ   ! 0,,PR1
         1 001062   200014 473700                    LDP3  ! P$,,AUTO
         1 001063   300000 756300                    STQ   ! 0,,PR3

      539     8199    4                 CALL DELMSG;

   8199  1 001064   001536 701200 1                  TSX1  ! DELMSG
         1 001065   000000 011200                    NOP   ! 0

      540     8200    4                 END;

   8200  1 001066   001117 710000 1                  TRA     s:8215

      541     8201
      542     8202    3             CASE (%SEND#);

      543     8203    4                 DO INHIBIT;

      544     8204    4                 P$->B$$PTR=MBLK$->KQ$MBLK.LNK$;

   8204  1 001067   200011 471700                    LDP1  ! MBLK$,,AUTO
         1 001070   100000 236300                    LDQ   ! 0,,PR1
         1 001071   200014 473700                    LDP3  ! P$,,AUTO
         1 001072   300000 756300                    STQ   ! 0,,PR3

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:69   
      545     8205    4                 MBLK$->KQ$MBLK.TYC='0'B;

   8205  1 001073   200011 471700                    LDP1  ! MBLK$,,AUTO
         1 001074   100013 450300                    STZ   ! 11,,PR1

      546     8206    4                MBLK$->KQ$MBLK.DVE.DVBYTE=MBLK$->KQ$MBLK.DVE.DVBYTE & (~%DVBYTE_CONT#)
              8206                          ;

   8206  1 001075   100010 236300                    LDQ   ! 8,,PR1
         1 001076   000011 736200                    QLS   ! 9
         1 001077   777000 376203                    ANQ   ! -512,DU
         1 001100   776000 376203                    ANQ   ! -1024,DU
         1 001101   000011 772200                    QRL   ! 9
         1 001102   100010 552320                    STBQ  ! 8,'20'O,PR1

   8206  1 001103                       SEND         null
      547     8207    4   SEND:         ;
      548     8208    4                 CWMBLK$=KQ$STA.MBLK$;

   8208  1 001103   200003 470700                    LDP0  ! @KQ$STA,,AUTO
         1 001104   000012 236300                    LDQ   ! 10,,PR0
         1 001105   200017 756300                    STQ   ! CWMBLK$,,AUTO

      549     8209    4                 KQ$STA.MBLK$=MBLK$;

   8209  1 001106   200011 236300                    LDQ   ! MBLK$,,AUTO
         1 001107   000012 756300                    STQ   ! 10,,PR0

      550     8210    4                 CALL KQW$SEND (KQ$STA);

   8210  1 001110   200003 630700                    EPPR0 ! @KQ$STA,,AUTO
         1 001111   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001112   000000 701200 xent               TSX1  ! KQW$SEND
         1 001113   000000 011200                    NOP   ! 0

      551     8211    4                 KQ$STA.MBLK$=CWMBLK$;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:70   
   8211  1 001114   200017 236300                    LDQ   ! CWMBLK$,,AUTO
         1 001115   200003 470700                    LDP0  ! @KQ$STA,,AUTO
         1 001116   000012 756300                    STQ   ! 10,,PR0

      552     8212    4                 END;

      553     8213
      554     8214    3           END; /* CASE FPT_UNLATCH.OUTPUT */

      555     8215    2         RETURN;

   8215  1 001117   200022 221300                    LDX1  ! DOACT+2,,AUTO
         1 001120   000001 702211                    TSX2  ! 1,X1

      556     8216    2   END DUMPRD;
      557     8217        /**/
      558     8218        /****************************************************************
      559     8219        *****************************************************************/
      560     8220        /*D* NAME:         TELLOS
      561     8221             PURPOSE:      To send '*RESPX' to the origin station of a latched
      562     8222                           input
      563     8223             DESCRIPTION:  A message of type '*RESPX', and no data, is sent
      564     8224                           the the station that sent the message pointed to
      565     8225                           by MBLK$
      566     8226        */
      567     8227    1   TELLOS: PROC;

   8227  1 001121   200024 741300       TELLOS       STX1  ! DOACT+4,,AUTO

      568     8228        /**/
      569     8229    2   DCL TMBLK$ PTR;
      570     8230        /**/
      571     8231    2         CALL KQM$GETMBLK (CG$->KQ$CG,TMBLK$,I) ALTRET(T0);

   8231  1 001122   200012 630500                    EPPR0   I,,AUTO
         1 001123   200032 450500                    STP0    OSTA$+5,,AUTO
         1 001124   200025 631500                    EPPR1   TMBLK$,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:71   
         1 001125   200031 451500                    STP1    OSTA$+4,,AUTO
         1 001126   200013 236100                    LDQ     CG$,,AUTO
         1 001127   200030 756100                    STQ     OSTA$+3,,AUTO
         1 001130   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001131   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001132   000000 701000 xent               TSX1    KQM$GETMBLK
         1 001133   001135 702000 1                  TSX2    T0

      572     8232    2         GOTO T1;

   8232  1 001134   001153 710000 1                  TRA     T1

      573     8233    2   T0:   I=KQMR_MBLK#;

   8233  1 001135   000001 235007       T0           LDA     1,DL
         1 001136   200012 755100                    STA     I,,AUTO

      574     8234    2         TMBLK$=ADDR(KQ$STA);

   8234  1 001137   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 001140   200025 756100                    STQ     TMBLK$,,AUTO

      575     8235    2         CALL KQM$GETBR (CG$->KQ$CG,TMBLK$,I) ALTRET(RTN);

   8235  1 001141   200012 630500                    EPPR0   I,,AUTO
         1 001142   200032 450500                    STP0    OSTA$+5,,AUTO
         1 001143   200025 631500                    EPPR1   TMBLK$,,AUTO
         1 001144   200031 451500                    STP1    OSTA$+4,,AUTO
         1 001145   200013 236100                    LDQ     CG$,,AUTO
         1 001146   200030 756100                    STQ     OSTA$+3,,AUTO
         1 001147   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001150   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001151   000000 701000 xent               TSX1    KQM$GETBR
         1 001152   001240 702000 1                  TSX2    RTN

   8234  1 001153                       T1           null
      576     8236    2   T1:   ;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:72   
      577     8237    2         TMBLK$->KQ$MBLK.STAR='1'B;

   8237  1 001153   200025 470500                    LDP0    TMBLK$,,AUTO
         1 001154   100000 236003                    LDQ     32768,DU
         1 001155   000010 256100                    ORSQ    8,,PR0

      578     8238    2         IF CG$->KQ$CG.QISS THEN

   8238  1 001156   200013 470500                    LDP0    CG$,,AUTO
         1 001157   000106 235100                    LDA     70,,PR0
         1 001160   001200 600000 1                  TZE     s:8246

      579     8239    3           DO;

      580     8240    3           TMBLK$->KQ$MBLK.KEY1=KQ$STA.BTN.KEY;

   8240  1 001161   200003 471500                    LDP1    @KQ$STA,,AUTO
         1 001162   200025 473500                    LDP3    TMBLK$,,AUTO
         1 001163   040100 100500                    MLR     fill='040'O
         1 001164   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 001165   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8

      581     8241    3           TMBLK$->KQ$MBLK.KEY2='*RESPX';

   8241  1 001166   200025 473500                    LDP3    TMBLK$,,AUTO
         1 001167   040100 100400                    MLR     fill='040'O
         1 001170   000007 000006 0                  ADSC9   E_CULRAUEVR+3            cn=0,n=6
         1 001171   300004 000010                    ADSC9   4,,PR3                   cn=0,n=8

      582     8242    3           TMBLK$->KQ$MBLK.DSTA=MBLK$->KQ$MBLK.KEY1;

   8242  1 001172   200025 473500                    LDP3    TMBLK$,,AUTO
         1 001173   200011 474500                    LDP4    MBLK$,,AUTO
         1 001174   400002 237100                    LDAQ    2,,PR4
         1 001175   300011 755100                    STA     9,,PR3
         1 001176   300012 756100                    STQ     10,,PR3

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:73   
      583     8243    3           END;

   8243  1 001177   001216 710000 1                  TRA     s:8250

      584     8244    2         ELSE
      585     8245    3           DO;

      586     8246    3           TMBLK$->KQ$MBLK.KEY1='*RESPX';

   8246  1 001200   200025 471500                    LDP1    TMBLK$,,AUTO
         1 001201   040100 100400                    MLR     fill='040'O
         1 001202   000007 000006 0                  ADSC9   E_CULRAUEVR+3            cn=0,n=6
         1 001203   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8

      587     8247    3           TMBLK$->KQ$MBLK.KEY2=KQ$STA.BTN.KEY;

   8247  1 001204   200003 471500                    LDP1    @KQ$STA,,AUTO
         1 001205   200025 473500                    LDP3    TMBLK$,,AUTO
         1 001206   040100 100500                    MLR     fill='040'O
         1 001207   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 001210   300004 000010                    ADSC9   4,,PR3                   cn=0,n=8

      588     8248    3           TMBLK$->KQ$MBLK.DSTA=MBLK$->KQ$MBLK.KEY2;

   8248  1 001211   200025 473500                    LDP3    TMBLK$,,AUTO
         1 001212   200011 474500                    LDP4    MBLK$,,AUTO
         1 001213   400004 237100                    LDAQ    4,,PR4
         1 001214   300011 755100                    STA     9,,PR3
         1 001215   300012 756100                    STQ     10,,PR3

      589     8249    3           END;

      590     8250    2         TMBLK$->KQ$MBLK.MID.PRIMARY=MBLK$->KQ$MBLK.MID.PRIMARY;

   8250  1 001216   200011 473500                    LDP3    MBLK$,,AUTO
         1 001217   200025 474500                    LDP4    TMBLK$,,AUTO
         1 001220   300014 235100                    LDA     12,,PR3
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:74   
         1 001221   400014 755100                    STA     12,,PR4

      591     8251    2         TMBLK$->KQ$MBLK.MID.XT     =BITBIN('777777777777'O);

   8251  1 001222   200025 474500                    LDP4    TMBLK$,,AUTO
         1 001223   000027 235000 xsym               LDA     B_VECTNIL+23
         1 001224   400015 755100                    STA     13,,PR4

      592     8252    2         CWMBLK$=KQ$STA.MBLK$;

   8252  1 001225   100012 236100                    LDQ     10,,PR1
         1 001226   200017 756100                    STQ     CWMBLK$,,AUTO

      593     8253    2         KQ$STA.MBLK$=TMBLK$;

   8253  1 001227   200025 236100                    LDQ     TMBLK$,,AUTO
         1 001230   100012 756100                    STQ     10,,PR1

      594     8254    2         CALL KQW$SENDNA (KQ$STA);

   8254  1 001231   200003 630500                    EPPR0   @KQ$STA,,AUTO
         1 001232   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001233   000000 701000 xent               TSX1    KQW$SENDNA
         1 001234   000000 011000                    NOP     0

      595     8255    2         KQ$STA.MBLK$=CWMBLK$;

   8255  1 001235   200017 236100                    LDQ     CWMBLK$,,AUTO
         1 001236   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 001237   000012 756100                    STQ     10,,PR0

      596     8256    2   RTN:  RETURN;

   8256  1 001240   200024 221300       RTN          LDX1  ! DOACT+4,,AUTO
         1 001241   000001 702211                    TSX2  ! 1,X1

      597     8257    2   END TELLOS;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:75   
      598     8258        /**/
      599     8259        /****************************************************************
      600     8260        *****************************************************************/
      601     8261        /*D* NAME:         TELLAU
      602     8262             PURPOSE:      To send a message to the AU
      603     8263        */
      604     8264    1   TELLAU: PROC (CODE);

   8264  1 001242   200024 741300       TELLAU       STX1  ! DOACT+4,,AUTO

      605     8265        /**/
      606     8266    2   DCL CODE UBIN WORD;
      607     8267        /**/
      608     8268    2         CALL KCA$TELLAUR (KQ$STA,CODE,MBLK$->KQ$MBLK);

   8268  1 001243   200011 236100                    LDQ     MBLK$,,AUTO
         1 001244   200032 756100                    STQ     OSTA$+5,,AUTO
         1 001245   200025 236100                    LDQ     @CODE,,AUTO
         1 001246   200003 235100                    LDA     @KQ$STA,,AUTO
         1 001247   200030 757100                    STAQ    OSTA$+3,,AUTO
         1 001250   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001251   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001252   000000 701000 xent               TSX1    KCA$TELLAUR
         1 001253   000000 011000                    NOP     0

      609     8269    2         RETURN;

   8269  1 001254   200024 221300                    LDX1  ! DOACT+4,,AUTO
         1 001255   000001 702211                    TSX2  ! 1,X1

      610     8270    2   END TELLAU;
      611     8271        /**/
      612     8272        /****************************************************************
      613     8273        *****************************************************************/
      614     8274        /*D* NAME:         INCMP
      615     8275             PURPOSE:      To process release by the journaller of a
      616     8276                           journaled message
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:76   
      617     8277             DESCRIPTION:  The JRNLD flag is set in the message, and the
      618     8278                           originating TERMINAL (if any) is told about
      619     8279                           the MSGID if he in fact wants to be.
      620     8280        */
      621     8281    1   INCMP: PROC;

   8281  1 001256   200024 741300       INCMP        STX1  ! DOACT+4,,AUTO

      622     8282        /**/
      623     8283        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      624     8622    2   DCL OSTA$ PTR;
      625     8623        /**/
      626     8624    2         MBLK$->KQ$MBLK.JRNLD='1'B;

   8624  1 001257   200011 470500                    LDP0    MBLK$,,AUTO
         1 001260   040000 236003                    LDQ     16384,DU
         1 001261   000010 256100                    ORSQ    8,,PR0

      627     8625    2         IF NOT MBLK$->KQ$MBLK.DVE.DVBYTE & %DVBYTE_RRR# THEN RETURN;

   8625  1 001262   200011 470500                    LDP0    MBLK$,,AUTO
         1 001263   000010 236100                    LDQ     8,,PR0
         1 001264   000011 736000                    QLS     9
         1 001265   777000 376003                    ANQ     -512,DU
         1 001266   010000 376003                    ANQ     4096,DU
         1 001267   001272 601000 1                  TNZ     s:8627

   8625  1 001270   200024 221300                    LDX1  ! DOACT+4,,AUTO
         1 001271   000001 702211                    TSX2  ! 1,X1

      628     8626              %LOCK (G=KQ$STREE.GATE);

   8627  1 001272   200013 236100                    LDQ     CG$,,AUTO
         1 001273   000075 036003                    ADLQ    61,DU
         1 001274   200030 756100                    STQ     OSTA$+3,,AUTO
         1 001275   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001276   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:77   
         1 001277   000000 701000 xent               TSX1    HFC$LOCK
         1 001300   000000 011000                    NOP     0

      629     8629    2         IF CG$->KQ$CG.QISS THEN

   8629  1 001301   200013 470500                    LDP0    CG$,,AUTO
         1 001302   000106 235100                    LDA     70,,PR0
         1 001303   001321 600000 1                  TZE     s:8632

      630     8630    2          CALL KQB$SRCH (KQ$STREE,MBLK$->KQ$MBLK.KEY1,OSTA$) ALTRET(J0);

   8630  1 001304   200025 631500                    EPPR1   OSTA$,,AUTO
         1 001305   200032 451500                    STP1    OSTA$+5,,AUTO
         1 001306   200011 236100                    LDQ     MBLK$,,AUTO
         1 001307   000002 036003                    ADLQ    2,DU
         1 001310   200031 756100                    STQ     OSTA$+4,,AUTO
         1 001311   200013 236100                    LDQ     CG$,,AUTO
         1 001312   000075 036003                    ADLQ    61,DU
         1 001313   200030 756100                    STQ     OSTA$+3,,AUTO
         1 001314   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001315   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001316   000000 701000 xent               TSX1    KQB$SRCH
         1 001317   001414 702000 1                  TSX2    J0
         1 001320   001335 710000 1                  TRA     s:8634

      631     8631    2         ELSE
      632     8632    2          CALL KQB$SRCH (KQ$STREE,MBLK$->KQ$MBLK.KEY2,OSTA$) ALTRET(J0);

   8632  1 001321   200025 631500                    EPPR1   OSTA$,,AUTO
         1 001322   200032 451500                    STP1    OSTA$+5,,AUTO
         1 001323   200011 236100                    LDQ     MBLK$,,AUTO
         1 001324   000004 036003                    ADLQ    4,DU
         1 001325   200031 756100                    STQ     OSTA$+4,,AUTO
         1 001326   200013 236100                    LDQ     CG$,,AUTO
         1 001327   000075 036003                    ADLQ    61,DU
         1 001330   200030 756100                    STQ     OSTA$+3,,AUTO
         1 001331   200030 630500                    EPPR0   OSTA$+3,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:78   
         1 001332   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001333   000000 701000 xent               TSX1    KQB$SRCH
         1 001334   001414 702000 1                  TSX2    J0

      633     8633              %LOCK (G=OSTA$->KQ$STA.GATE);

   8634  1 001335   200025 236100                    LDQ     OSTA$,,AUTO
         1 001336   000016 036003                    ADLQ    14,DU
         1 001337   200030 756100                    STQ     OSTA$+3,,AUTO
         1 001340   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001341   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001342   000000 701000 xent               TSX1    HFC$LOCK
         1 001343   000000 011000                    NOP     0

      634     8636              %UNLOCK (G=KQ$STREE.GATE);

   8637  1 001344   200013 236100                    LDQ     CG$,,AUTO
         1 001345   000075 036003                    ADLQ    61,DU
         1 001346   200030 756100                    STQ     OSTA$+3,,AUTO
         1 001347   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001350   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001351   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001352   000000 011000                    NOP     0

      635     8639    2         IF  OSTA$->KQ$STA.IDSC = '0'B

   8639  1 001353   200025 470500                    LDP0    OSTA$,,AUTO
         1 001354   000020 234100                    SZN     16,,PR0
         1 001355   001403 604000 1                  TMI     s:8651
         1 001356   000020 236100                    LDQ     16,,PR0
         1 001357   040000 316003                    CANQ    16384,DU
         1 001360   001403 600000 1                  TZE     s:8651
         1 001361   000010 236100                    LDQ     8,,PR0
         1 001362   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001363   001403 600000 1                  TZE     s:8651
         1 001364   000023 236100                    LDQ     19,,PR0
         1 001365   004000 316007                    CANQ    2048,DL
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:79   
         1 001366   001403 600000 1                  TZE     s:8651
         1 001367   200011 471500                    LDP1    MBLK$,,AUTO
         1 001370   000025 236100                    LDQ     21,,PR0
         1 001371   100014 116100                    CMPQ    12,,PR1
         1 001372   001403 601000 1                  TNZ     s:8651

      636     8640    2         AND OSTA$->KQ$STA.TERM
      637     8641    2         AND OSTA$->KQ$STA.LDCT$ ~= ADDR(NIL)
      638     8642    2         AND OSTA$->KQ$STA.JRNLW
      639     8643    2         AND OSTA$->KQ$STA.JMSGID = MBLK$->KQ$MBLK.MID.PRIMARY THEN
      640     8644    3           DO;

      641     8645    3           OSTA$->KQ$STA.LOCKCNT=OSTA$->KQ$STA.LOCKCNT+1;

   8645  1 001373   000020 236100                    LDQ     16,,PR0
         1 001374   000001 036007                    ADLQ    1,DL
         1 001375   000020 552104                    STBQ    16,'04'O,PR0

      642     8646    3           CALL KQP$INCMP (OSTA$->KQ$STA);

   8646  1 001376   200025 630500                    EPPR0   OSTA$,,AUTO
         1 001377   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001400   000000 701000 xent               TSX1    KQP$INCMP
         1 001401   000000 011000                    NOP     0

      643     8647    3           END;

   8647  1 001402   001412 710000 1                  TRA     s:8654

      644     8648    2         ELSE
      645     8649    3           DO;

      646     8650                %UNLOCK (G=OSTA$->KQ$STA.GATE);

   8651  1 001403   200025 236100                    LDQ     OSTA$,,AUTO
         1 001404   000016 036003                    ADLQ    14,DU
         1 001405   200030 756100                    STQ     OSTA$+3,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:80   
         1 001406   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001407   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001410   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001411   000000 011000                    NOP     0

      647     8653    3           END;

      648     8654    2         RETURN;

   8654  1 001412   200024 221300                    LDX1  ! DOACT+4,,AUTO
         1 001413   000001 702211                    TSX2  ! 1,X1

   8645  1 001414                       J0           null
      649     8655    2   J0:   ;
      650     8656              %UNLOCK (G=KQ$STREE.GATE);

   8657  1 001414   200013 236100                    LDQ     CG$,,AUTO
         1 001415   000075 036003                    ADLQ    61,DU
         1 001416   200030 756100                    STQ     OSTA$+3,,AUTO
         1 001417   200030 630500                    EPPR0   OSTA$+3,,AUTO
         1 001420   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001421   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001422   000000 011000                    NOP     0

      651     8659    2         RETURN;

   8659  1 001423   200024 221300                    LDX1  ! DOACT+4,,AUTO
         1 001424   000001 702211                    TSX2  ! 1,X1

      652     8660    2   END INCMP;
      653     8661        /****************************************************************
      654     8662        *****************************************************************/
      655     8663        /*D* NAME:         GETCLW
      656     8664             PURPOSE:      To find a continued latched write
      657     8665             DESCRIPTION:  Searches the chain of outstanding continued
      658     8666                           writes for one from the JIT DCB.  If it
      659     8667                           finds it then RETURN with MBLK$ pointing to
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:81   
      660     8668                           the MBLK, and P$ pointing to the link word
      661     8669                           to be used for removal.  Else ALTRETs.
      662     8670        */
      663     8671    1   GETCLW: PROC ALTRET;

   8671  1 001425   200022 741300       GETCLW       STX1  ! DOACT+2,,AUTO

      664     8672        /**/
      665     8673    2         MBLK$=KQ$STA.MBLK$;

   8673  1 001426   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 001427   000012 236100                    LDQ     10,,PR0
         1 001430   200011 756100                    STQ     MBLK$,,AUTO

      666     8674    2         P$=ADDR(KQ$STA.MBLK$);

   8674  1 001431   200003 236100                    LDQ     @KQ$STA,,AUTO
         1 001432   000012 036003                    ADLQ    10,DU
         1 001433   200014 756100                    STQ     P$,,AUTO

      667     8675    3           DO WHILE (MBLK$ ~= ADDR(NIL));

   8675  1 001434   001450 710000 1                  TRA     s:8680

      668     8676    3           IF ADDR(MBLK$->KQ$MBLK.DCB$)->B$$PTRR.DSP = ADDR(B$JIT.DCB$)->B$$PTRR.DSP
              8676                    THEN

   8676  1 001435   200011 470500                    LDP0    MBLK$,,AUTO
         1 001436   000013 220100                    LDX0    11,,PR0
         1 001437   000000 471400 xsym               LDP1    B$JIT$
         1 001440   100232 100100                    CMPX0   154,,PR1
         1 001441   001444 601000 1                  TNZ     s:8678

      669     8677    3            RETURN;

   8677  1 001442   200022 221300                    LDX1  ! DOACT+2,,AUTO
         1 001443   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:82   

      670     8678    3           P$=ADDR(MBLK$->KQ$MBLK.LNK$);

   8678  1 001444   200011 236100                    LDQ     MBLK$,,AUTO
         1 001445   200014 756100                    STQ     P$,,AUTO

      671     8679    3           MBLK$=MBLK$->KQ$MBLK.LNK$;

   8679  1 001446   000000 236100                    LDQ     0,,PR0
         1 001447   200011 756100                    STQ     MBLK$,,AUTO

      672     8680    3           END;

   8680  1 001450   200011 236100                    LDQ     MBLK$,,AUTO
         1 001451   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001452   001435 601000 1                  TNZ     s:8676

      673     8681    2         ALTRETURN;

   8681  1 001453   200022 221300                    LDX1  ! DOACT+2,,AUTO
         1 001454   000000 702211                    TSX2  ! 0,X1

      674     8682    2   END GETCLW;
      675     8683        %EJECT;
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:83   
      676     8684        /*F* NAME:         KQU$DELREAD
      677     8685             PURPOSE:      To delete a COMGROUP message
      678     8686             DESCRIPTION:  The first parameter is the station on whose behalf
      679     8687                           the message is being deleted.  The message to
      680     8688                           delete is pointed to by the RBLK indicated in
      681     8689                           KQ$STA.RBLK$.  The message is deleted by placing
      682     8690                           it on the delete queue and NILing out the RBLK
      683     8691                           pointer to it.
      684     8692
      685     8693                           The RBLK's NCDDA is held to be the first chunk
      686     8694                           of the message that is to be deleted.  To do
      687     8695                           this, NCDDA is stored in KQ$MBLK.DDA, and
      688     8696                           NCDDA is zeroed.
      689     8697        */
      690     8698    1   KQU$DELREAD: ENTRY(KQ$STA) ALTRET; /* !!Doesn't ALTRET!! */

   8698  1 001455   000000 700200 xent  KQU$DELREAD  TSX0  ! X66_AUTO_3
         1 001456   000034 000003                    ZERO    28,3

      691     8699        /**/
      692     8700    1         RBLK$=KQ$STA.RBLK$;

   8700  1 001457   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 001460   000011 236100                    LDQ     9,,PR0
         1 001461   200010 756100                    STQ     RBLK$,,AUTO

      693     8701    1         CG$=KQ$STA.CG$;

   8701  1 001462   000007 236100                    LDQ     7,,PR0
         1 001463   200013 756100                    STQ     CG$,,AUTO

      694     8702    2           DO INHIBIT;

      695     8703    2           MBLK$=RBLK$->KQ$RBLK.MBLK$;

   8703  1 001464   200010 471700                    LDP1  ! RBLK$,,AUTO
         1 001465   100000 236300                    LDQ   ! 0,,PR1
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:84   
         1 001466   200011 756300                    STQ   ! MBLK$,,AUTO

      696     8704    2           RBLK$->KQ$RBLK.MBLK$=ADDR(NIL);

   8704  1 001467   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 001470   100000 756300                    STQ   ! 0,,PR1

      697     8705    2           IF MBLK$ = ADDR(NIL) THEN RETURN;

   8705  1 001471   200011 236300                    LDQ   ! MBLK$,,AUTO
         1 001472   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 001473   001475 601200 1                  TNZ   ! s:8706

   8705  1 001474   000000 702200 xent               TSX2  ! X66_ARET

      698     8706    2           MBLK$->KQ$MBLK.RBLK = '0'B;

   8706  1 001475   200011 471700                    LDP1  ! MBLK$,,AUTO
         1 001476   000001 236200 2                  LDQ   ! 1
         1 001477   100010 356300                    ANSQ  ! 8,,PR1

      699     8707    2           MBLK$->KQ$MBLK.DDA=RBLK$->KQ$RBLK.NCDDA;

   8707  1 001500   200010 471700                    LDP1  ! RBLK$,,AUTO
         1 001501   200011 473700                    LDP3  ! MBLK$,,AUTO
         1 001502   100011 235300                    LDA   ! 9,,PR1
         1 001503   300006 755300                    STA   ! 6,,PR3

      700     8708    2           RBLK$->KQ$RBLK.NCDDA=0;

   8708  1 001504   200010 471700                    LDP1  ! RBLK$,,AUTO
         1 001505   100011 450300                    STZ   ! 9,,PR1

      701     8709    2           CALL DELMSG;

   8709  1 001506   001536 701200 1                  TSX1  ! DELMSG
         1 001507   000000 011200                    NOP   ! 0
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:85   

      702     8710    2           END;

      703     8711    1         RETURN;

   8711  1 001510   000000 702200 xent               TSX2  ! X66_ARET

      704     8712        /*F* NAME:         KQU$DELETE
      705     8713             PURPOSE:      To delete a COMGROUP message
      706     8714             DESCRIPTION:  Called on behalf of a station to delete a message.
      707     8715                           The MBLK to delete is in KQ$STA.MBLK$, which is
      708     8716                           set to NIL.  If the data can be fetched and deleted
      709     8717                           now, this is done and the MBLK released, else the
      710     8718                           MBLK is placed on the delete queue.
      711     8719        */
      712     8720    1   KQU$DELETE: ENTRY (KQ$STA) ALTRET; /* !!Doesn't ALTRET!! */

   8720  1 001511   000000 700200 xent  KQU$DELETE   TSX0  ! X66_AUTO_3
         1 001512   000034 000003                    ZERO    28,3

      713     8721        /**/
      714     8722    1         CG$=KQ$STA.CG$;

   8722  1 001513   200003 470500                    LDP0    @KQ$STA,,AUTO
         1 001514   000007 236100                    LDQ     7,,PR0
         1 001515   200013 756100                    STQ     CG$,,AUTO

      715     8723    2           DO INHIBIT;

      716     8724    2           MBLK$=KQ$STA.MBLK$;

   8724  1 001516   000012 236300                    LDQ   ! 10,,PR0
         1 001517   200011 756300                    STQ   ! MBLK$,,AUTO

      717     8725    2           KQ$STA.MBLK$=ADDR(NIL);

   8725  1 001520   000001 236200 xsym               LDQ   ! B_VECTNIL+1
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:86   
         1 001521   000012 756300                    STQ   ! 10,,PR0

      718     8726    2           CALL DELMSG;

   8726  1 001522   001536 701200 1                  TSX1  ! DELMSG
         1 001523   000000 011200                    NOP   ! 0

      719     8727    2           END;

      720     8728    1         RETURN;

   8728  1 001524   000000 702200 xent               TSX2  ! X66_ARET

      721     8729        /**/
      722     8730        /*F* NAME:         KQU$DELMSG
      723     8731             PURPOSE:      To delete a COMGROUP message
      724     8732             CALL:         KQU$DELMSG (KQ$CG,KQ$MBLK);
      725     8733             DESCRIPTION:  The message described by KQ$MBLK is deleted.
      726     8734        */
      727     8735    1   KQU$DELMSG: ENTRY (KQ$STA,FPT_UNLATCH) ALTRET; /* !!Doesn't ALTRET!! */

   8735  1 001525   000000 700200 xent  KQU$DELMSG   TSX0  ! X66_AUTO_3
         1 001526   000034 000003                    ZERO    28,3

      728     8736        /**/
      729     8737    2           DO INHIBIT;

      730     8738    2           CG$=ADDR(KQ$STA);

   8738  1 001527   200003 236300                    LDQ   ! @KQ$STA,,AUTO
         1 001530   200013 756300                    STQ   ! CG$,,AUTO

      731     8739    2           MBLK$=ADDR(FPT_UNLATCH);

   8739  1 001531   200004 236300                    LDQ   ! @FPT_UNLATCH,,AUTO
         1 001532   200011 756300                    STQ   ! MBLK$,,AUTO

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:87   
      732     8740    2           CALL DELMSG;

   8740  1 001533   001536 701200 1                  TSX1  ! DELMSG
         1 001534   000000 011200                    NOP   ! 0

      733     8741    2           END;

      734     8742    1         RETURN;

   8742  1 001535   000000 702200 xent               TSX2  ! X66_ARET

      735     8743        /*D* NAME:         DELMSG
      736     8744             PURPOSE:      To delete a message
      737     8745             DESCRIPTION:  The MBLK to delete is MBLK$.  The message
      738     8746                           is gotten rid of either by deleting the DBLKs
      739     8747                           and releasing the MBLK, or by placing the MBLK on
      740     8748                           the delete queue.
      741     8749        */
      742     8750    1   DELMSG: PROC;

   8750  1 001536   200024 741300       DELMSG       STX1  ! DOACT+4,,AUTO

      743     8751    3           DO INHIBIT;

      744     8752    3           IF NOT MBLK$->KQ$MBLK.JRNLD THEN

   8752  1 001537   200011 470700                    LDP0  ! MBLK$,,AUTO
         1 001540   000010 236300                    LDQ   ! 8,,PR0
         1 001541   040000 316203                    CANQ  ! 16384,DU
         1 001542   001561 601200 1                  TNZ   ! DEL0

      745     8753    4             DO;

      746     8754    4             IF MBLK$->KQ$MBLK.DDA ~= 0 THEN

   8754  1 001543   000006 235300                    LDA   ! 6,,PR0
         1 001544   001547 600200 1                  TZE   ! s:8756
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:88   

      747     8755    4              CALL DELDDA ALTRET(DEL0);

   8755  1 001545   001646 701200 1                  TSX1  ! DELDDA
         1 001546   001561 702200 1                  TSX2  ! DEL0

      748     8756    4             CALL KQM$RELMBLK (CG$->KQ$CG,MBLK$);

   8756  1 001547   200011 630700                    EPPR0 ! MBLK$,,AUTO
         1 001550   200031 450700                    STP0  ! OSTA$+4,,AUTO
         1 001551   200013 236300                    LDQ   ! CG$,,AUTO
         1 001552   200030 756300                    STQ   ! OSTA$+3,,AUTO
         1 001553   200030 630700                    EPPR0 ! OSTA$+3,,AUTO
         1 001554   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 001555   000000 701200 xent               TSX1  ! KQM$RELMBLK
         1 001556   000000 011200                    NOP   ! 0

      749     8757    4             RETURN;

   8757  1 001557   200024 221300                    LDX1  ! DOACT+4,,AUTO
         1 001560   000001 702211                    TSX2  ! 1,X1

   8752  1 001561                       DEL0         null
      750     8758    4             END;
      751     8759    3   DEL0:   ;
      752     8760                %LOCK (G=CG$->KQ$CG.GATE.MISC);

   8761  1 001561   200013 236300                    LDQ   ! CG$,,AUTO
         1 001562   000111 036203                    ADLQ  ! 73,DU
         1 001563   200030 756300                    STQ   ! OSTA$+3,,AUTO
         1 001564   200030 630700                    EPPR0 ! OSTA$+3,,AUTO
         1 001565   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 001566   000000 701200 xent               TSX1  ! HFC$LOCK
         1 001567   000000 011200                    NOP   ! 0

      753     8763    3           MBLK$->KQ$MBLK.LNK$=CG$->KQ$CG.DELMSG$;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:89   
   8763  1 001570   200013 470700                    LDP0  ! CG$,,AUTO
         1 001571   000114 236300                    LDQ   ! 76,,PR0
         1 001572   200011 471700                    LDP1  ! MBLK$,,AUTO
         1 001573   100000 756300                    STQ   ! 0,,PR1

      754     8764    3           CG$->KQ$CG.DELMSG$=MBLK$;

   8764  1 001574   200011 236300                    LDQ   ! MBLK$,,AUTO
         1 001575   000114 756300                    STQ   ! 76,,PR0

      755     8765    4             DO WHILE (CG$->KQ$CG.DELMSG$ ~= ADDR(NIL));

   8765  1 001576   001630 710200 1                  TRA   ! s:8773

      756     8766    4             MBLK$=CG$->KQ$CG.DELMSG$;

   8766  1 001577   200013 470700                    LDP0  ! CG$,,AUTO
         1 001600   000114 236300                    LDQ   ! 76,,PR0
         1 001601   200011 756300                    STQ   ! MBLK$,,AUTO

      757     8767    4             IF MBLK$->KQ$MBLK.JRNLD

   8767  1 001602   200011 471700                    LDP1  ! MBLK$,,AUTO
         1 001603   100010 236300                    LDQ   ! 8,,PR1
         1 001604   040000 316203                    CANQ  ! 16384,DU
         1 001605   001634 601200 1                  TNZ   ! DEL1
         1 001606   100010 234300                    SZN   ! 8,,PR1
         1 001607   001634 604200 1                  TMI   ! DEL1

      758     8768    4             OR MBLK$->KQ$MBLK.SUPER THEN GOTO DEL1;
      759     8769    4             IF MBLK$->KQ$MBLK.DDA ~= 0 THEN

   8769  1 001610   100006 235300                    LDA   ! 6,,PR1
         1 001611   001614 600200 1                  TZE   ! s:8771

      760     8770    4              CALL DELDDA ALTRET(DEL1);

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:90   
   8770  1 001612   001646 701200 1                  TSX1  ! DELDDA
         1 001613   001634 702200 1                  TSX2  ! DEL1

      761     8771    4             CG$->KQ$CG.DELMSG$=MBLK$->KQ$MBLK.LNK$;

   8771  1 001614   200011 470700                    LDP0  ! MBLK$,,AUTO
         1 001615   000000 236300                    LDQ   ! 0,,PR0
         1 001616   200013 471700                    LDP1  ! CG$,,AUTO
         1 001617   100114 756300                    STQ   ! 76,,PR1

      762     8772    4             CALL KQM$RELMBLK (CG$->KQ$CG,MBLK$);

   8772  1 001620   200011 633700                    EPPR3 ! MBLK$,,AUTO
         1 001621   200031 453700                    STP3  ! OSTA$+4,,AUTO
         1 001622   200013 236300                    LDQ   ! CG$,,AUTO
         1 001623   200030 756300                    STQ   ! OSTA$+3,,AUTO
         1 001624   200030 630700                    EPPR0 ! OSTA$+3,,AUTO
         1 001625   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 001626   000000 701200 xent               TSX1  ! KQM$RELMBLK
         1 001627   000000 011200                    NOP   ! 0

      763     8773    4             END;

   8773  1 001630   200013 470700                    LDP0  ! CG$,,AUTO
         1 001631   000114 236300                    LDQ   ! 76,,PR0
         1 001632   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 001633   001577 601200 1                  TNZ   ! s:8766

   8771  1 001634                       DEL1         null
      764     8774    3   DEL1:   ;
      765     8775                %UNLOCK (G=CG$->KQ$CG.GATE.MISC);

   8776  1 001634   200013 236300                    LDQ   ! CG$,,AUTO
         1 001635   000111 036203                    ADLQ  ! 73,DU
         1 001636   200030 756300                    STQ   ! OSTA$+3,,AUTO
         1 001637   200030 630700                    EPPR0 ! OSTA$+3,,AUTO
         1 001640   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:91   
         1 001641   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 001642   000000 011200                    NOP   ! 0

      766     8778    3           RETURN;

   8778  1 001643   200024 221300                    LDX1  ! DOACT+4,,AUTO
         1 001644   000001 702211                    TSX2  ! 1,X1

      767     8779    3           END; /*INHIBIT*/

   8779  1 001645   001701 710000 1                  TRA     s:8792

      768     8780        /**/
      769     8781    2   DELDDA: PROC ALTRET;

   8781  1 001646   200026 741300       DELDDA       STX1  ! OSTA$+1,,AUTO

      770     8782        /**/
      771     8783    4           DO INHIBIT;

      772     8784    4           DBLK$R=MBLK$->KQ$MBLK.STAMP;

   8784  1 001647   200011 470700                    LDP0  ! MBLK$,,AUTO
         1 001650   000001 236300                    LDQ   ! 1,,PR0
         1 001651   777777 376207                    ANQ   ! -1,DL
         1 001652   200015 756300                    STQ   ! DBLK$,,AUTO

      773     8785    4           DDA=MBLK$->KQ$MBLK.DDA;

   8785  1 001653   000006 235300                    LDA   ! 6,,PR0
         1 001654   200016 755300                    STA   ! DDA,,AUTO

      774     8786    4           CALL KQD$DELDDA (CG$->KQ$CG,DBLK$,DDA) ALTRET(D1);

   8786  1 001655   200016 631700                    EPPR1 ! DDA,,AUTO
         1 001656   200032 451700                    STP1  ! OSTA$+5,,AUTO
         1 001657   200015 633700                    EPPR3 ! DBLK$,,AUTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:92   
         1 001660   200031 453700                    STP3  ! OSTA$+4,,AUTO
         1 001661   200013 236300                    LDQ   ! CG$,,AUTO
         1 001662   200030 756300                    STQ   ! OSTA$+3,,AUTO
         1 001663   200030 630700                    EPPR0 ! OSTA$+3,,AUTO
         1 001664   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         1 001665   000000 701200 xent               TSX1  ! KQD$DELDDA
         1 001666   001671 702200 1                  TSX2  ! D1

      775     8787    4           RETURN;

   8787  1 001667   200026 221300                    LDX1  ! OSTA$+1,,AUTO
         1 001670   000001 702211                    TSX2  ! 1,X1

      776     8788    4   D1:     IF DDA ~= %KQDE_NDFRBLK THEN RETURN;

   8788  1 001671   200016 235300       D1           LDA   ! DDA,,AUTO
         1 001672   000012 115207                    CMPA  ! 10,DL
         1 001673   001676 600200 1                  TZE   ! s:8789

   8788  1 001674   200026 221300                    LDX1  ! OSTA$+1,,AUTO
         1 001675   000001 702211                    TSX2  ! 1,X1

      777     8789    4           ALTRETURN;

   8789  1 001676   200026 221300                    LDX1  ! OSTA$+1,,AUTO
         1 001677   000000 702211                    TSX2  ! 0,X1

      778     8790    4           END; /* Inhibit */

      779     8791    3   END DELDDA;

   8791  1 001700   000001 702211                    TSX2  ! 1,X1

      780     8792    2   END DELMSG;

   8792  1 001701   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:93   
E_CGNTUL
 Sect OctLoc
   0     000   132125 021624                                                    ZU..

E_BCGULO
 Sect OctLoc
   0     001   132125 021614                                                    ZU..

E_MULDCW
 Sect OctLoc
   0     002   132125 021644                                                    ZU..

E_CULUSR
 Sect OctLoc
   0     003   132125 021654                                                    ZU..

E_CULRAUEVR
 Sect OctLoc
   0     004   132125 022504                                                    ZU..

(unnamed)
 Sect OctLoc
   0     005   052101 125105   126040 040040   052122 105123   120130 040040    *AUEV   *RESPX

(unnamed)
 Sect OctLoc
   2     000   000010 006000   777777 777677   000011 006000   000012 006000    ................
      781     8793    1   END KQU$UNLATCH;

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:94   
--  Include file information  --

   B$JIT_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQU$UNLATCH.
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:95   

 **** Variables and constants ****

  ****  Section 000 RoData KQU$UNLATCH

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/w STRC        r     1 E_BCGULO                   0-0-0/w STRC        r     1 E_CGNTUL
     4-0-0/w STRC        r     1 E_CULRAUEVR                3-0-0/w STRC        r     1 E_CULUSR
     2-0-0/w STRC        r     1 E_MULDCW

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    25-0-0/w PTR         r     1 @CODE                      5-0-0/w PTR         r     1 @ERR
     4-0-0/w PTR         r     1 @FPT_UNLATCH               3-0-0/w PTR         r     1 @KQ$STA
    13-0-0/w PTR         r     1 CG$                       *0-0-0/w UBIN        r     1 CODE
    17-0-0/w PTR         r     1 CWMBLK$                   15-0-0/w PTR         r     1 DBLK$
    15-0-0/w UBIN        r     1 DBLK$R                    16-0-0/w UBIN        r     1 DDA
    20-0-0/w UBIN        r     1 DOACT                     *0-0-0/w BIT         r     1 ERR
    *0-0-0/d STRC(108)   r     1 FPT_UNLATCH               12-0-0/w UBIN        r     1 I
    *0-0-0/d STRC(1296)  r     1 KQ$STA                    11-0-0/w PTR         r     1 MBLK$
    25-0-0/w PTR         r     1 OSTA$                     14-0-0/w PTR         r     1 P$
     6-0-0/w PTR         r     1 QTN$                      10-0-0/w PTR         r     1 RBLK$
     7-0-0/w UBIN        r     1 RELIT                     25-0-0/w PTR         r     1 TMBLK$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$

  ****  BASED and DCB variables  ****

PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:96   
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$$PTR                     0-0-0/w STRC        r     1 B$$PTRR
     0-0-0/d STRC(7560)  r     1 B$JIT                      0-0-0/d STRC(6516)  r     1 KQ$CG
     0-0-0/d STRC(576)   r     1 KQ$MBLK                    0-0-0/d STRC(1908)  r     1 KQ$QTN
     0-0-0/d STRC(648)   r     1 KQ$RBLK                    0-0-0/d STRC(1296)  r     1 KQ$STA
     0-0-0/w STRC(216)   r     1 KQ$THDR


   Procedure KQU$UNLATCH requires 962 words for executable code.
   Procedure KQU$UNLATCH requires 28 words of local(AUTO) storage.

    No errors detected in file KQU$UNLATCH.:E05TSI    .
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:97   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:98   
          MINI XREF LISTING

B$$PTR
      7677**DCL      8059>>ASSIGN   8198<<ASSIGN   8204<<ASSIGN
B$$PTRR.DSP
      7679**DCL      7927>>IF       7927>>IF       8676>>IF       8676>>IF
B$JIT.DCB$
      7670**DCL      7927--IF       8676--IF
B$JIT.ERR.MID
      7581**DCL      7581--REDEF
B$JIT$
      7758**DCL      7575--IMP-PTR  7927>>IF       8676>>IF
BADOPT
      7864**LABEL    7820--GOTO     7953--GOTO
CG$
      7692**DCL      5837--IMP-PTR  7845<<ASSIGN   7875<<ASSIGN   7956>>IF       7956>>IF       7973>>IF
      7973>>IF       7998>>CALL     8039>>CALL     8044>>CALL     8100>>CALL     8136>>CALL     8139>>IF
      8157>>CALL     8231>>CALL     8235>>CALL     8238>>IF       8627>>CALL     8629>>IF       8630>>CALL
      8632>>CALL     8637>>CALL     8657>>CALL     8701<<ASSIGN   8722<<ASSIGN   8738<<ASSIGN   8756>>CALL
      8761>>CALL     8763>>ASSIGN   8764>>ASSIGN   8765>>DOWHILE  8766>>ASSIGN   8771>>ASSIGN   8772>>CALL
      8776>>CALL     8786>>CALL
CODE IN PROCEDURE TELLAU
      8266**DCL      8264--PROC     8268<>CALL
CWMBLK$
      7697**DCL      8163<<ASSIGN   8166>>ASSIGN   8208<<ASSIGN   8211>>ASSIGN   8252<<ASSIGN   8255>>ASSIGN
D1 IN PROCEDURE DELDDA
      8788**LABEL    8786--CALLALT
DBLK$
      7694**DCL      7695--REDEF    8136<>CALL     8157<>CALL     8786<>CALL
DBLK$R
      7695**DCL      8135<<ASSIGN   8156<<ASSIGN   8784<<ASSIGN
DDA
      7696**DCL      8785<<ASSIGN   8786<>CALL     8788>>IF
DEL0 IN PROCEDURE DELMSG
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:99   
      8752**LABEL    8755--CALLALT
DEL1 IN PROCEDURE DELMSG
      8771**LABEL    8768--GOTO     8770--CALLALT
DELDDA IN PROCEDURE DELMSG
      8781**PROC     8755--CALL     8770--CALL
DELIN
      7982**LABEL    7847--GOTO     7968--GOTO
DELMSG
      8750**PROC     8178--CALL     8199--CALL     8709--CALL     8726--CALL     8740--CALL
DOACT
      7698**DCL      7846<<ASSIGN   7849<<ASSIGN   8016>>IF       8104>>IF
DOLW
      7909**LABEL    7906--CALLALT
DUMPRD
      8125**PROC     8067--CALL
DUMPWR IN PROCEDURE DUMPRD
      8192**ENTRY    7922--CALL     7932--CALL     7941--CALL     8057--CALL     8064--CALL
ERR
      5815**DCL        52--PROC     7841--ENTRY    7864<<ASSIGN   7891<<ASSIGN   7913<<ASSIGN   7959<<ASSIGN
      7977<<ASSIGN
E_BCGULO
      7712**DCL      7891>>ASSIGN
E_CGNTUL
      7706**DCL      7864>>ASSIGN
E_CULRAUEVR
      7730**DCL      7959>>ASSIGN
E_CULUSR
      7724**DCL      7977>>ASSIGN
E_MULDCW
      7718**DCL      7913>>ASSIGN
FPT_UNLATCH
      5812**DCL        52--PROC     7841--ENTRY    8735--ENTRY    8739--ASSIGN
FPT_UNLATCH.INPUT
      5812**DCL      7887>>DOCASE   7955>>IF       8048>>IF       8127>>DOCASE
FPT_UNLATCH.JOURNALED
      5812**DCL      8139>>IF
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:100  
FPT_UNLATCH.OUTPUT
      5812**DCL      7817>>DOCASE   7909>>IF       7953>>IF       7986>>IF       8194>>DOCASE
FPT_UNLATCH.TELLAU
      5812**DCL      8130>>IF       8151>>IF       8170>>IF
FPT_UNLATCH.TELLOS
      5812**DCL      8132>>IF       8153>>IF       8172>>IF
GETCLW
      8671**PROC     7906--CALL
HFC$LOCK
      2923**DCL-ENT  7851--CALL     7998--CALL     8072--CALL     8107--CALL     8627--CALL     8634--CALL
      8761--CALL
HFC$UNLOCK
      2923**DCL-ENT  7861--CALL     7873--CALL     8044--CALL     8090--CALL     8097--CALL     8111--CALL
      8637--CALL     8651--CALL     8657--CALL     8776--CALL
I
      7691**DCL      8231<>CALL     8233<<ASSIGN   8235<>CALL
INCMP
      8281**PROC     8141--CALL
J0 IN PROCEDURE INCMP
      8645**LABEL    8630--CALLALT  8632--CALLALT
KCA$TELLAUR
      7741**DCL-ENT  8268--CALL
KQ$CG
      5837**DCL      8039<>CALL     8100<>CALL     8136<>CALL     8157<>CALL     8231<>CALL     8235<>CALL
      8756<>CALL     8772<>CALL     8786<>CALL
KQ$CG.AUCTL.DVBYTE.REREAD
      6280**DCL      6281--REDEF
KQ$CG.DELMSG$
      6233**DCL      8763>>ASSIGN   8764<<ASSIGN   8765>>DOWHILE  8766>>ASSIGN   8771<<ASSIGN
KQ$CG.GATE.MISC
      6229**DCL      8761<>CALL     8776<>CALL
KQ$CG.JRNLSTA$
      6340**DCL      8139>>IF
KQ$CG.QISS
      6223**DCL      7956>>IF       7956>>IF       7973>>IF       7973>>IF       8238>>IF       8629>>IF
KQ$CG.QUEUE.QTREE$
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:101  
      6059**DCL      7998>>CALL     8044>>CALL
KQ$CG.STREE
      6169**DCL      8630<>CALL     8632<>CALL
KQ$CG.STREE.GATE
      6171**DCL      8627<>CALL     8637<>CALL     8657<>CALL
KQ$MBLK
      6760**DCL      8268<>CALL
KQ$MBLK.DCB$
      6913**DCL      7927--IF       8676--IF
KQ$MBLK.DDA
      6825**DCL      8133>>IF       8136<>CALL     8154>>IF       8157<>CALL     8174<<ASSIGN   8707<<ASSIGN
      8754>>IF       8769>>IF       8785>>ASSIGN
KQ$MBLK.DSTA
      6909**DCL      8242<<ASSIGN   8248<<ASSIGN
KQ$MBLK.DVE.DVBYTE
      6860**DCL      8206<<ASSIGN   8206>>ASSIGN   8625>>IF
KQ$MBLK.DVE.EOMCHAR
      6862**DCL      6864--REDEF
KQ$MBLK.FORCECONT
      6897**DCL      7909>>IF       7989>>IF
KQ$MBLK.JRNLD
      6852**DCL      8624<<ASSIGN   8752>>IF       8767>>IF
KQ$MBLK.KEY1
      6788**DCL      6790--REDEF    7956>>IF       7973>>IF       8001>>IF       8240<<ASSIGN   8242>>ASSIGN
      8246<<ASSIGN   8630<>CALL
KQ$MBLK.KEY2
      6797**DCL      6815--REDEF    7956>>IF       7973>>IF       8241<<ASSIGN   8247<<ASSIGN   8248>>ASSIGN
      8632<>CALL
KQ$MBLK.LATCH
      6847**DCL      7907>>IF       7988>>IF       8057>>IF
KQ$MBLK.LNK$
      6762**DCL      6764--REDEF    6770--REDEF    6774--REDEF    7937>>IF       7940--ASSIGN   7944>>ASSIGN
      7990>>ASSIGN   8058--ASSIGN   8198>>ASSIGN   8204>>ASSIGN   8678--ASSIGN   8679>>ASSIGN   8763<<ASSIGN
      8771>>ASSIGN
KQ$MBLK.MID.PRIMARY
      6921**DCL      8250<<ASSIGN   8250>>ASSIGN   8639>>IF
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:102  
KQ$MBLK.MID.XT
      6922**DCL      8251<<ASSIGN
KQ$MBLK.RBLK
      6901**DCL      8145<<ASSIGN   8161<<ASSIGN   8177<<ASSIGN   8706<<ASSIGN
KQ$MBLK.STAMP
      6782**DCL      8135>>ASSIGN   8156>>ASSIGN   8784>>ASSIGN
KQ$MBLK.STAR
      6850**DCL      8237<<ASSIGN
KQ$MBLK.SUPER
      6841**DCL      8767>>IF
KQ$MBLK.TYC
      6911**DCL      6913--REDEF    8205<<ASSIGN
KQ$MBLK.XSP.MREQ$
      6817**DCL      6821--REDEF
KQ$QTN.CNACT
      7411**DCL      8024<<ASSIGN   8024>>ASSIGN   8029>>IF       8037>>IF
KQ$QTN.CRASHACT
      7446**DCL      8019<<ASSIGN   8019>>ASSIGN
KQ$QTN.MXACT
      7414**DCL      7416--REDEF    8016>>IF       8037>>IF
KQ$QTN.STA.ACTTYC
      7136**DCL      7140--REDEF
KQ$QTN.STA.BTN.KEY
      7120**DCL      8001>>IF
KQ$QTN.STA.DCBLNK$
      7143**DCL      7146--REDEF    7150--REDEF
KQ$QTN.STA.EVCNT
      7229**DCL      7232--REDEF
KQ$QTN.STA.EVNT
      7195**DCL      7199--REDEF    7202--REDEF
KQ$QTN.STA.OPNBLKED
      7256**DCL      7259--REDEF
KQ$QTN.STA.OPNREJ
      7262**DCL      7264--REDEF
KQ$QTN.STA.SUCCREAD
      7185**DCL      7189--REDEF
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:103  
KQ$QTN.STA.TCOUNT
      7314**DCL      7320--REDEF
KQ$QTN.STA.VGOT$
      7299**DCL      7303--REDEF    7307--REDEF
KQ$RBLK.BUF$
      6696**DCL      6698--REDEF
KQ$RBLK.CNACTD
      6610**DCL      6619--REDEF    8020>>IF       8028<<ASSIGN
KQ$RBLK.CS
      6601**DCL      7973>>IF
KQ$RBLK.DBLKX
      6716**DCL      6720--REDEF
KQ$RBLK.EOFNONE
      6588**DCL      6591--REDEF
KQ$RBLK.FROMQ
      6594**DCL      6597--REDEF    7993>>IF
KQ$RBLK.KEY1R
      6635**DCL      6636--REDEF
KQ$RBLK.KEY2R
      6640**DCL      6641--REDEF
KQ$RBLK.LATCH
      6583**DCL      6585--REDEF    7855>>IF
KQ$RBLK.LWRITES$
      6727**DCL      6731--REDEF    7925>>IF       7929>>IF       7931--ASSIGN   7935>>ASSIGN   8061--ASSIGN
      8062>>ASSIGN   8065>>ASSIGN
KQ$RBLK.LWTL$
      6698**DCL      7926>>ASSIGN   7939<<ASSIGN
KQ$RBLK.MBLK$
      6575**DCL      7855>>IF       7954>>ASSIGN   7971>>ASSIGN   7996>>ASSIGN   8126>>ASSIGN   8144<<ASSIGN
      8160<<ASSIGN   8176<<ASSIGN   8703>>ASSIGN   8704<<ASSIGN
KQ$RBLK.NCDDA
      6657**DCL      8146<<ASSIGN   8162<<ASSIGN   8174>>ASSIGN   8175<<ASSIGN   8707>>ASSIGN   8708<<ASSIGN
KQ$RBLK.QTN$
      6734**DCL      7993<<ASSIGN   8000>>ASSIGN
KQ$RBLK.STATE
      6580**DCL      7855>>IF       8052<<ASSIGN   8068<<ASSIGN
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:104  
KQ$STA
      5486**DCL        52--PROC     7841--ENTRY    8139--IF       8165<>CALL     8210<>CALL     8234--ASSIGN
      8254<>CALL     8268<>CALL     8698--ENTRY    8720--ENTRY    8735--ENTRY    8738--ASSIGN
KQ$STA.ACTTYC
      5538**DCL      5542--REDEF
KQ$STA.BTN.KEY
      5522**DCL      8240>>ASSIGN   8247>>ASSIGN
KQ$STA.CG$
      5525**DCL      7845>>ASSIGN   7875>>ASSIGN   8701>>ASSIGN   8722>>ASSIGN
KQ$STA.DCBLNK$
      5545**DCL      5548--REDEF    5552--REDEF
KQ$STA.EVCNT
      5631**DCL      5634--REDEF
KQ$STA.EVNT
      5597**DCL      5601--REDEF    5604--REDEF
KQ$STA.GATE
      5564**DCL      7851<>CALL     7861<>CALL     7873<>CALL     8072<>CALL     8090<>CALL     8097<>CALL
      8107<>CALL     8111<>CALL
KQ$STA.LATCHCNT
      5556**DCL      8109<<ASSIGN   8109>>ASSIGN
KQ$STA.MBLK$
      5531**DCL      7985>>ASSIGN   8054--ASSIGN   8055>>ASSIGN   8163>>ASSIGN   8164<<ASSIGN   8166<<ASSIGN
      8208>>ASSIGN   8209<<ASSIGN   8211<<ASSIGN   8252>>ASSIGN   8253<<ASSIGN   8255<<ASSIGN   8673>>ASSIGN
      8674--ASSIGN   8724>>ASSIGN   8725<<ASSIGN
KQ$STA.OPNBLKED
      5658**DCL      5661--REDEF
KQ$STA.OPNREJ
      5664**DCL      5666--REDEF
KQ$STA.RBLK$
      5529**DCL      7844>>ASSIGN   7853>>ASSIGN   8074>>IF       8095<<ASSIGN   8700>>ASSIGN
KQ$STA.SUCCREAD
      5587**DCL      5591--REDEF
KQ$STA.TCOUNT
      5716**DCL      5722--REDEF
KQ$STA.VGOT$
      5701**DCL      5705--REDEF    5709--REDEF
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:105  
KQ$STA IN PROCEDURE INCMP
      8297**DCL      8646<>CALL
KQ$STA.ACTTYC IN PROCEDURE INCMP
      8349**DCL      8353--REDEF
KQ$STA.DCBLNK$ IN PROCEDURE INCMP
      8356**DCL      8359--REDEF    8363--REDEF
KQ$STA.EVCNT IN PROCEDURE INCMP
      8442**DCL      8445--REDEF
KQ$STA.EVNT IN PROCEDURE INCMP
      8408**DCL      8412--REDEF    8415--REDEF
KQ$STA.GATE IN PROCEDURE INCMP
      8375**DCL      8634<>CALL     8651<>CALL
KQ$STA.IDSC IN PROCEDURE INCMP
      8377**DCL      8639>>IF
KQ$STA.JMSGID IN PROCEDURE INCMP
      8520**DCL      8639>>IF
KQ$STA.JRNLW IN PROCEDURE INCMP
      8480**DCL      8639>>IF
KQ$STA.LDCT$ IN PROCEDURE INCMP
      8338**DCL      8639>>IF
KQ$STA.LOCKCNT IN PROCEDURE INCMP
      8431**DCL      8645<<ASSIGN   8645>>ASSIGN
KQ$STA.OPNBLKED IN PROCEDURE INCMP
      8469**DCL      8472--REDEF
KQ$STA.OPNREJ IN PROCEDURE INCMP
      8475**DCL      8477--REDEF
KQ$STA.SUCCREAD IN PROCEDURE INCMP
      8398**DCL      8402--REDEF
KQ$STA.TCOUNT IN PROCEDURE INCMP
      8527**DCL      8533--REDEF
KQ$STA.TERM IN PROCEDURE INCMP
      8393**DCL      8639>>IF
KQ$STA.VGOT$ IN PROCEDURE INCMP
      8512**DCL      8516--REDEF    8520--REDEF
KQ$THDR.GATE
      7035**DCL      7998<>CALL     8044<>CALL
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:106  
KQB$SRCH
      7742**DCL-ENT  8630--CALL     8632--CALL
KQD$DELDDA
      7743**DCL-ENT  8786--CALL
KQD$RENEGE
      7744**DCL-ENT  8136--CALL     8157--CALL
KQM$GETBR
      7745**DCL-ENT  8235--CALL
KQM$GETMBLK
      7746**DCL-ENT  8231--CALL
KQM$RELMBLK
      7747**DCL-ENT  8756--CALL     8772--CALL
KQM$RELRBLK
      7748**DCL-ENT  8100--CALL
KQP$INCMP
      7749**DCL-ENT  8646--CALL
KQQ$ACT
      7750**DCL-ENT  8039--CALL
KQW$HOLD
      7751**DCL-ENT  8165--CALL
KQW$SEND
      7752**DCL-ENT  8210--CALL
KQW$SENDNA
      7753**DCL-ENT  8254--CALL
KQ_IMBLK.DVE.EOMCHAR
      3598**DCL      3600--REDEF
KQ_IMBLK.KEY1
      3524**DCL      3526--REDEF
KQ_IMBLK.KEY2
      3533**DCL      3551--REDEF
KQ_IMBLK.LNK$
      3498**DCL      3500--REDEF    3506--REDEF    3510--REDEF
KQ_IMBLK.TYC
      3647**DCL      3649--REDEF
KQ_IMBLK.XSP.MREQ$
      3553**DCL      3557--REDEF
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:107  
KQ_IRBLK.BUF$
      3102**DCL      3104--REDEF
KQ_IRBLK.CNACTD
      3016**DCL      3025--REDEF
KQ_IRBLK.DBLKX
      3122**DCL      3126--REDEF
KQ_IRBLK.EOFNONE
      2994**DCL      2997--REDEF
KQ_IRBLK.FROMQ
      3000**DCL      3003--REDEF
KQ_IRBLK.KEY1R
      3041**DCL      3042--REDEF
KQ_IRBLK.KEY2R
      3046**DCL      3047--REDEF
KQ_IRBLK.LATCH
      2989**DCL      2991--REDEF
KQ_IRBLK.LWRITES$
      3133**DCL      3137--REDEF
KQ_IRBLKT.CNACTD
      3202**DCL      3211--REDEF
KQ_IRBLKT.DBLK$
      3265**DCL      3269--REDEF    3272--REDEF
KQ_IRBLKT.EOFNONE
      3180**DCL      3183--REDEF
KQ_IRBLKT.FROMQ
      3186**DCL      3189--REDEF
KQ_IRBLKT.KEY1R
      3227**DCL      3228--REDEF
KQ_IRBLKT.KEY2R
      3232**DCL      3233--REDEF
KQ_IRBLKT.LATCH
      3175**DCL      3177--REDEF
MBLK$
      7690**DCL      6760--IMP-PTR  7907>>IF       7909>>IF       7926<<ASSIGN   7927>>IF       7929>>IF
      7937>>IF       7954<<ASSIGN   7956>>IF       7956>>IF       7971<<ASSIGN   7973>>IF       7973>>IF
      7985<<ASSIGN   7987>>DOWHILE  7988>>IF       7989>>IF       7990<<ASSIGN   7990>>ASSIGN   7996<<ASSIGN
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:108  
      8001>>IF       8055<<ASSIGN   8056>>DOWHILE  8057>>IF       8058>>ASSIGN   8059<<ASSIGN   8062<<ASSIGN
      8063>>DOWHILE  8065<<ASSIGN   8126<<ASSIGN   8133>>IF       8135>>ASSIGN   8136>>CALL     8145>>ASSIGN
      8154>>IF       8156>>ASSIGN   8157>>CALL     8161>>ASSIGN   8164>>ASSIGN   8174>>ASSIGN   8177>>ASSIGN
      8198>>ASSIGN   8204>>ASSIGN   8205>>ASSIGN   8206>>ASSIGN   8206>>ASSIGN   8209>>ASSIGN   8242>>ASSIGN
      8248>>ASSIGN   8250>>ASSIGN   8268>>CALL     8624>>ASSIGN   8625>>IF       8630>>CALL     8632>>CALL
      8639>>IF       8673<<ASSIGN   8675>>DOWHILE  8676>>IF       8678>>ASSIGN   8679<<ASSIGN   8679>>ASSIGN
      8703<<ASSIGN   8705>>IF       8706>>ASSIGN   8707>>ASSIGN   8724<<ASSIGN   8739<<ASSIGN   8752>>IF
      8754>>IF       8756<>CALL     8763>>ASSIGN   8764>>ASSIGN   8766<<ASSIGN   8767>>IF       8767>>IF
      8769>>IF       8771>>ASSIGN   8772<>CALL     8784>>ASSIGN   8785>>ASSIGN
MULDCW
      7912**LABEL    7908--GOTO     7989--GOTO
NK$LDCT.DDT$
      7543**DCL      7543--REDEF
NK$LDCT.IOQ$
      7542**DCL      7543--REDEF
NK$LDCT.LDCTX
      7544**DCL      7544--REDEF
NK$LDCT.LKFLG.ABORTED
      7556**DCL      7557--REDEF
NK$LDCT.RLCID.LDCTX
      7566**DCL      7566--REDEF
NK$LDCT.STA$
      7562**DCL      7563--REDEF
NK$LDCT.SYMB$
      7541**DCL      7541--REDEF    7541--REDEF    7542--REDEF
NTUL
      7855**LABEL    7925--GOTO     7928--GOTO
NTULU
      7857**LABEL    7854--GOTO
OSTA$ IN PROCEDURE INCMP
      8622**DCL      8630<>CALL     8632<>CALL     8634>>CALL     8639>>IF       8639>>IF       8639>>IF
      8639>>IF       8639>>IF       8645>>ASSIGN   8645>>ASSIGN   8646>>CALL     8651>>CALL
P$
      7693**DCL      7931<<ASSIGN   7935<<ASSIGN   7937>>IF       7939>>ASSIGN   7940<<ASSIGN   7940>>ASSIGN
      7944<<ASSIGN   7944>>ASSIGN   8054<<ASSIGN   8058<<ASSIGN   8059>>ASSIGN   8061<<ASSIGN   8198>>ASSIGN
      8204>>ASSIGN   8674<<ASSIGN   8678<<ASSIGN
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:109  
QTN$
      7687**DCL      7068--IMP-PTR  8000<<ASSIGN   8001>>IF       8016>>IF       8019>>ASSIGN   8019>>ASSIGN
      8024>>ASSIGN   8024>>ASSIGN   8029>>IF       8037>>IF       8037>>IF       8039<>CALL
RBLK$
      7689**DCL      6574--IMP-PTR  7844<<ASSIGN   7853<<ASSIGN   7854>>IF       7855>>IF       7855>>IF
      7855>>IF       7925>>IF       7926>>ASSIGN   7929>>IF       7931>>ASSIGN   7935>>ASSIGN   7939>>ASSIGN
      7954>>ASSIGN   7971>>ASSIGN   7973>>IF       7993>>IF       7993>>ASSIGN   7996>>ASSIGN   8000>>ASSIGN
      8020>>IF       8028>>ASSIGN   8052>>ASSIGN   8061>>ASSIGN   8062>>ASSIGN   8065>>ASSIGN   8068>>ASSIGN
      8074>>IF       8100<>CALL     8126>>ASSIGN   8144>>ASSIGN   8146>>ASSIGN   8160>>ASSIGN   8162>>ASSIGN
      8174>>ASSIGN   8175>>ASSIGN   8176>>ASSIGN   8700<<ASSIGN   8703>>ASSIGN   8704>>ASSIGN   8707>>ASSIGN
      8708>>ASSIGN
RELIT
      7688**DCL      7822<<ASSIGN   7843<<ASSIGN   8069>>IF
RTN IN PROCEDURE TELLOS
      8256**LABEL    8235--CALLALT
SC_CGBADRBLK
      7757**DCL-ENT  8076--CALL
SC_CGCALZ
      7756**DCL-ENT  8029--CALL
SC_CGLRKL
      7755**DCL-ENT  8002--CALL
SEND IN PROCEDURE DUMPRD
      8206**LABEL    8147--GOTO
T0 IN PROCEDURE TELLOS
      8233**LABEL    8231--CALLALT
T1 IN PROCEDURE TELLOS
      8234**LABEL    8232--GOTO
TELLAU
      8264**PROC     8131--CALL     8152--CALL     8171--CALL
TELLOS
      8227**PROC     8132--CALL     8153--CALL     8172--CALL
TMBLK$ IN PROCEDURE TELLOS
      8229**DCL      8231<>CALL     8234<<ASSIGN   8235<>CALL     8237>>ASSIGN   8240>>ASSIGN   8241>>ASSIGN
      8242>>ASSIGN   8246>>ASSIGN   8247>>ASSIGN   8248>>ASSIGN   8250>>ASSIGN   8251>>ASSIGN   8253>>ASSIGN
UNL
      7846**LABEL    7823--GOTO
PL6.E3A0      #001=KQU$UNLATCH File=KQU$UNLATCH.:E05TSI                          WED 07/30/97 01:37 Page:110  
UNL1
      8037**LABEL    8040--GOTO
