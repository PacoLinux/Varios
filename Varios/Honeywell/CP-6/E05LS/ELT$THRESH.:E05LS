VERSION E05

PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:1    
        1        1        /*M* ELT$THRESH - IO ERROR THRESHOLDING ROUTINES */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR */
        8        8        ELT$THRESH: PROC(IOERR);
        9        9        %INCLUDE EL$TABLES;
       10      332        %EL$IOERR (NAME=IOERR,STCLASS="");
       11      342        /**/
       12      343    1   DCL EL_THRESHOLD BIT(1) SYMREF ALIGNED;
       13      344    1   DCL B$DS3$ PTR SYMREF;
       14      345    1   DCL IOM$(0:7) PTR BASED(B$DS3$);        /* SDS file in DS3 */
       15      346        /**/
       16      347        /* THE FOLLOWING STRUCTURES MUST MATCH THE CORRESPONDING STRUCTURES
       17      348           IN ELT$INIT   */
       18      349    1   DCL I$ PTR;
       19      350    1   DCL 1 IOM BASED(I$) ALIGNED,
       20      351    1         2 ERR_RATE UBIN,
       21      352    1         2 NUM_ENTRIES UBIN HALF UNAL,
       22      353    1         2 THRESH UBIN HALF UNAL,
       23      354    1         2 THRESH_RATE UBIN,
       24      355    1         2 CHAN$ PTR;
       25      356    1   DCL CHAN$ PTR;
       26      357    1   DCL 1 CHAN BASED ALIGNED,
       27      358    1         2 ERR_RATE UBIN,
       28      359    1         2 NUM_ENTRIES UBIN HALF UNAL,
       29      360    1         2 THRESH UBIN HALF UNAL,
       30      361    1         2 THRESH_RATE UBIN,
       31      362    1         2 DEV$ PTR,
       32      363    1         2 MPC$ PTR;
       33      364    1   DCL MPC$ PTR;
       34      365    1   DCL 1 MPC BASED(MPC$) ALIGNED,
       35      366    1         2 ERR_RATE UBIN,
       36      367    1         2 NUM_ENTRIES UBIN HALF UNAL,
       37      368    1         2 THRESH UBIN HALF UNAL,
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:2    
       38      369    1         2 THRESH_RATE UBIN,
       39      370    1         2 DEVNM CHAR(8);
       40      371    1   DCL DEV$ PTR;
       41      372    1   DCL 1 DEVPTR REDEF DEV$,
       42      373    1         2 OFFSET UBIN(18) UNAL,
       43      374    1         2 * BIT(6) UNAL,
       44      375    1         2 SEGID BIT(12) UNAL;
       45      376    1   DCL 1 DEV BASED(DEV$) ALIGNED,
       46      377    1         2 ERR_RATE UBIN,
       47      378    1         2 NUM_ENTRIES UBIN HALF UNAL,
       48      379    1         2 THRESH UBIN HALF UNAL,
       49      380    1         2 THRESH_RATE UBIN,
       50      381    1         2 DEVNM CHAR(8),
       51      382    1         2 DEVNUM UBIN,
       52      383    1         2 STATS (0:9) UBIN;
       53      384        /**/
       54      385        /* THESE SUBS DEFINE THE THRESHOLDS */
       55      386        /**/
       56      387        %SUB IOM_MAGIC=10;
       57      388        %SUB IOM_ERR_RATE=1000;
       58      389        %SUB IOM_THRESH=2;
       59      390        /**/
       60      391        %SUB CHAN_MAGIC=10;
       61      392        %SUB CHAN_ERR_RATE=1000;
       62      393        %SUB CHAN_THRESH=2;
       63      394        /**/
       64      395        %SUB MPC_MAGIC=10;
       65      396        %SUB MPC_ERR_RATE=1000;
       66      397        %SUB MPC_THRESH=2;
       67      398        /**/
       68      399        %SUB DEV_MAGIC=10;
       69      400        %SUB DEV_ERR_RATE=1000;
       70      401        %SUB DEV_THRESH=2;
       71      402        /**/
       72      403        /* THESE ARE THE MESSAGES THAT WILL BE OUTPUT */
       73      404        /**/
       74      405        %INCLUDE EL_PERR_C;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:3    
       75      418        /*E*    ERROR:   ELT-E$THRESH
       76      419                MESSAGE: Frequent errors on component %U1 - use ELAN for detail.
       77      420                DESCRIPTION:  THE SPECIFIED COMPONENT HAS EXCEEDED A PREDEFINED
       78      421                              ERROR THRESHOLD.
       79      422        */
       80      423        /*E*    ERROR:   ELT-E$NOENTRY
       81      424                MESSAGE: I/O SYSTEM ERROR: NO THRESHOLDING ENTRY FOR %U1
       82      425                DESCRIPTION:  AN I/O ERROR WAS REPORTED FOR A SYSTEM COMPONENT
       83      426                              THAT DOES NOT APPEAR IN ELF'S THRESHOLDING TABLES.
       84      427                              THIS INDICATES A BUG IN THE THRESHOLDING CODE OR
       85      428                              INCORRECT INFORMATION IN THE :CONFIG FILE.
       86      429        */
       87      430        %INCLUDE CP_6;
       88      511        /**/
       89      512    1   DCL 1 DS3_VECTOR STATIC DALIGNED,       /* used for RESULTS of M$GDS   */
       90      513    1         2 W1,
       91      514    1           3 VSIZE# UBIN(18) UNAL INIT(0), /* # of WORDS! not bytes  */
       92      515    1           3 *         BIT(2) INIT('00'B), /* these give the byte count */
       93      516    1           3 FLAGS#    BIT(9) INIT('777'O),
       94      517    1           3 TYP#      BIT(2) INIT('00'B),
       95      518    1           3 *         UBIN(5) UNAL INIT(0),
       96      519    1         2 W2,
       97      520    1           3 BASE#     UBIN(20) UNAL INIT(0),
       98      521    1           3 *         UBIN(4) UNAL INIT(0),
       99      522    1           3 SEGID# BIT(12) INIT('6006'O), /* $LS6 or DS3   */
      100      523    1         2 PTR$ REDEF W2  PTR;
      101      524        %FPT_GDS (FPTN=FINDSIZE_DS3,
      102      525                  SEGSIZE=0,
      103      526                  RESULTS=DS3_VECTOR);
      104      542    1   DCL M$DO DCB;
      105      543    1   DCL 1 ERRCODE STATIC ALIGNED,
      106      544    1         2 FCG BIT(18) UNAL INIT('051424'O),
      107      545    1         2 MON BIT(1) UNAL INIT('0'B),
      108      546    1         2 CODE UBIN(14) UNAL INIT(0),
      109      547    1         2 SEV UBIN(3) UNAL INIT(0);
      110      548        %FPT_ERRMSG (FPTN=FPT_ERRMSG,
      111      549                     CODE=ERRCODE,
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:4    
      112      550                     INCLCODE=NO,
      113      551                     OUTDCB1=M$DO,
      114      552                     SUBMESS=YES);
      115      579        %MACRO FIELD (NAME=FIELD,MSG="' '");
      116      580        DCL 1 NAME STATIC ALIGNED,
      117      581              2 L UBIN BYTE UNAL INIT(SIZEC(MSG)),
      118      582              2 C CHAR(0) INIT(MSG);
      119      583        %MEND;
      120      584        %FIELD (NAME=IOMMSG,MSG='IOM 0');
      121      589        %FIELD (NAME=CHANMSG,MSG="'IOM 0, CHANNEL 00'");
      122      594        %FIELD (NAME=DEVMSG,MSG='YYNN');
      123      599        %FIELD (NAME=MPCMSG,MSG="'MPC ON IOM 0, CHANNEL 00'");
      124      604    1   DCL 1 ERRBUF ALIGNED,
      125      605    1         2 B1 CHAR(120),
      126      606    1         2 B2 CHAR(120);
      127      607        %FPT_KEYIN (FPTN=FPT_KEYIN);
      128      626    1   DCL LAST_REQID UBIN WORD STATIC INIT(0);
      129      627    1   DCL B$JIT$ PTR SYMREF;
      130      628        %INCLUDE B$JIT;
      131      918        %SUB NEVER="WHILE('0'B)";
      132      919        %EJECT;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:5    
      133      920    1           IF NOT EL_THRESHOLD THEN RETURN;
      134      921                /* Check for status = standby or out of paper/cards.  Don't bother
      135      922                   thresholding for these statuses.                 */
      136      923    2           IF IOERR.STATUS.MAJOR = 2 THEN DO; /* ATTENTION */
      137      924    2              IF SUBSTR(IOERR.DEVNM,0,2) = 'DP' AND IOERR.STATUS.MINOR = '20'O
      138      925    2              THEN RETURN;
      139      926    2              ELSE
      140      927    2                 IF SUBSTR(IOERR.DEVNM,0,2) = 'MT' AND IOERR.STATUS.MINOR = '04'O
      141      928    2                 THEN RETURN;
      142      929    2                 ELSE
      143      930    2                    IF (SUBSTR(IOERR.DEVNM,0,2) = 'LP' OR
      144      931    2                      SUBSTR(IOERR.DEVNM,0,2) = 'CP' OR
      145      932    2                      SUBSTR(IOERR.DEVNM,0,2) = 'CR') AND
      146      933    2                      (IOERR.STATUS.MINOR = '01'O OR IOERR.STATUS.MINOR = '02'O)
      147      934    2                    THEN RETURN;
      148      935    2              END;                         /* IF STATUS.MAJOR = ATTENTION */
      149      936    1           IF IOERR.REQID = LAST_REQID
      150      937    1           THEN RETURN;
      151      938    1           ELSE LAST_REQID = IOERR.REQID;
      152      939    1           ERRCODE.CODE=%E$NOENTRY;
      153      940    1           I$=IOM$(IOERR.IOCHAN.IOM);
      154      941    1           IF I$=ADDR(NIL) THEN GOTO IOM_NAME;
      155      942    1           IF IOERR.THRESH.IOM THEN
      156      943    1              CALL THRESHOLD(IOM,IOERR.CONNECTS.IOM,IOM_MAGIC,IOM_THRESH) ALTRET(
               943                       IOM_NAME);
      157      944    1           CHAN$=PINCRW(IOM.CHAN$,SIZEW(CHAN)*IOERR.IOCHAN.CHAN);
      158      945    1           IF IOERR.THRESH.CHANNEL THEN
      159      946    1              CALL THRESHOLD(CHAN$->CHAN,IOERR.CONNECTS.CHANNEL,CHAN_MAGIC,CHAN_THRESH)
               946                       ALTRET(CHAN_NAME);
      160      947    2           IF IOERR.THRESH.MPC THEN DO;
      161      948    2              MPC$=CHAN$->CHAN.MPC$;
      162      949    3              IF MPC$=ADDR(NIL) THEN DO;
      163      950    3                 CALL BINCHAR(SUBSTR(MPCMSG.C,11,1),IOERR.IOCHAN.IOM);
      164      951    3                 CALL BINCHAR(SUBSTR(MPCMSG.C,22,2),IOERR.IOCHAN.CHAN);
      165      952    3                 FPT_ERRMSG.FIELD1_=VECTOR(MPCMSG);
      166      953    3                 GOTO PUT_MESSAGE;
      167      954    3                 END;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:6    
      168      955    2              CALL THRESHOLD(MPC,IOERR.CONNECTS.MPC,MPC_MAGIC,MPC_THRESH) ALTRET(
               955                       MPC_NAME);
      169      956    2              END;
      170      957    2           IF IOERR.THRESH.DEVICE THEN DO;
      171      958    2              IF CHAN$->CHAN.DEV$=ADDR(NIL) THEN GOTO DEV_NAME;
      172      959    2              DEV$ = CHAN$->CHAN.DEV$;
      173      960    2              CALL M$GDS(FINDSIZE_DS3) ALTRET(DEV_NAME);
      174      961    3              DO WHILE(DEV.DEVNUM ~= IOERR.IOCHAN.DVN);
      175      962    3                 DEV$ = PINCRW(DEV$,SIZEW(DEV));
      176      963    3                 IF DEVPTR.OFFSET > DS3_VECTOR.W1.VSIZE# THEN GOTO DEV_NAME;
      177      964                       /* if the pointer offset is greater than the size of the
      178      965                          data segment bound, we did NOT find the device!!        */
      179      966    3                 END;                      /* DO WHILE */
      180      967    2              CALL THRESHOLD(DEV,IOERR.CONNECTS.DEVICE,DEV_MAGIC,DEV_THRESH) ALTRET(
               967                       DEV_NAME);
      181      968    2              END;
      182      969    1           RETURN;
      183      970        /**/
      184      971    1   IOM_NAME: ;
      185      972    1           CALL BINCHAR(SUBSTR(IOMMSG.C,4,1),IOERR.IOCHAN.IOM);
      186      973    1           FPT_ERRMSG.FIELD1_=VECTOR(IOMMSG);
      187      974    1           GOTO PUT_MESSAGE;
      188      975    1   CHAN_NAME: ;
      189      976    1           CALL BINCHAR(SUBSTR(CHANMSG.C,4,1),IOERR.IOCHAN.IOM);
      190      977    1           CALL BINCHAR(SUBSTR(CHANMSG.C,15,2),IOERR.IOCHAN.CHAN);
      191      978    1           FPT_ERRMSG.FIELD1_=VECTOR(CHANMSG);
      192      979    1           GOTO PUT_MESSAGE;
      193      980    1   MPC_NAME: ;
      194      981    1           DEVMSG.C=MPC.DEVNM;
      195      982    1           FPT_ERRMSG.FIELD1_=VECTOR(DEVMSG);
      196      983    1           GOTO PUT_MESSAGE;
      197      984    1   DEV_NAME: ;
      198      985    1           DEVMSG.C=IOERR.DEVNM;
      199      986    1           FPT_ERRMSG.FIELD1_=VECTOR(DEVMSG);
      200      987    1   PUT_MESSAGE: ;
      201      988    1           FPT_ERRMSG.BUF_=VECTOR(ERRBUF);
      202      989    1           CALL M$ERRMSG(FPT_ERRMSG) ALTRET(BAG_IT);
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:7    
      203      990    2           IF B$JIT.MODE = %M_GHOST# THEN DO;
      204      991    2              FPT_KEYIN.MESS_=VECTOR(ERRBUF.B1);
      205      992    2              CALL M$KEYIN(FPT_KEYIN);
      206      993    2              END;
      207      994    1   BAG_IT: RETURN;
      208      995        %EJECT;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:8    
      209      996    1   THRESHOLD: PROC(TBL,CONNECTS,MAGIC,THRESH) ALTRET;
      210      997        /****** WHAT SOME OF THESE THINGS MEAN *********
      211      998             MAGIC - weight factor
      212      999             TBL.RATE - current weighted error rate - connects/error
      213     1000             TBL.THRESH_RATE - value that TBL.THRESH must exceed to have an error
      214     1001                               reported.  This value is settable via SYSCON.
      215     1002             TBL.THRESH - number of times this component has exceeded TBL.THRESH_RATE
      216     1003             THRESH - component must exceed TBL.THRESH_RATE THRESH times for a
      217     1004                      message to be output.
      218     1005        *********************************************************************/
      219     1006    2   DCL 1 TBL ALIGNED,
      220     1007    2         2 RATE UBIN,
      221     1008    2         2 NUM UBIN HALF UNAL,
      222     1009    2         2 THRESH UBIN HALF UNAL,
      223     1010    2         2 THRESH_RATE UBIN;
      224     1011    2   DCL CONNECTS UBIN HALF HALIGNED;
      225     1012    2   DCL MAGIC UBIN;
      226     1013    2   DCL THRESH UBIN WORD;
      227     1014    2   DCL TEMP UBIN;
      228     1015        /**/
      229     1016    2           IF TBL.NUM<MAGIC THEN TEMP=TBL.NUM;
      230     1017    2           ELSE TEMP=MAGIC;
      231     1018    2           TBL.NUM=TBL.NUM+1;
      232     1019    2           TBL.RATE=(TBL.RATE*TEMP+CONNECTS)/(TEMP+1);
      233     1020    3           IF TBL.RATE<TBL.THRESH_RATE AND TBL.NUM>MAGIC THEN DO;
      234     1021    3              TBL.THRESH=TBL.THRESH+1;
      235     1022    4              IF TBL.THRESH > THRESH THEN DO;
      236     1023    4                 TBL.RATE = 0;
      237     1024    4                 TBL.NUM = 0;
      238     1025    4                 TBL.THRESH = 0;
      239     1026    4                 ERRCODE.CODE=%E$THRESH;
      240     1027    4                 ALTRETURN;
      241     1028    4                 END;
      242     1029    3              END;
      243     1030    2           ELSE TBL.THRESH=0;
      244     1031    2           RETURN;
      245     1032    2   END THRESHOLD;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:9    
      246     1033    1   END ELT$THRESH;
      247     1034        %EOD;

PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:10   
--  Include file information  --

   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   EL_PERR_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ELT$THRESH.

   Procedure ELT$THRESH requires 320 words for executable code.
   Procedure ELT$THRESH requires 76 words of local(AUTO) storage.

PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:11   

 Object Unit name= ELT$THRESH                                 File name= ELT$THRESH.:E05TOU
 UTS= JUL 29 '97 15:19:51.96 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none    67    103  ELT$THRESH
    2   DCB   even  none     0      0  M$DO
    3  RoData even  UTS      5      5  ELT$THRESH
    4   Proc  even  none   320    500  ELT$THRESH
    5  RoData even  none    15     17  ELT$THRESH

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes            yes      Std        1  ELT$THRESH

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:12   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     EL_THRESHOLD                          B$DS3$                                M$UC
     M$DO                                  B$JIT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:13   


        1        1        /*M* ELT$THRESH - IO ERROR THRESHOLDING ROUTINES */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR */
        8        8        ELT$THRESH: PROC(IOERR);

      8  4 000000   000000 700200 xent  ELT$THRESH   TSX0  ! X66_AUTO_1
         4 000001   000114 000001                    ZERO    76,1

        9        9        %INCLUDE EL$TABLES;
       10      332        %EL$IOERR (NAME=IOERR,STCLASS="");
       11      342        /**/
       12      343    1   DCL EL_THRESHOLD BIT(1) SYMREF ALIGNED;
       13      344    1   DCL B$DS3$ PTR SYMREF;
       14      345    1   DCL IOM$(0:7) PTR BASED(B$DS3$);        /* SDS file in DS3 */
       15      346        /**/
       16      347        /* THE FOLLOWING STRUCTURES MUST MATCH THE CORRESPONDING STRUCTURES
       17      348           IN ELT$INIT   */
       18      349    1   DCL I$ PTR;
       19      350    1   DCL 1 IOM BASED(I$) ALIGNED,
       20      351    1         2 ERR_RATE UBIN,
       21      352    1         2 NUM_ENTRIES UBIN HALF UNAL,
       22      353    1         2 THRESH UBIN HALF UNAL,
       23      354    1         2 THRESH_RATE UBIN,
       24      355    1         2 CHAN$ PTR;
       25      356    1   DCL CHAN$ PTR;
       26      357    1   DCL 1 CHAN BASED ALIGNED,
       27      358    1         2 ERR_RATE UBIN,
       28      359    1         2 NUM_ENTRIES UBIN HALF UNAL,
       29      360    1         2 THRESH UBIN HALF UNAL,
       30      361    1         2 THRESH_RATE UBIN,
       31      362    1         2 DEV$ PTR,
       32      363    1         2 MPC$ PTR;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:14   
       33      364    1   DCL MPC$ PTR;
       34      365    1   DCL 1 MPC BASED(MPC$) ALIGNED,
       35      366    1         2 ERR_RATE UBIN,
       36      367    1         2 NUM_ENTRIES UBIN HALF UNAL,
       37      368    1         2 THRESH UBIN HALF UNAL,
       38      369    1         2 THRESH_RATE UBIN,
       39      370    1         2 DEVNM CHAR(8);
       40      371    1   DCL DEV$ PTR;
       41      372    1   DCL 1 DEVPTR REDEF DEV$,
       42      373    1         2 OFFSET UBIN(18) UNAL,
       43      374    1         2 * BIT(6) UNAL,
       44      375    1         2 SEGID BIT(12) UNAL;
       45      376    1   DCL 1 DEV BASED(DEV$) ALIGNED,
       46      377    1         2 ERR_RATE UBIN,
       47      378    1         2 NUM_ENTRIES UBIN HALF UNAL,
       48      379    1         2 THRESH UBIN HALF UNAL,
       49      380    1         2 THRESH_RATE UBIN,
       50      381    1         2 DEVNM CHAR(8),
       51      382    1         2 DEVNUM UBIN,
       52      383    1         2 STATS (0:9) UBIN;
       53      384        /**/
       54      385        /* THESE SUBS DEFINE THE THRESHOLDS */
       55      386        /**/
       56      387        %SUB IOM_MAGIC=10;
       57      388        %SUB IOM_ERR_RATE=1000;
       58      389        %SUB IOM_THRESH=2;
       59      390        /**/
       60      391        %SUB CHAN_MAGIC=10;
       61      392        %SUB CHAN_ERR_RATE=1000;
       62      393        %SUB CHAN_THRESH=2;
       63      394        /**/
       64      395        %SUB MPC_MAGIC=10;
       65      396        %SUB MPC_ERR_RATE=1000;
       66      397        %SUB MPC_THRESH=2;
       67      398        /**/
       68      399        %SUB DEV_MAGIC=10;
       69      400        %SUB DEV_ERR_RATE=1000;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:15   
       70      401        %SUB DEV_THRESH=2;
       71      402        /**/
       72      403        /* THESE ARE THE MESSAGES THAT WILL BE OUTPUT */
       73      404        /**/
       74      405        %INCLUDE EL_PERR_C;
       75      418        /*E*    ERROR:   ELT-E$THRESH
       76      419                MESSAGE: Frequent errors on component %U1 - use ELAN for detail.
       77      420                DESCRIPTION:  THE SPECIFIED COMPONENT HAS EXCEEDED A PREDEFINED
       78      421                              ERROR THRESHOLD.
       79      422        */
       80      423        /*E*    ERROR:   ELT-E$NOENTRY
       81      424                MESSAGE: I/O SYSTEM ERROR: NO THRESHOLDING ENTRY FOR %U1
       82      425                DESCRIPTION:  AN I/O ERROR WAS REPORTED FOR A SYSTEM COMPONENT
       83      426                              THAT DOES NOT APPEAR IN ELF'S THRESHOLDING TABLES.
       84      427                              THIS INDICATES A BUG IN THE THRESHOLDING CODE OR
       85      428                              INCORRECT INFORMATION IN THE :CONFIG FILE.
       86      429        */
       87      430        %INCLUDE CP_6;
       88      511        /**/
       89      512    1   DCL 1 DS3_VECTOR STATIC DALIGNED,       /* used for RESULTS of M$GDS   */
       90      513    1         2 W1,
       91      514    1           3 VSIZE# UBIN(18) UNAL INIT(0), /* # of WORDS! not bytes  */
       92      515    1           3 *         BIT(2) INIT('00'B), /* these give the byte count */
       93      516    1           3 FLAGS#    BIT(9) INIT('777'O),
       94      517    1           3 TYP#      BIT(2) INIT('00'B),
       95      518    1           3 *         UBIN(5) UNAL INIT(0),
       96      519    1         2 W2,
       97      520    1           3 BASE#     UBIN(20) UNAL INIT(0),
       98      521    1           3 *         UBIN(4) UNAL INIT(0),
       99      522    1           3 SEGID# BIT(12) INIT('6006'O), /* $LS6 or DS3   */
      100      523    1         2 PTR$ REDEF W2  PTR;
      101      524        %FPT_GDS (FPTN=FINDSIZE_DS3,
      102      525                  SEGSIZE=0,
      103      526                  RESULTS=DS3_VECTOR);
      104      542    1   DCL M$DO DCB;
      105      543    1   DCL 1 ERRCODE STATIC ALIGNED,
      106      544    1         2 FCG BIT(18) UNAL INIT('051424'O),
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:16   
      107      545    1         2 MON BIT(1) UNAL INIT('0'B),
      108      546    1         2 CODE UBIN(14) UNAL INIT(0),
      109      547    1         2 SEV UBIN(3) UNAL INIT(0);
      110      548        %FPT_ERRMSG (FPTN=FPT_ERRMSG,
      111      549                     CODE=ERRCODE,
      112      550                     INCLCODE=NO,
      113      551                     OUTDCB1=M$DO,
      114      552                     SUBMESS=YES);
      115      579        %MACRO FIELD (NAME=FIELD,MSG="' '");
      116      580        DCL 1 NAME STATIC ALIGNED,
      117      581              2 L UBIN BYTE UNAL INIT(SIZEC(MSG)),
      118      582              2 C CHAR(0) INIT(MSG);
      119      583        %MEND;
      120      584        %FIELD (NAME=IOMMSG,MSG='IOM 0');
      121      589        %FIELD (NAME=CHANMSG,MSG="'IOM 0, CHANNEL 00'");
      122      594        %FIELD (NAME=DEVMSG,MSG='YYNN');
      123      599        %FIELD (NAME=MPCMSG,MSG="'MPC ON IOM 0, CHANNEL 00'");
      124      604    1   DCL 1 ERRBUF ALIGNED,
      125      605    1         2 B1 CHAR(120),
      126      606    1         2 B2 CHAR(120);
      127      607        %FPT_KEYIN (FPTN=FPT_KEYIN);
      128      626    1   DCL LAST_REQID UBIN WORD STATIC INIT(0);
      129      627    1   DCL B$JIT$ PTR SYMREF;
      130      628        %INCLUDE B$JIT;
      131      918        %SUB NEVER="WHILE('0'B)";
      132      919        %EJECT;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:17   
      133      920    1           IF NOT EL_THRESHOLD THEN RETURN;

    920  4 000002   000000 234000 xsym               SZN     EL_THRESHOLD
         4 000003   000005 604000 4                  TMI     s:923

    920  4 000004   000000 702200 xent               TSX2  ! X66_ARET

      134      921                /* Check for status = standby or out of paper/cards.  Don't bother
      135      922                   thresholding for these statuses.                 */
      136      923    2           IF IOERR.STATUS.MAJOR = 2 THEN DO; /* ATTENTION */

    923  4 000005   200003 470500                    LDP0    @IOERR,,AUTO
         4 000006   000001 236100                    LDQ     1,,PR0
         4 000007   170000 376003                    ANQ     61440,DU
         4 000010   020000 116003                    CMPQ    8192,DU
         4 000011   000050 601000 4                  TNZ     s:936

      137      924    2              IF SUBSTR(IOERR.DEVNM,0,2) = 'DP' AND IOERR.STATUS.MINOR = '20'O

    924  4 000012   000024 220100                    LDX0    20,,PR0
         4 000013   000000 100000 3                  CMPX0   0
         4 000014   000022 601000 4                  TNZ     s:927
         4 000015   000001 236100                    LDQ     1,,PR0
         4 000016   007700 376003                    ANQ     4032,DU
         4 000017   002000 116003                    CMPQ    1024,DU
         4 000020   000022 601000 4                  TNZ     s:927

      138      925    2              THEN RETURN;

    925  4 000021   000000 702200 xent               TSX2  ! X66_ARET

      139      926    2              ELSE
      140      927    2                 IF SUBSTR(IOERR.DEVNM,0,2) = 'MT' AND IOERR.STATUS.MINOR = '04'O

    927  4 000022   000001 100000 3                  CMPX0   1
         4 000023   000031 601000 4                  TNZ     s:930
         4 000024   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:18   
         4 000025   007700 376003                    ANQ     4032,DU
         4 000026   000400 116003                    CMPQ    256,DU
         4 000027   000031 601000 4                  TNZ     s:930

      141      928    2                 THEN RETURN;

    928  4 000030   000000 702200 xent               TSX2  ! X66_ARET

      142      929    2                 ELSE
      143      930    2                    IF (SUBSTR(IOERR.DEVNM,0,2) = 'LP' OR

    930  4 000031   000002 100000 3                  CMPX0   2
         4 000032   000037 600000 4                  TZE     s:930+6
         4 000033   000003 100000 3                  CMPX0   3
         4 000034   000037 600000 4                  TZE     s:930+6
         4 000035   000004 100000 3                  CMPX0   4
         4 000036   000050 601000 4                  TNZ     s:936
         4 000037   000001 236100                    LDQ     1,,PR0
         4 000040   007700 376003                    ANQ     4032,DU
         4 000041   000100 116003                    CMPQ    64,DU
         4 000042   000047 600000 4                  TZE     s:934
         4 000043   000001 236100                    LDQ     1,,PR0
         4 000044   007700 376003                    ANQ     4032,DU
         4 000045   000200 116003                    CMPQ    128,DU
         4 000046   000050 601000 4                  TNZ     s:936

      144      931    2                      SUBSTR(IOERR.DEVNM,0,2) = 'CP' OR
      145      932    2                      SUBSTR(IOERR.DEVNM,0,2) = 'CR') AND
      146      933    2                      (IOERR.STATUS.MINOR = '01'O OR IOERR.STATUS.MINOR = '02'O)
      147      934    2                    THEN RETURN;

    934  4 000047   000000 702200 xent               TSX2  ! X66_ARET

      148      935    2              END;                         /* IF STATUS.MAJOR = ATTENTION */
      149      936    1           IF IOERR.REQID = LAST_REQID

    936  4 000050   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:19   
         4 000051   000102 116000 1                  CMPQ    LAST_REQID
         4 000052   000054 601000 4                  TNZ     s:938

      150      937    1           THEN RETURN;

    937  4 000053   000000 702200 xent               TSX2  ! X66_ARET

      151      938    1           ELSE LAST_REQID = IOERR.REQID;

    938  4 000054   000102 756000 1                  STQ     LAST_REQID

      152      939    1           ERRCODE.CODE=%E$NOENTRY;

    939  4 000055   000010 236000 1                  LDQ     ERRCODE
         4 000056   000000 376000 5                  ANQ     0
         4 000057   000020 276007                    ORQ     16,DL
         4 000060   000010 756000 1                  STQ     ERRCODE

      153      940    1           I$=IOM$(IOERR.IOCHAN.IOM);

    940  4 000061   000005 236100                    LDQ     5,,PR0
         4 000062   000033 772000                    QRL     27
         4 000063   000007 376007                    ANQ     7,DL
         4 000064   000000 471400 xsym               LDP1    B$DS3$
         4 000065   100000 236106                    LDQ     0,QL,PR1
         4 000066   200004 756100                    STQ     I$,,AUTO

      154      941    1           IF I$=ADDR(NIL) THEN GOTO IOM_NAME;

    941  4 000067   000001 116000 xsym               CMPQ    B_VECTNIL+1
         4 000070   000261 600000 4                  TZE     IOM_NAME

      155      942    1           IF IOERR.THRESH.IOM THEN

    942  4 000071   000027 236100                    LDQ     23,,PR0
         4 000072   400000 316007                    CANQ    -131072,DL
         4 000073   000107 600000 4                  TZE     s:944
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:20   

      156      943    1              CALL THRESHOLD(IOM,IOERR.CONNECTS.IOM,IOM_MAGIC,IOM_THRESH) ALTRET(
               943                       IOM_NAME);

    943  4 000074   000001 236000 5                  LDQ     1
         4 000075   200110 756100                    STQ     @MAGIC+1,,AUTO
         4 000076   000002 236000 5                  LDQ     2
         4 000077   200107 756100                    STQ     @CONNECTS+1,,AUTO
         4 000100   200003 236100                    LDQ     @IOERR,,AUTO
         4 000101   000006 036003                    ADLQ    6,DU
         4 000102   200106 756100                    STQ     @TBL+1,,AUTO
         4 000103   200004 236100                    LDQ     I$,,AUTO
         4 000104   200105 756100                    STQ     ERRBUF+61,,AUTO
         4 000105   000365 701000 4                  TSX1    THRESHOLD
         4 000106   000261 702000 4                  TSX2    IOM_NAME

      157      944    1           CHAN$=PINCRW(IOM.CHAN$,SIZEW(CHAN)*IOERR.IOCHAN.CHAN);

    944  4 000107   200003 470500                    LDP0    @IOERR,,AUTO
         4 000110   000005 220100                    LDX0    5,,PR0
         4 000111   000777 360003                    ANX0    511,DU
         4 000112   200004 471500                    LDP1    I$,,AUTO
         4 000113   100003 473500                    LDP3    3,,PR1
         4 000114   000000 636010                    EAQ     0,X0
         4 000115   000022 772000                    QRL     18
         4 000116   000005 402007                    MPY     5,DL
         4 000117   300000 634506                    EPPR4   0,QL,PR3
         4 000120   200005 454500                    STP4    CHAN$,,AUTO

      158      945    1           IF IOERR.THRESH.CHANNEL THEN

    945  4 000121   000027 236100                    LDQ     23,,PR0
         4 000122   200000 316007                    CANQ    65536,DL
         4 000123   000137 600000 4                  TZE     s:947

      159      946    1             CALL THRESHOLD(CHAN$->CHAN,IOERR.CONNECTS.CHANNEL,CHAN_MAGIC,CHAN_THRESH)
               946                       ALTRET(CHAN_NAME);
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:21   

    946  4 000124   000001 236000 5                  LDQ     1
         4 000125   200110 756100                    STQ     @MAGIC+1,,AUTO
         4 000126   000002 236000 5                  LDQ     2
         4 000127   200107 756100                    STQ     @CONNECTS+1,,AUTO
         4 000130   200003 236100                    LDQ     @IOERR,,AUTO
         4 000131   000003 036000 5                  ADLQ    3
         4 000132   200106 756100                    STQ     @TBL+1,,AUTO
         4 000133   200005 236100                    LDQ     CHAN$,,AUTO
         4 000134   200105 756100                    STQ     ERRBUF+61,,AUTO
         4 000135   000365 701000 4                  TSX1    THRESHOLD
         4 000136   000275 702000 4                  TSX2    CHAN_NAME

      160      947    2           IF IOERR.THRESH.MPC THEN DO;

    947  4 000137   200003 470500                    LDP0    @IOERR,,AUTO
         4 000140   000027 236100                    LDQ     23,,PR0
         4 000141   100000 316007                    CANQ    32768,DL
         4 000142   000206 600000 4                  TZE     s:957

      161      948    2              MPC$=CHAN$->CHAN.MPC$;

    948  4 000143   200005 471500                    LDP1    CHAN$,,AUTO
         4 000144   100004 236100                    LDQ     4,,PR1
         4 000145   200006 756100                    STQ     MPC$,,AUTO

      162      949    3              IF MPC$=ADDR(NIL) THEN DO;

    949  4 000146   000001 116000 xsym               CMPQ    B_VECTNIL+1
         4 000147   000173 601000 4                  TNZ     s:955

      163      950    3                 CALL BINCHAR(SUBSTR(MPCMSG.C,11,1),IOERR.IOCHAN.IOM);

    950  4 000150   000005 236100                    LDQ     5,,PR0
         4 000151   000033 772000                    QRL     27
         4 000152   000007 376007                    ANQ     7,DL
         4 000153   000000 235003                    LDA     0,DU
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:22   
         4 000154   200112 757100                    STAQ    TEMP+1,,AUTO
         4 000155   000000 301500                    BTD
         4 000156   200112 000010                    NDSC9   TEMP+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         4 000157   000060 030001 1                  NDSC9   MPCMSG+3                 cn=0,s=nosgn,sf=0,n=1

      164      951    3                 CALL BINCHAR(SUBSTR(MPCMSG.C,22,2),IOERR.IOCHAN.CHAN);

    951  4 000160   000005 236100                    LDQ     5,,PR0
         4 000161   000022 772000                    QRL     18
         4 000162   000777 376007                    ANQ     511,DL
         4 000163   000000 235003                    LDA     0,DU
         4 000164   200112 757100                    STAQ    TEMP+1,,AUTO
         4 000165   000000 301500                    BTD
         4 000166   200112 000010                    NDSC9   TEMP+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         4 000167   000062 630002 1                  NDSC9   MPCMSG+5                 cn=3,s=nosgn,sf=0,n=2

      165      952    3                 FPT_ERRMSG.FIELD1_=VECTOR(MPCMSG);

    952  4 000170   000004 237000 5                  LDAQ    4
         4 000171   000026 757000 1                  STAQ    FPT_ERRMSG+12

      166      953    3                 GOTO PUT_MESSAGE;

    953  4 000172   000336 710000 4                  TRA     PUT_MESSAGE

      167      954    3                 END;
      168      955    2              CALL THRESHOLD(MPC,IOERR.CONNECTS.MPC,MPC_MAGIC,MPC_THRESH) ALTRET(
               955                       MPC_NAME);

    955  4 000173   000001 236000 5                  LDQ     1
         4 000174   200110 756100                    STQ     @MAGIC+1,,AUTO
         4 000175   000002 236000 5                  LDQ     2
         4 000176   200107 756100                    STQ     @CONNECTS+1,,AUTO
         4 000177   200003 236100                    LDQ     @IOERR,,AUTO
         4 000200   000007 036003                    ADLQ    7,DU
         4 000201   200106 756100                    STQ     @TBL+1,,AUTO
         4 000202   200006 236100                    LDQ     MPC$,,AUTO
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:23   
         4 000203   200105 756100                    STQ     ERRBUF+61,,AUTO
         4 000204   000365 701000 4                  TSX1    THRESHOLD
         4 000205   000321 702000 4                  TSX2    MPC_NAME

      169      956    2              END;

      170      957    2           IF IOERR.THRESH.DEVICE THEN DO;

    957  4 000206   200003 470500                    LDP0    @IOERR,,AUTO
         4 000207   000027 236100                    LDQ     23,,PR0
         4 000210   040000 316007                    CANQ    16384,DL
         4 000211   000260 600000 4                  TZE     s:969

      171      958    2              IF CHAN$->CHAN.DEV$=ADDR(NIL) THEN GOTO DEV_NAME;

    958  4 000212   200005 471500                    LDP1    CHAN$,,AUTO
         4 000213   100003 236100                    LDQ     3,,PR1
         4 000214   000001 116000 xsym               CMPQ    B_VECTNIL+1
         4 000215   000330 600000 4                  TZE     DEV_NAME

      172      959    2              DEV$ = CHAN$->CHAN.DEV$;

    959  4 000216   200007 756100                    STQ     DEV$,,AUTO

      173      960    2              CALL M$GDS(FINDSIZE_DS3) ALTRET(DEV_NAME);

    960  4 000217   000002 630400 1                  EPPR0   FINDSIZE_DS3
         4 000220   430001 713400                    CLIMB   alt,gds
         4 000221   400400 401760                    pmme    nvectors=2
         4 000222   000330 702000 4                  TSX2    DEV_NAME

      174      961    3              DO WHILE(DEV.DEVNUM ~= IOERR.IOCHAN.DVN);

    961  4 000223   200007 470500                    LDP0    DEV$,,AUTO
         4 000224   200003 471500                    LDP1    @IOERR,,AUTO
         4 000225   100005 236100                    LDQ     5,,PR1
         4 000226   000036 772000                    QRL     30
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:24   
         4 000227   000005 116100                    CMPQ    5,,PR0
         4 000230   000245 600000 4                  TZE     s:967

      175      962    3                 DEV$ = PINCRW(DEV$,SIZEW(DEV));

    962  4 000231   200007 236100                    LDQ     DEV$,,AUTO
         4 000232   000020 036003                    ADLQ    16,DU
         4 000233   200007 756100                    STQ     DEV$,,AUTO

      176      963    3                 IF DEVPTR.OFFSET > DS3_VECTOR.W1.VSIZE# THEN GOTO DEV_NAME;

    963  4 000234   000000 220000 1                  LDX0    DS3_VECTOR
         4 000235   200007 100100                    CMPX0   DEV$,,AUTO
         4 000236   000330 602000 4                  TNC     DEV_NAME

      177      964                       /* if the pointer offset is greater than the size of the
      178      965                          data segment bound, we did NOT find the device!!        */
      179      966    3                 END;                      /* DO WHILE */

    966  4 000237   200007 470500                    LDP0    DEV$,,AUTO
         4 000240   200003 471500                    LDP1    @IOERR,,AUTO
         4 000241   100005 236100                    LDQ     5,,PR1
         4 000242   000036 772000                    QRL     30
         4 000243   000005 116100                    CMPQ    5,,PR0
         4 000244   000231 601000 4                  TNZ     s:962

      180      967    2              CALL THRESHOLD(DEV,IOERR.CONNECTS.DEVICE,DEV_MAGIC,DEV_THRESH) ALTRET(
               967                       DEV_NAME);

    967  4 000245   000001 236000 5                  LDQ     1
         4 000246   200110 756100                    STQ     @MAGIC+1,,AUTO
         4 000247   000002 236000 5                  LDQ     2
         4 000250   200107 756100                    STQ     @CONNECTS+1,,AUTO
         4 000251   200003 236100                    LDQ     @IOERR,,AUTO
         4 000252   000006 036000 5                  ADLQ    6
         4 000253   200106 756100                    STQ     @TBL+1,,AUTO
         4 000254   200007 236100                    LDQ     DEV$,,AUTO
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:25   
         4 000255   200105 756100                    STQ     ERRBUF+61,,AUTO
         4 000256   000365 701000 4                  TSX1    THRESHOLD
         4 000257   000330 702000 4                  TSX2    DEV_NAME

      181      968    2              END;

      182      969    1           RETURN;

    969  4 000260   000000 702200 xent               TSX2  ! X66_ARET

    967  4 000261                       IOM_NAME     null
      183      970        /**/
      184      971    1   IOM_NAME: ;
      185      972    1           CALL BINCHAR(SUBSTR(IOMMSG.C,4,1),IOERR.IOCHAN.IOM);

    972  4 000261   200003 470500                    LDP0    @IOERR,,AUTO
         4 000262   000005 236100                    LDQ     5,,PR0
         4 000263   000033 772000                    QRL     27
         4 000264   000007 376007                    ANQ     7,DL
         4 000265   000000 235003                    LDA     0,DU
         4 000266   200112 757100                    STAQ    TEMP+1,,AUTO
         4 000267   000000 301500                    BTD
         4 000270   200112 000010                    NDSC9   TEMP+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         4 000271   000045 230001 1                  NDSC9   IOMMSG+1                 cn=1,s=nosgn,sf=0,n=1

      186      973    1           FPT_ERRMSG.FIELD1_=VECTOR(IOMMSG);

    973  4 000272   000010 237000 5                  LDAQ    8
         4 000273   000026 757000 1                  STAQ    FPT_ERRMSG+12

      187      974    1           GOTO PUT_MESSAGE;

    974  4 000274   000336 710000 4                  TRA     PUT_MESSAGE

    973  4 000275                       CHAN_NAME    null
      188      975    1   CHAN_NAME: ;
      189      976    1           CALL BINCHAR(SUBSTR(CHANMSG.C,4,1),IOERR.IOCHAN.IOM);
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:26   

    976  4 000275   200003 470500                    LDP0    @IOERR,,AUTO
         4 000276   000005 236100                    LDQ     5,,PR0
         4 000277   000033 772000                    QRL     27
         4 000300   000007 376007                    ANQ     7,DL
         4 000301   000000 235003                    LDA     0,DU
         4 000302   200112 757100                    STAQ    TEMP+1,,AUTO
         4 000303   000000 301500                    BTD
         4 000304   200112 000010                    NDSC9   TEMP+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         4 000305   000047 230001 1                  NDSC9   CHANMSG+1                cn=1,s=nosgn,sf=0,n=1

      190      977    1           CALL BINCHAR(SUBSTR(CHANMSG.C,15,2),IOERR.IOCHAN.CHAN);

    977  4 000306   000005 236100                    LDQ     5,,PR0
         4 000307   000022 772000                    QRL     18
         4 000310   000777 376007                    ANQ     511,DL
         4 000311   000000 235003                    LDA     0,DU
         4 000312   200112 757100                    STAQ    TEMP+1,,AUTO
         4 000313   000000 301500                    BTD
         4 000314   200112 000010                    NDSC9   TEMP+1,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         4 000315   000052 030002 1                  NDSC9   CHANMSG+4                cn=0,s=nosgn,sf=0,n=2

      191      978    1           FPT_ERRMSG.FIELD1_=VECTOR(CHANMSG);

    978  4 000316   000012 237000 5                  LDAQ    10
         4 000317   000026 757000 1                  STAQ    FPT_ERRMSG+12

      192      979    1           GOTO PUT_MESSAGE;

    979  4 000320   000336 710000 4                  TRA     PUT_MESSAGE

    978  4 000321                       MPC_NAME     null
      193      980    1   MPC_NAME: ;
      194      981    1           DEVMSG.C=MPC.DEVNM;

    981  4 000321   200006 470500                    LDP0    MPC$,,AUTO
         4 000322   040000 100500                    MLR     fill='040'O
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:27   
         4 000323   000003 000004                    ADSC9   3,,PR0                   cn=0,n=4
         4 000324   000053 200004 1                  ADSC9   DEVMSG                   cn=1,n=4

      195      982    1           FPT_ERRMSG.FIELD1_=VECTOR(DEVMSG);

    982  4 000325   000014 237000 5                  LDAQ    12
         4 000326   000026 757000 1                  STAQ    FPT_ERRMSG+12

      196      983    1           GOTO PUT_MESSAGE;

    983  4 000327   000336 710000 4                  TRA     PUT_MESSAGE

    982  4 000330                       DEV_NAME     null
      197      984    1   DEV_NAME: ;
      198      985    1           DEVMSG.C=IOERR.DEVNM;

    985  4 000330   200003 470500                    LDP0    @IOERR,,AUTO
         4 000331   040000 100500                    MLR     fill='040'O
         4 000332   000024 000004                    ADSC9   20,,PR0                  cn=0,n=4
         4 000333   000053 200004 1                  ADSC9   DEVMSG                   cn=1,n=4

      199      986    1           FPT_ERRMSG.FIELD1_=VECTOR(DEVMSG);

    986  4 000334   000014 237000 5                  LDAQ    12
         4 000335   000026 757000 1                  STAQ    FPT_ERRMSG+12

    986  4 000336                       PUT_MESSAGE  null
      200      987    1   PUT_MESSAGE: ;
      201      988    1           FPT_ERRMSG.BUF_=VECTOR(ERRBUF);

    988  4 000336   000007 235000 5                  LDA     7
         4 000337   200112 452500                    STP2    TEMP+1,,AUTO
         4 000340   200112 236100                    LDQ     TEMP+1,,AUTO
         4 000341   000010 036003                    ADLQ    8,DU
         4 000342   000016 757000 1                  STAQ    FPT_ERRMSG+4

      202      989    1           CALL M$ERRMSG(FPT_ERRMSG) ALTRET(BAG_IT);
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:28   

    989  4 000343   000012 630400 1                  EPPR0   FPT_ERRMSG
         4 000344   420000 713400                    CLIMB   alt,+8192
         4 000345   405000 401760                    pmme    nvectors=11
         4 000346   000364 702000 4                  TSX2    BAG_IT

      203      990    2           IF B$JIT.MODE = %M_GHOST# THEN DO;

    990  4 000347   000000 470400 xsym               LDP0    B$JIT$
         4 000350   000000 236100                    LDQ     0,,PR0
         4 000351   740000 376003                    ANQ     -16384,DU
         4 000352   100000 116003                    CMPQ    32768,DU
         4 000353   000364 601000 4                  TNZ     BAG_IT

      204      991    2              FPT_KEYIN.MESS_=VECTOR(ERRBUF.B1);

    991  4 000354   000016 235000 5                  LDA     14
         4 000355   200112 452500                    STP2    TEMP+1,,AUTO
         4 000356   200112 236100                    LDQ     TEMP+1,,AUTO
         4 000357   000010 036003                    ADLQ    8,DU
         4 000360   000066 757000 1                  STAQ    FPT_KEYIN+2

      205      992    2              CALL M$KEYIN(FPT_KEYIN);

    992  4 000361   000064 630400 1                  EPPR0   FPT_KEYIN
         4 000362   120000 713400                    CLIMB   40960
         4 000363   401400 401760                    pmme    nvectors=4

      206      993    2              END;

      207      994    1   BAG_IT: RETURN;

    994  4 000364   000000 702200 xent  BAG_IT       TSX2  ! X66_ARET

      208      995        %EJECT;
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:29   
      209      996    1   THRESHOLD: PROC(TBL,CONNECTS,MAGIC,THRESH) ALTRET;

    996  4 000365   200104 741300       THRESHOLD    STX1  ! ERRBUF+60,,AUTO

      210      997        /****** WHAT SOME OF THESE THINGS MEAN *********
      211      998             MAGIC - weight factor
      212      999             TBL.RATE - current weighted error rate - connects/error
      213     1000             TBL.THRESH_RATE - value that TBL.THRESH must exceed to have an error
      214     1001                               reported.  This value is settable via SYSCON.
      215     1002             TBL.THRESH - number of times this component has exceeded TBL.THRESH_RATE
      216     1003             THRESH - component must exceed TBL.THRESH_RATE THRESH times for a
      217     1004                      message to be output.
      218     1005        *********************************************************************/
      219     1006    2   DCL 1 TBL ALIGNED,
      220     1007    2         2 RATE UBIN,
      221     1008    2         2 NUM UBIN HALF UNAL,
      222     1009    2         2 THRESH UBIN HALF UNAL,
      223     1010    2         2 THRESH_RATE UBIN;
      224     1011    2   DCL CONNECTS UBIN HALF HALIGNED;
      225     1012    2   DCL MAGIC UBIN;
      226     1013    2   DCL THRESH UBIN WORD;
      227     1014    2   DCL TEMP UBIN;
      228     1015        /**/
      229     1016    2           IF TBL.NUM<MAGIC THEN TEMP=TBL.NUM;

   1016  4 000366   200107 470500                    LDP0    @MAGIC,,AUTO
         4 000367   200105 471500                    LDP1    @TBL,,AUTO
         4 000370   100001 236100                    LDQ     1,,PR1
         4 000371   000022 772000                    QRL     18
         4 000372   000000 116100                    CMPQ    0,,PR0
         4 000373   000376 603000 4                  TRC     s:1017

   1016  4 000374   200111 756100                    STQ     TEMP,,AUTO
         4 000375   000400 710000 4                  TRA     s:1018

      230     1017    2           ELSE TEMP=MAGIC;

PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:30   
   1017  4 000376   000000 235100                    LDA     0,,PR0
         4 000377   200111 755100                    STA     TEMP,,AUTO

      231     1018    2           TBL.NUM=TBL.NUM+1;

   1018  4 000400   100001 220100                    LDX0    1,,PR1
         4 000401   000001 622010                    EAX2    1,X0
         4 000402   100001 742100                    STX2    1,,PR1

      232     1019    2           TBL.RATE=(TBL.RATE*TEMP+CONNECTS)/(TEMP+1);

   1019  4 000403   100000 236100                    LDQ     0,,PR1
         4 000404   200111 402100                    MPY     TEMP,,AUTO
         4 000405   200106 473500                    LDP3    @CONNECTS,,AUTO
         4 000406   000100 101500                    MRL     fill='000'O
         4 000407   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2
         4 000410   200112 000004                    ADSC9   TEMP+1,,AUTO             cn=0,n=4
         4 000411   200112 036100                    ADLQ    TEMP+1,,AUTO
         4 000412   200111 235100                    LDA     TEMP,,AUTO
         4 000413   000001 035007                    ADLA    1,DL
         4 000414   200113 755100                    STA     TEMP+2,,AUTO
         4 000415   000000 116003                    CMPQ    0,DU
         4 000416   000434 605000 4                  TPL     s:1019+25
         4 000417   000000 115003                    CMPA    0,DU
         4 000420   000430 604000 4                  TMI     s:1019+21
         4 000421   000001 115007                    CMPA    1,DL
         4 000422   000441 600000 4                  TZE     s:1019+30
         4 000423   000000 235003                    LDA     0,DU
         4 000424   000001 737000                    LLS     1
         4 000425   200113 507100                    DVF     TEMP+2,,AUTO
         4 000426   000044 733000                    LRS     36
         4 000427   000441 710000 4                  TRA     s:1019+30
         4 000430   200113 116100                    CMPQ    TEMP+2,,AUTO
         4 000431   000436 602000 4                  TNC     s:1019+27
         4 000432   000001 236007                    LDQ     1,DL
         4 000433   000441 710000 4                  TRA     s:1019+30
         4 000434   000000 115003                    CMPA    0,DU
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:31   
         4 000435   000440 605000 4                  TPL     s:1019+29
         4 000436   000000 236003                    LDQ     0,DU
         4 000437   000441 710000 4                  TRA     s:1019+30
         4 000440   200113 506100                    DIV     TEMP+2,,AUTO
         4 000441   100000 756100                    STQ     0,,PR1

      233     1020    3           IF TBL.RATE<TBL.THRESH_RATE AND TBL.NUM>MAGIC THEN DO;

   1020  4 000442   100002 116100                    CMPQ    2,,PR1
         4 000443   000474 603000 4                  TRC     s:1030
         4 000444   100001 236100                    LDQ     1,,PR1
         4 000445   000022 772000                    QRL     18
         4 000446   000000 116100                    CMPQ    0,,PR0
         4 000447   000474 602000 4                  TNC     s:1030
         4 000450   000474 600000 4                  TZE     s:1030

      234     1021    3              TBL.THRESH=TBL.THRESH+1;

   1021  4 000451   100001 720100                    LXL0    1,,PR1
         4 000452   000001 621010                    EAX1    1,X0
         4 000453   100001 441100                    SXL1    1,,PR1

      235     1022    4              IF TBL.THRESH > THRESH THEN DO;

   1022  4 000454   200110 474500                    LDP4    @THRESH,,AUTO
         4 000455   100001 236100                    LDQ     1,,PR1
         4 000456   777777 376007                    ANQ     -1,DL
         4 000457   400000 116100                    CMPQ    0,,PR4
         4 000460   000476 602000 4                  TNC     s:1031
         4 000461   000476 600000 4                  TZE     s:1031

      236     1023    4                 TBL.RATE = 0;

   1023  4 000462   100000 450100                    STZ     0,,PR1

      237     1024    4                 TBL.NUM = 0;

PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:32   
   1024  4 000463   000000 220003                    LDX0    0,DU
         4 000464   100001 740100                    STX0    1,,PR1

      238     1025    4                 TBL.THRESH = 0;

   1025  4 000465   100001 440100                    SXL0    1,,PR1

      239     1026    4                 ERRCODE.CODE=%E$THRESH;

   1026  4 000466   000010 236000 1                  LDQ     ERRCODE
         4 000467   000000 376000 5                  ANQ     0
         4 000470   000010 276007                    ORQ     8,DL
         4 000471   000010 756000 1                  STQ     ERRCODE

      240     1027    4                 ALTRETURN;

   1027  4 000472   200104 221300                    LDX1  ! ERRBUF+60,,AUTO
         4 000473   000000 702211                    TSX2  ! 0,X1

      241     1028    4                 END;
      242     1029    3              END;
      243     1030    2           ELSE TBL.THRESH=0;

   1030  4 000474   000000 220003                    LDX0    0,DU
         4 000475   100001 440100                    SXL0    1,,PR1

      244     1031    2           RETURN;

   1031  4 000476   200104 221300                    LDX1  ! ERRBUF+60,,AUTO
         4 000477   000001 702211                    TSX2  ! 1,X1
      245     1032    2   END THRESHOLD;
      246     1033    1   END ELT$THRESH;
      247     1034        %EOD;

PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:33   
--  Include file information  --

   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   EL_PERR_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ELT$THRESH.
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:34   

 **** Variables and constants ****

  ****  Section 001  Data  ELT$THRESH

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    46-0-0/w STRC(162)   r     1 CHANMSG                   53-0-0/w STRC(45)    r     1 DEVMSG
     0-0-0/d STRC(72)    r     1 DS3_VECTOR                10-0-0/w STRC        r     1 ERRCODE
     2-0-0/d STRC(216)   r     1 FINDSIZE_DS3              12-0-0/d STRC(936)   r     1 FPT_ERRMSG
    64-0-0/d STRC(504)   r     1 FPT_KEYIN                 44-0-0/w STRC(54)    r     1 IOMMSG
   102-0-0/w UBIN        r     1 LAST_REQID                55-0-0/w STRC(225)   r     1 MPCMSG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   106-0-0/w PTR         r     1 @CONNECTS                  3-0-0/w PTR         r     1 @IOERR
   107-0-0/w PTR         r     1 @MAGIC                   105-0-0/w PTR         r     1 @TBL
   110-0-0/w PTR         r     1 @THRESH                    5-0-0/w PTR         r     1 CHAN$
    *0-0-0/h UBIN(18)    r     1 CONNECTS                   7-0-0/w PTR         r     1 DEV$
     7-0-0/w STRC        r     1 DEVPTR                    10-0-0/w STRC(2160)  r     1 ERRBUF
     4-0-0/w PTR         r     1 I$                        *0-0-0/w STRC(1080)  r     1 IOERR
    *0-0-0/w UBIN        r     1 MAGIC                      6-0-0/w PTR         r     1 MPC$
    *0-0-0/w STRC(108)   r     1 TBL                      111-0-0/w UBIN        r     1 TEMP
    *0-0-0/w UBIN        r     1 THRESH

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS3$                     0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w BIT         r     1 EL_THRESHOLD

  ****  BASED and DCB variables  ****
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:35   

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(180)   r     1 CHAN
     0-0-0/w STRC(576)   r     1 DEV                        0-0-0/w STRC(144)   r     1 IOM
     0-0-0/w PTR         r     1 IOM$(0:7)                  0-0-0N  NULL        r     1 M$DO
     0-0-0/w STRC(180)   r     1 MPC


   Procedure ELT$THRESH requires 320 words for executable code.
   Procedure ELT$THRESH requires 76 words of local(AUTO) storage.
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:36   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:37   
          MINI XREF LISTING

B$DS3$
       344**DCL       345--IMP-PTR   940>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       736**DCL       736--REDEF
B$JIT.ERR.MID
       643**DCL       643--REDEF
B$JIT.JRESPEAK
       804**DCL       805--REDEF
B$JIT.MODE
       637**DCL       990>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
       913**DCL       913--REDEF     914--REDEF
B$JIT.PNR
       817**DCL       817--REDEF
B$JIT.TSLINE
       911**DCL       912--REDEF
B$JIT$
       627**DCL       637--IMP-PTR   990>>IF
BAG_IT
       994**LABEL     989--CALLALT
CHAN
       357**DCL       944--ASSIGN    946<>CALL
CHAN.DEV$
       362**DCL       958>>IF        959>>ASSIGN
CHAN.MPC$
       363**DCL       948>>ASSIGN
CHAN$
       356**DCL       944<<ASSIGN    946>>CALL      948>>ASSIGN    958>>IF        959>>ASSIGN
CHANMSG
       590**DCL       978--ASSIGN
CHANMSG.C
       592**DCL       976<<CALLBLT   977<<CALLBLT
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:38   
CHAN_NAME
       973**LABEL     946--CALLALT
CONNECTS IN PROCEDURE THRESHOLD
      1011**DCL       996--PROC     1019>>ASSIGN
DEV
       376**DCL       962--ASSIGN    967<>CALL
DEV.DEVNUM
       382**DCL       961>>DOWHILE
DEV$
       371**DCL       372--REDEF     376--IMP-PTR   959<<ASSIGN    961>>DOWHILE   962<<ASSIGN    962>>ASSIGN
       967>>CALL
DEVMSG
       595**DCL       982--ASSIGN    986--ASSIGN
DEVMSG.C
       597**DCL       981<<ASSIGN    985<<ASSIGN
DEVPTR.OFFSET
       373**DCL       963>>IF
DEV_NAME
       982**LABEL     958--GOTO      960--CALLALT   963--GOTO      967--CALLALT
DS3_VECTOR
       512**DCL       537--DCLINIT
DS3_VECTOR.W1.VSIZE#
       514**DCL       963>>IF
DS3_VECTOR.W2
       519**DCL       523--REDEF
EL_THRESHOLD
       343**DCL       920>>IF
ERRBUF
       604**DCL       988--ASSIGN
ERRBUF.B1
       605**DCL       991--ASSIGN
ERRCODE
       543**DCL       563--DCLINIT
ERRCODE.CODE
       546**DCL       939<<ASSIGN   1026<<ASSIGN
FINDSIZE_DS3
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:39   
       537**DCL       960<>CALL
FINDSIZE_DS3.V
       537**DCL       537--DCLINIT
FPT_ERRMSG
       563**DCL       989<>CALL
FPT_ERRMSG.BUF_
       563**DCL       988<<ASSIGN
FPT_ERRMSG.FIELD1_
       565**DCL       952<<ASSIGN    973<<ASSIGN    978<<ASSIGN    982<<ASSIGN    986<<ASSIGN
FPT_ERRMSG.V
       567**DCL       563--DCLINIT
FPT_KEYIN
       618**DCL       992<>CALL
FPT_KEYIN.MESS_
       618**DCL       991<<ASSIGN
FPT_KEYIN.V
       621**DCL       618--DCLINIT
I$
       349**DCL       350--IMP-PTR   940<<ASSIGN    941>>IF        943>>CALL      944>>ASSIGN
IOERR
       333**DCL         8--PROC
IOERR.CONNECTS.CHANNEL
       336**DCL       946<>CALL
IOERR.CONNECTS.DEVICE
       336**DCL       967<>CALL
IOERR.CONNECTS.IOM
       336**DCL       943<>CALL
IOERR.CONNECTS.MPC
       336**DCL       955<>CALL
IOERR.DEVNM
       338**DCL       924>>IF        927>>IF        930>>IF        930>>IF        930>>IF        985>>ASSIGN
IOERR.IOCHAN.CHAN
       335**DCL       944>>ASSIGN    951>>CALLBLT   977>>CALLBLT
IOERR.IOCHAN.DVN
       335**DCL       961>>DOWHILE
IOERR.IOCHAN.IOM
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:40   
       335**DCL       940>>ASSIGN    950>>CALLBLT   972>>CALLBLT   976>>CALLBLT
IOERR.REQID
       333**DCL       936>>IF        938>>ASSIGN
IOERR.SEEK
       337**DCL       338--REDEF
IOERR.STATUS
       333**DCL       334--REDEF
IOERR.STATUS.MAJOR
       333**DCL       923>>IF
IOERR.STATUS.MINOR
       333**DCL       924>>IF        927>>IF        930>>IF        930>>IF
IOERR.THRESH.CHANNEL
       339**DCL       945>>IF
IOERR.THRESH.DEVICE
       339**DCL       957>>IF
IOERR.THRESH.IOM
       338**DCL       942>>IF
IOERR.THRESH.MPC
       339**DCL       947>>IF
IOM
       350**DCL       943<>CALL
IOM.CHAN$
       355**DCL       944>>ASSIGN
IOM$
       345**DCL       940>>ASSIGN
IOMMSG
       585**DCL       973--ASSIGN
IOMMSG.C
       587**DCL       972<<CALLBLT
IOM_NAME
       967**LABEL     941--GOTO      943--CALLALT
LAST_REQID
       626**DCL       936>>IF        938<<ASSIGN
M$ERRMSG
       502**DCL-ENT   989--CALL
M$GDS
PL6.E3A0      #001=ELT$THRESH File=ELT$THRESH.:E05TSI                            TUE 07/29/97 15:19 Page:41   
       474**DCL-ENT   960--CALL
M$KEYIN
       444**DCL-ENT   992--CALL
MAGIC IN PROCEDURE THRESHOLD
      1012**DCL       996--PROC     1016>>IF       1017>>ASSIGN   1020>>IF
MPC
       365**DCL       955<>CALL
MPC.DEVNM
       370**DCL       981>>ASSIGN
MPC$
       364**DCL       365--IMP-PTR   948<<ASSIGN    949>>IF        955>>CALL      981>>ASSIGN
MPCMSG
       600**DCL       952--ASSIGN
MPCMSG.C
       602**DCL       950<<CALLBLT   951<<CALLBLT
MPC_NAME
       978**LABEL     955--CALLALT
PUT_MESSAGE
       986**LABEL     953--GOTO      974--GOTO      979--GOTO      983--GOTO
TBL IN PROCEDURE THRESHOLD
      1006**DCL       996--PROC
TBL.NUM IN PROCEDURE THRESHOLD
      1008**DCL      1016>>IF       1016>>ASSIGN   1018<<ASSIGN   1018>>ASSIGN   1020>>IF       1024<<ASSIGN
TBL.RATE IN PROCEDURE THRESHOLD
      1007**DCL      1019<<ASSIGN   1019>>ASSIGN   1020>>IF       1023<<ASSIGN
TBL.THRESH IN PROCEDURE THRESHOLD
      1009**DCL      1021<<ASSIGN   1021>>ASSIGN   1022>>IF       1025<<ASSIGN   1030<<ASSIGN
TBL.THRESH_RATE IN PROCEDURE THRESHOLD
      1010**DCL      1020>>IF
TEMP IN PROCEDURE THRESHOLD
      1014**DCL      1016<<ASSIGN   1017<<ASSIGN   1019>>ASSIGN   1019>>ASSIGN
THRESH IN PROCEDURE THRESHOLD
      1013**DCL       996--PROC     1022>>IF
THRESHOLD
       996**PROC      943--CALL      946--CALL      955--CALL      967--CALL

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:42   
      248        1        /*T***********************************************************/
      249        2        /*T*                                                         */
      250        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      251        4        /*T*                                                         */
      252        5        /*T***********************************************************/
      253        6        ELT$INIT: PROC;
      254        7        %INCLUDE CP_6;
      255       88        %F$DCB;
      256      145        %FPT_GETDCB (FPTN=FPT_GETDCB,
      257      146                     DCBNUM=FPT_OPEN_CONFIG.V.DCB#);
      258      161        %FPT_OPEN (FPTN=FPT_OPEN_CONFIG,
      259      162                   NAME=VLP_NAME_CONFIG,
      260      163                   ACCT=VLP_ACCT_SYS,
      261      164                   ASN=FILE,
      262      165                   FUN=IN,
      263      166                   SHARE=ALL);
      264      275        %VLP_NAME (FPTN=VLP_NAME_CONFIG,
      265      276                   NAME=':CONFIG');
      266      303        %VLP_ACCT (FPTN=VLP_ACCT_SYS,
      267      304                   ACCT=':SYS');
      268      317        %FPT_CLOSE (FPTN=EL_CLOSE_CONFIG,STCLASS="STATIC SYMDEF",
      269      318                    DISP=SAVE);
      270      360        %FPT_GDS (FPTN=FPT_GDS,
      271      361                  SEGSIZE=1024);
      272      377        %FPT_READ (FPTN=FPT_READ,
      273      378                   KEYS=YES);
      274      417        %FPT_ERRMSG (FPTN=FPT_ERRMSG,
      275      418                     INCLCODE=NO,
      276      419                     OUTDCB1=M$DO,
      277      420                     SUBMESS=YES);
      278      447        %FPT_KEYIN (FPTN=FPT_KEYIN);
      279      466        %FPT_OPEN (FPTN=CREATE_ELF_DATA,
      280      467                   DCB=M$ELF_DATA,
      281      468                   FUN=CREATE,
      282      469                   EXIST=NEWFILE,
      283      470                   ACSVEH=ELF_DATA_ATTR,
      284      471                   ORG=RANDOM,
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:43   
      285      472                   SHARE=IN,
      286      473                   ASN=FILE,
      287      474                   ACS=DS3,
      288      475                   CTG=YES,
      289      476                   ACCT=VLP_ACCT_SYS,
      290      477                   NAME=VLP_NAME);
      291      586        %FPT_OPEN (FPTN=UPDATE_ELF_DATA,
      292      587                   DCB=M$ELF_DATA,
      293      588                   FUN=UPDATE,
      294      589                   ORG=RANDOM,
      295      590                   SHARE=IN,
      296      591                   ASN=FILE,
      297      592                   ACS=DS3,
      298      593                   CTG=YES,
      299      594                   ACCT=VLP_ACCT_SYS,
      300      595                   NAME=VLP_NAME);
      301      704        %FPT_MONINFO (FPTN=BOOTFLAG,
      302      705                MONINFO=MONINFO);
      303      720        %VLR_MONINFO (FPTN=MONINFO);
      304      738        /**/
      305      739        %VLP_ATTR(FPTN=ELF_DATA_ATTR);
      306      753        %VLP_ACSVEH (READ=YES, VEHICLE='SYSCON', LAST=";");
      307      770        %FPT_CLOSE (FPTN=CLOSE_ELF_DATA,
      308      771                    DISP=SAVE,
      309      772                    DCB=M$ELF_DATA);
      310      814        %VLP_NAME (NAME='ELF_DATA');
      311      841        %FPT_EXTEND (DCB=M$ELF_DATA,
      312      842                     SIZ=1);
      313      856    1   DCL ERRCODE BIT(36);
      314      857    1   DCL 1 ERRCODE2 REDEF ERRCODE,
      315      858    1         2 FCG BIT(18) UNAL,
      316      859    1         2 MON BIT(1) UNAL,
      317      860    1         2 CODE UBIN(14) UNAL,
      318      861    1         2 SEV UBIN(3) UNAL;
      319      862    1   DCL 1 ERRBUF ALIGNED,
      320      863    1         2 B1 CHAR(120),
      321      864    1         2 B2 CHAR(120);
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:44   
      322      865    1   DCL M$ELF_DATA DCB;
      323      866    1   DCL M$DO DCB;
      324      867    1   DCL B$TCB$ PTR SYMREF;
      325      868    1   DCL B$DS3$ PTR SYMREF;
      326      869    1   DCL B$DS4$ PTR SYMREF;
      327      870        %B$TCB;
      328      873        %B$ALT;
      329      881        %INCLUDE B_ERRORS_C;
      330     2008        %FPT_RELDCB (FPTN=FPT_RELDCB);
      331     2022    1   DCL EL_THRESHOLD BIT(1) ALIGNED STATIC SYMDEF INIT('0'B);
      332     2023    1   DCL EL_SNAPFLG BIT(1) ALIGNED SYMREF;
      333     2024    1   DCL TABLE$ PTR;
      334     2025    1   DCL 1 WORKSEG STATIC DALIGNED,
      335     2026    1         2 BOUND UBIN(20) UNAL,
      336     2027    1         2 * BIT(16) UNAL,
      337     2028    1         2 PTR$ PTR;
      338     2029    1   DCL WORK$ PTR;
      339     2030    1   DCL HEAD$ PTR;
      340     2031    1   DCL IOM$(0:7) PTR BASED(B$DS3$);
      341     2032    1   DCL IOMR$ PTR;
      342     2033    1   DCL MPCR$ PTR;
      343     2034    1   DCL MPC$ PTR;
      344     2035    1   DCL DEVR$ PTR;
      345     2036    1   DCL DEV$ PTR;
      346     2037    1   DCL T$ PTR;
      347     2038    1   DCL P$ PTR;
      348     2039    1   DCL IOM_ENTRY$ PTR;                     /* PTR TO IOM ENTRY IN ELF_DATA */
      349     2040    1   DCL I SBIN;
      350     2041    1   DCL J SBIN;
      351     2042    1   DCL WORDS_USED SBIN WORD STATIC;
      352     2043    1   DCL GRAN# UBIN WORD STATIC;
      353     2044        %SUB WORDS_PER_GRAN = 1024;
      354     2045    1   DCL BAD_RETURN REMEMBER;
      355     2046    1   DCL NUMDEVS SBIN;
      356     2047    1   DCL DCB$ PTR;
      357     2048    1   DCL DEVNM CHAR(8);
      358     2049    1   DCL B$JIT$ PTR SYMREF;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:45   
      359     2050        %INCLUDE B$JIT;
      360     2340        %INCLUDE IT_SUBS_C;
      361     2607        %INCLUDE NI$TABLES ;
      362     2823        %INCLUDE I_SUBS_C;                      /* has boot flags equs */
      363     2847        /**/
      364     2848        %INCLUDE EL_PERR_C;
      365     2861        /*E*    ERROR:   ELT-E$BAD_DATA
      366     2862                MESSAGE: ELF_DATA IS BAD - REBUILD HAS BEEN INITIATED
      367     2863                DESCRIPTION:  The data in ELF's data segment is not as expected.
      368     2864                              Thresholding information has been lost.
      369     2865                              ELF_DATA will be rebuilt from the current configuration.
      370     2866        */
      371     2867        %INCLUDE TD$STRUCT;
      372     2968        %TD$HEAD (NAME=TD$HEAD,STCLASS="BASED(HEAD$)");
      373     3004        %TD$IOM (NAME=TD$IOM,STCLASS="BASED(IOMR$)");
      374     3012        %TD$MPC (NAME=TD$MPC,STCLASS="BASED(MPCR$)");
      375     3034        %TD$DEV (NAME=TD$DEV,STCLASS="BASED(DEVR$)");
      376     3053        /**/
      377     3054        %MACRO KEY (NAME=JUNK,KEY="' '");
      378     3055        DCL 1 NAME STATIC ALIGNED,
      379     3056              2 L UBIN BYTE UNAL INIT(SIZEC(KEY)),
      380     3057              2 C CHAR(0) INIT(KEY);
      381     3058        %MEND;
      382     3059        %KEY (NAME=HEADKEY,KEY="%BINASC(0)");
      383     3064        %KEY (NAME=IOMKEY,KEY='IOM0');
      384     3069        %KEY (NAME=DEVKEY,KEY='YYNNDDDD');
      385     3074        /**/
      386     3075    1   DCL 1 IOM BASED ALIGNED,
      387     3076    1         2 ERR_RATE UBIN,
      388     3077    1         2 NUM_ENTRIES UBIN HALF UNAL,
      389     3078    1         2 THRESH UBIN HALF UNAL,
      390     3079    1         2 THRESH_RATE UBIN,
      391     3080    1         2 CHAN$ PTR;
      392     3081    1   DCL 1 CHAN(0:0) BASED ALIGNED,
      393     3082    1         2 ERR_RATE UBIN,
      394     3083    1         2 NUM_ENTRIES UBIN HALF UNAL,
      395     3084    1         2 THRESH UBIN HALF UNAL,
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:46   
      396     3085    1         2 THRESH_RATE UBIN,
      397     3086    1         2 DEV$ PTR,
      398     3087    1         2 MPC$ PTR;
      399     3088    1   DCL 1 MPC BASED(MPC$) ALIGNED,
      400     3089    1         2 ERR_RATE UBIN,
      401     3090    1         2 NUM_ENTRIES UBIN HALF UNAL,
      402     3091    1         2 THRESH UBIN HALF UNAL,
      403     3092    1         2 THRESH_RATE UBIN,
      404     3093    1         2 DEVNM CHAR(8);
      405     3094    1   DCL 1 DEV BASED(DEV$) ALIGNED,
      406     3095    1         2 ERR_RATE UBIN,
      407     3096    1         2 NUM_ENTRIES UBIN HALF UNAL,
      408     3097    1         2 THRESH UBIN HALF UNAL,
      409     3098    1         2 THRESH_RATE UBIN,
      410     3099    1         2 DEVNM CHAR(8),
      411     3100    1         2 DEVNUM UBIN,
      412     3101    1         2 STATS(0:9) UBIN;
      413     3102        %SUB NEVER="WHILE('0'B)";
      414     3103        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:47   
      415     3104        /**/
      416     3105        /* ROUTINE INITIALIZATION */
      417     3106        /**/
      418     3107    1           REMEMBER REPORT_ERR IN BAD_RETURN;
      419     3108    1           CALL M$GETDCB(FPT_GETDCB) ALTRET(REPORT_ERR);
      420     3109    1           DCB$=DCBADDR(FPT_OPEN_CONFIG.V.DCB#);
      421     3110    1           FPT_READ.V.DCB#=FPT_OPEN_CONFIG.V.DCB#;
      422     3111    1           EL_CLOSE_CONFIG.V.DCB#=FPT_OPEN_CONFIG.V.DCB#;
      423     3112    1           FPT_RELDCB.V.DCB#=FPT_OPEN_CONFIG.V.DCB#;
      424     3113    1           CALL M$OPEN(FPT_OPEN_CONFIG) ALTRET(REPORT_ERR);
      425     3114    1           IF DCBADDR(DCBNUM(M$ELF_DATA))->F$DCB.FCD#
      426     3115    1           THEN CALL M$CLOSE(CLOSE_ELF_DATA);
      427     3116        /**/
      428     3117    1           CALL M$MONINFO( BOOTFLAG );
      429     3118    1           IF MONINFO.BOOTFLAG# >= I_DISKBOOT /*7*/
      430     3119    1             OR EL_SNAPFLG THEN
      431     3120    2           DO;                   /* DISK BOOT OR RECOVERY OR SNAP HAS OCCURRED */
      432     3121    2              CALL M$OPEN(UPDATE_ELF_DATA)
      433     3122    3              WHENRETURN DO;               /* CHECK IF ELF_DATA LOOKS GOOD */
      434     3123    3                 IOM_ENTRY$ =B$DS3$;
      435     3124    3                 WORKSEG = '0'B;
      436     3125    3                 WORKSEG.PTR$ = B$DS4$;
      437     3126    3                 CALL GETSPACE(WORKSEG);
      438     3127    3                 WORK$ = WORKSEG.PTR$;
      439     3128    3                 CALL READ(HEADKEY, HEAD$); /* READ HEAD REC FROM :CONFIG */
      440     3129    3                 IOM_ENTRY$ = PINCRW(IOM_ENTRY$, 8);
      441     3130    4                 DO I = 0 TO TD$HEAD.NUMIOMS - 1;
      442     3131    4                    IF IOM$(I) ~= IOM_ENTRY$
      443     3132    5                    THEN DO;
      444     3133    5                       CALL M$CLOSE(CLOSE_ELF_DATA); /* ELF_DATA IS BAD */
      445     3134    5                       ERRCODE2.FCG = '051424'O;
      446     3135    5                       ERRCODE2.MON = '0'B;
      447     3136    5                       ERRCODE2.SEV = 0;
      448     3137    5                       ERRCODE2.CODE = %E$BAD_DATA;
      449     3138    5                       FPT_ERRMSG.CODE_ = VECTOR(ERRCODE);
      450     3139    5                       FPT_ERRMSG.BUF_ = VECTOR(ERRBUF);
      451     3140    5                       CALL M$ERRMSG(FPT_ERRMSG) ALTRET(BAG_IT);
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:48   
      452     3141    6                       IF B$JIT.MODE = %M_GHOST# THEN DO;
      453     3142    6                          FPT_KEYIN.MESS_ = VECTOR(ERRBUF.B1);
      454     3143    6                          CALL M$KEYIN(FPT_KEYIN) ALTRET(BAG_IT);
      455     3144    6                          END;
      456     3145    5                       GOTO BUILD_NEW_ELF_DATA;
      457     3146    5                       END;
      458     3147    4                    IOM_ENTRY$ = PINCRW(IOM_ENTRY$, SIZEW(IOM) + SIZEW(CHAN)*%
              3147                             N_MAXCHANS);
      459     3148    4                    END;                   /* DO I */
      460     3149    3                 EL_THRESHOLD = '1'B;      /* ELF_DATA LOOKS GOOD */
      461     3150    3                 GOTO BAG_IT;
      462     3151    3                 END;                      /* WHEN RETURN */
      463     3152    3              WHENALTRETURN DO;
      464     3153    3                 IF B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE = %E$NOFILE
      465     3154    3                 THEN GOTO BUILD_NEW_ELF_DATA;
      466     3155    3                 ELSE GOTO REPORT_ERR;
      467     3156    3                 END;                      /* WHEN ALTRETURN */
      468     3157    2              END;                         /* DISK BOOT OR RECOVERY */
      469     3158    1   BUILD_NEW_ELF_DATA:
      470     3159                                      /* TAPE BOOT OR ELF_DATA NEEDS TO BE RE-BUILT */
      471     3160    1           CALL M$OPEN(CREATE_ELF_DATA) ALTRET(REPORT_ERR);
      472     3161    1           TABLE$ = B$DS3$;
      473     3162    1           WORKSEG = '0'B;
      474     3163    1           WORKSEG.PTR$ = B$DS4$;
      475     3164    1           CALL GETSPACE(WORKSEG);
      476     3165    1           WORK$=WORKSEG.PTR$;
      477     3166    1           CALL READ(HEADKEY,HEAD$);
      478     3167    1           NUMDEVS=(((DCB$->F$DCB.ARS#+3)/4)-POFFW(ADDR(TD$HEAD.DEVNAME(0)),ADDR(
              3167                    TD$HEAD)))/2;
      479     3168    1           GRAN# = 1;
      480     3169    1           WORDS_USED = 0;
      481     3170    1           CALL GBLK(T$,8);
      482     3171    2           DO I=0 TO 7;
      483     3172    2              IOM$(I)=ADDR(NIL);
      484     3173    2              END;
      485     3174        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:49   
      486     3175        /**/
      487     3176        /* BUILD IOM AND CHANNEL TABLES */
      488     3177        /**/
      489     3178    2           DO I=0 TO TD$HEAD.NUMIOMS-1;
      490     3179    2              CALL BINCHAR(SUBSTR(IOMKEY.C,3,1),I);
      491     3180    2              CALL READ(IOMKEY,IOMR$);
      492     3181    2              CALL GBLK(T$,SIZEW(IOM));
      493     3182    2              IOM$(I)=T$;
      494     3183    2              T$->IOM='0'B;
      495     3184    2              T$->IOM.THRESH_RATE = 1000;
      496     3185    2              CALL GBLK(P$,SIZEW(CHAN)*%N_MAXCHANS);
      497     3186    2              T$->IOM.CHAN$=P$;
      498     3187    3              DO J=0 TO %N_MAXCHANS-1;
      499     3188    3                 P$->CHAN(J)='0'B;
      500     3189    3                 P$->CHAN.THRESH_RATE(J) = 1000;
      501     3190    3                 P$->CHAN.MPC$(J)=ADDR(NIL);
      502     3191    3                 P$->CHAN.DEV$(J)=ADDR(NIL);
      503     3192    3                 END;
      504     3193    2              WORK$=IOMR$;
      505     3194    2              END;
      506     3195        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:50   
      507     3196        /**/
      508     3197        /* BUILD MPC AND DEVICE TABLES */
      509     3198        /**/
      510     3199    1           CALL BLD_MPC(TD$HEAD.UNITMPC_INDX);
      511     3200    1           CALL BLD_MPC(TD$HEAD.TAPEMPC_INDX);
      512     3201    1           CALL BLD_MPC(TD$HEAD.DISKMPC_INDX);
      513     3202    1           CALL BLD_MPC(TD$HEAD.APMPC_INDX);
      514     3203    2           DO I=TD$HEAD.CONSOLE_INDX TO TD$HEAD.CONSOLE_INDX+TD$HEAD.NUMCONSOLES-1;
      515     3204    2              DEVNM=TD$HEAD.DEVNAME(I);
      516     3205    2              CALL BLD_DEV(DEVNM);
      517     3206    2              END;
      518     3207        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:51   
      519     3208        /**/
      520     3209        /* CLEANUP AND RETURN */
      521     3210        /**/
      522     3211    1           CALL M$CLOSE(CLOSE_ELF_DATA);
      523     3212    1           CALL M$OPEN(UPDATE_ELF_DATA) ALTRET(REPORT_ERR);
      524     3213    1           EL_THRESHOLD='1'B;
      525     3214    2           DO NEVER;
      526     3215    2   REPORT_ERR:
      527     3216    2              ERRCODE=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      528     3217    2              FPT_ERRMSG.CODE_=VECTOR(ERRCODE);
      529     3218    2              FPT_ERRMSG.V.DCB#=B$TCB$->B$TCB.ALT$->B$ALT.DCB#;
      530     3219    2              FPT_ERRMSG.BUF_=VECTOR(ERRBUF);
      531     3220    2              CALL M$ERRMSG(FPT_ERRMSG) ALTRET(BAG_IT);
      532     3221    3              IF B$JIT.MODE = %M_GHOST# THEN DO;
      533     3222    3                 FPT_KEYIN.MESS_=VECTOR(ERRBUF.B1);
      534     3223    3                 CALL M$KEYIN(FPT_KEYIN) ALTRET(BAG_IT);
      535     3224    3                 END;
      536     3225    2   BAG_IT:
      537     3226    2              END;
      538     3227    1           FPT_GDS.RESULTS_=VECTOR(WORKSEG);
      539     3228    1           FPT_GDS.V.SEGSIZE#=(WORKSEG.BOUND+1)/4;
      540     3229    1           CALL M$FDS(FPT_GDS) ALTRET(X1);
      541     3230    1   X1:     CALL M$CLOSE(EL_CLOSE_CONFIG) ALTRET(X2);
      542     3231    1   X2:     CALL M$RELDCB(FPT_RELDCB) ALTRET(X3);
      543     3232    1   X3:     RETURN;
      544     3233        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:52   
      545     3234    1   BLD_MPC: PROC(IDX);
      546     3235    2   DCL 1 IDX ALIGNED,
      547     3236    2         2 FIRST UBIN HALF UNAL,
      548     3237    2         2 N UBIN HALF UNAL;
      549     3238    2   DCL LAST UBIN;
      550     3239    2   DCL I SBIN;
      551     3240    2   DCL J SBIN;
      552     3241    2   DCL K SBIN;
      553     3242        /**/
      554     3243        /**/
      555     3244        /**/
      556     3245    2           LAST=IDX.FIRST+IDX.N-1;
      557     3246    3           DO I=IDX.FIRST TO LAST;
      558     3247    3              DEVKEY.C=TD$HEAD.DEVNAME(I);
      559     3248    3              CALL READ(DEVKEY,MPCR$);
      560     3249    3              CALL GBLK(MPC$,SIZEW(MPC));
      561     3250    3              MPC='0'B;
      562     3251    3              MPC.THRESH_RATE = 1000;
      563     3252    3              MPC.DEVNM=DEVKEY.C;
      564     3253    4              DO J=0 TO 7;
      565     3254    5                 IF TD$MPC.IOCHAN.PRESENCE(J) THEN DO;
      566     3255    5                    T$=IOM$(TD$MPC.IOCHAN.IOM(J))->IOM.CHAN$;
      567     3256    6                    DO K=TD$MPC.IOCHAN.LOCHAN(J) TO TD$MPC.IOCHAN.HICHAN(J);
      568     3257    6                       T$->CHAN.MPC$(K)=MPC$;
      569     3258    6                       END;
      570     3259    5                    END;
      571     3260    4                 END;
      572     3261    4              DO J=0 TO TD$MPC.NUMDEVS-1;
      573     3262    4                 CALL BLD_DEV(TD$MPC.DEVNAME(J));
      574     3263    4                 END;
      575     3264    3              WORK$=MPCR$;
      576     3265    3              END;
      577     3266    2           RETURN;
      578     3267    2   END BLD_MPC;
      579     3268        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:53   
      580     3269    1   BLD_DEV: PROC(DEVNM);
      581     3270    2   DCL DEVNM CHAR(8);
      582     3271    2   DCL I SBIN;
      583     3272    2   DCL J SBIN;
      584     3273    2   DCL NEW_DEV BIT(1);
      585     3274        /**/
      586     3275    2           NEW_DEV = '0'B;
      587     3276    3           DO I = 0 TO NUMDEVS;
      588     3277    3              IF TD$HEAD.DEVNAME(I) = DEVNM
      589     3278    3              THEN
      590     3279    4              DO;
      591     3280    4                 CALL INSERT(TD$HEAD.DEVNAME(I),4,4,'DONE');
      592     3281    4                 NEW_DEV = '1'B;
      593     3282    4                 END;
      594     3283    3              END;                         /* DO I = 0 TO NUMDEVS */
      595     3284    2           DEVKEY.C=DEVNM;
      596     3285    2           CALL READ(DEVKEY,DEVR$);
      597     3286    2           IF NEW_DEV
      598     3287    2           THEN
      599     3288    3           DO;
      600     3289    3              CALL GBLK(DEV$,SIZEW(DEV));
      601     3290    3              DEV = '0'B;
      602     3291    3              DEV.THRESH_RATE = 1000;
      603     3292    3              DEV.DEVNM = DEVNM;
      604     3293    3              DEV.DEVNUM = TD$DEV.DEVNUM;
      605     3294    3              END;
      606     3295    2           ELSE CALL FIND_DEV(DEV$,DEVNM);
      607     3296    3           IF TD$DEV.IOCHAN~='0'B THEN DO;
      608     3297    3              T$=ADDR(IOM$(TD$DEV.IOCHAN.IOM)->IOM.CHAN$->CHAN(TD$DEV.IOCHAN.CHAN));
      609     3298    3              IF T$->CHAN.DEV$(0)=ADDR(NIL) THEN
      610     3299    3                 T$->CHAN.DEV$(0)=DEV$;
      611     3300    3              END;
      612     3301    3           ELSE DO I=0 TO 7;
      613     3302    4              IF TD$MPC.IOCHAN.PRESENCE(I) THEN DO;
      614     3303    4                 T$=IOM$(TD$MPC.IOCHAN.IOM(I))->IOM.CHAN$;
      615     3304    5                 DO J=TD$MPC.IOCHAN.LOCHAN(I) TO TD$MPC.IOCHAN.HICHAN(I);
      616     3305    5                    IF T$->CHAN.DEV$(J)=ADDR(NIL) THEN
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:54   
      617     3306    5                       T$->CHAN.DEV$(J)=DEV$;
      618     3307    5                    END;
      619     3308    4                 END;
      620     3309    3              END;
      621     3310    2           WORK$=DEVR$;
      622     3311    2           RETURN;
      623     3312    2   END BLD_DEV;
      624     3313        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:55   
      625     3314    1   FIND_DEV: PROC(PTR$,DEVNM);
      626     3315        /**/
      627     3316    2   DCL PTR$ PTR;
      628     3317    2   DCL DEVNM CHAR(8);
      629     3318        /**/
      630     3319    2   DCL I UBIN;
      631     3320    2   DCL J UBIN;
      632     3321    2   DCL TEMP$ PTR;
      633     3322        /**/
      634     3323        /**/
      635     3324    3           DO I = 0 TO 7;
      636     3325    3              IF IOM$(I) ~= ADDR(NIL)
      637     3326    3              THEN
      638     3327    4              DO J = 0 TO %N_MAXCHANS-1;
      639     3328    4                 TEMP$ = IOM$(I)->IOM.CHAN$->CHAN.DEV$(J);
      640     3329    4                 IF TEMP$ ~= ADDR(NIL)
      641     3330    4                 THEN                      /* CHECK FOR DEVICE */
      642     3331    5                 DO;
      643     3332    5                    IF TEMP$->DEV.DEVNM = DEVNM
      644     3333    5                    THEN                   /* FOUND IT */
      645     3334    6                    DO;
      646     3335    6                       PTR$ = TEMP$;
      647     3336    6                       GOTO FOUND_IT;
      648     3337    6                       END;                /* IF DEV.DEVNM = DEVNM */
      649     3338    5                    END;                   /* IF TEMP$ ~= ADDR(NIL) */
      650     3339    4                 END;                      /* DO J = 0 TO %N_MAXCHANS-1 */
      651     3340    3              END;                         /* DO I = 0 TO 7 */
      652     3341    2   FOUND_IT :
      653     3342    2           RETURN;
      654     3343    2   END FIND_DEV;
      655     3344        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:56   
      656     3345    1   GETSPACE: PROC(VECTR);
      657     3346    2   DCL VECTR BIT(72) ALIGNED;
      658     3347    2           FPT_GDS.RESULTS_=VECTOR(VECTR);
      659     3348    2           CALL M$SENV;
      660     3349    2           CALL M$GDS(FPT_GDS) ALTRET(REPORT_ERR);
      661     3350    2           CALL M$RENV;
      662     3351    2           RETURN;
      663     3352    2   REPORT_ERR:
      664     3353    2           UNWIND TO BAD_RETURN;
      665     3354    2   END GETSPACE;
      666     3355        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:57   
      667     3356    1   READ:   PROC(KEY,REC$);
      668     3357    2   DCL 1 KEY,
      669     3358    2         2 L UBIN BYTE UNAL,
      670     3359    2         2 C CHAR(KEY.L);
      671     3360    2   DCL REC$ PTR;
      672     3361    2           FPT_READ.KEY_=VECTOR(KEY);
      673     3362    2           FPT_READ.BUF_.BUF$=WORK$;
      674     3363    2           FPT_READ.BUF_.BOUND=WORKSEG.BOUND-POFFC(WORK$,WORKSEG.PTR$);
      675     3364    2           CALL M$READ(FPT_READ) ALTRET(CHK_LD);
      676     3365    2           REC$=WORK$;
      677     3366    2           WORK$=PINCRW(WORK$,(DCB$->F$DCB.ARS#+3)/4);
      678     3367    2           RETURN;
      679     3368    2   CHK_LD: ;
      680     3369    3           IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$LD THEN DO;
      681     3370    3              CALL GETSPACE(WORKSEG);
      682     3371    3              FPT_READ.BUF_.BOUND=WORKSEG.BOUND-POFFC(WORK$,WORKSEG.PTR$);
      683     3372    3              CALL M$RETRY;
      684     3373    3              END;
      685     3374    2           UNWIND TO BAD_RETURN;
      686     3375    2   END READ;
      687     3376        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:58   
      688     3377    1   GBLK:   PROC(BLK$,SIZE);
      689     3378    2   DCL BLK$ PTR;
      690     3379    2   DCL SIZE SBIN;
      691     3380    2           WORDS_USED = WORDS_USED + SIZE;
      692     3381    3           DO WHILE(WORDS_USED > WORDS_PER_GRAN);
      693     3382    3              CALL M$EXTEND(FPT_EXTEND) ALTRET(NO_MEM);
      694     3383    3              GRAN# = GRAN# + 1;
      695     3384    3              WORDS_USED = WORDS_USED - WORDS_PER_GRAN;
      696     3385    3              END;                         /* DO WHILE */
      697     3386    2           BLK$=TABLE$;
      698     3387    2           TABLE$=PINCRW(TABLE$,SIZE);
      699     3388    2           RETURN;
      700     3389    2   NO_MEM:
      701     3390    2           UNWIND TO BAD_RETURN;
      702     3391    2   END GBLK;
      703     3392    1   END ELT$INIT;
      704     3393        %EOD;

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:59   
--  Include file information  --

   TD$STRUCT.:E05TOU  is referenced.
   EL_PERR_C.:E05TOU  is referenced.
   I_SUBS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   IT_SUBS_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ELT$INIT.

   Procedure ELT$INIT requires 762 words for executable code.
   Procedure ELT$INIT requires 106 words of local(AUTO) storage.

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:60   

 Object Unit name= ELT$INIT                                   File name= ELT$THRESH.:E05TOU
 UTS= JUL 29 '97 15:20:02.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none   362    552  ELT$INIT
    2   DCB   even  none     0      0  M$ELF_DATA
    3   DCB   even  none     0      0  M$DO
    4  RoData even  UTS      1      1  ELT$INIT
    5   Proc  even  none   762   1372  ELT$INIT
    6  RoData even  none    20     24  ELT$INIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     5      0   yes            yes      Std        0  ELT$INIT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1    106  EL_CLOSE_CONFIG                    1    536  EL_THRESHOLD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AUNWIND
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:61   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  M$ELF_DATA                            M$DO
     B$TCB$                                B$DS3$                                B$DS4$
     EL_SNAPFLG                            B$JIT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:62   


      248        1        /*T***********************************************************/
      249        2        /*T*                                                         */
      250        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      251        4        /*T*                                                         */
      252        5        /*T***********************************************************/
      253        6        ELT$INIT: PROC;

      6  5 000000   000000 700200 xent  ELT$INIT     TSX0  ! X66_AUTO_0
         5 000001   000152 000000                    ZERO    106,0

      254        7        %INCLUDE CP_6;
      255       88        %F$DCB;
      256      145        %FPT_GETDCB (FPTN=FPT_GETDCB,
      257      146                     DCBNUM=FPT_OPEN_CONFIG.V.DCB#);
      258      161        %FPT_OPEN (FPTN=FPT_OPEN_CONFIG,
      259      162                   NAME=VLP_NAME_CONFIG,
      260      163                   ACCT=VLP_ACCT_SYS,
      261      164                   ASN=FILE,
      262      165                   FUN=IN,
      263      166                   SHARE=ALL);
      264      275        %VLP_NAME (FPTN=VLP_NAME_CONFIG,
      265      276                   NAME=':CONFIG');
      266      303        %VLP_ACCT (FPTN=VLP_ACCT_SYS,
      267      304                   ACCT=':SYS');
      268      317        %FPT_CLOSE (FPTN=EL_CLOSE_CONFIG,STCLASS="STATIC SYMDEF",
      269      318                    DISP=SAVE);
      270      360        %FPT_GDS (FPTN=FPT_GDS,
      271      361                  SEGSIZE=1024);
      272      377        %FPT_READ (FPTN=FPT_READ,
      273      378                   KEYS=YES);
      274      417        %FPT_ERRMSG (FPTN=FPT_ERRMSG,
      275      418                     INCLCODE=NO,
      276      419                     OUTDCB1=M$DO,
      277      420                     SUBMESS=YES);
      278      447        %FPT_KEYIN (FPTN=FPT_KEYIN);
      279      466        %FPT_OPEN (FPTN=CREATE_ELF_DATA,
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:63   
      280      467                   DCB=M$ELF_DATA,
      281      468                   FUN=CREATE,
      282      469                   EXIST=NEWFILE,
      283      470                   ACSVEH=ELF_DATA_ATTR,
      284      471                   ORG=RANDOM,
      285      472                   SHARE=IN,
      286      473                   ASN=FILE,
      287      474                   ACS=DS3,
      288      475                   CTG=YES,
      289      476                   ACCT=VLP_ACCT_SYS,
      290      477                   NAME=VLP_NAME);
      291      586        %FPT_OPEN (FPTN=UPDATE_ELF_DATA,
      292      587                   DCB=M$ELF_DATA,
      293      588                   FUN=UPDATE,
      294      589                   ORG=RANDOM,
      295      590                   SHARE=IN,
      296      591                   ASN=FILE,
      297      592                   ACS=DS3,
      298      593                   CTG=YES,
      299      594                   ACCT=VLP_ACCT_SYS,
      300      595                   NAME=VLP_NAME);
      301      704        %FPT_MONINFO (FPTN=BOOTFLAG,
      302      705                MONINFO=MONINFO);
      303      720        %VLR_MONINFO (FPTN=MONINFO);
      304      738        /**/
      305      739        %VLP_ATTR(FPTN=ELF_DATA_ATTR);
      306      753        %VLP_ACSVEH (READ=YES, VEHICLE='SYSCON', LAST=";");
      307      770        %FPT_CLOSE (FPTN=CLOSE_ELF_DATA,
      308      771                    DISP=SAVE,
      309      772                    DCB=M$ELF_DATA);
      310      814        %VLP_NAME (NAME='ELF_DATA');
      311      841        %FPT_EXTEND (DCB=M$ELF_DATA,
      312      842                     SIZ=1);
      313      856    1   DCL ERRCODE BIT(36);
      314      857    1   DCL 1 ERRCODE2 REDEF ERRCODE,
      315      858    1         2 FCG BIT(18) UNAL,
      316      859    1         2 MON BIT(1) UNAL,
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:64   
      317      860    1         2 CODE UBIN(14) UNAL,
      318      861    1         2 SEV UBIN(3) UNAL;
      319      862    1   DCL 1 ERRBUF ALIGNED,
      320      863    1         2 B1 CHAR(120),
      321      864    1         2 B2 CHAR(120);
      322      865    1   DCL M$ELF_DATA DCB;
      323      866    1   DCL M$DO DCB;
      324      867    1   DCL B$TCB$ PTR SYMREF;
      325      868    1   DCL B$DS3$ PTR SYMREF;
      326      869    1   DCL B$DS4$ PTR SYMREF;
      327      870        %B$TCB;
      328      873        %B$ALT;
      329      881        %INCLUDE B_ERRORS_C;
      330     2008        %FPT_RELDCB (FPTN=FPT_RELDCB);
      331     2022    1   DCL EL_THRESHOLD BIT(1) ALIGNED STATIC SYMDEF INIT('0'B);
      332     2023    1   DCL EL_SNAPFLG BIT(1) ALIGNED SYMREF;
      333     2024    1   DCL TABLE$ PTR;
      334     2025    1   DCL 1 WORKSEG STATIC DALIGNED,
      335     2026    1         2 BOUND UBIN(20) UNAL,
      336     2027    1         2 * BIT(16) UNAL,
      337     2028    1         2 PTR$ PTR;
      338     2029    1   DCL WORK$ PTR;
      339     2030    1   DCL HEAD$ PTR;
      340     2031    1   DCL IOM$(0:7) PTR BASED(B$DS3$);
      341     2032    1   DCL IOMR$ PTR;
      342     2033    1   DCL MPCR$ PTR;
      343     2034    1   DCL MPC$ PTR;
      344     2035    1   DCL DEVR$ PTR;
      345     2036    1   DCL DEV$ PTR;
      346     2037    1   DCL T$ PTR;
      347     2038    1   DCL P$ PTR;
      348     2039    1   DCL IOM_ENTRY$ PTR;                     /* PTR TO IOM ENTRY IN ELF_DATA */
      349     2040    1   DCL I SBIN;
      350     2041    1   DCL J SBIN;
      351     2042    1   DCL WORDS_USED SBIN WORD STATIC;
      352     2043    1   DCL GRAN# UBIN WORD STATIC;
      353     2044        %SUB WORDS_PER_GRAN = 1024;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:65   
      354     2045    1   DCL BAD_RETURN REMEMBER;
      355     2046    1   DCL NUMDEVS SBIN;
      356     2047    1   DCL DCB$ PTR;
      357     2048    1   DCL DEVNM CHAR(8);
      358     2049    1   DCL B$JIT$ PTR SYMREF;
      359     2050        %INCLUDE B$JIT;
      360     2340        %INCLUDE IT_SUBS_C;
      361     2607        %INCLUDE NI$TABLES ;
      362     2823        %INCLUDE I_SUBS_C;                      /* has boot flags equs */
      363     2847        /**/
      364     2848        %INCLUDE EL_PERR_C;
      365     2861        /*E*    ERROR:   ELT-E$BAD_DATA
      366     2862                MESSAGE: ELF_DATA IS BAD - REBUILD HAS BEEN INITIATED
      367     2863                DESCRIPTION:  The data in ELF's data segment is not as expected.
      368     2864                              Thresholding information has been lost.
      369     2865                              ELF_DATA will be rebuilt from the current configuration.
      370     2866        */
      371     2867        %INCLUDE TD$STRUCT;
      372     2968        %TD$HEAD (NAME=TD$HEAD,STCLASS="BASED(HEAD$)");
      373     3004        %TD$IOM (NAME=TD$IOM,STCLASS="BASED(IOMR$)");
      374     3012        %TD$MPC (NAME=TD$MPC,STCLASS="BASED(MPCR$)");
      375     3034        %TD$DEV (NAME=TD$DEV,STCLASS="BASED(DEVR$)");
      376     3053        /**/
      377     3054        %MACRO KEY (NAME=JUNK,KEY="' '");
      378     3055        DCL 1 NAME STATIC ALIGNED,
      379     3056              2 L UBIN BYTE UNAL INIT(SIZEC(KEY)),
      380     3057              2 C CHAR(0) INIT(KEY);
      381     3058        %MEND;
      382     3059        %KEY (NAME=HEADKEY,KEY="%BINASC(0)");
      383     3064        %KEY (NAME=IOMKEY,KEY='IOM0');
      384     3069        %KEY (NAME=DEVKEY,KEY='YYNNDDDD');
      385     3074        /**/
      386     3075    1   DCL 1 IOM BASED ALIGNED,
      387     3076    1         2 ERR_RATE UBIN,
      388     3077    1         2 NUM_ENTRIES UBIN HALF UNAL,
      389     3078    1         2 THRESH UBIN HALF UNAL,
      390     3079    1         2 THRESH_RATE UBIN,
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:66   
      391     3080    1         2 CHAN$ PTR;
      392     3081    1   DCL 1 CHAN(0:0) BASED ALIGNED,
      393     3082    1         2 ERR_RATE UBIN,
      394     3083    1         2 NUM_ENTRIES UBIN HALF UNAL,
      395     3084    1         2 THRESH UBIN HALF UNAL,
      396     3085    1         2 THRESH_RATE UBIN,
      397     3086    1         2 DEV$ PTR,
      398     3087    1         2 MPC$ PTR;
      399     3088    1   DCL 1 MPC BASED(MPC$) ALIGNED,
      400     3089    1         2 ERR_RATE UBIN,
      401     3090    1         2 NUM_ENTRIES UBIN HALF UNAL,
      402     3091    1         2 THRESH UBIN HALF UNAL,
      403     3092    1         2 THRESH_RATE UBIN,
      404     3093    1         2 DEVNM CHAR(8);
      405     3094    1   DCL 1 DEV BASED(DEV$) ALIGNED,
      406     3095    1         2 ERR_RATE UBIN,
      407     3096    1         2 NUM_ENTRIES UBIN HALF UNAL,
      408     3097    1         2 THRESH UBIN HALF UNAL,
      409     3098    1         2 THRESH_RATE UBIN,
      410     3099    1         2 DEVNM CHAR(8),
      411     3100    1         2 DEVNUM UBIN,
      412     3101    1         2 STATS(0:9) UBIN;
      413     3102        %SUB NEVER="WHILE('0'B)";
      414     3103        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:67   
      415     3104        /**/
      416     3105        /* ROUTINE INITIALIZATION */
      417     3106        /**/
      418     3107    1           REMEMBER REPORT_ERR IN BAD_RETURN;

   3107  5 000002   000474 635000 5                  EAA     REPORT_ERR
         5 000003   200116 452500                    STP2    BAD_RETURN,,AUTO
         5 000004   200117 755100                    STA     BAD_RETURN+1,,AUTO

      419     3108    1           CALL M$GETDCB(FPT_GETDCB) ALTRET(REPORT_ERR);

   3108  5 000005   000000 630400 1                  EPPR0   FPT_GETDCB
         5 000006   460002 713400                    CLIMB   alt,+24578
         5 000007   401000 401760                    pmme    nvectors=3
         5 000010   000474 702000 5                  TSX2    REPORT_ERR

      420     3109    1           DCB$=DCBADDR(FPT_OPEN_CONFIG.V.DCB#);

   3109  5 000011   000000 470400 6                  LDP0    0
         5 000012   000000 471500                    LDP1    0,,PR0
         5 000013   000054 220000 1                  LDX0    FPT_OPEN_CONFIG+36
         5 000014   100000 236110                    LDQ     0,X0,PR1
         5 000015   200121 756100                    STQ     DCB$,,AUTO

      421     3110    1           FPT_READ.V.DCB#=FPT_OPEN_CONFIG.V.DCB#;

   3110  5 000016   000162 740000 1                  STX0    FPT_READ+8

      422     3111    1           EL_CLOSE_CONFIG.V.DCB#=FPT_OPEN_CONFIG.V.DCB#;

   3111  5 000017   000140 740000 1                  STX0    EL_CLOSE_CONFIG+26

      423     3112    1           FPT_RELDCB.V.DCB#=FPT_OPEN_CONFIG.V.DCB#;

   3112  5 000020   000534 740000 1                  STX0    FPT_RELDCB+2

      424     3113    1           CALL M$OPEN(FPT_OPEN_CONFIG) ALTRET(REPORT_ERR);
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:68   

   3113  5 000021   000010 630400 1                  EPPR0   FPT_OPEN_CONFIG
         5 000022   450000 713400                    CLIMB   alt,open
         5 000023   410400 401760                    pmme    nvectors=18
         5 000024   000474 702000 5                  TSX2    REPORT_ERR

      425     3114    1           IF DCBADDR(DCBNUM(M$ELF_DATA))->F$DCB.FCD#

   3114  5 000025   000000 236007 xsym               LDQ     M$ELF_DATA,DL
         5 000026   000000 470400 6                  LDP0    0
         5 000027   000000 471500                    LDP1    0,,PR0
         5 000030   100000 473506                    LDP3    0,QL,PR1
         5 000031   300031 236100                    LDQ     25,,PR3
         5 000032   020000 316007                    CANQ    8192,DL
         5 000033   000037 600000 5                  TZE     s:3117

      426     3115    1           THEN CALL M$CLOSE(CLOSE_ELF_DATA);

   3115  5 000034   000464 630400 1                  EPPR0   CLOSE_ELF_DATA
         5 000035   050001 713400                    CLIMB   close
         5 000036   406000 401760                    pmme    nvectors=13

      427     3116        /**/
      428     3117    1           CALL M$MONINFO( BOOTFLAG );

   3117  5 000037   000424 630400 1                  EPPR0   BOOTFLAG
         5 000040   020023 713400                    CLIMB   8211
         5 000041   402400 401760                    pmme    nvectors=6

      429     3118    1           IF MONINFO.BOOTFLAG# >= I_DISKBOOT /*7*/

   3118  5 000042   000446 235000 1                  LDA     MONINFO+6
         5 000043   000007 115007                    CMPA    7,DL
         5 000044   000047 603000 5                  TRC     s:3121
         5 000045   000000 234000 xsym               SZN     EL_SNAPFLG
         5 000046   000205 605000 5                  TPL     BUILD_NEW_ELF_DATA

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:69   
      430     3119    1             OR EL_SNAPFLG THEN
      431     3120    2           DO;                   /* DISK BOOT OR RECOVERY OR SNAP HAS OCCURRED */

      432     3121    2              CALL M$OPEN(UPDATE_ELF_DATA)

   3121  5 000047   000332 630400 1                  EPPR0   UPDATE_ELF_DATA
         5 000050   450000 713400                    CLIMB   alt,open
         5 000051   410400 401760                    pmme    nvectors=18
         5 000052   000176 702000 5                  TSX2    s:3153

      433     3122    3              WHENRETURN DO;               /* CHECK IF ELF_DATA LOOKS GOOD */

      434     3123    3                 IOM_ENTRY$ =B$DS3$;

   3123  5 000053   000000 236000 xsym               LDQ     B$DS3$
         5 000054   200112 756100                    STQ     IOM_ENTRY$,,AUTO

      435     3124    3                 WORKSEG = '0'B;

   3124  5 000055   000000 235003                    LDA     0,DU
         5 000056   000000 236003                    LDQ     0,DU
         5 000057   000540 757000 1                  STAQ    WORKSEG

      436     3125    3                 WORKSEG.PTR$ = B$DS4$;

   3125  5 000060   000000 236000 xsym               LDQ     B$DS4$
         5 000061   000541 756000 1                  STQ     WORKSEG+1

      437     3126    3                 CALL GETSPACE(WORKSEG);

   3126  5 000062   000001 236000 6                  LDQ     1
         5 000063   200145 756100                    STQ     J+1,,AUTO
         5 000064   001200 701000 5                  TSX1    GETSPACE
         5 000065   000000 011000                    NOP     0

      438     3127    3                 WORK$ = WORKSEG.PTR$;

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:70   
   3127  5 000066   000541 236000 1                  LDQ     WORKSEG+1
         5 000067   200101 756100                    STQ     WORK$,,AUTO

      439     3128    3                 CALL READ(HEADKEY, HEAD$); /* READ HEAD REC FROM :CONFIG */

   3128  5 000070   200102 630500                    EPPR0   HEAD$,,AUTO
         5 000071   200142 450500                    STP0    @BLK$+1,,AUTO
         5 000072   000002 236000 6                  LDQ     2
         5 000073   200141 756100                    STQ     NEW_DEV+3,,AUTO
         5 000074   001221 701000 5                  TSX1    READ
         5 000075   000000 011000                    NOP     0

      440     3129    3                 IOM_ENTRY$ = PINCRW(IOM_ENTRY$, 8);

   3129  5 000076   200112 236100                    LDQ     IOM_ENTRY$,,AUTO
         5 000077   000010 036003                    ADLQ    8,DU
         5 000100   200112 756100                    STQ     IOM_ENTRY$,,AUTO

      441     3130    4                 DO I = 0 TO TD$HEAD.NUMIOMS - 1;

   3130  5 000101   200113 450100                    STZ     I,,AUTO
         5 000102   000166 710000 5                  TRA     s:3148+1

      442     3131    4                    IF IOM$(I) ~= IOM_ENTRY$

   3131  5 000103   000000 470400 xsym               LDP0    B$DS3$
         5 000104   200113 720100                    LXL0    I,,AUTO
         5 000105   000000 236110                    LDQ     0,X0,PR0
         5 000106   200112 116100                    CMPQ    IOM_ENTRY$,,AUTO
         5 000107   000162 600000 5                  TZE     s:3147

      443     3132    5                    THEN DO;

      444     3133    5                       CALL M$CLOSE(CLOSE_ELF_DATA); /* ELF_DATA IS BAD */

   3133  5 000110   000464 630400 1                  EPPR0   CLOSE_ELF_DATA
         5 000111   050001 713400                    CLIMB   close
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:71   
         5 000112   406000 401760                    pmme    nvectors=13

      445     3134    5                       ERRCODE2.FCG = '051424'O;

   3134  5 000113   051424 220003                    LDX0    21268,DU
         5 000114   200003 740100                    STX0    ERRCODE,,AUTO

      446     3135    5                       ERRCODE2.MON = '0'B;

   3135  5 000115   000003 236000 6                  LDQ     3
         5 000116   200003 356100                    ANSQ    ERRCODE,,AUTO

      447     3136    5                       ERRCODE2.SEV = 0;

   3136  5 000117   000004 236000 6                  LDQ     4
         5 000120   200003 356100                    ANSQ    ERRCODE,,AUTO

      448     3137    5                       ERRCODE2.CODE = %E$BAD_DATA;

   3137  5 000121   200003 236100                    LDQ     ERRCODE,,AUTO
         5 000122   000005 376000 6                  ANQ     5
         5 000123   000030 276007                    ORQ     24,DL
         5 000124   200003 756100                    STQ     ERRCODE,,AUTO

      449     3138    5                       FPT_ERRMSG.CODE_ = VECTOR(ERRCODE);

   3138  5 000125   777640 235007                    LDA     -96,DL
         5 000126   200146 452500                    STP2    @VECTR+1,,AUTO
         5 000127   200146 236100                    LDQ     @VECTR+1,,AUTO
         5 000130   000003 036003                    ADLQ    3,DU
         5 000131   000172 757000 1                  STAQ    FPT_ERRMSG+2

      450     3139    5                       FPT_ERRMSG.BUF_ = VECTOR(ERRBUF);

   3139  5 000132   000006 235000 6                  LDA     6
         5 000133   200146 452500                    STP2    @VECTR+1,,AUTO
         5 000134   200146 236100                    LDQ     @VECTR+1,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:72   
         5 000135   000004 036003                    ADLQ    4,DU
         5 000136   000174 757000 1                  STAQ    FPT_ERRMSG+4

      451     3140    5                       CALL M$ERRMSG(FPT_ERRMSG) ALTRET(BAG_IT);

   3140  5 000137   000170 630400 1                  EPPR0   FPT_ERRMSG
         5 000140   420000 713400                    CLIMB   alt,+8192
         5 000141   405000 401760                    pmme    nvectors=11
         5 000142   000537 702000 5                  TSX2    BAG_IT

      452     3141    6                       IF B$JIT.MODE = %M_GHOST# THEN DO;

   3141  5 000143   000000 470400 xsym               LDP0    B$JIT$
         5 000144   000000 236100                    LDQ     0,,PR0
         5 000145   740000 376003                    ANQ     -16384,DU
         5 000146   100000 116003                    CMPQ    32768,DU
         5 000147   000161 601000 5                  TNZ     s:3145

      453     3142    6                          FPT_KEYIN.MESS_ = VECTOR(ERRBUF.B1);

   3142  5 000150   000007 235000 6                  LDA     7
         5 000151   200146 452500                    STP2    @VECTR+1,,AUTO
         5 000152   200146 236100                    LDQ     @VECTR+1,,AUTO
         5 000153   000004 036003                    ADLQ    4,DU
         5 000154   000224 757000 1                  STAQ    FPT_KEYIN+2

      454     3143    6                          CALL M$KEYIN(FPT_KEYIN) ALTRET(BAG_IT);

   3143  5 000155   000222 630400 1                  EPPR0   FPT_KEYIN
         5 000156   520000 713400                    CLIMB   alt,+40960
         5 000157   401400 401760                    pmme    nvectors=4
         5 000160   000537 702000 5                  TSX2    BAG_IT

      455     3144    6                          END;

      456     3145    5                       GOTO BUILD_NEW_ELF_DATA;

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:73   
   3145  5 000161   000205 710000 5                  TRA     BUILD_NEW_ELF_DATA

      457     3146    5                       END;
      458     3147    4                    IOM_ENTRY$ = PINCRW(IOM_ENTRY$, SIZEW(IOM) + SIZEW(CHAN)*%
              3147                             N_MAXCHANS);

   3147  5 000162   200112 236100                    LDQ     IOM_ENTRY$,,AUTO
         5 000163   001204 036003                    ADLQ    644,DU
         5 000164   200112 756100                    STQ     IOM_ENTRY$,,AUTO

      459     3148    4                    END;                   /* DO I */

   3148  5 000165   200113 054100                    AOS     I,,AUTO
         5 000166   200102 470500                    LDP0    HEAD$,,AUTO
         5 000167   000000 236100                    LDQ     0,,PR0
         5 000170   777777 376007                    ANQ     -1,DL
         5 000171   200113 116100                    CMPQ    I,,AUTO
         5 000172   000103 605400 5                  TPNZ    s:3131

      460     3149    3                 EL_THRESHOLD = '1'B;      /* ELF_DATA LOOKS GOOD */

   3149  5 000173   400000 236003                    LDQ     -131072,DU
         5 000174   000536 756000 1                  STQ     EL_THRESHOLD

      461     3150    3                 GOTO BAG_IT;

   3150  5 000175   000537 710000 5                  TRA     BAG_IT

      462     3151    3                 END;                      /* WHEN RETURN */
      463     3152    3              WHENALTRETURN DO;

      464     3153    3                 IF B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.CODE = %E$NOFILE

   3153  5 000176   000000 470400 xsym               LDP0    B$TCB$
         5 000177   000000 471500                    LDP1    0,,PR0
         5 000200   100102 236100                    LDQ     66,,PR1
         5 000201   377770 376007                    ANQ     131064,DL
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:74   
         5 000202   001610 116007                    CMPQ    904,DL
         5 000203   000205 600000 5                  TZE     BUILD_NEW_ELF_DATA

      465     3154    3                 THEN GOTO BUILD_NEW_ELF_DATA;
      466     3155    3                 ELSE GOTO REPORT_ERR;

   3155  5 000204   000474 710000 5                  TRA     REPORT_ERR

      467     3156    3                 END;                      /* WHEN ALTRETURN */
      468     3157    2              END;                         /* DISK BOOT OR RECOVERY */
      469     3158    1   BUILD_NEW_ELF_DATA:
      470     3159                                      /* TAPE BOOT OR ELF_DATA NEEDS TO BE RE-BUILT */
      471     3160    1           CALL M$OPEN(CREATE_ELF_DATA) ALTRET(REPORT_ERR);

   3160  5 000205   000240 630400 1     BUILD_NEW_E* EPPR0   CREATE_ELF_DATA
         5 000206   450000 713400                    CLIMB   alt,open
         5 000207   410400 401760                    pmme    nvectors=18
         5 000210   000474 702000 5                  TSX2    REPORT_ERR

      472     3161    1           TABLE$ = B$DS3$;

   3161  5 000211   000000 236000 xsym               LDQ     B$DS3$
         5 000212   200100 756100                    STQ     TABLE$,,AUTO

      473     3162    1           WORKSEG = '0'B;

   3162  5 000213   000000 235003                    LDA     0,DU
         5 000214   000000 236003                    LDQ     0,DU
         5 000215   000540 757000 1                  STAQ    WORKSEG

      474     3163    1           WORKSEG.PTR$ = B$DS4$;

   3163  5 000216   000000 236000 xsym               LDQ     B$DS4$
         5 000217   000541 756000 1                  STQ     WORKSEG+1

      475     3164    1           CALL GETSPACE(WORKSEG);

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:75   
   3164  5 000220   000001 236000 6                  LDQ     1
         5 000221   200145 756100                    STQ     J+1,,AUTO
         5 000222   001200 701000 5                  TSX1    GETSPACE
         5 000223   000000 011000                    NOP     0

      476     3165    1           WORK$=WORKSEG.PTR$;

   3165  5 000224   000541 236000 1                  LDQ     WORKSEG+1
         5 000225   200101 756100                    STQ     WORK$,,AUTO

      477     3166    1           CALL READ(HEADKEY,HEAD$);

   3166  5 000226   200102 630500                    EPPR0   HEAD$,,AUTO
         5 000227   200142 450500                    STP0    @BLK$+1,,AUTO
         5 000230   000002 236000 6                  LDQ     2
         5 000231   200141 756100                    STQ     NEW_DEV+3,,AUTO
         5 000232   001221 701000 5                  TSX1    READ
         5 000233   000000 011000                    NOP     0

      478     3167    1           NUMDEVS=(((DCB$->F$DCB.ARS#+3)/4)-POFFW(ADDR(TD$HEAD.DEVNAME(0)),ADDR(
              3167                    TD$HEAD)))/2;

   3167  5 000234   200121 470500                    LDP0    DCB$,,AUTO
         5 000235   000000 236100                    LDQ     0,,PR0
         5 000236   000003 036007                    ADLQ    3,DL
         5 000237   000004 506007                    DIV     4,DL
         5 000240   200146 756100                    STQ     @VECTR+1,,AUTO
         5 000241   200102 236100                    LDQ     HEAD$,,AUTO
         5 000242   000022 772000                    QRL     18
         5 000243   200147 756100                    STQ     @VECTR+2,,AUTO
         5 000244   200102 236100                    LDQ     HEAD$,,AUTO
         5 000245   000020 036003                    ADLQ    16,DU
         5 000246   000022 772000                    QRL     18
         5 000247   200147 136100                    SBLQ    @VECTR+2,,AUTO
         5 000250   200150 756100                    STQ     @VECTR+3,,AUTO
         5 000251   200146 236100                    LDQ     @VECTR+1,,AUTO
         5 000252   200150 136100                    SBLQ    @VECTR+3,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:76   
         5 000253   000002 506007                    DIV     2,DL
         5 000254   200120 756100                    STQ     NUMDEVS,,AUTO

      479     3168    1           GRAN# = 1;

   3168  5 000255   000001 235007                    LDA     1,DL
         5 000256   000543 755000 1                  STA     GRAN#

      480     3169    1           WORDS_USED = 0;

   3169  5 000257   000542 450000 1                  STZ     WORDS_USED

      481     3170    1           CALL GBLK(T$,8);

   3170  5 000260   000010 236000 6                  LDQ     8
         5 000261   200142 756100                    STQ     @BLK$+1,,AUTO
         5 000262   200110 631500                    EPPR1   T$,,AUTO
         5 000263   200141 451500                    STP1    NEW_DEV+3,,AUTO
         5 000264   001332 701000 5                  TSX1    GBLK
         5 000265   000000 011000                    NOP     0

      482     3171    2           DO I=0 TO 7;

   3171  5 000266   200113 450100                    STZ     I,,AUTO

      483     3172    2              IOM$(I)=ADDR(NIL);

   3172  5 000267   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 000270   000000 470400 xsym               LDP0    B$DS3$
         5 000271   200113 720100                    LXL0    I,,AUTO
         5 000272   000000 756110                    STQ     0,X0,PR0

      484     3173    2              END;

   3173  5 000273   200113 054100                    AOS     I,,AUTO
         5 000274   200113 235100                    LDA     I,,AUTO
         5 000275   000007 115007                    CMPA    7,DL
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:77   
         5 000276   000267 604400 5                  TMOZ    s:3172

      485     3174        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:78   
      486     3175        /**/
      487     3176        /* BUILD IOM AND CHANNEL TABLES */
      488     3177        /**/
      489     3178    2           DO I=0 TO TD$HEAD.NUMIOMS-1;

   3178  5 000277   200113 450100                    STZ     I,,AUTO
         5 000300   000377 710000 5                  TRA     s:3194+1

      490     3179    2              CALL BINCHAR(SUBSTR(IOMKEY.C,3,1),I);

   3179  5 000301   000000 301500                    BTD
         5 000302   200113 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         5 000303   000546 030001 1                  NDSC9   IOMKEY+1                 cn=0,s=nosgn,sf=0,n=1

      491     3180    2              CALL READ(IOMKEY,IOMR$);

   3180  5 000304   200103 630500                    EPPR0   IOMR$,,AUTO
         5 000305   200142 450500                    STP0    @BLK$+1,,AUTO
         5 000306   000011 236000 6                  LDQ     9
         5 000307   200141 756100                    STQ     NEW_DEV+3,,AUTO
         5 000310   001221 701000 5                  TSX1    READ
         5 000311   000000 011000                    NOP     0

      492     3181    2              CALL GBLK(T$,SIZEW(IOM));

   3181  5 000312   000012 236000 6                  LDQ     10
         5 000313   200142 756100                    STQ     @BLK$+1,,AUTO
         5 000314   200110 630500                    EPPR0   T$,,AUTO
         5 000315   200141 450500                    STP0    NEW_DEV+3,,AUTO
         5 000316   001332 701000 5                  TSX1    GBLK
         5 000317   000000 011000                    NOP     0

      493     3182    2              IOM$(I)=T$;

   3182  5 000320   200110 236100                    LDQ     T$,,AUTO
         5 000321   000000 470400 xsym               LDP0    B$DS3$
         5 000322   200113 720100                    LXL0    I,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:79   
         5 000323   000000 756110                    STQ     0,X0,PR0

      494     3183    2              T$->IOM='0'B;

   3183  5 000324   200110 470500                    LDP0    T$,,AUTO
         5 000325   000100 100400                    MLR     fill='000'O
         5 000326   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         5 000327   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16

      495     3184    2              T$->IOM.THRESH_RATE = 1000;

   3184  5 000330   001750 235007                    LDA     1000,DL
         5 000331   200110 470500                    LDP0    T$,,AUTO
         5 000332   000002 755100                    STA     2,,PR0

      496     3185    2              CALL GBLK(P$,SIZEW(CHAN)*%N_MAXCHANS);

   3185  5 000333   000014 236000 6                  LDQ     12
         5 000334   200142 756100                    STQ     @BLK$+1,,AUTO
         5 000335   200111 630500                    EPPR0   P$,,AUTO
         5 000336   200141 450500                    STP0    NEW_DEV+3,,AUTO
         5 000337   001332 701000 5                  TSX1    GBLK
         5 000340   000000 011000                    NOP     0

      497     3186    2              T$->IOM.CHAN$=P$;

   3186  5 000341   200111 236100                    LDQ     P$,,AUTO
         5 000342   200110 470500                    LDP0    T$,,AUTO
         5 000343   000003 756100                    STQ     3,,PR0

      498     3187    3              DO J=0 TO %N_MAXCHANS-1;

   3187  5 000344   200114 450100                    STZ     J,,AUTO
         5 000345   000371 710000 5                  TRA     s:3192+1

      499     3188    3                 P$->CHAN(J)='0'B;

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:80   
   3188  5 000346   200114 236100                    LDQ     J,,AUTO
         5 000347   000024 402007                    MPY     20,DL
         5 000350   200111 470500                    LDP0    P$,,AUTO
         5 000351   000106 100400                    MLR     fill='000'O
         5 000352   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         5 000353   000000 000024                    ADSC9   0,Q,PR0                  cn=0,n=20

      500     3189    3                 P$->CHAN.THRESH_RATE(J) = 1000;

   3189  5 000354   200114 236100                    LDQ     J,,AUTO
         5 000355   000005 402007                    MPY     5,DL
         5 000356   001750 235007                    LDA     1000,DL
         5 000357   200111 470500                    LDP0    P$,,AUTO
         5 000360   000002 755106                    STA     2,QL,PR0

      501     3190    3                 P$->CHAN.MPC$(J)=ADDR(NIL);

   3190  5 000361   000000 620006                    EAX0    0,QL
         5 000362   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 000363   200111 470500                    LDP0    P$,,AUTO
         5 000364   000004 756110                    STQ     4,X0,PR0

      502     3191    3                 P$->CHAN.DEV$(J)=ADDR(NIL);

   3191  5 000365   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 000366   200111 470500                    LDP0    P$,,AUTO
         5 000367   000003 756110                    STQ     3,X0,PR0

      503     3192    3                 END;

   3192  5 000370   200114 054100                    AOS     J,,AUTO
         5 000371   200114 235100                    LDA     J,,AUTO
         5 000372   000177 115007                    CMPA    127,DL
         5 000373   000346 604400 5                  TMOZ    s:3188

      504     3193    2              WORK$=IOMR$;

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:81   
   3193  5 000374   200103 236100                    LDQ     IOMR$,,AUTO
         5 000375   200101 756100                    STQ     WORK$,,AUTO

      505     3194    2              END;

   3194  5 000376   200113 054100                    AOS     I,,AUTO
         5 000377   200102 470500                    LDP0    HEAD$,,AUTO
         5 000400   000000 236100                    LDQ     0,,PR0
         5 000401   777777 376007                    ANQ     -1,DL
         5 000402   200113 116100                    CMPQ    I,,AUTO
         5 000403   000301 605400 5                  TPNZ    s:3179

      506     3195        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:82   
      507     3196        /**/
      508     3197        /* BUILD MPC AND DEVICE TABLES */
      509     3198        /**/
      510     3199    1           CALL BLD_MPC(TD$HEAD.UNITMPC_INDX);

   3199  5 000404   200102 236100                    LDQ     HEAD$,,AUTO
         5 000405   000001 036003                    ADLQ    1,DU
         5 000406   200125 756100                    STQ     DEVNM+3,,AUTO
         5 000407   000564 701000 5                  TSX1    BLD_MPC
         5 000410   000000 011000                    NOP     0

      511     3200    1           CALL BLD_MPC(TD$HEAD.TAPEMPC_INDX);

   3200  5 000411   200102 236100                    LDQ     HEAD$,,AUTO
         5 000412   000002 036003                    ADLQ    2,DU
         5 000413   200125 756100                    STQ     DEVNM+3,,AUTO
         5 000414   000564 701000 5                  TSX1    BLD_MPC
         5 000415   000000 011000                    NOP     0

      512     3201    1           CALL BLD_MPC(TD$HEAD.DISKMPC_INDX);

   3201  5 000416   200102 236100                    LDQ     HEAD$,,AUTO
         5 000417   000003 036003                    ADLQ    3,DU
         5 000420   200125 756100                    STQ     DEVNM+3,,AUTO
         5 000421   000564 701000 5                  TSX1    BLD_MPC
         5 000422   000000 011000                    NOP     0

      513     3202    1           CALL BLD_MPC(TD$HEAD.APMPC_INDX);

   3202  5 000423   200102 236100                    LDQ     HEAD$,,AUTO
         5 000424   000004 036003                    ADLQ    4,DU
         5 000425   200125 756100                    STQ     DEVNM+3,,AUTO
         5 000426   000564 701000 5                  TSX1    BLD_MPC
         5 000427   000000 011000                    NOP     0

      514     3203    2           DO I=TD$HEAD.CONSOLE_INDX TO TD$HEAD.CONSOLE_INDX+TD$HEAD.NUMCONSOLES-1;

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:83   
   3203  5 000430   200102 470500                    LDP0    HEAD$,,AUTO
         5 000431   000007 236100                    LDQ     7,,PR0
         5 000432   000022 772000                    QRL     18
         5 000433   200113 756100                    STQ     I,,AUTO
         5 000434   000450 710000 5                  TRA     s:3206+1

      515     3204    2              DEVNM=TD$HEAD.DEVNAME(I);

   3204  5 000435   200113 235100                    LDA     I,,AUTO
         5 000436   000003 735000                    ALS     3
         5 000437   200102 470500                    LDP0    HEAD$,,AUTO
         5 000440   040100 100505                    MLR     fill='040'O
         5 000441   000020 000010                    ADSC9   16,A,PR0                 cn=0,n=8
         5 000442   200122 000010                    ADSC9   DEVNM,,AUTO              cn=0,n=8

      516     3205    2              CALL BLD_DEV(DEVNM);

   3205  5 000443   200122 631500                    EPPR1   DEVNM,,AUTO
         5 000444   200133 451500                    STP1    K+2,,AUTO
         5 000445   000730 701000 5                  TSX1    BLD_DEV
         5 000446   000000 011000                    NOP     0

      517     3206    2              END;

   3206  5 000447   200113 054100                    AOS     I,,AUTO
         5 000450   200102 470500                    LDP0    HEAD$,,AUTO
         5 000451   000007 236100                    LDQ     7,,PR0
         5 000452   777777 376007                    ANQ     -1,DL
         5 000453   200146 756100                    STQ     @VECTR+1,,AUTO
         5 000454   000007 236100                    LDQ     7,,PR0
         5 000455   000022 772000                    QRL     18
         5 000456   200146 036100                    ADLQ    @VECTR+1,,AUTO
         5 000457   000435 604000 5                  TMI     s:3204
         5 000460   200113 116100                    CMPQ    I,,AUTO
         5 000461   000435 605400 5                  TPNZ    s:3204

      518     3207        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:84   
      519     3208        /**/
      520     3209        /* CLEANUP AND RETURN */
      521     3210        /**/
      522     3211    1           CALL M$CLOSE(CLOSE_ELF_DATA);

   3211  5 000462   000464 630400 1                  EPPR0   CLOSE_ELF_DATA
         5 000463   050001 713400                    CLIMB   close
         5 000464   406000 401760                    pmme    nvectors=13

      523     3212    1           CALL M$OPEN(UPDATE_ELF_DATA) ALTRET(REPORT_ERR);

   3212  5 000465   000332 630400 1                  EPPR0   UPDATE_ELF_DATA
         5 000466   450000 713400                    CLIMB   alt,open
         5 000467   410400 401760                    pmme    nvectors=18
         5 000470   000474 702000 5                  TSX2    REPORT_ERR

      524     3213    1           EL_THRESHOLD='1'B;

   3213  5 000471   400000 236003                    LDQ     -131072,DU
         5 000472   000536 756000 1                  STQ     EL_THRESHOLD

      525     3214    2           DO NEVER;

   3214  5 000473   000537 710000 5                  TRA     BAG_IT

      526     3215    2   REPORT_ERR:
      527     3216    2              ERRCODE=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   3216  5 000474   000000 470400 xsym  REPORT_ERR   LDP0    B$TCB$
         5 000475   000000 471500                    LDP1    0,,PR0
         5 000476   100102 236100                    LDQ     66,,PR1
         5 000477   200003 756100                    STQ     ERRCODE,,AUTO

      528     3217    2              FPT_ERRMSG.CODE_=VECTOR(ERRCODE);

   3217  5 000500   777640 235007                    LDA     -96,DL
         5 000501   200146 452500                    STP2    @VECTR+1,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:85   
         5 000502   200146 236100                    LDQ     @VECTR+1,,AUTO
         5 000503   000003 036003                    ADLQ    3,DU
         5 000504   000172 757000 1                  STAQ    FPT_ERRMSG+2

      529     3218    2              FPT_ERRMSG.V.DCB#=B$TCB$->B$TCB.ALT$->B$ALT.DCB#;

   3218  5 000505   000000 471500                    LDP1    0,,PR0
         5 000506   100101 720100                    LXL0    65,,PR1
         5 000507   000216 740000 1                  STX0    FPT_ERRMSG+22

      530     3219    2              FPT_ERRMSG.BUF_=VECTOR(ERRBUF);

   3219  5 000510   000006 235000 6                  LDA     6
         5 000511   200146 452500                    STP2    @VECTR+1,,AUTO
         5 000512   200146 236100                    LDQ     @VECTR+1,,AUTO
         5 000513   000004 036003                    ADLQ    4,DU
         5 000514   000174 757000 1                  STAQ    FPT_ERRMSG+4

      531     3220    2              CALL M$ERRMSG(FPT_ERRMSG) ALTRET(BAG_IT);

   3220  5 000515   000170 630400 1                  EPPR0   FPT_ERRMSG
         5 000516   420000 713400                    CLIMB   alt,+8192
         5 000517   405000 401760                    pmme    nvectors=11
         5 000520   000537 702000 5                  TSX2    BAG_IT

      532     3221    3              IF B$JIT.MODE = %M_GHOST# THEN DO;

   3221  5 000521   000000 470400 xsym               LDP0    B$JIT$
         5 000522   000000 236100                    LDQ     0,,PR0
         5 000523   740000 376003                    ANQ     -16384,DU
         5 000524   100000 116003                    CMPQ    32768,DU
         5 000525   000537 601000 5                  TNZ     BAG_IT

      533     3222    3                 FPT_KEYIN.MESS_=VECTOR(ERRBUF.B1);

   3222  5 000526   000007 235000 6                  LDA     7
         5 000527   200146 452500                    STP2    @VECTR+1,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:86   
         5 000530   200146 236100                    LDQ     @VECTR+1,,AUTO
         5 000531   000004 036003                    ADLQ    4,DU
         5 000532   000224 757000 1                  STAQ    FPT_KEYIN+2

      534     3223    3                 CALL M$KEYIN(FPT_KEYIN) ALTRET(BAG_IT);

   3223  5 000533   000222 630400 1                  EPPR0   FPT_KEYIN
         5 000534   520000 713400                    CLIMB   alt,+40960
         5 000535   401400 401760                    pmme    nvectors=4
         5 000536   000537 702000 5                  TSX2    BAG_IT

      535     3224    3                 END;

      536     3225    2   BAG_IT:
      537     3226    2              END;

   3226  5 000537                       BAG_IT       null
      538     3227    1           FPT_GDS.RESULTS_=VECTOR(WORKSEG);

   3227  5 000537   000016 237000 6                  LDAQ    14
         5 000540   000146 757000 1                  STAQ    FPT_GDS+2

      539     3228    1           FPT_GDS.V.SEGSIZE#=(WORKSEG.BOUND+1)/4;

   3228  5 000541   000540 236000 1                  LDQ     WORKSEG
         5 000542   000020 772000                    QRL     16
         5 000543   000001 036007                    ADLQ    1,DL
         5 000544   000002 772000                    QRL     2
         5 000545   000000 620006                    EAX0    0,QL
         5 000546   000150 440000 1                  SXL0    FPT_GDS+4

      540     3229    1           CALL M$FDS(FPT_GDS) ALTRET(X1);

   3229  5 000547   000144 630400 1                  EPPR0   FPT_GDS
         5 000550   430002 713400                    CLIMB   alt,fds
         5 000551   400400 401760                    pmme    nvectors=2
         5 000552   000553 702000 5                  TSX2    X1
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:87   

      541     3230    1   X1:     CALL M$CLOSE(EL_CLOSE_CONFIG) ALTRET(X2);

   3230  5 000553   000106 630400 1     X1           EPPR0   EL_CLOSE_CONFIG
         5 000554   450001 713400                    CLIMB   alt,close
         5 000555   406000 401760                    pmme    nvectors=13
         5 000556   000557 702000 5                  TSX2    X2

      542     3231    1   X2:     CALL M$RELDCB(FPT_RELDCB) ALTRET(X3);

   3231  5 000557   000532 630400 1     X2           EPPR0   FPT_RELDCB
         5 000560   460003 713400                    CLIMB   alt,+24579
         5 000561   400000 401760                    pmme    nvectors=1
         5 000562   000563 702000 5                  TSX2    X3

      543     3232    1   X3:     RETURN;

   3232  5 000563   000000 702200 xent  X3           TSX2  ! X66_ARET

      544     3233        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:88   
      545     3234    1   BLD_MPC: PROC(IDX);

   3234  5 000564   200124 741300       BLD_MPC      STX1  ! DEVNM+2,,AUTO

      546     3235    2   DCL 1 IDX ALIGNED,
      547     3236    2         2 FIRST UBIN HALF UNAL,
      548     3237    2         2 N UBIN HALF UNAL;
      549     3238    2   DCL LAST UBIN;
      550     3239    2   DCL I SBIN;
      551     3240    2   DCL J SBIN;
      552     3241    2   DCL K SBIN;
      553     3242        /**/
      554     3243        /**/
      555     3244        /**/
      556     3245    2           LAST=IDX.FIRST+IDX.N-1;

   3245  5 000565   200125 470500                    LDP0    @IDX,,AUTO
         5 000566   000000 236100                    LDQ     0,,PR0
         5 000567   777777 376007                    ANQ     -1,DL
         5 000570   200146 756100                    STQ     @VECTR+1,,AUTO
         5 000571   000000 236100                    LDQ     0,,PR0
         5 000572   000022 772000                    QRL     18
         5 000573   200146 036100                    ADLQ    @VECTR+1,,AUTO
         5 000574   000001 136007                    SBLQ    1,DL
         5 000575   200126 756100                    STQ     LAST,,AUTO

      557     3246    3           DO I=IDX.FIRST TO LAST;

   3246  5 000576   000000 236100                    LDQ     0,,PR0
         5 000577   000022 772000                    QRL     18
         5 000600   200127 756100                    STQ     I,,AUTO
         5 000601   000722 710000 5                  TRA     s:3265+1

      558     3247    3              DEVKEY.C=TD$HEAD.DEVNAME(I);

   3247  5 000602   200127 235100                    LDA     I,,AUTO
         5 000603   000003 735000                    ALS     3
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:89   
         5 000604   200102 470500                    LDP0    HEAD$,,AUTO
         5 000605   040000 100505                    MLR     fill='040'O
         5 000606   000020 000010                    ADSC9   16,A,PR0                 cn=0,n=8
         5 000607   000547 200010 1                  ADSC9   DEVKEY                   cn=1,n=8

      559     3248    3              CALL READ(DEVKEY,MPCR$);

   3248  5 000610   200104 631500                    EPPR1   MPCR$,,AUTO
         5 000611   200142 451500                    STP1    @BLK$+1,,AUTO
         5 000612   000020 236000 6                  LDQ     16
         5 000613   200141 756100                    STQ     NEW_DEV+3,,AUTO
         5 000614   001221 701000 5                  TSX1    READ
         5 000615   000000 011000                    NOP     0

      560     3249    3              CALL GBLK(MPC$,SIZEW(MPC));

   3249  5 000616   000021 236000 6                  LDQ     17
         5 000617   200142 756100                    STQ     @BLK$+1,,AUTO
         5 000620   200105 630500                    EPPR0   MPC$,,AUTO
         5 000621   200141 450500                    STP0    NEW_DEV+3,,AUTO
         5 000622   001332 701000 5                  TSX1    GBLK
         5 000623   000000 011000                    NOP     0

      561     3250    3              MPC='0'B;

   3250  5 000624   200105 470500                    LDP0    MPC$,,AUTO
         5 000625   000100 100400                    MLR     fill='000'O
         5 000626   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         5 000627   000000 000024                    ADSC9   0,,PR0                   cn=0,n=20

      562     3251    3              MPC.THRESH_RATE = 1000;

   3251  5 000630   001750 235007                    LDA     1000,DL
         5 000631   200105 470500                    LDP0    MPC$,,AUTO
         5 000632   000002 755100                    STA     2,,PR0

      563     3252    3              MPC.DEVNM=DEVKEY.C;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:90   

   3252  5 000633   200105 470500                    LDP0    MPC$,,AUTO
         5 000634   040100 100400                    MLR     fill='040'O
         5 000635   000547 200010 1                  ADSC9   DEVKEY                   cn=1,n=8
         5 000636   000003 000010                    ADSC9   3,,PR0                   cn=0,n=8

      564     3253    4              DO J=0 TO 7;

   3253  5 000637   200130 450100                    STZ     J,,AUTO

      565     3254    5                 IF TD$MPC.IOCHAN.PRESENCE(J) THEN DO;

   3254  5 000640   200104 470500                    LDP0    MPCR$,,AUTO
         5 000641   200130 720100                    LXL0    J,,AUTO
         5 000642   000002 234110                    SZN     2,X0,PR0
         5 000643   000674 605000 5                  TPL     s:3260

      566     3255    5                    T$=IOM$(TD$MPC.IOCHAN.IOM(J))->IOM.CHAN$;

   3255  5 000644   000002 221110                    LDX1    2,X0,PR0
         5 000645   000777 361003                    ANX1    511,DU
         5 000646   000000 471400 xsym               LDP1    B$DS3$
         5 000647   100000 473511                    LDP3    0,X1,PR1
         5 000650   300003 236100                    LDQ     3,,PR3
         5 000651   200110 756100                    STQ     T$,,AUTO

      567     3256    6                    DO K=TD$MPC.IOCHAN.LOCHAN(J) TO TD$MPC.IOCHAN.HICHAN(J);

   3256  5 000652   000002 236110                    LDQ     2,X0,PR0
         5 000653   000011 772000                    QRL     9
         5 000654   000777 376007                    ANQ     511,DL
         5 000655   200131 756100                    STQ     K,,AUTO
         5 000656   000666 710000 5                  TRA     s:3258+1

      568     3257    6                       T$->CHAN.MPC$(K)=MPC$;

   3257  5 000657   200131 236100                    LDQ     K,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:91   
         5 000660   000005 402007                    MPY     5,DL
         5 000661   000000 620006                    EAX0    0,QL
         5 000662   200105 236100                    LDQ     MPC$,,AUTO
         5 000663   200110 470500                    LDP0    T$,,AUTO
         5 000664   000004 756110                    STQ     4,X0,PR0

      569     3258    6                       END;

   3258  5 000665   200131 054100                    AOS     K,,AUTO
         5 000666   200104 470500                    LDP0    MPCR$,,AUTO
         5 000667   200130 720100                    LXL0    J,,AUTO
         5 000670   000002 236110                    LDQ     2,X0,PR0
         5 000671   000777 376007                    ANQ     511,DL
         5 000672   200131 116100                    CMPQ    K,,AUTO
         5 000673   000657 605000 5                  TPL     s:3257

      570     3259    5                    END;

      571     3260    4                 END;

   3260  5 000674   200130 054100                    AOS     J,,AUTO
         5 000675   200130 235100                    LDA     J,,AUTO
         5 000676   000007 115007                    CMPA    7,DL
         5 000677   000640 604400 5                  TMOZ    s:3254

      572     3261    4              DO J=0 TO TD$MPC.NUMDEVS-1;

   3261  5 000700   200130 450100                    STZ     J,,AUTO
         5 000701   000712 710000 5                  TRA     s:3263+1

      573     3262    4                 CALL BLD_DEV(TD$MPC.DEVNAME(J));

   3262  5 000702   200130 236100                    LDQ     J,,AUTO
         5 000703   000023 736000                    QLS     19
         5 000704   000017 036003                    ADLQ    15,DU
         5 000705   200104 036100                    ADLQ    MPCR$,,AUTO
         5 000706   200133 756100                    STQ     K+2,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:92   
         5 000707   000730 701000 5                  TSX1    BLD_DEV
         5 000710   000000 011000                    NOP     0

      574     3263    4                 END;

   3263  5 000711   200130 054100                    AOS     J,,AUTO
         5 000712   200104 470500                    LDP0    MPCR$,,AUTO
         5 000713   000012 236100                    LDQ     10,,PR0
         5 000714   000022 772000                    QRL     18
         5 000715   200130 116100                    CMPQ    J,,AUTO
         5 000716   000702 605400 5                  TPNZ    s:3262

      575     3264    3              WORK$=MPCR$;

   3264  5 000717   200104 236100                    LDQ     MPCR$,,AUTO
         5 000720   200101 756100                    STQ     WORK$,,AUTO

      576     3265    3              END;

   3265  5 000721   200127 054100                    AOS     I,,AUTO
         5 000722   200126 236100                    LDQ     LAST,,AUTO
         5 000723   000602 604000 5                  TMI     s:3247
         5 000724   200127 116100                    CMPQ    I,,AUTO
         5 000725   000602 605000 5                  TPL     s:3247

      577     3266    2           RETURN;

   3266  5 000726   200124 221300                    LDX1  ! DEVNM+2,,AUTO
         5 000727   000001 702211                    TSX2  ! 1,X1

      578     3267    2   END BLD_MPC;
      579     3268        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:93   
      580     3269    1   BLD_DEV: PROC(DEVNM);

   3269  5 000730   200132 741300       BLD_DEV      STX1  ! K+1,,AUTO

      581     3270    2   DCL DEVNM CHAR(8);
      582     3271    2   DCL I SBIN;
      583     3272    2   DCL J SBIN;
      584     3273    2   DCL NEW_DEV BIT(1);
      585     3274        /**/
      586     3275    2           NEW_DEV = '0'B;

   3275  5 000731   200136 450100                    STZ     NEW_DEV,,AUTO

      587     3276    3           DO I = 0 TO NUMDEVS;

   3276  5 000732   200134 450100                    STZ     I,,AUTO
         5 000733   000754 710000 5                  TRA     s:3283+1

      588     3277    3              IF TD$HEAD.DEVNAME(I) = DEVNM

   3277  5 000734   200134 235100                    LDA     I,,AUTO
         5 000735   000003 735000                    ALS     3
         5 000736   200102 470500                    LDP0    HEAD$,,AUTO
         5 000737   200133 471500                    LDP1    @DEVNM,,AUTO
         5 000740   040100 106505                    CMPC    fill='040'O
         5 000741   000020 000010                    ADSC9   16,A,PR0                 cn=0,n=8
         5 000742   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         5 000743   000753 601000 5                  TNZ     s:3283

      589     3278    3              THEN
      590     3279    4              DO;

      591     3280    4                 CALL INSERT(TD$HEAD.DEVNAME(I),4,4,'DONE');

   3280  5 000744   200134 236100                    LDQ     I,,AUTO
         5 000745   000001 736000                    QLS     1
         5 000746   000000 620006                    EAX0    0,QL
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:94   
         5 000747   000000 236000 4                  LDQ     0
         5 000750   000021 756110                    STQ     17,X0,PR0

      592     3281    4                 NEW_DEV = '1'B;

   3281  5 000751   400000 236003                    LDQ     -131072,DU
         5 000752   200136 756100                    STQ     NEW_DEV,,AUTO

      593     3282    4                 END;

      594     3283    3              END;                         /* DO I = 0 TO NUMDEVS */

   3283  5 000753   200134 054100                    AOS     I,,AUTO
         5 000754   200134 236100                    LDQ     I,,AUTO
         5 000755   200120 116100                    CMPQ    NUMDEVS,,AUTO
         5 000756   000734 604400 5                  TMOZ    s:3277

      595     3284    2           DEVKEY.C=DEVNM;

   3284  5 000757   200133 470500                    LDP0    @DEVNM,,AUTO
         5 000760   040000 100500                    MLR     fill='040'O
         5 000761   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         5 000762   000547 200010 1                  ADSC9   DEVKEY                   cn=1,n=8

      596     3285    2           CALL READ(DEVKEY,DEVR$);

   3285  5 000763   200106 631500                    EPPR1   DEVR$,,AUTO
         5 000764   200142 451500                    STP1    @BLK$+1,,AUTO
         5 000765   000020 236000 6                  LDQ     16
         5 000766   200141 756100                    STQ     NEW_DEV+3,,AUTO
         5 000767   001221 701000 5                  TSX1    READ
         5 000770   000000 011000                    NOP     0

      597     3286    2           IF NEW_DEV

   3286  5 000771   200136 234100                    SZN     NEW_DEV,,AUTO
         5 000772   001023 605000 5                  TPL     s:3295
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:95   

      598     3287    2           THEN
      599     3288    3           DO;

      600     3289    3              CALL GBLK(DEV$,SIZEW(DEV));

   3289  5 000773   000023 236000 6                  LDQ     19
         5 000774   200142 756100                    STQ     @BLK$+1,,AUTO
         5 000775   200107 630500                    EPPR0   DEV$,,AUTO
         5 000776   200141 450500                    STP0    NEW_DEV+3,,AUTO
         5 000777   001332 701000 5                  TSX1    GBLK
         5 001000   000000 011000                    NOP     0

      601     3290    3              DEV = '0'B;

   3290  5 001001   200107 470500                    LDP0    DEV$,,AUTO
         5 001002   000100 100400                    MLR     fill='000'O
         5 001003   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         5 001004   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64

      602     3291    3              DEV.THRESH_RATE = 1000;

   3291  5 001005   001750 235007                    LDA     1000,DL
         5 001006   200107 470500                    LDP0    DEV$,,AUTO
         5 001007   000002 755100                    STA     2,,PR0

      603     3292    3              DEV.DEVNM = DEVNM;

   3292  5 001010   200133 470500                    LDP0    @DEVNM,,AUTO
         5 001011   200107 471500                    LDP1    DEV$,,AUTO
         5 001012   040100 100500                    MLR     fill='040'O
         5 001013   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         5 001014   100003 000010                    ADSC9   3,,PR1                   cn=0,n=8

      604     3293    3              DEV.DEVNUM = TD$DEV.DEVNUM;

   3293  5 001015   200106 471500                    LDP1    DEVR$,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:96   
         5 001016   100012 236100                    LDQ     10,,PR1
         5 001017   777777 376007                    ANQ     -1,DL
         5 001020   200107 473500                    LDP3    DEV$,,AUTO
         5 001021   300005 756100                    STQ     5,,PR3

      605     3294    3              END;

   3294  5 001022   001031 710000 5                  TRA     s:3296

      606     3295    2           ELSE CALL FIND_DEV(DEV$,DEVNM);

   3295  5 001023   200133 236100                    LDQ     @DEVNM,,AUTO
         5 001024   200142 756100                    STQ     @BLK$+1,,AUTO
         5 001025   200107 630500                    EPPR0   DEV$,,AUTO
         5 001026   200141 450500                    STP0    NEW_DEV+3,,AUTO
         5 001027   001127 701000 5                  TSX1    FIND_DEV
         5 001030   000000 011000                    NOP     0

      607     3296    3           IF TD$DEV.IOCHAN~='0'B THEN DO;

   3296  5 001031   200106 470500                    LDP0    DEVR$,,AUTO
         5 001032   000010 235100                    LDA     8,,PR0
         5 001033   001055 600000 5                  TZE     s:3301

      608     3297    3              T$=ADDR(IOM$(TD$DEV.IOCHAN.IOM)->IOM.CHAN$->CHAN(TD$DEV.IOCHAN.CHAN));

   3297  5 001034   000010 220100                    LDX0    8,,PR0
         5 001035   000777 360003                    ANX0    511,DU
         5 001036   000000 471400 xsym               LDP1    B$DS3$
         5 001037   100000 473510                    LDP3    0,X0,PR1
         5 001040   300003 474500                    LDP4    3,,PR3
         5 001041   000010 236100                    LDQ     8,,PR0
         5 001042   000011 772000                    QRL     9
         5 001043   000777 376007                    ANQ     511,DL
         5 001044   000005 402007                    MPY     5,DL
         5 001045   400000 635506                    EPPR5   0,QL,PR4
         5 001046   200110 455500                    STP5    T$,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:97   

      609     3298    3              IF T$->CHAN.DEV$(0)=ADDR(NIL) THEN

   3298  5 001047   500003 236100                    LDQ     3,,PR5
         5 001050   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001051   001123 601000 5                  TNZ     s:3310

      610     3299    3                 T$->CHAN.DEV$(0)=DEV$;

   3299  5 001052   200107 236100                    LDQ     DEV$,,AUTO
         5 001053   500003 756100                    STQ     3,,PR5

      611     3300    3              END;

   3300  5 001054   001123 710000 5                  TRA     s:3310

      612     3301    3           ELSE DO I=0 TO 7;

   3301  5 001055   200134 450100                    STZ     I,,AUTO

      613     3302    4              IF TD$MPC.IOCHAN.PRESENCE(I) THEN DO;

   3302  5 001056   200104 470500                    LDP0    MPCR$,,AUTO
         5 001057   200134 720100                    LXL0    I,,AUTO
         5 001060   000002 234110                    SZN     2,X0,PR0
         5 001061   001117 605000 5                  TPL     s:3309

      614     3303    4                 T$=IOM$(TD$MPC.IOCHAN.IOM(I))->IOM.CHAN$;

   3303  5 001062   000002 221110                    LDX1    2,X0,PR0
         5 001063   000777 361003                    ANX1    511,DU
         5 001064   000000 471400 xsym               LDP1    B$DS3$
         5 001065   100000 473511                    LDP3    0,X1,PR1
         5 001066   300003 236100                    LDQ     3,,PR3
         5 001067   200110 756100                    STQ     T$,,AUTO

      615     3304    5                 DO J=TD$MPC.IOCHAN.LOCHAN(I) TO TD$MPC.IOCHAN.HICHAN(I);
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:98   

   3304  5 001070   000002 236110                    LDQ     2,X0,PR0
         5 001071   000011 772000                    QRL     9
         5 001072   000777 376007                    ANQ     511,DL
         5 001073   200135 756100                    STQ     J,,AUTO
         5 001074   001111 710000 5                  TRA     s:3307+1

      616     3305    5                    IF T$->CHAN.DEV$(J)=ADDR(NIL) THEN

   3305  5 001075   200135 236100                    LDQ     J,,AUTO
         5 001076   000005 402007                    MPY     5,DL
         5 001077   200110 470500                    LDP0    T$,,AUTO
         5 001100   000003 236106                    LDQ     3,QL,PR0
         5 001101   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001102   001110 601000 5                  TNZ     s:3307

      617     3306    5                       T$->CHAN.DEV$(J)=DEV$;

   3306  5 001103   200135 236100                    LDQ     J,,AUTO
         5 001104   000005 402007                    MPY     5,DL
         5 001105   000000 620006                    EAX0    0,QL
         5 001106   200107 236100                    LDQ     DEV$,,AUTO
         5 001107   000003 756110                    STQ     3,X0,PR0

      618     3307    5                    END;

   3307  5 001110   200135 054100                    AOS     J,,AUTO
         5 001111   200104 470500                    LDP0    MPCR$,,AUTO
         5 001112   200134 720100                    LXL0    I,,AUTO
         5 001113   000002 236110                    LDQ     2,X0,PR0
         5 001114   000777 376007                    ANQ     511,DL
         5 001115   200135 116100                    CMPQ    J,,AUTO
         5 001116   001075 605000 5                  TPL     s:3305

      619     3308    4                 END;

      620     3309    3              END;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:99   

   3309  5 001117   200134 054100                    AOS     I,,AUTO
         5 001120   200134 235100                    LDA     I,,AUTO
         5 001121   000007 115007                    CMPA    7,DL
         5 001122   001056 604400 5                  TMOZ    s:3302

      621     3310    2           WORK$=DEVR$;

   3310  5 001123   200106 236100                    LDQ     DEVR$,,AUTO
         5 001124   200101 756100                    STQ     WORK$,,AUTO

      622     3311    2           RETURN;

   3311  5 001125   200132 221300                    LDX1  ! K+1,,AUTO
         5 001126   000001 702211                    TSX2  ! 1,X1

      623     3312    2   END BLD_DEV;
      624     3313        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:100  
      625     3314    1   FIND_DEV: PROC(PTR$,DEVNM);

   3314  5 001127   200140 741300       FIND_DEV     STX1  ! NEW_DEV+2,,AUTO

      626     3315        /**/
      627     3316    2   DCL PTR$ PTR;
      628     3317    2   DCL DEVNM CHAR(8);
      629     3318        /**/
      630     3319    2   DCL I UBIN;
      631     3320    2   DCL J UBIN;
      632     3321    2   DCL TEMP$ PTR;
      633     3322        /**/
      634     3323        /**/
      635     3324    3           DO I = 0 TO 7;

   3324  5 001130   200143 450100                    STZ     I,,AUTO

      636     3325    3              IF IOM$(I) ~= ADDR(NIL)

   3325  5 001131   000000 470400 xsym               LDP0    B$DS3$
         5 001132   200143 720100                    LXL0    I,,AUTO
         5 001133   000000 236110                    LDQ     0,X0,PR0
         5 001134   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001135   001171 600000 5                  TZE     s:3340

      637     3326    3              THEN
      638     3327    4              DO J = 0 TO %N_MAXCHANS-1;

   3327  5 001136   200144 450100                    STZ     J,,AUTO
         5 001137   001166 710000 5                  TRA     s:3339+3

      639     3328    4                 TEMP$ = IOM$(I)->IOM.CHAN$->CHAN.DEV$(J);

   3328  5 001140   000000 470400 xsym               LDP0    B$DS3$
         5 001141   200143 720100                    LXL0    I,,AUTO
         5 001142   000000 471510                    LDP1    0,X0,PR0
         5 001143   100003 473500                    LDP3    3,,PR1
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:101  
         5 001144   200144 236100                    LDQ     J,,AUTO
         5 001145   000005 402007                    MPY     5,DL
         5 001146   300003 236106                    LDQ     3,QL,PR3
         5 001147   200145 756100                    STQ     TEMP$,,AUTO

      640     3329    4                 IF TEMP$ ~= ADDR(NIL)

   3329  5 001150   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001151   001163 600000 5                  TZE     s:3339

      641     3330    4                 THEN                      /* CHECK FOR DEVICE */
      642     3331    5                 DO;

      643     3332    5                    IF TEMP$->DEV.DEVNM = DEVNM

   3332  5 001152   200145 474500                    LDP4    TEMP$,,AUTO
         5 001153   200142 475500                    LDP5    @DEVNM,,AUTO
         5 001154   040100 106500                    CMPC    fill='040'O
         5 001155   400003 000010                    ADSC9   3,,PR4                   cn=0,n=8
         5 001156   500000 000010                    ADSC9   0,,PR5                   cn=0,n=8
         5 001157   001163 601000 5                  TNZ     s:3339

      644     3333    5                    THEN                   /* FOUND IT */
      645     3334    6                    DO;

      646     3335    6                       PTR$ = TEMP$;

   3335  5 001160   200141 476500                    LDP6    @PTR$,,AUTO
         5 001161   600000 756100                    STQ     0,,PR6

      647     3336    6                       GOTO FOUND_IT;

   3336  5 001162   001176 710000 5                  TRA     FOUND_IT

      648     3337    6                       END;                /* IF DEV.DEVNM = DEVNM */
      649     3338    5                    END;                   /* IF TEMP$ ~= ADDR(NIL) */
      650     3339    4                 END;                      /* DO J = 0 TO %N_MAXCHANS-1 */
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:102  

   3339  5 001163   200144 235100                    LDA     J,,AUTO
         5 001164   000001 035007                    ADLA    1,DL
         5 001165   200144 755100                    STA     J,,AUTO
         5 001166   200144 235100                    LDA     J,,AUTO
         5 001167   000200 115007                    CMPA    128,DL
         5 001170   001140 602000 5                  TNC     s:3328

      651     3340    3              END;                         /* DO I = 0 TO 7 */

   3340  5 001171   200143 235100                    LDA     I,,AUTO
         5 001172   000001 035007                    ADLA    1,DL
         5 001173   200143 755100                    STA     I,,AUTO
         5 001174   000010 115007                    CMPA    8,DL
         5 001175   001131 602000 5                  TNC     s:3325

      652     3341    2   FOUND_IT :
      653     3342    2           RETURN;

   3342  5 001176   200140 221300       FOUND_IT     LDX1  ! NEW_DEV+2,,AUTO
         5 001177   000001 702211                    TSX2  ! 1,X1

      654     3343    2   END FIND_DEV;
      655     3344        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:103  
      656     3345    1   GETSPACE: PROC(VECTR);

   3345  5 001200   200144 741300       GETSPACE     STX1  ! J,,AUTO

      657     3346    2   DCL VECTR BIT(72) ALIGNED;
      658     3347    2           FPT_GDS.RESULTS_=VECTOR(VECTR);

   3347  5 001201   000016 235000 6                  LDA     14
         5 001202   200145 236100                    LDQ     @VECTR,,AUTO
         5 001203   000146 757000 1                  STAQ    FPT_GDS+2

      659     3348    2           CALL M$SENV;

   3348  5 001204   010011 713400                    CLIMB   4105
         5 001205   000000 401760                    pmme    nvectors=0

      660     3349    2           CALL M$GDS(FPT_GDS) ALTRET(REPORT_ERR);

   3349  5 001206   000144 630400 1                  EPPR0   FPT_GDS
         5 001207   430001 713400                    CLIMB   alt,gds
         5 001210   400400 401760                    pmme    nvectors=2
         5 001211   001216 702000 5                  TSX2    REPORT_ERR

      661     3350    2           CALL M$RENV;

   3350  5 001212   010016 713400                    CLIMB   4110
         5 001213   000000 401760                    pmme    nvectors=0

      662     3351    2           RETURN;

   3351  5 001214   200144 221300                    LDX1  ! J,,AUTO
         5 001215   000001 702211                    TSX2  ! 1,X1

      663     3352    2   REPORT_ERR:
      664     3353    2           UNWIND TO BAD_RETURN;

   3353  5 001216   200116 237300       REPORT_ERR   LDAQ  ! BAD_RETURN,,AUTO
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:104  
         5 001217   000000 700200 xent               TSX0  ! X66_AUNWIND
         5 001220   000000 000200                    ZERO    0,128

      665     3354    2   END GETSPACE;
      666     3355        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:105  
      667     3356    1   READ:   PROC(KEY,REC$);

   3356  5 001221   200140 741300       READ         STX1  ! NEW_DEV+2,,AUTO

      668     3357    2   DCL 1 KEY,
      669     3358    2         2 L UBIN BYTE UNAL,
      670     3359    2         2 C CHAR(KEY.L);
      671     3360    2   DCL REC$ PTR;
      672     3361    2           FPT_READ.KEY_=VECTOR(KEY);

   3361  5 001222   200141 470500                    LDP0    @KEY,,AUTO
         5 001223   000100 101500                    MRL     fill='000'O
         5 001224   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         5 001225   200146 000002                    ADSC9   @VECTR+1,,AUTO           cn=0,n=2
         5 001226   200146 220100                    LDX0    @VECTR+1,,AUTO
         5 001227   000001 622010                    EAX2    1,X0
         5 001230   000000 635012                    EAA     0,X2
         5 001231   000002 771000                    ARL     2
         5 001232   000140 135007                    SBLA    96,DL
         5 001233   200141 236100                    LDQ     @KEY,,AUTO
         5 001234   000154 757000 1                  STAQ    FPT_READ+2

      673     3362    2           FPT_READ.BUF_.BUF$=WORK$;

   3362  5 001235   200101 236100                    LDQ     WORK$,,AUTO
         5 001236   000157 756000 1                  STQ     FPT_READ+5

      674     3363    2           FPT_READ.BUF_.BOUND=WORKSEG.BOUND-POFFC(WORK$,WORKSEG.PTR$);

   3363  5 001237   000541 236000 1                  LDQ     WORKSEG+1
         5 001240   000020 772000                    QRL     16
         5 001241   200146 756100                    STQ     @VECTR+1,,AUTO
         5 001242   200101 236100                    LDQ     WORK$,,AUTO
         5 001243   000020 772000                    QRL     16
         5 001244   200146 136100                    SBLQ    @VECTR+1,,AUTO
         5 001245   200147 756100                    STQ     @VECTR+2,,AUTO
         5 001246   000540 236000 1                  LDQ     WORKSEG
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:106  
         5 001247   000020 772000                    QRL     16
         5 001250   200147 136100                    SBLQ    @VECTR+2,,AUTO
         5 001251   000020 736000                    QLS     16
         5 001252   000156 676000 1                  ERQ     FPT_READ+4
         5 001253   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 001254   000156 656000 1                  ERSQ    FPT_READ+4

      675     3364    2           CALL M$READ(FPT_READ) ALTRET(CHK_LD);

   3364  5 001255   000152 630400 1                  EPPR0   FPT_READ
         5 001256   440000 713400                    CLIMB   alt,read
         5 001257   401400 401760                    pmme    nvectors=4
         5 001260   001275 702000 5                  TSX2    CHK_LD

      676     3365    2           REC$=WORK$;

   3365  5 001261   200101 236100                    LDQ     WORK$,,AUTO
         5 001262   200142 470500                    LDP0    @REC$,,AUTO
         5 001263   000000 756100                    STQ     0,,PR0

      677     3366    2           WORK$=PINCRW(WORK$,(DCB$->F$DCB.ARS#+3)/4);

   3366  5 001264   200121 471500                    LDP1    DCB$,,AUTO
         5 001265   100000 236100                    LDQ     0,,PR1
         5 001266   000003 036007                    ADLQ    3,DL
         5 001267   000004 506007                    DIV     4,DL
         5 001270   000022 736000                    QLS     18
         5 001271   200101 036100                    ADLQ    WORK$,,AUTO
         5 001272   200101 756100                    STQ     WORK$,,AUTO

      678     3367    2           RETURN;

   3367  5 001273   200140 221300                    LDX1  ! NEW_DEV+2,,AUTO
         5 001274   000001 702211                    TSX2  ! 1,X1

   3366  5 001275                       CHK_LD       null
      679     3368    2   CHK_LD: ;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:107  
      680     3369    3           IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$LD THEN DO;

   3369  5 001275   000000 470400 xsym               LDP0    B$TCB$
         5 001276   000000 471500                    LDP1    0,,PR0
         5 001277   100102 236100                    LDQ     66,,PR1
         5 001300   377770 376007                    ANQ     131064,DL
         5 001301   000070 116007                    CMPQ    56,DL
         5 001302   001327 601000 5                  TNZ     s:3374

      681     3370    3              CALL GETSPACE(WORKSEG);

   3370  5 001303   000001 236000 6                  LDQ     1
         5 001304   200145 756100                    STQ     @VECTR,,AUTO
         5 001305   001200 701000 5                  TSX1    GETSPACE
         5 001306   000000 011000                    NOP     0

      682     3371    3              FPT_READ.BUF_.BOUND=WORKSEG.BOUND-POFFC(WORK$,WORKSEG.PTR$);

   3371  5 001307   000541 236000 1                  LDQ     WORKSEG+1
         5 001310   000020 772000                    QRL     16
         5 001311   200146 756100                    STQ     @VECTR+1,,AUTO
         5 001312   200101 236100                    LDQ     WORK$,,AUTO
         5 001313   000020 772000                    QRL     16
         5 001314   200146 136100                    SBLQ    @VECTR+1,,AUTO
         5 001315   200147 756100                    STQ     @VECTR+2,,AUTO
         5 001316   000540 236000 1                  LDQ     WORKSEG
         5 001317   000020 772000                    QRL     16
         5 001320   200147 136100                    SBLQ    @VECTR+2,,AUTO
         5 001321   000020 736000                    QLS     16
         5 001322   000156 676000 1                  ERQ     FPT_READ+4
         5 001323   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 001324   000156 656000 1                  ERSQ    FPT_READ+4

      683     3372    3              CALL M$RETRY;

   3372  5 001325   010010 713400                    CLIMB   4104
         5 001326   000000 401760                    pmme    nvectors=0
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:108  

      684     3373    3              END;

      685     3374    2           UNWIND TO BAD_RETURN;

   3374  5 001327   200116 237300                    LDAQ  ! BAD_RETURN,,AUTO
         5 001330   000000 700200 xent               TSX0  ! X66_AUNWIND
         5 001331   000000 000200                    ZERO    0,128

      686     3375    2   END READ;
      687     3376        %EJECT;
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:109  
      688     3377    1   GBLK:   PROC(BLK$,SIZE);

   3377  5 001332   200140 741300       GBLK         STX1  ! NEW_DEV+2,,AUTO

      689     3378    2   DCL BLK$ PTR;
      690     3379    2   DCL SIZE SBIN;
      691     3380    2           WORDS_USED = WORDS_USED + SIZE;

   3380  5 001333   200142 470500                    LDP0    @SIZE,,AUTO
         5 001334   000542 236000 1                  LDQ     WORDS_USED
         5 001335   000000 036100                    ADLQ    0,,PR0
         5 001336   000542 756000 1                  STQ     WORDS_USED

      692     3381    3           DO WHILE(WORDS_USED > WORDS_PER_GRAN);

   3381  5 001337   002000 116007                    CMPQ    1024,DL
         5 001340   001355 604400 5                  TMOZ    s:3386

      693     3382    3              CALL M$EXTEND(FPT_EXTEND) ALTRET(NO_MEM);

   3382  5 001341   000526 630400 1                  EPPR0   FPT_EXTEND
         5 001342   440005 713400                    CLIMB   alt,+16389
         5 001343   400000 401760                    pmme    nvectors=1
         5 001344   001367 702000 5                  TSX2    NO_MEM

      694     3383    3              GRAN# = GRAN# + 1;

   3383  5 001345   000543 235000 1                  LDA     GRAN#
         5 001346   000001 035007                    ADLA    1,DL
         5 001347   000543 755000 1                  STA     GRAN#

      695     3384    3              WORDS_USED = WORDS_USED - WORDS_PER_GRAN;

   3384  5 001350   002000 336007                    LCQ     1024,DL
         5 001351   000542 056000 1                  ASQ     WORDS_USED

      696     3385    3              END;                         /* DO WHILE */
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:110  

   3385  5 001352   000542 235000 1                  LDA     WORDS_USED
         5 001353   002000 115007                    CMPA    1024,DL
         5 001354   001341 605400 5                  TPNZ    s:3382

      697     3386    2           BLK$=TABLE$;

   3386  5 001355   200100 236100                    LDQ     TABLE$,,AUTO
         5 001356   200141 470500                    LDP0    @BLK$,,AUTO
         5 001357   000000 756100                    STQ     0,,PR0

      698     3387    2           TABLE$=PINCRW(TABLE$,SIZE);

   3387  5 001360   200142 471500                    LDP1    @SIZE,,AUTO
         5 001361   100000 236100                    LDQ     0,,PR1
         5 001362   000022 736000                    QLS     18
         5 001363   200100 036100                    ADLQ    TABLE$,,AUTO
         5 001364   200100 756100                    STQ     TABLE$,,AUTO

      699     3388    2           RETURN;

   3388  5 001365   200140 221300                    LDX1  ! NEW_DEV+2,,AUTO
         5 001366   000001 702211                    TSX2  ! 1,X1

      700     3389    2   NO_MEM:
      701     3390    2           UNWIND TO BAD_RETURN;

   3390  5 001367   200116 237300       NO_MEM       LDAQ  ! BAD_RETURN,,AUTO
         5 001370   000000 700200 xent               TSX0  ! X66_AUNWIND
         5 001371   000000 000200                    ZERO    0,128
      702     3391    2   END GBLK;
      703     3392    1   END ELT$INIT;
      704     3393        %EOD;

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:111  
--  Include file information  --

   TD$STRUCT.:E05TOU  is referenced.
   EL_PERR_C.:E05TOU  is referenced.
   I_SUBS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   IT_SUBS_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ELT$INIT.
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:112  

 **** Variables and constants ****

  ****  Section 001  Data  ELT$INIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   424-0-0/d STRC(432)   r     1 BOOTFLAG                 464-0-0/d STRC(1080)  r     1 CLOSE_ELF_DATA
   240-0-0/d STRC(2088)  r     1 CREATE_ELF_DATA          547-0-0/w STRC(81)    r     1 DEVKEY
   460-0-0/w STRC(117)   r     1 ELF_DATA_ATTR            106-0-0/d STRC(1080)  r     1 EL_CLOSE_CONFIG
   536-0-0/w BIT         r     1 EL_THRESHOLD             170-0-0/d STRC(936)   r     1 FPT_ERRMSG
   526-0-0/d STRC(144)   r     1 FPT_EXTEND               144-0-0/d STRC(216)   r     1 FPT_GDS
     0-0-0/d STRC(288)   r     1 FPT_GETDCB               222-0-0/d STRC(504)   r     1 FPT_KEYIN
    10-0-0/d STRC(2088)  r     1 FPT_OPEN_CONFIG          152-0-0/d STRC(504)   r     1 FPT_READ
   532-0-0/d STRC(144)   r     1 FPT_RELDCB               543-0-0/w UBIN        r     1 GRAN#
   544-0-0/w STRC(18)    r     1 HEADKEY                  545-0-0/w STRC(45)    r     1 IOMKEY
   440-0-0/d STRC(540)   r     1 MONINFO                  332-0-0/d STRC(2088)  r     1 UPDATE_ELF_DATA
   104-0-0/c STRC(72)    r     1 VLP_ACCT_SYS             522-0-0/c STRC(81)    r     1 VLP_NAME
   102-0-0/c STRC(72)    r     1 VLP_NAME_CONFIG          542-0-0/w SBIN        r     1 WORDS_USED
   540-0-0/d STRC(72)    r     1 WORKSEG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   141-0-0/w PTR         r     1 @BLK$                    133-0-0/w PTR         r     1 @DEVNM
   142-0-0/w PTR         r     1 @DEVNM                   125-0-0/w PTR         r     1 @IDX
   141-0-0/w PTR         r     1 @KEY                     141-0-0/w PTR         r     1 @PTR$
   142-0-0/w PTR         r     1 @REC$                    142-0-0/w PTR         r     1 @SIZE
   145-0-0/w PTR         r     1 @VECTR                   116-0-0/d REMB        r     1 BAD_RETURN
    *0-0-0/w PTR         r     1 BLK$                     121-0-0/w PTR         r     1 DCB$
   107-0-0/w PTR         r     1 DEV$                     122-0-0/c CHAR(8)     r     1 DEVNM
    *0-0-0/c CHAR(8)     r     1 DEVNM                     *0-0-0/c CHAR(8)     r     1 DEVNM
   106-0-0/w PTR         r     1 DEVR$                      4-0-0/w STRC(2160)  r     1 ERRBUF
     3-0-0/b BIT         r     1 ERRCODE                    3-0-0/b STRC        r     1 ERRCODE2
   102-0-0/w PTR         r     1 HEAD$                    113-0-0/w SBIN        r     1 I
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:113  
   127-0-0/w SBIN        r     1 I                        134-0-0/w SBIN        r     1 I
   143-0-0/w UBIN        r     1 I                         *0-0-0/w STRC        r     1 IDX
   103-0-0/w PTR         r     1 IOMR$                    112-0-0/w PTR         r     1 IOM_ENTRY$
   114-0-0/w SBIN        r     1 J                        130-0-0/w SBIN        r     1 J
   135-0-0/w SBIN        r     1 J                        144-0-0/w UBIN        r     1 J
   131-0-0/w SBIN        r     1 K                         *0-0-0/c ASTR(9)     r     1 KEY
   126-0-0/w UBIN        r     1 LAST                     105-0-0/w PTR         r     1 MPC$
   104-0-0/w PTR         r     1 MPCR$                    136-0-0/b BIT         r     1 NEW_DEV
   120-0-0/w SBIN        r     1 NUMDEVS                  111-0-0/w PTR         r     1 P$
    *0-0-0/w PTR         r     1 PTR$                      *0-0-0/w PTR         r     1 REC$
    *0-0-0/w SBIN        r     1 SIZE                     110-0-0/w PTR         r     1 T$
   100-0-0/w PTR         r     1 TABLE$                   145-0-0/w PTR         r     1 TEMP$
    *0-0-0/w BIT (72)    r     1 VECTR                    101-0-0/w PTR         r     1 WORK$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS3$                     0-0-0/w PTR         r     1 B$DS4$
     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w BIT         r     1 EL_SNAPFLG

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/w STRC(180)   r     1 CHAN(0:0)
     0-0-0/w STRC(576)   r     1 DEV                        0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(144)   r     1 IOM                        0-0-0/w PTR         r     1 IOM$(0:7)
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$ELF_DATA
     0-0-0/w STRC(180)   r     1 MPC                        0-0-0/w STRC(396)   r     1 TD$DEV
     0-0-0/w STRC(648)   r     1 TD$HEAD                    0-0-0/w STRC(612)   r     1 TD$MPC

PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:114  

   Procedure ELT$INIT requires 762 words for executable code.
   Procedure ELT$INIT requires 106 words of local(AUTO) storage.
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:115  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:116  
          MINI XREF LISTING

B$ALT.CODE
       875**DCL       875--REDEF     876--REDEF     876--REDEF
B$ALT.DCB#
       876**DCL      3218>>ASSIGN
B$ALT.ERR
       876**DCL      3216>>ASSIGN
B$ALT.ERR.CODE
       877**DCL      3153>>IF       3369>>IF
B$ALT.ERR.ERR#
       877**DCL       877--REDEF
B$ALT.EVID
       876**DCL       876--REDEF     876--REDEF
B$DS3$
       868**DCL      2031--IMP-PTR  3123>>ASSIGN   3131>>IF       3161>>ASSIGN   3172>>ASSIGN   3182>>ASSIGN
      3255>>ASSIGN   3297>>ASSIGN   3303>>ASSIGN   3325>>IF       3328>>ASSIGN
B$DS4$
       869**DCL      3125>>ASSIGN   3163>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      2158**DCL      2158--REDEF
B$JIT.ERR.MID
      2065**DCL      2065--REDEF
B$JIT.JRESPEAK
      2226**DCL      2227--REDEF
B$JIT.MODE
      2059**DCL      3141>>IF       3221>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
      2335**DCL      2335--REDEF    2336--REDEF
B$JIT.PNR
      2239**DCL      2239--REDEF
B$JIT.TSLINE
      2333**DCL      2334--REDEF
B$JIT$
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:117  
      2049**DCL      2059--IMP-PTR  3141>>IF       3221>>IF
B$TCB.ALT$
       871**DCL      3153>>IF       3216>>ASSIGN   3218>>ASSIGN   3369>>IF
B$TCB$
       867**DCL      3153>>IF       3216>>ASSIGN   3218>>ASSIGN   3369>>IF
BAD_RETURN
      2045**DCL      3107<<REMEMBR  3353>>UNWIND   3374>>UNWIND   3390>>UNWIND
BAG_IT
      3226**LABEL    3140--CALLALT  3143--CALLALT  3150--GOTO     3220--CALLALT  3223--CALLALT
BLD_DEV
      3269**PROC     3205--CALL     3262--CALL
BLD_MPC
      3234**PROC     3199--CALL     3200--CALL     3201--CALL     3202--CALL
BLK$ IN PROCEDURE GBLK
      3378**DCL      3377--PROC     3386<<ASSIGN
BOOTFLAG
       716**DCL      3117<>CALL
BUILD_NEW_ELF_DATA
      3160**LABEL    3145--GOTO     3154--GOTO
CHAN
      3081**DCL      3147--ASSIGN   3185--CALL     3188<<ASSIGN   3297--ASSIGN
CHAN.DEV$
      3086**DCL      3191<<ASSIGN   3298>>IF       3299<<ASSIGN   3305>>IF       3306<<ASSIGN   3328>>ASSIGN
CHAN.MPC$
      3087**DCL      3190<<ASSIGN   3257<<ASSIGN
CHAN.THRESH_RATE
      3085**DCL      3189<<ASSIGN
CHK_LD IN PROCEDURE READ
      3366**LABEL    3364--CALLALT
CLOSE_ELF_DATA
       795**DCL      3115<>CALL     3133<>CALL     3211<>CALL
CLOSE_ELF_DATA.SN_
       795**DCL       795--REDEF
CLOSE_ELF_DATA.UTL_
       796**DCL       796--REDEF
CLOSE_ELF_DATA.V
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:118  
       800**DCL       795--DCLINIT
CLOSE_ELF_DATA.V.EXPIRE#
       810**DCL       810--REDEF
CLOSE_ELF_DATA.V.TYPE#
       808**DCL       808--REDEF
CLOSE_ELF_DATA.V.XTNSIZE#
       805**DCL       805--REDEF     807--REDEF
CREATE_ELF_DATA
       542**DCL      3160<>CALL
CREATE_ELF_DATA.ACSVEH_
       544**DCL       545--REDEF
CREATE_ELF_DATA.ALTKEYS_
       550**DCL       551--REDEF     551--REDEF
CREATE_ELF_DATA.HDR_
       549**DCL       550--REDEF
CREATE_ELF_DATA.TAB_
       548**DCL       549--REDEF
CREATE_ELF_DATA.UHL_
       542**DCL       543--REDEF     543--REDEF
CREATE_ELF_DATA.V
       551**DCL       542--DCLINIT
CREATE_ELF_DATA.V.FSN#
       582**DCL       582--REDEF     582--REDEF
CREATE_ELF_DATA.WSN_
       548**DCL       548--REDEF
DCB$
      2047**DCL      3109<<ASSIGN   3167>>ASSIGN   3366>>ASSIGN
DEV
      3094**DCL      3289--CALL     3290<<ASSIGN
DEV.DEVNM
      3099**DCL      3292<<ASSIGN   3332>>IF
DEV.DEVNUM
      3100**DCL      3293<<ASSIGN
DEV.THRESH_RATE
      3098**DCL      3291<<ASSIGN
DEV$
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:119  
      2036**DCL      3094--IMP-PTR  3289<>CALL     3290>>ASSIGN   3291>>ASSIGN   3292>>ASSIGN   3293>>ASSIGN
      3295<>CALL     3299>>ASSIGN   3306>>ASSIGN
DEVKEY
      3070**DCL      3248<>CALL     3285<>CALL
DEVKEY.C
      3072**DCL      3247<<ASSIGN   3252>>ASSIGN   3284<<ASSIGN
DEVNM
      2048**DCL      3204<<ASSIGN   3205<>CALL
DEVNM IN PROCEDURE BLD_DEV
      3270**DCL      3269--PROC     3277>>IF       3284>>ASSIGN   3292>>ASSIGN   3295<>CALL
DEVNM IN PROCEDURE FIND_DEV
      3317**DCL      3314--PROC     3332>>IF
DEVR$
      2035**DCL      3035--IMP-PTR  3285<>CALL     3293>>ASSIGN   3296>>IF       3297>>ASSIGN   3297>>ASSIGN
      3310>>ASSIGN
ELF_DATA_ATTR
       750**DCL       545--DCLINIT
ELF_DATA_ATTR.Q
       751**DCL       750--DCLINIT
EL_CLOSE_CONFIG
       341**DCL      3230<>CALL
EL_CLOSE_CONFIG.SN_
       341**DCL       341--REDEF
EL_CLOSE_CONFIG.UTL_
       342**DCL       342--REDEF
EL_CLOSE_CONFIG.V
       346**DCL       341--DCLINIT
EL_CLOSE_CONFIG.V.DCB#
       347**DCL      3111<<ASSIGN
EL_CLOSE_CONFIG.V.EXPIRE#
       356**DCL       356--REDEF
EL_CLOSE_CONFIG.V.TYPE#
       354**DCL       354--REDEF
EL_CLOSE_CONFIG.V.XTNSIZE#
       351**DCL       351--REDEF     353--REDEF
EL_SNAPFLG
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:120  
      2023**DCL      3118>>IF
EL_THRESHOLD
      2022**DCL      3149<<ASSIGN   3213<<ASSIGN
ERRBUF
       862**DCL      3139--ASSIGN   3219--ASSIGN
ERRBUF.B1
       863**DCL      3142--ASSIGN   3222--ASSIGN
ERRCODE
       856**DCL       857--REDEF    3138--ASSIGN   3216<<ASSIGN   3217--ASSIGN
ERRCODE2.CODE
       860**DCL      3137<<ASSIGN
ERRCODE2.FCG
       858**DCL      3134<<ASSIGN
ERRCODE2.MON
       859**DCL      3135<<ASSIGN
ERRCODE2.SEV
       861**DCL      3136<<ASSIGN
F$DCB.ACTPOS
       121**DCL       121--REDEF
F$DCB.ARS#
        95**DCL        95--REDEF    3167>>ASSIGN   3366>>ASSIGN
F$DCB.ATTR
       114**DCL       115--REDEF
F$DCB.BORROW
       129**DCL       129--REDEF     129--REDEF     129--REDEF
F$DCB.DCBNAME.L
       143**DCL       143--IMP-SIZ
F$DCB.EOMCHAR#
        99**DCL        99--REDEF
F$DCB.FCD#
       108**DCL      3114>>IF
F$DCB.FLDID
       124**DCL       124--REDEF
F$DCB.FORM$
       118**DCL       118--REDEF
F$DCB.FSECT
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:121  
       134**DCL       134--REDEF
F$DCB.FSN#
       111**DCL       111--REDEF     111--REDEF     112--REDEF
F$DCB.HEADER$
       117**DCL       117--REDEF
F$DCB.IXTNSIZE#
       115**DCL       115--REDEF
F$DCB.LASTSTA$
       104**DCL       104--REDEF
F$DCB.LVL
       130**DCL       130--REDEF
F$DCB.NAME#.C
       105**DCL       105--REDEF
F$DCB.NOEOF
       127**DCL       127--REDEF
F$DCB.NRECS#
       116**DCL       116--REDEF
F$DCB.NRECX
       135**DCL       135--REDEF
F$DCB.OHDR
       127**DCL       127--REDEF
F$DCB.ORG#
       110**DCL       110--REDEF
F$DCB.PRECNO
       133**DCL       133--REDEF
F$DCB.RCSZ
       139**DCL       139--REDEF
F$DCB.RES#
       106**DCL       106--REDEF
F$DCB.SETX
       118**DCL       118--REDEF
F$DCB.TAB$
       118**DCL       118--REDEF
F$DCB.TDA
       132**DCL       133--REDEF
F$DCB.WSN#
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:122  
       106**DCL       106--REDEF
FIND_DEV
      3314**PROC     3295--CALL
FOUND_IT IN PROCEDURE FIND_DEV
      3342**LABEL    3336--GOTO
FPT_ERRMSG
       431**DCL      3140<>CALL     3220<>CALL
FPT_ERRMSG.BUF_
       431**DCL      3139<<ASSIGN   3219<<ASSIGN
FPT_ERRMSG.CODE_
       431**DCL      3138<<ASSIGN   3217<<ASSIGN
FPT_ERRMSG.V
       435**DCL       431--DCLINIT
FPT_ERRMSG.V.DCB#
       435**DCL      3218<<ASSIGN
FPT_EXTEND
       853**DCL      3382<>CALL
FPT_EXTEND.V
       853**DCL       853--DCLINIT
FPT_GDS
       372**DCL      3229<>CALL     3349<>CALL
FPT_GDS.RESULTS_
       372**DCL      3227<<ASSIGN   3347<<ASSIGN
FPT_GDS.V
       372**DCL       372--DCLINIT
FPT_GDS.V.SEGSIZE#
       375**DCL      3228<<ASSIGN
FPT_GETDCB
       157**DCL      3108<>CALL
FPT_GETDCB.V
       158**DCL       157--DCLINIT
FPT_KEYIN
       458**DCL      3143<>CALL     3223<>CALL
FPT_KEYIN.MESS_
       458**DCL      3142<<ASSIGN   3222<<ASSIGN
FPT_KEYIN.V
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:123  
       461**DCL       458--DCLINIT
FPT_OPEN_CONFIG
       231**DCL      3113<>CALL
FPT_OPEN_CONFIG.ACSVEH_
       233**DCL       234--REDEF
FPT_OPEN_CONFIG.ALTKEYS_
       239**DCL       240--REDEF     240--REDEF
FPT_OPEN_CONFIG.HDR_
       238**DCL       239--REDEF
FPT_OPEN_CONFIG.TAB_
       237**DCL       238--REDEF
FPT_OPEN_CONFIG.UHL_
       231**DCL       232--REDEF     232--REDEF
FPT_OPEN_CONFIG.V
       240**DCL       231--DCLINIT
FPT_OPEN_CONFIG.V.DCB#
       240**DCL       158--DCLINIT  3109--ASSIGN   3110>>ASSIGN   3111>>ASSIGN   3112>>ASSIGN
FPT_OPEN_CONFIG.V.FSN#
       271**DCL       271--REDEF     271--REDEF
FPT_OPEN_CONFIG.WSN_
       237**DCL       237--REDEF
FPT_READ
       395**DCL      3364<>CALL
FPT_READ.BUF_.BOUND
       397**DCL      3363<<ASSIGN   3371<<ASSIGN
FPT_READ.BUF_.BUF$
       398**DCL      3362<<ASSIGN
FPT_READ.KEY_
       395**DCL      3361<<ASSIGN
FPT_READ.STATION_
       398**DCL       399--REDEF
FPT_READ.V
       399**DCL       395--DCLINIT
FPT_READ.V.DCB#
       399**DCL      3110<<ASSIGN
FPT_READ.V.DVBYTE.REREAD#
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:124  
       410**DCL       410--REDEF
FPT_READ.V.INDX#
       408**DCL       408--REDEF
FPT_RELDCB
      2019**DCL      3231<>CALL
FPT_RELDCB.V
      2019**DCL      2019--DCLINIT
FPT_RELDCB.V.DCB#
      2019**DCL      3112<<ASSIGN
GBLK
      3377**PROC     3170--CALL     3181--CALL     3185--CALL     3249--CALL     3289--CALL
GETSPACE
      3345**PROC     3126--CALL     3164--CALL     3370--CALL
GRAN#
      2043**DCL      3168<<ASSIGN   3383<<ASSIGN   3383>>ASSIGN
HEAD$
      2030**DCL      2969--IMP-PTR  3128<>CALL     3130>>DOINDEX  3166<>CALL     3167>>ASSIGN   3167>>ASSIGN
      3178>>DOINDEX  3199>>CALL     3200>>CALL     3201>>CALL     3202>>CALL     3203>>DOINDEX  3203>>DOINDEX
      3203>>DOINDEX  3204>>ASSIGN   3247>>ASSIGN   3277>>IF       3280>>CALLBLT
HEADKEY
      3060**DCL      3128<>CALL     3166<>CALL
I
      2040**DCL      3130<<DOINDEX  3131>>IF       3171<<DOINDEX  3172>>ASSIGN   3178<<DOINDEX  3179>>CALLBLT
      3182>>ASSIGN   3203<<DOINDEX  3204>>ASSIGN
I IN PROCEDURE BLD_DEV
      3271**DCL      3276<<DOINDEX  3277>>IF       3280>>CALLBLT  3301<<DOINDEX  3302>>IF       3303>>ASSIGN
      3304>>DOINDEX  3304>>DOINDEX
I IN PROCEDURE BLD_MPC
      3239**DCL      3246<<DOINDEX  3247>>ASSIGN
I IN PROCEDURE FIND_DEV
      3319**DCL      3324<<DOINDEX  3325>>IF       3328>>ASSIGN
IDX IN PROCEDURE BLD_MPC
      3235**DCL      3234--PROC
IDX.FIRST IN PROCEDURE BLD_MPC
      3236**DCL      3245>>ASSIGN   3246>>DOINDEX
IDX.N IN PROCEDURE BLD_MPC
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:125  
      3237**DCL      3245>>ASSIGN
IOM
      3075**DCL      3147--ASSIGN   3181--CALL     3183<<ASSIGN
IOM.CHAN$
      3080**DCL      3186<<ASSIGN   3255>>ASSIGN   3297>>ASSIGN   3303>>ASSIGN   3328>>ASSIGN
IOM.THRESH_RATE
      3079**DCL      3184<<ASSIGN
IOM$
      2031**DCL      3131>>IF       3172<<ASSIGN   3182<<ASSIGN   3255>>ASSIGN   3297>>ASSIGN   3303>>ASSIGN
      3325>>IF       3328>>ASSIGN
IOMKEY
      3065**DCL      3180<>CALL
IOMKEY.C
      3067**DCL      3179<<CALLBLT
IOMR$
      2032**DCL      3005--IMP-PTR  3180<>CALL     3193>>ASSIGN
IOM_ENTRY$
      2039**DCL      3123<<ASSIGN   3129<<ASSIGN   3129>>ASSIGN   3131>>IF       3147<<ASSIGN   3147>>ASSIGN
J
      2041**DCL      3187<<DOINDEX  3188>>ASSIGN   3189>>ASSIGN   3190>>ASSIGN   3191>>ASSIGN
J IN PROCEDURE BLD_DEV
      3272**DCL      3304<<DOINDEX  3305>>IF       3306>>ASSIGN
J IN PROCEDURE BLD_MPC
      3240**DCL      3253<<DOINDEX  3254>>IF       3255>>ASSIGN   3256>>DOINDEX  3256>>DOINDEX  3261<<DOINDEX
      3262>>CALL
J IN PROCEDURE FIND_DEV
      3320**DCL      3327<<DOINDEX  3328>>ASSIGN
K IN PROCEDURE BLD_MPC
      3241**DCL      3256<<DOINDEX  3257>>ASSIGN
KEY IN PROCEDURE READ
      3357**DCL      3356--PROC     3361--ASSIGN
KEY.L IN PROCEDURE READ
      3358**DCL      3359--IMP-SIZ  3361>>ASSIGN
LAST IN PROCEDURE BLD_MPC
      3238**DCL      3245<<ASSIGN   3246>>DOINDEX
M$CLOSE
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:126  
        16**DCL-ENT  3115--CALL     3133--CALL     3211--CALL     3230--CALL
M$ELF_DATA
       865**DCL      3114--IF
M$ERRMSG
        79**DCL-ENT  3140--CALL     3220--CALL
M$EXTEND
        20**DCL-ENT  3382--CALL
M$FDS
        51**DCL-ENT  3229--CALL
M$GDS
        51**DCL-ENT  3349--CALL
M$GETDCB
        22**DCL-ENT  3108--CALL
M$KEYIN
        21**DCL-ENT  3143--CALL     3223--CALL
M$MONINFO
        84**DCL-ENT  3117--CALL
M$OPEN
        16**DCL-ENT  3113--CALL     3121--CALL     3160--CALL     3212--CALL
M$READ
        17**DCL-ENT  3364--CALL
M$RELDCB
        22**DCL-ENT  3231--CALL
M$RENV
        72**DCL-ENT  3350--CALL
M$RETRY
        73**DCL-ENT  3372--CALL
M$SENV
        72**DCL-ENT  3348--CALL
MONINFO
       731**DCL       716--DCLINIT
MONINFO.BOOTFLAG#
       733**DCL      3118>>IF
MPC
      3088**DCL      3249--CALL     3250<<ASSIGN
MPC.DEVNM
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:127  
      3093**DCL      3252<<ASSIGN
MPC.THRESH_RATE
      3092**DCL      3251<<ASSIGN
MPC$
      2034**DCL      3088--IMP-PTR  3249<>CALL     3250>>ASSIGN   3251>>ASSIGN   3252>>ASSIGN   3257>>ASSIGN
MPCR$
      2033**DCL      3013--IMP-PTR  3248<>CALL     3254>>IF       3255>>ASSIGN   3256>>DOINDEX  3256>>DOINDEX
      3261>>DOINDEX  3262>>CALL     3264>>ASSIGN   3302>>IF       3303>>ASSIGN   3304>>DOINDEX  3304>>DOINDEX
NEW_DEV IN PROCEDURE BLD_DEV
      3273**DCL      3275<<ASSIGN   3281<<ASSIGN   3286>>IF
NO_MEM IN PROCEDURE GBLK
      3390**LABEL    3382--CALLALT
NUMDEVS
      2046**DCL      3167<<ASSIGN   3276>>DOINDEX
P$
      2038**DCL      3185<>CALL     3186>>ASSIGN   3188>>ASSIGN   3189>>ASSIGN   3190>>ASSIGN   3191>>ASSIGN
PTR$ IN PROCEDURE FIND_DEV
      3316**DCL      3314--PROC     3335<<ASSIGN
READ
      3356**PROC     3128--CALL     3166--CALL     3180--CALL     3248--CALL     3285--CALL
REC$ IN PROCEDURE READ
      3360**DCL      3356--PROC     3365<<ASSIGN
REPORT_ERR
      3216**LABEL    3107--REMEMBR  3108--CALLALT  3113--CALLALT  3155--GOTO     3160--CALLALT  3212--CALLALT
REPORT_ERR IN PROCEDURE GETSPACE
      3353**LABEL    3349--CALLALT
SIZE IN PROCEDURE GBLK
      3379**DCL      3377--PROC     3380>>ASSIGN   3387>>ASSIGN
T$
      2037**DCL      3170<>CALL     3181<>CALL     3182>>ASSIGN   3183>>ASSIGN   3184>>ASSIGN   3186>>ASSIGN
      3255<<ASSIGN   3257>>ASSIGN   3297<<ASSIGN   3298>>IF       3299>>ASSIGN   3303<<ASSIGN   3305>>IF
      3306>>ASSIGN
TABLE$
      2024**DCL      3161<<ASSIGN   3386>>ASSIGN   3387<<ASSIGN   3387>>ASSIGN
TD$DEV.DEVNUM
      3051**DCL      3293>>ASSIGN
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:128  
TD$DEV.IOCHAN
      3039**DCL      3296>>IF
TD$DEV.IOCHAN.CHAN
      3042**DCL      3297>>ASSIGN
TD$DEV.IOCHAN.IOM
      3041**DCL      3297>>ASSIGN
TD$HEAD
      2969**DCL      3167--ASSIGN
TD$HEAD.APMPC_INDX
      2978**DCL      3202<>CALL
TD$HEAD.CONSOLE_INDX
      2984**DCL      3203>>DOINDEX  3203>>DOINDEX
TD$HEAD.DEVNAME
      3002**DCL      3167--ASSIGN   3204>>ASSIGN   3247>>ASSIGN   3277>>IF       3280<<CALLBLT
TD$HEAD.DISKMPC_INDX
      2976**DCL      3201<>CALL
TD$HEAD.NUMCONSOLES
      2985**DCL      3203>>DOINDEX
TD$HEAD.NUMIOMS
      2971**DCL      3130>>DOINDEX  3178>>DOINDEX
TD$HEAD.TAPEMPC_INDX
      2974**DCL      3200<>CALL
TD$HEAD.UNITMPC_INDX
      2972**DCL      3199<>CALL
TD$MPC.DEVNAME
      3032**DCL      3262<>CALL
TD$MPC.IOCHAN.HICHAN
      3020**DCL      3256>>DOINDEX  3304>>DOINDEX
TD$MPC.IOCHAN.IOM
      3018**DCL      3255>>ASSIGN   3303>>ASSIGN
TD$MPC.IOCHAN.LOCHAN
      3019**DCL      3256>>DOINDEX  3304>>DOINDEX
TD$MPC.IOCHAN.PRESENCE
      3016**DCL      3254>>IF       3302>>IF
TD$MPC.NUMDEVS
      3021**DCL      3261>>DOINDEX
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:129  
TEMP$ IN PROCEDURE FIND_DEV
      3321**DCL      3328<<ASSIGN   3329>>IF       3332>>IF       3335>>ASSIGN
UPDATE_ELF_DATA
       660**DCL      3121<>CALL     3212<>CALL
UPDATE_ELF_DATA.ACSVEH_
       662**DCL       663--REDEF
UPDATE_ELF_DATA.ALTKEYS_
       668**DCL       669--REDEF     669--REDEF
UPDATE_ELF_DATA.HDR_
       667**DCL       668--REDEF
UPDATE_ELF_DATA.TAB_
       666**DCL       667--REDEF
UPDATE_ELF_DATA.UHL_
       660**DCL       661--REDEF     661--REDEF
UPDATE_ELF_DATA.V
       669**DCL       660--DCLINIT
UPDATE_ELF_DATA.V.FSN#
       700**DCL       700--REDEF     700--REDEF
UPDATE_ELF_DATA.WSN_
       666**DCL       666--REDEF
VECTR IN PROCEDURE GETSPACE
      3346**DCL      3345--PROC     3347--ASSIGN
VLP_ACCT_SYS
       315**DCL       236--DCLINIT   547--DCLINIT   665--DCLINIT
VLP_NAME
       839**DCL       543--DCLINIT   661--DCLINIT
VLP_NAME_CONFIG
       301**DCL       232--DCLINIT
WORDS_USED
      2042**DCL      3169<<ASSIGN   3380<<ASSIGN   3380>>ASSIGN   3381>>DOWHILE  3384<<ASSIGN   3384>>ASSIGN
WORK$
      2029**DCL      3127<<ASSIGN   3165<<ASSIGN   3193<<ASSIGN   3264<<ASSIGN   3310<<ASSIGN   3362>>ASSIGN
      3363>>ASSIGN   3365>>ASSIGN   3366<<ASSIGN   3366>>ASSIGN   3371>>ASSIGN
WORKSEG
      2025**DCL      3124<<ASSIGN   3126<>CALL     3162<<ASSIGN   3164<>CALL     3227--ASSIGN   3370<>CALL
WORKSEG.BOUND
PL6.E3A0      #002=ELT$INIT File=ELT$THRESH.:E05TSI                              TUE 07/29/97 15:20 Page:130  
      2026**DCL      3228>>ASSIGN   3363>>ASSIGN   3371>>ASSIGN
WORKSEG.PTR$
      2028**DCL      3125<<ASSIGN   3127>>ASSIGN   3163<<ASSIGN   3165>>ASSIGN   3363>>ASSIGN   3371>>ASSIGN
X1
      3230**LABEL    3229--CALLALT
X2
      3231**LABEL    3230--CALLALT
X3
      3232**LABEL    3231--CALLALT

PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:131  
      705        1        /*M* ELT$SETTHRESH - SET IO THRESHOLDS FOR ELF */
      706        2        /*T***********************************************************/
      707        3        /*T*                                                         */
      708        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      709        5        /*T*                                                         */
      710        6        /*T***********************************************************/
      711        7        ELT$SETTHRESH: PROC(THRESHSET);
      712        8        /**/
      713        9        %INCLUDE TS_SUBS_C;
      714       90        %INCLUDE IT_SUBS_C;
      715      357        %INCLUDE NI$TABLES ;
      716      573        %INCLUDE EL$TABLES;
      717      896        /**/
      718      897        %EL$THRESHSET (NAME=THRESHSET,STCLASS="");
      719      901    1   DCL I SBIN WORD;
      720      902    1   DCL J SBIN WORD;
      721      903    1   DCL K SBIN WORD;
      722      904    1   DCL B$DS3$ PTR SYMREF;
      723      905    1   DCL IOM$(0:7) PTR BASED(B$DS3$);        /* SDS file in DS3 */
      724      906        /**/
      725      907        /* THE FOLLOWING STRUCTURES MUST MATCH THE CORRESPONDING STRUCTURES
      726      908           IN ELT$INIT   */
      727      909    1   DCL I$ PTR;
      728      910    1   DCL 1 IOM BASED(I$) ALIGNED,
      729      911    1         2 ERR_RATE UBIN,
      730      912    1         2 NUM_ENTRIES UBIN HALF UNAL,
      731      913    1         2 THRESH UBIN HALF UNAL,
      732      914    1         2 THRESH_RATE UBIN,
      733      915    1         2 CHAN$ PTR;
      734      916    1   DCL CHAN$ PTR;
      735      917    1   DCL 1 CHAN(0:0)  BASED ALIGNED,
      736      918    1         2 ERR_RATE UBIN,
      737      919    1         2 NUM_ENTRIES UBIN HALF UNAL,
      738      920    1         2 THRESH UBIN HALF UNAL,
      739      921    1         2 THRESH_RATE UBIN,
      740      922    1         2 DEV$ PTR,
      741      923    1         2 MPC$ PTR;
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:132  
      742      924    1   DCL MPC$ PTR;
      743      925    1   DCL 1 MPC BASED(MPC$) ALIGNED,
      744      926    1         2 ERR_RATE UBIN,
      745      927    1         2 NUM_ENTRIES UBIN HALF UNAL,
      746      928    1         2 THRESH UBIN HALF UNAL,
      747      929    1         2 THRESH_RATE UBIN,
      748      930    1         2 DEVNM CHAR(8);
      749      931    1   DCL DEV$ PTR;
      750      932    1   DCL 1 DEV BASED(DEV$) ALIGNED,
      751      933    1         2 ERR_RATE UBIN,
      752      934    1         2 NUM_ENTRIES UBIN HALF UNAL,
      753      935    1         2 THRESH UBIN HALF UNAL,
      754      936    1         2 THRESH_RATE UBIN,
      755      937    1         2 DEVNM CHAR(8),
      756      938    1         2 DEVNUM UBIN,
      757      939    1         2 STATS (0:9) UBIN;
      758      940        %EJECT;
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:133  
      759      941    2           DO CASE(THRESHSET.CODE);
      760      942    2            CASE(TSS_IOM);
      761      943    2              I$ = IOM$(THRESHSET.IOM.IOM#);
      762      944    2              IF I$~=ADDR(NIL) THEN IOM.THRESH_RATE = THRESHSET.THRESH;
      763      945    2            CASE(TSS_MPC);
      764      946    3              DO J = 0 TO 7;               /* ALL IOMS                           */
      765      947    3                 IF IOM$(J) ~= ADDR(NIL)
      766      948    3                 THEN
      767      949    4                 DO K = 0 TO %N_MAXCHANS-1; /* CHECK ALL CHANNELS */
      768      950    4                    MPC$ = IOM$(J)->IOM.CHAN$->CHAN.MPC$(K);
      769      951    4                    IF MPC$ ~= ADDR(NIL)
      770      952    4                    THEN                   /* CHECK THIS MPC REC                 */
      771      953    5                    DO;
      772      954    5                       IF MPC.DEVNM = THRESHSET.DEVNAME
      773      955    5                       THEN MPC.THRESH_RATE = THRESHSET.THRESH;
      774      956    5                       END;                /* IF MPC$ ~= ADDR(NIL)               */
      775      957    4                    END;                   /* DO K = 0 TO %N_MAXCHANS-1 */
      776      958    3                 END;                      /* DO J = 0 TO 7                      */
      777      959    2            CASE(TSS_CHAN);
      778      960    2              I$ = IOM$(THRESHSET.IOM.IOM#);
      779      961    2              IF I$=ADDR(NIL) THEN RETURN;
      780      962    2              CHAN$ = IOM.CHAN$;
      781      963    3              DO J = THRESHSET.IOM.LOCHAN TO THRESHSET.IOM.HICHAN;
      782      964    3                 CHAN$->CHAN.THRESH_RATE(J) = THRESHSET.THRESH;
      783      965    3                 END;                      /* DO J                               */
      784      966    2            CASE(TSS_DEV);
      785      967    3              DO J = 0 TO 7;               /* ALL IOMS                           */
      786      968    3                 IF IOM$(J) ~= ADDR(NIL)
      787      969    3                 THEN
      788      970    4                 DO K = 0 TO %N_MAXCHANS-1; /* CHECK ALL CHANNELS */
      789      971    4                    DEV$ = IOM$(J)->IOM.CHAN$->CHAN.DEV$(K);
      790      972    4                    IF DEV$ ~= ADDR(NIL)
      791      973    4                    THEN                   /* CHECK THIS DEV REC                 */
      792      974    5                    DO;
      793      975    5                       IF DEV.DEVNM = THRESHSET.DEVNAME
      794      976    5                       THEN DEV.THRESH_RATE = THRESHSET.THRESH;
      795      977    5                       END;                /* IF DEV$ ~= ADDR(NIL)               */
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:134  
      796      978    4                    END;                   /* DO K = 0 TO %N_MAXCHANS-1 */
      797      979    3                 END;                      /* DO J = 0 TO 7                      */
      798      980    2            END;                           /* DO CASE                            */
      799      981    1   END ELT$SETTHRESH;

PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:135  
--  Include file information  --

   EL$TABLES.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   IT_SUBS_C.:E05TOU  is referenced.
   TS_SUBS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ELT$SETTHRESH.

   Procedure ELT$SETTHRESH requires 120 words for executable code.
   Procedure ELT$SETTHRESH requires 12 words of local(AUTO) storage.

    No errors detected in file ELT$THRESH.:E05TSI    .

PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:136  

 Object Unit name= ELT$SETTHRESH                              File name= ELT$THRESH.:E05TOU
 UTS= JUL 29 '97 15:20:30.28 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   120    170  ELT$SETTHRESH

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  ELT$SETTHRESH

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$DS3$                                B_VECTNIL
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:137  


      705        1        /*M* ELT$SETTHRESH - SET IO THRESHOLDS FOR ELF */
      706        2        /*T***********************************************************/
      707        3        /*T*                                                         */
      708        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      709        5        /*T*                                                         */
      710        6        /*T***********************************************************/
      711        7        ELT$SETTHRESH: PROC(THRESHSET);

      7  0 000000   000000 700200 xent  ELT$SETTHRE* TSX0  ! X66_AUTO_1
         0 000001   000014 000001                    ZERO    12,1

      712        8        /**/
      713        9        %INCLUDE TS_SUBS_C;
      714       90        %INCLUDE IT_SUBS_C;
      715      357        %INCLUDE NI$TABLES ;
      716      573        %INCLUDE EL$TABLES;
      717      896        /**/
      718      897        %EL$THRESHSET (NAME=THRESHSET,STCLASS="");
      719      901    1   DCL I SBIN WORD;
      720      902    1   DCL J SBIN WORD;
      721      903    1   DCL K SBIN WORD;
      722      904    1   DCL B$DS3$ PTR SYMREF;
      723      905    1   DCL IOM$(0:7) PTR BASED(B$DS3$);        /* SDS file in DS3 */
      724      906        /**/
      725      907        /* THE FOLLOWING STRUCTURES MUST MATCH THE CORRESPONDING STRUCTURES
      726      908           IN ELT$INIT   */
      727      909    1   DCL I$ PTR;
      728      910    1   DCL 1 IOM BASED(I$) ALIGNED,
      729      911    1         2 ERR_RATE UBIN,
      730      912    1         2 NUM_ENTRIES UBIN HALF UNAL,
      731      913    1         2 THRESH UBIN HALF UNAL,
      732      914    1         2 THRESH_RATE UBIN,
      733      915    1         2 CHAN$ PTR;
      734      916    1   DCL CHAN$ PTR;
      735      917    1   DCL 1 CHAN(0:0)  BASED ALIGNED,
      736      918    1         2 ERR_RATE UBIN,
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:138  
      737      919    1         2 NUM_ENTRIES UBIN HALF UNAL,
      738      920    1         2 THRESH UBIN HALF UNAL,
      739      921    1         2 THRESH_RATE UBIN,
      740      922    1         2 DEV$ PTR,
      741      923    1         2 MPC$ PTR;
      742      924    1   DCL MPC$ PTR;
      743      925    1   DCL 1 MPC BASED(MPC$) ALIGNED,
      744      926    1         2 ERR_RATE UBIN,
      745      927    1         2 NUM_ENTRIES UBIN HALF UNAL,
      746      928    1         2 THRESH UBIN HALF UNAL,
      747      929    1         2 THRESH_RATE UBIN,
      748      930    1         2 DEVNM CHAR(8);
      749      931    1   DCL DEV$ PTR;
      750      932    1   DCL 1 DEV BASED(DEV$) ALIGNED,
      751      933    1         2 ERR_RATE UBIN,
      752      934    1         2 NUM_ENTRIES UBIN HALF UNAL,
      753      935    1         2 THRESH UBIN HALF UNAL,
      754      936    1         2 THRESH_RATE UBIN,
      755      937    1         2 DEVNM CHAR(8),
      756      938    1         2 DEVNUM UBIN,
      757      939    1         2 STATS (0:9) UBIN;
      758      940        %EJECT;
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:139  
      759      941    2           DO CASE(THRESHSET.CODE);

    941  0 000002   200003 470500                    LDP0    @THRESHSET,,AUTO
         0 000003   000000 235100                    LDA     0,,PR0
         0 000004   000007 115007                    CMPA    7,DL
         0 000005   000007 602005 0                  TNC     s:941+5,AL
         0 000006   000167 710000 0                  TRA     s:981
         0 000007   000167 710000 0                  TRA     s:981
         0 000010   000125 710000 0                  TRA     s:967
         0 000011   000030 710000 0                  TRA     s:946
         0 000012   000167 710000 0                  TRA     s:981
         0 000013   000073 710000 0                  TRA     s:960
         0 000014   000167 710000 0                  TRA     s:981
         0 000015   000016 710000 0                  TRA     s:943

      760      942    2            CASE(TSS_IOM);

      761      943    2              I$ = IOM$(THRESHSET.IOM.IOM#);

    943  0 000016   000001 720100                    LXL0    1,,PR0
         0 000017   000000 471400 xsym               LDP1    B$DS3$
         0 000020   100000 236110                    LDQ     0,X0,PR1
         0 000021   200007 756100                    STQ     I$,,AUTO

      762      944    2              IF I$~=ADDR(NIL) THEN IOM.THRESH_RATE = THRESHSET.THRESH;

    944  0 000022   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000023   000167 600000 0                  TZE     s:981

    944  0 000024   200007 473500                    LDP3    I$,,AUTO
         0 000025   000003 235100                    LDA     3,,PR0
         0 000026   300002 755100                    STA     2,,PR3
         0 000027   000167 710000 0                  TRA     s:981

      763      945    2            CASE(TSS_MPC);

      764      946    3              DO J = 0 TO 7;               /* ALL IOMS                           */
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:140  

    946  0 000030   200005 450100                    STZ     J,,AUTO

      765      947    3                 IF IOM$(J) ~= ADDR(NIL)

    947  0 000031   000000 470400 xsym               LDP0    B$DS3$
         0 000032   200005 720100                    LXL0    J,,AUTO
         0 000033   000000 236110                    LDQ     0,X0,PR0
         0 000034   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000035   000066 600000 0                  TZE     s:958

      766      948    3                 THEN
      767      949    4                 DO K = 0 TO %N_MAXCHANS-1; /* CHECK ALL CHANNELS */

    949  0 000036   200006 450100                    STZ     K,,AUTO
         0 000037   000063 710000 0                  TRA     s:957+1

      768      950    4                    MPC$ = IOM$(J)->IOM.CHAN$->CHAN.MPC$(K);

    950  0 000040   000000 470400 xsym               LDP0    B$DS3$
         0 000041   200005 720100                    LXL0    J,,AUTO
         0 000042   000000 471510                    LDP1    0,X0,PR0
         0 000043   100003 473500                    LDP3    3,,PR1
         0 000044   200006 236100                    LDQ     K,,AUTO
         0 000045   000005 402007                    MPY     5,DL
         0 000046   300004 236106                    LDQ     4,QL,PR3
         0 000047   200011 756100                    STQ     MPC$,,AUTO

      769      951    4                    IF MPC$ ~= ADDR(NIL)

    951  0 000050   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000051   000062 600000 0                  TZE     s:957

      770      952    4                    THEN                   /* CHECK THIS MPC REC                 */
      771      953    5                    DO;

      772      954    5                       IF MPC.DEVNM = THRESHSET.DEVNAME
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:141  

    954  0 000052   200011 474500                    LDP4    MPC$,,AUTO
         0 000053   200003 475500                    LDP5    @THRESHSET,,AUTO
         0 000054   040100 106500                    CMPC    fill='040'O
         0 000055   400003 000010                    ADSC9   3,,PR4                   cn=0,n=8
         0 000056   500001 000010                    ADSC9   1,,PR5                   cn=0,n=8
         0 000057   000062 601000 0                  TNZ     s:957

      773      955    5                       THEN MPC.THRESH_RATE = THRESHSET.THRESH;

    955  0 000060   500003 235100                    LDA     3,,PR5
         0 000061   400002 755100                    STA     2,,PR4

      774      956    5                       END;                /* IF MPC$ ~= ADDR(NIL)               */

      775      957    4                    END;                   /* DO K = 0 TO %N_MAXCHANS-1 */

    957  0 000062   200006 054100                    AOS     K,,AUTO
         0 000063   200006 235100                    LDA     K,,AUTO
         0 000064   000177 115007                    CMPA    127,DL
         0 000065   000040 604400 0                  TMOZ    s:950

      776      958    3                 END;                      /* DO J = 0 TO 7                      */

    958  0 000066   200005 054100                    AOS     J,,AUTO
         0 000067   200005 235100                    LDA     J,,AUTO
         0 000070   000007 115007                    CMPA    7,DL
         0 000071   000031 604400 0                  TMOZ    s:947
         0 000072   000167 710000 0                  TRA     s:981

      777      959    2            CASE(TSS_CHAN);

      778      960    2              I$ = IOM$(THRESHSET.IOM.IOM#);

    960  0 000073   000001 720100                    LXL0    1,,PR0
         0 000074   000000 471400 xsym               LDP1    B$DS3$
         0 000075   100000 236110                    LDQ     0,X0,PR1
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:142  
         0 000076   200007 756100                    STQ     I$,,AUTO

      779      961    2              IF I$=ADDR(NIL) THEN RETURN;

    961  0 000077   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000100   000102 601000 0                  TNZ     s:962

    961  0 000101   000000 702200 xent               TSX2  ! X66_ARET

      780      962    2              CHAN$ = IOM.CHAN$;

    962  0 000102   200007 473500                    LDP3    I$,,AUTO
         0 000103   300003 236100                    LDQ     3,,PR3
         0 000104   200010 756100                    STQ     CHAN$,,AUTO

      781      963    3              DO J = THRESHSET.IOM.LOCHAN TO THRESHSET.IOM.HICHAN;

    963  0 000105   000002 236100                    LDQ     2,,PR0
         0 000106   000022 772000                    QRL     18
         0 000107   200005 756100                    STQ     J,,AUTO
         0 000110   000120 710000 0                  TRA     s:965+1

      782      964    3                 CHAN$->CHAN.THRESH_RATE(J) = THRESHSET.THRESH;

    964  0 000111   200005 236100                    LDQ     J,,AUTO
         0 000112   000005 402007                    MPY     5,DL
         0 000113   200003 470500                    LDP0    @THRESHSET,,AUTO
         0 000114   200010 471500                    LDP1    CHAN$,,AUTO
         0 000115   000003 235100                    LDA     3,,PR0
         0 000116   100002 755106                    STA     2,QL,PR1

      783      965    3                 END;                      /* DO J                               */

    965  0 000117   200005 054100                    AOS     J,,AUTO
         0 000120   000002 236100                    LDQ     2,,PR0
         0 000121   777777 376007                    ANQ     -1,DL
         0 000122   200005 116100                    CMPQ    J,,AUTO
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:143  
         0 000123   000111 605000 0                  TPL     s:964
         0 000124   000167 710000 0                  TRA     s:981

      784      966    2            CASE(TSS_DEV);

      785      967    3              DO J = 0 TO 7;               /* ALL IOMS                           */

    967  0 000125   200005 450100                    STZ     J,,AUTO

      786      968    3                 IF IOM$(J) ~= ADDR(NIL)

    968  0 000126   000000 470400 xsym               LDP0    B$DS3$
         0 000127   200005 720100                    LXL0    J,,AUTO
         0 000130   000000 236110                    LDQ     0,X0,PR0
         0 000131   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000132   000163 600000 0                  TZE     s:979

      787      969    3                 THEN
      788      970    4                 DO K = 0 TO %N_MAXCHANS-1; /* CHECK ALL CHANNELS */

    970  0 000133   200006 450100                    STZ     K,,AUTO
         0 000134   000160 710000 0                  TRA     s:978+1

      789      971    4                    DEV$ = IOM$(J)->IOM.CHAN$->CHAN.DEV$(K);

    971  0 000135   000000 470400 xsym               LDP0    B$DS3$
         0 000136   200005 720100                    LXL0    J,,AUTO
         0 000137   000000 471510                    LDP1    0,X0,PR0
         0 000140   100003 473500                    LDP3    3,,PR1
         0 000141   200006 236100                    LDQ     K,,AUTO
         0 000142   000005 402007                    MPY     5,DL
         0 000143   300003 236106                    LDQ     3,QL,PR3
         0 000144   200012 756100                    STQ     DEV$,,AUTO

      790      972    4                    IF DEV$ ~= ADDR(NIL)

    972  0 000145   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:144  
         0 000146   000157 600000 0                  TZE     s:978

      791      973    4                    THEN                   /* CHECK THIS DEV REC                 */
      792      974    5                    DO;

      793      975    5                       IF DEV.DEVNM = THRESHSET.DEVNAME

    975  0 000147   200012 474500                    LDP4    DEV$,,AUTO
         0 000150   200003 475500                    LDP5    @THRESHSET,,AUTO
         0 000151   040100 106500                    CMPC    fill='040'O
         0 000152   400003 000010                    ADSC9   3,,PR4                   cn=0,n=8
         0 000153   500001 000010                    ADSC9   1,,PR5                   cn=0,n=8
         0 000154   000157 601000 0                  TNZ     s:978

      794      976    5                       THEN DEV.THRESH_RATE = THRESHSET.THRESH;

    976  0 000155   500003 235100                    LDA     3,,PR5
         0 000156   400002 755100                    STA     2,,PR4

      795      977    5                       END;                /* IF DEV$ ~= ADDR(NIL)               */

      796      978    4                    END;                   /* DO K = 0 TO %N_MAXCHANS-1 */

    978  0 000157   200006 054100                    AOS     K,,AUTO
         0 000160   200006 235100                    LDA     K,,AUTO
         0 000161   000177 115007                    CMPA    127,DL
         0 000162   000135 604400 0                  TMOZ    s:971

      797      979    3                 END;                      /* DO J = 0 TO 7                      */

    979  0 000163   200005 054100                    AOS     J,,AUTO
         0 000164   200005 235100                    LDA     J,,AUTO
         0 000165   000007 115007                    CMPA    7,DL
         0 000166   000126 604400 0                  TMOZ    s:968

      798      980    2            END;                           /* DO CASE                            */

PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:145  
      799      981    1   END ELT$SETTHRESH;

    981  0 000167   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:146  
--  Include file information  --

   EL$TABLES.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   IT_SUBS_C.:E05TOU  is referenced.
   TS_SUBS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ELT$SETTHRESH.
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:147  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @THRESHSET                10-0-0/w PTR         r     1 CHAN$
    12-0-0/w PTR         r     1 DEV$                       7-0-0/w PTR         r     1 I$
     5-0-0/w SBIN        r     1 J                          6-0-0/w SBIN        r     1 K
    11-0-0/w PTR         r     1 MPC$                      *0-0-0/w STRC(144)   r     1 THRESHSET

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS3$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(180)   r     1 CHAN(0:0)                  0-0-0/w STRC(576)   r     1 DEV
     0-0-0/w STRC(144)   r     1 IOM                        0-0-0/w PTR         r     1 IOM$(0:7)
     0-0-0/w STRC(180)   r     1 MPC


   Procedure ELT$SETTHRESH requires 120 words for executable code.
   Procedure ELT$SETTHRESH requires 12 words of local(AUTO) storage.

    No errors detected in file ELT$THRESH.:E05TSI    .
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:148  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:149  
          MINI XREF LISTING

B$DS3$
       904**DCL       905--IMP-PTR   943>>ASSIGN    947>>IF        950>>ASSIGN    960>>ASSIGN    968>>IF
       971>>ASSIGN
CHAN.DEV$
       922**DCL       971>>ASSIGN
CHAN.MPC$
       923**DCL       950>>ASSIGN
CHAN.THRESH_RATE
       921**DCL       964<<ASSIGN
CHAN$
       916**DCL       962<<ASSIGN    964>>ASSIGN
DEV.DEVNM
       937**DCL       975>>IF
DEV.THRESH_RATE
       936**DCL       976<<ASSIGN
DEV$
       931**DCL       932--IMP-PTR   971<<ASSIGN    972>>IF        975>>IF        976>>ASSIGN
I$
       909**DCL       910--IMP-PTR   943<<ASSIGN    944>>IF        944>>ASSIGN    960<<ASSIGN    961>>IF
       962>>ASSIGN
IOM.CHAN$
       915**DCL       950>>ASSIGN    962>>ASSIGN    971>>ASSIGN
IOM.THRESH_RATE
       914**DCL       944<<ASSIGN
IOM$
       905**DCL       943>>ASSIGN    947>>IF        950>>ASSIGN    960>>ASSIGN    968>>IF        971>>ASSIGN
J
       902**DCL       946<<DOINDEX   947>>IF        950>>ASSIGN    963<<DOINDEX   964>>ASSIGN    967<<DOINDEX
       968>>IF        971>>ASSIGN
K
       903**DCL       949<<DOINDEX   950>>ASSIGN    970<<DOINDEX   971>>ASSIGN
MPC.DEVNM
PL6.E3A0      #003=ELT$SETTHRESH File=ELT$THRESH.:E05TSI                         TUE 07/29/97 15:20 Page:150  
       930**DCL       954>>IF
MPC.THRESH_RATE
       929**DCL       955<<ASSIGN
MPC$
       924**DCL       925--IMP-PTR   950<<ASSIGN    951>>IF        954>>IF        955>>ASSIGN
THRESHSET
       898**DCL         7--PROC
THRESHSET.CODE
       898**DCL       941>>DOCASE
THRESHSET.DEVNAME
       898**DCL       898--REDEF     954>>IF        975>>IF
THRESHSET.IOM.HICHAN
       898**DCL       963>>DOINDEX
THRESHSET.IOM.IOM#
       898**DCL       943>>ASSIGN    960>>ASSIGN
THRESHSET.IOM.LOCHAN
       898**DCL       963>>DOINDEX
THRESHSET.THRESH
       899**DCL       944>>ASSIGN    955>>ASSIGN    964>>ASSIGN    976>>ASSIGN
