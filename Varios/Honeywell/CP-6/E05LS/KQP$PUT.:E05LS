VERSION E05

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:1    
        1        1        /*M* KQP$PUT TERMINAL write to COMGROUP */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQP$PUT
       10       10             PURPOSE:      To provide COMGROUP WRITE functions for TERMINALs
       11       11             DESCRIPTION:  Contains all routines to implement write of COMGROUP
       12       12                           from TERMINALs.  Is the complement of KQG$GET, which
       13       13                           handles comgroup reads from TERMINALs.
       14       14        */
       15       15        /*F* NAME:         KQP$PUT
       16       16             PURPOSE:      To receive write from terminals
       17       17             DESCRIPTION:  KCF$FEIN calls here when a terminal wants to
       18       18                           write a message into the host, and the terminal
       19       19                           is connected to a COMGROUP.
       20       20
       21       21                           The params for the message to be created are
       22       22                           passed in K$RWPARM.  KQP$PUT checks the msgtyp
       23       23                           (blanks gets the AU-set default), and gives an
       24       24                           error if illegal.  Else it gets an MBLK and gives
       25       25                           an error if none are available.  The message
       26       26                           params are stuffed into the MBLK.
       27       27
       28       28                           Next, if there is no data (K$RWPARM.MSGSZ = 0),
       29       29                           we send the message.  Else (data present) if
       30       30                           it's in the circular queue we try to find a
       31       31                           reader for it, and if so, stuff the data into
       32       32                           his buffer without ever buffering it thru the
       33       33                           comgroup.  If this works we COMP his read and
       34       34                           just get out.
       35       35
       36       36                           If the data must be buffered thru the comgroup
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:2    
       37       37                           for some reason, then a DBLK is
       38       38                           allocated to put the data in.  If none are available
       39       39                           immediately, we post a request for one and ALTRET;
       40       40                           when one becomes available we call KCD$RDGO as
       41       41                           below.  If a DBLK is
       42       42                           available, then if message data is present, we
       43       43                           stuff the data into it and send the message via
       44       44                           KQW$SEND (who may ALTRET saying the destination
       45       45                           station was bad, in which case we give an appropriate
       46       46                           error back).  Otherwise (no message data present),
       47       47                           we map the DBLK into the comm. WSQ page table and
       48       48                           call KCD$RDGO, which tells the writer to write the
       49       49                           data into the DBLK.  When this is complete, the
       50       50                           writer causes KQP$DONE to be called
       51       51                           at which point the message is dispatched
       52       52                           by KQW$SEND as above.
       53       53        */
       54       54        /**/
       55       55        KQP$PUT: PROC (PAR,K$RWPARM) ALTRET;
       56       56        /**/
       57       57
       58       58
       59       59
       60       60        /**/
       61       61        /* INCLUDES */
       62       62        /**/
       63       63        %INCLUDE B_STRINGS_C;
       64      192        %INCLUDE KQ_SUBS_C;
       65      492        %INCLUDE KQ_MAC_C;
       66     3042        %INCLUDE HF_LOCK_C;
       67     3056        %INCLUDE KQ_DATA_R;
       68     3888        %INCLUDE NK$LDCT;
       69     3990        %INCLUDE KI_CP6;
       70     5086        %INCLUDE K$RWPARM;
       71     5472        %INCLUDE KC$CP6V_C;
       72     5592        %INCLUDE KC_CP6;
       73     6152        %INCLUDE CP_6_SUBS;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:3    
       74     6692        %INCLUDE SS_SCHED_C;
       75     6925        %INCLUDE N$REQ;
       76     6999        %INCLUDE JG_GHOSTS_C;
       77     7089        %INCLUDE OC_SUBS_C;
       78     7820        %INCLUDE KC_DATA_R;
       79     7833        %INCLUDE NK_SUBS;
       80     7858
       81     7859
       82     7860
       83     7861        /**/
       84     7862        /* PARAMETERS */
       85     7863        /**/
       86     7864    1   DCL PAR PTR;
       87     7865        %K$RWPARM (NAME=K$RWPARM);
       88     8181
       89     8182
       90     8183
       91     8184        /**/
       92     8185        /* BASED STRUCTURES */
       93     8186        /**/
       94     8187        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
       95     8926        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
       96     9265        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)");
       97     9535        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
       98     9573        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED(RBLK$)",TERM=1);
       99     9759        %KQ_RBLK (FPTN=KQ$RBLKD,STCLASS="BASED(RBLK$)",TERM=0);
      100     9945        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED(DBLK$)");
      101     9998        %KQ_MTYP (FPTN=KQ$MTYP,STCLASS="BASED(MTYP$)");
      102    10072        %KQ_QTN  (FPTN=KQ$QTN,STCLASS=BASED);
      103    10545        %KQ_DFRPARM (FPTN=KQ$DFRPARM,STCLASS=BASED);
      104    10574        %KQ_DFRBLK (FPTN=KQ$DFRBLK,STCLASS="BASED(DBLK$)");
      105    10624        %NK$LDCT (NAME=NK$LDCT,STCLASS="BASED(NK$LDCTAUTO$)");
      106    10670        %NK$LDCT (NAME=N$LDCT,STCLASS=BASED);
      107    10716        %N$REQ (STCLASS=BASED);
      108    10774        %VLP_FPRG(FPTN=VLP$FPRG,STCLASS=BASED);
      109    10795    1   DCL 1 B$$PRIO BASED HALIGNED,
      110    10796    1         2 HI UBIN BYTE UNAL,
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:4    
      111    10797    1         2 LO UBIN BYTE UNAL;
      112    10798    1   DCL B$$CHARS CHAR(I) BASED CALIGNED;
      113    10799    1   DCL B$$WORD UBIN WORD BASED ALIGNED;
      114    10800    1   DCL B$$SBIN SBIN WORD BASED ALIGNED;
      115    10801    1   DCL B$$HALF UBIN HALF BASED HALIGNED;
      116    10802    1   DCL B$$CHAR1 CHAR(1) BASED CALIGNED;
      117    10803    1   DCL B$$KEY1 CHAR(KEY1L) BASED ALIGNED;
      118    10804    1   DCL B$$KEY2 CHAR(KEY2L) BASED ALIGNED;
      119    10805    1   DCL 1 B$$XFPTW BASED DALIGNED,
      120    10806    1         2 * (0:1) UBIN;
      121    10807    1   DCL B$$PTR PTR BASED ALIGNED;
      122    10808
      123    10809
      124    10810
      125    10811        /**/
      126    10812        /* AUTO */
      127    10813        /**/
      128    10814    1   DCL STA$ PTR;
      129    10815    1   DCL MBLK$ PTR;
      130    10816    1   DCL CG$ PTR;
      131    10817    1   DCL NK$LDCTAUTO$ PTR;
      132    10818    1   DCL DBLK$ PTR;
      133    10819    1   DCL DBLK$R REDEF DBLK$ UBIN;
      134    10820    1   DCL I UBIN;
      135    10821    1   DCL J SBIN;
      136    10822    1   DCL DDA UBIN;
      137    10823    1   DCL MTYP$ PTR;
      138    10824    1   DCL KEY1L UBIN HALF;
      139    10825    1   DCL KEY2L UBIN HALF;
      140    10826    1   DCL TACTCNT REDEF KEY2L UBIN HALF;
      141    10827    1   DCL RBLK$ PTR;
      142    10828    1   DCL DSTA$ PTR;
      143    10829    1   DCL QTN$ PTR;
      144    10830    1   DCL DOTYC UBIN;
      145    10831        %K$RWPARM (NAME=RWPARM,STCLASS=AUTO);
      146    11147    1   DCL LOCKSET UBIN;
      147    11148    1   DCL P$ PTR;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:5    
      148    11149    1   DCL BUF$ PTR;
      149    11150    1   DCL 1 AUTOGATE DALIGNED,
      150    11151    1         2 LOCK UBIN(36),
      151    11152    1         2 *    UBIN(36);
      152    11153
      153    11154
      154    11155
      155    11156        /**/
      156    11157        /* REFS */
      157    11158        /**/
      158    11159    1   DCL HFC$ASSOCCLR  ENTRY(3);
      159    11160    1   DCL KCA$TELLAU    ENTRY(3) ALTRET;
      160    11161    1   DCL KCD$INCMP     ENTRY(2) ALTRET;
      161    11162    1   DCL KCD$RDGO      ENTRY(2) ALTRET;
      162    11163    1   DCL KCO$DSCTRM    ENTRY(1);
      163    11164    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      164    11165    1   DCL KQD$DEFERGO   ENTRY(3) ALTRET;
      165    11166    1   DCL KQD$DELETE    ENTRY(2) ALTRET;
      166    11167    1   DCL KQD$GET       ENTRY(3) ALTRET;
      167    11168    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      168    11169    1   DCL KQG$CLEANUP   ENTRY(1) ALTRET;
      169    11170    1   DCL KQG$RECOVER   ENTRY(1) ALTRET;
      170    11171    1   DCL KQM$GETBD     ENTRY(3) ALTRET;
      171    11172    1   DCL KQM$GETMBLK   ENTRY(3) ALTRET;
      172    11173    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      173    11174    1   DCL KQM$RELRBLKT  ENTRY(2) ALTRET;
      174    11175    1   DCL KQM$RELMTYP   ENTRY(2) ALTRET;
      175    11176    1   DCL KQQ$DEQUEUE   ENTRY(2) ALTRET;
      176    11177    1   DCL KQQ$DQEOFTIME ENTRY(2) ALTRET;
      177    11178    1   DCL KQR$COMP      ENTRY(1) ALTRET;
      178    11179    1   DCL KQT$GETSTA    ENTRY(3) ALTRET;
      179    11180    1   DCL KQT$GETTYP    ENTRY(3) ALTRET;
      180    11181    1   DCL KQU$DELETE    ENTRY(1) ALTRET;
      181    11182    1   DCL KQW$SENDNA    ENTRY(1) ALTRET;
      182    11183    1   DCL KQX$LDASR     ENTRY(1);
      183    11184    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      184    11185    1   DCL MMS$VGET      ENTRY(4) ALTRET;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:6    
      185    11186    1   DCL MMS$VREL      ENTRY(2) ALTRET;
      186    11187    1   DCL SSR$RUE       ENTRY(4);
      187    11188    1   DCL SSS$BLOCK     ENTRY;
      188    11189    1   DCL SC_BCGPUT     ENTRY    CONV(2,0);
      189    11190    1   DCL SC_CGNOTIMP   ENTRY    CONV(2,0);
      190    11191    1   DCL SC_BCGPSC     ENTRY    CONV(2,0);
      191    11192    1   DCL B$CGPT$ PTR SYMREF;
      192    11193
      193    11194
      194    11195
      195    11196        /**/
      196    11197        /* SUBS */
      197    11198        /**/
      198    11199        %EQU_CG;
      199    11247        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
      200    11248        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      201    11249        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      202    11250        %SUB DFRP$="ADDR(PAR)";
      203    11251        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:7    
      204    11252        /**/
      205    11253    1         NK$LDCTAUTO$= ADDR(PAR);
      206    11254    1         CALL SETUP ALTRET(RTN);
      207    11255            /*********************************************
      208    11256             *                                           *
      209    11257             *         Build the MBLK from the params    *
      210    11258             *                                           *
      211    11259             *********************************************/
      212    11260    2           DO INHIBIT;
      213    11261    2           IF STA$->KQ$STA.MREQ ~= 0 THEN
      214    11262    2            IF STA$->KQ$STA.MREQ = KQMR_MBLK# THEN GOTO NOMBLK;
      215    11263    2            ELSE IF STA$->KQ$STA.MREQ = - KQMR_MBLK# THEN
      216    11264    3               DO;
      217    11265    3               MBLK$=STA$->KQ$STA.MREQ$;
      218    11266    3               STA$->KQ$STA.MREQ=0;
      219    11267    3               IF MBLK$ ~= ADDR(NIL) THEN GOTO P3;
      220    11268    3               K$RWPARM.ERR=KQPE_QFUL#;
      221    11269    3               ALTRETURN;
      222    11270    3               END;
      223    11271    2           CALL KQM$GETMBLK (CG$->KQ$CG,MBLK$,I) ALTRET(P2);
      224    11272    2           GOTO P3;
      225    11273    2   P2:     IF STA$->KQ$STA.MREQ ~= 0 THEN GOTO NOMBLK;
      226    11274    2           MBLK$=STA$;
      227    11275    2           I=KQMR_MBLK#;
      228    11276    2           CALL KQM$GETBD (CG$->KQ$CG,MBLK$,I) ALTRET(NOMBLK);
      229    11277    2   P3:     IF STA$->KQ$STA.MBLK$ ~= ADDR(NIL) THEN
      230    11278    2            CALL SC_BCGPUT;
      231    11279        /*S* SCREECH_CODE: KQP-S$BCGPUT
      232    11280             TYPE:         SCREECH
      233    11281             MESSAGE:      Event-state conflict during PUT to COMGROUP
      234    11282             REMARKS:      KQP$PUT has been entered to start or continue
      235    11283                           a terminal PUT to COMGROUP, and the state of
      236    11284                           that terminal's PUT is not consistent with
      237    11285                           the way KQP$PUT was entered.  Examples are
      238    11286                           KQP$PUT called when the terminal has an MBLK,
      239    11287                           KQP$DONE called when the terminal has no PUT
      240    11288                           or it does but the PUT is not in the right
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:8    
      241    11289                           state.  One must examine the way KQP$PUT was
      242    11290                           entered, in
      243    11291                           order to determine what the inconsistency was,
      244    11292                           and why it occured. */
      245    11293    2           ELSE IF STA$->KQ$STA.JRNLW THEN CALL SC_BCGPUT;
      246    11294    2           STA$->KQ$STA.VGOT$=ADDR(NIL);
      247    11295    2           STA$->KQ$STA.MBLK$=MBLK$;
      248    11296    2           CG$->KQ$CG.STATS.PUTS=CG$->KQ$CG.STATS.PUTS+1;
      249    11297    2           STA$->KQ$STA.WRITES=STA$->KQ$STA.WRITES+1;
      250    11298    2           END;
      251    11299    1         IF K$RWPARM.STATION ~= '?' THEN
      252    11300    1          MBLK$->KQ$MBLK.DSTA=K$RWPARM.STATION;
      253    11301    1         ELSE MBLK$->KQ$MBLK.DSTA=' ';
      254    11302    1         IF K$RWPARM.MSGTYP = ' '
      255    11303    1         THEN MBLK$->KQ$MBLK.KEY1=CG$->KQ$CG.AUCTL.TMTYP;
      256    11304    1         ELSE MBLK$->KQ$MBLK.KEY1=K$RWPARM.MSGTYP;
      257    11305    1         MTYP$ = ADDR(NIL);
      258    11306    1         IF SUBSTR(MBLK$->KQ$MBLK.KEY1,0,1) ~= '*'
      259    11307    2         THEN DO;
      260    11308    2   FNDTYP: ;
      261    11309                %LOCK (G=KQ$TTREE.GATE);
      262    11312    2           CALL KQB$SRCH (KQ$TTREE,MBLK$->KQ$MBLK.KEY1,MTYP$) ALTRET(NOMTYP);
      263    11313    2   GOTMTYP:;
      264    11314    2           MTYP$->KQ$MTYP.NUMWRITES = MTYP$->KQ$MTYP.NUMWRITES + 1;
      265    11315    2           MBLK$->KQ$MBLK.JOURNAL=MTYP$->KQ$MTYP.JOURNAL;
      266    11316    2           TACTCNT=KQ$TTREE.ACTCNT;
      267    11317    2           END;
      268    11318    2         ELSE DO;
      269    11319    2           IF MBLK$->KQ$MBLK.KEY1='*AUEV' THEN GOTO BADMTYP1;
      270    11320    2           MBLK$->KQ$MBLK.STAR='1'B;
      271    11321    2           IF MBLK$->KQ$MBLK.DSTA = ' ' THEN
      272    11322    3             DO;
      273    11323                  %LOCK (G=KQ$STREE.GATE);
      274    11326    3             IF CG$->KQ$CG.AUSTA$ = ADDR(NIL) THEN
      275    11327    4               DO;
      276    11328                    %UNLOCK (G=KQ$STREE.GATE);
      277    11331    4               K$RWPARM.ERR=KQPE_NOSTA#;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:9    
      278    11332    4               GOTO DELALT;
      279    11333    4               END;
      280    11334    3             MBLK$->KQ$MBLK.DSTA=CG$->KQ$CG.AUSTA$->KQ$STA.BTN.KEY;
      281    11335                  %UNLOCK (G=KQ$STREE.GATE);
      282    11338    3             END;
      283    11339    2           MTYP$=ADDR(KQ_IMTYP);
      284    11340                %LOCK (G=KQ$TTREE.GATE);
      285    11343    2           END;
      286    11344    1         MBLK$->KQ$MBLK.MSGSIZE=K$RWPARM.MSGSZ;
      287    11345    1         IF K$RWPARM.DVE.DVBYTE.VFC
      288    11346    1         THEN
      289    11347    1          MBLK$->KQ$MBLK.MSGSIZE = MBLK$->KQ$MBLK.MSGSIZE + 1;
      290    11348    1         IF K$RWPARM.MSGSZ > CG$->KQ$CG.AUCTL.MAXMC THEN
      291    11349    2           DO;
      292    11350    2           MBLK$->KQ$MBLK.MSGSIZE=CG$->KQ$CG.AUCTL.MAXMC;
      293    11351    2           MBLK$->KQ$MBLK.TYC=MBLK$->KQ$MBLK.TYC|%TYC_LD;
      294    11352    2           END;
      295    11353    1         IF CG$->KQ$CG.QISS THEN
      296    11354    2           DO;
      297    11355    2           ADDR(MBLK$->KQ$MBLK.PRIO)->B$$PRIO.HI=STA$->KQ$STA.MPRIO;
      298    11356    2           ADDR(MBLK$->KQ$MBLK.PRIO)->B$$PRIO.LO=MTYP$->KQ$MTYP.MPRIO;
      299    11357    2           MBLK$->KQ$MBLK.KEY2=MBLK$->KQ$MBLK.KEY1;
      300    11358    2           MBLK$->KQ$MBLK.KEY1=STA$->KQ$STA.BTN.KEY;
      301    11359    2           END;
      302    11360    1         ELSE
      303    11361    2           DO;
      304    11362    2           ADDR(MBLK$->KQ$MBLK.PRIO)->B$$PRIO.HI=MTYP$->KQ$MTYP.MPRIO;
      305    11363    2           ADDR(MBLK$->KQ$MBLK.PRIO)->B$$PRIO.LO=STA$->KQ$STA.MPRIO;
      306    11364    2           MBLK$->KQ$MBLK.KEY2=STA$->KQ$STA.BTN.KEY;
      307    11365    2           END;
      308    11366              /**/
      309    11367    1         IF MBLK$->KQ$MBLK.KEY1 = '*FPABT' THEN
      310    11368    2           DO;
             11368                /* This allows TPA to receive the *FPABT message before the *AUEV message */
      311    11369    2           MBLK$->KQ$MBLK.PRIO = %KQ_AUEP#;
      312    11370    2           END;
      313    11371              /**/
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:10   
      314    11372    1         MBLK$->KQ$MBLK.MID.PRIMARY=CG$->KQ$CG.MSGID;
      315    11373    1         CG$->KQ$CG.MSGID=CG$->KQ$CG.MSGID+1;
      316    11374    1         IF KQ_LOG.TSIO THEN
      317    11375    1          CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_PUT,0,
      318    11376    1          MBLK$->KQ$MBLK.MID.PRIMARY,
      319    11377    1          ADDR(MBLK$->KQ$MBLK.MID.PRIMARY)->B$$HALF,
      320    11378    1          SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
      321    11379    1          SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
      322    11380              %UNLOCK (G=KQ$TTREE.GATE);
      323    11383    1         CALL PULLTYC;
      324    11384        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:11   
      325    11385        /**/
      326    11386    1         IF MBLK$->KQ$MBLK.MSGSIZE = 0 THEN
      327    11387    1          GOTO SENDIT0;
      328    11388    1         IF K$RWPARM.MSG$ ~= ADDR(NIL) THEN
      329    11389    1          IF NOT MBLK$->KQ$MBLK.JOURNAL THEN
      330    11390    2            DO;
      331    11391
      332    11392            /*********************************************
      333    11393             *                                           *
      334    11394             *         PUT directly to user buffer       *
      335    11395             *                                           *
      336    11396             *********************************************/
      337    11397
      338    11398    2            IF MBLK$->KQ$MBLK.DSTA ~= ' ' THEN
      339    11399    3              DO;
      340    11400    3              IF  NOT CG$->KQ$CG.AUCTL.DRML
      341    11401    3              AND NOT MBLK$->KQ$MBLK.STAR THEN
      342    11402    4                DO;
      343    11403                                /**********************************
      344    11404                                 *                                *
      345    11405                                 *       DIRECTED WRITE           *
      346    11406                                 *                                *
      347    11407                                 **********************************/
      348    11408    4                CALL CHKSTAL ALTRET(NOSTA0);
      349    11409    4                RBLK$=DSTA$->KQ$STA.RBLK$;
      350    11410    4                IF RBLK$ ~= ADDR(NIL) THEN
      351    11411    4                 IF  RBLK$->KQ$RBLK.STATE = KQRS_PEND#
      352    11412    4                 AND RBLK$->KQ$RBLK.LATCH = '0'B THEN
      353    11413    4                  IF DSTA$->KQ$STA.MLH.BUSY = '0'B THEN
      354    11414    5                    DO;
      355    11415    5                    KEY1L=RBLK$->KQ$RBLK.KEY1L;
      356    11416    5                    KEY2L=RBLK$->KQ$RBLK.KEY2L;
      357    11417    5                    IF  ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 = ADDR(MBLK$->KQ$MBLK.KEY1)
             11417                             ->B$$KEY1
      358    11418    5                    AND ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 = ADDR(MBLK$->KQ$MBLK.KEY2)
             11418                             ->B$$KEY2 THEN
      359    11419    5                     IF DSTA$->KQ$STA.LDCT$->N$LDCT.RESCOD = NK_CGDCB OR
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:12   
      360    11420    5                     DSTA$->KQ$STA.LDCT$->N$LDCT.RESCOD = NK_CGFPRG THEN
      361    11421    6                       DO;
      362    11422    6                       CALL XFERD ALTRET(GETOUT);
      363    11423    6                       GOTO WRITECG;
      364    11424    6                       END;
      365    11425    5                     ELSE CALL SC_BCGPUT; /* Can't be a terminal now can it? */
      366    11426    5                    END;
      367    11427                     %UNLOCK (G=DSTA$->KQ$STA.GATE);
      368    11430    4                END;
      369    11431    3              END;
      370    11432    2            ELSE IF NOT CG$->KQ$CG.AUCTL.QRML THEN
      371    11433    3               DO;
      372    11434                                /**********************************
      373    11435                                 *                                *
      374    11436                                 *       WRITE TO QUEUE           *
      375    11437                                 *                                *
      376    11438                                 **********************************/
      377    11439                    %LOCK (G=KQ$QTREE.GATE);
      378    11442    3               IF CG$->KQ$CG.QISS THEN QTN$=STA$;
      379    11443    3               ELSE
      380    11444    4                 DO;
      381    11445    4                 IF TACTCNT ~= KQ$TTREE.ACTCNT THEN
      382    11446    4                  CALL KQB$SRCH (KQ$TTREE,MBLK$->KQ$MBLK.KEY1,QTN$) ALTRET(BADMTYP);
      383    11447    4                 ELSE QTN$=MTYP$;
      384    11448    4                 END;
      385    11449    3               P$=ADDR(QTN$->KQ$QTN.READS$);
      386    11450    3               RBLK$=P$->B$$PTR;
      387    11451    4                 DO WHILE (RBLK$ ~= ADDR(NIL));
      388    11452    4                 KEY2L=RBLK$->KQ$RBLK.KEY2L;
      389    11453    4                 IF ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 = ADDR(MBLK$->KQ$MBLK.KEY2)->
             11453                          B$$KEY2 THEN
      390    11454    5                   DO;
      391    11455    5                   IF RBLK$->KQ$RBLK.LATCH THEN GOTO WR11;
      392    11456    5                   DSTA$=RBLK$->KQ$RBLKD.STA$;
      393    11457                        %LOCK (G=DSTA$->KQ$STA.GATE);
      394    11460    5                   IF RBLK$->KQ$RBLK.STATE = KQRS_PEND# THEN
      395    11461    6                     DO;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:13   
      396    11462    6   WRITENOWQ:
      397    11463    6                     CALL XFERQ ALTRET(GETOUT);
      398    11464    6                     GOTO WRITECG;
      399    11465    6                     END;
      400    11466                        %UNLOCK (G=DSTA$->KQ$STA.GATE);
      401    11469    5                   END;
      402    11470    4                 P$=ADDR(RBLK$->KQ$RBLKD.QRLNK$);
      403    11471    4                 RBLK$=P$->B$$PTR;
      404    11472    4                 END;
      405    11473                           /* COULD NOT FIND A GOOD READ ON THIS Q-TREE NODE.
      406    11474                              LOOK IN WILD-CARDED READS */
      407    11475    3               P$=ADDR(CG$->KQ$CG.QUEUE.WCRL$);
      408    11476    3               RBLK$=P$->B$$PTR;
      409    11477    4                 DO WHILE (RBLK$ ~= ADDR(NIL));
      410    11478    4                 KEY1L=RBLK$->KQ$RBLK.KEY1L;
      411    11479    4                 KEY2L=RBLK$->KQ$RBLK.KEY2L;
      412    11480    4                 IF  ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 = ADDR(MBLK$->KQ$MBLK.KEY1)->
             11480                          B$$KEY1
      413    11481    4                 AND ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 = ADDR(MBLK$->KQ$MBLK.KEY2)->
             11481                          B$$KEY2 THEN
      414    11482    5                   DO;
      415    11483    5                   IF RBLK$->KQ$RBLK.LATCH THEN GOTO WR11;
      416    11484    5                   DSTA$=RBLK$->KQ$RBLKD.STA$;
      417    11485                        %LOCK (G=DSTA$->KQ$STA.GATE);
      418    11488    5                   IF RBLK$->KQ$RBLK.STATE = KQRS_PEND# THEN
      419    11489    5                    GOTO WRITENOWQ;
      420    11490                        %UNLOCK (G=DSTA$->KQ$STA.GATE);
      421    11493    5                   END;
      422    11494    4                 P$=ADDR(RBLK$->KQ$RBLKD.QRLNK$);
      423    11495    4                 RBLK$=P$->B$$PTR;
      424    11496    4                 END;
      425    11497    3   WR11:       ;
      426    11498                    %UNLOCK (G=KQ$QTREE.GATE);
      427    11501    3               END;
      428    11502    2            END;
      429    11503    1   WRITECG:;
      430    11504        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:14   
      431    11505            /*********************************************
      432    11506             *                                           *
      433    11507             *         GET a data block                  *
      434    11508             *                                           *
      435    11509             *********************************************/
      436    11510    1         DDA=MBLK$->KQ$MBLK.MSGSIZE;
      437    11511    1         IF  KQ_DEBUG = 0
      438    11512    1         AND CG$->KQ$CG.AUCTL.REDUNDANT = '0'B THEN
      439    11513    1          CALL KQD$GET (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOGET);
      440    11514    1         ELSE
      441    11515    2           DO;  /* Copy MBLK into end of data blk */
      442    11516    2           DDA=DDA+SIZEC(KQ$MBLK);
      443    11517    2           CALL KQD$GET (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOGET);
      444    11518    2           PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK))->KQ$MBLK=MBLK$->KQ$MBLK;
      445    11519    2           DBLK$->KQ$DBLK.MBLK='1'B;
      446    11520    2           DBLK$->KQ$DBLK.DSIZE=MBLK$->KQ$MBLK.MSGSIZE;
      447    11521    2           END;
      448    11522    1         MBLK$->KQ$MBLK.DBLK$=DBLK$;
      449    11523    1         MBLK$->KQ$MBLK.DDA=DDA;
      450    11524    1         DBLK$->KQ$DBLK.STAMP=MBLK$->KQ$MBLK.STAMP;
      451    11525    1         IF K$RWPARM.MSG$ ~= ADDR(NIL) THEN
      452    11526    2           DO;
      453    11527                                /* XFER FROM INPUT CIRCULAR QUEUE */
      454    11528    2           I=MBLK$->KQ$MBLK.MSGSIZE;
      455    11529    2           IF K$RWPARM.DVE.DVBYTE.VFC
      456    11530    3           THEN DO;
      457    11531    3             BUF$ = PINCRW(DBLK$,SIZEW(KQ$DBLK));
      458    11532    3             I = 1;
      459    11533    3             BUF$->B$$CHARS = K$RWPARM.DVE.VFC;
      460    11534    3             BUF$ = PINCRC(BUF$,1);
      461    11535    3             I = MBLK$->KQ$MBLK.MSGSIZE - 1;
      462    11536    3             BUF$->B$$CHARS = K$RWPARM.MSG$->B$$CHARS;
      463    11537    3             END;
      464    11538    2           ELSE
      465    11539    2            PINCRW(DBLK$,SIZEW(KQ$DBLK))->B$$CHARS=K$RWPARM.MSG$->B$$CHARS;
      466    11540    2           GOTO SENDIT;
      467    11541    2           END;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:15   
      468    11542    1   PUT0: ;
      469    11543            /*********************************************
      470    11544             *                                           *
      471    11545             *         VGET it into the comm. WSQ        *
      472    11546             *                                           *
      473    11547             *********************************************/
      474    11548    1         BUF$ = PINCRW(DBLK$,SIZEW(KQ$DBLK));
      475    11549    1         I = MBLK$->KQ$MBLK.MSGSIZE;
      476    11550    1         IF MBLK$->KQ$MBLK.DVE.DVBYTE & %DVBYTE_VFC# THEN
      477    11551    2           DO;
      478    11552    2           I = 1;
      479    11553    2           BUF$->B$$CHARS = MBLK$->KQ$MBLK.DVE.VFC;
      480    11554    2           BUF$ = PINCRC(BUF$,1);
      481    11555    2           I = MBLK$->KQ$MBLK.MSGSIZE - 1;
      482    11556    2           END;
      483    11557    1         CALL MMS$VGET (%B_CWSQ1,BUF$,I,STA$->KQ$STA.VGOT$) ALTRET(NOVGET);
      484    11558    1   PUT01:;
      485    11559    1         MBLK$->KQ$MBLK.PUTSTATE=KQPS_GDN#;
      486    11560    1   PUT1: ;
      487    11561            /*********************************************
      488    11562             *                                           *
      489    11563             *         Give it to KCD$RDGO               *
      490    11564             *                                           *
      491    11565             *********************************************/
      492    11566    1         IF MBLK$->KQ$MBLK.DBLK$ ~= ADDR(NIL) THEN
      493    11567    1          RWPARM.ERR=0;
      494    11568    1         ELSE
      495    11569    2           DO;
      496    11570    2           RWPARM.ERR=KQPE_QFUL#;
      497    11571    2           CALL DUMPMSG;
      498    11572    2           GOTO GETOUT;
      499    11573    2           END;
      500    11574    1         RWPARM.MSG$ = STA$->KQ$STA.VGOT$;
      501    11575    1         IF MBLK$->KQ$MBLK.DVE.DVBYTE & %DVBYTE_VFC# THEN
      502    11576    1          RWPARM.MSGSZ = MBLK$->KQ$MBLK.MSGSIZE - 1;
      503    11577    1         ELSE
      504    11578    1          RWPARM.MSGSZ = MBLK$->KQ$MBLK.MSGSIZE;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:16   
      505    11579    1         IF LOCKSET = 0 THEN
      506    11580    2           DO;
      507    11581                %LOCK (G=STA$->KQ$STA.GATE);
      508    11584    2           STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
      509    11585                %UNLOCK (G=STA$->KQ$STA.GATE);
      510    11588    2           END;
      511    11589    1         AUTOGATE.LOCK = 1;
      512    11590              %LOCK(G=AUTOGATE);
      513    11593    1         CALL KCD$RDGO (NK$LDCT,RWPARM) ALTRET(RALT);
      514    11594              %UNLOCK(G=AUTOGATE);
      515    11597    1   PUT2: ;
      516    11598              %LOCK (G=STA$->KQ$STA.GATE);
      517    11601    1         IF STA$->KQ$STA.LOCKCNT = 0 THEN CALL SC_BCGPUT;
      518    11602    1         ELSE
      519    11603    1          STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;
      520    11604    1   PUT3: ;
      521    11605    1         IF STA$->KQ$STA.LOCKCNT = 0 THEN
      522    11606    1          IF STA$->KQ$STA.IDSC THEN
      523    11607    1           GOTO DODISC;
      524    11608              %UNLOCK (G=STA$->KQ$STA.GATE);
      525    11611    1         GOTO GETOUT;
      526    11612        /**/
      527    11613    1   RALT: ;
      528    11614              %UNLOCK(G=AUTOGATE);
      529    11617    2           DO INHIBIT;
      530    11618    2           I=MBLK$->KQ$MBLK.PUTSTATE;
      531    11619    2           MBLK$->KQ$MBLK.PUTSTATE=KQPS_DIP#;
      532    11620    2           IF I ~= KQPS_GDN# THEN CALL SC_BCGPUT;
      533    11621    2           CALL DUMPMSG;
      534    11622    2           GOTO PUT2;
      535    11623    2           END;
      536    11624    1   NOGET:;
      537    11625            /*********************************************
      538    11626             *                                           *
      539    11627             *         Cannot get a data block           *
      540    11628             *                                           *
      541    11629             *********************************************/
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:17   
      542    11630    1         IF DBLK$ ~= ADDR(NIL) THEN
      543    11631    2           DO; /* Got a defer block */
      544    11632                %LOCK (G=STA$->KQ$STA.GATE);
      545    11635    2           STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
      546    11636                %UNLOCK (G=STA$->KQ$STA.GATE);
      547    11639    2           DBLK$->KQ$DFRBLK.INFO$=STA$;
      548    11640    2           CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQP$GCONT));
      549    11641    2           K$RWPARM.ERR=KQPE_NOBUF#;
      550    11642    2           GOTO ALTRT;
      551    11643    2           END;
      552    11644        /**/
      553    11645        /**/
      554    11646                      /* No defer block - something wrong */
      555    11647    2           DO CASE (DDA);
      556    11648
      557    11649    2             CASE (%KQDE_NDFRBLK);
      558    11650                                /* No defer blocks */
      559    11651    2               CALL DUMPMSG1;
      560    11652    2               GOTO NOMBLK;
      561    11653
      562    11654    2             CASE (%KQDE_NSPC);
      563    11655    2               K$RWPARM.ERR=KQPE_QFUL#;
      564    11656    2               GOTO DELALT;
      565    11657
      566    11658    2             CASE (ELSE);
      567    11659    2               CALL SC_BCGPUT;
      568    11660
      569    11661    2           END;
      570    11662        /**/
      571    11663    1   NOMBLK:;
      572    11664    1         K$RWPARM.ERR=KQPE_NOMBLK#;
      573    11665    1         GOTO ALTRT;
      574    11666    1   NOMTYP:;
      575    11667    1         IF CG$->KQ$CG.AUCTL.XTYPLGL THEN
      576    11668    2           DO;
      577    11669    2           IF MBLK$->KQ$MBLK.KEY1 ~= ' ' THEN
      578    11670    2            CALL INDEX (I,SUBSTR(MBLK$->KQ$MBLK.KEY1,0,1),KC_LGL1ST) ALTRET(BADMTYP);
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:18   
      579    11671    2           MTYP$=STA$;
      580    11672    2           CALL KQT$GETTYP (CG$->KQ$CG,MTYP$,MBLK$->KQ$MBLK.KEY1) ALTRET(NOMTYP1);
      581    11673    2           GOTO GOTMTYP;
      582    11674    2   NOMTYP1:;
      583    11675    2           IF MTYP$ = ADDR(NIL) THEN K$RWPARM.ERR=KQPE_QFUL#;
      584    11676    2           ELSE K$RWPARM.ERR=KQPE_NOMBLK#;
      585    11677    2           END;
      586    11678    1         ELSE
      587    11679    2           DO;
      588    11680    2   BADMTYP:;
      589    11681                %UNLOCK (G=KQ$TTREE.GATE);
      590    11684    2   BADMTYP1:;
      591    11685    2           K$RWPARM.ERR=KQPE_BADMTYP#;
      592    11686    2           END;
      593    11687    1         MTYP$ = ADDR(NIL);
      594    11688    1   DELALT:;
      595    11689    1         CALL DUMPMSG1;
      596    11690    1         GOTO ALTRT;
      597    11691    1   NOVGET:;
      598    11692    1         MBLK$->KQ$MBLK.PUTSTATE=KQPS_NVG#;
      599    11693    1         IF LOCKSET = 0 THEN
      600    11694    2           DO;
      601    11695                %LOCK (G=STA$->KQ$STA.GATE);
      602    11698    2           STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
      603    11699                %UNLOCK (G=STA$->KQ$STA.GATE);
      604    11702    2           END;
      605    11703              %LOCK (G=CG$->KQ$CG.GATE.CG);
      606    11706    1         STA$->KQ$STA.DPVGLNK$=CG$->KQ$CG.DPVGHD$;
      607    11707    1         CG$->KQ$CG.DPVGHD$=STA$;
      608    11708              %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      609    11711    1         GOTO GETOUT;
      610    11712    1   PULLTYC: PROC;
      611    11713    2         MBLK$->KQ$MBLK.TYC=MBLK$->KQ$MBLK.TYC|K$RWPARM.TYC;
      612    11714    2         MBLK$->KQ$MBLK.DVE=K$RWPARM.DVE;
      613    11715    2         RETURN;
      614    11716    2   END PULLTYC;
      615    11717        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:19   
      616    11718        /**/
      617    11719        /*F* NAME:         KQP$GCONT
      618    11720             PURPOSE:      To continue a PUT after a deferred KQD$GET
      619    11721             CALL:         KQP$GCONT (KQ$DFRPARM)
      620    11722             DESCRIPTION:  The defer params contain the station pointer,
      621    11723                           and the results of the GET.  These are merged
      622    11724                           into the current PUT MBLK, and KQP$GCONT1 is
      623    11725                           fallen into.
      624    11726        */
      625    11727    1   KQP$GCONT: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */
      626    11728        /**/
      627    11729    1         STA$=DFRP$->KQ$DFRPARM.INFO$;
      628    11730    1         CG$=STA$->KQ$STA.CG$;
      629    11731    1         DBLK$=DFRP$->KQ$DFRPARM.DBLK$;
      630    11732    1         MBLK$=STA$->KQ$STA.MBLK$;
      631    11733    1         IF STA$->KQ$STA.IDSC THEN
      632    11734    2           DO;
      633    11735    2           IF DBLK$ ~= ADDR(NIL) THEN
      634    11736    2            CALL KQD$DELETE(STA$->KQ$STA.CG$->KQ$CG,DBLK$);
      635    11737    2           GOTO PUT2;
      636    11738    2           END;
      637    11739    1         IF MBLK$->KQ$MBLK.PUTSTATE ~= KQPS_IIP# THEN CALL SC_BCGPUT;
      638    11740    1         MBLK$->KQ$MBLK.DBLK$=DBLK$;
      639    11741    1         IF DBLK$ ~= ADDR(NIL) THEN
      640    11742    1          MBLK$->KQ$MBLK.DDA=DFRP$->KQ$DFRPARM.DDA;
      641    11743    1         ELSE IF DFRP$->KQ$DFRPARM.ERR ~= %KQDE_NSPC THEN
      642    11744    1           CALL SC_BCGPUT;
      643    11745    1         NK$LDCTAUTO$ = STA$->KQ$STA.LDCT$;
      644    11746        /**/
      645    11747        /*F* NAME:         KQP$GCONT1
      646    11748             PURPOSE:      To continue a PUT after a deferred KQD$GET
      647    11749             DESCRIPTION:  Continued from KQP$GCONT with the GET results
      648    11750                           merged into the MBLK.
      649    11751                           The PUT continues.
      650    11752        */
      651    11753    1         STA$=NK$LDCT.STA$;
      652    11754    1         CG$=NK$LDCT.CG$;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:20   
      653    11755    1         MBLK$=STA$->KQ$STA.MBLK$;
      654    11756    1         DBLK$=MBLK$->KQ$MBLK.DBLK$;
      655    11757    1         LOCKSET=1;
      656    11758    1         IF DBLK$ = ADDR(NIL) THEN GOTO PUT01;
      657    11759    1         DBLK$->KQ$DBLK.STAMP=MBLK$->KQ$MBLK.STAMP;
      658    11760    1         IF DBLK$->KQ$DBLK.DSIZE = MBLK$->KQ$MBLK.MSGSIZE+SIZEC(KQ$MBLK) THEN
      659    11761    2           DO;
      660    11762    2           PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK))->KQ$MBLK=MBLK$->KQ$MBLK;
      661    11763    2           DBLK$->KQ$DBLK.MBLK='1'B;
      662    11764    2           DBLK$->KQ$DBLK.DSIZE=MBLK$->KQ$MBLK.MSGSIZE;
      663    11765    2           END;
      664    11766    1         GOTO PUT0;
      665    11767        /**/
      666    11768        /*F* NAME:         KQP$PCG
      667    11769             PURPOSE:      To call KCD$RDGO again if it couldn't do its job
      668    11770             DESCRIPTION:  KCD$RDGO is called again if it failed for some
      669    11771                           reason the first time.
      670    11772        */
      671    11773    1   KQP$PCG: ENTRY (PAR) ALTRET;
      672    11774        /**/
      673    11775    1         NK$LDCTAUTO$ = ADDR(PAR);
      674    11776    1         CALL SETUP ALTRET(RTN);
      675    11777    1         MBLK$=STA$->KQ$STA.MBLK$;
      676    11778    1         IF MBLK$->KQ$MBLK.PUTSTATE ~= KQPS_GDN# THEN CALL SC_BCGPUT;
      677    11779    1         GOTO PUT1;
      678    11780        /**/
      679    11781        /*F* NAME:         KQP$DVGET
      680    11782             PURPOSE:      To continue a PUT by re-trying a VGET which
      681    11783                           failed due to a full FEP WSQ
      682    11784             DESCRIPTION:  Called from KCC$CLOCK.
      683    11785        */
      684    11786    1   KQP$DVGET: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */
      685    11787        /**/
      686    11788    1         NK$LDCTAUTO$ = ADDR(PAR);
      687    11789    1         STA$=NK$LDCT.STA$;
      688    11790    1         CG$=NK$LDCT.CG$;
      689    11791    1         MBLK$=STA$->KQ$STA.MBLK$;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:21   
      690    11792    1         IF MBLK$->KQ$MBLK.PUTSTATE ~= KQPS_NVG# THEN CALL SC_BCGPUT;
      691    11793    1         DBLK$=MBLK$->KQ$MBLK.DBLK$;
      692    11794    1         LOCKSET=1;
      693    11795    1         GOTO PUT0;
      694    11796        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:22   
      695    11797        /**/
      696    11798        /*F* NAME:         KQP$DONE
      697    11799             PURPOSE:      To finish a PUT
      698    11800             DESCRIPTION:  Called from KCF$FEIN when the FEP has finished
      699    11801                           transferring the data into the host buffer.
      700    11802                           The buffer is VRELed from the FEP's page table,
      701    11803                           the DBLK is unlocked, and KQW$SEND is called to
      702    11804                           transfer the message to the receiver.  If the
      703    11805                           message cannot be delivered, we ALTRET with an
      704    11806                           appropriate error code.
      705    11807
      706    11808                           If K$RWPARM.ERR ~= 0 when entered, this means
      707    11809                           that the message is to be discarded.
      708    11810        */
      709    11811    1   KQP$DONE: ENTRY (PAR,K$RWPARM) ALTRET;
      710    11812        /**/
      711    11813    1         NK$LDCTAUTO$ = ADDR(PAR);
      712    11814    1         DOTYC=0;
      713    11815    1         GOTO DONE;
      714    11816        /**/
      715    11817        /*F* NAME:         KQP$DONET
      716    11818             PURPOSE:      To finish a PUT passing TYC etc
      717    11819             DESCRIPTION:  Same as KQP$DONE except supplies new TYC, DVE,
      718    11820                           and MSGSZ
      719    11821        */
      720    11822    1   KQP$DONET: ENTRY (PAR,K$RWPARM) ALTRET;
      721    11823        /**/
      722    11824    1         NK$LDCTAUTO$ = ADDR(PAR);
      723    11825    1         DOTYC=1;
      724    11826    1   DONE: ;
      725    11827    1         CALL SETUP ALTRET(RTN);
      726    11828    1         MBLK$=STA$->KQ$STA.MBLK$;
      727    11829    2           DO INHIBIT;
      728    11830    2           IF MBLK$->KQ$MBLK.PUTSTATE ~= KQPS_GDN# THEN CALL SC_BCGPUT;
      729    11831    2           MBLK$->KQ$MBLK.PUTSTATE=KQPS_DIP#;
      730    11832    2           END;
      731    11833    1         IF DOTYC ~= 0 THEN
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:23   
      732    11834    2           DO;
      733    11835    2           CALL PULLTYC;
      734    11836    2           IF K$RWPARM.MSGSZ > MBLK$->KQ$MBLK.MSGSIZE THEN
      735    11837    2            CALL SC_BCGPSC;
      736    11838        /*S* SCREECH_CODE: KQP-S$BCGPSC
      737    11839             TYPE:         SCREECH
      738    11840             MESSAGE:      Bad COMGROUP PUT size change
      739    11841             REMARKS:      When TERMINALs PUT to a COMGROUP, they may not
      740    11842                           know how big the record will be (e.g. local card
      741    11843                           readers hooked up to INSYM).  Thus they call PUT
      742    11844                           asking for a buffer big enough to hold the max
      743    11845                           size record, and then pass the actual size read
      744    11846                           to KQP$DONET.  This screech occurs when the size
      745    11847                           passed to KQP$DONET is larger than that asked for
      746    11848                           originally.  Note that if the passed size is
      747    11849                           real, then the device has clobbered something by
      748    11850                           storing outside of the allocated data block. */
      749    11851    2           MBLK$->KQ$MBLK.MSGSIZE=K$RWPARM.MSGSZ;
      750    11852    2           MBLK$->KQ$MBLK.DBLK$->KQ$DBLK.DSIZE=K$RWPARM.MSGSZ;
      751    11853    2           END;
      752    11854    1         IF K$RWPARM.ERR ~= 0 THEN
      753    11855    2           DO;
      754    11856    2           CALL FINDMTYP;
      755    11857    2           CALL DUMPMSG;
      756    11858    2           GOTO GETOUT;
      757    11859    2           END;
      758    11860    1         IF STA$->KQ$STA.VGOT$ ~= ADDR(NIL) THEN
      759    11861    1          CALL MMS$VREL (%B_CWSQ1,STA$->KQ$STA.VGOT$);
      760    11862                                /* COME HERE TO SEND THE MESSAGE */
      761    11863    1   SENDIT:;
      762    11864    1         CALL KQD$UNLOCK (CG$->KQ$CG,MBLK$->KQ$MBLK.DBLK$);
      763    11865    1   SENDIT0:;
      764    11866    1         MBLK$->KQ$MBLK.PUTSTATE=KQPS_SIP#;
      765    11867    1         K$RWPARM.MSGID=MBLK$->KQ$MBLK.MID.PRIMARY;
      766    11868    1         K$RWPARM.MSGIDXT=BINBIT(MBLK$->KQ$MBLK.MID.XT,36);
      767    11869    1         IF MBLK$->KQ$MBLK.JOURNAL THEN
      768    11870    1          IF MBLK$->KQ$MBLK.DVE.DVBYTE & %DVBYTE_RRR# THEN
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:24   
      769    11871    2            DO;
      770    11872                 %LOCK (G=STA$->KQ$STA.GATE);
      771    11875    2            STA$->KQ$STA.JRNLW='1'B;
      772    11876    2            STA$->KQ$STA.JMSGID=0;
      773    11877                 %UNLOCK (G=STA$->KQ$STA.GATE);
      774    11880    2            CALL KQW$SENDNA (STA$->KQ$STA) ALTRET(NSJ);
      775    11881    2            IF  STA$->KQ$STA.JRNLW
      776    11882    2            AND STA$->KQ$STA.JMSGID = 0 THEN
      777    11883    3              DO;
      778    11884                   %LOCK (G=STA$->KQ$STA.GATE);
      779    11887    3              STA$->KQ$STA.JRNLW='0'B;
      780    11888                   %UNLOCK (G=STA$->KQ$STA.GATE);
      781    11891    3              GOTO GETOUT;
      782    11892    3              END;
      783    11893    2            K$RWPARM.ERR=KQPE_ILTR#;
      784    11894    2            ALTRETURN;
      785    11895    2   NSJ:     ;
      786    11896                 %LOCK (G=STA$->KQ$STA.GATE);
      787    11899    2            STA$->KQ$STA.JRNLW='0'B;
      788    11900                 %UNLOCK (G=STA$->KQ$STA.GATE);
      789    11903    2            GOTO NOSTA;
      790    11904    2            END;
      791    11905    1         CALL KQW$SENDNA (STA$->KQ$STA) ALTRET(NOSTA);
      792    11906    1   GETOUT:;
      793    11907    1   RTN:  ;
      794    11908    1         RETURN;
      795    11909    1   NOSTA0:;
      796    11910    1         CALL DUMPMSG1;
      797    11911    1   NOSTA: ;
      798    11912    1         K$RWPARM.ERR=KQPE_NOSTA#;
      799    11913    1   ALTRT: ;
      800    11914    1         ALTRETURN;
      801    11915        /**/
      802    11916        /*F* NAME:         KQP$INCMP
      803    11917             PURPOSE:      To tell a TERMINAL that a PUT is complete
      804    11918             CALL:         KQP$INCMP (KQ$STA)
      805    11919             DESCRIPTION:  When a message is to be JOURNALed, then
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:25   
      806    11920                           KQP$DONE ALTRETs with KQPE_ILTR (ID later),
      807    11921                           indicating that KCD$INCMP will be called
      808    11922                           later with the MSGID of the message, when
      809    11923                           the comgroup has safely journaled the message.
      810    11924
      811    11925                           KQP$INCMP is called from KQU$UNLATCH when the
      812    11926                           journal station UNLATCHes the message after
      813    11927                           having journaled it.
      814    11928
      815    11929                           Called with the station gate locked and
      816    11930                           LOCKCNT bumped up.
      817    11931
      818    11932                           MUST be called in behalf of a user.
      819    11933        */
      820    11934    1   KQP$INCMP: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */
      821    11935        /**/
      822    11936    1         LOCKSET=1;
      823    11937    1         STA$=ADDR(PAR);
      824    11938    1         STA$->KQ$STA.JRNLW='0'B;
      825    11939    1         RWPARM.MSGID=STA$->KQ$STA.JMSGID;
      826    11940              %UNLOCK (G=STA$->KQ$STA.GATE);
      827    11943    1         CALL SSS$BLOCK;
      828    11944    1         CALL KCD$INCMP (STA$->KQ$STA.LDCT$->N$LDCT,RWPARM);
      829    11945    1         GOTO PUT2;
      830    11946        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:26   
      831    11947        /**/
      832    11948        /*F* NAME:         KQP$EVNT
      833    11949             PURPOSE:      To handle TERMINAL events
      834    11950             DESCRIPTION:  Passes a TERMINAL BREAK event to the COMGROUP AU
      835    11951                           with the passed INFO word as info.
      836    11952        */
      837    11953    1   KQP$EVNT: ENTRY (PAR,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */
      838    11954        /**/
      839    11955    1         NK$LDCTAUTO$ = ADDR(PAR);
      840    11956    1         CALL SETUP ALTRET(RTN);
      841    11957    1         CALL KCA$TELLAU (STA$->KQ$STA,%CG_TBRK#,ADDR(K$RWPARM)->B$$WORD);
      842    11958    1         RETURN;
      843    11959        /**/
      844    11960        /*F* NAME:         KQP$FPEXIT
      845    11961             PURPOSE:      To send an FPRG TERMINAL at jobstep AU event
      846    11962             DESCRIPTION:  Sends an AU event of code=CG_FPEXIT to the AU
      847    11963        */
      848    11964    1   KQP$FPEXIT: ENTRY (PAR,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */
      849    11965        /**/
      850    11966    1         NK$LDCTAUTO$ = ADDR(PAR);
      851    11967    1         CALL SETUP ALTRET(RTN);
      852    11968    1         CALL KCA$TELLAU (STA$->KQ$STA,%CG_FPEXIT#,ADDR(K$RWPARM)->B$$WORD);
      853    11969    1         RETURN;
      854    11970        /**/
      855    11971        /*F* NAME:         KQP$FPABORT
      856    11972             PURPOSE:      To send an FPRG TERMINAL aborted AU event
      857    11973             DESCRIPTION:  Sends an AU event of code=CG_FPABORT to the AU
      858    11974                           passing along the reason for the abort
      859    11975        */
      860    11976    1   KQP$FPABORT: ENTRY (PAR,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */
      861    11977        /**/
      862    11978    1         NK$LDCTAUTO$ = ADDR(PAR);
      863    11979    1         CALL SETUP ALTRET(RTN);
      864    11980    1         CALL KCA$TELLAU (STA$->KQ$STA,%CG_FPABORT#,ADDR(K$RWPARM)->B$$WORD);
      865    11981    1         RETURN;
      866    11982        /**/
      867    11983        /*F* NAME:         KQP$FPLDTRC
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:27   
      868    11984             PURPOSE:      To send an FPRG TERMINAL issued M$LDTRC AU event
      869    11985             DESCRIPTION:  Sends an AU event of code=CG_FPLDTRC to the AU
      870    11986                           passing along a VLP_FPRG describing the M$LDTRC'ed
      871    11987                           to FPRG.
      872    11988        */
      873    11989    1   KQP$FPLDTRC: ENTRY (PAR,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */
      874    11990        /**/
      875    11991    1         NK$LDCTAUTO$ = ADDR(PAR);
      876    11992    1         CALL SETUP ALTRET(RTN);
      877    11993    1         CALL KCA$TELLAU (STA$->KQ$STA,%CG_FPLDTRC#,ADDR(K$RWPARM)->VLP$FPRG);
      878    11994    1         RETURN;
      879    11995        /**/
      880    11996        /*F* NAME:         KQP$UNLOCK
      881    11997             PURPOSE:      To count down a station's LOCKCNT
      882    11998             CALL:         KQP$UNLOCK (KQ$STA)
      883    11999             DESCRIPTION:  Locks the station gate and descrements LOCKCNT.
      884    12000                           If it hits 0 with IDSC set, calls KQP$FDISC and
      885    12001                           ALTRETs to indicate disconnect.  Else unlocks
      886    12002                           gate and returns.
      887    12003        */
      888    12004    1   KQP$UNLOCK: ENTRY (PAR) ALTRET;
      889    12005        /**/
      890    12006    1         STA$=ADDR(PAR);
      891    12007    1         LOCKSET=0;
      892    12008              %LOCK (G=STA$->KQ$STA.GATE);
      893    12011    1         IF STA$->KQ$STA.LOCKCNT = 0 THEN CALL SC_BCGPUT;
      894    12012    1         ELSE
      895    12013    1          STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;
      896    12014    1         IF STA$->KQ$STA.LOCKCNT = 0 THEN
      897    12015    1          IF  STA$->KQ$STA.IDSC
      898    12016    1          AND STA$->KQ$STA.TERM THEN
      899    12017    2            DO;
      900    12018    2            CALL KQP$FDISC (STA$->KQ$STA.LDCT$->N$LDCT);
      901    12019    2            ALTRETURN;
      902    12020    2            END;
      903    12021    1         IF LOCKSET = 0 THEN
      904    12022    2           DO;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:28   
      905    12023                %UNLOCK (G=STA$->KQ$STA.GATE);
      906    12026    2           END;
      907    12027    1         RETURN;
      908    12028        /**/
      909    12029        /*F* NAME:         KQP$DISC
      910    12030             PURPOSE:      To notify COMGROUP of terminal disconnect
      911    12031             DESCRIPTION:  Called when a comgroup terminal is disconnecting
      912    12032        */
      913    12033    1   KQP$DISC: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */
      914    12034        /**/
      915    12035    1         NK$LDCTAUTO$ = ADDR(PAR);
      916    12036    1         CALL SETUPI ALTRET(RTN);
      917    12037    2         IF ADDR(PAR)=STA$->KQ$STA.LDCT$ THEN DO;
      918    12038    2           IF STA$->KQ$STA.IDSC THEN RETURN;
      919    12039                %LOCK (G=STA$->KQ$STA.GATE);
      920    12042                                /* Unblock possible user writing to us */
      921    12043    2           IF STA$->KQ$STA.RBLK$ ~= ADDR(NIL) THEN
      922    12044    2            IF STA$->KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_XFIW# THEN
      923    12045    2             IF STA$->KQ$STA.RBLK$->KQ$RBLK.IOQ$ ~= ADDR(NIL) THEN
      924    12046    3               DO;
      925    12047    3               J=ADDR(STA$->KQ$STA.RBLK$->KQ$RBLK.IOQ$->N$REQ.STATION.LSTA$)->B$$SBIN;
      926    12048    3               ADDR(STA$->KQ$STA.RBLK$->KQ$RBLK.IOQ$->N$REQ.STATION.LSTA$)->B$$WORD=2;
      927    12049    3               IF J = -1 THEN
      928    12050    3                CALL SSR$RUE (%SS_UQA,STA$->KQ$STA.RBLK$->KQ$RBLK.IOQ$->N$REQ.USER#);
      929    12051    3               END;
      930    12052    2           IF KQ_LOG.TSIO THEN
      931    12053    3             DO;
      932    12054    3             J=STA$->KQ$STA.LOCKCNT;
      933    12055    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_TDRQ,
      934    12056    3             BITBIN(STA$->KQ$STA.IDSC),
      935    12057    3             J,0,
      936    12058    3             SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
      937    12059    3             SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
      938    12060    3             END;
      939    12061    2           STA$->KQ$STA.IDSC='1'B;
      940    12062    2           STA$->KQ$STA.JRNLW='0'B;
      941    12063    2           GOTO PUT3;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:29   
      942    12064    2           END;
      943    12065    2         ELSE DO;    /* Must be KQ$STA.SAVLDCT$ disconnecting. */
      944    12066                %LOCK(G=STA$->KQ$STA.GATE);
      945    12069    2           STA$->KQ$STA.SAVIDSC='1'B;
      946    12070    2           STA$->KQ$STA.DDISC=2;          /* This will cause disconnect to be   */
      947    12071                                               /* continued off the clock later      */
      948    12072                                               /* thereby not colliding with running */
      949    12073                                               /* disconnect off the KQ$CG.DPVGHD$   */
      950    12074                                               /* chain (which on completion causes  */
      951    12075                                               /* us to move KQ$STA.SAVLDCT$ and     */
      952    12076                                               /* KQ$STA.SAVIDSC to KQ$STA.LDCT$ and */
      953    12077                                               /* KQ$STA.IDSC).                      */
      954    12078                %UNLOCK(G=STA$->KQ$STA.GATE);
      955    12081                %LOCK(G=CG$->KQ$CG.GATE.CG);
      956    12084    2           CG$->KQ$CG.DELAY.DDISC='1'B;
      957    12085                %UNLOCK(G=CG$->KQ$CG.GATE.CG);
      958    12088    2           RETURN;
      959    12089    2           END;
      960    12090        /**/
      961    12091        /*F* NAME:         KQP$FDISC
      962    12092             PURPOSE:      To finally disconnect a terminal
      963    12093             DESCRIPTION:  Called by anyone who had KQ$STA.LOCKCNT counted
      964    12094                           up, and counted it down & found IDSC set.
      965    12095
      966    12096                           Entered with the station locked, and LOCKCNT zero.
      967    12097                           Cleans up any outstanding delayed mem request.
      968    12098                           Cleans up the current GET by calling KQG$CLEANUP.
      969    12099                           Then cleans up the current PUT.
      970    12100                           Last, calls KCO$DSCTRM to finish up the
      971    12101                           disconnect.
      972    12102        */
      973    12103    1   KQP$FDISC: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */
      974    12104        /**/
      975    12105    1         NK$LDCTAUTO$ = ADDR(PAR);
      976    12106    1         STA$=NK$LDCT.STA$;
      977    12107    1         CG$=NK$LDCT.CG$;
      978    12108    1   DODISC:;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:30   
      979    12109                     /*    Bump LOCKCNT up so
      980    12110                      *    that people calling
      981    12111                      *    KQP$UNLOCK won't
      982    12112                      *    drive thru here
      983    12113                      *    again.
      984    12114                      */
      985    12115    1         STA$->KQ$STA.LOCKCNT=1;
      986    12116                          /*    Always do disconnect off
      987    12117                           *    the clock.  So
      988    12118                           *    put this station on the
      989    12119                           *    disconnect list and
      990    12120                           *    exit.
      991    12121                           */
      992    12122    1         STA$->KQ$STA.PVGSENSE='1'B;
      993    12123              %UNLOCK (G=STA$->KQ$STA.GATE);
      994    12126              %LOCK (G=CG$->KQ$CG.GATE.CG);
      995    12129    1         STA$->KQ$STA.DPVGLNK$=CG$->KQ$CG.DPVGHD$;
      996    12130    1         CG$->KQ$CG.DPVGHD$=STA$;
      997    12131              %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      998    12134    1         RETURN;
      999    12135        /**/
     1000    12136        /*F* NAME:         KQP$DSCGO
     1001    12137             PURPOSE:      To continue terminal disconnect
     1002    12138             CALL:         KQP$DSCGO (NK$LDCT)
     1003    12139             DESCRIPTION:  Comgroup terminal disconnect is always
     1004    12140                           performed off the clock.  We are called
     1005    12141                           here from KCC$CLOCK to perform the
     1006    12142                           disconnect. */
     1007    12143    1   KQP$DSCGO: ENTRY (PAR) ALTRET;
     1008    12144        /**/
     1009    12145    1         NK$LDCTAUTO$ = ADDR(PAR);
     1010    12146    1         STA$=NK$LDCT.STA$;
     1011    12147    1         CG$=NK$LDCT.CG$;
     1012    12148              %LOCK (G=STA$->KQ$STA.GATE);
     1013    12151        /**/
     1014    12152    1         P$=STA$->KQ$STA.MREQ$;
     1015    12153    1         STA$->KQ$STA.MREQ$=ADDR(NIL);
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:31   
     1016    12154    1         J=-STA$->KQ$STA.MREQ;
     1017    12155    1         STA$->KQ$STA.MREQ=0;
     1018    12156    1         IF J < 0 THEN CALL SC_BCGPUT;
     1019    12157    1         ELSE IF J > 0 THEN
     1020    12158    1           IF P$ ~= ADDR(NIL) THEN
     1021    12159    2             DO CASE (J);
     1022    12160    2               CASE (KQMR_RBLKT#);
     1023    12161    2                 CALL KQM$RELRBLKT (CG$->KQ$CG,P$);
     1024    12162    2               CASE (KQMR_MBLK#);
     1025    12163    2                 CALL KQM$RELMBLK (CG$->KQ$CG,P$);
     1026    12164    2               CASE (KQMR_TYP#);
     1027    12165    2                 CALL KQM$RELMTYP (CG$->KQ$CG,P$);
     1028    12166    2               CASE (ELSE);
     1029    12167    2                 CALL SC_BCGPUT;
     1030    12168    2             END;
     1031    12169        /**/
     1032    12170    1         CALL KQG$CLEANUP (NK$LDCT) ALTRET(RTN);
     1033    12171    1         GOTO CDISC;
     1034    12172        /**/
     1035    12173        /*F* NAME:         KQP$CDISC
     1036    12174             PURPOSE:      To continue final disconnect after a delay
     1037    12175                           in KQG$CLEANUP
     1038    12176             DESCRIPTION:  KQG$CLEANUP calls here when he is finished,
     1039    12177                           if he had to delay and ALTRET.
     1040    12178        */
     1041    12179    1   KQP$CDISC: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */
     1042    12180        /**/
     1043    12181    1         NK$LDCTAUTO$ = ADDR(PAR);
     1044    12182    1         STA$=NK$LDCT.STA$;
     1045    12183    1         CG$=NK$LDCT.CG$;
     1046    12184    1   CDISC: ;
     1047    12185        /**/
     1048    12186                                /* CLEAN UP PUT */
     1049    12187    1         MBLK$=STA$->KQ$STA.MBLK$;
     1050    12188    1         IF MBLK$ ~= ADDR(NIL) THEN
     1051    12189    2           DO CASE (MBLK$->KQ$MBLK.PUTSTATE);
     1052    12190
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:32   
     1053    12191    2             CASE (ELSE);
     1054    12192    2               CALL SC_BCGPUT;
     1055    12193
     1056    12194    2             CASE (KQPS_GDN#);
     1057    12195    2               CALL FINDMTYP;
     1058    12196    2               CALL DUMPMSG;
     1059    12197
     1060    12198    2           END; /*CASE PUTSTATE */
     1061    12199        /**/
     1062    12200    1         CALL KCO$DSCTRM (STA$->KQ$STA);
     1063    12201    1         RETURN;
     1064    12202        /**/
     1065    12203        /*F* NAME:         KQP$RECOVER
     1066    12204             PURPOSE:      To clean up PUTs and GETs when a comgroup is being
     1067    12205                           opened after being closed by RECOVER.
     1068    12206             CALL:         KQP$RECOVER (KQ$STA);
     1069    12207             DESCRIPTION:  Cleans up PUT & GET much like disconnect does
     1070    12208        */
     1071    12209    1   KQP$RECOVER: ENTRY(PAR) ALTRET; /* !!Doesn't ALTRET!! */
     1072    12210        /**/
     1073    12211    1         STA$=ADDR(PAR);
     1074    12212    1         STA$->KQ$STA.MREQ=0;
     1075    12213    1         CG$=STA$->KQ$STA.CG$;
     1076    12214    1         MBLK$=STA$->KQ$STA.MBLK$;
     1077    12215    1         IF MBLK$ ~= ADDR(NIL) THEN
     1078    12216    2           DO;
     1079    12217    2           STA$->KQ$STA.VGOT$=ADDR(NIL);
     1080    12218    2           CALL FINDMTYP;
     1081    12219    2           CALL DUMPMSG;
     1082    12220    2           END;
     1083    12221    1         CALL KQG$RECOVER (STA$->KQ$STA);
     1084    12222    1         RETURN;
     1085    12223        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:33   
     1086    12224        /**/
     1087    12225        /*********************************************************************************
     1088    12226        *                                                                                *
     1089    12227        *   SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS    *
     1090    12228        *  S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S   *
     1091    12229        *  S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S       *
     1092    12230        *   SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS    *
     1093    12231        *      S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S   *
     1094    12232        *  S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S   *
     1095    12233        *   SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS    *
     1096    12234        *                                                                                *
     1097    12235        *********************************************************************************/
     1098    12236
     1099    12237        /****************************************************************
     1100    12238        *****************************************************************/
     1101    12239        /*D* NAME:         SETUP
     1102    12240             PURPOSE:      To provide entry to this module
     1103    12241             DESCRIPTION:  Picks up the STA$ from the LDCT and ALTRETs
     1104    12242                           if it's NIL.  Else maps onto the comgroup
     1105    12243                           data, and picks up the CG context block pointer.
     1106    12244                           If IDSC in the KQ$STA is set, ALTRETs.  Else
     1107    12245                           returns.
     1108    12246                           SETUPI does the same but does not ALTRET if IDSC
     1109    12247                           is set.
     1110    12248        */
     1111    12249    1   SETUP: PROC ALTRET;
     1112    12250    2   DCL IDSC BIT(1) ALIGNED;
     1113    12251    2         IDSC='1'B;
     1114    12252    2         GOTO CMN;
     1115    12253        /**/
     1116    12254    2   SETUPI: ENTRY ALTRET;
     1117    12255        /**/
     1118    12256    2         IDSC='0'B;
     1119    12257    2   CMN:  ;
     1120    12258    2         STA$=NK$LDCT.STA$;
     1121    12259    2         LOCKSET=0;
     1122    12260    2         IF STA$ = ADDR(NIL) THEN ALTRETURN;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:34   
     1123    12261    2         CG$=NK$LDCT.CG$;
     1124    12262    2         CALL KQX$LDASR (CG$->KQ$CG);
     1125    12263    2         IF ((STA$->KQ$STA.IDSC='1'B) OR (STA$->KQ$STA.SAVIDSC='1'B))
     1126    12264    2         AND (IDSC='1'B) THEN ALTRETURN;
     1127    12265    2         RETURN;
     1128    12266    2   END SETUP;
     1129    12267        /****************************************************************
     1130    12268        *****************************************************************/
     1131    12269        /*D* NAME:         CHKSTAL
     1132    12270             PURPOSE:      To find a station and lock it
     1133    12271             DESCRIPTION:  MBLK$->KQ$MBLK.DSTA is the station to find.
     1134    12272                           If it exists, then if it is connected and activated
     1135    12273                           DSTA$ is returned pointing to it, else ALTRET.
     1136    12274                           In either case the station tree is unlocked;
     1137    12275                           in the RETURN case, the station is locked.
     1138    12276        */
     1139    12277    1   CHKSTAL: PROC ALTRET;
     1140    12278        /**/
     1141    12279    2   DCL T$ PTR;
     1142    12280        /**/
     1143    12281              %LOCK (G=KQ$STREE.GATE);
     1144    12284    2         CALL KQB$SRCH (KQ$STREE,MBLK$->KQ$MBLK.DSTA,T$) ALTRET(NOSTA);
     1145    12285    2         DSTA$=T$;
     1146    12286    2   CHK0: ;
     1147    12287              %LOCK (G=DSTA$->KQ$STA.GATE);
     1148    12290    2         IF DSTA$->KQ$STA.AUP THEN GOTO CHK1;  /* not allowed to Write to AUP */
     1149    12291    2         IF DSTA$->KQ$STA.LDCT$ ~= ADDR(NIL) THEN
     1150    12292    2          IF DSTA$->KQ$STA.LDCT$->N$LDCT.LKFLG.ACTIVE THEN GOTO CHKDUN;
     1151    12293    2         IF NOT (CG$->KQ$CG.AUCTL.WAS) THEN
     1152    12294    3           DO;
     1153    12295    3   CHK1:   ;
     1154    12296                %UNLOCK (G=DSTA$->KQ$STA.GATE);
     1155    12299    3           GOTO CHKFAIL;
     1156    12300    3           END;
     1157    12301    2   CHKDUN:;
     1158    12302              %UNLOCK (G=KQ$STREE.GATE);
     1159    12305    2         RETURN;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:35   
     1160    12306    2   NOSTA:;
     1161    12307    2         IF CG$->KQ$CG.AUCTL.XSTALGL = '0'B OR
     1162    12308    2         NOT (CG$->KQ$CG.AUCTL.WAS) THEN
     1163    12309    3           DO;
     1164    12310    3   CHKFAIL:;
     1165    12311                %UNLOCK (G=KQ$STREE.GATE);
     1166    12314    3           ALTRETURN;
     1167    12315    3           END;
     1168    12316    2         T$=STA$;
     1169    12317    2         CALL KQT$GETSTA (CG$->KQ$CG,T$,MBLK$->KQ$MBLK.DSTA) ALTRET(CHKFAIL);
     1170    12318    2         DSTA$=T$;
     1171    12319    2         GOTO CHK0;
     1172    12320    2   END CHKSTAL;
     1173    12321        /****************************************************************
     1174    12322        *****************************************************************/
     1175    12323        /*D* NAME:         DUMPMSG
     1176    12324             PURPOSE:      To get rid of the current PUT
     1177    12325             DESCRIPTION:  The DBLK is VRELed if it was VGETed, and
     1178    12326                           unlocked if it exists.  Then the message
     1179    12327                          is deleted via KQU$DELETE.  The number of writes
     1180    12328                          is then decremented.
     1181    12329        */
     1182    12330    1   DUMPMSG: PROC;
     1183    12331        /**/
     1184    12332    2         MBLK$=STA$->KQ$STA.MBLK$;
     1185    12333    2         IF MBLK$->KQ$MBLK.DBLK$ ~= ADDR(NIL) THEN
     1186    12334    2          CALL KQD$UNLOCK (CG$->KQ$CG,MBLK$->KQ$MBLK.DBLK$);
     1187    12335    2         IF STA$->KQ$STA.VGOT$ ~= ADDR(NIL) THEN
     1188    12336    2          CALL MMS$VREL (%B_CWSQ1,STA$->KQ$STA.VGOT$);
     1189    12337    2   DUMPMSG1: ENTRY;
     1190    12338    2         CALL KQU$DELETE (STA$->KQ$STA);
     1191    12339    2         IF (MTYP$ ~= ADDR(NIL)) AND (MTYP$ ~= ADDR(KQ_IMTYP)) THEN
     1192    12340    2          MTYP$->KQ$MTYP.NUMWRITES = MTYP$->KQ$MTYP.NUMWRITES - 1;
     1193    12341    2         RETURN;
     1194    12342    2   END DUMPMSG;
     1195    12343        /****************************************************************
     1196    12344        *****************************************************************/
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:36   
     1197    12345        /*D* NAME:         FINDMTYP
     1198    12346             PURPOSE:      To Find the MTYP in the TTREE
     1199    12347             DESCRIPTION:  Depending on QISS it send the correct key
     1200    12348                           to KQB$SRCH to set MTYP.  If it ALTRETs
     1201    12349                           MTYP will be set to ADDR(NIL).
     1202    12350        */
     1203    12351    1   FINDMTYP: PROC;
     1204    12352        /**/
     1205    12353             %LOCK (G=KQ$TTREE.GATE) ;
     1206    12356    2         IF CG$->KQ$CG.QISS
     1207    12357    2         THEN CALL KQB$SRCH (KQ$TTREE, MBLK$->KQ$MBLK.KEY2, MTYP$) ALTRET(NTYP);
     1208    12358    2         ELSE CALL KQB$SRCH (KQ$TTREE, MBLK$->KQ$MBLK.KEY1, MTYP$) ALTRET(NTYP);
     1209    12359    3           DO WHILE ('0'B) ;
     1210    12360    3   NTYP:   MTYP$ = ADDR(NIL);
     1211    12361    3           END;
     1212    12362
     1213    12363              %UNLOCK (G=KQ$TTREE.GATE) ;
     1214    12366
     1215    12367    2         RETURN;
     1216    12368    2   END FINDMTYP;
     1217    12369        /****************************************************************
     1218    12370        *****************************************************************/
     1219    12371        /*D* NAME:         XFERD
     1220    12372             PURPOSE:      To transfer a write into the reader's buffer
     1221    12373             DESCRIPTION:  Enter with DSTA$ pointing to the reader's KQ$STA,
     1222    12374                           and with its gate locked.  RBLK$ points to the
     1223    12375                           reader's read, MBLK$ points to the writer's write.
     1224    12376                           K$RWPARM.MSG$ is the buffer.
     1225    12377
     1226    12378                           If the reader's buffer is too short, returns with
     1227    12379                           everything unlocked, else ALTRETs
     1228    12380                           with the data transfered, the read COMPed.
     1229    12381
     1230    12382                           Used only if the data is being xferred directly
     1231    12383                           from the writer's buffer.
     1232    12384        */
     1233    12385    1   XFERD: PROC ALTRET;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:37   
     1234    12386        /**/
     1235    12387    2   DCL QLOCK UBIN;
     1236    12388    2   DCL RRQ$ PTR;
     1237    12389        /**/
     1238    12390    2         QLOCK=0;
     1239    12391    2         GOTO XFER;
     1240    12392        /*D* NAME:         XFERQ
     1241    12393             PURPOSE:      To transfer a write into the reader's buffer
     1242    12394             DESCRIPTION:  Same as XFERD but the read was found in the
     1243    12395                           queue.  P$ points to the link word which must
     1244    12396                           be set to the RBLK's link if we complete the
     1245    12397                           xfer (this removes the read from the queue).
     1246    12398                           Also, this routine is entered with the queue
     1247    12399                           locked.
     1248    12400        */
     1249    12401    2   XFERQ: ENTRY ALTRET;
     1250    12402    2         QLOCK=1;
     1251    12403    2   XFER: ;
     1252    12404    2         RRQ$=DSTA$->KQ$STA.LDCT$->N$LDCT.IOQ$;
     1253    12405    2         RRQ$->N$REQ.TYC='0'B;
     1254    12406    2         I=MBLK$->KQ$MBLK.MSGSIZE;
     1255    12407    2         IF I > RBLK$->KQ$RBLKD.BUFSIZE THEN
     1256    12408    3           DO;
     1257    12409                %UNLOCK (G=DSTA$->KQ$STA.GATE);
     1258    12412    3           IF QLOCK ~= 0 THEN
     1259    12413    4             DO;
     1260    12414                  %UNLOCK (G=KQ$QTREE.GATE);
     1261    12417    4             END;
     1262    12418    3           RETURN;
     1263    12419    3           END;
     1264    12420              %LOCK (G=KQ_XFGATE);
     1265    12423    2         B$CGPT$->B$$XFPTW=RBLK$->KQ$RBLKD.PTW;
     1266    12424    2         CALL HFC$ASSOCCLR(%CGWSQ,0,2);
     1267    12425    2         IF K$RWPARM.DVE.DVBYTE.VFC
     1268    12426    3         THEN DO;
     1269    12427    3           BUF$ = RBLK$->KQ$RBLKD.BUF$;
     1270    12428    3           I = 1;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:38   
     1271    12429    3           BUF$->B$$CHARS = K$RWPARM.DVE.VFC;
     1272    12430    3           BUF$ = PINCRC(BUF$,1);
     1273    12431    3           I = MBLK$->KQ$MBLK.MSGSIZE - 1;
     1274    12432    3           BUF$->B$$CHARS = K$RWPARM.MSG$->B$$CHARS;
     1275    12433    3           END;
     1276    12434    2         ELSE
     1277    12435    2          RBLK$->KQ$RBLKD.BUF$->B$$CHARS=K$RWPARM.MSG$->B$$CHARS;
     1278    12436    2         B$CGPT$->B$$XFPTW='0'B;
     1279    12437    2         CALL HFC$ASSOCCLR(%CGWSQ,0,2);
     1280    12438              %UNLOCK (G=KQ_XFGATE);
     1281    12441    2         RRQ$->N$REQ.ARSIZE=MBLK$->KQ$MBLK.MSGSIZE;
     1282    12442    2         IF QLOCK ~= 0 THEN
     1283    12443    2          CALL MOVMCQ (STA$->KQ$STA.MBLK$);
     1284    12444    2         ELSE
     1285    12445    2          CALL MOVMC (STA$->KQ$STA.MBLK$);
     1286    12446    2         K$RWPARM.MSGID=MBLK$->KQ$MBLK.MID.PRIMARY;
     1287    12447    2         K$RWPARM.MSGIDXT=BINBIT(MBLK$->KQ$MBLK.MID.XT,36);
     1288    12448    2         CALL KQR$COMP (RRQ$->N$REQ);
     1289    12449    2         ALTRETURN;
     1290    12450        /**/
     1291    12451        /*D* NAME:         MOVMCQ
     1292    12452             PURPOSE:      To move a msg
     1293    12453                           to a reading station.
     1294    12454             DESCRIPTION:  DSTA$ is the destination
     1295    12455                           (the reader).  RBLK$ is the reading RBLK,
     1296    12456                           M$ is the pointer to the MBLK.
     1297    12457
     1298    12458                           The MBLK is moved to be pointed to by the
     1299    12459                           RBLK.  M$ is set to point to the MBLK's old link.
     1300    12460                           The RBLK's state is set to KQRS_XFDN#.
     1301    12461
     1302    12462                           The reader's station is locked, and it is
     1303    12463                           unlocked after we're done.  All this is done
     1304    12464                           inhibited to prevent losing the MBLK during a
     1305    12465                           crash (i.e. if another CPU screeches, it's
     1306    12466                           interrupt won't jerk us out).
     1307    12467
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:39   
     1308    12468                           The RBLK was originally found in the queue, and
     1309    12469                           P$ points the link which must be set to the
     1310    12470                           RBLK's link in order to remove it from the
     1311    12471                           queue.  The queue is unlocked after we're all
     1312    12472                           done.  The RBLK does not specify LATCH.
     1313    12473        */
     1314    12474    2   MOVMCQ: PROC (M$);
     1315    12475        /**/
     1316    12476    3   DCL M$ PTR;
     1317    12477        /**/
     1318    12478    4           DO INHIBIT;
     1319    12479    4           P$->B$$PTR=RBLK$->KQ$RBLKD.QRLNK$;
     1320    12480    4           RBLK$->KQ$RBLKD.QRLNK$=ADDR(NIL); /* alias LWRITES$ */
     1321    12481    4           MBLK$=M$;
     1322    12482    4           M$=MBLK$->KQ$MBLK.LNK$;
     1323    12483    4           IF RBLK$->KQ$RBLK.MBLK$~=ADDR(NIL) THEN
     1324    12484    4            RBLK$->KQ$RBLK.MBLK$->KQ$MBLK.RBLK = '0'B;
     1325    12485    4           RBLK$->KQ$RBLK.MBLK$=MBLK$;
     1326    12486    4           MBLK$->KQ$MBLK.RBLK = '1'B;
     1327    12487    4           MBLK$->KQ$MBLK.LNK$=ADDR(NIL);
     1328    12488    4           RBLK$->KQ$RBLK.STATE=KQRS_XFDN#;
     1329    12489                %UNLOCK (G=DSTA$->KQ$STA.GATE);
     1330    12492                %UNLOCK (G=KQ$QTREE.GATE);
     1331    12495    4           IF RBLK$->KQ$RBLKD.EOFTIME~=0 THEN
     1332    12496    4            CALL KQQ$DQEOFTIME(KQ$CG,RBLK$);
     1333    12497    4           RBLK$->KQ$RBLK.NCDDA=0;
     1334    12498    4           RETURN;
     1335    12499    4           END;
     1336    12500    3   END MOVMCQ;
     1337    12501        /**/
     1338    12502        /*D* NAME:         MOVMC
     1339    12503             PURPOSE:      To move a message from the writing station
     1340    12504                           to a reading station.
     1341    12505             DESCRIPTION:  Just like MOVMCQ except the read was not found
     1342    12506                           in the queue, so we must call DEQUEUE to remove
     1343    12507                           it if it was.  This means unlocking the reading station
     1344    12508                           first, since the queue isn't already locked, and
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:40   
     1345    12509                           one CANNOT lock a station and then the queue
     1346    12510                           (because we sometimes do the opposite).
     1347    12511        */
     1348    12512    2   MOVMC: PROC (M$);
     1349    12513        /**/
     1350    12514    3   DCL M$ PTR;
     1351    12515        /**/
     1352    12516    4           DO INHIBIT;
     1353    12517    4           MBLK$=M$;
     1354    12518    4           M$=MBLK$->KQ$MBLK.LNK$;
     1355    12519    4           IF RBLK$->KQ$RBLK.MBLK$~=ADDR(NIL) THEN
     1356    12520    4            RBLK$->KQ$RBLK.MBLK$->KQ$MBLK.RBLK = '0'B;
     1357    12521    4           RBLK$->KQ$RBLK.MBLK$=MBLK$;
     1358    12522    4           MBLK$->KQ$MBLK.RBLK = '1'B;
     1359    12523    4           MBLK$->KQ$MBLK.LNK$=ADDR(NIL);
     1360    12524    4           RBLK$->KQ$RBLK.STATE=KQRS_XFDN#;
     1361    12525    4           IF RBLK$->KQ$RBLKD.STA$ ~= ADDR(NIL) THEN
     1362    12526    5             DO;
     1363    12527                  %UNLOCK (G=DSTA$->KQ$STA.GATE);
     1364    12530    5             CALL KQQ$DEQUEUE (CG$->KQ$CG,RBLK$);
     1365    12531    5             IF RBLK$->KQ$RBLKD.EOFTIME~=0 THEN
     1366    12532    5              CALL KQQ$DQEOFTIME(KQ$CG,RBLK$);
     1367    12533    5             RBLK$->KQ$RBLK.NCDDA=0;
     1368    12534    5             END;
     1369    12535    4           ELSE
     1370    12536    5             DO;
     1371    12537    5             RBLK$->KQ$RBLK.NCDDA=0;
     1372    12538                  %UNLOCK (G=DSTA$->KQ$STA.GATE);
     1373    12541    5             END;
     1374    12542    4           RETURN;
     1375    12543    4           END;
     1376    12544    3   END MOVMC;
     1377    12545    2   END XFERD;
     1378    12546    1   END KQP$PUT;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:41   
--  Include file information  --

   NK_SUBS.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQP$PUT.

   Procedure KQP$PUT requires 2176 words for executable code.
   Procedure KQP$PUT requires 80 words of local(AUTO) storage.

    No errors detected in file KQP$PUT.:E05TSI    .

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:42   

 Object Unit name= KQP$PUT                                    File name= KQP$PUT.:E05TOU
 UTS= JUL 30 '97 01:31:54.36 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      5      5  KQP$PUT
    1   Proc  even  none  2176   4200  KQP$PUT
    2  RoData even  none    31     37  KQP$PUT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KQP$PUT
     1   1657          yes     yes      Std        1  KQP$GCONT
     1   2015          yes     yes      Std        1  KQP$PCG
     1   2036          yes     yes      Std        1  KQP$DVGET
     1   2067          yes     yes      Std        2  KQP$DONE
     1   2075          yes     yes      Std        2  KQP$DONET
     1   2343          yes     yes      Std        1  KQP$INCMP
     1   2402          yes     yes      Std        2  KQP$EVNT
     1   2422          yes     yes      Std        2  KQP$FPEXIT
     1   2442          yes     yes      Std        2  KQP$FPABORT
     1   2462          yes     yes      Std        2  KQP$FPLDTRC
     1   2502          yes     yes      Std        1  KQP$UNLOCK
     1   2557          yes     yes      Std        1  KQP$DISC
     1   2756          yes     yes      Std        1  KQP$FDISC
     1   3030          yes     yes      Std        1  KQP$DSCGO
     1   3151          yes     yes      Std        1  KQP$CDISC
     1   3215          yes     yes      Std        1  KQP$RECOVER
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:43   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KCO$DSCTRM
 yes     yes           Std       3 KQM$GETMBLK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       8 KQZ$LOG
 yes     yes           Std       2 KCD$RDGO
 yes     yes           Std       4 MMS$VGET
 yes     yes           Std       3 KQT$GETTYP
 yes     yes           Std       2 KQD$UNLOCK
 yes     yes           Std       1 KQG$RECOVER
 yes     yes           Std       3 KQM$GETBD
 yes     yes           Std       3 KQD$GET
 yes     yes           Std       3 KQD$DEFERGO
 yes     yes           Std       2 KCD$INCMP
 yes     yes           Std       3 KCA$TELLAU
 yes     yes           Std       2 KQD$DELETE
         yes           Std       1 HFC$LOCK
 yes     yes           Std       3 KQB$SRCH
 yes     yes           Std       2 MMS$VREL
 yes     yes           Std       2 KQM$RELMTYP
 yes     yes           Std       1 KQW$SENDNA
         yes           Std       0 SSS$BLOCK
         yes           Std       4 SSR$RUE
 yes     yes           Std       2 KQM$RELRBLKT
 yes     yes           Std       2 KQM$RELMBLK
 yes     yes           Std       1 KQG$CLEANUP
         yes           Std       1 KQX$LDASR
 yes     yes           Std       3 KQT$GETSTA
 yes     yes           Std       1 KQU$DELETE
         yes           Std       3 HFC$ASSOCCLR
 yes     yes           Std       1 KQR$COMP
 yes     yes           Std       2 KQQ$DQEOFTIME
 yes     yes           Std       2 KQQ$DEQUEUE
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:44   
 yes     yes           Std       1 KQP$GCONT
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BCGPUT                             SC_BCGPSC                             KQ_DEBUG
     KQ_XFGATE                             KQ_LOG                                KQ_IMTYP
     KC_LGL1ST                             B$CGPT$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:45   


        1        1        /*M* KQP$PUT TERMINAL write to COMGROUP */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQP$PUT
       10       10             PURPOSE:      To provide COMGROUP WRITE functions for TERMINALs
       11       11             DESCRIPTION:  Contains all routines to implement write of COMGROUP
       12       12                           from TERMINALs.  Is the complement of KQG$GET, which
       13       13                           handles comgroup reads from TERMINALs.
       14       14        */
       15       15        /*F* NAME:         KQP$PUT
       16       16             PURPOSE:      To receive write from terminals
       17       17             DESCRIPTION:  KCF$FEIN calls here when a terminal wants to
       18       18                           write a message into the host, and the terminal
       19       19                           is connected to a COMGROUP.
       20       20
       21       21                           The params for the message to be created are
       22       22                           passed in K$RWPARM.  KQP$PUT checks the msgtyp
       23       23                           (blanks gets the AU-set default), and gives an
       24       24                           error if illegal.  Else it gets an MBLK and gives
       25       25                           an error if none are available.  The message
       26       26                           params are stuffed into the MBLK.
       27       27
       28       28                           Next, if there is no data (K$RWPARM.MSGSZ = 0),
       29       29                           we send the message.  Else (data present) if
       30       30                           it's in the circular queue we try to find a
       31       31                           reader for it, and if so, stuff the data into
       32       32                           his buffer without ever buffering it thru the
       33       33                           comgroup.  If this works we COMP his read and
       34       34                           just get out.
       35       35
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:46   
       36       36                           If the data must be buffered thru the comgroup
       37       37                           for some reason, then a DBLK is
       38       38                           allocated to put the data in.  If none are available
       39       39                           immediately, we post a request for one and ALTRET;
       40       40                           when one becomes available we call KCD$RDGO as
       41       41                           below.  If a DBLK is
       42       42                           available, then if message data is present, we
       43       43                           stuff the data into it and send the message via
       44       44                           KQW$SEND (who may ALTRET saying the destination
       45       45                           station was bad, in which case we give an appropriate
       46       46                           error back).  Otherwise (no message data present),
       47       47                           we map the DBLK into the comm. WSQ page table and
       48       48                           call KCD$RDGO, which tells the writer to write the
       49       49                           data into the DBLK.  When this is complete, the
       50       50                           writer causes KQP$DONE to be called
       51       51                           at which point the message is dispatched
       52       52                           by KQW$SEND as above.
       53       53        */
       54       54        /**/
       55       55        KQP$PUT: PROC (PAR,K$RWPARM) ALTRET;

     55  1 000000   000000 700200 xent  KQP$PUT      TSX0  ! X66_AUTO_2
         1 000001   000120 000002                    ZERO    80,2

       56       56        /**/
       57       57
       58       58
       59       59
       60       60        /**/
       61       61        /* INCLUDES */
       62       62        /**/
       63       63        %INCLUDE B_STRINGS_C;
       64      192        %INCLUDE KQ_SUBS_C;
       65      492        %INCLUDE KQ_MAC_C;
       66     3042        %INCLUDE HF_LOCK_C;
       67     3056        %INCLUDE KQ_DATA_R;
       68     3888        %INCLUDE NK$LDCT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:47   
       69     3990        %INCLUDE KI_CP6;
       70     5086        %INCLUDE K$RWPARM;
       71     5472        %INCLUDE KC$CP6V_C;
       72     5592        %INCLUDE KC_CP6;
       73     6152        %INCLUDE CP_6_SUBS;
       74     6692        %INCLUDE SS_SCHED_C;
       75     6925        %INCLUDE N$REQ;
       76     6999        %INCLUDE JG_GHOSTS_C;
       77     7089        %INCLUDE OC_SUBS_C;
       78     7820        %INCLUDE KC_DATA_R;
       79     7833        %INCLUDE NK_SUBS;
       80     7858
       81     7859
       82     7860
       83     7861        /**/
       84     7862        /* PARAMETERS */
       85     7863        /**/
       86     7864    1   DCL PAR PTR;
       87     7865        %K$RWPARM (NAME=K$RWPARM);
       88     8181
       89     8182
       90     8183
       91     8184        /**/
       92     8185        /* BASED STRUCTURES */
       93     8186        /**/
       94     8187        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
       95     8926        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
       96     9265        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)");
       97     9535        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
       98     9573        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS="BASED(RBLK$)",TERM=1);
       99     9759        %KQ_RBLK (FPTN=KQ$RBLKD,STCLASS="BASED(RBLK$)",TERM=0);
      100     9945        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED(DBLK$)");
      101     9998        %KQ_MTYP (FPTN=KQ$MTYP,STCLASS="BASED(MTYP$)");
      102    10072        %KQ_QTN  (FPTN=KQ$QTN,STCLASS=BASED);
      103    10545        %KQ_DFRPARM (FPTN=KQ$DFRPARM,STCLASS=BASED);
      104    10574        %KQ_DFRBLK (FPTN=KQ$DFRBLK,STCLASS="BASED(DBLK$)");
      105    10624        %NK$LDCT (NAME=NK$LDCT,STCLASS="BASED(NK$LDCTAUTO$)");
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:48   
      106    10670        %NK$LDCT (NAME=N$LDCT,STCLASS=BASED);
      107    10716        %N$REQ (STCLASS=BASED);
      108    10774        %VLP_FPRG(FPTN=VLP$FPRG,STCLASS=BASED);
      109    10795    1   DCL 1 B$$PRIO BASED HALIGNED,
      110    10796    1         2 HI UBIN BYTE UNAL,
      111    10797    1         2 LO UBIN BYTE UNAL;
      112    10798    1   DCL B$$CHARS CHAR(I) BASED CALIGNED;
      113    10799    1   DCL B$$WORD UBIN WORD BASED ALIGNED;
      114    10800    1   DCL B$$SBIN SBIN WORD BASED ALIGNED;
      115    10801    1   DCL B$$HALF UBIN HALF BASED HALIGNED;
      116    10802    1   DCL B$$CHAR1 CHAR(1) BASED CALIGNED;
      117    10803    1   DCL B$$KEY1 CHAR(KEY1L) BASED ALIGNED;
      118    10804    1   DCL B$$KEY2 CHAR(KEY2L) BASED ALIGNED;
      119    10805    1   DCL 1 B$$XFPTW BASED DALIGNED,
      120    10806    1         2 * (0:1) UBIN;
      121    10807    1   DCL B$$PTR PTR BASED ALIGNED;
      122    10808
      123    10809
      124    10810
      125    10811        /**/
      126    10812        /* AUTO */
      127    10813        /**/
      128    10814    1   DCL STA$ PTR;
      129    10815    1   DCL MBLK$ PTR;
      130    10816    1   DCL CG$ PTR;
      131    10817    1   DCL NK$LDCTAUTO$ PTR;
      132    10818    1   DCL DBLK$ PTR;
      133    10819    1   DCL DBLK$R REDEF DBLK$ UBIN;
      134    10820    1   DCL I UBIN;
      135    10821    1   DCL J SBIN;
      136    10822    1   DCL DDA UBIN;
      137    10823    1   DCL MTYP$ PTR;
      138    10824    1   DCL KEY1L UBIN HALF;
      139    10825    1   DCL KEY2L UBIN HALF;
      140    10826    1   DCL TACTCNT REDEF KEY2L UBIN HALF;
      141    10827    1   DCL RBLK$ PTR;
      142    10828    1   DCL DSTA$ PTR;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:49   
      143    10829    1   DCL QTN$ PTR;
      144    10830    1   DCL DOTYC UBIN;
      145    10831        %K$RWPARM (NAME=RWPARM,STCLASS=AUTO);
      146    11147    1   DCL LOCKSET UBIN;
      147    11148    1   DCL P$ PTR;
      148    11149    1   DCL BUF$ PTR;
      149    11150    1   DCL 1 AUTOGATE DALIGNED,
      150    11151    1         2 LOCK UBIN(36),
      151    11152    1         2 *    UBIN(36);
      152    11153
      153    11154
      154    11155
      155    11156        /**/
      156    11157        /* REFS */
      157    11158        /**/
      158    11159    1   DCL HFC$ASSOCCLR  ENTRY(3);
      159    11160    1   DCL KCA$TELLAU    ENTRY(3) ALTRET;
      160    11161    1   DCL KCD$INCMP     ENTRY(2) ALTRET;
      161    11162    1   DCL KCD$RDGO      ENTRY(2) ALTRET;
      162    11163    1   DCL KCO$DSCTRM    ENTRY(1);
      163    11164    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      164    11165    1   DCL KQD$DEFERGO   ENTRY(3) ALTRET;
      165    11166    1   DCL KQD$DELETE    ENTRY(2) ALTRET;
      166    11167    1   DCL KQD$GET       ENTRY(3) ALTRET;
      167    11168    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      168    11169    1   DCL KQG$CLEANUP   ENTRY(1) ALTRET;
      169    11170    1   DCL KQG$RECOVER   ENTRY(1) ALTRET;
      170    11171    1   DCL KQM$GETBD     ENTRY(3) ALTRET;
      171    11172    1   DCL KQM$GETMBLK   ENTRY(3) ALTRET;
      172    11173    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      173    11174    1   DCL KQM$RELRBLKT  ENTRY(2) ALTRET;
      174    11175    1   DCL KQM$RELMTYP   ENTRY(2) ALTRET;
      175    11176    1   DCL KQQ$DEQUEUE   ENTRY(2) ALTRET;
      176    11177    1   DCL KQQ$DQEOFTIME ENTRY(2) ALTRET;
      177    11178    1   DCL KQR$COMP      ENTRY(1) ALTRET;
      178    11179    1   DCL KQT$GETSTA    ENTRY(3) ALTRET;
      179    11180    1   DCL KQT$GETTYP    ENTRY(3) ALTRET;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:50   
      180    11181    1   DCL KQU$DELETE    ENTRY(1) ALTRET;
      181    11182    1   DCL KQW$SENDNA    ENTRY(1) ALTRET;
      182    11183    1   DCL KQX$LDASR     ENTRY(1);
      183    11184    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      184    11185    1   DCL MMS$VGET      ENTRY(4) ALTRET;
      185    11186    1   DCL MMS$VREL      ENTRY(2) ALTRET;
      186    11187    1   DCL SSR$RUE       ENTRY(4);
      187    11188    1   DCL SSS$BLOCK     ENTRY;
      188    11189    1   DCL SC_BCGPUT     ENTRY    CONV(2,0);
      189    11190    1   DCL SC_CGNOTIMP   ENTRY    CONV(2,0);
      190    11191    1   DCL SC_BCGPSC     ENTRY    CONV(2,0);
      191    11192    1   DCL B$CGPT$ PTR SYMREF;
      192    11193
      193    11194
      194    11195
      195    11196        /**/
      196    11197        /* SUBS */
      197    11198        /**/
      198    11199        %EQU_CG;
      199    11247        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
      200    11248        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      201    11249        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      202    11250        %SUB DFRP$="ADDR(PAR)";
      203    11251        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:51   
      204    11252        /**/
      205    11253    1         NK$LDCTAUTO$= ADDR(PAR);

  11253  1 000002   200003 236100                    LDQ     @PAR,,AUTO
         1 000003   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      206    11254    1         CALL SETUP ALTRET(RTN);

  11254  1 000004   003245 701000 1                  TSX1    SETUP
         1 000005   002334 702000 1                  TSX2    GETOUT

      207    11255            /*********************************************
      208    11256             *                                           *
      209    11257             *         Build the MBLK from the params    *
      210    11258             *                                           *
      211    11259             *********************************************/
      212    11260    2           DO INHIBIT;

      213    11261    2           IF STA$->KQ$STA.MREQ ~= 0 THEN

  11261  1 000006   200005 470700                    LDP0  ! STA$,,AUTO
         1 000007   000020 236300                    LDQ   ! 16,,PR0
         1 000010   000777 316203                    CANQ  ! 511,DU
         1 000011   000034 600200 1                  TZE   ! s:11271

      214    11262    2            IF STA$->KQ$STA.MREQ = KQMR_MBLK# THEN GOTO NOMBLK;

  11262  1 000012   000777 376203                    ANQ   ! 511,DU
         1 000013   000001 116203                    CMPQ  ! 1,DU
         1 000014   001475 600200 1                  TZE   ! NOMBLK

      215    11263    2            ELSE IF STA$->KQ$STA.MREQ = - KQMR_MBLK# THEN

  11263  1 000015   000020 236300                    LDQ   ! 16,,PR0
         1 000016   000777 376203                    ANQ   ! 511,DU
         1 000017   000777 116203                    CMPQ  ! 511,DU
         1 000020   000034 601200 1                  TNZ   ! s:11271
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:52   

      216    11264    3               DO;

      217    11265    3               MBLK$=STA$->KQ$STA.MREQ$;

  11265  1 000021   000024 236300                    LDQ   ! 20,,PR0
         1 000022   200006 756300                    STQ   ! MBLK$,,AUTO

      218    11266    3               STA$->KQ$STA.MREQ=0;

  11266  1 000023   000000 236203                    LDQ   ! 0,DU
         1 000024   000020 552320                    STBQ  ! 16,'20'O,PR0

      219    11267    3               IF MBLK$ ~= ADDR(NIL) THEN GOTO P3;

  11267  1 000025   200006 236300                    LDQ   ! MBLK$,,AUTO
         1 000026   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 000027   000071 601200 1                  TNZ   ! P3

      220    11268    3               K$RWPARM.ERR=KQPE_QFUL#;

  11268  1 000030   000005 235207                    LDA   ! 5,DL
         1 000031   200004 471700                    LDP1  ! @K$RWPARM,,AUTO
         1 000032   100013 755300                    STA   ! 11,,PR1

      221    11269    3               ALTRETURN;

  11269  1 000033   000000 702200 xent               TSX2  ! X66_AALT

      222    11270    3               END;
      223    11271    2           CALL KQM$GETMBLK (CG$->KQ$CG,MBLK$,I) ALTRET(P2);

  11271  1 000034   200012 631700                    EPPR1 ! I,,AUTO
         1 000035   200112 451700                    STP1  ! @M$+3,,AUTO
         1 000036   200006 633700                    EPPR3 ! MBLK$,,AUTO
         1 000037   200111 453700                    STP3  ! @M$+2,,AUTO
         1 000040   200007 236300                    LDQ   ! CG$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:53   
         1 000041   200110 756300                    STQ   ! @M$+1,,AUTO
         1 000042   200110 630700                    EPPR0 ! @M$+1,,AUTO
         1 000043   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         1 000044   000000 701200 xent               TSX1  ! KQM$GETMBLK
         1 000045   000047 702200 1                  TSX2  ! P2

      224    11272    2           GOTO P3;

  11272  1 000046   000071 710200 1                  TRA   ! P3

      225    11273    2   P2:     IF STA$->KQ$STA.MREQ ~= 0 THEN GOTO NOMBLK;

  11273  1 000047   200005 470700       P2           LDP0  ! STA$,,AUTO
         1 000050   000020 236300                    LDQ   ! 16,,PR0
         1 000051   000777 316203                    CANQ  ! 511,DU
         1 000052   001475 601200 1                  TNZ   ! NOMBLK

      226    11274    2           MBLK$=STA$;

  11274  1 000053   200005 236300                    LDQ   ! STA$,,AUTO
         1 000054   200006 756300                    STQ   ! MBLK$,,AUTO

      227    11275    2           I=KQMR_MBLK#;

  11275  1 000055   000001 235207                    LDA   ! 1,DL
         1 000056   200012 755300                    STA   ! I,,AUTO

      228    11276    2           CALL KQM$GETBD (CG$->KQ$CG,MBLK$,I) ALTRET(NOMBLK);

  11276  1 000057   200012 631700                    EPPR1 ! I,,AUTO
         1 000060   200112 451700                    STP1  ! @M$+3,,AUTO
         1 000061   200006 633700                    EPPR3 ! MBLK$,,AUTO
         1 000062   200111 453700                    STP3  ! @M$+2,,AUTO
         1 000063   200007 236300                    LDQ   ! CG$,,AUTO
         1 000064   200110 756300                    STQ   ! @M$+1,,AUTO
         1 000065   200110 630700                    EPPR0 ! @M$+1,,AUTO
         1 000066   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:54   
         1 000067   000000 701200 xent               TSX1  ! KQM$GETBD
         1 000070   001475 702200 1                  TSX2  ! NOMBLK

      229    11277    2   P3:     IF STA$->KQ$STA.MBLK$ ~= ADDR(NIL) THEN

  11277  1 000071   200005 470700       P3           LDP0  ! STA$,,AUTO
         1 000072   000012 236300                    LDQ   ! 10,,PR0
         1 000073   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 000074   000100 600200 1                  TZE   ! s:11293

      230    11278    2            CALL SC_BCGPUT;

  11278  1 000075   000000 713600 xsym               CLIMB ! SC_BCGPUT
         1 000076   000000 600000 xsid               climb   nvectors=         0
         1 000077   000105 710200 1                  TRA   ! s:11294

      231    11279        /*S* SCREECH_CODE: KQP-S$BCGPUT
      232    11280             TYPE:         SCREECH
      233    11281             MESSAGE:      Event-state conflict during PUT to COMGROUP
      234    11282             REMARKS:      KQP$PUT has been entered to start or continue
      235    11283                           a terminal PUT to COMGROUP, and the state of
      236    11284                           that terminal's PUT is not consistent with
      237    11285                           the way KQP$PUT was entered.  Examples are
      238    11286                           KQP$PUT called when the terminal has an MBLK,
      239    11287                           KQP$DONE called when the terminal has no PUT
      240    11288                           or it does but the PUT is not in the right
      241    11289                           state.  One must examine the way KQP$PUT was
      242    11290                           entered, in
      243    11291                           order to determine what the inconsistency was,
      244    11292                           and why it occured. */
      245    11293    2           ELSE IF STA$->KQ$STA.JRNLW THEN CALL SC_BCGPUT;

  11293  1 000100   000023 236300                    LDQ   ! 19,,PR0
         1 000101   004000 316207                    CANQ  ! 2048,DL
         1 000102   000105 600200 1                  TZE   ! s:11294

  11293  1 000103   000000 713600 xsym               CLIMB ! SC_BCGPUT
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:55   
         1 000104   000000 600000 xsid               climb   nvectors=         0

      246    11294    2           STA$->KQ$STA.VGOT$=ADDR(NIL);

  11294  1 000105   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 000106   200005 470700                    LDP0  ! STA$,,AUTO
         1 000107   000025 756300                    STQ   ! 21,,PR0

      247    11295    2           STA$->KQ$STA.MBLK$=MBLK$;

  11295  1 000110   200006 236300                    LDQ   ! MBLK$,,AUTO
         1 000111   000012 756300                    STQ   ! 10,,PR0

      248    11296    2           CG$->KQ$CG.STATS.PUTS=CG$->KQ$CG.STATS.PUTS+1;

  11296  1 000112   200007 471700                    LDP1  ! CG$,,AUTO
         1 000113   100170 054300                    AOS   ! 120,,PR1

      249    11297    2           STA$->KQ$STA.WRITES=STA$->KQ$STA.WRITES+1;

  11297  1 000114   000027 054300                    AOS   ! 23,,PR0

      250    11298    2           END;

      251    11299    1         IF K$RWPARM.STATION ~= '?' THEN

  11299  1 000115   200004 473500                    LDP3    @K$RWPARM,,AUTO
         1 000116   300002 237100                    LDAQ    2,,PR3
         1 000117   000000 117000 2                  CMPAQ   0
         1 000120   000126 600000 1                  TZE     s:11301

      252    11300    1          MBLK$->KQ$MBLK.DSTA=K$RWPARM.STATION;

  11300  1 000121   200006 474500                    LDP4    MBLK$,,AUTO
         1 000122   300002 237100                    LDAQ    2,,PR3
         1 000123   400011 755100                    STA     9,,PR4
         1 000124   400012 756100                    STQ     10,,PR4
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:56   
         1 000125   000133 710000 1                  TRA     s:11302

      253    11301    1         ELSE MBLK$->KQ$MBLK.DSTA=' ';

  11301  1 000126   200006 474500                    LDP4    MBLK$,,AUTO
         1 000127   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000130   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000131   400011 755100                    STA     9,,PR4
         1 000132   400012 756100                    STQ     10,,PR4

      254    11302    1         IF K$RWPARM.MSGTYP = ' '

  11302  1 000133   300004 237100                    LDAQ    4,,PR3
         1 000134   000002 117000 2                  CMPAQ   2
         1 000135   000142 601000 1                  TNZ     s:11304

      255    11303    1         THEN MBLK$->KQ$MBLK.KEY1=CG$->KQ$CG.AUCTL.TMTYP;

  11303  1 000136   040100 100500                    MLR     fill='040'O
         1 000137   100125 000010                    ADSC9   85,,PR1                  cn=0,n=8
         1 000140   400002 000010                    ADSC9   2,,PR4                   cn=0,n=8
         1 000141   000144 710000 1                  TRA     s:11305

      256    11304    1         ELSE MBLK$->KQ$MBLK.KEY1=K$RWPARM.MSGTYP;

  11304  1 000142   300004 237100                    LDAQ    4,,PR3
         1 000143   400002 757100                    STAQ    2,,PR4

      257    11305    1         MTYP$ = ADDR(NIL);

  11305  1 000144   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000145   200015 756100                    STQ     MTYP$,,AUTO

      258    11306    1         IF SUBSTR(MBLK$->KQ$MBLK.KEY1,0,1) ~= '*'

  11306  1 000146   200006 474500                    LDP4    MBLK$,,AUTO
         1 000147   400002 236100                    LDQ     2,,PR4
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:57   
         1 000150   777000 376003                    ANQ     -512,DU
         1 000151   052000 116003                    CMPQ    21504,DU
         1 000152   000213 600000 1                  TZE     s:11319

      259    11307    2         THEN DO;

  11304  1 000153                       FNDTYP       null
      260    11308    2   FNDTYP: ;
      261    11309                %LOCK (G=KQ$TTREE.GATE);

  11310  1 000153   200007 236100                    LDQ     CG$,,AUTO
         1 000154   000067 036003                    ADLQ    55,DU
         1 000155   200110 756100                    STQ     @M$+1,,AUTO
         1 000156   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000157   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000160   000000 701000 xent               TSX1    HFC$LOCK
         1 000161   000000 011000                    NOP     0

      262    11312    2           CALL KQB$SRCH (KQ$TTREE,MBLK$->KQ$MBLK.KEY1,MTYP$) ALTRET(NOMTYP);

  11312  1 000162   200015 630500                    EPPR0   MTYP$,,AUTO
         1 000163   200112 450500                    STP0    @M$+3,,AUTO
         1 000164   200006 236100                    LDQ     MBLK$,,AUTO
         1 000165   000002 036003                    ADLQ    2,DU
         1 000166   200111 756100                    STQ     @M$+2,,AUTO
         1 000167   200007 236100                    LDQ     CG$,,AUTO
         1 000170   000067 036003                    ADLQ    55,DU
         1 000171   200110 756100                    STQ     @M$+1,,AUTO
         1 000172   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000173   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000174   000000 701000 xent               TSX1    KQB$SRCH
         1 000175   001501 702000 1                  TSX2    NOMTYP

  11312  1 000176                       GOTMTYP      null
      263    11313    2   GOTMTYP:;
      264    11314    2           MTYP$->KQ$MTYP.NUMWRITES = MTYP$->KQ$MTYP.NUMWRITES + 1;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:58   
  11314  1 000176   200015 470500                    LDP0    MTYP$,,AUTO
         1 000177   000010 054100                    AOS     8,,PR0

      265    11315    2           MBLK$->KQ$MBLK.JOURNAL=MTYP$->KQ$MTYP.JOURNAL;

  11315  1 000200   200006 470500                    LDP0    MBLK$,,AUTO
         1 000201   200015 471500                    LDP1    MTYP$,,AUTO
         1 000202   100007 236100                    LDQ     7,,PR1
         1 000203   000022 772000                    QRL     18
         1 000204   000010 676100                    ERQ     8,,PR0
         1 000205   000400 376007                    ANQ     256,DL
         1 000206   000010 656100                    ERSQ    8,,PR0

      266    11316    2           TACTCNT=KQ$TTREE.ACTCNT;

  11316  1 000207   200007 471500                    LDP1    CG$,,AUTO
         1 000210   100074 220100                    LDX0    60,,PR1
         1 000211   200017 740100                    STX0    KEY2L,,AUTO

      267    11317    2           END;

  11317  1 000212   000300 710000 1                  TRA     s:11344

      268    11318    2         ELSE DO;

      269    11319    2           IF MBLK$->KQ$MBLK.KEY1='*AUEV' THEN GOTO BADMTYP1;

  11319  1 000213   040000 106500                    CMPC    fill='040'O
         1 000214   400002 000010                    ADSC9   2,,PR4                   cn=0,n=8
         1 000215   000000 000005 0                  ADSC9   0                        cn=0,n=5
         1 000216   001556 600000 1                  TZE     BADMTYP1

      270    11320    2           MBLK$->KQ$MBLK.STAR='1'B;

  11320  1 000217   100000 236003                    LDQ     32768,DU
         1 000220   400010 256100                    ORSQ    8,,PR4

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:59   
      271    11321    2           IF MBLK$->KQ$MBLK.DSTA = ' ' THEN

  11321  1 000221   040000 106500                    CMPC    fill='040'O
         1 000222   400011 000010                    ADSC9   9,,PR4                   cn=0,n=8
         1 000223   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000224   000267 601000 1                  TNZ     s:11339

      272    11322    3             DO;

      273    11323                  %LOCK (G=KQ$STREE.GATE);

  11324  1 000225   200007 236100                    LDQ     CG$,,AUTO
         1 000226   000075 036003                    ADLQ    61,DU
         1 000227   200110 756100                    STQ     @M$+1,,AUTO
         1 000230   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000231   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000232   000000 701000 xent               TSX1    HFC$LOCK
         1 000233   000000 011000                    NOP     0

      274    11326    3             IF CG$->KQ$CG.AUSTA$ = ADDR(NIL) THEN

  11326  1 000234   200007 470500                    LDP0    CG$,,AUTO
         1 000235   000121 236100                    LDQ     81,,PR0
         1 000236   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000237   000253 601000 1                  TNZ     s:11334

      275    11327    4               DO;

      276    11328                    %UNLOCK (G=KQ$STREE.GATE);

  11329  1 000240   200007 236100                    LDQ     CG$,,AUTO
         1 000241   000075 036003                    ADLQ    61,DU
         1 000242   200110 756100                    STQ     @M$+1,,AUTO
         1 000243   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000244   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000245   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000246   000000 011000                    NOP     0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:60   

      277    11331    4               K$RWPARM.ERR=KQPE_NOSTA#;

  11331  1 000247   000004 235007                    LDA     4,DL
         1 000250   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000251   000013 755100                    STA     11,,PR0

      278    11332    4               GOTO DELALT;

  11332  1 000252   001563 710000 1                  TRA     DELALT

      279    11333    4               END;
      280    11334    3             MBLK$->KQ$MBLK.DSTA=CG$->KQ$CG.AUSTA$->KQ$STA.BTN.KEY;

  11334  1 000253   000121 471500                    LDP1    81,,PR0
         1 000254   200006 473500                    LDP3    MBLK$,,AUTO
         1 000255   040100 100500                    MLR     fill='040'O
         1 000256   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 000257   300011 000010                    ADSC9   9,,PR3                   cn=0,n=8

      281    11335                  %UNLOCK (G=KQ$STREE.GATE);

  11336  1 000260   200007 236100                    LDQ     CG$,,AUTO
         1 000261   000075 036003                    ADLQ    61,DU
         1 000262   200110 756100                    STQ     @M$+1,,AUTO
         1 000263   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000264   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000265   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000266   000000 011000                    NOP     0

      282    11338    3             END;

      283    11339    2           MTYP$=ADDR(KQ_IMTYP);

  11339  1 000267   000004 236000 2                  LDQ     4
         1 000270   200015 756100                    STQ     MTYP$,,AUTO

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:61   
      284    11340                %LOCK (G=KQ$TTREE.GATE);

  11341  1 000271   200007 236100                    LDQ     CG$,,AUTO
         1 000272   000067 036003                    ADLQ    55,DU
         1 000273   200110 756100                    STQ     @M$+1,,AUTO
         1 000274   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000275   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000276   000000 701000 xent               TSX1    HFC$LOCK
         1 000277   000000 011000                    NOP     0

      285    11343    2           END;

      286    11344    1         MBLK$->KQ$MBLK.MSGSIZE=K$RWPARM.MSGSZ;

  11344  1 000300   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000301   000001 235100                    LDA     1,,PR0
         1 000302   200006 471500                    LDP1    MBLK$,,AUTO
         1 000303   100016 755100                    STA     14,,PR1

      287    11345    1         IF K$RWPARM.DVE.DVBYTE.VFC

  11345  1 000304   000010 236100                    LDQ     8,,PR0
         1 000305   100000 316003                    CANQ    32768,DU
         1 000306   000311 600000 1                  TZE     s:11348

      288    11346    1         THEN
      289    11347    1          MBLK$->KQ$MBLK.MSGSIZE = MBLK$->KQ$MBLK.MSGSIZE + 1;

  11347  1 000307   000001 035007                    ADLA    1,DL
         1 000310   100016 755100                    STA     14,,PR1

      290    11348    1         IF K$RWPARM.MSGSZ > CG$->KQ$CG.AUCTL.MAXMC THEN

  11348  1 000311   200007 473500                    LDP3    CG$,,AUTO
         1 000312   300134 236100                    LDQ     92,,PR3
         1 000313   000322 604000 1                  TMI     s:11353
         1 000314   000001 116100                    CMPQ    1,,PR0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:62   
         1 000315   000322 605000 1                  TPL     s:11353

      291    11349    2           DO;

      292    11350    2           MBLK$->KQ$MBLK.MSGSIZE=CG$->KQ$CG.AUCTL.MAXMC;

  11350  1 000316   100016 756100                    STQ     14,,PR1

      293    11351    2           MBLK$->KQ$MBLK.TYC=MBLK$->KQ$MBLK.TYC|%TYC_LD;

  11351  1 000317   100013 236100                    LDQ     11,,PR1
         1 000320   000002 276000 0                  ORQ     2
         1 000321   100013 756100                    STQ     11,,PR1

      294    11352    2           END;

      295    11353    1         IF CG$->KQ$CG.QISS THEN

  11353  1 000322   300106 235100                    LDA     70,,PR3
         1 000323   000345 600000 1                  TZE     s:11362

      296    11354    2           DO;

      297    11355    2           ADDR(MBLK$->KQ$MBLK.PRIO)->B$$PRIO.HI=STA$->KQ$STA.MPRIO;

  11355  1 000324   200005 474500                    LDP4    STA$,,AUTO
         1 000325   400015 236100                    LDQ     13,,PR4
         1 000326   000011 736000                    QLS     9
         1 000327   100001 552140                    STBQ    1,'40'O,PR1

      298    11356    2           ADDR(MBLK$->KQ$MBLK.PRIO)->B$$PRIO.LO=MTYP$->KQ$MTYP.MPRIO;

  11356  1 000330   200015 471500                    LDP1    MTYP$,,AUTO
         1 000331   200006 475500                    LDP5    MBLK$,,AUTO
         1 000332   100007 236100                    LDQ     7,,PR1
         1 000333   000011 772000                    QRL     9
         1 000334   500001 552120                    STBQ    1,'20'O,PR5
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:63   

      299    11357    2           MBLK$->KQ$MBLK.KEY2=MBLK$->KQ$MBLK.KEY1;

  11357  1 000335   200006 471500                    LDP1    MBLK$,,AUTO
         1 000336   100002 237100                    LDAQ    2,,PR1
         1 000337   100004 757100                    STAQ    4,,PR1

      300    11358    2           MBLK$->KQ$MBLK.KEY1=STA$->KQ$STA.BTN.KEY;

  11358  1 000340   200006 471500                    LDP1    MBLK$,,AUTO
         1 000341   040100 100500                    MLR     fill='040'O
         1 000342   400005 000010                    ADSC9   5,,PR4                   cn=0,n=8
         1 000343   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8

      301    11359    2           END;

  11359  1 000344   000360 710000 1                  TRA     s:11367

      302    11360    1         ELSE
      303    11361    2           DO;

      304    11362    2           ADDR(MBLK$->KQ$MBLK.PRIO)->B$$PRIO.HI=MTYP$->KQ$MTYP.MPRIO;

  11362  1 000345   200015 474500                    LDP4    MTYP$,,AUTO
         1 000346   400007 236100                    LDQ     7,,PR4
         1 000347   100001 552140                    STBQ    1,'40'O,PR1

      305    11363    2           ADDR(MBLK$->KQ$MBLK.PRIO)->B$$PRIO.LO=STA$->KQ$STA.MPRIO;

  11363  1 000350   200005 471500                    LDP1    STA$,,AUTO
         1 000351   200006 474500                    LDP4    MBLK$,,AUTO
         1 000352   100015 236100                    LDQ     13,,PR1
         1 000353   400001 552120                    STBQ    1,'20'O,PR4

      306    11364    2           MBLK$->KQ$MBLK.KEY2=STA$->KQ$STA.BTN.KEY;

  11364  1 000354   200006 474500                    LDP4    MBLK$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:64   
         1 000355   040100 100500                    MLR     fill='040'O
         1 000356   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 000357   400004 000010                    ADSC9   4,,PR4                   cn=0,n=8

      307    11365    2           END;

      308    11366              /**/
      309    11367    1         IF MBLK$->KQ$MBLK.KEY1 = '*FPABT' THEN

  11367  1 000360   200006 471500                    LDP1    MBLK$,,AUTO
         1 000361   040000 106500                    CMPC    fill='040'O
         1 000362   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
         1 000363   000003 000006 0                  ADSC9   3                        cn=0,n=6
         1 000364   000367 601000 1                  TNZ     s:11372

      310    11368    2           DO;
             11368               /* This allows TPA to receive the *FPABT message before the *AUEV message */

      311    11369    2           MBLK$->KQ$MBLK.PRIO = %KQ_AUEP#;

  11369  1 000365   765000 220003                    LDX0    -5632,DU
         1 000366   100001 740100                    STX0    1,,PR1

      312    11370    2           END;

      313    11371              /**/
      314    11372    1         MBLK$->KQ$MBLK.MID.PRIMARY=CG$->KQ$CG.MSGID;

  11372  1 000367   200006 471500                    LDP1    MBLK$,,AUTO
         1 000370   300113 235100                    LDA     75,,PR3
         1 000371   100014 755100                    STA     12,,PR1

      315    11373    1         CG$->KQ$CG.MSGID=CG$->KQ$CG.MSGID+1;

  11373  1 000372   300113 235100                    LDA     75,,PR3
         1 000373   000001 035007                    ADLA    1,DL
         1 000374   300113 755100                    STA     75,,PR3
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:65   

      316    11374    1         IF KQ_LOG.TSIO THEN

  11374  1 000375   000000 236000 xsym               LDQ     KQ_LOG
         1 000376   004000 316003                    CANQ    2048,DU
         1 000377   000422 600000 1                  TZE     s:11381

      317    11375    1          CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_PUT,0,
      318    11376    1          MBLK$->KQ$MBLK.MID.PRIMARY,
      319    11377    1          ADDR(MBLK$->KQ$MBLK.MID.PRIMARY)->B$$HALF,
      320    11378    1          SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
      321    11379    1          SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));

  11379  1 000400   200005 236100                    LDQ     STA$,,AUTO
         1 000401   000006 036003                    ADLQ    6,DU
         1 000402   200116 756100                    STQ     @M$+7,,AUTO
         1 000403   200005 236100                    LDQ     STA$,,AUTO
         1 000404   000005 036003                    ADLQ    5,DU
         1 000405   200115 756100                    STQ     @M$+6,,AUTO
         1 000406   200006 236100                    LDQ     MBLK$,,AUTO
         1 000407   000014 036003                    ADLQ    12,DU
         1 000410   200114 756100                    STQ     @M$+5,,AUTO
         1 000411   000006 235000 2                  LDA     6
         1 000412   200112 757100                    STAQ    @M$+3,,AUTO
         1 000413   000007 236000 2                  LDQ     7
         1 000414   200007 235100                    LDA     CG$,,AUTO
         1 000415   200110 757100                    STAQ    @M$+1,,AUTO
         1 000416   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000417   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 000420   000000 701000 xent               TSX1    KQZ$LOG
         1 000421   000000 011000                    NOP     0

      322    11380              %UNLOCK (G=KQ$TTREE.GATE);

  11381  1 000422   200007 236100                    LDQ     CG$,,AUTO
         1 000423   000067 036003                    ADLQ    55,DU
         1 000424   200110 756100                    STQ     @M$+1,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:66   
         1 000425   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000426   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000427   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000430   000000 011000                    NOP     0

      323    11383    1         CALL PULLTYC;

  11383  1 000431   001644 701000 1                  TSX1    PULLTYC
         1 000432   000000 011000                    NOP     0

      324    11384        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:67   
      325    11385        /**/
      326    11386    1         IF MBLK$->KQ$MBLK.MSGSIZE = 0 THEN

  11386  1 000433   200006 470500                    LDP0    MBLK$,,AUTO
         1 000434   000016 235100                    LDA     14,,PR0
         1 000435   002202 600000 1                  TZE     SENDIT0

      327    11387    1          GOTO SENDIT0;
      328    11388    1         IF K$RWPARM.MSG$ ~= ADDR(NIL) THEN

  11388  1 000436   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 000437   100000 236100                    LDQ     0,,PR1
         1 000440   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000441   000767 600000 1                  TZE     WRITECG

      329    11389    1          IF NOT MBLK$->KQ$MBLK.JOURNAL THEN

  11389  1 000442   000010 236100                    LDQ     8,,PR0
         1 000443   000400 316007                    CANQ    256,DL
         1 000444   000767 601000 1                  TNZ     WRITECG

      330    11390    2            DO;

      331    11391
      332    11392            /*********************************************
      333    11393             *                                           *
      334    11394             *         PUT directly to user buffer       *
      335    11395             *                                           *
      336    11396             *********************************************/
      337    11397
      338    11398    2            IF MBLK$->KQ$MBLK.DSTA ~= ' ' THEN

  11398  1 000445   040000 106500                    CMPC    fill='040'O
         1 000446   000011 000010                    ADSC9   9,,PR0                   cn=0,n=8
         1 000447   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000450   000546 600000 1                  TZE     s:11432

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:68   
      339    11399    3              DO;

      340    11400    3              IF  NOT CG$->KQ$CG.AUCTL.DRML

  11400  1 000451   200007 473500                    LDP3    CG$,,AUTO
         1 000452   300136 236100                    LDQ     94,,PR3
         1 000453   020000 316003                    CANQ    8192,DU
         1 000454   000767 601000 1                  TNZ     WRITECG
         1 000455   000010 236100                    LDQ     8,,PR0
         1 000456   100000 316003                    CANQ    32768,DU
         1 000457   000767 601000 1                  TNZ     WRITECG

      341    11401    3              AND NOT MBLK$->KQ$MBLK.STAR THEN
      342    11402    4                DO;

      343    11403                                /**********************************
      344    11404                                 *                                *
      345    11405                                 *       DIRECTED WRITE           *
      346    11406                                 *                                *
      347    11407                                 **********************************/
      348    11408    4                CALL CHKSTAL ALTRET(NOSTA0);

  11408  1 000460   003304 701000 1                  TSX1    CHKSTAL
         1 000461   002335 702000 1                  TSX2    NOSTA0

      349    11409    4                RBLK$=DSTA$->KQ$STA.RBLK$;

  11409  1 000462   200021 470500                    LDP0    DSTA$,,AUTO
         1 000463   000011 236100                    LDQ     9,,PR0
         1 000464   200020 756100                    STQ     RBLK$,,AUTO

      350    11410    4                IF RBLK$ ~= ADDR(NIL) THEN

  11410  1 000465   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000466   000536 600000 1                  TZE     s:11428

      351    11411    4                 IF  RBLK$->KQ$RBLK.STATE = KQRS_PEND#
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:69   

  11411  1 000467   200020 471500                    LDP1    RBLK$,,AUTO
         1 000470   100001 220100                    LDX0    1,,PR1
         1 000471   000002 100003                    CMPX0   2,DU
         1 000472   000536 601000 1                  TNZ     s:11428
         1 000473   100001 236100                    LDQ     1,,PR1
         1 000474   400000 316007                    CANQ    -131072,DL
         1 000475   000536 601000 1                  TNZ     s:11428

      352    11412    4                 AND RBLK$->KQ$RBLK.LATCH = '0'B THEN
      353    11413    4                  IF DSTA$->KQ$STA.MLH.BUSY = '0'B THEN

  11413  1 000476   000037 236100                    LDQ     31,,PR0
         1 000477   000600 316003                    CANQ    384,DU
         1 000500   000536 601000 1                  TNZ     s:11428

      354    11414    5                    DO;

      355    11415    5                    KEY1L=RBLK$->KQ$RBLK.KEY1L;

  11415  1 000501   100001 236100                    LDQ     1,,PR1
         1 000502   000004 772000                    QRL     4
         1 000503   000017 376007                    ANQ     15,DL
         1 000504   000000 621006                    EAX1    0,QL
         1 000505   200016 741100                    STX1    KEY1L,,AUTO

      356    11416    5                    KEY2L=RBLK$->KQ$RBLK.KEY2L;

  11416  1 000506   100001 722100                    LXL2    1,,PR1
         1 000507   000017 362003                    ANX2    15,DU
         1 000510   200017 742100                    STX2    KEY2L,,AUTO

      357    11417    5                    IF  ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 = ADDR(MBLK$->KQ$MBLK.KEY1)
             11417                             ->B$$KEY1

  11417  1 000511   200006 473500                    LDP3    MBLK$,,AUTO
         1 000512   040140 106540                    CMPC    fill='040'O
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:70   
         1 000513   100002 000011                    ADSC9   2,,PR1                   cn=0,n=*X1
         1 000514   300002 000011                    ADSC9   2,,PR3                   cn=0,n=*X1
         1 000515   000536 601000 1                  TNZ     s:11428
         1 000516   040140 106540                    CMPC    fill='040'O
         1 000517   100004 000012                    ADSC9   4,,PR1                   cn=0,n=*X2
         1 000520   300004 000012                    ADSC9   4,,PR3                   cn=0,n=*X2
         1 000521   000536 601000 1                  TNZ     s:11428

      358    11418    5                    AND ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 = ADDR(MBLK$->KQ$MBLK.KEY2)
             11418                             ->B$$KEY2 THEN
      359    11419    5                     IF DSTA$->KQ$STA.LDCT$->N$LDCT.RESCOD = NK_CGDCB OR

  11419  1 000522   000010 474500                    LDP4    8,,PR0
         1 000523   400006 236100                    LDQ     6,,PR4
         1 000524   000017 376007                    ANQ     15,DL
         1 000525   000004 116007                    CMPQ    4,DL
         1 000526   000531 600000 1                  TZE     s:11422
         1 000527   000011 116007                    CMPQ    9,DL
         1 000530   000534 601000 1                  TNZ     s:11425

      360    11420    5                     DSTA$->KQ$STA.LDCT$->N$LDCT.RESCOD = NK_CGFPRG THEN
      361    11421    6                       DO;

      362    11422    6                       CALL XFERD ALTRET(GETOUT);

  11422  1 000531   003574 701000 1                  TSX1    XFERD
         1 000532   002334 702000 1                  TSX2    GETOUT

      363    11423    6                       GOTO WRITECG;

  11423  1 000533   000767 710000 1                  TRA     WRITECG

      364    11424    6                       END;
      365    11425    5                     ELSE CALL SC_BCGPUT; /* Can't be a terminal now can it? */

  11425  1 000534   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 000535   000000 600000 xsid               climb   nvectors=         0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:71   

      366    11426    5                    END;

      367    11427                     %UNLOCK (G=DSTA$->KQ$STA.GATE);

  11428  1 000536   200021 236100                    LDQ     DSTA$,,AUTO
         1 000537   000016 036003                    ADLQ    14,DU
         1 000540   200110 756100                    STQ     @M$+1,,AUTO
         1 000541   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000542   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000543   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000544   000000 011000                    NOP     0

      368    11430    4                END;

      369    11431    3              END;

  11431  1 000545   000767 710000 1                  TRA     WRITECG

      370    11432    2            ELSE IF NOT CG$->KQ$CG.AUCTL.QRML THEN

  11432  1 000546   200007 473500                    LDP3    CG$,,AUTO
         1 000547   300136 236100                    LDQ     94,,PR3
         1 000550   040000 316003                    CANQ    16384,DU
         1 000551   000767 601000 1                  TNZ     WRITECG

      371    11433    3               DO;

      372    11434                                /**********************************
      373    11435                                 *                                *
      374    11436                                 *       WRITE TO QUEUE           *
      375    11437                                 *                                *
      376    11438                                 **********************************/
      377    11439                    %LOCK (G=KQ$QTREE.GATE);

  11440  1 000552   300057 474500                    LDP4    47,,PR3
         1 000553   200110 454500                    STP4    @M$+1,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:72   
         1 000554   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000555   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000556   000000 701000 xent               TSX1    HFC$LOCK
         1 000557   000000 011000                    NOP     0

      378    11442    3               IF CG$->KQ$CG.QISS THEN QTN$=STA$;

  11442  1 000560   200007 470500                    LDP0    CG$,,AUTO
         1 000561   000106 235100                    LDA     70,,PR0
         1 000562   000566 600000 1                  TZE     s:11445

  11442  1 000563   200005 236100                    LDQ     STA$,,AUTO
         1 000564   200022 756100                    STQ     QTN$,,AUTO
         1 000565   000610 710000 1                  TRA     s:11449

      379    11443    3               ELSE
      380    11444    4                 DO;

      381    11445    4                 IF TACTCNT ~= KQ$TTREE.ACTCNT THEN

  11445  1 000566   200017 220100                    LDX0    KEY2L,,AUTO
         1 000567   000074 100100                    CMPX0   60,,PR0
         1 000570   000606 600000 1                  TZE     s:11447

      382    11446    4                  CALL KQB$SRCH (KQ$TTREE,MBLK$->KQ$MBLK.KEY1,QTN$) ALTRET(BADMTYP);

  11446  1 000571   200022 631500                    EPPR1   QTN$,,AUTO
         1 000572   200112 451500                    STP1    @M$+3,,AUTO
         1 000573   200006 236100                    LDQ     MBLK$,,AUTO
         1 000574   000002 036003                    ADLQ    2,DU
         1 000575   200111 756100                    STQ     @M$+2,,AUTO
         1 000576   200007 236100                    LDQ     CG$,,AUTO
         1 000577   000067 036003                    ADLQ    55,DU
         1 000600   200110 756100                    STQ     @M$+1,,AUTO
         1 000601   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000602   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000603   000000 701000 xent               TSX1    KQB$SRCH
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:73   
         1 000604   001547 702000 1                  TSX2    BADMTYP
         1 000605   000610 710000 1                  TRA     s:11449

      383    11447    4                 ELSE QTN$=MTYP$;

  11447  1 000606   200015 236100                    LDQ     MTYP$,,AUTO
         1 000607   200022 756100                    STQ     QTN$,,AUTO

      384    11448    4                 END;

      385    11449    3               P$=ADDR(QTN$->KQ$QTN.READS$);

  11449  1 000610   200022 236100                    LDQ     QTN$,,AUTO
         1 000611   000046 036003                    ADLQ    38,DU
         1 000612   200075 756100                    STQ     P$,,AUTO

      386    11450    3               RBLK$=P$->B$$PTR;

  11450  1 000613   200075 470500                    LDP0    P$,,AUTO
         1 000614   000000 236100                    LDQ     0,,PR0
         1 000615   200020 756100                    STQ     RBLK$,,AUTO

      387    11451    4                 DO WHILE (RBLK$ ~= ADDR(NIL));

  11451  1 000616   000667 710000 1                  TRA     s:11472

      388    11452    4                 KEY2L=RBLK$->KQ$RBLK.KEY2L;

  11452  1 000617   200020 470500                    LDP0    RBLK$,,AUTO
         1 000620   000001 720100                    LXL0    1,,PR0
         1 000621   000017 360003                    ANX0    15,DU
         1 000622   200017 740100                    STX0    KEY2L,,AUTO

      389    11453    4                 IF ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 = ADDR(MBLK$->KQ$MBLK.KEY2)->
             11453                          B$$KEY2 THEN

  11453  1 000623   200006 471500                    LDP1    MBLK$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:74   
         1 000624   040140 106540                    CMPC    fill='040'O
         1 000625   000004 000010                    ADSC9   4,,PR0                   cn=0,n=*X0
         1 000626   100004 000010                    ADSC9   4,,PR1                   cn=0,n=*X0
         1 000627   000661 601000 1                  TNZ     s:11470

      390    11454    5                   DO;

      391    11455    5                   IF RBLK$->KQ$RBLK.LATCH THEN GOTO WR11;

  11455  1 000630   000001 236100                    LDQ     1,,PR0
         1 000631   400000 316007                    CANQ    -131072,DL
         1 000632   000760 601000 1                  TNZ     WR11

      392    11456    5                   DSTA$=RBLK$->KQ$RBLKD.STA$;

  11456  1 000633   000012 236100                    LDQ     10,,PR0
         1 000634   200021 756100                    STQ     DSTA$,,AUTO

      393    11457                        %LOCK (G=DSTA$->KQ$STA.GATE);

  11458  1 000635   000016 036003                    ADLQ    14,DU
         1 000636   200110 756100                    STQ     @M$+1,,AUTO
         1 000637   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000640   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000641   000000 701000 xent               TSX1    HFC$LOCK
         1 000642   000000 011000                    NOP     0

      394    11460    5                   IF RBLK$->KQ$RBLK.STATE = KQRS_PEND# THEN

  11460  1 000643   200020 470500                    LDP0    RBLK$,,AUTO
         1 000644   000001 220100                    LDX0    1,,PR0
         1 000645   000002 100003                    CMPX0   2,DU
         1 000646   000652 601000 1                  TNZ     s:11467

      395    11461    6                     DO;

      396    11462    6   WRITENOWQ:
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:75   
      397    11463    6                     CALL XFERQ ALTRET(GETOUT);

  11463  1 000647   003577 701000 1     WRITENOWQ    TSX1    XFERQ
         1 000650   002334 702000 1                  TSX2    GETOUT

      398    11464    6                     GOTO WRITECG;

  11464  1 000651   000767 710000 1                  TRA     WRITECG

      399    11465    6                     END;
      400    11466                        %UNLOCK (G=DSTA$->KQ$STA.GATE);

  11467  1 000652   200021 236100                    LDQ     DSTA$,,AUTO
         1 000653   000016 036003                    ADLQ    14,DU
         1 000654   200110 756100                    STQ     @M$+1,,AUTO
         1 000655   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000656   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000657   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000660   000000 011000                    NOP     0

      401    11469    5                   END;

      402    11470    4                 P$=ADDR(RBLK$->KQ$RBLKD.QRLNK$);

  11470  1 000661   200020 236100                    LDQ     RBLK$,,AUTO
         1 000662   000020 036003                    ADLQ    16,DU
         1 000663   200075 756100                    STQ     P$,,AUTO

      403    11471    4                 RBLK$=P$->B$$PTR;

  11471  1 000664   200075 470500                    LDP0    P$,,AUTO
         1 000665   000000 236100                    LDQ     0,,PR0
         1 000666   200020 756100                    STQ     RBLK$,,AUTO

      404    11472    4                 END;

  11472  1 000667   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:76   
         1 000670   000617 601000 1                  TNZ     s:11452

      405    11473                           /* COULD NOT FIND A GOOD READ ON THIS Q-TREE NODE.
      406    11474                              LOOK IN WILD-CARDED READS */
      407    11475    3               P$=ADDR(CG$->KQ$CG.QUEUE.WCRL$);

  11475  1 000671   200007 236100                    LDQ     CG$,,AUTO
         1 000672   000060 036003                    ADLQ    48,DU
         1 000673   200075 756100                    STQ     P$,,AUTO

      408    11476    3               RBLK$=P$->B$$PTR;

  11476  1 000674   200075 470500                    LDP0    P$,,AUTO
         1 000675   000000 236100                    LDQ     0,,PR0
         1 000676   200020 756100                    STQ     RBLK$,,AUTO

      409    11477    4                 DO WHILE (RBLK$ ~= ADDR(NIL));

  11477  1 000677   000756 710000 1                  TRA     s:11496

      410    11478    4                 KEY1L=RBLK$->KQ$RBLK.KEY1L;

  11478  1 000700   200020 470500                    LDP0    RBLK$,,AUTO
         1 000701   000001 236100                    LDQ     1,,PR0
         1 000702   000004 772000                    QRL     4
         1 000703   000017 376007                    ANQ     15,DL
         1 000704   000000 620006                    EAX0    0,QL
         1 000705   200016 740100                    STX0    KEY1L,,AUTO

      411    11479    4                 KEY2L=RBLK$->KQ$RBLK.KEY2L;

  11479  1 000706   000001 721100                    LXL1    1,,PR0
         1 000707   000017 361003                    ANX1    15,DU
         1 000710   200017 741100                    STX1    KEY2L,,AUTO

      412    11480    4                 IF  ADDR(RBLK$->KQ$RBLK.KEY1)->B$$KEY1 = ADDR(MBLK$->KQ$MBLK.KEY1)->
             11480                          B$$KEY1
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:77   

  11480  1 000711   200006 471500                    LDP1    MBLK$,,AUTO
         1 000712   040140 106540                    CMPC    fill='040'O
         1 000713   000002 000010                    ADSC9   2,,PR0                   cn=0,n=*X0
         1 000714   100002 000010                    ADSC9   2,,PR1                   cn=0,n=*X0
         1 000715   000750 601000 1                  TNZ     s:11494
         1 000716   040140 106540                    CMPC    fill='040'O
         1 000717   000004 000011                    ADSC9   4,,PR0                   cn=0,n=*X1
         1 000720   100004 000011                    ADSC9   4,,PR1                   cn=0,n=*X1
         1 000721   000750 601000 1                  TNZ     s:11494

      413    11481    4                 AND ADDR(RBLK$->KQ$RBLK.KEY2)->B$$KEY2 = ADDR(MBLK$->KQ$MBLK.KEY2)->
             11481                          B$$KEY2 THEN
      414    11482    5                   DO;

      415    11483    5                   IF RBLK$->KQ$RBLK.LATCH THEN GOTO WR11;

  11483  1 000722   000001 236100                    LDQ     1,,PR0
         1 000723   400000 316007                    CANQ    -131072,DL
         1 000724   000760 601000 1                  TNZ     WR11

      416    11484    5                   DSTA$=RBLK$->KQ$RBLKD.STA$;

  11484  1 000725   000012 236100                    LDQ     10,,PR0
         1 000726   200021 756100                    STQ     DSTA$,,AUTO

      417    11485                        %LOCK (G=DSTA$->KQ$STA.GATE);

  11486  1 000727   000016 036003                    ADLQ    14,DU
         1 000730   200110 756100                    STQ     @M$+1,,AUTO
         1 000731   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000732   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000733   000000 701000 xent               TSX1    HFC$LOCK
         1 000734   000000 011000                    NOP     0

      418    11488    5                   IF RBLK$->KQ$RBLK.STATE = KQRS_PEND# THEN

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:78   
  11488  1 000735   200020 470500                    LDP0    RBLK$,,AUTO
         1 000736   000001 220100                    LDX0    1,,PR0
         1 000737   000002 100003                    CMPX0   2,DU
         1 000740   000647 600000 1                  TZE     WRITENOWQ

      419    11489    5                    GOTO WRITENOWQ;
      420    11490                        %UNLOCK (G=DSTA$->KQ$STA.GATE);

  11491  1 000741   200021 236100                    LDQ     DSTA$,,AUTO
         1 000742   000016 036003                    ADLQ    14,DU
         1 000743   200110 756100                    STQ     @M$+1,,AUTO
         1 000744   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000745   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000746   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000747   000000 011000                    NOP     0

      421    11493    5                   END;

      422    11494    4                 P$=ADDR(RBLK$->KQ$RBLKD.QRLNK$);

  11494  1 000750   200020 236100                    LDQ     RBLK$,,AUTO
         1 000751   000020 036003                    ADLQ    16,DU
         1 000752   200075 756100                    STQ     P$,,AUTO

      423    11495    4                 RBLK$=P$->B$$PTR;

  11495  1 000753   200075 470500                    LDP0    P$,,AUTO
         1 000754   000000 236100                    LDQ     0,,PR0
         1 000755   200020 756100                    STQ     RBLK$,,AUTO

      424    11496    4                 END;

  11496  1 000756   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000757   000700 601000 1                  TNZ     s:11478

  11489  1 000760                       WR11         null
      425    11497    3   WR11:       ;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:79   
      426    11498                    %UNLOCK (G=KQ$QTREE.GATE);

  11499  1 000760   200007 470500                    LDP0    CG$,,AUTO
         1 000761   000057 471500                    LDP1    47,,PR0
         1 000762   200110 451500                    STP1    @M$+1,,AUTO
         1 000763   200110 630500                    EPPR0   @M$+1,,AUTO
         1 000764   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000765   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000766   000000 011000                    NOP     0

      427    11501    3               END;

      428    11502    2            END;

  11496  1 000767                       WRITECG      null
      429    11503    1   WRITECG:;
      430    11504        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:80   
      431    11505            /*********************************************
      432    11506             *                                           *
      433    11507             *         GET a data block                  *
      434    11508             *                                           *
      435    11509             *********************************************/
      436    11510    1         DDA=MBLK$->KQ$MBLK.MSGSIZE;

  11510  1 000767   200006 470500                    LDP0    MBLK$,,AUTO
         1 000770   000016 235100                    LDA     14,,PR0
         1 000771   200014 755100                    STA     DDA,,AUTO

      437    11511    1         IF  KQ_DEBUG = 0

  11511  1 000772   000000 236000 xsym               LDQ     KQ_DEBUG
         1 000773   001013 601000 1                  TNZ     s:11516
         1 000774   200007 471500                    LDP1    CG$,,AUTO
         1 000775   100136 236100                    LDQ     94,,PR1
         1 000776   100000 316003                    CANQ    32768,DU
         1 000777   001013 601000 1                  TNZ     s:11516

      438    11512    1         AND CG$->KQ$CG.AUCTL.REDUNDANT = '0'B THEN
      439    11513    1          CALL KQD$GET (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOGET);

  11513  1 001000   200014 633500                    EPPR3   DDA,,AUTO
         1 001001   200112 453500                    STP3    @M$+3,,AUTO
         1 001002   200011 634500                    EPPR4   DBLK$,,AUTO
         1 001003   200111 454500                    STP4    @M$+2,,AUTO
         1 001004   200007 236100                    LDQ     CG$,,AUTO
         1 001005   200110 756100                    STQ     @M$+1,,AUTO
         1 001006   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001007   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001010   000000 701000 xent               TSX1    KQD$GET
         1 001011   001375 702000 1                  TSX2    NOGET
         1 001012   001046 710000 1                  TRA     s:11522

      440    11514    1         ELSE
      441    11515    2           DO;  /* Copy MBLK into end of data blk */
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:81   

      442    11516    2           DDA=DDA+SIZEC(KQ$MBLK);

  11516  1 001013   000100 035007                    ADLA    64,DL
         1 001014   200014 755100                    STA     DDA,,AUTO

      443    11517    2           CALL KQD$GET (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOGET);

  11517  1 001015   200014 631500                    EPPR1   DDA,,AUTO
         1 001016   200112 451500                    STP1    @M$+3,,AUTO
         1 001017   200011 633500                    EPPR3   DBLK$,,AUTO
         1 001020   200111 453500                    STP3    @M$+2,,AUTO
         1 001021   200007 236100                    LDQ     CG$,,AUTO
         1 001022   200110 756100                    STQ     @M$+1,,AUTO
         1 001023   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001024   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001025   000000 701000 xent               TSX1    KQD$GET
         1 001026   001375 702000 1                  TSX2    NOGET

      444    11518    2           PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK))->KQ$MBLK=MBLK$->KQ$MBLK;

  11518  1 001027   200011 470500                    LDP0    DBLK$,,AUTO
         1 001030   000004 220100                    LDX0    4,,PR0
         1 001031   000000 635010                    EAA     0,X0
         1 001032   000020 771000                    ARL     16
         1 001033   200006 471500                    LDP1    MBLK$,,AUTO
         1 001034   000105 100500                    MLR     fill='000'O
         1 001035   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64
         1 001036   077760 000100                    ADSC9   -16,A,PR0                cn=0,n=64

      445    11519    2           DBLK$->KQ$DBLK.MBLK='1'B;

  11519  1 001037   200011 470500                    LDP0    DBLK$,,AUTO
         1 001040   000020 236003                    LDQ     16,DU
         1 001041   000003 256100                    ORSQ    3,,PR0

      446    11520    2           DBLK$->KQ$DBLK.DSIZE=MBLK$->KQ$MBLK.MSGSIZE;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:82   

  11520  1 001042   200006 470500                    LDP0    MBLK$,,AUTO
         1 001043   000016 720100                    LXL0    14,,PR0
         1 001044   200011 471500                    LDP1    DBLK$,,AUTO
         1 001045   100000 440100                    SXL0    0,,PR1

      447    11521    2           END;

      448    11522    1         MBLK$->KQ$MBLK.DBLK$=DBLK$;

  11522  1 001046   200011 236100                    LDQ     DBLK$,,AUTO
         1 001047   200006 470500                    LDP0    MBLK$,,AUTO
         1 001050   000000 756100                    STQ     0,,PR0

      449    11523    1         MBLK$->KQ$MBLK.DDA=DDA;

  11523  1 001051   200006 470500                    LDP0    MBLK$,,AUTO
         1 001052   200014 235100                    LDA     DDA,,AUTO
         1 001053   000006 755100                    STA     6,,PR0

      450    11524    1         DBLK$->KQ$DBLK.STAMP=MBLK$->KQ$MBLK.STAMP;

  11524  1 001054   200006 470500                    LDP0    MBLK$,,AUTO
         1 001055   000001 720100                    LXL0    1,,PR0
         1 001056   200011 471500                    LDP1    DBLK$,,AUTO
         1 001057   100000 740100                    STX0    0,,PR1

      451    11525    1         IF K$RWPARM.MSG$ ~= ADDR(NIL) THEN

  11525  1 001060   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001061   000000 236100                    LDQ     0,,PR0
         1 001062   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001063   001133 600000 1                  TZE     PUT0

      452    11526    2           DO;

      453    11527                                /* XFER FROM INPUT CIRCULAR QUEUE */
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:83   
      454    11528    2           I=MBLK$->KQ$MBLK.MSGSIZE;

  11528  1 001064   200006 471500                    LDP1    MBLK$,,AUTO
         1 001065   100016 235100                    LDA     14,,PR1
         1 001066   200012 755100                    STA     I,,AUTO

      455    11529    2           IF K$RWPARM.DVE.DVBYTE.VFC

  11529  1 001067   000010 236100                    LDQ     8,,PR0
         1 001070   100000 316003                    CANQ    32768,DU
         1 001071   001123 600000 1                  TZE     s:11539

      456    11530    3           THEN DO;

      457    11531    3             BUF$ = PINCRW(DBLK$,SIZEW(KQ$DBLK));

  11531  1 001072   200011 236100                    LDQ     DBLK$,,AUTO
         1 001073   000006 036003                    ADLQ    6,DU
         1 001074   200076 756100                    STQ     BUF$,,AUTO

      458    11532    3             I = 1;

  11532  1 001075   000001 235007                    LDA     1,DL
         1 001076   200012 755100                    STA     I,,AUTO

      459    11533    3             BUF$->B$$CHARS = K$RWPARM.DVE.VFC;

  11533  1 001077   200076 473500                    LDP3    BUF$,,AUTO
         1 001100   000000 620005                    EAX0    0,AL
         1 001101   040140 100500                    MLR     fill='040'O
         1 001102   000010 200001                    ADSC9   8,,PR0                   cn=1,n=1
         1 001103   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      460    11534    3             BUF$ = PINCRC(BUF$,1);

  11534  1 001104   200076 236100                    LDQ     BUF$,,AUTO
         1 001105   200000 036007                    ADLQ    65536,DL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:84   
         1 001106   200076 756100                    STQ     BUF$,,AUTO

      461    11535    3             I = MBLK$->KQ$MBLK.MSGSIZE - 1;

  11535  1 001107   200006 471500                    LDP1    MBLK$,,AUTO
         1 001110   100016 235100                    LDA     14,,PR1
         1 001111   000001 135007                    SBLA    1,DL
         1 001112   200012 755100                    STA     I,,AUTO

      462    11536    3             BUF$->B$$CHARS = K$RWPARM.MSG$->B$$CHARS;

  11536  1 001113   000000 473500                    LDP3    0,,PR0
         1 001114   000000 620005                    EAX0    0,AL
         1 001115   200076 474500                    LDP4    BUF$,,AUTO
         1 001116   200012 721100                    LXL1    I,,AUTO
         1 001117   040140 100540                    MLR     fill='040'O
         1 001120   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         1 001121   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

      463    11537    3             END;

  11537  1 001122   001132 710000 1                  TRA     s:11540

      464    11538    2           ELSE
      465    11539    2            PINCRW(DBLK$,SIZEW(KQ$DBLK))->B$$CHARS=K$RWPARM.MSG$->B$$CHARS;

  11539  1 001123   000000 473500                    LDP3    0,,PR0
         1 001124   000000 620005                    EAX0    0,AL
         1 001125   200011 474500                    LDP4    DBLK$,,AUTO
         1 001126   200012 721100                    LXL1    I,,AUTO
         1 001127   040140 100540                    MLR     fill='040'O
         1 001130   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         1 001131   400006 000011                    ADSC9   6,,PR4                   cn=0,n=*X1

      466    11540    2           GOTO SENDIT;

  11540  1 001132   002173 710000 1                  TRA     SENDIT
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:85   

  11539  1 001133                       PUT0         null
      467    11541    2           END;
      468    11542    1   PUT0: ;
      469    11543            /*********************************************
      470    11544             *                                           *
      471    11545             *         VGET it into the comm. WSQ        *
      472    11546             *                                           *
      473    11547             *********************************************/
      474    11548    1         BUF$ = PINCRW(DBLK$,SIZEW(KQ$DBLK));

  11548  1 001133   200011 236100                    LDQ     DBLK$,,AUTO
         1 001134   000006 036003                    ADLQ    6,DU
         1 001135   200076 756100                    STQ     BUF$,,AUTO

      475    11549    1         I = MBLK$->KQ$MBLK.MSGSIZE;

  11549  1 001136   200006 470500                    LDP0    MBLK$,,AUTO
         1 001137   000016 235100                    LDA     14,,PR0
         1 001140   200012 755100                    STA     I,,AUTO

      476    11550    1         IF MBLK$->KQ$MBLK.DVE.DVBYTE & %DVBYTE_VFC# THEN

  11550  1 001141   000010 236100                    LDQ     8,,PR0
         1 001142   000011 736000                    QLS     9
         1 001143   777000 376003                    ANQ     -512,DU
         1 001144   100000 376003                    ANQ     32768,DU
         1 001145   001164 600000 1                  TZE     s:11557

      477    11551    2           DO;

      478    11552    2           I = 1;

  11552  1 001146   000001 236007                    LDQ     1,DL
         1 001147   200012 756100                    STQ     I,,AUTO

      479    11553    2           BUF$->B$$CHARS = MBLK$->KQ$MBLK.DVE.VFC;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:86   

  11553  1 001150   200076 471500                    LDP1    BUF$,,AUTO
         1 001151   000000 620006                    EAX0    0,QL
         1 001152   040140 100500                    MLR     fill='040'O
         1 001153   000010 400001                    ADSC9   8,,PR0                   cn=2,n=1
         1 001154   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

      480    11554    2           BUF$ = PINCRC(BUF$,1);

  11554  1 001155   200076 236100                    LDQ     BUF$,,AUTO
         1 001156   200000 036007                    ADLQ    65536,DL
         1 001157   200076 756100                    STQ     BUF$,,AUTO

      481    11555    2           I = MBLK$->KQ$MBLK.MSGSIZE - 1;

  11555  1 001160   200006 470500                    LDP0    MBLK$,,AUTO
         1 001161   000016 235100                    LDA     14,,PR0
         1 001162   000001 135007                    SBLA    1,DL
         1 001163   200012 755100                    STA     I,,AUTO

      482    11556    2           END;

      483    11557    1         CALL MMS$VGET (%B_CWSQ1,BUF$,I,STA$->KQ$STA.VGOT$) ALTRET(NOVGET);

  11557  1 001164   200005 236100                    LDQ     STA$,,AUTO
         1 001165   000025 036003                    ADLQ    21,DU
         1 001166   200113 756100                    STQ     @M$+4,,AUTO
         1 001167   200012 631500                    EPPR1   I,,AUTO
         1 001170   200112 451500                    STP1    @M$+3,,AUTO
         1 001171   200076 633500                    EPPR3   BUF$,,AUTO
         1 001172   200111 453500                    STP3    @M$+2,,AUTO
         1 001173   000011 236000 2                  LDQ     9
         1 001174   200110 756100                    STQ     @M$+1,,AUTO
         1 001175   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001176   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 001177   000000 701000 xent               TSX1    MMS$VGET
         1 001200   001566 702000 1                  TSX2    NOVGET
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:87   

  11557  1 001201                       PUT01        null
      484    11558    1   PUT01:;
      485    11559    1         MBLK$->KQ$MBLK.PUTSTATE=KQPS_GDN#;

  11559  1 001201   200006 470500                    LDP0    MBLK$,,AUTO
         1 001202   000010 236100                    LDQ     8,,PR0
         1 001203   000012 376000 2                  ANQ     10
         1 001204   000003 276007                    ORQ     3,DL
         1 001205   000010 756100                    STQ     8,,PR0

  11559  1 001206                       PUT1         null
      486    11560    1   PUT1: ;
      487    11561            /*********************************************
      488    11562             *                                           *
      489    11563             *         Give it to KCD$RDGO               *
      490    11564             *                                           *
      491    11565             *********************************************/
      492    11566    1         IF MBLK$->KQ$MBLK.DBLK$ ~= ADDR(NIL) THEN

  11566  1 001206   200006 470500                    LDP0    MBLK$,,AUTO
         1 001207   000000 236100                    LDQ     0,,PR0
         1 001210   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001211   001214 600000 1                  TZE     s:11570

      493    11567    1          RWPARM.ERR=0;

  11567  1 001212   200037 450100                    STZ     RWPARM+11,,AUTO
         1 001213   001221 710000 1                  TRA     s:11574

      494    11568    1         ELSE
      495    11569    2           DO;

      496    11570    2           RWPARM.ERR=KQPE_QFUL#;

  11570  1 001214   000005 235007                    LDA     5,DL
         1 001215   200037 755100                    STA     RWPARM+11,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:88   

      497    11571    2           CALL DUMPMSG;

  11571  1 001216   003440 701000 1                  TSX1    DUMPMSG
         1 001217   000000 011000                    NOP     0

      498    11572    2           GOTO GETOUT;

  11572  1 001220   002334 710000 1                  TRA     GETOUT

      499    11573    2           END;
      500    11574    1         RWPARM.MSG$ = STA$->KQ$STA.VGOT$;

  11574  1 001221   200005 471500                    LDP1    STA$,,AUTO
         1 001222   100025 236100                    LDQ     21,,PR1
         1 001223   200024 756100                    STQ     RWPARM,,AUTO

      501    11575    1         IF MBLK$->KQ$MBLK.DVE.DVBYTE & %DVBYTE_VFC# THEN

  11575  1 001224   000010 236100                    LDQ     8,,PR0
         1 001225   000011 736000                    QLS     9
         1 001226   777000 376003                    ANQ     -512,DU
         1 001227   100000 376003                    ANQ     32768,DU
         1 001230   001235 600000 1                  TZE     s:11578

      502    11576    1          RWPARM.MSGSZ = MBLK$->KQ$MBLK.MSGSIZE - 1;

  11576  1 001231   000016 235100                    LDA     14,,PR0
         1 001232   000001 135007                    SBLA    1,DL
         1 001233   200025 755100                    STA     RWPARM+1,,AUTO
         1 001234   001237 710000 1                  TRA     s:11579

      503    11577    1         ELSE
      504    11578    1          RWPARM.MSGSZ = MBLK$->KQ$MBLK.MSGSIZE;

  11578  1 001235   000016 235100                    LDA     14,,PR0
         1 001236   200025 755100                    STA     RWPARM+1,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:89   

      505    11579    1         IF LOCKSET = 0 THEN

  11579  1 001237   200074 236100                    LDQ     LOCKSET,,AUTO
         1 001240   001263 601000 1                  TNZ     s:11589

      506    11580    2           DO;

      507    11581                %LOCK (G=STA$->KQ$STA.GATE);

  11582  1 001241   200005 236100                    LDQ     STA$,,AUTO
         1 001242   000016 036003                    ADLQ    14,DU
         1 001243   200110 756100                    STQ     @M$+1,,AUTO
         1 001244   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001245   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001246   000000 701000 xent               TSX1    HFC$LOCK
         1 001247   000000 011000                    NOP     0

      508    11584    2           STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

  11584  1 001250   200005 470500                    LDP0    STA$,,AUTO
         1 001251   000020 236100                    LDQ     16,,PR0
         1 001252   000001 036007                    ADLQ    1,DL
         1 001253   000020 552104                    STBQ    16,'04'O,PR0

      509    11585                %UNLOCK (G=STA$->KQ$STA.GATE);

  11586  1 001254   200005 236100                    LDQ     STA$,,AUTO
         1 001255   000016 036003                    ADLQ    14,DU
         1 001256   200110 756100                    STQ     @M$+1,,AUTO
         1 001257   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001260   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001261   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001262   000000 011000                    NOP     0

      510    11588    2           END;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:90   
      511    11589    1         AUTOGATE.LOCK = 1;

  11589  1 001263   000001 235007                    LDA     1,DL
         1 001264   200100 755100                    STA     AUTOGATE,,AUTO

      512    11590              %LOCK(G=AUTOGATE);

  11591  1 001265   200100 630500                    EPPR0   AUTOGATE,,AUTO
         1 001266   200110 450500                    STP0    @M$+1,,AUTO
         1 001267   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001270   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001271   000000 701000 xent               TSX1    HFC$LOCK
         1 001272   000000 011000                    NOP     0

      513    11593    1         CALL KCD$RDGO (NK$LDCT,RWPARM) ALTRET(RALT);

  11593  1 001273   200024 630500                    EPPR0   RWPARM,,AUTO
         1 001274   200111 450500                    STP0    @M$+2,,AUTO
         1 001275   200010 236100                    LDQ     NK$LDCTAUTO$,,AUTO
         1 001276   200110 756100                    STQ     @M$+1,,AUTO
         1 001277   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001300   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001301   000000 701000 xent               TSX1    KCD$RDGO
         1 001302   001347 702000 1                  TSX2    RALT

      514    11594              %UNLOCK(G=AUTOGATE);

  11595  1 001303   200100 630500                    EPPR0   AUTOGATE,,AUTO
         1 001304   200110 450500                    STP0    @M$+1,,AUTO
         1 001305   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001306   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001307   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001310   000000 011000                    NOP     0

  11589  1 001311                       PUT2         null
      515    11597    1   PUT2: ;
      516    11598              %LOCK (G=STA$->KQ$STA.GATE);
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:91   

  11599  1 001311   200005 236100                    LDQ     STA$,,AUTO
         1 001312   000016 036003                    ADLQ    14,DU
         1 001313   200110 756100                    STQ     @M$+1,,AUTO
         1 001314   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001315   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001316   000000 701000 xent               TSX1    HFC$LOCK
         1 001317   000000 011000                    NOP     0

      517    11601    1         IF STA$->KQ$STA.LOCKCNT = 0 THEN CALL SC_BCGPUT;

  11601  1 001320   200005 470500                    LDP0    STA$,,AUTO
         1 001321   000020 236100                    LDQ     16,,PR0
         1 001322   000777 316007                    CANQ    511,DL
         1 001323   001327 601000 1                  TNZ     s:11603

  11601  1 001324   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 001325   000000 600000 xsid               climb   nvectors=         0
         1 001326   001331 710000 1                  TRA     PUT3

      518    11602    1         ELSE
      519    11603    1          STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;

  11603  1 001327   000777 036007                    ADLQ    511,DL
         1 001330   000020 552104                    STBQ    16,'04'O,PR0

  11601  1 001331                       PUT3         null
      520    11604    1   PUT3: ;
      521    11605    1         IF STA$->KQ$STA.LOCKCNT = 0 THEN

  11605  1 001331   200005 470500                    LDP0    STA$,,AUTO
         1 001332   000020 236100                    LDQ     16,,PR0
         1 001333   000777 316007                    CANQ    511,DL
         1 001334   001337 601000 1                  TNZ     s:11609

      522    11606    1          IF STA$->KQ$STA.IDSC THEN

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:92   
  11606  1 001335   000020 234100                    SZN     16,,PR0
         1 001336   002767 604000 1                  TMI     DODISC

      523    11607    1           GOTO DODISC;
      524    11608              %UNLOCK (G=STA$->KQ$STA.GATE);

  11609  1 001337   200005 236100                    LDQ     STA$,,AUTO
         1 001340   000016 036003                    ADLQ    14,DU
         1 001341   200110 756100                    STQ     @M$+1,,AUTO
         1 001342   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001343   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001344   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001345   000000 011000                    NOP     0

      525    11611    1         GOTO GETOUT;

  11611  1 001346   002334 710000 1                  TRA     GETOUT

  11605  1 001347                       RALT         null
      526    11612        /**/
      527    11613    1   RALT: ;
      528    11614              %UNLOCK(G=AUTOGATE);

  11615  1 001347   200100 630500                    EPPR0   AUTOGATE,,AUTO
         1 001350   200110 450500                    STP0    @M$+1,,AUTO
         1 001351   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001352   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001353   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001354   000000 011000                    NOP     0

      529    11617    2           DO INHIBIT;

      530    11618    2           I=MBLK$->KQ$MBLK.PUTSTATE;

  11618  1 001355   200006 470700                    LDP0  ! MBLK$,,AUTO
         1 001356   000010 236300                    LDQ   ! 8,,PR0
         1 001357   000017 376207                    ANQ   ! 15,DL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:93   
         1 001360   200012 756300                    STQ   ! I,,AUTO

      531    11619    2           MBLK$->KQ$MBLK.PUTSTATE=KQPS_DIP#;

  11619  1 001361   000010 236300                    LDQ   ! 8,,PR0
         1 001362   000012 376200 2                  ANQ   ! 10
         1 001363   000005 276207                    ORQ   ! 5,DL
         1 001364   000010 756300                    STQ   ! 8,,PR0

      532    11620    2           IF I ~= KQPS_GDN# THEN CALL SC_BCGPUT;

  11620  1 001365   200012 235300                    LDA   ! I,,AUTO
         1 001366   000003 115207                    CMPA  ! 3,DL
         1 001367   001372 600200 1                  TZE   ! s:11621

  11620  1 001370   000000 713600 xsym               CLIMB ! SC_BCGPUT
         1 001371   000000 600000 xsid               climb   nvectors=         0

      533    11621    2           CALL DUMPMSG;

  11621  1 001372   003440 701200 1                  TSX1  ! DUMPMSG
         1 001373   000000 011200                    NOP   ! 0

      534    11622    2           GOTO PUT2;

  11622  1 001374   001311 710200 1                  TRA   ! PUT2

      535    11623    2           END;

  11618  1 001375                       NOGET        null
      536    11624    1   NOGET:;
      537    11625            /*********************************************
      538    11626             *                                           *
      539    11627             *         Cannot get a data block           *
      540    11628             *                                           *
      541    11629             *********************************************/
      542    11630    1         IF DBLK$ ~= ADDR(NIL) THEN
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:94   

  11630  1 001375   200011 236100                    LDQ     DBLK$,,AUTO
         1 001376   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001377   001445 600000 1                  TZE     s:11647

      543    11631    2           DO; /* Got a defer block */

      544    11632                %LOCK (G=STA$->KQ$STA.GATE);

  11633  1 001400   200005 236100                    LDQ     STA$,,AUTO
         1 001401   000016 036003                    ADLQ    14,DU
         1 001402   200110 756100                    STQ     @M$+1,,AUTO
         1 001403   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001404   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001405   000000 701000 xent               TSX1    HFC$LOCK
         1 001406   000000 011000                    NOP     0

      545    11635    2           STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

  11635  1 001407   200005 470500                    LDP0    STA$,,AUTO
         1 001410   000020 236100                    LDQ     16,,PR0
         1 001411   000001 036007                    ADLQ    1,DL
         1 001412   000020 552104                    STBQ    16,'04'O,PR0

      546    11636                %UNLOCK (G=STA$->KQ$STA.GATE);

  11637  1 001413   200005 236100                    LDQ     STA$,,AUTO
         1 001414   000016 036003                    ADLQ    14,DU
         1 001415   200110 756100                    STQ     @M$+1,,AUTO
         1 001416   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001417   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001420   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001421   000000 011000                    NOP     0

      547    11639    2           DBLK$->KQ$DFRBLK.INFO$=STA$;

  11639  1 001422   200005 236100                    LDQ     STA$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:95   
         1 001423   200011 470500                    LDP0    DBLK$,,AUTO
         1 001424   000006 756100                    STQ     6,,PR0

      548    11640    2           CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQP$GCONT));

  11640  1 001425   001657 636000 1                  EAQ     s:11727
         1 001426   200110 756100                    STQ     @M$+1,,AUTO
         1 001427   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001430   200113 450500                    STP0    @M$+4,,AUTO
         1 001431   200011 631500                    EPPR1   DBLK$,,AUTO
         1 001432   200112 451500                    STP1    @M$+3,,AUTO
         1 001433   200007 236100                    LDQ     CG$,,AUTO
         1 001434   200111 756100                    STQ     @M$+2,,AUTO
         1 001435   200111 630500                    EPPR0   @M$+2,,AUTO
         1 001436   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001437   000000 701000 xent               TSX1    KQD$DEFERGO
         1 001440   000000 011000                    NOP     0

      549    11641    2           K$RWPARM.ERR=KQPE_NOBUF#;

  11641  1 001441   000002 235007                    LDA     2,DL
         1 001442   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001443   000013 755100                    STA     11,,PR0

      550    11642    2           GOTO ALTRT;

  11642  1 001444   002342 710000 1                  TRA     ALTRT

      551    11643    2           END;
      552    11644        /**/
      553    11645        /**/
      554    11646                      /* No defer block - something wrong */
      555    11647    2           DO CASE (DDA);

  11647  1 001445   200014 235100                    LDA     DDA,,AUTO
         1 001446   000013 115007                    CMPA    11,DL
         1 001447   001451 602005 1                  TNC     s:11647+4,AL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:96   
         1 001450   001473 710000 1                  TRA     s:11659
         1 001451   001473 710000 1                  TRA     s:11659
         1 001452   001473 710000 1                  TRA     s:11659
         1 001453   001467 710000 1                  TRA     s:11655
         1 001454   001473 710000 1                  TRA     s:11659
         1 001455   001473 710000 1                  TRA     s:11659
         1 001456   001473 710000 1                  TRA     s:11659
         1 001457   001473 710000 1                  TRA     s:11659
         1 001460   001473 710000 1                  TRA     s:11659
         1 001461   001473 710000 1                  TRA     s:11659
         1 001462   001473 710000 1                  TRA     s:11659
         1 001463   001464 710000 1                  TRA     s:11651

      556    11648
      557    11649    2             CASE (%KQDE_NDFRBLK);

      558    11650                                /* No defer blocks */
      559    11651    2               CALL DUMPMSG1;

  11651  1 001464   003474 701000 1                  TSX1    DUMPMSG1
         1 001465   000000 011000                    NOP     0

      560    11652    2               GOTO NOMBLK;

  11652  1 001466   001475 710000 1                  TRA     NOMBLK

      561    11653
      562    11654    2             CASE (%KQDE_NSPC);

      563    11655    2               K$RWPARM.ERR=KQPE_QFUL#;

  11655  1 001467   000005 235007                    LDA     5,DL
         1 001470   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001471   000013 755100                    STA     11,,PR0

      564    11656    2               GOTO DELALT;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:97   
  11656  1 001472   001563 710000 1                  TRA     DELALT

      565    11657
      566    11658    2             CASE (ELSE);

      567    11659    2               CALL SC_BCGPUT;

  11659  1 001473   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 001474   000000 600000 xsid               climb   nvectors=         0

      568    11660
      569    11661    2           END;

  11647  1 001475                       NOMBLK       null
      570    11662        /**/
      571    11663    1   NOMBLK:;
      572    11664    1         K$RWPARM.ERR=KQPE_NOMBLK#;

  11664  1 001475   000001 235007                    LDA     1,DL
         1 001476   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001477   000013 755100                    STA     11,,PR0

      573    11665    1         GOTO ALTRT;

  11665  1 001500   002342 710000 1                  TRA     ALTRT

  11664  1 001501                       NOMTYP       null
      574    11666    1   NOMTYP:;
      575    11667    1         IF CG$->KQ$CG.AUCTL.XTYPLGL THEN

  11667  1 001501   200007 470500                    LDP0    CG$,,AUTO
         1 001502   000133 236100                    LDQ     91,,PR0
         1 001503   000001 316007                    CANQ    1,DL
         1 001504   001547 600000 1                  TZE     BADMTYP

      576    11668    2           DO;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:98   
      577    11669    2           IF MBLK$->KQ$MBLK.KEY1 ~= ' ' THEN

  11669  1 001505   200006 471500                    LDP1    MBLK$,,AUTO
         1 001506   100002 237100                    LDAQ    2,,PR1
         1 001507   000002 117000 2                  CMPAQ   2
         1 001510   001516 600000 1                  TZE     s:11671

      578    11670    2            CALL INDEX (I,SUBSTR(MBLK$->KQ$MBLK.KEY1,0,1),KC_LGL1ST) ALTRET(BADMTYP);

  11670  1 001511   000100 124400                    SCM     mask='000'O
         1 001512   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 001513   100002 000001                    ADSC9   2,,PR1                   cn=0,n=1
         1 001514   200012 000100                    ARG     I,,AUTO
         1 001515   001547 606400 1                  TTN     BADMTYP

      579    11671    2           MTYP$=STA$;

  11671  1 001516   200005 236100                    LDQ     STA$,,AUTO
         1 001517   200015 756100                    STQ     MTYP$,,AUTO

      580    11672    2           CALL KQT$GETTYP (CG$->KQ$CG,MTYP$,MBLK$->KQ$MBLK.KEY1) ALTRET(NOMTYP1);

  11672  1 001520   200006 236100                    LDQ     MBLK$,,AUTO
         1 001521   000002 036003                    ADLQ    2,DU
         1 001522   200112 756100                    STQ     @M$+3,,AUTO
         1 001523   200015 633500                    EPPR3   MTYP$,,AUTO
         1 001524   200111 453500                    STP3    @M$+2,,AUTO
         1 001525   200007 236100                    LDQ     CG$,,AUTO
         1 001526   200110 756100                    STQ     @M$+1,,AUTO
         1 001527   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001530   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001531   000000 701000 xent               TSX1    KQT$GETTYP
         1 001532   001534 702000 1                  TSX2    NOMTYP1

      581    11673    2           GOTO GOTMTYP;

  11673  1 001533   000176 710000 1                  TRA     GOTMTYP
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:99   

  11671  1 001534                       NOMTYP1      null
      582    11674    2   NOMTYP1:;
      583    11675    2           IF MTYP$ = ADDR(NIL) THEN K$RWPARM.ERR=KQPE_QFUL#;

  11675  1 001534   200015 236100                    LDQ     MTYP$,,AUTO
         1 001535   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001536   001543 601000 1                  TNZ     s:11676

  11675  1 001537   000005 235007                    LDA     5,DL
         1 001540   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001541   000013 755100                    STA     11,,PR0
         1 001542   001561 710000 1                  TRA     s:11687

      584    11676    2           ELSE K$RWPARM.ERR=KQPE_NOMBLK#;

  11676  1 001543   000001 235007                    LDA     1,DL
         1 001544   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001545   000013 755100                    STA     11,,PR0

      585    11677    2           END;

  11677  1 001546   001561 710000 1                  TRA     s:11687

      586    11678    1         ELSE
      587    11679    2           DO;

  11675  1 001547                       BADMTYP      null
      588    11680    2   BADMTYP:;
      589    11681                %UNLOCK (G=KQ$TTREE.GATE);

  11682  1 001547   200007 236100                    LDQ     CG$,,AUTO
         1 001550   000067 036003                    ADLQ    55,DU
         1 001551   200110 756100                    STQ     @M$+1,,AUTO
         1 001552   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001553   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001554   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:100  
         1 001555   000000 011000                    NOP     0

  11675  1 001556                       BADMTYP1     null
      590    11684    2   BADMTYP1:;
      591    11685    2           K$RWPARM.ERR=KQPE_BADMTYP#;

  11685  1 001556   000003 235007                    LDA     3,DL
         1 001557   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001560   000013 755100                    STA     11,,PR0

      592    11686    2           END;

      593    11687    1         MTYP$ = ADDR(NIL);

  11687  1 001561   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001562   200015 756100                    STQ     MTYP$,,AUTO

  11687  1 001563                       DELALT       null
      594    11688    1   DELALT:;
      595    11689    1         CALL DUMPMSG1;

  11689  1 001563   003474 701000 1                  TSX1    DUMPMSG1
         1 001564   000000 011000                    NOP     0

      596    11690    1         GOTO ALTRT;

  11690  1 001565   002342 710000 1                  TRA     ALTRT

  11687  1 001566                       NOVGET       null
      597    11691    1   NOVGET:;
      598    11692    1         MBLK$->KQ$MBLK.PUTSTATE=KQPS_NVG#;

  11692  1 001566   200006 470500                    LDP0    MBLK$,,AUTO
         1 001567   000010 236100                    LDQ     8,,PR0
         1 001570   000012 376000 2                  ANQ     10
         1 001571   000002 276007                    ORQ     2,DL
         1 001572   000010 756100                    STQ     8,,PR0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:101  

      599    11693    1         IF LOCKSET = 0 THEN

  11693  1 001573   200074 235100                    LDA     LOCKSET,,AUTO
         1 001574   001617 601000 1                  TNZ     s:11704

      600    11694    2           DO;

      601    11695                %LOCK (G=STA$->KQ$STA.GATE);

  11696  1 001575   200005 236100                    LDQ     STA$,,AUTO
         1 001576   000016 036003                    ADLQ    14,DU
         1 001577   200110 756100                    STQ     @M$+1,,AUTO
         1 001600   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001601   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001602   000000 701000 xent               TSX1    HFC$LOCK
         1 001603   000000 011000                    NOP     0

      602    11698    2           STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

  11698  1 001604   200005 470500                    LDP0    STA$,,AUTO
         1 001605   000020 236100                    LDQ     16,,PR0
         1 001606   000001 036007                    ADLQ    1,DL
         1 001607   000020 552104                    STBQ    16,'04'O,PR0

      603    11699                %UNLOCK (G=STA$->KQ$STA.GATE);

  11700  1 001610   200005 236100                    LDQ     STA$,,AUTO
         1 001611   000016 036003                    ADLQ    14,DU
         1 001612   200110 756100                    STQ     @M$+1,,AUTO
         1 001613   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001614   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001615   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001616   000000 011000                    NOP     0

      604    11702    2           END;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:102  
      605    11703              %LOCK (G=CG$->KQ$CG.GATE.CG);

  11704  1 001617   200007 236100                    LDQ     CG$,,AUTO
         1 001620   000107 036003                    ADLQ    71,DU
         1 001621   200110 756100                    STQ     @M$+1,,AUTO
         1 001622   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001623   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001624   000000 701000 xent               TSX1    HFC$LOCK
         1 001625   000000 011000                    NOP     0

      606    11706    1         STA$->KQ$STA.DPVGLNK$=CG$->KQ$CG.DPVGHD$;

  11706  1 001626   200007 470500                    LDP0    CG$,,AUTO
         1 001627   000022 236100                    LDQ     18,,PR0
         1 001630   200005 471500                    LDP1    STA$,,AUTO
         1 001631   100025 756100                    STQ     21,,PR1

      607    11707    1         CG$->KQ$CG.DPVGHD$=STA$;

  11707  1 001632   200005 236100                    LDQ     STA$,,AUTO
         1 001633   000022 756100                    STQ     18,,PR0

      608    11708              %UNLOCK (G=CG$->KQ$CG.GATE.CG);

  11709  1 001634   200007 236100                    LDQ     CG$,,AUTO
         1 001635   000107 036003                    ADLQ    71,DU
         1 001636   200110 756100                    STQ     @M$+1,,AUTO
         1 001637   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001640   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001641   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001642   000000 011000                    NOP     0

      609    11711    1         GOTO GETOUT;

  11711  1 001643   002334 710000 1                  TRA     GETOUT

      610    11712    1   PULLTYC: PROC;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:103  

  11712  1 001644   200102 741300       PULLTYC      STX1  ! AUTOGATE+2,,AUTO

      611    11713    2         MBLK$->KQ$MBLK.TYC=MBLK$->KQ$MBLK.TYC|K$RWPARM.TYC;

  11713  1 001645   200006 470500                    LDP0    MBLK$,,AUTO
         1 001646   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 001647   000013 236100                    LDQ     11,,PR0
         1 001650   100006 276100                    ORQ     6,,PR1
         1 001651   000013 756100                    STQ     11,,PR0

      612    11714    2         MBLK$->KQ$MBLK.DVE=K$RWPARM.DVE;

  11714  1 001652   100010 236100                    LDQ     8,,PR1
         1 001653   000011 772000                    QRL     9
         1 001654   000010 552130                    STBQ    8,'30'O,PR0

      613    11715    2         RETURN;

  11715  1 001655   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
         1 001656   000001 702211                    TSX2  ! 1,X1

      614    11716    2   END PULLTYC;
      615    11717        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:104  
      616    11718        /**/
      617    11719        /*F* NAME:         KQP$GCONT
      618    11720             PURPOSE:      To continue a PUT after a deferred KQD$GET
      619    11721             CALL:         KQP$GCONT (KQ$DFRPARM)
      620    11722             DESCRIPTION:  The defer params contain the station pointer,
      621    11723                           and the results of the GET.  These are merged
      622    11724                           into the current PUT MBLK, and KQP$GCONT1 is
      623    11725                           fallen into.
      624    11726        */
      625    11727    1   KQP$GCONT: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */

  11727  1 001657   000000 700200 xent  KQP$GCONT    TSX0  ! X66_AUTO_2
         1 001660   000120 000002                    ZERO    80,2

      626    11728        /**/
      627    11729    1         STA$=DFRP$->KQ$DFRPARM.INFO$;

  11729  1 001661   200003 470500                    LDP0    @PAR,,AUTO
         1 001662   000000 236100                    LDQ     0,,PR0
         1 001663   200005 756100                    STQ     STA$,,AUTO

      628    11730    1         CG$=STA$->KQ$STA.CG$;

  11730  1 001664   200005 471500                    LDP1    STA$,,AUTO
         1 001665   100007 236100                    LDQ     7,,PR1
         1 001666   200007 756100                    STQ     CG$,,AUTO

      629    11731    1         DBLK$=DFRP$->KQ$DFRPARM.DBLK$;

  11731  1 001667   000001 236100                    LDQ     1,,PR0
         1 001670   200011 756100                    STQ     DBLK$,,AUTO

      630    11732    1         MBLK$=STA$->KQ$STA.MBLK$;

  11732  1 001671   100012 236100                    LDQ     10,,PR1
         1 001672   200006 756100                    STQ     MBLK$,,AUTO

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:105  
      631    11733    1         IF STA$->KQ$STA.IDSC THEN

  11733  1 001673   100020 234100                    SZN     16,,PR1
         1 001674   001711 605000 1                  TPL     s:11739

      632    11734    2           DO;

      633    11735    2           IF DBLK$ ~= ADDR(NIL) THEN

  11735  1 001675   200011 236100                    LDQ     DBLK$,,AUTO
         1 001676   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001677   001710 600000 1                  TZE     s:11737

      634    11736    2            CALL KQD$DELETE(STA$->KQ$STA.CG$->KQ$CG,DBLK$);

  11736  1 001700   100007 473500                    LDP3    7,,PR1
         1 001701   200011 634500                    EPPR4   DBLK$,,AUTO
         1 001702   200111 454500                    STP4    @M$+2,,AUTO
         1 001703   200110 453500                    STP3    @M$+1,,AUTO
         1 001704   200110 630500                    EPPR0   @M$+1,,AUTO
         1 001705   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001706   000000 701000 xent               TSX1    KQD$DELETE
         1 001707   000000 011000                    NOP     0

      635    11737    2           GOTO PUT2;

  11737  1 001710   001311 710000 1                  TRA     PUT2

      636    11738    2           END;
      637    11739    1         IF MBLK$->KQ$MBLK.PUTSTATE ~= KQPS_IIP# THEN CALL SC_BCGPUT;

  11739  1 001711   200006 473500                    LDP3    MBLK$,,AUTO
         1 001712   300010 236100                    LDQ     8,,PR3
         1 001713   000017 376007                    ANQ     15,DL
         1 001714   000006 116007                    CMPQ    6,DL
         1 001715   001720 600000 1                  TZE     s:11740

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:106  
  11739  1 001716   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 001717   000000 600000 xsid               climb   nvectors=         0

      638    11740    1         MBLK$->KQ$MBLK.DBLK$=DBLK$;

  11740  1 001720   200011 236100                    LDQ     DBLK$,,AUTO
         1 001721   200006 470500                    LDP0    MBLK$,,AUTO
         1 001722   000000 756100                    STQ     0,,PR0

      639    11741    1         IF DBLK$ ~= ADDR(NIL) THEN

  11741  1 001723   200011 236100                    LDQ     DBLK$,,AUTO
         1 001724   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001725   001733 600000 1                  TZE     s:11743

      640    11742    1          MBLK$->KQ$MBLK.DDA=DFRP$->KQ$DFRPARM.DDA;

  11742  1 001726   200003 470500                    LDP0    @PAR,,AUTO
         1 001727   200006 471500                    LDP1    MBLK$,,AUTO
         1 001730   000002 235100                    LDA     2,,PR0
         1 001731   100006 755100                    STA     6,,PR1
         1 001732   001741 710000 1                  TRA     s:11745

      641    11743    1         ELSE IF DFRP$->KQ$DFRPARM.ERR ~= %KQDE_NSPC THEN

  11743  1 001733   200003 470500                    LDP0    @PAR,,AUTO
         1 001734   000004 235100                    LDA     4,,PR0
         1 001735   000002 115007                    CMPA    2,DL
         1 001736   001741 600000 1                  TZE     s:11745

      642    11744    1           CALL SC_BCGPUT;

  11744  1 001737   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 001740   000000 600000 xsid               climb   nvectors=         0

      643    11745    1         NK$LDCTAUTO$ = STA$->KQ$STA.LDCT$;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:107  
  11745  1 001741   200005 470500                    LDP0    STA$,,AUTO
         1 001742   000010 236100                    LDQ     8,,PR0
         1 001743   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      644    11746        /**/
      645    11747        /*F* NAME:         KQP$GCONT1
      646    11748             PURPOSE:      To continue a PUT after a deferred KQD$GET
      647    11749             DESCRIPTION:  Continued from KQP$GCONT with the GET results
      648    11750                           merged into the MBLK.
      649    11751                           The PUT continues.
      650    11752        */
      651    11753    1         STA$=NK$LDCT.STA$;

  11753  1 001744   200010 471500                    LDP1    NK$LDCTAUTO$,,AUTO
         1 001745   100012 236100                    LDQ     10,,PR1
         1 001746   200005 756100                    STQ     STA$,,AUTO

      652    11754    1         CG$=NK$LDCT.CG$;

  11754  1 001747   100027 236100                    LDQ     23,,PR1
         1 001750   200007 756100                    STQ     CG$,,AUTO

      653    11755    1         MBLK$=STA$->KQ$STA.MBLK$;

  11755  1 001751   200005 470500                    LDP0    STA$,,AUTO
         1 001752   000012 236100                    LDQ     10,,PR0
         1 001753   200006 756100                    STQ     MBLK$,,AUTO

      654    11756    1         DBLK$=MBLK$->KQ$MBLK.DBLK$;

  11756  1 001754   200006 473500                    LDP3    MBLK$,,AUTO
         1 001755   300000 236100                    LDQ     0,,PR3
         1 001756   200011 756100                    STQ     DBLK$,,AUTO

      655    11757    1         LOCKSET=1;

  11757  1 001757   000001 235007                    LDA     1,DL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:108  
         1 001760   200074 755100                    STA     LOCKSET,,AUTO

      656    11758    1         IF DBLK$ = ADDR(NIL) THEN GOTO PUT01;

  11758  1 001761   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001762   001201 600000 1                  TZE     PUT01

      657    11759    1         DBLK$->KQ$DBLK.STAMP=MBLK$->KQ$MBLK.STAMP;

  11759  1 001763   300001 720100                    LXL0    1,,PR3
         1 001764   200011 474500                    LDP4    DBLK$,,AUTO
         1 001765   400000 740100                    STX0    0,,PR4

      658    11760    1         IF DBLK$->KQ$DBLK.DSIZE = MBLK$->KQ$MBLK.MSGSIZE+SIZEC(KQ$MBLK) THEN

  11760  1 001766   200006 473500                    LDP3    MBLK$,,AUTO
         1 001767   300016 235100                    LDA     14,,PR3
         1 001770   000100 035007                    ADLA    64,DL
         1 001771   200110 755100                    STA     @M$+1,,AUTO
         1 001772   200011 474500                    LDP4    DBLK$,,AUTO
         1 001773   400000 236100                    LDQ     0,,PR4
         1 001774   777777 376007                    ANQ     -1,DL
         1 001775   200110 116100                    CMPQ    @M$+1,,AUTO
         1 001776   002014 601000 1                  TNZ     s:11766

      659    11761    2           DO;

      660    11762    2           PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK))->KQ$MBLK=MBLK$->KQ$MBLK;

  11762  1 001777   400004 220100                    LDX0    4,,PR4
         1 002000   000000 635010                    EAA     0,X0
         1 002001   000020 771000                    ARL     16
         1 002002   000105 100500                    MLR     fill='000'O
         1 002003   300000 000100                    ADSC9   0,,PR3                   cn=0,n=64
         1 002004   477760 000100                    ADSC9   -16,A,PR4                cn=0,n=64

      661    11763    2           DBLK$->KQ$DBLK.MBLK='1'B;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:109  

  11763  1 002005   200011 473500                    LDP3    DBLK$,,AUTO
         1 002006   000020 236003                    LDQ     16,DU
         1 002007   300003 256100                    ORSQ    3,,PR3

      662    11764    2           DBLK$->KQ$DBLK.DSIZE=MBLK$->KQ$MBLK.MSGSIZE;

  11764  1 002010   200006 473500                    LDP3    MBLK$,,AUTO
         1 002011   300016 720100                    LXL0    14,,PR3
         1 002012   200011 474500                    LDP4    DBLK$,,AUTO
         1 002013   400000 440100                    SXL0    0,,PR4

      663    11765    2           END;

      664    11766    1         GOTO PUT0;

  11766  1 002014   001133 710000 1                  TRA     PUT0

      665    11767        /**/
      666    11768        /*F* NAME:         KQP$PCG
      667    11769             PURPOSE:      To call KCD$RDGO again if it couldn't do its job
      668    11770             DESCRIPTION:  KCD$RDGO is called again if it failed for some
      669    11771                           reason the first time.
      670    11772        */
      671    11773    1   KQP$PCG: ENTRY (PAR) ALTRET;

  11773  1 002015   000000 700200 xent  KQP$PCG      TSX0  ! X66_AUTO_2
         1 002016   000120 000002                    ZERO    80,2

      672    11774        /**/
      673    11775    1         NK$LDCTAUTO$ = ADDR(PAR);

  11775  1 002017   200003 236100                    LDQ     @PAR,,AUTO
         1 002020   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      674    11776    1         CALL SETUP ALTRET(RTN);

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:110  
  11776  1 002021   003245 701000 1                  TSX1    SETUP
         1 002022   002334 702000 1                  TSX2    GETOUT

      675    11777    1         MBLK$=STA$->KQ$STA.MBLK$;

  11777  1 002023   200005 470500                    LDP0    STA$,,AUTO
         1 002024   000012 236100                    LDQ     10,,PR0
         1 002025   200006 756100                    STQ     MBLK$,,AUTO

      676    11778    1         IF MBLK$->KQ$MBLK.PUTSTATE ~= KQPS_GDN# THEN CALL SC_BCGPUT;

  11778  1 002026   200006 471500                    LDP1    MBLK$,,AUTO
         1 002027   100010 236100                    LDQ     8,,PR1
         1 002030   000017 376007                    ANQ     15,DL
         1 002031   000003 116007                    CMPQ    3,DL
         1 002032   002035 600000 1                  TZE     s:11779

  11778  1 002033   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 002034   000000 600000 xsid               climb   nvectors=         0

      677    11779    1         GOTO PUT1;

  11779  1 002035   001206 710000 1                  TRA     PUT1

      678    11780        /**/
      679    11781        /*F* NAME:         KQP$DVGET
      680    11782             PURPOSE:      To continue a PUT by re-trying a VGET which
      681    11783                           failed due to a full FEP WSQ
      682    11784             DESCRIPTION:  Called from KCC$CLOCK.
      683    11785        */
      684    11786    1   KQP$DVGET: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */

  11786  1 002036   000000 700200 xent  KQP$DVGET    TSX0  ! X66_AUTO_2
         1 002037   000120 000002                    ZERO    80,2

      685    11787        /**/
      686    11788    1         NK$LDCTAUTO$ = ADDR(PAR);
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:111  

  11788  1 002040   200003 236100                    LDQ     @PAR,,AUTO
         1 002041   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      687    11789    1         STA$=NK$LDCT.STA$;

  11789  1 002042   200010 470500                    LDP0    NK$LDCTAUTO$,,AUTO
         1 002043   000012 236100                    LDQ     10,,PR0
         1 002044   200005 756100                    STQ     STA$,,AUTO

      688    11790    1         CG$=NK$LDCT.CG$;

  11790  1 002045   000027 236100                    LDQ     23,,PR0
         1 002046   200007 756100                    STQ     CG$,,AUTO

      689    11791    1         MBLK$=STA$->KQ$STA.MBLK$;

  11791  1 002047   200005 471500                    LDP1    STA$,,AUTO
         1 002050   100012 236100                    LDQ     10,,PR1
         1 002051   200006 756100                    STQ     MBLK$,,AUTO

      690    11792    1         IF MBLK$->KQ$MBLK.PUTSTATE ~= KQPS_NVG# THEN CALL SC_BCGPUT;

  11792  1 002052   200006 473500                    LDP3    MBLK$,,AUTO
         1 002053   300010 236100                    LDQ     8,,PR3
         1 002054   000017 376007                    ANQ     15,DL
         1 002055   000002 116007                    CMPQ    2,DL
         1 002056   002061 600000 1                  TZE     s:11793

  11792  1 002057   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 002060   000000 600000 xsid               climb   nvectors=         0

      691    11793    1         DBLK$=MBLK$->KQ$MBLK.DBLK$;

  11793  1 002061   200006 470500                    LDP0    MBLK$,,AUTO
         1 002062   000000 236100                    LDQ     0,,PR0
         1 002063   200011 756100                    STQ     DBLK$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:112  

      692    11794    1         LOCKSET=1;

  11794  1 002064   000001 235007                    LDA     1,DL
         1 002065   200074 755100                    STA     LOCKSET,,AUTO

      693    11795    1         GOTO PUT0;

  11795  1 002066   001133 710000 1                  TRA     PUT0

      694    11796        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:113  
      695    11797        /**/
      696    11798        /*F* NAME:         KQP$DONE
      697    11799             PURPOSE:      To finish a PUT
      698    11800             DESCRIPTION:  Called from KCF$FEIN when the FEP has finished
      699    11801                           transferring the data into the host buffer.
      700    11802                           The buffer is VRELed from the FEP's page table,
      701    11803                           the DBLK is unlocked, and KQW$SEND is called to
      702    11804                           transfer the message to the receiver.  If the
      703    11805                           message cannot be delivered, we ALTRET with an
      704    11806                           appropriate error code.
      705    11807
      706    11808                           If K$RWPARM.ERR ~= 0 when entered, this means
      707    11809                           that the message is to be discarded.
      708    11810        */
      709    11811    1   KQP$DONE: ENTRY (PAR,K$RWPARM) ALTRET;

  11811  1 002067   000000 700200 xent  KQP$DONE     TSX0  ! X66_AUTO_2
         1 002070   000120 000002                    ZERO    80,2

      710    11812        /**/
      711    11813    1         NK$LDCTAUTO$ = ADDR(PAR);

  11813  1 002071   200003 236100                    LDQ     @PAR,,AUTO
         1 002072   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      712    11814    1         DOTYC=0;

  11814  1 002073   200023 450100                    STZ     DOTYC,,AUTO

      713    11815    1         GOTO DONE;

  11815  1 002074   002103 710000 1                  TRA     DONE

      714    11816        /**/
      715    11817        /*F* NAME:         KQP$DONET
      716    11818             PURPOSE:      To finish a PUT passing TYC etc
      717    11819             DESCRIPTION:  Same as KQP$DONE except supplies new TYC, DVE,
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:114  
      718    11820                           and MSGSZ
      719    11821        */
      720    11822    1   KQP$DONET: ENTRY (PAR,K$RWPARM) ALTRET;

  11822  1 002075   000000 700200 xent  KQP$DONET    TSX0  ! X66_AUTO_2
         1 002076   000120 000002                    ZERO    80,2

      721    11823        /**/
      722    11824    1         NK$LDCTAUTO$ = ADDR(PAR);

  11824  1 002077   200003 236100                    LDQ     @PAR,,AUTO
         1 002100   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      723    11825    1         DOTYC=1;

  11825  1 002101   000001 235007                    LDA     1,DL
         1 002102   200023 755100                    STA     DOTYC,,AUTO

  11825  1 002103                       DONE         null
      724    11826    1   DONE: ;
      725    11827    1         CALL SETUP ALTRET(RTN);

  11827  1 002103   003245 701000 1                  TSX1    SETUP
         1 002104   002334 702000 1                  TSX2    GETOUT

      726    11828    1         MBLK$=STA$->KQ$STA.MBLK$;

  11828  1 002105   200005 470500                    LDP0    STA$,,AUTO
         1 002106   000012 236100                    LDQ     10,,PR0
         1 002107   200006 756100                    STQ     MBLK$,,AUTO

      727    11829    2           DO INHIBIT;

      728    11830    2           IF MBLK$->KQ$MBLK.PUTSTATE ~= KQPS_GDN# THEN CALL SC_BCGPUT;

  11830  1 002110   200006 471700                    LDP1  ! MBLK$,,AUTO
         1 002111   100010 236300                    LDQ   ! 8,,PR1
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:115  
         1 002112   000017 376207                    ANQ   ! 15,DL
         1 002113   000003 116207                    CMPQ  ! 3,DL
         1 002114   002117 600200 1                  TZE   ! s:11831

  11830  1 002115   000000 713600 xsym               CLIMB ! SC_BCGPUT
         1 002116   000000 600000 xsid               climb   nvectors=         0

      729    11831    2           MBLK$->KQ$MBLK.PUTSTATE=KQPS_DIP#;

  11831  1 002117   200006 470700                    LDP0  ! MBLK$,,AUTO
         1 002120   000010 236300                    LDQ   ! 8,,PR0
         1 002121   000012 376200 2                  ANQ   ! 10
         1 002122   000005 276207                    ORQ   ! 5,DL
         1 002123   000010 756300                    STQ   ! 8,,PR0

      730    11832    2           END;

      731    11833    1         IF DOTYC ~= 0 THEN

  11833  1 002124   200023 235100                    LDA     DOTYC,,AUTO
         1 002125   002147 600000 1                  TZE     s:11854

      732    11834    2           DO;

      733    11835    2           CALL PULLTYC;

  11835  1 002126   001644 701000 1                  TSX1    PULLTYC
         1 002127   000000 011000                    NOP     0

      734    11836    2           IF K$RWPARM.MSGSZ > MBLK$->KQ$MBLK.MSGSIZE THEN

  11836  1 002130   200006 470500                    LDP0    MBLK$,,AUTO
         1 002131   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 002132   000016 236100                    LDQ     14,,PR0
         1 002133   002140 604000 1                  TMI     s:11851
         1 002134   100001 116100                    CMPQ    1,,PR1
         1 002135   002140 605000 1                  TPL     s:11851
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:116  

      735    11837    2            CALL SC_BCGPSC;

  11837  1 002136   000000 713400 xsym               CLIMB   SC_BCGPSC
         1 002137   000000 600000 xsid               climb   nvectors=         0

      736    11838        /*S* SCREECH_CODE: KQP-S$BCGPSC
      737    11839             TYPE:         SCREECH
      738    11840             MESSAGE:      Bad COMGROUP PUT size change
      739    11841             REMARKS:      When TERMINALs PUT to a COMGROUP, they may not
      740    11842                           know how big the record will be (e.g. local card
      741    11843                           readers hooked up to INSYM).  Thus they call PUT
      742    11844                           asking for a buffer big enough to hold the max
      743    11845                           size record, and then pass the actual size read
      744    11846                           to KQP$DONET.  This screech occurs when the size
      745    11847                           passed to KQP$DONET is larger than that asked for
      746    11848                           originally.  Note that if the passed size is
      747    11849                           real, then the device has clobbered something by
      748    11850                           storing outside of the allocated data block. */
      749    11851    2           MBLK$->KQ$MBLK.MSGSIZE=K$RWPARM.MSGSZ;

  11851  1 002140   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 002141   000001 235100                    LDA     1,,PR0
         1 002142   200006 471500                    LDP1    MBLK$,,AUTO
         1 002143   100016 755100                    STA     14,,PR1

      750    11852    2           MBLK$->KQ$MBLK.DBLK$->KQ$DBLK.DSIZE=K$RWPARM.MSGSZ;

  11852  1 002144   100000 473500                    LDP3    0,,PR1
         1 002145   000001 720100                    LXL0    1,,PR0
         1 002146   300000 440100                    SXL0    0,,PR3

      751    11853    2           END;

      752    11854    1         IF K$RWPARM.ERR ~= 0 THEN

  11854  1 002147   200004 470500                    LDP0    @K$RWPARM,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:117  
         1 002150   000013 235100                    LDA     11,,PR0
         1 002151   002157 600000 1                  TZE     s:11860

      753    11855    2           DO;

      754    11856    2           CALL FINDMTYP;

  11856  1 002152   003514 701000 1                  TSX1    FINDMTYP
         1 002153   000000 011000                    NOP     0

      755    11857    2           CALL DUMPMSG;

  11857  1 002154   003440 701000 1                  TSX1    DUMPMSG
         1 002155   000000 011000                    NOP     0

      756    11858    2           GOTO GETOUT;

  11858  1 002156   002334 710000 1                  TRA     GETOUT

      757    11859    2           END;
      758    11860    1         IF STA$->KQ$STA.VGOT$ ~= ADDR(NIL) THEN

  11860  1 002157   200005 471500                    LDP1    STA$,,AUTO
         1 002160   100025 236100                    LDQ     21,,PR1
         1 002161   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002162   002173 600000 1                  TZE     SENDIT

      759    11861    1          CALL MMS$VREL (%B_CWSQ1,STA$->KQ$STA.VGOT$);

  11861  1 002163   200005 236100                    LDQ     STA$,,AUTO
         1 002164   000025 036003                    ADLQ    21,DU
         1 002165   000011 235000 2                  LDA     9
         1 002166   200110 757100                    STAQ    @M$+1,,AUTO
         1 002167   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002170   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002171   000000 701000 xent               TSX1    MMS$VREL
         1 002172   000000 011000                    NOP     0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:118  

  11860  1 002173                       SENDIT       null
      760    11862                                /* COME HERE TO SEND THE MESSAGE */
      761    11863    1   SENDIT:;
      762    11864    1         CALL KQD$UNLOCK (CG$->KQ$CG,MBLK$->KQ$MBLK.DBLK$);

  11864  1 002173   200006 236100                    LDQ     MBLK$,,AUTO
         1 002174   200007 235100                    LDA     CG$,,AUTO
         1 002175   200110 757100                    STAQ    @M$+1,,AUTO
         1 002176   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002177   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002200   000000 701000 xent               TSX1    KQD$UNLOCK
         1 002201   000000 011000                    NOP     0

  11860  1 002202                       SENDIT0      null
      763    11865    1   SENDIT0:;
      764    11866    1         MBLK$->KQ$MBLK.PUTSTATE=KQPS_SIP#;

  11866  1 002202   200006 470500                    LDP0    MBLK$,,AUTO
         1 002203   000010 236100                    LDQ     8,,PR0
         1 002204   000012 376000 2                  ANQ     10
         1 002205   000004 276007                    ORQ     4,DL
         1 002206   000010 756100                    STQ     8,,PR0

      765    11867    1         K$RWPARM.MSGID=MBLK$->KQ$MBLK.MID.PRIMARY;

  11867  1 002207   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 002210   000014 235100                    LDA     12,,PR0
         1 002211   100011 755100                    STA     9,,PR1

      766    11868    1         K$RWPARM.MSGIDXT=BINBIT(MBLK$->KQ$MBLK.MID.XT,36);

  11868  1 002212   000015 236100                    LDQ     13,,PR0
         1 002213   100012 756100                    STQ     10,,PR1

      767    11869    1         IF MBLK$->KQ$MBLK.JOURNAL THEN

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:119  
  11869  1 002214   000010 236100                    LDQ     8,,PR0
         1 002215   000400 316007                    CANQ    256,DL
         1 002216   002330 600000 1                  TZE     s:11905

      768    11870    1          IF MBLK$->KQ$MBLK.DVE.DVBYTE & %DVBYTE_RRR# THEN

  11870  1 002217   000010 236100                    LDQ     8,,PR0
         1 002220   000011 736000                    QLS     9
         1 002221   777000 376003                    ANQ     -512,DU
         1 002222   010000 376003                    ANQ     4096,DU
         1 002223   002330 600000 1                  TZE     s:11905

      769    11871    2            DO;

      770    11872                 %LOCK (G=STA$->KQ$STA.GATE);

  11873  1 002224   200005 236100                    LDQ     STA$,,AUTO
         1 002225   000016 036003                    ADLQ    14,DU
         1 002226   200110 756100                    STQ     @M$+1,,AUTO
         1 002227   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002230   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002231   000000 701000 xent               TSX1    HFC$LOCK
         1 002232   000000 011000                    NOP     0

      771    11875    2            STA$->KQ$STA.JRNLW='1'B;

  11875  1 002233   200005 470500                    LDP0    STA$,,AUTO
         1 002234   004000 236007                    LDQ     2048,DL
         1 002235   000023 256100                    ORSQ    19,,PR0

      772    11876    2            STA$->KQ$STA.JMSGID=0;

  11876  1 002236   000025 450100                    STZ     21,,PR0

      773    11877                 %UNLOCK (G=STA$->KQ$STA.GATE);

  11878  1 002237   200005 236100                    LDQ     STA$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:120  
         1 002240   000016 036003                    ADLQ    14,DU
         1 002241   200110 756100                    STQ     @M$+1,,AUTO
         1 002242   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002243   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002244   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002245   000000 011000                    NOP     0

      774    11880    2            CALL KQW$SENDNA (STA$->KQ$STA) ALTRET(NSJ);

  11880  1 002246   200005 630500                    EPPR0   STA$,,AUTO
         1 002247   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002250   000000 701000 xent               TSX1    KQW$SENDNA
         1 002251   002306 702000 1                  TSX2    NSJ

      775    11881    2            IF  STA$->KQ$STA.JRNLW

  11881  1 002252   200005 470500                    LDP0    STA$,,AUTO
         1 002253   000023 236100                    LDQ     19,,PR0
         1 002254   004000 316007                    CANQ    2048,DL
         1 002255   002302 600000 1                  TZE     s:11893
         1 002256   000025 235100                    LDA     21,,PR0
         1 002257   002302 601000 1                  TNZ     s:11893

      776    11882    2            AND STA$->KQ$STA.JMSGID = 0 THEN
      777    11883    3              DO;

      778    11884                   %LOCK (G=STA$->KQ$STA.GATE);

  11885  1 002260   200005 236100                    LDQ     STA$,,AUTO
         1 002261   000016 036003                    ADLQ    14,DU
         1 002262   200110 756100                    STQ     @M$+1,,AUTO
         1 002263   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002264   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002265   000000 701000 xent               TSX1    HFC$LOCK
         1 002266   000000 011000                    NOP     0

      779    11887    3              STA$->KQ$STA.JRNLW='0'B;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:121  

  11887  1 002267   200005 470500                    LDP0    STA$,,AUTO
         1 002270   000013 236000 2                  LDQ     11
         1 002271   000023 356100                    ANSQ    19,,PR0

      780    11888                   %UNLOCK (G=STA$->KQ$STA.GATE);

  11889  1 002272   200005 236100                    LDQ     STA$,,AUTO
         1 002273   000016 036003                    ADLQ    14,DU
         1 002274   200110 756100                    STQ     @M$+1,,AUTO
         1 002275   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002276   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002277   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002300   000000 011000                    NOP     0

      781    11891    3              GOTO GETOUT;

  11891  1 002301   002334 710000 1                  TRA     GETOUT

      782    11892    3              END;
      783    11893    2            K$RWPARM.ERR=KQPE_ILTR#;

  11893  1 002302   000010 235007                    LDA     8,DL
         1 002303   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 002304   100013 755100                    STA     11,,PR1

      784    11894    2            ALTRETURN;

  11894  1 002305   000000 702200 xent               TSX2  ! X66_AALT

  11893  1 002306                       NSJ          null
      785    11895    2   NSJ:     ;
      786    11896                 %LOCK (G=STA$->KQ$STA.GATE);

  11897  1 002306   200005 236100                    LDQ     STA$,,AUTO
         1 002307   000016 036003                    ADLQ    14,DU
         1 002310   200110 756100                    STQ     @M$+1,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:122  
         1 002311   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002312   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002313   000000 701000 xent               TSX1    HFC$LOCK
         1 002314   000000 011000                    NOP     0

      787    11899    2            STA$->KQ$STA.JRNLW='0'B;

  11899  1 002315   200005 470500                    LDP0    STA$,,AUTO
         1 002316   000013 236000 2                  LDQ     11
         1 002317   000023 356100                    ANSQ    19,,PR0

      788    11900                 %UNLOCK (G=STA$->KQ$STA.GATE);

  11901  1 002320   200005 236100                    LDQ     STA$,,AUTO
         1 002321   000016 036003                    ADLQ    14,DU
         1 002322   200110 756100                    STQ     @M$+1,,AUTO
         1 002323   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002324   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002325   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002326   000000 011000                    NOP     0

      789    11903    2            GOTO NOSTA;

  11903  1 002327   002337 710000 1                  TRA     NOSTA

      790    11904    2            END;
      791    11905    1         CALL KQW$SENDNA (STA$->KQ$STA) ALTRET(NOSTA);

  11905  1 002330   200005 630500                    EPPR0   STA$,,AUTO
         1 002331   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002332   000000 701000 xent               TSX1    KQW$SENDNA
         1 002333   002337 702000 1                  TSX2    NOSTA

  11901  1 002334                       GETOUT       null
  11901  1 002334                       RTN          null
      792    11906    1   GETOUT:;
      793    11907    1   RTN:  ;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:123  
      794    11908    1         RETURN;

  11908  1 002334   000000 702200 xent               TSX2  ! X66_ARET

  11901  1 002335                       NOSTA0       null
      795    11909    1   NOSTA0:;
      796    11910    1         CALL DUMPMSG1;

  11910  1 002335   003474 701000 1                  TSX1    DUMPMSG1
         1 002336   000000 011000                    NOP     0

  11901  1 002337                       NOSTA        null
      797    11911    1   NOSTA: ;
      798    11912    1         K$RWPARM.ERR=KQPE_NOSTA#;

  11912  1 002337   000004 235007                    LDA     4,DL
         1 002340   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 002341   000013 755100                    STA     11,,PR0

  11912  1 002342                       ALTRT        null
      799    11913    1   ALTRT: ;
      800    11914    1         ALTRETURN;

  11914  1 002342   000000 702200 xent               TSX2  ! X66_AALT

      801    11915        /**/
      802    11916        /*F* NAME:         KQP$INCMP
      803    11917             PURPOSE:      To tell a TERMINAL that a PUT is complete
      804    11918             CALL:         KQP$INCMP (KQ$STA)
      805    11919             DESCRIPTION:  When a message is to be JOURNALed, then
      806    11920                           KQP$DONE ALTRETs with KQPE_ILTR (ID later),
      807    11921                           indicating that KCD$INCMP will be called
      808    11922                           later with the MSGID of the message, when
      809    11923                           the comgroup has safely journaled the message.
      810    11924
      811    11925                           KQP$INCMP is called from KQU$UNLATCH when the
      812    11926                           journal station UNLATCHes the message after
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:124  
      813    11927                           having journaled it.
      814    11928
      815    11929                           Called with the station gate locked and
      816    11930                           LOCKCNT bumped up.
      817    11931
      818    11932                           MUST be called in behalf of a user.
      819    11933        */
      820    11934    1   KQP$INCMP: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */

  11934  1 002343   000000 700200 xent  KQP$INCMP    TSX0  ! X66_AUTO_2
         1 002344   000120 000002                    ZERO    80,2

      821    11935        /**/
      822    11936    1         LOCKSET=1;

  11936  1 002345   000001 235007                    LDA     1,DL
         1 002346   200074 755100                    STA     LOCKSET,,AUTO

      823    11937    1         STA$=ADDR(PAR);

  11937  1 002347   200003 236100                    LDQ     @PAR,,AUTO
         1 002350   200005 756100                    STQ     STA$,,AUTO

      824    11938    1         STA$->KQ$STA.JRNLW='0'B;

  11938  1 002351   200005 470500                    LDP0    STA$,,AUTO
         1 002352   000013 236000 2                  LDQ     11
         1 002353   000023 356100                    ANSQ    19,,PR0

      825    11939    1         RWPARM.MSGID=STA$->KQ$STA.JMSGID;

  11939  1 002354   000025 235100                    LDA     21,,PR0
         1 002355   200035 755100                    STA     RWPARM+9,,AUTO

      826    11940              %UNLOCK (G=STA$->KQ$STA.GATE);

  11941  1 002356   200005 236100                    LDQ     STA$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:125  
         1 002357   000016 036003                    ADLQ    14,DU
         1 002360   200110 756100                    STQ     @M$+1,,AUTO
         1 002361   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002362   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002363   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002364   000000 011000                    NOP     0

      827    11943    1         CALL SSS$BLOCK;

  11943  1 002365   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002366   000000 701000 xent               TSX1    SSS$BLOCK
         1 002367   000000 011000                    NOP     0

      828    11944    1         CALL KCD$INCMP (STA$->KQ$STA.LDCT$->N$LDCT,RWPARM);

  11944  1 002370   200005 470500                    LDP0    STA$,,AUTO
         1 002371   000010 471500                    LDP1    8,,PR0
         1 002372   200024 633500                    EPPR3   RWPARM,,AUTO
         1 002373   200111 453500                    STP3    @M$+2,,AUTO
         1 002374   200110 451500                    STP1    @M$+1,,AUTO
         1 002375   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002376   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002377   000000 701000 xent               TSX1    KCD$INCMP
         1 002400   000000 011000                    NOP     0

      829    11945    1         GOTO PUT2;

  11945  1 002401   001311 710000 1                  TRA     PUT2

      830    11946        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:126  
      831    11947        /**/
      832    11948        /*F* NAME:         KQP$EVNT
      833    11949             PURPOSE:      To handle TERMINAL events
      834    11950             DESCRIPTION:  Passes a TERMINAL BREAK event to the COMGROUP AU
      835    11951                           with the passed INFO word as info.
      836    11952        */
      837    11953    1   KQP$EVNT: ENTRY (PAR,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */

  11953  1 002402   000000 700200 xent  KQP$EVNT     TSX0  ! X66_AUTO_2
         1 002403   000120 000002                    ZERO    80,2

      838    11954        /**/
      839    11955    1         NK$LDCTAUTO$ = ADDR(PAR);

  11955  1 002404   200003 236100                    LDQ     @PAR,,AUTO
         1 002405   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      840    11956    1         CALL SETUP ALTRET(RTN);

  11956  1 002406   003245 701000 1                  TSX1    SETUP
         1 002407   002334 702000 1                  TSX2    GETOUT

      841    11957    1         CALL KCA$TELLAU (STA$->KQ$STA,%CG_TBRK#,ADDR(K$RWPARM)->B$$WORD);

  11957  1 002410   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 002411   200112 756100                    STQ     @M$+3,,AUTO
         1 002412   000014 236000 2                  LDQ     12
         1 002413   200005 235100                    LDA     STA$,,AUTO
         1 002414   200110 757100                    STAQ    @M$+1,,AUTO
         1 002415   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002416   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002417   000000 701000 xent               TSX1    KCA$TELLAU
         1 002420   000000 011000                    NOP     0

      842    11958    1         RETURN;

  11958  1 002421   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:127  

      843    11959        /**/
      844    11960        /*F* NAME:         KQP$FPEXIT
      845    11961             PURPOSE:      To send an FPRG TERMINAL at jobstep AU event
      846    11962             DESCRIPTION:  Sends an AU event of code=CG_FPEXIT to the AU
      847    11963        */
      848    11964    1   KQP$FPEXIT: ENTRY (PAR,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */

  11964  1 002422   000000 700200 xent  KQP$FPEXIT   TSX0  ! X66_AUTO_2
         1 002423   000120 000002                    ZERO    80,2

      849    11965        /**/
      850    11966    1         NK$LDCTAUTO$ = ADDR(PAR);

  11966  1 002424   200003 236100                    LDQ     @PAR,,AUTO
         1 002425   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      851    11967    1         CALL SETUP ALTRET(RTN);

  11967  1 002426   003245 701000 1                  TSX1    SETUP
         1 002427   002334 702000 1                  TSX2    GETOUT

      852    11968    1         CALL KCA$TELLAU (STA$->KQ$STA,%CG_FPEXIT#,ADDR(K$RWPARM)->B$$WORD);

  11968  1 002430   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 002431   200112 756100                    STQ     @M$+3,,AUTO
         1 002432   000016 236000 2                  LDQ     14
         1 002433   200005 235100                    LDA     STA$,,AUTO
         1 002434   200110 757100                    STAQ    @M$+1,,AUTO
         1 002435   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002436   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002437   000000 701000 xent               TSX1    KCA$TELLAU
         1 002440   000000 011000                    NOP     0

      853    11969    1         RETURN;

  11969  1 002441   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:128  

      854    11970        /**/
      855    11971        /*F* NAME:         KQP$FPABORT
      856    11972             PURPOSE:      To send an FPRG TERMINAL aborted AU event
      857    11973             DESCRIPTION:  Sends an AU event of code=CG_FPABORT to the AU
      858    11974                           passing along the reason for the abort
      859    11975        */
      860    11976    1   KQP$FPABORT: ENTRY (PAR,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */

  11976  1 002442   000000 700200 xent  KQP$FPABORT  TSX0  ! X66_AUTO_2
         1 002443   000120 000002                    ZERO    80,2

      861    11977        /**/
      862    11978    1         NK$LDCTAUTO$ = ADDR(PAR);

  11978  1 002444   200003 236100                    LDQ     @PAR,,AUTO
         1 002445   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      863    11979    1         CALL SETUP ALTRET(RTN);

  11979  1 002446   003245 701000 1                  TSX1    SETUP
         1 002447   002334 702000 1                  TSX2    GETOUT

      864    11980    1         CALL KCA$TELLAU (STA$->KQ$STA,%CG_FPABORT#,ADDR(K$RWPARM)->B$$WORD);

  11980  1 002450   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 002451   200112 756100                    STQ     @M$+3,,AUTO
         1 002452   000020 236000 2                  LDQ     16
         1 002453   200005 235100                    LDA     STA$,,AUTO
         1 002454   200110 757100                    STAQ    @M$+1,,AUTO
         1 002455   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002456   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002457   000000 701000 xent               TSX1    KCA$TELLAU
         1 002460   000000 011000                    NOP     0

      865    11981    1         RETURN;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:129  
  11981  1 002461   000000 702200 xent               TSX2  ! X66_ARET

      866    11982        /**/
      867    11983        /*F* NAME:         KQP$FPLDTRC
      868    11984             PURPOSE:      To send an FPRG TERMINAL issued M$LDTRC AU event
      869    11985             DESCRIPTION:  Sends an AU event of code=CG_FPLDTRC to the AU
      870    11986                           passing along a VLP_FPRG describing the M$LDTRC'ed
      871    11987                           to FPRG.
      872    11988        */
      873    11989    1   KQP$FPLDTRC: ENTRY (PAR,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */

  11989  1 002462   000000 700200 xent  KQP$FPLDTRC  TSX0  ! X66_AUTO_2
         1 002463   000120 000002                    ZERO    80,2

      874    11990        /**/
      875    11991    1         NK$LDCTAUTO$ = ADDR(PAR);

  11991  1 002464   200003 236100                    LDQ     @PAR,,AUTO
         1 002465   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      876    11992    1         CALL SETUP ALTRET(RTN);

  11992  1 002466   003245 701000 1                  TSX1    SETUP
         1 002467   002334 702000 1                  TSX2    GETOUT

      877    11993    1         CALL KCA$TELLAU (STA$->KQ$STA,%CG_FPLDTRC#,ADDR(K$RWPARM)->VLP$FPRG);

  11993  1 002470   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 002471   200112 756100                    STQ     @M$+3,,AUTO
         1 002472   000022 236000 2                  LDQ     18
         1 002473   200005 235100                    LDA     STA$,,AUTO
         1 002474   200110 757100                    STAQ    @M$+1,,AUTO
         1 002475   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002476   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002477   000000 701000 xent               TSX1    KCA$TELLAU
         1 002500   000000 011000                    NOP     0

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:130  
      878    11994    1         RETURN;

  11994  1 002501   000000 702200 xent               TSX2  ! X66_ARET

      879    11995        /**/
      880    11996        /*F* NAME:         KQP$UNLOCK
      881    11997             PURPOSE:      To count down a station's LOCKCNT
      882    11998             CALL:         KQP$UNLOCK (KQ$STA)
      883    11999             DESCRIPTION:  Locks the station gate and descrements LOCKCNT.
      884    12000                           If it hits 0 with IDSC set, calls KQP$FDISC and
      885    12001                           ALTRETs to indicate disconnect.  Else unlocks
      886    12002                           gate and returns.
      887    12003        */
      888    12004    1   KQP$UNLOCK: ENTRY (PAR) ALTRET;

  12004  1 002502   000000 700200 xent  KQP$UNLOCK   TSX0  ! X66_AUTO_2
         1 002503   000120 000002                    ZERO    80,2

      889    12005        /**/
      890    12006    1         STA$=ADDR(PAR);

  12006  1 002504   200003 236100                    LDQ     @PAR,,AUTO
         1 002505   200005 756100                    STQ     STA$,,AUTO

      891    12007    1         LOCKSET=0;

  12007  1 002506   200074 450100                    STZ     LOCKSET,,AUTO

      892    12008              %LOCK (G=STA$->KQ$STA.GATE);

  12009  1 002507   000016 036003                    ADLQ    14,DU
         1 002510   200110 756100                    STQ     @M$+1,,AUTO
         1 002511   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002512   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002513   000000 701000 xent               TSX1    HFC$LOCK
         1 002514   000000 011000                    NOP     0

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:131  
      893    12011    1         IF STA$->KQ$STA.LOCKCNT = 0 THEN CALL SC_BCGPUT;

  12011  1 002515   200005 470500                    LDP0    STA$,,AUTO
         1 002516   000020 236100                    LDQ     16,,PR0
         1 002517   000777 316007                    CANQ    511,DL
         1 002520   002524 601000 1                  TNZ     s:12013

  12011  1 002521   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 002522   000000 600000 xsid               climb   nvectors=         0
         1 002523   002526 710000 1                  TRA     s:12014

      894    12012    1         ELSE
      895    12013    1          STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;

  12013  1 002524   000777 036007                    ADLQ    511,DL
         1 002525   000020 552104                    STBQ    16,'04'O,PR0

      896    12014    1         IF STA$->KQ$STA.LOCKCNT = 0 THEN

  12014  1 002526   200005 470500                    LDP0    STA$,,AUTO
         1 002527   000020 236100                    LDQ     16,,PR0
         1 002530   000777 316007                    CANQ    511,DL
         1 002531   002545 601000 1                  TNZ     s:12021

      897    12015    1          IF  STA$->KQ$STA.IDSC

  12015  1 002532   000020 234100                    SZN     16,,PR0
         1 002533   002545 605000 1                  TPL     s:12021
         1 002534   040000 316003                    CANQ    16384,DU
         1 002535   002545 600000 1                  TZE     s:12021

      898    12016    1          AND STA$->KQ$STA.TERM THEN
      899    12017    2            DO;

      900    12018    2            CALL KQP$FDISC (STA$->KQ$STA.LDCT$->N$LDCT);

  12018  1 002536   000010 471500                    LDP1    8,,PR0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:132  
         1 002537   200110 451500                    STP1    @M$+1,,AUTO
         1 002540   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002541   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002542   002756 701000 1                  TSX1    s:12103
         1 002543   000000 011000                    NOP     0

      901    12019    2            ALTRETURN;

  12019  1 002544   000000 702200 xent               TSX2  ! X66_AALT

      902    12020    2            END;
      903    12021    1         IF LOCKSET = 0 THEN

  12021  1 002545   200074 235100                    LDA     LOCKSET,,AUTO
         1 002546   002556 601000 1                  TNZ     s:12027

      904    12022    2           DO;

      905    12023                %UNLOCK (G=STA$->KQ$STA.GATE);

  12024  1 002547   200005 236100                    LDQ     STA$,,AUTO
         1 002550   000016 036003                    ADLQ    14,DU
         1 002551   200110 756100                    STQ     @M$+1,,AUTO
         1 002552   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002553   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002554   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002555   000000 011000                    NOP     0

      906    12026    2           END;

      907    12027    1         RETURN;

  12027  1 002556   000000 702200 xent               TSX2  ! X66_ARET

      908    12028        /**/
      909    12029        /*F* NAME:         KQP$DISC
      910    12030             PURPOSE:      To notify COMGROUP of terminal disconnect
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:133  
      911    12031             DESCRIPTION:  Called when a comgroup terminal is disconnecting
      912    12032        */
      913    12033    1   KQP$DISC: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */

  12033  1 002557   000000 700200 xent  KQP$DISC     TSX0  ! X66_AUTO_2
         1 002560   000120 000002                    ZERO    80,2

      914    12034        /**/
      915    12035    1         NK$LDCTAUTO$ = ADDR(PAR);

  12035  1 002561   200003 236100                    LDQ     @PAR,,AUTO
         1 002562   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

      916    12036    1         CALL SETUPI ALTRET(RTN);

  12036  1 002563   003251 701000 1                  TSX1    SETUPI
         1 002564   002334 702000 1                  TSX2    GETOUT

      917    12037    2         IF ADDR(PAR)=STA$->KQ$STA.LDCT$ THEN DO;

  12037  1 002565   200005 470500                    LDP0    STA$,,AUTO
         1 002566   200003 236100                    LDQ     @PAR,,AUTO
         1 002567   000010 116100                    CMPQ    8,,PR0
         1 002570   002707 601000 1                  TNZ     s:12067

      918    12038    2           IF STA$->KQ$STA.IDSC THEN RETURN;

  12038  1 002571   000020 234100                    SZN     16,,PR0
         1 002572   002574 605000 1                  TPL     s:12040

  12038  1 002573   000000 702200 xent               TSX2  ! X66_ARET

      919    12039                %LOCK (G=STA$->KQ$STA.GATE);

  12040  1 002574   200005 236100                    LDQ     STA$,,AUTO
         1 002575   000016 036003                    ADLQ    14,DU
         1 002576   200110 756100                    STQ     @M$+1,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:134  
         1 002577   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002600   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002601   000000 701000 xent               TSX1    HFC$LOCK
         1 002602   000000 011000                    NOP     0

      920    12042                                /* Unblock possible user writing to us */
      921    12043    2           IF STA$->KQ$STA.RBLK$ ~= ADDR(NIL) THEN

  12043  1 002603   200005 470500                    LDP0    STA$,,AUTO
         1 002604   000011 236100                    LDQ     9,,PR0
         1 002605   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002606   002643 600000 1                  TZE     s:12052

      922    12044    2            IF STA$->KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_XFIW# THEN

  12044  1 002607   000011 471500                    LDP1    9,,PR0
         1 002610   100001 220100                    LDX0    1,,PR1
         1 002611   000006 100003                    CMPX0   6,DU
         1 002612   002643 601000 1                  TNZ     s:12052

      923    12045    2             IF STA$->KQ$STA.RBLK$->KQ$RBLK.IOQ$ ~= ADDR(NIL) THEN

  12045  1 002613   100015 236100                    LDQ     13,,PR1
         1 002614   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002615   002643 600000 1                  TZE     s:12052

      924    12046    3               DO;

      925    12047    3               J=ADDR(STA$->KQ$STA.RBLK$->KQ$RBLK.IOQ$->N$REQ.STATION.LSTA$)->B$$SBIN;

  12047  1 002616   100015 473500                    LDP3    13,,PR1
         1 002617   300013 235100                    LDA     11,,PR3
         1 002620   200013 755100                    STA     J,,AUTO

      926    12048    3               ADDR(STA$->KQ$STA.RBLK$->KQ$RBLK.IOQ$->N$REQ.STATION.LSTA$)->B$$WORD=2;

  12048  1 002621   000011 471500                    LDP1    9,,PR0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:135  
         1 002622   100015 473500                    LDP3    13,,PR1
         1 002623   000002 236007                    LDQ     2,DL
         1 002624   300013 756100                    STQ     11,,PR3

      927    12049    3               IF J = -1 THEN

  12049  1 002625   200013 235100                    LDA     J,,AUTO
         1 002626   000027 115000 xsym               CMPA    B_VECTNIL+23
         1 002627   002643 601000 1                  TNZ     s:12052

      928    12050    3                CALL SSR$RUE (%SS_UQA,STA$->KQ$STA.RBLK$->KQ$RBLK.IOQ$->N$REQ.USER#);

  12050  1 002630   000011 471500                    LDP1    9,,PR0
         1 002631   100015 473500                    LDP3    13,,PR1
         1 002632   200112 453500                    STP3    @M$+3,,AUTO
         1 002633   200112 236100                    LDQ     @M$+3,,AUTO
         1 002634   000024 036000 2                  ADLQ    20
         1 002635   000025 235000 2                  LDA     21
         1 002636   200110 757100                    STAQ    @M$+1,,AUTO
         1 002637   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002640   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002641   000000 701000 xent               TSX1    SSR$RUE
         1 002642   000000 011000                    NOP     0

      929    12051    3               END;

      930    12052    2           IF KQ_LOG.TSIO THEN

  12052  1 002643   000000 236000 xsym               LDQ     KQ_LOG
         1 002644   004000 316003                    CANQ    2048,DU
         1 002645   002701 600000 1                  TZE     s:12061

      931    12053    3             DO;

      932    12054    3             J=STA$->KQ$STA.LOCKCNT;

  12054  1 002646   200005 470500                    LDP0    STA$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:136  
         1 002647   000020 236100                    LDQ     16,,PR0
         1 002650   000777 376007                    ANQ     511,DL
         1 002651   200013 756100                    STQ     J,,AUTO

      933    12055    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_TDRQ,
      934    12056    3             BITBIN(STA$->KQ$STA.IDSC),
      935    12057    3             J,0,
      936    12058    3             SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
      937    12059    3             SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));

  12059  1 002652   000020 236100                    LDQ     16,,PR0
         1 002653   000043 772000                    QRL     35
         1 002654   200110 756100                    STQ     @M$+1,,AUTO
         1 002655   200005 236100                    LDQ     STA$,,AUTO
         1 002656   000006 036003                    ADLQ    6,DU
         1 002657   200117 756100                    STQ     @M$+8,,AUTO
         1 002660   200005 236100                    LDQ     STA$,,AUTO
         1 002661   000005 036003                    ADLQ    5,DU
         1 002662   200116 756100                    STQ     @M$+7,,AUTO
         1 002663   000006 236000 2                  LDQ     6
         1 002664   200115 756100                    STQ     @M$+6,,AUTO
         1 002665   200013 631500                    EPPR1   J,,AUTO
         1 002666   200114 451500                    STP1    @M$+5,,AUTO
         1 002667   200110 633500                    EPPR3   @M$+1,,AUTO
         1 002670   200113 453500                    STP3    @M$+4,,AUTO
         1 002671   000027 236000 2                  LDQ     23
         1 002672   200112 756100                    STQ     @M$+3,,AUTO
         1 002673   200007 236100                    LDQ     CG$,,AUTO
         1 002674   200111 756100                    STQ     @M$+2,,AUTO
         1 002675   200111 630500                    EPPR0   @M$+2,,AUTO
         1 002676   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 002677   000000 701000 xent               TSX1    KQZ$LOG
         1 002700   000000 011000                    NOP     0

      938    12060    3             END;

      939    12061    2           STA$->KQ$STA.IDSC='1'B;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:137  

  12061  1 002701   200005 470500                    LDP0    STA$,,AUTO
         1 002702   400000 236003                    LDQ     -131072,DU
         1 002703   000020 256100                    ORSQ    16,,PR0

      940    12062    2           STA$->KQ$STA.JRNLW='0'B;

  12062  1 002704   000013 236000 2                  LDQ     11
         1 002705   000023 356100                    ANSQ    19,,PR0

      941    12063    2           GOTO PUT3;

  12063  1 002706   001331 710000 1                  TRA     PUT3

      942    12064    2           END;
      943    12065    2         ELSE DO;    /* Must be KQ$STA.SAVLDCT$ disconnecting. */

      944    12066                %LOCK(G=STA$->KQ$STA.GATE);

  12067  1 002707   200005 236100                    LDQ     STA$,,AUTO
         1 002710   000016 036003                    ADLQ    14,DU
         1 002711   200110 756100                    STQ     @M$+1,,AUTO
         1 002712   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002713   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002714   000000 701000 xent               TSX1    HFC$LOCK
         1 002715   000000 011000                    NOP     0

      945    12069    2           STA$->KQ$STA.SAVIDSC='1'B;

  12069  1 002716   200005 470500                    LDP0    STA$,,AUTO
         1 002717   000400 236007                    LDQ     256,DL
         1 002720   000023 256100                    ORSQ    19,,PR0

      946    12070    2           STA$->KQ$STA.DDISC=2;          /* This will cause disconnect to be   */

  12070  1 002721   000023 236100                    LDQ     19,,PR0
         1 002722   000030 376000 2                  ANQ     24
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:138  
         1 002723   100000 276007                    ORQ     32768,DL
         1 002724   000023 756100                    STQ     19,,PR0

      947    12071                                               /* continued off the clock later      */
      948    12072                                               /* thereby not colliding with running */
      949    12073                                               /* disconnect off the KQ$CG.DPVGHD$   */
      950    12074                                               /* chain (which on completion causes  */
      951    12075                                               /* us to move KQ$STA.SAVLDCT$ and     */
      952    12076                                               /* KQ$STA.SAVIDSC to KQ$STA.LDCT$ and */
      953    12077                                               /* KQ$STA.IDSC).                      */
      954    12078                %UNLOCK(G=STA$->KQ$STA.GATE);

  12079  1 002725   200005 236100                    LDQ     STA$,,AUTO
         1 002726   000016 036003                    ADLQ    14,DU
         1 002727   200110 756100                    STQ     @M$+1,,AUTO
         1 002730   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002731   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002732   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002733   000000 011000                    NOP     0

      955    12081                %LOCK(G=CG$->KQ$CG.GATE.CG);

  12082  1 002734   200007 236100                    LDQ     CG$,,AUTO
         1 002735   000107 036003                    ADLQ    71,DU
         1 002736   200110 756100                    STQ     @M$+1,,AUTO
         1 002737   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002740   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002741   000000 701000 xent               TSX1    HFC$LOCK
         1 002742   000000 011000                    NOP     0

      956    12084    2           CG$->KQ$CG.DELAY.DDISC='1'B;

  12084  1 002743   200007 470500                    LDP0    CG$,,AUTO
         1 002744   004000 236003                    LDQ     2048,DU
         1 002745   000020 256100                    ORSQ    16,,PR0

      957    12085                %UNLOCK(G=CG$->KQ$CG.GATE.CG);
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:139  

  12086  1 002746   200007 236100                    LDQ     CG$,,AUTO
         1 002747   000107 036003                    ADLQ    71,DU
         1 002750   200110 756100                    STQ     @M$+1,,AUTO
         1 002751   200110 630500                    EPPR0   @M$+1,,AUTO
         1 002752   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002753   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002754   000000 011000                    NOP     0

      958    12088    2           RETURN;

  12088  1 002755   000000 702200 xent               TSX2  ! X66_ARET

      959    12089    2           END;
      960    12090        /**/
      961    12091        /*F* NAME:         KQP$FDISC
      962    12092             PURPOSE:      To finally disconnect a terminal
      963    12093             DESCRIPTION:  Called by anyone who had KQ$STA.LOCKCNT counted
      964    12094                           up, and counted it down & found IDSC set.
      965    12095
      966    12096                           Entered with the station locked, and LOCKCNT zero.
      967    12097                           Cleans up any outstanding delayed mem request.
      968    12098                           Cleans up the current GET by calling KQG$CLEANUP.
      969    12099                           Then cleans up the current PUT.
      970    12100                           Last, calls KCO$DSCTRM to finish up the
      971    12101                           disconnect.
      972    12102        */
      973    12103    1   KQP$FDISC: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */

  12103  1 002756   000000 700200 xent  KQP$FDISC    TSX0  ! X66_AUTO_2
         1 002757   000120 000002                    ZERO    80,2

      974    12104        /**/
      975    12105    1         NK$LDCTAUTO$ = ADDR(PAR);

  12105  1 002760   200003 236100                    LDQ     @PAR,,AUTO
         1 002761   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:140  

      976    12106    1         STA$=NK$LDCT.STA$;

  12106  1 002762   200010 470500                    LDP0    NK$LDCTAUTO$,,AUTO
         1 002763   000012 236100                    LDQ     10,,PR0
         1 002764   200005 756100                    STQ     STA$,,AUTO

      977    12107    1         CG$=NK$LDCT.CG$;

  12107  1 002765   000027 236100                    LDQ     23,,PR0
         1 002766   200007 756100                    STQ     CG$,,AUTO

  12107  1 002767                       DODISC       null
      978    12108    1   DODISC:;
      979    12109                     /*    Bump LOCKCNT up so
      980    12110                      *    that people calling
      981    12111                      *    KQP$UNLOCK won't
      982    12112                      *    drive thru here
      983    12113                      *    again.
      984    12114                      */
      985    12115    1         STA$->KQ$STA.LOCKCNT=1;

  12115  1 002767   200005 470500                    LDP0    STA$,,AUTO
         1 002770   000001 236007                    LDQ     1,DL
         1 002771   000020 552104                    STBQ    16,'04'O,PR0

      986    12116                          /*    Always do disconnect off
      987    12117                           *    the clock.  So
      988    12118                           *    put this station on the
      989    12119                           *    disconnect list and
      990    12120                           *    exit.
      991    12121                           */
      992    12122    1         STA$->KQ$STA.PVGSENSE='1'B;

  12122  1 002772   001000 236007                    LDQ     512,DL
         1 002773   000023 256100                    ORSQ    19,,PR0

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:141  
      993    12123              %UNLOCK (G=STA$->KQ$STA.GATE);

  12124  1 002774   200005 236100                    LDQ     STA$,,AUTO
         1 002775   000016 036003                    ADLQ    14,DU
         1 002776   200110 756100                    STQ     @M$+1,,AUTO
         1 002777   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003000   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003001   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003002   000000 011000                    NOP     0

      994    12126              %LOCK (G=CG$->KQ$CG.GATE.CG);

  12127  1 003003   200007 236100                    LDQ     CG$,,AUTO
         1 003004   000107 036003                    ADLQ    71,DU
         1 003005   200110 756100                    STQ     @M$+1,,AUTO
         1 003006   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003007   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003010   000000 701000 xent               TSX1    HFC$LOCK
         1 003011   000000 011000                    NOP     0

      995    12129    1         STA$->KQ$STA.DPVGLNK$=CG$->KQ$CG.DPVGHD$;

  12129  1 003012   200007 470500                    LDP0    CG$,,AUTO
         1 003013   000022 236100                    LDQ     18,,PR0
         1 003014   200005 471500                    LDP1    STA$,,AUTO
         1 003015   100025 756100                    STQ     21,,PR1

      996    12130    1         CG$->KQ$CG.DPVGHD$=STA$;

  12130  1 003016   200005 236100                    LDQ     STA$,,AUTO
         1 003017   000022 756100                    STQ     18,,PR0

      997    12131              %UNLOCK (G=CG$->KQ$CG.GATE.CG);

  12132  1 003020   200007 236100                    LDQ     CG$,,AUTO
         1 003021   000107 036003                    ADLQ    71,DU
         1 003022   200110 756100                    STQ     @M$+1,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:142  
         1 003023   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003024   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003025   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003026   000000 011000                    NOP     0

      998    12134    1         RETURN;

  12134  1 003027   000000 702200 xent               TSX2  ! X66_ARET

      999    12135        /**/
     1000    12136        /*F* NAME:         KQP$DSCGO
     1001    12137             PURPOSE:      To continue terminal disconnect
     1002    12138             CALL:         KQP$DSCGO (NK$LDCT)
     1003    12139             DESCRIPTION:  Comgroup terminal disconnect is always
     1004    12140                           performed off the clock.  We are called
     1005    12141                           here from KCC$CLOCK to perform the
     1006    12142                           disconnect. */
     1007    12143    1   KQP$DSCGO: ENTRY (PAR) ALTRET;

  12143  1 003030   000000 700200 xent  KQP$DSCGO    TSX0  ! X66_AUTO_2
         1 003031   000120 000002                    ZERO    80,2

     1008    12144        /**/
     1009    12145    1         NK$LDCTAUTO$ = ADDR(PAR);

  12145  1 003032   200003 236100                    LDQ     @PAR,,AUTO
         1 003033   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

     1010    12146    1         STA$=NK$LDCT.STA$;

  12146  1 003034   200010 470500                    LDP0    NK$LDCTAUTO$,,AUTO
         1 003035   000012 236100                    LDQ     10,,PR0
         1 003036   200005 756100                    STQ     STA$,,AUTO

     1011    12147    1         CG$=NK$LDCT.CG$;

  12147  1 003037   000027 236100                    LDQ     23,,PR0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:143  
         1 003040   200007 756100                    STQ     CG$,,AUTO

     1012    12148              %LOCK (G=STA$->KQ$STA.GATE);

  12149  1 003041   200005 236100                    LDQ     STA$,,AUTO
         1 003042   000016 036003                    ADLQ    14,DU
         1 003043   200110 756100                    STQ     @M$+1,,AUTO
         1 003044   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003045   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003046   000000 701000 xent               TSX1    HFC$LOCK
         1 003047   000000 011000                    NOP     0

     1013    12151        /**/
     1014    12152    1         P$=STA$->KQ$STA.MREQ$;

  12152  1 003050   200005 470500                    LDP0    STA$,,AUTO
         1 003051   000024 236100                    LDQ     20,,PR0
         1 003052   200075 756100                    STQ     P$,,AUTO

     1015    12153    1         STA$->KQ$STA.MREQ$=ADDR(NIL);

  12153  1 003053   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003054   000024 756100                    STQ     20,,PR0

     1016    12154    1         J=-STA$->KQ$STA.MREQ;

  12154  1 003055   000020 236100                    LDQ     16,,PR0
         1 003056   000011 736000                    QLS     9
         1 003057   000033 732000                    QRS     27
         1 003060   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 003061   000001 036007                    ADLQ    1,DL
         1 003062   200013 756100                    STQ     J,,AUTO

     1017    12155    1         STA$->KQ$STA.MREQ=0;

  12155  1 003063   000000 236003                    LDQ     0,DU
         1 003064   000020 552120                    STBQ    16,'20'O,PR0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:144  

     1018    12156    1         IF J < 0 THEN CALL SC_BCGPUT;

  12156  1 003065   200013 235100                    LDA     J,,AUTO
         1 003066   003072 605000 1                  TPL     s:12157

  12156  1 003067   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 003070   000000 600000 xsid               climb   nvectors=         0
         1 003071   003144 710000 1                  TRA     s:12170

     1019    12157    1         ELSE IF J > 0 THEN

  12157  1 003072   003144 604400 1                  TMOZ    s:12170

     1020    12158    1           IF P$ ~= ADDR(NIL) THEN

  12158  1 003073   200075 236100                    LDQ     P$,,AUTO
         1 003074   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003075   003144 600000 1                  TZE     s:12170

     1021    12159    2             DO CASE (J);

  12159  1 003076   000006 115007                    CMPA    6,DL
         1 003077   003101 602005 1                  TNC     s:12159+3,AL
         1 003100   003142 710000 1                  TRA     s:12167
         1 003101   003142 710000 1                  TRA     s:12167
         1 003102   003120 710000 1                  TRA     s:12163
         1 003103   003142 710000 1                  TRA     s:12167
         1 003104   003107 710000 1                  TRA     s:12161
         1 003105   003142 710000 1                  TRA     s:12167
         1 003106   003131 710000 1                  TRA     s:12165

     1022    12160    2               CASE (KQMR_RBLKT#);

     1023    12161    2                 CALL KQM$RELRBLKT (CG$->KQ$CG,P$);

  12161  1 003107   200075 631500                    EPPR1   P$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:145  
         1 003110   200111 451500                    STP1    @M$+2,,AUTO
         1 003111   200007 236100                    LDQ     CG$,,AUTO
         1 003112   200110 756100                    STQ     @M$+1,,AUTO
         1 003113   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003114   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003115   000000 701000 xent               TSX1    KQM$RELRBLKT
         1 003116   000000 011000                    NOP     0
         1 003117   003144 710000 1                  TRA     s:12170

     1024    12162    2               CASE (KQMR_MBLK#);

     1025    12163    2                 CALL KQM$RELMBLK (CG$->KQ$CG,P$);

  12163  1 003120   200075 631500                    EPPR1   P$,,AUTO
         1 003121   200111 451500                    STP1    @M$+2,,AUTO
         1 003122   200007 236100                    LDQ     CG$,,AUTO
         1 003123   200110 756100                    STQ     @M$+1,,AUTO
         1 003124   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003125   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003126   000000 701000 xent               TSX1    KQM$RELMBLK
         1 003127   000000 011000                    NOP     0
         1 003130   003144 710000 1                  TRA     s:12170

     1026    12164    2               CASE (KQMR_TYP#);

     1027    12165    2                 CALL KQM$RELMTYP (CG$->KQ$CG,P$);

  12165  1 003131   200075 631500                    EPPR1   P$,,AUTO
         1 003132   200111 451500                    STP1    @M$+2,,AUTO
         1 003133   200007 236100                    LDQ     CG$,,AUTO
         1 003134   200110 756100                    STQ     @M$+1,,AUTO
         1 003135   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003136   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003137   000000 701000 xent               TSX1    KQM$RELMTYP
         1 003140   000000 011000                    NOP     0
         1 003141   003144 710000 1                  TRA     s:12170

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:146  
     1028    12166    2               CASE (ELSE);

     1029    12167    2                 CALL SC_BCGPUT;

  12167  1 003142   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 003143   000000 600000 xsid               climb   nvectors=         0

     1030    12168    2             END;

     1031    12169        /**/
     1032    12170    1         CALL KQG$CLEANUP (NK$LDCT) ALTRET(RTN);

  12170  1 003144   200010 630500                    EPPR0   NK$LDCTAUTO$,,AUTO
         1 003145   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003146   000000 701000 xent               TSX1    KQG$CLEANUP
         1 003147   002334 702000 1                  TSX2    GETOUT

     1033    12171    1         GOTO CDISC;

  12171  1 003150   003162 710000 1                  TRA     CDISC

     1034    12172        /**/
     1035    12173        /*F* NAME:         KQP$CDISC
     1036    12174             PURPOSE:      To continue final disconnect after a delay
     1037    12175                           in KQG$CLEANUP
     1038    12176             DESCRIPTION:  KQG$CLEANUP calls here when he is finished,
     1039    12177                           if he had to delay and ALTRET.
     1040    12178        */
     1041    12179    1   KQP$CDISC: ENTRY (PAR) ALTRET; /* !!Doesn't ALTRET!! */

  12179  1 003151   000000 700200 xent  KQP$CDISC    TSX0  ! X66_AUTO_2
         1 003152   000120 000002                    ZERO    80,2

     1042    12180        /**/
     1043    12181    1         NK$LDCTAUTO$ = ADDR(PAR);

  12181  1 003153   200003 236100                    LDQ     @PAR,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:147  
         1 003154   200010 756100                    STQ     NK$LDCTAUTO$,,AUTO

     1044    12182    1         STA$=NK$LDCT.STA$;

  12182  1 003155   200010 470500                    LDP0    NK$LDCTAUTO$,,AUTO
         1 003156   000012 236100                    LDQ     10,,PR0
         1 003157   200005 756100                    STQ     STA$,,AUTO

     1045    12183    1         CG$=NK$LDCT.CG$;

  12183  1 003160   000027 236100                    LDQ     23,,PR0
         1 003161   200007 756100                    STQ     CG$,,AUTO

  12183  1 003162                       CDISC        null
     1046    12184    1   CDISC: ;
     1047    12185        /**/
     1048    12186                                /* CLEAN UP PUT */
     1049    12187    1         MBLK$=STA$->KQ$STA.MBLK$;

  12187  1 003162   200005 470500                    LDP0    STA$,,AUTO
         1 003163   000012 236100                    LDQ     10,,PR0
         1 003164   200006 756100                    STQ     MBLK$,,AUTO

     1050    12188    1         IF MBLK$ ~= ADDR(NIL) THEN

  12188  1 003165   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003166   003210 600000 1                  TZE     s:12200

     1051    12189    2           DO CASE (MBLK$->KQ$MBLK.PUTSTATE);

  12189  1 003167   200006 471500                    LDP1    MBLK$,,AUTO
         1 003170   100010 720100                    LXL0    8,,PR1
         1 003171   000017 360003                    ANX0    15,DU
         1 003172   000004 100003                    CMPX0   4,DU
         1 003173   003175 602010 1                  TNC     s:12189+6,X0
         1 003174   003201 710000 1                  TRA     s:12192
         1 003175   003201 710000 1                  TRA     s:12192
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:148  
         1 003176   003201 710000 1                  TRA     s:12192
         1 003177   003201 710000 1                  TRA     s:12192
         1 003200   003204 710000 1                  TRA     s:12195

     1052    12190
     1053    12191    2             CASE (ELSE);

     1054    12192    2               CALL SC_BCGPUT;

  12192  1 003201   000000 713400 xsym               CLIMB   SC_BCGPUT
         1 003202   000000 600000 xsid               climb   nvectors=         0
         1 003203   003210 710000 1                  TRA     s:12200

     1055    12193
     1056    12194    2             CASE (KQPS_GDN#);

     1057    12195    2               CALL FINDMTYP;

  12195  1 003204   003514 701000 1                  TSX1    FINDMTYP
         1 003205   000000 011000                    NOP     0

     1058    12196    2               CALL DUMPMSG;

  12196  1 003206   003440 701000 1                  TSX1    DUMPMSG
         1 003207   000000 011000                    NOP     0

     1059    12197
     1060    12198    2           END; /*CASE PUTSTATE */

     1061    12199        /**/
     1062    12200    1         CALL KCO$DSCTRM (STA$->KQ$STA);

  12200  1 003210   200005 630500                    EPPR0   STA$,,AUTO
         1 003211   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003212   000000 701000 xent               TSX1    KCO$DSCTRM
         1 003213   000000 011000                    NOP     0

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:149  
     1063    12201    1         RETURN;

  12201  1 003214   000000 702200 xent               TSX2  ! X66_ARET

     1064    12202        /**/
     1065    12203        /*F* NAME:         KQP$RECOVER
     1066    12204             PURPOSE:      To clean up PUTs and GETs when a comgroup is being
     1067    12205                           opened after being closed by RECOVER.
     1068    12206             CALL:         KQP$RECOVER (KQ$STA);
     1069    12207             DESCRIPTION:  Cleans up PUT & GET much like disconnect does
     1070    12208        */
     1071    12209    1   KQP$RECOVER: ENTRY(PAR) ALTRET; /* !!Doesn't ALTRET!! */

  12209  1 003215   000000 700200 xent  KQP$RECOVER  TSX0  ! X66_AUTO_2
         1 003216   000120 000002                    ZERO    80,2

     1072    12210        /**/
     1073    12211    1         STA$=ADDR(PAR);

  12211  1 003217   200003 236100                    LDQ     @PAR,,AUTO
         1 003220   200005 756100                    STQ     STA$,,AUTO

     1074    12212    1         STA$->KQ$STA.MREQ=0;

  12212  1 003221   200005 470500                    LDP0    STA$,,AUTO
         1 003222   000000 236003                    LDQ     0,DU
         1 003223   000020 552120                    STBQ    16,'20'O,PR0

     1075    12213    1         CG$=STA$->KQ$STA.CG$;

  12213  1 003224   000007 236100                    LDQ     7,,PR0
         1 003225   200007 756100                    STQ     CG$,,AUTO

     1076    12214    1         MBLK$=STA$->KQ$STA.MBLK$;

  12214  1 003226   000012 236100                    LDQ     10,,PR0
         1 003227   200006 756100                    STQ     MBLK$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:150  

     1077    12215    1         IF MBLK$ ~= ADDR(NIL) THEN

  12215  1 003230   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003231   003240 600000 1                  TZE     s:12221

     1078    12216    2           DO;

     1079    12217    2           STA$->KQ$STA.VGOT$=ADDR(NIL);

  12217  1 003232   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003233   000025 756100                    STQ     21,,PR0

     1080    12218    2           CALL FINDMTYP;

  12218  1 003234   003514 701000 1                  TSX1    FINDMTYP
         1 003235   000000 011000                    NOP     0

     1081    12219    2           CALL DUMPMSG;

  12219  1 003236   003440 701000 1                  TSX1    DUMPMSG
         1 003237   000000 011000                    NOP     0

     1082    12220    2           END;

     1083    12221    1         CALL KQG$RECOVER (STA$->KQ$STA);

  12221  1 003240   200005 630500                    EPPR0   STA$,,AUTO
         1 003241   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003242   000000 701000 xent               TSX1    KQG$RECOVER
         1 003243   000000 011000                    NOP     0

     1084    12222    1         RETURN;

  12222  1 003244   000000 702200 xent               TSX2  ! X66_ARET

     1085    12223        %EJECT;
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:151  
     1086    12224        /**/
     1087    12225        /*********************************************************************************
     1088    12226        *                                                                                *
     1089    12227        *   SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS    *
     1090    12228        *  S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S   *
     1091    12229        *  S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S       *
     1092    12230        *   SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS    *
     1093    12231        *      S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S   *
     1094    12232        *  S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S   *
     1095    12233        *   SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS    *
     1096    12234        *                                                                                *
     1097    12235        *********************************************************************************/
     1098    12236
     1099    12237        /****************************************************************
     1100    12238        *****************************************************************/
     1101    12239        /*D* NAME:         SETUP
     1102    12240             PURPOSE:      To provide entry to this module
     1103    12241             DESCRIPTION:  Picks up the STA$ from the LDCT and ALTRETs
     1104    12242                           if it's NIL.  Else maps onto the comgroup
     1105    12243                           data, and picks up the CG context block pointer.
     1106    12244                           If IDSC in the KQ$STA is set, ALTRETs.  Else
     1107    12245                           returns.
     1108    12246                           SETUPI does the same but does not ALTRET if IDSC
     1109    12247                           is set.
     1110    12248        */
     1111    12249    1   SETUP: PROC ALTRET;

  12249  1 003245   200102 741300       SETUP        STX1  ! AUTOGATE+2,,AUTO

     1112    12250    2   DCL IDSC BIT(1) ALIGNED;
     1113    12251    2         IDSC='1'B;

  12251  1 003246   400000 236003                    LDQ     -131072,DU
         1 003247   200103 756100                    STQ     IDSC,,AUTO

     1114    12252    2         GOTO CMN;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:152  
  12252  1 003250   003253 710000 1                  TRA     CMN

     1115    12253        /**/
     1116    12254    2   SETUPI: ENTRY ALTRET;

  12254  1 003251   200102 741300       SETUPI       STX1  ! AUTOGATE+2,,AUTO

     1117    12255        /**/
     1118    12256    2         IDSC='0'B;

  12256  1 003252   200103 450100                    STZ     IDSC,,AUTO

  12256  1 003253                       CMN          null
     1119    12257    2   CMN:  ;
     1120    12258    2         STA$=NK$LDCT.STA$;

  12258  1 003253   200010 470500                    LDP0    NK$LDCTAUTO$,,AUTO
         1 003254   000012 236100                    LDQ     10,,PR0
         1 003255   200005 756100                    STQ     STA$,,AUTO

     1121    12259    2         LOCKSET=0;

  12259  1 003256   200074 450100                    STZ     LOCKSET,,AUTO

     1122    12260    2         IF STA$ = ADDR(NIL) THEN ALTRETURN;

  12260  1 003257   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003260   003262 601000 1                  TNZ     s:12261

  12260  1 003261   000000 702211                    TSX2  ! 0,X1

     1123    12261    2         CG$=NK$LDCT.CG$;

  12261  1 003262   000027 236100                    LDQ     23,,PR0
         1 003263   200007 756100                    STQ     CG$,,AUTO

     1124    12262    2         CALL KQX$LDASR (CG$->KQ$CG);
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:153  

  12262  1 003264   200007 630500                    EPPR0   CG$,,AUTO
         1 003265   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003266   000000 701000 xent               TSX1    KQX$LDASR
         1 003267   000000 011000                    NOP     0

     1125    12263    2         IF ((STA$->KQ$STA.IDSC='1'B) OR (STA$->KQ$STA.SAVIDSC='1'B))

  12263  1 003270   200005 470500                    LDP0    STA$,,AUTO
         1 003271   000020 234100                    SZN     16,,PR0
         1 003272   003276 604000 1                  TMI     s:12263+6
         1 003273   000023 236100                    LDQ     19,,PR0
         1 003274   000400 316007                    CANQ    256,DL
         1 003275   003302 600000 1                  TZE     s:12265
         1 003276   200103 234100                    SZN     IDSC,,AUTO
         1 003277   003302 605000 1                  TPL     s:12265

     1126    12264    2         AND (IDSC='1'B) THEN ALTRETURN;

  12264  1 003300   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
         1 003301   000000 702211                    TSX2  ! 0,X1

     1127    12265    2         RETURN;

  12265  1 003302   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
         1 003303   000001 702211                    TSX2  ! 1,X1

     1128    12266    2   END SETUP;
     1129    12267        /****************************************************************
     1130    12268        *****************************************************************/
     1131    12269        /*D* NAME:         CHKSTAL
     1132    12270             PURPOSE:      To find a station and lock it
     1133    12271             DESCRIPTION:  MBLK$->KQ$MBLK.DSTA is the station to find.
     1134    12272                           If it exists, then if it is connected and activated
     1135    12273                           DSTA$ is returned pointing to it, else ALTRET.
     1136    12274                           In either case the station tree is unlocked;
     1137    12275                           in the RETURN case, the station is locked.
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:154  
     1138    12276        */
     1139    12277    1   CHKSTAL: PROC ALTRET;

  12277  1 003304   200102 741300       CHKSTAL      STX1  ! AUTOGATE+2,,AUTO

     1140    12278        /**/
     1141    12279    2   DCL T$ PTR;
     1142    12280        /**/
     1143    12281              %LOCK (G=KQ$STREE.GATE);

  12282  1 003305   200007 236100                    LDQ     CG$,,AUTO
         1 003306   000075 036003                    ADLQ    61,DU
         1 003307   200110 756100                    STQ     @M$+1,,AUTO
         1 003310   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003311   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003312   000000 701000 xent               TSX1    HFC$LOCK
         1 003313   000000 011000                    NOP     0

     1144    12284    2         CALL KQB$SRCH (KQ$STREE,MBLK$->KQ$MBLK.DSTA,T$) ALTRET(NOSTA);

  12284  1 003314   200103 630500                    EPPR0   T$,,AUTO
         1 003315   200112 450500                    STP0    @M$+3,,AUTO
         1 003316   200006 236100                    LDQ     MBLK$,,AUTO
         1 003317   000011 036003                    ADLQ    9,DU
         1 003320   200111 756100                    STQ     @M$+2,,AUTO
         1 003321   200007 236100                    LDQ     CG$,,AUTO
         1 003322   000075 036003                    ADLQ    61,DU
         1 003323   200110 756100                    STQ     @M$+1,,AUTO
         1 003324   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003325   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003326   000000 701000 xent               TSX1    KQB$SRCH
         1 003327   003401 702000 1                  TSX2    NOSTA

     1145    12285    2         DSTA$=T$;

  12285  1 003330   200103 236100                    LDQ     T$,,AUTO
         1 003331   200021 756100                    STQ     DSTA$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:155  

  12285  1 003332                       CHK0         null
     1146    12286    2   CHK0: ;
     1147    12287              %LOCK (G=DSTA$->KQ$STA.GATE);

  12288  1 003332   200021 236100                    LDQ     DSTA$,,AUTO
         1 003333   000016 036003                    ADLQ    14,DU
         1 003334   200110 756100                    STQ     @M$+1,,AUTO
         1 003335   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003336   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003337   000000 701000 xent               TSX1    HFC$LOCK
         1 003340   000000 011000                    NOP     0

     1148    12290    2         IF DSTA$->KQ$STA.AUP THEN GOTO CHK1;  /* not allowed to Write to AUP */

  12290  1 003341   200021 470500                    LDP0    DSTA$,,AUTO
         1 003342   000023 236100                    LDQ     19,,PR0
         1 003343   400000 316007                    CANQ    -131072,DL
         1 003344   003360 601000 1                  TNZ     CHK1

     1149    12291    2         IF DSTA$->KQ$STA.LDCT$ ~= ADDR(NIL) THEN

  12291  1 003345   000010 236100                    LDQ     8,,PR0
         1 003346   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003347   003354 600000 1                  TZE     s:12293

     1150    12292    2          IF DSTA$->KQ$STA.LDCT$->N$LDCT.LKFLG.ACTIVE THEN GOTO CHKDUN;

  12292  1 003350   000010 471500                    LDP1    8,,PR0
         1 003351   100011 236100                    LDQ     9,,PR1
         1 003352   000040 316003                    CANQ    32,DU
         1 003353   003370 601000 1                  TNZ     CHKDUN

     1151    12293    2         IF NOT (CG$->KQ$CG.AUCTL.WAS) THEN

  12293  1 003354   200007 471500                    LDP1    CG$,,AUTO
         1 003355   100133 236100                    LDQ     91,,PR1
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:156  
         1 003356   000010 316007                    CANQ    8,DL
         1 003357   003370 601000 1                  TNZ     CHKDUN

     1152    12294    3           DO;

  12292  1 003360                       CHK1         null
     1153    12295    3   CHK1:   ;
     1154    12296                %UNLOCK (G=DSTA$->KQ$STA.GATE);

  12297  1 003360   200021 236100                    LDQ     DSTA$,,AUTO
         1 003361   000016 036003                    ADLQ    14,DU
         1 003362   200110 756100                    STQ     @M$+1,,AUTO
         1 003363   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003364   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003365   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003366   000000 011000                    NOP     0

     1155    12299    3           GOTO CHKFAIL;

  12299  1 003367   003407 710000 1                  TRA     CHKFAIL

  12293  1 003370                       CHKDUN       null
     1156    12300    3           END;
     1157    12301    2   CHKDUN:;
     1158    12302              %UNLOCK (G=KQ$STREE.GATE);

  12303  1 003370   200007 236100                    LDQ     CG$,,AUTO
         1 003371   000075 036003                    ADLQ    61,DU
         1 003372   200110 756100                    STQ     @M$+1,,AUTO
         1 003373   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003374   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003375   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003376   000000 011000                    NOP     0

     1159    12305    2         RETURN;

  12305  1 003377   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:157  
         1 003400   000001 702211                    TSX2  ! 1,X1

  12293  1 003401                       NOSTA        null
     1160    12306    2   NOSTA:;
     1161    12307    2         IF CG$->KQ$CG.AUCTL.XSTALGL = '0'B OR

  12307  1 003401   200007 470500                    LDP0    CG$,,AUTO
         1 003402   000133 236100                    LDQ     91,,PR0
         1 003403   000020 316007                    CANQ    16,DL
         1 003404   003407 600000 1                  TZE     CHKFAIL
         1 003405   000010 316007                    CANQ    8,DL
         1 003406   003420 601000 1                  TNZ     s:12316

     1162    12308    2         NOT (CG$->KQ$CG.AUCTL.WAS) THEN
     1163    12309    3           DO;

  12299  1 003407                       CHKFAIL      null
     1164    12310    3   CHKFAIL:;
     1165    12311                %UNLOCK (G=KQ$STREE.GATE);

  12312  1 003407   200007 236100                    LDQ     CG$,,AUTO
         1 003410   000075 036003                    ADLQ    61,DU
         1 003411   200110 756100                    STQ     @M$+1,,AUTO
         1 003412   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003413   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003414   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003415   000000 011000                    NOP     0

     1166    12314    3           ALTRETURN;

  12314  1 003416   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
         1 003417   000000 702211                    TSX2  ! 0,X1

     1167    12315    3           END;
     1168    12316    2         T$=STA$;

  12316  1 003420   200005 236100                    LDQ     STA$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:158  
         1 003421   200103 756100                    STQ     T$,,AUTO

     1169    12317    2         CALL KQT$GETSTA (CG$->KQ$CG,T$,MBLK$->KQ$MBLK.DSTA) ALTRET(CHKFAIL);

  12317  1 003422   200006 236100                    LDQ     MBLK$,,AUTO
         1 003423   000011 036003                    ADLQ    9,DU
         1 003424   200112 756100                    STQ     @M$+3,,AUTO
         1 003425   200103 631500                    EPPR1   T$,,AUTO
         1 003426   200111 451500                    STP1    @M$+2,,AUTO
         1 003427   200007 236100                    LDQ     CG$,,AUTO
         1 003430   200110 756100                    STQ     @M$+1,,AUTO
         1 003431   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003432   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003433   000000 701000 xent               TSX1    KQT$GETSTA
         1 003434   003407 702000 1                  TSX2    CHKFAIL

     1170    12318    2         DSTA$=T$;

  12318  1 003435   200103 236100                    LDQ     T$,,AUTO
         1 003436   200021 756100                    STQ     DSTA$,,AUTO

     1171    12319    2         GOTO CHK0;

  12319  1 003437   003332 710000 1                  TRA     CHK0

     1172    12320    2   END CHKSTAL;
     1173    12321        /****************************************************************
     1174    12322        *****************************************************************/
     1175    12323        /*D* NAME:         DUMPMSG
     1176    12324             PURPOSE:      To get rid of the current PUT
     1177    12325             DESCRIPTION:  The DBLK is VRELed if it was VGETed, and
     1178    12326                           unlocked if it exists.  Then the message
     1179    12327                          is deleted via KQU$DELETE.  The number of writes
     1180    12328                          is then decremented.
     1181    12329        */
     1182    12330    1   DUMPMSG: PROC;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:159  
  12330  1 003440   200102 741300       DUMPMSG      STX1  ! AUTOGATE+2,,AUTO

     1183    12331        /**/
     1184    12332    2         MBLK$=STA$->KQ$STA.MBLK$;

  12332  1 003441   200005 470500                    LDP0    STA$,,AUTO
         1 003442   000012 236100                    LDQ     10,,PR0
         1 003443   200006 756100                    STQ     MBLK$,,AUTO

     1185    12333    2         IF MBLK$->KQ$MBLK.DBLK$ ~= ADDR(NIL) THEN

  12333  1 003444   200006 471500                    LDP1    MBLK$,,AUTO
         1 003445   100000 236100                    LDQ     0,,PR1
         1 003446   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003447   003457 600000 1                  TZE     s:12335

     1186    12334    2          CALL KQD$UNLOCK (CG$->KQ$CG,MBLK$->KQ$MBLK.DBLK$);

  12334  1 003450   200006 236100                    LDQ     MBLK$,,AUTO
         1 003451   200007 235100                    LDA     CG$,,AUTO
         1 003452   200110 757100                    STAQ    @M$+1,,AUTO
         1 003453   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003454   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003455   000000 701000 xent               TSX1    KQD$UNLOCK
         1 003456   000000 011000                    NOP     0

     1187    12335    2         IF STA$->KQ$STA.VGOT$ ~= ADDR(NIL) THEN

  12335  1 003457   200005 470500                    LDP0    STA$,,AUTO
         1 003460   000025 236100                    LDQ     21,,PR0
         1 003461   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003462   003473 600000 1                  TZE     s:12336+8

     1188    12336    2          CALL MMS$VREL (%B_CWSQ1,STA$->KQ$STA.VGOT$);

  12336  1 003463   200005 236100                    LDQ     STA$,,AUTO
         1 003464   000025 036003                    ADLQ    21,DU
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:160  
         1 003465   000011 235000 2                  LDA     9
         1 003466   200110 757100                    STAQ    @M$+1,,AUTO
         1 003467   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003470   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003471   000000 701000 xent               TSX1    MMS$VREL
         1 003472   000000 011000                    NOP     0
         1 003473   003475 710000 1                  TRA     s:12338

     1189    12337    2   DUMPMSG1: ENTRY;

  12337  1 003474   200102 741300       DUMPMSG1     STX1  ! AUTOGATE+2,,AUTO

     1190    12338    2         CALL KQU$DELETE (STA$->KQ$STA);

  12338  1 003475   200005 630500                    EPPR0   STA$,,AUTO
         1 003476   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003477   000000 701000 xent               TSX1    KQU$DELETE
         1 003500   000000 011000                    NOP     0

     1191    12339    2         IF (MTYP$ ~= ADDR(NIL)) AND (MTYP$ ~= ADDR(KQ_IMTYP)) THEN

  12339  1 003501   200015 236100                    LDQ     MTYP$,,AUTO
         1 003502   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003503   003512 600000 1                  TZE     s:12341
         1 003504   000004 236000 2                  LDQ     4
         1 003505   200015 116100                    CMPQ    MTYP$,,AUTO
         1 003506   003512 600000 1                  TZE     s:12341

     1192    12340    2          MTYP$->KQ$MTYP.NUMWRITES = MTYP$->KQ$MTYP.NUMWRITES - 1;

  12340  1 003507   200015 470500                    LDP0    MTYP$,,AUTO
         1 003510   000001 336007                    LCQ     1,DL
         1 003511   000010 056100                    ASQ     8,,PR0

     1193    12341    2         RETURN;

  12341  1 003512   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:161  
         1 003513   000001 702211                    TSX2  ! 1,X1

     1194    12342    2   END DUMPMSG;
     1195    12343        /****************************************************************
     1196    12344        *****************************************************************/
     1197    12345        /*D* NAME:         FINDMTYP
     1198    12346             PURPOSE:      To Find the MTYP in the TTREE
     1199    12347             DESCRIPTION:  Depending on QISS it send the correct key
     1200    12348                           to KQB$SRCH to set MTYP.  If it ALTRETs
     1201    12349                           MTYP will be set to ADDR(NIL).
     1202    12350        */
     1203    12351    1   FINDMTYP: PROC;

  12351  1 003514   200102 741300       FINDMTYP     STX1  ! AUTOGATE+2,,AUTO

     1204    12352        /**/
     1205    12353             %LOCK (G=KQ$TTREE.GATE) ;

  12354  1 003515   200007 236100                    LDQ     CG$,,AUTO
         1 003516   000067 036003                    ADLQ    55,DU
         1 003517   200110 756100                    STQ     @M$+1,,AUTO
         1 003520   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003521   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003522   000000 701000 xent               TSX1    HFC$LOCK
         1 003523   000000 011000                    NOP     0

     1206    12356    2         IF CG$->KQ$CG.QISS

  12356  1 003524   200007 470500                    LDP0    CG$,,AUTO
         1 003525   000106 235100                    LDA     70,,PR0
         1 003526   003544 600000 1                  TZE     s:12358

     1207    12357    2         THEN CALL KQB$SRCH (KQ$TTREE, MBLK$->KQ$MBLK.KEY2, MTYP$) ALTRET(NTYP);

  12357  1 003527   200015 631500                    EPPR1   MTYP$,,AUTO
         1 003530   200112 451500                    STP1    @M$+3,,AUTO
         1 003531   200006 236100                    LDQ     MBLK$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:162  
         1 003532   000004 036003                    ADLQ    4,DU
         1 003533   200111 756100                    STQ     @M$+2,,AUTO
         1 003534   200007 236100                    LDQ     CG$,,AUTO
         1 003535   000067 036003                    ADLQ    55,DU
         1 003536   200110 756100                    STQ     @M$+1,,AUTO
         1 003537   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003540   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003541   000000 701000 xent               TSX1    KQB$SRCH
         1 003542   003561 702000 1                  TSX2    NTYP
         1 003543   003560 710000 1                  TRA     s:12359

     1208    12358    2         ELSE CALL KQB$SRCH (KQ$TTREE, MBLK$->KQ$MBLK.KEY1, MTYP$) ALTRET(NTYP);

  12358  1 003544   200015 631500                    EPPR1   MTYP$,,AUTO
         1 003545   200112 451500                    STP1    @M$+3,,AUTO
         1 003546   200006 236100                    LDQ     MBLK$,,AUTO
         1 003547   000002 036003                    ADLQ    2,DU
         1 003550   200111 756100                    STQ     @M$+2,,AUTO
         1 003551   200007 236100                    LDQ     CG$,,AUTO
         1 003552   000067 036003                    ADLQ    55,DU
         1 003553   200110 756100                    STQ     @M$+1,,AUTO
         1 003554   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003555   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003556   000000 701000 xent               TSX1    KQB$SRCH
         1 003557   003561 702000 1                  TSX2    NTYP

     1209    12359    3           DO WHILE ('0'B) ;

  12359  1 003560   003563 710000 1                  TRA     s:12364

     1210    12360    3   NTYP:   MTYP$ = ADDR(NIL);

  12360  1 003561   000001 236000 xsym  NTYP         LDQ     B_VECTNIL+1
         1 003562   200015 756100                    STQ     MTYP$,,AUTO

     1211    12361    3           END;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:163  
     1212    12362
     1213    12363              %UNLOCK (G=KQ$TTREE.GATE) ;

  12364  1 003563   200007 236100                    LDQ     CG$,,AUTO
         1 003564   000067 036003                    ADLQ    55,DU
         1 003565   200110 756100                    STQ     @M$+1,,AUTO
         1 003566   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003567   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003570   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003571   000000 011000                    NOP     0

     1214    12366
     1215    12367    2         RETURN;

  12367  1 003572   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
         1 003573   000001 702211                    TSX2  ! 1,X1

     1216    12368    2   END FINDMTYP;
     1217    12369        /****************************************************************
     1218    12370        *****************************************************************/
     1219    12371        /*D* NAME:         XFERD
     1220    12372             PURPOSE:      To transfer a write into the reader's buffer
     1221    12373             DESCRIPTION:  Enter with DSTA$ pointing to the reader's KQ$STA,
     1222    12374                           and with its gate locked.  RBLK$ points to the
     1223    12375                           reader's read, MBLK$ points to the writer's write.
     1224    12376                           K$RWPARM.MSG$ is the buffer.
     1225    12377
     1226    12378                           If the reader's buffer is too short, returns with
     1227    12379                           everything unlocked, else ALTRETs
     1228    12380                           with the data transfered, the read COMPed.
     1229    12381
     1230    12382                           Used only if the data is being xferred directly
     1231    12383                           from the writer's buffer.
     1232    12384        */
     1233    12385    1   XFERD: PROC ALTRET;

  12385  1 003574   200102 741300       XFERD        STX1  ! AUTOGATE+2,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:164  

     1234    12386        /**/
     1235    12387    2   DCL QLOCK UBIN;
     1236    12388    2   DCL RRQ$ PTR;
     1237    12389        /**/
     1238    12390    2         QLOCK=0;

  12390  1 003575   200103 450100                    STZ     QLOCK,,AUTO

     1239    12391    2         GOTO XFER;

  12391  1 003576   003602 710000 1                  TRA     XFER

     1240    12392        /*D* NAME:         XFERQ
     1241    12393             PURPOSE:      To transfer a write into the reader's buffer
     1242    12394             DESCRIPTION:  Same as XFERD but the read was found in the
     1243    12395                           queue.  P$ points to the link word which must
     1244    12396                           be set to the RBLK's link if we complete the
     1245    12397                           xfer (this removes the read from the queue).
     1246    12398                           Also, this routine is entered with the queue
     1247    12399                           locked.
     1248    12400        */
     1249    12401    2   XFERQ: ENTRY ALTRET;

  12401  1 003577   200102 741300       XFERQ        STX1  ! AUTOGATE+2,,AUTO

     1250    12402    2         QLOCK=1;

  12402  1 003600   000001 235007                    LDA     1,DL
         1 003601   200103 755100                    STA     QLOCK,,AUTO

  12402  1 003602                       XFER         null
     1251    12403    2   XFER: ;
     1252    12404    2         RRQ$=DSTA$->KQ$STA.LDCT$->N$LDCT.IOQ$;

  12404  1 003602   200021 470500                    LDP0    DSTA$,,AUTO
         1 003603   000010 471500                    LDP1    8,,PR0
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:165  
         1 003604   100001 236100                    LDQ     1,,PR1
         1 003605   200104 756100                    STQ     RRQ$,,AUTO

     1253    12405    2         RRQ$->N$REQ.TYC='0'B;

  12405  1 003606   200104 473500                    LDP3    RRQ$,,AUTO
         1 003607   300021 450100                    STZ     17,,PR3

     1254    12406    2         I=MBLK$->KQ$MBLK.MSGSIZE;

  12406  1 003610   200006 471500                    LDP1    MBLK$,,AUTO
         1 003611   100016 235100                    LDA     14,,PR1
         1 003612   200012 755100                    STA     I,,AUTO

     1255    12407    2         IF I > RBLK$->KQ$RBLKD.BUFSIZE THEN

  12407  1 003613   200020 474500                    LDP4    RBLK$,,AUTO
         1 003614   400016 236100                    LDQ     14,,PR4
         1 003615   200012 116100                    CMPQ    I,,AUTO
         1 003616   003641 603000 1                  TRC     s:12421

     1256    12408    3           DO;

     1257    12409                %UNLOCK (G=DSTA$->KQ$STA.GATE);

  12410  1 003617   200021 236100                    LDQ     DSTA$,,AUTO
         1 003620   000016 036003                    ADLQ    14,DU
         1 003621   200110 756100                    STQ     @M$+1,,AUTO
         1 003622   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003623   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003624   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003625   000000 011000                    NOP     0

     1258    12412    3           IF QLOCK ~= 0 THEN

  12412  1 003626   200103 235100                    LDA     QLOCK,,AUTO
         1 003627   003637 600000 1                  TZE     s:12418
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:166  

     1259    12413    4             DO;

     1260    12414                  %UNLOCK (G=KQ$QTREE.GATE);

  12415  1 003630   200007 470500                    LDP0    CG$,,AUTO
         1 003631   000057 471500                    LDP1    47,,PR0
         1 003632   200110 451500                    STP1    @M$+1,,AUTO
         1 003633   200110 630500                    EPPR0   @M$+1,,AUTO
         1 003634   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003635   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003636   000000 011000                    NOP     0

     1261    12417    4             END;

     1262    12418    3           RETURN;

  12418  1 003637   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
         1 003640   000001 702211                    TSX2  ! 1,X1

     1263    12419    3           END;
     1264    12420              %LOCK (G=KQ_XFGATE);

  12421  1 003641   000031 630400 2                  EPPR0   25
         1 003642   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003643   000000 701000 xent               TSX1    HFC$LOCK
         1 003644   000000 011000                    NOP     0

     1265    12423    2         B$CGPT$->B$$XFPTW=RBLK$->KQ$RBLKD.PTW;

  12423  1 003645   200020 470500                    LDP0    RBLK$,,AUTO
         1 003646   000014 237100                    LDAQ    12,,PR0
         1 003647   000000 471400 xsym               LDP1    B$CGPT$
         1 003650   100000 757100                    STAQ    0,,PR1

     1266    12424    2         CALL HFC$ASSOCCLR(%CGWSQ,0,2);

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:167  
  12424  1 003651   000033 630400 2                  EPPR0   27
         1 003652   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003653   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 003654   000000 011000                    NOP     0

     1267    12425    2         IF K$RWPARM.DVE.DVBYTE.VFC

  12425  1 003655   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 003656   000010 236100                    LDQ     8,,PR0
         1 003657   100000 316003                    CANQ    32768,DU
         1 003660   003712 600000 1                  TZE     s:12435

     1268    12426    3         THEN DO;

     1269    12427    3           BUF$ = RBLK$->KQ$RBLKD.BUF$;

  12427  1 003661   200020 471500                    LDP1    RBLK$,,AUTO
         1 003662   100013 236100                    LDQ     11,,PR1
         1 003663   200076 756100                    STQ     BUF$,,AUTO

     1270    12428    3           I = 1;

  12428  1 003664   000001 235007                    LDA     1,DL
         1 003665   200012 755100                    STA     I,,AUTO

     1271    12429    3           BUF$->B$$CHARS = K$RWPARM.DVE.VFC;

  12429  1 003666   200076 473500                    LDP3    BUF$,,AUTO
         1 003667   000000 620005                    EAX0    0,AL
         1 003670   040140 100500                    MLR     fill='040'O
         1 003671   000010 200001                    ADSC9   8,,PR0                   cn=1,n=1
         1 003672   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

     1272    12430    3           BUF$ = PINCRC(BUF$,1);

  12430  1 003673   200076 236100                    LDQ     BUF$,,AUTO
         1 003674   200000 036007                    ADLQ    65536,DL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:168  
         1 003675   200076 756100                    STQ     BUF$,,AUTO

     1273    12431    3           I = MBLK$->KQ$MBLK.MSGSIZE - 1;

  12431  1 003676   200006 471500                    LDP1    MBLK$,,AUTO
         1 003677   100016 235100                    LDA     14,,PR1
         1 003700   000001 135007                    SBLA    1,DL
         1 003701   200012 755100                    STA     I,,AUTO

     1274    12432    3           BUF$->B$$CHARS = K$RWPARM.MSG$->B$$CHARS;

  12432  1 003702   000000 473500                    LDP3    0,,PR0
         1 003703   000000 620005                    EAX0    0,AL
         1 003704   200076 474500                    LDP4    BUF$,,AUTO
         1 003705   200012 721100                    LXL1    I,,AUTO
         1 003706   040140 100540                    MLR     fill='040'O
         1 003707   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         1 003710   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

     1275    12433    3           END;

  12433  1 003711   003721 710000 1                  TRA     s:12436

     1276    12434    2         ELSE
     1277    12435    2          RBLK$->KQ$RBLKD.BUF$->B$$CHARS=K$RWPARM.MSG$->B$$CHARS;

  12435  1 003712   200020 471500                    LDP1    RBLK$,,AUTO
         1 003713   100013 473500                    LDP3    11,,PR1
         1 003714   000000 474500                    LDP4    0,,PR0
         1 003715   200012 720100                    LXL0    I,,AUTO
         1 003716   040140 100540                    MLR     fill='040'O
         1 003717   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
         1 003720   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

     1278    12436    2         B$CGPT$->B$$XFPTW='0'B;

  12436  1 003721   000000 235003                    LDA     0,DU
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:169  
         1 003722   000000 236003                    LDQ     0,DU
         1 003723   000000 471400 xsym               LDP1    B$CGPT$
         1 003724   100000 757100                    STAQ    0,,PR1

     1279    12437    2         CALL HFC$ASSOCCLR(%CGWSQ,0,2);

  12437  1 003725   000033 630400 2                  EPPR0   27
         1 003726   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003727   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 003730   000000 011000                    NOP     0

     1280    12438              %UNLOCK (G=KQ_XFGATE);

  12439  1 003731   000031 630400 2                  EPPR0   25
         1 003732   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003733   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003734   000000 011000                    NOP     0

     1281    12441    2         RRQ$->N$REQ.ARSIZE=MBLK$->KQ$MBLK.MSGSIZE;

  12441  1 003735   200006 470500                    LDP0    MBLK$,,AUTO
         1 003736   200104 471500                    LDP1    RRQ$,,AUTO
         1 003737   000016 236100                    LDQ     14,,PR0
         1 003740   000020 736000                    QLS     16
         1 003741   100027 676100                    ERQ     23,,PR1
         1 003742   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 003743   100027 656100                    ERSQ    23,,PR1

     1282    12442    2         IF QLOCK ~= 0 THEN

  12442  1 003744   200103 235100                    LDA     QLOCK,,AUTO
         1 003745   003754 600000 1                  TZE     s:12445

     1283    12443    2          CALL MOVMCQ (STA$->KQ$STA.MBLK$);

  12443  1 003746   200005 236100                    LDQ     STA$,,AUTO
         1 003747   000012 036003                    ADLQ    10,DU
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:170  
         1 003750   200107 756100                    STQ     RRQ$+3,,AUTO
         1 003751   003775 701000 1                  TSX1    MOVMCQ
         1 003752   000000 011000                    NOP     0
         1 003753   003761 710000 1                  TRA     s:12446

     1284    12444    2         ELSE
     1285    12445    2          CALL MOVMC (STA$->KQ$STA.MBLK$);

  12445  1 003754   200005 236100                    LDQ     STA$,,AUTO
         1 003755   000012 036003                    ADLQ    10,DU
         1 003756   200107 756100                    STQ     RRQ$+3,,AUTO
         1 003757   004073 701000 1                  TSX1    MOVMC
         1 003760   000000 011000                    NOP     0

     1286    12446    2         K$RWPARM.MSGID=MBLK$->KQ$MBLK.MID.PRIMARY;

  12446  1 003761   200006 470500                    LDP0    MBLK$,,AUTO
         1 003762   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 003763   000014 235100                    LDA     12,,PR0
         1 003764   100011 755100                    STA     9,,PR1

     1287    12447    2         K$RWPARM.MSGIDXT=BINBIT(MBLK$->KQ$MBLK.MID.XT,36);

  12447  1 003765   000015 236100                    LDQ     13,,PR0
         1 003766   100012 756100                    STQ     10,,PR1

     1288    12448    2         CALL KQR$COMP (RRQ$->N$REQ);

  12448  1 003767   200104 630500                    EPPR0   RRQ$,,AUTO
         1 003770   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003771   000000 701000 xent               TSX1    KQR$COMP
         1 003772   000000 011000                    NOP     0

     1289    12449    2         ALTRETURN;

  12449  1 003773   200102 221300                    LDX1  ! AUTOGATE+2,,AUTO
         1 003774   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:171  

     1290    12450        /**/
     1291    12451        /*D* NAME:         MOVMCQ
     1292    12452             PURPOSE:      To move a msg
     1293    12453                           to a reading station.
     1294    12454             DESCRIPTION:  DSTA$ is the destination
     1295    12455                           (the reader).  RBLK$ is the reading RBLK,
     1296    12456                           M$ is the pointer to the MBLK.
     1297    12457
     1298    12458                           The MBLK is moved to be pointed to by the
     1299    12459                           RBLK.  M$ is set to point to the MBLK's old link.
     1300    12460                           The RBLK's state is set to KQRS_XFDN#.
     1301    12461
     1302    12462                           The reader's station is locked, and it is
     1303    12463                           unlocked after we're done.  All this is done
     1304    12464                           inhibited to prevent losing the MBLK during a
     1305    12465                           crash (i.e. if another CPU screeches, it's
     1306    12466                           interrupt won't jerk us out).
     1307    12467
     1308    12468                           The RBLK was originally found in the queue, and
     1309    12469                           P$ points the link which must be set to the
     1310    12470                           RBLK's link in order to remove it from the
     1311    12471                           queue.  The queue is unlocked after we're all
     1312    12472                           done.  The RBLK does not specify LATCH.
     1313    12473        */
     1314    12474    2   MOVMCQ: PROC (M$);

  12474  1 003775   200106 741300       MOVMCQ       STX1  ! RRQ$+2,,AUTO

     1315    12475        /**/
     1316    12476    3   DCL M$ PTR;
     1317    12477        /**/
     1318    12478    4           DO INHIBIT;

     1319    12479    4           P$->B$$PTR=RBLK$->KQ$RBLKD.QRLNK$;

  12479  1 003776   200020 470700                    LDP0  ! RBLK$,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:172  
         1 003777   000020 236300                    LDQ   ! 16,,PR0
         1 004000   200075 471700                    LDP1  ! P$,,AUTO
         1 004001   100000 756300                    STQ   ! 0,,PR1

     1320    12480    4           RBLK$->KQ$RBLKD.QRLNK$=ADDR(NIL); /* alias LWRITES$ */

  12480  1 004002   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 004003   200020 470700                    LDP0  ! RBLK$,,AUTO
         1 004004   000020 756300                    STQ   ! 16,,PR0

     1321    12481    4           MBLK$=M$;

  12481  1 004005   200107 470700                    LDP0  ! @M$,,AUTO
         1 004006   000000 236300                    LDQ   ! 0,,PR0
         1 004007   200006 756300                    STQ   ! MBLK$,,AUTO

     1322    12482    4           M$=MBLK$->KQ$MBLK.LNK$;

  12482  1 004010   200006 471700                    LDP1  ! MBLK$,,AUTO
         1 004011   100000 236300                    LDQ   ! 0,,PR1
         1 004012   000000 756300                    STQ   ! 0,,PR0

     1323    12483    4           IF RBLK$->KQ$RBLK.MBLK$~=ADDR(NIL) THEN

  12483  1 004013   200020 471700                    LDP1  ! RBLK$,,AUTO
         1 004014   100000 236300                    LDQ   ! 0,,PR1
         1 004015   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 004016   004022 600200 1                  TZE   ! s:12485

     1324    12484    4            RBLK$->KQ$RBLK.MBLK$->KQ$MBLK.RBLK = '0'B;

  12484  1 004017   100000 473700                    LDP3  ! 0,,PR1
         1 004020   000036 236200 2                  LDQ   ! 30
         1 004021   300010 356300                    ANSQ  ! 8,,PR3

     1325    12485    4           RBLK$->KQ$RBLK.MBLK$=MBLK$;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:173  
  12485  1 004022   200006 236300                    LDQ   ! MBLK$,,AUTO
         1 004023   200020 471700                    LDP1  ! RBLK$,,AUTO
         1 004024   100000 756300                    STQ   ! 0,,PR1

     1326    12486    4           MBLK$->KQ$MBLK.RBLK = '1'B;

  12486  1 004025   200006 471700                    LDP1  ! MBLK$,,AUTO
         1 004026   000100 236207                    LDQ   ! 64,DL
         1 004027   100010 256300                    ORSQ  ! 8,,PR1

     1327    12487    4           MBLK$->KQ$MBLK.LNK$=ADDR(NIL);

  12487  1 004030   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 004031   100000 756300                    STQ   ! 0,,PR1

     1328    12488    4           RBLK$->KQ$RBLK.STATE=KQRS_XFDN#;

  12488  1 004032   000005 220203                    LDX0  ! 5,DU
         1 004033   200020 471700                    LDP1  ! RBLK$,,AUTO
         1 004034   100001 740300                    STX0  ! 1,,PR1

     1329    12489                %UNLOCK (G=DSTA$->KQ$STA.GATE);

  12490  1 004035   200021 236300                    LDQ   ! DSTA$,,AUTO
         1 004036   000016 036203                    ADLQ  ! 14,DU
         1 004037   200110 756300                    STQ   ! @M$+1,,AUTO
         1 004040   200110 630700                    EPPR0 ! @M$+1,,AUTO
         1 004041   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 004042   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 004043   000000 011200                    NOP   ! 0

     1330    12492                %UNLOCK (G=KQ$QTREE.GATE);

  12493  1 004044   200007 470700                    LDP0  ! CG$,,AUTO
         1 004045   000057 471700                    LDP1  ! 47,,PR0
         1 004046   200110 451700                    STP1  ! @M$+1,,AUTO
         1 004047   200110 630700                    EPPR0 ! @M$+1,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:174  
         1 004050   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 004051   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 004052   000000 011200                    NOP   ! 0

     1331    12495    4           IF RBLK$->KQ$RBLKD.EOFTIME~=0 THEN

  12495  1 004053   200020 470700                    LDP0  ! RBLK$,,AUTO
         1 004054   000017 720300                    LXL0  ! 15,,PR0
         1 004055   004066 600200 1                  TZE   ! s:12497

     1332    12496    4            CALL KQQ$DQEOFTIME(KQ$CG,RBLK$);

  12496  1 004056   200020 631700                    EPPR1 ! RBLK$,,AUTO
         1 004057   200111 451700                    STP1  ! @M$+2,,AUTO
         1 004060   200007 236300                    LDQ   ! CG$,,AUTO
         1 004061   200110 756300                    STQ   ! @M$+1,,AUTO
         1 004062   200110 630700                    EPPR0 ! @M$+1,,AUTO
         1 004063   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 004064   000000 701200 xent               TSX1  ! KQQ$DQEOFTIME
         1 004065   000000 011200                    NOP   ! 0

     1333    12497    4           RBLK$->KQ$RBLK.NCDDA=0;

  12497  1 004066   200020 470700                    LDP0  ! RBLK$,,AUTO
         1 004067   000011 450300                    STZ   ! 9,,PR0

     1334    12498    4           RETURN;

  12498  1 004070   200106 221300                    LDX1  ! RRQ$+2,,AUTO
         1 004071   000001 702211                    TSX2  ! 1,X1

     1335    12499    4           END;

     1336    12500    3   END MOVMCQ;

  12500  1 004072   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:175  
     1337    12501        /**/
     1338    12502        /*D* NAME:         MOVMC
     1339    12503             PURPOSE:      To move a message from the writing station
     1340    12504                           to a reading station.
     1341    12505             DESCRIPTION:  Just like MOVMCQ except the read was not found
     1342    12506                           in the queue, so we must call DEQUEUE to remove
     1343    12507                           it if it was.  This means unlocking the reading station
     1344    12508                           first, since the queue isn't already locked, and
     1345    12509                           one CANNOT lock a station and then the queue
     1346    12510                           (because we sometimes do the opposite).
     1347    12511        */
     1348    12512    2   MOVMC: PROC (M$);

  12512  1 004073   200106 741300       MOVMC        STX1  ! RRQ$+2,,AUTO

     1349    12513        /**/
     1350    12514    3   DCL M$ PTR;
     1351    12515        /**/
     1352    12516    4           DO INHIBIT;

     1353    12517    4           MBLK$=M$;

  12517  1 004074   200107 470700                    LDP0  ! @M$,,AUTO
         1 004075   000000 236300                    LDQ   ! 0,,PR0
         1 004076   200006 756300                    STQ   ! MBLK$,,AUTO

     1354    12518    4           M$=MBLK$->KQ$MBLK.LNK$;

  12518  1 004077   200006 471700                    LDP1  ! MBLK$,,AUTO
         1 004100   100000 236300                    LDQ   ! 0,,PR1
         1 004101   000000 756300                    STQ   ! 0,,PR0

     1355    12519    4           IF RBLK$->KQ$RBLK.MBLK$~=ADDR(NIL) THEN

  12519  1 004102   200020 471700                    LDP1  ! RBLK$,,AUTO
         1 004103   100000 236300                    LDQ   ! 0,,PR1
         1 004104   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:176  
         1 004105   004111 600200 1                  TZE   ! s:12521

     1356    12520    4            RBLK$->KQ$RBLK.MBLK$->KQ$MBLK.RBLK = '0'B;

  12520  1 004106   100000 473700                    LDP3  ! 0,,PR1
         1 004107   000036 236200 2                  LDQ   ! 30
         1 004110   300010 356300                    ANSQ  ! 8,,PR3

     1357    12521    4           RBLK$->KQ$RBLK.MBLK$=MBLK$;

  12521  1 004111   200006 236300                    LDQ   ! MBLK$,,AUTO
         1 004112   200020 471700                    LDP1  ! RBLK$,,AUTO
         1 004113   100000 756300                    STQ   ! 0,,PR1

     1358    12522    4           MBLK$->KQ$MBLK.RBLK = '1'B;

  12522  1 004114   200006 471700                    LDP1  ! MBLK$,,AUTO
         1 004115   000100 236207                    LDQ   ! 64,DL
         1 004116   100010 256300                    ORSQ  ! 8,,PR1

     1359    12523    4           MBLK$->KQ$MBLK.LNK$=ADDR(NIL);

  12523  1 004117   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 004120   100000 756300                    STQ   ! 0,,PR1

     1360    12524    4           RBLK$->KQ$RBLK.STATE=KQRS_XFDN#;

  12524  1 004121   000005 220203                    LDX0  ! 5,DU
         1 004122   200020 471700                    LDP1  ! RBLK$,,AUTO
         1 004123   100001 740300                    STX0  ! 1,,PR1

     1361    12525    4           IF RBLK$->KQ$RBLKD.STA$ ~= ADDR(NIL) THEN

  12525  1 004124   200020 471700                    LDP1  ! RBLK$,,AUTO
         1 004125   100012 236300                    LDQ   ! 10,,PR1
         1 004126   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 004127   004165 600200 1                  TZE   ! s:12537
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:177  

     1362    12526    5             DO;

     1363    12527                  %UNLOCK (G=DSTA$->KQ$STA.GATE);

  12528  1 004130   200021 236300                    LDQ   ! DSTA$,,AUTO
         1 004131   000016 036203                    ADLQ  ! 14,DU
         1 004132   200110 756300                    STQ   ! @M$+1,,AUTO
         1 004133   200110 630700                    EPPR0 ! @M$+1,,AUTO
         1 004134   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 004135   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 004136   000000 011200                    NOP   ! 0

     1364    12530    5             CALL KQQ$DEQUEUE (CG$->KQ$CG,RBLK$);

  12530  1 004137   200020 630700                    EPPR0 ! RBLK$,,AUTO
         1 004140   200111 450700                    STP0  ! @M$+2,,AUTO
         1 004141   200007 236300                    LDQ   ! CG$,,AUTO
         1 004142   200110 756300                    STQ   ! @M$+1,,AUTO
         1 004143   200110 630700                    EPPR0 ! @M$+1,,AUTO
         1 004144   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 004145   000000 701200 xent               TSX1  ! KQQ$DEQUEUE
         1 004146   000000 011200                    NOP   ! 0

     1365    12531    5             IF RBLK$->KQ$RBLKD.EOFTIME~=0 THEN

  12531  1 004147   200020 470700                    LDP0  ! RBLK$,,AUTO
         1 004150   000017 720300                    LXL0  ! 15,,PR0
         1 004151   004162 600200 1                  TZE   ! s:12533

     1366    12532    5              CALL KQQ$DQEOFTIME(KQ$CG,RBLK$);

  12532  1 004152   200020 631700                    EPPR1 ! RBLK$,,AUTO
         1 004153   200111 451700                    STP1  ! @M$+2,,AUTO
         1 004154   200007 236300                    LDQ   ! CG$,,AUTO
         1 004155   200110 756300                    STQ   ! @M$+1,,AUTO
         1 004156   200110 630700                    EPPR0 ! @M$+1,,AUTO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:178  
         1 004157   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 004160   000000 701200 xent               TSX1  ! KQQ$DQEOFTIME
         1 004161   000000 011200                    NOP   ! 0

     1367    12533    5             RBLK$->KQ$RBLK.NCDDA=0;

  12533  1 004162   200020 470700                    LDP0  ! RBLK$,,AUTO
         1 004163   000011 450300                    STZ   ! 9,,PR0

     1368    12534    5             END;

  12534  1 004164   004175 710200 1                  TRA   ! s:12542

     1369    12535    4           ELSE
     1370    12536    5             DO;

     1371    12537    5             RBLK$->KQ$RBLK.NCDDA=0;

  12537  1 004165   100011 450300                    STZ   ! 9,,PR1

     1372    12538                  %UNLOCK (G=DSTA$->KQ$STA.GATE);

  12539  1 004166   200021 236300                    LDQ   ! DSTA$,,AUTO
         1 004167   000016 036203                    ADLQ  ! 14,DU
         1 004170   200110 756300                    STQ   ! @M$+1,,AUTO
         1 004171   200110 630700                    EPPR0 ! @M$+1,,AUTO
         1 004172   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 004173   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 004174   000000 011200                    NOP   ! 0

     1373    12541    5             END;

     1374    12542    4           RETURN;

  12542  1 004175   200106 221300                    LDX1  ! RRQ$+2,,AUTO
         1 004176   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:179  
     1375    12543    4           END;

     1376    12544    3   END MOVMC;

  12544  1 004177   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   0     000   052101 125105   126040 040040   002000 000000   052106 120101    *AUEV   ....*FPA
   0     004   102124 040040                                                    BT

(unnamed)
 Sect OctLoc
   2     000   077040 040040   040040 040040   040040 040040   040040 040040    ?
   2     004   000000 006000   000000 000020   000002 006000   000005 006000    ................
   2     010   000000 000015   000010 006000   777777 777760   777777 773777    ................
   2     014   000006 006000   000000 000030   000015 006000   000000 000031    ................
   2     020   000017 006000   000000 000032   000021 006000   000000 000034    ................
   2     024   000027 600000   000023 006000   000000 000044   000026 006000    ...........$....
   2     030   777777 637777   000000 006000   000000 000014   000032 006000    ................
   2     034   000002 006000   000004 006000   777777 777677                    ............
     1377    12545    2   END XFERD;
     1378    12546    1   END KQP$PUT;

PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:180  
--  Include file information  --

   NK_SUBS.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQP$PUT.
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:181  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                107-0-0/w PTR         r     1 @M$
   107-0-0/w PTR         r     1 @M$                        3-0-0/w PTR         r     1 @PAR
   100-0-0/d STRC(72)    r     1 AUTOGATE                  76-0-0/w PTR         r     1 BUF$
     7-0-0/w PTR         r     1 CG$                       11-0-0/w PTR         r     1 DBLK$
    14-0-0/w UBIN        r     1 DDA                       23-0-0/w UBIN        r     1 DOTYC
    21-0-0/w PTR         r     1 DSTA$                     12-0-0/w UBIN        r     1 I
   103-0-0/w BIT         r     1 IDSC                      13-0-0/w SBIN        r     1 J
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                  16-0-0/w UBIN(18)    r     1 KEY1L
    17-0-0/w UBIN(18)    r     1 KEY2L                     74-0-0/w UBIN        r     1 LOCKSET
    *0-0-0/w PTR         r     1 M$                        *0-0-0/w PTR         r     1 M$
     6-0-0/w PTR         r     1 MBLK$                     15-0-0/w PTR         r     1 MTYP$
    10-0-0/w PTR         r     1 NK$LDCTAUTO$              75-0-0/w PTR         r     1 P$
    *0-0-0/w PTR         r     1 PAR                      103-0-0/w UBIN        r     1 QLOCK
    22-0-0/w PTR         r     1 QTN$                      20-0-0/w PTR         r     1 RBLK$
   104-0-0/w PTR         r     1 RRQ$                      24-0-0/d STRC(1404)  r     1 RWPARM
     5-0-0/w PTR         r     1 STA$                     103-0-0/w PTR         r     1 T$
    17-0-0/w UBIN(18)    r     1 TACTCNT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$CGPT$                    0-0-0/c CHAR(68)    r     1 KC_LGL1ST
     0-0-0/w UBIN        r     1 KQ_DEBUG                   0-0-0/d STRC(360)   r     1 KQ_IMTYP
     0-0-0/b STRC        r     1 KQ_LOG                     0-0-0/w BIT (72)    r     1 KQ_XFGATE

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:182  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 B$$CHARS                   0-0-0/h UBIN(18)    r     1 B$$HALF
     0-0-0/w ACHR        r     1 B$$KEY1                    0-0-0/w ACHR        r     1 B$$KEY2
     0-0-0/h STRC(18)    r     1 B$$PRIO                    0-0-0/w PTR         r     1 B$$PTR
     0-0-0/w SBIN        r     1 B$$SBIN                    0-0-0/w UBIN        r     1 B$$WORD
     0-0-0/d STRC(72)    r     1 B$$XFPTW                   0-0-0/d STRC(6516)  r     1 KQ$CG
     0-0-0/d STRC(216)   r     1 KQ$DBLK                    0-0-0/d STRC(288)   r     1 KQ$DFRBLK
     0-0-0/w STRC(180)   r     1 KQ$DFRPARM                 0-0-0/d STRC(576)   r     1 KQ$MBLK
     0-0-0/d STRC(360)   r     1 KQ$MTYP                    0-0-0/d STRC(1908)  r     1 KQ$QTN
     0-0-0/d STRC(504)   r     1 KQ$RBLK                    0-0-0/d STRC(648)   r     1 KQ$RBLKD
     0-0-0/d STRC(1296)  r     1 KQ$STA                     0-0-0/w STRC(216)   r     1 KQ$THDR
     0-0-0/d STRC(864)   r     1 N$LDCT                     0-0-0/d STRC(1080)  r     1 N$REQ
     0-0-0/d STRC(864)   r     1 NK$LDCT                    0-0-0/d STRC(612)   r     1 VLP$FPRG


   Procedure KQP$PUT requires 2176 words for executable code.
   Procedure KQP$PUT requires 80 words of local(AUTO) storage.

    No errors detected in file KQP$PUT.:E05TSI    .
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:183  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:184  
          MINI XREF LISTING

ALTRT
     11912**LABEL   11642--GOTO    11665--GOTO    11690--GOTO
AUTOGATE
     11150**DCL     11591<>CALL    11595<>CALL    11615<>CALL
AUTOGATE.LOCK
     11151**DCL     11589<<ASSIGN
B$$CHARS
     10798**DCL     11533<<ASSIGN  11536<<ASSIGN  11536>>ASSIGN  11539<<ASSIGN  11539>>ASSIGN  11553<<ASSIGN
     12429<<ASSIGN  12432<<ASSIGN  12432>>ASSIGN  12435<<ASSIGN  12435>>ASSIGN
B$$HALF
     10801**DCL     11379<>CALL
B$$KEY1
     10803**DCL     11417>>IF      11417>>IF      11480>>IF      11480>>IF
B$$KEY2
     10804**DCL     11417>>IF      11417>>IF      11453>>IF      11453>>IF      11480>>IF      11480>>IF
B$$PRIO.HI
     10796**DCL     11355<<ASSIGN  11362<<ASSIGN
B$$PRIO.LO
     10797**DCL     11356<<ASSIGN  11363<<ASSIGN
B$$PTR
     10807**DCL     11450>>ASSIGN  11471>>ASSIGN  11476>>ASSIGN  11495>>ASSIGN  12479<<ASSIGN
B$$SBIN
     10800**DCL     12047>>ASSIGN
B$$WORD
     10799**DCL     11957<>CALL    11968<>CALL    11980<>CALL    12048<<ASSIGN
B$$XFPTW
     10805**DCL     12423<<ASSIGN  12436<<ASSIGN
B$CGPT$
     11192**DCL     12423>>ASSIGN  12436>>ASSIGN
BADMTYP
     11675**LABEL   11446--CALLALT 11670--CALLALT
BADMTYP1
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:185  
     11675**LABEL   11319--GOTO
BUF$
     11149**DCL     11531<<ASSIGN  11533>>ASSIGN  11534<<ASSIGN  11534>>ASSIGN  11536>>ASSIGN  11548<<ASSIGN
     11553>>ASSIGN  11554<<ASSIGN  11554>>ASSIGN  11557<>CALL    12427<<ASSIGN  12429>>ASSIGN  12430<<ASSIGN
     12430>>ASSIGN  12432>>ASSIGN
CDISC
     12183**LABEL   12171--GOTO
CG$
     10816**DCL      8202--IMP-PTR 11271>>CALL    11276>>CALL    11296>>ASSIGN  11296>>ASSIGN  11303>>ASSIGN
     11310>>CALL    11312>>CALL    11316>>ASSIGN  11324>>CALL    11326>>IF      11329>>CALL    11334>>ASSIGN
     11336>>CALL    11341>>CALL    11348>>IF      11350>>ASSIGN  11353>>IF      11372>>ASSIGN  11373>>ASSIGN
     11373>>ASSIGN  11379>>CALL    11381>>CALL    11400>>IF      11432>>IF      11440>>CALL    11442>>IF
     11445>>IF      11446>>CALL    11475>>ASSIGN  11499>>CALL    11511>>IF      11513>>CALL    11517>>CALL
     11640>>CALL    11667>>IF      11672>>CALL    11682>>CALL    11704>>CALL    11706>>ASSIGN  11707>>ASSIGN
     11709>>CALL    11730<<ASSIGN  11754<<ASSIGN  11790<<ASSIGN  11864>>CALL    12059>>CALL    12082>>CALL
     12084>>ASSIGN  12086>>CALL    12107<<ASSIGN  12127>>CALL    12129>>ASSIGN  12130>>ASSIGN  12132>>CALL
     12147<<ASSIGN  12161>>CALL    12163>>CALL    12165>>CALL    12183<<ASSIGN  12213<<ASSIGN  12261<<ASSIGN
     12262>>CALL    12282>>CALL    12284>>CALL    12293>>IF      12303>>CALL    12307>>IF      12307>>IF
     12312>>CALL    12317>>CALL    12334>>CALL    12354>>CALL    12356>>IF      12357>>CALL    12358>>CALL
     12364>>CALL    12415>>CALL    12493>>CALL    12496>>CALL    12530>>CALL    12532>>CALL
CHK0 IN PROCEDURE CHKSTAL
     12285**LABEL   12319--GOTO
CHK1 IN PROCEDURE CHKSTAL
     12292**LABEL   12290--GOTO
CHKDUN IN PROCEDURE CHKSTAL
     12293**LABEL   12292--GOTO
CHKFAIL IN PROCEDURE CHKSTAL
     12299**LABEL   12299--GOTO    12317--CALLALT
CHKSTAL
     12277**PROC    11408--CALL
CMN IN PROCEDURE SETUP
     12256**LABEL   12252--GOTO
DBLK$
     10818**DCL      9958--IMP-PTR 10587--IMP-PTR 10819--REDEF   11513<>CALL    11517<>CALL    11518>>ASSIGN
     11518>>ASSIGN  11519>>ASSIGN  11520>>ASSIGN  11522>>ASSIGN  11524>>ASSIGN  11531>>ASSIGN  11539>>ASSIGN
     11548>>ASSIGN  11630>>IF      11639>>ASSIGN  11640<>CALL    11731<<ASSIGN  11735>>IF      11736<>CALL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:186  
     11740>>ASSIGN  11741>>IF      11756<<ASSIGN  11758>>IF      11759>>ASSIGN  11760>>IF      11762>>ASSIGN
     11762>>ASSIGN  11763>>ASSIGN  11764>>ASSIGN  11793<<ASSIGN
DDA
     10822**DCL     11510<<ASSIGN  11513<>CALL    11516<<ASSIGN  11516>>ASSIGN  11517<>CALL    11523>>ASSIGN
     11647>>DOCASE
DELALT
     11687**LABEL   11332--GOTO    11656--GOTO
DODISC
     12107**LABEL   11607--GOTO
DONE
     11825**LABEL   11815--GOTO
DOTYC
     10830**DCL     11814<<ASSIGN  11825<<ASSIGN  11833>>IF
DSTA$
     10828**DCL     11409>>ASSIGN  11413>>IF      11419>>IF      11419>>IF      11428>>CALL    11456<<ASSIGN
     11458>>CALL    11467>>CALL    11484<<ASSIGN  11486>>CALL    11491>>CALL    12285<<ASSIGN  12288>>CALL
     12290>>IF      12291>>IF      12292>>IF      12297>>CALL    12318<<ASSIGN  12404>>ASSIGN  12410>>CALL
     12490>>CALL    12528>>CALL    12539>>CALL
DUMPMSG
     12330**PROC    11571--CALL    11621--CALL    11857--CALL    12196--CALL    12219--CALL
DUMPMSG1 IN PROCEDURE DUMPMSG
     12337**ENTRY   11651--CALL    11689--CALL    11910--CALL
FINDMTYP
     12351**PROC    11856--CALL    12195--CALL    12218--CALL
GETOUT
     11901**LABEL   11422--CALLALT 11463--CALLALT 11572--GOTO    11611--GOTO    11711--GOTO    11858--GOTO
     11891--GOTO
GOTMTYP
     11312**LABEL   11673--GOTO
HFC$ASSOCCLR
     11159**DCL-ENT 12424--CALL    12437--CALL
HFC$LOCK
      3055**DCL-ENT 11310--CALL    11324--CALL    11341--CALL    11440--CALL    11458--CALL    11486--CALL
     11582--CALL    11591--CALL    11599--CALL    11633--CALL    11696--CALL    11704--CALL    11873--CALL
     11885--CALL    11897--CALL    12009--CALL    12040--CALL    12067--CALL    12082--CALL    12127--CALL
     12149--CALL    12282--CALL    12288--CALL    12354--CALL    12421--CALL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:187  
HFC$UNLOCK
      3055**DCL-ENT 11329--CALL    11336--CALL    11381--CALL    11428--CALL    11467--CALL    11491--CALL
     11499--CALL    11586--CALL    11595--CALL    11609--CALL    11615--CALL    11637--CALL    11682--CALL
     11700--CALL    11709--CALL    11878--CALL    11889--CALL    11901--CALL    11941--CALL    12024--CALL
     12079--CALL    12086--CALL    12124--CALL    12132--CALL    12297--CALL    12303--CALL    12312--CALL
     12364--CALL    12410--CALL    12415--CALL    12439--CALL    12490--CALL    12493--CALL    12528--CALL
     12539--CALL
I
     10820**DCL     10798--IMP-SIZ 11271<>CALL    11275<<ASSIGN  11276<>CALL    11528<<ASSIGN  11532<<ASSIGN
     11533>>ASSIGN  11535<<ASSIGN  11536>>ASSIGN  11536>>ASSIGN  11539>>ASSIGN  11539>>ASSIGN  11549<<ASSIGN
     11552<<ASSIGN  11553>>ASSIGN  11555<<ASSIGN  11557<>CALL    11618<<ASSIGN  11620>>IF      11670<<CALLBLT
     12406<<ASSIGN  12407>>IF      12428<<ASSIGN  12429>>ASSIGN  12431<<ASSIGN  12432>>ASSIGN  12432>>ASSIGN
     12435>>ASSIGN  12435>>ASSIGN
IDSC IN PROCEDURE SETUP
     12250**DCL     12251<<ASSIGN  12256<<ASSIGN  12263>>IF
J
     10821**DCL     12047<<ASSIGN  12049>>IF      12054<<ASSIGN  12059<>CALL    12154<<ASSIGN  12156>>IF
     12157>>IF      12159>>DOCASE
K$RWPARM
      7886**DCL        55--PROC    11811--ENTRY   11822--ENTRY   11953--ENTRY   11957--CALL    11964--ENTRY
     11968--CALL    11976--ENTRY   11980--CALL    11989--ENTRY   11993--CALL
K$RWPARM.BLKREC
      7912**DCL      7937--REDEF
K$RWPARM.BLKREC.BLKU#
      7913**DCL      7915--REDEF
K$RWPARM.BLKREC.RECU#
      7925**DCL      7927--REDEF
K$RWPARM.DVE
      7943**DCL     11714>>ASSIGN
K$RWPARM.DVE.DVBYTE.VFC
      7952**DCL      7953--REDEF   11345>>IF      11529>>IF      12425>>IF
K$RWPARM.DVE.EOMCHAR
      7960**DCL      7964--REDEF
K$RWPARM.DVE.VFC
      7964**DCL     11533>>ASSIGN  12429>>ASSIGN
K$RWPARM.ERR
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:188  
      8024**DCL      8029--REDEF   11268<<ASSIGN  11331<<ASSIGN  11641<<ASSIGN  11655<<ASSIGN  11664<<ASSIGN
     11675<<ASSIGN  11676<<ASSIGN  11685<<ASSIGN  11854>>IF      11893<<ASSIGN  11912<<ASSIGN
K$RWPARM.FC
      7988**DCL      7989--REDEF
K$RWPARM.FLDID
      8170**DCL      8171--REDEF
K$RWPARM.FPT$
      8051**DCL      8058--REDEF
K$RWPARM.KEYTYPE
      8177**DCL      8178--REDEF
K$RWPARM.MSG$
      7887**DCL      7893--REDEF   11388>>IF      11525>>IF      11536>>ASSIGN  11539>>ASSIGN  12432>>ASSIGN
     12435>>ASSIGN
K$RWPARM.MSGID
      7999**DCL      8004--REDEF   11867<<ASSIGN  12446<<ASSIGN
K$RWPARM.MSGIDXT
      8012**DCL      8016--REDEF   11868<<ASSIGN  12447<<ASSIGN
K$RWPARM.MSGSZ
      7894**DCL     11344>>ASSIGN  11348>>IF      11836>>IF      11851>>ASSIGN  11852>>ASSIGN
K$RWPARM.MSGTYP
      7903**DCL     11302>>IF      11304>>ASSIGN
K$RWPARM.ORG
      8148**DCL      8149--REDEF
K$RWPARM.STATION
      7898**DCL     11299>>IF      11300>>ASSIGN
K$RWPARM.THDRSZ
      8092**DCL      8096--REDEF
K$RWPARM.TYC
      7908**DCL     11713>>ASSIGN
K$RWPARM.VDOFLGS
      8150**DCL      8161--REDEF
KCA$TELLAU
     11160**DCL-ENT 11957--CALL    11968--CALL    11980--CALL    11993--CALL
KCD$INCMP
     11161**DCL-ENT 11944--CALL
KCD$RDGO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:189  
     11162**DCL-ENT 11593--CALL
KCO$DSCTRM
     11163**DCL-ENT 12200--CALL
KC_LGL1ST
      7830**DCL     11670>>CALLBLT
KEY1L
     10824**DCL     10803--IMP-SIZ 11415<<ASSIGN  11417>>IF      11417>>IF      11478<<ASSIGN  11480>>IF
     11480>>IF
KEY2L
     10825**DCL     10804--IMP-SIZ 10826--REDEF   11416<<ASSIGN  11417>>IF      11417>>IF      11452<<ASSIGN
     11453>>IF      11453>>IF      11479<<ASSIGN  11480>>IF      11480>>IF
KQ$CG
      8202**DCL     11271<>CALL    11276<>CALL    11379<>CALL    11513<>CALL    11517<>CALL    11640<>CALL
     11672<>CALL    11736<>CALL    11864<>CALL    12059<>CALL    12161<>CALL    12163<>CALL    12165<>CALL
     12262<>CALL    12317<>CALL    12334<>CALL    12496<>CALL    12530<>CALL    12532<>CALL
KQ$CG.AUCTL.DRML
      8648**DCL     11400>>IF
KQ$CG.AUCTL.DVBYTE.REREAD
      8645**DCL      8646--REDEF
KQ$CG.AUCTL.MAXMC
      8645**DCL     11348>>IF      11350>>ASSIGN
KQ$CG.AUCTL.QRML
      8648**DCL     11432>>IF
KQ$CG.AUCTL.REDUNDANT
      8648**DCL     11511>>IF
KQ$CG.AUCTL.TMTYP
      8641**DCL     11303>>ASSIGN
KQ$CG.AUCTL.WAS
      8644**DCL     12293>>IF      12307>>IF
KQ$CG.AUCTL.XSTALGL
      8644**DCL     12307>>IF
KQ$CG.AUCTL.XTYPLGL
      8645**DCL     11667>>IF
KQ$CG.AUSTA$
      8612**DCL     11326>>IF      11334>>ASSIGN
KQ$CG.DELAY.DDISC
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:190  
      8283**DCL     12084<<ASSIGN
KQ$CG.DPVGHD$
      8296**DCL     11706>>ASSIGN  11707<<ASSIGN  12129>>ASSIGN  12130<<ASSIGN
KQ$CG.GATE.CG
      8592**DCL     11704<>CALL    11709<>CALL    12082<>CALL    12086<>CALL    12127<>CALL    12132<>CALL
KQ$CG.MSGID
      8596**DCL     11372>>ASSIGN  11373<<ASSIGN  11373>>ASSIGN
KQ$CG.QISS
      8588**DCL     11353>>IF      11442>>IF      12356>>IF
KQ$CG.QUEUE.QTREE$
      8424**DCL     11440>>CALL    11499>>CALL    12415>>CALL    12493>>CALL
KQ$CG.QUEUE.WCRL$
      8427**DCL     11475--ASSIGN
KQ$CG.STATS.PUTS
      8694**DCL     11296<<ASSIGN  11296>>ASSIGN
KQ$CG.STREE
      8534**DCL     12284<>CALL
KQ$CG.STREE.GATE
      8536**DCL     11324<>CALL    11329<>CALL    11336<>CALL    12282<>CALL    12303<>CALL    12312<>CALL
KQ$CG.TTREE
      8495**DCL     11312<>CALL    11446<>CALL    12357<>CALL    12358<>CALL
KQ$CG.TTREE.ACTCNT
      8510**DCL     11316>>ASSIGN  11445>>IF
KQ$CG.TTREE.GATE
      8497**DCL     11310<>CALL    11341<>CALL    11381<>CALL    11682<>CALL    12354<>CALL    12364<>CALL
KQ$DBLK
      9958**DCL     11531--ASSIGN  11539--ASSIGN  11548--ASSIGN
KQ$DBLK.DSIZE
      9963**DCL     11520<<ASSIGN  11760>>IF      11764<<ASSIGN  11852<<ASSIGN
KQ$DBLK.MBLK
      9983**DCL     11519<<ASSIGN  11763<<ASSIGN
KQ$DBLK.SIZW
      9992**DCL     11518>>ASSIGN  11762>>ASSIGN
KQ$DBLK.STAMP
      9959**DCL     11524<<ASSIGN  11759<<ASSIGN
KQ$DFRBLK.DBLK$
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:191  
     10609**DCL     10611--REDEF
KQ$DFRBLK.INFO
     10617**DCL     10619--REDEF
KQ$DFRBLK.INFO$
     10619**DCL     11639<<ASSIGN
KQ$DFRPARM.DBLK$
     10563**DCL     10565--REDEF   11731>>ASSIGN
KQ$DFRPARM.DDA
     10567**DCL     11742>>ASSIGN
KQ$DFRPARM.ERR
     10571**DCL     11743>>IF
KQ$DFRPARM.INFO
     10559**DCL     10561--REDEF
KQ$DFRPARM.INFO$
     10561**DCL     11729>>ASSIGN
KQ$MBLK
      9278**DCL     11516--ASSIGN  11518--ASSIGN  11518<<ASSIGN  11518>>ASSIGN  11760--IF      11762--ASSIGN
     11762<<ASSIGN  11762>>ASSIGN
KQ$MBLK.DBLK$
      9282**DCL     11522<<ASSIGN  11566>>IF      11740<<ASSIGN  11756>>ASSIGN  11793>>ASSIGN  11852>>ASSIGN
     11864<>CALL    12333>>IF      12334<>CALL
KQ$MBLK.DDA
      9343**DCL     11523<<ASSIGN  11742<<ASSIGN
KQ$MBLK.DSTA
      9427**DCL     11300<<ASSIGN  11301<<ASSIGN  11321>>IF      11334<<ASSIGN  11398>>IF      12284<>CALL
     12317<>CALL
KQ$MBLK.DVE
      9376**DCL     11714<<ASSIGN
KQ$MBLK.DVE.DVBYTE
      9378**DCL     11550>>IF      11575>>IF      11870>>IF
KQ$MBLK.DVE.EOMCHAR
      9380**DCL      9382--REDEF
KQ$MBLK.DVE.VFC
      9382**DCL     11553>>ASSIGN
KQ$MBLK.JOURNAL
      9413**DCL     11315<<ASSIGN  11389>>IF      11869>>IF
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:192  
KQ$MBLK.KEY1
      9306**DCL      9308--REDEF   11303<<ASSIGN  11304<<ASSIGN  11306>>IF      11312<>CALL    11319>>IF
     11357>>ASSIGN  11358<<ASSIGN  11367>>IF      11417--IF      11446<>CALL    11480--IF      11669>>IF
     11670>>CALLBLT 11672<>CALL    12358<>CALL
KQ$MBLK.KEY2
      9315**DCL      9333--REDEF   11357<<ASSIGN  11364<<ASSIGN  11417--IF      11453--IF      11480--IF
     12357<>CALL
KQ$MBLK.LNK$
      9280**DCL      9282--REDEF    9288--REDEF    9292--REDEF   12482>>ASSIGN  12487<<ASSIGN  12518>>ASSIGN
     12523<<ASSIGN
KQ$MBLK.MID.PRIMARY
      9439**DCL     11372<<ASSIGN  11379<>CALL    11379--CALL    11867>>ASSIGN  12446>>ASSIGN
KQ$MBLK.MID.XT
      9440**DCL     11868>>ASSIGN  12447>>ASSIGN
KQ$MBLK.MSGSIZE
      9441**DCL     11344<<ASSIGN  11347<<ASSIGN  11347>>ASSIGN  11350<<ASSIGN  11386>>IF      11510>>ASSIGN
     11520>>ASSIGN  11528>>ASSIGN  11535>>ASSIGN  11549>>ASSIGN  11555>>ASSIGN  11576>>ASSIGN  11578>>ASSIGN
     11760>>IF      11764>>ASSIGN  11836>>IF      11851<<ASSIGN  12406>>ASSIGN  12431>>ASSIGN  12441>>ASSIGN
KQ$MBLK.PRIO
      9296**DCL     11355--ASSIGN  11356--ASSIGN  11362--ASSIGN  11363--ASSIGN  11369<<ASSIGN
KQ$MBLK.PUTSTATE
      9424**DCL     11559<<ASSIGN  11618>>ASSIGN  11619<<ASSIGN  11692<<ASSIGN  11739>>IF      11778>>IF
     11792>>IF      11830>>IF      11831<<ASSIGN  11866<<ASSIGN  12189>>DOCASE
KQ$MBLK.RBLK
      9419**DCL     12484<<ASSIGN  12486<<ASSIGN  12520<<ASSIGN  12522<<ASSIGN
KQ$MBLK.STAMP
      9300**DCL     11524>>ASSIGN  11759>>ASSIGN
KQ$MBLK.STAR
      9368**DCL     11320<<ASSIGN  11400>>IF
KQ$MBLK.TYC
      9429**DCL      9431--REDEF   11351<<ASSIGN  11351>>ASSIGN  11713<<ASSIGN  11713>>ASSIGN
KQ$MBLK.XSP.MREQ$
      9335**DCL      9339--REDEF
KQ$MTYP.JOURNAL
     10051**DCL     11315>>ASSIGN
KQ$MTYP.MPRIO
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:193  
     10047**DCL     11356>>ASSIGN  11362>>ASSIGN
KQ$MTYP.NUMWRITES
     10065**DCL     11314<<ASSIGN  11314>>ASSIGN  12340<<ASSIGN  12340>>ASSIGN
KQ$QTN.MXACT
     10431**DCL     10433--REDEF
KQ$QTN.READS$
     10434**DCL     11449--ASSIGN
KQ$QTN.STA.ACTTYC
     10153**DCL     10157--REDEF
KQ$QTN.STA.DCBLNK$
     10160**DCL     10163--REDEF   10167--REDEF
KQ$QTN.STA.EVCNT
     10246**DCL     10249--REDEF
KQ$QTN.STA.EVNT
     10212**DCL     10216--REDEF   10219--REDEF
KQ$QTN.STA.OPNBLKED
     10273**DCL     10276--REDEF
KQ$QTN.STA.OPNREJ
     10279**DCL     10281--REDEF
KQ$QTN.STA.SUCCREAD
     10202**DCL     10206--REDEF
KQ$QTN.STA.TCOUNT
     10331**DCL     10337--REDEF
KQ$QTN.STA.VGOT$
     10316**DCL     10320--REDEF   10324--REDEF
KQ$RBLK.CNACTD
      9622**DCL      9631--REDEF
KQ$RBLK.DBLK$
      9685**DCL      9689--REDEF    9692--REDEF
KQ$RBLK.EOFNONE
      9600**DCL      9603--REDEF
KQ$RBLK.FROMQ
      9606**DCL      9609--REDEF
KQ$RBLK.IOQ$
      9699**DCL     12045>>IF      12047>>ASSIGN  12048>>ASSIGN  12050>>CALL
KQ$RBLK.KEY1
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:194  
      9648**DCL     11417--IF      11480--IF
KQ$RBLK.KEY1L
      9643**DCL     11415>>ASSIGN  11478>>ASSIGN
KQ$RBLK.KEY1R
      9647**DCL      9648--REDEF
KQ$RBLK.KEY2
      9653**DCL     11417--IF      11453--IF      11480--IF
KQ$RBLK.KEY2L
      9645**DCL     11416>>ASSIGN  11452>>ASSIGN  11479>>ASSIGN
KQ$RBLK.KEY2R
      9652**DCL      9653--REDEF
KQ$RBLK.LATCH
      9595**DCL      9597--REDEF   11411>>IF      11455>>IF      11483>>IF
KQ$RBLK.MBLK$
      9587**DCL     12483>>IF      12484>>ASSIGN  12485<<ASSIGN  12519>>IF      12520>>ASSIGN  12521<<ASSIGN
KQ$RBLK.NCDDA
      9669**DCL     12497<<ASSIGN  12533<<ASSIGN  12537<<ASSIGN
KQ$RBLK.STATE
      9592**DCL     11411>>IF      11460>>IF      11488>>IF      12044>>IF      12488<<ASSIGN  12524<<ASSIGN
KQ$RBLKD.BUF$
      9894**DCL      9896--REDEF   12427>>ASSIGN  12435>>ASSIGN
KQ$RBLKD.BUFSIZE
      9904**DCL     12407>>IF
KQ$RBLKD.CNACTD
      9808**DCL      9817--REDEF
KQ$RBLKD.DBLKX
      9914**DCL      9918--REDEF
KQ$RBLKD.EOFNONE
      9786**DCL      9789--REDEF
KQ$RBLKD.EOFTIME
      9918**DCL     12495>>IF      12531>>IF
KQ$RBLKD.FROMQ
      9792**DCL      9795--REDEF
KQ$RBLKD.KEY1R
      9833**DCL      9834--REDEF
KQ$RBLKD.KEY2R
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:195  
      9838**DCL      9839--REDEF
KQ$RBLKD.LATCH
      9781**DCL      9783--REDEF
KQ$RBLKD.LWRITES$
      9925**DCL      9929--REDEF
KQ$RBLKD.PTW
      9899**DCL     12423>>ASSIGN
KQ$RBLKD.QRLNK$
      9929**DCL     11470--ASSIGN  11494--ASSIGN  12479>>ASSIGN  12480<<ASSIGN
KQ$RBLKD.STA$
      9860**DCL     11456>>ASSIGN  11484>>ASSIGN  12525>>IF
KQ$STA
      8940**DCL     11880<>CALL    11905<>CALL    11957<>CALL    11968<>CALL    11980<>CALL    11993<>CALL
     12200<>CALL    12221<>CALL    12338<>CALL
KQ$STA.ACTTYC
      8992**DCL      8996--REDEF
KQ$STA.AUP
      9094**DCL     12290>>IF
KQ$STA.BTN.KEY
      8976**DCL     11334>>ASSIGN  11358>>ASSIGN  11364>>ASSIGN  11379<>CALL    11379<>CALL    12059<>CALL
     12059<>CALL
KQ$STA.CG$
      8979**DCL     11730>>ASSIGN  11736>>CALL    12213>>ASSIGN
KQ$STA.DCBLNK$
      8999**DCL      9002--REDEF    9006--REDEF
KQ$STA.DDISC
      9104**DCL     12070<<ASSIGN
KQ$STA.DPVGLNK$
      9159**DCL     11706<<ASSIGN  12129<<ASSIGN
KQ$STA.EVCNT
      9085**DCL      9088--REDEF
KQ$STA.EVNT
      9051**DCL      9055--REDEF    9058--REDEF
KQ$STA.GATE
      9018**DCL     11428<>CALL    11458<>CALL    11467<>CALL    11486<>CALL    11491<>CALL    11582<>CALL
     11586<>CALL    11599<>CALL    11609<>CALL    11633<>CALL    11637<>CALL    11696<>CALL    11700<>CALL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:196  
     11873<>CALL    11878<>CALL    11885<>CALL    11889<>CALL    11897<>CALL    11901<>CALL    11941<>CALL
     12009<>CALL    12024<>CALL    12040<>CALL    12067<>CALL    12079<>CALL    12124<>CALL    12149<>CALL
     12288<>CALL    12297<>CALL    12410<>CALL    12490<>CALL    12528<>CALL    12539<>CALL
KQ$STA.IDSC
      9020**DCL     11606>>IF      11733>>IF      12015>>IF      12038>>IF      12059<>CALL    12061<<ASSIGN
     12263>>IF
KQ$STA.JMSGID
      9163**DCL     11876<<ASSIGN  11881>>IF      11939>>ASSIGN
KQ$STA.JRNLW
      9123**DCL     11293>>IF      11875<<ASSIGN  11881>>IF      11887<<ASSIGN  11899<<ASSIGN  11938<<ASSIGN
     12062<<ASSIGN
KQ$STA.LDCT$
      8981**DCL     11419>>IF      11419>>IF      11745>>ASSIGN  11944>>CALL    12018>>CALL    12037>>IF
     12291>>IF      12292>>IF      12404>>ASSIGN
KQ$STA.LOCKCNT
      9074**DCL     11584<<ASSIGN  11584>>ASSIGN  11601>>IF      11603<<ASSIGN  11603>>ASSIGN  11605>>IF
     11635<<ASSIGN  11635>>ASSIGN  11698<<ASSIGN  11698>>ASSIGN  12011>>IF      12013<<ASSIGN  12013>>ASSIGN
     12014>>IF      12054>>ASSIGN  12115<<ASSIGN
KQ$STA.MBLK$
      8985**DCL     11277>>IF      11295<<ASSIGN  11732>>ASSIGN  11755>>ASSIGN  11777>>ASSIGN  11791>>ASSIGN
     11828>>ASSIGN  12187>>ASSIGN  12214>>ASSIGN  12332>>ASSIGN  12443<>CALL    12445<>CALL
KQ$STA.MLH.BUSY
      9222**DCL     11413>>IF
KQ$STA.MPRIO
      9013**DCL     11355>>ASSIGN  11363>>ASSIGN
KQ$STA.MREQ
      9065**DCL     11261>>IF      11262>>IF      11263>>IF      11266<<ASSIGN  11273>>IF      12154>>ASSIGN
     12155<<ASSIGN  12212<<ASSIGN
KQ$STA.MREQ$
      9150**DCL     11265>>ASSIGN  12152>>ASSIGN  12153<<ASSIGN
KQ$STA.OPNBLKED
      9112**DCL      9115--REDEF
KQ$STA.OPNREJ
      9118**DCL      9120--REDEF
KQ$STA.PVGSENSE
      9135**DCL     12122<<ASSIGN
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:197  
KQ$STA.RBLK$
      8983**DCL     11409>>ASSIGN  12043>>IF      12044>>IF      12045>>IF      12047>>ASSIGN  12048>>ASSIGN
     12050>>CALL
KQ$STA.SAVIDSC
      9139**DCL     12069<<ASSIGN  12263>>IF
KQ$STA.SUCCREAD
      9041**DCL      9045--REDEF
KQ$STA.TCOUNT
      9170**DCL      9176--REDEF
KQ$STA.TERM
      9036**DCL     12015>>IF
KQ$STA.VGOT$
      9155**DCL      9159--REDEF    9163--REDEF   11294<<ASSIGN  11557<>CALL    11574>>ASSIGN  11860>>IF
     11861<>CALL    12217<<ASSIGN  12335>>IF      12336<>CALL
KQ$STA.WRITES
      9168**DCL     11297<<ASSIGN  11297>>ASSIGN
KQ$THDR.GATE
      9553**DCL     11440<>CALL    11499<>CALL    12415<>CALL    12493<>CALL
KQB$SRCH
     11164**DCL-ENT 11312--CALL    11446--CALL    12284--CALL    12357--CALL    12358--CALL
KQD$DEFERGO
     11165**DCL-ENT 11640--CALL
KQD$DELETE
     11166**DCL-ENT 11736--CALL
KQD$GET
     11167**DCL-ENT 11513--CALL    11517--CALL
KQD$UNLOCK
     11168**DCL-ENT 11864--CALL    12334--CALL
KQG$CLEANUP
     11169**DCL-ENT 12170--CALL
KQG$RECOVER
     11170**DCL-ENT 12221--CALL
KQM$GETBD
     11171**DCL-ENT 11276--CALL
KQM$GETMBLK
     11172**DCL-ENT 11271--CALL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:198  
KQM$RELMBLK
     11173**DCL-ENT 12163--CALL
KQM$RELMTYP
     11175**DCL-ENT 12165--CALL
KQM$RELRBLKT
     11174**DCL-ENT 12161--CALL
KQP$FDISC
     12103**ENTRY   12018--CALL
KQP$GCONT
     11727**ENTRY   11640--CALL
KQQ$DEQUEUE
     11176**DCL-ENT 12530--CALL
KQQ$DQEOFTIME
     11177**DCL-ENT 12496--CALL    12532--CALL
KQR$COMP
     11178**DCL-ENT 12448--CALL
KQT$GETSTA
     11179**DCL-ENT 12317--CALL
KQT$GETTYP
     11180**DCL-ENT 11672--CALL
KQU$DELETE
     11181**DCL-ENT 12338--CALL
KQW$SENDNA
     11182**DCL-ENT 11880--CALL    11905--CALL
KQX$LDASR
     11183**DCL-ENT 12262--CALL
KQZ$LOG
     11184**DCL-ENT 11379--CALL    12059--CALL
KQ_DEBUG
      3068**DCL     11511>>IF
KQ_IMBLK.DVE.EOMCHAR
      3730**DCL      3732--REDEF
KQ_IMBLK.KEY1
      3656**DCL      3658--REDEF
KQ_IMBLK.KEY2
      3665**DCL      3683--REDEF
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:199  
KQ_IMBLK.LNK$
      3630**DCL      3632--REDEF    3638--REDEF    3642--REDEF
KQ_IMBLK.TYC
      3779**DCL      3781--REDEF
KQ_IMBLK.XSP.MREQ$
      3685**DCL      3689--REDEF
KQ_IMTYP
      3484**DCL     11339--ASSIGN  12339--IF
KQ_IRBLK.BUF$
      3234**DCL      3236--REDEF
KQ_IRBLK.CNACTD
      3148**DCL      3157--REDEF
KQ_IRBLK.DBLKX
      3254**DCL      3258--REDEF
KQ_IRBLK.EOFNONE
      3126**DCL      3129--REDEF
KQ_IRBLK.FROMQ
      3132**DCL      3135--REDEF
KQ_IRBLK.KEY1R
      3173**DCL      3174--REDEF
KQ_IRBLK.KEY2R
      3178**DCL      3179--REDEF
KQ_IRBLK.LATCH
      3121**DCL      3123--REDEF
KQ_IRBLK.LWRITES$
      3265**DCL      3269--REDEF
KQ_IRBLKT.CNACTD
      3334**DCL      3343--REDEF
KQ_IRBLKT.DBLK$
      3397**DCL      3401--REDEF    3404--REDEF
KQ_IRBLKT.EOFNONE
      3312**DCL      3315--REDEF
KQ_IRBLKT.FROMQ
      3318**DCL      3321--REDEF
KQ_IRBLKT.KEY1R
      3359**DCL      3360--REDEF
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:200  
KQ_IRBLKT.KEY2R
      3364**DCL      3365--REDEF
KQ_IRBLKT.LATCH
      3307**DCL      3309--REDEF
KQ_LOG.TSIO
      3088**DCL     11374>>IF      12052>>IF
KQ_XFGATE
      3072**DCL     12421<>CALL    12439<>CALL
LOCKSET
     11147**DCL     11579>>IF      11693>>IF      11757<<ASSIGN  11794<<ASSIGN  11936<<ASSIGN  12007<<ASSIGN
     12021>>IF      12259<<ASSIGN
M$ IN PROCEDURE MOVMC
     12514**DCL     12512--PROC    12517>>ASSIGN  12518<<ASSIGN
M$ IN PROCEDURE MOVMCQ
     12476**DCL     12474--PROC    12481>>ASSIGN  12482<<ASSIGN
MBLK$
     10815**DCL      9278--IMP-PTR 11265<<ASSIGN  11267>>IF      11271<>CALL    11274<<ASSIGN  11276<>CALL
     11295>>ASSIGN  11300>>ASSIGN  11301>>ASSIGN  11303>>ASSIGN  11304>>ASSIGN  11306>>IF      11312>>CALL
     11315>>ASSIGN  11319>>IF      11320>>ASSIGN  11321>>IF      11334>>ASSIGN  11344>>ASSIGN  11347>>ASSIGN
     11347>>ASSIGN  11350>>ASSIGN  11351>>ASSIGN  11351>>ASSIGN  11355>>ASSIGN  11356>>ASSIGN  11357>>ASSIGN
     11357>>ASSIGN  11358>>ASSIGN  11362>>ASSIGN  11363>>ASSIGN  11364>>ASSIGN  11367>>IF      11369>>ASSIGN
     11372>>ASSIGN  11379>>CALL    11379>>CALL    11386>>IF      11389>>IF      11398>>IF      11400>>IF
     11417>>IF      11417>>IF      11446>>CALL    11453>>IF      11480>>IF      11480>>IF      11510>>ASSIGN
     11518>>ASSIGN  11520>>ASSIGN  11522>>ASSIGN  11523>>ASSIGN  11524>>ASSIGN  11528>>ASSIGN  11535>>ASSIGN
     11549>>ASSIGN  11550>>IF      11553>>ASSIGN  11555>>ASSIGN  11559>>ASSIGN  11566>>IF      11575>>IF
     11576>>ASSIGN  11578>>ASSIGN  11618>>ASSIGN  11619>>ASSIGN  11669>>IF      11670>>CALLBLT 11672>>CALL
     11692>>ASSIGN  11713>>ASSIGN  11713>>ASSIGN  11714>>ASSIGN  11732<<ASSIGN  11739>>IF      11740>>ASSIGN
     11742>>ASSIGN  11755<<ASSIGN  11756>>ASSIGN  11759>>ASSIGN  11760>>IF      11762>>ASSIGN  11764>>ASSIGN
     11777<<ASSIGN  11778>>IF      11791<<ASSIGN  11792>>IF      11793>>ASSIGN  11828<<ASSIGN  11830>>IF
     11831>>ASSIGN  11836>>IF      11851>>ASSIGN  11852>>ASSIGN  11864>>CALL    11866>>ASSIGN  11867>>ASSIGN
     11868>>ASSIGN  11869>>IF      11870>>IF      12187<<ASSIGN  12188>>IF      12189>>DOCASE  12214<<ASSIGN
     12215>>IF      12284>>CALL    12317>>CALL    12332<<ASSIGN  12333>>IF      12334>>CALL    12357>>CALL
     12358>>CALL    12406>>ASSIGN  12431>>ASSIGN  12441>>ASSIGN  12446>>ASSIGN  12447>>ASSIGN  12481<<ASSIGN
     12482>>ASSIGN  12485>>ASSIGN  12486>>ASSIGN  12487>>ASSIGN  12517<<ASSIGN  12518>>ASSIGN  12521>>ASSIGN
     12522>>ASSIGN  12523>>ASSIGN
MMS$VGET
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:201  
     11185**DCL-ENT 11557--CALL
MMS$VREL
     11186**DCL-ENT 11861--CALL    12336--CALL
MOVMC IN PROCEDURE XFERD
     12512**PROC    12445--CALL
MOVMCQ IN PROCEDURE XFERD
     12474**PROC    12443--CALL
MTYP$
     10823**DCL     10011--IMP-PTR 11305<<ASSIGN  11312<>CALL    11314>>ASSIGN  11314>>ASSIGN  11315>>ASSIGN
     11339<<ASSIGN  11356>>ASSIGN  11362>>ASSIGN  11447>>ASSIGN  11671<<ASSIGN  11672<>CALL    11675>>IF
     11687<<ASSIGN  12339>>IF      12339>>IF      12340>>ASSIGN  12340>>ASSIGN  12357<>CALL    12358<>CALL
     12360<<ASSIGN
N$LDCT
     10683**DCL     11944<>CALL    12018<>CALL
N$LDCT.DDT$
     10685**DCL     10685--REDEF
N$LDCT.IOQ$
     10684**DCL     10685--REDEF   12404>>ASSIGN
N$LDCT.LDCTX
     10686**DCL     10686--REDEF
N$LDCT.LKFLG.ABORTED
     10698**DCL     10699--REDEF
N$LDCT.LKFLG.ACTIVE
     10702**DCL     12292>>IF
N$LDCT.RESCOD
     10691**DCL     11419>>IF      11419>>IF
N$LDCT.RLCID.LDCTX
     10708**DCL     10708--REDEF
N$LDCT.STA$
     10704**DCL     10705--REDEF
N$LDCT.SYMB$
     10683**DCL     10683--REDEF   10683--REDEF   10684--REDEF
N$REQ
     10725**DCL     12448<>CALL
N$REQ.ARSIZE
     10758**DCL     12441<<ASSIGN
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:202  
N$REQ.BUFADDR
     10734**DCL     10735--REDEF   10735--REDEF
N$REQ.DLA.DRELADDR
     10726**DCL     10726--REDEF
N$REQ.DVE.EOMCHAR
     10763**DCL     10764--REDEF
N$REQ.EAINFO
     10757**DCL     10757--REDEF
N$REQ.EAINFOX
     10757**DCL     10758--REDEF
N$REQ.EVNTINFO
     10758**DCL     10758--REDEF
N$REQ.STATION.LSTA$
     10738**DCL     12047--ASSIGN  12048--ASSIGN
N$REQ.STATUS
     10739**DCL     10745--REDEF
N$REQ.TYC
     10747**DCL     12405<<ASSIGN
N$REQ.USER#
     10759**DCL     12050<>CALL
NK$LDCT
     10637**DCL     11593<>CALL    12170<>CALL
NK$LDCT.CG$
     10668**DCL     11754>>ASSIGN  11790>>ASSIGN  12107>>ASSIGN  12147>>ASSIGN  12183>>ASSIGN  12261>>ASSIGN
NK$LDCT.DDT$
     10639**DCL     10639--REDEF
NK$LDCT.IOQ$
     10638**DCL     10639--REDEF
NK$LDCT.LDCTX
     10640**DCL     10640--REDEF
NK$LDCT.LKFLG.ABORTED
     10652**DCL     10653--REDEF
NK$LDCT.RLCID.LDCTX
     10662**DCL     10662--REDEF
NK$LDCT.STA$
     10658**DCL     10659--REDEF   11753>>ASSIGN  11789>>ASSIGN  12106>>ASSIGN  12146>>ASSIGN  12182>>ASSIGN
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:203  
     12258>>ASSIGN
NK$LDCT.SYMB$
     10637**DCL     10637--REDEF   10637--REDEF   10638--REDEF
NK$LDCTAUTO$
     10817**DCL     10637--IMP-PTR 11253<<ASSIGN  11593>>CALL    11745<<ASSIGN  11753>>ASSIGN  11754>>ASSIGN
     11775<<ASSIGN  11788<<ASSIGN  11789>>ASSIGN  11790>>ASSIGN  11813<<ASSIGN  11824<<ASSIGN  11955<<ASSIGN
     11966<<ASSIGN  11978<<ASSIGN  11991<<ASSIGN  12035<<ASSIGN  12105<<ASSIGN  12106>>ASSIGN  12107>>ASSIGN
     12145<<ASSIGN  12146>>ASSIGN  12147>>ASSIGN  12170>>CALL    12181<<ASSIGN  12182>>ASSIGN  12183>>ASSIGN
     12258>>ASSIGN  12261>>ASSIGN
NOGET
     11618**LABEL   11513--CALLALT 11517--CALLALT
NOMBLK
     11647**LABEL   11262--GOTO    11273--GOTO    11276--CALLALT 11652--GOTO
NOMTYP
     11664**LABEL   11312--CALLALT
NOMTYP1
     11671**LABEL   11672--CALLALT
NOSTA
     11901**LABEL   11903--GOTO    11905--CALLALT
NOSTA IN PROCEDURE CHKSTAL
     12293**LABEL   12284--CALLALT
NOSTA0
     11901**LABEL   11408--CALLALT
NOVGET
     11687**LABEL   11557--CALLALT
NSJ
     11893**LABEL   11880--CALLALT
NTYP IN PROCEDURE FINDMTYP
     12360**LABEL   12357--CALLALT 12358--CALLALT
P$
     11148**DCL     11449<<ASSIGN  11450>>ASSIGN  11470<<ASSIGN  11471>>ASSIGN  11475<<ASSIGN  11476>>ASSIGN
     11494<<ASSIGN  11495>>ASSIGN  12152<<ASSIGN  12158>>IF      12161<>CALL    12163<>CALL    12165<>CALL
     12479>>ASSIGN
P2
     11273**LABEL   11271--CALLALT
P3
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:204  
     11277**LABEL   11267--GOTO    11272--GOTO
PAR
      7864**DCL        55--PROC    11253--ASSIGN  11727--ENTRY   11729--ASSIGN  11731--ASSIGN  11742--ASSIGN
     11743--IF      11773--ENTRY   11775--ASSIGN  11786--ENTRY   11788--ASSIGN  11811--ENTRY   11813--ASSIGN
     11822--ENTRY   11824--ASSIGN  11934--ENTRY   11937--ASSIGN  11953--ENTRY   11955--ASSIGN  11964--ENTRY
     11966--ASSIGN  11976--ENTRY   11978--ASSIGN  11989--ENTRY   11991--ASSIGN  12004--ENTRY   12006--ASSIGN
     12033--ENTRY   12035--ASSIGN  12037--IF      12103--ENTRY   12105--ASSIGN  12143--ENTRY   12145--ASSIGN
     12179--ENTRY   12181--ASSIGN  12209--ENTRY   12211--ASSIGN
PULLTYC
     11712**PROC    11383--CALL    11835--CALL
PUT0
     11539**LABEL   11766--GOTO    11795--GOTO
PUT01
     11557**LABEL   11758--GOTO
PUT1
     11559**LABEL   11779--GOTO
PUT2
     11589**LABEL   11622--GOTO    11737--GOTO    11945--GOTO
PUT3
     11601**LABEL   12063--GOTO
QLOCK IN PROCEDURE XFERD
     12387**DCL     12390<<ASSIGN  12402<<ASSIGN  12412>>IF      12442>>IF
QTN$
     10829**DCL     11442<<ASSIGN  11446<>CALL    11447<<ASSIGN  11449>>ASSIGN
RALT
     11605**LABEL   11593--CALLALT
RBLK$
     10827**DCL      9586--IMP-PTR  9772--IMP-PTR 11409<<ASSIGN  11410>>IF      11411>>IF      11411>>IF
     11415>>ASSIGN  11416>>ASSIGN  11417>>IF      11417>>IF      11450<<ASSIGN  11451>>DOWHILE 11452>>ASSIGN
     11453>>IF      11455>>IF      11456>>ASSIGN  11460>>IF      11470>>ASSIGN  11471<<ASSIGN  11476<<ASSIGN
     11477>>DOWHILE 11478>>ASSIGN  11479>>ASSIGN  11480>>IF      11480>>IF      11483>>IF      11484>>ASSIGN
     11488>>IF      11494>>ASSIGN  11495<<ASSIGN  12407>>IF      12423>>ASSIGN  12427>>ASSIGN  12435>>ASSIGN
     12479>>ASSIGN  12480>>ASSIGN  12483>>IF      12484>>ASSIGN  12485>>ASSIGN  12488>>ASSIGN  12495>>IF
     12496<>CALL    12497>>ASSIGN  12519>>IF      12520>>ASSIGN  12521>>ASSIGN  12524>>ASSIGN  12525>>IF
     12530<>CALL    12531>>IF      12532<>CALL    12533>>ASSIGN  12537>>ASSIGN
RRQ$ IN PROCEDURE XFERD
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:205  
     12388**DCL     12404<<ASSIGN  12405>>ASSIGN  12441>>ASSIGN  12448>>CALL
RTN
     11901**LABEL   11254--CALLALT 11776--CALLALT 11827--CALLALT 11956--CALLALT 11967--CALLALT 11979--CALLALT
     11992--CALLALT 12036--CALLALT 12170--CALLALT
RWPARM
     10852**DCL     11593<>CALL    11944<>CALL
RWPARM.BLKREC
     10878**DCL     10903--REDEF
RWPARM.BLKREC.BLKU#
     10879**DCL     10881--REDEF
RWPARM.BLKREC.RECU#
     10891**DCL     10893--REDEF
RWPARM.DVE.DVBYTE.VFC
     10918**DCL     10919--REDEF
RWPARM.DVE.EOMCHAR
     10926**DCL     10930--REDEF
RWPARM.ERR
     10990**DCL     10995--REDEF   11567<<ASSIGN  11570<<ASSIGN
RWPARM.FC
     10954**DCL     10955--REDEF
RWPARM.FLDID
     11136**DCL     11137--REDEF
RWPARM.FPT$
     11017**DCL     11024--REDEF
RWPARM.KEYTYPE
     11143**DCL     11144--REDEF
RWPARM.MSG$
     10853**DCL     10859--REDEF   11574<<ASSIGN
RWPARM.MSGID
     10965**DCL     10970--REDEF   11939<<ASSIGN
RWPARM.MSGIDXT
     10978**DCL     10982--REDEF
RWPARM.MSGSZ
     10860**DCL     11576<<ASSIGN  11578<<ASSIGN
RWPARM.ORG
     11114**DCL     11115--REDEF
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:206  
RWPARM.THDRSZ
     11058**DCL     11062--REDEF
RWPARM.VDOFLGS
     11116**DCL     11127--REDEF
SC_BCGPSC
     11191**DCL-ENT 11837--CALL
SC_BCGPUT
     11189**DCL-ENT 11278--CALL    11293--CALL    11425--CALL    11601--CALL    11620--CALL    11659--CALL
     11739--CALL    11744--CALL    11778--CALL    11792--CALL    11830--CALL    12011--CALL    12156--CALL
     12167--CALL    12192--CALL
SENDIT
     11860**LABEL   11540--GOTO
SENDIT0
     11860**LABEL   11387--GOTO
SETUP
     12249**PROC    11254--CALL    11776--CALL    11827--CALL    11956--CALL    11967--CALL    11979--CALL
     11992--CALL
SETUPI IN PROCEDURE SETUP
     12254**ENTRY   12036--CALL
SSR$RUE
     11187**DCL-ENT 12050--CALL
SSS$BLOCK
     11188**DCL-ENT 11943--CALL
STA$
     10814**DCL      8940--IMP-PTR 11261>>IF      11262>>IF      11263>>IF      11265>>ASSIGN  11266>>ASSIGN
     11273>>IF      11274>>ASSIGN  11277>>IF      11293>>IF      11294>>ASSIGN  11295>>ASSIGN  11297>>ASSIGN
     11297>>ASSIGN  11355>>ASSIGN  11358>>ASSIGN  11363>>ASSIGN  11364>>ASSIGN  11379>>CALL    11379>>CALL
     11442>>ASSIGN  11557>>CALL    11574>>ASSIGN  11582>>CALL    11584>>ASSIGN  11584>>ASSIGN  11586>>CALL
     11599>>CALL    11601>>IF      11603>>ASSIGN  11603>>ASSIGN  11605>>IF      11606>>IF      11609>>CALL
     11633>>CALL    11635>>ASSIGN  11635>>ASSIGN  11637>>CALL    11639>>ASSIGN  11671>>ASSIGN  11696>>CALL
     11698>>ASSIGN  11698>>ASSIGN  11700>>CALL    11706>>ASSIGN  11707>>ASSIGN  11729<<ASSIGN  11730>>ASSIGN
     11732>>ASSIGN  11733>>IF      11736>>CALL    11745>>ASSIGN  11753<<ASSIGN  11755>>ASSIGN  11777>>ASSIGN
     11789<<ASSIGN  11791>>ASSIGN  11828>>ASSIGN  11860>>IF      11861>>CALL    11873>>CALL    11875>>ASSIGN
     11876>>ASSIGN  11878>>CALL    11880>>CALL    11881>>IF      11881>>IF      11885>>CALL    11887>>ASSIGN
     11889>>CALL    11897>>CALL    11899>>ASSIGN  11901>>CALL    11905>>CALL    11937<<ASSIGN  11938>>ASSIGN
     11939>>ASSIGN  11941>>CALL    11944>>CALL    11957>>CALL    11968>>CALL    11980>>CALL    11993>>CALL
PL6.E3A0      #001=KQP$PUT File=KQP$PUT.:E05TSI                                  WED 07/30/97 01:31 Page:207  
     12006<<ASSIGN  12009>>CALL    12011>>IF      12013>>ASSIGN  12013>>ASSIGN  12014>>IF      12015>>IF
     12015>>IF      12018>>CALL    12024>>CALL    12037>>IF      12038>>IF      12040>>CALL    12043>>IF
     12044>>IF      12045>>IF      12047>>ASSIGN  12048>>ASSIGN  12050>>CALL    12054>>ASSIGN  12059>>CALL
     12059>>CALL    12059>>CALL    12061>>ASSIGN  12062>>ASSIGN  12067>>CALL    12069>>ASSIGN  12070>>ASSIGN
     12079>>CALL    12106<<ASSIGN  12115>>ASSIGN  12122>>ASSIGN  12124>>CALL    12129>>ASSIGN  12130>>ASSIGN
     12146<<ASSIGN  12149>>CALL    12152>>ASSIGN  12153>>ASSIGN  12154>>ASSIGN  12155>>ASSIGN  12182<<ASSIGN
     12187>>ASSIGN  12200>>CALL    12211<<ASSIGN  12212>>ASSIGN  12213>>ASSIGN  12214>>ASSIGN  12217>>ASSIGN
     12221>>CALL    12258<<ASSIGN  12260>>IF      12263>>IF      12263>>IF      12316>>ASSIGN  12332>>ASSIGN
     12335>>IF      12336>>CALL    12338>>CALL    12443>>CALL    12445>>CALL
T$ IN PROCEDURE CHKSTAL
     12279**DCL     12284<>CALL    12285>>ASSIGN  12316<<ASSIGN  12317<>CALL    12318>>ASSIGN
TACTCNT
     10826**DCL     11316<<ASSIGN  11445>>IF
VLP$FPRG
     10785**DCL     11993<>CALL
WR11
     11489**LABEL   11455--GOTO    11483--GOTO
WRITECG
     11496**LABEL   11423--GOTO    11464--GOTO
WRITENOWQ
     11463**LABEL   11489--GOTO
XFER IN PROCEDURE XFERD
     12402**LABEL   12391--GOTO
XFERD
     12385**PROC    11422--CALL
XFERQ IN PROCEDURE XFERD
     12401**ENTRY   11463--CALL
