VERSION E05

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:2
                                     1  *M* X6A - PL6 run-time routine for L6 Monitor
                                     2  *T***********************************************************
                                     3  *T*                                                         *
                                     4  *T* Copyright (c) Bull HN Information Systems Inc., 1997    *
                                     5  *T*                                                         *
                                     6  *T***********************************************************
                                     7  *
                                     8  *D* For a description of auto storage layout, see GH_LCP6_M.
                                     9  *
                                    10  *
                                    11  * Defs
                                    12  *
                                    13           ENTDEF    X6A_MAUTO
                                    14           ENTDEF    X6A_MARET
                                    15           ENTDEF    X6A_AUNWIND
                                    16           SYMDEF    X6A@
                                    17           SYMDEF    X6AEND@
                                    18           ENTDEF    X6A_AUTO_0
                                    19           ENTDEF    X6A_AUTO_1
                                    20           ENTDEF    X6A_AUTO_2
                                    21           ENTDEF    X6A_AUTO_3
                                    22           ENTDEF    X6A_AUTO_N
                                    23           ENTDEF    X6A_ARET
                                    24           ENTDEF    X6A_AALT
                                    25           ENTDEF    X6B_BCM
                                    26           ENTDEF    X6B_BLR
                                    27           ENTDEF    X6C_ACMZ
                                    28           ENTDEF    X6C_ACM
                                    29           ENTDEF    X6C_ALRZ
                                    30           ENTDEF    X6C_ALR
                                    31           ENTDEF    X6C_MAT
                                    32           ENTDEF    X6C_SRCH
                                    33           ENTDEF    X6D_MID

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:3
                                    34           EJECT
                                    35  *
                                    36  *
         00000002                   37  BOT_FR$  EQU       2
         00000004                   38  AUTO_TYPE EQU      4
                                    39  *
         00000002                   40  RETDISP  EQU       2         # words following calls to X6A_?_?
                                    41  *
         00000000                   42  FR_RET   EQU       0         displ to return address in frame
         00000002                   43  FR_TYPE  EQU       2         displ to TYPE field in frame
         00000004                   44  FR_PARM1 EQU       4         displ to first PARM in frame
         FFFFFFFF                   45  CUR_FR_SIZ EQU     -1        size of frame (not in frame)
                                    46  *

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:4
                                    47           EJECT
         000000(0)                  48  X6A@    SECT       PROC
                                    49  *
                                    50  *
                                    51  *
         000000(0)                  52  X6A_ARET ALIGN
 00000   EC87                       53           LDB,B6    ,B7                 return address
 00001   0010 0007                  54           RLQ       B7                  This RLQ releases a frame
 00003   83C6 0001                  55           JMP       1,B6                Skip altret word
                                    56  *
                                    57  *
                                    58  *
         000005(0)                  59  X6A_AALT ALIGN
 00005   EC87                       60           LDB,B6    ,B7
 00006   0010 0007                  61           RLQ       B7
 00008   B806                       62           LDR,R3    ,B6                 PREL offset to alt
 00009   C3B6                       63           LNJ,B4    ,B6,R3

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:5
                                    64           EJECT
                                    65  *
         00000A(0)                  66  X6A_AUTO_0 ALIGN
                                    67  *
 0000A   B805                       68           LDR,R3    ,B5                 # words in frame
 0000B   0010 0037                  69           ACQ,R3    B7                  get a frame???
 0000D   EF87                       70           STB,B6    ,B7                 RET_ADDR
 0000E   8747 0002                  71           CL        FR_TYPE,B7          callable
 00010   83C5 0002                  72           JMP       RETDISP,B5

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:6
                                    73           EJECT
                                    74  *
         000012(0)                  75  X6A_AUTO_1 ALIGN
                                    76  *
 00012   B805                       77           LDR,R3    ,B5                 # words in frame
 00013   0010 0037                  78           ACQ,R3    B7                  get a frame???
 00015   EF87                       79           STB,B6    ,B7                 RET_ADDR
 00016   8747 0002                  80           CL        FR_TYPE,B7          callable
 00018   C284                       81           LLH,R4    ,B4
 00019   4D01                       82           CMV,R4    1
 0001A   0206                       83           BL        NA1,SPREL
 0001B   8C83                       84           LDI       ,B3                 Move PTR
 0001C   8D47 0004                  85           SDI       FR_PARM1,B7
 0001E   83C5 0002                  86           JMP       RETDISP,B5
                                    87  *
         000020(0)                  88  NA1      ALIGN
 00020   9B80 000000                89           LAB,B1    0
 00023   9FC7 0004                  90           STB,B1    FR_PARM1,B7
 00025   83C5 0002                  91           JMP       RETDISP,B5

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:7
                                    92           EJECT
                                    93  *
         000027(0)                  94  X6A_AUTO_2 ALIGN
                                    95  *
 00027   B805                       96           LDR,R3    ,B5                 # words in frame
 00028   0010 0037                  97           ACQ,R3    B7                  get a frame???
 0002A   EF87                       98           STB,B6    ,B7                 RET_ADDR
 0002B   8747 0002                  99           CL        FR_TYPE,B7          callable
 0002D   C284                      100           LLH,R4    ,B4
 0002E   4D01                      101           CMV,R4    1
 0002F   038A                      102           BLE       NA2,SPREL
 00030   8CC3 0002                 103           LDI       2,B3
 00032   8D47 0006                 104           SDI       FR_PARM1+2,B7
         000034(0)                 105  A21      ALIGN
 00034   8C83                      106           LDI       ,B3
 00035   8D47 0004                 107           SDI       FR_PARM1,B7
 00037   83C5 0002                 108           JMP       RETDISP,B5
         000039(0)                 109  NA2      ALIGN
 00039   9B80 000000               110           LAB,B1    0
 0003C   9FC7 0006                 111           STB,B1    FR_PARM1+2,B7
 0003E   0976                      112           BE        A21,SPREL
 0003F   9FC7 0004                 113           STB,B1    FR_PARM1,B7
 00041   83C5 0002                 114           JMP       RETDISP,B5

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:8
                                   115           EJECT
                                   116  *
         000043(0)                 117  X6A_AUTO_3 ALIGN
                                   118  *
 00043   B805                      119           LDR,R3    ,B5                 # words in frame
 00044   0010 0037                 120           ACQ,R3    B7                  get a frame???
 00046   EF87                      121           STB,B6    ,B7                 RET_ADDR
 00047   8747 0002                 122           CL        FR_TYPE,B7          callable
 00049   C284                      123           LLH,R4    ,B4
 0004A   4D02                      124           CMV,R4    2
 0004B   038E                      125           BLE       NA3,SPREL
 0004C   8CC3 0004                 126           LDI       4,B3
 0004E   8D47 0008                 127           SDI       FR_PARM1+4,B7
         000050(0)                 128  A32      ALIGN
 00050   8CC3 0002                 129           LDI       2,B3
 00052   8D47 0006                 130           SDI       FR_PARM1+2,B7
         000054(0)                 131  A31      ALIGN
 00054   8C83                      132           LDI       ,B3
 00055   8D47 0004                 133           SDI       FR_PARM1,B7
 00057   83C5 0002                 134           JMP       RETDISP,B5
         000059(0)                 135  NA3      ALIGN
 00059   9B80 000000               136           LAB,B1    0
 0005C   9FC7 0008                 137           STB,B1    FR_PARM1+4,B7
 0005E   0972                      138           BE        A32,SPREL
 0005F   9FC7 0006                 139           STB,B1    FR_PARM1+2,B7
 00061   49F3                      140           BNEZ,R4   A31,SPREL
 00062   9FC7 0004                 141           STB,B1    FR_PARM1,B7
 00064   83C5 0002                 142           JMP       RETDISP,B5

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:9
                                   143           EJECT
                                   144  *
                                   145  *
         000066(0)                 146  X6A_AUTO_N ALIGN
                                   147  *
 00066   B805                      148           LDR,R3    ,B5                 # words in frame
 00067   0010 0037                 149           ACQ,R3    B7                  get a frame???
 00069   EF87                      150           STB,B6    ,B7                 RET_ADDR
 0006A   8747 0002                 151           CL        FR_TYPE,B7          callable
                                   152  *
 0006C   ABC7 0004                 153           LAB,B2    FR_PARM1,B7
 0006E   C284                      154           LLH,R4    ,B4                 # args passed
 0006F   B845 0001                 155           LDR,R3    1,B5                # args expected
 00071   9853                      156           LDR,R1    R3
 00072   88D1                      157           DEC       R1                  index to last
 00073   B954                      158           CMR,R3    R4
 00074   038A                      159           BLE       ARGSOK,SPREL        passed >= expected
                                   160  *
 00075   A851                      161           LDR,R2    R1
 00076   A254                      162           SUB,R2    R4                  # nils -1
 00077   9B80 000000               163           LAB,B1    0
         00007A(0)                 164  NULLN    ALIGN
 0007A   9F92                      165           STB,B1    ,B2,R1
 0007B   88D1                      166           DEC       R1
 0007C   277E                      167           BDEC,R2   NULLN,SPREL
                                   168  *
 0007D   1804                      169           BLZ,R1    RET,SPREL           ret if none passed
                                   170  *
         00007E(0)                 171  ARGSOK   ALIGN                         /*move those passed*/
 0007E   8C93                      172           LDI       ,B3,R1
 0007F   8D12                      173           SDI       ,B2,R1
 00080   177E                      174           BDEC,R1   ARGSOK,SPREL
                                   175  *
         000081(0)                 176  RET      ALIGN
 00081   83C5 0002                 177           JMP       RETDISP,B5

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:10
                                   178           EJECT
                                   179  *
                                   180  *
         000083(0)                 181  X6A@     ALIGN
         000083(0)                 182  X6A_MAUTO ALIGN
 00083   C284                      183           LLH,R4    ,B4                 # args
 00084   9C83                      184           LDB,B1    ,B3                 operative loc if none passed
 00085   8C81                      185           LDI       ,B1
 00086   4D02                      186           CMV,R4    2
 00087   0384                      187           BLE       X6A_M1,SPREL
 00088   ACC3 0004                 188           LDB,B2    4,B3                one was passed
 0008A   8C82                      189           LDI       ,B2
         00008B(0)                 190  X6A_M1   ALIGN
 0008B   8481                      191           SID       ,B1                 offset between them
 0008C   9C83                      192           LDB,B1    ,B3                 PTR to parm1
 0008D   DC81                      193           LDB,B5    ,B1                 G$TSTACK$
 0008E   9CC3 0002                 194           LDB,B1    2,B3                PTR to parm2
 00090   9801                      195           LDR,R1    ,B1                 size of stack
 00091   9B95                      196           LAB,B1    ,B5,R1              end of stack
 00092   ACD5                      197           LDB,B2    B5
         000093(0)                 198  INITLOOP ALIGN
 00093   8702                      199           CL        ,B2
 00094   ABC2 0001                 200           LAB,B2    1,B2
 00096   ADD1                      201           CMB,B2    B1
 00097   027C                      202           BL        INITLOOP,SPREL
 00098   BBC1 FFFA                 203           LAB,B3    -6,B1               stack head
 0009A   ABC3 FFFC                 204           LAB,B2    -4,B3               BOT_FR
 0009C   BF85                      205           STB,B3    ,B5
 0009D   AFC5 0002                 206           STB,B2    BOT_FR$,B5
 0009F   8D02                      207           SDI       ,B2
 000A0   8405                      208           AID       ,B5
 000A1   8D05                      209           SDI       ,B5
 000A2   8C82                      210           LDI       ,B2
 000A3   8445 0002                 211           AID       2,B5
 000A5   8D45 0002                 212           SDI       2,B5
 000A7   EF82                      213           STB,B6    ,B2                 init bottom frame
CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:11
 000A8   8742 0002                 214           CL        FR_TYPE,B2
 000AA   88C2 0002                 215           DEC       FR_TYPE,B2          MAIN frame type
 000AC   3C04                      216           LDV,R3    4                   size of bottom frame
 000AD   BF42 FFFF                 217           STR,R3    CUR_FR_SIZ,B2
 000AF   8AD3                      218           INC       R3
 000B0   BF03                      219           STR,R3    ,B3                 cur words
 000B1   1EF0                      220           ADV,R1    -16
 000B2   9F43 0001                 221           STR,R1    1,B3                max words
 000B4   83C6 0001                 222           JMP       1,B6
                                   223  *
                                   224  *
         0000B6(0)                 225  X6A_MARET ALIGN
 000B6   0000                      226           HLT

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:12
                                   227           EJECT
                                   228  *
         0000B7(0)                 229  X6A_AUNWIND ALIGN
 000B7   FD83                      230  FNDB7    CMB,B7    ,B3
 000B8   0904                      231           BE        FONB7,SPREL
 000B9   0010 0007                 232           RLQ       B7                  This RLQ releases a frame
 000BB   0FFC                      233           B         FNDB7,SPREL
         0000BC(0)                 234  FONB7   ALIGN
 000BC   CCC3 0002                 235           LDB,B4    2,B3
 000BE   E384                      236           LNJ,B6    ,B4

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:13
                                   237           EJECT
                                   238  *
                                   239  *  X6C_ACM - Character compare
                                   240  *
                                   241  *    B2 - Operand 1 address
                                   242  *    R2 - Operand 1 index
                                   243  *    R6 - Operand 1 length
                                   244  *    B3 - Operand 2 address
                                   245  *    R3 - Operand 2 index
                                   246  *    R7 - Operand 2 length
                                   247  *
                                   248  *
         0000BF(0)                 249  X6C_ACMZ     ALIGN                 WORD
                                   250  *
 000BF   5C00                      251           LDV,R5   0                /* Fill character 0 */
 000C0   0F83                      252           B        ACM1,SPREL
                                   253  *
         0000C1(0)                 254  X6C_ACM      ALIGN                 WORD
                                   255  *
 000C1   D870 2000                 256           LDR,R5   ='2000'X         /* Fill character blank */
                                   257  *
         0000C3(0)                 258  ACM1         ALIGN                 WORD
                                   259  *
 000C3   C870 00FF                 260           LDR,R4   =255             /* Load maximum length  */
 000C5   E954                      261           CMR,R6   R4               /* Is oper 1 len < max len? */
 000C6   0282                      262           BGE      ACM2,SPREL       /* If not, setup oper 2 */
 000C7   C856                      263           LDR,R4   R6               /* If it is, assign oper 1 len */
                                   264  *
         0000C8(0)                 265  ACM2         ALIGN                 WORD
                                   266  *
 000C8   9870 00FF                 267           LDR,R1   =255             /* load maximum length  */
 000CA   F951                      268           CMR,R7   R1               /* Is oper 2 len < max len? */
 000CB   0282                      269           BGE      DO_ACOM,SPREL    /* If not, do the ACM   */
 000CC   9857                      270           LDR,R1   R7               /* If it is, assign oper 2 len */
                                   271  *
         0000CD(0)                 272  DO_ACOM      ALIGN                 WORD
CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:14
                                   273  *
 000CD   DA51                      274           ADD,R5   R1               /* R5 = fill char, & oper 2 len */
 000CE   0022 40220000             275           ACM      ALPHANUM(0,B2,R2,FILL),;  /* Length in R4 */
 000D1   40330000                  276                    ALPHANUM(0,B3,R3,FILL)    /* Fill & len in R5 */
 000D3   5301 0009                 277           CBNE     ACM_RET,PREL
 000D5   AA54                      278           ADD,R2   R4               /* Incr oper 1 index */
 000D6   E254                      279           SUB,R6   R4               /* Update oper 1 remaining len */
 000D7   D570 FF00                 280           AND,R5   ='FF00'X         /* Save fill char in R5 */
 000D9   BA51                      281           ADD,R3   R1               /* Incr oper 2 index */
 000DA   F251                      282           SUB,R7   R1               /* Update oper 2 remaining len */
                                   283  *
 000DB   69E8                      284           BNEZ,R6  ACM1,SPREL
 000DC   79E7                      285           BNEZ,R7  ACM1,SPREL
                                   286  *
         0000DD(0)                 287  ACM_RET       ALIGN                 WORD
                                   288  *
 000DD   C385                      289           LNJ,B4   ,B5              /* RETURN */
                                   290  *
                                   291  *

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:15
                                   292           EJECT
                                   293  *
                                   294  *
         0000DE(0)                 295  X6C_ALRZ ALIGN
                                   296  *
                                   297  *
 000DE   4C00                      298           LDV,R4    0               Fill Character
                                   299  *
         0000DF(0)                 300  ALRZ0    ALIGN
                                   301  *
                                   302  *  B2 - Source addr
                                   303  *  B3 - Dest addr
                                   304  *  R2 - Source offset
                                   305  *  R3 - Dest offset
                                   306  *  R4 - Fill character in left byte, 0 in right byte
                                   307  *  R5 - Size to move from B2 for each CIP
                                   308  *  R6 - Source remaining length
                                   309  *  R7 - Dest remaining length
                                   310  *
         0000DF(0)                 311  ALRZ1    ALIGN
 000DF   E957                      312           CMR,R6   R7       If source is longer than destination
 000E0   0205                      313           BL       ALRZ2,SPREL
 000E1   E857                      314           LDR,R6   R7       We only need to move as many bytes as in t
                                      ::he destination.
 000E2   0008                      315           MMM
 000E3   C3C5 0000                 316           LNJ,B4   0,B5     RETURN
         0000E5(0)                 317  ALRZ2    ALIGN
 000E5   F256                      318           SUB,R7   R6       Find out how much filler we need.
 000E6   0008                      319           MMM
         0000E7(0)                 320  ALRZ3    ALIGN
 000E7   D857                      321           LDR,R5    R7              MOVE REMAINING DEST LENGTH
 000E8   D970 00FF                 322           CMR,R5    =255
 000EA   0383                      323           BLE       ALRZ4,SPREL
 000EB   D870 00FF                 324           LDR,R5    =255
         0000ED(0)                 325  ALRZ4    ALIGN
 000ED   D454                      326           OR,R5     R4              ADD FILL CHAR
CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:16
 000EE   0021 40220000             327           ALR       ALPHANUM(0,B2,R2,FILL),;  len in R4
 000F1   40330000                  328                     ALPHANUM(0,B3,R3,FILL)    len in R5
 000F3   D2D5                      329           LLH,R5   R5          Get rid of fill character
 000F4   F255                      330           SUB,R7    R5
 000F5   BA55                      331           ADD,R3    R5
 000F6   79F1                      332           BNEZ,R7  ALRZ3,SPREL
                                   333  *
 000F7   437F                      334           CSYNC
 000F8   C385                      335           LNJ,B4    ,B5
                                   336  *
                                   337  *
         0000F9(0)                 338  X6C_ALR ALIGN
                                   339  *
 000F9   C870 2000                 340           LDR,R4    ='2000'X        Fill character - blank
 000FB   0FE4                      341           B         ALRZ0,SPREL

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:17
                                   342           EJECT
                                   343  *
                                   344  *  X6B_BLR - Bit move
                                   345  *     B2 - Source address
                                   346  *     B3 - Destination address
                                   347  *     R2 - Source displacement
                                   348  *     R3 - Destination displacement
                                   349  *     R6 - Source length
                                   350  *     R7 - Destination length
                                   351  *
                                   352  *
 000FC   6704                      353  BLR2     BDEC,R6   BLR_GET,SPREL   Source string is non-emtpy
                                   354  *
                                   355  *  Source string is empty - fill destination with zeroes
                                   356  *
 000FD   887F                      357  BLR_FILL LBF       ,B3,R3,PULL
 000FE   777F                      358           BDEC,R7   BLR_FILL,SPREL
 000FF   8385                      359           JMP       ,B5
                                   360  *
                                   361  *  Copy next bit from source to destination
                                   362  *
 00100   82EE                      363  BLR_GET  LB        ,B2,R2,PULL
 00101   8A7F                      364           LBS       ,B3,R3,PULL
                                   365  *
 00102   777A                      366  X6B_BLR  BDEC,R7   BLR2,SPREL      Br if dest string non-empty
 00103   8385                      367           JMP       ,B5             Done when dest exhausted

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:18
                                   368           EJECT
                                   369  *
                                   370  *  X6B_BCM - Bit compare
                                   371  *
                                   372  *    B2 - Source address
                                   373  *    B3 - Destination address
                                   374  *    R2 - Source offset
                                   375  *    R3 - Destination offset
                                   376  *    R6 - Source length
                                   377  *    R7 - Destination length
                                   378  *
                                   379  *
 00104   6706                      380  X6B_BCM  BDEC,R6   BCM2,SPREL      Br if source non-empty
 00105   770A                      381           BDEC,R7   BCM4,SPREL      Br if dest non-empty
 00106   8FC0 001B 0080            382  BCM_EQ   RSTR,'0080'X  IREQ,PREL   Reset G and L indicators
 00109   8385                      383           JMP       ,B5
                                   384  *
 0010A   7709                      385  BCM2     BDEC,R7   BCM6,SPREL      Br if both source and dest non-emp
                                      ::ty
                                   386  *
                                   387  *  Source is non-empty, dest is empty
                                   388  *
 0010B   82EE                      389  BCM3     LB        ,B2,R2,PULL     Load bit into b-bit if I register
 0010C   050E                      390           BBT       BCM_GT,SPREL    Bit set in source, source is great
                                      ::er
 0010D   677E                      391           BDEC,R6   BCM3,SPREL
 0010E   0FF8                      392           B         BCM_EQ,SPREL    Equal
                                   393  *
                                   394  *  Source is empty, dest is non-empty
                                   395  *
 0010F   82FF                      396  BCM4     LB        ,B3,R3,PULL
 00110   050E                      397           BBT       BCM_LT,SPREL    Bit set in dest, source is less
 00111   777E                      398           BDEC,R7   BCM4,SPREL
 00112   0FF4                      399           B         BCM_EQ,SPREL    Equal
                                   400  *
                                   401  *  Both source and dest non-empty, compare next bits
CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:19
                                   402  *
 00113   82EE                      403  BCM6     LB        ,B2,R2,PULL
 00114   0504                      404           BBT       BCM7,SPREL      True
 00115   82FF                      405           LB        ,B3,R3,PULL
 00116   0508                      406           BBT       BCM_LT,SPREL    Source not set, dest set
 00117   0FED                      407           B         X6B_BCM,SPREL
                                   408  *
 00118   82FF                      409  BCM7     LB        ,B3,R3,PULL
 00119   056B                      410           BBT       X6B_BCM,SPREL   Both set
                                   411  *
 0011A   8FC0 0009 0080            412  BCM_GT   RSTR,'0080'X  IRGT,PREL
 0011D   8385                      413           JMP       ,B5
                                   414  *
 0011E   8FC0 0004 0080            415  BCM_LT   RSTR,'0080'X  IRLT,PREL
 00121   8385                      416           JMP       ,B5
                                   417  *
 00122   0000                      418  IREQ     DATA      0
 00123   0002                      419  IRLT     DATA      '0002'X
 00124   0004                      420  IRGT     DATA      '0004'X
                                   421  *
                                   422  *

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:20
                                   423           EJECT
         000125(0)                 424  X6C_MAT         ALIGN     WORD
                                   425  *
                                   426  *  R1 - Source index
                                   427  *  R2 - target index
                                   428  *  R4 - Source length (current loop)
                                   429  *  R5 - Fill char & target length (current loop)
                                   430  *  R6 - Source length (total)
                                   431  *  R7 - Target length (total)
                                   432  *  B1 - Addr of translation table
                                   433  *  B2 - Addr of source
                                   434  *  B3 - Addr of target
                                   435  *
         000125(0)                 436  LOOP            ALIGN     WORD
                                   437  *
 00125   D870 00FF                 438            LDR,R5     =255
 00127   F955                      439            CMR,R7     R5             /* Check remaining target */
 00128   0282                      440            BGE        CHECK_OPR0,SPREL
 00129   D857                      441            LDR,R5     R7
                                   442  *
         00012A(0)                 443  CHECK_OPR0      ALIGN     WORD
                                   444  *
 0012A   C855                      445            LDR,R4     R5             /* Source len <= target len */
 0012B   E954                      446            CMR,R6     R4             /* Check remaining source */
 0012C   0282                      447            BGE        DO_MAT,SPREL
 0012D   C856                      448            LDR,R4     R6
                                   449  *
         00012E(0)                 450  DO_MAT          ALIGN      WORD
                                   451  *
 0012E   D470 2000                 452            OR,R5      ='2000'X       /* Fill char - blank */
 00130   0023 40220000             453            MAT        ALPHANUM(0,B2,R2,FILL),; /* Len in R4 */
 00133   40330000 40110000         454                       ALPHANUM(0,B3,R3,FILL),; /* Fill & len in R5 */
                                   455                       ALPHANUM(0,B1,R1,FILL)   /* Len = 256 */
                                   456  *
 00137   AA54                      457            ADD,R2     R4             /* Incr index for desc 0 */
 00138   E254                      458            SUB,R6     R4             /* Adjust remaining source len */
CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:21
 00139   D2D5                      459            LLH,R5     R5             /* Clear fill char; save len */
 0013A   BA55                      460            ADD,R3     R5             /* Incr index for desc 1 */
 0013B   F255                      461            SUB,R7     R5             /* Adjust remaining target len */
                                   462  *
 0013C   79E9                      463            BNEZ,R7    LOOP,SPREL     /* Check remaining source */
 0013D   437F                      464            CSYNC
 0013E   6982                      465            BNEZ,R6    ALTRET_MAT,SPREL   /* Check remaining target */
                                   466  *
 0013F   C385                      467            LNJ,B4     ,B5
                                   468  *
         000140(0)                 469  ALTRET_MAT       ALIGN      WORD
                                   470  *
 00140   C386                      471            LNJ,B4     ,B6
                                   472  *

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:22
                                   473           EJECT
                                   474  * This routine searches for a single character, then ACMs the rest
                                   475  * of the string.  The reason for this madness is that it's the
                                   476  * simplest method of insuring that we don't miss a comparison due
                                   477  * to the 255 character limits imposed upon us by the CIP.  In other
                                   478  * words, if the character string we are searching for begins at
                                   479  * character 250 for a length of 10, we would miss the comparison
                                   480  * searching from 0 to 255, and then from 256 to 511.
                                   481  *
         00000001                  482  DISPL     EQU  1
         00000002                  483  ARG_LEN   EQU  2
         00000003                  484  STR_LEN   EQU  3
         00000004                  485  ARG_INX   EQU  4
         00000005                  486  STR_INX   EQU  5
                                   487  *
         000141(0)                 488  X6C_SRCH        ALIGN      WORD
                                   489  *
                                   490  *
 00141   C870 0101                 491            LDR,R4     ='0101'X       /* Set up arg register */
 00143   1061                      492            SAR,R1     1
 00144   CB91                      493            LAB,B4     ,B1,R1         /* Get addr of TEMP */
 00145   EF44 0002                 494            STR,R6     ARG_LEN,B4     /* Save search arg len */
 00147   FF44 0003                 495            STR,R7     STR_LEN,B4     /* Save search str len */
 00149   AF44 0004                 496            STR,R2     ARG_INX,B4     /* Save search arg inx */
                                   497  *
         00014B(0)                 498  BEGIN           ALIGN      WORD
                                   499  *
 0014B   E870 00FF                 500            LDR,R6     =255           /* Init R6 for srch */
 0014D   F956                      501            CMR,R7     R6
 0014E   0282                      502            BGE        DO_SRCH,SPREL
 0014F   E857                      503            LDR,R6     R7
                                   504  *
         000150(0)                 505  DO_SRCH         ALIGN     WORD
                                   506  *
 00150   E470 0100                 507            OR,R6      ='0100'X
                                   508  *
CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:23
 00152   0028 40220000             509            SRCH       ALPHANUM(0,B2,R2,FILL),; /* Lengths in R4 */
 00155   40040000 40330000         510                       ALPHANUM(0,B4,0,FILL),;  /* Length = 4 */
                                   511                       ALPHANUM(0,B3,R3,FILL)   /* Lengths in R6 */
                                   512  *
 00159   7328                      513            CBL        NO_MATCH,SPREL
 0015A   F244 0001                 514            SUB,R7     DISPL,B4       /* Adjust remaining srch len */
 0015C   BA44 0001                 515            ADD,R3     DISPL,B4       /* Adjust srch str inx */
 0015E   BF44 0005                 516            STR,R3     STR_INX,B4     /* Save srch str inx */
 00160   E844 0002                 517            LDR,R6     ARG_LEN,B4     /* Get orig arg length */
 00162   F956                      518            CMR,R7     R6             /* Compare S len to T len */
 00163   0224                      519            BL         ALTRET_SRCH,SPREL /* No way this can match */
                                   520  *
         000164(0)                 521  ACM_LOOP        ALIGN     WORD
                                   522  *
 00164   C870 00FF                 523            LDR,R4     =255
 00166   E954                      524            CMR,R6     R4
 00167   0282                      525            BGE        DO_ACM,SPREL
 00168   C856                      526            LDR,R4     R6
                                   527  *
         000169(0)                 528  DO_ACM          ALIGN    WORD
                                   529  *
 00169   D854                      530            LDR,R5     R4             /* Set target length */
                                   531  *
 0016A   0022 40220000             532            ACM        ALPHANUM(0,B2,R2,FILL),; /* Len in R4 */
 0016D   40330000                  533                       ALPHANUM(0,B3,R3,FILL)   /* Len in R5 */
                                   534  *
 0016F   5309                      535            CBNE       ACM_UNEQUAL,SPREL
 00170   AA54                      536            ADD,R2     R4             /* Incr source inx */
 00171   BA55                      537            ADD,R3     R5             /* Incr target inx */
 00172   E254                      538            SUB,R6     R4             /* Adjust remaining target len */
 00173   69F1                      539            BNEZ,R6    ACM_LOOP,SPREL
                                   540  *
 00174   E844 0003                 541            LDR,R6     STR_LEN,B4     /* Get total str len */
 00176   E257                      542            SUB,R6     R7             /* Get result */
 00177   C385                      543            LNJ,B4     ,B5            /* RETURN */
                                   544  *
CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:24
         000178(0)                 545  ACM_UNEQUAL      ALIGN     WORD
                                   546  *
 00178   B844 0005                 547            LDR,R3     STR_INX,B4     /* Get inx into search str */
 0017A   3E01                      548            ADV,R3     1              /* Incr past last match */
 0017B   A844 0004                 549            LDR,R2     ARG_INX,B4     /* Restore arg inx */
                                   550  *                                   /* Adjust remaining len beyond
 0017D   7EFF                      551            ADV,R7     -1             /* the last match */
 0017E   C870 0101                 552            LDR,R4     ='0101'X       /* Re-init R4 */
 00180   0FCB                      553            B          BEGIN,SPREL    /* Continue scanning */
                                   554  *
         000181(0)                 555  NO_MATCH         ALIGN     WORD
                                   556  *
 00181   E2D6                      557            LLH,R6     R6             /* Clear srch data */
 00182   BA56                      558            ADD,R3     R6             /* Incr desc 2 inx */
 00183   F256                      559            SUB,R7     R6             /* Adjust remaining str len */
 00184   F944 0002                 560            CMR,R7     ARG_LEN,B4     /* Remaining len < srch arg ? */
 00186   02C5                      561            BGE        BEGIN,SPREL
                                   562  *
         000187(0)                 563  ALTRET_SRCH      ALIGN     WORD
                                   564  *
 00187   C386                      565            LNJ,B4     ,B6            /* Altreturn */
                                   566  *

CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:25
                                   567           EJECT
                                   568  *
                                   569  * This entry point is for double precision multiplication.  The high
                                   570  * order bytes are treated as signed quantities and the low order
                                   571  * bytes are treated as unsigned quantities.  If the highest bit in
                                   572  * a byte is set the machine "thinks" it's negative.  This is OK for
                                   573  * the high order bytes but not for the low order bytes, hence the
                                   574  * compensation in the code.
                                   575  *
         00000000                  576  BYTE0  EQU 0
         00000001                  577  BYTE1  EQU 1
                                   578  *
         000188(0)                 579  X6D_MID        ALIGN
                                   580
 00188   C856                      581         LDR,R4  R6
 00189   D857                      582         LDR,R5  R7
                                   583
 0018A   FB41 0001                 584         MUL,R7  BYTE1,B1  /* Multiply low-order bytes */
                                   585
                                   586  *                         /* Compare low-order byte of operand 1 */
                                   587  *                         /*  to zero. */
 0018C   5883                      588         BGEZ,R5    CHECK_OPR2,SPREL
 0018D   EA41 0001                 589         ADD,R6  BYTE1,B1  /* If < 0, compensate in the result */
                                   590  *
         00018F(0)                 591  CHECK_OPR2     ALIGN     WORD
                                   592  *
 0018F   89C1 0001                 593         CMZ     BYTE1,B1  /* Compare low-order byte of operand 2 */
                                   594  *                         /* to zero. */
 00191   0882                      595         BAGE    SKIP_OPR2,SPREL
 00192   EA55                      596         ADD,R6  R5         /* If < 0, compensate in the result */
                                   597  *
         000193(0)                 598  SKIP_OPR2      ALIGN     WORD
                                   599  *
 00193   9856                      600         LDR,R1  R6         /* Save current contents of R6 */
 00194   A857                      601         LDR,R2  R7         /* Save current contents of R7 */
                                   602  *
CALF.D00   OU Name=X6A_MAUTO               File=X6A$CSEQM.:E05TSI               WED JUL 30 '97 09:07 Page:26
                                   603  *                         /* Restore original high order byte of */
                                   604  *                         /* operand 1, then... */
                                   605  *                         /* Cross multiply high-order byte of */
                                   606  *                         /* operand 1 with low-order byte of  */
                                   607  *                         /* operand 2 */
 00195   F854                      608         LDR,R7  R4
 00196   FB41 0001                 609         MUL,R7  BYTE1,B1
 00198   9A57                      610         ADD,R1  R7
                                   611  *
                                   612  *                         /* Restore original low-order byte of */
                                   613  *                         /* operand 1, then... */
                                   614  *                         /* Cross multiply low-order byte of */
                                   615  *                         /* operand 2 with low-order byte of */
                                   616  *                         /* operand 1 */
 00199   F855                      617         LDR,R7  R5
 0019A   FB01                      618         MUL,R7  ,B1           BYTE0
 0019B   9A57                      619         ADD,R1  R7
                                   620  *
 0019C   E851                      621         LDR,R6  R1         /* Store high-order byte of result */
 0019D   F852                      622         LDR,R7  R2         /* Store low-order byte of result */
 0019E   C385                      623         LNJ,B4  ,B5        /* Return */
                                   624  *
         00019F(0)                 625  X6AEND@  ALIGN
                                   626           END
      No Errors in this assembly.
