VERSION E05

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:1    
        1        1        /*M* KXF$FRAME  -  X.25 Handler Frame Level Subroutine      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*X*   PLM = 4, IND=3, CTI=3, DCI=6, IAD=0, DTI=6, AND=Y, CSI=3, THI=3, STI=3, DMC=Y
                 8         */
        9        9        /*P* NAME: KXF$FRAME                                      */
       10       10        /*P* PURPOSE: This module contains the X.25 frame level   */
       11       11        /*P* subroutine and state machine.                        */
       12       12
       13       13        KXF$FRAME: PROC ( FPT_X25 ) ALTRET;
       14       14
       15       15        /*F* NAME: KXF$FRAME                                      */
       16       16        /*F* PURPOSE: This subroutine does the normal state       */
       17       17        /*F* transitions for the X.25 frame level.                */
       18       18
       19       19        /*D* NAME: KXF$FRAME                                      */
       20       20        /*D* PURPOSE: This subroutine does the normal state       */
       21       21        /*D* transitions for the X.25 frame level.                */
       22       22        /*D* CALL: CALL KXF$FRAME, ARGS ( FEVENT, *D* CTX$, *D* DAT$ )   */
       23       23        /*D* INPUT: FEVENT  =  frame event type                     */
       24       24        /*D* CTX$  =  line context block pointer                    */
       25       25        /*D* DAT$  =  data pointer  ( optional )                        */
       26       26        /*D* OUTPUT: none                                         */
       27       27
       28       28        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:2    
       29       29
       30       30        /* Include files                                           */
       31       31
       32       32        %INCLUDE K_ID_E;
       33       82        %K#ENTID_E;
       34      101        %K#LYRID_E;
       35      108        %INCLUDE KL_MACRO_C;
       36     3460        %INCLUDE KL_AFCN_C;
       37     3561        %INCLUDE LCP_6;
       38     7840        %INCLUDE CP_6_SUBS;
       39     8380        %INCLUDE G_JIT_M;
       40     8645        %INCLUDE KH$CHN;
       41     8767        %INCLUDE KH$CLK;
       42     9137        %INCLUDE KHA_FNC_E;
       43     9237        %INCLUDE KH_CLKFNC_E;
       44     9282        %INCLUDE KH_MACRO_C;
       45    10025        %INCLUDE KL_SUPER_C;
       46    12927        %INCLUDE KX_EQUS_E;
       47    13366        %INCLUDE KX_PERR_C;
       48    13495        %INCLUDE KX_SCODE_C;
       49    13561        %INCLUDE KX_DATA_C;
       50    13629        %INCLUDE KX_MACROS_M;
       51    14400        %INCLUDE KV_GLB;
       52    14423        %INCLUDE KV_GLBCNS_E;
       53    14764        %INCLUDE K_ADDRESS_M;
       54    15267        %INCLUDE KNH_MACRO_C;
       55    15550        %KV#CQ_HNDID_E;
       56    15555        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:3    
       57    15556        /*****************************************************************
       58    15557        *                                                                *
       59    15558        *                           Refs (inside X.25)                   *
       60    15559        *                                                                *
       61    15560        *****************************************************************/
       62    15561
       63    15562    1   DCL KHA$TSTCNC ENTRY (1) ALTRET;
       64    15563    1   DCL KHA$DVCADM ENTRY (6) ALTRET;
       65    15564    1   DCL KHA$LINE_ACTIVE ENTRY (1);
       66    15565    1   DCL KHA$LINE_INACTIVE ENTRY (1);
       67    15566    1   DCL KXC$CQSCN ENTRY (1);
       68    15567    1   DCL KXN$CMND ENTRY (3);
       69    15568    1   DCL KXP$PACKET ENTRY (1) ALTRET;
       70    15569    1   DCL KXS$GETBFR ENTRY (3) ALTRET;
       71    15570    1   DCL KXS$GETCNTX ENTRY (2) ALTRET;
       72    15571    1   DCL KXS$RLSBFR ENTRY (1);
       73    15572    1   DCL KXS$RLSCNTX ENTRY (1);
       74    15573    1   DCL KXS$Q_SYSLOG ENTRY (1);
       75    15574    1   DCL KXS$SYSLOG ENTRY (7);
       76    15575    1   DCL KXS$TMR ENTRY (1);
       77    15576    1   DCL KXX$X29 ENTRY (1);
       78    15577    1   DCL KHD$SCREECH ENTRY (1);
       79    15578    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
       80    15579    1   DCL KVB$GETSYS ENTRY (2) ALTRET;
       81    15580
       82    15581        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:4    
       83    15582        /*****************************************************************
       84    15583        *                                                                *
       85    15584        *                           Local equates                        *
       86    15585        *                                                                *
       87    15586        *****************************************************************/
       88    15587
       89    15588        /*****************************************************************
       90    15589        *                                                                *
       91    15590        *                           Action types                         *
       92    15591        *                                                                *
       93    15592        *****************************************************************/
       94    15593
       95    15594        %EQU Y_ACT_MIN# = 0;
       96    15595        %EQU Y_ACT_NULL# = 0;
       97    15596        %EQU Y_ACT_SCREECH# = 1;
       98    15597        %EQU Y_ACT_LOG# = 2;
       99    15598        %EQU Y_ACT_START# = 3;
      100    15599        %EQU Y_ACT_STOP# = 4;
      101    15600        %EQU Y_ACT_DISC_RETRY1# = 5;
      102    15601        %EQU Y_ACT_UA# = 6;
      103    15602        %EQU Y_ACT_SABM# = 7;
      104    15603        %EQU Y_ACT_DISC_R# = 8;
      105    15604        %EQU Y_ACT_DISC_L# = 9;
      106    15605        %EQU Y_ACT_DISC_LU# = 10;
      107    15606        %EQU Y_ACT_SABM_P# = 11;
      108    15607        %EQU Y_ACT_UP# = 12;
      109    15608        %EQU Y_ACT_DM# = 13;
      110    15609        %EQU Y_ACT_SABM_PR# = 14;
      111    15610        %EQU Y_ACT_DISC# = 15;
      112    15611        %EQU Y_ACT_RR_P# = 16;
      113    15612        %EQU Y_ACT_CL_BUSY# = 17;
      114    15613        %EQU Y_ACT_CL_REJ# = 18;
      115    15614        %EQU Y_ACT_DATA_OUT# = 19;
      116    15615        %EQU Y_ACT_DATA_IN# = 20;
      117    15616        %EQU Y_ACT_SABM_U# = 21;
      118    15617        %EQU Y_ACT_FRMR# = 22;
      119    15618        %EQU Y_ACT_RESP# = 23;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:5    
      120    15619        %EQU Y_ACT_REJ# = 24;
      121    15620        %EQU Y_ACT_RESET# = 25;
      122    15621        %EQU Y_ACT_RESET_P# = 26;
      123    15622        %EQU Y_ACT_CL_RESET# = 27;
      124    15623        %EQU Y_ACT_DATA_IN_S# = 28;
      125    15624        %EQU Y_ACT_CL_TR# = 29;
      126    15625        %EQU Y_ACT_RR_PR# = 30;
      127    15626        %EQU Y_ACT_DISC_NV# = 31;
      128    15627        %EQU Y_ACT_DISC_UNV# = 32;
      129    15628        %EQU Y_ACT_UP_UA# = 33;
      130    15629        %EQU Y_ACT_FRMR_TO# = 34;
      131    15630        %EQU Y_ACT_SP3# = 35;
      132    15631        %EQU Y_ACT_MAX# = 35;
      133    15632
      134    15633        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:6    
      135    15634        /*****************************************************************
      136    15635        *                                                                *
      137    15636        *                           Frame types                          *
      138    15637        *                                                                *
      139    15638        *****************************************************************/
      140    15639
      141    15640        %EQU Y_CTL_MIN# = BITBIN( '01'X );
      142    15641        %EQU Y_CTL_RR# = BITBIN( '01'X );
      143    15642        %EQU Y_CTL_RR_P# = BITBIN( '11'X );
      144    15643        %EQU Y_CTL_RR_F# = BITBIN( '11'X );
      145    15644        %EQU Y_CTL_RNR# = BITBIN( '05'X );
      146    15645        %EQU Y_CTL_RNR_P# = BITBIN( '15'X );
      147    15646        %EQU Y_CTL_REJ# = BITBIN( '09'X );
      148    15647        %EQU Y_CTL_REJ_P# = BITBIN( '19'X );
      149    15648        %EQU Y_CTL_DM# = BITBIN( '0F'X );
      150    15649        %EQU Y_CTL_DM_F# = BITBIN( '1F'X );
      151    15650        %EQU Y_CTL_SABM# = BITBIN( '2F'X );
      152    15651        %EQU Y_CTL_SABM_P# = BITBIN( '3F'X );
      153    15652        %EQU Y_CTL_DISC# = BITBIN( '43'X );
      154    15653        %EQU Y_CTL_DISC_P# = BITBIN( '53'X );
      155    15654        %EQU Y_CTL_UA# = BITBIN( '63'X );
      156    15655        %EQU Y_CTL_UA_F# = BITBIN( '73'X );
      157    15656        %EQU Y_CTL_FRMR# = BITBIN( '87'X );
      158    15657        %EQU Y_CTL_FRMR_F# = BITBIN( '97'X );
      159    15658        %EQU Y_CTL_SABME#=BITBIN('6F'X);
      160    15659        %EQU Y_CTL_SABME_P#=BITBIN('7F'X);
      161    15660        %EQU Y_CTL_MAX# = BITBIN( '97'X );
      162    15661
      163    15662        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:7    
      164    15663        /*****************************************************************
      165    15664        *                                                                *
      166    15665        *                           Event types                          *
      167    15666        *                                                                *
      168    15667        *****************************************************************/
      169    15668
      170    15669        %EQU Y_EV_MIN# = 0;
      171    15670        %EQU Y_EV_START# = 0;
      172    15671        %EQU Y_EV_STOP# = 1;
      173    15672        %EQU Y_EV_DIED# = 2;
      174    15673        %EQU Y_EV_TO_RC_LT_N2# = 3;
      175    15674        %EQU Y_EV_TO_RC_GE_N2# = 4;
      176    15675        %EQU Y_EV_CL_BUSY# = 5;
      177    15676        %EQU Y_EV_CL_REJ# = 6;
      178    15677        %EQU Y_EV_DATA_OUT# = 7;
      179    15678        %EQU Y_EV_I# = 8;
      180    15679        %EQU Y_EV_SABM# = 9;
      181    15680        %EQU Y_EV_DISC# = 10;
      182    15681        %EQU Y_EV_UA# = 11;
      183    15682        %EQU Y_EV_UA_F# = 12;
      184    15683        %EQU Y_EV_DM# = 13;
      185    15684        %EQU Y_EV_RR# = 14;
      186    15685        %EQU Y_EV_RR_F# = 15;
      187    15686        %EQU Y_EV_RNR# = 16;
      188    15687        %EQU Y_EV_RNR_F# = 17;
      189    15688        %EQU Y_EV_REJ# = 18;
      190    15689        %EQU Y_EV_REJ_F# = 19;
      191    15690        %EQU Y_EV_FRMR# = 20;
      192    15691        %EQU Y_EV_FRMR_F# = 21;
      193    15692        %EQU Y_EV_BAD_F# = 22;
      194    15693        %EQU Y_EV_BAD_NR# = 23;
      195    15694        %EQU Y_EV_BAD_ADR# = 24;
      196    15695        %EQU Y_EV_GARBAGE# = 25;
      197    15696        %EQU Y_EV_BAD_IFLD# = 26;
      198    15697        %EQU Y_EV_SP1# = 27;
      199    15698        %EQU Y_EV_SP2# = 28;
      200    15699        %EQU Y_EV_SP3# = 29;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:8    
      201    15700        %EQU Y_EV_MAX# = 29;
      202    15701
      203    15702        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:9    
      204    15703        /*****************************************************************
      205    15704        *                                                                *
      206    15705        *                           States                               *
      207    15706        *                                                                *
      208    15707        *****************************************************************/
      209    15708
      210    15709        %EQU Y_ST_MIN# = 0;
      211    15710        %EQU Y_ST_NULL# = 0;
      212    15711        %EQU Y_ST_DISC# = 1;
      213    15712        %EQU Y_ST_SETUP# = 2;
      214    15713        %EQU Y_ST_SETUP_TO# = 3;
      215    15714        %EQU Y_ST_NORMAL# = 4;
      216    15715        %EQU Y_ST_RESET# = 5;
      217    15716        %EQU Y_ST_RESET_TO# = 6;
      218    15717        %EQU Y_ST_FRMR# = 7;
      219    15718        %EQU Y_ST_TIMER_REC# = 8;
      220    15719        %EQU Y_ST_SP1# = 9;
      221    15720        %EQU Y_ST_SP2# = 10;
      222    15721        %EQU Y_ST_SP3# = 11;
      223    15722        %EQU Y_ST_MAX# = 11;
      224    15723
      225    15724        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:10   
      226    15725        /*****************************************************************
      227    15726        *                                                                *
      228    15727        *                           Supervisory frame types              *
      229    15728        *                                                                *
      230    15729        *****************************************************************/
      231    15730
      232    15731        %EQU Y_TYPE_MIN# = 0;
      233    15732        %EQU Y_TYPE_RR# = 0;
      234    15733        %EQU Y_TYPE_RNR# = 2;
      235    15734        %EQU Y_TYPE_REJ# = 4;
      236    15735        %EQU Y_TYPE_MAX# = 4;
      237    15736        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:11   
      238    15737        /*****************************************************************
      239    15738        *                                                                *
      240    15739        *                           Constant data                        *
      241    15740        *                                                                *
      242    15741        *****************************************************************/
      243    15742
      244    15743    1   DCL FRMR_REASON (0:%(%Y_EV_MAX#+1)) CONSTANT UBIN BYTE UNAL INIT ( 1*23,8,1,4,3,1*0
             15743            );
      245    15744        %KX$LINKDEV ( FPTN = KX_LINKDEV, STCLASS = CONSTANT );
      246    15771
      247    15772        /*****************************************************************
      248    15773        *                                                                *
      249    15774        *                           The magic state table                *
      250    15775        *                                                                *
      251    15776        *****************************************************************/
      252    15777
      253    15778    1   DCL 1 STATE_TABLE CONSTANT,
      254    15779    1         2 NEXT_STATE (0:%(%(%Y_EV_MAX# + 1) * %(%Y_ST_MAX# + 1)-1)) UBIN(8) UNAL
      255    15780    1    INIT(
      256    15781
      257    15782        /*  Null state - next states */
      258    15783
      259    15784    1    %Y_ST_DISC#,%Y_ST_NULL#,%Y_ST_NULL#,
      260    15785    1    %Y_ST_NULL#,%Y_ST_NULL#,
      261    15786    1    %Y_ST_NULL#,%Y_ST_NULL#,
      262    15787    1    %Y_ST_NULL#,%Y_ST_NULL#,
      263    15788    1    %Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,
      264    15789    1    %Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,
      265    15790    1    %Y_ST_NULL#,%Y_ST_NULL#,
      266    15791    1    %Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,
      267    15792    1    %Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,
      268    15793
      269    15794        /*  Disc state - next states */
      270    15795
      271    15796    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,
      272    15797    1    %Y_ST_DISC#,%Y_ST_DISC#,
      273    15798    1    %Y_ST_DISC#,%Y_ST_DISC#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:12   
      274    15799    1    %Y_ST_DISC#,%Y_ST_DISC#,
      275    15800    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      276    15801    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,
      277    15802    1    %Y_ST_DISC#,%Y_ST_DISC#,
      278    15803    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,
      279    15804    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,
      280    15805
      281    15806        /*  Setup state - next states */
      282    15807
      283    15808    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      284    15809    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP#,
      285    15810    1    %Y_ST_SETUP#,%Y_ST_SETUP#,
      286    15811    1    %Y_ST_SETUP#,%Y_ST_SETUP#,
      287    15812    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_NORMAL#,%Y_ST_SETUP#,%Y_ST_SETUP_TO#,
      288    15813    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      289    15814    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      290    15815    1    %Y_ST_SETUP#,%Y_ST_SETUP#,
      291    15816    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      292    15817    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      293    15818
      294    15819        /*  Setup time out state - next states */
      295    15820
      296    15821    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      297    15822    1    %Y_ST_SETUP_TO#,%Y_ST_DISC#,
      298    15823    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      299    15824    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      300    15825    1    %Y_ST_SETUP_TO#,%Y_ST_DISC#,%Y_ST_SETUP_TO#,%Y_ST_NORMAL#,
      301    15826    1    %Y_ST_SETUP_TO#,
      302    15827    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      303    15828    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      304    15829    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      305    15830    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      306    15831    1    %Y_ST_SETUP_TO#,
      307    15832    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      308    15833
      309    15834        /*  Normal state - next states */
      310    15835
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:13   
      311    15836    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,%Y_ST_NORMAL#,
      312    15837    1    %Y_ST_TIMER_REC#,%Y_ST_RESET#,
      313    15838    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,
      314    15839    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,
      315    15840    1    %Y_ST_NORMAL#,%Y_ST_DISC#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_RESET#,
      316    15841    1    %Y_ST_NORMAL#,%Y_ST_FRMR#,%Y_ST_NORMAL#,
      317    15842    1    %Y_ST_FRMR#,%Y_ST_NORMAL#,%Y_ST_FRMR#,
      318    15843    1    %Y_ST_RESET#,%Y_ST_FRMR#,
      319    15844    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_NORMAL#,%Y_ST_FRMR#,
      320    15845    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,%Y_ST_NORMAL#,
      321    15846
      322    15847        /*  Reset state - next states */
      323    15848
      324    15849    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      325    15850    1    %Y_ST_RESET_TO#,%Y_ST_RESET#,
      326    15851    1    %Y_ST_RESET#,%Y_ST_RESET#,
      327    15852    1    %Y_ST_RESET#,%Y_ST_RESET#,
      328    15853    1    %Y_ST_RESET#,%Y_ST_DISC#,%Y_ST_NORMAL#,%Y_ST_RESET#,%Y_ST_SETUP_TO#,
      329    15854    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      330    15855    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      331    15856    1    %Y_ST_RESET#,%Y_ST_RESET#,
      332    15857    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      333    15858    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      334    15859
      335    15860        /*  Reset time out state - next states */
      336    15861
      337    15862    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      338    15863    1    %Y_ST_RESET_TO#,%Y_ST_DISC#,
      339    15864    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      340    15865    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      341    15866    1    %Y_ST_RESET_TO#,%Y_ST_DISC#,%Y_ST_RESET_TO#,%Y_ST_NORMAL#,
      342    15867    1    %Y_ST_SETUP_TO#,
      343    15868    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      344    15869    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      345    15870    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      346    15871    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      347    15872    1    %Y_ST_RESET_TO#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:14   
      348    15873    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      349    15874
      350    15875        /*  Frame reject state - next states */
      351    15876
      352    15877    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,
      353    15878    1    %Y_ST_FRMR#,%Y_ST_RESET#,
      354    15879    1    %Y_ST_FRMR#,%Y_ST_FRMR#,
      355    15880    1    %Y_ST_FRMR#,%Y_ST_FRMR#,
      356    15881    1    %Y_ST_NORMAL#,%Y_ST_DISC#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_RESET#,
      357    15882    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,
      358    15883    1    %Y_ST_RESET#,%Y_ST_FRMR#,
      359    15884    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,
      360    15885    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,
      361    15886
      362    15887        /*  Timer recovery state - next states */
      363    15888
      364    15889    1    %Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,
      365    15890    1    %Y_ST_TIMER_REC#,%Y_ST_RESET#,
      366    15891    1    %Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,
      367    15892    1    %Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,
      368    15893    1    %Y_ST_NORMAL#,%Y_ST_DISC#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_RESET#,
      369    15894    1    %Y_ST_TIMER_REC#,%Y_ST_NORMAL#,%Y_ST_TIMER_REC#,
      370    15895    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,%Y_ST_NORMAL#,
      371    15896    1    %Y_ST_RESET#,%Y_ST_RESET#,
      372    15897    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_TIMER_REC#,%Y_ST_FRMR#,
      373    15898    1    %Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,
      374    15899
      375    15900        /*  Spare state #1 - next states */
      376    15901
      377    15902    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
      378    15903    1    %Y_ST_SP1#,%Y_ST_SP1#,
      379    15904    1    %Y_ST_SP1#,%Y_ST_SP1#,
      380    15905    1    %Y_ST_SP1#,%Y_ST_SP1#,
      381    15906    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
      382    15907    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
      383    15908    1    %Y_ST_SP1#,%Y_ST_SP1#,
      384    15909    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:15   
      385    15910    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
      386    15911
      387    15912        /*  Spare state #2 - next states */
      388    15913
      389    15914    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      390    15915    1    %Y_ST_SP2#,%Y_ST_SP2#,
      391    15916    1    %Y_ST_SP2#,%Y_ST_SP2#,
      392    15917    1    %Y_ST_SP2#,%Y_ST_SP2#,
      393    15918    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      394    15919    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      395    15920    1    %Y_ST_SP2#,%Y_ST_SP2#,
      396    15921    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      397    15922    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      398    15923
      399    15924        /*  Spare state #3 - next states */
      400    15925
      401    15926    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,
      402    15927    1    %Y_ST_SP3#,%Y_ST_SP3#,
      403    15928    1    %Y_ST_SP3#,%Y_ST_SP3#,
      404    15929    1    %Y_ST_SP3#,%Y_ST_SP3#,
      405    15930    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,
      406    15931    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,
      407    15932    1    %Y_ST_SP3#,%Y_ST_SP3#,
      408    15933    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,
      409    15934    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#),
      410    15935
      411    15936    1         2 ACTION (0:%(%(%Y_EV_MAX# + 1) * %(%Y_ST_MAX# + 1)-1)) UBIN(8) UNAL
      412    15937    1    INIT(
      413    15938
      414    15939        /*  Null state - actions */
      415    15940
      416    15941    1    %Y_ACT_START#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      417    15942    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      418    15943    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      419    15944    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      420    15945    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      421    15946    1    %Y_ACT_SCREECH#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:16   
      422    15947    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      423    15948    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      424    15949    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      425    15950    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      426    15951    1    %Y_ACT_SCREECH#,
      427    15952    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      428    15953
      429    15954        /*  Disc state - actions */
      430    15955
      431    15956    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      432    15957    1   %Y_ACT_DISC_R#,%Y_ACT_DISC_RETRY1#,
      433    15958    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      434    15959    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      435    15960    1    %Y_ACT_NULL#,%Y_ACT_UA#,%Y_ACT_SABM#,%Y_ACT_SABM#,%Y_ACT_SABM#,
      436    15961    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      437    15962    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      438    15963    1    %Y_ACT_NULL#,%Y_ACT_NULL#,
      439    15964    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      440    15965    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      441    15966
      442    15967        /*  Setup state - actions */
      443    15968
      444    15969    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      445    15970    1    %Y_ACT_SABM_P#,%Y_ACT_SCREECH#,
      446    15971    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      447    15972    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      448    15973    1    %Y_ACT_UA#,%Y_ACT_UA#,%Y_ACT_UP#,%Y_ACT_NULL#,%Y_ACT_SABM_P#,
      449    15974    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      450    15975    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      451    15976    1    %Y_ACT_NULL#,%Y_ACT_NULL#,
      452    15977    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      453    15978    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      454    15979
      455    15980        /*  Setup time out state - actions */
      456    15981
      457    15982    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      458    15983    1    %Y_ACT_SABM_PR#,%Y_ACT_DISC#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:17   
      459    15984    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      460    15985    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      461    15986    1    %Y_ACT_UA#,%Y_ACT_DISC_UNV#,%Y_ACT_NULL#,%Y_ACT_UP#,%Y_ACT_SABM_P#,
      462    15987    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      463    15988    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      464    15989    1    %Y_ACT_NULL#,%Y_ACT_NULL#,
      465    15990    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      466    15991    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      467    15992
      468    15993        /*  Normal state - actions */
      469    15994
      470    15995    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      471    15996    1    %Y_ACT_RR_P#,%Y_ACT_RESET#,
      472    15997    1    %Y_ACT_CL_BUSY#,%Y_ACT_CL_REJ#,
      473    15998    1    %Y_ACT_DATA_OUT#,%Y_ACT_DATA_IN#,
      474    15999    1    %Y_ACT_SABM_U#,%Y_ACT_DISC_LU#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,
      475    16000    1    %Y_ACT_RESET_P#,
      476    16001    1    %Y_ACT_RESP#,%Y_ACT_FRMR#,%Y_ACT_RESP#,
      477    16002    1    %Y_ACT_FRMR#,%Y_ACT_REJ#,%Y_ACT_FRMR#,
      478    16003    1    %Y_ACT_RESET#,%Y_ACT_FRMR#,
      479    16004    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_LOG#,%Y_ACT_FRMR#,
      480    16005    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      481    16006
      482    16007        /*  Reset state - actions */
      483    16008
      484    16009    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      485    16010    1    %Y_ACT_RESET_P#,%Y_ACT_SCREECH#,
      486    16011    1    %Y_ACT_CL_BUSY#,%Y_ACT_SCREECH#,
      487    16012    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      488    16013    1    %Y_ACT_UA#,%Y_ACT_DISC_LU#,%Y_ACT_CL_RESET#,%Y_ACT_NULL#,
      489    16014    1    %Y_ACT_SABM_P#,
      490    16015    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      491    16016    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      492    16017    1    %Y_ACT_RESET#,%Y_ACT_NULL#,
      493    16018    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      494    16019    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      495    16020
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:18   
      496    16021        /*  Reset time out state - actions */
      497    16022
      498    16023    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      499    16024    1    %Y_ACT_SABM_PR#,%Y_ACT_DISC_L#,
      500    16025    1    %Y_ACT_CL_BUSY#,%Y_ACT_SCREECH#,
      501    16026    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      502    16027    1    %Y_ACT_UA#,%Y_ACT_DISC_LU#,%Y_ACT_NULL#,%Y_ACT_CL_RESET#,%Y_ACT_SABM_P#,
      503    16028    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      504    16029    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      505    16030    1    %Y_ACT_SABM_PR#,%Y_ACT_SABM_PR#,
      506    16031    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      507    16032    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      508    16033
      509    16034        /*  Frame reject state - actions */
      510    16035
      511    16036    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      512    16037    1    %Y_ACT_FRMR_TO#,%Y_ACT_RESET#,
      513    16038    1    %Y_ACT_CL_BUSY#,%Y_ACT_SCREECH#,
      514    16039    1    %Y_ACT_SCREECH#,%Y_ACT_FRMR#,
      515    16040    1    %Y_ACT_SABM_U#,%Y_ACT_DISC_LU#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,
      516    16041    1    %Y_ACT_RESET#,
      517    16042    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,
      518    16043    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,
      519    16044    1    %Y_ACT_RESET#,%Y_ACT_FRMR#,
      520    16045    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_LOG#,%Y_ACT_FRMR#,
      521    16046    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      522    16047
      523    16048        /*  Timer recovery state - actions */
      524    16049
      525    16050    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      526    16051    1    %Y_ACT_RR_PR#,%Y_ACT_RESET#,
      527    16052    1    %Y_ACT_CL_BUSY#,%Y_ACT_CL_REJ#,
      528    16053    1    %Y_ACT_SCREECH#,%Y_ACT_DATA_IN#,
      529    16054    1    %Y_ACT_SABM_U#,%Y_ACT_DISC_LU#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_RESET#,
      530    16055    1    %Y_ACT_RESP#,%Y_ACT_CL_TR#,%Y_ACT_RESP#,
      531    16056    1    %Y_ACT_CL_TR#,%Y_ACT_REJ#,%Y_ACT_REJ#,
      532    16057    1    %Y_ACT_RESET#,%Y_ACT_RESET#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:19   
      533    16058    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_LOG#,%Y_ACT_FRMR#,
      534    16059    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      535    16060
      536    16061        /*  Spare state #1 - actions */
      537    16062
      538    16063    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      539    16064    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      540    16065    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      541    16066    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      542    16067    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      543    16068    1    %Y_ACT_SCREECH#,
      544    16069    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      545    16070    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      546    16071    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      547    16072    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      548    16073    1    %Y_ACT_SCREECH#,
      549    16074    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      550    16075
      551    16076        /*  Spare state #2 - actions */
      552    16077
      553    16078    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      554    16079    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      555    16080    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      556    16081    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      557    16082    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      558    16083    1    %Y_ACT_SCREECH#,
      559    16084    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      560    16085    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      561    16086    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      562    16087    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      563    16088    1    %Y_ACT_SCREECH#,
      564    16089    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      565    16090
      566    16091        /*  Spare state #3 - actions */
      567    16092
      568    16093    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      569    16094    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:20   
      570    16095    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      571    16096    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      572    16097    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      573    16098    1    %Y_ACT_SCREECH#,
      574    16099    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      575    16100    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      576    16101    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      577    16102    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      578    16103    1    %Y_ACT_SCREECH#,
      579    16104    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#);
      580    16105        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:21   
      581    16106        /*****************************************************************
      582    16107        *                                                                *
      583    16108        *                           WRSYSLOG VLPs                        *
      584    16109        *                                                                *
      585    16110        *****************************************************************/
      586    16111
      587    16112        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_FATAL_PROT#,
      588    16113                           FPTN = DISC,
      589    16114                           ERR# = %E_KXF_DISC# );
      590    16160        /*E*   ERROR:      KXF-E_KXF_DISC#-4
      591    16161               MESSAGE:    Time-out & retry exhausted in link set-up.
      592    16162        */
      593    16163        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_FATAL_PROT#,
      594    16164                           FPTN = DISC_L,
      595    16165                           ERR# = %E_KXF_DISC_L# );
      596    16211        /*E*   ERROR:      KXF-E_KXF_DISC_L#-4
      597    16212               MESSAGE:    Time-out & retry exhausted in link reset.
      598    16213        */
      599    16214        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_FATAL_PROT#,
      600    16215                           FPTN = DISC_LU,
      601    16216                           ERR# = %E_KXF_DISC_LU# );
      602    16262        /*E*   ERROR:      KXF-E_KXF_DISC_LU#-4
      603    16263               MESSAGE:    DISC frame received in data transfer state.
      604    16264        */
      605    16265        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_FATAL_PROT#,
      606    16266                           FPTN = DM,
      607    16267                           ERR# = %E_KXF_DM# );
      608    16313        /*E*   ERROR:      KXF-E_KXF_DM#-4
      609    16314               MESSAGE:    DM frame received during set-up procedure.
      610    16315        */
      611    16316        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_SOFT#,
      612    16317                           FPTN = FRMR,
      613    16318                           ERR# = %E_KXF_FRMR# );
      614    16364        /*E*   ERROR:      KXF-E_KXF_FRMR#-3
      615    16365               MESSAGE:    FRMR received in data transfer state.
      616    16366                           FRMR data recorded in VAL0, VAL1, and VAL2.
      617    16367        */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:22   
      618    16368        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_SOFT#,
      619    16369                           FPTN = LOG,
      620    16370                           ERR# = %E_KXF_LOG# );
      621    16416        /*E*   ERROR:      KXF-E_KXF_LOG#-3
      622    16417               MESSAGE:    An unexpected frame/event has been reported.
      623    16418                           VAL(0) is the internal event.  VAL(1) is the external event.
      624    16419                           VAL(2) is the state information.
      625    16420        */
      626    16421        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_NONFATAL_PROT#,
      627    16422                           FPTN = RESET,
      628    16423                           ERR# = %E_KXF_RESET# );
      629    16469        /*E*   ERROR:      KXF-E_KXF_RESET#-5
      630    16470               MESSAGE:    A link reset procedure was started.
      631    16471                           VAL(0) is the internal event.  VAL(1) is the external event.
      632    16472                           VAL(2) is the state information.
      633    16473        */
      634    16474        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_NONFATAL_PROT#,
      635    16475                           FPTN = T20TIMEOUT,
      636    16476                           ERR# = %E_KXF_T20TIMEOUT# );
      637    16522        /*E*   ERROR:      KXF-E_KXF_T20TIMEOUT#-5
      638    16523               MESSAGE:    Restart timer expired before getting restart confirm.
      639    16524        */
      640    16525        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_INFO#,
      641    16526                           FPTN = START,
      642    16527                           ERR# = %E_KXF_START# );
      643    16573        /*E*   ERROR:      KXF-E_KXF_START#-0
      644    16574               MESSAGE:    DSR and CTS are present. Line started.
      645    16575        */
      646    16576        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_INFO#,
      647    16577                           FPTN = UP,
      648    16578                           ERR# = %E_KXF_UP# );
      649    16624        /*E*   ERROR:      KXF-E_KXF_UP#-0
      650    16625               MESSAGE:    A line completed set-up procedures.
      651    16626        */
      652    16627        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_INFO#,
      653    16628                           FPTN = EXTENDED_FORMAT,
      654    16629                           ERR# = %E_KXF_EXTENDED_FORMAT# );
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:23   
      655    16675        /*E*   ERROR:      KXF-E_KXF_EXTENDED_FORMAT#-0
      656    16676               MESSAGE:    This link should speak extended frame format.
      657    16677        */
      658    16678        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_SOFT#,
      659    16679                           FPTN = SNDFRMR,
      660    16680                           ERR# = %E_KXF_SNDFRMR# );
      661    16726        /*E*   ERROR:      KXF-E_KXF_SNDFRMR#-3
      662    16727               MESSAGE:    A FRMR frame has been sent to the other end.
      663    16728                           VAL0 is the received control byte.
      664    16729                           VAL1 is the expected NS and NR values.
      665    16730                           VAL2 is the reason byte that was sent.
      666    16731                           VAL3 is the internal trace index, and data dumps the trace.
      667    16732        */
      668    16733        %VLP_SCODE (FPTN=Y_KHAALTRET,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_KHAALTRET#);
      669    16794        %VLP_SCODE (FPTN=Y_NO_PRMCLK,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_NO_PRMCLK#);
      670    16855        %VLP_SCODE (FPTN=Y_UNKEVT,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_FRM_UNKEVT#);
      671    16916        %VLP_SCODE (FPTN=Y_ACTSCR,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_FRM_ACTSCR#);
      672    16977        %VLP_SCODE (FPTN=Y_UNKACT,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_FRM_UNKACT#);
      673    17038        %FPT_X25 (FPTN = DATIN_FPT, STCLASS = CONSTANT, EVN = %KX_P_EV_DATIN#);
      674    17082        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:24   
      675    17083        /*****************************************************************
      676    17084        *                                                                *
      677    17085        *                           Auto                                 *
      678    17086        *                                                                *
      679    17087        *****************************************************************/
      680    17088
      681    17089    1   DCL CTX$ PTR;
      682    17090    1   DCL DAT$ PTR;
      683    17091    1   DCL CHN$ PTR;
      684    17092    1   DCL DVC$ PTR;
      685    17093    1   DCL TEMP1$ PTR;
      686    17094    1   DCL TEMP3$ PTR;
      687    17095        %FPT_X25 ( STCLASS = );
      688    17139        %FPT_X25 ( FPTN = CALL_FPT, STCLASS = );
      689    17183        %FPT_CLOCK ( FPTN = X25_PRM_CLK, STCLASS = STATIC,
      690    17184        CANCEL=NO,CLOCK=WALL,LEVEL=0,MODE=SET,
      691    17185        PERM=YES,UNITS=ONE_SECOND,
      692    17186        UTYPE=SEC);
      693    17210    1   DCL ONE_SECOND UBIN CONSTANT INIT(1);
      694    17211        %VLP_ERRCODE(STCLASS=AUTO , FPTN=ERCOD) ;
      695    17257
      696    17258    1   DCL FEVENT UBIN WORD;
      697    17259    1   DCL FSTATE UBIN WORD;
      698    17260    1   DCL EVENT UBIN WORD;
      699    17261    1   DCL PEVENT UBIN WORD;
      700    17262        %VLP_ERRCODE (STCLASS=AUTO, FPTN=KHA_ERROR);
      701    17308    1   DCL CTL UBIN WORD;
      702    17309    1   DCL NTYPE UBIN WORD;
      703    17310
      704    17311        /* The following used to be R rgeisters */
      705    17312
      706    17313    1   DCL TEMP1 UBIN WORD;
      707    17314    1   DCL TEMP2 UBIN WORD;
      708    17315    1   DCL TEMP3 UBIN WORD;
      709    17316    1   DCL TEMP4 UBIN WORD;
      710    17317    1   DCL PF BIT(1);
      711    17318    1   DCL NR UBIN BYTE;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:25   
      712    17319        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:26   
      713    17320        /*****************************************************************
      714    17321        *                                                                *
      715    17322        *                           Based                                *
      716    17323        *                                                                *
      717    17324        *****************************************************************/
      718    17325
      719    17326        %KH$CHN;
      720    17450        %KH$ADMIN_FPT ( FPTN = ADMIN_FPT, STCLASS = "BASED ( DAT$ )" );
      721    17661        %KL_BLKHDR ( NAME = BLKHDR, STCLASS = BASED );
      722    17756        %KL_LINKDEV ( NAME = KL$LINKDEV, STCLASS = BASED );
      723    17927        %KX$LINKDEV ( STCLASS = "BASED(DVC$)" );
      724    17954        %KX$LINKDEV ( FPTN = B$LINKDEV, STCLASS = BASED );
      725    17981
      726    17982        %KX$L1 ( STCLASS = "BASED ( CTX$ )" );
      727    18022        %KX$L2 ( STCLASS = "BASED ( CTX$ )" );
      728    18389        %KX$L2 ( FPTN = KX$L2S, SLCC = YES, STCLASS = "BASED ( CTX$ )" );
      729    18786        %KX$L3;
      730    19189        %KX$DATA ( STCLASS = "BASED ( DAT$ )" );
      731    19209        %KX$FRAME ( STCLASS = "BASED ( DAT$ )" );
      732    19241        %KX$XFRAME ( STCLASS = "BASED ( DAT$ )" );
      733    19275        %KX$EXTFRAME ( STCLASS = "BASED ( DAT$ )" );
      734    19299        %KX$EXTXFRAME ( STCLASS = "BASED ( DAT$ )" );
      735    19333        %KX$FRAME ( FPTN = KX$TFRAME, STCLASS = BASED );
      736    19365        %KX$PACKET (STCLASS = "BASED (DAT$)" );
      737    19431        %KX$XFPACKET ( STCLASS = " BASED (DAT$) " );
      738    19489
      739    19490        %KX$DATA ( FPTN = KX$TDATA );
      740    19510        %KX$TMRBLK ( FPTN = KX$BTMRBLK, STCLASS = BASED, LVL = 1 );
      741    19542
      742    19543        %G$JIT ( STCLASS = "BASED(G$JIT$)" );
      743    19957    1   DCL STR CHAR(50) BASED(DAT$);
      744    19958        %VLP_SCODE (FPTN=B$SCODE, STCLASS=BASED );
      745    20019        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:27   
      746    20020        /*****************************************************************
      747    20021        *                                                                *
      748    20022        *                           Static                               *
      749    20023        *                                                                *
      750    20024        *****************************************************************/
      751    20025
      752    20026    1   DCL G$JIT$ PTR SYMREF;
      753    20027        %KV_CQ;
      754    20043        %KX_DATA;
      755    20733    1   DCL KX_FRAME CHAR(50) STATIC INIT('F'*0);
      756    20734        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:28   
      757    20735        /*****************************************************************
      758    20736        *                                                                *
      759    20737        *                           Procedure                            *
      760    20738        *                                                                *
      761    20739        *****************************************************************/
      762    20740
      763    20741    1       CTX$ = FPT_X25.RCV$;
      764    20742    1       DAT$ = FPT_X25.PRM1$;
      765    20743                                    /*  Convert the external state equates
      766    20744                                        to internal values.  */
      767    20745
      768    20746    2       DO CASE ( FPT_X25.EVN );
      769    20747    2          CASE ( %KX_F_EV_START# );
      770    20748    2             FEVENT = %Y_EV_START#;
      771    20749
      772    20750    2          CASE ( %KX_F_EV_GETDAT#, %KX_F_EV_DATAVL# );
      773    20751    2             IF KX$L2.FLG.OK AND NOT KX$L2.FLG.BLK
      774    20752    2                THEN
      775    20753    3                   DO;
      776    20754    3                      CALL_FPT = '0'B;
      777    20755    3                      CALL_FPT.EVN = %KX_P_EV_GETDAT#;
      778    20756    3                      CALL Y$CAL_PAC1 ;
      779    20757    3                   END;
      780    20758    2             IF NOT KX$L1.CHN$->KH$CHN.ATTR&%G_ATTR_CL_SLCC
      781    20759    2                OR NOT KX$L2S.COMBUF.DATAVL
      782    20760    2                THEN GOTO L_RET0 ;
      783    20761        /*
      784    20762                      The SLCC has some STATS for us to count up.
      785    20763        */
      786    20764    2             KX$L2S.COMBUF.FEPBSY = '1'B;
      787    20765    2             KX$L2S.COMBUF.FEPRDY = '1'B;
      788    20766    2             TEMP1 = 500;
      789    20767    3             DO WHILE KX$L2S.COMBUF.FEPRDY;
      790    20768        /*
      791    20769                      Wait for the SLCC to see that we're here.
      792    20770        */
      793    20771    3                TEMP1 = TEMP1-1;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:29   
      794    20772    3                IF TEMP1=0 THEN EXIT; /* (but not forever) */
      795    20773    3             END;
      796    20774    2             KX$L2S.COMBUF.DATAVL = '0'B;
      797    20775    3             DO TEMP1 = 0 TO SIZEC(KX$L2S.COMBUF.DAT)-1;
      798    20776    3                TEMP2 = KX$L2S.COMBUF.DAT(TEMP1);
      799    20777    3                ERCOD = '0'B;
      800    20778    4                IF TEMP2>0 THEN DO CASE TEMP1;
      801    20779    4                         CASE (1,3,4,5,8,9); /* Possible FRMR causes */
      802    20780    4                            TEMP3 = TEMP1; /* Save error type for FRMR log */
      803    20781    4                            ERCOD = LOG;
      804    20782    4                         CASE (0); /* Timeouts */
      805    20783    4                            KX_STATS_HDLC.TIMEOUTS = KX_STATS_HDLC.TIMEOUTS + TEMP2;
      806    20784    4                         CASE (12,13,14,15); /* Garbage frame ignored */
      807    20785    4                            ERCOD = LOG;
      808    20786    4                         CASE (11); /* DM received */
      809    20787    4                            ERCOD = DM;
      810    20788    4                         CASE (6); /* REJ sent */
      811    20789    4                            KX_STATS_HDLC.F_REJECTS_OUT = KX_STATS_HDLC.F_REJECTS_OUT +
             20789                                     TEMP2;
      812    20790    4                         CASE (7); /* REJ received */
      813    20791    4                            KX_STATS_HDLC.F_REJECTS_IN = KX_STATS_HDLC.F_REJECTS_IN +
             20791                                     TEMP2;
      814    20792    4                            KX$L2S.REJ_CNT = KX$L2S.REJ_CNT + 1;
      815    20793    4                         CASE (2); /* FRMR sent */
      816    20794    4                            KX_STATS_HDLC.RESETS = KX_STATS_HDLC.RESETS + TEMP2;
      817    20795                                 %WRSYSLOG ( ERRCOD = SNDFRMR,
      818    20796                                 TRMID = KX$L1.CHN$->KH$CHN.TERMID,
      819    20797                                 VAL0 = KX$L2S.P_FRAME,
      820    20798                                 VAL1 = KX$L2S.P_FRAME.CTLRPF,
      821    20799                                 VAL2 = "PINCRW(ADDR(KX$L2S.P_FRAME),2)->STR",
      822    20800                                 VAL3 = "PINCRW(ADDR(KX$L2S.P_FRAME),3)->STR");
      823    20818    4                            ERCOD = RESET;
      824    20819    4                         CASE (10);
      825    20820    4                            KX_STATS_HDLC.RESETS = KX_STATS_HDLC.RESETS + TEMP2;
      826    20821    4                            ERCOD = FRMR;
      827    20822    4                         CASE (ELSE); /* Better not be any more */
      828    20823    4                            CALL KHD$SCREECH ( Y_UNKEVT );
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:30   
      829    20824    4                      END;
      830    20825    4                IF ERCOD THEN DO;
      831    20826                              %WRSYSLOG (ERRCOD = ERCOD,
      832    20827                              TRMID = KX$L1.CHN$->KH$CHN.TERMID,
      833    20828                              VAL0 = TEMP1, VAL1 = TEMP2, VAL2 = TEMP3 );
      834    20846    4                      END;
      835    20847    3             END;
      836    20848    2             KX$L2S.COMBUF.DAT = '0'B;
      837    20849    2             KX$L2S.COMBUF.FEPBSY = '0'B;
      838    20850    2             GOTO L_RET0;
      839    20851
      840    20852    2          CASE ( %KX_F_EV_ENB# );
      841    20853    2             IF ADMIN_FPT.TERMID.LEV ~= %TERMINAL_ID_LEV_CHAN#
      842    20854    2                THEN
      843    20855    3                   DO;
      844    20856    3                      TEMP1 = %KX_P_EV_ENB# ;
      845    20857    3                      GOTO L_2 ;
      846    20858    3                   END;
      847    20859        /*
      848    20860                                             Let the MLCP listen for DSR
      849    20861                                             and CTS.
      850    20862        */
      851    20863    2             CALL KXN$CMND ( %KX_N_INIT#, ADMIN_FPT.CHN$ -> KH$CHN );
      852    20864    2             CALL KXN$CMND ( %KX_N_START_TRN#, ADMIN_FPT.CHN$ -> KH$CHN );
      853    20865    2             GOTO L_RET0 ;
      854    20866
      855    20867    2          CASE ( %KX_F_EV_KLL# );
      856    20868    2             TEMP1 = %KX_P_EV_KLL# ;
      857    20869    2             GOTO L_DSC;
      858    20870    2          CASE ( %KX_F_EV_DSC# );
      859    20871    2             TEMP1 = %KX_P_EV_DSC# ;
      860    20872    2   L_DSC:
      861    20873    2             IF ADMIN_FPT.TERMID.LEV ~= %TERMINAL_ID_LEV_CHAN#
      862    20874    2                THEN
      863    20875    3                   DO;
      864    20876    3   L_2:
      865    20877    3                      CALL Y$CAL_PAC
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:31   
      866    20878    3                         WHENALTRETURN
      867    20879    4                            DO;
      868    20880    4                               ALTRETURN;
      869    20881    4                            END;
      870    20882    3                      GOTO L_RET0 ;
      871    20883    3                   END;
      872    20884    2             IF CTX$ = ADDR(NIL)
      873    20885    2                THEN
      874    20886    3                   DO;
      875    20887        /*
      876    20888                                             This is a KILL after we told
      877    20889                                             handler common connect and asked
      878    20890                                             for the line profile, but before
      879    20891                                             we received the line profile and
      880    20892                                             built context.  Report disconnect
      881    20893                                             to handler common, which will
      882    20894                                             cause a disable to be reported.
      883    20895        */
      884    20896    3                      CALL KHA$DVCADM ( %KHA_FNC_DISCONNECT_EVT,
      885    20897    3                         KHA_ERROR,
      886    20898    3                         ADMIN_FPT.TERMID,
      887    20899    3                         ADMIN_FPT.TERMID )
      888    20900    3                         WHENALTRETURN
      889    20901    4                            DO;
      890    20902        /*N*                           CALL KHD$SCREECH ( Y_KHAALTRET ); */
      891    20903    4                            END;
      892    20904    3                      GOTO L_RET0 ;
      893    20905    3                   END;
      894    20906    2             FEVENT = %Y_EV_STOP#;
      895    20907
      896    20908    2          CASE ( %KX_F_EV_DSB# );
      897    20909    2             IF ADMIN_FPT.TERMID.LEV ~= %TERMINAL_ID_LEV_CHAN#
      898    20910    2                THEN
      899    20911    3                   DO;
      900    20912    3                      TEMP1 = %KX_P_EV_DSB# ;
      901    20913    3                      GOTO L_2 ;
      902    20914    3                   END;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:32   
      903    20915    2             IF CTX$ = ADDR(NIL) AND ADMIN_FPT.CHN$ -> KH$CHN.DWNLOD
      904    20916    2                THEN
      905    20917    2                   CALL KXN$CMND ( %KX_N_STOP#, ADMIN_FPT.CHN$ -> KH$CHN );
      906    20918    2             GOTO L_RET0 ;
      907    20919
      908    20920    2          CASE ( %KX_F_EV_BLDCTX# );
      909    20921    2             IF ADMIN_FPT.CTX$->BLKHDR.BLKTYP = %KLTY_VIRCIR#
      910    20922    2                THEN
      911    20923    3                   DO;
      912    20924    3                      CALL_FPT = '0'B;
      913    20925    3                      CALL_FPT.EVN = %KX_P_EV_BLDCTX#;
      914    20926    3                      CALL Y$CAL_PAC0 ALTRET ( L_ALTRET );
      915    20927    3                   END;
      916    20928    2                ELSE
      917    20929    3                   DO;
      918    20930    3                      IF ADMIN_FPT.CTX$->BLKHDR.BLKTYP = %KLTY_LINK#
      919    20931    3                         THEN
      920    20932    3                            CALL KXS$GETCNTX ( ADMIN_FPT, CTX$ ) ALTRET ( L_ALTRET );
      921    20933    3                         ELSE
      922    20934    4                            DO;
      923    20935    4                               CALL KVB$GETSYS ( SIZEW(KX_LINKDEV), DVC$ )
             20935                                        WHENALTRETURN
      924    20936    5                                     DO;
      925    20937    5   L_ALTRET:                            ALTRETURN;
      926    20938    5                                     END;
      927    20939    4                               KX$LINKDEV = KX_LINKDEV;
      928    20940    4                               CHN$ = ADMIN_FPT.CHN$;
      929    20941    4                               CHN$->KH$CHN.CTX$ = DVC$;
      930    20942    4                               CHN$->KH$CHN.TERMID.TTYP = %KLTY_LINKDEV#;
      931    20943    4                               KX$LINKDEV.CHN$ = CHN$;
      932    20944    4                               KX$LINKDEV.CRC = ADMIN_FPT.CTX$->KL$LINKDEV.CIRCUITS#;
      933    20945    4                               KX$LINKDEV.PRTID = ADMIN_FPT.CTX$->KL$LINKDEV.PROTOCOL#;
      934    20946    4                               KX$LINKDEV.SUBADR = ADMIN_FPT.CTX$->KL$LINKDEV.SUBADDR#;
      935    20947    4                               KX$LINKDEV.LOGON = ADMIN_FPT.CTX$->KL$LINKDEV.LOGON#;
      936    20948    4                               IF ADMIN_FPT.CTX$->KL$LINKDEV.MODE = %
             20948                                        KL_DEVMODE_OUTGOING#
      937    20949    4                                  THEN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:33   
      938    20950    4                                     KX$LINKDEV.OUTBOUND = '1'B;
      939    20951    4                                  ELSE
      940    20952    4                                     KX$LINKDEV.INBOUND = '1'B;
      941    20953    4                               KX$LINKDEV.L2$ = CTX$;
      942    20954    4                               KX$LINKDEV.BLNK$ = KX$L2.DVC_TAIL$;
      943    20955    4                               IF KX$L2.DVC_TAIL$ ~= ADDR(NIL)
      944    20956    4                                  THEN
      945    20957    4                                     KX$L2.DVC_TAIL$->B$LINKDEV.FLNK$ = DVC$;
      946    20958    4                                  ELSE
      947    20959    4                                     KX$L2.DVC_HEAD$ = DVC$;
      948    20960    4                               KX$L2.DVC_TAIL$ = DVC$;
      949    20961    4                            END;
      950    20962    3                   END;
      951    20963    2             GOTO L_RET0 ;
      952    20964
      953    20965    2          CASE ( %KX_F_EV_DIED#, %KX_F_EV_ERRLOGKLL# );
      954    20966    2             FEVENT = %Y_EV_DIED#;
      955    20967
      956    20968    2          CASE ( %KX_F_EV_CL_BUSY# );
      957    20969    2             FEVENT = %Y_EV_CL_BUSY#;
      958    20970
      959    20971    2          CASE ( %KX_F_EV_CL_REJ# );
      960    20972    2             FEVENT = %Y_EV_CL_REJ#;
      961    20973
      962    20974    2          CASE ( %KX_F_EV_DATA_OUT# );
      963    20975    2             FEVENT = %Y_EV_DATA_OUT#;
      964    20976
      965    20977    2          CASE ( %KX_F_EV_DATA_IN# );
      966    20978    2             IF NOT KX$L1.CHN$->KH$CHN.ATTR&%G_ATTR_CL_SLCC
      967    20979    2                THEN
      968    20980    2                   CALL Y$CONDITION;
      969    20981    2                ELSE
      970    20982    2                   FEVENT = %Y_EV_I#;
      971    20983
      972    20984    2          CASE ( %KX_F_EV_TO# );
      973    20985    2             KX_STATS_HDLC.TIMEOUTS = KX_STATS_HDLC.TIMEOUTS + 1;
      974    20986    2             IF ( KX$L2.RC < KX$L2.N2 )
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:34   
      975    20987    2                THEN  /*  The retry count has not been exhausted  */
      976    20988    2                   FEVENT = %Y_EV_TO_RC_LT_N2#;
      977    20989    2                ELSE  /*  Retry count has been exhausted  */
      978    20990    2                   FEVENT = %Y_EV_TO_RC_GE_N2#;
      979    20991
      980    20992    2          CASE ( %KX_F_EV_HNDINT# );
      981    20993        /*
      982    20994                                             Set up KV_CQ_HNDSBR$ to call
      983    20995                                             KXC$CQSCN with ML messages.
      984    20996        */
      985    20997    2             KV_CQ_HNDSBR$ ( %KV#CQ_HNDID_SL ) = ENTADDR(KXC$CQSCN);
      986    20998        /*
      987    20999                                             Set up a permanent one second
      988    21000                                             clock for use with all the X.25
      989    21001                                             context blocks.
      990    21002        */
      991    21003    2             CALL M$CLOCK ( X25_PRM_CLK )
      992    21004    2                WHENALTRETURN
      993    21005    3                   DO;
      994    21006        /*S* SCREECH_CODE: KXF-S$KX_NO_PRMCLK#
      995    21007             MESSAGE: Unable to set the 1-second permanent clock.
      996    21008        */
      997    21009    3                      CALL KHD$SCREECH ( Y_NO_PRMCLK );
      998    21010    3                   END;
      999    21011    2   L_RET0:
     1000    21012    2             RETURN;
     1001    21013
     1002    21014    2          CASE ( %KX_F_EV_T20# );
     1003    21015    2             CHN$ = KX$L2.CHN$;
     1004    21016    2             KX$L2.R20_CNT = KX$L2.R20_CNT + 1;
     1005    21017    2             ERCOD = T20TIMEOUT;
     1006    21018    2             CALL Y$ER;
     1007    21019    2             IF KX$L2.R20_CNT < KX$L2.R20
     1008    21020    2                THEN
     1009    21021    3                   DO;
     1010    21022    3                      CALL_FPT = '0'B;
     1011    21023    3                      CALL_FPT.EVN = %KX_P_EV_INIT#;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:35   
     1012    21024    3                      CALL_FPT.CAL$ = CTX$;
     1013    21025    3                      CALL KXP$PACKET ( CALL_FPT )
     1014    21026    4                         WHENALTRETURN DO;
     1015    21027    4                               CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
     1016    21028    4                            END;
     1017    21029    3                      RETURN;
     1018    21030    3                   END;
     1019    21031    2                ELSE
     1020    21032    2                   FEVENT = %Y_EV_STOP#;
     1021    21033
     1022    21034    2          CASE ( %KX_F_EV_TERMACK# );
     1023    21035    2             KX$L2.TERMACKPND = '0'B;
     1024    21036    2             IF KX$L2.RLS_TERMACKPND
     1025    21037    2                THEN
     1026    21038    2                   CALL KXS$RLSCNTX ( CTX$ );
     1027    21039    2             RETURN;
     1028    21040
     1029    21041    2          CASE ( ELSE );
     1030    21042        /*S* SCREECH_CODE: KXF-S$KX_FRM_UNKEVT#
     1031    21043             MESSAGE: Frame received an unknown event.
     1032    21044        */
     1033    21045    2             CALL KHD$SCREECH ( Y_UNKEVT );
     1034    21046    2       END /*  CASE  */;
     1035    21047
     1036    21048    1       CHN$ = KX$L1.CHN$;
     1037    21049
     1038    21050                                          /* For SLCC, only data and control
     1039    21051                                             functions do anything. */
     1040    21052
     1041    21053    1       IF CHN$->KH$CHN.ATTR&%G_ATTR_CL_SLCC
     1042    21054    1          THEN
     1043    21055    2             DO CASE ( FEVENT );
     1044    21056    2                CASE ( %Y_EV_START# );
     1045    21057    2                   IF KX$L1.IN_CCB_HEAD$~=ADDR(NIL) THEN GOTO SLCC_UP;
     1046    21058    2                   CALL KXN$CMND ( %KX_N_START_RCV#, CHN$->KH$CHN);
     1047    21059    2                   ERCOD = START;
     1048    21060    2                   CALL Y$ER;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:36   
     1049    21061    2                   GOTO L_RET0;
     1050    21062    2   SLCC_UP:        ;
     1051    21063    2                   CALL Y$UP;
     1052    21064    2                   GOTO L_RET0;
     1053    21065    2                CASE ( %Y_EV_DIED#, %Y_EV_STOP# );
     1054    21066    2                   CHN$->KH$CHN.DWNLOD = '0'B; /* Always take a dump for now */
     1055    21067    2                   GOTO STOP_ENTRY;   /* in CASE  ( %Y_ACT_STOP# ) */
     1056    21068    2                CASE ( %Y_EV_DATA_OUT# );
     1057    21069    2                   KX$PACKET.GFI = 2;
     1058    21070    2                   KX_STATS_X25.BYTES_OUT = KX_STATS_X25.BYTES_OUT+KX$DATA.CNT-3;
     1059    21071    2                   KX_STATS_X25.PACKETS_OUT = KX_STATS_X25.PACKETS_OUT+1;
     1060    21072    2                   CALL KXN$CMND ( %KX_N_SEND_Q#, CHN$->KH$CHN, DAT$ );
     1061    21073    2                   RETURN;
     1062    21074    2                CASE ( %Y_EV_I# );
     1063    21075    2                   KX_STATS_X25.PACKETS_IN = KX_STATS_X25.PACKETS_IN + 1;
     1064    21076    2                   KX_STATS_X25.BYTES_IN = KX$DATA.CNT-3 + KX_STATS_X25.BYTES_IN;
     1065    21077    2                   CALL_FPT = DATIN_FPT;
     1066    21078    2                   CALL_FPT.CAL$ = CTX$;
     1067    21079    2                   CALL_FPT.PRM1$ = DAT$;
     1068    21080    2                   CALL KXP$PACKET (CALL_FPT);
     1069    21081    2                   FPT_X25.PRM1$ = CALL_FPT.PRM1$;
     1070    21082    2                   GOTO L_RET0;
     1071    21083    2                CASE ( ELSE );
     1072    21084    2                   CALL KHD$SCREECH ( Y_UNKEVT );
     1073    21085    2                   GOTO L_RET0;
     1074    21086    2             END /* CASE */;
     1075    21087                                    /* Get the current state */
     1076    21088
     1077    21089    1       FSTATE = KX$L2.STATE.CURRENT;
     1078    21090
     1079    21091        /* Make a trace entry                                     */
     1080    21092
     1081    21093        /* Eh?    $$TRACE ( FCG, 'KXF' ) , ( EVENT, 0 ) , ( MASK, %KX_TRACE_F ) */
     1082    21094
     1083    21095                                    /* Get the next state */
     1084    21096
     1085    21097    1       TEMP2 = FSTATE * ( %Y_EV_MAX# + 1 ) + FEVENT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:37   
     1086    21098    1       FSTATE = STATE_TABLE.NEXT_STATE ( TEMP2 );
     1087    21099
     1088    21100                                    /* Save the old and new states */
     1089    21101
     1090    21102    1       KX$L2.STATE.LAST = KX$L2.STATE.CURRENT;
     1091    21103    1       KX$L2.STATE.CURRENT = FSTATE;
     1092    21104        /*
     1093    21105                                             Update the history buffer.
     1094    21106        */
     1095    21107    1       KX$L2.HIST.STT ( KX$L2.HIST.X ) = FSTATE;
     1096    21108    1       KX$L2.HIST.EVT ( KX$L2.HIST.X ) = FEVENT;
     1097    21109    1       KX$L2.HIST.ACT ( KX$L2.HIST.X ) = STATE_TABLE.ACTION ( TEMP2 );
     1098    21110    1       KX$L2.HIST.X = KX$L2.HIST.X + 1;
     1099    21111    1       IF KX$L2.HIST.X > 7
     1100    21112    1          THEN
     1101    21113    1             KX$L2.HIST.X = 0;
     1102    21114
     1103    21115        /* Do the action requested                                */
     1104    21116
     1105    21117    2       DO CASE ( STATE_TABLE.ACTION ( TEMP2 ));
     1106    21118        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:38   
     1107    21119
     1108    21120        /* %Y_ACT_CL_BUSY#  -  clear DTE busy condition             */
     1109    21121        /* Reset DTE_BUSY                                         */
     1110    21122
     1111    21123    2          CASE ( %Y_ACT_CL_BUSY# );
     1112    21124
     1113    21125    2             KX$L2.FLG.DTE_BUSY = '0'B;
     1114    21126
     1115    21127        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:39   
     1116    21128
     1117    21129        /* %Y_ACT_CL_REJ#  -  clear DCE reject condition            */
     1118    21130        /* Reset DCE_REJ                                          */
     1119    21131        /* Retransmit                                             */
     1120    21132
     1121    21133    2          CASE ( %Y_ACT_CL_REJ# );
     1122    21134
     1123    21135    2             KX$L2.FLG.DCE_REJ = '0'B;
     1124    21136        /*
     1125    21137                                             Retransmit all the frames now.
     1126    21138        */
     1127    21139    2             CALL Y$RETRAN;
     1128    21140
     1129    21141        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:40   
     1130    21142
     1131    21143        /* %Y_ACT_CL_RESET#  -  the DTE has acknowledged the reset request              */
     1132    21144        /* Reset the context block                                */
     1133    21145
     1134    21146    2          CASE ( %Y_ACT_CL_RESET# );
     1135    21147
     1136    21148        /* Reset the context block                                */
     1137    21149
     1138    21150    2             CALL Y$RESET_RETRAN;
     1139    21151
     1140    21152        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:41   
     1141    21153
     1142    21154        /* %Y_ACT_CL_TR  -  on exit from timer recovery#,  set DCE_REJ                   */
     1143    21155        /* and DCE_BUSY to the appropriate values                 */
     1144    21156        /* Set / reset DCE_REJ and DCE_BUSY                         */
     1145    21157        /* Retransmit any unacknowledged I frames                 */
     1146    21158
     1147    21159    2          CASE ( %Y_ACT_CL_TR# );
     1148    21160
     1149    21161        /* Set the flags according to what response was received  */
     1150    21162
     1151    21163    2             IF ( FEVENT = %Y_EV_RR_F# )
     1152    21164    2                THEN           /*  RR resets DCE_BUSY  */
     1153    21165    2                   KX$L2.FLG.DCE_BUSY = '0'B;
     1154    21166    2                ELSE
     1155    21167    2                   IF ( FEVENT = %Y_EV_RNR_F# )
     1156    21168    2                      THEN     /*  RNR sets DEC_BUSY  */
     1157    21169    2                         KX$L2.FLG.DCE_BUSY = '1'B;
     1158    21170    2                      ELSE     /*  REJ resets DCE_BUSY and sets DCE_REJ  */
     1159    21171    2                         KX$L2.FLG.DCE_BUSY = '0'B;
     1160    21172    2             CALL Y$STOP_TIMER;
     1161    21173
     1162    21174    2             IF ( KX$L2.I_CNT ~= 0 )
     1163    21175    2                THEN           /*  Retransmit unacknowledged I frames  */
     1164    21176    2                   CALL Y$RETRAN;
     1165    21177
     1166    21178        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:42   
     1167    21179
     1168    21180        /* %Y_ACT_DATA_IN#  -  receipt of a valid I - frame           */
     1169    21181        /* Check for proper sequence number                       */
     1170    21182        /* Bad.                                                   */
     1171    21183        /* If DTE_REJ not set,  set it and send REJ                */
     1172    21184        /* Good.                                                  */
     1173    21185        /* Update N' ( S )  and V ( R )                                   */
     1174    21186        /* Give the I - frame to the packet level                   */
     1175    21187        /* Check for sending a response to the DCE                */
     1176    21188
     1177    21189    2          CASE ( %Y_ACT_DATA_IN# );
     1178    21190
     1179    21191        /* Check for the proper sequence number                   */
     1180    21192
     1181    21193    2             IF NOT KX$L2.FLG.EXTSEQ
     1182    21194    2                THEN
     1183    21195    2                   TEMP2 = KX$FRAME.CTL_BITS.NS;
     1184    21196    2                ELSE
     1185    21197    2                   TEMP2 = KX$EXTFRAME.XCTL.CTL_BITS.NS;
     1186    21198
     1187    21199        /* Is this the proper one?                                */
     1188    21200
     1189    21201    2             IF ( TEMP2 ~= KX$L2.VR )
     1190    21202    2                THEN
     1191    21203    3                   DO;
     1192    21204
     1193    21205        /* No  -  is the reject flag already set?                   */
     1194    21206
     1195    21207
     1196    21208        /* Are we already in reject state ?                       */
     1197    21209
     1198    21210    3                      IF KX$L2.FLG.DTE_REJ
     1199    21211    3                         THEN
     1200    21212    4                            DO;
     1201    21213    4                               IF KX$L2.FLG.POLL_R
     1202    21214    4                                  THEN
     1203    21215    4                                     CALL Y$RESP;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:43   
     1204    21216    4                            END;
     1205    21217    3                         ELSE
     1206    21218    4                            DO;
     1207    21219
     1208    21220        /* No  - send a REJ                             */
     1209    21221
     1210    21222    4                               KX$L2.FLG.DTE_REJ = '1'B;
     1211    21223    4                               IF KX$L2.FLG.POLL_R
     1212    21224    4                                  THEN
     1213    21225    4                                     CTL = %Y_CTL_REJ_P#;
     1214    21226    4                                  ELSE
     1215    21227    4                                     CTL = %Y_CTL_REJ#;
     1216    21228    4                               CALL Y$SEND_RESPONSE;
     1217    21229
     1218    21230        /* Stats                                                  */
     1219    21231
     1220    21232    4                               KX_STATS_HDLC.F_REJECTS_OUT = KX_STATS_HDLC.
             21232                                        F_REJECTS_OUT + 1;
     1221    21233    4                            END;
     1222    21234
     1223    21235    3                   END;
     1224    21236    2                ELSE
     1225    21237    3                   DO;
     1226    21238
     1227    21239        /* The sequence number was correct                        */
     1228    21240        /* Any reject condition is now cleared                    */
     1229    21241
     1230    21242    3                      KX$L2.FLG.DTE_REJ = '0'B;
     1231    21243
     1232    21244        /* Update V ( R )                                             */
     1233    21245
     1234    21246    3                      KX$L2.VR = MOD ( KX$L2.VR+1, 8+120*BITBIN(KX$L2.FLG.EXTSEQ) );
     1235    21247
     1236    21248    3   DATA_IN_ENTRY:     ;
     1237    21249        /* Stats                                                  */
     1238    21250
     1239    21251    3                      KX_STATS_X25.PACKETS_IN = KX_STATS_X25.PACKETS_IN + 1;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:44   
     1240    21252    3                      KX_STATS_X25.BYTES_IN = KX$DATA.CNT - 2
     1241    21253    3                         - BITBIN(KX$L2.FLG.EXTSEQ) + KX_STATS_X25.BYTES_IN;
     1242    21254
     1243    21255        /* Store 50 bytes of the frame in static */
     1244    21256    3                      KX_FRAME = STR;
     1245    21257        /* Give the I - frame to the packet level                   */
     1246    21258
     1247    21259        /* Y$RESP uses DAT$ so call_fpt has to be set up first */
     1248    21260    3                      CALL_FPT = DATIN_FPT;
     1249    21261    3                      CALL_FPT.CAL$ = CTX$;
     1250    21262    3                      CALL_FPT.PRM1$ = DAT$;
     1251    21263    3                      KX$L2.DCE_I_CNT = KX$L2.DCE_I_CNT + 1;
     1252    21264    3                      IF KX$L2.FLG.POLL_R
     1253    21265    3                         THEN  /* repsond to poll frames immediately */
     1254    21266    3                            CALL Y$RESP;
     1255    21267    3                      CALL KXP$PACKET (CALL_FPT);
     1256    21268
     1257    21269    3                      IF CALL_FPT.PRM1$ = ADDR(NIL)
     1258    21270    3                         THEN
     1259    21271        /*
     1260    21272           Packet level has held on to the buffer. Tell KXH not to
     1261    21273           re-use it.
     1262    21274        */
     1263    21275    3                            FPT_X25.PRM1$ = ADDR(NIL);
     1264    21276
     1265    21277        /* Should a response be sent to the DCE?                  */
     1266    21278
     1267    21279    3                      IF ( KX$L2.DCE_I_CNT >= MINIMUM(KX$L2.RSPDLY,KX$L2.K/2))
     1268    21280    3                         THEN
     1269    21281    4                            DO;
     1270    21282
     1271    21283        /* Send a response if no I - frames are ready or our xmt-wnd is blocked */
     1272    21284
     1273    21285    4                               IF (KX$L1.OUT_Q_HEAD$ = ADDR(NIL) OR KX$L2.FLG.BLK)
     1274    21286    4                                  THEN /*  Send a supv response  */
     1275    21287    5                                     DO;
     1276    21288    5                                        IF KX$L2.FLG.DTE_BUSY
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:45   
     1277    21289    5                                           THEN
     1278    21290    5                                              CTL = %Y_CTL_RNR#;
     1279    21291    5                                           ELSE
     1280    21292    5                                              CTL = %Y_CTL_RR#;
     1281    21293    5                                        CALL Y$SEND_RESPONSE;
     1282    21294    5                                     END; /* send supv response */
     1283    21295
     1284    21296        /* Reset the DCE's outstanding I - frame count              */
     1285    21297
     1286    21298    4                               KX$L2.DCE_I_CNT = 0;
     1287    21299
     1288    21300    4                            END;
     1289    21301
     1290    21302    3                   END /* IF */;
     1291    21303
     1292    21304        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:46   
     1293    21305
     1294    21306        /* %Y_ACT_DATA_OUT#  -  queue an I - frame for output         */
     1295    21307        /* Insert N ( S )  and update V ( S )                             */
     1296    21308        /* Add the buffer to the queue of unacknowledged I - frames */
     1297    21309        /* Check for being blocked by unacknowledged I - frames     */
     1298    21310        /* Put the buffer on the output queue                     */
     1299    21311        /* Start the timer                                        */
     1300    21312
     1301    21313    2          CASE ( %Y_ACT_DATA_OUT# );
     1302    21314
     1303    21315        /* Insert N ( S )                                             */
     1304    21316
     1305    21317    2             IF NOT KX$L2.FLG.EXTSEQ
     1306    21318    2                THEN
     1307    21319    3                   DO;
     1308    21320    3                      KX$FRAME.CTL_BITS.NS = KX$L2.VS;
     1309    21321    3                   END;
     1310    21322    2                ELSE
     1311    21323    3                   DO;
     1312    21324    3                      KX$EXTFRAME.XCTL.CTL_BITS.NS = KX$L2.VS;
     1313    21325    3                   END;
     1314    21326
     1315    21327        /* Update V ( S )                                             */
     1316    21328
     1317    21329    2             KX$L2.VS = MOD ( KX$L2.VS + 1, 8+120*BITBIN(KX$L2.FLG.EXTSEQ ) );
     1318    21330
     1319    21331
     1320    21332        /* Add this buffer to the queue of unacknowledged I - frames*/
     1321    21333
     1322    21334    2             IF ( KX$L2.I_LIST_HEAD$ = ADDR(NIL) )
     1323    21335    2                THEN
     1324    21336    3                   DO;
     1325    21337
     1326    21338        /* Empty list  -  this is the head and tail                 */
     1327    21339
     1328    21340    3                      KX$L2.I_LIST_HEAD$ = DAT$;
     1329    21341    3                      KX$L2.I_LIST_TAIL$ = DAT$;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:47   
     1330    21342    3                      KX$L2.I_CNT = 1;
     1331    21343
     1332    21344    3                   END;
     1333    21345    2                ELSE
     1334    21346    3                   DO;
     1335    21347
     1336    21348        /* Add this buffer to the tail                            */
     1337    21349
     1338    21350    3                      KX$L2.I_LIST_TAIL$ -> KX$TDATA.L2_LIST$ = DAT$;
     1339    21351    3                      KX$L2.I_LIST_TAIL$ = DAT$;
     1340    21352    3                      KX$L2.I_CNT = KX$L2.I_CNT + 1;
     1341    21353
     1342    21354    3                   END /* IF */;
     1343    21355
     1344    21356        /* Always clear the forward link                          */
     1345    21357
     1346    21358    2             KX$DATA.L2_LIST$ = ADDR(NIL);
     1347    21359
     1348    21360        /* ALWAYS clear the level 2 release                       */
     1349    21361
     1350    21362    2             KX$DATA.RLS.L2 = '0'B;
     1351    21363
     1352    21364        /* Check for being blocked by the window size             */
     1353    21365
     1354    21366    2             IF ( KX$L2.I_CNT >= KX$L2.K )
     1355    21367    2                THEN           /*  Blocked - set the flag  */
     1356    21368    2                   KX$L2.FLG.BLK = '1'B;
     1357    21369
     1358    21370        /* Stats again                                            */
     1359    21371
     1360    21372    2             KX_STATS_X25.PACKETS_OUT = KX_STATS_X25.PACKETS_OUT + 1;
     1361    21373    2             TEMP3 = KX$DATA.CNT - 2 - BITBIN(KX$L2.FLG.EXTSEQ);
     1362    21374    2             KX_STATS_X25.BYTES_OUT = KX_STATS_X25.BYTES_OUT + TEMP3;
     1363    21375
     1364    21376        /* Put in the command address                             */
     1365    21377
     1366    21378    2             KX$FRAME.ADR = KX$L2.ADR_CMND;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:48   
     1367    21379
     1368    21380        /* put the buffer on the output queue                     */
     1369    21381
     1370    21382    2             CALL KXN$CMND ( %KX_N_SEND_Q#, CHN$->KH$CHN, DAT$ );
     1371    21383
     1372    21384        /* Start the timer if it is not already running.          */
     1373    21385
     1374    21386    2             IF KX$L2.T1 ~= 0 AND NOT KX$L2.TMRBLK.ON
     1375    21387    2                THEN
     1376    21388    3                   DO;
     1377    21389    3                      CALL Y$START_TIMER;
     1378    21390    3                   END;
     1379    21391
     1380    21392        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:49   
     1381    21393
     1382    21394        /* %Y_ACT_DISC#  -  send a disconnect command               */
     1383    21395        /* Send the disconnect                                    */
     1384    21396        /* Log the action                                         */
     1385    21397        /* Start the timer                                        */
     1386    21398        /* Reset the retry count                                  */
     1387    21399
     1388    21400    2          CASE ( %Y_ACT_DISC# );
     1389    21401
     1390    21402        /* Send the disconnect                                    */
     1391    21403
     1392    21404    2             CTL = %Y_CTL_DISC#;
     1393    21405    2             CALL Y$SEND_COMMAND;
     1394    21406
     1395    21407        /* Log the action                                         */
     1396    21408
     1397    21409    2             ERCOD = DISC ;
     1398    21410    2             CALL Y$ER ;
     1399    21411
     1400    21412
     1401    21413        /* Start the timer                                        */
     1402    21414
     1403    21415    2             IF KX$L2.T1 ~= 0
     1404    21416    2                THEN
     1405    21417    3                   DO;
     1406    21418    3                      CALL Y$START_TIMER;
     1407    21419    3                   END;
     1408    21420
     1409    21421        /* Reset the retry count                                  */
     1410    21422
     1411    21423    2             KX$L2.RC = 0;
     1412    21424
     1413    21425        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:50   
     1414    21426
     1415    21427        /* %Y_ACT_DISC_L#  -  send a disconnect from an info transfer state             */
     1416    21428        /* Report VCDOWN                                          */
     1417    21429        /* Send the disconnect                                    */
     1418    21430        /* Reset the context block                                */
     1419    21431        /* Log the action                                         */
     1420    21432        /* Restart the timer                                      */
     1421    21433
     1422    21434    2          CASE ( %Y_ACT_DISC_L# );
     1423    21435
     1424    21436        /* Report VCDROP                                          */
     1425    21437
     1426    21438    2             CALL Y$STOP;
     1427    21439
     1428    21440        /* Send the disconnect                                    */
     1429    21441
     1430    21442    2             CTL = %Y_CTL_DISC#;
     1431    21443    2             CALL Y$SEND_COMMAND;
     1432    21444
     1433    21445        /* Reset the context block                                */
     1434    21446
     1435    21447    2             CALL Y$RESET;
     1436    21448
     1437    21449        /* Log the action                                         */
     1438    21450
     1439    21451    2             ERCOD = DISC_L ;
     1440    21452    2             GOTO L_1 ;
     1441    21453
     1442    21454
     1443    21455        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:51   
     1444    21456
     1445    21457        /* %Y_ACT_DISC_LU#  -  send a UA from an info state              */
     1446    21458        /* Report VCDROP                                          */
     1447    21459        /* Clear the output queue                                 */
     1448    21460        /* Send the UA                                            */
     1449    21461        /* Send a DISC                                            */
     1450    21462        /* Reset the context block                                */
     1451    21463        /* Log the action                                         */
     1452    21464
     1453    21465    2          CASE ( %Y_ACT_DISC_LU# );
     1454    21466
     1455    21467        /* Report VCDROP                                          */
     1456    21468
     1457    21469    2             CALL Y$STOP;
     1458    21470
     1459    21471        /* Clear the output queue                                 */
     1460    21472
     1461    21473    2             CALL Y$CLR_DAT_Q;
     1462    21474    2             CALL Y$CLR_SUP_Q;
     1463    21475
     1464    21476        /* Send the UA and the DISC                               */
     1465    21477
     1466    21478    2             CALL Y$UA;
     1467    21479    2             CTL = %Y_CTL_DISC#;
     1468    21480    2             CALL Y$SEND_COMMAND;
     1469    21481
     1470    21482        /* Reset the context block                                */
     1471    21483
     1472    21484    2             CALL Y$RESET;
     1473    21485
     1474    21486        /* Log the action                                         */
     1475    21487
     1476    21488    2             ERCOD = DISC_LU ;
     1477    21489    2   L_1:
     1478    21490    2             CALL Y$ER ;
     1479    21491    2             IF KX$L2.T1 ~= 0
     1480    21492    2                THEN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:52   
     1481    21493    2                   CALL Y$START_TIMER;
     1482    21494        /*
     1483    21495           Tell KHA that link is not active.
     1484    21496        */
     1485    21497    2             CALL KHA$LINE_INACTIVE ( KX$L1.CHN$->KH$CHN.TERMID );
     1486    21498
     1487    21499
     1488    21500        /* Stats                                                  */
     1489    21501
     1490    21502    2             KX_STATS_HDLC.DISCONNECTS = KX_STATS_HDLC.DISCONNECTS + 1;
     1491    21503    2             KX_STATS_HDLC.LINES = KX_STATS_HDLC.LINES - 1;
     1492    21504
     1493    21505        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:53   
     1494    21506
     1495    21507        /* %Y_ACT_DISC_NV#  -  send a disconnect from the down state*/
     1496    21508        /* Reset the context block                                */
     1497    21509        /* Send the disconnect                                    */
     1498    21510        /* Restart the timer                                      */
     1499    21511
     1500    21512    2          CASE ( %Y_ACT_DISC_NV# );
     1501    21513
     1502    21514    2   L_10:
     1503    21515    2             CALL Y$RESET;
     1504    21516    2             CTL = %Y_CTL_DISC#;
     1505    21517    2   L_7:
     1506    21518    2             CALL Y$SEND_COMMAND;
     1507    21519    2             IF KX$L2.T1 ~= 0
     1508    21520    2                THEN
     1509    21521    2                   CALL Y$START_TIMER;
     1510    21522
     1511    21523        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:54   
     1512    21524
     1513    21525        /* %Y_ACT_DISC_RETRY1#  -  send a polled disconnect for the first time
             21525         */
     1514    21526        /* Send the polled disconnect                             */
     1515    21527        /* Reset the retry count                                  */
     1516    21528        /* Start the timer                                        */
     1517    21529
     1518    21530    2          CASE ( %Y_ACT_DISC_RETRY1# );
     1519    21531
     1520    21532    2             KX$L2.RC = 0;
     1521    21533    2             GOTO L_9 ;
     1522    21534
     1523    21535        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:55   
     1524    21536
     1525    21537        /* %Y_ACT_DISC_R#  -  send a polled disconnect             */
     1526    21538        /* Send the polled disconnect                             */
     1527    21539        /* Increment the retry count                              */
     1528    21540        /* Start the timer                                        */
     1529    21541
     1530    21542    2          CASE ( %Y_ACT_DISC_R# );
     1531    21543
     1532    21544    2             KX$L2.RC = KX$L2.RC + 1;
     1533    21545    2   L_9:      CALL Y$CLR_SUP_Q;
     1534    21546    2             CTL = %Y_CTL_DISC_P#;
     1535    21547    2             GOTO L_7;
     1536    21548        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:56   
     1537    21549
     1538    21550        /* %Y_ACT_DISC_UNV#  -  send a UA from the down state            */
     1539    21551        /* Send the UA                                            */
     1540    21552        /* Reset the context block                                */
     1541    21553        /* Send a DISC and start timer                            */
     1542    21554
     1543    21555    2          CASE ( %Y_ACT_DISC_UNV# );
     1544    21556
     1545    21557    2             CALL Y$UA;
     1546    21558    2             GOTO L_10;
     1547    21559
     1548    21560        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:57   
     1549    21561
     1550    21562        /* %Y_ACT_DM#  -  disconnected mode message received while in setup             */
     1551    21563        /* Stop the timer                                         */
     1552    21564        /* Log the action                                         */
     1553    21565
     1554    21566    2          CASE ( %Y_ACT_DM# );
     1555    21567
     1556    21568        /* Stop the timer                                         */
     1557    21569
     1558    21570    2             CALL Y$STOP_TIMER;
     1559    21571
     1560    21572        /* Log the action                                         */
     1561    21573
     1562    21574    2             ERCOD = DM ;
     1563    21575    2             GOTO L_3 ;
     1564    21576
     1565    21577
     1566    21578        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:58   
     1567    21579
     1568    21580        /* %Y_ACT_FRMR#  -  send a frame reject                     */
     1569    21581        /* Send the frame reject                                  */
     1570    21582        /* Start the timer                                        */
     1571    21583        /* Reset the retry count                                  */
     1572    21584        /* Log the action                                         */
     1573    21585
     1574    21586    2          CASE ( %Y_ACT_FRMR# );
     1575    21587        /*
     1576    21588           If already in FRMR state, we ignore the received frame in the following
     1577    21589           two cases:
     1578    21590           - we are the DCE and the frame received is an I frame, or
     1579    21591           - the frame received is a normal response frame (i.e. fevent ~= bad_adr)
     1580    21592        */
     1581    21593    2             IF KX$L2.STATE.LAST = %Y_ST_FRMR# AND (
     1582    21594    2                ( KX$L2.FLG.DCE AND FEVENT = %Y_EV_I# ) OR
     1583    21595    2                ( KX$FRAME.ADR = KX$L2.ADR_CMND AND FEVENT ~= %Y_EV_BAD_ADR# ) )
     1584    21596    2                THEN
     1585    21597    3                   DO;
     1586    21598        /* intentionally left blank */
     1587    21599    3                   END;
     1588    21600    3                ELSE DO;
     1589    21601
     1590    21602        /* set up the frame reject parameters               */
     1591    21603        /* this assumed the extended format. */
     1592    21604
     1593    21605    3                      IF KX$L2.STATE.LAST ~= %Y_ST_FRMR#
     1594    21606    3                         THEN
     1595    21607    4                            DO;
     1596    21608    4                               KX$L2.FRMR_NSNR = KX$L2.VS*512 + KX$L2.VR*2;
     1597    21609    4                               IF KX$FRAME.ADR = KX$L2.ADR_CMND
     1598    21610    4                                  THEN
     1599    21611    4                                     KX$L2.FRMR_NSNR = KX$L2.FRMR_NSNR + 1;
     1600    21612    4                               IF KX$DATA.CNT = 4104
     1601    21613    4                                  THEN
     1602    21614    4                                     KX$L2.FRMR_BITS = 4;   /* y-bit on */
     1603    21615    4                                  ELSE
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:59   
     1604    21616    4                                     KX$L2.FRMR_BITS = FRMR_REASON ( FEVENT );
     1605    21617    4                            END;
     1606    21618
     1607    21619        /* Need to clear data queue too??                */
     1608    21620
     1609    21621    3                      CALL Y$CLR_SUP_Q;
     1610    21622
     1611    21623        /* Send the frame reject                         */
     1612    21624
     1613    21625    3                      CALL KXS$GETBFR ( 0, TEMP1$ );
     1614    21626    3                      TEMP1$->KX$DATA.RLS.L3 = '1'B;
     1615    21627    3                      TEMP1$->KX$DATA.RLS.L2 = '1'B;
     1616    21628    3                      TEMP1$->KX$DATA.CNT = 5 + 2*BITBIN(KX$L2.FLG.EXTSEQ);
     1617    21629    3                      TEMP1$->KX$FRAME.ADR = KX$L2.ADR_RESP;
     1618    21630    3                      IF KX$FRAME.ADR = KX$L2.ADR_RESP AND PF
     1619    21631    3                         THEN
     1620    21632    3                            TEMP1$->KX$FRAME.CTL = %Y_CTL_FRMR_F#;
     1621    21633    3                         ELSE
     1622    21634    3                            TEMP1$->KX$FRAME.CTL = %Y_CTL_FRMR#;
     1623    21635    3                      IF KX$L2.FLG.EXTSEQ
     1624    21636    3                         THEN
     1625    21637    4                            DO;
     1626    21638    4                               IF KX$L2.STATE.LAST ~= %Y_ST_FRMR#
     1627    21639    4                                  THEN
     1628    21640    4                                     KX$L2.FRMR_CTL = KX$EXTFRAME.XCTL_REDEF;
     1629    21641    4                               TEMP1$->KX$EXTXFRAME.FRMR_CTL = KX$L2.FRMR_CTL;
     1630    21642    4                               TEMP1$->KX$EXTXFRAME.FRMR_NSNR = KX$L2.FRMR_NSNR;
     1631    21643    4                               TEMP1$->KX$EXTXFRAME.FRMR_BITS = KX$L2.FRMR_BITS;
     1632    21644    4                            END;
     1633    21645    3                         ELSE
     1634    21646    4                            DO;
     1635    21647    4                               IF KX$L2.STATE.LAST ~= %Y_ST_FRMR#
     1636    21648    4                                  THEN
     1637    21649    4                                     KX$L2.FRMR_CTL = KX$FRAME.CTL;
     1638    21650    4                               TEMP1$->KX$XFRAME.FRMR_CTL = KX$L2.FRMR_CTL;
     1639    21651    4                               TEMP1$->KX$XFRAME.FRMR_VARS.VS = KX$L2.VS;
     1640    21652    4                               TEMP1$->KX$XFRAME.FRMR_VARS.VR = KX$L2.VR;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:60   
     1641    21653    4                               TEMP1$->KX$XFRAME.FRMR_VARS.CR = KX$L2.FRMR_NSNR_REDEF.
             21653                                        CR;
     1642    21654    4                               TEMP1$->KX$XFRAME.FRMR_BITS = KX$L2.FRMR_BITS;
     1643    21655    4                            END;
     1644    21656
     1645    21657    3                      DAT$ = TEMP1$;
     1646    21658    3                      CALL KXN$CMND ( %KX_N_SUPV_Q#, CHN$->KH$CHN, DAT$ );
     1647    21659
     1648    21660        /* Start the timer                                */
     1649    21661
     1650    21662    3                      CALL Y$START_TIMER;
     1651    21663
     1652    21664        /* Reset the retry count                         */
     1653    21665
     1654    21666    3                      KX$L2.RC = 0;
     1655    21667
     1656    21668        /* Log the event                                 */
     1657    21669
     1658    21670                           %WRSYSLOG ( ERRCOD = SNDFRMR,
     1659    21671                           TRMID = "KX$L1.CHN$ -> KH$CHN.TERMID",
     1660    21672                           VAL0 = KX$L2.FRMR_CTL,
     1661    21673                           VAL1 = KX$L2.FRMR_NSNR,
     1662    21674                           VAL2 = KX$L2.FRMR_BITS,
     1663    21675                           VAL3 = KX$L2.TRCX,
     1664    21676                           BFR = "KX$L2.TRC(0)");
     1665    21694    3                   END;
     1666    21695
     1667    21696        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:61   
     1668    21697        /* %Y_ACT_FRMR_TO#  -  Time out occurred after a FRMR frame was sent,
     1669    21698                               and RC < N2. Start timer again and inc RC.
     1670    21699        */
     1671    21700
     1672    21701    2          CASE ( %Y_ACT_FRMR_TO# );
     1673    21702
     1674    21703    2             GOTO FRMR_TO_ENTRY;   /* in case ACT_SABM_PR#  */
     1675    21704
     1676    21705        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:62   
     1677    21706
     1678    21707        /* %Y_ACT_LOG#  -  log the last state and event             */
     1679    21708
     1680    21709    2          CASE ( %Y_ACT_LOG# );
     1681    21710
     1682    21711        /* Log the last state and event                           */
     1683    21712
     1684    21713    2             ERCOD = LOG ;
     1685    21714    2             CALL Y$ER2 ;
     1686    21715
     1687    21716
     1688    21717        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:63   
     1689    21718
     1690    21719        /* %Y_ACT_NULL#  -  do nothing                              */
     1691    21720
     1692    21721    2          CASE ( %Y_ACT_NULL# );
     1693    21722
     1694    21723        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:64   
     1695    21724
     1696    21725        /* %Y_ACT_REJ#  -  the DCE has rejected an I - frame          */
     1697    21726        /* Set DCE_REJ                                            */
     1698    21727        /* Retransmit the desired frame and subsequent frames     */
     1699    21728        /* Reset the timer                                        */
     1700    21729        /* Log the action                                         */
     1701    21730
     1702    21731    2          CASE ( %Y_ACT_REJ# );
     1703    21732
     1704    21733        /* If this was a polled command,  respond                  */
     1705    21734
     1706    21735    2             IF KX$L2.FLG.POLL_R
     1707    21736    2                AND ( KX$FRAME.ADR = KX$L2.ADR_RESP )
     1708    21737    2                THEN           /*  Send a response  */
     1709    21738    2                   CALL Y$RESP;
     1710    21739
     1711    21740        /* Only do work if there are I frames pending             */
     1712    21741
     1713    21742    2             KX$L2.FLG.DCE_BUSY = '0'B;
     1714    21743    2             IF ( KX$L2.I_CNT ~= 0 )
     1715    21744    2                THEN
     1716    21745    3                   DO;
     1717    21746
     1718    21747        /* Retransmission must wait for the transmitter to stop   */
     1719    21748
     1720    21749    3                      IF CHN$->KH$CHN.OTPCCBCNT > 0
     1721    21750    3                         THEN
     1722    21751    3                            CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );
     1723    21752    3                      CALL Y$RETRAN;
     1724    21753    3                      IF KX$L2.T1 ~= 0
     1725    21754    3                         THEN
     1726    21755    3                            CALL Y$START_TIMER;
     1727    21756
     1728    21757    3                   END /* IF */;
     1729    21758
     1730    21759    2             KX$L2.REJ_CNT = KX$L2.REJ_CNT + 1;
     1731    21760    2             KX_STATS_HDLC.F_REJECTS_IN = KX_STATS_HDLC.F_REJECTS_IN + 1;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:65   
     1732    21761
     1733    21762        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:66   
     1734    21763
     1735    21764        /* %Y_ACT_RESET#  -  begin the level 2 link reset process   */
     1736    21765        /* Send a SABM                                            */
     1737    21766        /* Reset the timer                                        */
     1738    21767        /* Reset the retry count                                  */
     1739    21768        /* Log the action                                         */
     1740    21769
     1741    21770    2          CASE ( %Y_ACT_RESET# );
     1742    21771        /*
     1743    21772           If we are DCE and was in RESET state, do not generate additional
     1744    21773           SABMs for FRMRs received.
     1745    21774        */
     1746    21775    2             IF ( KX$L2.FLG.DCE AND KX$L2.STATE.LAST = %Y_ST_RESET#
     1747    21776    2                AND FEVENT = %Y_EV_FRMR# )
     1748    21777    3                THEN DO;
     1749    21778    3                   END;
     1750    21779    3                ELSE DO;
     1751    21780
     1752    21781    3                      IF CHN$->KH$CHN.OTPCCBCNT > 0
     1753    21782    3                         THEN
     1754    21783    3                            CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );
     1755    21784    3                      CALL Y$CLR_SUP_Q;
     1756    21785        /* Send a SABM or a SABME                                 */
     1757    21786
     1758    21787    3                      CTL = %Y_CTL_SABM# + BITBIN(KX$L2.FLG.EXTSEQ)*BITBIN('40'X);
     1759    21788    3                      CALL Y$SEND_COMMAND;
     1760    21789
     1761    21790        /* Reset the timer                                        */
     1762    21791
     1763    21792    3                      IF KX$L2.T1 ~= 0
     1764    21793    3                         THEN
     1765    21794    4                            DO;
     1766    21795    4                               CALL Y$START_TIMER;
     1767    21796    4                            END;
     1768    21797
     1769    21798        /* Reset the retry count                                  */
     1770    21799
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:67   
     1771    21800    3                      KX$L2.RC = 0;
     1772    21801
     1773    21802        /* Log the action                                         */
     1774    21803
     1775    21804    3                      ERCOD = RESET ;
     1776    21805    3                      CALL Y$ER2 ;
     1777    21806
     1778    21807
     1779    21808        /* Stats                                                  */
     1780    21809
     1781    21810    3                      GOTO L_6 ;
     1782    21811    3                   END;
     1783    21812
     1784    21813        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:68   
     1785    21814
     1786    21815        /* %Y_ACT_RESP#  -  send a response to free up the DCE's window                 */
     1787    21816        /* Send RR or RNR with final bit set if received a poll bit                   */
     1788    21817        /* Set the DCE_BUSY flag accordingly                      */
     1789    21818
     1790    21819    2          CASE ( %Y_ACT_RESP# );
     1791    21820
     1792    21821        /* Set DCE_BUSY accordingly                               */
     1793    21822
     1794    21823
     1795    21824        /* Distinguish RR from RNR                                    */
     1796    21825
     1797    21826    2             IF NOT ( BINBIT( KX$FRAME.CTL, 8 ) & '00000100'B )
     1798    21827    2                THEN           /*  Not busy  */
     1799    21828    2                   KX$L2.FLG.DCE_BUSY = '0'B;
     1800    21829    2                ELSE           /*  Busy  */
     1801    21830    2                   KX$L2.FLG.DCE_BUSY = '1'B;
     1802    21831
     1803    21832        /* Was the poll bit set                                   */
     1804    21833
     1805    21834    2             IF KX$L2.FLG.POLL_R
     1806    21835    2                THEN           /*  Yes, send a response  */
     1807    21836    2                   CALL Y$RESP;
     1808    21837
     1809    21838        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:69   
     1810    21839
     1811    21840        /* %Y_ACT_RR_P#  -  send a polled RR to start timer recovery*/
     1812    21841        /* Send the polled RR                                     */
     1813    21842        /* Reset the timer                                        */
     1814    21843        /* Reset the retry count                                  */
     1815    21844
     1816    21845    2          CASE ( %Y_ACT_RR_P# );
     1817    21846
     1818    21847        /* Send the polled RR                                     */
     1819    21848
     1820    21849    2             CTL = %Y_CTL_RR_P#;
     1821    21850    2             GOTO L_4 ;
     1822    21851
     1823    21852        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:70   
     1824    21853
     1825    21854        /* %Y_ACT_RR_PR#  -  send additional polled RRs from timer recovery             */
     1826    21855        /* Send the polled RR                                     */
     1827    21856        /* Start the timer                                        */
     1828    21857        /* Increment the retry count                              */
     1829    21858
     1830    21859    2          CASE ( %Y_ACT_RR_PR# );
     1831    21860
     1832    21861        /* Send the polled RR                                     */
     1833    21862
     1834    21863    2             CTL = %Y_CTL_RR_P#;
     1835    21864    2             GOTO L_5 ;
     1836    21865
     1837    21866        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:71   
     1838    21867
     1839    21868        /* %Y_ACT_SABM#  -  send a SABM to start the level 2 link setup                 */
     1840    21869        /* Send the SABM                                          */
     1841    21870        /* Reset the timer                                        */
     1842    21871        /* Reset the retry count                                  */
     1843    21872
     1844    21873    2          CASE ( %Y_ACT_SABM# );
     1845    21874
     1846    21875        /* Send the SABM or SABME                                 */
     1847    21876
     1848    21877    2             CTL = %Y_CTL_SABM# + BITBIN(KX$L2.FLG.EXTSEQ)*BITBIN('40'X);
     1849    21878    2             GOTO L_4 ;
     1850    21879
     1851    21880        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:72   
     1852    21881
     1853    21882        /* %Y_ACT_SABM_P#  -  send a polled SABM to continue the link setup             */
     1854    21883        /* Send a polled SABM or SABME                            */
     1855    21884        /* Start the timer                                        */
     1856    21885        /* Reset the retry count                                  */
     1857    21886
     1858    21887    2          CASE ( %Y_ACT_SABM_P# );
     1859    21888
     1860    21889        /* Send the polled SABM                                   */
     1861    21890
     1862    21891    2             IF CHN$->KH$CHN.OTPCCBCNT > 0
     1863    21892    2                THEN
     1864    21893    2                   CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );
     1865    21894    2             CALL Y$CLR_SUP_Q;
     1866    21895    2             CTL = %Y_CTL_SABM_P# + BITBIN(KX$L2.FLG.EXTSEQ)*BITBIN('40'X);
     1867    21896    2   L_4:
     1868    21897    2             CALL Y$SEND_COMMAND;
     1869    21898
     1870    21899        /* Start the timer                                        */
     1871    21900
     1872    21901    2             IF KX$L2.T1 ~= 0
     1873    21902    2                THEN
     1874    21903    3                   DO;
     1875    21904    3                      CALL Y$START_TIMER;
     1876    21905    3                   END;
     1877    21906
     1878    21907        /* Reset the retry count                                  */
     1879    21908
     1880    21909    2             KX$L2.RC = 0;
     1881    21910
     1882    21911        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:73   
     1883    21912
     1884    21913        /* %Y_ACT_SABM_PR#  -  send another polled SABM for link setup                  */
     1885    21914        /* Send the polled SABM                                   */
     1886    21915        /* Start the timer                                        */
     1887    21916        /* Increment the retry count                              */
     1888    21917
     1889    21918    2          CASE(%Y_ACT_SABM_PR# , %Y_ACT_RESET_P# ) ;
     1890    21919
     1891    21920        /* Send the polled SABM or SABME                          */
     1892    21921
     1893    21922    2             IF CHN$->KH$CHN.OTPCCBCNT > 0
     1894    21923    2                THEN
     1895    21924    2                   CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );
     1896    21925    2             CALL Y$CLR_SUP_Q;
     1897    21926    2             CTL = %Y_CTL_SABM_P# + BITBIN(KX$L2.FLG.EXTSEQ)*BITBIN('40'X);
     1898    21927    2   L_5:
     1899    21928    2             CALL Y$SEND_COMMAND;
     1900    21929
     1901    21930        /* Start the timer                                        */
     1902    21931
     1903    21932    2   FRMR_TO_ENTRY:
     1904    21933    2             IF KX$L2.T1 ~= 0
     1905    21934    2                THEN
     1906    21935    3                   DO;
     1907    21936    3                      CALL Y$START_TIMER;
     1908    21937    3                   END;
     1909    21938
     1910    21939        /* Increment the retry count                              */
     1911    21940
     1912    21941    2             KX$L2.RC = KX$L2.RC + 1;
     1913    21942
     1914    21943        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:74   
     1915    21944
     1916    21945        /* %Y_ACT_SABM_U#  -  send SABM and UA on link reset        */
     1917    21946        /* Clear the output queue                                 */
     1918    21947        /* Send the SABM                                          */
     1919    21948        /* Send the UA                                            */
     1920    21949        /* Reset the timer                                        */
     1921    21950        /* Reset the retry count                                  */
     1922    21951
     1923    21952    2          CASE ( %Y_ACT_SABM_U# );
     1924    21953
     1925    21954        /* Clear the output queue                                 */
     1926    21955
     1927    21956    2             IF CHN$->KH$CHN.OTPCCBCNT > 0
     1928    21957    2                THEN
     1929    21958    2                   CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );
     1930    21959    2             CALL Y$CLR_SUP_Q;
     1931    21960
     1932    21961        /* Send the UA                                            */
     1933    21962
     1934    21963    2             CALL Y$UA;
     1935    21964
     1936    21965        /* Stop the timer                                         */
     1937    21966
     1938    21967    2             CALL Y$STOP_TIMER;
     1939    21968
     1940    21969        /* Reset the context and retransmit (like in action CL_RESET#)  */
     1941    21970
     1942    21971    2             CALL Y$RESET_RETRAN;
     1943    21972
     1944    21973        /* Stats                                                  */
     1945    21974
     1946    21975    2   L_6:
     1947    21976    2             KX_STATS_HDLC.RESETS = KX_STATS_HDLC.RESETS + 1;
     1948    21977
     1949    21978        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:75   
     1950    21979
     1951    21980        /* %Y_ACT_SCREECH  -  screech#,  there is some internal problem                  */
     1952    21981        /* Screech                                                */
     1953    21982
     1954    21983    2          CASE ( %Y_ACT_SCREECH# );
     1955    21984
     1956    21985        /*S* SCREECH_CODE: KXF-S$KX_FRM_ACTSCR#                        */
     1957    21986        /*S* MESSAGE: KXF internal transition error               */
     1958    21987        /*S* DESCRIPTION: The state / transition table specifies that the               */
     1959    21988        /*S* event just received is supposedly impossible         */
     1960    21989        /*S* to receive when in this state.                       */
     1961    21990
     1962    21991    2             CALL KHD$SCREECH ( Y_ACTSCR );
     1963    21992
     1964    21993        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:76   
     1965    21994
     1966    21995        /* %Y_ACT_START#  -  the MLCP has heard DSR and CTS         */
     1967    21996        /* Start the MLCP                                         */
     1968    21997        /* Send a DISC                                            */
     1969    21998        /* Start the timer                                        */
     1970    21999        /* Log the action                                         */
     1971    22000
     1972    22001    2          CASE ( %Y_ACT_START# );
     1973    22002
     1974    22003        /* Start the MLCP  (  listening )                             */
     1975    22004
     1976    22005    2             CALL KXN$CMND ( %KX_N_START_RCV#, CHN$->KH$CHN, DAT$ );
     1977    22006
     1978    22007        /* Send a DISC                                            */
     1979    22008
     1980    22009    2             CTL = %Y_CTL_DISC#;
     1981    22010    2             CALL Y$SEND_COMMAND;
     1982    22011
     1983    22012        /* Start the timer                                        */
     1984    22013
     1985    22014    2             IF KX$L2.T1 ~= 0
     1986    22015    2                THEN
     1987    22016    3                   DO;
     1988    22017    3                      CALL Y$START_TIMER;
     1989    22018    3                   END;
     1990    22019
     1991    22020        /* Log the action                                         */
     1992    22021
     1993    22022    2             ERCOD = START ;
     1994    22023    2   L_3:
     1995    22024    2             CALL Y$ER ;
     1996    22025
     1997    22026
     1998    22027        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:77   
     1999    22028
     2000    22029        /* %Y_ACT_STOP#  -  stop the MLCP NOW!!!                    */
     2001    22030        /* Stop the MLCP                                          */
     2002    22031        /* Stop the TIMER                                         */
     2003    22032        /* Report DIED to all the level 3s                        */
     2004    22033        /* Release the context and any buffers                    */
     2005    22034        /* If the line is not marked for disable,  restart it      */
     2006    22035
     2007    22036    2          CASE ( %Y_ACT_STOP# );
     2008    22037
     2009    22038        /* Stop the MLCP                                          */
     2010    22039
     2011    22040    2   STOP_ENTRY:
     2012    22041
     2013    22042    2             CALL KXN$CMND ( %KX_N_STOP#, CHN$->KH$CHN );
     2014    22043    2             CALL Y$STOP_TIMER;
     2015    22044    2             CALL Y$STOP_T20;
     2016    22045
     2017    22046        /* Report DIED to all the level 3s                        */
     2018    22047
     2019    22048    2             CALL Y$DIED;
     2020    22049
     2021    22050        /* Stats                                                  */
     2022    22051
     2023    22052    2             IF ( KX$L2.STATE.CURRENT >= %Y_ST_NORMAL# )
     2024    22053    2                THEN
     2025    22054    3                   DO;
     2026    22055    3                      KX_STATS_HDLC.DISCONNECTS = KX_STATS_HDLC.DISCONNECTS + 1;
     2027    22056    3                      KX_STATS_HDLC.LINES = KX_STATS_HDLC.LINES - 1;
     2028    22057    3                   END /* IF */;
     2029    22058        /*
     2030    22059                                             Release the context, which calls
     2031    22060                                             handler common with a disconnect.
     2032    22061                                             If a test connect says that it is
     2033    22062                                             ok to continue, start the MLCP
     2034    22063                                             searching for DSR and CTS.
     2035    22064        */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:78   
     2036    22065    2             IF KX$L2.TERMACKPND
     2037    22066    2                THEN
     2038    22067    2                   KX$L2.RLS_TERMACKPND = '1'B;
     2039    22068    2                ELSE
     2040    22069    2                   CALL KXS$RLSCNTX ( CTX$ );
     2041    22070    2             IF FPT_X25.EVN ~= %KX_F_EV_ERRLOGKLL# THEN
     2042    22071        /*  If we were killed because of errlog limit, don't try to
     2043    22072            restart the line. When the h/w problem is fixed, the line
     2044    22073            can be restarted by killing and enabling.
     2045    22074        */
     2046    22075    2                   CALL KHA$TSTCNC ( CHN$ )
     2047    22076    2                      WHENRETURN
     2048    22077    3                         DO;
     2049    22078    3                            CALL KXN$CMND ( %KX_N_START_TRN#, CHN$->KH$CHN );
     2050    22079    3                         END;
     2051    22080
     2052    22081        /* Return NOW since the context is gone or changed        */
     2053    22082
     2054    22083    2             RETURN;
     2055    22084
     2056    22085        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:79   
     2057    22086
     2058    22087        /* %Y_ACT_UA#  -  just send a UA or UA_F                    */
     2059    22088        /* Send the UA                                            */
     2060    22089
     2061    22090    2          CASE ( %Y_ACT_UA# );
     2062    22091
     2063    22092        /* Send the UA                                            */
     2064    22093
     2065    22094    2             CALL Y$UA;
     2066    22095
     2067    22096        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:80   
     2068    22097
     2069    22098        /* %Y_ACT_UP#  -  link setup was successful                 */
     2070    22099        /* Stop the timer                                         */
     2071    22100        /* Kludge by setting the OK flag                          */
     2072    22101        /* Tell the level 3 handler to do its initialization stuff*/
     2073    22102        /* Log the action                                         */
     2074    22103
     2075    22104    2          CASE ( %Y_ACT_UP# );
     2076    22105
     2077    22106    2             CALL Y$UP;
     2078    22107        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:81   
     2079    22108        /* %Y_ACT_UP_UA#  -  We were SABM'd while in state DISC/DISC_TO.
     2080    22109                             call Y$UA and Y$UP.
     2081    22110        */
     2082    22111    2          CASE ( %Y_ACT_UP_UA# );
     2083    22112
     2084    22113    2             CALL Y$UA;
     2085    22114    2             CALL Y$UP;
     2086    22115        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:82   
     2087    22116
     2088    22117        /* Any other actions  -  something is very wrong,  so screech*/
     2089    22118
     2090    22119    2          CASE ( ELSE );
     2091    22120
     2092    22121        /*S* SCREECH_CODE: KXF-S$KX_FRM_UNKACT#                        */
     2093    22122        /*S* MESSAGE: Unknown action type                         */
     2094    22123        /*S* DESCRIPTION: Either the action tables are clobbered,  or an               */
     2095    22124        /*S* action was added without adding the code to          */
     2096    22125        /*S* handle it.                                           */
     2097    22126
     2098    22127    2             CALL KHD$SCREECH ( Y_UNKACT );
     2099    22128
     2100    22129    2       END /* CASE */;
     2101    22130
     2102    22131        /* Are we in normal state                                 */
     2103    22132
     2104    22133    1       IF ( KX$L2.STATE.CURRENT = %Y_ST_NORMAL# )
     2105    22134    1          AND NOT KX$L2.FLG.DCE_BUSY
     2106    22135    1          THEN                 /*  Normal, set the bit  */
     2107    22136    2             DO;
     2108    22137    2                IF NOT KX$L2.FLG.OK
     2109    22138    2                   THEN
     2110    22139    3                      DO;
     2111    22140    3                         KX$L2.FLG.DATAVL = '1'B;
     2112    22141    3                         KX$L2.FLG.OK = '1'B;
     2113    22142    3                      END;
     2114    22143    2             END;
     2115    22144    1          ELSE                 /*  Non-normal, reset the bit  */
     2116    22145    1             KX$L2.FLG.OK = '0'B;
     2117    22146
     2118    22147        /* Does the current state send polled frames?             */
     2119    22148
     2120    22149    1       TEMP3 = KX$L2.STATE.CURRENT;
     2121    22150    1       IF ( TEMP3 = %Y_ST_SETUP_TO# )
     2122    22151    1          OR ( TEMP3 = %Y_ST_RESET_TO# )
     2123    22152    1          OR ( TEMP3 = %Y_ST_TIMER_REC# )
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:83   
     2124    22153    1          OR ( TEMP3 = %Y_ST_DISC# AND CTL = %Y_CTL_DISC_P# )
     2125    22154    1          THEN                 /*  Yes, set the flag  */
     2126    22155    1             KX$L2.FLG.POLL_S = '1'B;
     2127    22156    1          ELSE
     2128    22157
     2129    22158        /* No poll sent                                           */
     2130    22159
     2131    22160    1             KX$L2.FLG.POLL_S = '0'B;
     2132    22161
     2133    22162        /* Always clear the POLL_R flag                           */
     2134    22163
     2135    22164    1       KX$L2.FLG.POLL_R = '0'B;
     2136    22165
     2137    22166    1       RETURN;
     2138    22167
     2139    22168        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:84   
     2140    22169    1   Y$CONDITION: PROC;
     2141    22170
     2142    22171        /*I* NAME: Y$CONDITION                                    */
     2143    22172        /*I* PURPOSE: This subroutine turns the external event into                   */
     2144    22173        /*I* an event that makes sense internally.                */
     2145    22174        /*I* INPUT: FEVENT  =  frame event type                     */
     2146    22175        /*I* CTX$  =  line context block pointer                    */
     2147    22176        /*I* DAT$  =  data pointer                                  */
     2148    22177        /*I* OUTPUT: FEVENT  =  frame event type                    */
     2149    22178
     2150    22179        /* There must be at least 2 bytes                         */
     2151    22180
     2152    22181    2       IF ( BINBIT(KX$FRAME.CTL,8) & '00000011'B ) = '00000011'B
     2153    22182    2          THEN
     2154    22183        /*
     2155    22184           This is an unnumbered frame. Basic and extended formats are the same.
     2156    22185        */
     2157    22186    2             PF = KX$FRAME.CTL_BITS.PF;
     2158    22187    2          ELSE
     2159    22188    2             IF NOT KX$L2.FLG.EXTSEQ
     2160    22189    2                THEN
     2161    22190    3                   DO;
     2162    22191    3                      PF = KX$FRAME.CTL_BITS.PF;
     2163    22192    3                      NR = KX$FRAME.CTL_BITS.NR;
     2164    22193    3                   END;
     2165    22194    2                ELSE
     2166    22195    3                   DO;
     2167    22196    3                      PF = KX$EXTFRAME.XCTL.PF;
     2168    22197    3                      NR = KX$EXTFRAME.XCTL.NR;
     2169    22198    3                   END;
     2170    22199
     2171    22200        /* Check for valid address                                */
     2172    22201
     2173    22202    2       IF ( ( KX$FRAME.ADR ~= 1 ) AND ( KX$FRAME.ADR ~= 3 ) ) OR KX$DATA.CNT < 2
     2174    22203    2          THEN
     2175    22204    3             DO;
     2176    22205
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:85   
     2177    22206        /* Bad address  -  return now with this event               */
     2178    22207
     2179    22208    3                FEVENT = %Y_EV_GARBAGE#;
     2180    22209    3                RETURN;
     2181    22210    3             END /* IF */;
     2182    22211    2       IF KX$DATA.CNT = 4104   /* i.e., KXH detected a frame which is too long */
     2183    22212    2          THEN
     2184    22213    3             DO;
     2185    22214    3                FEVENT = %Y_EV_BAD_IFLD#;
     2186    22215    3                RETURN;
     2187    22216    3             END;
     2188    22217
     2189    22218        /* Find out what type of frame we got                     */
     2190    22219
     2191    22220    2       IF NOT KX$FRAME.CTL_BITS.IFLAG  /* .IFLAG = '0'B --> I-FRAME */
     2192    22221    2          THEN
     2193    22222    3             DO;
     2194    22223        /* If this is a polled I frame,  set the flag              */
     2195    22224
     2196    22225    3                IF PF
     2197    22226    3                   THEN
     2198    22227    3                      KX$L2.FLG.POLL_R = '1'B;
     2199    22228
     2200    22229
     2201    22230        /* It's an I frame,  check the address                     */
     2202    22231
     2203    22232    3                IF ( KX$FRAME.ADR = KX$L2.ADR_RESP )
     2204    22233    3                   THEN
     2205    22234    4                      DO;
     2206    22235
     2207    22236        /* Set the event code                                     */
     2208    22237
     2209    22238    4                         FEVENT = %Y_EV_I#;
     2210    22239
     2211    22240        /* Check N ( R )  and update N' ( R )                             */
     2212    22241
     2213    22242    4                         CALL Y$NR;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:86   
     2214    22243
     2215    22244    4                      END;
     2216    22245    3                   ELSE        /*  This is bad data  */
     2217    22246    3                      FEVENT = %Y_EV_BAD_ADR#;
     2218    22247
     2219    22248    3             END;
     2220    22249    2          ELSE
     2221    22250    3             DO;
     2222    22251
     2223    22252        /* It's a supervisory or unnumbered frame                 */
     2224    22253
     2225    22254    4                DO CASE ( KX$FRAME.CTL_BITS.NS );
     2226    22255    4                   CASE ( %Y_TYPE_RR# );
     2227    22256
     2228    22257        /* Set the event code appropriately                       */
     2229    22258
     2230    22259    4                      IF PF
     2231    22260    4                         THEN
     2232    22261    5                            DO;
     2233    22262
     2234    22263        /* P / F bit is set                                         */
     2235    22264
     2236    22265    5                               IF KX$FRAME.ADR = KX$L2.ADR_RESP
     2237    22266    5                                  THEN
     2238    22267    6                                     DO;
     2239    22268
     2240    22269        /* This is a RR_P.                                */
     2241    22270
     2242    22271    6                                        FEVENT = %Y_EV_RR#;
     2243    22272    6                                        KX$L2.FLG.POLL_R = '1'B;
     2244    22273    6                                        CALL Y$NR;
     2245    22274
     2246    22275    6                                     END;
     2247    22276    5                                  ELSE
     2248    22277        /*
     2249    22278           This is an RR_F.
     2250    22279        */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:87   
     2251    22280    5                                     IF KX$L2.FLG.POLL_S
     2252    22281    5                                        THEN
     2253    22282    6                                           DO;
     2254    22283
     2255    22284    6                                              FEVENT = %Y_EV_RR_F#;
     2256    22285    6                                              CALL Y$NR;
     2257    22286
     2258    22287    6                                           END;
     2259    22288    5                                        ELSE
     2260    22289    5                                           FEVENT = %Y_EV_BAD_F#;
     2261    22290
     2262    22291    5                            END;
     2263    22292    4                         ELSE
     2264    22293    5                            DO;
     2265    22294
     2266    22295        /* Just a plain old RR                                    */
     2267    22296
     2268    22297    5                               FEVENT = %Y_EV_RR#;
     2269    22298    5                               CALL Y$NR;
     2270    22299
     2271    22300    5                            END /* IF */;
     2272    22301
     2273    22302    4                   CASE ( %Y_TYPE_RNR# );
     2274    22303
     2275    22304        /* Set the event code appropriately                       */
     2276    22305
     2277    22306    4                      IF PF
     2278    22307    4                         THEN
     2279    22308    5                            DO;
     2280    22309
     2281    22310        /* P / F bit is set                                         */
     2282    22311
     2283    22312    5                               IF KX$FRAME.ADR = KX$L2.ADR_RESP
     2284    22313    5                                  THEN
     2285    22314    6                                     DO;
     2286    22315
     2287    22316        /* This is a RNR_P.                              */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:88   
     2288    22317
     2289    22318    6                                        FEVENT = %Y_EV_RNR#;
     2290    22319    6                                        KX$L2.FLG.POLL_R = '1'B;
     2291    22320    6                                        CALL Y$NR;
     2292    22321
     2293    22322    6                                     END;
     2294    22323    5                                  ELSE
     2295    22324    5                                     IF KX$L2.FLG.POLL_S
     2296    22325    5                                        THEN
     2297    22326    6                                           DO;
     2298    22327
     2299    22328        /* This is a RNR_F.                                       */
     2300    22329    6                                              FEVENT = %Y_EV_RNR_F#;
     2301    22330    6                                              CALL Y$NR;
     2302    22331
     2303    22332    6                                           END;
     2304    22333    5                                        ELSE
     2305    22334    5                                           FEVENT = %Y_EV_BAD_F#;
     2306    22335
     2307    22336    5                            END;
     2308    22337    4                         ELSE
     2309    22338    5                            DO;
     2310    22339
     2311    22340        /* Just a plain old RNR                                   */
     2312    22341
     2313    22342    5                               FEVENT = %Y_EV_RNR#;
     2314    22343    5                               CALL Y$NR;
     2315    22344
     2316    22345    5                            END /* IF */;
     2317    22346
     2318    22347    4                   CASE ( %Y_TYPE_REJ# );
     2319    22348
     2320    22349        /* Set the event code appropriately                       */
     2321    22350
     2322    22351    4                      IF PF
     2323    22352    4                         THEN
     2324    22353    5                            DO;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:89   
     2325    22354
     2326    22355        /* P / F bit is set                                         */
     2327    22356
     2328    22357    5                               IF KX$FRAME.ADR = KX$L2.ADR_RESP
     2329    22358    5                                  THEN
     2330    22359    6                                     DO;
     2331    22360
     2332    22361        /* This is a REJ_P.                                       */
     2333    22362
     2334    22363    6                                        FEVENT = %Y_EV_REJ#;
     2335    22364    6                                        KX$L2.FLG.POLL_R = '1'B;
     2336    22365    6                                        CALL Y$NR;
     2337    22366
     2338    22367    6                                     END;
     2339    22368    5                                  ELSE
     2340    22369    5                                     IF KX$L2.FLG.POLL_S
     2341    22370    5                                        THEN
     2342    22371    6                                           DO;
     2343    22372
     2344    22373        /* This is a REJ_F                                        */
     2345    22374    6                                              FEVENT = %Y_EV_REJ_F#;
     2346    22375    6                                              CALL Y$NR;
     2347    22376
     2348    22377    6                                           END;
     2349    22378    5                                        ELSE
     2350    22379    5                                           FEVENT = %Y_EV_BAD_F#;
     2351    22380
     2352    22381    5                            END;
     2353    22382    4                         ELSE
     2354    22383    5                            DO;
     2355    22384
     2356    22385        /* Just a plain old REJ                                   */
     2357    22386
     2358    22387    5                               FEVENT = %Y_EV_REJ#;
     2359    22388    5                               CALL Y$NR;
     2360    22389
     2361    22390    5                            END /* IF */;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:90   
     2362    22391
     2363    22392    4                   CASE ( ELSE );
     2364    22393
     2365    22394        /* It's an unnumbered frame                               */
     2366    22395
     2367    22396    5                      DO SELECT ( KX$FRAME.CTL );
     2368    22397    5                         SELECT ( %Y_CTL_DM#, %Y_CTL_DM_F# );
     2369    22398
     2370    22399        /* DM frames must be responses  (  commands to us  )          */
     2371    22400
     2372    22401    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_CMND )
     2373    22402    5                            THEN  /*  This is Ok  */
     2374    22403    5                               FEVENT = %Y_EV_DM#;
     2375    22404    5                            ELSE  /*  This is not so Ok  */
     2376    22405    5                               FEVENT = %Y_EV_BAD_ADR#;
     2377    22406
     2378    22407    5                         SELECT ( %Y_CTL_SABM#, %Y_CTL_SABM_P#, %Y_CTL_SABME#, %
             22407                                  Y_CTL_SABME_P# );
     2379    22408
     2380    22409        /* SABM frames must be commands  (  responses to us  )        */
     2381    22410
     2382    22411    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_RESP )
     2383    22412    5                            THEN
     2384    22413    6                               DO;
     2385    22414
     2386    22415        /* Report a SABM event                                    */
     2387    22416
     2388    22417    6                                  FEVENT = %Y_EV_SABM#;
     2389    22418
     2390    22419        /* Set the POLL_R bit if necessary                        */
     2391    22420
     2392    22421    6                                  IF PF
     2393    22422    6                                     THEN
     2394    22423    6                                        KX$L2.FLG.POLL_R = '1'B;
     2395    22424
     2396    22425    6                               END;
     2397    22426    5                            ELSE  /*  Bad address  */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:91   
     2398    22427    5                               FEVENT = %Y_EV_BAD_ADR#;
     2399    22428        /*
     2400    22429           SABME means extended mode. Is our EXTSEQ bit on?
     2401    22430        */
     2402    22431    5                         IF (BINBIT(KX$FRAME.CTL,8) & '40'X) AND NOT KX$L2.FLG.EXTSEQ
     2403    22432    5                            THEN
     2404    22433    6                               DO;
     2405    22434    6                                  ERCOD = EXTENDED_FORMAT;
     2406    22435    6                                  CALL Y$ER;
     2407    22436    6                                  FEVENT = %Y_EV_BAD_ADR#;
     2408    22437    6                               END;
     2409    22438
     2410    22439    5                         SELECT ( %Y_CTL_DISC#, %Y_CTL_DISC_P# );
     2411    22440
     2412    22441        /* DISCs must be commands  (  responses to us  )              */
     2413    22442
     2414    22443    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_RESP )
     2415    22444    5                            THEN
     2416    22445    6                               DO;
     2417    22446    6                                  FEVENT = %Y_EV_DISC#;
     2418    22447
     2419    22448        /* Set the POLL_R flag if necessary                       */
     2420    22449
     2421    22450    6                                  IF PF
     2422    22451    6                                     THEN
     2423    22452    6                                        KX$L2.FLG.POLL_R = '1'B;
     2424    22453
     2425    22454    6                               END;
     2426    22455    5                            ELSE  /*  Bad address  */
     2427    22456    5                               FEVENT = %Y_EV_BAD_ADR#;
     2428    22457
     2429    22458    5                         SELECT ( %Y_CTL_UA# );
     2430    22459
     2431    22460        /* UA frames must be responses  (  commands to us  )          */
     2432    22461
     2433    22462    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_CMND )
     2434    22463    5                            THEN  /*  Everything is Ok  */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:92   
     2435    22464    5                               FEVENT = %Y_EV_UA#;
     2436    22465    5                            ELSE  /*  Bad address  */
     2437    22466    5                               FEVENT = %Y_EV_BAD_ADR#;
     2438    22467
     2439    22468    5                         SELECT ( %Y_CTL_UA_F# );
     2440    22469
     2441    22470        /* Final UA frames must be responses  (  commands to us  )    */
     2442    22471
     2443    22472    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_CMND )
     2444    22473    5                            THEN
     2445    22474    6                               DO;
     2446    22475
     2447    22476        /* Is a final response expected?                          */
     2448    22477
     2449    22478    6                                  IF KX$L2.FLG.POLL_S
     2450    22479    6                                     THEN  /*  This is Ok  */
     2451    22480    6                                        FEVENT = %Y_EV_UA_F#;
     2452    22481    6                                     ELSE  /*  Unexpected final response  */
     2453    22482    6                                        FEVENT = %Y_EV_BAD_F#;
     2454    22483
     2455    22484    6                               END;
     2456    22485    5                            ELSE  /*  NAK  */
     2457    22486    5                               FEVENT = %Y_EV_BAD_ADR#;
     2458    22487
     2459    22488    5                         SELECT ( %Y_CTL_FRMR#, %Y_CTL_FRMR_F# );
     2460    22489
     2461    22490        /* The length of FRMRs must be 5, or 7, for extended format */
     2462    22491
     2463    22492    5                         IF ( KX$DATA.CNT ~= 5+2*BITBIN(KX$L2.FLG.EXTSEQ) )
     2464    22493    5                            THEN  /*  Invalid frame  */
     2465    22494    5                               FEVENT = %Y_EV_BAD_IFLD#;
     2466    22495    5                            ELSE
     2467    22496    6                               DO;
     2468    22497
     2469    22498        /* FRMR frames must be responses  (  commands to us  )        */
     2470    22499
     2471    22500    6                                  IF ( KX$FRAME.ADR = KX$L2.ADR_CMND )
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:93   
     2472    22501    6                                     THEN  /*  Ok  */
     2473    22502    6                                        FEVENT = %Y_EV_FRMR#;
     2474    22503    6                                     ELSE  /*  Bad address  */
     2475    22504    6                                        FEVENT = %Y_EV_BAD_ADR#;
     2476    22505
     2477    22506        /* Log the FRMR parameters                                */
     2478    22507
     2479    22508                                       %WRSYSLOG ( ERRCOD = FRMR,
     2480    22509                                       TRMID = "KX$L1.CHN$ -> KH$CHN.TERMID",
     2481    22510                                       BFR = KX$L2.SUPV_Q_TAIL$,
             22510                                           /* to record STATE history as well */
     2482    22511                                       VAL0 = KX$EXTXFRAME.FRMR_CTL,
     2483    22512                                       VAL1 = KX$EXTXFRAME.FRMR_NSNR,
     2484    22513                                       VAL2 = KX$EXTXFRAME.FRMR_BITS );
     2485    22531
     2486    22532
     2487    22533    6                               END /* IF */;
     2488    22534
     2489    22535    5                         SELECT ( ELSE );
     2490    22536
     2491    22537        /* It's a bad frame,  set the event code                   */
     2492    22538
     2493    22539    5                      FEVENT = %Y_EV_BAD_ADR#;
     2494    22540    5                      END /* SELECT */;
     2495    22541    4                END /* SELECT */;
     2496    22542    3             END /* IF */;
     2497    22543
     2498    22544        /* Check for long frames                                  */
     2499    22545
     2500    22546    2       IF ( FEVENT ~= %Y_EV_I# ) AND ( FEVENT < %Y_EV_FRMR# )
     2501    22547    2          AND ( KX$DATA.CNT > 2 + BITBIN(KX$L2.FLG.EXTSEQ) )
     2502    22548    2          THEN                 /*  This is a long frame  */
     2503    22549    2             FEVENT = %Y_EV_BAD_IFLD#;
     2504    22550
     2505    22551    2   END /* SUBROUTINE */;
     2506    22552        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:94   
     2507    22553    1   Y$NR: PROC;
     2508    22554
     2509    22555        /*I* NAME: Y$NR                                           */
     2510    22556        /*I* PURPOSE: This subroutine checks for a good N ( R )       */
     2511    22557        /*I* and updates N' ( R ) .                                   */
     2512    22558        /*I* CALL: CALL Y$NR                                      */
     2513    22559        /*I* INPUT: CTX$  =  line context block pointer             */
     2514    22560        /*I* DAT$  =  data pointer                                  */
     2515    22561        /*I* FEVENT  =  event type                                  */
     2516    22562        /*I* OUTPUT: FEVENT  =  event type                          */
     2517    22563
     2518    22564        /* Does N ( R )  get checked for the current state?           */
     2519    22565
     2520    22566    2       IF ( KX$L2.STATE.CURRENT = %Y_ST_NORMAL# )
     2521    22567    2          THEN
     2522    22568    3             DO;
     2523    22569                                                /* This IF intentionally left blank   */
     2524    22570
     2525    22571        /* This one gets checked                                  */
     2526    22572
     2527    22573    3             END;
     2528    22574    2          ELSE
     2529    22575    2             IF ( KX$L2.STATE.CURRENT = %Y_ST_TIMER_REC# )
     2530    22576    2                AND PF
     2531    22577    2                THEN
     2532    22578    3                   DO;
     2533    22579
     2534    22580        /* When n timer recovery,  responses with the              */
     2535    22581        /* final bit set are checked                              */
     2536    22582
     2537    22583    3                   END;
     2538    22584    2                ELSE
     2539    22585    3                   DO;
     2540    22586
     2541    22587        /* No others are checked                                  */
     2542    22588
     2543    22589    3                      RETURN;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:95   
     2544    22590
     2545    22591    3                   END /* IF */;
     2546    22592
     2547    22593        /* Get N ( R )  from the frame                                */
     2548    22594
     2549    22595    2       TEMP2 = NR;
     2550    22596
     2551    22597        /* Get N' ( R )  and V ( S )  from the context block              */
     2552    22598
     2553    22599    2       TEMP3 = KX$L2.NPR;
     2554    22600    2       TEMP4 = KX$L2.VS;
     2555    22601
     2556    22602        /* Is N ( R )  valid?                                         */
     2557    22603
     2558    22604    2       IF ( TEMP4 < TEMP3 )
     2559    22605    2          THEN
     2560    22606    3             DO;
     2561    22607    3                TEMP4 = TEMP4 + 8 + 120*BITBIN(KX$L2.FLG.EXTSEQ);
     2562    22608    3             END /* IF */;
     2563    22609
     2564    22610    2       IF ( TEMP2 < TEMP3 )
     2565    22611    2          THEN
     2566    22612    3             DO;
     2567    22613    3                TEMP2 = TEMP2 + 8 + 120*BITBIN(KX$L2.FLG.EXTSEQ);
     2568    22614    3             END /* IF */;
     2569    22615
     2570    22616        /* Is N ( R )  between N' ( R )  and V ( S ) ?                        */
     2571    22617
     2572    22618    2       IF ( TEMP2 < TEMP3 ) OR ( TEMP2 > TEMP4 )
     2573    22619    2          THEN
     2574    22620    3             DO;
     2575    22621
     2576    22622        /* Bad N ( R )                                                */
     2577    22623
     2578    22624    3                FEVENT = %Y_EV_BAD_NR#;
     2579    22625    3                RETURN;
     2580    22626
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:96   
     2581    22627    3             END /* IF */;
     2582    22628
     2583    22629        /* Restore TEMP2 and TEMP4                                */
     2584    22630
     2585    22631    2       TEMP2 = NR;
     2586    22632    2       TEMP4 = KX$L2.VS;
     2587    22633
     2588    22634        /* Does N' ( R )  already match N ( R )                           */
     2589    22635
     2590    22636    2       IF ( TEMP3 ~= TEMP2 )
     2591    22637    2          THEN
     2592    22638    3             DO;
     2593    22639
     2594    22640        /* Not a match,  reset BLK and reset the retry count       */
     2595    22641
     2596    22642    3                KX$L2.FLG.BLK = '0'B;
     2597    22643    3                KX$L2.RC = 0;
     2598    22644
     2599    22645        /* Loop thru and update N' ( R )                              */
     2600    22646
     2601    22647    4                DO UNTIL ( TEMP3 = TEMP2 );
     2602    22648
     2603    22649        /* Increment N' ( R )                                         */
     2604    22650
     2605    22651    4                   TEMP3 = MOD(TEMP3 + 1, 8+120*BITBIN(KX$L2.FLG.EXTSEQ));
     2606    22652        /* Decrement the outstanding I frame count                */
     2607    22653
     2608    22654    4                   KX$L2.I_CNT = KX$L2.I_CNT - 1;
     2609    22655
     2610    22656        /* Release the frame if it does not contain a data packet */
     2611    22657
     2612    22658    4                   TEMP3$ = KX$L2.I_LIST_HEAD$;
     2613    22659
     2614    22660        /* Fix the head pointer                              */
     2615    22661
     2616    22662    4                   KX$L2.I_LIST_HEAD$ = TEMP3$ -> KX$TDATA.L2_LIST$;
     2617    22663
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:97   
     2618    22664        /* Check for buffer release                               */
     2619    22665
     2620    22666    4                   TEMP3$ -> KX$DATA.RLS.L2 = '1'B;
     2621    22667    4                   IF ( TEMP3$ -> KX$TDATA.RLS_STAT = %KX_BFR_RLS_OK# )
     2622    22668    4                      THEN
     2623    22669    4                         CALL KXS$RLSBFR ( TEMP3$ );
     2624    22670    4                END /* LOOP */;
     2625    22671
     2626    22672        /* Return N' ( R )  to the context block                      */
     2627    22673
     2628    22674    3                KX$L2.NPR = TEMP3;
     2629    22675
     2630    22676    3                IF KX$L2.FLG.POLL_S AND FEVENT ~= %Y_EV_RR_F#
     2631    22677    3                   AND FEVENT ~= %Y_EV_RNR_F#
     2632    22678    3                   AND FEVENT ~= %Y_EV_REJ_F#
     2633    22679    3                   THEN
     2634    22680    3                      RETURN;
     2635    22681
     2636    22682        /* Are there any outstanding I frames                     */
     2637    22683
     2638    22684    3                CALL Y$STOP_TIMER;
     2639    22685    3                IF (KX$L2.T1 ~= 0) AND (KX$L2.I_CNT ~= 0)
     2640    22686    3                   THEN
     2641    22687    4                      DO;
     2642    22688    4                         CALL Y$START_TIMER;
     2643    22689    4                      END;
     2644    22690    3             END;  /*  IF ( TEMP3 ~= TEMP2)   */
     2645    22691
     2646    22692    2   END /* SUBROUTINE */;
     2647    22693        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:98   
     2648    22694    1   Y$RESET: PROC;
     2649    22695
     2650    22696        /*I* NAME: Y$RESET,  Y$RESET_RETRAN                        */
     2651    22697        /*I* PURPOSE: This subroutine resets the line context block                   */
     2652    22698        /*I* to its start condition. Unacknowledged I frames are  */
     2653    22699        /*I* either retransmitted or released.                    */
     2654    22700        /*I* CALL: CALL Y$RESET                                   */
     2655    22701        /*I* INPUT: CTX$  =  line context block                     */
     2656    22702        /*I* OUTPUT: none                                         */
     2657    22703
     2658    22704        /* RESET releases unacknowledged I frames                 */
     2659    22705
     2660    22706    2       TEMP2 = 0;
     2661    22707    2       KX$L2.FLG.RESTART = '0'B;
     2662    22708    2       KX$L2.FLG.RESTART_PEND = '0'B;
     2663    22709
     2664    22710    2       GOTO SUBCOMMON; /* LOOK BELOW */
     2665    22711
     2666    22712    2   Y$RESET_RETRAN: ENTRY;
     2667    22713
     2668    22714        /* RESET_RETRAN retransmits unacknowledged I frames       */
     2669    22715
     2670    22716    2       TEMP2 = 1;
     2671    22717
     2672    22718    2   SUBCOMMON: ;                            /* THERE MUST BE AN ALTENTRY ABOVE ME */
     2673    22719
     2674    22720        /* Reset the context block                                */
     2675    22721
     2676    22722    2       KX$L2.RC = 0;
     2677    22723    2       KX$L2.NPR = 0;
     2678    22724    2       KX$L2.VS = 0;
     2679    22725    2       KX$L2.VR = 0;
     2680    22726    2       KX$L2.FLG.BLK = '0'B;
     2681    22727    2       KX$L2.FLG.DCE_BUSY = '0'B;
     2682    22728    2       KX$L2.FLG.DCE_REJ = '0'B;
     2683    22729    2       KX$L2.FLG.DTE_REJ = '0'B;
     2684    22730    2       KX$L2.DCE_I_CNT = 0;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:99   
     2685    22731    2       CALL Y$STOP_TIMER;
     2686    22732    2       CALL Y$STOP_T20;
     2687    22733
     2688    22734        /* Are there unacknowledged I frames?                     */
     2689    22735
     2690    22736    2       IF ( KX$L2.I_CNT ~= 0 )
     2691    22737    2          THEN
     2692    22738    3             DO;
     2693    22739
     2694    22740        /* Yes  -  are they to be retransmitted?                    */
     2695    22741
     2696    22742    3                IF TEMP2 ~= 0
     2697    22743    3                   THEN
     2698    22744    4                      DO;
     2699    22745
     2700    22746        /* Yes  -  as they are being retransmitted,  change the send */
     2701    22747        /* sequence number and rest the receive sequence number   */
     2702    22748        /* Further comments are missing                           */
     2703    22749
     2704    22750    4                         DAT$ = KX$L2.I_LIST_HEAD$;
     2705    22751    4                         TEMP2 = 0;
     2706    22752    5                         DO WHILE ( DAT$ ~= ADDR(NIL) ); /* LOOP START           */
     2707    22753    5                            IF NOT KX$L2.FLG.EXTSEQ
     2708    22754    5                               THEN
     2709    22755    6                                  DO;
     2710    22756    6                                     KX$FRAME.CTL_BITS.NS = TEMP2;
     2711    22757    6                                     KX$FRAME.CTL_BITS.NR = 0;
     2712    22758    6                                  END;
     2713    22759    5                               ELSE
     2714    22760    6                                  DO;
     2715    22761    6                                     KX$EXTFRAME.XCTL.CTL_BITS.NS = TEMP2;
     2716    22762    6                                     KX$EXTFRAME.XCTL.NR = 0;
     2717    22763    6                                  END;
     2718    22764    5                            TEMP2 = TEMP2 + 1;
     2719    22765    5                            DAT$ = KX$DATA.L2_LIST$;
     2720    22766    5                         END /* LOOP */;
     2721    22767
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:100  
     2722    22768        /* Store the current V ( S )                                  */
     2723    22769
     2724    22770    4                         KX$L2.VS = TEMP2;
     2725    22771
     2726    22772        /* Check for blocked                                      */
     2727    22773
     2728    22774    4                         IF ( KX$L2.I_CNT >= KX$L2.K )
     2729    22775    4                            THEN
     2730    22776    4                               KX$L2.FLG.BLK = '1'B;
     2731    22777
     2732    22778        /* Is the I count non - zero?                               */
     2733    22779
     2734    22780    4                         IF ( KX$L2.I_CNT ~= 0 )
     2735    22781    4                            THEN  /*  Reset the timer  */
     2736    22782    4                               IF KX$L2.T1 ~= 0
     2737    22783    4                                  THEN
     2738    22784    5                                     DO;
     2739    22785    5                                        CALL Y$START_TIMER;
     2740    22786    5                                     END;
     2741    22787
     2742    22788        /* Do the retransmission                                  */
     2743    22789
     2744    22790    4                         CALL Y$RETRAN;
     2745    22791
     2746    22792    4                      END;
     2747    22793    3                   ELSE
     2748    22794    4                      DO;
     2749    22795
     2750    22796        /* Unacknowledged I frames are to be released             */
     2751    22797
     2752    22798    4                         DAT$ = KX$L2.I_LIST_HEAD$;
     2753    22799    5                         DO WHILE ( DAT$ ~= ADDR(NIL) ); /* LOOP START           */
     2754    22800    5                            TEMP3$ = KX$DATA.L2_LIST$;
     2755    22801    5                            KX$DATA.RLS.L2 = '1'B;
     2756    22802    5                            IF ( KX$DATA.RLS_STAT = %KX_BFR_RLS_OK# )
     2757    22803    5                               THEN
     2758    22804    5                                  CALL KXS$RLSBFR ( DAT$ );
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:101  
     2759    22805    5                            DAT$ = TEMP3$;
     2760    22806    5                         END /* LOOP */;
     2761    22807
     2762    22808        /* Clear any info about I lists                           */
     2763    22809
     2764    22810    4                         KX$L2.I_CNT = 0;
     2765    22811    4                         KX$L2.I_LIST_HEAD$ = ADDR(NIL);
     2766    22812    4                         KX$L2.I_LIST_TAIL$ = ADDR(NIL);
     2767    22813
     2768    22814    4                      END /* IF */;
     2769    22815
     2770    22816    3             END /* IF */;
     2771    22817
     2772    22818    2   END /* SUBROUTINE */;
     2773    22819        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:102  
     2774    22820
     2775    22821        /*I* NAME: Y$RETRAN                                       */
     2776    22822        /*I* PURPOSE: Retransmit I frames                         */
     2777    22823        /*I* CALL: CALL Y$RETRAN                                  */
     2778    22824
     2779    22825    1   Y$RETRAN: PROC;
     2780    22826
     2781    22827        /* Is it safe to retransmit now?                          */
     2782    22828
     2783    22829    2       IF ( KX$L1.OUT_CCB_HEAD$ = ADDR(NIL) )
     2784    22830    2          AND ( KX$L1.OUT_Q_HEAD$ = ADDR(NIL) )
     2785    22831    2          THEN
     2786    22832    3             DO;
     2787    22833
     2788    22834        /* Yes  -  the I frames can't be on any L1 Q  -  retransmit now                   */
     2789    22835
     2790    22836    3                DAT$ = KX$L2.I_LIST_HEAD$;
     2791    22837    4                DO WHILE ( DAT$ ~= ADDR(NIL) ); /* LOOP START*/
     2792    22838    4                   CALL KXN$CMND ( %KX_N_SEND_Q#, CHN$->KH$CHN, DAT$ );
     2793    22839    4                   DAT$ = KX$DATA.L2_LIST$;
     2794    22840    4                END /* LOOP */;
     2795    22841
     2796    22842    3             END;
     2797    22843    2          ELSE                 /*  KXH will initiate the retransmission  */
     2798    22844    2             KX$L2.FLG.DCE_REJ = '1'B;
     2799    22845
     2800    22846    2   END /* SUBROUTINE */;
     2801    22847        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:103  
     2802    22848
     2803    22849        /*I* NAME: Y$UA                                           */
     2804    22850        /*I* PURPOSE: Send a UA or UA with final bit set          */
     2805    22851        /*I* CALL: CALL Y$UA                                      */
     2806    22852        /*I* INPUT: CTX$  ->  level 2 context                       */
     2807    22853        /*I* OUTPUT: None                                         */
     2808    22854
     2809    22855    1   Y$UA: PROC;
     2810    22856
     2811    22857    2   DCL ADDRESS UBIN;
     2812    22858
     2813    22859        /* UA or UA_F                                             */
     2814    22860
     2815    22861    2       IF KX$L2.FLG.POLL_R
     2816    22862    2          THEN
     2817    22863    2             CTL = %Y_CTL_UA_F#;
     2818    22864    2          ELSE
     2819    22865    2             CTL = %Y_CTL_UA#;
     2820    22866
     2821    22867    2       GOTO SEND_ADR_RESP;
     2822    22868
     2823    22869        /*I* NAME: Y$RESP                                         */
     2824    22870        /*I* PURPOSE: Send an RR or RNR with the final bit set    */
     2825    22871        /*I* CALL: CALL Y$RESP                                    */
     2826    22872
     2827    22873    2   Y$RESP: ENTRY;
     2828    22874
     2829    22875    2       IF KX$L2.FLG.DTE_BUSY
     2830    22876    2          THEN
     2831    22877    2             CTL = %Y_CTL_RNR_P#;
     2832    22878    2          ELSE
     2833    22879    2             CTL = %Y_CTL_RR_P#;
     2834    22880    2       KX$L2.DCE_I_CNT = 0;
     2835    22881    2       GOTO SEND_ADR_RESP;
     2836    22882
     2837    22883    2   Y$SEND_RESPONSE: ENTRY;
     2838    22884        /*I* NAME: Y$SEND_RESPONSE                                */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:104  
     2839    22885        /*I* PURPOSE: This subroutine will send the requested response        */
     2840    22886        /*I* CALL: CALL Y$SEND_RESPONSE                           */
     2841    22887        /*I* INPUT: CTL  =  response to send                      */
     2842    22888
     2843    22889    2   SEND_ADR_RESP:
     2844    22890    2       ADDRESS = KX$L2.ADR_RESP;
     2845    22891    2       GOTO SEND_COMMON;
     2846    22892
     2847    22893    2   Y$SEND_COMMAND: ENTRY;
     2848    22894
     2849    22895        /*I* NAME: Y$SEND_COMMAND                                 */
     2850    22896        /*I* PURPOSE: This subroutine will send the requested command         */
     2851    22897        /*I* CALL: CALL Y$SEND_COMMAND                            */
     2852    22898        /*I* INPUT: CTL  =  command to send                       */
     2853    22899
     2854    22900    2       ADDRESS = KX$L2.ADR_CMND;
     2855    22901
     2856    22902        /* Get a buffer                                           */
     2857    22903
     2858    22904    2   SEND_COMMON:
     2859    22905    2       CALL KXS$GETBFR ( 0, DAT$ );
     2860    22906    2       KX$DATA.RLS.L3 = '1'B;
     2861    22907    2       KX$DATA.RLS.L2 = '1'B;
     2862    22908
     2863    22909        /* Figure out the data size and where the P/F bit should be */
     2864    22910
     2865    22911    2       IF ( MOD(CTL,4)=1 AND KX$L2.FLG.EXTSEQ )
     2866    22912    2          THEN
     2867    22913    3             DO;
     2868    22914    3                KX$DATA.CNT = 3;
     2869    22915    3                IF ( BINBIT(CTL,8) & '00010000'B )  /* polled RR/RNR/REJ */
     2870    22916    3                   THEN
     2871    22917    4                      DO;
     2872    22918    4                         CTL = CTL - BITBIN('00010000'B);
     2873    22919    4                         KX$EXTFRAME.XCTL.PF = '1'B;  /* puts P/F bit in right place */
     2874    22920    4                      END;
     2875    22921    3             END;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:105  
     2876    22922    2          ELSE
     2877    22923    2             KX$DATA.CNT = 2;
     2878    22924
     2879    22925    2       KX$FRAME.ADR = ADDRESS;
     2880    22926
     2881    22927    2       KX$FRAME.CTL = CTL;
     2882    22928        /* Send the buffer                                        */
     2883    22929
     2884    22930    2       CALL KXN$CMND ( %KX_N_SUPV_Q#, CHN$->KH$CHN, DAT$ );
     2885    22931
     2886    22932    2   END /* SUBROUTINE */;
     2887    22933        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:106  
     2888    22934
     2889    22935        /*I* NAME: Y$STOP,  Y$DIED                                 */
     2890    22936        /*I* PURPOSE: Report STOP or DIED to packet level */
     2891    22937
     2892    22938    1   Y$STOP: PROC;
     2893    22939
     2894    22940    2       PEVENT = %KX_P_EV_STOP_ALL#;
     2895    22941
     2896    22942    2       GOTO SUBCOMMON;
     2897    22943
     2898    22944    2   Y$DIED: ENTRY;
     2899    22945
     2900    22946    2       PEVENT = %KX_P_EV_DIED_ALL#;
     2901    22947
     2902    22948    2   SUBCOMMON: ;                            /* THERE MUST BE AN ALTENTRY ABOVE ME */
     2903    22949
     2904    22950    2       CALL_FPT = '0'B;
     2905    22951    2       CALL_FPT.EVN = PEVENT;
     2906    22952    2       CALL_FPT.CAL$ = CTX$;
     2907    22953    2       CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN
     2908    22954    3             DO;
     2909    22955    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
     2910    22956    3             END;
     2911    22957    2   END /* SUBROUTINE */;
     2912    22958        %EJECT ;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:107  
     2913    22959    1   Y$ER: PROC;
     2914    22960               %WRSYSLOG   (  ERRCOD=ERCOD ,
     2915    22961                              TRMID = "KX$L1.CHN$->KH$CHN.TERMID" ) ;
     2916    22979    2       RETURN ;
     2917    22980    2   END ;
     2918    22981
     2919    22982    1   Y$ER2: PROC;
     2920    22983               %WRSYSLOG   (  ERRCOD=ERCOD ,
     2921    22984                  TRMID = "KX$L1.CHN$ -> KH$CHN.TERMID",
     2922    22985                  VAL0 = FEVENT,
     2923    22986                  VAL1 = FPT_X25.EVN,
     2924    22987                  VAL2 = KX$L2.STATES );
     2925    23005    2       RETURN ;
     2926    23006    2   END ;
     2927    23007
     2928    23008        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:108  
     2929    23009
     2930    23010    1   Y$UP: PROC;
     2931    23011
     2932    23012        /*I*
     2933    23013             NAME: Y$UP
     2934    23014             PURPOSE: Frame level is up. Stop timer, set L2.OK,
     2935    23015                      init Packet level, and log.
     2936    23016             CALL: CALL Y$UP
     2937    23017        */
     2938    23018
     2939    23019        /* Stop the timer                                         */
     2940    23020
     2941    23021    2       CALL Y$STOP_TIMER;
     2942    23022
     2943    23023        /*
     2944    23024           Tell KHA that link is active.
     2945    23025        */
     2946    23026    2       CALL KHA$LINE_ACTIVE ( KX$L1.CHN$->KH$CHN.TERMID );
     2947    23027
     2948    23028        /* Kludge by setting the OK flag                          */
     2949    23029
     2950    23030    2       KX$L2.FLG.OK = '1'B;
     2951    23031
     2952    23032        /* Tell the level 3 stuff to initialize                   */
     2953    23033
     2954    23034    2       CALL_FPT = '0'B;
     2955    23035    2       CALL_FPT.EVN = %KX_P_EV_INIT#;
     2956    23036    2       CALL_FPT.CAL$ = CTX$;
     2957    23037    2       CALL KXP$PACKET ( CALL_FPT )
     2958    23038    3          WHENALTRETURN DO;
     2959    23039    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
     2960    23040    3             END;
     2961    23041
     2962    23042        /* Log the action                                         */
     2963    23043
     2964    23044    2       ERCOD = UP ;
     2965    23045    2       CALL Y$ER ;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:109  
     2966    23046
     2967    23047
     2968    23048        /* Stats                                                  */
     2969    23049
     2970    23050    2       KX_STATS_HDLC.LINES = KX_STATS_HDLC.LINES + 1;
     2971    23051    2       KX_STATS_HDLC.CONNECTS = KX_STATS_HDLC.CONNECTS + 1;
     2972    23052
     2973    23053
     2974    23054    2   END Y$UP;
     2975    23055
     2976    23056        %EJECT ;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:110  
     2977    23057    1   Y$STOP_TIMER:
     2978    23058    1       PROC ;
     2979    23059                  %STOP_TIMER ( FPTN = KX$L2.TMRBLK );
     2980    23068    2       RETURN ;
     2981    23069    2   END ;
     2982    23070    1   Y$STOP_T20: PROC;
     2983    23071            %STOP_TIMER ( FPTN = KX$L2.T20TMR );
     2984    23080    2       RETURN;
     2985    23081    2   END;
     2986    23082
     2987    23083
     2988    23084
     2989    23085    1   Y$CAL_PAC:
     2990    23086    1       PROC ALTRET ;
     2991    23087    2       CALL_FPT = '0'B;
     2992    23088    2       CALL_FPT.EVN = TEMP1 ;
     2993    23089    2       IF ADMIN_FPT.CHN$->KH$CHN.TERMID.TTYP=%KLTY_LINKDEV# THEN RETURN;
     2994    23090    2       CALL_FPT.RCV$ = ADMIN_FPT.CHN$->KH$CHN.CTX$ ;
     2995    23091    2   Y$CAL_PAC0: ENTRY ALTRET;
     2996    23092    2       CALL_FPT.PRM1$ = ADDR( ADMIN_FPT ) ;
     2997    23093    2   Y$CAL_PAC1: ENTRY ALTRET;
     2998    23094    2       CALL_FPT.CAL$ = CTX$ ;
     2999    23095    2       CALL KXP$PACKET (CALL_FPT)
     3000    23096    3          WHENALTRETURN DO;
     3001    23097    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
     3002    23098    3             END;
     3003    23099    2       RETURN ;
     3004    23100    2   END ;
     3005    23101
     3006    23102        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:111  
     3007    23103
     3008    23104    1   Y$START_TIMER: PROC;
     3009    23105
     3010    23106        /*
     3011    23107            There are so many occurrences of %START_TIMER that it make more
     3012    23108            sense to do what the macro does in an internal routine.
     3013    23109        */
     3014    23110
     3015    23111    2       IF KX$L2.T1 ~= 0
     3016    23112    2          THEN
     3017    23113    3             DO;
     3018    23114    3                KX$L2.TMRBLK.CNT = KX$L2.T1;
     3019    23115    3                IF NOT KX$L2.TMRBLK.ON
     3020    23116    3                   THEN
     3021    23117    4                      DO;
     3022    23118    4                         KX$L2.TMRBLK.ON = '1'B;
     3023    23119    4                         KX$L2.TMRBLK.FLNK$ = ADDR(NIL);
     3024    23120    4                         IF KX_TMRBLK.QTL$ = ADDR(NIL)
     3025    23121    4                            THEN
     3026    23122    4                               KX_TMRBLK.QHD$ = ADDR ( KX$L2.TMRBLK );
     3027    23123    4                            ELSE
     3028    23124    4                               KX_TMRBLK.QTL$ -> KX$BTMRBLK.FLNK$ = ADDR ( KX$L2.TMRBLK
             23124                                        );
     3029    23125    4                         KX$L2.TMRBLK.BLNK$ = KX_TMRBLK.QTL$;
     3030    23126    4                         KX_TMRBLK.QTL$ = ADDR ( KX$L2.TMRBLK );
     3031    23127    4                      END;
     3032    23128    3             END;
     3033    23129    2          ELSE
     3034    23130    2             IF KX$L2.TMRBLK.ON
     3035    23131    2                THEN
     3036    23132    3                   DO;
     3037    23133    3                      KX$L2.TMRBLK.ON = '0'B;
     3038    23134    3                      IF KX$L2.TMRBLK.FLNK$ = ADDR(NIL)
     3039    23135    3                         THEN
     3040    23136    3                            KX_TMRBLK.QTL$ = KX$L2.TMRBLK.BLNK$;
     3041    23137    3                         ELSE
     3042    23138    3                            KX$L2.TMRBLK.FLNK$ -> KX$BTMRBLK.BLNK$ = KX$L2.TMRBLK.BLNK$
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:112  
             23138                                     ;
     3043    23139    3                      IF KX$L2.TMRBLK.BLNK$ = ADDR(NIL)
     3044    23140    3                         THEN
     3045    23141    3                            KX_TMRBLK.QHD$ = KX$L2.TMRBLK.FLNK$;
     3046    23142    3                         ELSE
     3047    23143    3                            KX$L2.TMRBLK.BLNK$ -> KX$BTMRBLK.FLNK$ = KX$L2.TMRBLK.FLNK$
             23143                                     ;
     3048    23144    3                   END;
     3049    23145
     3050    23146    2       RETURN;
     3051    23147
     3052    23148    2   END Y$START_TIMER;
     3053    23149        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:113  
     3054    23150
     3055    23151    1   Y$CLR_DAT_Q: PROC;
     3056    23152
     3057    23153        /*I* NAME: Y$CLR_DAT_Q
     3058    23154             PURPOSE: Clear the queue of I frames
     3059    23155        */
     3060    23156    3       DO WHILE ( KX$L2.OUT_Q_HEAD$ ~= ADDR(NIL));
     3061    23157    3          DAT$ = KX$L2.OUT_Q_HEAD$;
     3062    23158    3          KX$L2.OUT_Q_HEAD$ = KX$DATA.NEXT$;
     3063    23159        /*
     3064    23160                                             If all the other layers are done
     3065    23161                                             with this buffer, release it.
     3066    23162        */
     3067    23163    3          KX$DATA.RLS.L1 = '1'B;
     3068    23164    3          IF ( KX$DATA.RLS_STAT = %KX_BFR_RLS_OK# )
     3069    23165    3             THEN
     3070    23166    4                DO;
     3071    23167    4                   CALL KXS$RLSBFR ( DAT$ );
     3072    23168    4                END;
     3073    23169    3             ELSE
     3074    23170    4                DO;
     3075    23171    4                   KX$DATA.NEXT$ = ADDR(NIL);
     3076    23172    4                END /* IF */;
     3077    23173
     3078    23174        /* Loop back for the next buffer                                              */
     3079    23175
     3080    23176    3       END /* LOOP */;
     3081    23177
     3082    23178        /* Reset the count                                                            */
     3083    23179
     3084    23180
     3085    23181        /* The tail is also null                                                      */
     3086    23182
     3087    23183    2       KX$L2.OUT_Q_TAIL$ = ADDR(NIL);
     3088    23184    2       RETURN;
     3089    23185    2   END Y$CLR_DAT_Q;
     3090    23186        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:114  
     3091    23187
     3092    23188    1   Y$CLR_SUP_Q: PROC;
     3093    23189
     3094    23190        /*I* NAME: Y$CLR_SUP_Q
     3095    23191             PURPOSE: Clear the queue of Supervisory frames
     3096    23192        */
     3097    23193    3       DO WHILE ( KX$L2.SUPV_Q_HEAD$ ~= ADDR(NIL));
     3098    23194    3          DAT$ = KX$L2.SUPV_Q_HEAD$;
     3099    23195    3          KX$L2.SUPV_Q_HEAD$ = KX$DATA.NEXT$;
     3100    23196        /*
     3101    23197                                             Release it.
     3102    23198        */
     3103    23199    3          CALL KXS$RLSBFR ( DAT$ );
     3104    23200        /* Loop back for the next buffer                                              */
     3105    23201
     3106    23202    3       END /* LOOP */;
     3107    23203
     3108    23204
     3109    23205        /* The tail is also null                                                      */
     3110    23206
     3111    23207    2       KX$L2.SUPV_Q_TAIL$ = ADDR(NIL);
     3112    23208    2       RETURN;
     3113    23209    2   END Y$CLR_SUP_Q;
     3114    23210
     3115    23211
     3116    23212    1   END KXF$FRAME;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:115  
--  Include file information  --

   KNH_MACRO_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV_GLB.:E05TOU  is referenced.
   KX_MACROS_M.:E05TOU  is referenced.
   KX_DATA_C.:E05TOU  is referenced.
   KX_SCODE_C.:E05TOU  is referenced.
   KX_PERR_C.:E05TOU  is referenced.
   KX_EQUS_E.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
      No diagnostics issued in procedure KXF$FRAME.

   Procedure KXF$FRAME requires 4543 words for executable code.
   Procedure KXF$FRAME requires 70 words of local(AUTO) storage.
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:116  

    No errors detected in file KXF$FRAME.:E05TSI    .

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:117  

 Object Unit name= KXF$FRAME                                  File name= KXF$FRAME.:E05TOU
 UTS= JUL 30 '97 02:19:00.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    456    1C8  KXF$FRAME
    1   Data  even  none    32     20  KXF$FRAME
    2   Proc  even  none  4543   11BF  KXF$FRAME
    3  RoData even  none     9      9  KXF$FRAME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  KXF$FRAME
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:118  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       7 KXS$SYSLOG
 yes     yes           Std       2 KXS$GETCNTX
 yes     yes           Std       2 KVB$GETSYS
         yes           Std       1 KHA$LINE_INACTIVE
 yes     yes           Std       1 KHA$TSTCNC
         yes           Std       3 KXN$CMND
 yes     yes           Std       6 KHA$DVCADM
         yes           Std       1 KXC$CQSCN
 yes     yes           Std       1 KXP$PACKET
         yes           Std       1 KXS$RLSCNTX
 yes     yes           Std       3 KXS$GETBFR
         yes           Std       1 KHD$SCREECH
         yes           Std       1 KXS$RLSBFR
         yes           Std       1 KHA$LINE_ACTIVE
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     G$JIT$                                KV_CQ_HNDSBR$                         KX_TMRBLK
     KX_STATS_HDLC                         KX_STATS_X25                          KX_PM$
r    G$ROS$
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:119  


        1        1        /*M* KXF$FRAME  -  X.25 Handler Frame Level Subroutine      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*X*  PLM = 4, IND=3, CTI=3, DCI=6, IAD=0, DTI=6, AND=Y, CSI=3, THI=3, STI=3, DMC=Y
                 8         */
        9        9        /*P* NAME: KXF$FRAME                                      */
       10       10        /*P* PURPOSE: This module contains the X.25 frame level   */
       11       11        /*P* subroutine and state machine.                        */
       12       12
       13       13        KXF$FRAME: PROC ( FPT_X25 ) ALTRET;

     13   2 000000  D380 0000 0000  xent KXF$FRAME       LNJ,B5   X6A_AUTO_1
          2 000003       0046 0001                       DC       70,1

       14       14
       15       15        /*F* NAME: KXF$FRAME                                      */
       16       16        /*F* PURPOSE: This subroutine does the normal state       */
       17       17        /*F* transitions for the X.25 frame level.                */
       18       18
       19       19        /*D* NAME: KXF$FRAME                                      */
       20       20        /*D* PURPOSE: This subroutine does the normal state       */
       21       21        /*D* transitions for the X.25 frame level.                */
       22       22        /*D* CALL: CALL KXF$FRAME, ARGS ( FEVENT, *D* CTX$, *D* DAT$ )   */
       23       23        /*D* INPUT: FEVENT  =  frame event type                     */
       24       24        /*D* CTX$  =  line context block pointer                    */
       25       25        /*D* DAT$  =  data pointer  ( optional )                        */
       26       26        /*D* OUTPUT: none                                         */
       27       27
       28       28        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:120  
       29       29
       30       30        /* Include files                                           */
       31       31
       32       32        %INCLUDE K_ID_E;
       33       82        %K#ENTID_E;
       34      101        %K#LYRID_E;
       35      108        %INCLUDE KL_MACRO_C;
       36     3460        %INCLUDE KL_AFCN_C;
       37     3561        %INCLUDE LCP_6;
       38     7840        %INCLUDE CP_6_SUBS;
       39     8380        %INCLUDE G_JIT_M;
       40     8645        %INCLUDE KH$CHN;
       41     8767        %INCLUDE KH$CLK;
       42     9137        %INCLUDE KHA_FNC_E;
       43     9237        %INCLUDE KH_CLKFNC_E;
       44     9282        %INCLUDE KH_MACRO_C;
       45    10025        %INCLUDE KL_SUPER_C;
       46    12927        %INCLUDE KX_EQUS_E;
       47    13366        %INCLUDE KX_PERR_C;
       48    13495        %INCLUDE KX_SCODE_C;
       49    13561        %INCLUDE KX_DATA_C;
       50    13629        %INCLUDE KX_MACROS_M;
       51    14400        %INCLUDE KV_GLB;
       52    14423        %INCLUDE KV_GLBCNS_E;
       53    14764        %INCLUDE K_ADDRESS_M;
       54    15267        %INCLUDE KNH_MACRO_C;
       55    15550        %KV#CQ_HNDID_E;
       56    15555        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:121  
       57    15556        /*****************************************************************
       58    15557        *                                                                *
       59    15558        *                           Refs (inside X.25)                   *
       60    15559        *                                                                *
       61    15560        *****************************************************************/
       62    15561
       63    15562    1   DCL KHA$TSTCNC ENTRY (1) ALTRET;
       64    15563    1   DCL KHA$DVCADM ENTRY (6) ALTRET;
       65    15564    1   DCL KHA$LINE_ACTIVE ENTRY (1);
       66    15565    1   DCL KHA$LINE_INACTIVE ENTRY (1);
       67    15566    1   DCL KXC$CQSCN ENTRY (1);
       68    15567    1   DCL KXN$CMND ENTRY (3);
       69    15568    1   DCL KXP$PACKET ENTRY (1) ALTRET;
       70    15569    1   DCL KXS$GETBFR ENTRY (3) ALTRET;
       71    15570    1   DCL KXS$GETCNTX ENTRY (2) ALTRET;
       72    15571    1   DCL KXS$RLSBFR ENTRY (1);
       73    15572    1   DCL KXS$RLSCNTX ENTRY (1);
       74    15573    1   DCL KXS$Q_SYSLOG ENTRY (1);
       75    15574    1   DCL KXS$SYSLOG ENTRY (7);
       76    15575    1   DCL KXS$TMR ENTRY (1);
       77    15576    1   DCL KXX$X29 ENTRY (1);
       78    15577    1   DCL KHD$SCREECH ENTRY (1);
       79    15578    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
       80    15579    1   DCL KVB$GETSYS ENTRY (2) ALTRET;
       81    15580
       82    15581        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:122  
       83    15582        /*****************************************************************
       84    15583        *                                                                *
       85    15584        *                           Local equates                        *
       86    15585        *                                                                *
       87    15586        *****************************************************************/
       88    15587
       89    15588        /*****************************************************************
       90    15589        *                                                                *
       91    15590        *                           Action types                         *
       92    15591        *                                                                *
       93    15592        *****************************************************************/
       94    15593
       95    15594        %EQU Y_ACT_MIN# = 0;
       96    15595        %EQU Y_ACT_NULL# = 0;
       97    15596        %EQU Y_ACT_SCREECH# = 1;
       98    15597        %EQU Y_ACT_LOG# = 2;
       99    15598        %EQU Y_ACT_START# = 3;
      100    15599        %EQU Y_ACT_STOP# = 4;
      101    15600        %EQU Y_ACT_DISC_RETRY1# = 5;
      102    15601        %EQU Y_ACT_UA# = 6;
      103    15602        %EQU Y_ACT_SABM# = 7;
      104    15603        %EQU Y_ACT_DISC_R# = 8;
      105    15604        %EQU Y_ACT_DISC_L# = 9;
      106    15605        %EQU Y_ACT_DISC_LU# = 10;
      107    15606        %EQU Y_ACT_SABM_P# = 11;
      108    15607        %EQU Y_ACT_UP# = 12;
      109    15608        %EQU Y_ACT_DM# = 13;
      110    15609        %EQU Y_ACT_SABM_PR# = 14;
      111    15610        %EQU Y_ACT_DISC# = 15;
      112    15611        %EQU Y_ACT_RR_P# = 16;
      113    15612        %EQU Y_ACT_CL_BUSY# = 17;
      114    15613        %EQU Y_ACT_CL_REJ# = 18;
      115    15614        %EQU Y_ACT_DATA_OUT# = 19;
      116    15615        %EQU Y_ACT_DATA_IN# = 20;
      117    15616        %EQU Y_ACT_SABM_U# = 21;
      118    15617        %EQU Y_ACT_FRMR# = 22;
      119    15618        %EQU Y_ACT_RESP# = 23;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:123  
      120    15619        %EQU Y_ACT_REJ# = 24;
      121    15620        %EQU Y_ACT_RESET# = 25;
      122    15621        %EQU Y_ACT_RESET_P# = 26;
      123    15622        %EQU Y_ACT_CL_RESET# = 27;
      124    15623        %EQU Y_ACT_DATA_IN_S# = 28;
      125    15624        %EQU Y_ACT_CL_TR# = 29;
      126    15625        %EQU Y_ACT_RR_PR# = 30;
      127    15626        %EQU Y_ACT_DISC_NV# = 31;
      128    15627        %EQU Y_ACT_DISC_UNV# = 32;
      129    15628        %EQU Y_ACT_UP_UA# = 33;
      130    15629        %EQU Y_ACT_FRMR_TO# = 34;
      131    15630        %EQU Y_ACT_SP3# = 35;
      132    15631        %EQU Y_ACT_MAX# = 35;
      133    15632
      134    15633        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:124  
      135    15634        /*****************************************************************
      136    15635        *                                                                *
      137    15636        *                           Frame types                          *
      138    15637        *                                                                *
      139    15638        *****************************************************************/
      140    15639
      141    15640        %EQU Y_CTL_MIN# = BITBIN( '01'X );
      142    15641        %EQU Y_CTL_RR# = BITBIN( '01'X );
      143    15642        %EQU Y_CTL_RR_P# = BITBIN( '11'X );
      144    15643        %EQU Y_CTL_RR_F# = BITBIN( '11'X );
      145    15644        %EQU Y_CTL_RNR# = BITBIN( '05'X );
      146    15645        %EQU Y_CTL_RNR_P# = BITBIN( '15'X );
      147    15646        %EQU Y_CTL_REJ# = BITBIN( '09'X );
      148    15647        %EQU Y_CTL_REJ_P# = BITBIN( '19'X );
      149    15648        %EQU Y_CTL_DM# = BITBIN( '0F'X );
      150    15649        %EQU Y_CTL_DM_F# = BITBIN( '1F'X );
      151    15650        %EQU Y_CTL_SABM# = BITBIN( '2F'X );
      152    15651        %EQU Y_CTL_SABM_P# = BITBIN( '3F'X );
      153    15652        %EQU Y_CTL_DISC# = BITBIN( '43'X );
      154    15653        %EQU Y_CTL_DISC_P# = BITBIN( '53'X );
      155    15654        %EQU Y_CTL_UA# = BITBIN( '63'X );
      156    15655        %EQU Y_CTL_UA_F# = BITBIN( '73'X );
      157    15656        %EQU Y_CTL_FRMR# = BITBIN( '87'X );
      158    15657        %EQU Y_CTL_FRMR_F# = BITBIN( '97'X );
      159    15658        %EQU Y_CTL_SABME#=BITBIN('6F'X);
      160    15659        %EQU Y_CTL_SABME_P#=BITBIN('7F'X);
      161    15660        %EQU Y_CTL_MAX# = BITBIN( '97'X );
      162    15661
      163    15662        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:125  
      164    15663        /*****************************************************************
      165    15664        *                                                                *
      166    15665        *                           Event types                          *
      167    15666        *                                                                *
      168    15667        *****************************************************************/
      169    15668
      170    15669        %EQU Y_EV_MIN# = 0;
      171    15670        %EQU Y_EV_START# = 0;
      172    15671        %EQU Y_EV_STOP# = 1;
      173    15672        %EQU Y_EV_DIED# = 2;
      174    15673        %EQU Y_EV_TO_RC_LT_N2# = 3;
      175    15674        %EQU Y_EV_TO_RC_GE_N2# = 4;
      176    15675        %EQU Y_EV_CL_BUSY# = 5;
      177    15676        %EQU Y_EV_CL_REJ# = 6;
      178    15677        %EQU Y_EV_DATA_OUT# = 7;
      179    15678        %EQU Y_EV_I# = 8;
      180    15679        %EQU Y_EV_SABM# = 9;
      181    15680        %EQU Y_EV_DISC# = 10;
      182    15681        %EQU Y_EV_UA# = 11;
      183    15682        %EQU Y_EV_UA_F# = 12;
      184    15683        %EQU Y_EV_DM# = 13;
      185    15684        %EQU Y_EV_RR# = 14;
      186    15685        %EQU Y_EV_RR_F# = 15;
      187    15686        %EQU Y_EV_RNR# = 16;
      188    15687        %EQU Y_EV_RNR_F# = 17;
      189    15688        %EQU Y_EV_REJ# = 18;
      190    15689        %EQU Y_EV_REJ_F# = 19;
      191    15690        %EQU Y_EV_FRMR# = 20;
      192    15691        %EQU Y_EV_FRMR_F# = 21;
      193    15692        %EQU Y_EV_BAD_F# = 22;
      194    15693        %EQU Y_EV_BAD_NR# = 23;
      195    15694        %EQU Y_EV_BAD_ADR# = 24;
      196    15695        %EQU Y_EV_GARBAGE# = 25;
      197    15696        %EQU Y_EV_BAD_IFLD# = 26;
      198    15697        %EQU Y_EV_SP1# = 27;
      199    15698        %EQU Y_EV_SP2# = 28;
      200    15699        %EQU Y_EV_SP3# = 29;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:126  
      201    15700        %EQU Y_EV_MAX# = 29;
      202    15701
      203    15702        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:127  
      204    15703        /*****************************************************************
      205    15704        *                                                                *
      206    15705        *                           States                               *
      207    15706        *                                                                *
      208    15707        *****************************************************************/
      209    15708
      210    15709        %EQU Y_ST_MIN# = 0;
      211    15710        %EQU Y_ST_NULL# = 0;
      212    15711        %EQU Y_ST_DISC# = 1;
      213    15712        %EQU Y_ST_SETUP# = 2;
      214    15713        %EQU Y_ST_SETUP_TO# = 3;
      215    15714        %EQU Y_ST_NORMAL# = 4;
      216    15715        %EQU Y_ST_RESET# = 5;
      217    15716        %EQU Y_ST_RESET_TO# = 6;
      218    15717        %EQU Y_ST_FRMR# = 7;
      219    15718        %EQU Y_ST_TIMER_REC# = 8;
      220    15719        %EQU Y_ST_SP1# = 9;
      221    15720        %EQU Y_ST_SP2# = 10;
      222    15721        %EQU Y_ST_SP3# = 11;
      223    15722        %EQU Y_ST_MAX# = 11;
      224    15723
      225    15724        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:128  
      226    15725        /*****************************************************************
      227    15726        *                                                                *
      228    15727        *                           Supervisory frame types              *
      229    15728        *                                                                *
      230    15729        *****************************************************************/
      231    15730
      232    15731        %EQU Y_TYPE_MIN# = 0;
      233    15732        %EQU Y_TYPE_RR# = 0;
      234    15733        %EQU Y_TYPE_RNR# = 2;
      235    15734        %EQU Y_TYPE_REJ# = 4;
      236    15735        %EQU Y_TYPE_MAX# = 4;
      237    15736        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:129  
      238    15737        /*****************************************************************
      239    15738        *                                                                *
      240    15739        *                           Constant data                        *
      241    15740        *                                                                *
      242    15741        *****************************************************************/
      243    15742
      244    15743    1   DCL FRMR_REASON (0:%(%Y_EV_MAX#+1)) CONSTANT UBIN BYTE UNAL INIT ( 1*23,8,1,4,3,1*0
             15743            );
      245    15744        %KX$LINKDEV ( FPTN = KX_LINKDEV, STCLASS = CONSTANT );
      246    15771
      247    15772        /*****************************************************************
      248    15773        *                                                                *
      249    15774        *                           The magic state table                *
      250    15775        *                                                                *
      251    15776        *****************************************************************/
      252    15777
      253    15778    1   DCL 1 STATE_TABLE CONSTANT,
      254    15779    1         2 NEXT_STATE (0:%(%(%Y_EV_MAX# + 1) * %(%Y_ST_MAX# + 1)-1)) UBIN(8) UNAL
      255    15780    1    INIT(
      256    15781
      257    15782        /*  Null state - next states */
      258    15783
      259    15784    1    %Y_ST_DISC#,%Y_ST_NULL#,%Y_ST_NULL#,
      260    15785    1    %Y_ST_NULL#,%Y_ST_NULL#,
      261    15786    1    %Y_ST_NULL#,%Y_ST_NULL#,
      262    15787    1    %Y_ST_NULL#,%Y_ST_NULL#,
      263    15788    1    %Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,
      264    15789    1    %Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,
      265    15790    1    %Y_ST_NULL#,%Y_ST_NULL#,
      266    15791    1    %Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,
      267    15792    1    %Y_ST_NULL#,%Y_ST_NULL#,%Y_ST_NULL#,
      268    15793
      269    15794        /*  Disc state - next states */
      270    15795
      271    15796    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,
      272    15797    1    %Y_ST_DISC#,%Y_ST_DISC#,
      273    15798    1    %Y_ST_DISC#,%Y_ST_DISC#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:130  
      274    15799    1    %Y_ST_DISC#,%Y_ST_DISC#,
      275    15800    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      276    15801    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,
      277    15802    1    %Y_ST_DISC#,%Y_ST_DISC#,
      278    15803    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,
      279    15804    1    %Y_ST_DISC#,%Y_ST_DISC#,%Y_ST_DISC#,
      280    15805
      281    15806        /*  Setup state - next states */
      282    15807
      283    15808    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      284    15809    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP#,
      285    15810    1    %Y_ST_SETUP#,%Y_ST_SETUP#,
      286    15811    1    %Y_ST_SETUP#,%Y_ST_SETUP#,
      287    15812    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_NORMAL#,%Y_ST_SETUP#,%Y_ST_SETUP_TO#,
      288    15813    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      289    15814    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      290    15815    1    %Y_ST_SETUP#,%Y_ST_SETUP#,
      291    15816    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      292    15817    1    %Y_ST_SETUP#,%Y_ST_SETUP#,%Y_ST_SETUP#,
      293    15818
      294    15819        /*  Setup time out state - next states */
      295    15820
      296    15821    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      297    15822    1    %Y_ST_SETUP_TO#,%Y_ST_DISC#,
      298    15823    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      299    15824    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      300    15825    1    %Y_ST_SETUP_TO#,%Y_ST_DISC#,%Y_ST_SETUP_TO#,%Y_ST_NORMAL#,
      301    15826    1    %Y_ST_SETUP_TO#,
      302    15827    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      303    15828    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      304    15829    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      305    15830    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      306    15831    1    %Y_ST_SETUP_TO#,
      307    15832    1    %Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,%Y_ST_SETUP_TO#,
      308    15833
      309    15834        /*  Normal state - next states */
      310    15835
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:131  
      311    15836    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,%Y_ST_NORMAL#,
      312    15837    1    %Y_ST_TIMER_REC#,%Y_ST_RESET#,
      313    15838    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,
      314    15839    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,
      315    15840    1    %Y_ST_NORMAL#,%Y_ST_DISC#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_RESET#,
      316    15841    1    %Y_ST_NORMAL#,%Y_ST_FRMR#,%Y_ST_NORMAL#,
      317    15842    1    %Y_ST_FRMR#,%Y_ST_NORMAL#,%Y_ST_FRMR#,
      318    15843    1    %Y_ST_RESET#,%Y_ST_FRMR#,
      319    15844    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_NORMAL#,%Y_ST_FRMR#,
      320    15845    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,%Y_ST_NORMAL#,
      321    15846
      322    15847        /*  Reset state - next states */
      323    15848
      324    15849    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      325    15850    1    %Y_ST_RESET_TO#,%Y_ST_RESET#,
      326    15851    1    %Y_ST_RESET#,%Y_ST_RESET#,
      327    15852    1    %Y_ST_RESET#,%Y_ST_RESET#,
      328    15853    1    %Y_ST_RESET#,%Y_ST_DISC#,%Y_ST_NORMAL#,%Y_ST_RESET#,%Y_ST_SETUP_TO#,
      329    15854    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      330    15855    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      331    15856    1    %Y_ST_RESET#,%Y_ST_RESET#,
      332    15857    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      333    15858    1    %Y_ST_RESET#,%Y_ST_RESET#,%Y_ST_RESET#,
      334    15859
      335    15860        /*  Reset time out state - next states */
      336    15861
      337    15862    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      338    15863    1    %Y_ST_RESET_TO#,%Y_ST_DISC#,
      339    15864    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      340    15865    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      341    15866    1    %Y_ST_RESET_TO#,%Y_ST_DISC#,%Y_ST_RESET_TO#,%Y_ST_NORMAL#,
      342    15867    1    %Y_ST_SETUP_TO#,
      343    15868    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      344    15869    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      345    15870    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      346    15871    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      347    15872    1    %Y_ST_RESET_TO#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:132  
      348    15873    1    %Y_ST_RESET_TO#,%Y_ST_RESET_TO#,%Y_ST_RESET_TO#,
      349    15874
      350    15875        /*  Frame reject state - next states */
      351    15876
      352    15877    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,
      353    15878    1    %Y_ST_FRMR#,%Y_ST_RESET#,
      354    15879    1    %Y_ST_FRMR#,%Y_ST_FRMR#,
      355    15880    1    %Y_ST_FRMR#,%Y_ST_FRMR#,
      356    15881    1    %Y_ST_NORMAL#,%Y_ST_DISC#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_RESET#,
      357    15882    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,
      358    15883    1    %Y_ST_RESET#,%Y_ST_FRMR#,
      359    15884    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,
      360    15885    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,
      361    15886
      362    15887        /*  Timer recovery state - next states */
      363    15888
      364    15889    1    %Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,
      365    15890    1    %Y_ST_TIMER_REC#,%Y_ST_RESET#,
      366    15891    1    %Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,
      367    15892    1    %Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,
      368    15893    1    %Y_ST_NORMAL#,%Y_ST_DISC#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_RESET#,
      369    15894    1    %Y_ST_TIMER_REC#,%Y_ST_NORMAL#,%Y_ST_TIMER_REC#,
      370    15895    1    %Y_ST_NORMAL#,%Y_ST_NORMAL#,%Y_ST_NORMAL#,
      371    15896    1    %Y_ST_RESET#,%Y_ST_RESET#,
      372    15897    1    %Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_FRMR#,%Y_ST_TIMER_REC#,%Y_ST_FRMR#,
      373    15898    1    %Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,%Y_ST_TIMER_REC#,
      374    15899
      375    15900        /*  Spare state #1 - next states */
      376    15901
      377    15902    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
      378    15903    1    %Y_ST_SP1#,%Y_ST_SP1#,
      379    15904    1    %Y_ST_SP1#,%Y_ST_SP1#,
      380    15905    1    %Y_ST_SP1#,%Y_ST_SP1#,
      381    15906    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
      382    15907    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
      383    15908    1    %Y_ST_SP1#,%Y_ST_SP1#,
      384    15909    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:133  
      385    15910    1    %Y_ST_SP1#,%Y_ST_SP1#,%Y_ST_SP1#,
      386    15911
      387    15912        /*  Spare state #2 - next states */
      388    15913
      389    15914    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      390    15915    1    %Y_ST_SP2#,%Y_ST_SP2#,
      391    15916    1    %Y_ST_SP2#,%Y_ST_SP2#,
      392    15917    1    %Y_ST_SP2#,%Y_ST_SP2#,
      393    15918    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      394    15919    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      395    15920    1    %Y_ST_SP2#,%Y_ST_SP2#,
      396    15921    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      397    15922    1    %Y_ST_SP2#,%Y_ST_SP2#,%Y_ST_SP2#,
      398    15923
      399    15924        /*  Spare state #3 - next states */
      400    15925
      401    15926    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,
      402    15927    1    %Y_ST_SP3#,%Y_ST_SP3#,
      403    15928    1    %Y_ST_SP3#,%Y_ST_SP3#,
      404    15929    1    %Y_ST_SP3#,%Y_ST_SP3#,
      405    15930    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,
      406    15931    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,
      407    15932    1    %Y_ST_SP3#,%Y_ST_SP3#,
      408    15933    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#,
      409    15934    1    %Y_ST_SP3#,%Y_ST_SP3#,%Y_ST_SP3#),
      410    15935
      411    15936    1         2 ACTION (0:%(%(%Y_EV_MAX# + 1) * %(%Y_ST_MAX# + 1)-1)) UBIN(8) UNAL
      412    15937    1    INIT(
      413    15938
      414    15939        /*  Null state - actions */
      415    15940
      416    15941    1    %Y_ACT_START#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      417    15942    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      418    15943    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      419    15944    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      420    15945    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      421    15946    1    %Y_ACT_SCREECH#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:134  
      422    15947    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      423    15948    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      424    15949    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      425    15950    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      426    15951    1    %Y_ACT_SCREECH#,
      427    15952    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      428    15953
      429    15954        /*  Disc state - actions */
      430    15955
      431    15956    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      432    15957    1   %Y_ACT_DISC_R#,%Y_ACT_DISC_RETRY1#,
      433    15958    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      434    15959    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      435    15960    1    %Y_ACT_NULL#,%Y_ACT_UA#,%Y_ACT_SABM#,%Y_ACT_SABM#,%Y_ACT_SABM#,
      436    15961    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      437    15962    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      438    15963    1    %Y_ACT_NULL#,%Y_ACT_NULL#,
      439    15964    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      440    15965    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      441    15966
      442    15967        /*  Setup state - actions */
      443    15968
      444    15969    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      445    15970    1    %Y_ACT_SABM_P#,%Y_ACT_SCREECH#,
      446    15971    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      447    15972    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      448    15973    1    %Y_ACT_UA#,%Y_ACT_UA#,%Y_ACT_UP#,%Y_ACT_NULL#,%Y_ACT_SABM_P#,
      449    15974    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      450    15975    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      451    15976    1    %Y_ACT_NULL#,%Y_ACT_NULL#,
      452    15977    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      453    15978    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      454    15979
      455    15980        /*  Setup time out state - actions */
      456    15981
      457    15982    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      458    15983    1    %Y_ACT_SABM_PR#,%Y_ACT_DISC#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:135  
      459    15984    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      460    15985    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      461    15986    1    %Y_ACT_UA#,%Y_ACT_DISC_UNV#,%Y_ACT_NULL#,%Y_ACT_UP#,%Y_ACT_SABM_P#,
      462    15987    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      463    15988    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      464    15989    1    %Y_ACT_NULL#,%Y_ACT_NULL#,
      465    15990    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      466    15991    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      467    15992
      468    15993        /*  Normal state - actions */
      469    15994
      470    15995    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      471    15996    1    %Y_ACT_RR_P#,%Y_ACT_RESET#,
      472    15997    1    %Y_ACT_CL_BUSY#,%Y_ACT_CL_REJ#,
      473    15998    1    %Y_ACT_DATA_OUT#,%Y_ACT_DATA_IN#,
      474    15999    1    %Y_ACT_SABM_U#,%Y_ACT_DISC_LU#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,
      475    16000    1    %Y_ACT_RESET_P#,
      476    16001    1    %Y_ACT_RESP#,%Y_ACT_FRMR#,%Y_ACT_RESP#,
      477    16002    1    %Y_ACT_FRMR#,%Y_ACT_REJ#,%Y_ACT_FRMR#,
      478    16003    1    %Y_ACT_RESET#,%Y_ACT_FRMR#,
      479    16004    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_LOG#,%Y_ACT_FRMR#,
      480    16005    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      481    16006
      482    16007        /*  Reset state - actions */
      483    16008
      484    16009    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      485    16010    1    %Y_ACT_RESET_P#,%Y_ACT_SCREECH#,
      486    16011    1    %Y_ACT_CL_BUSY#,%Y_ACT_SCREECH#,
      487    16012    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      488    16013    1    %Y_ACT_UA#,%Y_ACT_DISC_LU#,%Y_ACT_CL_RESET#,%Y_ACT_NULL#,
      489    16014    1    %Y_ACT_SABM_P#,
      490    16015    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      491    16016    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      492    16017    1    %Y_ACT_RESET#,%Y_ACT_NULL#,
      493    16018    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      494    16019    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      495    16020
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:136  
      496    16021        /*  Reset time out state - actions */
      497    16022
      498    16023    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      499    16024    1    %Y_ACT_SABM_PR#,%Y_ACT_DISC_L#,
      500    16025    1    %Y_ACT_CL_BUSY#,%Y_ACT_SCREECH#,
      501    16026    1    %Y_ACT_SCREECH#,%Y_ACT_NULL#,
      502    16027    1    %Y_ACT_UA#,%Y_ACT_DISC_LU#,%Y_ACT_NULL#,%Y_ACT_CL_RESET#,%Y_ACT_SABM_P#,
      503    16028    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      504    16029    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,
      505    16030    1    %Y_ACT_SABM_PR#,%Y_ACT_SABM_PR#,
      506    16031    1    %Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_NULL#,%Y_ACT_LOG#,%Y_ACT_NULL#,
      507    16032    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      508    16033
      509    16034        /*  Frame reject state - actions */
      510    16035
      511    16036    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      512    16037    1    %Y_ACT_FRMR_TO#,%Y_ACT_RESET#,
      513    16038    1    %Y_ACT_CL_BUSY#,%Y_ACT_SCREECH#,
      514    16039    1    %Y_ACT_SCREECH#,%Y_ACT_FRMR#,
      515    16040    1    %Y_ACT_SABM_U#,%Y_ACT_DISC_LU#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,
      516    16041    1    %Y_ACT_RESET#,
      517    16042    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,
      518    16043    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,
      519    16044    1    %Y_ACT_RESET#,%Y_ACT_FRMR#,
      520    16045    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_LOG#,%Y_ACT_FRMR#,
      521    16046    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      522    16047
      523    16048        /*  Timer recovery state - actions */
      524    16049
      525    16050    1    %Y_ACT_SCREECH#,%Y_ACT_STOP#,%Y_ACT_STOP#,
      526    16051    1    %Y_ACT_RR_PR#,%Y_ACT_RESET#,
      527    16052    1    %Y_ACT_CL_BUSY#,%Y_ACT_CL_REJ#,
      528    16053    1    %Y_ACT_SCREECH#,%Y_ACT_DATA_IN#,
      529    16054    1    %Y_ACT_SABM_U#,%Y_ACT_DISC_LU#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_RESET#,
      530    16055    1    %Y_ACT_RESP#,%Y_ACT_CL_TR#,%Y_ACT_RESP#,
      531    16056    1    %Y_ACT_CL_TR#,%Y_ACT_REJ#,%Y_ACT_REJ#,
      532    16057    1    %Y_ACT_RESET#,%Y_ACT_RESET#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:137  
      533    16058    1    %Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_FRMR#,%Y_ACT_LOG#,%Y_ACT_FRMR#,
      534    16059    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      535    16060
      536    16061        /*  Spare state #1 - actions */
      537    16062
      538    16063    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      539    16064    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      540    16065    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      541    16066    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      542    16067    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      543    16068    1    %Y_ACT_SCREECH#,
      544    16069    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      545    16070    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      546    16071    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      547    16072    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      548    16073    1    %Y_ACT_SCREECH#,
      549    16074    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      550    16075
      551    16076        /*  Spare state #2 - actions */
      552    16077
      553    16078    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      554    16079    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      555    16080    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      556    16081    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      557    16082    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      558    16083    1    %Y_ACT_SCREECH#,
      559    16084    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      560    16085    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      561    16086    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      562    16087    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      563    16088    1    %Y_ACT_SCREECH#,
      564    16089    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      565    16090
      566    16091        /*  Spare state #3 - actions */
      567    16092
      568    16093    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      569    16094    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:138  
      570    16095    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      571    16096    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      572    16097    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      573    16098    1    %Y_ACT_SCREECH#,
      574    16099    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      575    16100    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      576    16101    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      577    16102    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#,
      578    16103    1    %Y_ACT_SCREECH#,
      579    16104    1    %Y_ACT_SCREECH#,%Y_ACT_SCREECH#,%Y_ACT_SCREECH#);
      580    16105        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:139  
      581    16106        /*****************************************************************
      582    16107        *                                                                *
      583    16108        *                           WRSYSLOG VLPs                        *
      584    16109        *                                                                *
      585    16110        *****************************************************************/
      586    16111
      587    16112        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_FATAL_PROT#,
      588    16113                           FPTN = DISC,
      589    16114                           ERR# = %E_KXF_DISC# );
      590    16160        /*E*   ERROR:      KXF-E_KXF_DISC#-4
      591    16161               MESSAGE:    Time-out & retry exhausted in link set-up.
      592    16162        */
      593    16163        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_FATAL_PROT#,
      594    16164                           FPTN = DISC_L,
      595    16165                           ERR# = %E_KXF_DISC_L# );
      596    16211        /*E*   ERROR:      KXF-E_KXF_DISC_L#-4
      597    16212               MESSAGE:    Time-out & retry exhausted in link reset.
      598    16213        */
      599    16214        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_FATAL_PROT#,
      600    16215                           FPTN = DISC_LU,
      601    16216                           ERR# = %E_KXF_DISC_LU# );
      602    16262        /*E*   ERROR:      KXF-E_KXF_DISC_LU#-4
      603    16263               MESSAGE:    DISC frame received in data transfer state.
      604    16264        */
      605    16265        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_FATAL_PROT#,
      606    16266                           FPTN = DM,
      607    16267                           ERR# = %E_KXF_DM# );
      608    16313        /*E*   ERROR:      KXF-E_KXF_DM#-4
      609    16314               MESSAGE:    DM frame received during set-up procedure.
      610    16315        */
      611    16316        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_SOFT#,
      612    16317                           FPTN = FRMR,
      613    16318                           ERR# = %E_KXF_FRMR# );
      614    16364        /*E*   ERROR:      KXF-E_KXF_FRMR#-3
      615    16365               MESSAGE:    FRMR received in data transfer state.
      616    16366                           FRMR data recorded in VAL0, VAL1, and VAL2.
      617    16367        */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:140  
      618    16368        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_SOFT#,
      619    16369                           FPTN = LOG,
      620    16370                           ERR# = %E_KXF_LOG# );
      621    16416        /*E*   ERROR:      KXF-E_KXF_LOG#-3
      622    16417               MESSAGE:    An unexpected frame/event has been reported.
      623    16418                           VAL(0) is the internal event.  VAL(1) is the external event.
      624    16419                           VAL(2) is the state information.
      625    16420        */
      626    16421        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_NONFATAL_PROT#,
      627    16422                           FPTN = RESET,
      628    16423                           ERR# = %E_KXF_RESET# );
      629    16469        /*E*   ERROR:      KXF-E_KXF_RESET#-5
      630    16470               MESSAGE:    A link reset procedure was started.
      631    16471                           VAL(0) is the internal event.  VAL(1) is the external event.
      632    16472                           VAL(2) is the state information.
      633    16473        */
      634    16474        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_NONFATAL_PROT#,
      635    16475                           FPTN = T20TIMEOUT,
      636    16476                           ERR# = %E_KXF_T20TIMEOUT# );
      637    16522        /*E*   ERROR:      KXF-E_KXF_T20TIMEOUT#-5
      638    16523               MESSAGE:    Restart timer expired before getting restart confirm.
      639    16524        */
      640    16525        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_INFO#,
      641    16526                           FPTN = START,
      642    16527                           ERR# = %E_KXF_START# );
      643    16573        /*E*   ERROR:      KXF-E_KXF_START#-0
      644    16574               MESSAGE:    DSR and CTS are present. Line started.
      645    16575        */
      646    16576        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_INFO#,
      647    16577                           FPTN = UP,
      648    16578                           ERR# = %E_KXF_UP# );
      649    16624        /*E*   ERROR:      KXF-E_KXF_UP#-0
      650    16625               MESSAGE:    A line completed set-up procedures.
      651    16626        */
      652    16627        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_INFO#,
      653    16628                           FPTN = EXTENDED_FORMAT,
      654    16629                           ERR# = %E_KXF_EXTENDED_FORMAT# );
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:141  
      655    16675        /*E*   ERROR:      KXF-E_KXF_EXTENDED_FORMAT#-0
      656    16676               MESSAGE:    This link should speak extended frame format.
      657    16677        */
      658    16678        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='F',SEV=%G_WRSYSLOG_SEV_SOFT#,
      659    16679                           FPTN = SNDFRMR,
      660    16680                           ERR# = %E_KXF_SNDFRMR# );
      661    16726        /*E*   ERROR:      KXF-E_KXF_SNDFRMR#-3
      662    16727               MESSAGE:    A FRMR frame has been sent to the other end.
      663    16728                           VAL0 is the received control byte.
      664    16729                           VAL1 is the expected NS and NR values.
      665    16730                           VAL2 is the reason byte that was sent.
      666    16731                           VAL3 is the internal trace index, and data dumps the trace.
      667    16732        */
      668    16733        %VLP_SCODE (FPTN=Y_KHAALTRET,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_KHAALTRET#);
      669    16794        %VLP_SCODE (FPTN=Y_NO_PRMCLK,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_NO_PRMCLK#);
      670    16855        %VLP_SCODE (FPTN=Y_UNKEVT,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_FRM_UNKEVT#);
      671    16916        %VLP_SCODE (FPTN=Y_ACTSCR,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_FRM_ACTSCR#);
      672    16977        %VLP_SCODE (FPTN=Y_UNKACT,STCLASS=CONSTANT,FCG=KX,MID=F,ERR#=%S$KX_FRM_UNKACT#);
      673    17038        %FPT_X25 (FPTN = DATIN_FPT, STCLASS = CONSTANT, EVN = %KX_P_EV_DATIN#);
      674    17082        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:142  
      675    17083        /*****************************************************************
      676    17084        *                                                                *
      677    17085        *                           Auto                                 *
      678    17086        *                                                                *
      679    17087        *****************************************************************/
      680    17088
      681    17089    1   DCL CTX$ PTR;
      682    17090    1   DCL DAT$ PTR;
      683    17091    1   DCL CHN$ PTR;
      684    17092    1   DCL DVC$ PTR;
      685    17093    1   DCL TEMP1$ PTR;
      686    17094    1   DCL TEMP3$ PTR;
      687    17095        %FPT_X25 ( STCLASS = );
      688    17139        %FPT_X25 ( FPTN = CALL_FPT, STCLASS = );
      689    17183        %FPT_CLOCK ( FPTN = X25_PRM_CLK, STCLASS = STATIC,
      690    17184        CANCEL=NO,CLOCK=WALL,LEVEL=0,MODE=SET,
      691    17185        PERM=YES,UNITS=ONE_SECOND,
      692    17186        UTYPE=SEC);
      693    17210    1   DCL ONE_SECOND UBIN CONSTANT INIT(1);
      694    17211        %VLP_ERRCODE(STCLASS=AUTO , FPTN=ERCOD) ;
      695    17257
      696    17258    1   DCL FEVENT UBIN WORD;
      697    17259    1   DCL FSTATE UBIN WORD;
      698    17260    1   DCL EVENT UBIN WORD;
      699    17261    1   DCL PEVENT UBIN WORD;
      700    17262        %VLP_ERRCODE (STCLASS=AUTO, FPTN=KHA_ERROR);
      701    17308    1   DCL CTL UBIN WORD;
      702    17309    1   DCL NTYPE UBIN WORD;
      703    17310
      704    17311        /* The following used to be R rgeisters */
      705    17312
      706    17313    1   DCL TEMP1 UBIN WORD;
      707    17314    1   DCL TEMP2 UBIN WORD;
      708    17315    1   DCL TEMP3 UBIN WORD;
      709    17316    1   DCL TEMP4 UBIN WORD;
      710    17317    1   DCL PF BIT(1);
      711    17318    1   DCL NR UBIN BYTE;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:143  
      712    17319        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:144  
      713    17320        /*****************************************************************
      714    17321        *                                                                *
      715    17322        *                           Based                                *
      716    17323        *                                                                *
      717    17324        *****************************************************************/
      718    17325
      719    17326        %KH$CHN;
      720    17450        %KH$ADMIN_FPT ( FPTN = ADMIN_FPT, STCLASS = "BASED ( DAT$ )" );
      721    17661        %KL_BLKHDR ( NAME = BLKHDR, STCLASS = BASED );
      722    17756        %KL_LINKDEV ( NAME = KL$LINKDEV, STCLASS = BASED );
      723    17927        %KX$LINKDEV ( STCLASS = "BASED(DVC$)" );
      724    17954        %KX$LINKDEV ( FPTN = B$LINKDEV, STCLASS = BASED );
      725    17981
      726    17982        %KX$L1 ( STCLASS = "BASED ( CTX$ )" );
      727    18022        %KX$L2 ( STCLASS = "BASED ( CTX$ )" );
      728    18389        %KX$L2 ( FPTN = KX$L2S, SLCC = YES, STCLASS = "BASED ( CTX$ )" );
      729    18786        %KX$L3;
      730    19189        %KX$DATA ( STCLASS = "BASED ( DAT$ )" );
      731    19209        %KX$FRAME ( STCLASS = "BASED ( DAT$ )" );
      732    19241        %KX$XFRAME ( STCLASS = "BASED ( DAT$ )" );
      733    19275        %KX$EXTFRAME ( STCLASS = "BASED ( DAT$ )" );
      734    19299        %KX$EXTXFRAME ( STCLASS = "BASED ( DAT$ )" );
      735    19333        %KX$FRAME ( FPTN = KX$TFRAME, STCLASS = BASED );
      736    19365        %KX$PACKET (STCLASS = "BASED (DAT$)" );
      737    19431        %KX$XFPACKET ( STCLASS = " BASED (DAT$) " );
      738    19489
      739    19490        %KX$DATA ( FPTN = KX$TDATA );
      740    19510        %KX$TMRBLK ( FPTN = KX$BTMRBLK, STCLASS = BASED, LVL = 1 );
      741    19542
      742    19543        %G$JIT ( STCLASS = "BASED(G$JIT$)" );
      743    19957    1   DCL STR CHAR(50) BASED(DAT$);
      744    19958        %VLP_SCODE (FPTN=B$SCODE, STCLASS=BASED );
      745    20019        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:145  
      746    20020        /*****************************************************************
      747    20021        *                                                                *
      748    20022        *                           Static                               *
      749    20023        *                                                                *
      750    20024        *****************************************************************/
      751    20025
      752    20026    1   DCL G$JIT$ PTR SYMREF;
      753    20027        %KV_CQ;
      754    20043        %KX_DATA;
      755    20733    1   DCL KX_FRAME CHAR(50) STATIC INIT('F'*0);
      756    20734        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:146  
      757    20735        /*****************************************************************
      758    20736        *                                                                *
      759    20737        *                           Procedure                            *
      760    20738        *                                                                *
      761    20739        *****************************************************************/
      762    20740
      763    20741    1       CTX$ = FPT_X25.RCV$;

  20741   2 000005  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 000007  DCC6 0003                            LDB,B5   3,B6
          2 000009  DFC7 0006                            STB,B5   CTX$,AUTO

      764    20742    1       DAT$ = FPT_X25.PRM1$;

  20742   2 00000B  CCC6 0007                            LDB,B4   7,B6
          2 00000D  CFC7 0008                            STB,B4   DAT$,AUTO

      765    20743                                    /*  Convert the external state equates
      766    20744                                        to internal values.  */
      767    20745
      768    20746    2       DO CASE ( FPT_X25.EVN );

  20746   2 00000F  B806                                 LDR,R3   ,B6
          2 000010  3D14                                 CMV,R3   20
          2 000011  0281 0352                            BGE      s:21045,PREL
          2 000013  A830 0000 0019  02                   LDR,R2   s:20746+10,R3
          2 000016  83A0 0000 002D  02                   JMP      s:20748,R2
          2 000019       0000                            DC       s:20748,PREL
          2 00001A       0337                            DC       s:21045,PREL
          2 00001B       0281                            DC       s:20966,PREL
          2 00001C       02A7                            DC       s:20985,PREL
          2 00001D       0337                            DC       s:21045,PREL
          2 00001E       0286                            DC       s:20969,PREL
          2 00001F       028B                            DC       s:20972,PREL
          2 000020       0290                            DC       s:20975,PREL
          2 000021       0295                            DC       s:20978,PREL
          2 000022       0004                            DC       s:20751,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:147  
          2 000023       0004                            DC       s:20751,PREL
          2 000024       013F                            DC       s:20853,PREL
          2 000025       01AD                            DC       s:20909,PREL
          2 000026       016F                            DC       s:20868,PREL
          2 000027       01D3                            DC       s:20921,PREL
          2 000028       0174                            DC       s:20871,PREL
          2 000029       02C0                            DC       s:20997,PREL
          2 00002A       02DB                            DC       s:21015,PREL
          2 00002B       0281                            DC       s:20966,PREL
          2 00002C       0320                            DC       s:21035,PREL

      769    20747    2          CASE ( %KX_F_EV_START# );

      770    20748    2             FEVENT = %Y_EV_START#;

  20748   2 00002D  8747 0024                            CL       FEVENT,AUTO
          2 00002F  0F81 033D                            B        s:21048,PREL

      771    20749
      772    20750    2          CASE ( %KX_F_EV_GETDAT#, %KX_F_EV_DATAVL# );

      773    20751    2             IF KX$L2.FLG.OK AND NOT KX$L2.FLG.BLK

  20751   2 000031  82C5 002E                            LB,'0800'X        46,B5
  20751   2 000033       0800
          2 000034  0581 0012                            BBF      s:20758,PREL
          2 000036  89C5 002E                            CMZ      46,B5
          2 000038  0801 000E                            BAL      s:20758,PREL

      774    20752    2                THEN
      775    20753    3                   DO;

      776    20754    3                      CALL_FPT = '0'B;

  20754   2 00003A  5C20                                 LDV,R5   32
          2 00003B  0021                                 ALR      ;
          2 00003C       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:148  
          2 00003E       4007 0012                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

      777    20755    3                      CALL_FPT.EVN = %KX_P_EV_GETDAT#;

  20755   2 000040  6C11                                 LDV,R6   17
          2 000041  437F                                 CSYNC    s:20755,SPREL
          2 000042  EF47 0012                            STR,R6   CALL_FPT,AUTO

      778    20756    3                      CALL Y$CAL_PAC1 ;

  20756   2 000044  E3C0 1093                            LNJ,B6   s:0,PREL
          2 000046       0001                            DC       s:20758,PREL

      779    20757    3                   END;

      780    20758    2             IF NOT KX$L1.CHN$->KH$CHN.ATTR&%G_ATTR_CL_SLCC

  20758   2 000047  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000049  DCC6 0002                            LDB,B5   2,B6
          2 00004B  E845 0005                            LDR,R6   5,B5
          2 00004D  E570 0200                            AND,R6   512,IMO
          2 00004F  6901 02B5                            BEZ,R6   s:21010,PREL
          2 000051  89C6 0076                            CMZ      118,B6
          2 000053  0881 02B1                            BAGE     s:21010,PREL

      781    20759    2                OR NOT KX$L2S.COMBUF.DATAVL
      782    20760    2                THEN GOTO L_RET0 ;
      783    20761        /*
      784    20762                      The SLCC has some STATS for us to count up.
      785    20763        */
      786    20764    2             KX$L2S.COMBUF.FEPBSY = '1'B;

  20764   2 000055  8946 0076                            LBT,'2000'X       118,B6
  20764   2 000057       2000

      787    20765    2             KX$L2S.COMBUF.FEPRDY = '1'B;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:149  
  20765   2 000058  8946 0076                            LBT,'4000'X       118,B6
  20765   2 00005A       4000

      788    20766    2             TEMP1 = 500;

  20766   2 00005B  E870 01F4                            LDR,R6   500,IMO
          2 00005D  EF47 002C                            STR,R6   TEMP1,AUTO

      789    20767    3             DO WHILE KX$L2S.COMBUF.FEPRDY;

  20767   2 00005F  82C6 0076                            LB,'4000'X        118,B6
  20767   2 000061       4000
          2 000062  0581 000D                            BBF      s:20774,PREL

      790    20768        /*
      791    20769                      Wait for the SLCC to see that we're here.
      792    20770        */
      793    20771    3                TEMP1 = TEMP1-1;

  20771   2 000064  88C7 002C                            DEC      TEMP1,AUTO

      794    20772    3                IF TEMP1=0 THEN EXIT; /* (but not forever) */

  20772   2 000066  E847 002C                            LDR,R6   TEMP1,AUTO
          2 000068  6901 0007                            BEZ,R6   s:20774,PREL

      795    20773    3             END;

  20773   2 00006A  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00006C  82C6 0076                            LB,'4000'X        118,B6
          2 00006E       4000
          2 00006F  0575                                 BBT      s:20771,SPREL

      796    20774    2             KX$L2S.COMBUF.DATAVL = '0'B;

  20774   2 000070  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000072  8846 0076                            LBF,'8000'X       118,B6
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:150  
          2 000074       8000

      797    20775    3             DO TEMP1 = 0 TO SIZEC(KX$L2S.COMBUF.DAT)-1;

  20775   2 000075  8747 002C                            CL       TEMP1,AUTO
          2 000077  0F81 00E1                            B        s:20847+2,PREL

      798    20776    3                TEMP2 = KX$L2S.COMBUF.DAT(TEMP1);

  20776   2 000079  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00007B  DBC6 0077                            LAB,B5   119,B6
          2 00007D  B847 002C                            LDR,R3   TEMP1,AUTO
          2 00007F  E2B5                                 LLH,R6   ,B5,R3
          2 000080  EF47 002D                            STR,R6   TEMP2,AUTO

      799    20777    3                ERCOD = '0'B;

  20777   2 000082  8747 0022                            CL       ERCOD,AUTO
          2 000084  8747 0023                            CL       ERCOD+1,AUTO

      800    20778    4                IF TEMP2>0 THEN DO CASE TEMP1;

  20778   2 000086  6901 00A0                            BEZ,R6   s:20825,PREL

  20778   2 000088  3D10                                 CMV,R3   16
          2 000089  0281 0094                            BGE      s:20823,PREL
          2 00008B  A830 0000 0091  02                   LDR,R2   s:20778+11,R3
          2 00008E  83A0 0000 00A1  02                   JMP      s:20780,R2
          2 000091       0009                            DC       s:20783,PREL
          2 000092       0000                            DC       s:20780,PREL
          2 000093       0037                            DC       s:20794,PREL
          2 000094       0000                            DC       s:20780,PREL
          2 000095       0000                            DC       s:20780,PREL
          2 000096       0000                            DC       s:20780,PREL
          2 000097       0021                            DC       s:20789,PREL
          2 000098       002B                            DC       s:20791,PREL
          2 000099       0000                            DC       s:20780,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:151  
          2 00009A       0000                            DC       s:20780,PREL
          2 00009B       006E                            DC       s:20820,PREL
          2 00009C       001A                            DC       s:20787,PREL
          2 00009D       0013                            DC       s:20785,PREL
          2 00009E       0013                            DC       s:20785,PREL
          2 00009F       0013                            DC       s:20785,PREL
          2 0000A0       0013                            DC       s:20785,PREL

      801    20779    4                         CASE (1,3,4,5,8,9); /* Possible FRMR causes */

      802    20780    4                            TEMP3 = TEMP1; /* Save error type for FRMR log */

  20780   2 0000A1  BF47 002E                            STR,R3   TEMP3,AUTO

      803    20781    4                            ERCOD = LOG;

  20781   2 0000A3  8C80 0000 019A  00                   LDI      LOG
          2 0000A6  8D47 0022                            SDI      ERCOD,AUTO
          2 0000A8  0F81 007E                            B        s:20825,PREL

      804    20782    4                         CASE (0); /* Timeouts */

      805    20783    4                            KX_STATS_HDLC.TIMEOUTS = KX_STATS_HDLC.TIMEOUTS + TEMP2;

  20783   2 0000AA  F856                                 LDR,R7   R6
          2 0000AB  6C00                                 LDV,R6   0
          2 0000AC  8400 0000 0022  xsym                 AID      KX_STATS_HDLC+34
          2 0000AF  8D00 0000 0022  xsym                 SDI      KX_STATS_HDLC+34
          2 0000B2  0F81 0074                            B        s:20825,PREL

      806    20784    4                         CASE (12,13,14,15); /* Garbage frame ignored */

      807    20785    4                            ERCOD = LOG;

  20785   2 0000B4  8C80 0000 019A  00                   LDI      LOG
          2 0000B7  8D47 0022                            SDI      ERCOD,AUTO
          2 0000B9  0F81 006D                            B        s:20825,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:152  

      808    20786    4                         CASE (11); /* DM received */

      809    20787    4                            ERCOD = DM;

  20787   2 0000BB  8C80 0000 0196  00                   LDI      DM
          2 0000BE  8D47 0022                            SDI      ERCOD,AUTO
          2 0000C0  0F81 0066                            B        s:20825,PREL

      810    20788    4                         CASE (6); /* REJ sent */

      811    20789    4                           KX_STATS_HDLC.F_REJECTS_OUT = KX_STATS_HDLC.F_REJECTS_OUT +
             20789                                     TEMP2;

  20789   2 0000C2  F856                                 LDR,R7   R6
          2 0000C3  6C00                                 LDV,R6   0
          2 0000C4  8400 0000 0028  xsym                 AID      KX_STATS_HDLC+40
          2 0000C7  8D00 0000 0028  xsym                 SDI      KX_STATS_HDLC+40
          2 0000CA  0F81 005C                            B        s:20825,PREL

      812    20790    4                         CASE (7); /* REJ received */

      813    20791    4                            KX_STATS_HDLC.F_REJECTS_IN = KX_STATS_HDLC.F_REJECTS_IN +
             20791                                     TEMP2;

  20791   2 0000CC  F856                                 LDR,R7   R6
          2 0000CD  6C00                                 LDV,R6   0
          2 0000CE  8400 0000 0026  xsym                 AID      KX_STATS_HDLC+38
          2 0000D1  8D00 0000 0026  xsym                 SDI      KX_STATS_HDLC+38

      814    20792    4                            KX$L2S.REJ_CNT = KX$L2S.REJ_CNT + 1;

  20792   2 0000D4  8AC6 0057                            INC      87,B6
          2 0000D6  0F81 0050                            B        s:20825,PREL

      815    20793    4                         CASE (2); /* FRMR sent */

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:153  
      816    20794    4                            KX_STATS_HDLC.RESETS = KX_STATS_HDLC.RESETS + TEMP2;

  20794   2 0000D8  F856                                 LDR,R7   R6
          2 0000D9  6C00                                 LDV,R6   0
          2 0000DA  8400 0000 0024  xsym                 AID      KX_STATS_HDLC+36
          2 0000DD  8D00 0000 0024  xsym                 SDI      KX_STATS_HDLC+36

      817    20795                                 %WRSYSLOG ( ERRCOD = SNDFRMR,
      818    20796                                 TRMID = KX$L1.CHN$->KH$CHN.TERMID,
      819    20797                                 VAL0 = KX$L2S.P_FRAME,
      820    20798                                 VAL1 = KX$L2S.P_FRAME.CTLRPF,
      821    20799                                 VAL2 = "PINCRW(ADDR(KX$L2S.P_FRAME),2)->STR",
      822    20800                                 VAL3 = "PINCRW(ADDR(KX$L2S.P_FRAME),3)->STR");

  20816   2 0000E0  DCC6 0002                            LDB,B5   2,B6
          2 0000E2  CBC6 002A                            LAB,B4   42,B6
          2 0000E4  CFC7 0044                            STB,B4   ADDRESS+16,AUTO
          2 0000E6  BBC6 0029                            LAB,B3   41,B6
          2 0000E8  BFC7 0042                            STB,B3   ADDRESS+14,AUTO
          2 0000EA  ABC6 0028                            LAB,B2   40,B6
          2 0000EC  AFC7 0040                            STB,B2   ADDRESS+12,AUTO
          2 0000EE  9BC6 0027                            LAB,B1   39,B6
          2 0000F0  9FC7 003E                            STB,B1   ADDRESS+10,AUTO
          2 0000F2  EB80 0000 0000                       LAB,B6   0
          2 0000F5  EFC7 003C                            STB,B6   ADDRESS+8,AUTO
          2 0000F7  EBC5 0012                            LAB,B6   18,B5
          2 0000F9  EFC7 003A                            STB,B6   ADDRESS+6,AUTO
          2 0000FB  DB80 0000 01A6  00                   LAB,B5   SNDFRMR
          2 0000FE  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000100  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000102  CBF0 0700                            LAB,B4   1792,IMO
          2 000104  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 000107       0001                            DC       s:20818,PREL

      823    20818    4                            ERCOD = RESET;

  20818   2 000108  8C80 0000 019C  00                   LDI      RESET
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:154  
          2 00010B  8D47 0022                            SDI      ERCOD,AUTO
          2 00010D  0F81 0019                            B        s:20825,PREL

      824    20819    4                         CASE (10);

      825    20820    4                            KX_STATS_HDLC.RESETS = KX_STATS_HDLC.RESETS + TEMP2;

  20820   2 00010F  F856                                 LDR,R7   R6
          2 000110  6C00                                 LDV,R6   0
          2 000111  8400 0000 0024  xsym                 AID      KX_STATS_HDLC+36
          2 000114  8D00 0000 0024  xsym                 SDI      KX_STATS_HDLC+36

      826    20821    4                            ERCOD = FRMR;

  20821   2 000117  8C80 0000 0198  00                   LDI      FRMR
          2 00011A  8D47 0022                            SDI      ERCOD,AUTO
          2 00011C  0F81 000A                            B        s:20825,PREL

      827    20822    4                         CASE (ELSE); /* Better not be any more */

      828    20823    4                            CALL KHD$SCREECH ( Y_UNKEVT );

  20823   2 00011E  BB80 0000 0000  03                   LAB,B3   0
          2 000121  CBF0 0100                            LAB,B4   256,IMO
          2 000123  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000126       0001                            DC       s:20825,PREL

      829    20824    4                      END;

      830    20825    4                IF ERCOD THEN DO;

  20825   2 000127  EB80 0000 0000  03                   LAB,B6   0
          2 00012A  5C01                                 LDV,R5   1
          2 00012B  0022                                 ACM      ;
          2 00012C       4407 0022                                ALPHANUM(ERCOD,AUTO,,4,FILL),;
          2 00012E       4006 0002                                ALPHANUM(2,B6,,R5,FILL)
          2 000130  5381 0026                            CBE      s:20847,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:155  

      831    20826                              %WRSYSLOG (ERRCOD = ERCOD,
      832    20827                              TRMID = KX$L1.CHN$->KH$CHN.TERMID,
      833    20828                              VAL0 = TEMP1, VAL1 = TEMP2, VAL2 = TEMP3 );

  20844   2 000132  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000134  DCC6 0002                            LDB,B5   2,B6
          2 000136  CBC7 002E                            LAB,B4   TEMP3,AUTO
          2 000138  CFC7 0042                            STB,B4   ADDRESS+14,AUTO
          2 00013A  BBC7 002D                            LAB,B3   TEMP2,AUTO
          2 00013C  BFC7 0040                            STB,B3   ADDRESS+12,AUTO
          2 00013E  ABC7 002C                            LAB,B2   TEMP1,AUTO
          2 000140  AFC7 003E                            STB,B2   ADDRESS+10,AUTO
          2 000142  9B80 0000 0000                       LAB,B1   0
          2 000145  9FC7 003C                            STB,B1   ADDRESS+8,AUTO
          2 000147  EBC5 0012                            LAB,B6   18,B5
          2 000149  EFC7 003A                            STB,B6   ADDRESS+6,AUTO
          2 00014B  DBC7 0022                            LAB,B5   ERCOD,AUTO
          2 00014D  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 00014F  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000151  CBF0 0600                            LAB,B4   1536,IMO
          2 000153  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 000156       0001                            DC       s:20847,PREL

      834    20846    4                      END;

      835    20847    3             END;

  20847   2 000157  8AC7 002C                            INC      TEMP1,AUTO
          2 000159  E847 002C                            LDR,R6   TEMP1,AUTO
          2 00015B  6D0F                                 CMV,R6   15
          2 00015C  0381 FF1C                            BLE      s:20776,PREL

      836    20848    2             KX$L2S.COMBUF.DAT = '0'B;

  20848   2 00015E  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000160  5C10                                 LDV,R5   16
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:156  
          2 000161  0021                                 ALR      ;
          2 000162       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 000164       4006 0077                                ALPHANUM(119,B6,,R5,FILL)

      837    20849    2             KX$L2S.COMBUF.FEPBSY = '0'B;

  20849   2 000166  8846 0076                            LBF,'2000'X       118,B6
  20849   2 000168       2000

      838    20850    2             GOTO L_RET0;

  20850   2 000169  437F                                 CSYNC    s:20849+2,SPREL
          2 00016A  0F81 019A                            B        s:21010,PREL

      839    20851
      840    20852    2          CASE ( %KX_F_EV_ENB# );

      841    20853    2             IF ADMIN_FPT.TERMID.LEV ~= %TERMINAL_ID_LEV_CHAN#

  20853   2 00016C  E844 0001                            LDR,R6   1,B4
          2 00016E  E570 00FF                            AND,R6   255,IMO
          2 000170  6D01                                 CMV,R6   1
          2 000171  0901 0006                            BE       s:20863,PREL

      842    20854    2                THEN
      843    20855    3                   DO;

      844    20856    3                      TEMP1 = %KX_P_EV_ENB# ;

  20856   2 000173  5C0C                                 LDV,R5   12
          2 000174  DF47 002C                            STR,R5   TEMP1,AUTO

      845    20857    3                      GOTO L_2 ;

  20857   2 000176  0F81 0034                            B        s:20875,PREL

      846    20858    3                   END;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:157  
      847    20859        /*
      848    20860                                             Let the MLCP listen for DSR
      849    20861                                             and CTS.
      850    20862        */
      851    20863    2             CALL KXN$CMND ( %KX_N_INIT#, ADMIN_FPT.CHN$ -> KH$CHN );

  20863   2 000178  BCC4 000B                            LDB,B3   11,B4
          2 00017A  ABF0 0001                            LAB,B2   1,IMO
          2 00017C  BFC7 003A                            STB,B3   ADDRESS+6,AUTO
          2 00017E  AFC7 0038                            STB,B2   ADDRESS+4,AUTO
          2 000180  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000182  CBF0 0200                            LAB,B4   512,IMO
          2 000184  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 000187       0001                            DC       s:20864,PREL

      852    20864    2             CALL KXN$CMND ( %KX_N_START_TRN#, ADMIN_FPT.CHN$ -> KH$CHN );

  20864   2 000188  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 00018A  DCC6 000B                            LDB,B5   11,B6
          2 00018C  CBF0 0004                            LAB,B4   4,IMO
          2 00018E  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 000190  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000192  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000194  CBF0 0200                            LAB,B4   512,IMO
          2 000196  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 000199       0001                            DC       s:20865,PREL

      853    20865    2             GOTO L_RET0 ;

  20865   2 00019A  0F81 016A                            B        s:21010,PREL

      854    20866
      855    20867    2          CASE ( %KX_F_EV_KLL# );

      856    20868    2             TEMP1 = %KX_P_EV_KLL# ;

  20868   2 00019C  6C0F                                 LDV,R6   15
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:158  
          2 00019D  EF47 002C                            STR,R6   TEMP1,AUTO

      857    20869    2             GOTO L_DSC;

  20869   2 00019F  0F81 0004                            B        s:20873,PREL

      858    20870    2          CASE ( %KX_F_EV_DSC# );

      859    20871    2             TEMP1 = %KX_P_EV_DSC# ;

  20871   2 0001A1  6C0E                                 LDV,R6   14
          2 0001A2  EF47 002C                            STR,R6   TEMP1,AUTO

      860    20872    2   L_DSC:
      861    20873    2             IF ADMIN_FPT.TERMID.LEV ~= %TERMINAL_ID_LEV_CHAN#

  20873   2 0001A4  D844 0001            L_DSC           LDR,R5   1,B4
          2 0001A6  D570 00FF                            AND,R5   255,IMO
          2 0001A8  5D01                                 CMV,R5   1
          2 0001A9  0901 000B                            BE       s:20884,PREL

      862    20874    2                THEN
      863    20875    3                   DO;

      864    20876    3   L_2:
      865    20877    3                      CALL Y$CAL_PAC

  20877   2 0001AB  E3C0 0F04            L_2             LNJ,B6   s:0,PREL
          2 0001AD       0003                            DC       s:20880,PREL
          2 0001AE  0F81 0004                            B        s:20882,PREL

      866    20878    3                         WHENALTRETURN
      867    20879    4                            DO;

      868    20880    4                               ALTRETURN;

  20880   2 0001B0  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:159  

      869    20881    4                            END;
      870    20882    3                      GOTO L_RET0 ;

  20882   2 0001B3  0F81 0151                            B        s:21010,PREL

      871    20883    3                   END;
      872    20884    2             IF CTX$ = ADDR(NIL)

  20884   2 0001B5  8DC7 0006                            CMN      CTX$,AUTO
          2 0001B7  0981 001D                            BNE      s:20906,PREL

      873    20885    2                THEN
      874    20886    3                   DO;

      875    20887        /*
      876    20888                                             This is a KILL after we told
      877    20889                                             handler common connect and asked
      878    20890                                             for the line profile, but before
      879    20891                                             we received the line profile and
      880    20892                                             built context.  Report disconnect
      881    20893                                             to handler common, which will
      882    20894                                             cause a disable to be reported.
      883    20895        */
      884    20896    3                      CALL KHA$DVCADM ( %KHA_FNC_DISCONNECT_EVT,

  20896   2 0001B9  BBF0 000C                            LAB,B3   12,IMO
          2 0001BB  ABC4 0001                            LAB,B2   1,B4
          2 0001BD  AFC7 003E                            STB,B2   ADDRESS+10,AUTO
          2 0001BF  9BC4 0001                            LAB,B1   1,B4
          2 0001C1  9FC7 003C                            STB,B1   ADDRESS+8,AUTO
          2 0001C3  EBC7 0028                            LAB,B6   KHA_ERROR,AUTO
          2 0001C5  EFC7 003A                            STB,B6   ADDRESS+6,AUTO
          2 0001C7  BFC7 0038                            STB,B3   ADDRESS+4,AUTO
          2 0001C9  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0001CB  CBF0 0400                            LAB,B4   1024,IMO
          2 0001CD  E380 0000 0000  xent                 LNJ,B6   KHA$DVCADM
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:160  
          2 0001D0       0003                            DC       s:20904,PREL
          2 0001D1  0F81 0001                            B        s:20904,PREL

      885    20897    3                         KHA_ERROR,
      886    20898    3                         ADMIN_FPT.TERMID,
      887    20899    3                         ADMIN_FPT.TERMID )
      888    20900    3                         WHENALTRETURN
      889    20901    4                            DO;

      890    20902        /*N*                           CALL KHD$SCREECH ( Y_KHAALTRET ); */
      891    20903    4                            END;

      892    20904    3                      GOTO L_RET0 ;

  20904   2 0001D3  0F81 0131                            B        s:21010,PREL

      893    20905    3                   END;
      894    20906    2             FEVENT = %Y_EV_STOP#;

  20906   2 0001D5  4C01                                 LDV,R4   1
          2 0001D6  CF47 0024                            STR,R4   FEVENT,AUTO
          2 0001D8  0F81 0194                            B        s:21048,PREL

      895    20907
      896    20908    2          CASE ( %KX_F_EV_DSB# );

      897    20909    2             IF ADMIN_FPT.TERMID.LEV ~= %TERMINAL_ID_LEV_CHAN#

  20909   2 0001DA  E844 0001                            LDR,R6   1,B4
          2 0001DC  E570 00FF                            AND,R6   255,IMO
          2 0001DE  6D01                                 CMV,R6   1
          2 0001DF  0901 0005                            BE       s:20915,PREL

      898    20910    2                THEN
      899    20911    3                   DO;

      900    20912    3                      TEMP1 = %KX_P_EV_DSB# ;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:161  

  20912   2 0001E1  5C0D                                 LDV,R5   13
          2 0001E2  DF47 002C                            STR,R5   TEMP1,AUTO

      901    20913    3                      GOTO L_2 ;

  20913   2 0001E4  0FC7                                 B        s:20875,SPREL

      902    20914    3                   END;
      903    20915    2             IF CTX$ = ADDR(NIL) AND ADMIN_FPT.CHN$ -> KH$CHN.DWNLOD

  20915   2 0001E5  8DC7 0006                            CMN      CTX$,AUTO
          2 0001E7  0981 0016                            BNE      s:20918,PREL
          2 0001E9  BCC4 000B                            LDB,B3   11,B4
          2 0001EB  82C3 0007                            LB,'1000'X        7,B3
          2 0001ED       1000
          2 0001EE  0581 000F                            BBF      s:20918,PREL

      904    20916    2                THEN
      905    20917    2                   CALL KXN$CMND ( %KX_N_STOP#, ADMIN_FPT.CHN$ -> KH$CHN );

  20917   2 0001F0  ABF0 0005                            LAB,B2   5,IMO
          2 0001F2  BFC7 003A                            STB,B3   ADDRESS+6,AUTO
          2 0001F4  AFC7 0038                            STB,B2   ADDRESS+4,AUTO
          2 0001F6  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0001F8  CBF0 0200                            LAB,B4   512,IMO
          2 0001FA  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 0001FD       0001                            DC       s:20918,PREL

      906    20918    2             GOTO L_RET0 ;

  20918   2 0001FE  0F81 0106                            B        s:21010,PREL

      907    20919
      908    20920    2          CASE ( %KX_F_EV_BLDCTX# );

      909    20921    2             IF ADMIN_FPT.CTX$->BLKHDR.BLKTYP = %KLTY_VIRCIR#
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:162  

  20921   2 000200  BCC4 0009                            LDB,B3   9,B4
          2 000202  E2C3 0002                            LLH,R6   2,B3
          2 000204  6D08                                 CMV,R6   8
          2 000205  0981 0010                            BNE      s:20930,PREL

      910    20922    2                THEN
      911    20923    3                   DO;

      912    20924    3                      CALL_FPT = '0'B;

  20924   2 000207  5C20                                 LDV,R5   32
          2 000208  0021                                 ALR      ;
          2 000209       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 00020B       4007 0012                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

      913    20925    3                      CALL_FPT.EVN = %KX_P_EV_BLDCTX#;

  20925   2 00020D  6C10                                 LDV,R6   16
          2 00020E  437F                                 CSYNC    s:20925,SPREL
          2 00020F  EF47 0012                            STR,R6   CALL_FPT,AUTO

      914    20926    3                      CALL Y$CAL_PAC0 ALTRET ( L_ALTRET );

  20926   2 000211  E3C0 0EBE                            LNJ,B6   s:0,PREL
          2 000213       0028                            DC       s:20936,PREL

      915    20927    3                   END;

  20927   2 000214  0F81 0097                            B        s:20963,PREL

      916    20928    2                ELSE
      917    20929    3                   DO;

      918    20930    3                      IF ADMIN_FPT.CTX$->BLKHDR.BLKTYP = %KLTY_LINK#

  20930   2 000216  6D04                                 CMV,R6   4
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:163  
          2 000217  0981 0011                            BNE      s:20935,PREL

      919    20931    3                         THEN
      920    20932    3                            CALL KXS$GETCNTX ( ADMIN_FPT, CTX$ ) ALTRET ( L_ALTRET );

  20932   2 000219  ABC7 0006                            LAB,B2   CTX$,AUTO
          2 00021B  AFC7 003A                            STB,B2   ADDRESS+6,AUTO
          2 00021D  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 00021F  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000221  CBF0 0200                            LAB,B4   512,IMO
          2 000223  E380 0000 0000  xent                 LNJ,B6   KXS$GETCNTX
          2 000226       0015                            DC       s:20936,PREL
          2 000227  0F81 0084                            B        s:20963,PREL

      921    20933    3                         ELSE
      922    20934    4                            DO;

      923    20935    4                               CALL KVB$GETSYS ( SIZEW(KX_LINKDEV), DVC$ )
             20935                                        WHENALTRETURN

  20935   2 000229  ABF0 0018                            LAB,B2   24,IMO
          2 00022B  9BC7 000C                            LAB,B1   DVC$,AUTO
          2 00022D  9FC7 003A                            STB,B1   ADDRESS+6,AUTO
          2 00022F  AFC7 0038                            STB,B2   ADDRESS+4,AUTO
          2 000231  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000233  CBF0 0200                            LAB,B4   512,IMO
          2 000235  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000238       0003                            DC       s:20936,PREL
          2 000239  0F81 0004                            B        s:20939,PREL

      924    20936    5                                     DO;

      925    20937    5   L_ALTRET:                            ALTRETURN;

  20937   2 00023B  C380 0000 0000  xent L_ALTRET        LNJ,B4   X6A_AALT

      926    20938    5                                     END;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:164  
      927    20939    4                               KX$LINKDEV = KX_LINKDEV;

  20939   2 00023E  AB80 0000 0000  00                   LAB,B2   FRMR_REASON
          2 000241  2C20                                 LDV,R2   32
          2 000242  6C30                                 LDV,R6   48
          2 000243  BCC7 000C                            LDB,B3   DVC$,AUTO
          2 000245  3C00                                 LDV,R3   0
          2 000246  0008                                 MMM

      928    20940    4                               CHN$ = ADMIN_FPT.CHN$;

  20940   2 000247  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000249  DCC6 000B                            LDB,B5   11,B6
          2 00024B  DFC7 000A                            STB,B5   CHN$,AUTO

      929    20941    4                               CHN$->KH$CHN.CTX$ = DVC$;

  20941   2 00024D  CCC7 000C                            LDB,B4   DVC$,AUTO
          2 00024F  CFC5 000C                            STB,B4   12,B5

      930    20942    4                               CHN$->KH$CHN.TERMID.TTYP = %KLTY_LINKDEV#;

  20942   2 000251  6C0B                                 LDV,R6   11
          2 000252  E7C5 0012                            STH,R6   18,B5

      931    20943    4                               KX$LINKDEV.CHN$ = CHN$;

  20943   2 000254  BCC7 000C                            LDB,B3   DVC$,AUTO
          2 000256  DFC3 0004                            STB,B5   4,B3

      932    20944    4                               KX$LINKDEV.CRC = ADMIN_FPT.CTX$->KL$LINKDEV.CIRCUITS#;

  20944   2 000258  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 00025A  DCC6 0009                            LDB,B5   9,B6
          2 00025C  CCC7 000C                            LDB,B4   DVC$,AUTO
          2 00025E  D845 0004                            LDR,R5   4,B5
          2 000260  DF44 0010                            STR,R5   16,B4
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:165  

      933    20945    4                              KX$LINKDEV.PRTID = ADMIN_FPT.CTX$->KL$LINKDEV.PROTOCOL#;

  20945   2 000262  DCC6 0009                            LDB,B5   9,B6
          2 000264  C2C5 0005                            LLH,R4   5,B5
          2 000266  C7C4 0012                            STH,R4   18,B4

      934    20946    4                              KX$LINKDEV.SUBADR = ADMIN_FPT.CTX$->KL$LINKDEV.SUBADDR#;

  20946   2 000268  DCC6 0009                            LDB,B5   9,B6
          2 00026A  C845 0005                            LDR,R4   5,B5
          2 00026C  CAC4 0012                            SRM,R4,'00FF'X    18,B4
          2 00026E       00FF

      935    20947    4                               KX$LINKDEV.LOGON = ADMIN_FPT.CTX$->KL$LINKDEV.LOGON#;

  20947   2 00026F  DCC6 0009                            LDB,B5   9,B6
          2 000271  AB85                                 LAB,B2   ,B5
          2 000272  2C10                                 LDV,R2   16
          2 000273  6C08                                 LDV,R6   8
          2 000274  BB84                                 LAB,B3   ,B4
          2 000275  3C26                                 LDV,R3   38
          2 000276  0008                                 MMM

      936    20948    4                               IF ADMIN_FPT.CTX$->KL$LINKDEV.MODE = %
             20948                                        KL_DEVMODE_OUTGOING#

  20948   2 000277  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000279  9CC6 0009                            LDB,B1   9,B6
          2 00027B  E2C1 0006                            LLH,R6   6,B1
          2 00027D  6D02                                 CMV,R6   2
          2 00027E  0981 0008                            BNE      s:20952,PREL

      937    20949    4                                  THEN
      938    20950    4                                     KX$LINKDEV.OUTBOUND = '1'B;

  20950   2 000280  ECC7 000C                            LDB,B6   DVC$,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:166  
          2 000282  8946 0017                            LBT,'0080'X       23,B6
          2 000284       0080
          2 000285  0F81 0006                            B        s:20953,PREL

      939    20951    4                                  ELSE
      940    20952    4                                     KX$LINKDEV.INBOUND = '1'B;

  20952   2 000287  ECC7 000C                            LDB,B6   DVC$,AUTO
          2 000289  8946 0017                            LBT,'0040'X       23,B6
          2 00028B       0040

      941    20953    4                               KX$LINKDEV.L2$ = CTX$;

  20953   2 00028C  9CC7 0006                            LDB,B1   CTX$,AUTO
          2 00028E  9FC6 000A                            STB,B1   10,B6

      942    20954    4                               KX$LINKDEV.BLNK$ = KX$L2.DVC_TAIL$;

  20954   2 000290  ECC1 006A                            LDB,B6   106,B1
          2 000292  DCC7 000C                            LDB,B5   DVC$,AUTO
          2 000294  EFC5 0008                            STB,B6   8,B5

      943    20955    4                               IF KX$L2.DVC_TAIL$ ~= ADDR(NIL)

  20955   2 000296  8DC1 006A                            CMN      106,B1
          2 000298  0901 0009                            BE       s:20959,PREL

      944    20956    4                                  THEN
      945    20957    4                                     KX$L2.DVC_TAIL$->B$LINKDEV.FLNK$ = DVC$;

  20957   2 00029A  ECC1 006A                            LDB,B6   106,B1
          2 00029C  DCC7 000C                            LDB,B5   DVC$,AUTO
          2 00029E  DFC6 0006                            STB,B5   6,B6
          2 0002A0  0F81 0005                            B        s:20960,PREL

      946    20958    4                                  ELSE
      947    20959    4                                     KX$L2.DVC_HEAD$ = DVC$;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:167  

  20959   2 0002A2  ECC7 000C                            LDB,B6   DVC$,AUTO
          2 0002A4  EFC1 0068                            STB,B6   104,B1

      948    20960    4                               KX$L2.DVC_TAIL$ = DVC$;

  20960   2 0002A6  ECC7 000C                            LDB,B6   DVC$,AUTO
          2 0002A8  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 0002AA  EFC5 006A                            STB,B6   106,B5

      949    20961    4                            END;

      950    20962    3                   END;

      951    20963    2             GOTO L_RET0 ;

  20963   2 0002AC  0F81 0058                            B        s:21010,PREL

      952    20964
      953    20965    2          CASE ( %KX_F_EV_DIED#, %KX_F_EV_ERRLOGKLL# );

      954    20966    2             FEVENT = %Y_EV_DIED#;

  20966   2 0002AE  6C02                                 LDV,R6   2
          2 0002AF  EF47 0024                            STR,R6   FEVENT,AUTO
          2 0002B1  0F81 00BB                            B        s:21048,PREL

      955    20967
      956    20968    2          CASE ( %KX_F_EV_CL_BUSY# );

      957    20969    2             FEVENT = %Y_EV_CL_BUSY#;

  20969   2 0002B3  6C05                                 LDV,R6   5
          2 0002B4  EF47 0024                            STR,R6   FEVENT,AUTO
          2 0002B6  0F81 00B6                            B        s:21048,PREL

      958    20970
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:168  
      959    20971    2          CASE ( %KX_F_EV_CL_REJ# );

      960    20972    2             FEVENT = %Y_EV_CL_REJ#;

  20972   2 0002B8  6C06                                 LDV,R6   6
          2 0002B9  EF47 0024                            STR,R6   FEVENT,AUTO
          2 0002BB  0F81 00B1                            B        s:21048,PREL

      961    20973
      962    20974    2          CASE ( %KX_F_EV_DATA_OUT# );

      963    20975    2             FEVENT = %Y_EV_DATA_OUT#;

  20975   2 0002BD  6C07                                 LDV,R6   7
          2 0002BE  EF47 0024                            STR,R6   FEVENT,AUTO
          2 0002C0  0F81 00AC                            B        s:21048,PREL

      964    20976
      965    20977    2          CASE ( %KX_F_EV_DATA_IN# );

      966    20978    2             IF NOT KX$L1.CHN$->KH$CHN.ATTR&%G_ATTR_CL_SLCC

  20978   2 0002C2  BCC5 0002                            LDB,B3   2,B5
          2 0002C4  E843 0005                            LDR,R6   5,B3
          2 0002C6  E570 0200                            AND,R6   512,IMO
          2 0002C8  6981 0006                            BNEZ,R6  s:20982,PREL

      967    20979    2                THEN
      968    20980    2                   CALL Y$CONDITION;

  20980   2 0002CA  E3C0 07DC                            LNJ,B6   s:0,PREL
          2 0002CC       0001                            DC       s:20980+3,PREL
          2 0002CD  0F81 009F                            B        s:21048,PREL

      969    20981    2                ELSE
      970    20982    2                   FEVENT = %Y_EV_I#;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:169  
  20982   2 0002CF  6C08                                 LDV,R6   8
          2 0002D0  EF47 0024                            STR,R6   FEVENT,AUTO
          2 0002D2  0F81 009A                            B        s:21048,PREL

      971    20983
      972    20984    2          CASE ( %KX_F_EV_TO# );

      973    20985    2             KX_STATS_HDLC.TIMEOUTS = KX_STATS_HDLC.TIMEOUTS + 1;

  20985   2 0002D4  8A80 0000 0023  xsym                 INC      KX_STATS_HDLC+35
          2 0002D7  8E80 0000 0022  xsym                 CAD      KX_STATS_HDLC+34

      974    20986    2             IF ( KX$L2.RC < KX$L2.N2 )

  20986   2 0002DA  E845 0017                            LDR,R6   23,B5
          2 0002DC  E570 00FF                            AND,R6   255,IMO
          2 0002DE  D2C5 0017                            LLH,R5   23,B5
          2 0002E0  E955                                 CMR,R6   R5
          2 0002E1  0881 0006                            BAGE     s:20990,PREL

      975    20987    2                THEN  /*  The retry count has not been exhausted  */
      976    20988    2                   FEVENT = %Y_EV_TO_RC_LT_N2#;

  20988   2 0002E3  4C03                                 LDV,R4   3
          2 0002E4  CF47 0024                            STR,R4   FEVENT,AUTO
          2 0002E6  0F81 0086                            B        s:21048,PREL

      977    20989    2                ELSE  /*  Retry count has been exhausted  */
      978    20990    2                   FEVENT = %Y_EV_TO_RC_GE_N2#;

  20990   2 0002E8  4C04                                 LDV,R4   4
          2 0002E9  CF47 0024                            STR,R4   FEVENT,AUTO
          2 0002EB  0F81 0081                            B        s:21048,PREL

      979    20991
      980    20992    2          CASE ( %KX_F_EV_HNDINT# );

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:170  
      981    20993        /*
      982    20994                                             Set up KV_CQ_HNDSBR$ to call
      983    20995                                             KXC$CQSCN with ML messages.
      984    20996        */
      985    20997    2             KV_CQ_HNDSBR$ ( %KV#CQ_HNDID_SL ) = ENTADDR(KXC$CQSCN);

  20997   2 0002ED  BB80 0000 0000  xent                 LAB,B3   KXC$CQSCN
          2 0002F0  BF80 0000 0002  xsym                 STB,B3   KV_CQ_HNDSBR$+2

      986    20998        /*
      987    20999                                             Set up a permanent one second
      988    21000                                             clock for use with all the X.25
      989    21001                                             context blocks.
      990    21002        */
      991    21003    2             CALL M$CLOCK ( X25_PRM_CLK )

  21003   2 0002F3  BB80 0000 0000  01                   LAB,B3   X25_PRM_CLK
          2 0002F6  B870 08C6                            LDR,R3   2246,IMO
          2 0002F8  0001                                 MCL
          2 0002F9       0003                            DC       s:21009,PREL
          2 0002FA  0F81 000A                            B        s:21010,PREL

      992    21004    2                WHENALTRETURN
      993    21005    3                   DO;

      994    21006        /*S* SCREECH_CODE: KXF-S$KX_NO_PRMCLK#
      995    21007             MESSAGE: Unable to set the 1-second permanent clock.
      996    21008        */
      997    21009    3                      CALL KHD$SCREECH ( Y_NO_PRMCLK );

  21009   2 0002FC  BB80 0000 0003  03                   LAB,B3   +3
          2 0002FF  CBF0 0100                            LAB,B4   256,IMO
          2 000301  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000304       0001                            DC       s:21010,PREL

      998    21010    3                   END;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:171  
      999    21011    2   L_RET0:
     1000    21012    2             RETURN;

  21012   2 000305  C380 0000 0000  xent L_RET0          LNJ,B4   X6A_ARET

     1001    21013
     1002    21014    2          CASE ( %KX_F_EV_T20# );

     1003    21015    2             CHN$ = KX$L2.CHN$;

  21015   2 000308  BCC5 0002                            LDB,B3   2,B5
          2 00030A  BFC7 000A                            STB,B3   CHN$,AUTO

     1004    21016    2             KX$L2.R20_CNT = KX$L2.R20_CNT + 1;

  21016   2 00030C  E2C5 0054                            LLH,R6   84,B5
          2 00030E  6E01                                 ADV,R6   1
          2 00030F  E7C5 0054                            STH,R6   84,B5

     1005    21017    2             ERCOD = T20TIMEOUT;

  21017   2 000311  8C80 0000 019E  00                   LDI      T20TIMEOUT
          2 000314  8D47 0022                            SDI      ERCOD,AUTO

     1006    21018    2             CALL Y$ER;

  21018   2 000316  E3C0 0C98                            LNJ,B6   s:0,PREL
          2 000318       0001                            DC       s:21019,PREL

     1007    21019    2             IF KX$L2.R20_CNT < KX$L2.R20

  21019   2 000319  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00031B  E2C6 0054                            LLH,R6   84,B6
          2 00031D  D846 0054                            LDR,R5   84,B6
          2 00031F  D570 00FF                            AND,R5   255,IMO
          2 000321  E955                                 CMR,R6   R5
          2 000322  0881 0025                            BAGE     s:21032,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:172  

     1008    21020    2                THEN
     1009    21021    3                   DO;

     1010    21022    3                      CALL_FPT = '0'B;

  21022   2 000324  5C20                                 LDV,R5   32
          2 000325  0021                                 ALR      ;
          2 000326       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 000328       4007 0012                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

     1011    21023    3                      CALL_FPT.EVN = %KX_P_EV_INIT#;

  21023   2 00032A  437F                                 CSYNC    s:21022+5,SPREL
          2 00032B  8747 0012                            CL       CALL_FPT,AUTO

     1012    21024    3                      CALL_FPT.CAL$ = CTX$;

  21024   2 00032D  EFC7 0013                            STB,B6   CALL_FPT+1,AUTO

     1013    21025    3                      CALL KXP$PACKET ( CALL_FPT )

  21025   2 00032F  DBC7 0012                            LAB,B5   CALL_FPT,AUTO
          2 000331  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000333  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000335  CBF0 0100                            LAB,B4   256,IMO
          2 000337  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 00033A       0003                            DC       s:21027,PREL
          2 00033B  0F81 0009                            B        s:21029,PREL

     1014    21026    4                         WHENALTRETURN DO;

     1015    21027    4                               CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  21027   2 00033D  BBC7 0019                            LAB,B3   CALL_FPT+7,AUTO
          2 00033F  CBF0 0100                            LAB,B4   256,IMO
          2 000341  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:173  
          2 000344       0001                            DC       s:21029,PREL

     1016    21028    4                            END;

     1017    21029    3                      RETURN;

  21029   2 000345  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1018    21030    3                   END;
     1019    21031    2                ELSE
     1020    21032    2                   FEVENT = %Y_EV_STOP#;

  21032   2 000348  4C01                                 LDV,R4   1
          2 000349  CF47 0024                            STR,R4   FEVENT,AUTO
          2 00034B  0F81 0021                            B        s:21048,PREL

     1021    21033
     1022    21034    2          CASE ( %KX_F_EV_TERMACK# );

     1023    21035    2             KX$L2.TERMACKPND = '0'B;

  21035   2 00034D  8845 0067                            LBF,'0020'X       103,B5
  21035   2 00034F       0020

     1024    21036    2             IF KX$L2.RLS_TERMACKPND

  21036   2 000350  82C5 0067                            LB,'0010'X        103,B5
  21036   2 000352       0010
          2 000353  0581 000D                            BBF      s:21039,PREL

     1025    21037    2                THEN
     1026    21038    2                   CALL KXS$RLSCNTX ( CTX$ );

  21038   2 000355  BBC7 0006                            LAB,B3   CTX$,AUTO
          2 000357  BFC7 0038                            STB,B3   ADDRESS+4,AUTO
          2 000359  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 00035B  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:174  
          2 00035D  E380 0000 0000  xent                 LNJ,B6   KXS$RLSCNTX
          2 000360       0001                            DC       s:21039,PREL

     1027    21039    2             RETURN;

  21039   2 000361  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1028    21040
     1029    21041    2          CASE ( ELSE );

     1030    21042        /*S* SCREECH_CODE: KXF-S$KX_FRM_UNKEVT#
     1031    21043             MESSAGE: Frame received an unknown event.
     1032    21044        */
     1033    21045    2             CALL KHD$SCREECH ( Y_UNKEVT );

  21045   2 000364  BB80 0000 0000  03                   LAB,B3   0
          2 000367  CBF0 0100                            LAB,B4   256,IMO
          2 000369  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 00036C       0001                            DC       s:21048,PREL

     1034    21046    2       END /*  CASE  */;

     1035    21047
     1036    21048    1       CHN$ = KX$L1.CHN$;

  21048   2 00036D  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00036F  DCC6 0002                            LDB,B5   2,B6
          2 000371  DFC7 000A                            STB,B5   CHN$,AUTO

     1037    21049
     1038    21050                                          /* For SLCC, only data and control
     1039    21051                                             functions do anything. */
     1040    21052
     1041    21053    1       IF CHN$->KH$CHN.ATTR&%G_ATTR_CL_SLCC

  21053   2 000373  E845 0005                            LDR,R6   5,B5
          2 000375  E570 0200                            AND,R6   512,IMO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:175  
          2 000377  6901 00B0                            BEZ,R6   s:21089,PREL

     1042    21054    1          THEN
     1043    21055    2             DO CASE ( FEVENT );

  21055   2 000379  B847 0024                            LDR,R3   FEVENT,AUTO
          2 00037B  3D09                                 CMV,R3   9
          2 00037C  0281 00A0                            BGE      s:21084,PREL
          2 00037E  A830 0000 0384  02                   LDR,R2   s:21055+11,R3
          2 000381  83A0 0000 038D  02                   JMP      s:21057,R2
          2 000384       0000                            DC       s:21057,PREL
          2 000385       0021                            DC       s:21066,PREL
          2 000386       0021                            DC       s:21066,PREL
          2 000387       0090                            DC       s:21084,PREL
          2 000388       0090                            DC       s:21084,PREL
          2 000389       0090                            DC       s:21084,PREL
          2 00038A       0090                            DC       s:21084,PREL
          2 00038B       0026                            DC       s:21069,PREL
          2 00038C       0058                            DC       s:21075,PREL

     1044    21056    2                CASE ( %Y_EV_START# );

     1045    21057    2                   IF KX$L1.IN_CCB_HEAD$~=ADDR(NIL) THEN GOTO SLCC_UP;

  21057   2 00038D  8DC6 0006                            CMN      6,B6
          2 00038F  0981 0019                            BNE      s:21059,PREL

     1046    21058    2                   CALL KXN$CMND ( %KX_N_START_RCV#, CHN$->KH$CHN);

  21058   2 000391  CBF0 0003                            LAB,B4   3,IMO
          2 000393  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 000395  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000397  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000399  CBF0 0200                            LAB,B4   512,IMO
          2 00039B  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 00039E       0001                            DC       s:21059,PREL

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:176  
     1047    21059    2                   ERCOD = START;

  21059   2 00039F  8C80 0000 01A0  00                   LDI      START
          2 0003A2  8D47 0022                            SDI      ERCOD,AUTO

     1048    21060    2                   CALL Y$ER;

  21060   2 0003A4  E3C0 0C0A                            LNJ,B6   s:0,PREL
          2 0003A6       0001                            DC       s:21061,PREL

     1049    21061    2                   GOTO L_RET0;

  21061   2 0003A7  0F81 FF5D                            B        s:21010,PREL

  21059   2                              SLCC_UP         null
     1050    21062    2   SLCC_UP:        ;
     1051    21063    2                   CALL Y$UP;

  21063   2 0003A9  E3C0 0C4F            SLCC_UP         LNJ,B6   s:0,PREL
          2 0003AB       0001                            DC       s:21064,PREL

     1052    21064    2                   GOTO L_RET0;

  21064   2 0003AC  0F81 FF58                            B        s:21010,PREL

     1053    21065    2                CASE ( %Y_EV_DIED#, %Y_EV_STOP# );

     1054    21066    2                   CHN$->KH$CHN.DWNLOD = '0'B; /* Always take a dump for now */

  21066   2 0003AE  8845 0007                            LBF,'1000'X       7,B5
  21066   2 0003B0       1000

     1055    21067    2                   GOTO STOP_ENTRY;   /* in CASE  ( %Y_ACT_STOP# ) */

  21067   2 0003B1  0F81 0633                            B        s:22036,PREL

     1056    21068    2                CASE ( %Y_EV_DATA_OUT# );
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:177  

     1057    21069    2                   KX$PACKET.GFI = 2;

  21069   2 0003B3  E870 2000                            LDR,R6   8192,IMO
          2 0003B5  CCC7 0008                            LDB,B4   DAT$,AUTO
          2 0003B7  EAC4 0009                            SRM,R6,'3000'X    9,B4
          2 0003B9       3000

     1058    21070    2                   KX_STATS_X25.BYTES_OUT = KX_STATS_X25.BYTES_OUT+KX$DATA.CNT-3;

  21070   2 0003BA  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0003BC  F845 0007                            LDR,R7   7,B5
          2 0003BE  6C00                                 LDV,R6   0
          2 0003BF  8400 0000 0016  xsym                 AID      KX_STATS_X25+22
          2 0003C2  8470 FFFF FFFD                       AID      -3,IMO
          2 0003C5  8D00 0000 0016  xsym                 SDI      KX_STATS_X25+22

     1059    21071    2                   KX_STATS_X25.PACKETS_OUT = KX_STATS_X25.PACKETS_OUT+1;

  21071   2 0003C8  8A80 0000 001B  xsym                 INC      KX_STATS_X25+27
          2 0003CB  8E80 0000 001A  xsym                 CAD      KX_STATS_X25+26

     1060    21072    2                   CALL KXN$CMND ( %KX_N_SEND_Q#, CHN$->KH$CHN, DAT$ );

  21072   2 0003CE  CBF0 0008                            LAB,B4   8,IMO
          2 0003D0  BBC7 0008                            LAB,B3   DAT$,AUTO
          2 0003D2  BFC7 003C                            STB,B3   ADDRESS+8,AUTO
          2 0003D4  ACC7 000A                            LDB,B2   CHN$,AUTO
          2 0003D6  AFC7 003A                            STB,B2   ADDRESS+6,AUTO
          2 0003D8  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 0003DA  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0003DC  CBF0 0300                            LAB,B4   768,IMO
          2 0003DE  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 0003E1       0001                            DC       s:21073,PREL

     1061    21073    2                   RETURN;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:178  
  21073   2 0003E2  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1062    21074    2                CASE ( %Y_EV_I# );

     1063    21075    2                   KX_STATS_X25.PACKETS_IN = KX_STATS_X25.PACKETS_IN + 1;

  21075   2 0003E5  8A80 0000 0019  xsym                 INC      KX_STATS_X25+25
          2 0003E8  8E80 0000 0018  xsym                 CAD      KX_STATS_X25+24

     1064    21076    2                   KX_STATS_X25.BYTES_IN = KX$DATA.CNT-3 + KX_STATS_X25.BYTES_IN;

  21076   2 0003EB  CCC7 0008                            LDB,B4   DAT$,AUTO
          2 0003ED  F844 0007                            LDR,R7   7,B4
          2 0003EF  6C00                                 LDV,R6   0
          2 0003F0  8400 0000 0014  xsym                 AID      KX_STATS_X25+20
          2 0003F3  8470 FFFF FFFD                       AID      -3,IMO
          2 0003F6  8D00 0000 0014  xsym                 SDI      KX_STATS_X25+20

     1065    21077    2                   CALL_FPT = DATIN_FPT;

  21077   2 0003F9  AB80 0000 01B7  00                   LAB,B2   DATIN_FPT
          2 0003FC  2C00                                 LDV,R2   0
          2 0003FD  6C20                                 LDV,R6   32
          2 0003FE  BB87                                 LAB,B3   ,AUTO
          2 0003FF  3C24                                 LDV,R3   36
          2 000400  0008                                 MMM

     1066    21078    2                   CALL_FPT.CAL$ = CTX$;

  21078   2 000401  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000403  EFC7 0013                            STB,B6   CALL_FPT+1,AUTO

     1067    21079    2                   CALL_FPT.PRM1$ = DAT$;

  21079   2 000405  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000407  DFC7 0019                            STB,B5   CALL_FPT+7,AUTO

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:179  
     1068    21080    2                   CALL KXP$PACKET (CALL_FPT);

  21080   2 000409  CBC7 0012                            LAB,B4   CALL_FPT,AUTO
          2 00040B  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 00040D  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 00040F  CBF0 0100                            LAB,B4   256,IMO
          2 000411  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 000414       0001                            DC       s:21081,PREL

     1069    21081    2                   FPT_X25.PRM1$ = CALL_FPT.PRM1$;

  21081   2 000415  ECC7 0019                            LDB,B6   CALL_FPT+7,AUTO
          2 000417  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          2 000419  EFC5 0007                            STB,B6   7,B5

     1070    21082    2                   GOTO L_RET0;

  21082   2 00041B  0F81 FEE9                            B        s:21010,PREL

     1071    21083    2                CASE ( ELSE );

     1072    21084    2                   CALL KHD$SCREECH ( Y_UNKEVT );

  21084   2 00041D  BB80 0000 0000  03                   LAB,B3   0
          2 000420  CBF0 0100                            LAB,B4   256,IMO
          2 000422  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000425       0001                            DC       s:21085,PREL

     1073    21085    2                   GOTO L_RET0;

  21085   2 000426  0F81 FEDE                            B        s:21010,PREL

     1074    21086    2             END /* CASE */;

     1075    21087                                    /* Get the current state */
     1076    21088
     1077    21089    1       FSTATE = KX$L2.STATE.CURRENT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:180  

  21089   2 000428  E2C6 001D                            LLH,R6   29,B6
          2 00042A  EF47 0025                            STR,R6   FSTATE,AUTO

     1078    21090
     1079    21091        /* Make a trace entry                                     */
     1080    21092
     1081    21093        /* Eh?    $$TRACE ( FCG, 'KXF' ) , ( EVENT, 0 ) , ( MASK, %KX_TRACE_F ) */
     1082    21094
     1083    21095                                    /* Get the next state */
     1084    21096
     1085    21097    1       TEMP2 = FSTATE * ( %Y_EV_MAX# + 1 ) + FEVENT;

  21097   2 00042C  6F1E                                 MLV,R6   30
          2 00042D  EA47 0024                            ADD,R6   FEVENT,AUTO
          2 00042F  EF47 002D                            STR,R6   TEMP2,AUTO

     1086    21098    1       FSTATE = STATE_TABLE.NEXT_STATE ( TEMP2 );

  21098   2 000431  B856                                 LDR,R3   R6
          2 000432  D2B0 0000 0028  00                   LLH,R5   STATE_TABLE,R3
          2 000435  DF47 0025                            STR,R5   FSTATE,AUTO

     1087    21099
     1088    21100                                    /* Save the old and new states */
     1089    21101
     1090    21102    1       KX$L2.STATE.LAST = KX$L2.STATE.CURRENT;

  21102   2 000437  C2C6 001D                            LLH,R4   29,B6
          2 000439  CAC6 001D                            SRM,R4,'00FF'X    29,B6
          2 00043B       00FF

     1091    21103    1       KX$L2.STATE.CURRENT = FSTATE;

  21103   2 00043C  D7C6 001D                            STH,R5   29,B6

     1092    21104        /*
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:181  
     1093    21105                                             Update the history buffer.
     1094    21106        */
     1095    21107    1       KX$L2.HIST.STT ( KX$L2.HIST.X ) = FSTATE;

  21107   2 00043E  A846 001F                            LDR,R2   31,B6
          2 000440  2E40                                 ADV,R2   64
          2 000441  D7A6                                 STH,R5   ,B6,R2

     1096    21108    1       KX$L2.HIST.EVT ( KX$L2.HIST.X ) = FEVENT;

  21108   2 000442  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000444  A846 001F                            LDR,R2   31,B6
          2 000446  C847 0024                            LDR,R4   FEVENT,AUTO
          2 000448  2E48                                 ADV,R2   72
          2 000449  C7A6                                 STH,R4   ,B6,R2

     1097    21109    1       KX$L2.HIST.ACT ( KX$L2.HIST.X ) = STATE_TABLE.ACTION ( TEMP2 );

  21109   2 00044A  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00044C  A846 001F                            LDR,R2   31,B6
          2 00044E  9847 002D                            LDR,R1   TEMP2,AUTO
          2 000450  C290 0000 00DC  00                   LLH,R4   STATE_TABLE+180,R1
          2 000453  2E50                                 ADV,R2   80
          2 000454  C7A6                                 STH,R4   ,B6,R2

     1098    21110    1       KX$L2.HIST.X = KX$L2.HIST.X + 1;

  21110   2 000455  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000457  8AC6 001F                            INC      31,B6

     1099    21111    1       IF KX$L2.HIST.X > 7

  21111   2 000459  C846 001F                            LDR,R4   31,B6
          2 00045B  4D07                                 CMV,R4   7
          2 00045C  0381 0003                            BLE      s:21117,PREL

     1100    21112    1          THEN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:182  
     1101    21113    1             KX$L2.HIST.X = 0;

  21113   2 00045E  8746 001F                            CL       31,B6

     1102    21114
     1103    21115        /* Do the action requested                                */
     1104    21116
     1105    21117    2       DO CASE ( STATE_TABLE.ACTION ( TEMP2 ));

  21117   2 000460  A847 002D                            LDR,R2   TEMP2,AUTO
          2 000462  92A0 0000 00DC  00                   LLH,R1   STATE_TABLE+180,R2
          2 000465  1D23                                 CMV,R1   35
          2 000466  0281 05FA                            BGE      s:22127,PREL
          2 000468  B810 0000 046E  02                   LDR,R3   s:21117+14,R1
          2 00046B  83B0 0000 0491  02                   JMP      s:21125,R3
          2 00046E       05D9                            DC       s:22133,PREL
          2 00046F       051B                            DC       s:21991,PREL
          2 000470       03AF                            DC       s:21713,PREL
          2 000471       0526                            DC       s:22005,PREL
          2 000472       0554                            DC       s:22036,PREL
          2 000473       0247                            DC       s:21532,PREL
          2 000474       05BE                            DC       s:22094,PREL
          2 000475       047B                            DC       s:21877,PREL
          2 000476       024C                            DC       s:21544,PREL
          2 000477       01D7                            DC       s:21438,PREL
          2 000478       01EA                            DC       s:21469,PREL
          2 000479       0484                            DC       s:21891,PREL
          2 00047A       05C3                            DC       s:22106,PREL
          2 00047B       025E                            DC       s:21570,PREL
          2 00047C       04B9                            DC       s:21922,PREL
          2 00047D       01B8                            DC       s:21404,PREL
          2 00047E       0471                            DC       s:21849,PREL
          2 00047F       0000                            DC       s:21125,PREL
          2 000480       0005                            DC       s:21135,PREL
          2 000481       0113                            DC       s:21317,PREL
          2 000482       0036                            DC       s:21193,PREL
          2 000483       04F2                            DC       s:21956,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:183  
          2 000484       0268                            DC       s:21593,PREL
          2 000485       0454                            DC       s:21826,PREL
          2 000486       03B9                            DC       s:21735,PREL
          2 000487       0404                            DC       s:21775,PREL
          2 000488       04B9                            DC       s:21922,PREL
          2 000489       000D                            DC       s:21150,PREL
          2 00048A       05D0                            DC       s:22127,PREL
          2 00048B       0012                            DC       s:21163,PREL
          2 00048C       0476                            DC       s:21863,PREL
          2 00048D       0232                            DC       s:21512,PREL
          2 00048E       025A                            DC       s:21557,PREL
          2 00048F       05C8                            DC       s:22113,PREL
          2 000490       03AD                            DC       s:21703,PREL

     1106    21118        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:184  
     1107    21119
     1108    21120        /* %Y_ACT_CL_BUSY#  -  clear DTE busy condition             */
     1109    21121        /* Reset DTE_BUSY                                         */
     1110    21122
     1111    21123    2          CASE ( %Y_ACT_CL_BUSY# );

     1112    21124
     1113    21125    2             KX$L2.FLG.DTE_BUSY = '0'B;

  21125   2 000491  8846 002E                            LBF,'0080'X       46,B6
  21125   2 000493       0080
          2 000494  0F81 05D5                            B        s:22133,PREL

     1114    21126
     1115    21127        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:185  
     1116    21128
     1117    21129        /* %Y_ACT_CL_REJ#  -  clear DCE reject condition            */
     1118    21130        /* Reset DCE_REJ                                          */
     1119    21131        /* Retransmit                                             */
     1120    21132
     1121    21133    2          CASE ( %Y_ACT_CL_REJ# );

     1122    21134
     1123    21135    2             KX$L2.FLG.DCE_REJ = '0'B;

  21135   2 000496  8846 002E                            LBF,'0100'X       46,B6
  21135   2 000498       0100

     1124    21136        /*
     1125    21137                                             Retransmit all the frames now.
     1126    21138        */
     1127    21139    2             CALL Y$RETRAN;

  21139   2 000499  E3C0 0A03                            LNJ,B6   s:0,PREL
          2 00049B       0001                            DC       s:21139+3,PREL
          2 00049C  0F81 05CD                            B        s:22133,PREL

     1128    21140
     1129    21141        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:186  
     1130    21142
     1131    21143        /* %Y_ACT_CL_RESET#  -  the DTE has acknowledged the reset request              */
     1132    21144        /* Reset the context block                                */
     1133    21145
     1134    21146    2          CASE ( %Y_ACT_CL_RESET# );

     1135    21147
     1136    21148        /* Reset the context block                                */
     1137    21149
     1138    21150    2             CALL Y$RESET_RETRAN;

  21150   2 00049E  E3C0 0938                            LNJ,B6   s:0,PREL
          2 0004A0       0001                            DC       s:21150+3,PREL
          2 0004A1  0F81 05C8                            B        s:22133,PREL

     1139    21151
     1140    21152        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:187  
     1141    21153
     1142    21154        /* %Y_ACT_CL_TR  -  on exit from timer recovery#,  set DCE_REJ                   */
     1143    21155        /* and DCE_BUSY to the appropriate values                 */
     1144    21156        /* Set / reset DCE_REJ and DCE_BUSY                         */
     1145    21157        /* Retransmit any unacknowledged I frames                 */
     1146    21158
     1147    21159    2          CASE ( %Y_ACT_CL_TR# );

     1148    21160
     1149    21161        /* Set the flags according to what response was received  */
     1150    21162
     1151    21163    2             IF ( FEVENT = %Y_EV_RR_F# )

  21163   2 0004A3  C847 0024                            LDR,R4   FEVENT,AUTO
          2 0004A5  4D0F                                 CMV,R4   15
          2 0004A6  0981 0006                            BNE      s:21167,PREL

     1152    21164    2                THEN           /*  RR resets DCE_BUSY  */
     1153    21165    2                   KX$L2.FLG.DCE_BUSY = '0'B;

  21165   2 0004A8  8846 002E                            LBF,'4000'X       46,B6
  21165   2 0004AA       4000
          2 0004AB  0F81 000C                            B        s:21172,PREL

     1154    21166    2                ELSE
     1155    21167    2                   IF ( FEVENT = %Y_EV_RNR_F# )

  21167   2 0004AD  4D11                                 CMV,R4   17
          2 0004AE  0981 0006                            BNE      s:21171,PREL

     1156    21168    2                      THEN     /*  RNR sets DEC_BUSY  */
     1157    21169    2                         KX$L2.FLG.DCE_BUSY = '1'B;

  21169   2 0004B0  8946 002E                            LBT,'4000'X       46,B6
  21169   2 0004B2       4000
          2 0004B3  0F81 0004                            B        s:21172,PREL

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:188  
     1158    21170    2                      ELSE     /*  REJ resets DCE_BUSY and sets DCE_REJ  */
     1159    21171    2                         KX$L2.FLG.DCE_BUSY = '0'B;

  21171   2 0004B5  8846 002E                            LBF,'4000'X       46,B6
  21171   2 0004B7       4000

     1160    21172    2             CALL Y$STOP_TIMER;

  21172   2 0004B8  E3C0 0B93                            LNJ,B6   s:0,PREL
          2 0004BA       0001                            DC       s:21174,PREL

     1161    21173
     1162    21174    2             IF ( KX$L2.I_CNT ~= 0 )

  21174   2 0004BB  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0004BD  82C6 002F                            LB,'00FF'X        47,B6
          2 0004BF       00FF
          2 0004C0  0581 05A9                            BBF      s:22133,PREL

     1163    21175    2                THEN           /*  Retransmit unacknowledged I frames  */
     1164    21176    2                   CALL Y$RETRAN;

  21176   2 0004C2  E3C0 09DA                            LNJ,B6   s:0,PREL
          2 0004C4       0001                            DC       s:21176+3,PREL
          2 0004C5  0F81 05A4                            B        s:22133,PREL

     1165    21177
     1166    21178        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:189  
     1167    21179
     1168    21180        /* %Y_ACT_DATA_IN#  -  receipt of a valid I - frame           */
     1169    21181        /* Check for proper sequence number                       */
     1170    21182        /* Bad.                                                   */
     1171    21183        /* If DTE_REJ not set,  set it and send REJ                */
     1172    21184        /* Good.                                                  */
     1173    21185        /* Update N' ( S )  and V ( R )                                   */
     1174    21186        /* Give the I - frame to the packet level                   */
     1175    21187        /* Check for sending a response to the DCE                */
     1176    21188
     1177    21189    2          CASE ( %Y_ACT_DATA_IN# );

     1178    21190
     1179    21191        /* Check for the proper sequence number                   */
     1180    21192
     1181    21193    2             IF NOT KX$L2.FLG.EXTSEQ

  21193   2 0004C7  89C6 002F                            CMZ      47,B6
          2 0004C9  0801 000C                            BAL      s:21197,PREL

     1182    21194    2                THEN
     1183    21195    2                   TEMP2 = KX$FRAME.CTL_BITS.NS;

  21195   2 0004CB  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0004CD  A845 0008                            LDR,R2   8,B5
          2 0004CF  2041                                 SOR,R2   1
          2 0004D0  A570 0007                            AND,R2   7,IMO
          2 0004D2  AF47 002D                            STR,R2   TEMP2,AUTO
          2 0004D4  0F81 000A                            B        s:21201,PREL

     1184    21196    2                ELSE
     1185    21197    2                   TEMP2 = KX$EXTFRAME.XCTL.CTL_BITS.NS;

  21197   2 0004D6  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0004D8  A845 0008                            LDR,R2   8,B5
          2 0004DA  2041                                 SOR,R2   1
          2 0004DB  A570 007F                            AND,R2   127,IMO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:190  
          2 0004DD  AF47 002D                            STR,R2   TEMP2,AUTO

     1186    21198
     1187    21199        /* Is this the proper one?                                */
     1188    21200
     1189    21201    2             IF ( TEMP2 ~= KX$L2.VR )

  21201   2 0004DF  C846 002D                            LDR,R4   45,B6
          2 0004E1  C570 00FF                            AND,R4   255,IMO
          2 0004E3  C952                                 CMR,R4   R2
          2 0004E4  0901 002B                            BE       s:21242,PREL

     1190    21202    2                THEN
     1191    21203    3                   DO;

     1192    21204
     1193    21205        /* No  -  is the reject flag already set?                   */
     1194    21206
     1195    21207
     1196    21208        /* Are we already in reject state ?                       */
     1197    21209
     1198    21210    3                      IF KX$L2.FLG.DTE_REJ

  21210   2 0004E6  82C6 002E                            LB,'0040'X        46,B6
  21210   2 0004E8       0040
          2 0004E9  0581 000B                            BBF      s:21222,PREL

     1199    21211    3                         THEN
     1200    21212    4                            DO;

     1201    21213    4                               IF KX$L2.FLG.POLL_R

  21213   2 0004EB  82C6 002E                            LB,'0400'X        46,B6
  21213   2 0004ED       0400
          2 0004EE  0581 057B                            BBF      s:22133,PREL

     1202    21214    4                                  THEN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:191  
     1203    21215    4                                     CALL Y$RESP;

  21215   2 0004F0  E3C0 09F7                            LNJ,B6   s:0,PREL
          2 0004F2       0001                            DC       s:21216,PREL

     1204    21216    4                            END;

  21216   2 0004F3  0F81 0576                            B        s:22133,PREL

     1205    21217    3                         ELSE
     1206    21218    4                            DO;

     1207    21219
     1208    21220        /* No  - send a REJ                             */
     1209    21221
     1210    21222    4                               KX$L2.FLG.DTE_REJ = '1'B;

  21222   2 0004F5  8946 002E                            LBT,'0040'X       46,B6
  21222   2 0004F7       0040

     1211    21223    4                               IF KX$L2.FLG.POLL_R

  21223   2 0004F8  82C6 002E                            LB,'0400'X        46,B6
  21223   2 0004FA       0400
          2 0004FB  0581 0006                            BBF      s:21227,PREL

     1212    21224    4                                  THEN
     1213    21225    4                                     CTL = %Y_CTL_REJ_P#;

  21225   2 0004FD  3C19                                 LDV,R3   25
          2 0004FE  BF47 002A                            STR,R3   CTL,AUTO
          2 000500  0F81 0004                            B        s:21228,PREL

     1214    21226    4                                  ELSE
     1215    21227    4                                     CTL = %Y_CTL_REJ#;

  21227   2 000502  3C09                                 LDV,R3   9
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:192  
          2 000503  BF47 002A                            STR,R3   CTL,AUTO

     1216    21228    4                               CALL Y$SEND_RESPONSE;

  21228   2 000505  E3C0 09F7                            LNJ,B6   s:0,PREL
          2 000507       0001                            DC       s:21232,PREL

     1217    21229
     1218    21230        /* Stats                                                  */
     1219    21231
     1220    21232    4                               KX_STATS_HDLC.F_REJECTS_OUT = KX_STATS_HDLC.
             21232                                        F_REJECTS_OUT + 1;

  21232   2 000508  8A80 0000 0029  xsym                 INC      KX_STATS_HDLC+41
          2 00050B  8E80 0000 0028  xsym                 CAD      KX_STATS_HDLC+40

     1221    21233    4                            END;

     1222    21234
     1223    21235    3                   END;

  21235   2 00050E  0F81 055B                            B        s:22133,PREL

     1224    21236    2                ELSE
     1225    21237    3                   DO;

     1226    21238
     1227    21239        /* The sequence number was correct                        */
     1228    21240        /* Any reject condition is now cleared                    */
     1229    21241
     1230    21242    3                      KX$L2.FLG.DTE_REJ = '0'B;

  21242   2 000510  8846 002E                            LBF,'0040'X       46,B6
  21242   2 000512       0040

     1231    21243
     1232    21244        /* Update V ( R )                                             */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:193  
     1233    21245
     1234    21246    3                      KX$L2.VR = MOD ( KX$L2.VR+1, 8+120*BITBIN(KX$L2.FLG.EXTSEQ) );

  21246   2 000513  B846 002F                            LDR,R3   47,B6
          2 000515  304F                                 SOR,R3   15
          2 000516  F854                                 LDR,R7   R4
          2 000517  6C00                                 LDV,R6   0
          2 000518  8470 0000 0001                       AID      1,IMO
          2 00051B  3F78                                 MLV,R3   120
          2 00051C  3E08                                 ADV,R3   8
          2 00051D  F353                                 DIV,R7   R3
          2 00051E  EAC6 002D                            SRM,R6,'00FF'X    45,B6
          2 000520       00FF

  21246   2                              DATA_IN_ENTRY   null
     1235    21247
     1236    21248    3   DATA_IN_ENTRY:     ;
     1237    21249        /* Stats                                                  */
     1238    21250
     1239    21251    3                      KX_STATS_X25.PACKETS_IN = KX_STATS_X25.PACKETS_IN + 1;

  21251   2 000521  8A80 0000 0019  xsym DATA_IN_ENTRY   INC      KX_STATS_X25+25
          2 000524  8E80 0000 0018  xsym                 CAD      KX_STATS_X25+24

     1240    21252    3                      KX_STATS_X25.BYTES_IN = KX$DATA.CNT - 2

  21252   2 000527  E846 002F                            LDR,R6   47,B6
          2 000529  604F                                 SOR,R6   15
          2 00052A  E245 0007                            SUB,R6   7,B5
          2 00052C  70F0                                 DAR,R7   16
          2 00052D  8480 0000 0014  xsym                 SID      KX_STATS_X25+20
          2 000530  8656                                 CPL      R6
          2 000531  8657                                 CPL      R7
          2 000532  8470 FFFF FFFF                       AID      -1,IMO
          2 000535  8D00 0000 0014  xsym                 SDI      KX_STATS_X25+20

     1241    21253    3                         - BITBIN(KX$L2.FLG.EXTSEQ) + KX_STATS_X25.BYTES_IN;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:194  
     1242    21254
     1243    21255        /* Store 50 bytes of the frame in static */
     1244    21256    3                      KX_FRAME = STR;

  21256   2 000538  AB85                                 LAB,B2   ,B5
          2 000539  2C00                                 LDV,R2   0
          2 00053A  6C32                                 LDV,R6   50
          2 00053B  BB80 0000 0000  01                   LAB,B3   X25_PRM_CLK
          2 00053E  3C0E                                 LDV,R3   14
          2 00053F  0008                                 MMM

     1245    21257        /* Give the I - frame to the packet level                   */
     1246    21258
     1247    21259        /* Y$RESP uses DAT$ so call_fpt has to be set up first */
     1248    21260    3                      CALL_FPT = DATIN_FPT;

  21260   2 000540  AB80 0000 01B7  00                   LAB,B2   DATIN_FPT
          2 000543  2C00                                 LDV,R2   0
          2 000544  6C20                                 LDV,R6   32
          2 000545  BB87                                 LAB,B3   ,AUTO
          2 000546  3C24                                 LDV,R3   36
          2 000547  0008                                 MMM

     1249    21261    3                      CALL_FPT.CAL$ = CTX$;

  21261   2 000548  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00054A  EFC7 0013                            STB,B6   CALL_FPT+1,AUTO

     1250    21262    3                      CALL_FPT.PRM1$ = DAT$;

  21262   2 00054C  CCC7 0008                            LDB,B4   DAT$,AUTO
          2 00054E  CFC7 0019                            STB,B4   CALL_FPT+7,AUTO

     1251    21263    3                      KX$L2.DCE_I_CNT = KX$L2.DCE_I_CNT + 1;

  21263   2 000550  E2C6 002D                            LLH,R6   45,B6
          2 000552  6E01                                 ADV,R6   1
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:195  
          2 000553  E7C6 002D                            STH,R6   45,B6

     1252    21264    3                      IF KX$L2.FLG.POLL_R

  21264   2 000555  82C6 002E                            LB,'0400'X        46,B6
  21264   2 000557       0400
          2 000558  0581 0004                            BBF      s:21267,PREL

     1253    21265    3                         THEN  /* repsond to poll frames immediately */
     1254    21266    3                            CALL Y$RESP;

  21266   2 00055A  E3C0 098D                            LNJ,B6   s:0,PREL
          2 00055C       0001                            DC       s:21267,PREL

     1255    21267    3                      CALL KXP$PACKET (CALL_FPT);

  21267   2 00055D  EBC7 0012                            LAB,B6   CALL_FPT,AUTO
          2 00055F  EFC7 0038                            STB,B6   ADDRESS+4,AUTO
          2 000561  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000563  CBF0 0100                            LAB,B4   256,IMO
          2 000565  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 000568       0001                            DC       s:21269,PREL

     1256    21268
     1257    21269    3                      IF CALL_FPT.PRM1$ = ADDR(NIL)

  21269   2 000569  8DC7 0019                            CMN      CALL_FPT+7,AUTO
          2 00056B  0981 0008                            BNE      s:21279,PREL

     1258    21270    3                         THEN
     1259    21271        /*
     1260    21272           Packet level has held on to the buffer. Tell KXH not to
     1261    21273           re-use it.
     1262    21274        */
     1263    21275    3                            FPT_X25.PRM1$ = ADDR(NIL);

  21275   2 00056D  EB80 0000 0000                       LAB,B6   0
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:196  
          2 000570  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          2 000572  EFC5 0007                            STB,B6   7,B5

     1264    21276
     1265    21277        /* Should a response be sent to the DCE?                  */
     1266    21278
     1267    21279    3                      IF ( KX$L2.DCE_I_CNT >= MINIMUM(KX$L2.RSPDLY,KX$L2.K/2))

  21279   2 000574  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000576  E2C6 0016                            LLH,R6   22,B6
          2 000578  6041                                 SOR,R6   1
          2 000579  D846 001A                            LDR,R5   26,B6
          2 00057B  D570 00FF                            AND,R5   255,IMO
          2 00057D  D956                                 CMR,R5   R6
          2 00057E  0281 0002                            BGE      s:21279+13,PREL
          2 000580  E855                                 LDR,R6   R5
          2 000581  C2C6 002D                            LLH,R4   45,B6
          2 000583  C956                                 CMR,R4   R6
          2 000584  0201 04E5                            BL       s:22133,PREL

     1268    21280    3                         THEN
     1269    21281    4                            DO;

     1270    21282
     1271    21283        /* Send a response if no I - frames are ready or our xmt-wnd is blocked */
     1272    21284
     1273    21285    4                               IF (KX$L1.OUT_Q_HEAD$ = ADDR(NIL) OR KX$L2.FLG.BLK)

  21285   2 000586  8DC6 000E                            CMN      14,B6
          2 000588  0901 0005                            BE       s:21288,PREL
          2 00058A  89C6 002E                            CMZ      46,B6
          2 00058C  0881 0011                            BAGE     s:21298,PREL

     1274    21286    4                                  THEN /*  Send a supv response  */
     1275    21287    5                                     DO;

     1276    21288    5                                        IF KX$L2.FLG.DTE_BUSY
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:197  

  21288   2 00058E  82C6 002E                            LB,'0080'X        46,B6
  21288   2 000590       0080
          2 000591  0581 0006                            BBF      s:21292,PREL

     1277    21289    5                                           THEN
     1278    21290    5                                              CTL = %Y_CTL_RNR#;

  21290   2 000593  6C05                                 LDV,R6   5
          2 000594  EF47 002A                            STR,R6   CTL,AUTO
          2 000596  0F81 0004                            B        s:21293,PREL

     1279    21291    5                                           ELSE
     1280    21292    5                                              CTL = %Y_CTL_RR#;

  21292   2 000598  6C01                                 LDV,R6   1
          2 000599  EF47 002A                            STR,R6   CTL,AUTO

     1281    21293    5                                        CALL Y$SEND_RESPONSE;

  21293   2 00059B  E3C0 0961                            LNJ,B6   s:0,PREL
          2 00059D       0001                            DC       s:21298,PREL

     1282    21294    5                                     END; /* send supv response */

     1283    21295
     1284    21296        /* Reset the DCE's outstanding I - frame count              */
     1285    21297
     1286    21298    4                               KX$L2.DCE_I_CNT = 0;

  21298   2 00059E  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0005A0  87C6 002D                            CLH      45,B6

     1287    21299
     1288    21300    4                            END;

     1289    21301
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:198  
     1290    21302    3                   END /* IF */;

  21302   2 0005A2  0F81 04C7                            B        s:22133,PREL

     1291    21303
     1292    21304        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:199  
     1293    21305
     1294    21306        /* %Y_ACT_DATA_OUT#  -  queue an I - frame for output         */
     1295    21307        /* Insert N ( S )  and update V ( S )                             */
     1296    21308        /* Add the buffer to the queue of unacknowledged I - frames */
     1297    21309        /* Check for being blocked by unacknowledged I - frames     */
     1298    21310        /* Put the buffer on the output queue                     */
     1299    21311        /* Start the timer                                        */
     1300    21312
     1301    21313    2          CASE ( %Y_ACT_DATA_OUT# );

     1302    21314
     1303    21315        /* Insert N ( S )                                             */
     1304    21316
     1305    21317    2             IF NOT KX$L2.FLG.EXTSEQ

  21317   2 0005A4  89C6 002F                            CMZ      47,B6
          2 0005A6  0801 000B                            BAL      s:21324,PREL

     1306    21318    2                THEN
     1307    21319    3                   DO;

     1308    21320    3                      KX$FRAME.CTL_BITS.NS = KX$L2.VS;

  21320   2 0005A8  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0005AA  C846 002C                            LDR,R4   44,B6
          2 0005AC  4001                                 SOL,R4   1
          2 0005AD  CAC5 0008                            SRM,R4,'000E'X    8,B5
          2 0005AF       000E

     1309    21321    3                   END;

  21321   2 0005B0  0F81 0009                            B        s:21329,PREL

     1310    21322    2                ELSE
     1311    21323    3                   DO;

     1312    21324    3                      KX$EXTFRAME.XCTL.CTL_BITS.NS = KX$L2.VS;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:200  

  21324   2 0005B2  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0005B4  C846 002C                            LDR,R4   44,B6
          2 0005B6  4001                                 SOL,R4   1
          2 0005B7  CAC5 0008                            SRM,R4,'00FE'X    8,B5
          2 0005B9       00FE

     1313    21325    3                   END;

     1314    21326
     1315    21327        /* Update V ( S )                                             */
     1316    21328
     1317    21329    2             KX$L2.VS = MOD ( KX$L2.VS + 1, 8+120*BITBIN(KX$L2.FLG.EXTSEQ ) );

  21329   2 0005BA  C846 002F                            LDR,R4   47,B6
          2 0005BC  404F                                 SOR,R4   15
          2 0005BD  F846 002C                            LDR,R7   44,B6
          2 0005BF  F570 00FF                            AND,R7   255,IMO
          2 0005C1  6C00                                 LDV,R6   0
          2 0005C2  8470 0000 0001                       AID      1,IMO
          2 0005C5  4F78                                 MLV,R4   120
          2 0005C6  4E08                                 ADV,R4   8
          2 0005C7  F354                                 DIV,R7   R4
          2 0005C8  EAC6 002C                            SRM,R6,'00FF'X    44,B6
          2 0005CA       00FF

     1318    21330
     1319    21331
     1320    21332        /* Add this buffer to the queue of unacknowledged I - frames*/
     1321    21333
     1322    21334    2             IF ( KX$L2.I_LIST_HEAD$ = ADDR(NIL) )

  21334   2 0005CB  8DC6 0030                            CMN      48,B6
          2 0005CD  0981 000D                            BNE      s:21350,PREL

     1323    21335    2                THEN
     1324    21336    3                   DO;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:201  

     1325    21337
     1326    21338        /* Empty list  -  this is the head and tail                 */
     1327    21339
     1328    21340    3                      KX$L2.I_LIST_HEAD$ = DAT$;

  21340   2 0005CF  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0005D1  DFC6 0030                            STB,B5   48,B6

     1329    21341    3                      KX$L2.I_LIST_TAIL$ = DAT$;

  21341   2 0005D3  DFC6 0032                            STB,B5   50,B6

     1330    21342    3                      KX$L2.I_CNT = 1;

  21342   2 0005D5  6C01                                 LDV,R6   1
          2 0005D6  EAC6 002F                            SRM,R6,'00FF'X    47,B6
          2 0005D8       00FF

     1331    21343
     1332    21344    3                   END;

  21344   2 0005D9  0F81 0014                            B        s:21358,PREL

     1333    21345    2                ELSE
     1334    21346    3                   DO;

     1335    21347
     1336    21348        /* Add this buffer to the tail                            */
     1337    21349
     1338    21350    3                      KX$L2.I_LIST_TAIL$ -> KX$TDATA.L2_LIST$ = DAT$;

  21350   2 0005DB  DCC6 0032                            LDB,B5   50,B6
          2 0005DD  CCC7 0008                            LDB,B4   DAT$,AUTO
          2 0005DF  CFC5 0002                            STB,B4   2,B5

     1339    21351    3                      KX$L2.I_LIST_TAIL$ = DAT$;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:202  

  21351   2 0005E1  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 0005E3  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 0005E5  EFC5 0032                            STB,B6   50,B5

     1340    21352    3                      KX$L2.I_CNT = KX$L2.I_CNT + 1;

  21352   2 0005E7  E845 002F                            LDR,R6   47,B5
          2 0005E9  EA70 0001                            ADD,R6   1,IMO
          2 0005EB  EAC5 002F                            SRM,R6,'00FF'X    47,B5
          2 0005ED       00FF

     1341    21353
     1342    21354    3                   END /* IF */;

     1343    21355
     1344    21356        /* Always clear the forward link                          */
     1345    21357
     1346    21358    2             KX$DATA.L2_LIST$ = ADDR(NIL);

  21358   2 0005EE  EB80 0000 0000                       LAB,B6   0
          2 0005F1  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0005F3  EFC5 0002                            STB,B6   2,B5

     1347    21359
     1348    21360        /* ALWAYS clear the level 2 release                       */
     1349    21361
     1350    21362    2             KX$DATA.RLS.L2 = '0'B;

  21362   2 0005F5  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 0005F7  8846 0006                            LBF,'4000'X       6,B6
          2 0005F9       4000

     1351    21363
     1352    21364        /* Check for being blocked by the window size             */
     1353    21365
     1354    21366    2             IF ( KX$L2.I_CNT >= KX$L2.K )
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:203  

  21366   2 0005FA  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0005FC  E846 002F                            LDR,R6   47,B6
          2 0005FE  E570 00FF                            AND,R6   255,IMO
          2 000600  C2C6 0016                            LLH,R4   22,B6
          2 000602  E954                                 CMR,R6   R4
          2 000603  0801 0004                            BAL      s:21372,PREL

     1355    21367    2                THEN           /*  Blocked - set the flag  */
     1356    21368    2                   KX$L2.FLG.BLK = '1'B;

  21368   2 000605  8946 002E                            LBT,'8000'X       46,B6
  21368   2 000607       8000

     1357    21369
     1358    21370        /* Stats again                                            */
     1359    21371
     1360    21372    2             KX_STATS_X25.PACKETS_OUT = KX_STATS_X25.PACKETS_OUT + 1;

  21372   2 000608  8A80 0000 001B  xsym                 INC      KX_STATS_X25+27
          2 00060B  8E80 0000 001A  xsym                 CAD      KX_STATS_X25+26

     1361    21373    2             TEMP3 = KX$DATA.CNT - 2 - BITBIN(KX$L2.FLG.EXTSEQ);

  21373   2 00060E  C846 002F                            LDR,R4   47,B6
          2 000610  404F                                 SOR,R4   15
          2 000611  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000613  C245 0007                            SUB,R4   7,B5
          2 000615  8254                                 NEG      R4
          2 000616  4EFE                                 ADV,R4   -2
          2 000617  CF47 002E                            STR,R4   TEMP3,AUTO

     1362    21374    2             KX_STATS_X25.BYTES_OUT = KX_STATS_X25.BYTES_OUT + TEMP3;

  21374   2 000619  F854                                 LDR,R7   R4
          2 00061A  6C00                                 LDV,R6   0
          2 00061B  8400 0000 0016  xsym                 AID      KX_STATS_X25+22
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:204  
          2 00061E  8D00 0000 0016  xsym                 SDI      KX_STATS_X25+22

     1363    21375
     1364    21376        /* Put in the command address                             */
     1365    21377
     1366    21378    2             KX$FRAME.ADR = KX$L2.ADR_CMND;

  21378   2 000621  B2C6 001E                            LLH,R3   30,B6
          2 000623  B7C5 0008                            STH,R3   8,B5

     1367    21379
     1368    21380        /* put the buffer on the output queue                     */
     1369    21381
     1370    21382    2             CALL KXN$CMND ( %KX_N_SEND_Q#, CHN$->KH$CHN, DAT$ );

  21382   2 000625  DBF0 0008                            LAB,B5   8,IMO
          2 000627  CBC7 0008                            LAB,B4   DAT$,AUTO
          2 000629  CFC7 003C                            STB,B4   ADDRESS+8,AUTO
          2 00062B  BCC7 000A                            LDB,B3   CHN$,AUTO
          2 00062D  BFC7 003A                            STB,B3   ADDRESS+6,AUTO
          2 00062F  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000631  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000633  CBF0 0300                            LAB,B4   768,IMO
          2 000635  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 000638       0001                            DC       s:21386,PREL

     1371    21383
     1372    21384        /* Start the timer if it is not already running.          */
     1373    21385
     1374    21386    2             IF KX$L2.T1 ~= 0 AND NOT KX$L2.TMRBLK.ON

  21386   2 000639  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00063B  82C6 0016                            LB,'00FF'X        22,B6
          2 00063D       00FF
          2 00063E  0581 042B                            BBF      s:22133,PREL
          2 000640  89C6 0047                            CMZ      71,B6
          2 000642  0801 0427                            BAL      s:22133,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:205  

     1375    21387    2                THEN
     1376    21388    3                   DO;

     1377    21389    3                      CALL Y$START_TIMER;

  21389   2 000644  E3C0 0AB3                            LNJ,B6   s:0,PREL
          2 000646       0001                            DC       s:21390,PREL

     1378    21390    3                   END;

  21390   2 000647  0F81 0422                            B        s:22133,PREL

     1379    21391
     1380    21392        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:206  
     1381    21393
     1382    21394        /* %Y_ACT_DISC#  -  send a disconnect command               */
     1383    21395        /* Send the disconnect                                    */
     1384    21396        /* Log the action                                         */
     1385    21397        /* Start the timer                                        */
     1386    21398        /* Reset the retry count                                  */
     1387    21399
     1388    21400    2          CASE ( %Y_ACT_DISC# );

     1389    21401
     1390    21402        /* Send the disconnect                                    */
     1391    21403
     1392    21404    2             CTL = %Y_CTL_DISC#;

  21404   2 000649  4C43                                 LDV,R4   67
          2 00064A  CF47 002A                            STR,R4   CTL,AUTO

     1393    21405    2             CALL Y$SEND_COMMAND;

  21405   2 00064C  E3C0 08BC                            LNJ,B6   s:0,PREL
          2 00064E       0001                            DC       s:21409,PREL

     1394    21406
     1395    21407        /* Log the action                                         */
     1396    21408
     1397    21409    2             ERCOD = DISC ;

  21409   2 00064F  8C80 0000 0190  00                   LDI      DISC
          2 000652  8D47 0022                            SDI      ERCOD,AUTO

     1398    21410    2             CALL Y$ER ;

  21410   2 000654  E3C0 095A                            LNJ,B6   s:0,PREL
          2 000656       0001                            DC       s:21415,PREL

     1399    21411
     1400    21412
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:207  
     1401    21413        /* Start the timer                                        */
     1402    21414
     1403    21415    2             IF KX$L2.T1 ~= 0

  21415   2 000657  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000659  82C6 0016                            LB,'00FF'X        22,B6
          2 00065B       00FF
          2 00065C  0581 0004                            BBF      s:21423,PREL

     1404    21416    2                THEN
     1405    21417    3                   DO;

     1406    21418    3                      CALL Y$START_TIMER;

  21418   2 00065E  E3C0 0A99                            LNJ,B6   s:0,PREL
          2 000660       0001                            DC       s:21423,PREL

     1407    21419    3                   END;

     1408    21420
     1409    21421        /* Reset the retry count                                  */
     1410    21422
     1411    21423    2             KX$L2.RC = 0;

  21423   2 000661  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000663  8846 0017                            LBF,'00FF'X       23,B6
          2 000665       00FF
          2 000666  0F81 0403                            B        s:22133,PREL

     1412    21424
     1413    21425        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:208  
     1414    21426
     1415    21427        /* %Y_ACT_DISC_L#  -  send a disconnect from an info transfer state             */
     1416    21428        /* Report VCDOWN                                          */
     1417    21429        /* Send the disconnect                                    */
     1418    21430        /* Reset the context block                                */
     1419    21431        /* Log the action                                         */
     1420    21432        /* Restart the timer                                      */
     1421    21433
     1422    21434    2          CASE ( %Y_ACT_DISC_L# );

     1423    21435
     1424    21436        /* Report VCDROP                                          */
     1425    21437
     1426    21438    2             CALL Y$STOP;

  21438   2 000668  E3C0 0911                            LNJ,B6   s:0,PREL
          2 00066A       0001                            DC       s:21442,PREL

     1427    21439
     1428    21440        /* Send the disconnect                                    */
     1429    21441
     1430    21442    2             CTL = %Y_CTL_DISC#;

  21442   2 00066B  6C43                                 LDV,R6   67
          2 00066C  EF47 002A                            STR,R6   CTL,AUTO

     1431    21443    2             CALL Y$SEND_COMMAND;

  21443   2 00066E  E3C0 089A                            LNJ,B6   s:0,PREL
          2 000670       0001                            DC       s:21447,PREL

     1432    21444
     1433    21445        /* Reset the context block                                */
     1434    21446
     1435    21447    2             CALL Y$RESET;

  21447   2 000671  E3C0 0757                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:209  
          2 000673       0001                            DC       s:21451,PREL

     1436    21448
     1437    21449        /* Log the action                                         */
     1438    21450
     1439    21451    2             ERCOD = DISC_L ;

  21451   2 000674  8C80 0000 0192  00                   LDI      DISC_L
          2 000677  8D47 0022                            SDI      ERCOD,AUTO

     1440    21452    2             GOTO L_1 ;

  21452   2 000679  0F81 001B                            B        s:21490,PREL

     1441    21453
     1442    21454
     1443    21455        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:210  
     1444    21456
     1445    21457        /* %Y_ACT_DISC_LU#  -  send a UA from an info state              */
     1446    21458        /* Report VCDROP                                          */
     1447    21459        /* Clear the output queue                                 */
     1448    21460        /* Send the UA                                            */
     1449    21461        /* Send a DISC                                            */
     1450    21462        /* Reset the context block                                */
     1451    21463        /* Log the action                                         */
     1452    21464
     1453    21465    2          CASE ( %Y_ACT_DISC_LU# );

     1454    21466
     1455    21467        /* Report VCDROP                                          */
     1456    21468
     1457    21469    2             CALL Y$STOP;

  21469   2 00067B  E3C0 08FE                            LNJ,B6   s:0,PREL
          2 00067D       0001                            DC       s:21473,PREL

     1458    21470
     1459    21471        /* Clear the output queue                                 */
     1460    21472
     1461    21473    2             CALL Y$CLR_DAT_Q;

  21473   2 00067E  E3C0 0AE1                            LNJ,B6   s:0,PREL
          2 000680       0001                            DC       s:21474,PREL

     1462    21474    2             CALL Y$CLR_SUP_Q;

  21474   2 000681  E3C0 0B16                            LNJ,B6   s:0,PREL
          2 000683       0001                            DC       s:21478,PREL

     1463    21475
     1464    21476        /* Send the UA and the DISC                               */
     1465    21477
     1466    21478    2             CALL Y$UA;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:211  
  21478   2 000684  E3C0 0850                            LNJ,B6   s:0,PREL
          2 000686       0001                            DC       s:21479,PREL

     1467    21479    2             CTL = %Y_CTL_DISC#;

  21479   2 000687  6C43                                 LDV,R6   67
          2 000688  EF47 002A                            STR,R6   CTL,AUTO

     1468    21480    2             CALL Y$SEND_COMMAND;

  21480   2 00068A  E3C0 087E                            LNJ,B6   s:0,PREL
          2 00068C       0001                            DC       s:21484,PREL

     1469    21481
     1470    21482        /* Reset the context block                                */
     1471    21483
     1472    21484    2             CALL Y$RESET;

  21484   2 00068D  E3C0 073B                            LNJ,B6   s:0,PREL
          2 00068F       0001                            DC       s:21488,PREL

     1473    21485
     1474    21486        /* Log the action                                         */
     1475    21487
     1476    21488    2             ERCOD = DISC_LU ;

  21488   2 000690  8C80 0000 0194  00                   LDI      DISC_LU
          2 000693  8D47 0022                            SDI      ERCOD,AUTO

     1477    21489    2   L_1:
     1478    21490    2             CALL Y$ER ;

  21490   2 000695  E3C0 0919            L_1             LNJ,B6   s:0,PREL
          2 000697       0001                            DC       s:21491,PREL

     1479    21491    2             IF KX$L2.T1 ~= 0

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:212  
  21491   2 000698  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00069A  82C6 0016                            LB,'00FF'X        22,B6
          2 00069C       00FF
          2 00069D  0581 0004                            BBF      s:21497,PREL

     1480    21492    2                THEN
     1481    21493    2                   CALL Y$START_TIMER;

  21493   2 00069F  E3C0 0A58                            LNJ,B6   s:0,PREL
          2 0006A1       0001                            DC       s:21497,PREL

     1482    21494        /*
     1483    21495           Tell KHA that link is not active.
     1484    21496        */
     1485    21497    2             CALL KHA$LINE_INACTIVE ( KX$L1.CHN$->KH$CHN.TERMID );

  21497   2 0006A2  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0006A4  DCC6 0002                            LDB,B5   2,B6
          2 0006A6  CBC5 0012                            LAB,B4   18,B5
          2 0006A8  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 0006AA  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0006AC  CBF0 0100                            LAB,B4   256,IMO
          2 0006AE  E380 0000 0000  xent                 LNJ,B6   KHA$LINE_INACTIVE
          2 0006B1       0001                            DC       s:21502,PREL

     1486    21498
     1487    21499
     1488    21500        /* Stats                                                  */
     1489    21501
     1490    21502    2             KX_STATS_HDLC.DISCONNECTS = KX_STATS_HDLC.DISCONNECTS + 1;

  21502   2 0006B2  8A80 0000 0019  xsym                 INC      KX_STATS_HDLC+25
          2 0006B5  8E80 0000 0018  xsym                 CAD      KX_STATS_HDLC+24

     1491    21503    2             KX_STATS_HDLC.LINES = KX_STATS_HDLC.LINES - 1;

  21503   2 0006B8  8C80 0000 0014  xsym                 LDI      KX_STATS_HDLC+20
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:213  
          2 0006BB  8470 FFFF FFFF                       AID      -1,IMO
          2 0006BE  8D00 0000 0014  xsym                 SDI      KX_STATS_HDLC+20
          2 0006C1  0F81 03A8                            B        s:22133,PREL

     1492    21504
     1493    21505        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:214  
     1494    21506
     1495    21507        /* %Y_ACT_DISC_NV#  -  send a disconnect from the down state*/
     1496    21508        /* Reset the context block                                */
     1497    21509        /* Send the disconnect                                    */
     1498    21510        /* Restart the timer                                      */
     1499    21511
     1500    21512    2          CASE ( %Y_ACT_DISC_NV# );

     1501    21513
     1502    21514    2   L_10:
     1503    21515    2             CALL Y$RESET;

  21515   2 0006C3  E3C0 0705            L_10            LNJ,B6   s:0,PREL
          2 0006C5       0001                            DC       s:21516,PREL

     1504    21516    2             CTL = %Y_CTL_DISC#;

  21516   2 0006C6  6C43                                 LDV,R6   67
          2 0006C7  EF47 002A                            STR,R6   CTL,AUTO

     1505    21517    2   L_7:
     1506    21518    2             CALL Y$SEND_COMMAND;

  21518   2 0006C9  E3C0 083F            L_7             LNJ,B6   s:0,PREL
          2 0006CB       0001                            DC       s:21519,PREL

     1507    21519    2             IF KX$L2.T1 ~= 0

  21519   2 0006CC  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0006CE  82C6 0016                            LB,'00FF'X        22,B6
          2 0006D0       00FF
          2 0006D1  0581 0398                            BBF      s:22133,PREL

     1508    21520    2                THEN
     1509    21521    2                   CALL Y$START_TIMER;

  21521   2 0006D3  E3C0 0A24                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:215  
          2 0006D5       0001                            DC       s:21521+3,PREL
          2 0006D6  0F81 0393                            B        s:22133,PREL

     1510    21522
     1511    21523        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:216  
     1512    21524
     1513    21525        /* %Y_ACT_DISC_RETRY1#  -  send a polled disconnect for the first time
             21525         */
     1514    21526        /* Send the polled disconnect                             */
     1515    21527        /* Reset the retry count                                  */
     1516    21528        /* Start the timer                                        */
     1517    21529
     1518    21530    2          CASE ( %Y_ACT_DISC_RETRY1# );

     1519    21531
     1520    21532    2             KX$L2.RC = 0;

  21532   2 0006D8  8846 0017                            LBF,'00FF'X       23,B6
  21532   2 0006DA       00FF

     1521    21533    2             GOTO L_9 ;

  21533   2 0006DB  0F81 0008                            B        s:21545,PREL

     1522    21534
     1523    21535        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:217  
     1524    21536
     1525    21537        /* %Y_ACT_DISC_R#  -  send a polled disconnect             */
     1526    21538        /* Send the polled disconnect                             */
     1527    21539        /* Increment the retry count                              */
     1528    21540        /* Start the timer                                        */
     1529    21541
     1530    21542    2          CASE ( %Y_ACT_DISC_R# );

     1531    21543
     1532    21544    2             KX$L2.RC = KX$L2.RC + 1;

  21544   2 0006DD  C846 0017                            LDR,R4   23,B6
          2 0006DF  CA70 0001                            ADD,R4   1,IMO
          2 0006E1  CAC6 0017                            SRM,R4,'00FF'X    23,B6
          2 0006E3       00FF

     1533    21545    2   L_9:      CALL Y$CLR_SUP_Q;

  21545   2 0006E4  E3C0 0AB3            L_9             LNJ,B6   s:0,PREL
          2 0006E6       0001                            DC       s:21546,PREL

     1534    21546    2             CTL = %Y_CTL_DISC_P#;

  21546   2 0006E7  6C53                                 LDV,R6   83
          2 0006E8  EF47 002A                            STR,R6   CTL,AUTO

     1535    21547    2             GOTO L_7;

  21547   2 0006EA  0FDF                                 B        s:21518,SPREL

     1536    21548        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:218  
     1537    21549
     1538    21550        /* %Y_ACT_DISC_UNV#  -  send a UA from the down state            */
     1539    21551        /* Send the UA                                            */
     1540    21552        /* Reset the context block                                */
     1541    21553        /* Send a DISC and start timer                            */
     1542    21554
     1543    21555    2          CASE ( %Y_ACT_DISC_UNV# );

     1544    21556
     1545    21557    2             CALL Y$UA;

  21557   2 0006EB  E3C0 07E9                            LNJ,B6   s:0,PREL
          2 0006ED       0001                            DC       s:21558,PREL

     1546    21558    2             GOTO L_10;

  21558   2 0006EE  0FD5                                 B        s:21512,SPREL

     1547    21559
     1548    21560        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:219  
     1549    21561
     1550    21562        /* %Y_ACT_DM#  -  disconnected mode message received while in setup             */
     1551    21563        /* Stop the timer                                         */
     1552    21564        /* Log the action                                         */
     1553    21565
     1554    21566    2          CASE ( %Y_ACT_DM# );

     1555    21567
     1556    21568        /* Stop the timer                                         */
     1557    21569
     1558    21570    2             CALL Y$STOP_TIMER;

  21570   2 0006EF  E3C0 095C                            LNJ,B6   s:0,PREL
          2 0006F1       0001                            DC       s:21574,PREL

     1559    21571
     1560    21572        /* Log the action                                         */
     1561    21573
     1562    21574    2             ERCOD = DM ;

  21574   2 0006F2  8C80 0000 0196  00                   LDI      DM
          2 0006F5  8D47 0022                            SDI      ERCOD,AUTO

     1563    21575    2             GOTO L_3 ;

  21575   2 0006F7  0F81 02E8                            B        s:22024,PREL

     1564    21576
     1565    21577
     1566    21578        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:220  
     1567    21579
     1568    21580        /* %Y_ACT_FRMR#  -  send a frame reject                     */
     1569    21581        /* Send the frame reject                                  */
     1570    21582        /* Start the timer                                        */
     1571    21583        /* Reset the retry count                                  */
     1572    21584        /* Log the action                                         */
     1573    21585
     1574    21586    2          CASE ( %Y_ACT_FRMR# );

     1575    21587        /*
     1576    21588           If already in FRMR state, we ignore the received frame in the following
     1577    21589           two cases:
     1578    21590           - we are the DCE and the frame received is an I frame, or
     1579    21591           - the frame received is a normal response frame (i.e. fevent ~= bad_adr)
     1580    21592        */
     1581    21593    2             IF KX$L2.STATE.LAST = %Y_ST_FRMR# AND (

  21593   2 0006F9  C846 001D                            LDR,R4   29,B6
          2 0006FB  C570 00FF                            AND,R4   255,IMO
          2 0006FD  4D07                                 CMV,R4   7
          2 0006FE  0981 001B                            BNE      s:21605,PREL
          2 000700  82C6 002E                            LB,'1000'X        46,B6
          2 000702       1000
          2 000703  0581 0006                            BBF      s:21593+17,PREL
          2 000705  E847 0024                            LDR,R6   FEVENT,AUTO
          2 000707  6D08                                 CMV,R6   8
          2 000708  0901 000F                            BE       s:21599,PREL
          2 00070A  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 00070C  E2C5 0008                            LLH,R6   8,B5
          2 00070E  D2C6 001E                            LLH,R5   30,B6
          2 000710  E955                                 CMR,R6   R5
          2 000711  0981 0008                            BNE      s:21605,PREL
          2 000713  E847 0024                            LDR,R6   FEVENT,AUTO
          2 000715  6D18                                 CMV,R6   24
          2 000716  0901 0003                            BE       s:21605,PREL

     1582    21594    2                ( KX$L2.FLG.DCE AND FEVENT = %Y_EV_I# ) OR
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:221  
     1583    21595    2                ( KX$FRAME.ADR = KX$L2.ADR_CMND AND FEVENT ~= %Y_EV_BAD_ADR# ) )
     1584    21596    2                THEN
     1585    21597    3                   DO;

     1586    21598        /* intentionally left blank */
     1587    21599    3                   END;

  21599   2 000718  0F81 0351                            B        s:22133,PREL

     1588    21600    3                ELSE DO;

     1589    21601
     1590    21602        /* set up the frame reject parameters               */
     1591    21603        /* this assumed the extended format. */
     1592    21604
     1593    21605    3                      IF KX$L2.STATE.LAST ~= %Y_ST_FRMR#

  21605   2 00071A  4D07                                 CMV,R4   7
          2 00071B  0901 0029                            BE       s:21621,PREL

     1594    21606    3                         THEN
     1595    21607    4                            DO;

     1596    21608    4                               KX$L2.FRMR_NSNR = KX$L2.VS*512 + KX$L2.VR*2;

  21608   2 00071D  E846 002C                            LDR,R6   44,B6
          2 00071F  6008                                 SOL,R6   8
          2 000720  D846 002D                            LDR,R5   45,B6
          2 000722  D570 00FF                            AND,R5   255,IMO
          2 000724  EA55                                 ADD,R6   R5
          2 000725  6001                                 SOL,R6   1
          2 000726  EF46 0053                            STR,R6   83,B6

     1597    21609    4                               IF KX$FRAME.ADR = KX$L2.ADR_CMND

  21609   2 000728  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 00072A  B2C5 0008                            LLH,R3   8,B5
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:222  
          2 00072C  E2C6 001E                            LLH,R6   30,B6
          2 00072E  B956                                 CMR,R3   R6
          2 00072F  0981 0003                            BNE      s:21612,PREL

     1598    21610    4                                  THEN
     1599    21611    4                                     KX$L2.FRMR_NSNR = KX$L2.FRMR_NSNR + 1;

  21611   2 000731  8AC6 0053                            INC      83,B6

     1600    21612    4                               IF KX$DATA.CNT = 4104

  21612   2 000733  B845 0007                            LDR,R3   7,B5
          2 000735  B970 1008                            CMR,R3   4104,IMO
          2 000737  0981 0006                            BNE      s:21616,PREL

     1601    21613    4                                  THEN
     1602    21614    4                                     KX$L2.FRMR_BITS = 4;   /* y-bit on */

  21614   2 000739  6C04                                 LDV,R6   4
          2 00073A  E7C6 0039                            STH,R6   57,B6
          2 00073C  0F81 0008                            B        s:21621,PREL

     1603    21615    4                                  ELSE
     1604    21616    4                                     KX$L2.FRMR_BITS = FRMR_REASON ( FEVENT );

  21616   2 00073E  B847 0024                            LDR,R3   FEVENT,AUTO
          2 000740  E2B0 0000 0000  00                   LLH,R6   FRMR_REASON,R3
          2 000743  E7C6 0039                            STH,R6   57,B6

     1605    21617    4                            END;

     1606    21618
     1607    21619        /* Need to clear data queue too??                */
     1608    21620
     1609    21621    3                      CALL Y$CLR_SUP_Q;

  21621   2 000745  E3C0 0A52                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:223  
          2 000747       0001                            DC       s:21625,PREL

     1610    21622
     1611    21623        /* Send the frame reject                         */
     1612    21624
     1613    21625    3                      CALL KXS$GETBFR ( 0, TEMP1$ );

  21625   2 000748  EBF0 0000                            LAB,B6   0,IMO
          2 00074A  DBC7 000E                            LAB,B5   TEMP1$,AUTO
          2 00074C  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 00074E  EFC7 0038                            STB,B6   ADDRESS+4,AUTO
          2 000750  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000752  CBF0 0200                            LAB,B4   512,IMO
          2 000754  E380 0000 0000  xent                 LNJ,B6   KXS$GETBFR
          2 000757       0001                            DC       s:21626,PREL

     1614    21626    3                      TEMP1$->KX$DATA.RLS.L3 = '1'B;

  21626   2 000758  ECC7 000E                            LDB,B6   TEMP1$,AUTO
          2 00075A  8946 0006                            LBT,'8000'X       6,B6
          2 00075C       8000

     1615    21627    3                      TEMP1$->KX$DATA.RLS.L2 = '1'B;

  21627   2 00075D  ECC7 000E                            LDB,B6   TEMP1$,AUTO
          2 00075F  8946 0006                            LBT,'4000'X       6,B6
          2 000761       4000

     1616    21628    3                      TEMP1$->KX$DATA.CNT = 5 + 2*BITBIN(KX$L2.FLG.EXTSEQ);

  21628   2 000762  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000764  E846 002F                            LDR,R6   47,B6
          2 000766  604F                                 SOR,R6   15
          2 000767  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 000769  6001                                 SOL,R6   1
          2 00076A  6E05                                 ADV,R6   5
          2 00076B  EF45 0007                            STR,R6   7,B5
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:224  

     1617    21629    3                      TEMP1$->KX$FRAME.ADR = KX$L2.ADR_RESP;

  21629   2 00076D  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00076F  E846 001E                            LDR,R6   30,B6
          2 000771  E570 00FF                            AND,R6   255,IMO
          2 000773  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 000775  E7C5 0008                            STH,R6   8,B5

     1618    21630    3                      IF KX$FRAME.ADR = KX$L2.ADR_RESP AND PF

  21630   2 000777  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000779  E2C5 0008                            LLH,R6   8,B5
          2 00077B  D846 001E                            LDR,R5   30,B6
          2 00077D  D570 00FF                            AND,R5   255,IMO
          2 00077F  E955                                 CMR,R6   R5
          2 000780  0981 000E                            BNE      s:21634,PREL
          2 000782  89C7 0030                            CMZ      PF,AUTO
          2 000784  0881 000A                            BAGE     s:21634,PREL

     1619    21631    3                         THEN
     1620    21632    3                            TEMP1$->KX$FRAME.CTL = %Y_CTL_FRMR_F#;

  21632   2 000786  C870 0097                            LDR,R4   151,IMO
          2 000788  CCC7 000E                            LDB,B4   TEMP1$,AUTO
          2 00078A  CAC4 0008                            SRM,R4,'00FF'X    8,B4
          2 00078C       00FF
          2 00078D  0F81 0008                            B        s:21635,PREL

     1621    21633    3                         ELSE
     1622    21634    3                            TEMP1$->KX$FRAME.CTL = %Y_CTL_FRMR#;

  21634   2 00078F  C870 0087                            LDR,R4   135,IMO
          2 000791  CCC7 000E                            LDB,B4   TEMP1$,AUTO
          2 000793  CAC4 0008                            SRM,R4,'00FF'X    8,B4
          2 000795       00FF

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:225  
     1623    21635    3                      IF KX$L2.FLG.EXTSEQ

  21635   2 000796  89C6 002F                            CMZ      47,B6
          2 000798  0881 0029                            BAGE     s:21647,PREL

     1624    21636    3                         THEN
     1625    21637    4                            DO;

     1626    21638    4                               IF KX$L2.STATE.LAST ~= %Y_ST_FRMR#

  21638   2 00079A  E846 001D                            LDR,R6   29,B6
          2 00079C  E570 00FF                            AND,R6   255,IMO
          2 00079E  6D07                                 CMV,R6   7
          2 00079F  0901 000E                            BE       s:21641,PREL

     1627    21639    4                                  THEN
     1628    21640    4                                     KX$L2.FRMR_CTL = KX$EXTFRAME.XCTL_REDEF;

  21640   2 0007A1  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0007A3  5C02                                 LDV,R5   2
          2 0007A4  0021                                 ALR      ;
          2 0007A5       C205 0008                                ALPHANUM(8,B5,1,2),;
          2 0007A7       4007 0038                                ALPHANUM(ADDRESS+4,AUTO,,R5,FILL)
          2 0007A9  437F                                 CSYNC    s:21640+7,SPREL
          2 0007AA  E847 0038                            LDR,R6   ADDRESS+4,AUTO
          2 0007AC  EF46 0038                            STR,R6   56,B6

     1629    21641    4                               TEMP1$->KX$EXTXFRAME.FRMR_CTL = KX$L2.FRMR_CTL;

  21641   2 0007AE  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007B0  E846 0038                            LDR,R6   56,B6
          2 0007B2  EF45 0009                            STR,R6   9,B5

     1630    21642    4                               TEMP1$->KX$EXTXFRAME.FRMR_NSNR = KX$L2.FRMR_NSNR;

  21642   2 0007B4  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007B6  E846 0053                            LDR,R6   83,B6
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:226  
          2 0007B8  EF45 000A                            STR,R6   10,B5

     1631    21643    4                               TEMP1$->KX$EXTXFRAME.FRMR_BITS = KX$L2.FRMR_BITS;

  21643   2 0007BA  E2C6 0039                            LLH,R6   57,B6
          2 0007BC  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007BE  E7C5 000B                            STH,R6   11,B5

     1632    21644    4                            END;

  21644   2 0007C0  0F81 0034                            B        s:21657,PREL

     1633    21645    3                         ELSE
     1634    21646    4                            DO;

     1635    21647    4                               IF KX$L2.STATE.LAST ~= %Y_ST_FRMR#

  21647   2 0007C2  E846 001D                            LDR,R6   29,B6
          2 0007C4  E570 00FF                            AND,R6   255,IMO
          2 0007C6  6D07                                 CMV,R6   7
          2 0007C7  0901 0009                            BE       s:21650,PREL

     1636    21648    4                                  THEN
     1637    21649    4                                     KX$L2.FRMR_CTL = KX$FRAME.CTL;

  21649   2 0007C9  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0007CB  D845 0008                            LDR,R5   8,B5
          2 0007CD  D570 00FF                            AND,R5   255,IMO
          2 0007CF  DF46 0038                            STR,R5   56,B6

     1638    21650    4                               TEMP1$->KX$XFRAME.FRMR_CTL = KX$L2.FRMR_CTL;

  21650   2 0007D1  D846 0038                            LDR,R5   56,B6
          2 0007D3  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007D5  D7C5 0009                            STH,R5   9,B5

     1639    21651    4                               TEMP1$->KX$XFRAME.FRMR_VARS.VS = KX$L2.VS;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:227  

  21651   2 0007D7  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007D9  E846 002C                            LDR,R6   44,B6
          2 0007DB  6005                                 SOL,R6   5
          2 0007DC  EAC5 0009                            SRM,R6,'00E0'X    9,B5
          2 0007DE       00E0

     1640    21652    4                               TEMP1$->KX$XFRAME.FRMR_VARS.VR = KX$L2.VR;

  21652   2 0007DF  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007E1  E846 002D                            LDR,R6   45,B6
          2 0007E3  6001                                 SOL,R6   1
          2 0007E4  EAC5 0009                            SRM,R6,'000E'X    9,B5
          2 0007E6       000E

     1641    21653    4                               TEMP1$->KX$XFRAME.FRMR_VARS.CR = KX$L2.FRMR_NSNR_REDEF.
             21653                                        CR;

  21653   2 0007E7  E846 0053                            LDR,R6   83,B6
          2 0007E9  6004                                 SOL,R6   4
          2 0007EA  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007EC  EAC5 0009                            SRM,R6,'0010'X    9,B5
          2 0007EE       0010

     1642    21654    4                               TEMP1$->KX$XFRAME.FRMR_BITS = KX$L2.FRMR_BITS;

  21654   2 0007EF  E2C6 0039                            LLH,R6   57,B6
          2 0007F1  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007F3  E7C5 000A                            STH,R6   10,B5

     1643    21655    4                            END;

     1644    21656
     1645    21657    3                      DAT$ = TEMP1$;

  21657   2 0007F5  DCC7 000E                            LDB,B5   TEMP1$,AUTO
          2 0007F7  DFC7 0008                            STB,B5   DAT$,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:228  

     1646    21658    3                      CALL KXN$CMND ( %KX_N_SUPV_Q#, CHN$->KH$CHN, DAT$ );

  21658   2 0007F9  CBF0 000B                            LAB,B4   11,IMO
          2 0007FB  BBC7 0008                            LAB,B3   DAT$,AUTO
          2 0007FD  BFC7 003C                            STB,B3   ADDRESS+8,AUTO
          2 0007FF  ACC7 000A                            LDB,B2   CHN$,AUTO
          2 000801  AFC7 003A                            STB,B2   ADDRESS+6,AUTO
          2 000803  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000805  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000807  CBF0 0300                            LAB,B4   768,IMO
          2 000809  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 00080C       0001                            DC       s:21662,PREL

     1647    21659
     1648    21660        /* Start the timer                                */
     1649    21661
     1650    21662    3                      CALL Y$START_TIMER;

  21662   2 00080D  E3C0 08EA                            LNJ,B6   s:0,PREL
          2 00080F       0001                            DC       s:21666,PREL

     1651    21663
     1652    21664        /* Reset the retry count                         */
     1653    21665
     1654    21666    3                      KX$L2.RC = 0;

  21666   2 000810  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000812  8846 0017                            LBF,'00FF'X       23,B6
          2 000814       00FF

     1655    21667
     1656    21668        /* Log the event                                 */
     1657    21669
     1658    21670                           %WRSYSLOG ( ERRCOD = SNDFRMR,
     1659    21671                           TRMID = "KX$L1.CHN$ -> KH$CHN.TERMID",
     1660    21672                           VAL0 = KX$L2.FRMR_CTL,
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:229  
     1661    21673                           VAL1 = KX$L2.FRMR_NSNR,
     1662    21674                           VAL2 = KX$L2.FRMR_BITS,
     1663    21675                           VAL3 = KX$L2.TRCX,
     1664    21676                           BFR = "KX$L2.TRC(0)");

  21692   2 000815  DCC6 0002                            LDB,B5   2,B6
          2 000817  CBC6 006F                            LAB,B4   111,B6
          2 000819  CFC7 0044                            STB,B4   ADDRESS+16,AUTO
          2 00081B  BBC6 0039                            LAB,B3   57,B6
          2 00081D  BFC7 0042                            STB,B3   ADDRESS+14,AUTO
          2 00081F  ABC6 0053                            LAB,B2   83,B6
          2 000821  AFC7 0040                            STB,B2   ADDRESS+12,AUTO
          2 000823  9BC6 0038                            LAB,B1   56,B6
          2 000825  9FC7 003E                            STB,B1   ADDRESS+10,AUTO
          2 000827  CBC6 0070                            LAB,B4   112,B6
          2 000829  CFC7 003C                            STB,B4   ADDRESS+8,AUTO
          2 00082B  EBC5 0012                            LAB,B6   18,B5
          2 00082D  EFC7 003A                            STB,B6   ADDRESS+6,AUTO
          2 00082F  DB80 0000 01A6  00                   LAB,B5   SNDFRMR
          2 000832  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000834  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000836  CBF0 0700                            LAB,B4   1792,IMO
          2 000838  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 00083B       0001                            DC       s:21694,PREL

     1665    21694    3                   END;

  21694   2 00083C  0F81 022D                            B        s:22133,PREL

     1666    21695
     1667    21696        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:230  
     1668    21697        /* %Y_ACT_FRMR_TO#  -  Time out occurred after a FRMR frame was sent,
     1669    21698                               and RC < N2. Start timer again and inc RC.
     1670    21699        */
     1671    21700
     1672    21701    2          CASE ( %Y_ACT_FRMR_TO# );

     1673    21702
     1674    21703    2             GOTO FRMR_TO_ENTRY;   /* in case ACT_SABM_PR#  */

  21703   2 00083E  0F81 012F                            B        s:21933,PREL

     1675    21704
     1676    21705        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:231  
     1677    21706
     1678    21707        /* %Y_ACT_LOG#  -  log the last state and event             */
     1679    21708
     1680    21709    2          CASE ( %Y_ACT_LOG# );

     1681    21710
     1682    21711        /* Log the last state and event                           */
     1683    21712
     1684    21713    2             ERCOD = LOG ;

  21713   2 000840  8C80 0000 019A  00                   LDI      LOG
          2 000843  8D47 0022                            SDI      ERCOD,AUTO

     1685    21714    2             CALL Y$ER2 ;

  21714   2 000845  E3C0 0788                            LNJ,B6   s:0,PREL
          2 000847       0001                            DC       s:21714+3,PREL
          2 000848  0F81 0221                            B        s:22133,PREL

     1686    21715
     1687    21716
     1688    21717        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:232  
     1689    21718
     1690    21719        /* %Y_ACT_NULL#  -  do nothing                              */
     1691    21720
     1692    21721    2          CASE ( %Y_ACT_NULL# );

     1693    21722
     1694    21723        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:233  
     1695    21724
     1696    21725        /* %Y_ACT_REJ#  -  the DCE has rejected an I - frame          */
     1697    21726        /* Set DCE_REJ                                            */
     1698    21727        /* Retransmit the desired frame and subsequent frames     */
     1699    21728        /* Reset the timer                                        */
     1700    21729        /* Log the action                                         */
     1701    21730
     1702    21731    2          CASE ( %Y_ACT_REJ# );

     1703    21732
     1704    21733        /* If this was a polled command,  respond                  */
     1705    21734
     1706    21735    2             IF KX$L2.FLG.POLL_R

  21735   2 00084A  82C6 002E                            LB,'0400'X        46,B6
  21735   2 00084C       0400
          2 00084D  0581 000F                            BBF      s:21742,PREL
          2 00084F  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000851  C2C5 0008                            LLH,R4   8,B5
          2 000853  E846 001E                            LDR,R6   30,B6
          2 000855  E570 00FF                            AND,R6   255,IMO
          2 000857  C956                                 CMR,R4   R6
          2 000858  0981 0004                            BNE      s:21742,PREL

     1707    21736    2                AND ( KX$FRAME.ADR = KX$L2.ADR_RESP )
     1708    21737    2                THEN           /*  Send a response  */
     1709    21738    2                   CALL Y$RESP;

  21738   2 00085A  E3C0 068D                            LNJ,B6   s:0,PREL
          2 00085C       0001                            DC       s:21742,PREL

     1710    21739
     1711    21740        /* Only do work if there are I frames pending             */
     1712    21741
     1713    21742    2             KX$L2.FLG.DCE_BUSY = '0'B;

  21742   2 00085D  ECC7 0006                            LDB,B6   CTX$,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:234  
          2 00085F  8846 002E                            LBF,'4000'X       46,B6
          2 000861       4000

     1714    21743    2             IF ( KX$L2.I_CNT ~= 0 )

  21743   2 000862  82C6 002F                            LB,'00FF'X        47,B6
  21743   2 000864       00FF
          2 000865  0581 0023                            BBF      s:21759,PREL

     1715    21744    2                THEN
     1716    21745    3                   DO;

     1717    21746
     1718    21747        /* Retransmission must wait for the transmitter to stop   */
     1719    21748
     1720    21749    3                      IF CHN$->KH$CHN.OTPCCBCNT > 0

  21749   2 000867  DCC7 000A                            LDB,B5   CHN$,AUTO
          2 000869  82C5 0007                            LB,'000F'X        7,B5
          2 00086B       000F
          2 00086C  0581 000F                            BBF      s:21752,PREL

     1721    21750    3                         THEN
     1722    21751    3                            CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );

  21751   2 00086E  CBF0 000C                            LAB,B4   12,IMO
          2 000870  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 000872  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000874  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000876  CBF0 0200                            LAB,B4   512,IMO
          2 000878  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 00087B       0001                            DC       s:21752,PREL

     1723    21752    3                      CALL Y$RETRAN;

  21752   2 00087C  E3C0 0620                            LNJ,B6   s:0,PREL
          2 00087E       0001                            DC       s:21753,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:235  

     1724    21753    3                      IF KX$L2.T1 ~= 0

  21753   2 00087F  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000881  82C6 0016                            LB,'00FF'X        22,B6
          2 000883       00FF
          2 000884  0581 0004                            BBF      s:21759,PREL

     1725    21754    3                         THEN
     1726    21755    3                            CALL Y$START_TIMER;

  21755   2 000886  E3C0 0871                            LNJ,B6   s:0,PREL
          2 000888       0001                            DC       s:21759,PREL

     1727    21756
     1728    21757    3                   END /* IF */;

     1729    21758
     1730    21759    2             KX$L2.REJ_CNT = KX$L2.REJ_CNT + 1;

  21759   2 000889  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00088B  8AC6 0057                            INC      87,B6

     1731    21760    2             KX_STATS_HDLC.F_REJECTS_IN = KX_STATS_HDLC.F_REJECTS_IN + 1;

  21760   2 00088D  8A80 0000 0027  xsym                 INC      KX_STATS_HDLC+39
          2 000890  8E80 0000 0026  xsym                 CAD      KX_STATS_HDLC+38
          2 000893  0F81 01D6                            B        s:22133,PREL

     1732    21761
     1733    21762        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:236  
     1734    21763
     1735    21764        /* %Y_ACT_RESET#  -  begin the level 2 link reset process   */
     1736    21765        /* Send a SABM                                            */
     1737    21766        /* Reset the timer                                        */
     1738    21767        /* Reset the retry count                                  */
     1739    21768        /* Log the action                                         */
     1740    21769
     1741    21770    2          CASE ( %Y_ACT_RESET# );

     1742    21771        /*
     1743    21772           If we are DCE and was in RESET state, do not generate additional
     1744    21773           SABMs for FRMRs received.
     1745    21774        */
     1746    21775    2             IF ( KX$L2.FLG.DCE AND KX$L2.STATE.LAST = %Y_ST_RESET#

  21775   2 000895  82C6 002E                            LB,'1000'X        46,B6
  21775   2 000897       1000
          2 000898  0581 000F                            BBF      s:21781,PREL
          2 00089A  C846 001D                            LDR,R4   29,B6
          2 00089C  C570 00FF                            AND,R4   255,IMO
          2 00089E  4D05                                 CMV,R4   5
          2 00089F  0981 0008                            BNE      s:21781,PREL
          2 0008A1  E847 0024                            LDR,R6   FEVENT,AUTO
          2 0008A3  6D14                                 CMV,R6   20
          2 0008A4  0981 0003                            BNE      s:21781,PREL

     1747    21776    2                AND FEVENT = %Y_EV_FRMR# )
     1748    21777    3                THEN DO;

     1749    21778    3                   END;

  21778   2 0008A6  0F81 01C3                            B        s:22133,PREL

     1750    21779    3                ELSE DO;

     1751    21780
     1752    21781    3                      IF CHN$->KH$CHN.OTPCCBCNT > 0
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:237  

  21781   2 0008A8  DCC7 000A                            LDB,B5   CHN$,AUTO
          2 0008AA  82C5 0007                            LB,'000F'X        7,B5
          2 0008AC       000F
          2 0008AD  0581 000F                            BBF      s:21784,PREL

     1753    21782    3                         THEN
     1754    21783    3                            CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );

  21783   2 0008AF  CBF0 000C                            LAB,B4   12,IMO
          2 0008B1  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 0008B3  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 0008B5  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0008B7  CBF0 0200                            LAB,B4   512,IMO
          2 0008B9  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 0008BC       0001                            DC       s:21784,PREL

     1755    21784    3                      CALL Y$CLR_SUP_Q;

  21784   2 0008BD  E3C0 08DA                            LNJ,B6   s:0,PREL
          2 0008BF       0001                            DC       s:21787,PREL

     1756    21785        /* Send a SABM or a SABME                                 */
     1757    21786
     1758    21787    3                      CTL = %Y_CTL_SABM# + BITBIN(KX$L2.FLG.EXTSEQ)*BITBIN('40'X);

  21787   2 0008C0  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0008C2  E846 002F                            LDR,R6   47,B6
          2 0008C4  604F                                 SOR,R6   15
          2 0008C5  6006                                 SOL,R6   6
          2 0008C6  6E2F                                 ADV,R6   47
          2 0008C7  EF47 002A                            STR,R6   CTL,AUTO

     1759    21788    3                      CALL Y$SEND_COMMAND;

  21788   2 0008C9  E3C0 063F                            LNJ,B6   s:0,PREL
          2 0008CB       0001                            DC       s:21792,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:238  

     1760    21789
     1761    21790        /* Reset the timer                                        */
     1762    21791
     1763    21792    3                      IF KX$L2.T1 ~= 0

  21792   2 0008CC  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0008CE  82C6 0016                            LB,'00FF'X        22,B6
          2 0008D0       00FF
          2 0008D1  0581 0004                            BBF      s:21800,PREL

     1764    21793    3                         THEN
     1765    21794    4                            DO;

     1766    21795    4                               CALL Y$START_TIMER;

  21795   2 0008D3  E3C0 0824                            LNJ,B6   s:0,PREL
          2 0008D5       0001                            DC       s:21800,PREL

     1767    21796    4                            END;

     1768    21797
     1769    21798        /* Reset the retry count                                  */
     1770    21799
     1771    21800    3                      KX$L2.RC = 0;

  21800   2 0008D6  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0008D8  8846 0017                            LBF,'00FF'X       23,B6
          2 0008DA       00FF

     1772    21801
     1773    21802        /* Log the action                                         */
     1774    21803
     1775    21804    3                      ERCOD = RESET ;

  21804   2 0008DB  8C80 0000 019C  00                   LDI      RESET
          2 0008DE  8D47 0022                            SDI      ERCOD,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:239  

     1776    21805    3                      CALL Y$ER2 ;

  21805   2 0008E0  E3C0 06ED                            LNJ,B6   s:0,PREL
          2 0008E2       0001                            DC       s:21810,PREL

     1777    21806
     1778    21807
     1779    21808        /* Stats                                                  */
     1780    21809
     1781    21810    3                      GOTO L_6 ;

  21810   2 0008E3  0F81 00C0                            B        s:21976,PREL

     1782    21811    3                   END;
     1783    21812
     1784    21813        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:240  
     1785    21814
     1786    21815        /* %Y_ACT_RESP#  -  send a response to free up the DCE's window                 */
     1787    21816        /* Send RR or RNR with final bit set if received a poll bit                   */
     1788    21817        /* Set the DCE_BUSY flag accordingly                      */
     1789    21818
     1790    21819    2          CASE ( %Y_ACT_RESP# );

     1791    21820
     1792    21821        /* Set DCE_BUSY accordingly                               */
     1793    21822
     1794    21823
     1795    21824        /* Distinguish RR from RNR                                    */
     1796    21825
     1797    21826    2             IF NOT ( BINBIT( KX$FRAME.CTL, 8 ) & '00000100'B )

  21826   2 0008E5  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 0008E7  C845 0008                            LDR,R4   8,B5
          2 0008E9  C570 00FF                            AND,R4   255,IMO
          2 0008EB  4008                                 SOL,R4   8
          2 0008EC  C570 0400                            AND,R4   1024,IMO
          2 0008EE  4981 0006                            BNEZ,R4  s:21830,PREL

     1798    21827    2                THEN           /*  Not busy  */
     1799    21828    2                   KX$L2.FLG.DCE_BUSY = '0'B;

  21828   2 0008F0  8846 002E                            LBF,'4000'X       46,B6
  21828   2 0008F2       4000
          2 0008F3  0F81 0004                            B        s:21834,PREL

     1800    21829    2                ELSE           /*  Busy  */
     1801    21830    2                   KX$L2.FLG.DCE_BUSY = '1'B;

  21830   2 0008F5  8946 002E                            LBT,'4000'X       46,B6
  21830   2 0008F7       4000

     1802    21831
     1803    21832        /* Was the poll bit set                                   */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:241  
     1804    21833
     1805    21834    2             IF KX$L2.FLG.POLL_R

  21834   2 0008F8  82C6 002E                            LB,'0400'X        46,B6
  21834   2 0008FA       0400
          2 0008FB  0581 016E                            BBF      s:22133,PREL

     1806    21835    2                THEN           /*  Yes, send a response  */
     1807    21836    2                   CALL Y$RESP;

  21836   2 0008FD  E3C0 05EA                            LNJ,B6   s:0,PREL
          2 0008FF       0001                            DC       s:21836+3,PREL
          2 000900  0F81 0169                            B        s:22133,PREL

     1808    21837
     1809    21838        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:242  
     1810    21839
     1811    21840        /* %Y_ACT_RR_P#  -  send a polled RR to start timer recovery*/
     1812    21841        /* Send the polled RR                                     */
     1813    21842        /* Reset the timer                                        */
     1814    21843        /* Reset the retry count                                  */
     1815    21844
     1816    21845    2          CASE ( %Y_ACT_RR_P# );

     1817    21846
     1818    21847        /* Send the polled RR                                     */
     1819    21848
     1820    21849    2             CTL = %Y_CTL_RR_P#;

  21849   2 000902  4C11                                 LDV,R4   17
          2 000903  CF47 002A                            STR,R4   CTL,AUTO

     1821    21850    2             GOTO L_4 ;

  21850   2 000905  0F81 0030                            B        s:21897,PREL

     1822    21851
     1823    21852        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:243  
     1824    21853
     1825    21854        /* %Y_ACT_RR_PR#  -  send additional polled RRs from timer recovery             */
     1826    21855        /* Send the polled RR                                     */
     1827    21856        /* Start the timer                                        */
     1828    21857        /* Increment the retry count                              */
     1829    21858
     1830    21859    2          CASE ( %Y_ACT_RR_PR# );

     1831    21860
     1832    21861        /* Send the polled RR                                     */
     1833    21862
     1834    21863    2             CTL = %Y_CTL_RR_P#;

  21863   2 000907  4C11                                 LDV,R4   17
          2 000908  CF47 002A                            STR,R4   CTL,AUTO

     1835    21864    2             GOTO L_5 ;

  21864   2 00090A  0F81 0060                            B        s:21928,PREL

     1836    21865
     1837    21866        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:244  
     1838    21867
     1839    21868        /* %Y_ACT_SABM#  -  send a SABM to start the level 2 link setup                 */
     1840    21869        /* Send the SABM                                          */
     1841    21870        /* Reset the timer                                        */
     1842    21871        /* Reset the retry count                                  */
     1843    21872
     1844    21873    2          CASE ( %Y_ACT_SABM# );

     1845    21874
     1846    21875        /* Send the SABM or SABME                                 */
     1847    21876
     1848    21877    2             CTL = %Y_CTL_SABM# + BITBIN(KX$L2.FLG.EXTSEQ)*BITBIN('40'X);

  21877   2 00090C  C846 002F                            LDR,R4   47,B6
          2 00090E  404F                                 SOR,R4   15
          2 00090F  4006                                 SOL,R4   6
          2 000910  4E2F                                 ADV,R4   47
          2 000911  CF47 002A                            STR,R4   CTL,AUTO

     1849    21878    2             GOTO L_4 ;

  21878   2 000913  0F81 0022                            B        s:21897,PREL

     1850    21879
     1851    21880        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:245  
     1852    21881
     1853    21882        /* %Y_ACT_SABM_P#  -  send a polled SABM to continue the link setup             */
     1854    21883        /* Send a polled SABM or SABME                            */
     1855    21884        /* Start the timer                                        */
     1856    21885        /* Reset the retry count                                  */
     1857    21886
     1858    21887    2          CASE ( %Y_ACT_SABM_P# );

     1859    21888
     1860    21889        /* Send the polled SABM                                   */
     1861    21890
     1862    21891    2             IF CHN$->KH$CHN.OTPCCBCNT > 0

  21891   2 000915  DCC7 000A                            LDB,B5   CHN$,AUTO
          2 000917  82C5 0007                            LB,'000F'X        7,B5
          2 000919       000F
          2 00091A  0581 000F                            BBF      s:21894,PREL

     1863    21892    2                THEN
     1864    21893    2                   CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );

  21893   2 00091C  CBF0 000C                            LAB,B4   12,IMO
          2 00091E  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 000920  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000922  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000924  CBF0 0200                            LAB,B4   512,IMO
          2 000926  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 000929       0001                            DC       s:21894,PREL

     1865    21894    2             CALL Y$CLR_SUP_Q;

  21894   2 00092A  E3C0 086D                            LNJ,B6   s:0,PREL
          2 00092C       0001                            DC       s:21895,PREL

     1866    21895    2             CTL = %Y_CTL_SABM_P# + BITBIN(KX$L2.FLG.EXTSEQ)*BITBIN('40'X);

  21895   2 00092D  ECC7 0006                            LDB,B6   CTX$,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:246  
          2 00092F  E846 002F                            LDR,R6   47,B6
          2 000931  604F                                 SOR,R6   15
          2 000932  6006                                 SOL,R6   6
          2 000933  6E3F                                 ADV,R6   63
          2 000934  EF47 002A                            STR,R6   CTL,AUTO

     1867    21896    2   L_4:
     1868    21897    2             CALL Y$SEND_COMMAND;

  21897   2 000936  E3C0 05D2            L_4             LNJ,B6   s:0,PREL
          2 000938       0001                            DC       s:21901,PREL

     1869    21898
     1870    21899        /* Start the timer                                        */
     1871    21900
     1872    21901    2             IF KX$L2.T1 ~= 0

  21901   2 000939  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00093B  82C6 0016                            LB,'00FF'X        22,B6
          2 00093D       00FF
          2 00093E  0581 0004                            BBF      s:21909,PREL

     1873    21902    2                THEN
     1874    21903    3                   DO;

     1875    21904    3                      CALL Y$START_TIMER;

  21904   2 000940  E3C0 07B7                            LNJ,B6   s:0,PREL
          2 000942       0001                            DC       s:21909,PREL

     1876    21905    3                   END;

     1877    21906
     1878    21907        /* Reset the retry count                                  */
     1879    21908
     1880    21909    2             KX$L2.RC = 0;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:247  
  21909   2 000943  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000945  8846 0017                            LBF,'00FF'X       23,B6
          2 000947       00FF
          2 000948  0F81 0121                            B        s:22133,PREL

     1881    21910
     1882    21911        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:248  
     1883    21912
     1884    21913        /* %Y_ACT_SABM_PR#  -  send another polled SABM for link setup                  */
     1885    21914        /* Send the polled SABM                                   */
     1886    21915        /* Start the timer                                        */
     1887    21916        /* Increment the retry count                              */
     1888    21917
     1889    21918    2          CASE(%Y_ACT_SABM_PR# , %Y_ACT_RESET_P# ) ;

     1890    21919
     1891    21920        /* Send the polled SABM or SABME                          */
     1892    21921
     1893    21922    2             IF CHN$->KH$CHN.OTPCCBCNT > 0

  21922   2 00094A  DCC7 000A                            LDB,B5   CHN$,AUTO
          2 00094C  82C5 0007                            LB,'000F'X        7,B5
          2 00094E       000F
          2 00094F  0581 000F                            BBF      s:21925,PREL

     1894    21923    2                THEN
     1895    21924    2                   CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );

  21924   2 000951  CBF0 000C                            LAB,B4   12,IMO
          2 000953  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 000955  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000957  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000959  CBF0 0200                            LAB,B4   512,IMO
          2 00095B  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 00095E       0001                            DC       s:21925,PREL

     1896    21925    2             CALL Y$CLR_SUP_Q;

  21925   2 00095F  E3C0 0838                            LNJ,B6   s:0,PREL
          2 000961       0001                            DC       s:21926,PREL

     1897    21926    2             CTL = %Y_CTL_SABM_P# + BITBIN(KX$L2.FLG.EXTSEQ)*BITBIN('40'X);

  21926   2 000962  ECC7 0006                            LDB,B6   CTX$,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:249  
          2 000964  E846 002F                            LDR,R6   47,B6
          2 000966  604F                                 SOR,R6   15
          2 000967  6006                                 SOL,R6   6
          2 000968  6E3F                                 ADV,R6   63
          2 000969  EF47 002A                            STR,R6   CTL,AUTO

     1898    21927    2   L_5:
     1899    21928    2             CALL Y$SEND_COMMAND;

  21928   2 00096B  E3C0 059D            L_5             LNJ,B6   s:0,PREL
          2 00096D       0001                            DC       s:21933,PREL

     1900    21929
     1901    21930        /* Start the timer                                        */
     1902    21931
     1903    21932    2   FRMR_TO_ENTRY:
     1904    21933    2             IF KX$L2.T1 ~= 0

  21933   2 00096E  ECC7 0006            FRMR_TO_ENTRY   LDB,B6   CTX$,AUTO
          2 000970  82C6 0016                            LB,'00FF'X        22,B6
          2 000972       00FF
          2 000973  0581 0004                            BBF      s:21941,PREL

     1905    21934    2                THEN
     1906    21935    3                   DO;

     1907    21936    3                      CALL Y$START_TIMER;

  21936   2 000975  E3C0 0782                            LNJ,B6   s:0,PREL
          2 000977       0001                            DC       s:21941,PREL

     1908    21937    3                   END;

     1909    21938
     1910    21939        /* Increment the retry count                              */
     1911    21940
     1912    21941    2             KX$L2.RC = KX$L2.RC + 1;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:250  

  21941   2 000978  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00097A  E846 0017                            LDR,R6   23,B6
          2 00097C  EA70 0001                            ADD,R6   1,IMO
          2 00097E  EAC6 0017                            SRM,R6,'00FF'X    23,B6
          2 000980       00FF
          2 000981  0F81 00E8                            B        s:22133,PREL

     1913    21942
     1914    21943        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:251  
     1915    21944
     1916    21945        /* %Y_ACT_SABM_U#  -  send SABM and UA on link reset        */
     1917    21946        /* Clear the output queue                                 */
     1918    21947        /* Send the SABM                                          */
     1919    21948        /* Send the UA                                            */
     1920    21949        /* Reset the timer                                        */
     1921    21950        /* Reset the retry count                                  */
     1922    21951
     1923    21952    2          CASE ( %Y_ACT_SABM_U# );

     1924    21953
     1925    21954        /* Clear the output queue                                 */
     1926    21955
     1927    21956    2             IF CHN$->KH$CHN.OTPCCBCNT > 0

  21956   2 000983  DCC7 000A                            LDB,B5   CHN$,AUTO
          2 000985  82C5 0007                            LB,'000F'X        7,B5
          2 000987       000F
          2 000988  0581 000F                            BBF      s:21959,PREL

     1928    21957    2                THEN
     1929    21958    2                   CALL KXN$CMND ( %KX_N_ABR#, CHN$->KH$CHN );

  21958   2 00098A  CBF0 000C                            LAB,B4   12,IMO
          2 00098C  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 00098E  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000990  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000992  CBF0 0200                            LAB,B4   512,IMO
          2 000994  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 000997       0001                            DC       s:21959,PREL

     1930    21959    2             CALL Y$CLR_SUP_Q;

  21959   2 000998  E3C0 07FF                            LNJ,B6   s:0,PREL
          2 00099A       0001                            DC       s:21963,PREL

     1931    21960
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:252  
     1932    21961        /* Send the UA                                            */
     1933    21962
     1934    21963    2             CALL Y$UA;

  21963   2 00099B  E3C0 0539                            LNJ,B6   s:0,PREL
          2 00099D       0001                            DC       s:21967,PREL

     1935    21964
     1936    21965        /* Stop the timer                                         */
     1937    21966
     1938    21967    2             CALL Y$STOP_TIMER;

  21967   2 00099E  E3C0 06AD                            LNJ,B6   s:0,PREL
          2 0009A0       0001                            DC       s:21971,PREL

     1939    21968
     1940    21969        /* Reset the context and retransmit (like in action CL_RESET#)  */
     1941    21970
     1942    21971    2             CALL Y$RESET_RETRAN;

  21971   2 0009A1  E3C0 0435                            LNJ,B6   s:0,PREL
          2 0009A3       0001                            DC       s:21976,PREL

     1943    21972
     1944    21973        /* Stats                                                  */
     1945    21974
     1946    21975    2   L_6:
     1947    21976    2             KX_STATS_HDLC.RESETS = KX_STATS_HDLC.RESETS + 1;

  21976   2 0009A4  8A80 0000 0025  xsym L_6             INC      KX_STATS_HDLC+37
          2 0009A7  8E80 0000 0024  xsym                 CAD      KX_STATS_HDLC+36
          2 0009AA  0F81 00BF                            B        s:22133,PREL

     1948    21977
     1949    21978        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:253  
     1950    21979
     1951    21980        /* %Y_ACT_SCREECH  -  screech#,  there is some internal problem                  */
     1952    21981        /* Screech                                                */
     1953    21982
     1954    21983    2          CASE ( %Y_ACT_SCREECH# );

     1955    21984
     1956    21985        /*S* SCREECH_CODE: KXF-S$KX_FRM_ACTSCR#                        */
     1957    21986        /*S* MESSAGE: KXF internal transition error               */
     1958    21987        /*S* DESCRIPTION: The state / transition table specifies that the               */
     1959    21988        /*S* event just received is supposedly impossible         */
     1960    21989        /*S* to receive when in this state.                       */
     1961    21990
     1962    21991    2             CALL KHD$SCREECH ( Y_ACTSCR );

  21991   2 0009AC  BB80 0000 0005  03                   LAB,B3   +5
          2 0009AF  CBF0 0100                            LAB,B4   256,IMO
          2 0009B1  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 0009B4       0001                            DC       s:21991+9,PREL
          2 0009B5  0F81 00B4                            B        s:22133,PREL

     1963    21992
     1964    21993        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:254  
     1965    21994
     1966    21995        /* %Y_ACT_START#  -  the MLCP has heard DSR and CTS         */
     1967    21996        /* Start the MLCP                                         */
     1968    21997        /* Send a DISC                                            */
     1969    21998        /* Start the timer                                        */
     1970    21999        /* Log the action                                         */
     1971    22000
     1972    22001    2          CASE ( %Y_ACT_START# );

     1973    22002
     1974    22003        /* Start the MLCP  (  listening )                             */
     1975    22004
     1976    22005    2             CALL KXN$CMND ( %KX_N_START_RCV#, CHN$->KH$CHN, DAT$ );

  22005   2 0009B7  DBF0 0003                            LAB,B5   3,IMO
          2 0009B9  CBC7 0008                            LAB,B4   DAT$,AUTO
          2 0009BB  CFC7 003C                            STB,B4   ADDRESS+8,AUTO
          2 0009BD  BCC7 000A                            LDB,B3   CHN$,AUTO
          2 0009BF  BFC7 003A                            STB,B3   ADDRESS+6,AUTO
          2 0009C1  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 0009C3  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0009C5  CBF0 0300                            LAB,B4   768,IMO
          2 0009C7  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 0009CA       0001                            DC       s:22009,PREL

     1977    22006
     1978    22007        /* Send a DISC                                            */
     1979    22008
     1980    22009    2             CTL = %Y_CTL_DISC#;

  22009   2 0009CB  6C43                                 LDV,R6   67
          2 0009CC  EF47 002A                            STR,R6   CTL,AUTO

     1981    22010    2             CALL Y$SEND_COMMAND;

  22010   2 0009CE  E3C0 053A                            LNJ,B6   s:0,PREL
          2 0009D0       0001                            DC       s:22014,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:255  

     1982    22011
     1983    22012        /* Start the timer                                        */
     1984    22013
     1985    22014    2             IF KX$L2.T1 ~= 0

  22014   2 0009D1  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0009D3  82C6 0016                            LB,'00FF'X        22,B6
          2 0009D5       00FF
          2 0009D6  0581 0004                            BBF      s:22022,PREL

     1986    22015    2                THEN
     1987    22016    3                   DO;

     1988    22017    3                      CALL Y$START_TIMER;

  22017   2 0009D8  E3C0 071F                            LNJ,B6   s:0,PREL
          2 0009DA       0001                            DC       s:22022,PREL

     1989    22018    3                   END;

     1990    22019
     1991    22020        /* Log the action                                         */
     1992    22021
     1993    22022    2             ERCOD = START ;

  22022   2 0009DB  8C80 0000 01A0  00                   LDI      START
          2 0009DE  8D47 0022                            SDI      ERCOD,AUTO

     1994    22023    2   L_3:
     1995    22024    2             CALL Y$ER ;

  22024   2 0009E0  E3C0 05CE            L_3             LNJ,B6   s:0,PREL
          2 0009E2       0001                            DC       s:22024+3,PREL
          2 0009E3  0F81 0086                            B        s:22133,PREL

     1996    22025
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:256  
     1997    22026
     1998    22027        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:257  
     1999    22028
     2000    22029        /* %Y_ACT_STOP#  -  stop the MLCP NOW!!!                    */
     2001    22030        /* Stop the MLCP                                          */
     2002    22031        /* Stop the TIMER                                         */
     2003    22032        /* Report DIED to all the level 3s                        */
     2004    22033        /* Release the context and any buffers                    */
     2005    22034        /* If the line is not marked for disable,  restart it      */
     2006    22035
     2007    22036    2          CASE ( %Y_ACT_STOP# );

     2008    22037
     2009    22038        /* Stop the MLCP                                          */
     2010    22039
     2011    22040    2   STOP_ENTRY:
     2012    22041
     2013    22042    2             CALL KXN$CMND ( %KX_N_STOP#, CHN$->KH$CHN );

  22042   2 0009E5  EBF0 0005            STOP_ENTRY      LAB,B6   5,IMO
          2 0009E7  DCC7 000A                            LDB,B5   CHN$,AUTO
          2 0009E9  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 0009EB  EFC7 0038                            STB,B6   ADDRESS+4,AUTO
          2 0009ED  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0009EF  CBF0 0200                            LAB,B4   512,IMO
          2 0009F1  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 0009F4       0001                            DC       s:22043,PREL

     2014    22043    2             CALL Y$STOP_TIMER;

  22043   2 0009F5  E3C0 0656                            LNJ,B6   s:0,PREL
          2 0009F7       0001                            DC       s:22044,PREL

     2015    22044    2             CALL Y$STOP_T20;

  22044   2 0009F8  E3C0 0685                            LNJ,B6   s:0,PREL
          2 0009FA       0001                            DC       s:22048,PREL

     2016    22045
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:258  
     2017    22046        /* Report DIED to all the level 3s                        */
     2018    22047
     2019    22048    2             CALL Y$DIED;

  22048   2 0009FB  E3C0 0585                            LNJ,B6   s:0,PREL
          2 0009FD       0001                            DC       s:22052,PREL

     2020    22049
     2021    22050        /* Stats                                                  */
     2022    22051
     2023    22052    2             IF ( KX$L2.STATE.CURRENT >= %Y_ST_NORMAL# )

  22052   2 0009FE  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000A00  E2C6 001D                            LLH,R6   29,B6
          2 000A02  6D04                                 CMV,R6   4
          2 000A03  0201 0010                            BL       s:22065,PREL

     2024    22053    2                THEN
     2025    22054    3                   DO;

     2026    22055    3                      KX_STATS_HDLC.DISCONNECTS = KX_STATS_HDLC.DISCONNECTS + 1;

  22055   2 000A05  8A80 0000 0019  xsym                 INC      KX_STATS_HDLC+25
          2 000A08  8E80 0000 0018  xsym                 CAD      KX_STATS_HDLC+24

     2027    22056    3                      KX_STATS_HDLC.LINES = KX_STATS_HDLC.LINES - 1;

  22056   2 000A0B  8C80 0000 0014  xsym                 LDI      KX_STATS_HDLC+20
          2 000A0E  8470 FFFF FFFF                       AID      -1,IMO
          2 000A11  8D00 0000 0014  xsym                 SDI      KX_STATS_HDLC+20

     2028    22057    3                   END /* IF */;

     2029    22058        /*
     2030    22059                                             Release the context, which calls
     2031    22060                                             handler common with a disconnect.
     2032    22061                                             If a test connect says that it is
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:259  
     2033    22062                                             ok to continue, start the MLCP
     2034    22063                                             searching for DSR and CTS.
     2035    22064        */
     2036    22065    2             IF KX$L2.TERMACKPND

  22065   2 000A14  82C6 0067                            LB,'0020'X        103,B6
  22065   2 000A16       0020
          2 000A17  0581 0006                            BBF      s:22069,PREL

     2037    22066    2                THEN
     2038    22067    2                   KX$L2.RLS_TERMACKPND = '1'B;

  22067   2 000A19  8946 0067                            LBT,'0010'X       103,B6
  22067   2 000A1B       0010
          2 000A1C  0F81 000D                            B        s:22070,PREL

     2039    22068    2                ELSE
     2040    22069    2                   CALL KXS$RLSCNTX ( CTX$ );

  22069   2 000A1E  DBC7 0006                            LAB,B5   CTX$,AUTO
          2 000A20  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000A22  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000A24  CBF0 0100                            LAB,B4   256,IMO
          2 000A26  E380 0000 0000  xent                 LNJ,B6   KXS$RLSCNTX
          2 000A29       0001                            DC       s:22070,PREL

     2041    22070    2             IF FPT_X25.EVN ~= %KX_F_EV_ERRLOGKLL# THEN

  22070   2 000A2A  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          2 000A2C  E806                                 LDR,R6   ,B6
          2 000A2D  6D12                                 CMV,R6   18
          2 000A2E  0901 001D                            BE       s:22083,PREL

     2042    22071        /*  If we were killed because of errlog limit, don't try to
     2043    22072            restart the line. When the h/w problem is fixed, the line
     2044    22073            can be restarted by killing and enabling.
     2045    22074        */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:260  
     2046    22075    2                   CALL KHA$TSTCNC ( CHN$ )

  22075   2 000A30  DBC7 000A                            LAB,B5   CHN$,AUTO
          2 000A32  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000A34  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000A36  CBF0 0100                            LAB,B4   256,IMO
          2 000A38  E380 0000 0000  xent                 LNJ,B6   KHA$TSTCNC
          2 000A3B       0011                            DC       s:22083,PREL

     2047    22076    2                      WHENRETURN
     2048    22077    3                         DO;

     2049    22078    3                            CALL KXN$CMND ( %KX_N_START_TRN#, CHN$->KH$CHN );

  22078   2 000A3C  EBF0 0004                            LAB,B6   4,IMO
          2 000A3E  DCC7 000A                            LDB,B5   CHN$,AUTO
          2 000A40  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 000A42  EFC7 0038                            STB,B6   ADDRESS+4,AUTO
          2 000A44  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000A46  CBF0 0200                            LAB,B4   512,IMO
          2 000A48  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 000A4B       0001                            DC       s:22083,PREL

     2050    22079    3                         END;

     2051    22080
     2052    22081        /* Return NOW since the context is gone or changed        */
     2053    22082
     2054    22083    2             RETURN;

  22083   2 000A4C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2055    22084
     2056    22085        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:261  
     2057    22086
     2058    22087        /* %Y_ACT_UA#  -  just send a UA or UA_F                    */
     2059    22088        /* Send the UA                                            */
     2060    22089
     2061    22090    2          CASE ( %Y_ACT_UA# );

     2062    22091
     2063    22092        /* Send the UA                                            */
     2064    22093
     2065    22094    2             CALL Y$UA;

  22094   2 000A4F  E3C0 0485                            LNJ,B6   s:0,PREL
          2 000A51       0001                            DC       s:22094+3,PREL
          2 000A52  0F81 0017                            B        s:22133,PREL

     2066    22095
     2067    22096        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:262  
     2068    22097
     2069    22098        /* %Y_ACT_UP#  -  link setup was successful                 */
     2070    22099        /* Stop the timer                                         */
     2071    22100        /* Kludge by setting the OK flag                          */
     2072    22101        /* Tell the level 3 handler to do its initialization stuff*/
     2073    22102        /* Log the action                                         */
     2074    22103
     2075    22104    2          CASE ( %Y_ACT_UP# );

     2076    22105
     2077    22106    2             CALL Y$UP;

  22106   2 000A54  E3C0 05A4                            LNJ,B6   s:0,PREL
          2 000A56       0001                            DC       s:22106+3,PREL
          2 000A57  0F81 0012                            B        s:22133,PREL

     2078    22107        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:263  
     2079    22108        /* %Y_ACT_UP_UA#  -  We were SABM'd while in state DISC/DISC_TO.
     2080    22109                             call Y$UA and Y$UP.
     2081    22110        */
     2082    22111    2          CASE ( %Y_ACT_UP_UA# );

     2083    22112
     2084    22113    2             CALL Y$UA;

  22113   2 000A59  E3C0 047B                            LNJ,B6   s:0,PREL
          2 000A5B       0001                            DC       s:22114,PREL

     2085    22114    2             CALL Y$UP;

  22114   2 000A5C  E3C0 059C                            LNJ,B6   s:0,PREL
          2 000A5E       0001                            DC       s:22114+3,PREL
          2 000A5F  0F81 000A                            B        s:22133,PREL

     2086    22115        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:264  
     2087    22116
     2088    22117        /* Any other actions  -  something is very wrong,  so screech*/
     2089    22118
     2090    22119    2          CASE ( ELSE );

     2091    22120
     2092    22121        /*S* SCREECH_CODE: KXF-S$KX_FRM_UNKACT#                        */
     2093    22122        /*S* MESSAGE: Unknown action type                         */
     2094    22123        /*S* DESCRIPTION: Either the action tables are clobbered,  or an               */
     2095    22124        /*S* action was added without adding the code to          */
     2096    22125        /*S* handle it.                                           */
     2097    22126
     2098    22127    2             CALL KHD$SCREECH ( Y_UNKACT );

  22127   2 000A61  BB80 0000 0007  03                   LAB,B3   +7
          2 000A64  CBF0 0100                            LAB,B4   256,IMO
          2 000A66  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000A69       0001                            DC       s:22133,PREL

     2099    22128
     2100    22129    2       END /* CASE */;

     2101    22130
     2102    22131        /* Are we in normal state                                 */
     2103    22132
     2104    22133    1       IF ( KX$L2.STATE.CURRENT = %Y_ST_NORMAL# )

  22133   2 000A6A  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000A6C  E2C6 001D                            LLH,R6   29,B6
          2 000A6E  6D04                                 CMV,R6   4
          2 000A6F  0981 0013                            BNE      s:22145,PREL
          2 000A71  82C6 002E                            LB,'4000'X        46,B6
          2 000A73       4000
          2 000A74  0501 000E                            BBT      s:22145,PREL

     2105    22134    1          AND NOT KX$L2.FLG.DCE_BUSY
     2106    22135    1          THEN                 /*  Normal, set the bit  */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:265  
     2107    22136    2             DO;

     2108    22137    2                IF NOT KX$L2.FLG.OK

  22137   2 000A76  82C6 002E                            LB,'0800'X        46,B6
  22137   2 000A78       0800
          2 000A79  0501 000C                            BBT      s:22149,PREL

     2109    22138    2                   THEN
     2110    22139    3                      DO;

     2111    22140    3                         KX$L2.FLG.DATAVL = '1'B;

  22140   2 000A7B  8946 002E                            LBT,'0002'X       46,B6
  22140   2 000A7D       0002

     2112    22141    3                         KX$L2.FLG.OK = '1'B;

  22141   2 000A7E  8946 002E                            LBT,'0800'X       46,B6
  22141   2 000A80       0800

     2113    22142    3                      END;

     2114    22143    2             END;

  22143   2 000A81  0F81 0004                            B        s:22149,PREL

     2115    22144    1          ELSE                 /*  Non-normal, reset the bit  */
     2116    22145    1             KX$L2.FLG.OK = '0'B;

  22145   2 000A83  8846 002E                            LBF,'0800'X       46,B6
  22145   2 000A85       0800

     2117    22146
     2118    22147        /* Does the current state send polled frames?             */
     2119    22148
     2120    22149    1       TEMP3 = KX$L2.STATE.CURRENT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:266  

  22149   2 000A86  EF47 002E                            STR,R6   TEMP3,AUTO

     2121    22150    1       IF ( TEMP3 = %Y_ST_SETUP_TO# )

  22150   2 000A88  6D03                                 CMV,R6   3
          2 000A89  0901 000F                            BE       s:22155,PREL
          2 000A8B  6D06                                 CMV,R6   6
          2 000A8C  0901 000C                            BE       s:22155,PREL
          2 000A8E  6D08                                 CMV,R6   8
          2 000A8F  0901 0009                            BE       s:22155,PREL
          2 000A91  6D01                                 CMV,R6   1
          2 000A92  0981 000B                            BNE      s:22160,PREL
          2 000A94  D847 002A                            LDR,R5   CTL,AUTO
          2 000A96  5D53                                 CMV,R5   83
          2 000A97  0981 0006                            BNE      s:22160,PREL

     2122    22151    1          OR ( TEMP3 = %Y_ST_RESET_TO# )
     2123    22152    1          OR ( TEMP3 = %Y_ST_TIMER_REC# )
     2124    22153    1          OR ( TEMP3 = %Y_ST_DISC# AND CTL = %Y_CTL_DISC_P# )
     2125    22154    1          THEN                 /*  Yes, set the flag  */
     2126    22155    1             KX$L2.FLG.POLL_S = '1'B;

  22155   2 000A99  8946 002E                            LBT,'0200'X       46,B6
  22155   2 000A9B       0200
          2 000A9C  0F81 0004                            B        s:22164,PREL

     2127    22156    1          ELSE
     2128    22157
     2129    22158        /* No poll sent                                           */
     2130    22159
     2131    22160    1             KX$L2.FLG.POLL_S = '0'B;

  22160   2 000A9E  8846 002E                            LBF,'0200'X       46,B6
  22160   2 000AA0       0200

     2132    22161
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:267  
     2133    22162        /* Always clear the POLL_R flag                           */
     2134    22163
     2135    22164    1       KX$L2.FLG.POLL_R = '0'B;

  22164   2 000AA1  8846 002E                            LBF,'0400'X       46,B6
  22164   2 000AA3       0400

     2136    22165
     2137    22166    1       RETURN;

  22166   2 000AA4  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2138    22167
     2139    22168        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:268  
     2140    22169    1   Y$CONDITION: PROC;

  22169   2 000AA7  EFC7 0032            Y$CONDITION     STB,B6   NR+1,AUTO

     2141    22170
     2142    22171        /*I* NAME: Y$CONDITION                                    */
     2143    22172        /*I* PURPOSE: This subroutine turns the external event into                   */
     2144    22173        /*I* an event that makes sense internally.                */
     2145    22174        /*I* INPUT: FEVENT  =  frame event type                     */
     2146    22175        /*I* CTX$  =  line context block pointer                    */
     2147    22176        /*I* DAT$  =  data pointer                                  */
     2148    22177        /*I* OUTPUT: FEVENT  =  frame event type                    */
     2149    22178
     2150    22179        /* There must be at least 2 bytes                         */
     2151    22180
     2152    22181    2       IF ( BINBIT(KX$FRAME.CTL,8) & '00000011'B ) = '00000011'B

  22181   2 000AA9  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000AAB  E845 0008                            LDR,R6   8,B5
          2 000AAD  E570 00FF                            AND,R6   255,IMO
          2 000AAF  6008                                 SOL,R6   8
          2 000AB0  E570 0300                            AND,R6   768,IMO
          2 000AB2  E970 0300                            CMR,R6   768,IMO
          2 000AB4  0981 000A                            BNE      s:22188,PREL

     2153    22182    2          THEN
     2154    22183        /*
     2155    22184           This is an unnumbered frame. Basic and extended formats are the same.
     2156    22185        */
     2157    22186    2             PF = KX$FRAME.CTL_BITS.PF;

  22186   2 000AB6  E845 0008                            LDR,R6   8,B5
          2 000AB8  600B                                 SOL,R6   11
          2 000AB9  E570 8000                            AND,R6   -32768,IMO
          2 000ABB  EF47 0030                            STR,R6   PF,AUTO
          2 000ABD  0F81 0023                            B        s:22202,PREL

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:269  
     2158    22187    2          ELSE
     2159    22188    2             IF NOT KX$L2.FLG.EXTSEQ

  22188   2 000ABF  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000AC1  89C4 002F                            CMZ      47,B4
          2 000AC3  0801 0011                            BAL      s:22196,PREL

     2160    22189    2                THEN
     2161    22190    3                   DO;

     2162    22191    3                      PF = KX$FRAME.CTL_BITS.PF;

  22191   2 000AC5  E845 0008                            LDR,R6   8,B5
          2 000AC7  600B                                 SOL,R6   11
          2 000AC8  E570 8000                            AND,R6   -32768,IMO
          2 000ACA  EF47 0030                            STR,R6   PF,AUTO

     2163    22192    3                      NR = KX$FRAME.CTL_BITS.NR;

  22192   2 000ACC  D845 0008                            LDR,R5   8,B5
          2 000ACE  5045                                 SOR,R5   5
          2 000ACF  D570 0007                            AND,R5   7,IMO
          2 000AD1  D7C7 0031                            STH,R5   NR,AUTO

     2164    22193    3                   END;

  22193   2 000AD3  0F81 000D                            B        s:22202,PREL

     2165    22194    2                ELSE
     2166    22195    3                   DO;

     2167    22196    3                      PF = KX$EXTFRAME.XCTL.PF;

  22196   2 000AD5  E845 0009                            LDR,R6   9,B5
          2 000AD7  6007                                 SOL,R6   7
          2 000AD8  E570 8000                            AND,R6   -32768,IMO
          2 000ADA  EF47 0030                            STR,R6   PF,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:270  

     2168    22197    3                      NR = KX$EXTFRAME.XCTL.NR;

  22197   2 000ADC  D845 0009                            LDR,R5   9,B5
          2 000ADE  5049                                 SOR,R5   9
          2 000ADF  D7C7 0031                            STH,R5   NR,AUTO

     2169    22198    3                   END;

     2170    22199
     2171    22200        /* Check for valid address                                */
     2172    22201
     2173    22202    2       IF ( ( KX$FRAME.ADR ~= 1 ) AND ( KX$FRAME.ADR ~= 3 ) ) OR KX$DATA.CNT < 2

  22202   2 000AE1  E2C5 0008                            LLH,R6   8,B5
          2 000AE3  6D01                                 CMV,R6   1
          2 000AE4  0901 0004                            BE       s:22202+8,PREL
          2 000AE6  6D03                                 CMV,R6   3
          2 000AE7  0981 0006                            BNE      s:22208,PREL
          2 000AE9  D845 0007                            LDR,R5   7,B5
          2 000AEB  5D02                                 CMV,R5   2
          2 000AEC  0281 0008                            BGE      s:22211,PREL

     2174    22203    2          THEN
     2175    22204    3             DO;

     2176    22205
     2177    22206        /* Bad address  -  return now with this event               */
     2178    22207
     2179    22208    3                FEVENT = %Y_EV_GARBAGE#;

  22208   2 000AEE  5C19                                 LDV,R5   25
          2 000AEF  DF47 0024                            STR,R5   FEVENT,AUTO

     2180    22209    3                RETURN;

  22209   2 000AF1  ECC7 0032                            LDB,B6   NR+1,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:271  
          2 000AF3  C3C6 0001                            LNJ,B4   1,B6

     2181    22210    3             END /* IF */;
     2182    22211    2       IF KX$DATA.CNT = 4104   /* i.e., KXH detected a frame which is too long */

  22211   2 000AF5  D970 1008                            CMR,R5   4104,IMO
          2 000AF7  0981 0008                            BNE      s:22220,PREL

     2183    22212    2          THEN
     2184    22213    3             DO;

     2185    22214    3                FEVENT = %Y_EV_BAD_IFLD#;

  22214   2 000AF9  4C1A                                 LDV,R4   26
          2 000AFA  CF47 0024                            STR,R4   FEVENT,AUTO

     2186    22215    3                RETURN;

  22215   2 000AFC  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 000AFE  C3C6 0001                            LNJ,B4   1,B6

     2187    22216    3             END;
     2188    22217
     2189    22218        /* Find out what type of frame we got                     */
     2190    22219
     2191    22220    2       IF NOT KX$FRAME.CTL_BITS.IFLAG  /* .IFLAG = '0'B --> I-FRAME */

  22220   2 000B00  82C5 0008                            LB,'0001'X        8,B5
  22220   2 000B02       0001
          2 000B03  0501 0022                            BBT      s:22254,PREL

     2192    22221    2          THEN
     2193    22222    3             DO;

     2194    22223        /* If this is a polled I frame,  set the flag              */
     2195    22224
     2196    22225    3                IF PF
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:272  

  22225   2 000B05  89C7 0030                            CMZ      PF,AUTO
          2 000B07  0881 0006                            BAGE     s:22232,PREL

     2197    22226    3                   THEN
     2198    22227    3                      KX$L2.FLG.POLL_R = '1'B;

  22227   2 000B09  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000B0B  8944 002E                            LBT,'0400'X       46,B4
          2 000B0D       0400

     2199    22228
     2200    22229
     2201    22230        /* It's an I frame,  check the address                     */
     2202    22231
     2203    22232    3                IF ( KX$FRAME.ADR = KX$L2.ADR_RESP )

  22232   2 000B0E  E2C5 0008                            LLH,R6   8,B5
          2 000B10  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000B12  D846 001E                            LDR,R5   30,B6
          2 000B14  D570 00FF                            AND,R5   255,IMO
          2 000B16  E955                                 CMR,R6   R5
          2 000B17  0981 0009                            BNE      s:22246,PREL

     2204    22233    3                   THEN
     2205    22234    4                      DO;

     2206    22235
     2207    22236        /* Set the event code                                     */
     2208    22237
     2209    22238    4                         FEVENT = %Y_EV_I#;

  22238   2 000B19  4C08                                 LDV,R4   8
          2 000B1A  CF47 0024                            STR,R4   FEVENT,AUTO

     2210    22239
     2211    22240        /* Check N ( R )  and update N' ( R )                             */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:273  
     2212    22241
     2213    22242    4                         CALL Y$NR;

  22242   2 000B1C  E3C0 01E1                            LNJ,B6   s:0,PREL
          2 000B1E       0001                            DC       s:22244,PREL

     2214    22243
     2215    22244    4                      END;

  22244   2 000B1F  0F81 01C3                            B        s:22546,PREL

     2216    22245    3                   ELSE        /*  This is bad data  */
     2217    22246    3                      FEVENT = %Y_EV_BAD_ADR#;

  22246   2 000B21  4C18                                 LDV,R4   24
          2 000B22  CF47 0024                            STR,R4   FEVENT,AUTO

     2218    22247
     2219    22248    3             END;

  22248   2 000B24  0F81 01BE                            B        s:22546,PREL

     2220    22249    2          ELSE
     2221    22250    3             DO;

     2222    22251
     2223    22252        /* It's a supervisory or unnumbered frame                 */
     2224    22253
     2225    22254    4                DO CASE ( KX$FRAME.CTL_BITS.NS );

  22254   2 000B26  B845 0008                            LDR,R3   8,B5
          2 000B28  3041                                 SOR,R3   1
          2 000B29  B570 0007                            AND,R3   7,IMO
          2 000B2B  3D05                                 CMV,R3   5
          2 000B2C  0281 00A2                            BGE      s:22396,PREL
          2 000B2E  A830 0000 0B34  02                   LDR,R2   s:22254+14,R3
          2 000B31  83A0 0000 0B39  02                   JMP      s:22259,R2
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:274  
          2 000B34       0000                            DC       s:22259,PREL
          2 000B35       0096                            DC       s:22396,PREL
          2 000B36       0032                            DC       s:22306,PREL
          2 000B37       0096                            DC       s:22396,PREL
          2 000B38       0064                            DC       s:22351,PREL

     2226    22255    4                   CASE ( %Y_TYPE_RR# );

     2227    22256
     2228    22257        /* Set the event code appropriately                       */
     2229    22258
     2230    22259    4                      IF PF

  22259   2 000B39  89C7 0030                            CMZ      PF,AUTO
          2 000B3B  0881 0027                            BAGE     s:22297,PREL

     2231    22260    4                         THEN
     2232    22261    5                            DO;

     2233    22262
     2234    22263        /* P / F bit is set                                         */
     2235    22264
     2236    22265    5                               IF KX$FRAME.ADR = KX$L2.ADR_RESP

  22265   2 000B3D  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000B3F  C844 001E                            LDR,R4   30,B4
          2 000B41  C570 00FF                            AND,R4   255,IMO
          2 000B43  E954                                 CMR,R6   R4
          2 000B44  0981 000C                            BNE      s:22280,PREL

     2237    22266    5                                  THEN
     2238    22267    6                                     DO;

     2239    22268
     2240    22269        /* This is a RR_P.                                */
     2241    22270
     2242    22271    6                                        FEVENT = %Y_EV_RR#;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:275  

  22271   2 000B46  1C0E                                 LDV,R1   14
          2 000B47  9F47 0024                            STR,R1   FEVENT,AUTO

     2243    22272    6                                        KX$L2.FLG.POLL_R = '1'B;

  22272   2 000B49  8944 002E                            LBT,'0400'X       46,B4
  22272   2 000B4B       0400

     2244    22273    6                                        CALL Y$NR;

  22273   2 000B4C  E3C0 01B1                            LNJ,B6   s:0,PREL
          2 000B4E       0001                            DC       s:22275,PREL

     2245    22274
     2246    22275    6                                     END;

  22275   2 000B4F  0F81 0193                            B        s:22546,PREL

     2247    22276    5                                  ELSE
     2248    22277        /*
     2249    22278           This is an RR_F.
     2250    22279        */
     2251    22280    5                                     IF KX$L2.FLG.POLL_S

  22280   2 000B51  82C4 002E                            LB,'0200'X        46,B4
  22280   2 000B53       0200
          2 000B54  0581 0009                            BBF      s:22289,PREL

     2252    22281    5                                        THEN
     2253    22282    6                                           DO;

     2254    22283
     2255    22284    6                                              FEVENT = %Y_EV_RR_F#;

  22284   2 000B56  1C0F                                 LDV,R1   15
          2 000B57  9F47 0024                            STR,R1   FEVENT,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:276  

     2256    22285    6                                              CALL Y$NR;

  22285   2 000B59  E3C0 01A4                            LNJ,B6   s:0,PREL
          2 000B5B       0001                            DC       s:22287,PREL

     2257    22286
     2258    22287    6                                           END;

  22287   2 000B5C  0F81 0186                            B        s:22546,PREL

     2259    22288    5                                        ELSE
     2260    22289    5                                           FEVENT = %Y_EV_BAD_F#;

  22289   2 000B5E  1C16                                 LDV,R1   22
          2 000B5F  9F47 0024                            STR,R1   FEVENT,AUTO

     2261    22290
     2262    22291    5                            END;

  22291   2 000B61  0F81 0181                            B        s:22546,PREL

     2263    22292    4                         ELSE
     2264    22293    5                            DO;

     2265    22294
     2266    22295        /* Just a plain old RR                                    */
     2267    22296
     2268    22297    5                               FEVENT = %Y_EV_RR#;

  22297   2 000B63  4C0E                                 LDV,R4   14
          2 000B64  CF47 0024                            STR,R4   FEVENT,AUTO

     2269    22298    5                               CALL Y$NR;

  22298   2 000B66  E3C0 0197                            LNJ,B6   s:0,PREL
          2 000B68       0001                            DC       s:22300,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:277  

     2270    22299
     2271    22300    5                            END /* IF */;

  22300   2 000B69  0F81 0179                            B        s:22546,PREL

     2272    22301
     2273    22302    4                   CASE ( %Y_TYPE_RNR# );

     2274    22303
     2275    22304        /* Set the event code appropriately                       */
     2276    22305
     2277    22306    4                      IF PF

  22306   2 000B6B  89C7 0030                            CMZ      PF,AUTO
          2 000B6D  0881 0027                            BAGE     s:22342,PREL

     2278    22307    4                         THEN
     2279    22308    5                            DO;

     2280    22309
     2281    22310        /* P / F bit is set                                         */
     2282    22311
     2283    22312    5                               IF KX$FRAME.ADR = KX$L2.ADR_RESP

  22312   2 000B6F  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000B71  C844 001E                            LDR,R4   30,B4
          2 000B73  C570 00FF                            AND,R4   255,IMO
          2 000B75  E954                                 CMR,R6   R4
          2 000B76  0981 000C                            BNE      s:22324,PREL

     2284    22313    5                                  THEN
     2285    22314    6                                     DO;

     2286    22315
     2287    22316        /* This is a RNR_P.                              */
     2288    22317
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:278  
     2289    22318    6                                        FEVENT = %Y_EV_RNR#;

  22318   2 000B78  1C10                                 LDV,R1   16
          2 000B79  9F47 0024                            STR,R1   FEVENT,AUTO

     2290    22319    6                                        KX$L2.FLG.POLL_R = '1'B;

  22319   2 000B7B  8944 002E                            LBT,'0400'X       46,B4
  22319   2 000B7D       0400

     2291    22320    6                                        CALL Y$NR;

  22320   2 000B7E  E3C0 017F                            LNJ,B6   s:0,PREL
          2 000B80       0001                            DC       s:22322,PREL

     2292    22321
     2293    22322    6                                     END;

  22322   2 000B81  0F81 0161                            B        s:22546,PREL

     2294    22323    5                                  ELSE
     2295    22324    5                                     IF KX$L2.FLG.POLL_S

  22324   2 000B83  82C4 002E                            LB,'0200'X        46,B4
  22324   2 000B85       0200
          2 000B86  0581 0009                            BBF      s:22334,PREL

     2296    22325    5                                        THEN
     2297    22326    6                                           DO;

     2298    22327
     2299    22328        /* This is a RNR_F.                                       */
     2300    22329    6                                              FEVENT = %Y_EV_RNR_F#;

  22329   2 000B88  1C11                                 LDV,R1   17
          2 000B89  9F47 0024                            STR,R1   FEVENT,AUTO

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:279  
     2301    22330    6                                              CALL Y$NR;

  22330   2 000B8B  E3C0 0172                            LNJ,B6   s:0,PREL
          2 000B8D       0001                            DC       s:22332,PREL

     2302    22331
     2303    22332    6                                           END;

  22332   2 000B8E  0F81 0154                            B        s:22546,PREL

     2304    22333    5                                        ELSE
     2305    22334    5                                           FEVENT = %Y_EV_BAD_F#;

  22334   2 000B90  1C16                                 LDV,R1   22
          2 000B91  9F47 0024                            STR,R1   FEVENT,AUTO

     2306    22335
     2307    22336    5                            END;

  22336   2 000B93  0F81 014F                            B        s:22546,PREL

     2308    22337    4                         ELSE
     2309    22338    5                            DO;

     2310    22339
     2311    22340        /* Just a plain old RNR                                   */
     2312    22341
     2313    22342    5                               FEVENT = %Y_EV_RNR#;

  22342   2 000B95  4C10                                 LDV,R4   16
          2 000B96  CF47 0024                            STR,R4   FEVENT,AUTO

     2314    22343    5                               CALL Y$NR;

  22343   2 000B98  E3C0 0165                            LNJ,B6   s:0,PREL
          2 000B9A       0001                            DC       s:22345,PREL

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:280  
     2315    22344
     2316    22345    5                            END /* IF */;

  22345   2 000B9B  0F81 0147                            B        s:22546,PREL

     2317    22346
     2318    22347    4                   CASE ( %Y_TYPE_REJ# );

     2319    22348
     2320    22349        /* Set the event code appropriately                       */
     2321    22350
     2322    22351    4                      IF PF

  22351   2 000B9D  89C7 0030                            CMZ      PF,AUTO
          2 000B9F  0881 0027                            BAGE     s:22387,PREL

     2323    22352    4                         THEN
     2324    22353    5                            DO;

     2325    22354
     2326    22355        /* P / F bit is set                                         */
     2327    22356
     2328    22357    5                               IF KX$FRAME.ADR = KX$L2.ADR_RESP

  22357   2 000BA1  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000BA3  C844 001E                            LDR,R4   30,B4
          2 000BA5  C570 00FF                            AND,R4   255,IMO
          2 000BA7  E954                                 CMR,R6   R4
          2 000BA8  0981 000C                            BNE      s:22369,PREL

     2329    22358    5                                  THEN
     2330    22359    6                                     DO;

     2331    22360
     2332    22361        /* This is a REJ_P.                                       */
     2333    22362
     2334    22363    6                                        FEVENT = %Y_EV_REJ#;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:281  

  22363   2 000BAA  1C12                                 LDV,R1   18
          2 000BAB  9F47 0024                            STR,R1   FEVENT,AUTO

     2335    22364    6                                        KX$L2.FLG.POLL_R = '1'B;

  22364   2 000BAD  8944 002E                            LBT,'0400'X       46,B4
  22364   2 000BAF       0400

     2336    22365    6                                        CALL Y$NR;

  22365   2 000BB0  E3C0 014D                            LNJ,B6   s:0,PREL
          2 000BB2       0001                            DC       s:22367,PREL

     2337    22366
     2338    22367    6                                     END;

  22367   2 000BB3  0F81 012F                            B        s:22546,PREL

     2339    22368    5                                  ELSE
     2340    22369    5                                     IF KX$L2.FLG.POLL_S

  22369   2 000BB5  82C4 002E                            LB,'0200'X        46,B4
  22369   2 000BB7       0200
          2 000BB8  0581 0009                            BBF      s:22379,PREL

     2341    22370    5                                        THEN
     2342    22371    6                                           DO;

     2343    22372
     2344    22373        /* This is a REJ_F                                        */
     2345    22374    6                                              FEVENT = %Y_EV_REJ_F#;

  22374   2 000BBA  1C13                                 LDV,R1   19
          2 000BBB  9F47 0024                            STR,R1   FEVENT,AUTO

     2346    22375    6                                              CALL Y$NR;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:282  

  22375   2 000BBD  E3C0 0140                            LNJ,B6   s:0,PREL
          2 000BBF       0001                            DC       s:22377,PREL

     2347    22376
     2348    22377    6                                           END;

  22377   2 000BC0  0F81 0122                            B        s:22546,PREL

     2349    22378    5                                        ELSE
     2350    22379    5                                           FEVENT = %Y_EV_BAD_F#;

  22379   2 000BC2  1C16                                 LDV,R1   22
          2 000BC3  9F47 0024                            STR,R1   FEVENT,AUTO

     2351    22380
     2352    22381    5                            END;

  22381   2 000BC5  0F81 011D                            B        s:22546,PREL

     2353    22382    4                         ELSE
     2354    22383    5                            DO;

     2355    22384
     2356    22385        /* Just a plain old REJ                                   */
     2357    22386
     2358    22387    5                               FEVENT = %Y_EV_REJ#;

  22387   2 000BC7  4C12                                 LDV,R4   18
          2 000BC8  CF47 0024                            STR,R4   FEVENT,AUTO

     2359    22388    5                               CALL Y$NR;

  22388   2 000BCA  E3C0 0133                            LNJ,B6   s:0,PREL
          2 000BCC       0001                            DC       s:22390,PREL

     2360    22389
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:283  
     2361    22390    5                            END /* IF */;

  22390   2 000BCD  0F81 0115                            B        s:22546,PREL

     2362    22391
     2363    22392    4                   CASE ( ELSE );

     2364    22393
     2365    22394        /* It's an unnumbered frame                               */
     2366    22395
     2367    22396    5                      DO SELECT ( KX$FRAME.CTL );

  22396   2 000BCF  C845 0008                            LDR,R4   8,B5
          2 000BD1  C570 00FF                            AND,R4   255,IMO
          2 000BD3  C970 006F                            CMR,R4   111,IMO
          2 000BD5  0201 001A                            BL       s:22396+33,PREL
          2 000BD7  0901 004F                            BE       s:22411,PREL
          2 000BD9  C970 007F                            CMR,R4   127,IMO
          2 000BDB  0201 000F                            BL       s:22396+28,PREL
          2 000BDD  0901 0049                            BE       s:22411,PREL
          2 000BDF  C970 0087                            CMR,R4   135,IMO
          2 000BE1  0201 00FE                            BL       s:22539,PREL
          2 000BE3  0901 00BB                            BE       s:22492,PREL
          2 000BE5  C970 0097                            CMR,R4   151,IMO
          2 000BE7  0981 00F8                            BNE      s:22539,PREL
          2 000BE9  0F81 00B5                            B        s:22492,PREL
          2 000BEB  4D73                                 CMV,R4   115
          2 000BEC  0981 00F3                            BNE      s:22539,PREL
          2 000BEE  0F81 0095                            B        s:22472,PREL
          2 000BF0  C970 003F                            CMR,R4   63,IMO
          2 000BF2  0201 0013                            BL       s:22396+55,PREL
          2 000BF4  0901 0032                            BE       s:22411,PREL
          2 000BF6  C970 0053                            CMR,R4   83,IMO
          2 000BF8  0201 0008                            BL       s:22396+50,PREL
          2 000BFA  0901 005E                            BE       s:22443,PREL
          2 000BFC  4D63                                 CMV,R4   99
          2 000BFD  0981 00E2                            BNE      s:22539,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:284  
          2 000BFF  0F81 0073                            B        s:22462,PREL
          2 000C01  4D43                                 CMV,R4   67
          2 000C02  0981 00DD                            BNE      s:22539,PREL
          2 000C04  0F81 0054                            B        s:22443,PREL
          2 000C06  C970 001F                            CMR,R4   31,IMO
          2 000C08  0201 0008                            BL       s:22396+66,PREL
          2 000C0A  0901 000B                            BE       s:22401,PREL
          2 000C0C  4D2F                                 CMV,R4   47
          2 000C0D  0981 00D2                            BNE      s:22539,PREL
          2 000C0F  0F81 0017                            B        s:22411,PREL
          2 000C11  4D0F                                 CMV,R4   15
          2 000C12  0981 00CD                            BNE      s:22539,PREL
          2 000C14  0F81 0001                            B        s:22401,PREL

     2368    22397    5                         SELECT ( %Y_CTL_DM#, %Y_CTL_DM_F# );

     2369    22398
     2370    22399        /* DM frames must be responses  (  commands to us  )          */
     2371    22400
     2372    22401    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_CMND )

  22401   2 000C16  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000C18  A2C4 001E                            LLH,R2   30,B4
          2 000C1A  E952                                 CMR,R6   R2
          2 000C1B  0981 0006                            BNE      s:22405,PREL

     2373    22402    5                            THEN  /*  This is Ok  */
     2374    22403    5                               FEVENT = %Y_EV_DM#;

  22403   2 000C1D  1C0D                                 LDV,R1   13
          2 000C1E  9F47 0024                            STR,R1   FEVENT,AUTO
          2 000C20  0F81 00C2                            B        s:22546,PREL

     2375    22404    5                            ELSE  /*  This is not so Ok  */
     2376    22405    5                               FEVENT = %Y_EV_BAD_ADR#;

  22405   2 000C22  1C18                                 LDV,R1   24
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:285  
          2 000C23  9F47 0024                            STR,R1   FEVENT,AUTO
          2 000C25  0F81 00BD                            B        s:22546,PREL

     2377    22406
     2378    22407    5                         SELECT ( %Y_CTL_SABM#, %Y_CTL_SABM_P#, %Y_CTL_SABME#, %
             22407                                  Y_CTL_SABME_P# );

     2379    22408
     2380    22409        /* SABM frames must be commands  (  responses to us  )        */
     2381    22410
     2382    22411    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_RESP )

  22411   2 000C27  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000C29  A844 001E                            LDR,R2   30,B4
          2 000C2B  A570 00FF                            AND,R2   255,IMO
          2 000C2D  E952                                 CMR,R6   R2
          2 000C2E  0981 000D                            BNE      s:22427,PREL

     2383    22412    5                            THEN
     2384    22413    6                               DO;

     2385    22414
     2386    22415        /* Report a SABM event                                    */
     2387    22416
     2388    22417    6                                  FEVENT = %Y_EV_SABM#;

  22417   2 000C30  1C09                                 LDV,R1   9
          2 000C31  9F47 0024                            STR,R1   FEVENT,AUTO

     2389    22418
     2390    22419        /* Set the POLL_R bit if necessary                        */
     2391    22420
     2392    22421    6                                  IF PF

  22421   2 000C33  89C7 0030                            CMZ      PF,AUTO
          2 000C35  0881 0009                            BAGE     s:22431,PREL

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:286  
     2393    22422    6                                     THEN
     2394    22423    6                                        KX$L2.FLG.POLL_R = '1'B;

  22423   2 000C37  8944 002E                            LBT,'0400'X       46,B4
  22423   2 000C39       0400

     2395    22424
     2396    22425    6                               END;

  22425   2 000C3A  0F81 0004                            B        s:22431,PREL

     2397    22426    5                            ELSE  /*  Bad address  */
     2398    22427    5                               FEVENT = %Y_EV_BAD_ADR#;

  22427   2 000C3C  1C18                                 LDV,R1   24
          2 000C3D  9F47 0024                            STR,R1   FEVENT,AUTO

     2399    22428        /*
     2400    22429           SABME means extended mode. Is our EXTSEQ bit on?
     2401    22430        */
     2402    22431    5                         IF (BINBIT(KX$FRAME.CTL,8) & '40'X) AND NOT KX$L2.FLG.EXTSEQ

  22431   2 000C3F  E845 0008                            LDR,R6   8,B5
          2 000C41  E570 00FF                            AND,R6   255,IMO
          2 000C43  6008                                 SOL,R6   8
          2 000C44  E570 4000                            AND,R6   16384,IMO
          2 000C46  6901 009C                            BEZ,R6   s:22546,PREL
          2 000C48  89C4 002F                            CMZ      47,B4
          2 000C4A  0801 0098                            BAL      s:22546,PREL

     2403    22432    5                            THEN
     2404    22433    6                               DO;

     2405    22434    6                                  ERCOD = EXTENDED_FORMAT;

  22434   2 000C4C  8C80 0000 01A4  00                   LDI      EXTENDED_FORMAT
          2 000C4F  8D47 0022                            SDI      ERCOD,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:287  

     2406    22435    6                                  CALL Y$ER;

  22435   2 000C51  E3C0 035D                            LNJ,B6   s:0,PREL
          2 000C53       0001                            DC       s:22436,PREL

     2407    22436    6                                  FEVENT = %Y_EV_BAD_ADR#;

  22436   2 000C54  6C18                                 LDV,R6   24
          2 000C55  EF47 0024                            STR,R6   FEVENT,AUTO

     2408    22437    6                               END;

  22437   2 000C57  0F81 008B                            B        s:22546,PREL

     2409    22438
     2410    22439    5                         SELECT ( %Y_CTL_DISC#, %Y_CTL_DISC_P# );

     2411    22440
     2412    22441        /* DISCs must be commands  (  responses to us  )              */
     2413    22442
     2414    22443    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_RESP )

  22443   2 000C59  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000C5B  A844 001E                            LDR,R2   30,B4
          2 000C5D  A570 00FF                            AND,R2   255,IMO
          2 000C5F  E952                                 CMR,R6   R2
          2 000C60  0981 000D                            BNE      s:22456,PREL

     2415    22444    5                            THEN
     2416    22445    6                               DO;

     2417    22446    6                                  FEVENT = %Y_EV_DISC#;

  22446   2 000C62  1C0A                                 LDV,R1   10
          2 000C63  9F47 0024                            STR,R1   FEVENT,AUTO

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:288  
     2418    22447
     2419    22448        /* Set the POLL_R flag if necessary                       */
     2420    22449
     2421    22450    6                                  IF PF

  22450   2 000C65  89C7 0030                            CMZ      PF,AUTO
          2 000C67  0881 007B                            BAGE     s:22546,PREL

     2422    22451    6                                     THEN
     2423    22452    6                                        KX$L2.FLG.POLL_R = '1'B;

  22452   2 000C69  8944 002E                            LBT,'0400'X       46,B4
  22452   2 000C6B       0400

     2424    22453
     2425    22454    6                               END;

  22454   2 000C6C  0F81 0076                            B        s:22546,PREL

     2426    22455    5                            ELSE  /*  Bad address  */
     2427    22456    5                               FEVENT = %Y_EV_BAD_ADR#;

  22456   2 000C6E  1C18                                 LDV,R1   24
          2 000C6F  9F47 0024                            STR,R1   FEVENT,AUTO
          2 000C71  0F81 0071                            B        s:22546,PREL

     2428    22457
     2429    22458    5                         SELECT ( %Y_CTL_UA# );

     2430    22459
     2431    22460        /* UA frames must be responses  (  commands to us  )          */
     2432    22461
     2433    22462    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_CMND )

  22462   2 000C73  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000C75  A2C4 001E                            LLH,R2   30,B4
          2 000C77  E952                                 CMR,R6   R2
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:289  
          2 000C78  0981 0006                            BNE      s:22466,PREL

     2434    22463    5                            THEN  /*  Everything is Ok  */
     2435    22464    5                               FEVENT = %Y_EV_UA#;

  22464   2 000C7A  1C0B                                 LDV,R1   11
          2 000C7B  9F47 0024                            STR,R1   FEVENT,AUTO
          2 000C7D  0F81 0065                            B        s:22546,PREL

     2436    22465    5                            ELSE  /*  Bad address  */
     2437    22466    5                               FEVENT = %Y_EV_BAD_ADR#;

  22466   2 000C7F  1C18                                 LDV,R1   24
          2 000C80  9F47 0024                            STR,R1   FEVENT,AUTO
          2 000C82  0F81 0060                            B        s:22546,PREL

     2438    22467
     2439    22468    5                         SELECT ( %Y_CTL_UA_F# );

     2440    22469
     2441    22470        /* Final UA frames must be responses  (  commands to us  )    */
     2442    22471
     2443    22472    5                         IF ( KX$FRAME.ADR = KX$L2.ADR_CMND )

  22472   2 000C84  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000C86  A2C4 001E                            LLH,R2   30,B4
          2 000C88  E952                                 CMR,R6   R2
          2 000C89  0981 0010                            BNE      s:22486,PREL

     2444    22473    5                            THEN
     2445    22474    6                               DO;

     2446    22475
     2447    22476        /* Is a final response expected?                          */
     2448    22477
     2449    22478    6                                  IF KX$L2.FLG.POLL_S

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:290  
  22478   2 000C8B  82C4 002E                            LB,'0200'X        46,B4
  22478   2 000C8D       0200
          2 000C8E  0581 0006                            BBF      s:22482,PREL

     2450    22479    6                                     THEN  /*  This is Ok  */
     2451    22480    6                                        FEVENT = %Y_EV_UA_F#;

  22480   2 000C90  1C0C                                 LDV,R1   12
          2 000C91  9F47 0024                            STR,R1   FEVENT,AUTO
          2 000C93  0F81 004F                            B        s:22546,PREL

     2452    22481    6                                     ELSE  /*  Unexpected final response  */
     2453    22482    6                                        FEVENT = %Y_EV_BAD_F#;

  22482   2 000C95  1C16                                 LDV,R1   22
          2 000C96  9F47 0024                            STR,R1   FEVENT,AUTO

     2454    22483
     2455    22484    6                               END;

  22484   2 000C98  0F81 004A                            B        s:22546,PREL

     2456    22485    5                            ELSE  /*  NAK  */
     2457    22486    5                               FEVENT = %Y_EV_BAD_ADR#;

  22486   2 000C9A  1C18                                 LDV,R1   24
          2 000C9B  9F47 0024                            STR,R1   FEVENT,AUTO
          2 000C9D  0F81 0045                            B        s:22546,PREL

     2458    22487
     2459    22488    5                         SELECT ( %Y_CTL_FRMR#, %Y_CTL_FRMR_F# );

     2460    22489
     2461    22490        /* The length of FRMRs must be 5, or 7, for extended format */
     2462    22491
     2463    22492    5                         IF ( KX$DATA.CNT ~= 5+2*BITBIN(KX$L2.FLG.EXTSEQ) )

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:291  
  22492   2 000C9F  CCC7 0006                            LDB,B4   CTX$,AUTO
          2 000CA1  A844 002F                            LDR,R2   47,B4
          2 000CA3  204F                                 SOR,R2   15
          2 000CA4  2001                                 SOL,R2   1
          2 000CA5  2E05                                 ADV,R2   5
          2 000CA6  A955                                 CMR,R2   R5
          2 000CA7  0901 0006                            BE       s:22500,PREL

     2464    22493    5                            THEN  /*  Invalid frame  */
     2465    22494    5                               FEVENT = %Y_EV_BAD_IFLD#;

  22494   2 000CA9  2C1A                                 LDV,R2   26
          2 000CAA  AF47 0024                            STR,R2   FEVENT,AUTO
          2 000CAC  0F81 0036                            B        s:22546,PREL

     2466    22495    5                            ELSE
     2467    22496    6                               DO;

     2468    22497
     2469    22498        /* FRMR frames must be responses  (  commands to us  )        */
     2470    22499
     2471    22500    6                                  IF ( KX$FRAME.ADR = KX$L2.ADR_CMND )

  22500   2 000CAE  A2C4 001E                            LLH,R2   30,B4
          2 000CB0  E952                                 CMR,R6   R2
          2 000CB1  0981 0006                            BNE      s:22504,PREL

     2472    22501    6                                     THEN  /*  Ok  */
     2473    22502    6                                        FEVENT = %Y_EV_FRMR#;

  22502   2 000CB3  1C14                                 LDV,R1   20
          2 000CB4  9F47 0024                            STR,R1   FEVENT,AUTO
          2 000CB6  0F81 0004                            B        s:22529,PREL

     2474    22503    6                                     ELSE  /*  Bad address  */
     2475    22504    6                                        FEVENT = %Y_EV_BAD_ADR#;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:292  
  22504   2 000CB8  1C18                                 LDV,R1   24
          2 000CB9  9F47 0024                            STR,R1   FEVENT,AUTO

     2476    22505
     2477    22506        /* Log the FRMR parameters                                */
     2478    22507
     2479    22508                                       %WRSYSLOG ( ERRCOD = FRMR,
     2480    22509                                       TRMID = "KX$L1.CHN$ -> KH$CHN.TERMID",
     2481    22510                                       BFR = KX$L2.SUPV_Q_TAIL$,
             22510                                           /* to record STATE history as well */
     2482    22511                                       VAL0 = KX$EXTXFRAME.FRMR_CTL,
     2483    22512                                       VAL1 = KX$EXTXFRAME.FRMR_NSNR,
     2484    22513                                       VAL2 = KX$EXTXFRAME.FRMR_BITS );

  22529   2 000CBB  BCC4 0002                            LDB,B3   2,B4
          2 000CBD  ABC5 000B                            LAB,B2   11,B5
          2 000CBF  AFC7 0042                            STB,B2   ADDRESS+14,AUTO
          2 000CC1  9BC5 000A                            LAB,B1   10,B5
          2 000CC3  9FC7 0040                            STB,B1   ADDRESS+12,AUTO
          2 000CC5  EBC5 0009                            LAB,B6   9,B5
          2 000CC7  EFC7 003E                            STB,B6   ADDRESS+10,AUTO
          2 000CC9  EBC4 0014                            LAB,B6   20,B4
          2 000CCB  EFC7 003C                            STB,B6   ADDRESS+8,AUTO
          2 000CCD  EBC3 0012                            LAB,B6   18,B3
          2 000CCF  EFC7 003A                            STB,B6   ADDRESS+6,AUTO
          2 000CD1  BB80 0000 0198  00                   LAB,B3   FRMR
          2 000CD4  BFC7 0038                            STB,B3   ADDRESS+4,AUTO
          2 000CD6  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000CD8  CBF0 0600                            LAB,B4   1536,IMO
          2 000CDA  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 000CDD       0001                            DC       s:22533,PREL

     2485    22531
     2486    22532
     2487    22533    6                               END /* IF */;

  22533   2 000CDE  0F81 0004                            B        s:22546,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:293  

     2488    22534
     2489    22535    5                         SELECT ( ELSE );

     2490    22536
     2491    22537        /* It's a bad frame,  set the event code                   */
     2492    22538
     2493    22539    5                      FEVENT = %Y_EV_BAD_ADR#;

  22539   2 000CE0  2C18                                 LDV,R2   24
          2 000CE1  AF47 0024                            STR,R2   FEVENT,AUTO

     2494    22540    5                      END /* SELECT */;

     2495    22541    4                END /* SELECT */;

     2496    22542    3             END /* IF */;

     2497    22543
     2498    22544        /* Check for long frames                                  */
     2499    22545
     2500    22546    2       IF ( FEVENT ~= %Y_EV_I# ) AND ( FEVENT < %Y_EV_FRMR# )

  22546   2 000CE3  E847 0024                            LDR,R6   FEVENT,AUTO
          2 000CE5  6D08                                 CMV,R6   8
          2 000CE6  0901 0013                            BE       s:22551,PREL
          2 000CE8  6D14                                 CMV,R6   20
          2 000CE9  0281 0010                            BGE      s:22551,PREL
          2 000CEB  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000CED  D846 002F                            LDR,R5   47,B6
          2 000CEF  504F                                 SOR,R5   15
          2 000CF0  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000CF2  5E02                                 ADV,R5   2
          2 000CF3  D945 0007                            CMR,R5   7,B5
          2 000CF5  0281 0004                            BGE      s:22551,PREL

     2501    22547    2          AND ( KX$DATA.CNT > 2 + BITBIN(KX$L2.FLG.EXTSEQ) )
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:294  
     2502    22548    2          THEN                 /*  This is a long frame  */
     2503    22549    2             FEVENT = %Y_EV_BAD_IFLD#;

  22549   2 000CF7  6C1A                                 LDV,R6   26
          2 000CF8  EF47 0024                            STR,R6   FEVENT,AUTO

     2504    22550
     2505    22551    2   END /* SUBROUTINE */;

  22551   2 000CFA  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 000CFC  C3C6 0001                            LNJ,B4   1,B6

     2506    22552        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:295  
     2507    22553    1   Y$NR: PROC;

  22553   2 000CFE  EFC7 0034            Y$NR            STB,B6   NR+3,AUTO

     2508    22554
     2509    22555        /*I* NAME: Y$NR                                           */
     2510    22556        /*I* PURPOSE: This subroutine checks for a good N ( R )       */
     2511    22557        /*I* and updates N' ( R ) .                                   */
     2512    22558        /*I* CALL: CALL Y$NR                                      */
     2513    22559        /*I* INPUT: CTX$  =  line context block pointer             */
     2514    22560        /*I* DAT$  =  data pointer                                  */
     2515    22561        /*I* FEVENT  =  event type                                  */
     2516    22562        /*I* OUTPUT: FEVENT  =  event type                          */
     2517    22563
     2518    22564        /* Does N ( R )  get checked for the current state?           */
     2519    22565
     2520    22566    2       IF ( KX$L2.STATE.CURRENT = %Y_ST_NORMAL# )

  22566   2 000D00  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 000D02  E2C5 001D                            LLH,R6   29,B5
          2 000D04  6D04                                 CMV,R6   4
          2 000D05  0981 0003                            BNE      s:22575,PREL

     2521    22567    2          THEN
     2522    22568    3             DO;

     2523    22569                                                /* This IF intentionally left blank   */
     2524    22570
     2525    22571        /* This one gets checked                                  */
     2526    22572
     2527    22573    3             END;

  22573   2 000D07  0F81 000E                            B        s:22595,PREL

     2528    22574    2          ELSE
     2529    22575    2             IF ( KX$L2.STATE.CURRENT = %Y_ST_TIMER_REC# )

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:296  
  22575   2 000D09  6D08                                 CMV,R6   8
          2 000D0A  0981 0007                            BNE      s:22589,PREL
          2 000D0C  89C7 0030                            CMZ      PF,AUTO
          2 000D0E  0881 0003                            BAGE     s:22589,PREL

     2530    22576    2                AND PF
     2531    22577    2                THEN
     2532    22578    3                   DO;

     2533    22579
     2534    22580        /* When n timer recovery,  responses with the              */
     2535    22581        /* final bit set are checked                              */
     2536    22582
     2537    22583    3                   END;

  22583   2 000D10  0F81 0005                            B        s:22595,PREL

     2538    22584    2                ELSE
     2539    22585    3                   DO;

     2540    22586
     2541    22587        /* No others are checked                                  */
     2542    22588
     2543    22589    3                      RETURN;

  22589   2 000D12  ECC7 0034                            LDB,B6   NR+3,AUTO
          2 000D14  C3C6 0001                            LNJ,B4   1,B6

     2544    22590
     2545    22591    3                   END /* IF */;
     2546    22592
     2547    22593        /* Get N ( R )  from the frame                                */
     2548    22594
     2549    22595    2       TEMP2 = NR;

  22595   2 000D16  D2C7 0031                            LLH,R5   NR,AUTO
          2 000D18  DF47 002D                            STR,R5   TEMP2,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:297  

     2550    22596
     2551    22597        /* Get N' ( R )  and V ( S )  from the context block              */
     2552    22598
     2553    22599    2       TEMP3 = KX$L2.NPR;

  22599   2 000D1A  E2C5 002C                            LLH,R6   44,B5
          2 000D1C  EF47 002E                            STR,R6   TEMP3,AUTO

     2554    22600    2       TEMP4 = KX$L2.VS;

  22600   2 000D1E  C845 002C                            LDR,R4   44,B5
          2 000D20  C570 00FF                            AND,R4   255,IMO
          2 000D22  CF47 002F                            STR,R4   TEMP4,AUTO

     2555    22601
     2556    22602        /* Is N ( R )  valid?                                         */
     2557    22603
     2558    22604    2       IF ( TEMP4 < TEMP3 )

  22604   2 000D24  C956                                 CMR,R4   R6
          2 000D25  0281 000A                            BGE      s:22610,PREL

     2559    22605    2          THEN
     2560    22606    3             DO;

     2561    22607    3                TEMP4 = TEMP4 + 8 + 120*BITBIN(KX$L2.FLG.EXTSEQ);

  22607   2 000D27  B845 002F                            LDR,R3   47,B5
          2 000D29  304F                                 SOR,R3   15
          2 000D2A  3F78                                 MLV,R3   120
          2 000D2B  BA54                                 ADD,R3   R4
          2 000D2C  C853                                 LDR,R4   R3
          2 000D2D  4E08                                 ADV,R4   8
          2 000D2E  CF47 002F                            STR,R4   TEMP4,AUTO

     2562    22608    3             END /* IF */;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:298  

     2563    22609
     2564    22610    2       IF ( TEMP2 < TEMP3 )

  22610   2 000D30  D956                                 CMR,R5   R6
          2 000D31  0281 000A                            BGE      s:22618,PREL

     2565    22611    2          THEN
     2566    22612    3             DO;

     2567    22613    3                TEMP2 = TEMP2 + 8 + 120*BITBIN(KX$L2.FLG.EXTSEQ);

  22613   2 000D33  B845 002F                            LDR,R3   47,B5
          2 000D35  304F                                 SOR,R3   15
          2 000D36  3F78                                 MLV,R3   120
          2 000D37  BA55                                 ADD,R3   R5
          2 000D38  D853                                 LDR,R5   R3
          2 000D39  5E08                                 ADV,R5   8
          2 000D3A  DF47 002D                            STR,R5   TEMP2,AUTO

     2568    22614    3             END /* IF */;

     2569    22615
     2570    22616        /* Is N ( R )  between N' ( R )  and V ( S ) ?                        */
     2571    22617
     2572    22618    2       IF ( TEMP2 < TEMP3 ) OR ( TEMP2 > TEMP4 )

  22618   2 000D3C  D956                                 CMR,R5   R6
          2 000D3D  0201 0004                            BL       s:22624,PREL
          2 000D3F  D954                                 CMR,R5   R4
          2 000D40  0381 0008                            BLE      s:22631,PREL

     2573    22619    2          THEN
     2574    22620    3             DO;

     2575    22621
     2576    22622        /* Bad N ( R )                                                */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:299  
     2577    22623
     2578    22624    3                FEVENT = %Y_EV_BAD_NR#;

  22624   2 000D42  3C17                                 LDV,R3   23
          2 000D43  BF47 0024                            STR,R3   FEVENT,AUTO

     2579    22625    3                RETURN;

  22625   2 000D45  ECC7 0034                            LDB,B6   NR+3,AUTO
          2 000D47  C3C6 0001                            LNJ,B4   1,B6

     2580    22626
     2581    22627    3             END /* IF */;
     2582    22628
     2583    22629        /* Restore TEMP2 and TEMP4                                */
     2584    22630
     2585    22631    2       TEMP2 = NR;

  22631   2 000D49  D2C7 0031                            LLH,R5   NR,AUTO
          2 000D4B  DF47 002D                            STR,R5   TEMP2,AUTO

     2586    22632    2       TEMP4 = KX$L2.VS;

  22632   2 000D4D  C845 002C                            LDR,R4   44,B5
          2 000D4F  C570 00FF                            AND,R4   255,IMO
          2 000D51  CF47 002F                            STR,R4   TEMP4,AUTO

     2587    22633
     2588    22634        /* Does N' ( R )  already match N ( R )                           */
     2589    22635
     2590    22636    2       IF ( TEMP3 ~= TEMP2 )

  22636   2 000D53  E955                                 CMR,R6   R5
          2 000D54  0901 0070                            BE       s:22692,PREL

     2591    22637    2          THEN
     2592    22638    3             DO;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:300  

     2593    22639
     2594    22640        /* Not a match,  reset BLK and reset the retry count       */
     2595    22641
     2596    22642    3                KX$L2.FLG.BLK = '0'B;

  22642   2 000D56  8845 002E                            LBF,'8000'X       46,B5
  22642   2 000D58       8000

     2597    22643    3                KX$L2.RC = 0;

  22643   2 000D59  8845 0017                            LBF,'00FF'X       23,B5
  22643   2 000D5B       00FF

     2598    22644
     2599    22645        /* Loop thru and update N' ( R )                              */
     2600    22646
     2601    22647    4                DO UNTIL ( TEMP3 = TEMP2 );

     2602    22648
     2603    22649        /* Increment N' ( R )                                         */
     2604    22650
     2605    22651    4                   TEMP3 = MOD(TEMP3 + 1, 8+120*BITBIN(KX$L2.FLG.EXTSEQ));

  22651   2 000D5C  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000D5E  E846 002F                            LDR,R6   47,B6
          2 000D60  604F                                 SOR,R6   15
          2 000D61  F847 002E                            LDR,R7   TEMP3,AUTO
          2 000D63  EF47 0038                            STR,R6   ADDRESS+4,AUTO
          2 000D65  6C00                                 LDV,R6   0
          2 000D66  8470 0000 0001                       AID      1,IMO
          2 000D69  D847 0038                            LDR,R5   ADDRESS+4,AUTO
          2 000D6B  5F78                                 MLV,R5   120
          2 000D6C  5E08                                 ADV,R5   8
          2 000D6D  F355                                 DIV,R7   R5
          2 000D6E  EF47 002E                            STR,R6   TEMP3,AUTO

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:301  
     2606    22652        /* Decrement the outstanding I frame count                */
     2607    22653
     2608    22654    4                   KX$L2.I_CNT = KX$L2.I_CNT - 1;

  22654   2 000D70  C846 002F                            LDR,R4   47,B6
          2 000D72  CA70 00FF                            ADD,R4   255,IMO
          2 000D74  CAC6 002F                            SRM,R4,'00FF'X    47,B6
          2 000D76       00FF

     2609    22655
     2610    22656        /* Release the frame if it does not contain a data packet */
     2611    22657
     2612    22658    4                   TEMP3$ = KX$L2.I_LIST_HEAD$;

  22658   2 000D77  DCC6 0030                            LDB,B5   48,B6
          2 000D79  DFC7 0010                            STB,B5   TEMP3$,AUTO

     2613    22659
     2614    22660        /* Fix the head pointer                              */
     2615    22661
     2616    22662    4                   KX$L2.I_LIST_HEAD$ = TEMP3$ -> KX$TDATA.L2_LIST$;

  22662   2 000D7B  CCC5 0002                            LDB,B4   2,B5
          2 000D7D  CFC6 0030                            STB,B4   48,B6

     2617    22663
     2618    22664        /* Check for buffer release                               */
     2619    22665
     2620    22666    4                   TEMP3$ -> KX$DATA.RLS.L2 = '1'B;

  22666   2 000D7F  8945 0006                            LBT,'4000'X       6,B5
  22666   2 000D81       4000

     2621    22667    4                   IF ( TEMP3$ -> KX$TDATA.RLS_STAT = %KX_BFR_RLS_OK# )

  22667   2 000D82  ECC7 0010                            LDB,B6   TEMP3$,AUTO
          2 000D84  E846 0006                            LDR,R6   6,B6
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:302  
          2 000D86  604D                                 SOR,R6   13
          2 000D87  6D07                                 CMV,R6   7
          2 000D88  0981 000D                            BNE      s:22670,PREL

     2622    22668    4                      THEN
     2623    22669    4                         CALL KXS$RLSBFR ( TEMP3$ );

  22669   2 000D8A  DBC7 0010                            LAB,B5   TEMP3$,AUTO
          2 000D8C  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000D8E  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000D90  CBF0 0100                            LAB,B4   256,IMO
          2 000D92  E380 0000 0000  xent                 LNJ,B6   KXS$RLSBFR
          2 000D95       0001                            DC       s:22670,PREL

     2624    22670    4                END /* LOOP */;

  22670   2 000D96  E847 002E                            LDR,R6   TEMP3,AUTO
          2 000D98  E947 002D                            CMR,R6   TEMP2,AUTO
          2 000D9A  09C2                                 BNE      s:22651,SPREL

     2625    22671
     2626    22672        /* Return N' ( R )  to the context block                      */
     2627    22673
     2628    22674    3                KX$L2.NPR = TEMP3;

  22674   2 000D9B  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000D9D  E7C6 002C                            STH,R6   44,B6

     2629    22675
     2630    22676    3                IF KX$L2.FLG.POLL_S AND FEVENT ~= %Y_EV_RR_F#

  22676   2 000D9F  82C6 002E                            LB,'0200'X        46,B6
  22676   2 000DA1       0200
          2 000DA2  0581 0010                            BBF      s:22684,PREL
          2 000DA4  E847 0024                            LDR,R6   FEVENT,AUTO
          2 000DA6  6D0F                                 CMV,R6   15
          2 000DA7  0901 000B                            BE       s:22684,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:303  
          2 000DA9  6D11                                 CMV,R6   17
          2 000DAA  0901 0008                            BE       s:22684,PREL
          2 000DAC  6D13                                 CMV,R6   19
          2 000DAD  0901 0005                            BE       s:22684,PREL

     2631    22677    3                   AND FEVENT ~= %Y_EV_RNR_F#
     2632    22678    3                   AND FEVENT ~= %Y_EV_REJ_F#
     2633    22679    3                   THEN
     2634    22680    3                      RETURN;

  22680   2 000DAF  ECC7 0034                            LDB,B6   NR+3,AUTO
          2 000DB1  C3C6 0001                            LNJ,B4   1,B6

     2635    22681
     2636    22682        /* Are there any outstanding I frames                     */
     2637    22683
     2638    22684    3                CALL Y$STOP_TIMER;

  22684   2 000DB3  E3C0 0298                            LNJ,B6   s:0,PREL
          2 000DB5       0001                            DC       s:22685,PREL

     2639    22685    3                IF (KX$L2.T1 ~= 0) AND (KX$L2.I_CNT ~= 0)

  22685   2 000DB6  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000DB8  82C6 0016                            LB,'00FF'X        22,B6
          2 000DBA       00FF
          2 000DBB  0581 0009                            BBF      s:22692,PREL
          2 000DBD  82C6 002F                            LB,'00FF'X        47,B6
          2 000DBF       00FF
          2 000DC0  0581 0004                            BBF      s:22692,PREL

     2640    22686    3                   THEN
     2641    22687    4                      DO;

     2642    22688    4                         CALL Y$START_TIMER;

  22688   2 000DC2  E3C0 0335                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:304  
          2 000DC4       0001                            DC       s:22692,PREL

     2643    22689    4                      END;

     2644    22690    3             END;  /*  IF ( TEMP3 ~= TEMP2)   */

     2645    22691
     2646    22692    2   END /* SUBROUTINE */;

  22692   2 000DC5  ECC7 0034                            LDB,B6   NR+3,AUTO
          2 000DC7  C3C6 0001                            LNJ,B4   1,B6

     2647    22693        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:305  
     2648    22694    1   Y$RESET: PROC;

  22694   2 000DC9  EFC7 0032            Y$RESET         STB,B6   NR+1,AUTO

     2649    22695
     2650    22696        /*I* NAME: Y$RESET,  Y$RESET_RETRAN                        */
     2651    22697        /*I* PURPOSE: This subroutine resets the line context block                   */
     2652    22698        /*I* to its start condition. Unacknowledged I frames are  */
     2653    22699        /*I* either retransmitted or released.                    */
     2654    22700        /*I* CALL: CALL Y$RESET                                   */
     2655    22701        /*I* INPUT: CTX$  =  line context block                     */
     2656    22702        /*I* OUTPUT: none                                         */
     2657    22703
     2658    22704        /* RESET releases unacknowledged I frames                 */
     2659    22705
     2660    22706    2       TEMP2 = 0;

  22706   2 000DCB  8747 002D                            CL       TEMP2,AUTO

     2661    22707    2       KX$L2.FLG.RESTART = '0'B;

  22707   2 000DCD  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 000DCF  8845 002E                            LBF,'0008'X       46,B5
          2 000DD1       0008

     2662    22708    2       KX$L2.FLG.RESTART_PEND = '0'B;

  22708   2 000DD2  8845 002E                            LBF,'0004'X       46,B5
  22708   2 000DD4       0004

     2663    22709
     2664    22710    2       GOTO SUBCOMMON; /* LOOK BELOW */

  22710   2 000DD5  0F81 0006                            B        s:22716,PREL

     2665    22711
     2666    22712    2   Y$RESET_RETRAN: ENTRY;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:306  

  22712   2 000DD7  EFC7 0032            Y$RESET_RETRAN  STB,B6   NR+1,AUTO

     2667    22713
     2668    22714        /* RESET_RETRAN retransmits unacknowledged I frames       */
     2669    22715
     2670    22716    2       TEMP2 = 1;

  22716   2 000DD9  6C01                                 LDV,R6   1
          2 000DDA  EF47 002D                            STR,R6   TEMP2,AUTO

  22716   2                              SUBCOMMON       null
     2671    22717
     2672    22718    2   SUBCOMMON: ;                            /* THERE MUST BE AN ALTENTRY ABOVE ME */
     2673    22719
     2674    22720        /* Reset the context block                                */
     2675    22721
     2676    22722    2       KX$L2.RC = 0;

  22722   2 000DDC  ECC7 0006            SUBCOMMON       LDB,B6   CTX$,AUTO
          2 000DDE  8846 0017                            LBF,'00FF'X       23,B6
          2 000DE0       00FF

     2677    22723    2       KX$L2.NPR = 0;

  22723   2 000DE1  87C6 002C                            CLH      44,B6

     2678    22724    2       KX$L2.VS = 0;

  22724   2 000DE3  8846 002C                            LBF,'00FF'X       44,B6
  22724   2 000DE5       00FF

     2679    22725    2       KX$L2.VR = 0;

  22725   2 000DE6  8846 002D                            LBF,'00FF'X       45,B6
  22725   2 000DE8       00FF

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:307  
     2680    22726    2       KX$L2.FLG.BLK = '0'B;

  22726   2 000DE9  8846 002E                            LBF,'8000'X       46,B6
  22726   2 000DEB       8000

     2681    22727    2       KX$L2.FLG.DCE_BUSY = '0'B;

  22727   2 000DEC  8846 002E                            LBF,'4000'X       46,B6
  22727   2 000DEE       4000

     2682    22728    2       KX$L2.FLG.DCE_REJ = '0'B;

  22728   2 000DEF  8846 002E                            LBF,'0100'X       46,B6
  22728   2 000DF1       0100

     2683    22729    2       KX$L2.FLG.DTE_REJ = '0'B;

  22729   2 000DF2  8846 002E                            LBF,'0040'X       46,B6
  22729   2 000DF4       0040

     2684    22730    2       KX$L2.DCE_I_CNT = 0;

  22730   2 000DF5  87C6 002D                            CLH      45,B6

     2685    22731    2       CALL Y$STOP_TIMER;

  22731   2 000DF7  E3C0 0254                            LNJ,B6   s:0,PREL
          2 000DF9       0001                            DC       s:22732,PREL

     2686    22732    2       CALL Y$STOP_T20;

  22732   2 000DFA  E3C0 0283                            LNJ,B6   s:0,PREL
          2 000DFC       0001                            DC       s:22736,PREL

     2687    22733
     2688    22734        /* Are there unacknowledged I frames?                     */
     2689    22735
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:308  
     2690    22736    2       IF ( KX$L2.I_CNT ~= 0 )

  22736   2 000DFD  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000DFF  82C6 002F                            LB,'00FF'X        47,B6
          2 000E01       00FF
          2 000E02  0581 0096                            BBF      s:22818,PREL

     2691    22737    2          THEN
     2692    22738    3             DO;

     2693    22739
     2694    22740        /* Yes  -  are they to be retransmitted?                    */
     2695    22741
     2696    22742    3                IF TEMP2 ~= 0

  22742   2 000E04  E847 002D                            LDR,R6   TEMP2,AUTO
          2 000E06  6901 0059                            BEZ,R6   s:22798,PREL

     2697    22743    3                   THEN
     2698    22744    4                      DO;

     2699    22745
     2700    22746        /* Yes  -  as they are being retransmitted,  change the send */
     2701    22747        /* sequence number and rest the receive sequence number   */
     2702    22748        /* Further comments are missing                           */
     2703    22749
     2704    22750    4                         DAT$ = KX$L2.I_LIST_HEAD$;

  22750   2 000E08  DCC6 0030                            LDB,B5   48,B6
          2 000E0A  DFC7 0008                            STB,B5   DAT$,AUTO

     2705    22751    4                         TEMP2 = 0;

  22751   2 000E0C  8747 002D                            CL       TEMP2,AUTO

     2706    22752    5                         DO WHILE ( DAT$ ~= ADDR(NIL) ); /* LOOP START           */

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:309  
  22752   2 000E0E  0F81 002B                            B        s:22766,PREL

     2707    22753    5                            IF NOT KX$L2.FLG.EXTSEQ

  22753   2 000E10  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000E12  89C6 002F                            CMZ      47,B6
          2 000E14  0801 0010                            BAL      s:22761,PREL

     2708    22754    5                               THEN
     2709    22755    6                                  DO;

     2710    22756    6                                     KX$FRAME.CTL_BITS.NS = TEMP2;

  22756   2 000E16  E847 002D                            LDR,R6   TEMP2,AUTO
          2 000E18  6001                                 SOL,R6   1
          2 000E19  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000E1B  EAC5 0008                            SRM,R6,'000E'X    8,B5
          2 000E1D       000E

     2711    22757    6                                     KX$FRAME.CTL_BITS.NR = 0;

  22757   2 000E1E  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000E20  8845 0008                            LBF,'00E0'X       8,B5
          2 000E22       00E0

     2712    22758    6                                  END;

  22758   2 000E23  0F81 000E                            B        s:22764,PREL

     2713    22759    5                               ELSE
     2714    22760    6                                  DO;

     2715    22761    6                                     KX$EXTFRAME.XCTL.CTL_BITS.NS = TEMP2;

  22761   2 000E25  E847 002D                            LDR,R6   TEMP2,AUTO
          2 000E27  6001                                 SOL,R6   1
          2 000E28  DCC7 0008                            LDB,B5   DAT$,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:310  
          2 000E2A  EAC5 0008                            SRM,R6,'00FE'X    8,B5
          2 000E2C       00FE

     2716    22762    6                                     KX$EXTFRAME.XCTL.NR = 0;

  22762   2 000E2D  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000E2F  8845 0009                            LBF,'FE00'X       9,B5
          2 000E31       FE00

     2717    22763    6                                  END;

     2718    22764    5                            TEMP2 = TEMP2 + 1;

  22764   2 000E32  8AC7 002D                            INC      TEMP2,AUTO

     2719    22765    5                            DAT$ = KX$DATA.L2_LIST$;

  22765   2 000E34  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000E36  CCC5 0002                            LDB,B4   2,B5
          2 000E38  CFC7 0008                            STB,B4   DAT$,AUTO

     2720    22766    5                         END /* LOOP */;

  22766   2 000E3A  8DC7 0008                            CMN      DAT$,AUTO
          2 000E3C  09D4                                 BNE      s:22753,SPREL

     2721    22767
     2722    22768        /* Store the current V ( S )                                  */
     2723    22769
     2724    22770    4                         KX$L2.VS = TEMP2;

  22770   2 000E3D  E847 002D                            LDR,R6   TEMP2,AUTO
          2 000E3F  EAC6 002C                            SRM,R6,'00FF'X    44,B6
          2 000E41       00FF

     2725    22771
     2726    22772        /* Check for blocked                                      */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:311  
     2727    22773
     2728    22774    4                         IF ( KX$L2.I_CNT >= KX$L2.K )

  22774   2 000E42  E846 002F                            LDR,R6   47,B6
          2 000E44  E570 00FF                            AND,R6   255,IMO
          2 000E46  D2C6 0016                            LLH,R5   22,B6
          2 000E48  E955                                 CMR,R6   R5
          2 000E49  0801 0004                            BAL      s:22780,PREL

     2729    22775    4                            THEN
     2730    22776    4                               KX$L2.FLG.BLK = '1'B;

  22776   2 000E4B  8946 002E                            LBT,'8000'X       46,B6
  22776   2 000E4D       8000

     2731    22777
     2732    22778        /* Is the I count non - zero?                               */
     2733    22779
     2734    22780    4                         IF ( KX$L2.I_CNT ~= 0 )

  22780   2 000E4E  82C6 002F                            LB,'00FF'X        47,B6
  22780   2 000E50       00FF
          2 000E51  0581 0009                            BBF      s:22790,PREL

     2735    22781    4                            THEN  /*  Reset the timer  */
     2736    22782    4                               IF KX$L2.T1 ~= 0

  22782   2 000E53  82C6 0016                            LB,'00FF'X        22,B6
  22782   2 000E55       00FF
          2 000E56  0581 0004                            BBF      s:22790,PREL

     2737    22783    4                                  THEN
     2738    22784    5                                     DO;

     2739    22785    5                                        CALL Y$START_TIMER;

  22785   2 000E58  E3C0 029F                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:312  
          2 000E5A       0001                            DC       s:22790,PREL

     2740    22786    5                                     END;

     2741    22787
     2742    22788        /* Do the retransmission                                  */
     2743    22789
     2744    22790    4                         CALL Y$RETRAN;

  22790   2 000E5B  E3C0 0041                            LNJ,B6   s:0,PREL
          2 000E5D       0001                            DC       s:22792,PREL

     2745    22791
     2746    22792    4                      END;

  22792   2 000E5E  0F81 003A                            B        s:22818,PREL

     2747    22793    3                   ELSE
     2748    22794    4                      DO;

     2749    22795
     2750    22796        /* Unacknowledged I frames are to be released             */
     2751    22797
     2752    22798    4                         DAT$ = KX$L2.I_LIST_HEAD$;

  22798   2 000E60  DCC6 0030                            LDB,B5   48,B6
          2 000E62  DFC7 0008                            STB,B5   DAT$,AUTO

     2753    22799    5                         DO WHILE ( DAT$ ~= ADDR(NIL) ); /* LOOP START           */

  22799   2 000E64  0F81 0022                            B        s:22806,PREL

     2754    22800    5                            TEMP3$ = KX$DATA.L2_LIST$;

  22800   2 000E66  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000E68  DCC6 0002                            LDB,B5   2,B6
          2 000E6A  DFC7 0010                            STB,B5   TEMP3$,AUTO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:313  

     2755    22801    5                            KX$DATA.RLS.L2 = '1'B;

  22801   2 000E6C  8946 0006                            LBT,'4000'X       6,B6
  22801   2 000E6E       4000

     2756    22802    5                            IF ( KX$DATA.RLS_STAT = %KX_BFR_RLS_OK# )

  22802   2 000E6F  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000E71  E846 0006                            LDR,R6   6,B6
          2 000E73  604D                                 SOR,R6   13
          2 000E74  6D07                                 CMV,R6   7
          2 000E75  0981 000D                            BNE      s:22805,PREL

     2757    22803    5                               THEN
     2758    22804    5                                  CALL KXS$RLSBFR ( DAT$ );

  22804   2 000E77  DBC7 0008                            LAB,B5   DAT$,AUTO
          2 000E79  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000E7B  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000E7D  CBF0 0100                            LAB,B4   256,IMO
          2 000E7F  E380 0000 0000  xent                 LNJ,B6   KXS$RLSBFR
          2 000E82       0001                            DC       s:22805,PREL

     2759    22805    5                            DAT$ = TEMP3$;

  22805   2 000E83  ECC7 0010                            LDB,B6   TEMP3$,AUTO
          2 000E85  EFC7 0008                            STB,B6   DAT$,AUTO

     2760    22806    5                         END /* LOOP */;

  22806   2 000E87  8DC7 0008                            CMN      DAT$,AUTO
          2 000E89  09DD                                 BNE      s:22800,SPREL

     2761    22807
     2762    22808        /* Clear any info about I lists                           */
     2763    22809
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:314  
     2764    22810    4                         KX$L2.I_CNT = 0;

  22810   2 000E8A  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000E8C  8846 002F                            LBF,'00FF'X       47,B6
          2 000E8E       00FF

     2765    22811    4                         KX$L2.I_LIST_HEAD$ = ADDR(NIL);

  22811   2 000E8F  DB80 0000 0000                       LAB,B5   0
          2 000E92  DFC6 0030                            STB,B5   48,B6

     2766    22812    4                         KX$L2.I_LIST_TAIL$ = ADDR(NIL);

  22812   2 000E94  CB80 0000 0000                       LAB,B4   0
          2 000E97  CFC6 0032                            STB,B4   50,B6

     2767    22813
     2768    22814    4                      END /* IF */;

     2769    22815
     2770    22816    3             END /* IF */;

     2771    22817
     2772    22818    2   END /* SUBROUTINE */;

  22818   2 000E99  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 000E9B  C3C6 0001                            LNJ,B4   1,B6

     2773    22819        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:315  
     2774    22820
     2775    22821        /*I* NAME: Y$RETRAN                                       */
     2776    22822        /*I* PURPOSE: Retransmit I frames                         */
     2777    22823        /*I* CALL: CALL Y$RETRAN                                  */
     2778    22824
     2779    22825    1   Y$RETRAN: PROC;

  22825   2 000E9D  EFC7 0034            Y$RETRAN        STB,B6   NR+3,AUTO

     2780    22826
     2781    22827        /* Is it safe to retransmit now?                          */
     2782    22828
     2783    22829    2       IF ( KX$L1.OUT_CCB_HEAD$ = ADDR(NIL) )

  22829   2 000E9F  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 000EA1  8DC5 000A                            CMN      10,B5
          2 000EA3  0981 002A                            BNE      s:22844,PREL
          2 000EA5  8DC5 000E                            CMN      14,B5
          2 000EA7  0981 0026                            BNE      s:22844,PREL

     2784    22830    2          AND ( KX$L1.OUT_Q_HEAD$ = ADDR(NIL) )
     2785    22831    2          THEN
     2786    22832    3             DO;

     2787    22833
     2788    22834        /* Yes  -  the I frames can't be on any L1 Q  -  retransmit now                  */
     2789    22835
     2790    22836    3                DAT$ = KX$L2.I_LIST_HEAD$;

  22836   2 000EA9  CCC5 0030                            LDB,B4   48,B5
          2 000EAB  CFC7 0008                            STB,B4   DAT$,AUTO

     2791    22837    4                DO WHILE ( DAT$ ~= ADDR(NIL) ); /* LOOP START*/

  22837   2 000EAD  0F81 001B                            B        s:22840,PREL

     2792    22838    4                   CALL KXN$CMND ( %KX_N_SEND_Q#, CHN$->KH$CHN, DAT$ );
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:316  

  22838   2 000EAF  EBF0 0008                            LAB,B6   8,IMO
          2 000EB1  DBC7 0008                            LAB,B5   DAT$,AUTO
          2 000EB3  DFC7 003C                            STB,B5   ADDRESS+8,AUTO
          2 000EB5  CCC7 000A                            LDB,B4   CHN$,AUTO
          2 000EB7  CFC7 003A                            STB,B4   ADDRESS+6,AUTO
          2 000EB9  EFC7 0038                            STB,B6   ADDRESS+4,AUTO
          2 000EBB  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000EBD  CBF0 0300                            LAB,B4   768,IMO
          2 000EBF  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 000EC2       0001                            DC       s:22839,PREL

     2793    22839    4                   DAT$ = KX$DATA.L2_LIST$;

  22839   2 000EC3  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000EC5  DCC6 0002                            LDB,B5   2,B6
          2 000EC7  DFC7 0008                            STB,B5   DAT$,AUTO

     2794    22840    4                END /* LOOP */;

  22840   2 000EC9  8DC7 0008                            CMN      DAT$,AUTO
          2 000ECB  09E4                                 BNE      s:22838,SPREL

     2795    22841
     2796    22842    3             END;

  22842   2 000ECC  0F81 0004                            B        s:22846,PREL

     2797    22843    2          ELSE                 /*  KXH will initiate the retransmission  */
     2798    22844    2             KX$L2.FLG.DCE_REJ = '1'B;

  22844   2 000ECE  8945 002E                            LBT,'0100'X       46,B5
  22844   2 000ED0       0100

     2799    22845
     2800    22846    2   END /* SUBROUTINE */;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:317  
  22846   2 000ED1  ECC7 0034                            LDB,B6   NR+3,AUTO
          2 000ED3  C3C6 0001                            LNJ,B4   1,B6

     2801    22847        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:318  
     2802    22848
     2803    22849        /*I* NAME: Y$UA                                           */
     2804    22850        /*I* PURPOSE: Send a UA or UA with final bit set          */
     2805    22851        /*I* CALL: CALL Y$UA                                      */
     2806    22852        /*I* INPUT: CTX$  ->  level 2 context                       */
     2807    22853        /*I* OUTPUT: None                                         */
     2808    22854
     2809    22855    1   Y$UA: PROC;

  22855   2 000ED5  EFC7 0032            Y$UA            STB,B6   NR+1,AUTO

     2810    22856
     2811    22857    2   DCL ADDRESS UBIN;
     2812    22858
     2813    22859        /* UA or UA_F                                             */
     2814    22860
     2815    22861    2       IF KX$L2.FLG.POLL_R

  22861   2 000ED7  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 000ED9  82C5 002E                            LB,'0400'X        46,B5
          2 000EDB       0400
          2 000EDC  0581 0006                            BBF      s:22865,PREL

     2816    22862    2          THEN
     2817    22863    2             CTL = %Y_CTL_UA_F#;

  22863   2 000EDE  6C73                                 LDV,R6   115
          2 000EDF  EF47 002A                            STR,R6   CTL,AUTO
          2 000EE1  0F81 0004                            B        s:22867,PREL

     2818    22864    2          ELSE
     2819    22865    2             CTL = %Y_CTL_UA#;

  22865   2 000EE3  6C63                                 LDV,R6   99
          2 000EE4  EF47 002A                            STR,R6   CTL,AUTO

     2820    22866
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:319  
     2821    22867    2       GOTO SEND_ADR_RESP;

  22867   2 000EE6  0F81 0018                            B        s:22890,PREL

     2822    22868
     2823    22869        /*I* NAME: Y$RESP                                         */
     2824    22870        /*I* PURPOSE: Send an RR or RNR with the final bit set    */
     2825    22871        /*I* CALL: CALL Y$RESP                                    */
     2826    22872
     2827    22873    2   Y$RESP: ENTRY;

  22873   2 000EE8  EFC7 0032            Y$RESP          STB,B6   NR+1,AUTO

     2828    22874
     2829    22875    2       IF KX$L2.FLG.DTE_BUSY

  22875   2 000EEA  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 000EEC  82C5 002E                            LB,'0080'X        46,B5
          2 000EEE       0080
          2 000EEF  0581 0006                            BBF      s:22879,PREL

     2830    22876    2          THEN
     2831    22877    2             CTL = %Y_CTL_RNR_P#;

  22877   2 000EF1  6C15                                 LDV,R6   21
          2 000EF2  EF47 002A                            STR,R6   CTL,AUTO
          2 000EF4  0F81 0004                            B        s:22880,PREL

     2832    22878    2          ELSE
     2833    22879    2             CTL = %Y_CTL_RR_P#;

  22879   2 000EF6  6C11                                 LDV,R6   17
          2 000EF7  EF47 002A                            STR,R6   CTL,AUTO

     2834    22880    2       KX$L2.DCE_I_CNT = 0;

  22880   2 000EF9  87C5 002D                            CLH      45,B5
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:320  

     2835    22881    2       GOTO SEND_ADR_RESP;

  22881   2 000EFB  0F81 0003                            B        s:22890,PREL

     2836    22882
     2837    22883    2   Y$SEND_RESPONSE: ENTRY;

  22883   2 000EFD  EFC7 0032            Y$SEND_RESPONSE STB,B6   NR+1,AUTO

     2838    22884        /*I* NAME: Y$SEND_RESPONSE                                */
     2839    22885        /*I* PURPOSE: This subroutine will send the requested response        */
     2840    22886        /*I* CALL: CALL Y$SEND_RESPONSE                           */
     2841    22887        /*I* INPUT: CTL  =  response to send                      */
     2842    22888
     2843    22889    2   SEND_ADR_RESP:
     2844    22890    2       ADDRESS = KX$L2.ADR_RESP;

  22890   2 000EFF  ECC7 0006            SEND_ADR_RESP   LDB,B6   CTX$,AUTO
          2 000F01  E846 001E                            LDR,R6   30,B6
          2 000F03  E570 00FF                            AND,R6   255,IMO
          2 000F05  EF47 0034                            STR,R6   ADDRESS,AUTO

     2845    22891    2       GOTO SEND_COMMON;

  22891   2 000F07  0F81 0009                            B        s:22905,PREL

     2846    22892
     2847    22893    2   Y$SEND_COMMAND: ENTRY;

  22893   2 000F09  EFC7 0032            Y$SEND_COMMAND  STB,B6   NR+1,AUTO

     2848    22894
     2849    22895        /*I* NAME: Y$SEND_COMMAND                                 */
     2850    22896        /*I* PURPOSE: This subroutine will send the requested command         */
     2851    22897        /*I* CALL: CALL Y$SEND_COMMAND                            */
     2852    22898        /*I* INPUT: CTL  =  command to send                       */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:321  
     2853    22899
     2854    22900    2       ADDRESS = KX$L2.ADR_CMND;

  22900   2 000F0B  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 000F0D  E2C5 001E                            LLH,R6   30,B5
          2 000F0F  EF47 0034                            STR,R6   ADDRESS,AUTO

     2855    22901
     2856    22902        /* Get a buffer                                           */
     2857    22903
     2858    22904    2   SEND_COMMON:
     2859    22905    2       CALL KXS$GETBFR ( 0, DAT$ );

  22905   2 000F11  EBF0 0000            SEND_COMMON     LAB,B6   0,IMO
          2 000F13  DBC7 0008                            LAB,B5   DAT$,AUTO
          2 000F15  DFC7 003A                            STB,B5   ADDRESS+6,AUTO
          2 000F17  EFC7 0038                            STB,B6   ADDRESS+4,AUTO
          2 000F19  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000F1B  CBF0 0200                            LAB,B4   512,IMO
          2 000F1D  E380 0000 0000  xent                 LNJ,B6   KXS$GETBFR
          2 000F20       0001                            DC       s:22906,PREL

     2860    22906    2       KX$DATA.RLS.L3 = '1'B;

  22906   2 000F21  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000F23  8946 0006                            LBT,'8000'X       6,B6
          2 000F25       8000

     2861    22907    2       KX$DATA.RLS.L2 = '1'B;

  22907   2 000F26  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000F28  8946 0006                            LBT,'4000'X       6,B6
          2 000F2A       4000

     2862    22908
     2863    22909        /* Figure out the data size and where the P/F bit should be */
     2864    22910
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:322  
     2865    22911    2       IF ( MOD(CTL,4)=1 AND KX$L2.FLG.EXTSEQ )

  22911   2 000F2B  E847 002A                            LDR,R6   CTL,AUTO
          2 000F2D  E570 0003                            AND,R6   3,IMO
          2 000F2F  6D01                                 CMV,R6   1
          2 000F30  0981 001F                            BNE      s:22923,PREL
          2 000F32  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000F34  89C6 002F                            CMZ      47,B6
          2 000F36  0881 0019                            BAGE     s:22923,PREL

     2866    22912    2          THEN
     2867    22913    3             DO;

     2868    22914    3                KX$DATA.CNT = 3;

  22914   2 000F38  DCC7 0008                            LDB,B5   DAT$,AUTO
          2 000F3A  6C03                                 LDV,R6   3
          2 000F3B  EF45 0007                            STR,R6   7,B5

     2869    22915    3                IF ( BINBIT(CTL,8) & '00010000'B )  /* polled RR/RNR/REJ */

  22915   2 000F3D  D847 002A                            LDR,R5   CTL,AUTO
          2 000F3F  5008                                 SOL,R5   8
          2 000F40  D570 1000                            AND,R5   4096,IMO
          2 000F42  5901 0012                            BEZ,R5   s:22925,PREL

     2870    22916    3                   THEN
     2871    22917    4                      DO;

     2872    22918    4                         CTL = CTL - BITBIN('00010000'B);

  22918   2 000F44  D847 002A                            LDR,R5   CTL,AUTO
          2 000F46  5EF0                                 ADV,R5   -16
          2 000F47  DF47 002A                            STR,R5   CTL,AUTO

     2873    22919    4                         KX$EXTFRAME.XCTL.PF = '1'B; /* puts P/F bit in right place */

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:323  
  22919   2 000F49  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000F4B  8946 0009                            LBT,'0100'X       9,B6
          2 000F4D       0100

     2874    22920    4                      END;

     2875    22921    3             END;

  22921   2 000F4E  0F81 0006                            B        s:22925,PREL

     2876    22922    2          ELSE
     2877    22923    2             KX$DATA.CNT = 2;

  22923   2 000F50  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000F52  6C02                                 LDV,R6   2
          2 000F53  EF46 0007                            STR,R6   7,B6

     2878    22924
     2879    22925    2       KX$FRAME.ADR = ADDRESS;

  22925   2 000F55  E847 0034                            LDR,R6   ADDRESS,AUTO
          2 000F57  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000F59  E7C6 0008                            STH,R6   8,B6

     2880    22926
     2881    22927    2       KX$FRAME.CTL = CTL;

  22927   2 000F5B  D847 002A                            LDR,R5   CTL,AUTO
          2 000F5D  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 000F5F  DAC6 0008                            SRM,R5,'00FF'X    8,B6
          2 000F61       00FF

     2882    22928        /* Send the buffer                                        */
     2883    22929
     2884    22930    2       CALL KXN$CMND ( %KX_N_SUPV_Q#, CHN$->KH$CHN, DAT$ );

  22930   2 000F62  EBF0 000B                            LAB,B6   11,IMO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:324  
          2 000F64  DBC7 0008                            LAB,B5   DAT$,AUTO
          2 000F66  DFC7 003C                            STB,B5   ADDRESS+8,AUTO
          2 000F68  CCC7 000A                            LDB,B4   CHN$,AUTO
          2 000F6A  CFC7 003A                            STB,B4   ADDRESS+6,AUTO
          2 000F6C  EFC7 0038                            STB,B6   ADDRESS+4,AUTO
          2 000F6E  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000F70  CBF0 0300                            LAB,B4   768,IMO
          2 000F72  E380 0000 0000  xent                 LNJ,B6   KXN$CMND
          2 000F75       0001                            DC       s:22932,PREL

     2885    22931
     2886    22932    2   END /* SUBROUTINE */;

  22932   2 000F76  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 000F78  C3C6 0001                            LNJ,B4   1,B6

     2887    22933        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:325  
     2888    22934
     2889    22935        /*I* NAME: Y$STOP,  Y$DIED                                 */
     2890    22936        /*I* PURPOSE: Report STOP or DIED to packet level */
     2891    22937
     2892    22938    1   Y$STOP: PROC;

  22938   2 000F7A  EFC7 0032            Y$STOP          STB,B6   NR+1,AUTO

     2893    22939
     2894    22940    2       PEVENT = %KX_P_EV_STOP_ALL#;

  22940   2 000F7C  6C18                                 LDV,R6   24
          2 000F7D  EF47 0027                            STR,R6   PEVENT,AUTO

     2895    22941
     2896    22942    2       GOTO SUBCOMMON;

  22942   2 000F7F  0F81 0006                            B        s:22946,PREL

     2897    22943
     2898    22944    2   Y$DIED: ENTRY;

  22944   2 000F81  EFC7 0032            Y$DIED          STB,B6   NR+1,AUTO

     2899    22945
     2900    22946    2       PEVENT = %KX_P_EV_DIED_ALL#;

  22946   2 000F83  6C19                                 LDV,R6   25
          2 000F84  EF47 0027                            STR,R6   PEVENT,AUTO

  22946   2                              SUBCOMMON       null
     2901    22947
     2902    22948    2   SUBCOMMON: ;                            /* THERE MUST BE AN ALTENTRY ABOVE ME */
     2903    22949
     2904    22950    2       CALL_FPT = '0'B;

  22950   2 000F86  5C20                 SUBCOMMON       LDV,R5   32
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:326  
          2 000F87  0021                                 ALR      ;
          2 000F88       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 000F8A       4007 0012                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

     2905    22951    2       CALL_FPT.EVN = PEVENT;

  22951   2 000F8C  437F                                 CSYNC    s:22946+5,SPREL
          2 000F8D  E847 0027                            LDR,R6   PEVENT,AUTO
          2 000F8F  EF47 0012                            STR,R6   CALL_FPT,AUTO

     2906    22952    2       CALL_FPT.CAL$ = CTX$;

  22952   2 000F91  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 000F93  EFC7 0013                            STB,B6   CALL_FPT+1,AUTO

     2907    22953    2       CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN

  22953   2 000F95  DBC7 0012                            LAB,B5   CALL_FPT,AUTO
          2 000F97  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 000F99  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000F9B  CBF0 0100                            LAB,B4   256,IMO
          2 000F9D  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 000FA0       0003                            DC       s:22955,PREL
          2 000FA1  0F81 0009                            B        s:22957,PREL

     2908    22954    3             DO;

     2909    22955    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  22955   2 000FA3  BBC7 0019                            LAB,B3   CALL_FPT+7,AUTO
          2 000FA5  CBF0 0100                            LAB,B4   256,IMO
          2 000FA7  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000FAA       0001                            DC       s:22957,PREL

     2910    22956    3             END;

     2911    22957    2   END /* SUBROUTINE */;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:327  

  22957   2 000FAB  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 000FAD  C3C6 0001                            LNJ,B4   1,B6

     2912    22958        %EJECT ;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:328  
     2913    22959    1   Y$ER: PROC;

  22959   2 000FAF  EFC7 0034            Y$ER            STB,B6   ADDRESS,AUTO

     2914    22960               %WRSYSLOG   (  ERRCOD=ERCOD ,
     2915    22961                              TRMID = "KX$L1.CHN$->KH$CHN.TERMID" ) ;

  22977   2 000FB1  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 000FB3  CCC5 0002                            LDB,B4   2,B5
          2 000FB5  BB80 0000 0000                       LAB,B3   0
          2 000FB8  BFC7 003C                            STB,B3   ADDRESS+8,AUTO
          2 000FBA  ABC4 0012                            LAB,B2   18,B4
          2 000FBC  AFC7 003A                            STB,B2   ADDRESS+6,AUTO
          2 000FBE  CBC7 0022                            LAB,B4   ERCOD,AUTO
          2 000FC0  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000FC2  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000FC4  CBF0 0300                            LAB,B4   768,IMO
          2 000FC6  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 000FC9       0001                            DC       s:22979,PREL

     2916    22979    2       RETURN ;

  22979   2 000FCA  ECC7 0034                            LDB,B6   ADDRESS,AUTO
          2 000FCC  C3C6 0001                            LNJ,B4   1,B6

     2917    22980    2   END ;
     2918    22981
     2919    22982    1   Y$ER2: PROC;

  22982   2 000FCE  EFC7 0032            Y$ER2           STB,B6   NR+1,AUTO

     2920    22983               %WRSYSLOG   (  ERRCOD=ERCOD ,
     2921    22984                  TRMID = "KX$L1.CHN$ -> KH$CHN.TERMID",
     2922    22985                  VAL0 = FEVENT,
     2923    22986                  VAL1 = FPT_X25.EVN,
     2924    22987                  VAL2 = KX$L2.STATES );

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:329  
  23003   2 000FD0  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 000FD2  CCC5 0002                            LDB,B4   2,B5
          2 000FD4  BBC5 001D                            LAB,B3   29,B5
          2 000FD6  BFC7 0042                            STB,B3   ADDRESS+14,AUTO
          2 000FD8  ACC7 0004                            LDB,B2   @FPT_X25,AUTO
          2 000FDA  AFC7 0040                            STB,B2   ADDRESS+12,AUTO
          2 000FDC  9BC7 0024                            LAB,B1   FEVENT,AUTO
          2 000FDE  9FC7 003E                            STB,B1   ADDRESS+10,AUTO
          2 000FE0  EB80 0000 0000                       LAB,B6   0
          2 000FE3  EFC7 003C                            STB,B6   ADDRESS+8,AUTO
          2 000FE5  EBC4 0012                            LAB,B6   18,B4
          2 000FE7  EFC7 003A                            STB,B6   ADDRESS+6,AUTO
          2 000FE9  CBC7 0022                            LAB,B4   ERCOD,AUTO
          2 000FEB  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 000FED  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 000FEF  CBF0 0600                            LAB,B4   1536,IMO
          2 000FF1  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 000FF4       0001                            DC       s:23005,PREL

     2925    23005    2       RETURN ;

  23005   2 000FF5  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 000FF7  C3C6 0001                            LNJ,B4   1,B6

     2926    23006    2   END ;
     2927    23007
     2928    23008        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:330  
     2929    23009
     2930    23010    1   Y$UP: PROC;

  23010   2 000FF9  EFC7 0032            Y$UP            STB,B6   NR+1,AUTO

     2931    23011
     2932    23012        /*I*
     2933    23013             NAME: Y$UP
     2934    23014             PURPOSE: Frame level is up. Stop timer, set L2.OK,
     2935    23015                      init Packet level, and log.
     2936    23016             CALL: CALL Y$UP
     2937    23017        */
     2938    23018
     2939    23019        /* Stop the timer                                         */
     2940    23020
     2941    23021    2       CALL Y$STOP_TIMER;

  23021   2 000FFB  E3C0 0050                            LNJ,B6   s:0,PREL
          2 000FFD       0001                            DC       s:23026,PREL

     2942    23022
     2943    23023        /*
     2944    23024           Tell KHA that link is active.
     2945    23025        */
     2946    23026    2       CALL KHA$LINE_ACTIVE ( KX$L1.CHN$->KH$CHN.TERMID );

  23026   2 000FFE  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 001000  DCC6 0002                            LDB,B5   2,B6
          2 001002  CBC5 0012                            LAB,B4   18,B5
          2 001004  CFC7 0038                            STB,B4   ADDRESS+4,AUTO
          2 001006  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 001008  CBF0 0100                            LAB,B4   256,IMO
          2 00100A  E380 0000 0000  xent                 LNJ,B6   KHA$LINE_ACTIVE
          2 00100D       0001                            DC       s:23030,PREL

     2947    23027
     2948    23028        /* Kludge by setting the OK flag                          */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:331  
     2949    23029
     2950    23030    2       KX$L2.FLG.OK = '1'B;

  23030   2 00100E  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 001010  8946 002E                            LBT,'0800'X       46,B6
          2 001012       0800

     2951    23031
     2952    23032        /* Tell the level 3 stuff to initialize                   */
     2953    23033
     2954    23034    2       CALL_FPT = '0'B;

  23034   2 001013  5C20                                 LDV,R5   32
          2 001014  0021                                 ALR      ;
          2 001015       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 001017       4007 0012                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

     2955    23035    2       CALL_FPT.EVN = %KX_P_EV_INIT#;

  23035   2 001019  437F                                 CSYNC    s:23034+5,SPREL
          2 00101A  8747 0012                            CL       CALL_FPT,AUTO

     2956    23036    2       CALL_FPT.CAL$ = CTX$;

  23036   2 00101C  EFC7 0013                            STB,B6   CALL_FPT+1,AUTO

     2957    23037    2       CALL KXP$PACKET ( CALL_FPT )

  23037   2 00101E  DBC7 0012                            LAB,B5   CALL_FPT,AUTO
          2 001020  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 001022  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 001024  CBF0 0100                            LAB,B4   256,IMO
          2 001026  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 001029       0003                            DC       s:23039,PREL
          2 00102A  0F81 0009                            B        s:23044,PREL

     2958    23038    3          WHENALTRETURN DO;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:332  

     2959    23039    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  23039   2 00102C  BBC7 0019                            LAB,B3   CALL_FPT+7,AUTO
          2 00102E  CBF0 0100                            LAB,B4   256,IMO
          2 001030  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 001033       0001                            DC       s:23044,PREL

     2960    23040    3             END;

     2961    23041
     2962    23042        /* Log the action                                         */
     2963    23043
     2964    23044    2       ERCOD = UP ;

  23044   2 001034  8C80 0000 01A2  00                   LDI      UP
          2 001037  8D47 0022                            SDI      ERCOD,AUTO

     2965    23045    2       CALL Y$ER ;

  23045   2 001039  E3C0 FF75                            LNJ,B6   s:0,PREL
          2 00103B       0001                            DC       s:23050,PREL

     2966    23046
     2967    23047
     2968    23048        /* Stats                                                  */
     2969    23049
     2970    23050    2       KX_STATS_HDLC.LINES = KX_STATS_HDLC.LINES + 1;

  23050   2 00103C  8A80 0000 0015  xsym                 INC      KX_STATS_HDLC+21
          2 00103F  8E80 0000 0014  xsym                 CAD      KX_STATS_HDLC+20

     2971    23051    2       KX_STATS_HDLC.CONNECTS = KX_STATS_HDLC.CONNECTS + 1;

  23051   2 001042  8A80 0000 0017  xsym                 INC      KX_STATS_HDLC+23
          2 001045  8E80 0000 0016  xsym                 CAD      KX_STATS_HDLC+22

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:333  
     2972    23052
     2973    23053
     2974    23054    2   END Y$UP;

  23054   2 001048  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 00104A  C3C6 0001                            LNJ,B4   1,B6

     2975    23055
     2976    23056        %EJECT ;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:334  
     2977    23057    1   Y$STOP_TIMER:

  23057   2 00104C  EFC7 0036            Y$STOP_TIMER    STB,B6   ADDRESS+2,AUTO

     2978    23058    1       PROC ;
     2979    23059                  %STOP_TIMER ( FPTN = KX$L2.TMRBLK );

  23064   2 00104E  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 001050  89C5 0047                            CMZ      71,B5
          2 001052  0881 0027                            BAGE     s:23068,PREL

  23064   2 001054  8845 0047                            LBF,'8000'X       71,B5
  23064   2 001056       8000

  23064   2 001057  8DC5 003E                            CMN      62,B5
          2 001059  0981 0008                            BNE      s:23064+20,PREL

  23064   2 00105B  CCC5 0040                            LDB,B4   64,B5
          2 00105D  CF80 0000 0002  xsym                 STB,B4   KX_TMRBLK+2
          2 001060  0F81 0007                            B        s:23065,PREL

  23064   2 001062  CCC5 003E                            LDB,B4   62,B5
          2 001064  BCC5 0040                            LDB,B3   64,B5
          2 001066  BFC4 0002                            STB,B3   2,B4

  23065   2 001068  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00106A  8DC6 0040                            CMN      64,B6
          2 00106C  0981 0008                            BNE      s:23065+13,PREL

  23065   2 00106E  DCC6 003E                            LDB,B5   62,B6
          2 001070  DF80 0000 0000  xsym                 STB,B5   KX_TMRBLK
          2 001073  0F81 0006                            B        s:23068,PREL

  23065   2 001075  DCC6 0040                            LDB,B5   64,B6
          2 001077  CCC6 003E                            LDB,B4   62,B6
          2 001079  CF85                                 STB,B4   ,B5

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:335  
     2980    23068    2       RETURN ;

  23068   2 00107A  ECC7 0036                            LDB,B6   ADDRESS+2,AUTO
          2 00107C  C3C6 0001                            LNJ,B4   1,B6

     2981    23069    2   END ;
     2982    23070    1   Y$STOP_T20: PROC;

  23070   2 00107E  EFC7 0034            Y$STOP_T20      STB,B6   ADDRESS,AUTO

     2983    23071            %STOP_TIMER ( FPTN = KX$L2.T20TMR );

  23076   2 001080  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 001082  89C5 0051                            CMZ      81,B5
          2 001084  0881 0027                            BAGE     s:23080,PREL

  23076   2 001086  8845 0051                            LBF,'8000'X       81,B5
  23076   2 001088       8000

  23076   2 001089  8DC5 0048                            CMN      72,B5
          2 00108B  0981 0008                            BNE      s:23076+20,PREL

  23076   2 00108D  CCC5 004A                            LDB,B4   74,B5
          2 00108F  CF80 0000 0002  xsym                 STB,B4   KX_TMRBLK+2
          2 001092  0F81 0007                            B        s:23077,PREL

  23076   2 001094  CCC5 0048                            LDB,B4   72,B5
          2 001096  BCC5 004A                            LDB,B3   74,B5
          2 001098  BFC4 0002                            STB,B3   2,B4

  23077   2 00109A  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00109C  8DC6 004A                            CMN      74,B6
          2 00109E  0981 0008                            BNE      s:23077+13,PREL

  23077   2 0010A0  DCC6 0048                            LDB,B5   72,B6
          2 0010A2  DF80 0000 0000  xsym                 STB,B5   KX_TMRBLK
          2 0010A5  0F81 0006                            B        s:23080,PREL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:336  

  23077   2 0010A7  DCC6 004A                            LDB,B5   74,B6
          2 0010A9  CCC6 0048                            LDB,B4   72,B6
          2 0010AB  CF85                                 STB,B4   ,B5

     2984    23080    2       RETURN;

  23080   2 0010AC  ECC7 0034                            LDB,B6   ADDRESS,AUTO
          2 0010AE  C3C6 0001                            LNJ,B4   1,B6

     2985    23081    2   END;
     2986    23082
     2987    23083
     2988    23084
     2989    23085    1   Y$CAL_PAC:

  23085   2 0010B0  EFC7 0032            Y$CAL_PAC       STB,B6   NR+1,AUTO

     2990    23086    1       PROC ALTRET ;
     2991    23087    2       CALL_FPT = '0'B;

  23087   2 0010B2  5C20                                 LDV,R5   32
          2 0010B3  0021                                 ALR      ;
          2 0010B4       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 0010B6       4007 0012                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

     2992    23088    2       CALL_FPT.EVN = TEMP1 ;

  23088   2 0010B8  437F                                 CSYNC    s:23087+5,SPREL
          2 0010B9  E847 002C                            LDR,R6   TEMP1,AUTO
          2 0010BB  EF47 0012                            STR,R6   CALL_FPT,AUTO

     2993    23089    2       IF ADMIN_FPT.CHN$->KH$CHN.TERMID.TTYP=%KLTY_LINKDEV# THEN RETURN;

  23089   2 0010BD  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 0010BF  DCC6 000B                            LDB,B5   11,B6
          2 0010C1  C2C5 0012                            LLH,R4   18,B5
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:337  
          2 0010C3  4D0B                                 CMV,R4   11
          2 0010C4  0981 0005                            BNE      s:23090,PREL

  23089   2 0010C6  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 0010C8  C3C6 0001                            LNJ,B4   1,B6

     2994    23090    2       CALL_FPT.RCV$ = ADMIN_FPT.CHN$->KH$CHN.CTX$ ;

  23090   2 0010CA  CCC5 000C                            LDB,B4   12,B5
          2 0010CC  CFC7 0015                            STB,B4   CALL_FPT+3,AUTO
          2 0010CE  0F81 0003                            B        s:23092,PREL

     2995    23091    2   Y$CAL_PAC0: ENTRY ALTRET;

  23091   2 0010D0  EFC7 0032            Y$CAL_PAC0      STB,B6   NR+1,AUTO

     2996    23092    2       CALL_FPT.PRM1$ = ADDR( ADMIN_FPT ) ;

  23092   2 0010D2  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 0010D4  EFC7 0019                            STB,B6   CALL_FPT+7,AUTO
          2 0010D6  0F81 0003                            B        s:23094,PREL

     2997    23093    2   Y$CAL_PAC1: ENTRY ALTRET;

  23093   2 0010D8  EFC7 0032            Y$CAL_PAC1      STB,B6   NR+1,AUTO

     2998    23094    2       CALL_FPT.CAL$ = CTX$ ;

  23094   2 0010DA  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0010DC  EFC7 0013                            STB,B6   CALL_FPT+1,AUTO

     2999    23095    2       CALL KXP$PACKET (CALL_FPT)

  23095   2 0010DE  DBC7 0012                            LAB,B5   CALL_FPT,AUTO
          2 0010E0  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 0010E2  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0010E4  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:338  
          2 0010E6  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 0010E9       0003                            DC       s:23097,PREL
          2 0010EA  0F81 0009                            B        s:23099,PREL

     3000    23096    3          WHENALTRETURN DO;

     3001    23097    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  23097   2 0010EC  BBC7 0019                            LAB,B3   CALL_FPT+7,AUTO
          2 0010EE  CBF0 0100                            LAB,B4   256,IMO
          2 0010F0  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 0010F3       0001                            DC       s:23099,PREL

     3002    23098    3             END;

     3003    23099    2       RETURN ;

  23099   2 0010F4  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 0010F6  C3C6 0001                            LNJ,B4   1,B6

     3004    23100    2   END ;
     3005    23101
     3006    23102        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:339  
     3007    23103
     3008    23104    1   Y$START_TIMER: PROC;

  23104   2 0010F8  EFC7 0036            Y$START_TIMER   STB,B6   ADDRESS+2,AUTO

     3009    23105
     3010    23106        /*
     3011    23107            There are so many occurrences of %START_TIMER that it make more
     3012    23108            sense to do what the macro does in an internal routine.
     3013    23109        */
     3014    23110
     3015    23111    2       IF KX$L2.T1 ~= 0

  23111   2 0010FA  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 0010FC  82C5 0016                            LB,'00FF'X        22,B5
          2 0010FE       00FF
          2 0010FF  0581 0032                            BBF      s:23130,PREL

     3016    23112    2          THEN
     3017    23113    3             DO;

     3018    23114    3                KX$L2.TMRBLK.CNT = KX$L2.T1;

  23114   2 001101  E845 0016                            LDR,R6   22,B5
          2 001103  EAC5 0046                            SRM,R6,'00FF'X    70,B5
          2 001105       00FF

     3019    23115    3                IF NOT KX$L2.TMRBLK.ON

  23115   2 001106  89C5 0047                            CMZ      71,B5
          2 001108  0801 0053                            BAL      s:23146,PREL

     3020    23116    3                   THEN
     3021    23117    4                      DO;

     3022    23118    4                         KX$L2.TMRBLK.ON = '1'B;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:340  
  23118   2 00110A  8945 0047                            LBT,'8000'X       71,B5
  23118   2 00110C       8000

     3023    23119    4                         KX$L2.TMRBLK.FLNK$ = ADDR(NIL);

  23119   2 00110D  CB80 0000 0000                       LAB,B4   0
          2 001110  CFC5 003E                            STB,B4   62,B5

     3024    23120    4                         IF KX_TMRBLK.QTL$ = ADDR(NIL)

  23120   2 001112  8D80 0000 0002  xsym                 CMN      KX_TMRBLK+2
          2 001115  0981 0008                            BNE      s:23124,PREL

     3025    23121    4                            THEN
     3026    23122    4                               KX_TMRBLK.QHD$ = ADDR ( KX$L2.TMRBLK );

  23122   2 001117  BBC5 003E                            LAB,B3   62,B5
          2 001119  BF80 0000 0000  xsym                 STB,B3   KX_TMRBLK
          2 00111C  0F81 0007                            B        s:23125,PREL

     3027    23123    4                            ELSE
     3028    23124    4                              KX_TMRBLK.QTL$ -> KX$BTMRBLK.FLNK$ = ADDR ( KX$L2.TMRBLK
             23124                                        );

  23124   2 00111E  BBC5 003E                            LAB,B3   62,B5
          2 001120  AC80 0000 0002  xsym                 LDB,B2   KX_TMRBLK+2
          2 001123  BF82                                 STB,B3   ,B2

     3029    23125    4                         KX$L2.TMRBLK.BLNK$ = KX_TMRBLK.QTL$;

  23125   2 001124  EC80 0000 0002  xsym                 LDB,B6   KX_TMRBLK+2
          2 001127  DCC7 0006                            LDB,B5   CTX$,AUTO
          2 001129  EFC5 0040                            STB,B6   64,B5

     3030    23126    4                         KX_TMRBLK.QTL$ = ADDR ( KX$L2.TMRBLK );

  23126   2 00112B  CBC5 003E                            LAB,B4   62,B5
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:341  
          2 00112D  CF80 0000 0002  xsym                 STB,B4   KX_TMRBLK+2

     3031    23127    4                      END;

     3032    23128    3             END;

  23128   2 001130  0F81 002B                            B        s:23146,PREL

     3033    23129    2          ELSE
     3034    23130    2             IF KX$L2.TMRBLK.ON

  23130   2 001132  89C5 0047                            CMZ      71,B5
          2 001134  0881 0027                            BAGE     s:23146,PREL

     3035    23131    2                THEN
     3036    23132    3                   DO;

     3037    23133    3                      KX$L2.TMRBLK.ON = '0'B;

  23133   2 001136  8845 0047                            LBF,'8000'X       71,B5
  23133   2 001138       8000

     3038    23134    3                      IF KX$L2.TMRBLK.FLNK$ = ADDR(NIL)

  23134   2 001139  8DC5 003E                            CMN      62,B5
          2 00113B  0981 0008                            BNE      s:23138,PREL

     3039    23135    3                         THEN
     3040    23136    3                            KX_TMRBLK.QTL$ = KX$L2.TMRBLK.BLNK$;

  23136   2 00113D  CCC5 0040                            LDB,B4   64,B5
          2 00113F  CF80 0000 0002  xsym                 STB,B4   KX_TMRBLK+2
          2 001142  0F81 0007                            B        s:23139,PREL

     3041    23137    3                         ELSE
     3042    23138    3                           KX$L2.TMRBLK.FLNK$ -> KX$BTMRBLK.BLNK$ = KX$L2.TMRBLK.BLNK$
             23138                                     ;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:342  

  23138   2 001144  CCC5 003E                            LDB,B4   62,B5
          2 001146  BCC5 0040                            LDB,B3   64,B5
          2 001148  BFC4 0002                            STB,B3   2,B4

     3043    23139    3                      IF KX$L2.TMRBLK.BLNK$ = ADDR(NIL)

  23139   2 00114A  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00114C  8DC6 0040                            CMN      64,B6
          2 00114E  0981 0008                            BNE      s:23143,PREL

     3044    23140    3                         THEN
     3045    23141    3                            KX_TMRBLK.QHD$ = KX$L2.TMRBLK.FLNK$;

  23141   2 001150  DCC6 003E                            LDB,B5   62,B6
          2 001152  DF80 0000 0000  xsym                 STB,B5   KX_TMRBLK
          2 001155  0F81 0006                            B        s:23146,PREL

     3046    23142    3                         ELSE
     3047    23143    3                           KX$L2.TMRBLK.BLNK$ -> KX$BTMRBLK.FLNK$ = KX$L2.TMRBLK.FLNK$
             23143                                     ;

  23143   2 001157  DCC6 0040                            LDB,B5   64,B6
          2 001159  CCC6 003E                            LDB,B4   62,B6
          2 00115B  CF85                                 STB,B4   ,B5

     3048    23144    3                   END;

     3049    23145
     3050    23146    2       RETURN;

  23146   2 00115C  ECC7 0036                            LDB,B6   ADDRESS+2,AUTO
          2 00115E  C3C6 0001                            LNJ,B4   1,B6

     3051    23147
     3052    23148    2   END Y$START_TIMER;
     3053    23149        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:343  
     3054    23150
     3055    23151    1   Y$CLR_DAT_Q: PROC;

  23151   2 001160  EFC7 0032            Y$CLR_DAT_Q     STB,B6   NR+1,AUTO

     3056    23152
     3057    23153        /*I* NAME: Y$CLR_DAT_Q
     3058    23154             PURPOSE: Clear the queue of I frames
     3059    23155        */
     3060    23156    3       DO WHILE ( KX$L2.OUT_Q_HEAD$ ~= ADDR(NIL));

  23156   2 001162  0F81 0027                            B        s:23176,PREL

     3061    23157    3          DAT$ = KX$L2.OUT_Q_HEAD$;

  23157   2 001164  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 001166  DCC6 000E                            LDB,B5   14,B6
          2 001168  DFC7 0008                            STB,B5   DAT$,AUTO

     3062    23158    3          KX$L2.OUT_Q_HEAD$ = KX$DATA.NEXT$;

  23158   2 00116A  CC85                                 LDB,B4   ,B5
          2 00116B  CFC6 000E                            STB,B4   14,B6

     3063    23159        /*
     3064    23160                                             If all the other layers are done
     3065    23161                                             with this buffer, release it.
     3066    23162        */
     3067    23163    3          KX$DATA.RLS.L1 = '1'B;

  23163   2 00116D  8945 0006                            LBT,'2000'X       6,B5
  23163   2 00116F       2000

     3068    23164    3          IF ( KX$DATA.RLS_STAT = %KX_BFR_RLS_OK# )

  23164   2 001170  ECC7 0008                            LDB,B6   DAT$,AUTO
          2 001172  E846 0006                            LDR,R6   6,B6
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:344  
          2 001174  604D                                 SOR,R6   13
          2 001175  6D07                                 CMV,R6   7
          2 001176  0981 000F                            BNE      s:23171,PREL

     3069    23165    3             THEN
     3070    23166    4                DO;

     3071    23167    4                   CALL KXS$RLSBFR ( DAT$ );

  23167   2 001178  DBC7 0008                            LAB,B5   DAT$,AUTO
          2 00117A  DFC7 0038                            STB,B5   ADDRESS+4,AUTO
          2 00117C  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 00117E  CBF0 0100                            LAB,B4   256,IMO
          2 001180  E380 0000 0000  xent                 LNJ,B6   KXS$RLSBFR
          2 001183       0001                            DC       s:23168,PREL

     3072    23168    4                END;

  23168   2 001184  0F81 0005                            B        s:23176,PREL

     3073    23169    3             ELSE
     3074    23170    4                DO;

     3075    23171    4                   KX$DATA.NEXT$ = ADDR(NIL);

  23171   2 001186  DB80 0000 0000                       LAB,B5   0
          2 001189  DF86                                 STB,B5   ,B6

     3076    23172    4                END /* IF */;

     3077    23173
     3078    23174        /* Loop back for the next buffer                                              */
     3079    23175
     3080    23176    3       END /* LOOP */;

  23176   2 00118A  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00118C  8DC6 000E                            CMN      14,B6
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:345  
          2 00118E  09D6                                 BNE      s:23157,SPREL

     3081    23177
     3082    23178        /* Reset the count                                                            */
     3083    23179
     3084    23180
     3085    23181        /* The tail is also null                                                      */
     3086    23182
     3087    23183    2       KX$L2.OUT_Q_TAIL$ = ADDR(NIL);

  23183   2 00118F  DB80 0000 0000                       LAB,B5   0
          2 001192  DFC6 0010                            STB,B5   16,B6

     3088    23184    2       RETURN;

  23184   2 001194  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 001196  C3C6 0001                            LNJ,B4   1,B6

     3089    23185    2   END Y$CLR_DAT_Q;
     3090    23186        %EJECT;
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:346  
     3091    23187
     3092    23188    1   Y$CLR_SUP_Q: PROC;

  23188   2 001198  EFC7 0032            Y$CLR_SUP_Q     STB,B6   NR+1,AUTO

     3093    23189
     3094    23190        /*I* NAME: Y$CLR_SUP_Q
     3095    23191             PURPOSE: Clear the queue of Supervisory frames
     3096    23192        */
     3097    23193    3       DO WHILE ( KX$L2.SUPV_Q_HEAD$ ~= ADDR(NIL));

  23193   2 00119A  0F81 0016                            B        s:23202,PREL

     3098    23194    3          DAT$ = KX$L2.SUPV_Q_HEAD$;

  23194   2 00119C  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 00119E  DCC6 0012                            LDB,B5   18,B6
          2 0011A0  DFC7 0008                            STB,B5   DAT$,AUTO

     3099    23195    3          KX$L2.SUPV_Q_HEAD$ = KX$DATA.NEXT$;

  23195   2 0011A2  CC85                                 LDB,B4   ,B5
          2 0011A3  CFC6 0012                            STB,B4   18,B6

     3100    23196        /*
     3101    23197                                             Release it.
     3102    23198        */
     3103    23199    3          CALL KXS$RLSBFR ( DAT$ );

  23199   2 0011A5  BBC7 0008                            LAB,B3   DAT$,AUTO
          2 0011A7  BFC7 0038                            STB,B3   ADDRESS+4,AUTO
          2 0011A9  BBC7 0038                            LAB,B3   ADDRESS+4,AUTO
          2 0011AB  CBF0 0100                            LAB,B4   256,IMO
          2 0011AD  E380 0000 0000  xent                 LNJ,B6   KXS$RLSBFR
          2 0011B0       0001                            DC       s:23202,PREL

     3104    23200        /* Loop back for the next buffer                                              */
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:347  
     3105    23201
     3106    23202    3       END /* LOOP */;

  23202   2 0011B1  ECC7 0006                            LDB,B6   CTX$,AUTO
          2 0011B3  8DC6 0012                            CMN      18,B6
          2 0011B5  09E7                                 BNE      s:23194,SPREL

     3107    23203
     3108    23204
     3109    23205        /* The tail is also null                                                      */
     3110    23206
     3111    23207    2       KX$L2.SUPV_Q_TAIL$ = ADDR(NIL);

  23207   2 0011B6  DB80 0000 0000                       LAB,B5   0
          2 0011B9  DFC6 0014                            STB,B5   20,B6

     3112    23208    2       RETURN;

  23208   2 0011BB  ECC7 0032                            LDB,B6   NR+1,AUTO
          2 0011BD  C3C6 0001                            LNJ,B4   1,B6
     3113    23209    2   END Y$CLR_SUP_Q;
     3114    23210
     3115    23211
     3116    23212    1   END KXF$FRAME;

PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:348  
--  Include file information  --

   KNH_MACRO_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV_GLB.:E05TOU  is referenced.
   KX_MACROS_M.:E05TOU  is referenced.
   KX_DATA_C.:E05TOU  is referenced.
   KX_SCODE_C.:E05TOU  is referenced.
   KX_PERR_C.:E05TOU  is referenced.
   KX_EQUS_E.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
      No diagnostics issued in procedure KXF$FRAME.
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:349  

 **** Variables and constants ****

  ****  Section 000 RoData KXF$FRAME

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

   1B7-0-0/w STRC(256)   r     1 DATIN_FPT                190-0-0/w STRC(32)    r     1 DISC
   192-0-0/w STRC(32)    r     1 DISC_L                   194-0-0/w STRC(32)    r     1 DISC_LU
   196-0-0/w STRC(32)    r     1 DM                       1A4-0-0/w STRC(32)    r     1 EXTENDED_FORMAT
   198-0-0/w STRC(32)    r     1 FRMR
     0-0-0/b UBIN(8)     r     1 FRMR_REASON(0:30)
    10-0-0/w STRC(384)   r     1 KX_LINKDEV               19A-0-0/w STRC(32)    r     1 LOG
   1C7-0-0/w UBIN(16)    r     1 ONE_SECOND               19C-0-0/w STRC(32)    r     1 RESET
   1A6-0-0/w STRC(32)    r     1 SNDFRMR                  1A0-0-0/w STRC(32)    r     1 START
    28-0-0/b STRC(5760)  r     1 STATE_TABLE              19E-0-0/w STRC(32)    r     1 T20TIMEOUT
   1A2-0-0/w STRC(32)    r     1 UP                       1B1-0-0/w STRC(48)    r     1 Y_ACTSCR
   1AB-0-0/w STRC(48)    r     1 Y_NO_PRMCLK              1B4-0-0/w STRC(48)    r     1 Y_UNKACT
   1AE-0-0/w STRC(48)    r     1 Y_UNKEVT

  ****  Section 001  Data  KXF$FRAME

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/c CHAR(50)    r     1 KX_FRAME                   0-0-0/w STRC(112)   r     1 X25_PRM_CLK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @FPT_X25                  34-0-0/w UBIN(16)    r     1 ADDRESS
    12-0-0/w STRC(256)   r     1 CALL_FPT                   A-0-0/w PTR         r     1 CHN$
    2A-0-0/w UBIN(16)    r     1 CTL                        6-0-0/w PTR         r     1 CTX$
     8-0-0/w PTR         r     1 DAT$                       C-0-0/w PTR         r     1 DVC$
    22-0-0/w STRC(32)    r     1 ERCOD                     24-0-0/w UBIN(16)    r     1 FEVENT
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:350  
    *0-0-0/w STRC(256)   r     1 FPT_X25                   25-0-0/w UBIN(16)    r     1 FSTATE
    28-0-0/w STRC(32)    r     1 KHA_ERROR                 31-0-0/w UBIN(8)     r     1 NR
    27-0-0/w UBIN(16)    r     1 PEVENT                    30-0-0/b BIT         r     1 PF
    2C-0-0/w UBIN(16)    r     1 TEMP1                      E-0-0/w PTR         r     1 TEMP1$
    2D-0-0/w UBIN(16)    r     1 TEMP2                     2E-0-0/w UBIN(16)    r     1 TEMP3
    10-0-0/w PTR         r     1 TEMP3$                    2F-0-0/w UBIN(16)    r     1 TEMP4

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$JIT$
     0-0-0/w EPTR        r     1 KV_CQ_HNDSBR$(0:2)
     0-0-0/b EPTR        r     1 KX_PM$(0:2)                0-0-0/w STRC(800)   r     1 KX_STATS_HDLC
     0-0-0/w STRC(1248)  r     1 KX_STATS_X25               0-0-0/w STRC(64)    r     1 KX_TMRBLK

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(288)   r     1 ADMIN_FPT                  0-0-0/w STRC(384)   r     1 B$LINKDEV
     0-0-0/w STRC(48)    r     1 B$SCODE                    0-0-0/w STRC(64)    r     1 BLKHDR
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/c STRC(192)   r     1 KL$LINKDEV
     0-0-0/w STRC(160)   r     1 KX$BTMRBLK                 0-0-0/w STRC(128)   r     1 KX$DATA
     0-0-0/w STRC(152)   r     1 KX$EXTFRAME                0-0-0/w STRC(184)   r     1 KX$EXTXFRAME
     0-0-0/w STRC(144)   r     1 KX$FRAME                   0-0-0/w STRC(352)   r     1 KX$L1
     0-0-0/w STRC(4992)  r     1 KX$L2                      0-0-0/w STRC(2032)  r     1 KX$L2S
     0-0-0/w STRC(384)   r     1 KX$LINKDEV                 0-0-0/w STRC(168)   r     1 KX$PACKET
     0-0-0/w STRC(128)   r     1 KX$TDATA                   0-0-0/w STRC(168)   r     1 KX$XFRAME
     0-0-0/c CHAR(50)    r     1 STR


   Procedure KXF$FRAME requires 4543 words for executable code.
   Procedure KXF$FRAME requires 70 words of local(AUTO) storage.
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:351  

    No errors detected in file KXF$FRAME.:E05TSI    .
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:352  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:353  
          MINI XREF LISTING

ADDRESS IN PROCEDURE Y$UA
     22857**DCL     22890<<ASSIGN  22900<<ASSIGN  22925>>ASSIGN
ADMIN_FPT
     17465**DCL     20932<>CALL    23092--ASSIGN
ADMIN_FPT.CHN$
     17592**DCL     20863>>CALL    20864>>CALL    20915>>IF      20917>>CALL    20940>>ASSIGN  23089>>IF
     23090>>ASSIGN
ADMIN_FPT.CTX$
     17521**DCL     20921>>IF      20930>>IF      20944>>ASSIGN  20945>>ASSIGN  20946>>ASSIGN  20947>>ASSIGN
     20948>>IF
ADMIN_FPT.TERMID
     17487**DCL     20896<>CALL    20896<>CALL
ADMIN_FPT.TERMID.LEV
     17489**DCL     20853>>IF      20873>>IF      20909>>IF
ADMIN_FPT.TERMID.TERM
     17489**DCL     17498--REDEF
B$LINKDEV.FLNK$
     17973**DCL     20957<<ASSIGN
B$SCODE
     19985**DCL     21027<>CALL    22955<>CALL    23039<>CALL    23097<>CALL
BLKHDR.BLKTYP
     17703**DCL     20921>>IF      20930>>IF
CALL_FPT
     17166**DCL     20754<<ASSIGN  20924<<ASSIGN  21022<<ASSIGN  21025<>CALL    21077<<ASSIGN  21080<>CALL
     21260<<ASSIGN  21267<>CALL    22950<<ASSIGN  22953<>CALL    23034<<ASSIGN  23037<>CALL    23087<<ASSIGN
     23095<>CALL
CALL_FPT.CAL$
     17170**DCL     21024<<ASSIGN  21078<<ASSIGN  21261<<ASSIGN  22952<<ASSIGN  23036<<ASSIGN  23094<<ASSIGN
CALL_FPT.EVN
     17170**DCL     20755<<ASSIGN  20925<<ASSIGN  21023<<ASSIGN  22951<<ASSIGN  23035<<ASSIGN  23088<<ASSIGN
CALL_FPT.PRM1$
     17171**DCL     17172--REDEF   21027>>CALL    21079<<ASSIGN  21081>>ASSIGN  21262<<ASSIGN  21269>>IF
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:354  
     22955>>CALL    23039>>CALL    23092<<ASSIGN  23097>>CALL
CALL_FPT.PRM2$
     17173**DCL     17173--REDEF
CALL_FPT.RCV$
     17170**DCL     23090<<ASSIGN
CHN$
     17091**DCL     20940<<ASSIGN  20941>>ASSIGN  20942>>ASSIGN  20943>>ASSIGN  21015<<ASSIGN  21048<<ASSIGN
     21053>>IF      21058>>CALL    21066>>ASSIGN  21072>>CALL    21382>>CALL    21658>>CALL    21749>>IF
     21751>>CALL    21781>>IF      21783>>CALL    21891>>IF      21893>>CALL    21922>>IF      21924>>CALL
     21956>>IF      21958>>CALL    22005>>CALL    22042>>CALL    22075<>CALL    22078>>CALL    22838>>CALL
     22930>>CALL
CTL
     17308**DCL     21225<<ASSIGN  21227<<ASSIGN  21290<<ASSIGN  21292<<ASSIGN  21404<<ASSIGN  21442<<ASSIGN
     21479<<ASSIGN  21516<<ASSIGN  21546<<ASSIGN  21787<<ASSIGN  21849<<ASSIGN  21863<<ASSIGN  21877<<ASSIGN
     21895<<ASSIGN  21926<<ASSIGN  22009<<ASSIGN  22150>>IF      22863<<ASSIGN  22865<<ASSIGN  22877<<ASSIGN
     22879<<ASSIGN  22911>>IF      22915>>IF      22918<<ASSIGN  22918>>ASSIGN  22927>>ASSIGN
CTX$
     17089**DCL     17995--IMP-PTR 18040--IMP-PTR 18407--IMP-PTR 20741<<ASSIGN  20751>>IF      20751>>IF
     20758>>IF      20758>>IF      20764>>ASSIGN  20765>>ASSIGN  20767>>DOWHILE 20774>>ASSIGN  20776>>ASSIGN
     20792>>ASSIGN  20792>>ASSIGN  20816>>CALL    20816>>CALL    20816>>CALL    20816>>CALL    20816>>CALL
     20844>>CALL    20848>>ASSIGN  20849>>ASSIGN  20884>>IF      20915>>IF      20932<>CALL    20953>>ASSIGN
     20954>>ASSIGN  20955>>IF      20957>>ASSIGN  20959>>ASSIGN  20960>>ASSIGN  20978>>IF      20986>>IF
     20986>>IF      21015>>ASSIGN  21016>>ASSIGN  21016>>ASSIGN  21019>>IF      21019>>IF      21024>>ASSIGN
     21035>>ASSIGN  21036>>IF      21038<>CALL    21048>>ASSIGN  21057>>IF      21078>>ASSIGN  21089>>ASSIGN
     21102>>ASSIGN  21102>>ASSIGN  21103>>ASSIGN  21107>>ASSIGN  21107>>ASSIGN  21108>>ASSIGN  21108>>ASSIGN
     21109>>ASSIGN  21109>>ASSIGN  21110>>ASSIGN  21110>>ASSIGN  21111>>IF      21113>>ASSIGN  21125>>ASSIGN
     21135>>ASSIGN  21165>>ASSIGN  21169>>ASSIGN  21171>>ASSIGN  21174>>IF      21193>>IF      21201>>IF
     21210>>IF      21213>>IF      21222>>ASSIGN  21223>>IF      21242>>ASSIGN  21246>>ASSIGN  21246>>ASSIGN
     21246>>ASSIGN  21252>>ASSIGN  21261>>ASSIGN  21263>>ASSIGN  21263>>ASSIGN  21264>>IF      21279>>IF
     21279>>IF      21279>>IF      21285>>IF      21285>>IF      21288>>IF      21298>>ASSIGN  21317>>IF
     21320>>ASSIGN  21324>>ASSIGN  21329>>ASSIGN  21329>>ASSIGN  21329>>ASSIGN  21334>>IF      21340>>ASSIGN
     21341>>ASSIGN  21342>>ASSIGN  21350>>ASSIGN  21351>>ASSIGN  21352>>ASSIGN  21352>>ASSIGN  21366>>IF
     21366>>IF      21368>>ASSIGN  21373>>ASSIGN  21378>>ASSIGN  21386>>IF      21386>>IF      21415>>IF
     21423>>ASSIGN  21491>>IF      21497>>CALL    21519>>IF      21532>>ASSIGN  21544>>ASSIGN  21544>>ASSIGN
     21593>>IF      21593>>IF      21593>>IF      21605>>IF      21608>>ASSIGN  21608>>ASSIGN  21608>>ASSIGN
     21609>>IF      21611>>ASSIGN  21611>>ASSIGN  21614>>ASSIGN  21616>>ASSIGN  21628>>ASSIGN  21629>>ASSIGN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:355  
     21630>>IF      21635>>IF      21638>>IF      21640>>ASSIGN  21641>>ASSIGN  21642>>ASSIGN  21643>>ASSIGN
     21647>>IF      21649>>ASSIGN  21650>>ASSIGN  21651>>ASSIGN  21652>>ASSIGN  21653>>ASSIGN  21654>>ASSIGN
     21666>>ASSIGN  21692>>CALL    21692>>CALL    21692>>CALL    21692>>CALL    21692>>CALL    21692>>CALL
     21735>>IF      21735>>IF      21742>>ASSIGN  21743>>IF      21753>>IF      21759>>ASSIGN  21759>>ASSIGN
     21775>>IF      21775>>IF      21787>>ASSIGN  21792>>IF      21800>>ASSIGN  21828>>ASSIGN  21830>>ASSIGN
     21834>>IF      21877>>ASSIGN  21895>>ASSIGN  21901>>IF      21909>>ASSIGN  21926>>ASSIGN  21933>>IF
     21941>>ASSIGN  21941>>ASSIGN  22014>>IF      22052>>IF      22065>>IF      22067>>ASSIGN  22069<>CALL
     22133>>IF      22133>>IF      22137>>IF      22140>>ASSIGN  22141>>ASSIGN  22145>>ASSIGN  22149>>ASSIGN
     22155>>ASSIGN  22160>>ASSIGN  22164>>ASSIGN  22188>>IF      22227>>ASSIGN  22232>>IF      22265>>IF
     22272>>ASSIGN  22280>>IF      22312>>IF      22319>>ASSIGN  22324>>IF      22357>>IF      22364>>ASSIGN
     22369>>IF      22401>>IF      22411>>IF      22423>>ASSIGN  22431>>IF      22443>>IF      22452>>ASSIGN
     22462>>IF      22472>>IF      22478>>IF      22492>>IF      22500>>IF      22529>>CALL    22529>>CALL
     22546>>IF      22566>>IF      22575>>IF      22599>>ASSIGN  22600>>ASSIGN  22607>>ASSIGN  22613>>ASSIGN
     22632>>ASSIGN  22642>>ASSIGN  22643>>ASSIGN  22651>>ASSIGN  22654>>ASSIGN  22654>>ASSIGN  22658>>ASSIGN
     22662>>ASSIGN  22674>>ASSIGN  22676>>IF      22685>>IF      22685>>IF      22707>>ASSIGN  22708>>ASSIGN
     22722>>ASSIGN  22723>>ASSIGN  22724>>ASSIGN  22725>>ASSIGN  22726>>ASSIGN  22727>>ASSIGN  22728>>ASSIGN
     22729>>ASSIGN  22730>>ASSIGN  22736>>IF      22750>>ASSIGN  22753>>IF      22770>>ASSIGN  22774>>IF
     22774>>IF      22776>>ASSIGN  22780>>IF      22782>>IF      22798>>ASSIGN  22810>>ASSIGN  22811>>ASSIGN
     22812>>ASSIGN  22829>>IF      22829>>IF      22836>>ASSIGN  22844>>ASSIGN  22861>>IF      22875>>IF
     22880>>ASSIGN  22890>>ASSIGN  22900>>ASSIGN  22911>>IF      22952>>ASSIGN  22977>>CALL    23003>>CALL
     23003>>CALL    23026>>CALL    23030>>ASSIGN  23036>>ASSIGN  23064>>IF      23064>>ASSIGN  23064>>IF
     23064>>ASSIGN  23064>>ASSIGN  23064>>ASSIGN  23065>>IF      23065>>ASSIGN  23065>>ASSIGN  23065>>ASSIGN
     23076>>IF      23076>>ASSIGN  23076>>IF      23076>>ASSIGN  23076>>ASSIGN  23076>>ASSIGN  23077>>IF
     23077>>ASSIGN  23077>>ASSIGN  23077>>ASSIGN  23094>>ASSIGN  23111>>IF      23114>>ASSIGN  23114>>ASSIGN
     23115>>IF      23118>>ASSIGN  23119>>ASSIGN  23122>>ASSIGN  23124>>ASSIGN  23125>>ASSIGN  23126>>ASSIGN
     23130>>IF      23133>>ASSIGN  23134>>IF      23136>>ASSIGN  23138>>ASSIGN  23138>>ASSIGN  23139>>IF
     23141>>ASSIGN  23143>>ASSIGN  23143>>ASSIGN  23156>>DOWHILE 23157>>ASSIGN  23158>>ASSIGN  23183>>ASSIGN
     23193>>DOWHILE 23194>>ASSIGN  23195>>ASSIGN  23207>>ASSIGN
DAT$
     17090**DCL     17465--IMP-PTR 19202--IMP-PTR 19222--IMP-PTR 19254--IMP-PTR 19288--IMP-PTR 19312--IMP-PTR
     19378--IMP-PTR 19444--IMP-PTR 19957--IMP-PTR 20742<<ASSIGN  20853>>IF      20863>>CALL    20864>>CALL
     20873>>IF      20896>>CALL    20896>>CALL    20909>>IF      20915>>IF      20917>>CALL    20921>>IF
     20930>>IF      20932>>CALL    20940>>ASSIGN  20944>>ASSIGN  20945>>ASSIGN  20946>>ASSIGN  20947>>ASSIGN
     20948>>IF      21069>>ASSIGN  21070>>ASSIGN  21072<>CALL    21076>>ASSIGN  21079>>ASSIGN  21195>>ASSIGN
     21197>>ASSIGN  21252>>ASSIGN  21256>>ASSIGN  21262>>ASSIGN  21320>>ASSIGN  21324>>ASSIGN  21340>>ASSIGN
     21341>>ASSIGN  21350>>ASSIGN  21351>>ASSIGN  21358>>ASSIGN  21362>>ASSIGN  21373>>ASSIGN  21378>>ASSIGN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:356  
     21382<>CALL    21593>>IF      21609>>IF      21612>>IF      21630>>IF      21640>>ASSIGN  21649>>ASSIGN
     21657<<ASSIGN  21658<>CALL    21735>>IF      21826>>IF      22005<>CALL    22181>>IF      22186>>ASSIGN
     22191>>ASSIGN  22192>>ASSIGN  22196>>ASSIGN  22197>>ASSIGN  22202>>IF      22202>>IF      22202>>IF
     22211>>IF      22220>>IF      22232>>IF      22254>>DOCASE  22265>>IF      22312>>IF      22357>>IF
     22396>>DOSELCT 22401>>IF      22411>>IF      22431>>IF      22443>>IF      22462>>IF      22472>>IF
     22492>>IF      22500>>IF      22529>>CALL    22529>>CALL    22529>>CALL    22546>>IF      22750<<ASSIGN
     22752>>DOWHILE 22756>>ASSIGN  22757>>ASSIGN  22761>>ASSIGN  22762>>ASSIGN  22765<<ASSIGN  22765>>ASSIGN
     22798<<ASSIGN  22799>>DOWHILE 22800>>ASSIGN  22801>>ASSIGN  22802>>IF      22804<>CALL    22805<<ASSIGN
     22836<<ASSIGN  22837>>DOWHILE 22838<>CALL    22839<<ASSIGN  22839>>ASSIGN  22905<>CALL    22906>>ASSIGN
     22907>>ASSIGN  22914>>ASSIGN  22919>>ASSIGN  22923>>ASSIGN  22925>>ASSIGN  22927>>ASSIGN  22930<>CALL
     23089>>IF      23090>>ASSIGN  23092>>ASSIGN  23157<<ASSIGN  23158>>ASSIGN  23163>>ASSIGN  23164>>IF
     23167<>CALL    23171>>ASSIGN  23194<<ASSIGN  23195>>ASSIGN  23199<>CALL
DATIN_FPT
     17065**DCL     21077>>ASSIGN  21260>>ASSIGN
DATIN_FPT.PRM1$
     17070**DCL     17071--REDEF
DATIN_FPT.PRM2$
     17072**DCL     17072--REDEF
DISC
     16128**DCL     21409>>ASSIGN
DISC_L
     16179**DCL     21451>>ASSIGN
DISC_LU
     16230**DCL     21488>>ASSIGN
DM
     16281**DCL     20787>>ASSIGN  21574>>ASSIGN
DVC$
     17092**DCL     17945--IMP-PTR 20935<>CALL    20939>>ASSIGN  20941>>ASSIGN  20943>>ASSIGN  20944>>ASSIGN
     20945>>ASSIGN  20946>>ASSIGN  20947>>ASSIGN  20950>>ASSIGN  20952>>ASSIGN  20953>>ASSIGN  20954>>ASSIGN
     20957>>ASSIGN  20959>>ASSIGN  20960>>ASSIGN
ERCOD
     17225**DCL     20777<<ASSIGN  20781<<ASSIGN  20785<<ASSIGN  20787<<ASSIGN  20818<<ASSIGN  20821<<ASSIGN
     20825>>IF      20844<>CALL    21017<<ASSIGN  21059<<ASSIGN  21409<<ASSIGN  21451<<ASSIGN  21488<<ASSIGN
     21574<<ASSIGN  21713<<ASSIGN  21804<<ASSIGN  22022<<ASSIGN  22434<<ASSIGN  22977<>CALL    23003<>CALL
     23044<<ASSIGN
EXTENDED_FORMAT
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:357  
     16643**DCL     22434>>ASSIGN
FEVENT
     17258**DCL     20748<<ASSIGN  20906<<ASSIGN  20966<<ASSIGN  20969<<ASSIGN  20972<<ASSIGN  20975<<ASSIGN
     20982<<ASSIGN  20988<<ASSIGN  20990<<ASSIGN  21032<<ASSIGN  21055>>DOCASE  21097>>ASSIGN  21108>>ASSIGN
     21163>>IF      21167>>IF      21593>>IF      21593>>IF      21616>>ASSIGN  21775>>IF      22208<<ASSIGN
     22214<<ASSIGN  22238<<ASSIGN  22246<<ASSIGN  22271<<ASSIGN  22284<<ASSIGN  22289<<ASSIGN  22297<<ASSIGN
     22318<<ASSIGN  22329<<ASSIGN  22334<<ASSIGN  22342<<ASSIGN  22363<<ASSIGN  22374<<ASSIGN  22379<<ASSIGN
     22387<<ASSIGN  22403<<ASSIGN  22405<<ASSIGN  22417<<ASSIGN  22427<<ASSIGN  22436<<ASSIGN  22446<<ASSIGN
     22456<<ASSIGN  22464<<ASSIGN  22466<<ASSIGN  22480<<ASSIGN  22482<<ASSIGN  22486<<ASSIGN  22494<<ASSIGN
     22502<<ASSIGN  22504<<ASSIGN  22539<<ASSIGN  22546>>IF      22546>>IF      22549<<ASSIGN  22624<<ASSIGN
     22676>>IF      22676>>IF      22676>>IF      23003<>CALL
FPT_X25
     17122**DCL        13--PROC
FPT_X25.EVN
     17126**DCL     20746>>DOCASE  22070>>IF      23003<>CALL
FPT_X25.PRM1$
     17127**DCL     17128--REDEF   20742>>ASSIGN  21081<<ASSIGN  21275<<ASSIGN
FPT_X25.PRM2$
     17129**DCL     17129--REDEF
FPT_X25.RCV$
     17126**DCL     20741>>ASSIGN
FRMR
     16332**DCL     20821>>ASSIGN  22529<>CALL
FRMR_REASON
     15743**DCL     21616>>ASSIGN
FRMR_TO_ENTRY
     21933**LABEL   21703--GOTO
FSTATE
     17259**DCL     21089<<ASSIGN  21097>>ASSIGN  21098<<ASSIGN  21103>>ASSIGN  21107>>ASSIGN
G$JIT.ERRLOG
     19887**DCL     19890--REDEF
G$JIT.JSUNIT
     19626**DCL     19627--REDEF
G$JIT.MCLS
     19625**DCL     19625--REDEF
G$JIT.TMRZ
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:358  
     19894**DCL     19895--REDEF
G$JIT.USER_EXTIME
     19618**DCL     19619--REDEF
G$JIT.USER_MEMTIME
     19621**DCL     19621--REDEF
G$JIT.USER_SVTIME
     19620**DCL     19620--REDEF
G$JIT$
     20026**DCL     19557--IMP-PTR
KH$CHN
     17341**DCL     20863<>CALL    20864<>CALL    20917<>CALL    21058<>CALL    21072<>CALL    21382<>CALL
     21658<>CALL    21751<>CALL    21783<>CALL    21893<>CALL    21924<>CALL    21958<>CALL    22005<>CALL
     22042<>CALL    22078<>CALL    22838<>CALL    22930<>CALL
KH$CHN.ATTR
     17374**DCL     20758>>IF      20978>>IF      21053>>IF
KH$CHN.CTX$
     17411**DCL     20941<<ASSIGN  23090>>ASSIGN
KH$CHN.DWNLOD
     17379**DCL     20915>>IF      21066<<ASSIGN
KH$CHN.OTPCCBCNT
     17385**DCL     21749>>IF      21781>>IF      21891>>IF      21922>>IF      21956>>IF
KH$CHN.TERMID
     17435**DCL     20816<>CALL    20844<>CALL    21497<>CALL    21692<>CALL    22529<>CALL    22977<>CALL
     23003<>CALL    23026<>CALL
KH$CHN.TERMID.TERM
     17437**DCL     17446--REDEF
KH$CHN.TERMID.TTYP
     17437**DCL     20942<<ASSIGN  23089>>IF
KHA$DVCADM
     15563**DCL-ENT 20896--CALL
KHA$LINE_ACTIVE
     15564**DCL-ENT 23026--CALL
KHA$LINE_INACTIVE
     15565**DCL-ENT 21497--CALL
KHA$TSTCNC
     15562**DCL-ENT 22075--CALL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:359  
KHA_ERROR
     17276**DCL     20896<>CALL
KHD$SCREECH
     15577**DCL-ENT 20823--CALL    21009--CALL    21027--CALL    21045--CALL    21084--CALL    21991--CALL
     22127--CALL    22955--CALL    23039--CALL    23097--CALL
KL$LINKDEV.CIRCUITS#
     17893**DCL     20944>>ASSIGN
KL$LINKDEV.LOGON#
     17925**DCL     20947>>ASSIGN
KL$LINKDEV.MODE
     17916**DCL     20948>>IF
KL$LINKDEV.PROTOCOL#
     17897**DCL     20945>>ASSIGN
KL$LINKDEV.SUBADDR#
     17900**DCL     20946>>ASSIGN
KVB$GETSYS
     15579**DCL-ENT 20935--CALL
KV_CQ_HNDSBR$
     20040**DCL     20997<<ASSIGN
KX$BTMRBLK.BLNK$
     19537**DCL     23064<<ASSIGN  23076<<ASSIGN  23138<<ASSIGN
KX$BTMRBLK.FLNK$
     19537**DCL     23065<<ASSIGN  23077<<ASSIGN  23124<<ASSIGN  23143<<ASSIGN
KX$DATA.CNT
     19205**DCL     21070>>ASSIGN  21076>>ASSIGN  21252>>ASSIGN  21373>>ASSIGN  21612>>IF      21628<<ASSIGN
     22202>>IF      22211>>IF      22492>>IF      22546>>IF      22914<<ASSIGN  22923<<ASSIGN
KX$DATA.L2_LIST$
     19204**DCL     21358<<ASSIGN  22765>>ASSIGN  22800>>ASSIGN  22839>>ASSIGN
KX$DATA.NEXT$
     19204**DCL     23158>>ASSIGN  23171<<ASSIGN  23195>>ASSIGN
KX$DATA.RLS.L1
     19205**DCL     23163<<ASSIGN
KX$DATA.RLS.L2
     19205**DCL     21362<<ASSIGN  21627<<ASSIGN  22666<<ASSIGN  22801<<ASSIGN  22907<<ASSIGN
KX$DATA.RLS.L3
     19205**DCL     21626<<ASSIGN  22906<<ASSIGN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:360  
KX$DATA.RLS_STAT
     19204**DCL     19205--REDEF   22802>>IF      23164>>IF
KX$EXTFRAME.RLS_STAT
     19290**DCL     19291--REDEF
KX$EXTFRAME.XCTL
     19295**DCL     19296--REDEF
KX$EXTFRAME.XCTL.CTL
     19295**DCL     19295--REDEF
KX$EXTFRAME.XCTL.CTL_BITS.NS
     19295**DCL     21197>>ASSIGN  21324<<ASSIGN  22761<<ASSIGN
KX$EXTFRAME.XCTL.NR
     19296**DCL     22197>>ASSIGN  22762<<ASSIGN
KX$EXTFRAME.XCTL.PF
     19296**DCL     22196>>ASSIGN  22919<<ASSIGN
KX$EXTFRAME.XCTL_REDEF
     19296**DCL     21640>>ASSIGN
KX$EXTXFRAME.CTL
     19319**DCL     19319--REDEF
KX$EXTXFRAME.FRMR_BITS
     19331**DCL     21643<<ASSIGN  22529<>CALL
KX$EXTXFRAME.FRMR_CTL
     19330**DCL     21641<<ASSIGN  22529<>CALL
KX$EXTXFRAME.FRMR_NSNR
     19330**DCL     19330--REDEF   21642<<ASSIGN  22529<>CALL
KX$EXTXFRAME.RLS_STAT
     19314**DCL     19315--REDEF
KX$FRAME.ADR
     19229**DCL     21378<<ASSIGN  21593>>IF      21609>>IF      21629<<ASSIGN  21630>>IF      21735>>IF
     22202>>IF      22202>>IF      22232>>IF      22265>>IF      22312>>IF      22357>>IF      22401>>IF
     22411>>IF      22443>>IF      22462>>IF      22472>>IF      22500>>IF      22925<<ASSIGN
KX$FRAME.CTL
     19229**DCL     19229--REDEF   21632<<ASSIGN  21634<<ASSIGN  21649>>ASSIGN  21826>>IF      22181>>IF
     22396>>DOSELCT 22431>>IF      22927<<ASSIGN
KX$FRAME.CTL_BITS.IFLAG
     19235**DCL     22220>>IF
KX$FRAME.CTL_BITS.NR
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:361  
     19231**DCL     22192>>ASSIGN  22757<<ASSIGN
KX$FRAME.CTL_BITS.NS
     19233**DCL     21195>>ASSIGN  21320<<ASSIGN  22254>>DOCASE  22756<<ASSIGN
KX$FRAME.CTL_BITS.PF
     19231**DCL     22186>>ASSIGN  22191>>ASSIGN
KX$FRAME.RLS_STAT
     19224**DCL     19225--REDEF
KX$L1.CHN$
     18014**DCL     20758>>IF      20816>>CALL    20844>>CALL    20978>>IF      21048>>ASSIGN  21497>>CALL
     21692>>CALL    22529>>CALL    22977>>CALL    23003>>CALL    23026>>CALL
KX$L1.IN_CCB_HEAD$
     18016**DCL     21057>>IF
KX$L1.OUT_CCB_HEAD$
     18016**DCL     22829>>IF
KX$L1.OUT_Q_HEAD$
     18017**DCL     21285>>IF      22829>>IF
KX$L2.ADR_CMND
     18070**DCL     21378>>ASSIGN  21593>>IF      21609>>IF      22401>>IF      22462>>IF      22472>>IF
     22500>>IF      22900>>ASSIGN
KX$L2.ADR_RESP
     18070**DCL     21629>>ASSIGN  21630>>IF      21735>>IF      22232>>IF      22265>>IF      22312>>IF
     22357>>IF      22411>>IF      22443>>IF      22890>>ASSIGN
KX$L2.CHN$
     18059**DCL     21015>>ASSIGN
KX$L2.DCE_I_CNT
     18075**DCL     21263<<ASSIGN  21263>>ASSIGN  21279>>IF      21298<<ASSIGN  22730<<ASSIGN  22880<<ASSIGN
KX$L2.DFLVCPRF.TRADEL
     18180**DCL     18190--REDEF
KX$L2.DSTSNPA.ADR_STRING
     18371**DCL     18371--REDEF
KX$L2.DVC_HEAD$
     18377**DCL     20959<<ASSIGN
KX$L2.DVC_TAIL$
     18377**DCL     20954>>ASSIGN  20955>>IF      20957>>ASSIGN  20960<<ASSIGN
KX$L2.FLG.BLK
     18083**DCL     20751>>IF      21285>>IF      21368<<ASSIGN  22642<<ASSIGN  22726<<ASSIGN  22776<<ASSIGN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:362  
KX$L2.FLG.DATAVL
     18086**DCL     22140<<ASSIGN
KX$L2.FLG.DCE
     18083**DCL     21593>>IF      21775>>IF
KX$L2.FLG.DCE_BUSY
     18083**DCL     21165<<ASSIGN  21169<<ASSIGN  21171<<ASSIGN  21742<<ASSIGN  21828<<ASSIGN  21830<<ASSIGN
     22133>>IF      22727<<ASSIGN
KX$L2.FLG.DCE_REJ
     18084**DCL     21135<<ASSIGN  22728<<ASSIGN  22844<<ASSIGN
KX$L2.FLG.DTE_BUSY
     18085**DCL     21125<<ASSIGN  21288>>IF      22875>>IF
KX$L2.FLG.DTE_REJ
     18085**DCL     21210>>IF      21222<<ASSIGN  21242<<ASSIGN  22729<<ASSIGN
KX$L2.FLG.EXTSEQ
     18087**DCL     21193>>IF      21246>>ASSIGN  21252>>ASSIGN  21317>>IF      21329>>ASSIGN  21373>>ASSIGN
     21628>>ASSIGN  21635>>IF      21787>>ASSIGN  21877>>ASSIGN  21895>>ASSIGN  21926>>ASSIGN  22188>>IF
     22431>>IF      22492>>IF      22546>>IF      22607>>ASSIGN  22613>>ASSIGN  22651>>ASSIGN  22753>>IF
     22911>>IF
KX$L2.FLG.OK
     18084**DCL     20751>>IF      22137>>IF      22141<<ASSIGN  22145<<ASSIGN  23030<<ASSIGN
KX$L2.FLG.POLL_R
     18084**DCL     21213>>IF      21223>>IF      21264>>IF      21735>>IF      21834>>IF      22164<<ASSIGN
     22227<<ASSIGN  22272<<ASSIGN  22319<<ASSIGN  22364<<ASSIGN  22423<<ASSIGN  22452<<ASSIGN  22861>>IF
KX$L2.FLG.POLL_S
     18084**DCL     22155<<ASSIGN  22160<<ASSIGN  22280>>IF      22324>>IF      22369>>IF      22478>>IF
     22676>>IF
KX$L2.FLG.RESTART
     18086**DCL     22707<<ASSIGN
KX$L2.FLG.RESTART_PEND
     18086**DCL     22708<<ASSIGN
KX$L2.FRMR_BITS
     18090**DCL     21614<<ASSIGN  21616<<ASSIGN  21643>>ASSIGN  21654>>ASSIGN  21692<>CALL
KX$L2.FRMR_CTL
     18090**DCL     21640<<ASSIGN  21641>>ASSIGN  21649<<ASSIGN  21650>>ASSIGN  21692<>CALL
KX$L2.FRMR_NSNR
     18157**DCL     18158--REDEF   21608<<ASSIGN  21611<<ASSIGN  21611>>ASSIGN  21642>>ASSIGN  21692<>CALL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:363  
KX$L2.FRMR_NSNR_REDEF.CR
     18158**DCL     21653>>ASSIGN
KX$L2.HIST.ACT
     18074**DCL     21109<<ASSIGN
KX$L2.HIST.EVT
     18073**DCL     21108<<ASSIGN
KX$L2.HIST.STT
     18073**DCL     21107<<ASSIGN
KX$L2.HIST.X
     18073**DCL     21107>>ASSIGN  21108>>ASSIGN  21109>>ASSIGN  21110<<ASSIGN  21110>>ASSIGN  21111>>IF
     21113<<ASSIGN
KX$L2.I_CNT
     18088**DCL     21174>>IF      21342<<ASSIGN  21352<<ASSIGN  21352>>ASSIGN  21366>>IF      21743>>IF
     22654<<ASSIGN  22654>>ASSIGN  22685>>IF      22736>>IF      22774>>IF      22780>>IF      22810<<ASSIGN
KX$L2.I_LIST_HEAD$
     18088**DCL     21334>>IF      21340<<ASSIGN  22658>>ASSIGN  22662<<ASSIGN  22750>>ASSIGN  22798>>ASSIGN
     22811<<ASSIGN  22836>>ASSIGN
KX$L2.I_LIST_TAIL$
     18089**DCL     21341<<ASSIGN  21350>>ASSIGN  21351<<ASSIGN  22812<<ASSIGN
KX$L2.K
     18066**DCL     21279>>IF      21366>>IF      22774>>IF
KX$L2.N2
     18066**DCL     20986>>IF
KX$L2.NPR
     18074**DCL     22599>>ASSIGN  22674<<ASSIGN  22723<<ASSIGN
KX$L2.NTWADR.ADR_STRING
     18091**DCL     18091--REDEF
KX$L2.OUT_Q_HEAD$
     18062**DCL     23156>>DOWHILE 23157>>ASSIGN  23158<<ASSIGN
KX$L2.OUT_Q_TAIL$
     18063**DCL     23183<<ASSIGN
KX$L2.R20
     18158**DCL     21019>>IF
KX$L2.R20_CNT
     18158**DCL     21016<<ASSIGN  21016>>ASSIGN  21019>>IF
KX$L2.RC
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:364  
     18066**DCL     20986>>IF      21423<<ASSIGN  21532<<ASSIGN  21544<<ASSIGN  21544>>ASSIGN  21666<<ASSIGN
     21800<<ASSIGN  21909<<ASSIGN  21941<<ASSIGN  21941>>ASSIGN  22643<<ASSIGN  22722<<ASSIGN
KX$L2.REJ_CNT
     18160**DCL     21759<<ASSIGN  21759>>ASSIGN
KX$L2.RLS_TERMACKPND
     18376**DCL     21036>>IF      22067<<ASSIGN
KX$L2.RSPDLY
     18068**DCL     21279>>IF
KX$L2.STATE.CURRENT
     18070**DCL     21089>>ASSIGN  21102>>ASSIGN  21103<<ASSIGN  22052>>IF      22133>>IF      22149>>ASSIGN
     22566>>IF      22575>>IF
KX$L2.STATE.LAST
     18070**DCL     21102<<ASSIGN  21593>>IF      21605>>IF      21638>>IF      21647>>IF      21775>>IF
KX$L2.STATES
     18069**DCL     18069--REDEF   23003<>CALL
KX$L2.SUPV_Q_HEAD$
     18063**DCL     23193>>DOWHILE 23194>>ASSIGN  23195<<ASSIGN
KX$L2.SUPV_Q_TAIL$
     18064**DCL     22529<>CALL    23207<<ASSIGN
KX$L2.T1
     18066**DCL     21386>>IF      21415>>IF      21491>>IF      21519>>IF      21753>>IF      21792>>IF
     21901>>IF      21933>>IF      22014>>IF      22685>>IF      22782>>IF      23111>>IF      23114>>ASSIGN
KX$L2.T20TMR.BLNK$
     18152**DCL     23076>>ASSIGN  23076>>ASSIGN  23077>>IF      23077>>ASSIGN
KX$L2.T20TMR.FLNK$
     18152**DCL     23076>>IF      23076>>ASSIGN  23077>>ASSIGN  23077>>ASSIGN
KX$L2.T20TMR.ON
     18154**DCL     23076>>IF      23076<<ASSIGN
KX$L2.TERMACKPND
     18376**DCL     21035<<ASSIGN  22065>>IF
KX$L2.TMRBLK
     18118**DCL     23122--ASSIGN  23124--ASSIGN  23126--ASSIGN
KX$L2.TMRBLK.BLNK$
     18120**DCL     23064>>ASSIGN  23064>>ASSIGN  23065>>IF      23065>>ASSIGN  23125<<ASSIGN  23136>>ASSIGN
     23138>>ASSIGN  23139>>IF      23143>>ASSIGN
KX$L2.TMRBLK.CNT
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:365  
     18122**DCL     23114<<ASSIGN
KX$L2.TMRBLK.FLNK$
     18120**DCL     23064>>IF      23064>>ASSIGN  23065>>ASSIGN  23065>>ASSIGN  23119<<ASSIGN  23134>>IF
     23138>>ASSIGN  23141>>ASSIGN  23143>>ASSIGN
KX$L2.TMRBLK.ON
     18122**DCL     21386>>IF      23064>>IF      23064<<ASSIGN  23115>>IF      23118<<ASSIGN  23130>>IF
     23133<<ASSIGN
KX$L2.TRC
     18380**DCL     21692<>CALL
KX$L2.TRCX
     18380**DCL     21692<>CALL
KX$L2.VR
     18075**DCL     21201>>IF      21246<<ASSIGN  21246>>ASSIGN  21608>>ASSIGN  21652>>ASSIGN  22725<<ASSIGN
KX$L2.VS
     18074**DCL     21320>>ASSIGN  21324>>ASSIGN  21329<<ASSIGN  21329>>ASSIGN  21608>>ASSIGN  21651>>ASSIGN
     22600>>ASSIGN  22632>>ASSIGN  22724<<ASSIGN  22770<<ASSIGN
KX$L2S.COMBUF.DAT
     18783**DCL     20775--DOINDEX 20776>>ASSIGN  20848<<ASSIGN
KX$L2S.COMBUF.DATAVL
     18781**DCL     20758>>IF      20774<<ASSIGN
KX$L2S.COMBUF.FEPBSY
     18782**DCL     20764<<ASSIGN  20849<<ASSIGN
KX$L2S.COMBUF.FEPRDY
     18782**DCL     20765<<ASSIGN  20767>>DOWHILE
KX$L2S.DFLVCPRF.TRADEL
     18577**DCL     18587--REDEF
KX$L2S.DSTSNPA.ADR_STRING
     18768**DCL     18768--REDEF
KX$L2S.FRMR_NSNR
     18554**DCL     18555--REDEF
KX$L2S.NTWADR.ADR_STRING
     18488**DCL     18488--REDEF
KX$L2S.P_CCB.LNK$
     18468**DCL     18468--REDEF
KX$L2S.P_FRAME
     18475**DCL     20816<>CALL    20816--CALL    20816--CALL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:366  
KX$L2S.P_FRAME.CTLRPF
     18475**DCL     20816<>CALL
KX$L2S.REJ_CNT
     18557**DCL     20792<<ASSIGN  20792>>ASSIGN
KX$L2S.STATES
     18436**DCL     18436--REDEF
KX$L3.CALL_OPTS.RCVADR.ADR_STRING
     18846**DCL     18846--REDEF
KX$L3.CM_OPTS.RCVADR.ADR_STRING
     18881**DCL     18881--REDEF
KX$L3.CUG
     18924**DCL     18925--REDEF
KX$L3.DFL_OPTS.RCVADR.ADR_STRING
     18916**DCL     18916--REDEF
KX$L3.LCLADR.ADR_STRING
     19041**DCL     19041--REDEF
KX$L3.LCLNSAP
     19058**DCL     19114--REDEF
KX$L3.LCLNSAP.NSAP.ADDRESS_N
     19109**DCL     19110--REDEF
KX$L3.LCN#
     18923**DCL     18924--REDEF
KX$L3.RMTNSAP
     19131**DCL     19187--REDEF
KX$L3.RMTNSAP.NSAP.ADDRESS_N
     19182**DCL     19183--REDEF
KX$L3.STATES
     18929**DCL     18929--REDEF
KX$L3.TRNDLY
     18925**DCL     18926--REDEF
KX$L3.TRNDLYIND
     18926**DCL     18927--REDEF
KX$LINKDEV
     17945**DCL     20939<<ASSIGN
KX$LINKDEV.BLNK$
     17946**DCL     20954<<ASSIGN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:367  
KX$LINKDEV.CHN$
     17945**DCL     20943<<ASSIGN
KX$LINKDEV.CRC
     17948**DCL     20944<<ASSIGN
KX$LINKDEV.INBOUND
     17950**DCL     20952<<ASSIGN
KX$LINKDEV.L2$
     17947**DCL     20953<<ASSIGN
KX$LINKDEV.LOGON
     17949**DCL     20947<<ASSIGN
KX$LINKDEV.OUTBOUND
     17950**DCL     20950<<ASSIGN
KX$LINKDEV.PRTID
     17949**DCL     20945<<ASSIGN
KX$LINKDEV.SUBADR
     17949**DCL     20946<<ASSIGN
KX$PACKET.CTL
     19385**DCL     19385--REDEF
KX$PACKET.GFI
     19414**DCL     21069<<ASSIGN
KX$PACKET.LCN#
     19414**DCL     19415--REDEF
KX$PACKET.RLS_STAT
     19380**DCL     19381--REDEF
KX$PACKET.TYPE
     19415**DCL     19415--REDEF   19427--REDEF
KX$PACKET.TYPE_BITS.PS
     19419**DCL     19419--REDEF
KX$TDATA.L2_LIST$
     19505**DCL     21350<<ASSIGN  22662>>ASSIGN
KX$TDATA.RLS_STAT
     19505**DCL     19506--REDEF   22667>>IF
KX$TFRAME.CTL
     19353**DCL     19353--REDEF
KX$TFRAME.RLS_STAT
     19348**DCL     19349--REDEF
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:368  
KX$XFPACKET.LCN#
     19472**DCL     19473--REDEF
KX$XFPACKET.RLS_STAT
     19446**DCL     19447--REDEF
KX$XFPACKET.TYPE
     19473**DCL     19473--REDEF   19485--REDEF
KX$XFPACKET.TYPE_BITS.PS
     19477**DCL     19477--REDEF
KX$XFPACKET.XCTL
     19451**DCL     19452--REDEF
KX$XFPACKET.XCTL.CTL
     19451**DCL     19451--REDEF
KX$XFRAME.CTL
     19261**DCL     19261--REDEF
KX$XFRAME.FRMR_BITS
     19273**DCL     21654<<ASSIGN
KX$XFRAME.FRMR_CTL
     19272**DCL     21650<<ASSIGN
KX$XFRAME.FRMR_NSNR
     19272**DCL     19272--REDEF
KX$XFRAME.FRMR_VARS.CR
     19273**DCL     21653<<ASSIGN
KX$XFRAME.FRMR_VARS.VR
     19273**DCL     21652<<ASSIGN
KX$XFRAME.FRMR_VARS.VS
     19272**DCL     21651<<ASSIGN
KX$XFRAME.RLS_STAT
     19256**DCL     19257--REDEF
KXC$CQSCN
     15566**DCL-ENT 20997--ASSIGN
KXN$CMND
     15567**DCL-ENT 20863--CALL    20864--CALL    20917--CALL    21058--CALL    21072--CALL    21382--CALL
     21658--CALL    21751--CALL    21783--CALL    21893--CALL    21924--CALL    21958--CALL    22005--CALL
     22042--CALL    22078--CALL    22838--CALL    22930--CALL
KXP$PACKET
     15568**DCL-ENT 21025--CALL    21080--CALL    21267--CALL    22953--CALL    23037--CALL    23095--CALL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:369  
KXS$GETBFR
     15569**DCL-ENT 21625--CALL    22905--CALL
KXS$GETCNTX
     15570**DCL-ENT 20932--CALL
KXS$RLSBFR
     15571**DCL-ENT 22669--CALL    22804--CALL    23167--CALL    23199--CALL
KXS$RLSCNTX
     15572**DCL-ENT 21038--CALL    22069--CALL
KXS$SYSLOG
     15574**DCL-ENT 20816--CALL    20844--CALL    21692--CALL    22529--CALL    22977--CALL    23003--CALL
KX_FRAME
     20733**DCL     21256<<ASSIGN
KX_LINKDEV
     15762**DCL     20935--CALL    20939>>ASSIGN
KX_STATS_HDLC.CONNECTS
     20382**DCL     23051<<ASSIGN  23051>>ASSIGN
KX_STATS_HDLC.DISCONNECTS
     20382**DCL     21502<<ASSIGN  21502>>ASSIGN  22055<<ASSIGN  22055>>ASSIGN
KX_STATS_HDLC.F_REJECTS_IN
     20385**DCL     20791<<ASSIGN  20791>>ASSIGN  21760<<ASSIGN  21760>>ASSIGN
KX_STATS_HDLC.F_REJECTS_OUT
     20385**DCL     20789<<ASSIGN  20789>>ASSIGN  21232<<ASSIGN  21232>>ASSIGN
KX_STATS_HDLC.LINES
     20382**DCL     21503<<ASSIGN  21503>>ASSIGN  22056<<ASSIGN  22056>>ASSIGN  23050<<ASSIGN  23050>>ASSIGN
KX_STATS_HDLC.REQSTATS.DSPMSK
     20330**DCL     20336--REDEF
KX_STATS_HDLC.REQSTATS.SLCMSK
     20371**DCL     20378--REDEF
KX_STATS_HDLC.RESETS
     20385**DCL     20794<<ASSIGN  20794>>ASSIGN  20820<<ASSIGN  20820>>ASSIGN  21976<<ASSIGN  21976>>ASSIGN
KX_STATS_HDLC.TIMEOUTS
     20384**DCL     20783<<ASSIGN  20783>>ASSIGN  20985<<ASSIGN  20985>>ASSIGN
KX_STATS_X25.BYTES_IN
     20707**DCL     21076<<ASSIGN  21076>>ASSIGN  21252<<ASSIGN  21252>>ASSIGN
KX_STATS_X25.BYTES_OUT
     20707**DCL     21070<<ASSIGN  21070>>ASSIGN  21374<<ASSIGN  21374>>ASSIGN
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:370  
KX_STATS_X25.PACKETS_IN
     20707**DCL     21075<<ASSIGN  21075>>ASSIGN  21251<<ASSIGN  21251>>ASSIGN
KX_STATS_X25.PACKETS_OUT
     20708**DCL     21071<<ASSIGN  21071>>ASSIGN  21372<<ASSIGN  21372>>ASSIGN
KX_STATS_X25.REQSTATS.DSPMSK
     20655**DCL     20661--REDEF
KX_STATS_X25.REQSTATS.SLCMSK
     20696**DCL     20703--REDEF
KX_TMRBLK.QHD$
     20061**DCL     23065<<ASSIGN  23077<<ASSIGN  23122<<ASSIGN  23141<<ASSIGN
KX_TMRBLK.QTL$
     20061**DCL     23064<<ASSIGN  23076<<ASSIGN  23120>>IF      23124>>ASSIGN  23125>>ASSIGN  23126<<ASSIGN
     23136<<ASSIGN
LOG
     16384**DCL     20781>>ASSIGN  20785>>ASSIGN  21713>>ASSIGN
L_1
     21490**LABEL   21452--GOTO
L_10
     21515**LABEL   21558--GOTO
L_2
     20877**LABEL   20857--GOTO    20913--GOTO
L_3
     22024**LABEL   21575--GOTO
L_4
     21897**LABEL   21850--GOTO    21878--GOTO
L_5
     21928**LABEL   21864--GOTO
L_6
     21976**LABEL   21810--GOTO
L_7
     21518**LABEL   21547--GOTO
L_9
     21545**LABEL   21533--GOTO
L_ALTRET
     20937**LABEL   20926--CALLALT 20932--CALLALT
L_DSC
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:371  
     20873**LABEL   20869--GOTO
L_RET0
     21012**LABEL   20760--GOTO    20850--GOTO    20865--GOTO    20882--GOTO    20904--GOTO    20918--GOTO
     20963--GOTO    21061--GOTO    21064--GOTO    21082--GOTO    21085--GOTO
M$CLOCK
      7806**DCL-ENT 21003--CALL
NR
     17318**DCL     22192<<ASSIGN  22197<<ASSIGN  22595>>ASSIGN  22631>>ASSIGN
ONE_SECOND
     17210**DCL     17202--DCLINIT
PEVENT
     17261**DCL     22940<<ASSIGN  22946<<ASSIGN  22951>>ASSIGN
PF
     17317**DCL     21630>>IF      22186<<ASSIGN  22191<<ASSIGN  22196<<ASSIGN  22225>>IF      22259>>IF
     22306>>IF      22351>>IF      22421>>IF      22450>>IF      22575>>IF
RESET
     16437**DCL     20818>>ASSIGN  21804>>ASSIGN
SEND_ADR_RESP IN PROCEDURE Y$UA
     22890**LABEL   22867--GOTO    22881--GOTO
SEND_COMMON IN PROCEDURE Y$UA
     22905**LABEL   22891--GOTO
SLCC_UP
     21059**LABEL   21057--GOTO
SNDFRMR
     16694**DCL     20816<>CALL    21692<>CALL
START
     16541**DCL     21059>>ASSIGN  22022>>ASSIGN
STATE_TABLE.ACTION
     15936**DCL     21109>>ASSIGN  21117>>DOCASE
STATE_TABLE.NEXT_STATE
     15779**DCL     21098>>ASSIGN
STOP_ENTRY
     22042**LABEL   21067--GOTO
STR
     19957**DCL     20816<>CALL    20816<>CALL    21256>>ASSIGN
SUBCOMMON IN PROCEDURE Y$RESET
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:372  
     22716**LABEL   22710--GOTO
SUBCOMMON IN PROCEDURE Y$STOP
     22946**LABEL   22942--GOTO
T20TIMEOUT
     16490**DCL     21017>>ASSIGN
TEMP1
     17313**DCL     20766<<ASSIGN  20771<<ASSIGN  20771>>ASSIGN  20772>>IF      20775<<DOINDEX 20776>>ASSIGN
     20778>>DOCASE  20780>>ASSIGN  20844<>CALL    20856<<ASSIGN  20868<<ASSIGN  20871<<ASSIGN  20912<<ASSIGN
     23088>>ASSIGN
TEMP1$
     17093**DCL     21625<>CALL    21626>>ASSIGN  21627>>ASSIGN  21628>>ASSIGN  21629>>ASSIGN  21632>>ASSIGN
     21634>>ASSIGN  21641>>ASSIGN  21642>>ASSIGN  21643>>ASSIGN  21650>>ASSIGN  21651>>ASSIGN  21652>>ASSIGN
     21653>>ASSIGN  21654>>ASSIGN  21657>>ASSIGN
TEMP2
     17314**DCL     20776<<ASSIGN  20778>>IF      20783>>ASSIGN  20789>>ASSIGN  20791>>ASSIGN  20794>>ASSIGN
     20820>>ASSIGN  20844<>CALL    21097<<ASSIGN  21098>>ASSIGN  21109>>ASSIGN  21117>>DOCASE  21195<<ASSIGN
     21197<<ASSIGN  21201>>IF      22595<<ASSIGN  22610>>IF      22613<<ASSIGN  22613>>ASSIGN  22618>>IF
     22618>>IF      22631<<ASSIGN  22636>>IF      22647>>DOUNTIL 22706<<ASSIGN  22716<<ASSIGN  22742>>IF
     22751<<ASSIGN  22756>>ASSIGN  22761>>ASSIGN  22764<<ASSIGN  22764>>ASSIGN  22770>>ASSIGN
TEMP3
     17315**DCL     20780<<ASSIGN  20844<>CALL    21373<<ASSIGN  21374>>ASSIGN  22149<<ASSIGN  22150>>IF
     22150>>IF      22150>>IF      22150>>IF      22599<<ASSIGN  22604>>IF      22610>>IF      22618>>IF
     22636>>IF      22647>>DOUNTIL 22651<<ASSIGN  22651>>ASSIGN  22674>>ASSIGN
TEMP3$
     17094**DCL     22658<<ASSIGN  22662>>ASSIGN  22666>>ASSIGN  22667>>IF      22669<>CALL    22800<<ASSIGN
     22805>>ASSIGN
TEMP4
     17316**DCL     22600<<ASSIGN  22604>>IF      22607<<ASSIGN  22607>>ASSIGN  22618>>IF      22632<<ASSIGN
UP
     16592**DCL     23044>>ASSIGN
X25_PRM_CLK
     17199**DCL     21003<>CALL
X25_PRM_CLK.V
     17202**DCL     17202--DCLINIT
Y$CAL_PAC
     23086**PROC    20877--CALL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:373  
Y$CAL_PAC0 IN PROCEDURE Y$CAL_PAC
     23091**ENTRY   20926--CALL
Y$CAL_PAC1 IN PROCEDURE Y$CAL_PAC
     23093**ENTRY   20756--CALL
Y$CLR_DAT_Q
     23151**PROC    21473--CALL
Y$CLR_SUP_Q
     23188**PROC    21474--CALL    21545--CALL    21621--CALL    21784--CALL    21894--CALL    21925--CALL
     21959--CALL
Y$CONDITION
     22169**PROC    20980--CALL
Y$DIED IN PROCEDURE Y$STOP
     22944**ENTRY   22048--CALL
Y$ER
     22959**PROC    21018--CALL    21060--CALL    21410--CALL    21490--CALL    22024--CALL    22435--CALL
     23045--CALL
Y$ER2
     22982**PROC    21714--CALL    21805--CALL
Y$NR
     22553**PROC    22242--CALL    22273--CALL    22285--CALL    22298--CALL    22320--CALL    22330--CALL
     22343--CALL    22365--CALL    22375--CALL    22388--CALL
Y$RESET
     22694**PROC    21447--CALL    21484--CALL    21515--CALL
Y$RESET_RETRAN IN PROCEDURE Y$RESET
     22712**ENTRY   21150--CALL    21971--CALL
Y$RESP IN PROCEDURE Y$UA
     22873**ENTRY   21215--CALL    21266--CALL    21738--CALL    21836--CALL
Y$RETRAN
     22825**PROC    21139--CALL    21176--CALL    21752--CALL    22790--CALL
Y$SEND_COMMAND IN PROCEDURE Y$UA
     22893**ENTRY   21405--CALL    21443--CALL    21480--CALL    21518--CALL    21788--CALL    21897--CALL
     21928--CALL    22010--CALL
Y$SEND_RESPONSE IN PROCEDURE Y$UA
     22883**ENTRY   21228--CALL    21293--CALL
Y$START_TIMER
     23104**PROC    21389--CALL    21418--CALL    21493--CALL    21521--CALL    21662--CALL    21755--CALL
PL6.E3A0      #001=KXF$FRAME File=KXF$FRAME.:E05TSI                              WED 07/30/97 02:19 Page:374  
     21795--CALL    21904--CALL    21936--CALL    22017--CALL    22688--CALL    22785--CALL
Y$STOP
     22938**PROC    21438--CALL    21469--CALL
Y$STOP_T20
     23070**PROC    22044--CALL    22732--CALL
Y$STOP_TIMER
     23058**PROC    21172--CALL    21570--CALL    21967--CALL    22043--CALL    22684--CALL    22731--CALL
     23021--CALL
Y$UA
     22855**PROC    21478--CALL    21557--CALL    21963--CALL    22094--CALL    22113--CALL
Y$UP
     23010**PROC    21063--CALL    22106--CALL    22114--CALL
Y_ACTSCR
     16943**DCL     21991<>CALL
Y_NO_PRMCLK
     16821**DCL     21009<>CALL
Y_UNKACT
     17004**DCL     22127<>CALL
Y_UNKEVT
     16882**DCL     20823<>CALL    21045<>CALL    21084<>CALL
