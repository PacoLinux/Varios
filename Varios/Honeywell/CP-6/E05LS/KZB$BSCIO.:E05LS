VERSION E05

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:1    
        1        1        /*M*  Line Manager for 2780/3780 and HASP protocol                 */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
        8        8        /*P*     NAME:     KZB$BSCIO
        9        9                 PURPOSE:  To process I/O complete events for HASP and 2780/3780
       10       10                           lines.
       11       11                                                                           */
       12       12        %EJECT;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:2    
       13       13        /*F*     NAME:     KZB$BSCIO
       14       14                 PURPOSE:  To control what happens on a 2780/3780 line.
       15       15                                                                           */
       16       16        %EJECT;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:3    
       17       17        /*D*     NAME:     KZB$BSCIO
       18       18                 CALL:
       19       19                    CALL KZB$BSCIO (Line-context,Bisync-FPT) ALTRET(label);
       20       20                 PARAMETERS:
       21       21                    Bisync-FPT is the Common Line Manager FPT structure.
       22       22                    Line-context is the line context structure.
       23       23                 INTERFACE:
       24       24                    This module calls routine KZR$RBT for reporting
       25       25                    input and acquiring output.
       26       26                 ENVIRONMENT:
       27       27                    The routine is entered at the Inhibit Interrupt Level and
       28       28                    must exit at the same level.
       29       29                 DESCRIPTION:
       30       30                    KZB$BSCIO is called by the Common Line Manager when an input
       31       31                    complete event occurs. It is passed an FPT structure
       32       32                    containing an event code which represents what
       33       33                    happened, a new state code, an old state code, and
       34       34                    an action code.
       35       35                    A normal return causes nothing further to be done on
       36       36                    behalf of the line.  If an ALTRETURN occurs, the Common Line
       37       37                    Manager will perform further processing based on the
       38       38                    event and function fields in the FPT.
       39       39                    Possiblities are; screech, change state and call
       40       40                           KZB$BSCIO again, or disconnect.
       41       41        */
       42       42        %EJECT;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:4    
       43       43        KZB$BSCIO: PROC ( KZ$LINCTX, KZ@BSCFPT ) ALTRET;
       44       44
       45       45        %INCLUDE KZ$LINCTX;
       46      665        %INCLUDE KZ$RBT_M;
       47     1224        %INCLUDE KZ_BSCFPT;
       48     1254        %INCLUDE KZ_BSC_C;
       49     2236        %INCLUDE KZ_LIN_C;
       50     2292        %INCLUDE LCP_6;
       51     6571        %INCLUDE KZ_MLCP_C;
       52     6646        %INCLUDE KH$CLK;
       53     7016        %INCLUDE KH_CLKFNC_E;
       54     7061
       55     7062        %KZ$LINCTX     ( NAME = KZ$LINCTX, STCLASS = "" );
       56     7493
       57     7494        %KZ$EVENT (STCLASS="");
       58     7576
       59     7577        %KZ_BSCFPT     ( NAME = KZ@BSCFPT );
       60     7586        %KZ_BSCFPTEQUS;
       61     7592        %KZ$RBT_E;
       62     7622
       63     7623    1   DCL KZR_ABORT@ EPTR SYMREF;
       64     7624    1   DCL KZR_ORDERS@ EPTR SYMREF;
       65     7625
       66     7626    1   DCL KZR$RBT ENTRY(1) ALTRET;
       67     7627    1   DCL KZR$RELOTPBFR ENTRY(1) ALTRET;
       68     7628    1   DCL KZB$DFRWACK ENTRY;
       69     7629    1   DCL KZB$DFRNAK ENTRY;
       70     7630    1   DCL KZB$DFRENQ ENTRY;
       71     7631    1   DCL KZB$DFRTTD ENTRY;
       72     7632    1   DCL KZB$INACTCLK ENTRY(1) ALTRET;
       73     7633    1   DCL KZL$OTPRDY ENTRY(1) ALTRET;
       74     7634    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
       75     7635
       76     7636
       77     7637        %KH$CLK (FPTN=KH_CLK,STCLASS=CONSTANT,FNC=%KH#CLK_SETCLK,
       78     7638                 PRD=1,PRDUNT=%KH#C_SEC);
       79     7787        %KH$CLK (FPTN=CLK_FPT,STCLASS="",FNC=%KH#CLK_SETCLK);
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:5    
       80     7936
       81     7937        %KH$CLK (FPTN=KH_CNCL,STCLASS=CONSTANT,FNC=%KH#CLK_CANCEL);
       82     8086    1   DCL BFR CHAR(1) BASED(KZ$LINCTX.OTPHD$);
       83     8087        %KH$CLK (FPTN=CNCL,STCLASS="",FNC=%KH#CLK_CANCEL);
       84     8236
       85     8237
       86     8238        %EJECT;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:6    
       87     8239    2         DO CASE ( KZ@BSCFPT.ACT );
       88     8240
       89     8241    2          CASE ( %KZ#BSCACT_INIT );
       90     8242
       91     8243    2            KZ@BSCFPT.FNC = %KZ#FNC_DSC;
       92     8244    2            ALTRETURN;
       93     8245
       94     8246    2          CASE ( %KZ#BSCACT_LISTEN );
       95     8247
       96     8248    2            CALL KZR_ORDERS@ ( %KZ#SEND_NOTHING, KZ$LINCTX );
       97     8249
       98     8250    2          CASE ( %KZ#BSCACT_DOWHAT );
       99     8251
      100     8252    2            CALL KZR_ABORT@ ( KZ$LINCTX );
      101     8253
      102     8254                 /* Check for a device with output waiting.  If so, report
      103     8255                    SNDOTP to bid for the line.  Otherwise, just listen again.       */
      104     8256
      105     8257    2            KZ@BSCFPT.FNC = %KZ#FNC_MOV;
      106     8258    2            KZ@BSCFPT.EVT = %KZ#BSCEVT_GO;
      107     8259    2            CALL KZL$OTPRDY (KZ$LINCTX)  ALTRET(MOVALT);
      108     8260    2            KZ@BSCFPT.EVT = %KZ#BSCEVT_SNDOTP;
      109     8261    2            ALTRETURN;
      110     8262
      111     8263    2          CASE ( %KZ#BSCACT_ACK0,
      112     8264    2               %KZ#BSCACT_ACK1 );
      113     8265
      114     8266    2            CALL KZB$INACTCLK (KZ$LINCTX);
      115     8267    3            IF KZ$LINCTX.CTB.ENQ$ ~= ADDR(NIL) THEN DO;
      116     8268    3               CNCL=KH_CNCL;
      117     8269    3               CNCL.CTBCTX$=KZ$LINCTX.CTB.ENQ$;
      118     8270    3               KZ$LINCTX.CTB.ENQ$=ADDR(NIL);
      119     8271    3               CALL KHC$CLOCK (CNCL);
      120     8272    3               END;
      121     8273    3            IF KZ$LINCTX.CTB.NAK$ ~= ADDR(NIL) THEN DO;
      122     8274    3               CNCL=KH_CNCL;
      123     8275    3               CNCL.CTBCTX$=KZ$LINCTX.CTB.NAK$;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:7    
      124     8276    3               KZ$LINCTX.CTB.NAK$=ADDR(NIL);
      125     8277    3               CALL KHC$CLOCK (CNCL);
      126     8278    3               END;
      127     8279    2            IF KZ@BSCFPT.EVT = %KZ#BSCEVT_ENQ THEN
      128     8280    2               CALL CNTRTRY ALTRET(MOVALT);
      129     8281    2            ELSE
      130     8282    2               KZ$LINCTX.RTRCNT = 0;
      131     8283    2            IF KZ@BSCFPT.ACT = %KZ#BSCACT_ACK0 THEN
      132     8284    2               CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );
      133     8285    2            ELSE
      134     8286    2               CALL KZR_ORDERS@ ( %KZ#SEND_ACK1, KZ$LINCTX );
      135     8287
      136     8288    2          CASE ( %KZ#BSCACT_WACK );
      137     8289    2            CALL KZB$INACTCLK (KZ$LINCTX);
      138     8290
      139     8291    2            IF KZ@BSCFPT.EVT = %KZ#BSCEVT_ETBBLK OR
      140     8292    2               KZ@BSCFPT.EVT = %KZ#BSCEVT_ETXBLK THEN
      141     8293    2               KZ$LINCTX.INPDATSIZ = KZ@BSCFPT.SIZ;
      142     8294    2            KZ$EVENT.EVENT=%KZ#LINFCN_INP;
      143     8295    2            KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);
      144     8296    2            CALL KZR$RBT (KZ$EVENT) ALTRET(CANT_ACCEPT_INPUT);
      145     8297    2   MOVE_WITH_GO:;
      146     8298    2            KZ@BSCFPT.EVT = %KZ#BSCEVT_GO;
      147     8299    2            KZ@BSCFPT.FNC = %KZ#FNC_MOV;
      148     8300    2   MOVALT:  ALTRETURN;
      149     8301
      150     8302    2   CANT_ACCEPT_INPUT:;
      151     8303    2            CLK_FPT=KH_CLK;
      152     8304    2            CLK_FPT.UID$=ADDR(KZ$LINCTX);
      153     8305    2            CLK_FPT.SBR$=ENTADDR(KZB$DFRWACK);
      154     8306    2            CALL KHC$CLOCK (CLK_FPT);
      155     8307    2            KZ$LINCTX.CTB.ENQ$ = CLK_FPT.CTBCTX$;
      156     8308
      157     8309    2          CASE ( %KZ#BSCACT_NAK );
      158     8310
      159     8311    2            CALL CNTRTRY ALTRET(MOVALT);
      160     8312    2            CALL KZR_ORDERS@ ( %KZ#SEND_NAK, KZ$LINCTX );
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:8    
      161     8313
      162     8314    2          CASE ( %KZ#BSCACT_DNAK );
      163     8315
      164     8316    2            CALL KZB$INACTCLK (KZ$LINCTX);
      165     8317    2            KZ$LINCTX.RTRCNT = 0;
      166     8318    2            CLK_FPT=KH_CLK;
      167     8319    2            CLK_FPT.UID$=ADDR(KZ$LINCTX);
      168     8320    2            CLK_FPT.SBR$=ENTADDR(KZB$DFRNAK);
      169     8321    2            CALL KHC$CLOCK (CLK_FPT);
      170     8322    2            KZ$LINCTX.CTB.NAK$ = CLK_FPT.CTBCTX$;
      171     8323
      172     8324    2          CASE ( %KZ#BSCACT_BID );
      173     8325
      174     8326    2            CALL KZR_ABORT@ ( KZ$LINCTX );
      175     8327    2            IF KZ$LINCTX.PRO.SLAVE THEN
      176     8328    2               KZ$LINCTX.TIMOUT.USESEC='1'B; /* Send ENQ at secondary rate. */
      177     8329    2            CALL KZR_ORDERS@ ( %KZ#SEND_ENQ, KZ$LINCTX );
      178     8330
      179     8331    2          CASE ( %KZ#BSCACT_TTD );
      180     8332
      181     8333    2            CALL KZB$INACTCLK (KZ$LINCTX);
      182     8334    2            KZ$LINCTX.TIMOUT.USESEC='0'B; /* Use primary timeout value now */
      183     8335    2            KZ$LINCTX.FLAGS.FIRST = '0'B;
      184     8336    2            KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP;
      185     8337    2            KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);
      186     8338    2            CALL KZR$RBT (KZ$EVENT) ALTRET(NO_BSC_OTP);
      187     8339    2            IF NOT KZ$LINCTX.FLAGS.FIRST THEN
      188     8340    2               KZ@BSCFPT.EVT = %KZ#BSCEVT_GO;
      189     8341    2            ELSE
      190     8342    2               KZ@BSCFPT.EVT = %KZ#BSCEVT_SNDOTP;
      191     8343    2            KZ$LINCTX.FLAGS.FIRST = '0'B;
      192     8344    2            KZ@BSCFPT.FNC = %KZ#FNC_MOV;
      193     8345    2            ALTRETURN;
      194     8346    2   NO_BSC_OTP:;
      195     8347    2            CLK_FPT=KH_CLK;
      196     8348    2            CLK_FPT.PRD=2;            /* Send TTD every two seconds */
      197     8349    2            CLK_FPT.UID$=ADDR(KZ$LINCTX);
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:9    
      198     8350    2            CLK_FPT.SBR$=ENTADDR(KZB$DFRTTD);
      199     8351    2            CALL KHC$CLOCK (CLK_FPT);
      200     8352    2            KZ$LINCTX.CTB.ENQ$ = CLK_FPT.CTBCTX$;
      201     8353
      202     8354    2          CASE ( %KZ#BSCACT_ETB );
      203     8355
      204     8356    2            IF KZ@BSCFPT.EVT = %KZ#BSCEVT_NAK AND
      205     8357    3               NOT KZ$LINCTX.PRO.ERRDUPBLK THEN DO;
      206     8358                    /* We're not allowed to resend blocks to this device...
      207     8359                       pretend everything was OK (we got an ACK0/1). */
      208     8360    3               IF KZ@BSCFPT.NEWSTT = %KZ#BSCSTT_ETB_16 THEN
      209     8361    3                  KZ@BSCFPT.EVT = %KZ#BSCEVT_ACK1;
      210     8362    3               ELSE
      211     8363    3                  KZ@BSCFPT.EVT = %KZ#BSCEVT_ACK0;
      212     8364    3               KZ$LINCTX.FLAGS.FIRST = '0'B;
      213     8365    3               KZ@BSCFPT.FNC = %KZ#FNC_MOV;
      214     8366    3               ALTRETURN;
      215     8367    3               END;
      216     8368    2            KZ$LINCTX.RTRCNT = 0;
      217     8369    2            CALL KZR_ORDERS@ ( %KZ#SEND_BLOCK, KZ$LINCTX );
      218     8370
      219     8371    2          CASE ( %KZ#BSCACT_ETX );
      220     8372
      221     8373    2            IF KZ@BSCFPT.EVT = %KZ#BSCEVT_NAK AND
      222     8374    3               NOT KZ$LINCTX.PRO.ERRDUPBLK THEN DO;
      223     8375                    /* We're not allowed to resend blocks to this device...
      224     8376                       pretend everything was OK (we got an ACK0/1). */
      225     8377    3               IF KZ@BSCFPT.NEWSTT = %KZ#BSCSTT_ETX_17 THEN
      226     8378    3                  KZ@BSCFPT.EVT = %KZ#BSCEVT_ACK1;
      227     8379    3               ELSE
      228     8380    3                  KZ@BSCFPT.EVT = %KZ#BSCEVT_ACK0;
      229     8381    3               KZ$LINCTX.FLAGS.FIRST = '0'B;
      230     8382    3               KZ@BSCFPT.FNC = %KZ#FNC_MOV;
      231     8383    3               ALTRETURN;
      232     8384    3               END;
      233     8385    2            KZ$LINCTX.RTRCNT = 0;
      234     8386    2            CALL KZR_ORDERS@ ( %KZ#SEND_TEXT, KZ$LINCTX );
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:10   
      235     8387
      236     8388    2          CASE ( %KZ#BSCACT_XITSND );
      237     8389    2            CALL KZB$INACTCLK (KZ$LINCTX);
      238     8390
      239     8391    3            IF KZ$LINCTX.OTPHD$ ~= ADDR(NIL) THEN DO;
      240     8392    3               CALL KZR$RELOTPBFR (BFR);
      241     8393    3               KZ$LINCTX.OTPHD$ = ADDR(NIL);
      242     8394    3               END;
      243     8395    2            CALL KZR_ORDERS@ ( %KZ#SEND_EOT, KZ$LINCTX );
      244     8396
      245     8397    2          CASE ( %KZ#BSCACT_ENQERR );
      246     8398
      247     8399    2            CALL CNTRTRY ALTRET(MOVALT);
      248     8400    2            CALL KZR_ORDERS@ ( %KZ#SEND_ENQ, KZ$LINCTX );
      249     8401
      250     8402    2          CASE ( %KZ#BSCACT_ENQ );
      251     8403
      252     8404    2            CLK_FPT=KH_CLK;
      253     8405    2            CLK_FPT.UID$=ADDR(KZ$LINCTX);
      254     8406    2            CLK_FPT.SBR$=ENTADDR(KZB$DFRENQ);
      255     8407    2            CALL KHC$CLOCK (CLK_FPT);
      256     8408    2            KZ$LINCTX.CTB.ENQ$ = CLK_FPT.CTBCTX$;
      257     8409
      258     8410    2          CASE ( %KZ#BSCACT_TMOENQ );
      259     8411
      260     8412    2            CALL CNTRTRY ALTRET(MOVALT);
      261     8413    2            CALL KZR_ORDERS@ (%KZ#SEND_NOTHING,KZ$LINCTX);
      262     8414
      263     8415    2          CASE ( %KZ#BSCACT_INITACK0 );
      264     8416
      265     8417    2            CALL KZB$INACTCLK (KZ$LINCTX);
      266     8418    2            KZ$LINCTX.CURDEV$=ADDR(NIL);
      267     8419    2            CALL CNTRTRY ALTRET(MOVALT);
      268     8420    2            CALL KZR_ORDERS@ (%KZ#SEND_ACK0,KZ$LINCTX);
      269     8421
      270     8422    2          END;
      271     8423
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:11   
      272     8424        /*    Count retries                                                */
      273     8425
      274     8426    1   CNTRTRY: PROC ALTRET;
      275     8427
      276     8428    2         KZ$LINCTX.RTRCNT = KZ$LINCTX.RTRCNT + 1;
      277     8429    2         IF KZ$LINCTX.PRO.RETRYS > 0 AND
      278     8430    3            KZ$LINCTX.RTRCNT > KZ$LINCTX.PRO.RETRYS THEN DO;
      279     8431    3            KZ@BSCFPT.EVT = %KZ#BSCEVT_URCERR;
      280     8432    3            KZ@BSCFPT.FNC = %KZ#FNC_MOV;
      281     8433    3            ALTRETURN;
      282     8434    3            END;
      283     8435    2         RETURN;
      284     8436    2   END;
      285     8437    1   END KZB$BSCIO;
      286     8438        %EOD;

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:12   
--  Include file information  --

   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KZ_MLCP_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KZ_BSC_C.:E05TOU  is referenced.
   KZ_BSCFPT.:E05TOU  is referenced.
   KZ$RBT_M.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZB$BSCIO.

   Procedure KZB$BSCIO requires 839 words for executable code.
   Procedure KZB$BSCIO requires 48 words of local(AUTO) storage.

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:13   

 Object Unit name= KZB$BSCIO                                  File name= KZB$BSCIO.:E05TOU
 UTS= JUL 30 '97 02:49:05.16 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     19     13  KZB$BSCIO
    1   Proc  even  none   839    347  KZB$BSCIO

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KZB$BSCIO

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KZL$OTPRDY
 yes     yes           Std       1 KZR$RBT
         yes           Std       0 KZB$DFRWACK
 yes     yes           Std       1 KZR$RELOTPBFR
 yes     yes           Std       1 KHC$CLOCK
         yes           Std       0 KZB$DFRENQ
 yes     yes           Std       1 KZB$INACTCLK
         yes           Std       0 KZB$DFRNAK
         yes           Std       0 KZB$DFRTTD
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:14   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZR_ABORT@                            KZR_ORDERS@                      r    G$ROS$
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:15   


        1        1        /*M*  Line Manager for 2780/3780 and HASP protocol                 */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
        8        8        /*P*     NAME:     KZB$BSCIO
        9        9                 PURPOSE:  To process I/O complete events for HASP and 2780/3780
       10       10                           lines.
       11       11                                                                           */
       12       12        %EJECT;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:16   
       13       13        /*F*     NAME:     KZB$BSCIO
       14       14                 PURPOSE:  To control what happens on a 2780/3780 line.
       15       15                                                                           */
       16       16        %EJECT;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:17   
       17       17        /*D*     NAME:     KZB$BSCIO
       18       18                 CALL:
       19       19                    CALL KZB$BSCIO (Line-context,Bisync-FPT) ALTRET(label);
       20       20                 PARAMETERS:
       21       21                    Bisync-FPT is the Common Line Manager FPT structure.
       22       22                    Line-context is the line context structure.
       23       23                 INTERFACE:
       24       24                    This module calls routine KZR$RBT for reporting
       25       25                    input and acquiring output.
       26       26                 ENVIRONMENT:
       27       27                    The routine is entered at the Inhibit Interrupt Level and
       28       28                    must exit at the same level.
       29       29                 DESCRIPTION:
       30       30                    KZB$BSCIO is called by the Common Line Manager when an input
       31       31                    complete event occurs. It is passed an FPT structure
       32       32                    containing an event code which represents what
       33       33                    happened, a new state code, an old state code, and
       34       34                    an action code.
       35       35                    A normal return causes nothing further to be done on
       36       36                    behalf of the line.  If an ALTRETURN occurs, the Common Line
       37       37                    Manager will perform further processing based on the
       38       38                    event and function fields in the FPT.
       39       39                    Possiblities are; screech, change state and call
       40       40                           KZB$BSCIO again, or disconnect.
       41       41        */
       42       42        %EJECT;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:18   
       43       43        KZB$BSCIO: PROC ( KZ$LINCTX, KZ@BSCFPT ) ALTRET;

     43   1 000000  D380 0000 0000  xent KZB$BSCIO       LNJ,B5   X6A_AUTO_2
          1 000003       0030 0002                       DC       48,2

       44       44
       45       45        %INCLUDE KZ$LINCTX;
       46      665        %INCLUDE KZ$RBT_M;
       47     1224        %INCLUDE KZ_BSCFPT;
       48     1254        %INCLUDE KZ_BSC_C;
       49     2236        %INCLUDE KZ_LIN_C;
       50     2292        %INCLUDE LCP_6;
       51     6571        %INCLUDE KZ_MLCP_C;
       52     6646        %INCLUDE KH$CLK;
       53     7016        %INCLUDE KH_CLKFNC_E;
       54     7061
       55     7062        %KZ$LINCTX     ( NAME = KZ$LINCTX, STCLASS = "" );
       56     7493
       57     7494        %KZ$EVENT (STCLASS="");
       58     7576
       59     7577        %KZ_BSCFPT     ( NAME = KZ@BSCFPT );
       60     7586        %KZ_BSCFPTEQUS;
       61     7592        %KZ$RBT_E;
       62     7622
       63     7623    1   DCL KZR_ABORT@ EPTR SYMREF;
       64     7624    1   DCL KZR_ORDERS@ EPTR SYMREF;
       65     7625
       66     7626    1   DCL KZR$RBT ENTRY(1) ALTRET;
       67     7627    1   DCL KZR$RELOTPBFR ENTRY(1) ALTRET;
       68     7628    1   DCL KZB$DFRWACK ENTRY;
       69     7629    1   DCL KZB$DFRNAK ENTRY;
       70     7630    1   DCL KZB$DFRENQ ENTRY;
       71     7631    1   DCL KZB$DFRTTD ENTRY;
       72     7632    1   DCL KZB$INACTCLK ENTRY(1) ALTRET;
       73     7633    1   DCL KZL$OTPRDY ENTRY(1) ALTRET;
       74     7634    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
       75     7635
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:19   
       76     7636
       77     7637        %KH$CLK (FPTN=KH_CLK,STCLASS=CONSTANT,FNC=%KH#CLK_SETCLK,
       78     7638                 PRD=1,PRDUNT=%KH#C_SEC);
       79     7787        %KH$CLK (FPTN=CLK_FPT,STCLASS="",FNC=%KH#CLK_SETCLK);
       80     7936
       81     7937        %KH$CLK (FPTN=KH_CNCL,STCLASS=CONSTANT,FNC=%KH#CLK_CANCEL);
       82     8086    1   DCL BFR CHAR(1) BASED(KZ$LINCTX.OTPHD$);
       83     8087        %KH$CLK (FPTN=CNCL,STCLASS="",FNC=%KH#CLK_CANCEL);
       84     8236
       85     8237
       86     8238        %EJECT;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:20   
       87     8239    2         DO CASE ( KZ@BSCFPT.ACT );

   8239   1 000005  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          1 000007  B806                                 LDR,R3   ,B6
          1 000008  3D11                                 CMV,R3   17
          1 000009  0281 031A                            BGE      s:8422,PREL
          1 00000B  A830 0000 0011  01                   LDR,R2   s:8239+12,R3
          1 00000E  83A0 0000 0022  01                   JMP      s:8243,R2
          1 000011       0000                            DC       s:8243,PREL
          1 000012       0006                            DC       s:8248,PREL
          1 000013       0019                            DC       s:8252,PREL
          1 000014       003A                            DC       s:8266,PREL
          1 000015       00C4                            DC       s:8289,PREL
          1 000016       003A                            DC       s:8266,PREL
          1 000017       011F                            DC       s:8311,PREL
          1 000018       0135                            DC       s:8316,PREL
          1 000019       0164                            DC       s:8326,PREL
          1 00001A       0187                            DC       s:8333,PREL
          1 00001B       01EC                            DC       s:8356,PREL
          1 00001C       0223                            DC       s:8373,PREL
          1 00001D       025A                            DC       s:8389,PREL
          1 00001E       028E                            DC       s:8399,PREL
          1 00001F       02A4                            DC       s:8404,PREL
          1 000020       02C9                            DC       s:8412,PREL
          1 000021       02DF                            DC       s:8417,PREL

       88     8240
       89     8241    2          CASE ( %KZ#BSCACT_INIT );

       90     8242
       91     8243    2            KZ@BSCFPT.FNC = %KZ#FNC_DSC;

   8243   1 000022  6C02                                 LDV,R6   2
          1 000023  EF46 0004                            STR,R6   4,B6

       92     8244    2            ALTRETURN;

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:21   
   8244   1 000025  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

       93     8245
       94     8246    2          CASE ( %KZ#BSCACT_LISTEN );

       95     8247
       96     8248    2            CALL KZR_ORDERS@ ( %KZ#SEND_NOTHING, KZ$LINCTX );

   8248   1 000028  DBF0 000C                            LAB,B5   12,IMO
          1 00002A  CCC7 0004                            LDB,B4   @KZ$LINCTX,AUTO
          1 00002C  CFC7 002E                            STB,B4   CNCL+13,AUTO
          1 00002E  DFC7 002C                            STB,B5   CNCL+11,AUTO
          1 000030  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 000032  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 000035  CBF0 0200                            LAB,B4   512,IMO
          1 000037  E381                                 LNJ,B6   ,B1
          1 000038       0001                            DC       s:8248+17,PREL
          1 000039  0F81 02EA                            B        s:8422,PREL

       97     8249
       98     8250    2          CASE ( %KZ#BSCACT_DOWHAT );

       99     8251
      100     8252    2            CALL KZR_ABORT@ ( KZ$LINCTX );

   8252   1 00003B  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 00003D  9C80 0000 0000  xsym                 LDB,B1   KZR_ABORT@
          1 000040  CBF0 0100                            LAB,B4   256,IMO
          1 000042  E381                                 LNJ,B6   ,B1
          1 000043       0001                            DC       s:8257,PREL

      101     8253
      102     8254                 /* Check for a device with output waiting.  If so, report
      103     8255                    SNDOTP to bid for the line.  Otherwise, just listen again.       */
      104     8256
      105     8257    2            KZ@BSCFPT.FNC = %KZ#FNC_MOV;

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:22   
   8257   1 000044  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          1 000046  6C03                                 LDV,R6   3
          1 000047  EF46 0004                            STR,R6   4,B6

      106     8258    2            KZ@BSCFPT.EVT = %KZ#BSCEVT_GO;

   8258   1 000049  5C01                                 LDV,R5   1
          1 00004A  DF46 0001                            STR,R5   1,B6

      107     8259    2            CALL KZL$OTPRDY (KZ$LINCTX)  ALTRET(MOVALT);

   8259   1 00004C  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 00004E  CBF0 0100                            LAB,B4   256,IMO
          1 000050  E380 0000 0000  xent                 LNJ,B6   KZL$OTPRDY
          1 000053       00C6                            DC       s:8300,PREL

      108     8260    2            KZ@BSCFPT.EVT = %KZ#BSCEVT_SNDOTP;

   8260   1 000054  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          1 000056  6C10                                 LDV,R6   16
          1 000057  EF46 0001                            STR,R6   1,B6

      109     8261    2            ALTRETURN;

   8261   1 000059  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      110     8262
      111     8263    2          CASE ( %KZ#BSCACT_ACK0,

      112     8264    2               %KZ#BSCACT_ACK1 );
      113     8265
      114     8266    2            CALL KZB$INACTCLK (KZ$LINCTX);

   8266   1 00005C  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 00005E  CBF0 0100                            LAB,B4   256,IMO
          1 000060  E380 0000 0000  xent                 LNJ,B6   KZB$INACTCLK
          1 000063       0001                            DC       s:8267,PREL
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:23   

      115     8267    3            IF KZ$LINCTX.CTB.ENQ$ ~= ADDR(NIL) THEN DO;

   8267   1 000064  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000066  8DC6 002D                            CMN      45,B6
          1 000068  0901 001E                            BE       s:8273,PREL

      116     8268    3               CNCL=KH_CNCL;

   8268   1 00006A  AB80 0000 0000  00                   LAB,B2   KH_CLK
          1 00006D  2C16                                 LDV,R2   22
          1 00006E  6C10                                 LDV,R6   16
          1 00006F  BB87                                 LAB,B3   ,AUTO
          1 000070  3C42                                 LDV,R3   66
          1 000071  0008                                 MMM

      117     8269    3               CNCL.CTBCTX$=KZ$LINCTX.CTB.ENQ$;

   8269   1 000072  DCC6 002D                            LDB,B5   45,B6
          1 000074  DFC7 0021                            STB,B5   CNCL,AUTO

      118     8270    3               KZ$LINCTX.CTB.ENQ$=ADDR(NIL);

   8270   1 000076  CB80 0000 0000                       LAB,B4   0
          1 000079  CFC6 002D                            STB,B4   45,B6

      119     8271    3               CALL KHC$CLOCK (CNCL);

   8271   1 00007B  ABC7 0021                            LAB,B2   CNCL,AUTO
          1 00007D  AFC7 002C                            STB,B2   CNCL+11,AUTO
          1 00007F  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 000081  CBF0 0100                            LAB,B4   256,IMO
          1 000083  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 000086       0001                            DC       s:8273,PREL

      120     8272    3               END;

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:24   
      121     8273    3            IF KZ$LINCTX.CTB.NAK$ ~= ADDR(NIL) THEN DO;

   8273   1 000087  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000089  8DC6 002F                            CMN      47,B6
          1 00008B  0901 001E                            BE       s:8279,PREL

      122     8274    3               CNCL=KH_CNCL;

   8274   1 00008D  AB80 0000 0000  00                   LAB,B2   KH_CLK
          1 000090  2C16                                 LDV,R2   22
          1 000091  6C10                                 LDV,R6   16
          1 000092  BB87                                 LAB,B3   ,AUTO
          1 000093  3C42                                 LDV,R3   66
          1 000094  0008                                 MMM

      123     8275    3               CNCL.CTBCTX$=KZ$LINCTX.CTB.NAK$;

   8275   1 000095  DCC6 002F                            LDB,B5   47,B6
          1 000097  DFC7 0021                            STB,B5   CNCL,AUTO

      124     8276    3               KZ$LINCTX.CTB.NAK$=ADDR(NIL);

   8276   1 000099  CB80 0000 0000                       LAB,B4   0
          1 00009C  CFC6 002F                            STB,B4   47,B6

      125     8277    3               CALL KHC$CLOCK (CNCL);

   8277   1 00009E  ABC7 0021                            LAB,B2   CNCL,AUTO
          1 0000A0  AFC7 002C                            STB,B2   CNCL+11,AUTO
          1 0000A2  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 0000A4  CBF0 0100                            LAB,B4   256,IMO
          1 0000A6  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 0000A9       0001                            DC       s:8279,PREL

      126     8278    3               END;

      127     8279    2            IF KZ@BSCFPT.EVT = %KZ#BSCEVT_ENQ THEN
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:25   

   8279   1 0000AA  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          1 0000AC  E846 0001                            LDR,R6   1,B6
          1 0000AE  6D0D                                 CMV,R6   13
          1 0000AF  0981 0006                            BNE      s:8282,PREL

      128     8280    2               CALL CNTRTRY ALTRET(MOVALT);

   8280   1 0000B1  E3C0 0274                            LNJ,B6   s:0,PREL
          1 0000B3       0066                            DC       s:8300,PREL
          1 0000B4  0F81 0005                            B        s:8283,PREL

      129     8281    2            ELSE
      130     8282    2               KZ$LINCTX.RTRCNT = 0;

   8282   1 0000B6  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0000B8  8745 0039                            CL       57,B5

      131     8283    2            IF KZ@BSCFPT.ACT = %KZ#BSCACT_ACK0 THEN

   8283   1 0000BA  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          1 0000BC  E806                                 LDR,R6   ,B6
          1 0000BD  6D03                                 CMV,R6   3
          1 0000BE  0981 0014                            BNE      s:8286,PREL

      132     8284    2               CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );

   8284   1 0000C0  DBF0 000A                            LAB,B5   10,IMO
          1 0000C2  CCC7 0004                            LDB,B4   @KZ$LINCTX,AUTO
          1 0000C4  CFC7 002E                            STB,B4   CNCL+13,AUTO
          1 0000C6  DFC7 002C                            STB,B5   CNCL+11,AUTO
          1 0000C8  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 0000CA  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0000CD  CBF0 0200                            LAB,B4   512,IMO
          1 0000CF  E381                                 LNJ,B6   ,B1
          1 0000D0       0001                            DC       s:8284+17,PREL
          1 0000D1  0F81 0252                            B        s:8422,PREL
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:26   

      133     8285    2            ELSE
      134     8286    2               CALL KZR_ORDERS@ ( %KZ#SEND_ACK1, KZ$LINCTX );

   8286   1 0000D3  DBF0 000B                            LAB,B5   11,IMO
          1 0000D5  CCC7 0004                            LDB,B4   @KZ$LINCTX,AUTO
          1 0000D7  CFC7 002E                            STB,B4   CNCL+13,AUTO
          1 0000D9  DFC7 002C                            STB,B5   CNCL+11,AUTO
          1 0000DB  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 0000DD  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0000E0  CBF0 0200                            LAB,B4   512,IMO
          1 0000E2  E381                                 LNJ,B6   ,B1
          1 0000E3       0001                            DC       s:8286+17,PREL
          1 0000E4  0F81 023F                            B        s:8422,PREL

      135     8287
      136     8288    2          CASE ( %KZ#BSCACT_WACK );

      137     8289    2            CALL KZB$INACTCLK (KZ$LINCTX);

   8289   1 0000E6  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 0000E8  CBF0 0100                            LAB,B4   256,IMO
          1 0000EA  E380 0000 0000  xent                 LNJ,B6   KZB$INACTCLK
          1 0000ED       0001                            DC       s:8291,PREL

      138     8290
      139     8291    2            IF KZ@BSCFPT.EVT = %KZ#BSCEVT_ETBBLK OR

   8291   1 0000EE  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          1 0000F0  E846 0001                            LDR,R6   1,B6
          1 0000F2  6D05                                 CMV,R6   5
          1 0000F3  0901 0004                            BE       s:8293,PREL
          1 0000F5  6D06                                 CMV,R6   6
          1 0000F6  0981 0007                            BNE      s:8294,PREL

      140     8292    2               KZ@BSCFPT.EVT = %KZ#BSCEVT_ETXBLK THEN
      141     8293    2               KZ$LINCTX.INPDATSIZ = KZ@BSCFPT.SIZ;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:27   

   8293   1 0000F8  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0000FA  D846 0003                            LDR,R5   3,B6
          1 0000FC  DF45 0059                            STR,R5   89,B5

      142     8294    2            KZ$EVENT.EVENT=%KZ#LINFCN_INP;

   8294   1 0000FE  6C04                                 LDV,R6   4
          1 0000FF  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      143     8295    2            KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);

   8295   1 000101  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000103  DFC7 000B                            STB,B5   KZ$EVENT+3,AUTO

      144     8296    2            CALL KZR$RBT (KZ$EVENT) ALTRET(CANT_ACCEPT_INPUT);

   8296   1 000105  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          1 000107  CFC7 002C                            STB,B4   CNCL+11,AUTO
          1 000109  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 00010B  CBF0 0100                            LAB,B4   256,IMO
          1 00010D  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 000110       000C                            DC       s:8299,PREL

   8295   1                              MOVE_WITH_GO    null
      145     8297    2   MOVE_WITH_GO:;
      146     8298    2            KZ@BSCFPT.EVT = %KZ#BSCEVT_GO;

   8298   1 000111  ECC7 0006            MOVE_WITH_GO    LDB,B6   @KZ@BSCFPT,AUTO
          1 000113  6C01                                 LDV,R6   1
          1 000114  EF46 0001                            STR,R6   1,B6

      147     8299    2            KZ@BSCFPT.FNC = %KZ#FNC_MOV;

   8299   1 000116  5C03                                 LDV,R5   3
          1 000117  DF46 0004                            STR,R5   4,B6

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:28   
      148     8300    2   MOVALT:  ALTRETURN;

   8300   1 000119  C380 0000 0000  xent MOVALT          LNJ,B4   X6A_AALT

   8299   1                              CANT_ACCEPT_INP*null
      149     8301
      150     8302    2   CANT_ACCEPT_INPUT:;
      151     8303    2            CLK_FPT=KH_CLK;

   8303   1 00011C  AB80 0000 0000  00   CANT_ACCEPT_INP*LAB,B2   KH_CLK
          1 00011F  2C00                                 LDV,R2   0
          1 000120  6C16                                 LDV,R6   22
          1 000121  BB87                                 LAB,B3   ,AUTO
          1 000122  3C2C                                 LDV,R3   44
          1 000123  0008                                 MMM

      152     8304    2            CLK_FPT.UID$=ADDR(KZ$LINCTX);

   8304   1 000124  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000126  EFC7 0018                            STB,B6   CLK_FPT+2,AUTO

      153     8305    2            CLK_FPT.SBR$=ENTADDR(KZB$DFRWACK);

   8305   1 000128  DB80 0000 0000  xent                 LAB,B5   KZB$DFRWACK
          1 00012B  DFC7 001E                            STB,B5   CLK_FPT+8,AUTO

      154     8306    2            CALL KHC$CLOCK (CLK_FPT);

   8306   1 00012D  CBC7 0016                            LAB,B4   CLK_FPT,AUTO
          1 00012F  CFC7 002C                            STB,B4   CNCL+11,AUTO
          1 000131  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 000133  CBF0 0100                            LAB,B4   256,IMO
          1 000135  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 000138       0001                            DC       s:8307,PREL

      155     8307    2            KZ$LINCTX.CTB.ENQ$ = CLK_FPT.CTBCTX$;

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:29   
   8307   1 000139  ECC7 0016                            LDB,B6   CLK_FPT,AUTO
          1 00013B  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00013D  EFC5 002D                            STB,B6   45,B5
          1 00013F  0F81 01E4                            B        s:8422,PREL

      156     8308
      157     8309    2          CASE ( %KZ#BSCACT_NAK );

      158     8310
      159     8311    2            CALL CNTRTRY ALTRET(MOVALT);

   8311   1 000141  E3C0 01E4                            LNJ,B6   s:0,PREL
          1 000143       FFD6                            DC       s:8300,PREL

      160     8312    2            CALL KZR_ORDERS@ ( %KZ#SEND_NAK, KZ$LINCTX );

   8312   1 000144  EBF0 0006                            LAB,B6   6,IMO
          1 000146  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000148  DFC7 002E                            STB,B5   CNCL+13,AUTO
          1 00014A  EFC7 002C                            STB,B6   CNCL+11,AUTO
          1 00014C  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 00014E  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 000151  CBF0 0200                            LAB,B4   512,IMO
          1 000153  E381                                 LNJ,B6   ,B1
          1 000154       0001                            DC       s:8312+17,PREL
          1 000155  0F81 01CE                            B        s:8422,PREL

      161     8313
      162     8314    2          CASE ( %KZ#BSCACT_DNAK );

      163     8315
      164     8316    2            CALL KZB$INACTCLK (KZ$LINCTX);

   8316   1 000157  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 000159  CBF0 0100                            LAB,B4   256,IMO
          1 00015B  E380 0000 0000  xent                 LNJ,B6   KZB$INACTCLK
          1 00015E       0001                            DC       s:8317,PREL
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:30   

      165     8317    2            KZ$LINCTX.RTRCNT = 0;

   8317   1 00015F  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000161  8746 0039                            CL       57,B6

      166     8318    2            CLK_FPT=KH_CLK;

   8318   1 000163  AB80 0000 0000  00                   LAB,B2   KH_CLK
          1 000166  2C00                                 LDV,R2   0
          1 000167  6C16                                 LDV,R6   22
          1 000168  BB87                                 LAB,B3   ,AUTO
          1 000169  3C2C                                 LDV,R3   44
          1 00016A  0008                                 MMM

      167     8319    2            CLK_FPT.UID$=ADDR(KZ$LINCTX);

   8319   1 00016B  EFC7 0018                            STB,B6   CLK_FPT+2,AUTO

      168     8320    2            CLK_FPT.SBR$=ENTADDR(KZB$DFRNAK);

   8320   1 00016D  DB80 0000 0000  xent                 LAB,B5   KZB$DFRNAK
          1 000170  DFC7 001E                            STB,B5   CLK_FPT+8,AUTO

      169     8321    2            CALL KHC$CLOCK (CLK_FPT);

   8321   1 000172  CBC7 0016                            LAB,B4   CLK_FPT,AUTO
          1 000174  CFC7 002C                            STB,B4   CNCL+11,AUTO
          1 000176  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 000178  CBF0 0100                            LAB,B4   256,IMO
          1 00017A  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 00017D       0001                            DC       s:8322,PREL

      170     8322    2            KZ$LINCTX.CTB.NAK$ = CLK_FPT.CTBCTX$;

   8322   1 00017E  ECC7 0016                            LDB,B6   CLK_FPT,AUTO
          1 000180  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:31   
          1 000182  EFC5 002F                            STB,B6   47,B5
          1 000184  0F81 019F                            B        s:8422,PREL

      171     8323
      172     8324    2          CASE ( %KZ#BSCACT_BID );

      173     8325
      174     8326    2            CALL KZR_ABORT@ ( KZ$LINCTX );

   8326   1 000186  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 000188  9C80 0000 0000  xsym                 LDB,B1   KZR_ABORT@
          1 00018B  CBF0 0100                            LAB,B4   256,IMO
          1 00018D  E381                                 LNJ,B6   ,B1
          1 00018E       0001                            DC       s:8327,PREL

      175     8327    2            IF KZ$LINCTX.PRO.SLAVE THEN

   8327   1 00018F  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000191  89C6 004B                            CMZ      75,B6
          1 000193  0881 0004                            BAGE     s:8329,PREL

      176     8328    2               KZ$LINCTX.TIMOUT.USESEC='1'B; /* Send ENQ at secondary rate. */

   8328   1 000195  8946 0088                            LBT,'8000'X       136,B6
   8328   1 000197       8000

      177     8329    2            CALL KZR_ORDERS@ ( %KZ#SEND_ENQ, KZ$LINCTX );

   8329   1 000198  DBF0 000D                            LAB,B5   13,IMO
          1 00019A  EFC7 002E                            STB,B6   CNCL+13,AUTO
          1 00019C  DFC7 002C                            STB,B5   CNCL+11,AUTO
          1 00019E  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 0001A0  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0001A3  CBF0 0200                            LAB,B4   512,IMO
          1 0001A5  E381                                 LNJ,B6   ,B1
          1 0001A6       0001                            DC       s:8329+15,PREL
          1 0001A7  0F81 017C                            B        s:8422,PREL
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:32   

      178     8330
      179     8331    2          CASE ( %KZ#BSCACT_TTD );

      180     8332
      181     8333    2            CALL KZB$INACTCLK (KZ$LINCTX);

   8333   1 0001A9  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 0001AB  CBF0 0100                            LAB,B4   256,IMO
          1 0001AD  E380 0000 0000  xent                 LNJ,B6   KZB$INACTCLK
          1 0001B0       0001                            DC       s:8334,PREL

      182     8334    2            KZ$LINCTX.TIMOUT.USESEC='0'B; /* Use primary timeout value now */

   8334   1 0001B1  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 0001B3  8846 0088                            LBF,'8000'X       136,B6
          1 0001B5       8000

      183     8335    2            KZ$LINCTX.FLAGS.FIRST = '0'B;

   8335   1 0001B6  8846 0034                            LBF,'0080'X       52,B6
   8335   1 0001B8       0080

      184     8336    2            KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP;

   8336   1 0001B9  6C01                                 LDV,R6   1
          1 0001BA  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      185     8337    2            KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);

   8337   1 0001BC  EFC7 000B                            STB,B6   KZ$EVENT+3,AUTO

      186     8338    2            CALL KZR$RBT (KZ$EVENT) ALTRET(NO_BSC_OTP);

   8338   1 0001BE  DBC7 0008                            LAB,B5   KZ$EVENT,AUTO
          1 0001C0  DFC7 002C                            STB,B5   CNCL+11,AUTO
          1 0001C2  BBC7 002C                            LAB,B3   CNCL+11,AUTO
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:33   
          1 0001C4  CBF0 0100                            LAB,B4   256,IMO
          1 0001C6  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 0001C9       001D                            DC       s:8344,PREL

      187     8339    2            IF NOT KZ$LINCTX.FLAGS.FIRST THEN

   8339   1 0001CA  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 0001CC  82C6 0034                            LB,'0080'X        52,B6
          1 0001CE       0080
          1 0001CF  0501 0008                            BBT      s:8342,PREL

      188     8340    2               KZ@BSCFPT.EVT = %KZ#BSCEVT_GO;

   8340   1 0001D1  DCC7 0006                            LDB,B5   @KZ@BSCFPT,AUTO
          1 0001D3  6C01                                 LDV,R6   1
          1 0001D4  EF45 0001                            STR,R6   1,B5
          1 0001D6  0F81 0006                            B        s:8343,PREL

      189     8341    2            ELSE
      190     8342    2               KZ@BSCFPT.EVT = %KZ#BSCEVT_SNDOTP;

   8342   1 0001D8  DCC7 0006                            LDB,B5   @KZ@BSCFPT,AUTO
          1 0001DA  6C10                                 LDV,R6   16
          1 0001DB  EF45 0001                            STR,R6   1,B5

      191     8343    2            KZ$LINCTX.FLAGS.FIRST = '0'B;

   8343   1 0001DD  8846 0034                            LBF,'0080'X       52,B6
   8343   1 0001DF       0080

      192     8344    2            KZ@BSCFPT.FNC = %KZ#FNC_MOV;

   8344   1 0001E0  6C03                                 LDV,R6   3
          1 0001E1  EF45 0004                            STR,R6   4,B5

      193     8345    2            ALTRETURN;

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:34   
   8345   1 0001E3  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

   8344   1                              NO_BSC_OTP      null
      194     8346    2   NO_BSC_OTP:;
      195     8347    2            CLK_FPT=KH_CLK;

   8347   1 0001E6  AB80 0000 0000  00   NO_BSC_OTP      LAB,B2   KH_CLK
          1 0001E9  2C00                                 LDV,R2   0
          1 0001EA  6C16                                 LDV,R6   22
          1 0001EB  BB87                                 LAB,B3   ,AUTO
          1 0001EC  3C2C                                 LDV,R3   44
          1 0001ED  0008                                 MMM

      196     8348    2            CLK_FPT.PRD=2;            /* Send TTD every two seconds */

   8348   1 0001EE  6C02                                 LDV,R6   2
          1 0001EF  EF47 0020                            STR,R6   CLK_FPT+10,AUTO

      197     8349    2            CLK_FPT.UID$=ADDR(KZ$LINCTX);

   8349   1 0001F1  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 0001F3  EFC7 0018                            STB,B6   CLK_FPT+2,AUTO

      198     8350    2            CLK_FPT.SBR$=ENTADDR(KZB$DFRTTD);

   8350   1 0001F5  DB80 0000 0000  xent                 LAB,B5   KZB$DFRTTD
          1 0001F8  DFC7 001E                            STB,B5   CLK_FPT+8,AUTO

      199     8351    2            CALL KHC$CLOCK (CLK_FPT);

   8351   1 0001FA  CBC7 0016                            LAB,B4   CLK_FPT,AUTO
          1 0001FC  CFC7 002C                            STB,B4   CNCL+11,AUTO
          1 0001FE  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 000200  CBF0 0100                            LAB,B4   256,IMO
          1 000202  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 000205       0001                            DC       s:8352,PREL

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:35   
      200     8352    2            KZ$LINCTX.CTB.ENQ$ = CLK_FPT.CTBCTX$;

   8352   1 000206  ECC7 0016                            LDB,B6   CLK_FPT,AUTO
          1 000208  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00020A  EFC5 002D                            STB,B6   45,B5
          1 00020C  0F81 0117                            B        s:8422,PREL

      201     8353
      202     8354    2          CASE ( %KZ#BSCACT_ETB );

      203     8355
      204     8356    2            IF KZ@BSCFPT.EVT = %KZ#BSCEVT_NAK AND

   8356   1 00020E  E846 0001                            LDR,R6   1,B6
          1 000210  6D0C                                 CMV,R6   12
          1 000211  0981 001E                            BNE      s:8368,PREL
          1 000213  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000215  82C5 004B                            LB,'0080'X        75,B5
          1 000217       0080
          1 000218  0501 0017                            BBT      s:8368,PREL

      205     8357    3               NOT KZ$LINCTX.PRO.ERRDUPBLK THEN DO;

      206     8358                    /* We're not allowed to resend blocks to this device...
      207     8359                       pretend everything was OK (we got an ACK0/1). */
      208     8360    3               IF KZ@BSCFPT.NEWSTT = %KZ#BSCSTT_ETB_16 THEN

   8360   1 00021A  D2C6 0002                            LLH,R5   2,B6
          1 00021C  5D10                                 CMV,R5   16
          1 00021D  0981 0006                            BNE      s:8363,PREL

      209     8361    3                  KZ@BSCFPT.EVT = %KZ#BSCEVT_ACK1;

   8361   1 00021F  6C0B                                 LDV,R6   11
          1 000220  EF46 0001                            STR,R6   1,B6
          1 000222  0F81 0004                            B        s:8364,PREL

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:36   
      210     8362    3               ELSE
      211     8363    3                  KZ@BSCFPT.EVT = %KZ#BSCEVT_ACK0;

   8363   1 000224  6C0A                                 LDV,R6   10
          1 000225  EF46 0001                            STR,R6   1,B6

      212     8364    3               KZ$LINCTX.FLAGS.FIRST = '0'B;

   8364   1 000227  8845 0034                            LBF,'0080'X       52,B5
   8364   1 000229       0080

      213     8365    3               KZ@BSCFPT.FNC = %KZ#FNC_MOV;

   8365   1 00022A  6C03                                 LDV,R6   3
          1 00022B  EF46 0004                            STR,R6   4,B6

      214     8366    3               ALTRETURN;

   8366   1 00022D  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      215     8367    3               END;
      216     8368    2            KZ$LINCTX.RTRCNT = 0;

   8368   1 000230  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000232  8745 0039                            CL       57,B5

      217     8369    2            CALL KZR_ORDERS@ ( %KZ#SEND_BLOCK, KZ$LINCTX );

   8369   1 000234  CBF0 0001                            LAB,B4   1,IMO
          1 000236  DFC7 002E                            STB,B5   CNCL+13,AUTO
          1 000238  CFC7 002C                            STB,B4   CNCL+11,AUTO
          1 00023A  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 00023C  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 00023F  CBF0 0200                            LAB,B4   512,IMO
          1 000241  E381                                 LNJ,B6   ,B1
          1 000242       0001                            DC       s:8369+15,PREL
          1 000243  0F81 00E0                            B        s:8422,PREL
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:37   

      218     8370
      219     8371    2          CASE ( %KZ#BSCACT_ETX );

      220     8372
      221     8373    2            IF KZ@BSCFPT.EVT = %KZ#BSCEVT_NAK AND

   8373   1 000245  E846 0001                            LDR,R6   1,B6
          1 000247  6D0C                                 CMV,R6   12
          1 000248  0981 001E                            BNE      s:8385,PREL
          1 00024A  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00024C  82C5 004B                            LB,'0080'X        75,B5
          1 00024E       0080
          1 00024F  0501 0017                            BBT      s:8385,PREL

      222     8374    3               NOT KZ$LINCTX.PRO.ERRDUPBLK THEN DO;

      223     8375                    /* We're not allowed to resend blocks to this device...
      224     8376                       pretend everything was OK (we got an ACK0/1). */
      225     8377    3               IF KZ@BSCFPT.NEWSTT = %KZ#BSCSTT_ETX_17 THEN

   8377   1 000251  D2C6 0002                            LLH,R5   2,B6
          1 000253  5D11                                 CMV,R5   17
          1 000254  0981 0006                            BNE      s:8380,PREL

      226     8378    3                  KZ@BSCFPT.EVT = %KZ#BSCEVT_ACK1;

   8378   1 000256  6C0B                                 LDV,R6   11
          1 000257  EF46 0001                            STR,R6   1,B6
          1 000259  0F81 0004                            B        s:8381,PREL

      227     8379    3               ELSE
      228     8380    3                  KZ@BSCFPT.EVT = %KZ#BSCEVT_ACK0;

   8380   1 00025B  6C0A                                 LDV,R6   10
          1 00025C  EF46 0001                            STR,R6   1,B6

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:38   
      229     8381    3               KZ$LINCTX.FLAGS.FIRST = '0'B;

   8381   1 00025E  8845 0034                            LBF,'0080'X       52,B5
   8381   1 000260       0080

      230     8382    3               KZ@BSCFPT.FNC = %KZ#FNC_MOV;

   8382   1 000261  6C03                                 LDV,R6   3
          1 000262  EF46 0004                            STR,R6   4,B6

      231     8383    3               ALTRETURN;

   8383   1 000264  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      232     8384    3               END;
      233     8385    2            KZ$LINCTX.RTRCNT = 0;

   8385   1 000267  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000269  8745 0039                            CL       57,B5

      234     8386    2            CALL KZR_ORDERS@ ( %KZ#SEND_TEXT, KZ$LINCTX );

   8386   1 00026B  CBF0 0002                            LAB,B4   2,IMO
          1 00026D  DFC7 002E                            STB,B5   CNCL+13,AUTO
          1 00026F  CFC7 002C                            STB,B4   CNCL+11,AUTO
          1 000271  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 000273  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 000276  CBF0 0200                            LAB,B4   512,IMO
          1 000278  E381                                 LNJ,B6   ,B1
          1 000279       0001                            DC       s:8386+15,PREL
          1 00027A  0F81 00A9                            B        s:8422,PREL

      235     8387
      236     8388    2          CASE ( %KZ#BSCACT_XITSND );

      237     8389    2            CALL KZB$INACTCLK (KZ$LINCTX);

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:39   
   8389   1 00027C  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 00027E  CBF0 0100                            LAB,B4   256,IMO
          1 000280  E380 0000 0000  xent                 LNJ,B6   KZB$INACTCLK
          1 000283       0001                            DC       s:8391,PREL

      238     8390
      239     8391    3            IF KZ$LINCTX.OTPHD$ ~= ADDR(NIL) THEN DO;

   8391   1 000284  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000286  8DC6 0052                            CMN      82,B6
          1 000288  0901 0014                            BE       s:8395,PREL

      240     8392    3               CALL KZR$RELOTPBFR (BFR);

   8392   1 00028A  DCC6 0052                            LDB,B5   82,B6
          1 00028C  DFC7 002C                            STB,B5   CNCL+11,AUTO
          1 00028E  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 000290  CBF0 0100                            LAB,B4   256,IMO
          1 000292  E380 0000 0000  xent                 LNJ,B6   KZR$RELOTPBFR
          1 000295       0001                            DC       s:8393,PREL

      241     8393    3               KZ$LINCTX.OTPHD$ = ADDR(NIL);

   8393   1 000296  EB80 0000 0000                       LAB,B6   0
          1 000299  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00029B  EFC5 0052                            STB,B6   82,B5

      242     8394    3               END;

      243     8395    2            CALL KZR_ORDERS@ ( %KZ#SEND_EOT, KZ$LINCTX );

   8395   1 00029D  EBF0 0009                            LAB,B6   9,IMO
          1 00029F  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0002A1  DFC7 002E                            STB,B5   CNCL+13,AUTO
          1 0002A3  EFC7 002C                            STB,B6   CNCL+11,AUTO
          1 0002A5  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 0002A7  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:40   
          1 0002AA  CBF0 0200                            LAB,B4   512,IMO
          1 0002AC  E381                                 LNJ,B6   ,B1
          1 0002AD       0001                            DC       s:8395+17,PREL
          1 0002AE  0F81 0075                            B        s:8422,PREL

      244     8396
      245     8397    2          CASE ( %KZ#BSCACT_ENQERR );

      246     8398
      247     8399    2            CALL CNTRTRY ALTRET(MOVALT);

   8399   1 0002B0  E3C0 0075                            LNJ,B6   s:0,PREL
          1 0002B2       FE67                            DC       s:8300,PREL

      248     8400    2            CALL KZR_ORDERS@ ( %KZ#SEND_ENQ, KZ$LINCTX );

   8400   1 0002B3  EBF0 000D                            LAB,B6   13,IMO
          1 0002B5  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0002B7  DFC7 002E                            STB,B5   CNCL+13,AUTO
          1 0002B9  EFC7 002C                            STB,B6   CNCL+11,AUTO
          1 0002BB  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 0002BD  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0002C0  CBF0 0200                            LAB,B4   512,IMO
          1 0002C2  E381                                 LNJ,B6   ,B1
          1 0002C3       0001                            DC       s:8400+17,PREL
          1 0002C4  0F81 005F                            B        s:8422,PREL

      249     8401
      250     8402    2          CASE ( %KZ#BSCACT_ENQ );

      251     8403
      252     8404    2            CLK_FPT=KH_CLK;

   8404   1 0002C6  AB80 0000 0000  00                   LAB,B2   KH_CLK
          1 0002C9  2C00                                 LDV,R2   0
          1 0002CA  6C16                                 LDV,R6   22
          1 0002CB  BB87                                 LAB,B3   ,AUTO
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:41   
          1 0002CC  3C2C                                 LDV,R3   44
          1 0002CD  0008                                 MMM

      253     8405    2            CLK_FPT.UID$=ADDR(KZ$LINCTX);

   8405   1 0002CE  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0002D0  DFC7 0018                            STB,B5   CLK_FPT+2,AUTO

      254     8406    2            CLK_FPT.SBR$=ENTADDR(KZB$DFRENQ);

   8406   1 0002D2  CB80 0000 0000  xent                 LAB,B4   KZB$DFRENQ
          1 0002D5  CFC7 001E                            STB,B4   CLK_FPT+8,AUTO

      255     8407    2            CALL KHC$CLOCK (CLK_FPT);

   8407   1 0002D7  ABC7 0016                            LAB,B2   CLK_FPT,AUTO
          1 0002D9  AFC7 002C                            STB,B2   CNCL+11,AUTO
          1 0002DB  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 0002DD  CBF0 0100                            LAB,B4   256,IMO
          1 0002DF  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 0002E2       0001                            DC       s:8408,PREL

      256     8408    2            KZ$LINCTX.CTB.ENQ$ = CLK_FPT.CTBCTX$;

   8408   1 0002E3  ECC7 0016                            LDB,B6   CLK_FPT,AUTO
          1 0002E5  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0002E7  EFC5 002D                            STB,B6   45,B5
          1 0002E9  0F81 003A                            B        s:8422,PREL

      257     8409
      258     8410    2          CASE ( %KZ#BSCACT_TMOENQ );

      259     8411
      260     8412    2            CALL CNTRTRY ALTRET(MOVALT);

   8412   1 0002EB  E3C0 003A                            LNJ,B6   s:0,PREL
          1 0002ED       FE2C                            DC       s:8300,PREL
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:42   

      261     8413    2            CALL KZR_ORDERS@ (%KZ#SEND_NOTHING,KZ$LINCTX);

   8413   1 0002EE  EBF0 000C                            LAB,B6   12,IMO
          1 0002F0  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0002F2  DFC7 002E                            STB,B5   CNCL+13,AUTO
          1 0002F4  EFC7 002C                            STB,B6   CNCL+11,AUTO
          1 0002F6  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 0002F8  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0002FB  CBF0 0200                            LAB,B4   512,IMO
          1 0002FD  E381                                 LNJ,B6   ,B1
          1 0002FE       0001                            DC       s:8413+17,PREL
          1 0002FF  0F81 0024                            B        s:8422,PREL

      262     8414
      263     8415    2          CASE ( %KZ#BSCACT_INITACK0 );

      264     8416
      265     8417    2            CALL KZB$INACTCLK (KZ$LINCTX);

   8417   1 000301  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 000303  CBF0 0100                            LAB,B4   256,IMO
          1 000305  E380 0000 0000  xent                 LNJ,B6   KZB$INACTCLK
          1 000308       0001                            DC       s:8418,PREL

      266     8418    2            KZ$LINCTX.CURDEV$=ADDR(NIL);

   8418   1 000309  EB80 0000 0000                       LAB,B6   0
          1 00030C  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00030E  EFC5 0050                            STB,B6   80,B5

      267     8419    2            CALL CNTRTRY ALTRET(MOVALT);

   8419   1 000310  E3C0 0015                            LNJ,B6   s:0,PREL
          1 000312       FE07                            DC       s:8300,PREL

      268     8420    2            CALL KZR_ORDERS@ (%KZ#SEND_ACK0,KZ$LINCTX);
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:43   

   8420   1 000313  EBF0 000A                            LAB,B6   10,IMO
          1 000315  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000317  DFC7 002E                            STB,B5   CNCL+13,AUTO
          1 000319  EFC7 002C                            STB,B6   CNCL+11,AUTO
          1 00031B  BBC7 002C                            LAB,B3   CNCL+11,AUTO
          1 00031D  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 000320  CBF0 0200                            LAB,B4   512,IMO
          1 000322  E381                                 LNJ,B6   ,B1
          1 000323       0001                            DC       s:8422,PREL

      269     8421
      270     8422    2          END;

   8422   1 000324  0F81 001F                            B        s:8437,PREL

      271     8423
      272     8424        /*    Count retries                                                */
      273     8425
      274     8426    1   CNTRTRY: PROC ALTRET;

   8426   1 000326  EFC7 002A            CNTRTRY         STB,B6   CNCL+9,AUTO

      275     8427
      276     8428    2         KZ$LINCTX.RTRCNT = KZ$LINCTX.RTRCNT + 1;

   8428   1 000328  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00032A  8AC5 0039                            INC      57,B5

      277     8429    2         IF KZ$LINCTX.PRO.RETRYS > 0 AND

   8429   1 00032C  E845 003D                            LDR,R6   61,B5
          1 00032E  6901 0011                            BEZ,R6   s:8435,PREL
          1 000330  E945 0039                            CMR,R6   57,B5
          1 000332  0281 000D                            BGE      s:8435,PREL

      278     8430    3            KZ$LINCTX.RTRCNT > KZ$LINCTX.PRO.RETRYS THEN DO;
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:44   

      279     8431    3            KZ@BSCFPT.EVT = %KZ#BSCEVT_URCERR;

   8431   1 000334  CCC7 0006                            LDB,B4   @KZ@BSCFPT,AUTO
          1 000336  5C04                                 LDV,R5   4
          1 000337  DF44 0001                            STR,R5   1,B4

      280     8432    3            KZ@BSCFPT.FNC = %KZ#FNC_MOV;

   8432   1 000339  6C03                                 LDV,R6   3
          1 00033A  EF44 0004                            STR,R6   4,B4

      281     8433    3            ALTRETURN;

   8433   1 00033C  ECC7 002A                            LDB,B6   CNCL+9,AUTO
          1 00033E  B806                                 LDR,R3   ,B6
          1 00033F  C3B6                                 LNJ,B4   ,B6,R3

      282     8434    3            END;
      283     8435    2         RETURN;

   8435   1 000340  ECC7 002A                            LDB,B6   CNCL+9,AUTO
          1 000342  C3C6 0001                            LNJ,B4   1,B6

      284     8436    2   END;
      285     8437    1   END KZB$BSCIO;

   8437   1 000344  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      286     8438        %EOD;

PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:45   
--  Include file information  --

   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KZ_MLCP_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KZ_BSC_C.:E05TOU  is referenced.
   KZ_BSCFPT.:E05TOU  is referenced.
   KZ$RBT_M.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZB$BSCIO.
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:46   

 **** Variables and constants ****

  ****  Section 000 RoData KZB$BSCIO

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(176)   r     1 KH_CLK                     B-0-0/w STRC(128)   r     1 KH_CNCL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KZ$LINCTX                 6-0-0/w PTR         r     1 @KZ@BSCFPT
    16-0-0/w STRC(176)   r     1 CLK_FPT                   21-0-0/w STRC(128)   r     1 CNCL
     8-0-0/w STRC(224)   r     1 KZ$EVENT                  *0-0-0/w STRC(2192)  r     1 KZ$LINCTX
    *0-0-0/w STRC(80)    r     1 KZ@BSCFPT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w EPTR        r     1 KZR_ABORT@                 0-0-0/w EPTR        r     1 KZR_ORDERS@

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR        r     1 BFR


   Procedure KZB$BSCIO requires 839 words for executable code.
   Procedure KZB$BSCIO requires 48 words of local(AUTO) storage.
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:47   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:48   
          MINI XREF LISTING

BFR
      8086**DCL      8392<>CALL
CANT_ACCEPT_INPUT
      8299**LABEL    8296--CALLALT
CLK_FPT
      7801**DCL      8303<<ASSIGN   8306<>CALL     8318<<ASSIGN   8321<>CALL     8347<<ASSIGN   8351<>CALL
      8404<<ASSIGN   8407<>CALL
CLK_FPT.CTBCTX$
      7807**DCL      8307>>ASSIGN   8322>>ASSIGN   8352>>ASSIGN   8408>>ASSIGN
CLK_FPT.PRD
      7922**DCL      8348<<ASSIGN
CLK_FPT.SBR$
      7918**DCL      8305<<ASSIGN   8320<<ASSIGN   8350<<ASSIGN   8406<<ASSIGN
CLK_FPT.UID
      7817**DCL      7818--REDEF    7819--REDEF
CLK_FPT.UID$
      7818**DCL      8304<<ASSIGN   8319<<ASSIGN   8349<<ASSIGN   8405<<ASSIGN
CNCL
      8101**DCL      8268<<ASSIGN   8271<>CALL     8274<<ASSIGN   8277<>CALL
CNCL.CTBCTX$
      8107**DCL      8269<<ASSIGN   8275<<ASSIGN
CNCL.UID
      8117**DCL      8118--REDEF    8119--REDEF
CNTRTRY
      8426**PROC     8280--CALL     8311--CALL     8399--CALL     8412--CALL     8419--CALL
KHC$CLOCK
      7634**DCL-ENT  8271--CALL     8277--CALL     8306--CALL     8321--CALL     8351--CALL     8407--CALL
KH_CLK
      7652**DCL      8303>>ASSIGN   8318>>ASSIGN   8347>>ASSIGN   8404>>ASSIGN
KH_CLK.UID
      7668**DCL      7669--REDEF    7670--REDEF
KH_CNCL
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:49   
      7951**DCL      8268>>ASSIGN   8274>>ASSIGN
KH_CNCL.UID
      7967**DCL      7968--REDEF    7969--REDEF
KZ$EVENT
      7508**DCL      8296<>CALL     8338<>CALL
KZ$EVENT.EVENT
      7509**DCL      8294<<ASSIGN   8336<<ASSIGN
KZ$EVENT.LINCTX$
      7515**DCL      8295<<ASSIGN   8337<<ASSIGN
KZ$LINCTX
      7073**DCL        43--PROC     8248<>CALL     8252<>CALL     8259<>CALL     8266<>CALL     8284<>CALL
      8286<>CALL     8289<>CALL     8295--ASSIGN   8304--ASSIGN   8312<>CALL     8316<>CALL     8319--ASSIGN
      8326<>CALL     8329<>CALL     8333<>CALL     8337--ASSIGN   8349--ASSIGN   8369<>CALL     8386<>CALL
      8389<>CALL     8395<>CALL     8400<>CALL     8405--ASSIGN   8413<>CALL     8417<>CALL     8420<>CALL
KZ$LINCTX.CTB.ENQ$
      7158**DCL      8267>>IF       8269>>ASSIGN   8270<<ASSIGN   8307<<ASSIGN   8352<<ASSIGN   8408<<ASSIGN
KZ$LINCTX.CTB.NAK$
      7160**DCL      8273>>IF       8275>>ASSIGN   8276<<ASSIGN   8322<<ASSIGN
KZ$LINCTX.CURDEV$
      7372**DCL      8418<<ASSIGN
KZ$LINCTX.FLAGS.FIRST
      7206**DCL      8335<<ASSIGN   8339>>IF       8343<<ASSIGN   8364<<ASSIGN   8381<<ASSIGN
KZ$LINCTX.INPDATSIZ
      7383**DCL      8293<<ASSIGN
KZ$LINCTX.LINID.TERM
      7096**DCL      7105--REDEF
KZ$LINCTX.OTPCNT
      7361**DCL      7364--REDEF
KZ$LINCTX.OTPHD$
      7374**DCL      8086--IMP-PTR  8391>>IF       8392>>CALL     8393<<ASSIGN
KZ$LINCTX.POLSIZ
      7407**DCL      7409--REDEF
KZ$LINCTX.PRO.ERRDUPBLK
      7343**DCL      8356>>IF       8373>>IF
KZ$LINCTX.PRO.RETRYS
      7268**DCL      8429>>IF       8429>>IF
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:50   
KZ$LINCTX.PRO.SLAVE
      7312**DCL      8327>>IF
KZ$LINCTX.RTRCNT
      7249**DCL      8282<<ASSIGN   8317<<ASSIGN   8368<<ASSIGN   8385<<ASSIGN   8428<<ASSIGN   8428>>ASSIGN
      8429>>IF
KZ$LINCTX.TIMOUT.USESEC
      7485**DCL      8328<<ASSIGN   8334<<ASSIGN
KZ@BSCFPT
      7578**DCL        43--PROC
KZ@BSCFPT.ACT
      7579**DCL      8239>>DOCASE   8283>>IF
KZ@BSCFPT.EVT
      7580**DCL      8258<<ASSIGN   8260<<ASSIGN   8279>>IF       8291>>IF       8291>>IF       8298<<ASSIGN
      8340<<ASSIGN   8342<<ASSIGN   8356>>IF       8361<<ASSIGN   8363<<ASSIGN   8373>>IF       8378<<ASSIGN
      8380<<ASSIGN   8431<<ASSIGN
KZ@BSCFPT.FNC
      7584**DCL      8243<<ASSIGN   8257<<ASSIGN   8299<<ASSIGN   8344<<ASSIGN   8365<<ASSIGN   8382<<ASSIGN
      8432<<ASSIGN
KZ@BSCFPT.NEWSTT
      7581**DCL      8360>>IF       8377>>IF
KZ@BSCFPT.SIZ
      7583**DCL      8293>>ASSIGN
KZB$DFRENQ
      7630**DCL-ENT  8406--ASSIGN
KZB$DFRNAK
      7629**DCL-ENT  8320--ASSIGN
KZB$DFRTTD
      7631**DCL-ENT  8350--ASSIGN
KZB$DFRWACK
      7628**DCL-ENT  8305--ASSIGN
KZB$INACTCLK
      7632**DCL-ENT  8266--CALL     8289--CALL     8316--CALL     8333--CALL     8389--CALL     8417--CALL
KZL$OTPRDY
      7633**DCL-ENT  8259--CALL
KZR$RBT
      7626**DCL-ENT  8296--CALL     8338--CALL
PL6.E3A0      #001=KZB$BSCIO File=KZB$BSCIO.:E05TSI                              WED 07/30/97 02:49 Page:51   
KZR$RELOTPBFR
      7627**DCL-ENT  8392--CALL
KZR_ABORT@
      7623**DCL      8252>>CALL     8326>>CALL
KZR_ORDERS@
      7624**DCL      8248>>CALL     8284>>CALL     8286>>CALL     8312>>CALL     8329>>CALL     8369>>CALL
      8386>>CALL     8395>>CALL     8400>>CALL     8413>>CALL     8420>>CALL
MOVALT
      8300**LABEL    8259--CALLALT  8280--CALLALT  8311--CALLALT  8399--CALLALT  8412--CALLALT  8419--CALLALT
NO_BSC_OTP
      8344**LABEL    8338--CALLALT

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:52   
      287        1        /*T***********************************************************/
      288        2        /*T*                                                         */
      289        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      290        4        /*T*                                                         */
      291        5        /*T***********************************************************/
      292        6        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
      293        7        /*P*     NAME:     KZB$HASPIO
      294        8                 PURPOSE:  To provide HASP protocol and physical I/O
      295        9                    for the Common Line Manager.
      296       10                                                                           */
      297       11        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:53   
      298       12        /*F*     NAME:     KZB$HASPIO
      299       13                 PURPOSE:  To physically control a HASP line.
      300       14                                                                           */
      301       15        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:54   
      302       16        /*D*     NAME:     KZB$HASPIO
      303       17                 CALL:
      304       18                    CALL KZB$HASPIO (Line-context,Bisync-FPT) ALTRET(label);
      305       19                 PARAMETERS:
      306       20                    Bisync-FPT is the Common Line Manager FPT structure.
      307       21                    Line-context is the line context structure.
      308       22                 INTERFACE:
      309       23                           This module calls routine KZR$RBT for reporting
      310       24                           input and acquiring output.
      311       25                 ENVIRONMENT:
      312       26                           The routine is entered at the synchronous common
      313       27                           inhibit level and must exit at the same level.
      314       28                 DESCRIPTION:
      315       29                           KZB$HASPIO is called by KZP$DRIVER when a real
      316       30                           event occurs and is passed an FPT structure
      317       31                           containing an event code which represents what
      318       32                           happened, a new state code, an old state code, and
      319       33                           an action code.
      320       34                           A normal return causes nothing further to be done on
      321       35                           behalf of the line.  If an ALTRETURN occurs, the
      322       36                           Common Line Manager will perform further processing
      323       37                           based on the event and function fields in the FPT.
      324       38                           Possiblities are; screech, change state and call
      325       39                           KZB$HASPIO again, or disconnect.
      326       40        */
      327       41        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:55   
      328       42        KZB$HASPIO: PROC ( KZ$LINCTX, KZ@BSCFPT ) ALTRET;
      329       43
      330       44        %INCLUDE KZ$LINCTX;
      331      664        %INCLUDE KZ_BSCFPT;
      332      694        %INCLUDE KZ_CLM_E;
      333      866        %INCLUDE KZ_HASP_C;
      334     1208        %INCLUDE KZ_LIN_C;
      335     1264        %INCLUDE KZ_MLCP_C;
      336     1339        %INCLUDE KH$CHN;
      337     1461        %INCLUDE KH$CLK;
      338     1831        %INCLUDE KH_CLKFNC_E;
      339     1876        %INCLUDE LCP_6;
      340     6155
      341     6156        %KZ$LINCTX (NAME=KZ$LINCTX,STCLASS=PARAM);
      342     6587        %KZ_BSCFPT (NAME=KZ@BSCFPT,STCLASS=PARAM);
      343     6596        %KZ_BSCFPTEQUS;
      344     6602
      345     6603        %KZ$EVENT (STCLASS=AUTO);
      346     6685
      347     6686        %KH$CHN;
      348     6810
      349     6811    1   DCL KZR_ORDERS@ EPTR SYMREF;
      350     6812    1   DCL KZR_ABORT@ EPTR SYMREF;
      351     6813    1   DCL KZR_CNCDSC@ EPTR SYMREF;
      352     6814    1   DCL KZR$RBT ENTRY(1) ALTRET;
      353     6815
      354     6816    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
      355     6817    1   DCL KZB$DFRACK ENTRY(1);
      356     6818    1   DCL KZB$INACTLIN ENTRY(1);
      357     6819
      358     6820        %KH$CLK (FPTN=SET_CLK,STCLASS=CONSTANT,FNC=%KH#CLK_SETCLK,
      359     6821                 PRDUNT=%KH#C_MIN);
      360     6970        %KH$CLK (FPTN=RESET_CLK,STCLASS=CONSTANT,FNC=%KH#CLK_RESET,PRDUNT=%KH#C_MIN);
      361     7119        %KH$CLK (FPTN=KH_CLK,STCLASS=CONSTANT,FNC=%KH#CLK_SETCLK,
      362     7120                 PRDUNT=%KH#C_SEC,PRD=1);
      363     7269        %KH$CLK (FPTN=CLK_FPT,STCLASS="",FNC=%KH#CLK_SETCLK);
      364     7418
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:56   
      365     7419        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:57   
      366     7420    2         DO CASE ( KZ@BSCFPT.ACT );
      367     7421
      368     7422    2          CASE ( %KZ#HSPACT_INIT );
      369     7423
      370     7424    3            IF KZ@BSCFPT.EVT ~= %KZ#HSPEVT_ACK0 THEN DO;
      371     7425    3               KZ@BSCFPT.FNC = %KZ#FNC_DSC;
      372     7426    3               ALTRETURN;
      373     7427    3               END;
      374     7428    3            ELSE DO;
      375     7429    3               KZ$EVENT.EVENT = %KZ#CLM_EVENT_LINACK;
      376     7430    3               KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);
      377     7431    3               KZ$EVENT.TERMID$=ADDR(KZ$LINCTX.LINID);
      378     7432    3               CALL KZR_CNCDSC@ (KZ$EVENT);
      379     7433    3               CALL INACTCLK;
      380     7434    3               END;
      381     7435
      382     7436    2          CASE (%KZ#HSPACT_BID);
      383     7437
      384     7438    2            CALL KZR_ABORT@ ( KZ$LINCTX );
      385     7439    2            CALL KZR_ORDERS@ ( %KZ#SEND_SOH_ENQ, KZ$LINCTX );
      386     7440
      387     7441    2          CASE (%KZ#HSPACT_ACKBID,
      388     7442    2               %KZ#HSPACT_INTACK );
      389     7443
      390     7444    2            CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );
      391     7445
      392     7446    2          CASE (%KZ#HSPACT_INTBLK);
      393     7447
      394     7448    2            KZ$LINCTX.INPDATSIZ = KZ@BSCFPT.SIZ;
      395     7449    2            KZ$EVENT.EVENT=%KZ#LINFCN_INP;
      396     7450    2            KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);
      397     7451    2            CALL KZR$RBT (KZ$EVENT) ALTRET(THAT_WAS_A_SIGNON);
      398     7452    2            RETURN;                   /* Bad signon               */
      399     7453    2   THAT_WAS_A_SIGNON:;
      400     7454    2            CALL INACTCLK;
      401     7455
      402     7456    2          CASE ( %KZ#HSPACT_STRT );
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:58   
      403     7457
      404     7458    2            KZ$EVENT.EVENT = %KZ#LINFCN_ACKSIGNON;
      405     7459    2            KZ$EVENT.LINCTX$ = ADDR(KZ$LINCTX);
      406     7460    2            CALL KZR$RBT (KZ$EVENT) ALTRET(ACK_SIGNON_WITH_ACK0);
      407     7461    2            KZ$EVENT.EVENT = %KZ#LINFCN_GETOTP;
      408     7462    2            CALL KZR$RBT (KZ$EVENT) ALTRET(ACK_SIGNON_WITH_ACK0);
      409     7463    2            CALL KZR_ORDERS@ ( %KZ#SEND_TBLOCK, KZ$LINCTX );
      410     7464    2            RETURN;
      411     7465    2   ACK_SIGNON_WITH_ACK0:
      412     7466    2            CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );
      413     7467
      414     7468    2          CASE ( %KZ#HSPACT_HSPACK,
      415     7469    2               %KZ#HSPACT_HSPBLK );
      416     7470
      417     7471    2            IF KZ@BSCFPT.EVT = %KZ#HSPEVT_NAK AND
      418     7472    3               KZ$LINCTX.PRO.ERRDUPBLK THEN DO;
      419     7473    3               KZ$LINCTX.RTRCNT = KZ$LINCTX.RTRCNT + 1;
      420     7474    3               IF KZ$LINCTX.PRO.RETRYS ~= 0 AND KZ$LINCTX.RTRCNT
      421     7475    4                  > KZ$LINCTX.PRO.RETRYS THEN DO;
      422     7476    4                  KZ@BSCFPT.EVT = %KZ#HSPEVT_URCERR;
      423     7477    4                  KZ@BSCFPT.FNC = %KZ#FNC_MOV;
      424     7478    4                  ALTRETURN;
      425     7479    4                  END;
      426     7480    4               ELSE DO;
      427     7481    4                  IF KZ$LINCTX.OTPDATSIZ = 0 THEN
      428     7482    4                     CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );
      429     7483    4                  ELSE
      430     7484    4                     CALL KZR_ORDERS@ ( %KZ#SEND_TBLOCK, KZ$LINCTX );
      431     7485    4                  END;
      432     7486    3               END;
      433     7487    3            ELSE DO;
      434     7488    3               IF KZ@BSCFPT.EVT ~= %KZ#HSPEVT_ETBBLK THEN
      435     7489    3                  KZ$LINCTX.INPDATSIZ = 0;
      436     7490    4               ELSE DO;
      437     7491    4                  KZ$LINCTX.INPDATSIZ = KZ@BSCFPT.SIZ;
      438     7492    4                  CALL INACTCLK;
      439     7493    4                  END;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:59   
      440     7494    3               KZ$EVENT.EVENT=%KZ#LINFCN_INP;
      441     7495    3               KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);
      442     7496    3               CALL KZR$RBT (KZ$EVENT);
      443     7497    3               KZ$LINCTX.RTRCNT = 0;
      444     7498    4               IF KZ@BSCFPT.EVT = %KZ#HSPEVT_GO THEN DO;
      445     7499    4                  KZ$EVENT.EVENT = %KZ#LINFCN_SNDSIGNON;
      446     7500    4                  CALL KZR$RBT (KZ$EVENT);
      447     7501    4                  END;
      448     7502    3               KZ$EVENT.EVENT = %KZ#LINFCN_GETOTP;
      449     7503    3               CALL KZR$RBT (KZ$EVENT) ALTRET(NO_RBT_OTP);
      450     7504    3               CALL KZR_ORDERS@ ( %KZ#SEND_TBLOCK, KZ$LINCTX );
      451     7505    3               CALL INACTCLK;
      452     7506    3               GOTO RBT_OTP_EXIT;
      453     7507    3   NO_RBT_OTP: ;
      454     7508    4               IF KZ@BSCFPT.SIZ < 10 THEN DO;
      455     7509    4                  CLK_FPT=KH_CLK;
      456     7510    4                  CLK_FPT.UID$=ADDR(KZ$LINCTX);
      457     7511    4                  CLK_FPT.SBR$=ENTADDR(KZB$DFRACK);
      458     7512    4                  CALL KHC$CLOCK (CLK_FPT);
      459     7513    4                  KZ$LINCTX.CTB.ACK$ = CLK_FPT.CTBCTX$;
      460     7514    4                  END;
      461     7515    3               ELSE
      462     7516    3                  CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );
      463     7517    3   RBT_OTP_EXIT:;
      464     7518    3               END;
      465     7519
      466     7520    2          CASE ( %KZ#HSPACT_HSPNAK,
      467     7521    2                  %KZ#HSPACT_INTNAK );
      468     7522
      469     7523    2            KZ$LINCTX.RTRCNT = KZ$LINCTX.RTRCNT + 1;
      470     7524    2            IF KZ$LINCTX.PRO.RETRYS ~= 0 AND KZ$LINCTX.RTRCNT >
      471     7525    3               KZ$LINCTX.PRO.RETRYS THEN DO;
      472     7526    3               KZ@BSCFPT.EVT = %KZ#HSPEVT_URCERR;
      473     7527    3               KZ@BSCFPT.FNC = %KZ#FNC_MOV;
      474     7528    3               ALTRETURN;
      475     7529    3               END;
      476     7530    2            ELSE
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:60   
      477     7531    2               CALL KZR_ORDERS@ ( %KZ#SEND_NAK, KZ$LINCTX );
      478     7532
      479     7533    2          CASE ( %KZ#HSPACT_RESEND );
      480     7534
      481     7535    2            IF KZ@BSCFPT.EVT ~= %KZ#HSPEVT_ETBBLK THEN
      482     7536    2               KZ$LINCTX.INPDATSIZ = 0;
      483     7537    3            ELSE DO;
      484     7538    3               KZ$LINCTX.INPDATSIZ = KZ@BSCFPT.SIZ;
      485     7539    3               CALL INACTCLK;
      486     7540    3               END;
      487     7541    2            KZ$EVENT.EVENT=%KZ#LINFCN_INP;
      488     7542    2            KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);
      489     7543    2            CALL KZR$RBT (KZ$EVENT);
      490     7544    2            IF KZ$LINCTX.OTPDATSIZ = 0 THEN
      491     7545    2               CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );
      492     7546    2            ELSE
      493     7547    2               CALL KZR_ORDERS@ ( %KZ#SEND_TBLOCK, KZ$LINCTX );
      494     7548
      495     7549    2          END;
      496     7550    1         RETURN;
      497     7551
      498     7552
      499     7553        /*    Reset inactive line clock.                                */
      500     7554
      501     7555    1   INACTCLK: PROC;
      502     7556
      503     7557    2         IF KZ$LINCTX.CHN$->KH$CHN.REDTIMOUTPRD = 0 THEN RETURN;
      504     7558    3         IF KZ$LINCTX.TMRCTB$ = ADDR(NIL) THEN DO;
      505     7559    3            CLK_FPT=SET_CLK;
      506     7560    3            CLK_FPT.UID$=ADDR(KZ$LINCTX);
      507     7561    3            CLK_FPT.SBR$=ENTADDR(KZB$INACTLIN);
      508     7562    3            CLK_FPT.PRD=KZ$LINCTX.CHN$->KH$CHN.REDTIMOUTPRD;
      509     7563    3            CALL KHC$CLOCK (CLK_FPT);
      510     7564    3            KZ$LINCTX.TMRCTB$=CLK_FPT.CTBCTX$;
      511     7565    3            END;
      512     7566    3         ELSE DO;
      513     7567    3            CLK_FPT=RESET_CLK;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:61   
      514     7568    3            CLK_FPT.CTBCTX$=KZ$LINCTX.TMRCTB$;
      515     7569    3            CLK_FPT.PRD=KZ$LINCTX.CHN$->KH$CHN.REDTIMOUTPRD;
      516     7570    3            CALL KHC$CLOCK (CLK_FPT);
      517     7571    3            END;
      518     7572    2         RETURN;
      519     7573    2   END;
      520     7574        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:62   
      521     7575
      522     7576        /*D*  NAME: KZB$INACTCLK
      523     7577              CALL:
      524     7578                    CALL KZB$INACTCLK
      525     7579              PURPOSE: To set, or reset, a clock to timeout inactive lines.
      526     7580                                                                           */
      527     7581
      528     7582    1   KZB$INACTCLK: ENTRY (KZ$LINCTX) ALTRET;
      529     7583
      530     7584    1         CALL INACTCLK;
      531     7585    1         RETURN;
      532     7586    1   END KZB$HASPIO;
      533     7587        %EOD;

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:63   
--  Include file information  --

   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KZ_MLCP_C.:E05TOU  is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KZ_HASP_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ_BSCFPT.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZB$HASPIO.

   Procedure KZB$HASPIO requires 678 words for executable code.
   Procedure KZB$HASPIO requires 40 words of local(AUTO) storage.

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:64   

 Object Unit name= KZB$HASPIO                                 File name= KZB$BSCIO.:E05TOU
 UTS= JUL 30 '97 02:50:02.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     33     21  KZB$HASPIO
    1   Proc  even  none   678    2A6  KZB$HASPIO

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KZB$HASPIO
     1    29B          yes     yes      Std        1  KZB$INACTCLK

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KZR$RBT
         yes           Std       1 KZB$DFRACK
 yes     yes           Std       1 KHC$CLOCK
         yes           Std       1 KZB$INACTLIN
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:65   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZR_ORDERS@                           KZR_ABORT@                            KZR_CNCDSC@
r    G$ROS$
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:66   


      287        1        /*T***********************************************************/
      288        2        /*T*                                                         */
      289        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      290        4        /*T*                                                         */
      291        5        /*T***********************************************************/
      292        6        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
      293        7        /*P*     NAME:     KZB$HASPIO
      294        8                 PURPOSE:  To provide HASP protocol and physical I/O
      295        9                    for the Common Line Manager.
      296       10                                                                           */
      297       11        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:67   
      298       12        /*F*     NAME:     KZB$HASPIO
      299       13                 PURPOSE:  To physically control a HASP line.
      300       14                                                                           */
      301       15        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:68   
      302       16        /*D*     NAME:     KZB$HASPIO
      303       17                 CALL:
      304       18                    CALL KZB$HASPIO (Line-context,Bisync-FPT) ALTRET(label);
      305       19                 PARAMETERS:
      306       20                    Bisync-FPT is the Common Line Manager FPT structure.
      307       21                    Line-context is the line context structure.
      308       22                 INTERFACE:
      309       23                           This module calls routine KZR$RBT for reporting
      310       24                           input and acquiring output.
      311       25                 ENVIRONMENT:
      312       26                           The routine is entered at the synchronous common
      313       27                           inhibit level and must exit at the same level.
      314       28                 DESCRIPTION:
      315       29                           KZB$HASPIO is called by KZP$DRIVER when a real
      316       30                           event occurs and is passed an FPT structure
      317       31                           containing an event code which represents what
      318       32                           happened, a new state code, an old state code, and
      319       33                           an action code.
      320       34                           A normal return causes nothing further to be done on
      321       35                           behalf of the line.  If an ALTRETURN occurs, the
      322       36                           Common Line Manager will perform further processing
      323       37                           based on the event and function fields in the FPT.
      324       38                           Possiblities are; screech, change state and call
      325       39                           KZB$HASPIO again, or disconnect.
      326       40        */
      327       41        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:69   
      328       42        KZB$HASPIO: PROC ( KZ$LINCTX, KZ@BSCFPT ) ALTRET;

     42   1 000000  D380 0000 0000  xent KZB$HASPIO      LNJ,B5   X6A_AUTO_2
          1 000003       0028 0002                       DC       40,2

      329       43
      330       44        %INCLUDE KZ$LINCTX;
      331      664        %INCLUDE KZ_BSCFPT;
      332      694        %INCLUDE KZ_CLM_E;
      333      866        %INCLUDE KZ_HASP_C;
      334     1208        %INCLUDE KZ_LIN_C;
      335     1264        %INCLUDE KZ_MLCP_C;
      336     1339        %INCLUDE KH$CHN;
      337     1461        %INCLUDE KH$CLK;
      338     1831        %INCLUDE KH_CLKFNC_E;
      339     1876        %INCLUDE LCP_6;
      340     6155
      341     6156        %KZ$LINCTX (NAME=KZ$LINCTX,STCLASS=PARAM);
      342     6587        %KZ_BSCFPT (NAME=KZ@BSCFPT,STCLASS=PARAM);
      343     6596        %KZ_BSCFPTEQUS;
      344     6602
      345     6603        %KZ$EVENT (STCLASS=AUTO);
      346     6685
      347     6686        %KH$CHN;
      348     6810
      349     6811    1   DCL KZR_ORDERS@ EPTR SYMREF;
      350     6812    1   DCL KZR_ABORT@ EPTR SYMREF;
      351     6813    1   DCL KZR_CNCDSC@ EPTR SYMREF;
      352     6814    1   DCL KZR$RBT ENTRY(1) ALTRET;
      353     6815
      354     6816    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
      355     6817    1   DCL KZB$DFRACK ENTRY(1);
      356     6818    1   DCL KZB$INACTLIN ENTRY(1);
      357     6819
      358     6820        %KH$CLK (FPTN=SET_CLK,STCLASS=CONSTANT,FNC=%KH#CLK_SETCLK,
      359     6821                 PRDUNT=%KH#C_MIN);
      360     6970        %KH$CLK (FPTN=RESET_CLK,STCLASS=CONSTANT,FNC=%KH#CLK_RESET,PRDUNT=%KH#C_MIN);
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:70   
      361     7119        %KH$CLK (FPTN=KH_CLK,STCLASS=CONSTANT,FNC=%KH#CLK_SETCLK,
      362     7120                 PRDUNT=%KH#C_SEC,PRD=1);
      363     7269        %KH$CLK (FPTN=CLK_FPT,STCLASS="",FNC=%KH#CLK_SETCLK);
      364     7418
      365     7419        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:71   
      366     7420    2         DO CASE ( KZ@BSCFPT.ACT );

   7420   1 000005  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          1 000007  B806                                 LDR,R3   ,B6
          1 000008  3D0B                                 CMV,R3   11
          1 000009  0281 022C                            BGE      s:7550,PREL
          1 00000B  A830 0000 0011  01                   LDR,R2   s:7420+12,R3
          1 00000E  83A0 0000 001C  01                   JMP      s:7424,R2
          1 000011       0000                            DC       s:7424,PREL
          1 000012       0028                            DC       s:7438,PREL
          1 000013       0044                            DC       s:7444,PREL
          1 000014       0044                            DC       s:7444,PREL
          1 000015       0057                            DC       s:7448,PREL
          1 000016       01A7                            DC       s:7523,PREL
          1 000017       0076                            DC       s:7458,PREL
          1 000018       00BF                            DC       s:7471,PREL
          1 000019       00BF                            DC       s:7471,PREL
          1 00001A       01A7                            DC       s:7523,PREL
          1 00001B       01CD                            DC       s:7535,PREL

      367     7421
      368     7422    2          CASE ( %KZ#HSPACT_INIT );

      369     7423
      370     7424    3            IF KZ@BSCFPT.EVT ~= %KZ#HSPEVT_ACK0 THEN DO;

   7424   1 00001C  E846 0001                            LDR,R6   1,B6
          1 00001E  6D07                                 CMV,R6   7
          1 00001F  0901 0007                            BE       s:7429,PREL

      371     7425    3               KZ@BSCFPT.FNC = %KZ#FNC_DSC;

   7425   1 000021  5C02                                 LDV,R5   2
          1 000022  DF46 0004                            STR,R5   4,B6

      372     7426    3               ALTRETURN;

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:72   
   7426   1 000024  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      373     7427    3               END;
      374     7428    3            ELSE DO;

      375     7429    3               KZ$EVENT.EVENT = %KZ#CLM_EVENT_LINACK;

   7429   1 000027  5C05                                 LDV,R5   5
          1 000028  DF47 0008                            STR,R5   KZ$EVENT,AUTO

      376     7430    3               KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);

   7430   1 00002A  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00002C  DFC7 000B                            STB,B5   KZ$EVENT+3,AUTO

      377     7431    3               KZ$EVENT.TERMID$=ADDR(KZ$LINCTX.LINID);

   7431   1 00002E  CBC5 0004                            LAB,B4   4,B5
          1 000030  CFC7 000D                            STB,B4   KZ$EVENT+5,AUTO

      378     7432    3               CALL KZR_CNCDSC@ (KZ$EVENT);

   7432   1 000032  BBC7 0008                            LAB,B3   KZ$EVENT,AUTO
          1 000034  BFC7 0024                            STB,B3   CLK_FPT+14,AUTO
          1 000036  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000038  9C80 0000 0000  xsym                 LDB,B1   KZR_CNCDSC@
          1 00003B  CBF0 0100                            LAB,B4   256,IMO
          1 00003D  E381                                 LNJ,B6   ,B1
          1 00003E       0001                            DC       s:7433,PREL

      379     7433    3               CALL INACTCLK;

   7433   1 00003F  E3C0 01F9                            LNJ,B6   s:0,PREL
          1 000041       0001                            DC       s:7434,PREL

      380     7434    3               END;

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:73   
   7434   1 000042  0F81 01F3                            B        s:7550,PREL

      381     7435
      382     7436    2          CASE (%KZ#HSPACT_BID);

      383     7437
      384     7438    2            CALL KZR_ABORT@ ( KZ$LINCTX );

   7438   1 000044  BBC7 0004                            LAB,B3   @KZ$LINCTX,AUTO
          1 000046  9C80 0000 0000  xsym                 LDB,B1   KZR_ABORT@
          1 000049  CBF0 0100                            LAB,B4   256,IMO
          1 00004B  E381                                 LNJ,B6   ,B1
          1 00004C       0001                            DC       s:7439,PREL

      385     7439    2            CALL KZR_ORDERS@ ( %KZ#SEND_SOH_ENQ, KZ$LINCTX );

   7439   1 00004D  EBF0 0008                            LAB,B6   8,IMO
          1 00004F  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000051  DFC7 0026                            STB,B5   CLK_FPT+16,AUTO
          1 000053  EFC7 0024                            STB,B6   CLK_FPT+14,AUTO
          1 000055  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000057  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 00005A  CBF0 0200                            LAB,B4   512,IMO
          1 00005C  E381                                 LNJ,B6   ,B1
          1 00005D       0001                            DC       s:7439+17,PREL
          1 00005E  0F81 01D7                            B        s:7550,PREL

      386     7440
      387     7441    2          CASE (%KZ#HSPACT_ACKBID,

      388     7442    2               %KZ#HSPACT_INTACK );
      389     7443
      390     7444    2            CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );

   7444   1 000060  DBF0 000A                            LAB,B5   10,IMO
          1 000062  CCC7 0004                            LDB,B4   @KZ$LINCTX,AUTO
          1 000064  CFC7 0026                            STB,B4   CLK_FPT+16,AUTO
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:74   
          1 000066  DFC7 0024                            STB,B5   CLK_FPT+14,AUTO
          1 000068  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 00006A  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 00006D  CBF0 0200                            LAB,B4   512,IMO
          1 00006F  E381                                 LNJ,B6   ,B1
          1 000070       0001                            DC       s:7444+17,PREL
          1 000071  0F81 01C4                            B        s:7550,PREL

      391     7445
      392     7446    2          CASE (%KZ#HSPACT_INTBLK);

      393     7447
      394     7448    2            KZ$LINCTX.INPDATSIZ = KZ@BSCFPT.SIZ;

   7448   1 000073  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000075  E846 0003                            LDR,R6   3,B6
          1 000077  EF45 0059                            STR,R6   89,B5

      395     7449    2            KZ$EVENT.EVENT=%KZ#LINFCN_INP;

   7449   1 000079  5C04                                 LDV,R5   4
          1 00007A  DF47 0008                            STR,R5   KZ$EVENT,AUTO

      396     7450    2            KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);

   7450   1 00007C  DFC7 000B                            STB,B5   KZ$EVENT+3,AUTO

      397     7451    2            CALL KZR$RBT (KZ$EVENT) ALTRET(THAT_WAS_A_SIGNON);

   7451   1 00007E  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          1 000080  CFC7 0024                            STB,B4   CLK_FPT+14,AUTO
          1 000082  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000084  CBF0 0100                            LAB,B4   256,IMO
          1 000086  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 000089       0004                            DC       s:7450,PREL

      398     7452    2            RETURN;                   /* Bad signon               */
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:75   

   7452   1 00008A  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

   7450   1                              THAT_WAS_A_SIGN*null
      399     7453    2   THAT_WAS_A_SIGNON:;
      400     7454    2            CALL INACTCLK;

   7454   1 00008D  E3C0 01AB            THAT_WAS_A_SIGN*LNJ,B6   s:0,PREL
          1 00008F       0001                            DC       s:7450+3,PREL
          1 000090  0F81 01A5                            B        s:7550,PREL

      401     7455
      402     7456    2          CASE ( %KZ#HSPACT_STRT );

      403     7457
      404     7458    2            KZ$EVENT.EVENT = %KZ#LINFCN_ACKSIGNON;

   7458   1 000092  6C19                                 LDV,R6   25
          1 000093  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      405     7459    2            KZ$EVENT.LINCTX$ = ADDR(KZ$LINCTX);

   7459   1 000095  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000097  DFC7 000B                            STB,B5   KZ$EVENT+3,AUTO

      406     7460    2            CALL KZR$RBT (KZ$EVENT) ALTRET(ACK_SIGNON_WITH_ACK0);

   7460   1 000099  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          1 00009B  CFC7 0024                            STB,B4   CLK_FPT+14,AUTO
          1 00009D  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 00009F  CBF0 0100                            LAB,B4   256,IMO
          1 0000A1  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 0000A4       0024                            DC       s:7466,PREL

      407     7461    2            KZ$EVENT.EVENT = %KZ#LINFCN_GETOTP;

   7461   1 0000A5  6C01                                 LDV,R6   1
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:76   
          1 0000A6  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      408     7462    2            CALL KZR$RBT (KZ$EVENT) ALTRET(ACK_SIGNON_WITH_ACK0);

   7462   1 0000A8  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          1 0000AA  EFC7 0024                            STB,B6   CLK_FPT+14,AUTO
          1 0000AC  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 0000AE  CBF0 0100                            LAB,B4   256,IMO
          1 0000B0  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 0000B3       0015                            DC       s:7466,PREL

      409     7463    2            CALL KZR_ORDERS@ ( %KZ#SEND_TBLOCK, KZ$LINCTX );

   7463   1 0000B4  EBF0 0003                            LAB,B6   3,IMO
          1 0000B6  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0000B8  DFC7 0026                            STB,B5   CLK_FPT+16,AUTO
          1 0000BA  EFC7 0024                            STB,B6   CLK_FPT+14,AUTO
          1 0000BC  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 0000BE  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0000C1  CBF0 0200                            LAB,B4   512,IMO
          1 0000C3  E381                                 LNJ,B6   ,B1
          1 0000C4       0001                            DC       s:7464,PREL

      410     7464    2            RETURN;

   7464   1 0000C5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      411     7465    2   ACK_SIGNON_WITH_ACK0:
      412     7466    2            CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );

   7466   1 0000C8  EBF0 000A            ACK_SIGNON_WITH*LAB,B6   10,IMO
          1 0000CA  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0000CC  DFC7 0026                            STB,B5   CLK_FPT+16,AUTO
          1 0000CE  EFC7 0024                            STB,B6   CLK_FPT+14,AUTO
          1 0000D0  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 0000D2  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0000D5  CBF0 0200                            LAB,B4   512,IMO
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:77   
          1 0000D7  E381                                 LNJ,B6   ,B1
          1 0000D8       0001                            DC       s:7466+17,PREL
          1 0000D9  0F81 015C                            B        s:7550,PREL

      413     7467
      414     7468    2          CASE ( %KZ#HSPACT_HSPACK,

      415     7469    2               %KZ#HSPACT_HSPBLK );
      416     7470
      417     7471    2            IF KZ@BSCFPT.EVT = %KZ#HSPEVT_NAK AND

   7471   1 0000DB  E846 0001                            LDR,R6   1,B6
          1 0000DD  6D0A                                 CMV,R6   10
          1 0000DE  0981 0041                            BNE      s:7488,PREL
          1 0000E0  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0000E2  82C5 004B                            LB,'0080'X        75,B5
          1 0000E4       0080
          1 0000E5  0581 003A                            BBF      s:7488,PREL

      418     7472    3               KZ$LINCTX.PRO.ERRDUPBLK THEN DO;

      419     7473    3               KZ$LINCTX.RTRCNT = KZ$LINCTX.RTRCNT + 1;

   7473   1 0000E7  8AC5 0039                            INC      57,B5

      420     7474    3               IF KZ$LINCTX.PRO.RETRYS ~= 0 AND KZ$LINCTX.RTRCNT

   7474   1 0000E9  E845 003D                            LDR,R6   61,B5
          1 0000EB  6901 000E                            BEZ,R6   s:7481,PREL
          1 0000ED  E945 0039                            CMR,R6   57,B5
          1 0000EF  0281 000A                            BGE      s:7481,PREL

      421     7475    4                  > KZ$LINCTX.PRO.RETRYS THEN DO;

      422     7476    4                  KZ@BSCFPT.EVT = %KZ#HSPEVT_URCERR;

   7476   1 0000F1  5C04                                 LDV,R5   4
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:78   
          1 0000F2  DF46 0001                            STR,R5   1,B6

      423     7477    4                  KZ@BSCFPT.FNC = %KZ#FNC_MOV;

   7477   1 0000F4  6C03                                 LDV,R6   3
          1 0000F5  EF46 0004                            STR,R6   4,B6

      424     7478    4                  ALTRETURN;

   7478   1 0000F7  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      425     7479    4                  END;
      426     7480    4               ELSE DO;

      427     7481    4                  IF KZ$LINCTX.OTPDATSIZ = 0 THEN

   7481   1 0000FA  D845 005D                            LDR,R5   93,B5
          1 0000FC  5981 0012                            BNEZ,R5  s:7484,PREL

      428     7482    4                     CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );

   7482   1 0000FE  CBF0 000A                            LAB,B4   10,IMO
          1 000100  DFC7 0026                            STB,B5   CLK_FPT+16,AUTO
          1 000102  CFC7 0024                            STB,B4   CLK_FPT+14,AUTO
          1 000104  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000106  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 000109  CBF0 0200                            LAB,B4   512,IMO
          1 00010B  E381                                 LNJ,B6   ,B1
          1 00010C       0001                            DC       s:7482+15,PREL
          1 00010D  0F81 0128                            B        s:7550,PREL

      429     7483    4                  ELSE
      430     7484    4                     CALL KZR_ORDERS@ ( %KZ#SEND_TBLOCK, KZ$LINCTX );

   7484   1 00010F  CBF0 0003                            LAB,B4   3,IMO
          1 000111  DFC7 0026                            STB,B5   CLK_FPT+16,AUTO
          1 000113  CFC7 0024                            STB,B4   CLK_FPT+14,AUTO
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:79   
          1 000115  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000117  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 00011A  CBF0 0200                            LAB,B4   512,IMO
          1 00011C  E381                                 LNJ,B6   ,B1
          1 00011D       0001                            DC       s:7486,PREL

      431     7485    4                  END;

      432     7486    3               END;

   7486   1 00011E  0F81 0117                            B        s:7550,PREL

      433     7487    3            ELSE DO;

      434     7488    3               IF KZ@BSCFPT.EVT ~= %KZ#HSPEVT_ETBBLK THEN

   7488   1 000120  6D05                                 CMV,R6   5
          1 000121  0901 0007                            BE       s:7491,PREL

      435     7489    3                  KZ$LINCTX.INPDATSIZ = 0;

   7489   1 000123  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000125  8745 0059                            CL       89,B5
          1 000127  0F81 000A                            B        s:7494,PREL

      436     7490    4               ELSE DO;

      437     7491    4                  KZ$LINCTX.INPDATSIZ = KZ@BSCFPT.SIZ;

   7491   1 000129  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00012B  D846 0003                            LDR,R5   3,B6
          1 00012D  DF45 0059                            STR,R5   89,B5

      438     7492    4                  CALL INACTCLK;

   7492   1 00012F  E3C0 0109                            LNJ,B6   s:0,PREL
          1 000131       0001                            DC       s:7494,PREL
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:80   

      439     7493    4                  END;

      440     7494    3               KZ$EVENT.EVENT=%KZ#LINFCN_INP;

   7494   1 000132  6C04                                 LDV,R6   4
          1 000133  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      441     7495    3               KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);

   7495   1 000135  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000137  EFC7 000B                            STB,B6   KZ$EVENT+3,AUTO

      442     7496    3               CALL KZR$RBT (KZ$EVENT);

   7496   1 000139  DBC7 0008                            LAB,B5   KZ$EVENT,AUTO
          1 00013B  DFC7 0024                            STB,B5   CLK_FPT+14,AUTO
          1 00013D  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 00013F  CBF0 0100                            LAB,B4   256,IMO
          1 000141  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 000144       0001                            DC       s:7497,PREL

      443     7497    3               KZ$LINCTX.RTRCNT = 0;

   7497   1 000145  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000147  8746 0039                            CL       57,B6

      444     7498    4               IF KZ@BSCFPT.EVT = %KZ#HSPEVT_GO THEN DO;

   7498   1 000149  DCC7 0006                            LDB,B5   @KZ@BSCFPT,AUTO
          1 00014B  E845 0001                            LDR,R6   1,B5
          1 00014D  6D01                                 CMV,R6   1
          1 00014E  0981 0010                            BNE      s:7502,PREL

      445     7499    4                  KZ$EVENT.EVENT = %KZ#LINFCN_SNDSIGNON;

   7499   1 000150  5C18                                 LDV,R5   24
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:81   
          1 000151  DF47 0008                            STR,R5   KZ$EVENT,AUTO

      446     7500    4                  CALL KZR$RBT (KZ$EVENT);

   7500   1 000153  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          1 000155  CFC7 0024                            STB,B4   CLK_FPT+14,AUTO
          1 000157  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000159  CBF0 0100                            LAB,B4   256,IMO
          1 00015B  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 00015E       0001                            DC       s:7502,PREL

      447     7501    4                  END;

      448     7502    3               KZ$EVENT.EVENT = %KZ#LINFCN_GETOTP;

   7502   1 00015F  6C01                                 LDV,R6   1
          1 000160  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      449     7503    3               CALL KZR$RBT (KZ$EVENT) ALTRET(NO_RBT_OTP);

   7503   1 000162  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          1 000164  EFC7 0024                            STB,B6   CLK_FPT+14,AUTO
          1 000166  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000168  CBF0 0100                            LAB,B4   256,IMO
          1 00016A  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 00016D       0017                            DC       s:7502,PREL

      450     7504    3               CALL KZR_ORDERS@ ( %KZ#SEND_TBLOCK, KZ$LINCTX );

   7504   1 00016E  EBF0 0003                            LAB,B6   3,IMO
          1 000170  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000172  DFC7 0026                            STB,B5   CLK_FPT+16,AUTO
          1 000174  EFC7 0024                            STB,B6   CLK_FPT+14,AUTO
          1 000176  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000178  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 00017B  CBF0 0200                            LAB,B4   512,IMO
          1 00017D  E381                                 LNJ,B6   ,B1
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:82   
          1 00017E       0001                            DC       s:7505,PREL

      451     7505    3               CALL INACTCLK;

   7505   1 00017F  E3C0 00B9                            LNJ,B6   s:0,PREL
          1 000181       0001                            DC       s:7506,PREL

      452     7506    3               GOTO RBT_OTP_EXIT;

   7506   1 000182  0F81 003E                            B        s:7516,PREL

   7502   1                              NO_RBT_OTP      null
      453     7507    3   NO_RBT_OTP: ;
      454     7508    4               IF KZ@BSCFPT.SIZ < 10 THEN DO;

   7508   1 000184  ECC7 0006            NO_RBT_OTP      LDB,B6   @KZ@BSCFPT,AUTO
          1 000186  E846 0003                            LDR,R6   3,B6
          1 000188  6D0A                                 CMV,R6   10
          1 000189  0281 0026                            BGE      s:7516,PREL

      455     7509    4                  CLK_FPT=KH_CLK;

   7509   1 00018B  AB80 0000 0000  00                   LAB,B2   SET_CLK
          1 00018E  2C2C                                 LDV,R2   44
          1 00018F  6C16                                 LDV,R6   22
          1 000190  BB87                                 LAB,B3   ,AUTO
          1 000191  3C2C                                 LDV,R3   44
          1 000192  0008                                 MMM

      456     7510    4                  CLK_FPT.UID$=ADDR(KZ$LINCTX);

   7510   1 000193  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000195  DFC7 0018                            STB,B5   CLK_FPT+2,AUTO

      457     7511    4                  CLK_FPT.SBR$=ENTADDR(KZB$DFRACK);

   7511   1 000197  CB80 0000 0000  xent                 LAB,B4   KZB$DFRACK
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:83   
          1 00019A  CFC7 001E                            STB,B4   CLK_FPT+8,AUTO

      458     7512    4                  CALL KHC$CLOCK (CLK_FPT);

   7512   1 00019C  ABC7 0016                            LAB,B2   CLK_FPT,AUTO
          1 00019E  AFC7 0024                            STB,B2   CLK_FPT+14,AUTO
          1 0001A0  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 0001A2  CBF0 0100                            LAB,B4   256,IMO
          1 0001A4  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 0001A7       0001                            DC       s:7513,PREL

      459     7513    4                  KZ$LINCTX.CTB.ACK$ = CLK_FPT.CTBCTX$;

   7513   1 0001A8  ECC7 0016                            LDB,B6   CLK_FPT,AUTO
          1 0001AA  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0001AC  EFC5 002B                            STB,B6   43,B5

      460     7514    4                  END;

   7514   1 0001AE  0F81 0012                            B        s:7516,PREL

      461     7515    3               ELSE
      462     7516    3                  CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );

   7516   1 0001B0  DBF0 000A                            LAB,B5   10,IMO
          1 0001B2  CCC7 0004                            LDB,B4   @KZ$LINCTX,AUTO
          1 0001B4  CFC7 0026                            STB,B4   CLK_FPT+16,AUTO
          1 0001B6  DFC7 0024                            STB,B5   CLK_FPT+14,AUTO
          1 0001B8  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 0001BA  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0001BD  CBF0 0200                            LAB,B4   512,IMO
          1 0001BF  E381                                 LNJ,B6   ,B1
          1 0001C0       0001                            DC       s:7516,PREL

   7516   1                              RBT_OTP_EXIT    null
      463     7517    3   RBT_OTP_EXIT:;
      464     7518    3               END;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:84   

   7518   1 0001C1  0F81 0074            RBT_OTP_EXIT    B        s:7550,PREL

      465     7519
      466     7520    2          CASE ( %KZ#HSPACT_HSPNAK,

      467     7521    2                  %KZ#HSPACT_INTNAK );
      468     7522
      469     7523    2            KZ$LINCTX.RTRCNT = KZ$LINCTX.RTRCNT + 1;

   7523   1 0001C3  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0001C5  8AC5 0039                            INC      57,B5

      470     7524    2            IF KZ$LINCTX.PRO.RETRYS ~= 0 AND KZ$LINCTX.RTRCNT >

   7524   1 0001C7  E845 003D                            LDR,R6   61,B5
          1 0001C9  6901 000E                            BEZ,R6   s:7531,PREL
          1 0001CB  E945 0039                            CMR,R6   57,B5
          1 0001CD  0281 000A                            BGE      s:7531,PREL

      471     7525    3               KZ$LINCTX.PRO.RETRYS THEN DO;

      472     7526    3               KZ@BSCFPT.EVT = %KZ#HSPEVT_URCERR;

   7526   1 0001CF  5C04                                 LDV,R5   4
          1 0001D0  DF46 0001                            STR,R5   1,B6

      473     7527    3               KZ@BSCFPT.FNC = %KZ#FNC_MOV;

   7527   1 0001D2  6C03                                 LDV,R6   3
          1 0001D3  EF46 0004                            STR,R6   4,B6

      474     7528    3               ALTRETURN;

   7528   1 0001D5  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      475     7529    3               END;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:85   
      476     7530    2            ELSE
      477     7531    2               CALL KZR_ORDERS@ ( %KZ#SEND_NAK, KZ$LINCTX );

   7531   1 0001D8  CBF0 0006                            LAB,B4   6,IMO
          1 0001DA  DFC7 0026                            STB,B5   CLK_FPT+16,AUTO
          1 0001DC  CFC7 0024                            STB,B4   CLK_FPT+14,AUTO
          1 0001DE  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 0001E0  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 0001E3  CBF0 0200                            LAB,B4   512,IMO
          1 0001E5  E381                                 LNJ,B6   ,B1
          1 0001E6       0001                            DC       s:7531+15,PREL
          1 0001E7  0F81 004E                            B        s:7550,PREL

      478     7532
      479     7533    2          CASE ( %KZ#HSPACT_RESEND );

      480     7534
      481     7535    2            IF KZ@BSCFPT.EVT ~= %KZ#HSPEVT_ETBBLK THEN

   7535   1 0001E9  E846 0001                            LDR,R6   1,B6
          1 0001EB  6D05                                 CMV,R6   5
          1 0001EC  0901 0007                            BE       s:7538,PREL

      482     7536    2               KZ$LINCTX.INPDATSIZ = 0;

   7536   1 0001EE  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0001F0  8745 0059                            CL       89,B5
          1 0001F2  0F81 000A                            B        s:7541,PREL

      483     7537    3            ELSE DO;

      484     7538    3               KZ$LINCTX.INPDATSIZ = KZ@BSCFPT.SIZ;

   7538   1 0001F4  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 0001F6  D846 0003                            LDR,R5   3,B6
          1 0001F8  DF45 0059                            STR,R5   89,B5

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:86   
      485     7539    3               CALL INACTCLK;

   7539   1 0001FA  E3C0 003E                            LNJ,B6   s:0,PREL
          1 0001FC       0001                            DC       s:7541,PREL

      486     7540    3               END;

      487     7541    2            KZ$EVENT.EVENT=%KZ#LINFCN_INP;

   7541   1 0001FD  6C04                                 LDV,R6   4
          1 0001FE  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      488     7542    2            KZ$EVENT.LINCTX$=ADDR(KZ$LINCTX);

   7542   1 000200  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000202  EFC7 000B                            STB,B6   KZ$EVENT+3,AUTO

      489     7543    2            CALL KZR$RBT (KZ$EVENT);

   7543   1 000204  DBC7 0008                            LAB,B5   KZ$EVENT,AUTO
          1 000206  DFC7 0024                            STB,B5   CLK_FPT+14,AUTO
          1 000208  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 00020A  CBF0 0100                            LAB,B4   256,IMO
          1 00020C  E380 0000 0000  xent                 LNJ,B6   KZR$RBT
          1 00020F       0001                            DC       s:7544,PREL

      490     7544    2            IF KZ$LINCTX.OTPDATSIZ = 0 THEN

   7544   1 000210  ECC7 0004                            LDB,B6   @KZ$LINCTX,AUTO
          1 000212  E846 005D                            LDR,R6   93,B6
          1 000214  6981 0012                            BNEZ,R6  s:7547,PREL

      491     7545    2               CALL KZR_ORDERS@ ( %KZ#SEND_ACK0, KZ$LINCTX );

   7545   1 000216  DBF0 000A                            LAB,B5   10,IMO
          1 000218  EFC7 0026                            STB,B6   CLK_FPT+16,AUTO
          1 00021A  DFC7 0024                            STB,B5   CLK_FPT+14,AUTO
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:87   
          1 00021C  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 00021E  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 000221  CBF0 0200                            LAB,B4   512,IMO
          1 000223  E381                                 LNJ,B6   ,B1
          1 000224       0001                            DC       s:7545+15,PREL
          1 000225  0F81 0010                            B        s:7550,PREL

      492     7546    2            ELSE
      493     7547    2               CALL KZR_ORDERS@ ( %KZ#SEND_TBLOCK, KZ$LINCTX );

   7547   1 000227  DBF0 0003                            LAB,B5   3,IMO
          1 000229  EFC7 0026                            STB,B6   CLK_FPT+16,AUTO
          1 00022B  DFC7 0024                            STB,B5   CLK_FPT+14,AUTO
          1 00022D  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 00022F  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          1 000232  CBF0 0200                            LAB,B4   512,IMO
          1 000234  E381                                 LNJ,B6   ,B1
          1 000235       0001                            DC       s:7550,PREL

      494     7548
      495     7549    2          END;

      496     7550    1         RETURN;

   7550   1 000236  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      497     7551
      498     7552
      499     7553        /*    Reset inactive line clock.                                */
      500     7554
      501     7555    1   INACTCLK: PROC;

   7555   1 000239  EFC7 0022            INACTCLK        STB,B6   CLK_FPT+12,AUTO

      502     7556
      503     7557    2         IF KZ$LINCTX.CHN$->KH$CHN.REDTIMOUTPRD = 0 THEN RETURN;

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:88   
   7557   1 00023B  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 00023D  CCC5 0002                            LDB,B4   2,B5
          1 00023F  82C4 0009                            LB,'00FF'X        9,B4
          1 000241       00FF
          1 000242  0501 0005                            BBT      s:7558,PREL

   7557   1 000244  ECC7 0022                            LDB,B6   CLK_FPT+12,AUTO
          1 000246  C3C6 0001                            LNJ,B4   1,B6

      504     7558    3         IF KZ$LINCTX.TMRCTB$ = ADDR(NIL) THEN DO;

   7558   1 000248  8DC5 006A                            CMN      106,B5
          1 00024A  0981 002C                            BNE      s:7567,PREL

      505     7559    3            CLK_FPT=SET_CLK;

   7559   1 00024C  AB80 0000 0000  00                   LAB,B2   SET_CLK
          1 00024F  2C00                                 LDV,R2   0
          1 000250  6C16                                 LDV,R6   22
          1 000251  BB87                                 LAB,B3   ,AUTO
          1 000252  3C2C                                 LDV,R3   44
          1 000253  0008                                 MMM

      506     7560    3            CLK_FPT.UID$=ADDR(KZ$LINCTX);

   7560   1 000254  DFC7 0018                            STB,B5   CLK_FPT+2,AUTO

      507     7561    3            CLK_FPT.SBR$=ENTADDR(KZB$INACTLIN);

   7561   1 000256  EB80 0000 0000  xent                 LAB,B6   KZB$INACTLIN
          1 000259  EFC7 001E                            STB,B6   CLK_FPT+8,AUTO

      508     7562    3            CLK_FPT.PRD=KZ$LINCTX.CHN$->KH$CHN.REDTIMOUTPRD;

   7562   1 00025B  CCC5 0002                            LDB,B4   2,B5
          1 00025D  E844 0009                            LDR,R6   9,B4
          1 00025F  E570 00FF                            AND,R6   255,IMO
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:89   
          1 000261  EF47 0020                            STR,R6   CLK_FPT+10,AUTO

      509     7563    3            CALL KHC$CLOCK (CLK_FPT);

   7563   1 000263  CBC7 0016                            LAB,B4   CLK_FPT,AUTO
          1 000265  CFC7 0024                            STB,B4   CLK_FPT+14,AUTO
          1 000267  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000269  CBF0 0100                            LAB,B4   256,IMO
          1 00026B  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 00026E       0001                            DC       s:7564,PREL

      510     7564    3            KZ$LINCTX.TMRCTB$=CLK_FPT.CTBCTX$;

   7564   1 00026F  ECC7 0016                            LDB,B6   CLK_FPT,AUTO
          1 000271  DCC7 0004                            LDB,B5   @KZ$LINCTX,AUTO
          1 000273  EFC5 006A                            STB,B6   106,B5

      511     7565    3            END;

   7565   1 000275  0F81 0021                            B        s:7572,PREL

      512     7566    3         ELSE DO;

      513     7567    3            CLK_FPT=RESET_CLK;

   7567   1 000277  AB80 0000 0000  00                   LAB,B2   SET_CLK
          1 00027A  2C16                                 LDV,R2   22
          1 00027B  6C16                                 LDV,R6   22
          1 00027C  BB87                                 LAB,B3   ,AUTO
          1 00027D  3C2C                                 LDV,R3   44
          1 00027E  0008                                 MMM

      514     7568    3            CLK_FPT.CTBCTX$=KZ$LINCTX.TMRCTB$;

   7568   1 00027F  ECC5 006A                            LDB,B6   106,B5
          1 000281  EFC7 0016                            STB,B6   CLK_FPT,AUTO

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:90   
      515     7569    3            CLK_FPT.PRD=KZ$LINCTX.CHN$->KH$CHN.REDTIMOUTPRD;

   7569   1 000283  CCC5 0002                            LDB,B4   2,B5
          1 000285  E844 0009                            LDR,R6   9,B4
          1 000287  E570 00FF                            AND,R6   255,IMO
          1 000289  EF47 0020                            STR,R6   CLK_FPT+10,AUTO

      516     7570    3            CALL KHC$CLOCK (CLK_FPT);

   7570   1 00028B  CBC7 0016                            LAB,B4   CLK_FPT,AUTO
          1 00028D  CFC7 0024                            STB,B4   CLK_FPT+14,AUTO
          1 00028F  BBC7 0024                            LAB,B3   CLK_FPT+14,AUTO
          1 000291  CBF0 0100                            LAB,B4   256,IMO
          1 000293  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 000296       0001                            DC       s:7572,PREL

      517     7571    3            END;

      518     7572    2         RETURN;

   7572   1 000297  ECC7 0022                            LDB,B6   CLK_FPT+12,AUTO
          1 000299  C3C6 0001                            LNJ,B4   1,B6

      519     7573    2   END;
      520     7574        %EJECT;
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:91   
      521     7575
      522     7576        /*D*  NAME: KZB$INACTCLK
      523     7577              CALL:
      524     7578                    CALL KZB$INACTCLK
      525     7579              PURPOSE: To set, or reset, a clock to timeout inactive lines.
      526     7580                                                                           */
      527     7581
      528     7582    1   KZB$INACTCLK: ENTRY (KZ$LINCTX) ALTRET;

   7582   1 00029B  D380 0000 0000  xent KZB$INACTCLK    LNJ,B5   X6A_AUTO_2
          1 00029E       0028 0002                       DC       40,2

      529     7583
      530     7584    1         CALL INACTCLK;

   7584   1 0002A0  E3C0 FF98                            LNJ,B6   s:0,PREL
          1 0002A2       0001                            DC       s:7585,PREL

      531     7585    1         RETURN;

   7585   1 0002A3  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      532     7586    1   END KZB$HASPIO;
      533     7587        %EOD;

PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:92   
--  Include file information  --

   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KZ_MLCP_C.:E05TOU  is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KZ_HASP_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ_BSCFPT.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZB$HASPIO.
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:93   

 **** Variables and constants ****

  ****  Section 000 RoData KZB$HASPIO

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    16-0-0/w STRC(176)   r     1 KH_CLK                     B-0-0/w STRC(176)   r     1 RESET_CLK
     0-0-0/w STRC(176)   r     1 SET_CLK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KZ$LINCTX                 6-0-0/w PTR         r     1 @KZ@BSCFPT
    16-0-0/w STRC(176)   r     1 CLK_FPT                    8-0-0/w STRC(224)   r     1 KZ$EVENT
    *0-0-0/w STRC(2192)  r     1 KZ$LINCTX                 *0-0-0/w STRC(80)    r     1 KZ@BSCFPT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w EPTR        r     1 KZR_ABORT@                 0-0-0/w EPTR        r     1 KZR_CNCDSC@
     0-0-0/w EPTR        r     1 KZR_ORDERS@

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KH$CHN


   Procedure KZB$HASPIO requires 678 words for executable code.
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:94   
   Procedure KZB$HASPIO requires 40 words of local(AUTO) storage.
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:95   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:96   
          MINI XREF LISTING

ACK_SIGNON_WITH_ACK0
      7466**LABEL    7460--CALLALT  7462--CALLALT
CLK_FPT
      7283**DCL      7509<<ASSIGN   7512<>CALL     7559<<ASSIGN   7563<>CALL     7567<<ASSIGN   7570<>CALL
CLK_FPT.CTBCTX$
      7289**DCL      7513>>ASSIGN   7564>>ASSIGN   7568<<ASSIGN
CLK_FPT.PRD
      7404**DCL      7562<<ASSIGN   7569<<ASSIGN
CLK_FPT.SBR$
      7400**DCL      7511<<ASSIGN   7561<<ASSIGN
CLK_FPT.UID
      7299**DCL      7300--REDEF    7301--REDEF
CLK_FPT.UID$
      7300**DCL      7510<<ASSIGN   7560<<ASSIGN
INACTCLK
      7555**PROC     7433--CALL     7454--CALL     7492--CALL     7505--CALL     7539--CALL     7584--CALL
KH$CHN.REDTIMOUTPRD
      6768**DCL      7557>>IF       7562>>ASSIGN   7569>>ASSIGN
KH$CHN.TERMID.TERM
      6797**DCL      6806--REDEF
KHC$CLOCK
      6816**DCL-ENT  7512--CALL     7563--CALL     7570--CALL
KH_CLK
      7134**DCL      7509>>ASSIGN
KH_CLK.UID
      7150**DCL      7151--REDEF    7152--REDEF
KZ$EVENT
      6617**DCL      7432<>CALL     7451<>CALL     7460<>CALL     7462<>CALL     7496<>CALL     7500<>CALL
      7503<>CALL     7543<>CALL
KZ$EVENT.EVENT
      6618**DCL      7429<<ASSIGN   7449<<ASSIGN   7458<<ASSIGN   7461<<ASSIGN   7494<<ASSIGN   7499<<ASSIGN
      7502<<ASSIGN   7541<<ASSIGN
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:97   
KZ$EVENT.LINCTX$
      6624**DCL      7430<<ASSIGN   7450<<ASSIGN   7459<<ASSIGN   7495<<ASSIGN   7542<<ASSIGN
KZ$EVENT.TERMID$
      6627**DCL      7431<<ASSIGN
KZ$LINCTX
      6167**DCL        42--PROC     7430--ASSIGN   7438<>CALL     7439<>CALL     7444<>CALL     7450--ASSIGN
      7459--ASSIGN   7463<>CALL     7466<>CALL     7482<>CALL     7484<>CALL     7495--ASSIGN   7504<>CALL
      7510--ASSIGN   7516<>CALL     7531<>CALL     7542--ASSIGN   7545<>CALL     7547<>CALL     7560--ASSIGN
      7582--ENTRY
KZ$LINCTX.CHN$
      6170**DCL      7557>>IF       7562>>ASSIGN   7569>>ASSIGN
KZ$LINCTX.CTB.ACK$
      6250**DCL      7513<<ASSIGN
KZ$LINCTX.INPDATSIZ
      6477**DCL      7448<<ASSIGN   7489<<ASSIGN   7491<<ASSIGN   7536<<ASSIGN   7538<<ASSIGN
KZ$LINCTX.LINID
      6188**DCL      7431--ASSIGN
KZ$LINCTX.LINID.TERM
      6190**DCL      6199--REDEF
KZ$LINCTX.OTPCNT
      6455**DCL      6458--REDEF
KZ$LINCTX.OTPDATSIZ
      6483**DCL      7481>>IF       7544>>IF
KZ$LINCTX.POLSIZ
      6501**DCL      6503--REDEF
KZ$LINCTX.PRO.ERRDUPBLK
      6437**DCL      7471>>IF
KZ$LINCTX.PRO.RETRYS
      6362**DCL      7474>>IF       7474>>IF       7524>>IF       7524>>IF
KZ$LINCTX.RTRCNT
      6343**DCL      7473<<ASSIGN   7473>>ASSIGN   7474>>IF       7497<<ASSIGN   7523<<ASSIGN   7523>>ASSIGN
      7524>>IF
KZ$LINCTX.TMRCTB$
      6512**DCL      7558>>IF       7564<<ASSIGN   7568>>ASSIGN
KZ@BSCFPT
      6588**DCL        42--PROC
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:98   
KZ@BSCFPT.ACT
      6589**DCL      7420>>DOCASE
KZ@BSCFPT.EVT
      6590**DCL      7424>>IF       7471>>IF       7476<<ASSIGN   7488>>IF       7498>>IF       7526<<ASSIGN
      7535>>IF
KZ@BSCFPT.FNC
      6594**DCL      7425<<ASSIGN   7477<<ASSIGN   7527<<ASSIGN
KZ@BSCFPT.SIZ
      6593**DCL      7448>>ASSIGN   7491>>ASSIGN   7508>>IF       7538>>ASSIGN
KZB$DFRACK
      6817**DCL-ENT  7511--ASSIGN
KZB$INACTLIN
      6818**DCL-ENT  7561--ASSIGN
KZR$RBT
      6814**DCL-ENT  7451--CALL     7460--CALL     7462--CALL     7496--CALL     7500--CALL     7503--CALL
      7543--CALL
KZR_ABORT@
      6812**DCL      7438>>CALL
KZR_CNCDSC@
      6813**DCL      7432>>CALL
KZR_ORDERS@
      6811**DCL      7439>>CALL     7444>>CALL     7463>>CALL     7466>>CALL     7482>>CALL     7484>>CALL
      7504>>CALL     7516>>CALL     7531>>CALL     7545>>CALL     7547>>CALL
NO_RBT_OTP
      7502**LABEL    7503--CALLALT
RBT_OTP_EXIT
      7516**LABEL    7506--GOTO
RESET_CLK
      6984**DCL      7567>>ASSIGN
RESET_CLK.UID
      7000**DCL      7001--REDEF    7002--REDEF
SET_CLK
      6835**DCL      7559>>ASSIGN
SET_CLK.UID
      6851**DCL      6852--REDEF    6853--REDEF
THAT_WAS_A_SIGNON
PL6.E3A0      #002=KZB$HASPIO File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:99   
      7450**LABEL    7451--CALLALT

PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:100  
      534        1        /*T***********************************************************/
      535        2        /*T*                                                         */
      536        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      537        4        /*T*                                                         */
      538        5        /*T***********************************************************/
      539        6
      540        7        /* NAME: KZB$DFRACK
      541        8           PURPOSE: Procedures to send control characters when clock expires.
      542        9                                                                           */
      543       10        KZB$DFRACK: PROC (KH$EXP);
      544       11
      545       12        %INCLUDE KH$CLK;
      546      382        %INCLUDE KH_CLKFNC_E;
      547      427        %INCLUDE KZ$LINCTX;
      548     1047        %INCLUDE KHC_MAC_C;
      549     1088        %INCLUDE KZ_MLCP_C;
      550     1163        %INCLUDE KL_CONTROL_C;
      551     1543        %INCLUDE KH_MACRO_C;
      552     2286        %INCLUDE KI_CP6;
      553     3382
      554     3383           %KH$EXP (STCLASS=PARAM);
      555     3446
      556     3447           %KZ$LINCTX;
      557     3878
      558     3879           %INHIBIT_DCLS;
      559     3891
      560     3892           %KH$CTLTBL (FPTN=KH$CTLTBL,
      561     3893                       STCLASS="BASED(KH_CTLTBL$)");
      562     4105
      563     4106    1   DCL KH_CTLTBL$ PTR SYMREF;
      564     4107    1   DCL INHWORD UBIN WORD BASED;
      565     4108
      566     4109    1   DCL ORDER UBIN WORD;
      567     4110    1   DCL KZR_ORDERS@ EPTR SYMREF;
      568     4111
      569     4112    1   DCL KZR$KILL_LINE ENTRY(1) ALTRET;
      570     4113
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:101  
      571     4114
      572     4115    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.ACK$ = ADDR(NIL);
      573     4116    1         ORDER = %KZ#SEND_ACK0;
      574     4117    1         GOTO DEFER_IT;
      575     4118
      576     4119    1   KZB$DFRNAK: ENTRY;
      577     4120
      578     4121    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.NAK$ = ADDR(NIL);
      579     4122    1         ORDER = %KZ#SEND_NAK;
      580     4123    1         GOTO DEFER_IT;
      581     4124
      582     4125    1   KZB$DFRWACK: ENTRY;
      583     4126
      584     4127    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.ENQ$ = ADDR(NIL);
      585     4128    1         ORDER = %KZ#SEND_WACK;
      586     4129    1         GOTO DEFER_IT;
      587     4130
      588     4131    1   KZB$DFRTTD: ENTRY;
      589     4132
      590     4133    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.ENQ$ = ADDR(NIL);
      591     4134    1         ORDER = %KZ#SEND_TTD;
      592     4135    1         GOTO DEFER_IT;
      593     4136
      594     4137    1   KZB$DFRENQ: ENTRY;
      595     4138
      596     4139    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.ENQ$ = ADDR(NIL);
      597     4140    1         ORDER = %KZ#SEND_ENQ;
      598     4141
      599     4142
      600     4143    1   DEFER_IT:;
      601     4144    2         IF NOT (KH$EXP.ABORT OR KH$EXP.RESET) THEN DO;
      602     4145    2            INHIBIT_LEVEL = KH$CTLTBL.PARM.PTR$ (%KL_HNDLRPARM_INTLVL) -> INHWORD;
      603     4146              %DISABLE;
      604     4150    2            CALL KZR_ORDERS@ (ORDER,KH$EXP.UID$->KZ$LINCTX);
      605     4151              %ENABLE;
      606     4157    2            END;
      607     4158    1         RETURN;
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:102  
      608     4159
      609     4160
      610     4161
      611     4162    1   KZB$INACTLIN: ENTRY(KH$EXP);
      612     4163
      613     4164    1         CALL KZR$KILL_LINE (KH$EXP.UID$->KZ$LINCTX);
      614     4165    1         RETURN;
      615     4166
      616     4167    1   END KZB$DFRACK;

PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:103  
--  Include file information  --

   KI_CP6.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KZ_MLCP_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
      No diagnostics issued in procedure KZB$DFRACK.

   Procedure KZB$DFRACK requires 174 words for executable code.
   Procedure KZB$DFRACK requires 14 words of local(AUTO) storage.

    No errors detected in file KZB$BSCIO.:E05TSI    .

PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:104  

 Object Unit name= KZB$DFRACK                                 File name= KZB$BSCIO.:E05TOU
 UTS= JUL 30 '97 02:50:47.68 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   174     AE  KZB$DFRACK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KZB$DFRACK
     0     12                  yes      Std        0  KZB$DFRNAK
     0     24                  yes      Std        0  KZB$DFRWACK
     0     36                  yes      Std        0  KZB$DFRTTD
     0     48                  yes      Std        0  KZB$DFRENQ
     0     99                  yes      Std        1  KZB$INACTLIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KHI$DISABLE
         yes           Std       0 KHI$ENABLE
 yes     yes           Std       1 KZR$KILL_LINE
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:105  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KH_CTLTBL$                            KZR_ORDERS@                      r    G$ROS$
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:106  


      534        1        /*T***********************************************************/
      535        2        /*T*                                                         */
      536        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      537        4        /*T*                                                         */
      538        5        /*T***********************************************************/
      539        6
      540        7        /* NAME: KZB$DFRACK
      541        8           PURPOSE: Procedures to send control characters when clock expires.
      542        9                                                                           */
      543       10        KZB$DFRACK: PROC (KH$EXP);

     10   0 000000  D380 0000 0000  xent KZB$DFRACK      LNJ,B5   X6A_AUTO_1
          0 000003       000E 0001                       DC       14,1

      544       11
      545       12        %INCLUDE KH$CLK;
      546      382        %INCLUDE KH_CLKFNC_E;
      547      427        %INCLUDE KZ$LINCTX;
      548     1047        %INCLUDE KHC_MAC_C;
      549     1088        %INCLUDE KZ_MLCP_C;
      550     1163        %INCLUDE KL_CONTROL_C;
      551     1543        %INCLUDE KH_MACRO_C;
      552     2286        %INCLUDE KI_CP6;
      553     3382
      554     3383           %KH$EXP (STCLASS=PARAM);
      555     3446
      556     3447           %KZ$LINCTX;
      557     3878
      558     3879           %INHIBIT_DCLS;
      559     3891
      560     3892           %KH$CTLTBL (FPTN=KH$CTLTBL,
      561     3893                       STCLASS="BASED(KH_CTLTBL$)");
      562     4105
      563     4106    1   DCL KH_CTLTBL$ PTR SYMREF;
      564     4107    1   DCL INHWORD UBIN WORD BASED;
      565     4108
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:107  
      566     4109    1   DCL ORDER UBIN WORD;
      567     4110    1   DCL KZR_ORDERS@ EPTR SYMREF;
      568     4111
      569     4112    1   DCL KZR$KILL_LINE ENTRY(1) ALTRET;
      570     4113
      571     4114
      572     4115    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.ACK$ = ADDR(NIL);

   4115   0 000005  ECC7 0004                            LDB,B6   @KH$EXP,AUTO
          0 000007  DC86                                 LDB,B5   ,B6
          0 000008  CB80 0000 0000                       LAB,B4   0
          0 00000B  CFC5 002B                            STB,B4   43,B5

      573     4116    1         ORDER = %KZ#SEND_ACK0;

   4116   0 00000D  6C0A                                 LDV,R6   10
          0 00000E  EF47 0008                            STR,R6   ORDER,AUTO

      574     4117    1         GOTO DEFER_IT;

   4117   0 000010  0F81 0047                            B        s:4140,PREL

      575     4118
      576     4119    1   KZB$DFRNAK: ENTRY;

   4119   0 000012  D380 0000 0000  xent KZB$DFRNAK      LNJ,B5   X6A_AUTO_1
          0 000015       000E 0001                       DC       14,1

      577     4120
      578     4121    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.NAK$ = ADDR(NIL);

   4121   0 000017  ECC7 0004                            LDB,B6   @KH$EXP,AUTO
          0 000019  DC86                                 LDB,B5   ,B6
          0 00001A  CB80 0000 0000                       LAB,B4   0
          0 00001D  CFC5 002F                            STB,B4   47,B5

      579     4122    1         ORDER = %KZ#SEND_NAK;
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:108  

   4122   0 00001F  6C06                                 LDV,R6   6
          0 000020  EF47 0008                            STR,R6   ORDER,AUTO

      580     4123    1         GOTO DEFER_IT;

   4123   0 000022  0F81 0035                            B        s:4140,PREL

      581     4124
      582     4125    1   KZB$DFRWACK: ENTRY;

   4125   0 000024  D380 0000 0000  xent KZB$DFRWACK     LNJ,B5   X6A_AUTO_1
          0 000027       000E 0001                       DC       14,1

      583     4126
      584     4127    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.ENQ$ = ADDR(NIL);

   4127   0 000029  ECC7 0004                            LDB,B6   @KH$EXP,AUTO
          0 00002B  DC86                                 LDB,B5   ,B6
          0 00002C  CB80 0000 0000                       LAB,B4   0
          0 00002F  CFC5 002D                            STB,B4   45,B5

      585     4128    1         ORDER = %KZ#SEND_WACK;

   4128   0 000031  6C05                                 LDV,R6   5
          0 000032  EF47 0008                            STR,R6   ORDER,AUTO

      586     4129    1         GOTO DEFER_IT;

   4129   0 000034  0F81 0023                            B        s:4140,PREL

      587     4130
      588     4131    1   KZB$DFRTTD: ENTRY;

   4131   0 000036  D380 0000 0000  xent KZB$DFRTTD      LNJ,B5   X6A_AUTO_1
          0 000039       000E 0001                       DC       14,1

PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:109  
      589     4132
      590     4133    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.ENQ$ = ADDR(NIL);

   4133   0 00003B  ECC7 0004                            LDB,B6   @KH$EXP,AUTO
          0 00003D  DC86                                 LDB,B5   ,B6
          0 00003E  CB80 0000 0000                       LAB,B4   0
          0 000041  CFC5 002D                            STB,B4   45,B5

      591     4134    1         ORDER = %KZ#SEND_TTD;

   4134   0 000043  6C04                                 LDV,R6   4
          0 000044  EF47 0008                            STR,R6   ORDER,AUTO

      592     4135    1         GOTO DEFER_IT;

   4135   0 000046  0F81 0011                            B        s:4140,PREL

      593     4136
      594     4137    1   KZB$DFRENQ: ENTRY;

   4137   0 000048  D380 0000 0000  xent KZB$DFRENQ      LNJ,B5   X6A_AUTO_1
          0 00004B       000E 0001                       DC       14,1

      595     4138
      596     4139    1         KH$EXP.UID$ -> KZ$LINCTX.CTB.ENQ$ = ADDR(NIL);

   4139   0 00004D  ECC7 0004                            LDB,B6   @KH$EXP,AUTO
          0 00004F  DC86                                 LDB,B5   ,B6
          0 000050  CB80 0000 0000                       LAB,B4   0
          0 000053  CFC5 002D                            STB,B4   45,B5

      597     4140    1         ORDER = %KZ#SEND_ENQ;

   4140   0 000055  6C0D                                 LDV,R6   13
          0 000056  EF47 0008                            STR,R6   ORDER,AUTO

   4140   0                              DEFER_IT        null
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:110  
      598     4141
      599     4142
      600     4143    1   DEFER_IT:;
      601     4144    2         IF NOT (KH$EXP.ABORT OR KH$EXP.RESET) THEN DO;

   4144   0 000058  82C6 0005            DEFER_IT        LB,'4000'X        5,B6
   4144   0 00005A       4000
          0 00005B  0501 003A                            BBT      s:4158,PREL
          0 00005D  82C6 0005                            LB,'2000'X        5,B6
          0 00005F       2000
          0 000060  0501 0035                            BBT      s:4158,PREL

      602     4145    2            INHIBIT_LEVEL = KH$CTLTBL.PARM.PTR$ (%KL_HNDLRPARM_INTLVL) -> INHWORD;

   4145   0 000062  DC80 0000 0000  xsym                 LDB,B5   KH_CTLTBL$
          0 000065  CCC5 0002                            LDB,B4   2,B5
          0 000067  D804                                 LDR,R5   ,B4
          0 000068  DF47 0006                            STR,R5   INHIBIT_LEVEL,AUTO

      603     4146              %DISABLE;

   4147   0 00006A  DF47 0007                            STR,R5   DISABLE_LEVEL,AUTO

   4148   0 00006C  CBC7 0007                            LAB,B4   DISABLE_LEVEL,AUTO
          0 00006E  CFC7 000A                            STB,B4   ORDER+2,AUTO
          0 000070  BBC7 000A                            LAB,B3   ORDER+2,AUTO
          0 000072  CBF0 0100                            LAB,B4   256,IMO
          0 000074  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          0 000077       0001                            DC       s:4150,PREL

      604     4150    2            CALL KZR_ORDERS@ (ORDER,KH$EXP.UID$->KZ$LINCTX);

   4150   0 000078  ECC7 0004                            LDB,B6   @KH$EXP,AUTO
          0 00007A  DC86                                 LDB,B5   ,B6
          0 00007B  DFC7 000C                            STB,B5   ORDER+4,AUTO
          0 00007D  CBC7 0008                            LAB,B4   ORDER,AUTO
          0 00007F  CFC7 000A                            STB,B4   ORDER+2,AUTO
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:111  
          0 000081  BBC7 000A                            LAB,B3   ORDER+2,AUTO
          0 000083  9C80 0000 0000  xsym                 LDB,B1   KZR_ORDERS@
          0 000086  CBF0 0200                            LAB,B4   512,IMO
          0 000088  E381                                 LNJ,B6   ,B1
          0 000089       0001                            DC       s:4152,PREL

      605     4151              %ENABLE;

   4152   0 00008A  E847 0007                            LDR,R6   DISABLE_LEVEL,AUTO
          0 00008C  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          0 00008E  0901 0007                            BE       s:4158,PREL

   4154   0 000090  CBF0 0000                            LAB,B4   0,IMO
          0 000092  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          0 000095       0001                            DC       s:4158,PREL

      606     4157    2            END;

      607     4158    1         RETURN;

   4158   0 000096  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      608     4159
      609     4160
      610     4161
      611     4162    1   KZB$INACTLIN: ENTRY(KH$EXP);

   4162   0 000099  D380 0000 0000  xent KZB$INACTLIN    LNJ,B5   X6A_AUTO_1
          0 00009C       000E 0001                       DC       14,1

      612     4163
      613     4164    1         CALL KZR$KILL_LINE (KH$EXP.UID$->KZ$LINCTX);

   4164   0 00009E  ECC7 0004                            LDB,B6   @KH$EXP,AUTO
          0 0000A0  DC86                                 LDB,B5   ,B6
          0 0000A1  DFC7 000A                            STB,B5   ORDER+2,AUTO
          0 0000A3  BBC7 000A                            LAB,B3   ORDER+2,AUTO
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:112  
          0 0000A5  CBF0 0100                            LAB,B4   256,IMO
          0 0000A7  E380 0000 0000  xent                 LNJ,B6   KZR$KILL_LINE
          0 0000AA       0001                            DC       s:4165,PREL

      614     4165    1         RETURN;

   4165   0 0000AB  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      615     4166
      616     4167    1   END KZB$DFRACK;

PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:113  
--  Include file information  --

   KI_CP6.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KZ_MLCP_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
      No diagnostics issued in procedure KZB$DFRACK.
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:114  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KH$EXP                    7-0-0/w UBIN(16)    r     1 DISABLE_LEVEL
     6-0-0/w UBIN(16)    r     1 INHIBIT_LEVEL             *0-0-0/w STRC(96)    r     1 KH$EXP
     8-0-0/w UBIN(16)    r     1 ORDER

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KH_CTLTBL$                 0-0-0/w EPTR        r     1 KZR_ORDERS@

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 INHWORD                    0-0-0/w STRC(64)    r     1 KH$CTLTBL
     0-0-0/w STRC(2192)  r     1 KZ$LINCTX


   Procedure KZB$DFRACK requires 174 words for executable code.
   Procedure KZB$DFRACK requires 14 words of local(AUTO) storage.

    No errors detected in file KZB$BSCIO.:E05TSI    .
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:115  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:116  
          MINI XREF LISTING

DEFER_IT
      4140**LABEL    4117--GOTO     4123--GOTO     4129--GOTO     4135--GOTO
DISABLE_LEVEL
      3889**DCL      4147<<ASSIGN   4148<>CALL     4152>>IF
INHIBIT_LEVEL
      3886**DCL      4145<<ASSIGN   4147>>ASSIGN   4152>>IF
INHWORD
      4107**DCL      4145>>ASSIGN
KH$CTLTBL.PARM.PTR$
      4036**DCL      4145>>ASSIGN
KH$EXP
      3397**DCL        10--PROC     4162--ENTRY
KH$EXP.ABORT
      3419**DCL      4144>>IF
KH$EXP.RESET
      3431**DCL      4144>>IF
KH$EXP.UID
      3403**DCL      3404--REDEF
KH$EXP.UID$
      3404**DCL      4115>>ASSIGN   4121>>ASSIGN   4127>>ASSIGN   4133>>ASSIGN   4139>>ASSIGN   4150>>CALL
      4164>>CALL
KHI$DISABLE
      3883**DCL-ENT  4148--CALL
KHI$ENABLE
      3882**DCL-ENT  4154--CALL
KH_CTLTBL$
      4106**DCL      3910--IMP-PTR  4145>>ASSIGN
KZ$LINCTX
      3458**DCL      4150<>CALL     4164<>CALL
KZ$LINCTX.CTB.ACK$
      3541**DCL      4115<<ASSIGN
KZ$LINCTX.CTB.ENQ$
PL6.E3A0      #003=KZB$DFRACK File=KZB$BSCIO.:E05TSI                             WED 07/30/97 02:50 Page:117  
      3543**DCL      4127<<ASSIGN   4133<<ASSIGN   4139<<ASSIGN
KZ$LINCTX.CTB.NAK$
      3545**DCL      4121<<ASSIGN
KZ$LINCTX.LINID.TERM
      3481**DCL      3490--REDEF
KZ$LINCTX.OTPCNT
      3746**DCL      3749--REDEF
KZ$LINCTX.POLSIZ
      3792**DCL      3794--REDEF
KZR$KILL_LINE
      4112**DCL-ENT  4164--CALL
KZR_ORDERS@
      4110**DCL      4150>>CALL
ORDER
      4109**DCL      4116<<ASSIGN   4122<<ASSIGN   4128<<ASSIGN   4134<<ASSIGN   4140<<ASSIGN   4150<>CALL
