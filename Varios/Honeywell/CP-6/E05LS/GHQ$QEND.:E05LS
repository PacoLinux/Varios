VERSION E05

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:1    
        1        1        /*M* Quantum end and asynchronous event processing  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*  */
        8        8        /*P* NAME: GHQ$QEND
        9        9             PURPOSE: To check if the current user has reached the end
       10       10                      of an execution quantum or has any outstanding
       11       11                      asynchronous events and to do the appropriate
       12       12                      processing if he has.                               */
       13       13        /*D* NAME: GHQ$QEND
       14       14             CALL: CALL GHQ$QEND ALTRET;
       15       15
       16       16             DESCRIPTION:  This routine is called following a RTC interrupt
       17       17                   or after rescheduling a user that was previously quantum
       18       18                   quantum ended.  The various asynchronous event indicators
       19       19                   in the users context are tested to determine if
       20       20                   the user should be returned to in other than the normal
       21       21                   manner.  If so, the users current environment is moved to
       22       22                   the TCB and then modified to return control to the appropriate
       23       23                   asynchronous entry point.  After this process, quantum end
       24       24                   tests are made to determine if the user has reached the end
       25       25                   of an execution quantum or if he has had a minimum amount
       26       26                   of guaranteed execution time since last being scheduled and
       27       27                   there is another, higher priority user waiting to execute.
       28       28                   If so, the ALTRET is taken to block the user and reschedule
       29       29                   another.
       30       30                                                                           */
       31       31        /*D* NAME: GHQ$MCLEND
       32       32             CALL: CALL GHQ$MCLEND ALTRET;
       33       33
       34       34             DESCRIPTION:  This routine is called following an MCL service
       35       35                   with the environment to be returned to in the users TSA.
       36       36                   This entry provides a convenient means of identifying the
       37       37                   TSA environment while providing the same facililities
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:2    
       38       38                   described above for GHQ$QEND.
       39       39                                                                           */
       40       40
       41       41        GHQ$QEND: PROC ALTRET;
       42       42
       43       43
       44       44
       45       45        %INCLUDE B_ERRORS_C;
       46     1172        %INCLUDE GH_SCHD_M;
       47     1316        %INCLUDE GH_SCHD_E;
       48     1412        %INCLUDE G_JIT_M;
       49     1677        %INCLUDE G_HJIT_M;
       50     1822 S      %INCLUDE G_LCP6_E;
       51     1823        %INCLUDE G_ROS_M;
       52     1905        %INCLUDE GM_VIRTUAL_E;
       53     2115 S      %INCLUDE GH_LCP6_M;
       54     2116        %INCLUDE GH_GATE_M;
       55     2157 S      %INCLUDE GU_LCP6_M;
       56     2158        %INCLUDE GU_MACROS_M;
       57     2317        %INCLUDE GH_HARDWARE_M;
       58     2415        %INCLUDE KL_MACRO_C;
       59     5767        %INCLUDE KL_AFCN_C;
       60     5868        %INCLUDE K_ID_E;
       61     5918        %INCLUDE P_FEP_M;
       62     6356
       63     6357        %G$MHJIT (STCLASS="BASED(G$MHJIT$)");
       64    13231        %G$UHJIT (STCLASS="BASED(G$UHJIT$)");
       65    16205        %G$TSA (STCLASS="BASED(G$TSA_USR$)");
       66    16593        %G$USER (STCLASS="BASED(CU$)");
       67    16604        %G$JIT (FPTN=G$JIT,STCLASS="BASED(G$JIT$)");
       68    17018        %G$DO (STCLASS="BASED(D$)");
       69    17081        %G$ROS (STCLASS="BASED(G$ROS$)");
       70    17125        %G$ECCB;
       71    17201        %G$LOW_MEM (STCLASS="BASED(G$LOW_MEM$)");
       72    17250        %GUE_ENVTCB_PARAMS (FPTN=ENVTCB);
       73    17375        %K#ENTID_E;
       74    17394        %K#LYRID_E;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:3    
       75    17401
       76    17402        %G$JIT_E;
       77    17464
       78    17465        %PS_LCP6STT (STCLASS=SYMREF);
       79    17969
       80    17970        %VLP_ERRCODE (FPTN=TCBERR,FCG=GH,MID=Q,MON='1'B,SEV=G_SEV_ABORT#,
       81    17971                      STCLASS=CONSTANT,ERR#=%E$TCBFULL);
       82    18017
       83    18018        %VLP_ERRCODE (FPTN=EMAXTIME,FCG=GH,MID=Q,MON='1'B,SEV=G_SEV_ABORT#,
       84    18019                      STCLASS=CONSTANT,ERR#=%E$MAXTIME);
       85    18065
       86    18066        %VLP_ERRCODE (FPTN=ENOEVENT,FCG=GH,MID=Q,MON='1'B,SEV=G_SEV_ABORT#,
       87    18067                      STCLASS=CONSTANT,ERR#=%E$NOEVENT);
       88    18113
       89    18114        %GH_LEV (FPTN=TRIG_CLK,TYPE=TRIGGER,STCLASS=STATIC);
       90    18136        %GH_LEV (FPTN=TRIG,STCLASS=AUTO);
       91    18158        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:4    
       92    18159
       93    18160    1   DCL GHH$LVL ENTRY ALTRET;
       94    18161    1   DCL GHH$LEV ENTRY(1);
       95    18162    1   DCL GHI$MAKE_TSA ENTRY(2);
       96    18163    1   DCL GHR$MON ENTRY;
       97    18164    1   DCL GHR$SRV ENTRY;
       98    18165    1   DCL GHR$USR ENTRY;
       99    18166    1   DCL GUE$ENVTCB ENTRY(1) ALTRET;
      100    18167    1   DCL GUS$RESTRTCLK ENTRY;
      101    18168    1   DCL GHS$XXDO ENTRY(3) ALTRET;
      102    18169    1   DCL GHS$EVENT ENTRY(7);
      103    18170    1   DCL GJS$ABORTM ENTRY(1);
      104    18171    1   DCL GJS$ABORTX ENTRY(1);
      105    18172    1   DCL GJU$GET_DB ENTRY ALTRET;
      106    18173
      107    18174    1   DCL G$JIT$ PTR SYMREF;
      108    18175    1   DCL G$ROS$ PTR SYMREF;
      109    18176    1   DCL G$LOW_MEM$ PTR SYMREF;
      110    18177    1   DCL G$MHJIT$ PTR SYMREF;
      111    18178    1   DCL G$UHJIT$ PTR SYMREF;
      112    18179    1   DCL G$TSA_USR$ PTR SYMREF READONLY;
      113    18180    1   DCL GH_HIR SBIN SYMREF;
      114    18181    1   DCL GH_QMIN UBIN SYMREF;
      115    18182    1   DCL GH_QUAN UBIN SYMREF;
      116    18183    1   DCL G_ASFGATE UBIN SYMREF;
      117    18184
      118    18185
      119    18186        %GATE (FPTN=TGATE,STCLASS=AUTO);
      120    18205    1   DCL RTIME SBIN(32);
      121    18206    1   DCL D$ PTR;
      122    18207    1   DCL DD$ PTR;
      123    18208    1   DCL CU$ PTR;
      124    18209    1   DCL ASFLAG BIT(16);
      125    18210    1   DCL I UBIN;
      126    18211    1   DCL TRAP# UBIN;
      127    18212    1   DCL ERROR BIT(32);
      128    18213        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:5    
      129    18214    1           IF G$UHJIT.ISA_USR.TSAP$~=ADDR(NIL) AND (G$UHJIT.DMN.ID~=%G_DMN_DB#
      130    18215    1             OR G$UHJIT.ISA_USR.TSAP$~=ADDR(G$UHJIT.TSA_USR))
      131    18216    1           THEN RETURN;
      132    18217
      133    18218    1           ENVTCB.ENVTYPE = %GUE_ENVTCB_ISA#; /* Environment in ISA              */
      134    18219    1           GOTO COMMN;
      135    18220
      136    18221    1   GHQ$MCLEND: ENTRY ALTRET;
      137    18222
      138    18223    1           ENVTCB.ENVTYPE = %GUE_ENVTCB_TSA#;
      139    18224
      140    18225
      141    18226    1   COMMN:  CALL GHH$LVL ALTRET(XIT);       /* Return if not at background level  */
      142    18227
      143    18228    1           CU$ = G$MHJIT.CU$;
      144    18229    1           IF (G$JIT.RNST|G$U.ASYNCH)
      145    18230    1             OR (G$U.DL$~=ADDR(NIL))
      146    18231    1             OR (G$JIT.TMRZ) THEN
      147    18232    2           DO;
      148    18233    2              IF G$JIT.RNST|G$U.ASYNCH THEN
      149    18234    2                 GOTO SE7;
      150    18235    2              IF G$U.DL$~=ADDR(NIL) THEN
      151    18236    2                 GOTO SE6;
      152    18237    2              IF G$JIT.TMRZ THEN
      153    18238    2                 CALL CHKTMRZ (0) ALTRET(SE6);
      154    18239    2              END;
      155    18240        /* Compute time remaining in quantum and check for quantum end  */
      156    18241    1   SE1A:   RTIME=G$JIT.IDELTAT-G$JIT.STIME-G$JIT.XTIME;
      157    18242    1           TGATE.FLG = '1'B;               /* Initialize gate                    */
      158    18243                %LOCK(G=TGATE);                 /* Inhibit                            */
      159    18250    1           IF RTIME <= 0 THEN
      160    18251    2           DO;
      161    18252    2              CALL GHR$MON;
      162    18253    2              G$JIT.SCHTIME = G$JIT.XTIME+G$JIT.STIME;
      163    18254    2              CALL ACCTEX;                 /* Give him a new quantum             */
      164    18255    2              G$U.PRIO=G$U.PRIOB;          /* at base priority                   */
      165    18256                   %UNLOCK(G=TGATE);
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:6    
      166    18263    2              ALTRETURN;                   /* Altreturn to block him             */
      167    18264    2              END;
      168    18265        /* If there is a higher priority user waiting, compute the
      169    18266           time since the current user was scheduled and if its greater
      170    18267           than QMIN, park the current user.                         */
      171    18268        /* If QMIN hasn't expired, set RTC to go off at QMIN.              */
      172    18269    1           IF GH_HIR > 0 THEN
      173    18270    2           DO;
      174    18271    2              RTIME=GH_QMIN-(G$JIT.IDELTAT-G$JIT.SCHTIME-RTIME);
      175    18272    2              IF RTIME <= 0 THEN
      176    18273    3              DO;
      177    18274    3                 GH_HIR=0;
      178    18275    3                 CALL GHR$MON;
      179    18276    3                 G$JIT.SCHTIME = G$JIT.XTIME+G$JIT.STIME;
      180    18277                      %UNLOCK(G=TGATE);
      181    18284    3                 ALTRETURN;                /* Altreturn to block user            */
      182    18285    3                 END;
      183    18286    2              END;
      184    18287        /* If there isn't a high priority user waiting set RTC to go off at QUAN*/
      185    18288    1           G$LOW_MEM.RTC_CURR = RTIME;
      186    18289                %UNLOCK(G=TGATE);               /* Unihibit                           */
      187    18296    1   XIT:    CALL GHR$USR;
      188    18297    1           RETURN;                         /* Normal return to continue          */
      189    18298        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:7    
      190    18299        /* Get Event entries from the Dolist      */
      191    18300
      192    18301        /*  Don't Event him if he is about to be Quantum Ended. */
      193    18302
      194    18303    1   SE6:    IF G$JIT.STIME+G$JIT.XTIME >= G$JIT.IDELTAT THEN
      195    18304    1              GOTO SE1A;
      196    18305    1           D$=G$U.DL$;
      197    18306        /* Look for non-busy Event entry on Dolist */
      198    18307    2           DO WHILE (D$ ~= ADDR(NIL));
      199    18308    2              IF G$DO.BUSY ~= '1'B THEN
      200    18309    2                 GOTO SE61;
      201    18310    2              D$=G$DO.LNK$;
      202    18311    2              END;
      203    18312    1           GOTO SE1A;
      204    18313
      205    18314    1   SE61:   ;
      206    18315    1           IF (ENVTCB.ENVTYPE = %GUE_ENVTCB_TSA#) AND
      207    18316    1             (G$UHJIT.ISA_USR.TSAP$ ~= ADDR(G$UHJIT.TSA_USR) )
      208    18317    1           THEN GOTO SE1A;
      209    18318
      210    18319
      211    18320    2           IF G$DO.ECCSC = %G_RTTMRSC# THEN DO;
      212    18321    2              IF G$JIT.CLUKRINT ~= 0 THEN
      213    18322    2                 CALL GUS$RESTRTCLK;
      214    18323    2              IF G$JIT.CLUKRLVL = 0 THEN
      215    18324    2                 GOTO SE62;
      216    18325    3              ELSE DO;
      217    18326    3                 TRIG=TRIG_CLK;
      218    18327    3                 TRIG.LEVEL=G$JIT.CLUKRLVL;
      219    18328    3                 CALL GHH$LEV (TRIG);
      220    18329    3                 END;
      221    18330    2              END;
      222    18331
      223    18332    2           ELSE DO;
      224    18333    2   SE62:      IF G$DO.ENTER ~= ENTADDR(NIL)
      225    18334    2              THEN CALL G$DO.ENTER (D$) ALTRET(SE91);
      226    18335
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:8    
      227    18336    2              IF G$DO.DMAIN = %GH_DBDMN#
      228    18337    3              THEN DO;
      229    18338    3                 G$U.ASYNCH = G$U.ASYNCH | %U_ALIBFD;
      230    18339    3                 G$JIT.JUNK.DB_TIMER = '1'B;
      231    18340    3                 CALL GHS$XXDO (0,D$);
      232    18341    3                 GH_HIR = 0;
      233    18342    3                 GOTO SE7;
      234    18343    3                 END;
      235    18344
      236    18345    2              IF G$ROS$->G$ROS.U_ECCB$->G$ECCB.EVENT$ = ENTADDR(NIL)
      237    18346    3              THEN DO;
      238    18347    3                 G$JIT.ERR = ENOEVENT;
      239    18348    3                 CALL GHS$XXDO (0,D$);
      240    18349    3                 GOTO SE92;
      241    18350    3                 END;
      242    18351        /*E* ERROR: GHQ-E$NOEVENT-E
      243    18352             MESSAGE: No active event procedure when event reported.
      244    18353        */
      245    18354
      246    18355    2              TRAP# = %G_FPRG_EVENT#;
      247    18356    2              CALL MAKE_TSA;
      248    18357    2              ENVTCB.ENV$ = ADDR(G$UHJIT.TSA_USR);
      249    18358
      250    18359    2              IF G$JIT.DB# = 0
      251    18360    2              THEN ENVTCB.P$$ = G$ROS$->G$ROS.U_ECCB$->G$ECCB.EVENT$;
      252    18361    2              ELSE ENVTCB.P$$ = G$TSA.P$$;
      253    18362
      254    18363    2              ENVTCB.TCB$ = ADDR(G$ROS.TCB);
      255    18364    2              ENVTCB.ECC = %G_EVENT#;
      256    18365    2              ENVTCB.ECINFO.SUBC = G$DO.ECCSC;
      257    18366    2              ENVTCB.ECINFO.EVID = G$DO.EVID;
      258    18367    2              ENVTCB.ECINFO.ERR = G$DO.ERRC;
      259    18368    2              ENVTCB.ECINFO.P# = G$DO.ECCSZ;
      260    18369    2              IF G$DO.ECCSZ > 0 THEN
      261    18370    2                 ENVTCB.MOREINFO$ = D$;
      262    18371    2              ELSE
      263    18372    2                 ENVTCB.MOREINFO$ = ADDR(NIL);
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:9    
      264    18373
      265    18374    2              CALL GUE$ENVTCB (ENVTCB) ALTRET(SE9);
      266    18375
      267    18376    2              END;
      268    18377
      269    18378    1           CALL GHS$XXDO (0,D$);
      270    18379    1           GH_HIR=0;
      271    18380    1           GOTO SE1A;
      272    18381        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:10   
      273    18382    1   SE91:   CALL GHS$XXDO (0,D$);           /* Don't give this to user            */
      274    18383    1           GOTO SE6;
      275    18384
      276    18385    1   SE9:    CALL GHS$XXDO (0,D$);           /* No room on his TCB                 */
      277    18386
      278    18387    1           G$JIT.ERR = TCBERR;
      279    18388        /*E* ERROR: GHQ-E$TCBFULL-E
      280    18389             MESSAGE: Can't give you event or break control - Your TCB is full.
      281    18390        */
      282    18391    1   SE92:   ;
      283    18392    1           G$TSA.I.TRAP# = 64 - %G_FPRG_XCON#;
      284    18393    1           G$JIT.RNST = (G$JIT.RNST | %G_RS_ABRT#);
      285    18394
      286    18395    1           GOTO SE1A;
      287    18396        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:11   
      288    18397        /* Process ASYNCH flags and run status from JIT  */
      289    18398    1   SE7:    ;
      290    18399                %LOCK (G = G_ASFGATE);
      291    18406    1           ASFLAG=G$U.ASYNCH;
      292    18407    1           G$U.ASYNCH = '0'B;
      293    18408                %UNLOCK (G = G_ASFGATE);
      294    18415    1           G$U.ASYNCH='0'B;                /* Clear flags                        */
      295    18416        /*    Check if Disconnection occured     */
      296    18417    1           IF ASFLAG & %U_DSC THEN
      297    18418    1              CALL ABORTEX(3);
      298    18419        /*    Check if Abort from interrupt level */
      299    18420    1           IF ASFLAG & %U_INTABRT THEN
      300    18421    1              CALL ABORTEX(4);
      301    18422        /* Check for some kind of operator abort */
      302    18423    1           IF ASFLAG & %U_ABRT THEN
      303    18424    1              CALL ABORTEX(0);
      304    18425        /* Check for some kind of operator error of this user */
      305    18426    1           IF ASFLAG & %U_ERR THEN
      306    18427    1              CALL ABORTEX(1);
      307    18428        /*    Check for limit exceeded  */
      308    18429    1           IF G$JIT.RNST & %G_RS_LIMX# THEN
      309    18430    1              CALL ABORTEX(2);
      310    18431
      311    18432    2           IF ASFLAG & %U_ALIBFD THEN DO;
      312    18433    2              IF G$UHJIT.DMN.ID = %G_DMN_USR_SVC#
      313    18434    2                OR G$UHJIT.DMN.ID = %G_DMN_USR#
      314    18435    3              THEN DO;
      315    18436
      316    18437                                                /* Associate the debugger             */
      317    18438
      318    18439    3                 ASFLAG = ASFLAG & ~%U_ALIBFD;
      319    18440    3                 IF ENVTCB.ENVTYPE = %GUE_ENVTCB_TSA# THEN
      320    18441    3                    CALL GJU$GET_DB;
      321    18442    4                 ELSE DO;
      322    18443    4                    G$UHJIT.ISA_USR.REGS.M1.J = '1'B;
      323    18444    4                    G$JIT.JUNK.ALIBFD = '1'B;
      324    18445    4                    END;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:12   
      325    18446    3                 END;
      326    18447                   %LOCK (G=G_ASFGATE);
      327    18454    2              G$U.ASYNCH =G$U.ASYNCH | ASFLAG;
      328    18455                   %UNLOCK (G=G_ASFGATE);
      329    18462    2              GOTO SE1A;
      330    18463    2              END;
      331    18464        /*    Check for YC or Break                                      */
      332    18465    1           IF ASFLAG & %U_YC THEN
      333    18466    1              ENVTCB.ECINFO.SUBC = %G_YCSC#;
      334    18467    1           ELSE
      335    18468    1              IF ASFLAG & %U_BRK THEN
      336    18469    1                 ENVTCB.ECINFO.SUBC = %G_BRKSC#;
      337    18470    1              ELSE
      338    18471    1                 GOTO SE1A;
      339    18472
      340    18473    1           IF G$ROS$->G$ROS.U_ECCB$->G$ECCB.INT$ = ENTADDR(NIL)
      341    18474    1           THEN GOTO SE1A;
      342    18475
      343    18476    1           TRAP# = %G_FPRG_BRK#;
      344    18477    1           CALL MAKE_TSA;
      345    18478    1           ENVTCB.ENV$ = ADDR(G$UHJIT.TSA_USR);
      346    18479
      347    18480    1           IF G$JIT.DB# = 0
      348    18481    1           THEN ENVTCB.P$$ = G$ROS$->G$ROS.U_ECCB$->G$ECCB.INT$;
      349    18482    1           ELSE ENVTCB.P$$ = G$TSA.P$$;
      350    18483
      351    18484    1           ENVTCB.TCB$ = ADDR(G$ROS.TCB);
      352    18485    1           ENVTCB.ECC = %G_BRK#;
      353    18486    1           ENVTCB.ECINFO.EVID = 0;
      354    18487    1           ENVTCB.ECINFO.ERR = G$JIT.ERR;
      355    18488    1           ENVTCB.ECINFO.P# = 0;
      356    18489    1           ENVTCB.MOREINFO$ = ADDR(NIL);
      357    18490    1           CALL GUE$ENVTCB (ENVTCB) ALTRET(SE9);
      358    18491
      359    18492    1           GH_HIR=0;
      360    18493    1           GOTO SE1A;
      361    18494        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:13   
      362    18495        /*                                                                    */
      363    18496        /*    SET JIT.RNST ACCORDING TO STATUS                                */
      364    18497        /*                                                                    */
      365    18498    1   ABORTEX: PROC(STATUS);
      366    18499    2   DCL   STATUS UBIN;
      367    18500    2   DCL 1 ERRORS_INIT CONSTANT,
      368    18501             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$XKEY,SEV=G_SEV_ABORT#,LAST=
             18501                 ",",LVL=2);
      369    18547             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$EKEY,SEV=G_SEV_ERROR#,LAST=
             18547                 ",",LVL=2);
      370    18593             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$LIMX,SEV=G_SEV_ERROR#,LAST=
             18593                 ",",LVL=2);
      371    18639             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$LDSC,SEV=G_SEV_ABORT#,LAST=
             18639                 ",",LVL=2);
      372    18685             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$INTABRT,SEV=G_SEV_ERROR#,LAST
             18685                 =";",LVL=2);
      373    18731    2   DCL 1 ERRORS(0:4) REDEF ERRORS_INIT BIT(32);
      374    18732    2   DCL    RNSTAT(0:4) CONSTANT BIT(16)
      375    18733    2                   INIT(%G_RS_XKEY#,
      376    18734    2                        %G_RS_EKEY#,
      377    18735    2                        %G_RS_LIMX#,
      378    18736    2                        %G_RS_DSC#,
      379    18737    2                        %G_RS_INTABRT#);
      380    18738        /*                                                                    */
      381    18739    2           G$JIT.RNST = (G$JIT.RNST | RNSTAT(STATUS) );
      382    18740    2           IF G$JIT.ERR.SEV = 0
      383    18741    2           THEN G$JIT.ERR = ERRORS(STATUS);
      384    18742
      385    18743    2           CALL GHR$SRV;
      386    18744
      387    18745    2           TRAP# = %G_FPRG_XCON#;
      388    18746    2           CALL MAKE_TSA;
      389    18747    2           RETURN;                         /* If XCON after step aborted         */
      390    18748    2   END;
      391    18749        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:14   
      392    18750        /*                                                              */
      393    18751        /*          Get a TSA frame to enter the trap handler           */
      394    18752        /*                                                              */
      395    18753    1   MAKE_TSA: PROC;
      396    18754    2   DCL A$ PTR;
      397    18755
      398    18756    2           IF ENVTCB.ENVTYPE ~= %GUE_ENVTCB_TSA#
      399    18757    3           THEN DO;
      400    18758    3              A$ = ADDR(NIL);
      401    18759    3              CALL GHI$MAKE_TSA(TRAP#,A$);
      402    18760    3              G$TSA.ISA.REGS = G$UHJIT.ISA_USR.REGS;
      403    18761    3              ENVTCB.ENVTYPE = %GUE_ENVTCB_TSA#;
      404    18762    3              END;
      405    18763
      406    18764    2           ELSE G$TSA.I.TRAP# = TRAP#;
      407    18765
      408    18766    2   END MAKE_TSA;
      409    18767        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:15   
      410    18768        /*                QUANTUM END ACCOUNTING PROCEDURE                    */
      411    18769        /*                                                                    */
      412    18770    1   ACCTEX: PROC;
      413    18771    2   DCL   CT UBIN(32);
      414    18772    2   DCL X SBIN;
      415    18773
      416    18774        /* Give him a fresh quantum                                        */
      417    18775    2           G$JIT.IDELTAT=GH_QUAN;
      418    18776        /* If CP or DELTA running, don't tick UTIMER                       */
      419    18777    2           IF NOT G$U.FLG.CPIC AND NOT G$U.FLG.DIC THEN
      420    18778    2              CALL CHKTMRZ (1);
      421    18779
      422    18780        /* Compute Memory Time Product in Tics                              */
      423    18781    2           CT=G$JIT.XTIME+G$JIT.STIME * G$U.PCT;
      424    18782    3           DO;
      425    18783    3              G$JIT.TUEXT=G$JIT.TUEXT+G$JIT.XTIME;
      426    18784    3              G$JIT.TUSVT=G$JIT.TUSVT+G$JIT.STIME;
      427    18785    3              G$JIT.UMEMTIM=G$JIT.UMEMTIM+CT;
      428    18786    3              END;
      429    18787    2           X = /*N* G$MHJIT.PNO*4 + */ G$JIT.MODE-1;
      430    18788    2           PS_LCP6STT.UXEQTIME(X)=PS_LCP6STT.UXEQTIME(X)+G$JIT.XTIME;
      431    18789    2           PS_LCP6STT.USRVTIME(X)=PS_LCP6STT.USRVTIME(X)+G$JIT.STIME;
      432    18790    2           IF G$JIT.MRT > 0 THEN
      433    18791    2              G$JIT.MRT = G$JIT.MRT-G$JIT.XTIME-G$JIT.STIME;
      434    18792    2           G$JIT.STIME=0;
      435    18793    2           G$JIT.XTIME=0;
      436    18794    2           IF G$JIT.MRT <= 0 THEN
      437    18795    3           DO;
      438    18796    3              G$JIT.MRT=0;
      439    18797    3              G$JIT.RNST = (G$JIT.RNST | %G_RS_LIMX#);
      440    18798    3              G$JIT.XLIMFLG.TIME = '1'B;
      441    18799    3              G$JIT.ERR = EMAXTIME;
      442    18800    3              END;
      443    18801    2           RETURN;
      444    18802    2   END;
      445    18803
      446    18804
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:16   
      447    18805        /*    Check if UTIMER has run out and event him if so.             */
      448    18806
      449    18807    1   CHKTMRZ: PROC (DECR) ALTRET;
      450    18808
      451    18809    2   DCL T UBIN;
      452    18810    2   DCL DECR UBIN;
      453    18811    2   DCL RTIME UBIN(32);
      454    18812
      455    18813    2           RTIME=G$JIT.XTIME+G$JIT.STIME;
      456    18814    2           T=0;
      457    18815    3           DO I = 0 TO 2;
      458    18816    3              IF G$JIT.TIMERS(I) ~= 0 THEN
      459    18817    4                 IF RTIME >= G$JIT.TIMERS(I) THEN DO;
      460    18818    4                    T=T+1;
      461    18819    5                    IF I = 0 THEN DO;
      462    18820    5                       IF G$JIT.CLUKXINT ~= 0 THEN
      463    18821    5                          G$JIT.TMRZ.UTIMER = RTIME + G$JIT.CLUKXINT;
      464    18822    5                       ELSE
      465    18823    5                          G$JIT.TMRZ.UTIMER = 0;
      466    18824    6                       IF G$JIT.CLUKXLVL ~= 0 THEN DO;
      467    18825    6                          TRIG=TRIG_CLK;
      468    18826    6                          TRIG.LEVEL=G$JIT.CLUKXLVL;
      469    18827    6                          CALL GHH$LEV (TRIG);
      470    18828    6                          END;
      471    18829    5                       ELSE
      472    18830    5                          GOTO CHKTMR1;
      473    18831    5                       END;
      474    18832    5                    ELSE DO;
      475    18833    5                       G$JIT.TIMERS(I)=0;
      476    18834    5   CHKTMR1:            CALL GHS$EVENT(G$MHJIT.CUN,I,%G_XTMRSC#,0,,0);
      477    18835    5                       END;
      478    18836    4                    END;
      479    18837    3                 ELSE
      480    18838    4                    IF DECR ~= 0 THEN DO;
      481    18839    4                       G$JIT.TIMERS(I)=G$JIT.TIMERS(I)-RTIME;
      482    18840    4                       IF G$JIT.TIMERS(I) < G$JIT.IDELTAT THEN
      483    18841    4                          G$JIT.IDELTAT = G$JIT.TIMERS(I);
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:17   
      484    18842    4                       END;
      485    18843    3              END;
      486    18844    2           IF T ~= 0 THEN
      487    18845    2              ALTRETURN;
      488    18846    2           RETURN;
      489    18847    2   END;
      490    18848
      491    18849
      492    18850
      493    18851    1   END;
      494    18852        %EOD;

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:18   
--  Include file information  --

   P_FEP_M.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   GH_HARDWARE_M.:E05TOU  is referenced.
   GU_MACROS_M.:E05TOU  is referenced.
   GH_GATE_M.:E05TOU  cannot be made into a system file and is referenced.
   GM_VIRTUAL_E.:E05TOU  is referenced.
   G_ROS_M.:E05TOU  is referenced.
   G_HJIT_M.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   GH_SCHD_E.:E05TOU  is referenced.
   GH_SCHD_M.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure GHQ$QEND.

   Procedure GHQ$QEND requires 1358 words for executable code.
   Procedure GHQ$QEND requires 62 words of local(AUTO) storage.

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:19   

 Object Unit name= GHQ$QEND                                   File name= GHQ$QEND.:E05TOU
 UTS= JUL 29 '97 21:35:17.32 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     21     15  GHQ$QEND
    1   Data  even  none     1      1  GHQ$QEND
    2   Proc  even  none  1358    54E  GHQ$QEND
    3  RoData even  none     5      5  GHQ$QEND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        0  GHQ$QEND
     2     23          yes     yes      Std        0  GHQ$MCLEND
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:20   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 GHH$LVL
 yes     yes           Std       1 GHH$UNLOCK
         yes           Std       0 GHR$USR
         yes           Std       0 GUS$RESTRTCLK
         yes           Std       1 GHH$LEV
 yes     yes           Std       3 GHS$XXDO
 yes     yes           Std       1 GHH$LOCK
 yes     yes           Std       1 GUE$ENVTCB
 yes     yes           Std       0 GJU$GET_DB
         yes           Std       0 GHR$MON
         yes           Std       0 GHR$SRV
         yes           Std       2 GHI$MAKE_TSA
         yes           Std       7 GHS$EVENT
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT
                       nStd      0 X6D_MID

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     PS_LCP6STT                            G$JIT$                                G$ROS$
     G$LOW_MEM$                            G$MHJIT$                              G$UHJIT$
r    G$TSA_USR$                            GH_HIR                                GH_QMIN
     GH_QUAN                               G_ASFGATE                        r    G$ROS$
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:21   


        1        1        /*M* Quantum end and asynchronous event processing  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*  */
        8        8        /*P* NAME: GHQ$QEND
        9        9             PURPOSE: To check if the current user has reached the end
       10       10                      of an execution quantum or has any outstanding
       11       11                      asynchronous events and to do the appropriate
       12       12                      processing if he has.                               */
       13       13        /*D* NAME: GHQ$QEND
       14       14             CALL: CALL GHQ$QEND ALTRET;
       15       15
       16       16             DESCRIPTION:  This routine is called following a RTC interrupt
       17       17                   or after rescheduling a user that was previously quantum
       18       18                   quantum ended.  The various asynchronous event indicators
       19       19                   in the users context are tested to determine if
       20       20                   the user should be returned to in other than the normal
       21       21                   manner.  If so, the users current environment is moved to
       22       22                   the TCB and then modified to return control to the appropriate
       23       23                   asynchronous entry point.  After this process, quantum end
       24       24                   tests are made to determine if the user has reached the end
       25       25                   of an execution quantum or if he has had a minimum amount
       26       26                   of guaranteed execution time since last being scheduled and
       27       27                   there is another, higher priority user waiting to execute.
       28       28                   If so, the ALTRET is taken to block the user and reschedule
       29       29                   another.
       30       30                                                                           */
       31       31        /*D* NAME: GHQ$MCLEND
       32       32             CALL: CALL GHQ$MCLEND ALTRET;
       33       33
       34       34             DESCRIPTION:  This routine is called following an MCL service
       35       35                   with the environment to be returned to in the users TSA.
       36       36                   This entry provides a convenient means of identifying the
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:22   
       37       37                   TSA environment while providing the same facililities
       38       38                   described above for GHQ$QEND.
       39       39                                                                           */
       40       40
       41       41        GHQ$QEND: PROC ALTRET;

     41   2 000000  D380 0000 0000  xent GHQ$QEND        LNJ,B5   X6A_AUTO_0
          2 000003       003E 0000                       DC       62,0

       42       42
       43       43
       44       44
       45       45        %INCLUDE B_ERRORS_C;
       46     1172        %INCLUDE GH_SCHD_M;
       47     1316        %INCLUDE GH_SCHD_E;
       48     1412        %INCLUDE G_JIT_M;
       49     1677        %INCLUDE G_HJIT_M;
       50     1822 S      %INCLUDE G_LCP6_E;
       51     1823        %INCLUDE G_ROS_M;
       52     1905        %INCLUDE GM_VIRTUAL_E;
       53     2115 S      %INCLUDE GH_LCP6_M;
       54     2116        %INCLUDE GH_GATE_M;
       55     2157 S      %INCLUDE GU_LCP6_M;
       56     2158        %INCLUDE GU_MACROS_M;
       57     2317        %INCLUDE GH_HARDWARE_M;
       58     2415        %INCLUDE KL_MACRO_C;
       59     5767        %INCLUDE KL_AFCN_C;
       60     5868        %INCLUDE K_ID_E;
       61     5918        %INCLUDE P_FEP_M;
       62     6356
       63     6357        %G$MHJIT (STCLASS="BASED(G$MHJIT$)");
       64    13231        %G$UHJIT (STCLASS="BASED(G$UHJIT$)");
       65    16205        %G$TSA (STCLASS="BASED(G$TSA_USR$)");
       66    16593        %G$USER (STCLASS="BASED(CU$)");
       67    16604        %G$JIT (FPTN=G$JIT,STCLASS="BASED(G$JIT$)");
       68    17018        %G$DO (STCLASS="BASED(D$)");
       69    17081        %G$ROS (STCLASS="BASED(G$ROS$)");
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:23   
       70    17125        %G$ECCB;
       71    17201        %G$LOW_MEM (STCLASS="BASED(G$LOW_MEM$)");
       72    17250        %GUE_ENVTCB_PARAMS (FPTN=ENVTCB);
       73    17375        %K#ENTID_E;
       74    17394        %K#LYRID_E;
       75    17401
       76    17402        %G$JIT_E;
       77    17464
       78    17465        %PS_LCP6STT (STCLASS=SYMREF);
       79    17969
       80    17970        %VLP_ERRCODE (FPTN=TCBERR,FCG=GH,MID=Q,MON='1'B,SEV=G_SEV_ABORT#,
       81    17971                      STCLASS=CONSTANT,ERR#=%E$TCBFULL);
       82    18017
       83    18018        %VLP_ERRCODE (FPTN=EMAXTIME,FCG=GH,MID=Q,MON='1'B,SEV=G_SEV_ABORT#,
       84    18019                      STCLASS=CONSTANT,ERR#=%E$MAXTIME);
       85    18065
       86    18066        %VLP_ERRCODE (FPTN=ENOEVENT,FCG=GH,MID=Q,MON='1'B,SEV=G_SEV_ABORT#,
       87    18067                      STCLASS=CONSTANT,ERR#=%E$NOEVENT);
       88    18113
       89    18114        %GH_LEV (FPTN=TRIG_CLK,TYPE=TRIGGER,STCLASS=STATIC);
       90    18136        %GH_LEV (FPTN=TRIG,STCLASS=AUTO);
       91    18158        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:24   
       92    18159
       93    18160    1   DCL GHH$LVL ENTRY ALTRET;
       94    18161    1   DCL GHH$LEV ENTRY(1);
       95    18162    1   DCL GHI$MAKE_TSA ENTRY(2);
       96    18163    1   DCL GHR$MON ENTRY;
       97    18164    1   DCL GHR$SRV ENTRY;
       98    18165    1   DCL GHR$USR ENTRY;
       99    18166    1   DCL GUE$ENVTCB ENTRY(1) ALTRET;
      100    18167    1   DCL GUS$RESTRTCLK ENTRY;
      101    18168    1   DCL GHS$XXDO ENTRY(3) ALTRET;
      102    18169    1   DCL GHS$EVENT ENTRY(7);
      103    18170    1   DCL GJS$ABORTM ENTRY(1);
      104    18171    1   DCL GJS$ABORTX ENTRY(1);
      105    18172    1   DCL GJU$GET_DB ENTRY ALTRET;
      106    18173
      107    18174    1   DCL G$JIT$ PTR SYMREF;
      108    18175    1   DCL G$ROS$ PTR SYMREF;
      109    18176    1   DCL G$LOW_MEM$ PTR SYMREF;
      110    18177    1   DCL G$MHJIT$ PTR SYMREF;
      111    18178    1   DCL G$UHJIT$ PTR SYMREF;
      112    18179    1   DCL G$TSA_USR$ PTR SYMREF READONLY;
      113    18180    1   DCL GH_HIR SBIN SYMREF;
      114    18181    1   DCL GH_QMIN UBIN SYMREF;
      115    18182    1   DCL GH_QUAN UBIN SYMREF;
      116    18183    1   DCL G_ASFGATE UBIN SYMREF;
      117    18184
      118    18185
      119    18186        %GATE (FPTN=TGATE,STCLASS=AUTO);
      120    18205    1   DCL RTIME SBIN(32);
      121    18206    1   DCL D$ PTR;
      122    18207    1   DCL DD$ PTR;
      123    18208    1   DCL CU$ PTR;
      124    18209    1   DCL ASFLAG BIT(16);
      125    18210    1   DCL I UBIN;
      126    18211    1   DCL TRAP# UBIN;
      127    18212    1   DCL ERROR BIT(32);
      128    18213        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:25   
      129    18214    1           IF G$UHJIT.ISA_USR.TSAP$~=ADDR(NIL) AND (G$UHJIT.DMN.ID~=%G_DMN_DB#

  18214   2 000005  EC80 0000 0000  xsym                 LDB,B6   G$UHJIT$
          2 000008  8DC6 007F                            CMN      127,B6
          2 00000A  0901 0013                            BE       s:18218,PREL
          2 00000C  E846 007E                            LDR,R6   126,B6
          2 00000E  6D05                                 CMV,R6   5
          2 00000F  0981 000B                            BNE      s:18216,PREL
          2 000011  DCC6 007F                            LDB,B5   127,B6
          2 000013  CBC6 00B6                            LAB,B4   182,B6
          2 000015  CFC7 0032                            STB,B4   RTIME+3,AUTO
          2 000017  DDC7 0032                            CMB,B5   RTIME+3,AUTO
          2 000019  0901 0004                            BE       s:18218,PREL

      130    18215    1             OR G$UHJIT.ISA_USR.TSAP$~=ADDR(G$UHJIT.TSA_USR))
      131    18216    1           THEN RETURN;

  18216   2 00001B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      132    18217
      133    18218    1           ENVTCB.ENVTYPE = %GUE_ENVTCB_ISA#; /* Environment in ISA              */

  18218   2 00001E  6C01                                 LDV,R6   1
          2 00001F  EF47 000E                            STR,R6   ENVTCB+10,AUTO

      134    18219    1           GOTO COMMN;

  18219   2 000021  0F81 0008                            B        s:18226,PREL

      135    18220
      136    18221    1   GHQ$MCLEND: ENTRY ALTRET;

  18221   2 000023  D380 0000 0000  xent GHQ$MCLEND      LNJ,B5   X6A_AUTO_0
          2 000026       003E 0000                       DC       62,0

      137    18222
      138    18223    1           ENVTCB.ENVTYPE = %GUE_ENVTCB_TSA#;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:26   

  18223   2 000028  8747 000E                            CL       ENVTCB+10,AUTO

      139    18224
      140    18225
      141    18226    1   COMMN:  CALL GHH$LVL ALTRET(XIT);       /* Return if not at background level  */

  18226   2 00002A  CBF0 0000            COMMN           LAB,B4   0,IMO
          2 00002C  E380 0000 0000  xent                 LNJ,B6   GHH$LVL
          2 00002F       00DD                            DC       s:18296,PREL

      142    18227
      143    18228    1           CU$ = G$MHJIT.CU$;

  18228   2 000030  EC80 0000 0000  xsym                 LDB,B6   G$MHJIT$
          2 000033  DCC6 0352                            LDB,B5   850,B6
          2 000035  DFC7 001D                            STB,B5   CU$,AUTO

      144    18229    1           IF (G$JIT.RNST|G$U.ASYNCH)

  18229   2 000037  CC80 0000 0000  xsym                 LDB,B4   G$JIT$
          2 00003A  E844 0096                            LDR,R6   150,B4
          2 00003C  E445 0001                            OR,R6    1,B5
          2 00003E  6981 0010                            BNEZ,R6  s:18233,PREL
          2 000040  8DC5 000D                            CMN      13,B5
          2 000042  0981 000C                            BNE      s:18233,PREL
          2 000044  BB80 0000 0000  03                   LAB,B3   0
          2 000047  5C01                                 LDV,R5   1
          2 000048  0022                                 ACM      ;
          2 000049       4C04 00A8                                ALPHANUM(168,B4,,12,FILL),;
          2 00004B       4003 0000                                ALPHANUM(0,B3,,R5,FILL)
          2 00004D  5381 001D                            CBE      s:18239,PREL

      145    18230    1             OR (G$U.DL$~=ADDR(NIL))
      146    18231    1             OR (G$JIT.TMRZ) THEN
      147    18232    2           DO;

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:27   
      148    18233    2              IF G$JIT.RNST|G$U.ASYNCH THEN

  18233   2 00004F  E844 0096                            LDR,R6   150,B4
          2 000051  E445 0001                            OR,R6    1,B5
          2 000053  6981 0236                            BNEZ,R6  s:18393,PREL

      149    18234    2                 GOTO SE7;
      150    18235    2              IF G$U.DL$~=ADDR(NIL) THEN

  18235   2 000055  8DC5 000D                            CMN      13,B5
          2 000057  0981 00BD                            BNE      s:18303,PREL

      151    18236    2                 GOTO SE6;
      152    18237    2              IF G$JIT.TMRZ THEN

  18237   2 000059  BB80 0000 0000  03                   LAB,B3   0
          2 00005C  5C01                                 LDV,R5   1
          2 00005D  0022                                 ACM      ;
          2 00005E       4C04 00A8                                ALPHANUM(168,B4,,12,FILL),;
          2 000060       4003 0000                                ALPHANUM(0,B3,,R5,FILL)
          2 000062  5381 0008                            CBE      s:18239,PREL

      153    18238    2                 CALL CHKTMRZ (0) ALTRET(SE6);

  18238   2 000064  BBF0 0000                            LAB,B3   0,IMO
          2 000066  BFC7 002C                            STB,B3   A$+2,AUTO
          2 000068  E3C0 042D                            LNJ,B6   s:0,PREL
          2 00006A       00AB                            DC       s:18303,PREL

      154    18239    2              END;

      155    18240        /* Compute time remaining in quantum and check for quantum end  */
      156    18241    1   SE1A:   RTIME=G$JIT.IDELTAT-G$JIT.STIME-G$JIT.XTIME;

  18241   2 00006B  EC80 0000 0000  xsym SE1A            LDB,B6   G$JIT$
          2 00006E  8CC6 006E                            LDI      110,B6
          2 000070  84C6 006C                            SID      108,B6
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:28   
          2 000072  84C6 006A                            SID      106,B6
          2 000074  8D47 0017                            SDI      RTIME,AUTO

      157    18242    1           TGATE.FLG = '1'B;               /* Initialize gate                    */

  18242   2 000076  8947 0014                            LBT,'8000'X       TGATE,AUTO
  18242   2 000078       8000

      158    18243                %LOCK(G=TGATE);                 /* Inhibit                            */

  18248   2 000079  DBC7 0014                            LAB,B5   TGATE,AUTO
          2 00007B  DFC7 0032                            STB,B5   RTIME+3,AUTO
          2 00007D  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 00007F  CBF0 0100                            LAB,B4   256,IMO
          2 000081  E380 0000 0000  xent                 LNJ,B6   GHH$LOCK
          2 000084       0001                            DC       s:18250,PREL

      159    18250    1           IF RTIME <= 0 THEN

  18250   2 000085  8CC7 0017                            LDI      RTIME,AUTO
          2 000087  84F0 0000 0000                       SID      0,IMO
          2 00008A  6A01 002C                            BGZ,R6   s:18269,PREL
          2 00008C  6801 0003                            BLZ,R6   s:18252,PREL
          2 00008E  7981 0028                            BNEZ,R7  s:18269,PREL

      160    18251    2           DO;

      161    18252    2              CALL GHR$MON;

  18252   2 000090  CBF0 0000                            LAB,B4   0,IMO
          2 000092  E380 0000 0000  xent                 LNJ,B6   GHR$MON
          2 000095       0001                            DC       s:18253,PREL

      162    18253    2              G$JIT.SCHTIME = G$JIT.XTIME+G$JIT.STIME;

  18253   2 000096  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 000099  8CC6 006A                            LDI      106,B6
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:29   
          2 00009B  8446 006C                            AID      108,B6
          2 00009D  8D46 0072                            SDI      114,B6

      163    18254    2              CALL ACCTEX;                 /* Give him a new quantum             */

  18254   2 00009F  E3C0 0363                            LNJ,B6   s:0,PREL
          2 0000A1       0001                            DC       s:18255,PREL

      164    18255    2              G$U.PRIO=G$U.PRIOB;          /* at base priority                   */

  18255   2 0000A2  ECC7 001D                            LDB,B6   CU$,AUTO
          2 0000A4  E846 0010                            LDR,R6   16,B6
          2 0000A6  EF46 000F                            STR,R6   15,B6

      165    18256                   %UNLOCK(G=TGATE);

  18261   2 0000A8  DBC7 0014                            LAB,B5   TGATE,AUTO
          2 0000AA  DFC7 0032                            STB,B5   RTIME+3,AUTO
          2 0000AC  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 0000AE  CBF0 0100                            LAB,B4   256,IMO
          2 0000B0  E380 0000 0000  xent                 LNJ,B6   GHH$UNLOCK
          2 0000B3       0001                            DC       s:18263,PREL

      166    18263    2              ALTRETURN;                   /* Altreturn to block him             */

  18263   2 0000B4  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      167    18264    2              END;
      168    18265        /* If there is a higher priority user waiting, compute the
      169    18266           time since the current user was scheduled and if its greater
      170    18267           than QMIN, park the current user.                         */
      171    18268        /* If QMIN hasn't expired, set RTC to go off at QMIN.              */
      172    18269    1           IF GH_HIR > 0 THEN

  18269   2 0000B7  E800 0000 0000  xsym                 LDR,R6   GH_HIR
          2 0000BA  6A81 003E                            BLEZ,R6  s:18288,PREL

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:30   
      173    18270    2           DO;

      174    18271    2              RTIME=GH_QMIN-(G$JIT.IDELTAT-G$JIT.SCHTIME-RTIME);

  18271   2 0000BC  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 0000BF  8CC6 006E                            LDI      110,B6
          2 0000C1  84C6 0072                            SID      114,B6
          2 0000C3  84C7 0017                            SID      RTIME,AUTO
          2 0000C5  8D47 0032                            SDI      RTIME+3,AUTO
          2 0000C7  F800 0000 0000  xsym                 LDR,R7   GH_QMIN
          2 0000CA  6C00                                 LDV,R6   0
          2 0000CB  84C7 0032                            SID      RTIME+3,AUTO
          2 0000CD  8D47 0017                            SDI      RTIME,AUTO

      175    18272    2              IF RTIME <= 0 THEN

  18272   2 0000CF  84F0 0000 0000                       SID      0,IMO
          2 0000D2  6A01 0026                            BGZ,R6   s:18288,PREL
          2 0000D4  6801 0003                            BLZ,R6   s:18274,PREL
          2 0000D6  7981 0022                            BNEZ,R7  s:18288,PREL

      176    18273    3              DO;

      177    18274    3                 GH_HIR=0;

  18274   2 0000D8  8700 0000 0000  xsym                 CL       GH_HIR

      178    18275    3                 CALL GHR$MON;

  18275   2 0000DB  CBF0 0000                            LAB,B4   0,IMO
          2 0000DD  E380 0000 0000  xent                 LNJ,B6   GHR$MON
          2 0000E0       0001                            DC       s:18276,PREL

      179    18276    3                 G$JIT.SCHTIME = G$JIT.XTIME+G$JIT.STIME;

  18276   2 0000E1  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 0000E4  8CC6 006A                            LDI      106,B6
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:31   
          2 0000E6  8446 006C                            AID      108,B6
          2 0000E8  8D46 0072                            SDI      114,B6

      180    18277                      %UNLOCK(G=TGATE);

  18282   2 0000EA  DBC7 0014                            LAB,B5   TGATE,AUTO
          2 0000EC  DFC7 0032                            STB,B5   RTIME+3,AUTO
          2 0000EE  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 0000F0  CBF0 0100                            LAB,B4   256,IMO
          2 0000F2  E380 0000 0000  xent                 LNJ,B6   GHH$UNLOCK
          2 0000F5       0001                            DC       s:18284,PREL

      181    18284    3                 ALTRETURN;                /* Altreturn to block user            */

  18284   2 0000F6  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      182    18285    3                 END;
      183    18286    2              END;
      184    18287        /* If there isn't a high priority user waiting set RTC to go off at QUAN*/
      185    18288    1           G$LOW_MEM.RTC_CURR = RTIME;

  18288   2 0000F9  EC80 0000 0000  xsym                 LDB,B6   G$LOW_MEM$
          2 0000FC  E847 0018                            LDR,R6   RTIME+1,AUTO
          2 0000FE  EF46 0015                            STR,R6   21,B6

      186    18289                %UNLOCK(G=TGATE);               /* Unihibit                           */

  18294   2 000100  DBC7 0014                            LAB,B5   TGATE,AUTO
          2 000102  DFC7 0032                            STB,B5   RTIME+3,AUTO
          2 000104  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 000106  CBF0 0100                            LAB,B4   256,IMO
          2 000108  E380 0000 0000  xent                 LNJ,B6   GHH$UNLOCK
          2 00010B       0001                            DC       s:18296,PREL

      187    18296    1   XIT:    CALL GHR$USR;

  18296   2 00010C  CBF0 0000            XIT             LAB,B4   0,IMO
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:32   
          2 00010E  E380 0000 0000  xent                 LNJ,B6   GHR$USR
          2 000111       0001                            DC       s:18297,PREL

      188    18297    1           RETURN;                         /* Normal return to continue          */

  18297   2 000112  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      189    18298        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:33   
      190    18299        /* Get Event entries from the Dolist      */
      191    18300
      192    18301        /*  Don't Event him if he is about to be Quantum Ended. */
      193    18302
      194    18303    1   SE6:    IF G$JIT.STIME+G$JIT.XTIME >= G$JIT.IDELTAT THEN

  18303   2 000115  EC80 0000 0000  xsym SE6             LDB,B6   G$JIT$
          2 000118  8CC6 006C                            LDI      108,B6
          2 00011A  8446 006A                            AID      106,B6
          2 00011C  84C6 006E                            SID      110,B6
          2 00011E  0601 FF4C                            BCT      s:18239,PREL

      195    18304    1              GOTO SE1A;
      196    18305    1           D$=G$U.DL$;

  18305   2 000120  DCC7 001D                            LDB,B5   CU$,AUTO
          2 000122  CCC5 000D                            LDB,B4   13,B5
          2 000124  CFC7 0019                            STB,B4   D$,AUTO

      197    18306        /* Look for non-busy Event entry on Dolist */
      198    18307    2           DO WHILE (D$ ~= ADDR(NIL));

  18307   2 000126  0F81 000A                            B        s:18311,PREL

      199    18308    2              IF G$DO.BUSY ~= '1'B THEN

  18308   2 000128  ECC7 0019                            LDB,B6   D$,AUTO
          2 00012A  89C6 0002                            CMZ      2,B6
          2 00012C  0881 0009                            BAGE     s:18307,PREL

      200    18309    2                 GOTO SE61;
      201    18310    2              D$=G$DO.LNK$;

  18310   2 00012E  DC86                                 LDB,B5   ,B6
          2 00012F  DFC7 0019                            STB,B5   D$,AUTO

      202    18311    2              END;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:34   

  18311   2 000131  8DC7 0019                            CMN      D$,AUTO
          2 000133  09F5                                 BNE      s:18308,SPREL

      203    18312    1           GOTO SE1A;

  18312   2 000134  0F81 FF36                            B        s:18239,PREL

  18307   2                              SE61            null
      204    18313
      205    18314    1   SE61:   ;
      206    18315    1           IF (ENVTCB.ENVTYPE = %GUE_ENVTCB_TSA#) AND

  18315   2 000136  E847 000E            SE61            LDR,R6   ENVTCB+10,AUTO
          2 000138  6981 000E                            BNEZ,R6  s:18320,PREL
          2 00013A  DC80 0000 0000  xsym                 LDB,B5   G$UHJIT$
          2 00013D  CCC5 007F                            LDB,B4   127,B5
          2 00013F  BBC5 00B6                            LAB,B3   182,B5
          2 000141  BFC7 0032                            STB,B3   RTIME+3,AUTO
          2 000143  CDC7 0032                            CMB,B4   RTIME+3,AUTO
          2 000145  0981 FF25                            BNE      s:18239,PREL

      207    18316    1             (G$UHJIT.ISA_USR.TSAP$ ~= ADDR(G$UHJIT.TSA_USR) )
      208    18317    1           THEN GOTO SE1A;
      209    18318
      210    18319
      211    18320    2           IF G$DO.ECCSC = %G_RTTMRSC# THEN DO;

  18320   2 000147  D2C6 0005                            LLH,R5   5,B6
          2 000149  5D01                                 CMV,R5   1
          2 00014A  0981 0030                            BNE      s:18332,PREL

      212    18321    2              IF G$JIT.CLUKRINT ~= 0 THEN

  18321   2 00014C  DC80 0000 0000  xsym                 LDB,B5   G$JIT$
          2 00014F  8CC5 0075                            LDI      117,B5
          2 000151  84F0 0000 0000                       SID      0,IMO
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:35   
          2 000154  6981 0003                            BNEZ,R6  s:18322,PREL
          2 000156  7901 0007                            BEZ,R7   s:18323,PREL

      213    18322    2                 CALL GUS$RESTRTCLK;

  18322   2 000158  CBF0 0000                            LAB,B4   0,IMO
          2 00015A  E380 0000 0000  xent                 LNJ,B6   GUS$RESTRTCLK
          2 00015D       0001                            DC       s:18323,PREL

      214    18323    2              IF G$JIT.CLUKRLVL = 0 THEN

  18323   2 00015E  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 000161  E2C6 0074                            LLH,R6   116,B6
          2 000163  6901 0017                            BEZ,R6   s:18332,PREL

      215    18324    2                 GOTO SE62;
      216    18325    3              ELSE DO;

      217    18326    3                 TRIG=TRIG_CLK;

  18326   2 000165  D800 0000 0000  01                   LDR,R5   TRIG_CLK
          2 000168  DF47 0013                            STR,R5   TRIG,AUTO

      218    18327    3                 TRIG.LEVEL=G$JIT.CLUKRLVL;

  18327   2 00016A  EAC7 0013                            SRM,R6,'003F'X    TRIG,AUTO
  18327   2 00016C       003F

      219    18328    3                 CALL GHH$LEV (TRIG);

  18328   2 00016D  DBC7 0013                            LAB,B5   TRIG,AUTO
          2 00016F  DFC7 0032                            STB,B5   RTIME+3,AUTO
          2 000171  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 000173  CBF0 0100                            LAB,B4   256,IMO
          2 000175  E380 0000 0000  xent                 LNJ,B6   GHH$LEV
          2 000178       0001                            DC       s:18330,PREL

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:36   
      220    18329    3                 END;

      221    18330    2              END;

  18330   2 000179  0F81 00C0                            B        s:18378,PREL

      222    18331
      223    18332    2           ELSE DO;

      224    18333    2   SE62:      IF G$DO.ENTER ~= ENTADDR(NIL)

  18333   2 00017B  ECC7 0019            SE62            LDB,B6   D$,AUTO
          2 00017D  DCC6 0003                            LDB,B5   3,B6
          2 00017F  DD80 0000 0001  03                   CMB,B5   +1
          2 000182  0901 000D                            BE       s:18336,PREL

      225    18334    2              THEN CALL G$DO.ENTER (D$) ALTRET(SE91);

  18334   2 000184  CBC7 0019                            LAB,B4   D$,AUTO
          2 000186  CFC7 0032                            STB,B4   RTIME+3,AUTO
          2 000188  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 00018A  9CC6 0003                            LDB,B1   3,B6
          2 00018C  CBF0 0100                            LAB,B4   256,IMO
          2 00018E  E381                                 LNJ,B6   ,B1
          2 00018F       00C0                            DC       s:18382,PREL

      226    18335
      227    18336    2              IF G$DO.DMAIN = %GH_DBDMN#

  18336   2 000190  ECC7 0019                            LDB,B6   D$,AUTO
          2 000192  E846 0002                            LDR,R6   2,B6
          2 000194  E570 00FF                            AND,R6   255,IMO
          2 000196  6D02                                 CMV,R6   2
          2 000197  0981 0024                            BNE      s:18345,PREL

      228    18337    3              THEN DO;

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:37   
      229    18338    3                 G$U.ASYNCH = G$U.ASYNCH | %U_ALIBFD;

  18338   2 000199  DCC7 001D                            LDB,B5   CU$,AUTO
          2 00019B  D845 0001                            LDR,R5   1,B5
          2 00019D  D470 0800                            OR,R5    2048,IMO
          2 00019F  DF45 0001                            STR,R5   1,B5

      230    18339    3                 G$JIT.JUNK.DB_TIMER = '1'B;

  18339   2 0001A1  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 0001A4  8946 0098                            LBT,'1000'X       152,B6
          2 0001A6       1000

      231    18340    3                 CALL GHS$XXDO (0,D$);

  18340   2 0001A7  CBF0 0000                            LAB,B4   0,IMO
          2 0001A9  BBC7 0019                            LAB,B3   D$,AUTO
          2 0001AB  BFC7 0034                            STB,B3   RTIME+5,AUTO
          2 0001AD  CFC7 0032                            STB,B4   RTIME+3,AUTO
          2 0001AF  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 0001B1  CBF0 0200                            LAB,B4   512,IMO
          2 0001B3  E380 0000 0000  xent                 LNJ,B6   GHS$XXDO
          2 0001B6       0001                            DC       s:18341,PREL

      232    18341    3                 GH_HIR = 0;

  18341   2 0001B7  8700 0000 0000  xsym                 CL       GH_HIR

      233    18342    3                 GOTO SE7;

  18342   2 0001BA  0F81 00CF                            B        s:18393,PREL

      234    18343    3                 END;
      235    18344
      236    18345    2              IF G$ROS$->G$ROS.U_ECCB$->G$ECCB.EVENT$ = ENTADDR(NIL)

  18345   2 0001BC  DC80 0000 0000  xsym                 LDB,B5   G$ROS$
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:38   
          2 0001BF  CCC5 000C                            LDB,B4   12,B5
          2 0001C1  BC84                                 LDB,B3   ,B4
          2 0001C2  BD80 0000 0000  03                   CMB,B3   0
          2 0001C5  0981 001B                            BNE      s:18355,PREL

      237    18346    3              THEN DO;

      238    18347    3                 G$JIT.ERR = ENOEVENT;

  18347   2 0001C7  8C80 0000 0004  00                   LDI      ENOEVENT
          2 0001CA  AC80 0000 0000  xsym                 LDB,B2   G$JIT$
          2 0001CD  8D42 003C                            SDI      60,B2

      239    18348    3                 CALL GHS$XXDO (0,D$);

  18348   2 0001CF  CBF0 0000                            LAB,B4   0,IMO
          2 0001D1  BBC7 0019                            LAB,B3   D$,AUTO
          2 0001D3  BFC7 0034                            STB,B3   RTIME+5,AUTO
          2 0001D5  CFC7 0032                            STB,B4   RTIME+3,AUTO
          2 0001D7  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 0001D9  CBF0 0200                            LAB,B4   512,IMO
          2 0001DB  E380 0000 0000  xent                 LNJ,B6   GHS$XXDO
          2 0001DE       0001                            DC       s:18349,PREL

      240    18349    3                 GOTO SE92;

  18349   2 0001DF  0F81 0099                            B        s:18387,PREL

      241    18350    3                 END;
      242    18351        /*E* ERROR: GHQ-E$NOEVENT-E
      243    18352             MESSAGE: No active event procedure when event reported.
      244    18353        */
      245    18354
      246    18355    2              TRAP# = %G_FPRG_EVENT#;

  18355   2 0001E1  5C38                                 LDV,R5   56
          2 0001E2  DF47 0021                            STR,R5   TRAP#,AUTO
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:39   

      247    18356    2              CALL MAKE_TSA;

  18356   2 0001E4  E3C0 01E8                            LNJ,B6   s:0,PREL
          2 0001E6       0001                            DC       s:18357,PREL

      248    18357    2              ENVTCB.ENV$ = ADDR(G$UHJIT.TSA_USR);

  18357   2 0001E7  EC80 0000 0000  xsym                 LDB,B6   G$UHJIT$
          2 0001EA  DBC6 00B6                            LAB,B5   182,B6
          2 0001EC  DFC7 000F                            STB,B5   ENVTCB+11,AUTO

      249    18358
      250    18359    2              IF G$JIT.DB# = 0

  18359   2 0001EE  CC80 0000 0000  xsym                 LDB,B4   G$JIT$
          2 0001F1  E2C4 008D                            LLH,R6   141,B4
          2 0001F3  6981 000B                            BNEZ,R6  s:18361,PREL

      251    18360    2              THEN ENVTCB.P$$ = G$ROS$->G$ROS.U_ECCB$->G$ECCB.EVENT$;

  18360   2 0001F5  BC80 0000 0000  xsym                 LDB,B3   G$ROS$
          2 0001F8  ACC3 000C                            LDB,B2   12,B3
          2 0001FA  9C82                                 LDB,B1   ,B2
          2 0001FB  9FC7 0004                            STB,B1   ENVTCB,AUTO
          2 0001FD  0F81 0008                            B        s:18363,PREL

      252    18361    2              ELSE ENVTCB.P$$ = G$TSA.P$$;

  18361   2 0001FF  BC80 0000 0000  xsym                 LDB,B3   G$TSA_USR$
          2 000202  ACC3 0008                            LDB,B2   8,B3
          2 000204  AFC7 0004                            STB,B2   ENVTCB,AUTO

      253    18362
      254    18363    2              ENVTCB.TCB$ = ADDR(G$ROS.TCB);

  18363   2 000206  BC80 0000 0000  xsym                 LDB,B3   G$ROS$
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:40   
          2 000209  ABC3 0004                            LAB,B2   4,B3
          2 00020B  AFC7 0011                            STB,B2   ENVTCB+13,AUTO

      255    18364    2              ENVTCB.ECC = %G_EVENT#;

  18364   2 00020D  8747 0006                            CL       ENVTCB+2,AUTO

      256    18365    2              ENVTCB.ECINFO.SUBC = G$DO.ECCSC;

  18365   2 00020F  9CC7 0019                            LDB,B1   D$,AUTO
          2 000211  D2C1 0005                            LLH,R5   5,B1
          2 000213  DF47 0007                            STR,R5   ENVTCB+3,AUTO

      257    18366    2              ENVTCB.ECINFO.EVID = G$DO.EVID;

  18366   2 000215  C2C1 0006                            LLH,R4   6,B1
          2 000217  CF47 0008                            STR,R4   ENVTCB+4,AUTO

      258    18367    2              ENVTCB.ECINFO.ERR = G$DO.ERRC;

  18367   2 000219  8CC1 0007                            LDI      7,B1
          2 00021B  8D47 0009                            SDI      ENVTCB+5,AUTO

      259    18368    2              ENVTCB.ECINFO.P# = G$DO.ECCSZ;

  18368   2 00021D  B841 0009                            LDR,R3   9,B1
          2 00021F  BF47 000B                            STR,R3   ENVTCB+7,AUTO

      260    18369    2              IF G$DO.ECCSZ > 0 THEN

  18369   2 000221  A841 0009                            LDR,R2   9,B1
          2 000223  2901 0005                            BEZ,R2   s:18372,PREL

      261    18370    2                 ENVTCB.MOREINFO$ = D$;

  18370   2 000225  9FC7 000C                            STB,B1   ENVTCB+8,AUTO
          2 000227  0F81 0006                            B        s:18374,PREL
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:41   

      262    18371    2              ELSE
      263    18372    2                 ENVTCB.MOREINFO$ = ADDR(NIL);

  18372   2 000229  EB80 0000 0000                       LAB,B6   0
          2 00022C  EFC7 000C                            STB,B6   ENVTCB+8,AUTO

      264    18373
      265    18374    2              CALL GUE$ENVTCB (ENVTCB) ALTRET(SE9);

  18374   2 00022E  EBC7 0004                            LAB,B6   ENVTCB,AUTO
          2 000230  EFC7 0032                            STB,B6   RTIME+3,AUTO
          2 000232  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 000234  CBF0 0100                            LAB,B4   256,IMO
          2 000236  E380 0000 0000  xent                 LNJ,B6   GUE$ENVTCB
          2 000239       0028                            DC       s:18385,PREL

      266    18375
      267    18376    2              END;

      268    18377
      269    18378    1           CALL GHS$XXDO (0,D$);

  18378   2 00023A  EBF0 0000                            LAB,B6   0,IMO
          2 00023C  DBC7 0019                            LAB,B5   D$,AUTO
          2 00023E  DFC7 0034                            STB,B5   RTIME+5,AUTO
          2 000240  EFC7 0032                            STB,B6   RTIME+3,AUTO
          2 000242  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 000244  CBF0 0200                            LAB,B4   512,IMO
          2 000246  E380 0000 0000  xent                 LNJ,B6   GHS$XXDO
          2 000249       0001                            DC       s:18379,PREL

      270    18379    1           GH_HIR=0;

  18379   2 00024A  8700 0000 0000  xsym                 CL       GH_HIR

      271    18380    1           GOTO SE1A;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:42   

  18380   2 00024D  0F81 FE1D                            B        s:18239,PREL

      272    18381        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:43   
      273    18382    1   SE91:   CALL GHS$XXDO (0,D$);           /* Don't give this to user            */

  18382   2 00024F  EBF0 0000            SE91            LAB,B6   0,IMO
          2 000251  DBC7 0019                            LAB,B5   D$,AUTO
          2 000253  DFC7 0034                            STB,B5   RTIME+5,AUTO
          2 000255  EFC7 0032                            STB,B6   RTIME+3,AUTO
          2 000257  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 000259  CBF0 0200                            LAB,B4   512,IMO
          2 00025B  E380 0000 0000  xent                 LNJ,B6   GHS$XXDO
          2 00025E       0001                            DC       s:18383,PREL

      274    18383    1           GOTO SE6;

  18383   2 00025F  0F81 FEB5                            B        s:18303,PREL

      275    18384
      276    18385    1   SE9:    CALL GHS$XXDO (0,D$);           /* No room on his TCB                 */

  18385   2 000261  EBF0 0000            SE9             LAB,B6   0,IMO
          2 000263  DBC7 0019                            LAB,B5   D$,AUTO
          2 000265  DFC7 0034                            STB,B5   RTIME+5,AUTO
          2 000267  EFC7 0032                            STB,B6   RTIME+3,AUTO
          2 000269  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 00026B  CBF0 0200                            LAB,B4   512,IMO
          2 00026D  E380 0000 0000  xent                 LNJ,B6   GHS$XXDO
          2 000270       0001                            DC       s:18387,PREL

      277    18386
      278    18387    1           G$JIT.ERR = TCBERR;

  18387   2 000271  8C80 0000 0000  00                   LDI      TCBERR
          2 000274  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 000277  8D46 003C                            SDI      60,B6

  18387   2                              SE92            null
      279    18388        /*E* ERROR: GHQ-E$TCBFULL-E
      280    18389             MESSAGE: Can't give you event or break control - Your TCB is full.
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:44   
      281    18390        */
      282    18391    1   SE92:   ;
      283    18392    1           G$TSA.I.TRAP# = 64 - %G_FPRG_XCON#;

  18392   2 000279  6C06                 SE92            LDV,R6   6
          2 00027A  EC80 0000 0000  xsym                 LDB,B6   G$TSA_USR$
          2 00027D  E7C6 0002                            STH,R6   2,B6

      284    18393    1           G$JIT.RNST = (G$JIT.RNST | %G_RS_ABRT#);

  18393   2 00027F  DC80 0000 0000  xsym                 LDB,B5   G$JIT$
          2 000282  D845 0096                            LDR,R5   150,B5
          2 000284  D470 0008                            OR,R5    8,IMO
          2 000286  DF45 0096                            STR,R5   150,B5

      285    18394
      286    18395    1           GOTO SE1A;

  18395   2 000288  0F81 FDE2                            B        s:18239,PREL

  18393   2                              SE7             null
      287    18396        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:45   
      288    18397        /* Process ASYNCH flags and run status from JIT  */
      289    18398    1   SE7:    ;
      290    18399                %LOCK (G = G_ASFGATE);

  18404   2 00028A  BB80 0000 0003  03   SE7             LAB,B3   +3
          2 00028D  CBF0 0100                            LAB,B4   256,IMO
          2 00028F  E380 0000 0000  xent                 LNJ,B6   GHH$LOCK
          2 000292       0001                            DC       s:18406,PREL

      291    18406    1           ASFLAG=G$U.ASYNCH;

  18406   2 000293  ECC7 001D                            LDB,B6   CU$,AUTO
          2 000295  E846 0001                            LDR,R6   1,B6
          2 000297  EF47 001F                            STR,R6   ASFLAG,AUTO

      292    18407    1           G$U.ASYNCH = '0'B;

  18407   2 000299  8746 0001                            CL       1,B6

      293    18408                %UNLOCK (G = G_ASFGATE);

  18413   2 00029B  BB80 0000 0003  03                   LAB,B3   +3
          2 00029E  CBF0 0100                            LAB,B4   256,IMO
          2 0002A0  E380 0000 0000  xent                 LNJ,B6   GHH$UNLOCK
          2 0002A3       0001                            DC       s:18415,PREL

      294    18415    1           G$U.ASYNCH='0'B;                /* Clear flags                        */

  18415   2 0002A4  ECC7 001D                            LDB,B6   CU$,AUTO
          2 0002A6  8746 0001                            CL       1,B6

      295    18416        /*    Check if Disconnection occured     */
      296    18417    1           IF ASFLAG & %U_DSC THEN

  18417   2 0002A8  E847 001F                            LDR,R6   ASFLAG,AUTO
          2 0002AA  E570 0400                            AND,R6   1024,IMO
          2 0002AC  6901 0008                            BEZ,R6   s:18420,PREL
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:46   

      297    18418    1              CALL ABORTEX(3);

  18418   2 0002AE  DBF0 0003                            LAB,B5   3,IMO
          2 0002B0  DFC7 0026                            STB,B5   TRAP#+5,AUTO
          2 0002B2  E3C0 00F0                            LNJ,B6   s:0,PREL
          2 0002B4       0001                            DC       s:18420,PREL

      298    18419        /*    Check if Abort from interrupt level */
      299    18420    1           IF ASFLAG & %U_INTABRT THEN

  18420   2 0002B5  E847 001F                            LDR,R6   ASFLAG,AUTO
          2 0002B7  E570 0100                            AND,R6   256,IMO
          2 0002B9  6901 0008                            BEZ,R6   s:18423,PREL

      300    18421    1              CALL ABORTEX(4);

  18421   2 0002BB  EBF0 0004                            LAB,B6   4,IMO
          2 0002BD  EFC7 0026                            STB,B6   TRAP#+5,AUTO
          2 0002BF  E3C0 00E3                            LNJ,B6   s:0,PREL
          2 0002C1       0001                            DC       s:18423,PREL

      301    18422        /* Check for some kind of operator abort */
      302    18423    1           IF ASFLAG & %U_ABRT THEN

  18423   2 0002C2  E847 001F                            LDR,R6   ASFLAG,AUTO
          2 0002C4  E570 8000                            AND,R6   -32768,IMO
          2 0002C6  6901 0008                            BEZ,R6   s:18426,PREL

      303    18424    1              CALL ABORTEX(0);

  18424   2 0002C8  EBF0 0000                            LAB,B6   0,IMO
          2 0002CA  EFC7 0026                            STB,B6   TRAP#+5,AUTO
          2 0002CC  E3C0 00D6                            LNJ,B6   s:0,PREL
          2 0002CE       0001                            DC       s:18426,PREL

      304    18425        /* Check for some kind of operator error of this user */
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:47   
      305    18426    1           IF ASFLAG & %U_ERR THEN

  18426   2 0002CF  E847 001F                            LDR,R6   ASFLAG,AUTO
          2 0002D1  E570 4000                            AND,R6   16384,IMO
          2 0002D3  6901 0008                            BEZ,R6   s:18429,PREL

      306    18427    1              CALL ABORTEX(1);

  18427   2 0002D5  EBF0 0001                            LAB,B6   1,IMO
          2 0002D7  EFC7 0026                            STB,B6   TRAP#+5,AUTO
          2 0002D9  E3C0 00C9                            LNJ,B6   s:0,PREL
          2 0002DB       0001                            DC       s:18429,PREL

      307    18428        /*    Check for limit exceeded  */
      308    18429    1           IF G$JIT.RNST & %G_RS_LIMX# THEN

  18429   2 0002DC  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 0002DF  E846 0096                            LDR,R6   150,B6
          2 0002E1  E570 0800                            AND,R6   2048,IMO
          2 0002E3  6901 0008                            BEZ,R6   s:18432,PREL

      309    18430    1              CALL ABORTEX(2);

  18430   2 0002E5  DBF0 0002                            LAB,B5   2,IMO
          2 0002E7  DFC7 0026                            STB,B5   TRAP#+5,AUTO
          2 0002E9  E3C0 00B9                            LNJ,B6   s:0,PREL
          2 0002EB       0001                            DC       s:18432,PREL

      310    18431
      311    18432    2           IF ASFLAG & %U_ALIBFD THEN DO;

  18432   2 0002EC  E847 001F                            LDR,R6   ASFLAG,AUTO
          2 0002EE  E570 0800                            AND,R6   2048,IMO
          2 0002F0  6901 0043                            BEZ,R6   s:18465,PREL

      312    18433    2              IF G$UHJIT.DMN.ID = %G_DMN_USR_SVC#

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:48   
  18433   2 0002F2  EC80 0000 0000  xsym                 LDB,B6   G$UHJIT$
          2 0002F5  E846 007E                            LDR,R6   126,B6
          2 0002F7  6D03                                 CMV,R6   3
          2 0002F8  0901 0004                            BE       s:18439,PREL
          2 0002FA  6D07                                 CMV,R6   7
          2 0002FB  0981 001C                            BNE      s:18452,PREL

      313    18434    2                OR G$UHJIT.DMN.ID = %G_DMN_USR#
      314    18435    3              THEN DO;

      315    18436
      316    18437                                                /* Associate the debugger             */
      317    18438
      318    18439    3                 ASFLAG = ASFLAG & ~%U_ALIBFD;

  18439   2 0002FD  D847 001F                            LDR,R5   ASFLAG,AUTO
          2 0002FF  D570 F7FF                            AND,R5   -2049,IMO
          2 000301  DF47 001F                            STR,R5   ASFLAG,AUTO

      319    18440    3                 IF ENVTCB.ENVTYPE = %GUE_ENVTCB_TSA# THEN

  18440   2 000303  C847 000E                            LDR,R4   ENVTCB+10,AUTO
          2 000305  4981 0009                            BNEZ,R4  s:18443,PREL

      320    18441    3                    CALL GJU$GET_DB;

  18441   2 000307  CBF0 0000                            LAB,B4   0,IMO
          2 000309  E380 0000 0000  xent                 LNJ,B6   GJU$GET_DB
          2 00030C       0001                            DC       s:18441+6,PREL
          2 00030D  0F81 000A                            B        s:18452,PREL

      321    18442    4                 ELSE DO;

      322    18443    4                    G$UHJIT.ISA_USR.REGS.M1.J = '1'B;

  18443   2 00030F  8946 009D                            LBT,'0080'X       157,B6
  18443   2 000311       0080
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:49   

      323    18444    4                    G$JIT.JUNK.ALIBFD = '1'B;

  18444   2 000312  DC80 0000 0000  xsym                 LDB,B5   G$JIT$
          2 000315  8945 0098                            LBT,'0020'X       152,B5
          2 000317       0020

      324    18445    4                    END;

      325    18446    3                 END;

      326    18447                   %LOCK (G=G_ASFGATE);

  18452   2 000318  BB80 0000 0003  03                   LAB,B3   +3
          2 00031B  CBF0 0100                            LAB,B4   256,IMO
          2 00031D  E380 0000 0000  xent                 LNJ,B6   GHH$LOCK
          2 000320       0001                            DC       s:18454,PREL

      327    18454    2              G$U.ASYNCH =G$U.ASYNCH | ASFLAG;

  18454   2 000321  ECC7 001D                            LDB,B6   CU$,AUTO
          2 000323  E846 0001                            LDR,R6   1,B6
          2 000325  E447 001F                            OR,R6    ASFLAG,AUTO
          2 000327  EF46 0001                            STR,R6   1,B6

      328    18455                   %UNLOCK (G=G_ASFGATE);

  18460   2 000329  BB80 0000 0003  03                   LAB,B3   +3
          2 00032C  CBF0 0100                            LAB,B4   256,IMO
          2 00032E  E380 0000 0000  xent                 LNJ,B6   GHH$UNLOCK
          2 000331       0001                            DC       s:18462,PREL

      329    18462    2              GOTO SE1A;

  18462   2 000332  0F81 FD38                            B        s:18239,PREL

      330    18463    2              END;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:50   
      331    18464        /*    Check for YC or Break                                      */
      332    18465    1           IF ASFLAG & %U_YC THEN

  18465   2 000334  E847 001F                            LDR,R6   ASFLAG,AUTO
          2 000336  E570 1000                            AND,R6   4096,IMO
          2 000338  6901 0005                            BEZ,R6   s:18468,PREL

      333    18466    1              ENVTCB.ECINFO.SUBC = %G_YCSC#;

  18466   2 00033A  8747 0007                            CL       ENVTCB+3,AUTO
          2 00033C  0F81 000C                            B        s:18473,PREL

      334    18467    1           ELSE
      335    18468    1              IF ASFLAG & %U_BRK THEN

  18468   2 00033E  E847 001F                            LDR,R6   ASFLAG,AUTO
          2 000340  E570 2000                            AND,R6   8192,IMO
          2 000342  6901 FD28                            BEZ,R6   s:18239,PREL

      336    18469    1                 ENVTCB.ECINFO.SUBC = %G_BRKSC#;

  18469   2 000344  6C01                                 LDV,R6   1
          2 000345  EF47 0007                            STR,R6   ENVTCB+3,AUTO
          2 000347  0F81 0001                            B        s:18473,PREL

      337    18470    1              ELSE
      338    18471    1                 GOTO SE1A;
      339    18472
      340    18473    1           IF G$ROS$->G$ROS.U_ECCB$->G$ECCB.INT$ = ENTADDR(NIL)

  18473   2 000349  EC80 0000 0000  xsym                 LDB,B6   G$ROS$
          2 00034C  DCC6 000C                            LDB,B5   12,B6
          2 00034E  CCC5 0002                            LDB,B4   2,B5
          2 000350  CD80 0000 0000  03                   CMB,B4   0
          2 000353  0901 FD17                            BE       s:18239,PREL

      341    18474    1           THEN GOTO SE1A;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:51   
      342    18475
      343    18476    1           TRAP# = %G_FPRG_BRK#;

  18476   2 000355  6C39                                 LDV,R6   57
          2 000356  EF47 0021                            STR,R6   TRAP#,AUTO

      344    18477    1           CALL MAKE_TSA;

  18477   2 000358  E3C0 0074                            LNJ,B6   s:0,PREL
          2 00035A       0001                            DC       s:18478,PREL

      345    18478    1           ENVTCB.ENV$ = ADDR(G$UHJIT.TSA_USR);

  18478   2 00035B  EC80 0000 0000  xsym                 LDB,B6   G$UHJIT$
          2 00035E  DBC6 00B6                            LAB,B5   182,B6
          2 000360  DFC7 000F                            STB,B5   ENVTCB+11,AUTO

      346    18479
      347    18480    1           IF G$JIT.DB# = 0

  18480   2 000362  CC80 0000 0000  xsym                 LDB,B4   G$JIT$
          2 000365  E2C4 008D                            LLH,R6   141,B4
          2 000367  6981 000C                            BNEZ,R6  s:18482,PREL

      348    18481    1           THEN ENVTCB.P$$ = G$ROS$->G$ROS.U_ECCB$->G$ECCB.INT$;

  18481   2 000369  BC80 0000 0000  xsym                 LDB,B3   G$ROS$
          2 00036C  ACC3 000C                            LDB,B2   12,B3
          2 00036E  9CC2 0002                            LDB,B1   2,B2
          2 000370  9FC7 0004                            STB,B1   ENVTCB,AUTO
          2 000372  0F81 0008                            B        s:18484,PREL

      349    18482    1           ELSE ENVTCB.P$$ = G$TSA.P$$;

  18482   2 000374  BC80 0000 0000  xsym                 LDB,B3   G$TSA_USR$
          2 000377  ACC3 0008                            LDB,B2   8,B3
          2 000379  AFC7 0004                            STB,B2   ENVTCB,AUTO
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:52   

      350    18483
      351    18484    1           ENVTCB.TCB$ = ADDR(G$ROS.TCB);

  18484   2 00037B  BC80 0000 0000  xsym                 LDB,B3   G$ROS$
          2 00037E  ABC3 0004                            LAB,B2   4,B3
          2 000380  AFC7 0011                            STB,B2   ENVTCB+13,AUTO

      352    18485    1           ENVTCB.ECC = %G_BRK#;

  18485   2 000382  5C01                                 LDV,R5   1
          2 000383  DF47 0006                            STR,R5   ENVTCB+2,AUTO

      353    18486    1           ENVTCB.ECINFO.EVID = 0;

  18486   2 000385  8747 0008                            CL       ENVTCB+4,AUTO

      354    18487    1           ENVTCB.ECINFO.ERR = G$JIT.ERR;

  18487   2 000387  8CC4 003C                            LDI      60,B4
          2 000389  8D47 0009                            SDI      ENVTCB+5,AUTO

      355    18488    1           ENVTCB.ECINFO.P# = 0;

  18488   2 00038B  8747 000B                            CL       ENVTCB+7,AUTO

      356    18489    1           ENVTCB.MOREINFO$ = ADDR(NIL);

  18489   2 00038D  9B80 0000 0000                       LAB,B1   0
          2 000390  9FC7 000C                            STB,B1   ENVTCB+8,AUTO

      357    18490    1           CALL GUE$ENVTCB (ENVTCB) ALTRET(SE9);

  18490   2 000392  EBC7 0004                            LAB,B6   ENVTCB,AUTO
          2 000394  EFC7 0032                            STB,B6   RTIME+3,AUTO
          2 000396  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 000398  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:53   
          2 00039A  E380 0000 0000  xent                 LNJ,B6   GUE$ENVTCB
          2 00039D       FEC4                            DC       s:18385,PREL

      358    18491
      359    18492    1           GH_HIR=0;

  18492   2 00039E  8700 0000 0000  xsym                 CL       GH_HIR

      360    18493    1           GOTO SE1A;

  18493   2 0003A1  0F81 FCC9                            B        s:18239,PREL

      361    18494        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:54   
      362    18495        /*                                                                    */
      363    18496        /*    SET JIT.RNST ACCORDING TO STATUS                                */
      364    18497        /*                                                                    */
      365    18498    1   ABORTEX: PROC(STATUS);

  18498   2 0003A3  EFC7 0024            ABORTEX         STB,B6   TRAP#+3,AUTO

      366    18499    2   DCL   STATUS UBIN;
      367    18500    2   DCL 1 ERRORS_INIT CONSTANT,
      368    18501             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$XKEY,SEV=G_SEV_ABORT#,LAST=
             18501                 ",",LVL=2);
      369    18547             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$EKEY,SEV=G_SEV_ERROR#,LAST=
             18547                 ",",LVL=2);
      370    18593             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$LIMX,SEV=G_SEV_ERROR#,LAST=
             18593                 ",",LVL=2);
      371    18639             %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$LDSC,SEV=G_SEV_ABORT#,LAST=
             18639                 ",",LVL=2);
      372    18685            %VLP_ERRCODE(FPTN=*,FCG=GH,MID=Q,MON='1'B,ERR#=%E$INTABRT,SEV=G_SEV_ERROR#,LAST
             18685                 =";",LVL=2);
      373    18731    2   DCL 1 ERRORS(0:4) REDEF ERRORS_INIT BIT(32);
      374    18732    2   DCL    RNSTAT(0:4) CONSTANT BIT(16)
      375    18733    2                   INIT(%G_RS_XKEY#,
      376    18734    2                        %G_RS_EKEY#,
      377    18735    2                        %G_RS_LIMX#,
      378    18736    2                        %G_RS_DSC#,
      379    18737    2                        %G_RS_INTABRT#);
      380    18738        /*                                                                    */
      381    18739    2           G$JIT.RNST = (G$JIT.RNST | RNSTAT(STATUS) );

  18739   2 0003A5  DCC7 0026                            LDB,B5   @STATUS,AUTO
          2 0003A7  B805                                 LDR,R3   ,B5
          2 0003A8  CC80 0000 0000  xsym                 LDB,B4   G$JIT$
          2 0003AB  E844 0096                            LDR,R6   150,B4
          2 0003AD  E430 0000 0010  00                   OR,R6    RNSTAT,R3
          2 0003B0  EF44 0096                            STR,R6   150,B4

      382    18740    2           IF G$JIT.ERR.SEV = 0
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:55   

  18740   2 0003B2  82C4 003D                            LB,'0007'X        61,B4
  18740   2 0003B4       0007
          2 0003B5  0501 0007                            BBT      s:18743,PREL

      383    18741    2           THEN G$JIT.ERR = ERRORS(STATUS);

  18741   2 0003B7  B805                                 LDR,R3   ,B5
          2 0003B8  8CB0 0000 0006  00                   LDI      ERRORS_INIT,R3
          2 0003BB  8D44 003C                            SDI      60,B4

      384    18742
      385    18743    2           CALL GHR$SRV;

  18743   2 0003BD  CBF0 0000                            LAB,B4   0,IMO
          2 0003BF  E380 0000 0000  xent                 LNJ,B6   GHR$SRV
          2 0003C2       0001                            DC       s:18745,PREL

      386    18744
      387    18745    2           TRAP# = %G_FPRG_XCON#;

  18745   2 0003C3  6C3A                                 LDV,R6   58
          2 0003C4  EF47 0021                            STR,R6   TRAP#,AUTO

      388    18746    2           CALL MAKE_TSA;

  18746   2 0003C6  E3C0 0006                            LNJ,B6   s:0,PREL
          2 0003C8       0001                            DC       s:18747,PREL

      389    18747    2           RETURN;                         /* If XCON after step aborted         */

  18747   2 0003C9  ECC7 0024                            LDB,B6   TRAP#+3,AUTO
          2 0003CB  C3C6 0001                            LNJ,B4   1,B6

      390    18748    2   END;
      391    18749        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:56   
      392    18750        /*                                                              */
      393    18751        /*          Get a TSA frame to enter the trap handler           */
      394    18752        /*                                                              */
      395    18753    1   MAKE_TSA: PROC;

  18753   2 0003CD  EFC7 0028            MAKE_TSA        STB,B6   CT+2,AUTO

      396    18754    2   DCL A$ PTR;
      397    18755
      398    18756    2           IF ENVTCB.ENVTYPE ~= %GUE_ENVTCB_TSA#

  18756   2 0003CF  E847 000E                            LDR,R6   ENVTCB+10,AUTO
          2 0003D1  6901 0026                            BEZ,R6   s:18764,PREL

      399    18757    3           THEN DO;

      400    18758    3              A$ = ADDR(NIL);

  18758   2 0003D3  DB80 0000 0000                       LAB,B5   0
          2 0003D6  DFC7 002A                            STB,B5   A$,AUTO

      401    18759    3              CALL GHI$MAKE_TSA(TRAP#,A$);

  18759   2 0003D8  CBC7 002A                            LAB,B4   A$,AUTO
          2 0003DA  CFC7 0034                            STB,B4   RTIME+5,AUTO
          2 0003DC  BBC7 0021                            LAB,B3   TRAP#,AUTO
          2 0003DE  BFC7 0032                            STB,B3   RTIME+3,AUTO
          2 0003E0  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 0003E2  CBF0 0200                            LAB,B4   512,IMO
          2 0003E4  E380 0000 0000  xent                 LNJ,B6   GHI$MAKE_TSA
          2 0003E7       0001                            DC       s:18760,PREL

      402    18760    3              G$TSA.ISA.REGS = G$UHJIT.ISA_USR.REGS;

  18760   2 0003E8  AC80 0000 0000  xsym                 LDB,B2   G$UHJIT$
          2 0003EB  ABC2 0087                            LAB,B2   135,B2
          2 0003ED  2C00                                 LDV,R2   0
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:57   
          2 0003EE  6C44                                 LDV,R6   68
          2 0003EF  BC80 0000 0000  xsym                 LDB,B3   G$TSA_USR$
          2 0003F2  3C30                                 LDV,R3   48
          2 0003F3  0008                                 MMM

      403    18761    3              ENVTCB.ENVTYPE = %GUE_ENVTCB_TSA#;

  18761   2 0003F4  8747 000E                            CL       ENVTCB+10,AUTO

      404    18762    3              END;

  18762   2 0003F6  0F81 0008                            B        s:18766,PREL

      405    18763
      406    18764    2           ELSE G$TSA.I.TRAP# = TRAP#;

  18764   2 0003F8  D847 0021                            LDR,R5   TRAP#,AUTO
          2 0003FA  DC80 0000 0000  xsym                 LDB,B5   G$TSA_USR$
          2 0003FD  D7C5 0002                            STH,R5   2,B5

      407    18765
      408    18766    2   END MAKE_TSA;

  18766   2 0003FF  ECC7 0028                            LDB,B6   CT+2,AUTO
          2 000401  C3C6 0001                            LNJ,B4   1,B6

      409    18767        %EJECT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:58   
      410    18768        /*                QUANTUM END ACCOUNTING PROCEDURE                    */
      411    18769        /*                                                                    */
      412    18770    1   ACCTEX: PROC;

  18770   2 000403  EFC7 0024            ACCTEX          STB,B6   TRAP#+3,AUTO

      413    18771    2   DCL   CT UBIN(32);
      414    18772    2   DCL X SBIN;
      415    18773
      416    18774        /* Give him a fresh quantum                                        */
      417    18775    2           G$JIT.IDELTAT=GH_QUAN;

  18775   2 000405  F800 0000 0000  xsym                 LDR,R7   GH_QUAN
          2 000408  6C00                                 LDV,R6   0
          2 000409  DC80 0000 0000  xsym                 LDB,B5   G$JIT$
          2 00040C  8D45 006E                            SDI      110,B5

      418    18776        /* If CP or DELTA running, don't tick UTIMER                       */
      419    18777    2           IF NOT G$U.FLG.CPIC AND NOT G$U.FLG.DIC THEN

  18777   2 00040E  CCC7 001D                            LDB,B4   CU$,AUTO
          2 000410  8984                                 CMZ      ,B4
          2 000411  0801 000C                            BAL      s:18781,PREL
          2 000413  8284                                 LB,'4000'X        ,B4
          2 000414       4000
          2 000415  0501 0008                            BBT      s:18781,PREL

      420    18778    2              CALL CHKTMRZ (1);

  18778   2 000417  BBF0 0001                            LAB,B3   1,IMO
          2 000419  BFC7 002C                            STB,B3   A$+2,AUTO
          2 00041B  E3C0 007A                            LNJ,B6   s:0,PREL
          2 00041D       0001                            DC       s:18781,PREL

      421    18779
      422    18780        /* Compute Memory Time Product in Tics                              */
      423    18781    2           CT=G$JIT.XTIME+G$JIT.STIME * G$U.PCT;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:59   

  18781   2 00041E  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 000421  DCC7 001D                            LDB,B5   CU$,AUTO
          2 000423  F845 000A                            LDR,R7   10,B5
          2 000425  6C00                                 LDV,R6   0
          2 000426  9BC6 006C                            LAB,B1   108,B6
          2 000428  D380 0000 0000  xent                 LNJ,B5   X6D_MID
          2 00042B  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 00042E  8446 006A                            AID      106,B6
          2 000430  8D47 0026                            SDI      CT,AUTO

      424    18782    3           DO;

      425    18783    3              G$JIT.TUEXT=G$JIT.TUEXT+G$JIT.XTIME;

  18783   2 000432  8CC6 0024                            LDI      36,B6
          2 000434  8446 006A                            AID      106,B6
          2 000436  8D46 0024                            SDI      36,B6

      426    18784    3              G$JIT.TUSVT=G$JIT.TUSVT+G$JIT.STIME;

  18784   2 000438  8CC6 0026                            LDI      38,B6
          2 00043A  8446 006C                            AID      108,B6
          2 00043C  8D46 0026                            SDI      38,B6

      427    18785    3              G$JIT.UMEMTIM=G$JIT.UMEMTIM+CT;

  18785   2 00043E  8CC6 0028                            LDI      40,B6
          2 000440  8447 0026                            AID      CT,AUTO
          2 000442  8D46 0028                            SDI      40,B6

      428    18786    3              END;

      429    18787    2           X = /*N* G$MHJIT.PNO*4 + */ G$JIT.MODE-1;

  18787   2 000444  D2C6 0004                            LLH,R5   4,B6
          2 000446  5EFF                                 ADV,R5   -1
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:60   
          2 000447  DF47 0028                            STR,R5   X,AUTO

      430    18788    2           PS_LCP6STT.UXEQTIME(X)=PS_LCP6STT.UXEQTIME(X)+G$JIT.XTIME;

  18788   2 000449  B855                                 LDR,R3   R5
          2 00044A  8CB0 0000 0014  xsym                 LDI      PS_LCP6STT+20,R3
          2 00044D  8446 006A                            AID      106,B6
          2 00044F  8D30 0000 0014  xsym                 SDI      PS_LCP6STT+20,R3

      431    18789    2           PS_LCP6STT.USRVTIME(X)=PS_LCP6STT.USRVTIME(X)+G$JIT.STIME;

  18789   2 000452  8CB0 0000 001C  xsym                 LDI      PS_LCP6STT+28,R3
          2 000455  8446 006C                            AID      108,B6
          2 000457  8D30 0000 001C  xsym                 SDI      PS_LCP6STT+28,R3

      432    18790    2           IF G$JIT.MRT > 0 THEN

  18790   2 00045A  8CC6 0070                            LDI      112,B6
          2 00045C  84F0 0000 0000                       SID      0,IMO
          2 00045F  6801 000D                            BLZ,R6   s:18792,PREL
          2 000461  6A01 0003                            BGZ,R6   s:18791,PREL
          2 000463  7901 0009                            BEZ,R7   s:18792,PREL

      433    18791    2              G$JIT.MRT = G$JIT.MRT-G$JIT.XTIME-G$JIT.STIME;

  18791   2 000465  8CC6 0070                            LDI      112,B6
          2 000467  84C6 006A                            SID      106,B6
          2 000469  84C6 006C                            SID      108,B6
          2 00046B  8D46 0070                            SDI      112,B6

      434    18792    2           G$JIT.STIME=0;

  18792   2 00046D  8746 006C                            CL       108,B6
          2 00046F  8746 006D                            CL       109,B6

      435    18793    2           G$JIT.XTIME=0;

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:61   
  18793   2 000471  8746 006A                            CL       106,B6
          2 000473  8746 006B                            CL       107,B6

      436    18794    2           IF G$JIT.MRT <= 0 THEN

  18794   2 000475  8CC6 0070                            LDI      112,B6
          2 000477  84F0 0000 0000                       SID      0,IMO
          2 00047A  6A01 0017                            BGZ,R6   s:18801,PREL
          2 00047C  6801 0003                            BLZ,R6   s:18796,PREL
          2 00047E  7981 0013                            BNEZ,R7  s:18801,PREL

      437    18795    3           DO;

      438    18796    3              G$JIT.MRT=0;

  18796   2 000480  8746 0070                            CL       112,B6
          2 000482  8746 0071                            CL       113,B6

      439    18797    3              G$JIT.RNST = (G$JIT.RNST | %G_RS_LIMX#);

  18797   2 000484  E846 0096                            LDR,R6   150,B6
          2 000486  E470 0800                            OR,R6    2048,IMO
          2 000488  EF46 0096                            STR,R6   150,B6

      440    18798    3              G$JIT.XLIMFLG.TIME = '1'B;

  18798   2 00048A  8946 003F                            LBT,'0001'X       63,B6
  18798   2 00048C       0001

      441    18799    3              G$JIT.ERR = EMAXTIME;

  18799   2 00048D  8C80 0000 0002  00                   LDI      EMAXTIME
          2 000490  8D46 003C                            SDI      60,B6

      442    18800    3              END;

      443    18801    2           RETURN;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:62   

  18801   2 000492  ECC7 0024                            LDB,B6   TRAP#+3,AUTO
          2 000494  C3C6 0001                            LNJ,B4   1,B6

      444    18802    2   END;
      445    18803
      446    18804
      447    18805        /*    Check if UTIMER has run out and event him if so.             */
      448    18806
      449    18807    1   CHKTMRZ: PROC (DECR) ALTRET;

  18807   2 000496  EFC7 002A            CHKTMRZ         STB,B6   A$,AUTO

      450    18808
      451    18809    2   DCL T UBIN;
      452    18810    2   DCL DECR UBIN;
      453    18811    2   DCL RTIME UBIN(32);
      454    18812
      455    18813    2           RTIME=G$JIT.XTIME+G$JIT.STIME;

  18813   2 000498  DC80 0000 0000  xsym                 LDB,B5   G$JIT$
          2 00049B  8CC5 006A                            LDI      106,B5
          2 00049D  8445 006C                            AID      108,B5
          2 00049F  8D47 002F                            SDI      RTIME,AUTO

      456    18814    2           T=0;

  18814   2 0004A1  8747 002E                            CL       T,AUTO

      457    18815    3           DO I = 0 TO 2;

  18815   2 0004A3  8747 0020                            CL       I,AUTO

      458    18816    3              IF G$JIT.TIMERS(I) ~= 0 THEN

  18816   2 0004A5  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 0004A8  B847 0020                            LDR,R3   I,AUTO
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:63   
          2 0004AA  3E54                                 ADV,R3   84
          2 0004AB  8CB6                                 LDI      ,B6,R3
          2 0004AC  84F0 0000 0000                       SID      0,IMO
          2 0004AF  6981 0003                            BNEZ,R6  s:18817,PREL
          2 0004B1  7901 0089                            BEZ,R7   s:18843,PREL

      459    18817    4                 IF RTIME >= G$JIT.TIMERS(I) THEN DO;

  18817   2 0004B3  8CC7 002F                            LDI      RTIME,AUTO
          2 0004B5  84B6                                 SID      ,B6,R3
          2 0004B6  0681 006D                            BCF      s:18838,PREL

      460    18818    4                    T=T+1;

  18818   2 0004B8  8AC7 002E                            INC      T,AUTO

      461    18819    5                    IF I = 0 THEN DO;

  18819   2 0004BA  E847 0020                            LDR,R6   I,AUTO
          2 0004BC  6981 0033                            BNEZ,R6  s:18833,PREL

      462    18820    5                       IF G$JIT.CLUKXINT ~= 0 THEN

  18820   2 0004BE  8CC6 0077                            LDI      119,B6
          2 0004C0  84F0 0000 0000                       SID      0,IMO
          2 0004C3  6981 0003                            BNEZ,R6  s:18821,PREL
          2 0004C5  7901 0009                            BEZ,R7   s:18823,PREL

      463    18821    5                          G$JIT.TMRZ.UTIMER = RTIME + G$JIT.CLUKXINT;

  18821   2 0004C7  8CC7 002F                            LDI      RTIME,AUTO
          2 0004C9  8446 0077                            AID      119,B6
          2 0004CB  8D46 00A8                            SDI      168,B6
          2 0004CD  0F81 0005                            B        s:18824,PREL

      464    18822    5                       ELSE
      465    18823    5                          G$JIT.TMRZ.UTIMER = 0;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:64   

  18823   2 0004CF  8746 00A8                            CL       168,B6
          2 0004D1  8746 00A9                            CL       169,B6

      466    18824    6                       IF G$JIT.CLUKXLVL ~= 0 THEN DO;

  18824   2 0004D3  82C6 0074                            LB,'00FF'X        116,B6
  18824   2 0004D5       00FF
          2 0004D6  0581 0027                            BBF      s:18834,PREL

      467    18825    6                          TRIG=TRIG_CLK;

  18825   2 0004D8  E800 0000 0000  01                   LDR,R6   TRIG_CLK
          2 0004DB  EF47 0013                            STR,R6   TRIG,AUTO

      468    18826    6                          TRIG.LEVEL=G$JIT.CLUKXLVL;

  18826   2 0004DD  D846 0074                            LDR,R5   116,B6
          2 0004DF  DAC7 0013                            SRM,R5,'003F'X    TRIG,AUTO
          2 0004E1       003F

      469    18827    6                          CALL GHH$LEV (TRIG);

  18827   2 0004E2  DBC7 0013                            LAB,B5   TRIG,AUTO
          2 0004E4  DFC7 0032                            STB,B5   RTIME+3,AUTO
          2 0004E6  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 0004E8  CBF0 0100                            LAB,B4   256,IMO
          2 0004EA  E380 0000 0000  xent                 LNJ,B6   GHH$LEV
          2 0004ED       0001                            DC       s:18828,PREL

      470    18828    6                          END;

  18828   2 0004EE  0F81 004C                            B        s:18843,PREL

      471    18829    5                       ELSE
      472    18830    5                          GOTO CHKTMR1;
      473    18831    5                       END;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:65   
      474    18832    5                    ELSE DO;

      475    18833    5                       G$JIT.TIMERS(I)=0;

  18833   2 0004F0  DBC6 00A8                            LAB,B5   168,B6
          2 0004F2  A856                                 LDR,R2   R6
          2 0004F3  2001                                 SOL,R2   1
          2 0004F4  8725                                 CL       ,B5,R2
          2 0004F5  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 0004F8  DBC6 00A9                            LAB,B5   169,B6
          2 0004FA  B847 0020                            LDR,R3   I,AUTO
          2 0004FC  3001                                 SOL,R3   1
          2 0004FD  8735                                 CL       ,B5,R3

      476    18834    5   CHKTMR1:            CALL GHS$EVENT(G$MHJIT.CUN,I,%G_XTMRSC#,0,,0);

  18834   2 0004FE  EBF0 0000            CHKTMR1         LAB,B6   0,IMO
          2 000500  DBF0 0000                            LAB,B5   0,IMO
          2 000502  CBF0 0000                            LAB,B4   0,IMO
          2 000504  CFC7 003C                            STB,B4   RTIME+13,AUTO
          2 000506  BB80 0000 0000                       LAB,B3   0
          2 000509  BFC7 003A                            STB,B3   RTIME+11,AUTO
          2 00050B  DFC7 0038                            STB,B5   RTIME+9,AUTO
          2 00050D  EFC7 0036                            STB,B6   RTIME+7,AUTO
          2 00050F  ABC7 0020                            LAB,B2   I,AUTO
          2 000511  AFC7 0034                            STB,B2   RTIME+5,AUTO
          2 000513  9C80 0000 0000  xsym                 LDB,B1   G$MHJIT$
          2 000516  EBC1 0351                            LAB,B6   849,B1
          2 000518  EFC7 0032                            STB,B6   RTIME+3,AUTO
          2 00051A  BBC7 0032                            LAB,B3   RTIME+3,AUTO
          2 00051C  CBF0 0600                            LAB,B4   1536,IMO
          2 00051E  E380 0000 0000  xent                 LNJ,B6   GHS$EVENT
          2 000521       0001                            DC       s:18836,PREL

      477    18835    5                       END;

      478    18836    4                    END;
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:66   

  18836   2 000522  0F81 0018                            B        s:18843,PREL

      479    18837    3                 ELSE
      480    18838    4                    IF DECR ~= 0 THEN DO;

  18838   2 000524  DCC7 002C                            LDB,B5   @DECR,AUTO
          2 000526  E805                                 LDR,R6   ,B5
          2 000527  6901 0013                            BEZ,R6   s:18843,PREL

      481    18839    4                       G$JIT.TIMERS(I)=G$JIT.TIMERS(I)-RTIME;

  18839   2 000529  8CB6                                 LDI      ,B6,R3
          2 00052A  84C7 002F                            SID      RTIME,AUTO
          2 00052C  8D36                                 SDI      ,B6,R3

      482    18840    4                       IF G$JIT.TIMERS(I) < G$JIT.IDELTAT THEN

  18840   2 00052D  EC80 0000 0000  xsym                 LDB,B6   G$JIT$
          2 000530  B847 0020                            LDR,R3   I,AUTO
          2 000532  3E54                                 ADV,R3   84
          2 000533  8CB6                                 LDI      ,B6,R3
          2 000534  84C6 006E                            SID      110,B6
          2 000536  0601 0004                            BCT      s:18843,PREL

      483    18841    4                          G$JIT.IDELTAT = G$JIT.TIMERS(I);

  18841   2 000538  8CB6                                 LDI      ,B6,R3
          2 000539  8D46 006E                            SDI      110,B6

      484    18842    4                       END;

      485    18843    3              END;

  18843   2 00053B  8AC7 0020                            INC      I,AUTO
          2 00053D  E847 0020                            LDR,R6   I,AUTO
          2 00053F  6D02                                 CMV,R6   2
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:67   
          2 000540  0381 FF64                            BLE      s:18816,PREL

      486    18844    2           IF T ~= 0 THEN

  18844   2 000542  D847 002E                            LDR,R5   T,AUTO
          2 000544  5901 0005                            BEZ,R5   s:18846,PREL

      487    18845    2              ALTRETURN;

  18845   2 000546  ECC7 002A                            LDB,B6   A$,AUTO
          2 000548  B806                                 LDR,R3   ,B6
          2 000549  C3B6                                 LNJ,B4   ,B6,R3

      488    18846    2           RETURN;

  18846   2 00054A  ECC7 002A                            LDB,B6   A$,AUTO
          2 00054C  C3C6 0001                            LNJ,B4   1,B6
      489    18847    2   END;
      490    18848
      491    18849
      492    18850
      493    18851    1   END;
      494    18852        %EOD;

PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:68   
--  Include file information  --

   P_FEP_M.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   GH_HARDWARE_M.:E05TOU  is referenced.
   GU_MACROS_M.:E05TOU  is referenced.
   GH_GATE_M.:E05TOU  cannot be made into a system file and is referenced.
   GM_VIRTUAL_E.:E05TOU  is referenced.
   G_ROS_M.:E05TOU  is referenced.
   G_HJIT_M.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   GH_SCHD_E.:E05TOU  is referenced.
   GH_SCHD_M.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure GHQ$QEND.
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:69   

 **** Variables and constants ****

  ****  Section 000 RoData GHQ$QEND

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w STRC(32)    r     1 EMAXTIME                   4-0-0/w STRC(32)    r     1 ENOEVENT
     6-0-0/w BIT (32)    r     1 ERRORS(0:4)                6-0-0/w STRC(160)   r     1 ERRORS_INIT
    10-0-0/b BIT (16)    r     1 RNSTAT(0:4)                0-0-0/w STRC(32)    r     1 TCBERR

  ****  Section 001  Data  GHQ$QEND

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(16)    r     1 TRIG_CLK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    2C-0-0/w PTR         r     1 @DECR                     26-0-0/w PTR         r     1 @STATUS
    2A-0-0/w PTR         r     1 A$                        1F-0-0/b BIT (16)    r     1 ASFLAG
    26-0-0/w UBIN(32)    r     1 CT                        1D-0-0/w PTR         r     1 CU$
    19-0-0/w PTR         r     1 D$                        *0-0-0/w UBIN(16)    r     1 DECR
     4-0-0/w STRC(240)   r     1 ENVTCB                    20-0-0/w UBIN(16)    r     1 I
    17-0-0/w SBIN(32)    r     1 RTIME                     2F-0-0/w UBIN(32)    r     1 RTIME
    *0-0-0/w UBIN(16)    r     1 STATUS                    2E-0-0/w UBIN(16)    r     1 T
    14-0-0/w STRC(48)    r     1 TGATE                     21-0-0/w UBIN(16)    r     1 TRAP#
    13-0-0/w STRC(16)    r     1 TRIG                      28-0-0/w SBIN(16)    r     1 X

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:70   

     0-0-0/w PTR         r     1 G$JIT$                     0-0-0/w PTR         r     1 G$LOW_MEM$
     0-0-0/w PTR         r     1 G$MHJIT$                   0-0-0/w PTR         r     1 G$ROS$
     0-0-0/w PTR         r     1 G$TSA_USR$                 0-0-0/w PTR         r     1 G$UHJIT$
     0-0-0/w SBIN(16)    r     1 GH_HIR                     0-0-0/w UBIN(16)    r     1 GH_QMIN
     0-0-0/w UBIN(16)    r     1 GH_QUAN                    0-0-0/w UBIN(16)    r     1 G_ASFGATE
     0-0-0/w STRC(2208)  r     1 PS_LCP6STT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(256)   r     1 G$DO                       0-0-0/w STRC(224)   r     1 G$ECCB
     0-0-0/w STRC(5616)  r     1 G$JIT                      0-0-0/w STRC(4096)  r     1 G$LOW_MEM
     0-0-0/w STRC(27232) r     1 G$MHJIT                    0-0-0/w STRC(928)   r     1 G$ROS
     0-0-0/w STRC(928)   r     1 G$TSA                      0-0-0/w STRC(384)   r     1 G$U
     0-0-0/w STRC(6480)  r     1 G$UHJIT


   Procedure GHQ$QEND requires 1358 words for executable code.
   Procedure GHQ$QEND requires 62 words of local(AUTO) storage.
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:71   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:72   
          MINI XREF LISTING

A$ IN PROCEDURE MAKE_TSA
     18754**DCL     18758<<ASSIGN  18759<>CALL
ABORTEX
     18498**PROC    18418--CALL    18421--CALL    18424--CALL    18427--CALL    18430--CALL
ACCTEX
     18770**PROC    18254--CALL
ASFLAG
     18209**DCL     18406<<ASSIGN  18417>>IF      18420>>IF      18423>>IF      18426>>IF      18432>>IF
     18439<<ASSIGN  18439>>ASSIGN  18454>>ASSIGN  18465>>IF      18468>>IF
CHKTMR1 IN PROCEDURE CHKTMRZ
     18834**LABEL   18830--GOTO
CHKTMRZ
     18807**PROC    18238--CALL    18778--CALL
COMMN
     18226**LABEL   18219--GOTO
CT IN PROCEDURE ACCTEX
     18771**DCL     18781<<ASSIGN  18785>>ASSIGN
CU$
     18208**DCL     16598--IMP-PTR 18228<<ASSIGN  18229>>IF      18229>>IF      18233>>IF      18235>>IF
     18255>>ASSIGN  18255>>ASSIGN  18305>>ASSIGN  18338>>ASSIGN  18338>>ASSIGN  18406>>ASSIGN  18407>>ASSIGN
     18415>>ASSIGN  18454>>ASSIGN  18454>>ASSIGN  18777>>IF      18777>>IF      18781>>ASSIGN
D$
     18206**DCL     17023--IMP-PTR 18305<<ASSIGN  18307>>DOWHILE 18308>>IF      18310<<ASSIGN  18310>>ASSIGN
     18320>>IF      18333>>IF      18334>>CALL    18334<>CALL    18336>>IF      18340<>CALL    18348<>CALL
     18365>>ASSIGN  18366>>ASSIGN  18367>>ASSIGN  18368>>ASSIGN  18369>>IF      18370>>ASSIGN  18378<>CALL
     18382<>CALL    18385<>CALL
DECR IN PROCEDURE CHKTMRZ
     18810**DCL     18807--PROC    18838>>IF
EMAXTIME
     18033**DCL     18799>>ASSIGN
ENOEVENT
     18081**DCL     18347>>ASSIGN
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:73   
ENVTCB
     17251**DCL     18374<>CALL    18490<>CALL
ENVTCB.ECC
     17251**DCL     18364<<ASSIGN  18485<<ASSIGN
ENVTCB.ECINFO.ERR
     17337**DCL     18367<<ASSIGN  18487<<ASSIGN
ENVTCB.ECINFO.EVID
     17294**DCL     17312--REDEF   17320--REDEF   17320--REDEF   18366<<ASSIGN  18486<<ASSIGN
ENVTCB.ECINFO.P#
     17367**DCL     18368<<ASSIGN  18488<<ASSIGN
ENVTCB.ECINFO.SUBC
     17271**DCL     17271--REDEF   17289--REDEF   17293--REDEF   17293--REDEF   18365<<ASSIGN  18466<<ASSIGN
     18469<<ASSIGN
ENVTCB.ENV$
     17369**DCL     18357<<ASSIGN  18478<<ASSIGN
ENVTCB.ENVTYPE
     17369**DCL     18218<<ASSIGN  18223<<ASSIGN  18315>>IF      18440>>IF      18756>>IF      18761<<ASSIGN
ENVTCB.MOREINFO$
     17369**DCL     18370<<ASSIGN  18372<<ASSIGN  18489<<ASSIGN
ENVTCB.P$$
     17251**DCL     17251--REDEF   18360<<ASSIGN  18361<<ASSIGN  18481<<ASSIGN  18482<<ASSIGN
ENVTCB.TCB$
     17369**DCL     18363<<ASSIGN  18484<<ASSIGN
ERRORS IN PROCEDURE ABORTEX
     18731**DCL     18741>>ASSIGN
ERRORS_INIT IN PROCEDURE ABORTEX
     18500**DCL     18731--REDEF
G$DO.BUSY
     17027**DCL     18308>>IF
G$DO.DMAIN
     17027**DCL     18336>>IF
G$DO.ECCSC
     17027**DCL     18320>>IF      18365>>ASSIGN
G$DO.ECCSZ
     17079**DCL     18368>>ASSIGN  18369>>IF
G$DO.ENTER
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:74   
     17027**DCL     18333>>IF      18334>>CALL
G$DO.ERRC
     17046**DCL     18367>>ASSIGN
G$DO.EVID
     17028**DCL     18366>>ASSIGN
G$DO.LNK$
     17023**DCL     18310>>ASSIGN
G$ECCB.EVENT$
     17145**DCL     18345>>IF      18360>>ASSIGN
G$ECCB.FLTFLG
     17168**DCL     17199--REDEF
G$ECCB.INT$
     17145**DCL     18473>>IF      18481>>ASSIGN
G$JIT.CLUKRINT
     16789**DCL     18321>>IF
G$JIT.CLUKRLVL
     16788**DCL     18323>>IF      18327>>ASSIGN
G$JIT.CLUKXINT
     16789**DCL     18820>>IF      18821>>ASSIGN
G$JIT.CLUKXLVL
     16788**DCL     18824>>IF      18826>>ASSIGN
G$JIT.DB#
     16799**DCL     18359>>IF      18480>>IF
G$JIT.ERR
     16706**DCL     18347<<ASSIGN  18387<<ASSIGN  18487>>ASSIGN  18741<<ASSIGN  18799<<ASSIGN
G$JIT.ERR.SEV
     16734**DCL     18740>>IF
G$JIT.ERRLOG
     16948**DCL     16951--REDEF
G$JIT.IDELTAT
     16787**DCL     18241>>ASSIGN  18271>>ASSIGN  18303>>IF      18775<<ASSIGN  18840>>IF      18841<<ASSIGN
G$JIT.JSUNIT
     16687**DCL     16688--REDEF
G$JIT.JUNK.ALIBFD
     16945**DCL     18444<<ASSIGN
G$JIT.JUNK.DB_TIMER
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:75   
     16939**DCL     18339<<ASSIGN
G$JIT.MCLS
     16686**DCL     16686--REDEF
G$JIT.MODE
     16675**DCL     18787>>ASSIGN
G$JIT.MRT
     16787**DCL     18790>>IF      18791<<ASSIGN  18791>>ASSIGN  18794>>IF      18796<<ASSIGN
G$JIT.RNST
     16918**DCL     18229>>IF      18233>>IF      18393<<ASSIGN  18393>>ASSIGN  18429>>IF      18739<<ASSIGN
     18739>>ASSIGN  18797<<ASSIGN  18797>>ASSIGN
G$JIT.SCHTIME
     16787**DCL     18253<<ASSIGN  18271>>ASSIGN  18276<<ASSIGN
G$JIT.STIME
     16786**DCL     18241>>ASSIGN  18253>>ASSIGN  18276>>ASSIGN  18303>>IF      18781>>ASSIGN  18784>>ASSIGN
     18789>>ASSIGN  18791>>ASSIGN  18792<<ASSIGN  18813>>ASSIGN
G$JIT.TIMERS
     16956**DCL     18816>>IF      18817>>IF      18833<<ASSIGN  18839<<ASSIGN  18839>>ASSIGN  18840>>IF
     18841>>ASSIGN
G$JIT.TMRZ
     16955**DCL     16956--REDEF   18229>>IF      18237>>IF
G$JIT.TMRZ.UTIMER
     16955**DCL     18821<<ASSIGN  18823<<ASSIGN
G$JIT.TUEXT
     16680**DCL     18783<<ASSIGN  18783>>ASSIGN
G$JIT.TUSVT
     16681**DCL     18784<<ASSIGN  18784>>ASSIGN
G$JIT.UMEMTIM
     16682**DCL     18785<<ASSIGN  18785>>ASSIGN
G$JIT.USER_EXTIME
     16679**DCL     16680--REDEF
G$JIT.USER_MEMTIME
     16682**DCL     16682--REDEF
G$JIT.USER_SVTIME
     16681**DCL     16681--REDEF
G$JIT.XLIMFLG.TIME
     16778**DCL     18798<<ASSIGN
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:76   
G$JIT.XTIME
     16786**DCL     18241>>ASSIGN  18253>>ASSIGN  18276>>ASSIGN  18303>>IF      18781>>ASSIGN  18783>>ASSIGN
     18788>>ASSIGN  18791>>ASSIGN  18793<<ASSIGN  18813>>ASSIGN
G$JIT$
     18174**DCL     16618--IMP-PTR 18229>>IF      18229>>IF      18233>>IF      18237>>IF      18241>>ASSIGN
     18241>>ASSIGN  18241>>ASSIGN  18253>>ASSIGN  18253>>ASSIGN  18253>>ASSIGN  18271>>ASSIGN  18271>>ASSIGN
     18276>>ASSIGN  18276>>ASSIGN  18276>>ASSIGN  18303>>IF      18303>>IF      18303>>IF      18321>>IF
     18323>>IF      18327>>ASSIGN  18339>>ASSIGN  18347>>ASSIGN  18359>>IF      18387>>ASSIGN  18393>>ASSIGN
     18393>>ASSIGN  18429>>IF      18444>>ASSIGN  18480>>IF      18487>>ASSIGN  18739>>ASSIGN  18739>>ASSIGN
     18740>>IF      18741>>ASSIGN  18775>>ASSIGN  18781>>ASSIGN  18781>>ASSIGN  18783>>ASSIGN  18783>>ASSIGN
     18783>>ASSIGN  18784>>ASSIGN  18784>>ASSIGN  18784>>ASSIGN  18785>>ASSIGN  18785>>ASSIGN  18787>>ASSIGN
     18788>>ASSIGN  18789>>ASSIGN  18790>>IF      18791>>ASSIGN  18791>>ASSIGN  18791>>ASSIGN  18791>>ASSIGN
     18792>>ASSIGN  18793>>ASSIGN  18794>>IF      18796>>ASSIGN  18797>>ASSIGN  18797>>ASSIGN  18798>>ASSIGN
     18799>>ASSIGN  18813>>ASSIGN  18813>>ASSIGN  18816>>IF      18817>>IF      18820>>IF      18821>>ASSIGN
     18821>>ASSIGN  18823>>ASSIGN  18824>>IF      18826>>ASSIGN  18833>>ASSIGN  18839>>ASSIGN  18839>>ASSIGN
     18840>>IF      18840>>IF      18841>>ASSIGN  18841>>ASSIGN
G$LOW_MEM.IV.IL$
     17243**DCL     17243--REDEF
G$LOW_MEM.IV.INT.I#00$
     17243**DCL     17243--REDEF
G$LOW_MEM.IV.INT.I#01$
     17243**DCL     17243--REDEF
G$LOW_MEM.IV.INT.I#02$
     17244**DCL     17244--REDEF
G$LOW_MEM.IV.INT.I#03$
     17244**DCL     17244--REDEF
G$LOW_MEM.IV.INT.I#04$
     17244**DCL     17245--REDEF
G$LOW_MEM.IV.INT.I#05$
     17245**DCL     17245--REDEF
G$LOW_MEM.IV.INT.I#61$
     17246**DCL     17246--REDEF
G$LOW_MEM.IV.INT.I#62$
     17246**DCL     17246--REDEF
G$LOW_MEM.IV.INT.I#63$
     17246**DCL     17246--REDEF
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:77   
G$LOW_MEM.RTC_CURR
     17207**DCL     18288<<ASSIGN
G$LOW_MEM.TV.T#01$
     17231**DCL     17231--REDEF
G$LOW_MEM.TV.T#02$
     17231**DCL     17231--REDEF
G$LOW_MEM.TV.T#03$
     17230**DCL     17230--REDEF
G$LOW_MEM.TV.T#05$
     17230**DCL     17230--REDEF
G$LOW_MEM.TV.T#06$
     17229**DCL     17229--REDEF
G$LOW_MEM.TV.T#07$
     17229**DCL     17229--REDEF
G$LOW_MEM.TV.T#08$
     17228**DCL     17229--REDEF
G$LOW_MEM.TV.T#09$
     17228**DCL     17228--REDEF
G$LOW_MEM.TV.T#10$
     17228**DCL     17228--REDEF
G$LOW_MEM.TV.T#12$
     17227**DCL     17227--REDEF
G$LOW_MEM.TV.T#13$
     17227**DCL     17227--REDEF
G$LOW_MEM.TV.T#14$
     17226**DCL     17226--REDEF
G$LOW_MEM.TV.T#15$
     17226**DCL     17226--REDEF
G$LOW_MEM.TV.T#16$
     17225**DCL     17226--REDEF
G$LOW_MEM.TV.T#17$
     17225**DCL     17225--REDEF
G$LOW_MEM.TV.T#19$
     17224**DCL     17225--REDEF
G$LOW_MEM.TV.T#20$
     17224**DCL     17224--REDEF
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:78   
G$LOW_MEM.TV.T#21$
     17224**DCL     17224--REDEF
G$LOW_MEM.TV.T#22$
     17223**DCL     17223--REDEF
G$LOW_MEM.TV.T#23$
     17223**DCL     17223--REDEF
G$LOW_MEM.TV.T#24$
     17222**DCL     17223--REDEF
G$LOW_MEM.TV.T#25$
     17222**DCL     17222--REDEF
G$LOW_MEM.TV.T#26$
     17222**DCL     17222--REDEF
G$LOW_MEM.TV.T#27$
     17221**DCL     17221--REDEF
G$LOW_MEM.TV.T#28$
     17221**DCL     17221--REDEF
G$LOW_MEM.TV.T#29$
     17220**DCL     17221--REDEF
G$LOW_MEM.TV.T#30$
     17220**DCL     17220--REDEF
G$LOW_MEM.TV.T#31$
     17220**DCL     17220--REDEF
G$LOW_MEM.TV.T#32$
     17219**DCL     17219--REDEF
G$LOW_MEM.TV.T#33$
     17219**DCL     17219--REDEF
G$LOW_MEM$
     18176**DCL     17206--IMP-PTR 18288>>ASSIGN
G$MHJIT.CU$
     12702**DCL     18228>>ASSIGN
G$MHJIT.CUN
     12702**DCL     18834<>CALL
G$MHJIT.INTCON.HHJIT
     12836**DCL     12836--REDEF
G$MHJIT.INTCON.P$$
     12809**DCL     12809--REDEF
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:79   
G$MHJIT.ISA_BIGFOOT.P$$
      9754**DCL      9754--REDEF
G$MHJIT.ISA_DBINH.P$$
     10968**DCL     10968--REDEF
G$MHJIT.ISA_IDLE.P$$
      7849**DCL      7849--REDEF
G$MHJIT.ISA_LVL10.P$$
     11271**DCL     11271--REDEF
G$MHJIT.ISA_LVL11.P$$
     11574**DCL     11574--REDEF
G$MHJIT.ISA_LVL12.P$$
     11877**DCL     11877--REDEF
G$MHJIT.ISA_LVL5.P$$
     10057**DCL     10057--REDEF
G$MHJIT.ISA_OV.P$$
      9451**DCL      9451--REDEF
G$MHJIT.ISA_PFS.P$$
      9122**DCL      9122--REDEF
G$MHJIT.ISA_RT_CLOCK.P$$
     12484**DCL     12484--REDEF
G$MHJIT.ISA_SATYR_RCV.P$$
     10361**DCL     10361--REDEF
G$MHJIT.ISA_SATYR_TRN.P$$
     10665**DCL     10665--REDEF
G$MHJIT.ISA_SCHD.P$$
     12180**DCL     12180--REDEF
G$MHJIT.ISA_WDOG.P$$
      9230**DCL      9230--REDEF
G$MHJIT.TSA_DB.ISA.P$$
      8452**DCL      8452--REDEF
G$MHJIT.TSA_DB.P$$
      8323**DCL      8323--REDEF    8324--REDEF
G$MHJIT.TSA_HND.ISA.P$$
     13030**DCL     13030--REDEF
G$MHJIT.TSA_HND.P$$
     12901**DCL     12901--REDEF   12902--REDEF
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:80   
G$MHJIT.TSA_MON.ISA.P$$
      8064**DCL      8064--REDEF
G$MHJIT.TSA_MON.P$$
      7935**DCL      7935--REDEF    7936--REDEF
G$MHJIT.TSA_OV.ISA.P$$
      8840**DCL      8840--REDEF
G$MHJIT.TSA_OV.P$$
      8711**DCL      8711--REDEF    8712--REDEF
G$MHJIT$
     18177**DCL      6374--IMP-PTR 18228>>ASSIGN  18834>>CALL
G$ROS.AUTO_DS$
     17104**DCL     17105--REDEF
G$ROS.AUTO_T$
     17105**DCL     17105--REDEF
G$ROS.TCB
     17100**DCL     18363--ASSIGN  18484--ASSIGN
G$ROS.U_ECCB$
     17102**DCL     18345>>IF      18360>>ASSIGN  18473>>IF      18481>>ASSIGN
G$ROS$
     18175**DCL     17095--IMP-PTR 18345>>IF      18360>>ASSIGN  18363>>ASSIGN  18473>>IF      18481>>ASSIGN
     18484>>ASSIGN
G$TSA.I.TRAP#
     16256**DCL     18392<<ASSIGN  18764<<ASSIGN
G$TSA.ISA.P$$
     16393**DCL     16393--REDEF
G$TSA.ISA.REGS
     16435**DCL     18760<<ASSIGN
G$TSA.P$$
     16264**DCL     16264--REDEF   16265--REDEF   18361>>ASSIGN  18482>>ASSIGN
G$TSA_USR$
     18179**DCL     16232--IMP-PTR 18361>>ASSIGN  18392>>ASSIGN  18482>>ASSIGN  18760>>ASSIGN  18764>>ASSIGN
G$U.ASYNCH
     16599**DCL     18229>>IF      18233>>IF      18338<<ASSIGN  18338>>ASSIGN  18406>>ASSIGN  18407<<ASSIGN
     18415<<ASSIGN  18454<<ASSIGN  18454>>ASSIGN
G$U.DL$
     16601**DCL     18229>>IF      18235>>IF      18305>>ASSIGN
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:81   
G$U.FLG.CPIC
     16598**DCL     18777>>IF
G$U.FLG.DIC
     16598**DCL     18777>>IF
G$U.MISC
     16599**DCL     16599--REDEF
G$U.PCT
     16600**DCL     18781>>ASSIGN
G$U.PRIO
     16601**DCL     18255<<ASSIGN
G$U.PRIOB
     16601**DCL     18255>>ASSIGN
G$UHJIT.DMN.ID
     14966**DCL     18214>>IF      18433>>IF      18433>>IF
G$UHJIT.ISA_USR
     14671**DCL     14966--REDEF
G$UHJIT.ISA_USR.P$$
     14746**DCL     14746--REDEF
G$UHJIT.ISA_USR.REGS
     14788**DCL     18760>>ASSIGN
G$UHJIT.ISA_USR.REGS.M1.J
     14840**DCL     18443<<ASSIGN
G$UHJIT.ISA_USR.TSAP$
     14673**DCL     18214>>IF      18214>>IF      18315>>IF
G$UHJIT.TSA_CP.ISA.P$$
     15953**DCL     15953--REDEF
G$UHJIT.TSA_CP.P$$
     15824**DCL     15824--REDEF   15825--REDEF
G$UHJIT.TSA_DB.ISA.P$$
     15565**DCL     15565--REDEF
G$UHJIT.TSA_DB.P$$
     15436**DCL     15436--REDEF   15437--REDEF
G$UHJIT.TSA_RTT.P$$
     16199**DCL     16199--REDEF   16200--REDEF
G$UHJIT.TSA_USR
     14996**DCL     18214--IF      18315--IF      18357--ASSIGN  18478--ASSIGN
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:82   
G$UHJIT.TSA_USR.ISA.P$$
     15155**DCL     15155--REDEF
G$UHJIT.TSA_USR.P$$
     15026**DCL     15026--REDEF   15027--REDEF
G$UHJIT$
     18178**DCL     13248--IMP-PTR 18214>>IF      18214>>IF      18214>>IF      18214>>IF      18315>>IF
     18315>>IF      18357>>ASSIGN  18433>>IF      18433>>IF      18443>>ASSIGN  18478>>ASSIGN  18760>>ASSIGN
GHH$LEV
     18161**DCL-ENT 18328--CALL    18827--CALL
GHH$LOCK
      2156**DCL-ENT 18248--CALL    18404--CALL    18452--CALL
GHH$LVL
     18160**DCL-ENT 18226--CALL
GHH$UNLOCK
      2156**DCL-ENT 18261--CALL    18282--CALL    18294--CALL    18413--CALL    18460--CALL
GHI$MAKE_TSA
     18162**DCL-ENT 18759--CALL
GHR$MON
     18163**DCL-ENT 18252--CALL    18275--CALL
GHR$SRV
     18164**DCL-ENT 18743--CALL
GHR$USR
     18165**DCL-ENT 18296--CALL
GHS$EVENT
     18169**DCL-ENT 18834--CALL
GHS$XXDO
     18168**DCL-ENT 18340--CALL    18348--CALL    18378--CALL    18382--CALL    18385--CALL
GH_HIR
     18180**DCL     18269>>IF      18274<<ASSIGN  18341<<ASSIGN  18379<<ASSIGN  18492<<ASSIGN
GH_QMIN
     18181**DCL     18271>>ASSIGN
GH_QUAN
     18182**DCL     18775>>ASSIGN
GJU$GET_DB
     18172**DCL-ENT 18441--CALL
GUE$ENVTCB
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:83   
     18166**DCL-ENT 18374--CALL    18490--CALL
GUS$RESTRTCLK
     18167**DCL-ENT 18322--CALL
G_ASFGATE
     18183**DCL     18404<>CALL    18413<>CALL    18452<>CALL    18460<>CALL
I
     18210**DCL     18815<<DOINDEX 18816>>IF      18817>>IF      18819>>IF      18833>>ASSIGN  18834<>CALL
     18839>>ASSIGN  18839>>ASSIGN  18840>>IF      18841>>ASSIGN
MAKE_TSA
     18753**PROC    18356--CALL    18477--CALL    18746--CALL
PS_LCP6STT.REQSTATS.DSPMSK
     17731**DCL     17737--REDEF
PS_LCP6STT.REQSTATS.SLCMSK
     17772**DCL     17779--REDEF
PS_LCP6STT.USRVTIME
     17790**DCL     18789<<ASSIGN  18789>>ASSIGN
PS_LCP6STT.UXEQTIME
     17786**DCL     18788<<ASSIGN  18788>>ASSIGN
RNSTAT IN PROCEDURE ABORTEX
     18732**DCL     18739>>ASSIGN
RTIME
     18205**DCL     18241<<ASSIGN  18250>>IF      18271<<ASSIGN  18271>>ASSIGN  18272>>IF      18288>>ASSIGN
RTIME IN PROCEDURE CHKTMRZ
     18811**DCL     18813<<ASSIGN  18817>>IF      18821>>ASSIGN  18839>>ASSIGN
SE1A
     18241**LABEL   18304--GOTO    18312--GOTO    18317--GOTO    18380--GOTO    18395--GOTO    18462--GOTO
     18471--GOTO    18474--GOTO    18493--GOTO
SE6
     18303**LABEL   18236--GOTO    18238--CALLALT 18383--GOTO
SE61
     18307**LABEL   18309--GOTO
SE62
     18333**LABEL   18324--GOTO
SE7
     18393**LABEL   18234--GOTO    18342--GOTO
SE9
PL6.E3A0      #001=GHQ$QEND File=GHQ$QEND.:E05TSI                                TUE 07/29/97 21:35 Page:84   
     18385**LABEL   18374--CALLALT 18490--CALLALT
SE91
     18382**LABEL   18334--CALLALT
SE92
     18387**LABEL   18349--GOTO
STATUS IN PROCEDURE ABORTEX
     18499**DCL     18498--PROC    18739>>ASSIGN  18741>>ASSIGN
T IN PROCEDURE CHKTMRZ
     18809**DCL     18814<<ASSIGN  18818<<ASSIGN  18818>>ASSIGN  18844>>IF
TCBERR
     17985**DCL     18387>>ASSIGN
TGATE
     18198**DCL     18248<>CALL    18261<>CALL    18282<>CALL    18294<>CALL
TGATE.FLG
     18202**DCL     18242<<ASSIGN
TRAP#
     18211**DCL     18355<<ASSIGN  18476<<ASSIGN  18745<<ASSIGN  18759<>CALL    18764>>ASSIGN
TRIG
     18155**DCL     18326<<ASSIGN  18328<>CALL    18825<<ASSIGN  18827<>CALL
TRIG.LEVEL
     18155**DCL     18327<<ASSIGN  18826<<ASSIGN
TRIG_CLK
     18133**DCL     18326>>ASSIGN  18825>>ASSIGN
X IN PROCEDURE ACCTEX
     18772**DCL     18787<<ASSIGN  18788>>ASSIGN  18788>>ASSIGN  18789>>ASSIGN  18789>>ASSIGN
XIT
     18296**LABEL   18226--CALLALT

PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:85   
      495        1        /*T***********************************************************/
      496        2        /*T*                                                         */
      497        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      498        4        /*T*                                                         */
      499        5        /*T***********************************************************/
      500        6        /*
      501        7              Return Users Current State as Text
      502        8                                                                           */
      503        9        GHQ$STATE: PROC (USER,STATE);
      504       10
      505       11        /*F*
      506       12              NAME: GHQ$STATE
      507       13              PURPOSE:
      508       14                 To return the specified users current scheduler state as
      509       15                 a four character text string.
      510       16              CALL:
      511       17                 CALL GHQ$STATE (User-number,State);
      512       18              PARAMETERS:
      513       19                 User-number is an index to an entry in the system User Tables.
      514       20                 It is defined as BYTE CALIGNED.
      515       21                 State is a four character Scheduler State name.
      516       22                                                                           */
      517       23
      518       24        %INCLUDE GH_SCHD_M;
      519      168        %INCLUDE GH_GATE_M;
      520      209
      521      210        %G$USER (FPTN="G$USER(0:0)",STCLASS="BASED(G$USRT$)");
      522      221
      523      222    1   DCL USER UBIN;
      524      223    1   DCL STATE CHAR(4);
      525      224
      526      225        %GATE (FPTN=G_SCHDGATE,STCLASS=SYMREF);
      527      244
      528      245        %G_STTTXT (STCLASS=SYMREF);
      529      262    1   DCL G$USRT$ PTR SYMREF;
      530      263
      531      264              %LOCK (G=G_SCHDGATE);
PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:86   
      532      271    1           STATE=G_STTTXT(G$USER.US(USER));
      533      272                %UNLOCK (G=G_SCHDGATE);
      534      279    1           RETURN;
      535      280    1   END;

PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:87   
--  Include file information  --

   GH_GATE_M.:E05TOU  cannot be made into a system file and is referenced.
   GH_SCHD_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure GHQ$STATE.

   Procedure GHQ$STATE requires 53 words for executable code.
   Procedure GHQ$STATE requires 10 words of local(AUTO) storage.

    No errors detected in file GHQ$QEND.:E05TSI    .

PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:88   

 Object Unit name= GHQ$STATE                                  File name= GHQ$QEND.:E05TOU
 UTS= JUL 29 '97 21:37:17.08 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    53     35  GHQ$STATE
    1  RoData even  none     2      2  GHQ$STATE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        2  GHQ$STATE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 GHH$LOCK
 yes     yes           Std       1 GHH$UNLOCK
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     G_SCHDGATE                            G_STTTXT                              G$USRT$
r    G$ROS$
PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:89   


      495        1        /*T***********************************************************/
      496        2        /*T*                                                         */
      497        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      498        4        /*T*                                                         */
      499        5        /*T***********************************************************/
      500        6        /*
      501        7              Return Users Current State as Text
      502        8                                                                           */
      503        9        GHQ$STATE: PROC (USER,STATE);

      9   0 000000  D380 0000 0000  xent GHQ$STATE       LNJ,B5   X6A_AUTO_2
          0 000003       000A 0002                       DC       10,2

      504       10
      505       11        /*F*
      506       12              NAME: GHQ$STATE
      507       13              PURPOSE:
      508       14                 To return the specified users current scheduler state as
      509       15                 a four character text string.
      510       16              CALL:
      511       17                 CALL GHQ$STATE (User-number,State);
      512       18              PARAMETERS:
      513       19                 User-number is an index to an entry in the system User Tables.
      514       20                 It is defined as BYTE CALIGNED.
      515       21                 State is a four character Scheduler State name.
      516       22                                                                           */
      517       23
      518       24        %INCLUDE GH_SCHD_M;
      519      168        %INCLUDE GH_GATE_M;
      520      209
      521      210        %G$USER (FPTN="G$USER(0:0)",STCLASS="BASED(G$USRT$)");
      522      221
      523      222    1   DCL USER UBIN;
      524      223    1   DCL STATE CHAR(4);
      525      224
      526      225        %GATE (FPTN=G_SCHDGATE,STCLASS=SYMREF);
PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:90   
      527      244
      528      245        %G_STTTXT (STCLASS=SYMREF);
      529      262    1   DCL G$USRT$ PTR SYMREF;
      530      263
      531      264              %LOCK (G=G_SCHDGATE);

    269   0 000005  BB80 0000 0000  01                   LAB,B3   0
          0 000008  CBF0 0100                            LAB,B4   256,IMO
          0 00000A  E380 0000 0000  xent                 LNJ,B6   GHH$LOCK
          0 00000D       0001                            DC       s:271,PREL

      532      271    1           STATE=G_STTTXT(G$USER.US(USER));

    271   0 00000E  8CC7 0006                            LDI      @STATE,AUTO
          0 000010  B856                                 LDR,R3   R6
          0 000011  E570 7FFF                            AND,R6   32767,IMO
          0 000013  8D47 0008                            SDI      @STATE+2,AUTO
          0 000015  ECC7 0008                            LDB,B6   @STATE+2,AUTO
          0 000017  304F                                 SOR,R3   15
          0 000018  DCC7 0004                            LDB,B5   @USER,AUTO
          0 00001A  A805                                 LDR,R2   ,B5
          0 00001B  CC80 0000 0000  xsym                 LDB,B4   G$USRT$
          0 00001E  2F18                                 MLV,R2   24
          0 00001F  2E02                                 ADV,R2   2
          0 000020  9824                                 LDR,R1   ,B4,R2
          0 000021  AB80 0000 0000  xsym                 LAB,B2   G_STTTXT
          0 000024  A851                                 LDR,R2   R1
          0 000025  2002                                 SOL,R2   2
          0 000026  6C04                                 LDV,R6   4
          0 000027  BB86                                 LAB,B3   ,B6
          0 000028  0008                                 MMM

      533      272                %UNLOCK (G=G_SCHDGATE);

    277   0 000029  BB80 0000 0000  01                   LAB,B3   0
          0 00002C  CBF0 0100                            LAB,B4   256,IMO
          0 00002E  E380 0000 0000  xent                 LNJ,B6   GHH$UNLOCK
PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:91   
          0 000031       0001                            DC       s:279,PREL

      534      279    1           RETURN;

    279   0 000032  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      535      280    1   END;

PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:92   
--  Include file information  --

   GH_GATE_M.:E05TOU  cannot be made into a system file and is referenced.
   GH_SCHD_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure GHQ$STATE.
PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:93   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 @STATE                     4-0-0/w PTR         r     1 @USER
    *0-0-0/c CHAR(4)     r     1 STATE                     *0-0-0/w UBIN(16)    r     1 USER

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$USRT$                    0-0-0/w STRC(48)    r     1 G_SCHDGATE
     0-0-0/c CHAR(4)     r     1 G_STTTXT(0:31)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(384)   r     1 G$USER(0:0)


   Procedure GHQ$STATE requires 53 words for executable code.
   Procedure GHQ$STATE requires 10 words of local(AUTO) storage.

    No errors detected in file GHQ$QEND.:E05TSI    .
PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:94   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=GHQ$STATE File=GHQ$QEND.:E05TSI                               TUE 07/29/97 21:37 Page:95   
          MINI XREF LISTING

G$USER.MISC
       216**DCL       216--REDEF
G$USER.US
       216**DCL       271>>ASSIGN
G$USRT$
       262**DCL       215--IMP-PTR   271>>ASSIGN
GHH$LOCK
       208**DCL-ENT   269--CALL
GHH$UNLOCK
       208**DCL-ENT   277--CALL
G_SCHDGATE
       237**DCL       269<>CALL      277<>CALL
G_STTTXT
       258**DCL       271>>ASSIGN
STATE
       223**DCL         9--PROC      271<<ASSIGN
USER
       222**DCL         9--PROC      271>>ASSIGN
