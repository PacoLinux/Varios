VERSION E05

PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:1    
        1        1        /*M*   IRI$INIT  Recovery initialization that can be done in PL6  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,MEC,MOC,EXM=1,CLM=30,CRM=78,ENU=0,ECU=0 */
        8        8
        9        9        IRI$INIT: PROC ALTRET;
       10       10
       11       11                                      /* AUTO                                       */
       12       12    1   DCL POBUF$ PTR;
       13       13    1   DCL RBUF$ PTR;
       14       14    1   DCL T$ PTR;
       15       15    1   DCL I SBIN WORD;
       16       16    1   DCL B$JIT$ PTR;
       17       17    1   DCL DEBUGM SBIN;
       18       18
       19       19                                      /* MACRO FILES                                */
       20       20        %INCLUDE CP_6;
       21     5579        %INCLUDE IR_DATA_M;
       22     5743        %INCLUDE NI$TABLES;
       23     5959
       24     5960                                      /*CONSTANT - STATIC DATA                      */
       25     5961    1   DCL RVM_IDM CONSTANT CHAR(28) INIT(
       26     5962    1   'RCVR-SCREECH ID XnnXnnn-i   '); /* Pad to word boundry                     */
       27     5963    1   DCL RVM_DUMPFB CONSTANT CHAR(68) INIT(
       28     5964    1        '**************************************** RCVR-ALL DUMP SLOTS BUSY');
       29     5965    1   DCL RVM_DUMPFS CONSTANT CHAR(64) INIT(
       30     5966    1        '**************************************** RCVR-SNAP DUMP SKIPPED');
       31     5967    1   DCL RVM_FEPDFS CONSTANT CHAR(64) INIT(
       32     5968    1        '**************************************** RCVR-FEP  DUMP SKIPPED');
       33     5969    1   DCL RVM_DUMPFF CONSTANT CHAR(68) INIT(
       34     5970    1        '**************************************** RCVR-LAST DUMP SLOT USED');
       35     5971    1   DCL RVM_NODUMP CONSTANT CHAR(72) INIT(
       36     5972    1        '**************************************** RCVR-NO DUMP AREA ON SYS DISK');
       37     5973
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:2    
       38     5974        %VLP_SCODE (FPTN=DUMP_ALL, ALLUSR=YES,
       39     5975                     SPBUF=YES, FMBUF=YES, ROSEG=YES);
       40     6036
       41     6037                                      /*  RECOVERY SYMREFS                          */
       42     6038        %RV_BUFF (STCLASS=SYMREF);
       43     6074        %RV_USRDIR (STCLASS=SYMREF);
       44     6078
       45     6079    1   DCL R$CU$ PTR SYMREF;
       46     6080    1   DCL R$USRT$ PTR SYMREF;
       47     6081
       48     6082    1   DCL RV_ATTEMPTS SBIN SYMREF;
       49     6083    1   DCL RV_BOOTFLAG SBIN SYMREF;
       50     6084    1   DCL RV_BUFFGRAN SBIN SYMREF;
       51     6085    1   DCL RV_CUN SBIN SYMREF;
       52     6086    1   DCL RV_DEBUGM SBIN SYMREF;
       53     6087    1   DCL RV_DINDEXA SBIN SYMREF;
       54     6088    1   DCL RV_LASTGRAN SBIN SYMREF;
       55     6089    1   DCL RV_MAXGRAN  SBIN SYMREF;
       56     6090    1   DCL RV_MUAIS SBIN SYMREF;
       57     6091    1   DCL RV_NODUMPG SBIN SYMREF;
       58     6092    1   DCL RV_NXTGRAN  SBIN SYMREF;
       59     6093    1   DCL RV_PDUMP  SBIN SYMREF;
       60     6094    1   DCL RV_SCODEA BIT(72) SYMREF DALIGNED;
       61     6095    1   DCL RV_SEV7SZ SBIN SYMREF;
       62     6096    1   DCL RV_USRDRDA SBIN SYMREF;
       63     6097    1   DCL RV_USRTYP UBIN(18) SYMREF;
       64     6098    1   DCL RV_WDGRAN SBIN SYMREF;
       65     6099                                      /* AARDVARK SYMREFS                           */
       66     6100    1   DCL 1 IDBUF SYMREF,
       67     6101    1         2 CNT UBIN,
       68     6102    1         2 TXT CHAR(28);
       69     6103    1   DCL MONPLL UBIN(36) SYMREF;
       70     6104    1   DCL POBUF(0:1023) BIT(36) SYMREF;
       71     6105    1   DCL TOPDA UBIN(36) SYMREF;
       72     6106
       73     6107                                      /* ENTREFS                                    */
       74     6108    1   DCL IRR$READBUF ENTRY ALTRET;
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:3    
       75     6109    1   DCL IRR$WWSQD ENTRY;
       76     6110    1   DCL IRR$GIVEUP ENTRY;
       77     6111    1   DCL IRR$TYPE6M ENTRY(2);
       78     6112
       79     6113                                      /* BASED STRUCTURES                           */
       80     6114        %INCLUDE B$USER;
       81     6330        %INCLUDE I$DISK;
       82     6582        %INCLUDE U$JIT_C;
       83     7081        %RV_BUFF (NAME=RV$BUFF,STCLASS=BASED);
       84     7117
       85     7118    1   DCL 1 B$IDM BASED,
       86     7119    1         2 TXT CHAR(16) UNAL,
       87     7120    1         2 VER,
       88     7121    1           3 VERC CHAR(3) UNAL,
       89     7122    1           3 BOOTC CHAR(1) UNAL,
       90     7123    1         2 SCOUNT CHAR(3) UNAL,
       91     7124    1         2 * CHAR(1) UNAL,
       92     7125    1         2 IND CHAR(1) UNAL;
       93     7126
       94     7127    1   DCL 1 B$SCODE BASED ALIGNED,
       95     7128    1         2 * BIT(36),
       96     7129    1         2 DUMP_BITS BIT(36);
       97     7130
       98     7131    1   DCL B$CUSRTBL(0:15) UBIN WORD BASED;
       99     7132                                      /* STRING SUBSTITUTIONS                       */
      100     7133        %INCLUDE CP_6_SUBS;
      101     7673        %INCLUDE I_SUBS_C;
      102     7697        %SUB I$DISKDIR=POBUF$->I$DISKDIR;
      103     7698
      104     7699        %EJECT;
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:4    
      105     7700                                      /* IRI$INIT                                   */
      106     7701                                      /* ENTERED WITH SYSTEM DISKDIR IN POBUF       */
      107     7702    1      POBUF$=ADDR(POBUF);
      108     7703    1      RBUF$=ADDR(RV_USRDIR);
      109     7704    1      DEBUGM = RV_DEBUGM;
      110     7705
      111     7706    1      IF (I$DISKDIR.DUMP.SIZE=0) OR (I$DISKDIR.DUMP.DA=0)
      112     7707    2      THEN DO;
      113     7708    2           RV_DEBUGM = 1;
      114     7709    2           CALL IRR$TYPE6M(RVM_NODUMP,SIZEW(RVM_NODUMP));
      115     7710    2           GOTO RVI_ALT;
      116     7711    2           END;
      117     7712        /*O*   MESSAGE:   RCVR-NO DUMP AREA ON SYS DISK
      118     7713               MEANING:   Either the system area pack was built
      119     7714                          with no dump area or the System Area
      120     7715                          Directory has been clobbered.
      121     7716        */
      122     7717    1      RV_LASTGRAN = I$DISKDIR.DUMP.DA
      123     7718    1        + I$DISKDIR.DUMP.SIZE
      124     7719    1        - 1;
      125     7720    1      RV_SEV7SZ = (RV_MUAIS / (1024 / LENGTHW(B$JIT)) ) +1
      126     7721    1        + 4                      /* For Monitor Jit, Hjit, and Tstack          */
      127     7722    1        + 3                      /* For User Jit, Hjit, and Tstack             */
      128     7723    1        + RV_BUFF.EL_MAXPGS;
      129     7724    1      I$DISKDIR.DUMP.SCOUNT = I$DISKDIR.DUMP.SCOUNT+1;
      130     7725                                      /* FINISH INITIALIZING RECOVERY BUFFER        */
      131     7726    1      RV_BUFF.BUSY = 1;
      132     7727    1      RV_BUFF.SCOUNT = I$DISKDIR.DUMP.SCOUNT;
      133     7728    1      RV_BUFF.AMONID = I$DISKDIR.MONID.A;
      134     7729    1      RV_BUFF.DMONID = I$DISKDIR.MONID.M;
      135     7730    1      RV_BUFF.TAPE_ID = IDBUF.TXT;
      136     7731    1      RV_BUFF.MONPLL = MONPLL;
      137     7732    1      R$CU$ = ADDR(R$USRT$->B$USER(RV_CUN));
      138     7733    1      RV_BUFF.C_USRTBL = R$CU$->B$CUSRTBL;
      139     7734
      140     7735    1      RV_DINDEXA = %RV_SYSDDUMP#;
      141     7736    1      RV_BUFFGRAN = I$DISKDIR.DUMP.DA;
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:5    
      142     7737                                      /*
      143     7738                                      Reclaim the granules from converted dumps
      144     7739                                      */
      145     7740    1      RV_NODUMPG=0;
      146     7741    1      RV_PDUMP=0;
      147     7742    1      I=RV_DINDEXA-1;
      148     7743    2      DO WHILE (I>=0);
      149     7744    2           IF I$DISKDIR.RCVR2.DA(I) ~=0
      150     7745    3           THEN DO;              /* If this dump area is (or was) in use       */
      151     7746    3                RV_WDGRAN = I$DISKDIR.RCVR2.DA(I);
      152     7747    3                CALL IRR$READBUF ALTRET(GOT_INDEX);
      153     7748                                      /*Read gran 0 - dump#(I) into RV_USRDIR       */
      154     7749    3                IF RBUF$->RV$BUFF.BUSY = 0
      155     7750    4                THEN DO;         /*If RCVR2 is done                            */
      156     7751    4                     RV_BUFFGRAN = RV_WDGRAN;
      157     7752    4                     I$DISKDIR.RCVR2.DA(I) = 0;
      158     7753    4                     RV_DINDEXA=I;
      159     7754    4                     END;
      160     7755    4                ELSE DO;
      161     7756    4                     RV_DINDEXA=I+1;
      162     7757    4                     RV_BUFFGRAN = I$DISKDIR.RCVR2.DA(I)
      163     7758    4                       + RBUF$->RV$BUFF.SIZE;
      164     7759    4                     GOTO GOT_INDEX;
      165     7760    4                     END;
      166     7761    3                END;
      167     7762    3           ELSE DO;
      168     7763    3                RV_DINDEXA=I;
      169     7764    3                END;
      170     7765    2           I=I-1;
      171     7766    2           END;                  /*DO WHILE I>=0                               */
      172     7767
      173     7768    1   GOT_INDEX: ;
      174     7769                                 /* Re-write disk directory with updated scount     */
      175     7770    1      RV_WDGRAN = TOPDA;
      176     7771    1      CALL IRR$WWSQD;
      177     7772                                      /* Report the Screech ID                      */
      178     7773    1      I=I$DISKDIR.DUMP.SCOUNT;
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:6    
      179     7774    2      DO WHILE (I>999);
      180     7775    2           I=I-999;
      181     7776    2           END;
      182     7777    1      RV_BUFF.IDCOUNT = I;
      183     7778    1      T$=ADDR(RVM_IDM);
      184     7779    1      T$->B$IDM.VER=I$DISKDIR.MONID.M;
      185     7780    1      CALL BINCHAR(T$->B$IDM.SCOUNT,I);
      186     7781    1      CALL BINCHAR(T$->B$IDM.IND,RV_DINDEXA);
      187     7782    1      CALL IRR$TYPE6M(RVM_IDM,SIZEW(RVM_IDM));
      188     7783
      189     7784        /*O*   MESSAGE:   RCVR-SCREECH ID VERcnn-I
      190     7785               MEANING:   Identifies the unique Screech ID.
      191     7786                          May be useful when the OC log
      192     7787                          arrives with a dump file.
      193     7788        */
      194     7789
      195     7790    1      RV_DEBUGM = 1;
      196     7791    1      IF RV_DINDEXA = %RV_SYSDDUMP#
      197     7792    2      THEN DO;              /*If no dump slot available-should never happen    */
      198     7793    2           CALL IRR$TYPE6M(RVM_DUMPFB,SIZEW(RVM_DUMPFB));
      199     7794        /*O*   MESSAGE:   RCVR-ALL DUMP SLOTS BUSY
      200     7795               MEANING:   SCREECHing faster than dump files
      201     7796                          can be converted.
      202     7797        */
      203     7798    2           RV_ATTEMPTS = RV_ATTEMPTS + 1;
      204     7799    2           IF RV_ATTEMPTS > 2 THEN CALL IRR$GIVEUP;
      205     7800    2           RV_BOOTFLAG = I_RCVR_DUMPF;
      206     7801    2           RV_BUFF.RCODE.SEV = %SEV_SCREECH#;
      207     7802    2           GOTO RVI_ALT;
      208     7803    2           END;
      209     7804
      210     7805    1      ELSE RV_ATTEMPTS = 0;
      211     7806    1      I$DISKDIR.RCVR2.DA(RV_DINDEXA) = RV_BUFFGRAN;
      212     7807    1      I$DISKDIR.DUMP.LDUMP = RV_DINDEXA;
      213     7808    1      RV_BOOTFLAG = I_RECOVERY;  /*Assume normal                               */
      214     7809    1      IF RV_DINDEXA = %RV_SYSDDUMP#-1
      215     7810    2      THEN DO;
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:7    
      216     7811                                      /*When using the last available dump slot     */
      217     7812    2           IF RV_BUFF.RCODE.SEV = %SEV_SNAP#
      218     7813    3           THEN DO;
      219     7814    3                CALL IRR$TYPE6M(RVM_DUMPFS,SIZEW(RVM_DUMPFS));
      220     7815    3                GOTO RVI_ALT;
      221     7816    3                END;
      222     7817
      223     7818    2           IF RV_BUFF.RCODE.SEV = %SEV_FESNAP#
      224     7819    3           THEN DO;
      225     7820    3                CALL IRR$TYPE6M(RVM_FEPDFS,SIZEW(RVM_FEPDFS));
      226     7821
      227     7822        /*O*   MESSAGE:   RCVR-SNAP DUMP SKIPPED
      228     7823               MEANING:   All but last dump slot on the system
      229     7824                          disk was busy when Recovery was called
      230     7825                          to do a snapshot dump.
      231     7826        */
      232     7827    3   RVI_ALT:     ;
      233     7828    3                RV_PDUMP=RV_PDUMP+1;
      234     7829    3                RV_NODUMPG=RV_NODUMPG+1;
      235     7830    3                RV_SCODEA = RV_BUFF.RCODE;
      236     7831    3                RV_DEBUGM = DEBUGM;
      237     7832    3                ALTRETURN;
      238     7833    3                END;
      239     7834    3           ELSE DO;
      240     7835    3                RV_BOOTFLAG=I_RCVR_DUMPF;
      241     7836    3                IF RV_BUFF.RCODE.SEV ~= %SEV_ZAP#
      242     7837    4                THEN DO;
      243     7838    4                     RV_BUFF.RCODE.SEV = %SEV_SCREECH#;
      244     7839
      245     7840    4                     ADDR(RV_BUFF.RCODE)->B$SCODE.DUMP_BITS =
      246     7841    4                       ( ADDR(RV_BUFF.RCODE)->B$SCODE.DUMP_BITS
      247     7842    4                       | ADDR(DUMP_ALL)->B$SCODE.DUMP_BITS);
      248     7843    4                     END;
      249     7844    3                CALL IRR$TYPE6M(RVM_DUMPFF,SIZEW(RVM_DUMPFF));
      250     7845        /*O*   MESSAGE:   RCVR- LAST DUMP FILE USED
      251     7846               MEANING:   The last slot allocated for Recovery dumps
      252     7847                          on the System Disk has been used.  A SUA
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:8    
      253     7848                          or SNAP will be converted to a full SCREECH.
      254     7849                          No users will be allowed to log on until
      255     7850                          all dump files have been converted to keyed
      256     7851                          files.
      257     7852        */
      258     7853    3                END;
      259     7854
      260     7855    2           END;                  /*DO if using the last slot                   */
      261     7856
      262     7857    1      RV_DEBUGM = DEBUGM;
      263     7858    1      RV_WDGRAN = TOPDA;
      264     7859    1      CALL IRR$WWSQD;
      265     7860                                 /*Re-write disk directory with 1st gran-this dump. */
      266     7861    1      RV_USRDRDA = RV_BUFFGRAN+1;
      267     7862    1      RV_NXTGRAN = RV_USRDRDA+1;
      268     7863    1      IF RV_BUFF.RCODE.SEV = %SEV_SCREECH#
      269     7864    1      THEN RV_MAXGRAN = RV_LASTGRAN;
      270     7865    1      ELSE RV_MAXGRAN=RV_LASTGRAN-RV_SEV7SZ;
      271     7866    1      RV_BUFF.MAXGRAN = RV_MAXGRAN;
      272     7867    1   RVI_EXIT: ;
      273     7868    1      RV_SCODEA = RV_BUFF.RCODE;
      274     7869    1      RV_BUFF.DINDEX=RV_DINDEXA;
      275     7870    1      RETURN;
      276     7871    1   END IRI$INIT;

PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:9    
--  Include file information  --

   I_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   U$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   I$DISK.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   IR_DATA_M.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure IRI$INIT.

   Procedure IRI$INIT requires 224 words for executable code.
   Procedure IRI$INIT requires 10 words of local(AUTO) storage.

    No errors detected in file IRI$INIT.:E05TSI    .

PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:10   

 Object Unit name= IRI$INIT                                   File name= IRI$INIT.:E05TOU
 UTS= JUL 29 '97 22:45:56.24 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     91    133  IRI$INIT
    2   Data  even  none     2      2  IRI$INIT
    3   Proc  even  none   224    340  IRI$INIT
    4  RoData even  none    18     22  IRI$INIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        0  IRI$INIT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 IRR$TYPE6M
 yes     yes           Std       0 IRR$READBUF
         yes           Std       0 IRR$GIVEUP
         yes           Std       0 IRR$WWSQD
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:11   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  RV_BUFF                               RV_USRDIR
     R$CU$                                 R$USRT$                               RV_ATTEMPTS
     RV_BOOTFLAG                           RV_BUFFGRAN                           RV_CUN
     RV_DEBUGM                             RV_DINDEXA                            RV_LASTGRAN
     RV_MAXGRAN                            RV_MUAIS                              RV_NODUMPG
     RV_NXTGRAN                            RV_PDUMP                              RV_SCODEA
     RV_SEV7SZ                             RV_USRDRDA                            RV_WDGRAN
     IDBUF                                 MONPLL                                POBUF
     TOPDA                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:12   


        1        1        /*M*   IRI$INIT  Recovery initialization that can be done in PL6  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,MEC,MOC,EXM=1,CLM=30,CRM=78,ENU=0,ECU=0 */
        8        8
        9        9        IRI$INIT: PROC ALTRET;

      9  3 000000   000000 700200 xent  IRI$INIT     TSX0  ! X66_AUTO_0
         3 000001   000012 000000                    ZERO    10,0

       10       10
       11       11                                      /* AUTO                                       */
       12       12    1   DCL POBUF$ PTR;
       13       13    1   DCL RBUF$ PTR;
       14       14    1   DCL T$ PTR;
       15       15    1   DCL I SBIN WORD;
       16       16    1   DCL B$JIT$ PTR;
       17       17    1   DCL DEBUGM SBIN;
       18       18
       19       19                                      /* MACRO FILES                                */
       20       20        %INCLUDE CP_6;
       21     5579        %INCLUDE IR_DATA_M;
       22     5743        %INCLUDE NI$TABLES;
       23     5959
       24     5960                                      /*CONSTANT - STATIC DATA                      */
       25     5961    1   DCL RVM_IDM CONSTANT CHAR(28) INIT(
       26     5962    1   'RCVR-SCREECH ID XnnXnnn-i   '); /* Pad to word boundry                     */
       27     5963    1   DCL RVM_DUMPFB CONSTANT CHAR(68) INIT(
       28     5964    1        '**************************************** RCVR-ALL DUMP SLOTS BUSY');
       29     5965    1   DCL RVM_DUMPFS CONSTANT CHAR(64) INIT(
       30     5966    1        '**************************************** RCVR-SNAP DUMP SKIPPED');
       31     5967    1   DCL RVM_FEPDFS CONSTANT CHAR(64) INIT(
       32     5968    1        '**************************************** RCVR-FEP  DUMP SKIPPED');
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:13   
       33     5969    1   DCL RVM_DUMPFF CONSTANT CHAR(68) INIT(
       34     5970    1        '**************************************** RCVR-LAST DUMP SLOT USED');
       35     5971    1   DCL RVM_NODUMP CONSTANT CHAR(72) INIT(
       36     5972    1        '**************************************** RCVR-NO DUMP AREA ON SYS DISK');
       37     5973
       38     5974        %VLP_SCODE (FPTN=DUMP_ALL, ALLUSR=YES,
       39     5975                     SPBUF=YES, FMBUF=YES, ROSEG=YES);
       40     6036
       41     6037                                      /*  RECOVERY SYMREFS                          */
       42     6038        %RV_BUFF (STCLASS=SYMREF);
       43     6074        %RV_USRDIR (STCLASS=SYMREF);
       44     6078
       45     6079    1   DCL R$CU$ PTR SYMREF;
       46     6080    1   DCL R$USRT$ PTR SYMREF;
       47     6081
       48     6082    1   DCL RV_ATTEMPTS SBIN SYMREF;
       49     6083    1   DCL RV_BOOTFLAG SBIN SYMREF;
       50     6084    1   DCL RV_BUFFGRAN SBIN SYMREF;
       51     6085    1   DCL RV_CUN SBIN SYMREF;
       52     6086    1   DCL RV_DEBUGM SBIN SYMREF;
       53     6087    1   DCL RV_DINDEXA SBIN SYMREF;
       54     6088    1   DCL RV_LASTGRAN SBIN SYMREF;
       55     6089    1   DCL RV_MAXGRAN  SBIN SYMREF;
       56     6090    1   DCL RV_MUAIS SBIN SYMREF;
       57     6091    1   DCL RV_NODUMPG SBIN SYMREF;
       58     6092    1   DCL RV_NXTGRAN  SBIN SYMREF;
       59     6093    1   DCL RV_PDUMP  SBIN SYMREF;
       60     6094    1   DCL RV_SCODEA BIT(72) SYMREF DALIGNED;
       61     6095    1   DCL RV_SEV7SZ SBIN SYMREF;
       62     6096    1   DCL RV_USRDRDA SBIN SYMREF;
       63     6097    1   DCL RV_USRTYP UBIN(18) SYMREF;
       64     6098    1   DCL RV_WDGRAN SBIN SYMREF;
       65     6099                                      /* AARDVARK SYMREFS                           */
       66     6100    1   DCL 1 IDBUF SYMREF,
       67     6101    1         2 CNT UBIN,
       68     6102    1         2 TXT CHAR(28);
       69     6103    1   DCL MONPLL UBIN(36) SYMREF;
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:14   
       70     6104    1   DCL POBUF(0:1023) BIT(36) SYMREF;
       71     6105    1   DCL TOPDA UBIN(36) SYMREF;
       72     6106
       73     6107                                      /* ENTREFS                                    */
       74     6108    1   DCL IRR$READBUF ENTRY ALTRET;
       75     6109    1   DCL IRR$WWSQD ENTRY;
       76     6110    1   DCL IRR$GIVEUP ENTRY;
       77     6111    1   DCL IRR$TYPE6M ENTRY(2);
       78     6112
       79     6113                                      /* BASED STRUCTURES                           */
       80     6114        %INCLUDE B$USER;
       81     6330        %INCLUDE I$DISK;
       82     6582        %INCLUDE U$JIT_C;
       83     7081        %RV_BUFF (NAME=RV$BUFF,STCLASS=BASED);
       84     7117
       85     7118    1   DCL 1 B$IDM BASED,
       86     7119    1         2 TXT CHAR(16) UNAL,
       87     7120    1         2 VER,
       88     7121    1           3 VERC CHAR(3) UNAL,
       89     7122    1           3 BOOTC CHAR(1) UNAL,
       90     7123    1         2 SCOUNT CHAR(3) UNAL,
       91     7124    1         2 * CHAR(1) UNAL,
       92     7125    1         2 IND CHAR(1) UNAL;
       93     7126
       94     7127    1   DCL 1 B$SCODE BASED ALIGNED,
       95     7128    1         2 * BIT(36),
       96     7129    1         2 DUMP_BITS BIT(36);
       97     7130
       98     7131    1   DCL B$CUSRTBL(0:15) UBIN WORD BASED;
       99     7132                                      /* STRING SUBSTITUTIONS                       */
      100     7133        %INCLUDE CP_6_SUBS;
      101     7673        %INCLUDE I_SUBS_C;
      102     7697        %SUB I$DISKDIR=POBUF$->I$DISKDIR;
      103     7698
      104     7699        %EJECT;
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:15   
      105     7700                                      /* IRI$INIT                                   */
      106     7701                                      /* ENTERED WITH SYSTEM DISKDIR IN POBUF       */
      107     7702    1      POBUF$=ADDR(POBUF);

   7702  3 000002   000000 236000 4                  LDQ     0
         3 000003   200003 756100                    STQ     POBUF$,,AUTO

      108     7703    1      RBUF$=ADDR(RV_USRDIR);

   7703  3 000004   000001 236000 4                  LDQ     1
         3 000005   200004 756100                    STQ     RBUF$,,AUTO

      109     7704    1      DEBUGM = RV_DEBUGM;

   7704  3 000006   000000 235000 xsym               LDA     RV_DEBUGM
         3 000007   200010 755100                    STA     DEBUGM,,AUTO

      110     7705
      111     7706    1      IF (I$DISKDIR.DUMP.SIZE=0) OR (I$DISKDIR.DUMP.DA=0)

   7706  3 000010   200003 470500                    LDP0    POBUF$,,AUTO
         3 000011   000202 235100                    LDA     130,,PR0
         3 000012   000015 600000 3                  TZE     s:7708
         3 000013   000201 235100                    LDA     129,,PR0
         3 000014   000024 601000 3                  TNZ     s:7717

      112     7707    2      THEN DO;

      113     7708    2           RV_DEBUGM = 1;

   7708  3 000015   000001 235007                    LDA     1,DL
         3 000016   000000 755000 xsym               STA     RV_DEBUGM

      114     7709    2           CALL IRR$TYPE6M(RVM_NODUMP,SIZEW(RVM_NODUMP));

   7709  3 000017   000003 630400 4                  EPPR0   3
         3 000020   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:16   
         3 000021   000000 701000 xent               TSX1    IRR$TYPE6M
         3 000022   000000 011000                    NOP     0

      115     7710    2           GOTO RVI_ALT;

   7710  3 000023   000257 710000 3                  TRA     RVI_ALT

      116     7711    2           END;
      117     7712        /*O*   MESSAGE:   RCVR-NO DUMP AREA ON SYS DISK
      118     7713               MEANING:   Either the system area pack was built
      119     7714                          with no dump area or the System Area
      120     7715                          Directory has been clobbered.
      121     7716        */
      122     7717    1      RV_LASTGRAN = I$DISKDIR.DUMP.DA

   7717  3 000024   000201 236100                    LDQ     129,,PR0
         3 000025   000202 036100                    ADLQ    130,,PR0
         3 000026   000001 136007                    SBLQ    1,DL
         3 000027   000000 756000 xsym               STQ     RV_LASTGRAN

      123     7718    1        + I$DISKDIR.DUMP.SIZE
      124     7719    1        - 1;
      125     7720    1      RV_SEV7SZ = (RV_MUAIS / (1024 / LENGTHW(B$JIT)) ) +1

   7720  3 000030   000000 236000 xsym               LDQ     RV_MUAIS
         3 000031   000004 506007                    DIV     4,DL
         3 000032   000263 036000 xsym               ADLQ    RV_BUFF+179
         3 000033   000010 036007                    ADLQ    8,DL
         3 000034   000000 756000 xsym               STQ     RV_SEV7SZ

      126     7721    1        + 4                      /* For Monitor Jit, Hjit, and Tstack          */
      127     7722    1        + 3                      /* For User Jit, Hjit, and Tstack             */
      128     7723    1        + RV_BUFF.EL_MAXPGS;
      129     7724    1      I$DISKDIR.DUMP.SCOUNT = I$DISKDIR.DUMP.SCOUNT+1;

   7724  3 000035   000200 235100                    LDA     128,,PR0
         3 000036   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:17   
         3 000037   000200 755100                    STA     128,,PR0

      130     7725                                      /* FINISH INITIALIZING RECOVERY BUFFER        */
      131     7726    1      RV_BUFF.BUSY = 1;

   7726  3 000040   000001 235007                    LDA     1,DL
         3 000041   000000 755000 xsym               STA     RV_BUFF

      132     7727    1      RV_BUFF.SCOUNT = I$DISKDIR.DUMP.SCOUNT;

   7727  3 000042   000200 235100                    LDA     128,,PR0
         3 000043   000001 755000 xsym               STA     RV_BUFF+1

      133     7728    1      RV_BUFF.AMONID = I$DISKDIR.MONID.A;

   7728  3 000044   000210 236100                    LDQ     136,,PR0
         3 000045   000270 756000 xsym               STQ     RV_BUFF+184

      134     7729    1      RV_BUFF.DMONID = I$DISKDIR.MONID.M;

   7729  3 000046   000211 236100                    LDQ     137,,PR0
         3 000047   000271 756000 xsym               STQ     RV_BUFF+185

      135     7730    1      RV_BUFF.TAPE_ID = IDBUF.TXT;

   7730  3 000050   040000 100400                    MLR     fill='040'O
         3 000051   000001 000034 xsym               ADSC9   IDBUF+1                  cn=0,n=28
         3 000052   000300 000034 xsym               ADSC9   RV_BUFF+192              cn=0,n=28

      136     7731    1      RV_BUFF.MONPLL = MONPLL;

   7731  3 000053   000000 235000 xsym               LDA     MONPLL
         3 000054   000274 755000 xsym               STA     RV_BUFF+188

      137     7732    1      R$CU$ = ADDR(R$USRT$->B$USER(RV_CUN));

   7732  3 000055   000000 236000 xsym               LDQ     RV_CUN
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:18   
         3 000056   000026 736000                    QLS     22
         3 000057   000000 036000 xsym               ADLQ    R$USRT$
         3 000060   000000 756000 xsym               STQ     R$CU$

      138     7733    1      RV_BUFF.C_USRTBL = R$CU$->B$CUSRTBL;

   7733  3 000061   000000 471400 xsym               LDP1    R$CU$
         3 000062   000000 100500                    MLR     fill='000'O
         3 000063   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64
         3 000064   000164 000100 xsym               ADSC9   RV_BUFF+116              cn=0,n=64

      139     7734
      140     7735    1      RV_DINDEXA = %RV_SYSDDUMP#;

   7735  3 000065   000004 235007                    LDA     4,DL
         3 000066   000000 755000 xsym               STA     RV_DINDEXA

      141     7736    1      RV_BUFFGRAN = I$DISKDIR.DUMP.DA;

   7736  3 000067   000201 235100                    LDA     129,,PR0
         3 000070   000000 755000 xsym               STA     RV_BUFFGRAN

      142     7737                                      /*
      143     7738                                      Reclaim the granules from converted dumps
      144     7739                                      */
      145     7740    1      RV_NODUMPG=0;

   7740  3 000071   000000 450000 xsym               STZ     RV_NODUMPG

      146     7741    1      RV_PDUMP=0;

   7741  3 000072   000000 450000 xsym               STZ     RV_PDUMP

      147     7742    1      I=RV_DINDEXA-1;

   7742  3 000073   000000 235000 xsym               LDA     RV_DINDEXA
         3 000074   000001 135007                    SBLA    1,DL
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:19   
         3 000075   200006 755100                    STA     I,,AUTO

      148     7743    2      DO WHILE (I>=0);

   7743  3 000076   000140 604000 3                  TMI     GOT_INDEX

      149     7744    2           IF I$DISKDIR.RCVR2.DA(I) ~=0

   7744  3 000077   200003 470500                    LDP0    POBUF$,,AUTO
         3 000100   200006 720100                    LXL0    I,,AUTO
         3 000101   000204 235110                    LDA     132,X0,PR0
         3 000102   000133 600000 3                  TZE     s:7763

      150     7745    3           THEN DO;              /* If this dump area is (or was) in use       */

      151     7746    3                RV_WDGRAN = I$DISKDIR.RCVR2.DA(I);

   7746  3 000103   000000 755000 xsym               STA     RV_WDGRAN

      152     7747    3                CALL IRR$READBUF ALTRET(GOT_INDEX);

   7747  3 000104   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000105   000000 701000 xent               TSX1    IRR$READBUF
         3 000106   000140 702000 3                  TSX2    GOT_INDEX

      153     7748                                      /*Read gran 0 - dump#(I) into RV_USRDIR       */
      154     7749    3                IF RBUF$->RV$BUFF.BUSY = 0

   7749  3 000107   200004 470500                    LDP0    RBUF$,,AUTO
         3 000110   000000 235100                    LDA     0,,PR0
         3 000111   000122 601000 3                  TNZ     s:7756

      155     7750    4                THEN DO;         /*If RCVR2 is done                            */

      156     7751    4                     RV_BUFFGRAN = RV_WDGRAN;

   7751  3 000112   000000 236000 xsym               LDQ     RV_WDGRAN
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:20   
         3 000113   000000 756000 xsym               STQ     RV_BUFFGRAN

      157     7752    4                     I$DISKDIR.RCVR2.DA(I) = 0;

   7752  3 000114   200003 471500                    LDP1    POBUF$,,AUTO
         3 000115   200006 720100                    LXL0    I,,AUTO
         3 000116   100204 450110                    STZ     132,X0,PR1

      158     7753    4                     RV_DINDEXA=I;

   7753  3 000117   200006 235100                    LDA     I,,AUTO
         3 000120   000000 755000 xsym               STA     RV_DINDEXA

      159     7754    4                     END;

   7754  3 000121   000135 710000 3                  TRA     s:7765

      160     7755    4                ELSE DO;

      161     7756    4                     RV_DINDEXA=I+1;

   7756  3 000122   200006 236100                    LDQ     I,,AUTO
         3 000123   000001 036007                    ADLQ    1,DL
         3 000124   000000 756000 xsym               STQ     RV_DINDEXA

      162     7757    4                     RV_BUFFGRAN = I$DISKDIR.RCVR2.DA(I)

   7757  3 000125   200003 471500                    LDP1    POBUF$,,AUTO
         3 000126   200006 720100                    LXL0    I,,AUTO
         3 000127   100204 236110                    LDQ     132,X0,PR1
         3 000130   000002 036100                    ADLQ    2,,PR0
         3 000131   000000 756000 xsym               STQ     RV_BUFFGRAN

      163     7758    4                       + RBUF$->RV$BUFF.SIZE;
      164     7759    4                     GOTO GOT_INDEX;

   7759  3 000132   000140 710000 3                  TRA     GOT_INDEX
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:21   

      165     7760    4                     END;
      166     7761    3                END;
      167     7762    3           ELSE DO;

      168     7763    3                RV_DINDEXA=I;

   7763  3 000133   200006 236100                    LDQ     I,,AUTO
         3 000134   000000 756000 xsym               STQ     RV_DINDEXA

      169     7764    3                END;

      170     7765    2           I=I-1;

   7765  3 000135   000001 336007                    LCQ     1,DL
         3 000136   200006 056100                    ASQ     I,,AUTO

      171     7766    2           END;                  /*DO WHILE I>=0                               */

   7766  3 000137   000077 605000 3                  TPL     s:7744

   7758  3 000140                       GOT_INDEX    null
      172     7767
      173     7768    1   GOT_INDEX: ;
      174     7769                                 /* Re-write disk directory with updated scount     */
      175     7770    1      RV_WDGRAN = TOPDA;

   7770  3 000140   000000 235000 xsym               LDA     TOPDA
         3 000141   000000 755000 xsym               STA     RV_WDGRAN

      176     7771    1      CALL IRR$WWSQD;

   7771  3 000142   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000143   000000 701000 xent               TSX1    IRR$WWSQD
         3 000144   000000 011000                    NOP     0

      177     7772                                      /* Report the Screech ID                      */
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:22   
      178     7773    1      I=I$DISKDIR.DUMP.SCOUNT;

   7773  3 000145   200003 470500                    LDP0    POBUF$,,AUTO
         3 000146   000200 235100                    LDA     128,,PR0
         3 000147   200006 755100                    STA     I,,AUTO

      179     7774    2      DO WHILE (I>999);

   7774  3 000150   001747 115007                    CMPA    999,DL
         3 000151   000157 604400 3                  TMOZ    s:7777

      180     7775    2           I=I-999;

   7775  3 000152   001747 336007                    LCQ     999,DL
         3 000153   200006 056100                    ASQ     I,,AUTO

      181     7776    2           END;

   7776  3 000154   200006 235100                    LDA     I,,AUTO
         3 000155   001747 115007                    CMPA    999,DL
         3 000156   000152 605400 3                  TPNZ    s:7775

      182     7777    1      RV_BUFF.IDCOUNT = I;

   7777  3 000157   000273 755000 xsym               STA     RV_BUFF+187

      183     7778    1      T$=ADDR(RVM_IDM);

   7778  3 000160   000005 236000 4                  LDQ     5
         3 000161   200005 756100                    STQ     T$,,AUTO

      184     7779    1      T$->B$IDM.VER=I$DISKDIR.MONID.M;

   7779  3 000162   200003 470500                    LDP0    POBUF$,,AUTO
         3 000163   200005 471500                    LDP1    T$,,AUTO
         3 000164   000100 100500                    MLR     fill='000'O
         3 000165   000211 000004                    ADSC9   137,,PR0                 cn=0,n=4
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:23   
         3 000166   100004 000004                    ADSC9   4,,PR1                   cn=0,n=4

      185     7780    1      CALL BINCHAR(T$->B$IDM.SCOUNT,I);

   7780  3 000167   000100 301500                    BTD
         3 000170   200006 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         3 000171   100005 030003                    NDSC9   5,,PR1                   cn=0,s=nosgn,sf=0,n=3

      186     7781    1      CALL BINCHAR(T$->B$IDM.IND,RV_DINDEXA);

   7781  3 000172   000100 301400                    BTD
         3 000173   000000 000004 xsym               NDSC9   RV_DINDEXA               cn=0,s=lsgnf,sf=0,n=4
         3 000174   100006 030001                    NDSC9   6,,PR1                   cn=0,s=nosgn,sf=0,n=1

      187     7782    1      CALL IRR$TYPE6M(RVM_IDM,SIZEW(RVM_IDM));

   7782  3 000175   000006 630400 4                  EPPR0   6
         3 000176   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000177   000000 701000 xent               TSX1    IRR$TYPE6M
         3 000200   000000 011000                    NOP     0

      188     7783
      189     7784        /*O*   MESSAGE:   RCVR-SCREECH ID VERcnn-I
      190     7785               MEANING:   Identifies the unique Screech ID.
      191     7786                          May be useful when the OC log
      192     7787                          arrives with a dump file.
      193     7788        */
      194     7789
      195     7790    1      RV_DEBUGM = 1;

   7790  3 000201   000001 235007                    LDA     1,DL
         3 000202   000000 755000 xsym               STA     RV_DEBUGM

      196     7791    1      IF RV_DINDEXA = %RV_SYSDDUMP#

   7791  3 000203   000000 236000 xsym               LDQ     RV_DINDEXA
         3 000204   000004 116007                    CMPQ    4,DL
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:24   
         3 000205   000226 601000 3                  TNZ     s:7805

      197     7792    2      THEN DO;              /*If no dump slot available-should never happen    */

      198     7793    2           CALL IRR$TYPE6M(RVM_DUMPFB,SIZEW(RVM_DUMPFB));

   7793  3 000206   000011 630400 4                  EPPR0   9
         3 000207   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000210   000000 701000 xent               TSX1    IRR$TYPE6M
         3 000211   000000 011000                    NOP     0

      199     7794        /*O*   MESSAGE:   RCVR-ALL DUMP SLOTS BUSY
      200     7795               MEANING:   SCREECHing faster than dump files
      201     7796                          can be converted.
      202     7797        */
      203     7798    2           RV_ATTEMPTS = RV_ATTEMPTS + 1;

   7798  3 000212   000000 054000 xsym               AOS     RV_ATTEMPTS

      204     7799    2           IF RV_ATTEMPTS > 2 THEN CALL IRR$GIVEUP;

   7799  3 000213   000000 235000 xsym               LDA     RV_ATTEMPTS
         3 000214   000002 115007                    CMPA    2,DL
         3 000215   000221 604400 3                  TMOZ    s:7800

   7799  3 000216   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000217   000000 701000 xent               TSX1    IRR$GIVEUP
         3 000220   000000 011000                    NOP     0

      205     7800    2           RV_BOOTFLAG = I_RCVR_DUMPF;

   7800  3 000221   000012 235007                    LDA     10,DL
         3 000222   000000 755000 xsym               STA     RV_BOOTFLAG

      206     7801    2           RV_BUFF.RCODE.SEV = %SEV_SCREECH#;

   7801  3 000223   000007 236007                    LDQ     7,DL
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:25   
         3 000224   000014 256000 xsym               ORSQ    RV_BUFF+12

      207     7802    2           GOTO RVI_ALT;

   7802  3 000225   000257 710000 3                  TRA     RVI_ALT

      208     7803    2           END;
      209     7804
      210     7805    1      ELSE RV_ATTEMPTS = 0;

   7805  3 000226   000000 450000 xsym               STZ     RV_ATTEMPTS

      211     7806    1      I$DISKDIR.RCVR2.DA(RV_DINDEXA) = RV_BUFFGRAN;

   7806  3 000227   000000 235000 xsym               LDA     RV_BUFFGRAN
         3 000230   200003 470500                    LDP0    POBUF$,,AUTO
         3 000231   000204 755106                    STA     132,QL,PR0

      212     7807    1      I$DISKDIR.DUMP.LDUMP = RV_DINDEXA;

   7807  3 000232   000000 235000 xsym               LDA     RV_DINDEXA
         3 000233   000203 755100                    STA     131,,PR0

      213     7808    1      RV_BOOTFLAG = I_RECOVERY;  /*Assume normal                               */

   7808  3 000234   000011 236007                    LDQ     9,DL
         3 000235   000000 756000 xsym               STQ     RV_BOOTFLAG

      214     7809    1      IF RV_DINDEXA = %RV_SYSDDUMP#-1

   7809  3 000236   000003 115007                    CMPA    3,DL
         3 000237   000303 601000 3                  TNZ     s:7857

      215     7810    2      THEN DO;

      216     7811                                      /*When using the last available dump slot     */
      217     7812    2           IF RV_BUFF.RCODE.SEV = %SEV_SNAP#
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:26   

   7812  3 000240   000014 236000 xsym               LDQ     RV_BUFF+12
         3 000241   000007 376007                    ANQ     7,DL
         3 000242   000005 116007                    CMPQ    5,DL
         3 000243   000251 601000 3                  TNZ     s:7818

      218     7813    3           THEN DO;

      219     7814    3                CALL IRR$TYPE6M(RVM_DUMPFS,SIZEW(RVM_DUMPFS));

   7814  3 000244   000014 630400 4                  EPPR0   12
         3 000245   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000246   000000 701000 xent               TSX1    IRR$TYPE6M
         3 000247   000000 011000                    NOP     0

      220     7815    3                GOTO RVI_ALT;

   7815  3 000250   000257 710000 3                  TRA     RVI_ALT

      221     7816    3                END;
      222     7817
      223     7818    2           IF RV_BUFF.RCODE.SEV = %SEV_FESNAP#

   7818  3 000251   000003 116007                    CMPQ    3,DL
         3 000252   000266 601000 3                  TNZ     s:7835

      224     7819    3           THEN DO;

      225     7820    3                CALL IRR$TYPE6M(RVM_FEPDFS,SIZEW(RVM_FEPDFS));

   7820  3 000253   000016 630400 4                  EPPR0   14
         3 000254   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000255   000000 701000 xent               TSX1    IRR$TYPE6M
         3 000256   000000 011000                    NOP     0

   7820  3 000257                       RVI_ALT      null
      226     7821
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:27   
      227     7822        /*O*   MESSAGE:   RCVR-SNAP DUMP SKIPPED
      228     7823               MEANING:   All but last dump slot on the system
      229     7824                          disk was busy when Recovery was called
      230     7825                          to do a snapshot dump.
      231     7826        */
      232     7827    3   RVI_ALT:     ;
      233     7828    3                RV_PDUMP=RV_PDUMP+1;

   7828  3 000257   000000 054000 xsym               AOS     RV_PDUMP

      234     7829    3                RV_NODUMPG=RV_NODUMPG+1;

   7829  3 000260   000000 054000 xsym               AOS     RV_NODUMPG

      235     7830    3                RV_SCODEA = RV_BUFF.RCODE;

   7830  3 000261   000014 237000 xsym               LDAQ    RV_BUFF+12
         3 000262   000000 757000 xsym               STAQ    RV_SCODEA

      236     7831    3                RV_DEBUGM = DEBUGM;

   7831  3 000263   200010 235100                    LDA     DEBUGM,,AUTO
         3 000264   000000 755000 xsym               STA     RV_DEBUGM

      237     7832    3                ALTRETURN;

   7832  3 000265   000000 702200 xent               TSX2  ! X66_AALT

      238     7833    3                END;
      239     7834    3           ELSE DO;

      240     7835    3                RV_BOOTFLAG=I_RCVR_DUMPF;

   7835  3 000266   000012 235007                    LDA     10,DL
         3 000267   000000 755000 xsym               STA     RV_BOOTFLAG

      241     7836    3                IF RV_BUFF.RCODE.SEV ~= %SEV_ZAP#
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:28   

   7836  3 000270   000004 116007                    CMPQ    4,DL
         3 000271   000277 600000 3                  TZE     s:7844

      242     7837    4                THEN DO;

      243     7838    4                     RV_BUFF.RCODE.SEV = %SEV_SCREECH#;

   7838  3 000272   000007 236007                    LDQ     7,DL
         3 000273   000014 256000 xsym               ORSQ    RV_BUFF+12

      244     7839
      245     7840    4                     ADDR(RV_BUFF.RCODE)->B$SCODE.DUMP_BITS =

   7840  3 000274   000015 236000 xsym               LDQ     RV_BUFF+13
         3 000275   000001 276000 2                  ORQ     DUMP_ALL+1
         3 000276   000015 756000 xsym               STQ     RV_BUFF+13

      246     7841    4                       ( ADDR(RV_BUFF.RCODE)->B$SCODE.DUMP_BITS
      247     7842    4                       | ADDR(DUMP_ALL)->B$SCODE.DUMP_BITS);
      248     7843    4                     END;

      249     7844    3                CALL IRR$TYPE6M(RVM_DUMPFF,SIZEW(RVM_DUMPFF));

   7844  3 000277   000020 630400 4                  EPPR0   16
         3 000300   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000301   000000 701000 xent               TSX1    IRR$TYPE6M
         3 000302   000000 011000                    NOP     0

      250     7845        /*O*   MESSAGE:   RCVR- LAST DUMP FILE USED
      251     7846               MEANING:   The last slot allocated for Recovery dumps
      252     7847                          on the System Disk has been used.  A SUA
      253     7848                          or SNAP will be converted to a full SCREECH.
      254     7849                          No users will be allowed to log on until
      255     7850                          all dump files have been converted to keyed
      256     7851                          files.
      257     7852        */
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:29   
      258     7853    3                END;

      259     7854
      260     7855    2           END;                  /*DO if using the last slot                   */

      261     7856
      262     7857    1      RV_DEBUGM = DEBUGM;

   7857  3 000303   200010 235100                    LDA     DEBUGM,,AUTO
         3 000304   000000 755000 xsym               STA     RV_DEBUGM

      263     7858    1      RV_WDGRAN = TOPDA;

   7858  3 000305   000000 236000 xsym               LDQ     TOPDA
         3 000306   000000 756000 xsym               STQ     RV_WDGRAN

      264     7859    1      CALL IRR$WWSQD;

   7859  3 000307   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000310   000000 701000 xent               TSX1    IRR$WWSQD
         3 000311   000000 011000                    NOP     0

      265     7860                                 /*Re-write disk directory with 1st gran-this dump. */
      266     7861    1      RV_USRDRDA = RV_BUFFGRAN+1;

   7861  3 000312   000000 235000 xsym               LDA     RV_BUFFGRAN
         3 000313   000001 035007                    ADLA    1,DL
         3 000314   000000 755000 xsym               STA     RV_USRDRDA

      267     7862    1      RV_NXTGRAN = RV_USRDRDA+1;

   7862  3 000315   000001 035007                    ADLA    1,DL
         3 000316   000000 755000 xsym               STA     RV_NXTGRAN

      268     7863    1      IF RV_BUFF.RCODE.SEV = %SEV_SCREECH#

   7863  3 000317   000014 236000 xsym               LDQ     RV_BUFF+12
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:30   
         3 000320   000007 376007                    ANQ     7,DL
         3 000321   000007 116007                    CMPQ    7,DL
         3 000322   000326 601000 3                  TNZ     s:7865

      269     7864    1      THEN RV_MAXGRAN = RV_LASTGRAN;

   7864  3 000323   000000 235000 xsym               LDA     RV_LASTGRAN
         3 000324   000000 755000 xsym               STA     RV_MAXGRAN
         3 000325   000331 710000 3                  TRA     s:7866

      270     7865    1      ELSE RV_MAXGRAN=RV_LASTGRAN-RV_SEV7SZ;

   7865  3 000326   000000 236000 xsym               LDQ     RV_LASTGRAN
         3 000327   000000 136000 xsym               SBLQ    RV_SEV7SZ
         3 000330   000000 756000 xsym               STQ     RV_MAXGRAN

      271     7866    1      RV_BUFF.MAXGRAN = RV_MAXGRAN;

   7866  3 000331   000000 235000 xsym               LDA     RV_MAXGRAN
         3 000332   000277 755000 xsym               STA     RV_BUFF+191

   7866  3 000333                       RVI_EXIT     null
      272     7867    1   RVI_EXIT: ;
      273     7868    1      RV_SCODEA = RV_BUFF.RCODE;

   7868  3 000333   000014 237000 xsym               LDAQ    RV_BUFF+12
         3 000334   000000 757000 xsym               STAQ    RV_SCODEA

      274     7869    1      RV_BUFF.DINDEX=RV_DINDEXA;

   7869  3 000335   000000 235000 xsym               LDA     RV_DINDEXA
         3 000336   000275 755000 xsym               STA     RV_BUFF+189

      275     7870    1      RETURN;

   7870  3 000337   000000 702200 xent               TSX2  ! X66_ARET
      276     7871    1   END IRI$INIT;
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:31   

PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:32   
--  Include file information  --

   I_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   U$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   I$DISK.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   IR_DATA_M.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure IRI$INIT.
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:33   

 **** Variables and constants ****

  ****  Section 001 RoData IRI$INIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/c CHAR(68)    r     1 RVM_DUMPFB                70-0-0/c CHAR(68)    r     1 RVM_DUMPFF
    30-0-0/c CHAR(64)    r     1 RVM_DUMPFS                50-0-0/c CHAR(64)    r     1 RVM_FEPDFS
     0-0-0/c CHAR(28)    r     1 RVM_IDM                  111-0-0/c CHAR(72)    r     1 RVM_NODUMP

  ****  Section 002  Data  IRI$INIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(72)    r     1 DUMP_ALL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/w PTR         r     1 B$JIT$                    10-0-0/w SBIN        r     1 DEBUGM
     6-0-0/w SBIN        r     1 I                          3-0-0/w PTR         r     1 POBUF$
     4-0-0/w PTR         r     1 RBUF$                      5-0-0/w PTR         r     1 T$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(288)   r     1 IDBUF                      0-0-0/w UBIN        r     1 MONPLL
     0-0-0/b BIT         r     1 POBUF(0:1023)              0-0-0/w PTR         r     1 R$CU$
     0-0-0/w PTR         r     1 R$USRT$                    0-0-0/w SBIN        r     1 RV_ATTEMPTS
     0-0-0/w SBIN        r     1 RV_BOOTFLAG                0-0-0/d STRC(36864) r     1 RV_BUFF
     0-0-0/w SBIN        r     1 RV_BUFFGRAN                0-0-0/w SBIN        r     1 RV_CUN
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:34   
     0-0-0/w SBIN        r     1 RV_DEBUGM                  0-0-0/w SBIN        r     1 RV_DINDEXA
     0-0-0/w SBIN        r     1 RV_LASTGRAN                0-0-0/w SBIN        r     1 RV_MAXGRAN
     0-0-0/w SBIN        r     1 RV_MUAIS                   0-0-0/w SBIN        r     1 RV_NODUMPG
     0-0-0/w SBIN        r     1 RV_NXTGRAN                 0-0-0/w SBIN        r     1 RV_PDUMP
     0-0-0/d BIT (72)    r     1 RV_SCODEA                  0-0-0/w SBIN        r     1 RV_SEV7SZ
     0-0-0/d STRC(36864) r     1 RV_USRDIR                  0-0-0/w SBIN        r     1 RV_USRDRDA
     0-0-0/w SBIN        r     1 RV_WDGRAN                  0-0-0/w UBIN        r     1 TOPDA

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 B$CUSRTBL(0:15)
     0-0-0/c STRC(225)   r     1 B$IDM                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(72)    r     1 B$SCODE                    0-0-0/w STRC(576)   r     1 B$USER(0:0)
     0-0-0/w STRC(8640)  r     1 I$DISKDIR                  0-0-0/d STRC(36864) r     1 RV$BUFF


   Procedure IRI$INIT requires 224 words for executable code.
   Procedure IRI$INIT requires 10 words of local(AUTO) storage.

    No errors detected in file IRI$INIT.:E05TSI    .
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:35   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:36   
          MINI XREF LISTING

B$CUSRTBL
      7131**DCL      7733>>ASSIGN
B$DO.ECCINFO
      6265**DCL      6266--REDEF
B$IDM.IND
      7125**DCL      7781<<CALLBLT
B$IDM.SCOUNT
      7123**DCL      7780<<CALLBLT
B$IDM.VER
      7120**DCL      7779<<ASSIGN
B$JIT
      6904**DCL      7720--ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      7003**DCL      7003--REDEF
B$JIT.ERR.MID
      6910**DCL      6910--REDEF
B$JIT$
        16**DCL      6904--IMP-PTR
B$SCODE.DUMP_BITS
      7129**DCL      7840<<ASSIGN   7840>>ASSIGN   7840>>ASSIGN
B$U.MISC
      6244**DCL      6245--REDEF
B$USER
      6289**DCL      7732--ASSIGN
B$USER.MISC
      6320**DCL      6321--REDEF
DEBUGM
        17**DCL      7704<<ASSIGN   7831>>ASSIGN   7857>>ASSIGN
DUMP_ALL
      5990**DCL      7840--ASSIGN
GOT_INDEX
      7758**LABEL    7747--CALLALT  7759--GOTO
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:37   
I
        15**DCL      7742<<ASSIGN   7743>>DOWHILE  7744>>IF       7746>>ASSIGN   7752>>ASSIGN   7753>>ASSIGN
      7756>>ASSIGN   7757>>ASSIGN   7763>>ASSIGN   7765<<ASSIGN   7765>>ASSIGN   7773<<ASSIGN   7774>>DOWHILE
      7775<<ASSIGN   7775>>ASSIGN   7777>>ASSIGN   7780>>CALLBLT
I$DISKDIR.DUMP.DA
      6531**DCL      7706>>IF       7717>>ASSIGN   7736>>ASSIGN
I$DISKDIR.DUMP.LDUMP
      6533**DCL      7807<<ASSIGN
I$DISKDIR.DUMP.SCOUNT
      6530**DCL      7724<<ASSIGN   7724>>ASSIGN   7727>>ASSIGN   7773>>ASSIGN
I$DISKDIR.DUMP.SIZE
      6532**DCL      7706>>IF       7717>>ASSIGN
I$DISKDIR.FW.NAME
      6580**DCL      6581--REDEF
I$DISKDIR.MONID.A
      6537**DCL      7728>>ASSIGN
I$DISKDIR.MONID.M
      6540**DCL      6543--REDEF    7729>>ASSIGN   7779>>ASSIGN
I$DISKDIR.RCVR2.DA
      6535**DCL      7744>>IF       7746>>ASSIGN   7752<<ASSIGN   7757>>ASSIGN   7806<<ASSIGN
IDBUF.TXT
      6102**DCL      7730>>ASSIGN
IRR$GIVEUP
      6110**DCL-ENT  7799--CALL
IRR$READBUF
      6108**DCL-ENT  7747--CALL
IRR$TYPE6M
      6111**DCL-ENT  7709--CALL     7782--CALL     7793--CALL     7814--CALL     7820--CALL     7844--CALL
IRR$WWSQD
      6109**DCL-ENT  7771--CALL     7859--CALL
MONPLL
      6103**DCL      7731>>ASSIGN
POBUF
      6104**DCL      7702--ASSIGN
POBUF$
        12**DCL      7702<<ASSIGN   7706>>IF       7706>>IF       7717>>ASSIGN   7717>>ASSIGN   7724>>ASSIGN
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:38   
      7724>>ASSIGN   7727>>ASSIGN   7728>>ASSIGN   7729>>ASSIGN   7736>>ASSIGN   7744>>IF       7746>>ASSIGN
      7752>>ASSIGN   7757>>ASSIGN   7773>>ASSIGN   7779>>ASSIGN   7806>>ASSIGN   7807>>ASSIGN
R$CU$
      6079**DCL      7732<<ASSIGN   7733>>ASSIGN
R$USRT$
      6080**DCL      7732>>ASSIGN
RBUF$
        13**DCL      7703<<ASSIGN   7749>>IF       7757>>ASSIGN
RV$BUFF.BUSY
      7082**DCL      7749>>IF
RV$BUFF.SIZE
      7082**DCL      7757>>ASSIGN
RVI_ALT
      7820**LABEL    7710--GOTO     7802--GOTO     7815--GOTO
RVM_DUMPFB
      5963**DCL      7793<>CALL     7793--CALL
RVM_DUMPFF
      5969**DCL      7844<>CALL     7844--CALL
RVM_DUMPFS
      5965**DCL      7814<>CALL     7814--CALL
RVM_FEPDFS
      5967**DCL      7820<>CALL     7820--CALL
RVM_IDM
      5961**DCL      7778--ASSIGN   7782<>CALL     7782--CALL
RVM_NODUMP
      5971**DCL      7709<>CALL     7709--CALL
RV_ATTEMPTS
      6082**DCL      7798<<ASSIGN   7798>>ASSIGN   7799>>IF       7805<<ASSIGN
RV_BOOTFLAG
      6083**DCL      7800<<ASSIGN   7808<<ASSIGN   7835<<ASSIGN
RV_BUFF.AMONID
      6054**DCL      7728<<ASSIGN
RV_BUFF.BUSY
      6039**DCL      7726<<ASSIGN
RV_BUFF.C_USRTBL
      6051**DCL      7733<<ASSIGN
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:39   
RV_BUFF.DINDEX
      6055**DCL      7869<<ASSIGN
RV_BUFF.DMONID
      6054**DCL      7729<<ASSIGN
RV_BUFF.EL_MAXPGS
      6053**DCL      7720>>ASSIGN
RV_BUFF.IDCOUNT
      6055**DCL      7777<<ASSIGN
RV_BUFF.MAXGRAN
      6055**DCL      7866<<ASSIGN
RV_BUFF.MONPLL
      6055**DCL      7731<<ASSIGN
RV_BUFF.RCODE
      6042**DCL      7830>>ASSIGN   7840--ASSIGN   7840--ASSIGN   7868>>ASSIGN
RV_BUFF.RCODE.SEV
      6043**DCL      7801<<ASSIGN   7812>>IF       7818>>IF       7836>>IF       7838<<ASSIGN   7863>>IF
RV_BUFF.SCOUNT
      6039**DCL      7727<<ASSIGN
RV_BUFF.TAPE_ID
      6056**DCL      7730<<ASSIGN
RV_BUFFGRAN
      6084**DCL      7736<<ASSIGN   7751<<ASSIGN   7757<<ASSIGN   7806>>ASSIGN   7861>>ASSIGN
RV_CUN
      6085**DCL      7732>>ASSIGN
RV_DEBUGM
      6086**DCL      7704>>ASSIGN   7708<<ASSIGN   7790<<ASSIGN   7831<<ASSIGN   7857<<ASSIGN
RV_DINDEXA
      6087**DCL      7735<<ASSIGN   7742>>ASSIGN   7753<<ASSIGN   7756<<ASSIGN   7763<<ASSIGN   7781>>CALLBLT
      7791>>IF       7806>>ASSIGN   7807>>ASSIGN   7809>>IF       7869>>ASSIGN
RV_LASTGRAN
      6088**DCL      7717<<ASSIGN   7864>>ASSIGN   7865>>ASSIGN
RV_MAXGRAN
      6089**DCL      7864<<ASSIGN   7865<<ASSIGN   7866>>ASSIGN
RV_MUAIS
      6090**DCL      7720>>ASSIGN
RV_NODUMPG
PL6.E3A0      #001=IRI$INIT File=IRI$INIT.:E05TSI                                TUE 07/29/97 22:45 Page:40   
      6091**DCL      7740<<ASSIGN   7829<<ASSIGN   7829>>ASSIGN
RV_NXTGRAN
      6092**DCL      7862<<ASSIGN
RV_PDUMP
      6093**DCL      7741<<ASSIGN   7828<<ASSIGN   7828>>ASSIGN
RV_SCODEA
      6094**DCL      7830<<ASSIGN   7868<<ASSIGN
RV_SEV7SZ
      6095**DCL      7720<<ASSIGN   7865>>ASSIGN
RV_USRDIR
      6075**DCL      7703--ASSIGN
RV_USRDRDA
      6096**DCL      7861<<ASSIGN   7862>>ASSIGN
RV_WDGRAN
      6098**DCL      7746<<ASSIGN   7751>>ASSIGN   7770<<ASSIGN   7858<<ASSIGN
T$
        14**DCL      7778<<ASSIGN   7779>>ASSIGN   7780>>CALLBLT  7781>>CALLBLT
TOPDA
      6105**DCL      7770>>ASSIGN   7858>>ASSIGN
