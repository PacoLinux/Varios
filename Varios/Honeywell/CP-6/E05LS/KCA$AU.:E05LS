VERSION E05

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:1    
        1        1        /*M*  KCA$AU - Administrative user interface for comgroups */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 8        ,IAD=0,PRB */
        9        9        /**/
       10       10        /*P* NAME:         KCA$AU
       11       11
       12       12             PURPOSE:      Provide interfaces between the comgroup and
       13       13                           its administrative user.
       14       14
       15       15        */
       16       16
       17       17
       18       18
       19       19        KCA$TELLAU: PROC(PARM,CODE,INFO) ALTRET;
       20       20
       21       21
       22       22
       23       23        /**/
       24       24        /* INCLUDES */
       25       25        /**/
       26       26        %INCLUDE F_CP6;
       27     1051        %INCLUDE HF_LOCK_C;
       28     1065        %INCLUDE KC$CP6V_C;
       29     1185        %INCLUDE KC_CP6;
       30     1745        %INCLUDE KI_CP6;
       31     2841        %INCLUDE KQ_MAC_C;
       32     5391        %INCLUDE KQ_SUBS_C;
       33     5691        %INCLUDE NK$LDCT;
       34     5793        %INCLUDE NK_SUBS;
       35     5818        %INCLUDE SS_SCHED_C;
       36     6051
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:2    
       37     6052
       38     6053        /**/
       39     6054        /* BASED STRUCTURES */
       40     6055        /**/
       41     6056        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CG$)");
       42     6795        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS=BASED);
       43     6848        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)");
       44     7118        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
       45     7457        %NK$LDCT;
       46     7503        %VLP_FPRG(FPTN=VLP$FPRG,STCLASS=BASED);
       47     7524        %VLP_STATION (FPTN=VLP$STATION,STCLASS=BASED);
       48     7551    1   DCL UBINHALF UBIN(18) BASED ALIGNED;
       49     7552    1   DCL MOVEI CHAR(I) BASED ALIGNED;
       50     7553    1   DCL B$$BIT72 BIT(72) BASED ALIGNED;
       51     7554
       52     7555
       53     7556
       54     7557        /**/
       55     7558        /* PARAMETERS */
       56     7559        /**/
       57     7560    1   DCL PARM UBIN;
       58     7561    1   DCL CODE UBIN;
       59     7562    1   DCL INFO UBIN;
       60     7563    1   DCL CNNCT$ REDEF INFO PTR;
       61     7564
       62     7565
       63     7566
       64     7567        /**/
       65     7568        /* AUTO */
       66     7569        /**/
       67     7570    1   DCL MYSTA$ PTR;
       68     7571    1   DCL CG$ PTR;
       69     7572    1   DCL STA$ PTR;
       70     7573    1   DCL FPRG$ REDEF STA$ PTR;
       71     7574    1   DCL ACTION UBIN;
       72     7575    1   DCL UTS REDEF ACTION UBIN;
       73     7576    1   DCL TYP UBIN;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:3    
       74     7577    1   DCL DBLK$ PTR;
       75     7578    1   DCL STMP REDEF DBLK$ UBIN;
       76     7579    1   DCL REGFLG UBIN;
       77     7580    1   DCL MBLK$ PTR;
       78     7581    1   DCL I UBIN;
       79     7582    1   DCL DDA UBIN;
       80     7583    1   DCL NXT$ PTR;
       81     7584
       82     7585
       83     7586
       84     7587        /**/
       85     7588        /* EQUS */
       86     7589        /**/
       87     7590        %EQU_CG;
       88     7638
       89     7639
       90     7640
       91     7641        /**/
       92     7642        /* EXTERNAL ROUTINES */
       93     7643        /**/
       94     7644    1   DCL KCO$DSCTRMGO  ENTRY(1);
       95     7645    1   DCL KQC$ACTSTA    ENTRY(2) ALTRET;
       96     7646    1   DCL KQC$DACTSTA   ENTRY(2) ALTRET;
       97     7647    1   DCL KQC$DISCSTA   ENTRY(2) ALTRET;
       98     7648    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
       99     7649    1   DCL KQD$FETCHR    ENTRY(3) ALTRET;
      100     7650    1   DCL KQD$GET       ENTRY(3) ALTRET;
      101     7651    1   DCL KQD$GETR      ENTRY(3) ALTRET;
      102     7652    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      103     7653    1   DCL KQL$MERGEMLH  ENTRY(2) ALTRET;
      104     7654    1   DCL KQM$GETBR     ENTRY(3) ALTRET;
      105     7655    1   DCL KQM$GETMBLK   ENTRY(3) ALTRET;
      106     7656    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      107     7657    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      108     7658    1   DCL KQU$DELETE    ENTRY(1) ALTRET;
      109     7659    1   DCL KQW$JNLD      ENTRY(1) ALTRET;
      110     7660    1   DCL KQW$TELLAU    ENTRY(1) ALTRET;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:4    
      111     7661    1   DCL SC_CGAUERR    ENTRY    CONV(2,0);
      112     7662    1   DCL SC_CGNOMBLK   ENTRY    CONV(2,0);
      113     7663    1   DCL SSR$RUE       ENTRY(4);
      114     7664
      115     7665
      116     7666
      117     7667        /**/
      118     7668        /* CONSTANT */
      119     7669        /**/
      120     7670    1   DCL AUEVKEY CONSTANT CHAR(8) INIT('*AUEV');
      121     7671    1   DCL AUEVPRIH CONSTANT UBIN INIT(%(KQ_AUEP#+1));
      122     7672    1   DCL AUEVPRIL CONSTANT UBIN INIT(%KQ_AUEP#);
      123     7673        %KQ_MBLK (FPTN=KQ_IMBLK,STCLASS=SYMREF);
      124     7943        %VLP_STATION (STCLASS=CONSTANT);
      125     7970        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:5    
      126     7971
      127     7972
      128     7973        /*F* NAME:         KCA$TELLAU
      129     7974
      130     7975             PURPOSE:      Send a message to the AU, and perform the
      131     7976                           functions associated with the message.
      132     7977
      133     7978        */
      134     7979
      135     7980
      136     7981
      137     7982        /*D* NAME:         KCA$TELLAU
      138     7983
      139     7984             CALL:         CALL KCA$TELLAU (KQ$STA,CODE,INFO) ALTRET(LOC);
      140     7985
      141     7986             INPUT:        KQ$STA - The station to which the
      142     7987                                  message applies.
      143     7988                           CODE - The type of action to be taken
      144     7989                           INFO - Optional word of information
      145     7990
      146     7991             DESCRIPTION:  If appropriate, the AU is sent a message.  Then
      147     7992                           if needed, some action is taken.
      148     7993
      149     7994                           If a message needs to be sent then KCA$AU
      150     7995                           attempts to acquire an MBLK.  If none are
      151     7996                           available, we ALTRET.
      152     7997
      153     7998
      154     7999        KCA$TELLAU: ENTRY(PARM,CODE,INFO) ALTRET;
      155     8000        */
      156     8001
      157     8002    1         REGFLG=0;  /* Don't REG */
      158     8003    1         MBLK$=ADDR(NIL);
      159     8004    1         GOTO COM;
      160     8005
      161     8006        /**/
      162     8007        /*F* NAME:         KCA$TELLAUR
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:6    
      163     8008             PURPOSE:      Same as KCA$TELLAU
      164     8009        */
      165     8010        /**/
      166     8011        /*D* NAME:         KCA$TELLAUR
      167     8012             CALL:         KCA$TELLAUR (KQ$STA,CODE,INFO) ALTRET(LOC)
      168     8013             INPUT:        Same as KCA$TELLAU
      169     8014             DESCRIPTION:  Same as KCA$TELLAU except that the caller
      170     8015                           is blocked if necessary in order to wait for
      171     8016                           an MBLK to become available.  If none, ALTRET.
      172     8017        */
      173     8018    1   KCA$TELLAUR: ENTRY(PARM,CODE,INFO) ALTRET;
      174     8019
      175     8020    1         REGFLG=1;  /* REG if no MBLKs */
      176     8021    1         MBLK$=ADDR(NIL);
      177     8022    1         GOTO COM;
      178     8023
      179     8024        /**/
      180     8025        /*F* NAME:         KCA$TELLAUM
      181     8026             PURPOSE:      Same as KCA$TELLAU
      182     8027        */
      183     8028        /**/
      184     8029        /*D* NAME:         KCA$TELLAUM
      185     8030             CALL:         KCA$TELLAUM (KQ$STA,CODE,INFO)
      186     8031             INPUT:        Same as KCA$TELLAU except that STA$->KQ$STA.MBLK$
      187     8032                           is the MBLK to use.
      188     8033             DESCRIPTION:  Same as KCA$TELLAU except that it is assumed that
      189     8034                           an MBLK will be required, and it is present in
      190     8035                           the passed station's MBLK$.  This routine never
      191     8036                           ALTRETs.
      192     8037
      193     8038                           The various event codes are:
      194     8039        */
      195     8040    1   KCA$TELLAUM: ENTRY(PARM,CODE,INFO) ALTRET;
      196     8041
      197     8042    1         MYSTA$=ADDR(PARM);
      198     8043    1         REGFLG=0;
      199     8044              %LOCK (G=MYSTA$->KQ$STA.GATE);
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:7    
      200     8047    1         MBLK$=MYSTA$->KQ$STA.MBLK$;
      201     8048    1         MYSTA$->KQ$STA.MBLK$=ADDR(NIL);
      202     8049              %UNLOCK (G=MYSTA$->KQ$STA.GATE);
      203     8052    1         IF MBLK$=ADDR(NIL) THEN CALL SC_CGNOMBLK;
      204     8053        /*S* SCREECH_CODE: KCA-S$CGNOMBLK
      205     8054             TYPE:         SNAP
      206     8055             MESSAGE:      No MBLK was obtained for announcing an event to the AU
      207     8056             REMARKS:      KCA$TELLAUM must be called with an MBLK already set up
      208     8057                           for the station.  If one doesn't exist, a snap is sufficient
      209     8058                           because we will go ahead and set one up.  However, this snap
      210     8059                           is here because we can't always fill in all the information,
      211     8060                           i.e., terminal connection.  */
      212     8061
      213     8062    1   COM:  ;
      214     8063    1         MYSTA$=ADDR(PARM);
      215     8064    1         CG$=MYSTA$->KQ$STA.CG$;
      216     8065        /**/
      217     8066    1   AGAIN: ;
      218     8067    2           DO CASE(CODE);
      219     8068
      220     8069        /*D*
      221     8070                           %CG_AUCON# - AU connect.  This occurs when the
      222     8071                           AU connects to the comgroup.  First the AU's
      223     8072                           DCB is activated.  Then the list of connected
      224     8073                           stations is scanned.  For each station found,
      225     8074                           AUCONTERM or AUCONDCB is checked to see what
      226     8075                           action is to be taken.  The possibilities are:
      227     8076                             ACTIVATE - the station is activated
      228     8077                             DEACTIVATE - the station is deactivated
      229     8078                             DISCONNECT - the station is disconnected
      230     8079                             NO-CHANGE - the station's status is not changed
      231     8080
      232     8081                           If the station is still connected, a connect
      233     8082                           message is sent to the AU.
      234     8083                           Note that we don't have to worry about FPRG terminal
      235     8084                           stations here since they may not exist without an AU
      236     8085                           and we are just now connecting the AU.
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:8    
      237     8086        */
      238     8087
      239     8088    2             CASE(%CG_AUCON#);
      240     8089    2               CALL KQC$ACTSTA(MYSTA$->KQ$STA);
      241     8090        /**/
      242     8091    2               CALL MSTALOCK;
      243     8092                    %LOCK(G=KQ$CG.GORGOSTA$->KQ$STA.GATE);
      244     8095    2               CALL KQL$MERGEMLH(MYSTA$->KQ$STA.MLH,
      245     8096    2               ADDR(KQ$CG.GORGOSTA$->KQ$STA.MLH));
      246     8097                    %UNLOCK (G=KQ$CG.GORGOSTA$->KQ$STA.GATE);
      247     8100    2               CALL MSTAUNLOCK;
      248     8101        /**/
      249     8102    2   AUCON0:     ;
      250     8103    2               CALL SLOCK;
      251     8104    2               STA$=KQ$CG.STREE.HEAD$;  /* Head of linear list */
      252     8105    3                 DO WHILE(STA$~=ADDR(NIL));
      253     8106    3                 CALL STALOCK;
      254     8107    3                 IF  STA$->KQ$STA.TOLDAU = '0'B
      255     8108    3                 AND STA$->KQ$STA.IDSC   = '0'B
      256     8109    3                 AND STA$->KQ$STA.LDCT$ ~= ADDR(NIL)
      257     8110    3                 AND NOT (STA$->KQ$STA.TERM='1'B
      258     8111    3                 AND STA$->KQ$STA.LDCT$->NK$LDCT.RLCID.LDCTX=0)
      259     8112    4                 THEN DO;
      260     8113    4                   STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
      261     8114    4                   TYP=STA$->KQ$STA.LDCT$->NK$LDCT.RESCOD;
      262     8115    4                   STA$->KQ$STA.TOLDAU='1'B;
      263     8116    4                   CALL STAUNLOCK;
      264     8117    4                   CALL SUNLOCK;
      265     8118    4                   IF TYP=NK_CGDCB THEN
      266     8119    4                    ACTION=KQ$CG.AUCTL.AUCONDCB;
      267     8120    4                   ELSE
      268     8121    4                    ACTION=KQ$CG.AUCTL.AUCONTERM;
      269     8122    5                     DO CASE(ACTION);
      270     8123    5                       CASE(%ACTIVATE#);
      271     8124    5                         CALL KQC$ACTSTA (STA$->KQ$STA);
      272     8125    5                       CASE(%DEACTIVATE#);
      273     8126    5                         CALL KQC$DACTSTA (STA$->KQ$STA);
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:9    
      274     8127    5                       CASE(%DISCONNECT#);
      275     8128    5                         CALL KQC$DISCSTA (STA$->KQ$STA);
      276     8129    5                     END;
      277     8130    4                   IF KQ$CG.AUCTL.CONMSG AND STA$->KQ$STA.LDCT$~=ADDR(NIL)
      278     8131    4                   AND NOT STA$->KQ$STA.IDSC THEN
      279     8132    5                     DO;
      280     8133    5                     STMP=ADDR(STA$->KQ$STA.BTN.KEY)->UBINHALF;
      281     8134    5                     DDA=STA$->KQ$STA.CNNCTDDA;
      282     8135    5                     CALL KQD$FETCHR(KQ$CG,STMP,DDA) ALTRET(FETCHERR);
      283     8136    5                     I=STA$->KQ$STA.CNNCTSIZE;
      284     8137    5                     CNNCT$->MOVEI=PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI;
      285     8138    5                     CALL KQD$UNLOCK(KQ$CG,DBLK$);
      286     8139    5                     IF TYP=NK_CGDCB THEN
      287     8140    5                      CALL SENDAU(STA$->KQ$STA,%CG_DOPN#,AUEVPRIH);
      288     8141    5                     ELSE
      289     8142    5                      CALL SENDAU(STA$->KQ$STA,%CG_TCON#,AUEVPRIH);
      290     8143    5   FETCHERR:         ;
      291     8144    5                     END;
      292     8145    4                   CALL SLOCK;
      293     8146    4                   CALL STALOCK;
      294     8147    4                   IF STA$->KQ$STA.EVNT THEN
      295     8148    4                    CALL TBRK; /* Send remembered event */
      296     8149    4                   IF NOT STA$->KQ$STA.IDSC THEN
      297     8150    4                    STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;
      298     8151    4                   ELSE
      299     8152    5                     DO;
      300     8153    5                     CALL STAUNLOCK;
      301     8154    5                     CALL SUNLOCK;
      302     8155    5                     CALL KQP$UNLOCK (STA$->KQ$STA);
      303     8156    5                     GOTO AUCON0;
      304     8157    5                     END;
      305     8158    4                   END;
      306     8159    3                 CALL STAUNLOCK;
      307     8160    3                 STA$=STA$->KQ$STA.BTN.FLINK$;
      308     8161    3                 END;
      309     8162    2               CALL SUNLOCK;
      310     8163        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:10   
      311     8164        /*D*
      312     8165                           %CG_AUDCON# - AU disconnect.  This occurs when
      313     8166                           the AU disconnects from the comgroup and there
      314     8167                           is at least one other DCB still open.
      315     8168                           First the AU's DCB is deactivated.  Then the
      316     8169                           list of connected stations is searched.  For
      317     8170                           each station, the action described by
      318     8171                           AUDCONDCB or AUDCONTERM is taken.
      319     8172                           FPRG terminals will at least be caused to
      320     8173                           deactivate. Note that this will cause pure
      321     8174                           FPRG terminals to disconnect as well.
      322     8175        */
      323     8176    2             CASE(%CG_AUDCON#);
      324     8177
      325     8178    2   AUDCON0:    ;
      326     8179    2               CALL SLOCK;
      327     8180    2               STA$=KQ$CG.STREE.HEAD$;  /* Head of linear list */
      328     8181    3                 DO WHILE(STA$~=ADDR(NIL));
      329     8182    3                 CALL STALOCK;
      330     8183    3                 NXT$=STA$->KQ$STA.BTN.FLINK$;
      331     8184    3                 IF  STA$->KQ$STA.DSCREQW
      332     8185    3                 AND STA$->KQ$STA.TERM THEN
      333     8186    4                   DO;
      334     8187    4                   STA$->KQ$STA.DSCREQW='0'B;
      335     8188    4                   CALL STAUNLOCK;
      336     8189    4                   CALL SUNLOCK;
      337     8190    4                   CALL KCO$DSCTRMGO (STA$->KQ$STA);
      338     8191    4                   CALL SLOCK;
      339     8192    4                   GOTO NXTSTA;
      340     8193    4                   END;
      341     8194    3                 IF STA$->KQ$STA.LDCT$~=ADDR(NIL) THEN
      342     8195    3                  IF NOT STA$->KQ$STA.IDSC
      343     8196    3                  AND (STA$->KQ$STA.LDCT$->NK$LDCT.RESCOD=NK_CGFPRG
      344     8197    3                  OR (NOT(STA$->KQ$STA.TERM='1'B
      345     8198    3                  AND STA$->KQ$STA.LDCT$->NK$LDCT.RLCID.LDCTX=0)))
      346     8199    4                  THEN DO;
      347     8200    4                    STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:11   
      348     8201    4                    TYP=STA$->KQ$STA.LDCT$->NK$LDCT.RESCOD;
      349     8202    4                    STA$->KQ$STA.TOLDAU='0'B;
      350     8203    4                    IF TYP=NK_CGDCB THEN
      351     8204    4                     ACTION=KQ$CG.AUCTL.AUDCONDCB;
      352     8205    5                    ELSE DO;
      353     8206    5                      ACTION=KQ$CG.AUCTL.AUDCONTERM;
      354     8207    5                      IF TYP=NK_CGFPRG AND ACTION~=%DEACTIVATE# AND ACTION~=%
              8207                               DISCONNECT#
      355     8208    5                      THEN ACTION=%DEACTIVATE#;
      356     8209                                               /* A least deactivate FPRGs when no AU */
      357     8210    5                      END;
      358     8211    5                      DO CASE(ACTION);
      359     8212    5                        CASE(%ACTIVATE#);
      360     8213    5                          CALL STAUNLOCK;
      361     8214    5                          CALL SUNLOCK;
      362     8215    5                          CALL KQC$ACTSTA (STA$->KQ$STA);
      363     8216    5                        CASE(%DEACTIVATE#);
      364     8217    5                          CALL STAUNLOCK;
      365     8218    5                          CALL SUNLOCK;
      366     8219    5                          CALL KQC$DACTSTA (STA$->KQ$STA);
      367     8220    5                        CASE(%DISCONNECT#);
      368     8221    5                          CALL STAUNLOCK;
      369     8222    5                          CALL SUNLOCK;
      370     8223    5                          CALL KQC$DISCSTA (STA$->KQ$STA);
      371     8224    5                        CASE (ELSE);
      372     8225    5                          IF  NOT STA$->KQ$STA.TERM
      373     8226    5                          AND STA$->KQ$STA.OPNBLKED THEN
      374     8227    6                            DO;
      375     8228    6                            STA$->KQ$STA.OPNBLKED='0'B;
      376     8229    6                            CALL STAUNLOCK;
      377     8230    6                            CALL SUNLOCK;
      378     8231    6                            CALL SSR$RUE (%SS_UQA,STA$->KQ$STA.USR#);
      379     8232    6                            END;
      380     8233    5                          ELSE
      381     8234    6                            DO;
      382     8235    6                            CALL STAUNLOCK;
      383     8236    6                            CALL SUNLOCK;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:12   
      384     8237    6                            END;
      385     8238    5                      END;
      386     8239    4                    CALL SLOCK;
      387     8240    4                    CALL STALOCK;
      388     8241    4                    IF NOT STA$->KQ$STA.IDSC THEN
      389     8242    4                     STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;
      390     8243    4                    ELSE
      391     8244    5                      DO;
      392     8245    5                      CALL STAUNLOCK;
      393     8246    5                      CALL SUNLOCK;
      394     8247    5                      CALL KQP$UNLOCK (STA$->KQ$STA);
      395     8248    5                      GOTO AUDCON0;
      396     8249    5                      END;
      397     8250    4                    END;
      398     8251    3                 CALL STAUNLOCK;
      399     8252    3   NXTSTA:       ;
      400     8253    3                 STA$=NXT$;
      401     8254    3                 END;
      402     8255    2               CALL SUNLOCK;
      403     8256        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:13   
      404     8257
      405     8258
      406     8259        /*D*
      407     8260                           %CG_DOPN# - DCB open (other than AU).
      408     8261                           Depending on DCBCONAU and DCBCONNAU and whether
      409     8262                           or not the AU is connected, the station is
      410     8263                           activated.
      411     8264                           If the AU is present and wants connect messages,
      412     8265                           one is sent.
      413     8266        */
      414     8267    2             CASE(%CG_DOPN#);
      415     8268
      416     8269        /**/
      417     8270    2               IF KQ$CG.AUCTL.CONMSG AND KQ$CG.AUSTA$~=ADDR(NIL) THEN
      418     8271    3                 DO;
      419     8272    3                 CALL MSTALOCK;
      420     8273    3                 IF NOT MYSTA$->KQ$STA.TOLDAU THEN
      421     8274    4                   DO;
      422     8275    4                   MYSTA$->KQ$STA.TOLDAU='1'B;
      423     8276    4                   CALL MSTAUNLOCK;
      424     8277    4                   CALL SENDAU (MYSTA$->KQ$STA,%CG_DOPN#,AUEVPRIL);
      425     8278    4                   END;
      426     8279    3                 ELSE
      427     8280    3                  CALL MSTAUNLOCK;
      428     8281    3                 END;
      429     8282        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:14   
      430     8283
      431     8284
      432     8285        /*D*
      433     8286                           %CG_DCLS# - close a DCB.
      434     8287                           The station is deactivated.  If the AU wants
      435     8288                           disconnect messages, one is sent.
      436     8289        */
      437     8290
      438     8291
      439     8292    2             CASE(%CG_DCLS#);
      440     8293
      441     8294    2               IF KQ$CG.AUCTL.CONMSG AND KQ$CG.AUSTA$~=ADDR(NIL) THEN
      442     8295    2                CALL SENDAU(MYSTA$->KQ$STA,%CG_DCLS#,AUEVPRIL);
      443     8296        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:15   
      444     8297
      445     8298
      446     8299        /*D*
      447     8300                           %CG_TCON# - terminal connect.
      448     8301                           The station is activated if requested, and the
      449     8302                           AU is sent a message.
      450     8303        */
      451     8304
      452     8305
      453     8306    2             CASE(%CG_TCON#);
      454     8307
      455     8308    2               IF KQ$CG.AUCTL.CONMSG THEN
      456     8309    2                IF KQ$CG.AUSTA$~=ADDR(NIL) THEN
      457     8310    3                  DO;
      458     8311    3                  CALL MSTALOCK;
      459     8312    3                  IF NOT MYSTA$->KQ$STA.TOLDAU AND NOT MYSTA$->KQ$STA.IDSC THEN
      460     8313    4                    DO;
      461     8314    4                    MYSTA$->KQ$STA.TOLDAU='1'B;
      462     8315    4                    CALL MSTAUNLOCK;
      463     8316    4                    CALL SENDAU(MYSTA$->KQ$STA,%CG_TCON#,AUEVPRIL);
      464     8317    4                    END;
      465     8318    3                  ELSE
      466     8319    3                   CALL MSTAUNLOCK;
      467     8320    3                  END;
      468     8321        /**/
      469     8322    2               GOTO RET;
      470     8323        /**/
      471     8324        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:16   
      472     8325
      473     8326
      474     8327        /*D*
      475     8328                           %CG_TDSC# - terminal disconnect
      476     8329        */
      477     8330
      478     8331
      479     8332    2             CASE(%CG_TDSC#);
      480     8333
      481     8334    2               IF KQ$CG.AUCTL.CONMSG THEN
      482     8335    2                CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL);
      483     8336
      484     8337
      485     8338         /*D*
      486     8339
      487     8340                           %CG_TDRQ# - terminal disconnect request
      488     8341        */
      489     8342
      490     8343
      491     8344    2             CASE (%CG_TDRQ#);
      492     8345
      493     8346    2               CALL SENDAU (MYSTA$->KQ$STA,CODE,AUEVPRIL);
      494     8347        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:17   
      495     8348
      496     8349
      497     8350        /*D*
      498     8351                           %CG_TBRK# - break events
      499     8352        */
      500     8353
      501     8354    2             CASE(%CG_TBRK#);
      502     8355
      503     8356    2               CALL MSTALOCK;
      504     8357    2               IF MYSTA$->KQ$STA.EVNT
      505     8358    2               OR MYSTA$->KQ$STA.EVCNT > 10 THEN
      506     8359    3                 DO;
      507     8360    3                 CALL MSTAUNLOCK;
      508     8361    3                 GOTO RET;
      509     8362    3                 END;
      510     8363    2               MYSTA$->KQ$STA.EVCNT=MYSTA$->KQ$STA.EVCNT+1;
      511     8364    2               CALL MSTAUNLOCK;
      512     8365    2               CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,INFO) ALTRET(NSTBRK);
      513     8366
      514     8367    2               GOTO RET;
      515     8368        /**/
      516     8369    2   NSTBRK:     CALL SLOCK;
      517     8370    2               CALL MSTALOCK;
      518     8371    2               MYSTA$->KQ$STA.EVSC=INFO;
      519     8372    2               MYSTA$->KQ$STA.EVNT='1'B;
      520     8373    2   NSEVNT:     CALL MSTAUNLOCK;
      521     8374    2               CALL SUNLOCK;
      522     8375    2               IF KQ$CG.AUSTA$ ~= ADDR(NIL) THEN
      523     8376    3                 DO;
      524     8377                      %LOCK (G=KQ$CG.GATE.CG);
      525     8380    3                 KQ$CG.DELAY.AU='1'B;
      526     8381                      %UNLOCK (G=KQ$CG.GATE.CG);
      527     8384    3                 END;
      528     8385    2               GOTO RET;
      529     8386        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:18   
      530     8387
      531     8388
      532     8389        /*D*
      533     8390                           %CG_STDSC - symbiont terminal disconnect
      534     8391                           %CG_STHLD - symbiont terminal held
      535     8392                           %CG_SFERR - symbiont file error
      536     8393                           %CG_STERR - symbiont terminal error
      537     8394                           %CG_SFEXT - symbiont finished extent
      538     8395                           %CG_SFSPA - symbiont finished spacing
      539     8396                           %CG_STOKN - symbiont token
      540     8397                           %CG_STACK - symbiont granule acknowlege
      541     8398                           %CG_WARN  - comgroup low on space warning
      542     8399                           %CG_FPEXIT -FPRG issued an M$EXIT
      543     8400                           %CG_FPABORT-FPRG aborted
      544     8401        */
      545     8402
      546     8403    2             CASE(%CG_STDSC#,%CG_STHLD#,%CG_SFERR#,%CG_STERR#,%CG_SFEXT#,
      547     8404    2               %CG_SFSPA#,%CG_STOKN#,%CG_STACK#,%CG_WARN#,
      548     8405    2               %CG_FPEXIT#,%CG_FPABORT#);
      549     8406
      550     8407    2               CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,INFO);
      551     8408        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:19   
      552     8409        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:20   
      553     8410        /*D*
      554     8411                           %CG_FPLDTRC# - FPRG issued an M$LDTRC
      555     8412        */
      556     8413
      557     8414    2             CASE(%CG_FPLDTRC#);
      558     8415    2               IF MBLK$=ADDR(NIL) THEN CALL KQM$GETMBLK(KQ$CG,MBLK$,TYP)
      559     8416    3                WHENALTRETURN DO;
      560     8417    3                  IF REGFLG=0 THEN GOTO ALT;
      561     8418    3                  TYP=KQMR_MBLK#;
      562     8419    3                  MBLK$=MYSTA$;
      563     8420    3                  CALL KQM$GETBR(KQ$CG,MBLK$,TYP) ALTRET(ALT);
      564     8421    3                  END;
      565     8422    2               TYP=SIZEC(VLP$FPRG);
      566     8423    2               IF REGFLG~=0
      567     8424    2               THEN CALL KQD$GETR(KQ$CG,DBLK$,TYP) ALTRET(ALT);
      568     8425    2               ELSE CALL KQD$GET (KQ$CG,DBLK$,TYP) ALTRET(ALT);
      569     8426    2               FPRG$=PINCRW(DBLK$,SIZEW(KQ$DBLK));
      570     8427    2               FPRG$->VLP$FPRG=ADDR(INFO)->VLP$FPRG;
      571     8428    2               DBLK$->KQ$DBLK.STAMP=KQ$MBLK.STAMP;
      572     8429    2               CALL KQD$UNLOCK(KQ$CG,DBLK$);
      573     8430    2               CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,0,TYP,SIZEC(VLP$FPRG));
      574     8431
      575     8432        /*D*
      576     8433                           %CG_JNLD  - JOURNAL delete message
      577     8434
      578     8435                           Called from the comgroup message delete logic
      579     8436                           when a message is being deleted after being
      580     8437                           journaled.
      581     8438
      582     8439                           The third parameter is an MBLK which contains
      583     8440                           the MSGID of the message being deleted.  This
      584     8441                           passed MBLK is used and deleted, since it is
      585     8442                           utilized to create a data-less message which
      586     8443                           is send to the journal station.
      587     8444        */
      588     8445    2             CASE (%CG_JNLD#);
      589     8446    2               MBLK$=ADDR(INFO);
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:21   
      590     8447    2               IF KQ$CG.QISS THEN
      591     8448    3                 DO;
      592     8449    3                 ADDR(MBLK$->KQ$MBLK.KEY1)->B$$BIT72=MBLK$->KQ$MBLK.MID;
      593     8450    3                 MBLK$->KQ$MBLK.KEY2=AUEVKEY;
      594     8451    3                 END;
      595     8452    2               ELSE
      596     8453    3                 DO;
      597     8454    3                 MBLK$->KQ$MBLK.KEY1=AUEVKEY;
      598     8455    3                 ADDR(MBLK$->KQ$MBLK.KEY2)->B$$BIT72=MBLK$->KQ$MBLK.MID;
      599     8456    3                 END;
      600     8457    2               MBLK$->KQ$MBLK.DVE='0'B;
      601     8458    2               MBLK$->KQ$MBLK.JRNLD='0'B;
      602     8459    2               MBLK$->KQ$MBLK.JOURNAL='0'B;
      603     8460    2               MBLK$->KQ$MBLK.FORCECONT='0'B;
      604     8461    2               MBLK$->KQ$MBLK.MSGSIZE=0;
      605     8462    2               MBLK$->KQ$MBLK.PRIO=AUEVPRIL;
      606     8463    2               MBLK$->KQ$MBLK.DDA=0;
      607     8464    2               MBLK$->KQ$MBLK.FC=%CG_JNLD#;
      608     8465                    %LOCK (G=KQ$CG.TTREE.GATE);
      609     8468    2               MBLK$->KQ$MBLK.MID.PRIMARY=KQ$CG.MSGID;
      610     8469    2               KQ$CG.MSGID=KQ$CG.MSGID+1;
      611     8470    2               MBLK$->KQ$MBLK.MID.XT=0;
      612     8471                    %UNLOCK (G=KQ$CG.TTREE.GATE);
      613     8474                    /* MYSTA$ = KQ$CG.GORGOSTA$ here, so gate needs to be locked */
      614     8475                    %LOCK (G=MYSTA$->KQ$STA.GATE);
      615     8478    2               MYSTA$->KQ$STA.MBLK$=MBLK$;
      616     8479    2               CALL KQW$JNLD (MYSTA$->KQ$STA);
      617     8480    2               MBLK$=ADDR(NIL);
      618     8481        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:22   
      619     8482
      620     8483
      621     8484        /*D*
      622     8485                           %CG_UNLH# - HOLD event.  This record is sent
      623     8486                           to the AU whenever a latched transaction is put
      624     8487                           into HOLD status.
      625     8488
      626     8489
      627     8490                           %CG_UNLR# - RERUN event.  This record is sent
      628     8491                           to the AU whenever a latched transaction is put
      629     8492                           into RERUN status.
      630     8493
      631     8494                           %CG_UNLD# - DELETE event.  This record is sent
      632     8495                           to the AU whenever a latched transaction is
      633     8496                           deleted.
      634     8497        */
      635     8498
      636     8499    2             CASE(%CG_UNLH#,%CG_UNLR#,%CG_UNLD#);
      637     8500
      638     8501    2               IF NOT KQ$CG.AUCTL.UNLAMSG THEN GOTO RET;
      639     8502    2               IF MBLK$=ADDR(NIL) THEN
      640     8503    2                CALL KQM$GETMBLK(KQ$CG,MBLK$,TYP) ALTRET(NOMBLK);
      641     8504    2   GETM5:      ;
      642     8505    2               TYP=SIZEC(VLP$STATION);
      643     8506    2               IF REGFLG~=0 THEN
      644     8507    2                CALL KQD$GETR(KQ$CG,DBLK$,TYP) ALTRET(ALT);
      645     8508    2               ELSE
      646     8509    2                CALL KQD$GET(KQ$CG,DBLK$,TYP) ALTRET(ALT);
      647     8510    2               STA$=PINCRW(DBLK$,SIZEW(KQ$DBLK));
      648     8511    2               STA$->VLP$STATION=VLP_STATION;
      649     8512    2               STA$->VLP$STATION.MSGID#=ADDR(INFO)->KQ$MBLK.MID.PRIMARY;
      650     8513    2               STA$->VLP$STATION.MSGIDXT=BINBIT(ADDR(INFO)->KQ$MBLK.MID.XT,36);
      651     8514    2               IF KQ$CG.QISS THEN
      652     8515    3                 DO;
      653     8516    3                 STA$->VLP$STATION.STATION#=ADDR(INFO)->KQ$MBLK.KEY1;
      654     8517    3                 STA$->VLP$STATION.MSGTYP#=ADDR(INFO)->KQ$MBLK.KEY2;
      655     8518    3                 END;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:23   
      656     8519    2               ELSE
      657     8520    3                 DO;
      658     8521    3                 STA$->VLP$STATION.STATION#=ADDR(INFO)->KQ$MBLK.KEY2;
      659     8522    3                 STA$->VLP$STATION.MSGTYP#=ADDR(INFO)->KQ$MBLK.KEY1;
      660     8523    3                 END;
      661     8524    2               DBLK$->KQ$DBLK.STAMP=KQ$MBLK.STAMP;
      662     8525    2               CALL KQD$UNLOCK(KQ$CG,DBLK$);
      663     8526    2               IF NOT KQ$CG.RCVR THEN
      664     8527    2                CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,%CG_UNL_USER#,TYP,SIZEC(
              8527                         VLP$STATION));
      665     8528    2               ELSE
      666     8529    2                CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,%CG_UNL_RCVR#,TYP,SIZEC(
              8529                         VLP$STATION));
      667     8530    2               GOTO RET;
      668     8531        /**/
      669     8532    2   NOMBLK:     ;
      670     8533    2               IF REGFLG=0 THEN
      671     8534    2                GOTO ALT;
      672     8535    2               TYP=KQMR_MBLK#;
      673     8536    2               MBLK$=MYSTA$;
      674     8537    2               CALL KQM$GETBR(KQ$CG,MBLK$,TYP) ALTRET(ALT);
      675     8538    2               GOTO GETM5;
      676     8539        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:24   
      677     8540
      678     8541        /*D*
      679     8542                      %CG_FWCG - FWCG-complete event.  This event doesn't
      680     8543                      actually go to the AU; it goes to the current station.
      681     8544                      KCA$TELLAUM is the only way to report this event,
      682     8545                      since the passed MBLK already contains DDA and MSGSIZE.
      683     8546                      We simply set up the rest of the MBLK correctly and
      684     8547                      send the message to ourselves.
      685     8548
      686     8549                      A MSGID is obtained and returned in the 3rd param
      687     8550                      of KCA$TELLAUM.
      688     8551        */
      689     8552
      690     8553    2             CASE (%CG_FWCG#);
      691     8554
      692     8555    2               IF MBLK$ = ADDR(NIL) THEN CALL SC_CGAUERR;
      693     8556    2               CALL SENDAU (MYSTA$->KQ$STA,%CG_FWCG#,AUEVPRIL,INFO);
      694     8557        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:25   
      695     8558
      696     8559
      697     8560    2             CASE(ELSE);
      698     8561
      699     8562    2               CALL SC_CGAUERR;
      700     8563        /*S*  SCREECH_CODE: KCA-S$CGAUERR
      701     8564              TYPE: SCREECH
      702     8565              MESSAGE: Error reporting an event to the AU of a comgroup
      703     8566        */
      704     8567    2           END;
      705     8568
      706     8569
      707     8570    1   RET:  ;
      708     8571    1         IF MBLK$ ~= ADDR(NIL) THEN
      709     8572    1          CALL KQM$RELMBLK (KQ$CG,MBLK$);
      710     8573    1         RETURN;
      711     8574        /**/
      712     8575    1   ALT:  ;
      713     8576    2         IF MBLK$~=ADDR(NIL) THEN DO;
      714     8577    2           IF MBLK$->KQ$MBLK.DDA~=0
      715     8578    2           THEN CALL KQD$DELDDA(KQ$CG,MBLK$->KQ$MBLK.STAMP,
      716     8579    2            MBLK$->KQ$MBLK.DDA);
      717     8580    2           CALL KQM$RELMBLK(KQ$CG,MBLK$);
      718     8581    2           END;
      719     8582    1         ALTRETURN;
      720     8583        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:26   
      721     8584        /**/
      722     8585        /*F* NAME:         KCA$CLOCK
      723     8586             PURPOSE:      To process deferred AU-related items
      724     8587             CALL:         KCA$CLOCK (KQ$CG)
      725     8588             DESCRIPTION:  Called from KCC$CLOCK when KQ$CG.DELAY.AU is
      726     8589                           found set.
      727     8590        */
      728     8591    1   KCA$CLOCK: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */
      729     8592        /**/
      730     8593    1         CG$=ADDR(PARM);
      731     8594    1         REGFLG=0;
      732     8595              %LOCK (G=KQ$CG.GATE.CG);
      733     8598    1         KQ$CG.DELAY.AU='0'B;
      734     8599              %UNLOCK (G=KQ$CG.GATE.CG);
      735     8602    1   CLOCK0:;
      736     8603    1         CALL SLOCK;
      737     8604    1         STA$=KQ$CG.STREE.HEAD$;
      738     8605    2           DO WHILE (STA$ ~= ADDR(NIL));
      739     8606    2           CALL STALOCK;
      740     8607    2           IF STA$->KQ$STA.TERM THEN
      741     8608    2            IF STA$->KQ$STA.EVNT THEN
      742     8609    3              DO;
      743     8610    3              STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
      744     8611    3              CALL TBRK;
      745     8612    3   CLOCK1:    IF NOT STA$->KQ$STA.IDSC THEN
      746     8613    3               STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;
      747     8614    3              ELSE
      748     8615    4                DO;
      749     8616    4                CALL STAUNLOCK;
      750     8617    4                CALL SUNLOCK;
      751     8618    4                CALL KQP$UNLOCK (STA$->KQ$STA);
      752     8619    4                GOTO CLOCK0;
      753     8620    4                END;
      754     8621    3              END;
      755     8622    2           CALL STAUNLOCK;
      756     8623    2           STA$=STA$->KQ$STA.BTN.FLINK$;
      757     8624    2           END;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:27   
      758     8625    1         CALL SUNLOCK;
      759     8626    1         RETURN;
      760     8627        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:28   
      761     8628        /****************************************************************
      762     8629        *****************************************************************/
      763     8630        /*D* NAME:         TBRK
      764     8631             PURPOSE:      To perform functions for handling
      765     8632                           terminal breaks */
      766     8633        /**/
      767     8634    1   TBRK: PROC;
      768     8635        /**/
      769     8636    2   DCL T$ PTR;
      770     8637    2   DCL SENT UBIN;
      771     8638    2   DCL COD UBIN;
      772     8639        /**/
      773     8640    2         COD=%CG_TBRK#;
      774     8641    2         TYP=STA$->KQ$STA.EVSC;
      775     8642    2   EVNT: SENT=0;
      776     8643    2         CALL STAUNLOCK;
      777     8644    2         CALL SUNLOCK;
      778     8645    2         T$=MBLK$;
      779     8646    2         MBLK$=ADDR(NIL);
      780     8647    2         CALL SENDAU (STA$->KQ$STA,COD,AUEVPRIL,TYP) ALTRET(NOSENT);
      781     8648    2         SENT=1;
      782     8649    2   NOSENT:;
      783     8650    2         MBLK$=T$;
      784     8651    2         CALL SLOCK;
      785     8652    2         CALL STALOCK;
      786     8653    2         IF SENT ~= 0 THEN STA$->KQ$STA.EVNT='0'B;
      787     8654    2         RETURN;
      788     8655    2   END TBRK;
      789     8656        /****************************************************************
      790     8657        *****************************************************************/
      791     8658        /*D* NAME:         SLOCK SUNLOCK STALOCK STAUNLOCK MSTALOCK MSTAUNLOCK
      792     8659             PURPOSE:      Routines to lock/unlock gates */
      793     8660        /**/
      794     8661    1   SLOCK: PROC;
      795     8662        /**/
      796     8663        %LOCK (G=KQ$CG.STREE.GATE);
      797     8666    2         RETURN;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:29   
      798     8667    2   SUNLOCK: ENTRY;
      799     8668        /**/
      800     8669              %UNLOCK (G=KQ$CG.STREE.GATE);
      801     8672    2         RETURN;
      802     8673    2   STALOCK: ENTRY;
      803     8674        /**/
      804     8675              %LOCK (G=STA$->KQ$STA.GATE);
      805     8678    2         RETURN;
      806     8679    2   STAUNLOCK: ENTRY;
      807     8680        /**/
      808     8681              %UNLOCK (G=STA$->KQ$STA.GATE);
      809     8684    2         RETURN;
      810     8685    2   MSTALOCK: ENTRY;
      811     8686        /**/
      812     8687              %LOCK (G=MYSTA$->KQ$STA.GATE);
      813     8690    2         RETURN;
      814     8691    2   MSTAUNLOCK: ENTRY;
      815     8692        /**/
      816     8693              %UNLOCK (G=MYSTA$->KQ$STA.GATE);
      817     8696    2         RETURN;
      818     8697    2   END SLOCK;
      819     8698        /**/
      820     8699        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:30   
      821     8700        /****************************************************************
      822     8701        *****************************************************************/
      823     8702        /*D* NAME:         SENDAU
      824     8703             PURPOSE:      To send an event to the AU
      825     8704             CALL:         SENDAU (KQ$STA,CODE,PRIO,INFO[,DDA,DDASIZ) ALTRET(LOC)
      826     8705             INPUT:        KQ$STA     is the sending station
      827     8706                           CODE       is the %CG_XXXX# event code
      828     8707                           PRIO       is the prio that the message is to have
      829     8708                           INFO       one word of info to be received by the
      830     8709                                      AU in B$CGAURD.INFO
      831     8710                           DDA        the DDA for connect events
      832     8711                           DDASIZ     the info size for connect events
      833     8712             DESCRIPTION:  An MBLK is obtained if we don't have one already
      834     8713                           (MBLK$ ~= ADDR(NIL)), and initialized as appropriate
      835     8714                           to the event being passed.  The event is sent to
      836     8715                           the AU via KQW$WRITE.
      837     8716
      838     8717                           In order to avoid making a data block to carry
      839     8718                           the contents of B$CGAURD, we kluge things so that
      840     8719                           this info is carried in the MBLK itself.  This
      841     8720                           requires magic code in KQR$READ when the message
      842     8721                           is being read.  In particular:
      843     8722
      844     8723                              EVENT     - is stored in KQ$MBLK.FC
      845     8724                              INFO      - is stored as the MSGID extension
      846     8725        */
      847     8726    1   SENDAU: PROC(KQ$STA,CODE,PRIO,INFO,DDA,DDASIZ) ALTRET;
      848     8727
      849     8728        /**/
      850     8729        /* PARAMETERS */
      851     8730        /**/
      852     8731        %KQ_STA (FPTN=KQ$STA,STCLASS=);
      853     9070    2   DCL CODE UBIN;
      854     9071    2   DCL PRIO UBIN;
      855     9072    2   DCL INFO UBIN;
      856     9073    2   DCL DDA UBIN;
      857     9074    2   DCL DDASIZ UBIN;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:31   
      858     9075
      859     9076
      860     9077        /**/
      861     9078        /* AUTO */
      862     9079        /**/
      863     9080    2   DCL I UBIN;
      864     9081    2   DCL DSTA CHAR(8);
      865     9082    2   DCL DBLK$ PTR;
      866     9083
      867     9084
      868     9085        /**/
      869     9086        /* BASED */
      870     9087        /**/
      871     9088        %KQ_STA (FPTN=KQ$STA1,STCLASS=BASED);
      872     9427    2   DCL MOVEI CHAR(I) BASED ALIGNED;
      873     9428
      874     9429
      875     9430
      876     9431            %LOCK (G=KQ$CG.GATE.CG);
      877     9434    2         IF CODE = %CG_FWCG# THEN
      878     9435    2          DSTA=KQ$STA.BTN.KEY;
      879     9436    2         ELSE
      880     9437    3           DO;
      881     9438    3           IF KQ$CG.AUSTA$=ADDR(NIL) THEN
      882     9439    4             DO;
      883     9440    4             IF CODE=%CG_UNLH# OR CODE=%CG_UNLR# OR CODE=%CG_UNLD# THEN
      884     9441    5               DO;
      885     9442    5               DSTA='*GORGO';
      886     9443    5               GOTO SENDIT;
      887     9444    5               END;
      888     9445                  %UNLOCK (G=KQ$CG.GATE.CG);
      889     9448    4             ALTRETURN;
      890     9449    4             END;
      891     9450    3           DSTA=KQ$CG.AUSTA$->KQ$STA1.BTN.KEY;
      892     9451    3           END;
      893     9452    2   SENDIT: ;
      894     9453    2         KQ$CG.AUSENDCNT=KQ$CG.AUSENDCNT+1;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:32   
      895     9454              %UNLOCK (G=KQ$CG.GATE.CG);
      896     9457    2         IF MBLK$=ADDR(NIL) THEN
      897     9458    2          CALL KQM$GETMBLK(KQ$CG,MBLK$,I) ALTRET(NOMBLK);
      898     9459    2   GOTMBLK: ;
      899     9460    2         IF NOT KQ$CG.QISS THEN
      900     9461    3           DO;
      901     9462    3           KQ$MBLK.KEY1=AUEVKEY;
      902     9463    3           KQ$MBLK.KEY2=KQ$STA.BTN.KEY;
      903     9464    3           END;
      904     9465    2         ELSE
      905     9466    3           DO;
      906     9467    3           KQ$MBLK.KEY1=KQ$STA.BTN.KEY;
      907     9468    3           KQ$MBLK.KEY2=AUEVKEY;
      908     9469    3           END;
      909     9470    2         KQ$MBLK.STAR='1'B;
      910     9471              %LOCK (G=KQ$CG.TTREE.GATE);
      911     9474    2         KQ$MBLK.MID.PRIMARY=KQ$CG.MSGID;
      912     9475    2         KQ$CG.MSGID=KQ$CG.MSGID+1;
      913     9476              %UNLOCK (G=KQ$CG.TTREE.GATE);
      914     9479    2         IF CODE = %CG_FWCG# THEN INFO=KQ$MBLK.MID.PRIMARY;
      915     9480    2         ELSE
      916     9481    2          IF ADDR(INFO)~=ADDR(NIL) THEN
      917     9482    2           KQ$MBLK.MID.XT=INFO;
      918     9483    2          ELSE
      919     9484    2           KQ$MBLK.MID.XT=0;
      920     9485    2         KQ$MBLK.PRIO=PRIO;
      921     9486    2         KQ$MBLK.FC=CODE;
      922     9487    2         KQ$MBLK.DSTA=DSTA;
      923     9488    2         IF (CODE=%CG_TCON# OR CODE=%CG_DOPN#)
      924     9489    2         AND KQ$MBLK.DDA=0
      925     9490    3         THEN DO;  /* Note that connecting terminal stations already have     */
      926     9491                          /* their MBLK.DDA filled in so there is no need to do this */
      927     9492                          /* again.                                                  */
      928     9493    3           KQ$MBLK.MSGSIZE=KQ$STA.CNNCTSIZE;
      929     9494    3           I=KQ$STA.CNNCTSIZE;
      930     9495    3           CALL KQD$GETR(KQ$CG,DBLK$,I) ALTRET(NODBLK);
      931     9496    3           KQ$MBLK.DDA=I;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:33   
      932     9497    3           I=KQ$STA.CNNCTSIZE;
      933     9498    3           IF ADDR(CNNCT$)~=ADDR(NIL) THEN
              9498                    /* don't screech if we didn't pass this parm */
      934     9499    3            PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=CNNCT$->MOVEI;
      935     9500    3           ELSE
      936     9501    3            PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=' ';
      937     9502    3           DBLK$->KQ$DBLK.STAMP=KQ$MBLK.STAMP;
      938     9503    3           CALL KQD$UNLOCK(KQ$CG,DBLK$);
      939     9504    3           END;
      940     9505    2         IF ADDR(DDA)~=ADDR(NIL) THEN
      941     9506    3           DO;
      942     9507    3           KQ$MBLK.DDA=DDA;
      943     9508    3           KQ$MBLK.MSGSIZE=DDASIZ;
      944     9509    3           END;
      945     9510              %LOCK (G=KQ$CG.GORGOSTA$->KQ$STA1.GATE);
      946     9513    2         KQ$CG.GORGOSTA$->KQ$STA1.MBLK$=MBLK$;
      947     9514    2         CALL KQW$TELLAU (KQ$CG.GORGOSTA$->KQ$STA1);
      948     9515    2         MBLK$=ADDR(NIL);
      949     9516              %LOCK (G=KQ$CG.GATE.CG);
      950     9519    2         KQ$CG.AUSENDCNT=KQ$CG.AUSENDCNT-1;
      951     9520              %UNLOCK (G=KQ$CG.GATE.CG);
      952     9523    2         RETURN;
      953     9524        /**/
      954     9525        /**/
      955     9526        /**/
      956     9527        /**/
      957     9528    2   NOMBLK:;
      958     9529    2         IF REGFLG=0 THEN
      959     9530    2          GOTO NOMBLK5;
      960     9531    2         I=KQMR_MBLK#;
      961     9532    2         MBLK$=ADDR(KQ$STA);
      962     9533    2         CALL KQM$GETBR(KQ$CG,MBLK$,I) ALTRET(NOMBLK5);
      963     9534    2         GOTO GOTMBLK;
      964     9535        /**/
      965     9536    2   NOMBLK5: ;
      966     9537    2   NODBLK: ;
      967     9538    2         ALTRETURN;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:34   
      968     9539        /**/
      969     9540    2   END SENDAU;
      970     9541        /**/
      971     9542    1   END KCA$TELLAU;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:35   
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F_CP6.:E05TOU  is referenced.
      No diagnostics issued in procedure KCA$TELLAU.

   Procedure KCA$TELLAU requires 1439 words for executable code.
   Procedure KCA$TELLAU requires 38 words of local(AUTO) storage.

    No errors detected in file KCA$AU.:E05TSI    .

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:36   

 Object Unit name= KCA$TELLAU                                 File name= KCA$AU.:E05TOU
 UTS= JUL 30 '97 00:08:27.64 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     14     16  KCA$TELLAU
    1   Proc  even  none  1439   2637  KCA$TELLAU
    2  RoData even  none    29     35  KCA$TELLAU

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  KCA$TELLAU
     1      6          yes     yes      Std        3  KCA$TELLAUR
     1     15          yes     yes      Std        3  KCA$TELLAUM
     1   1745          yes     yes      Std        1  KCA$CLOCK
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:37   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 KQP$UNLOCK
 yes     yes           Std       3 KQD$DELDDA
 yes     yes           Std       2 KQC$ACTSTA
 yes     yes           Std       3 KQD$FETCHR
 yes     yes           Std       2 KQD$UNLOCK
 yes     yes           Std       3 KQM$GETMBLK
 yes     yes           Std       3 KQD$GETR
 yes     yes           Std       3 KQD$GET
 yes     yes           Std       2 KQC$DISCSTA
 yes     yes           Std       2 KQL$MERGEMLH
 yes     yes           Std       2 KQC$DACTSTA
         yes           Std       1 KCO$DSCTRMGO
         yes           Std       4 SSR$RUE
 yes     yes           Std       3 KQM$GETBR
 yes     yes           Std       1 KQW$JNLD
 yes     yes           Std       2 KQM$RELMBLK
 yes     yes           Std       1 KQW$TELLAU
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_CGAUERR                            SC_CGNOMBLK                           B_VECTNIL
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:38   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:39   


        1        1        /*M*  KCA$AU - Administrative user interface for comgroups */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 8        ,IAD=0,PRB */
        9        9        /**/
       10       10        /*P* NAME:         KCA$AU
       11       11
       12       12             PURPOSE:      Provide interfaces between the comgroup and
       13       13                           its administrative user.
       14       14
       15       15        */
       16       16
       17       17
       18       18
       19       19        KCA$TELLAU: PROC(PARM,CODE,INFO) ALTRET;

     19  1 000000   000000 700200 xent  KCA$TELLAU   TSX0  ! X66_AUTO_3
         1 000001   000046 000003                    ZERO    38,3

       20       20
       21       21
       22       22
       23       23        /**/
       24       24        /* INCLUDES */
       25       25        /**/
       26       26        %INCLUDE F_CP6;
       27     1051        %INCLUDE HF_LOCK_C;
       28     1065        %INCLUDE KC$CP6V_C;
       29     1185        %INCLUDE KC_CP6;
       30     1745        %INCLUDE KI_CP6;
       31     2841        %INCLUDE KQ_MAC_C;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:40   
       32     5391        %INCLUDE KQ_SUBS_C;
       33     5691        %INCLUDE NK$LDCT;
       34     5793        %INCLUDE NK_SUBS;
       35     5818        %INCLUDE SS_SCHED_C;
       36     6051
       37     6052
       38     6053        /**/
       39     6054        /* BASED STRUCTURES */
       40     6055        /**/
       41     6056        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CG$)");
       42     6795        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS=BASED);
       43     6848        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)");
       44     7118        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
       45     7457        %NK$LDCT;
       46     7503        %VLP_FPRG(FPTN=VLP$FPRG,STCLASS=BASED);
       47     7524        %VLP_STATION (FPTN=VLP$STATION,STCLASS=BASED);
       48     7551    1   DCL UBINHALF UBIN(18) BASED ALIGNED;
       49     7552    1   DCL MOVEI CHAR(I) BASED ALIGNED;
       50     7553    1   DCL B$$BIT72 BIT(72) BASED ALIGNED;
       51     7554
       52     7555
       53     7556
       54     7557        /**/
       55     7558        /* PARAMETERS */
       56     7559        /**/
       57     7560    1   DCL PARM UBIN;
       58     7561    1   DCL CODE UBIN;
       59     7562    1   DCL INFO UBIN;
       60     7563    1   DCL CNNCT$ REDEF INFO PTR;
       61     7564
       62     7565
       63     7566
       64     7567        /**/
       65     7568        /* AUTO */
       66     7569        /**/
       67     7570    1   DCL MYSTA$ PTR;
       68     7571    1   DCL CG$ PTR;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:41   
       69     7572    1   DCL STA$ PTR;
       70     7573    1   DCL FPRG$ REDEF STA$ PTR;
       71     7574    1   DCL ACTION UBIN;
       72     7575    1   DCL UTS REDEF ACTION UBIN;
       73     7576    1   DCL TYP UBIN;
       74     7577    1   DCL DBLK$ PTR;
       75     7578    1   DCL STMP REDEF DBLK$ UBIN;
       76     7579    1   DCL REGFLG UBIN;
       77     7580    1   DCL MBLK$ PTR;
       78     7581    1   DCL I UBIN;
       79     7582    1   DCL DDA UBIN;
       80     7583    1   DCL NXT$ PTR;
       81     7584
       82     7585
       83     7586
       84     7587        /**/
       85     7588        /* EQUS */
       86     7589        /**/
       87     7590        %EQU_CG;
       88     7638
       89     7639
       90     7640
       91     7641        /**/
       92     7642        /* EXTERNAL ROUTINES */
       93     7643        /**/
       94     7644    1   DCL KCO$DSCTRMGO  ENTRY(1);
       95     7645    1   DCL KQC$ACTSTA    ENTRY(2) ALTRET;
       96     7646    1   DCL KQC$DACTSTA   ENTRY(2) ALTRET;
       97     7647    1   DCL KQC$DISCSTA   ENTRY(2) ALTRET;
       98     7648    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
       99     7649    1   DCL KQD$FETCHR    ENTRY(3) ALTRET;
      100     7650    1   DCL KQD$GET       ENTRY(3) ALTRET;
      101     7651    1   DCL KQD$GETR      ENTRY(3) ALTRET;
      102     7652    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      103     7653    1   DCL KQL$MERGEMLH  ENTRY(2) ALTRET;
      104     7654    1   DCL KQM$GETBR     ENTRY(3) ALTRET;
      105     7655    1   DCL KQM$GETMBLK   ENTRY(3) ALTRET;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:42   
      106     7656    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      107     7657    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      108     7658    1   DCL KQU$DELETE    ENTRY(1) ALTRET;
      109     7659    1   DCL KQW$JNLD      ENTRY(1) ALTRET;
      110     7660    1   DCL KQW$TELLAU    ENTRY(1) ALTRET;
      111     7661    1   DCL SC_CGAUERR    ENTRY    CONV(2,0);
      112     7662    1   DCL SC_CGNOMBLK   ENTRY    CONV(2,0);
      113     7663    1   DCL SSR$RUE       ENTRY(4);
      114     7664
      115     7665
      116     7666
      117     7667        /**/
      118     7668        /* CONSTANT */
      119     7669        /**/
      120     7670    1   DCL AUEVKEY CONSTANT CHAR(8) INIT('*AUEV');
      121     7671    1   DCL AUEVPRIH CONSTANT UBIN INIT(%(KQ_AUEP#+1));
      122     7672    1   DCL AUEVPRIL CONSTANT UBIN INIT(%KQ_AUEP#);
      123     7673        %KQ_MBLK (FPTN=KQ_IMBLK,STCLASS=SYMREF);
      124     7943        %VLP_STATION (STCLASS=CONSTANT);
      125     7970        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:43   
      126     7971
      127     7972
      128     7973        /*F* NAME:         KCA$TELLAU
      129     7974
      130     7975             PURPOSE:      Send a message to the AU, and perform the
      131     7976                           functions associated with the message.
      132     7977
      133     7978        */
      134     7979
      135     7980
      136     7981
      137     7982        /*D* NAME:         KCA$TELLAU
      138     7983
      139     7984             CALL:         CALL KCA$TELLAU (KQ$STA,CODE,INFO) ALTRET(LOC);
      140     7985
      141     7986             INPUT:        KQ$STA - The station to which the
      142     7987                                  message applies.
      143     7988                           CODE - The type of action to be taken
      144     7989                           INFO - Optional word of information
      145     7990
      146     7991             DESCRIPTION:  If appropriate, the AU is sent a message.  Then
      147     7992                           if needed, some action is taken.
      148     7993
      149     7994                           If a message needs to be sent then KCA$AU
      150     7995                           attempts to acquire an MBLK.  If none are
      151     7996                           available, we ALTRET.
      152     7997
      153     7998
      154     7999        KCA$TELLAU: ENTRY(PARM,CODE,INFO) ALTRET;
      155     8000        */
      156     8001
      157     8002    1         REGFLG=0;  /* Don't REG */

   8002  1 000002   200014 450100                    STZ     REGFLG,,AUTO

      158     8003    1         MBLK$=ADDR(NIL);

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:44   
   8003  1 000003   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000004   200015 756100                    STQ     MBLK$,,AUTO

      159     8004    1         GOTO COM;

   8004  1 000005   000051 710000 1                  TRA     COM

      160     8005
      161     8006        /**/
      162     8007        /*F* NAME:         KCA$TELLAUR
      163     8008             PURPOSE:      Same as KCA$TELLAU
      164     8009        */
      165     8010        /**/
      166     8011        /*D* NAME:         KCA$TELLAUR
      167     8012             CALL:         KCA$TELLAUR (KQ$STA,CODE,INFO) ALTRET(LOC)
      168     8013             INPUT:        Same as KCA$TELLAU
      169     8014             DESCRIPTION:  Same as KCA$TELLAU except that the caller
      170     8015                           is blocked if necessary in order to wait for
      171     8016                           an MBLK to become available.  If none, ALTRET.
      172     8017        */
      173     8018    1   KCA$TELLAUR: ENTRY(PARM,CODE,INFO) ALTRET;

   8018  1 000006   000000 700200 xent  KCA$TELLAUR  TSX0  ! X66_AUTO_3
         1 000007   000046 000003                    ZERO    38,3

      174     8019
      175     8020    1         REGFLG=1;  /* REG if no MBLKs */

   8020  1 000010   000001 235007                    LDA     1,DL
         1 000011   200014 755100                    STA     REGFLG,,AUTO

      176     8021    1         MBLK$=ADDR(NIL);

   8021  1 000012   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000013   200015 756100                    STQ     MBLK$,,AUTO

      177     8022    1         GOTO COM;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:45   

   8022  1 000014   000051 710000 1                  TRA     COM

      178     8023
      179     8024        /**/
      180     8025        /*F* NAME:         KCA$TELLAUM
      181     8026             PURPOSE:      Same as KCA$TELLAU
      182     8027        */
      183     8028        /**/
      184     8029        /*D* NAME:         KCA$TELLAUM
      185     8030             CALL:         KCA$TELLAUM (KQ$STA,CODE,INFO)
      186     8031             INPUT:        Same as KCA$TELLAU except that STA$->KQ$STA.MBLK$
      187     8032                           is the MBLK to use.
      188     8033             DESCRIPTION:  Same as KCA$TELLAU except that it is assumed that
      189     8034                           an MBLK will be required, and it is present in
      190     8035                           the passed station's MBLK$.  This routine never
      191     8036                           ALTRETs.
      192     8037
      193     8038                           The various event codes are:
      194     8039        */
      195     8040    1   KCA$TELLAUM: ENTRY(PARM,CODE,INFO) ALTRET;

   8040  1 000015   000000 700200 xent  KCA$TELLAUM  TSX0  ! X66_AUTO_3
         1 000016   000046 000003                    ZERO    38,3

      196     8041
      197     8042    1         MYSTA$=ADDR(PARM);

   8042  1 000017   200003 236100                    LDQ     @PARM,,AUTO
         1 000020   200006 756100                    STQ     MYSTA$,,AUTO

      198     8043    1         REGFLG=0;

   8043  1 000021   200014 450100                    STZ     REGFLG,,AUTO

      199     8044              %LOCK (G=MYSTA$->KQ$STA.GATE);

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:46   
   8045  1 000022   000016 036003                    ADLQ    14,DU
         1 000023   200042 756100                    STQ     DBLK$+2,,AUTO
         1 000024   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 000025   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000026   000000 701000 xent               TSX1    HFC$LOCK
         1 000027   000000 011000                    NOP     0

      200     8047    1         MBLK$=MYSTA$->KQ$STA.MBLK$;

   8047  1 000030   200006 470500                    LDP0    MYSTA$,,AUTO
         1 000031   000012 236100                    LDQ     10,,PR0
         1 000032   200015 756100                    STQ     MBLK$,,AUTO

      201     8048    1         MYSTA$->KQ$STA.MBLK$=ADDR(NIL);

   8048  1 000033   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000034   000012 756100                    STQ     10,,PR0

      202     8049              %UNLOCK (G=MYSTA$->KQ$STA.GATE);

   8050  1 000035   200006 236100                    LDQ     MYSTA$,,AUTO
         1 000036   000016 036003                    ADLQ    14,DU
         1 000037   200042 756100                    STQ     DBLK$+2,,AUTO
         1 000040   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 000041   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000042   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000043   000000 011000                    NOP     0

      203     8052    1         IF MBLK$=ADDR(NIL) THEN CALL SC_CGNOMBLK;

   8052  1 000044   200015 236100                    LDQ     MBLK$,,AUTO
         1 000045   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000046   000051 601000 1                  TNZ     COM

   8052  1 000047   000000 713400 xsym               CLIMB   SC_CGNOMBLK
         1 000050   000000 600000 xsid               climb   nvectors=         0

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:47   
   8052  1 000051                       COM          null
      204     8053        /*S* SCREECH_CODE: KCA-S$CGNOMBLK
      205     8054             TYPE:         SNAP
      206     8055             MESSAGE:      No MBLK was obtained for announcing an event to the AU
      207     8056             REMARKS:      KCA$TELLAUM must be called with an MBLK already set up
      208     8057                           for the station.  If one doesn't exist, a snap is sufficient
      209     8058                           because we will go ahead and set one up.  However, this snap
      210     8059                           is here because we can't always fill in all the information,
      211     8060                           i.e., terminal connection.  */
      212     8061
      213     8062    1   COM:  ;
      214     8063    1         MYSTA$=ADDR(PARM);

   8063  1 000051   200003 236100                    LDQ     @PARM,,AUTO
         1 000052   200006 756100                    STQ     MYSTA$,,AUTO

      215     8064    1         CG$=MYSTA$->KQ$STA.CG$;

   8064  1 000053   200006 470500                    LDP0    MYSTA$,,AUTO
         1 000054   000007 236100                    LDQ     7,,PR0
         1 000055   200007 756100                    STQ     CG$,,AUTO

   8064  1 000056                       AGAIN        null
      216     8065        /**/
      217     8066    1   AGAIN: ;
      218     8067    2           DO CASE(CODE);

   8067  1 000056   200004 471500                    LDP1    @CODE,,AUTO
         1 000057   100000 235100                    LDA     0,,PR1
         1 000060   000033 115007                    CMPA    27,DL
         1 000061   000063 602005 1                  TNC     AGAIN+5,AL
         1 000062   001676 710000 1                  TRA     s:8562
         1 000063   000706 710000 1                  TRA     s:8270
         1 000064   000745 710000 1                  TRA     s:8294
         1 000065   000767 710000 1                  TRA     s:8308
         1 000066   001030 710000 1                  TRA     s:8334
         1 000067   001064 710000 1                  TRA     s:8356
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:48   
         1 000070   001676 710000 1                  TRA     s:8562
         1 000071   001453 710000 1                  TRA     s:8501
         1 000072   001453 710000 1                  TRA     s:8501
         1 000073   001453 710000 1                  TRA     s:8501
         1 000074   001165 710000 1                  TRA     s:8407
         1 000075   001165 710000 1                  TRA     s:8407
         1 000076   001165 710000 1                  TRA     s:8407
         1 000077   001165 710000 1                  TRA     s:8407
         1 000100   001165 710000 1                  TRA     s:8407
         1 000101   001165 710000 1                  TRA     s:8407
         1 000102   001165 710000 1                  TRA     s:8407
         1 000103   001165 710000 1                  TRA     s:8407
         1 000104   001165 710000 1                  TRA     s:8407
         1 000105   000116 710000 1                  TRA     s:8089
         1 000106   000442 710000 1                  TRA     AUDCON0
         1 000107   001656 710000 1                  TRA     s:8555
         1 000110   001332 710000 1                  TRA     s:8446
         1 000111   001050 710000 1                  TRA     s:8346
         1 000112   001676 710000 1                  TRA     s:8562
         1 000113   001165 710000 1                  TRA     s:8407
         1 000114   001165 710000 1                  TRA     s:8407
         1 000115   001201 710000 1                  TRA     s:8415

      219     8068
      220     8069        /*D*
      221     8070                           %CG_AUCON# - AU connect.  This occurs when the
      222     8071                           AU connects to the comgroup.  First the AU's
      223     8072                           DCB is activated.  Then the list of connected
      224     8073                           stations is scanned.  For each station found,
      225     8074                           AUCONTERM or AUCONDCB is checked to see what
      226     8075                           action is to be taken.  The possibilities are:
      227     8076                             ACTIVATE - the station is activated
      228     8077                             DEACTIVATE - the station is deactivated
      229     8078                             DISCONNECT - the station is disconnected
      230     8079                             NO-CHANGE - the station's status is not changed
      231     8080
      232     8081                           If the station is still connected, a connect
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:49   
      233     8082                           message is sent to the AU.
      234     8083                           Note that we don't have to worry about FPRG terminal
      235     8084                           stations here since they may not exist without an AU
      236     8085                           and we are just now connecting the AU.
      237     8086        */
      238     8087
      239     8088    2             CASE(%CG_AUCON#);

      240     8089    2               CALL KQC$ACTSTA(MYSTA$->KQ$STA);

   8089  1 000116   200006 630500                    EPPR0   MYSTA$,,AUTO
         1 000117   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000120   000000 701000 xent               TSX1    KQC$ACTSTA
         1 000121   000000 011000                    NOP     0

      241     8090        /**/
      242     8091    2               CALL MSTALOCK;

   8091  1 000122   002170 701000 1                  TSX1    MSTALOCK
         1 000123   000000 011000                    NOP     0

      243     8092                    %LOCK(G=KQ$CG.GORGOSTA$->KQ$STA.GATE);

   8093  1 000124   200007 470500                    LDP0    CG$,,AUTO
         1 000125   000207 471500                    LDP1    135,,PR0
         1 000126   100016 633500                    EPPR3   14,,PR1
         1 000127   200042 453500                    STP3    DBLK$+2,,AUTO
         1 000130   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 000131   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000132   000000 701000 xent               TSX1    HFC$LOCK
         1 000133   000000 011000                    NOP     0

      244     8095    2               CALL KQL$MERGEMLH(MYSTA$->KQ$STA.MLH,

   8095  1 000134   200007 470500                    LDP0    CG$,,AUTO
         1 000135   000207 471500                    LDP1    135,,PR0
         1 000136   100034 633500                    EPPR3   28,,PR1
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:50   
         1 000137   200042 453500                    STP3    DBLK$+2,,AUTO
         1 000140   200042 634500                    EPPR4   DBLK$+2,,AUTO
         1 000141   200045 454500                    STP4    DBLK$+5,,AUTO
         1 000142   200006 236100                    LDQ     MYSTA$,,AUTO
         1 000143   000034 036003                    ADLQ    28,DU
         1 000144   200044 756100                    STQ     DBLK$+4,,AUTO
         1 000145   200044 630500                    EPPR0   DBLK$+4,,AUTO
         1 000146   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000147   000000 701000 xent               TSX1    KQL$MERGEMLH
         1 000150   000000 011000                    NOP     0

      245     8096    2               ADDR(KQ$CG.GORGOSTA$->KQ$STA.MLH));
      246     8097                    %UNLOCK (G=KQ$CG.GORGOSTA$->KQ$STA.GATE);

   8098  1 000151   200007 470500                    LDP0    CG$,,AUTO
         1 000152   000207 471500                    LDP1    135,,PR0
         1 000153   100016 633500                    EPPR3   14,,PR1
         1 000154   200042 453500                    STP3    DBLK$+2,,AUTO
         1 000155   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 000156   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000157   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000160   000000 011000                    NOP     0

      247     8100    2               CALL MSTAUNLOCK;

   8100  1 000161   002202 701000 1                  TSX1    MSTAUNLOCK
         1 000162   000000 011000                    NOP     0

   8100  1 000163                       AUCON0       null
      248     8101        /**/
      249     8102    2   AUCON0:     ;
      250     8103    2               CALL SLOCK;

   8103  1 000163   002120 701000 1                  TSX1    SLOCK
         1 000164   000000 011000                    NOP     0

      251     8104    2               STA$=KQ$CG.STREE.HEAD$;  /* Head of linear list */
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:51   

   8104  1 000165   200007 470500                    LDP0    CG$,,AUTO
         1 000166   000101 236100                    LDQ     65,,PR0
         1 000167   200010 756100                    STQ     STA$,,AUTO

      252     8105    3                 DO WHILE(STA$~=ADDR(NIL));

   8105  1 000170   000435 710000 1                  TRA     s:8161

      253     8106    3                 CALL STALOCK;

   8106  1 000171   002144 701000 1                  TSX1    STALOCK
         1 000172   000000 011000                    NOP     0

      254     8107    3                 IF  STA$->KQ$STA.TOLDAU = '0'B

   8107  1 000173   200010 470500                    LDP0    STA$,,AUTO
         1 000174   000020 236100                    LDQ     16,,PR0
         1 000175   004000 316003                    CANQ    2048,DU
         1 000176   000430 601000 1                  TNZ     s:8159
         1 000177   000020 234100                    SZN     16,,PR0
         1 000200   000430 604000 1                  TMI     s:8159
         1 000201   000010 236100                    LDQ     8,,PR0
         1 000202   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000203   000430 600000 1                  TZE     s:8159
         1 000204   000020 236100                    LDQ     16,,PR0
         1 000205   040000 316003                    CANQ    16384,DU
         1 000206   000212 600000 1                  TZE     s:8113
         1 000207   000010 471500                    LDP1    8,,PR0
         1 000210   100015 720100                    LXL0    13,,PR1
         1 000211   000430 600000 1                  TZE     s:8159

      255     8108    3                 AND STA$->KQ$STA.IDSC   = '0'B
      256     8109    3                 AND STA$->KQ$STA.LDCT$ ~= ADDR(NIL)
      257     8110    3                 AND NOT (STA$->KQ$STA.TERM='1'B
      258     8111    3                 AND STA$->KQ$STA.LDCT$->NK$LDCT.RLCID.LDCTX=0)
      259     8112    4                 THEN DO;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:52   

      260     8113    4                   STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

   8113  1 000212   000001 036007                    ADLQ    1,DL
         1 000213   000020 552104                    STBQ    16,'04'O,PR0

      261     8114    4                   TYP=STA$->KQ$STA.LDCT$->NK$LDCT.RESCOD;

   8114  1 000214   000010 471500                    LDP1    8,,PR0
         1 000215   100006 236100                    LDQ     6,,PR1
         1 000216   000017 376007                    ANQ     15,DL
         1 000217   200012 756100                    STQ     TYP,,AUTO

      262     8115    4                   STA$->KQ$STA.TOLDAU='1'B;

   8115  1 000220   004000 236003                    LDQ     2048,DU
         1 000221   000020 256100                    ORSQ    16,,PR0

      263     8116    4                   CALL STAUNLOCK;

   8116  1 000222   002156 701000 1                  TSX1    STAUNLOCK
         1 000223   000000 011000                    NOP     0

      264     8117    4                   CALL SUNLOCK;

   8117  1 000224   002132 701000 1                  TSX1    SUNLOCK
         1 000225   000000 011000                    NOP     0

      265     8118    4                   IF TYP=NK_CGDCB THEN

   8118  1 000226   200012 235100                    LDA     TYP,,AUTO
         1 000227   000004 115007                    CMPA    4,DL
         1 000230   000237 601000 1                  TNZ     s:8121

      266     8119    4                    ACTION=KQ$CG.AUCTL.AUCONDCB;

   8119  1 000231   200007 470500                    LDP0    CG$,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:53   
         1 000232   000133 236100                    LDQ     91,,PR0
         1 000233   000011 772000                    QRL     9
         1 000234   000003 376007                    ANQ     3,DL
         1 000235   200011 756100                    STQ     ACTION,,AUTO
         1 000236   000244 710000 1                  TRA     s:8122

      267     8120    4                   ELSE
      268     8121    4                    ACTION=KQ$CG.AUCTL.AUCONTERM;

   8121  1 000237   200007 470500                    LDP0    CG$,,AUTO
         1 000240   000133 236100                    LDQ     91,,PR0
         1 000241   000013 772000                    QRL     11
         1 000242   000003 376007                    ANQ     3,DL
         1 000243   200011 756100                    STQ     ACTION,,AUTO

      269     8122    5                     DO CASE(ACTION);

   8122  1 000244   000004 116007                    CMPQ    4,DL
         1 000245   000247 602006 1                  TNC     s:8122+3,QL
         1 000246   000271 710000 1                  TRA     s:8130
         1 000247   000271 710000 1                  TRA     s:8130
         1 000250   000253 710000 1                  TRA     s:8124
         1 000251   000260 710000 1                  TRA     s:8126
         1 000252   000265 710000 1                  TRA     s:8128

      270     8123    5                       CASE(%ACTIVATE#);

      271     8124    5                         CALL KQC$ACTSTA (STA$->KQ$STA);

   8124  1 000253   200010 630500                    EPPR0   STA$,,AUTO
         1 000254   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000255   000000 701000 xent               TSX1    KQC$ACTSTA
         1 000256   000000 011000                    NOP     0
         1 000257   000271 710000 1                  TRA     s:8130

      272     8125    5                       CASE(%DEACTIVATE#);

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:54   
      273     8126    5                         CALL KQC$DACTSTA (STA$->KQ$STA);

   8126  1 000260   200010 630500                    EPPR0   STA$,,AUTO
         1 000261   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000262   000000 701000 xent               TSX1    KQC$DACTSTA
         1 000263   000000 011000                    NOP     0
         1 000264   000271 710000 1                  TRA     s:8130

      274     8127    5                       CASE(%DISCONNECT#);

      275     8128    5                         CALL KQC$DISCSTA (STA$->KQ$STA);

   8128  1 000265   200010 630500                    EPPR0   STA$,,AUTO
         1 000266   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000267   000000 701000 xent               TSX1    KQC$DISCSTA
         1 000270   000000 011000                    NOP     0

      276     8129    5                     END;

      277     8130    4                   IF KQ$CG.AUCTL.CONMSG AND STA$->KQ$STA.LDCT$~=ADDR(NIL)

   8130  1 000271   200007 470500                    LDP0    CG$,,AUTO
         1 000272   000133 236100                    LDQ     91,,PR0
         1 000273   400000 316007                    CANQ    -131072,DL
         1 000274   000376 600000 1                  TZE     FETCHERR
         1 000275   200010 471500                    LDP1    STA$,,AUTO
         1 000276   100010 236100                    LDQ     8,,PR1
         1 000277   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000300   000376 600000 1                  TZE     FETCHERR
         1 000301   100020 234100                    SZN     16,,PR1
         1 000302   000376 604000 1                  TMI     FETCHERR

      278     8131    4                   AND NOT STA$->KQ$STA.IDSC THEN
      279     8132    5                     DO;

      280     8133    5                     STMP=ADDR(STA$->KQ$STA.BTN.KEY)->UBINHALF;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:55   
   8133  1 000303   100005 236100                    LDQ     5,,PR1
         1 000304   000022 772000                    QRL     18
         1 000305   200013 756100                    STQ     DBLK$,,AUTO

      281     8134    5                     DDA=STA$->KQ$STA.CNNCTDDA;

   8134  1 000306   100021 235100                    LDA     17,,PR1
         1 000307   200017 755100                    STA     DDA,,AUTO

      282     8135    5                     CALL KQD$FETCHR(KQ$CG,STMP,DDA) ALTRET(FETCHERR);

   8135  1 000310   200017 633500                    EPPR3   DDA,,AUTO
         1 000311   200044 453500                    STP3    DBLK$+4,,AUTO
         1 000312   200013 634500                    EPPR4   DBLK$,,AUTO
         1 000313   200043 454500                    STP4    DBLK$+3,,AUTO
         1 000314   200007 236100                    LDQ     CG$,,AUTO
         1 000315   200042 756100                    STQ     DBLK$+2,,AUTO
         1 000316   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 000317   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000320   000000 701000 xent               TSX1    KQD$FETCHR
         1 000321   000376 702000 1                  TSX2    FETCHERR

      283     8136    5                     I=STA$->KQ$STA.CNNCTSIZE;

   8136  1 000322   200010 470500                    LDP0    STA$,,AUTO
         1 000323   000015 236100                    LDQ     13,,PR0
         1 000324   777777 376007                    ANQ     -1,DL
         1 000325   200016 756100                    STQ     I,,AUTO

      284     8137    5                     CNNCT$->MOVEI=PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI;

   8137  1 000326   200005 471500                    LDP1    @INFO,,AUTO
         1 000327   100000 473500                    LDP3    0,,PR1
         1 000330   200013 474500                    LDP4    DBLK$,,AUTO
         1 000331   000000 620006                    EAX0    0,QL
         1 000332   200016 721100                    LXL1    I,,AUTO
         1 000333   040140 100540                    MLR     fill='040'O
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:56   
         1 000334   400006 000010                    ADSC9   6,,PR4                   cn=0,n=*X0
         1 000335   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1

      285     8138    5                     CALL KQD$UNLOCK(KQ$CG,DBLK$);

   8138  1 000336   200013 633500                    EPPR3   DBLK$,,AUTO
         1 000337   200043 453500                    STP3    DBLK$+3,,AUTO
         1 000340   200007 236100                    LDQ     CG$,,AUTO
         1 000341   200042 756100                    STQ     DBLK$+2,,AUTO
         1 000342   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 000343   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000344   000000 701000 xent               TSX1    KQD$UNLOCK
         1 000345   000000 011000                    NOP     0

      286     8139    5                     IF TYP=NK_CGDCB THEN

   8139  1 000346   200012 235100                    LDA     TYP,,AUTO
         1 000347   000004 115007                    CMPA    4,DL
         1 000350   000364 601000 1                  TNZ     s:8142

      287     8140    5                      CALL SENDAU(STA$->KQ$STA,%CG_DOPN#,AUEVPRIH);

   8140  1 000351   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000352   200034 756100                    STQ     @DDA+1,,AUTO
         1 000353   000001 235000 xsym               LDA     B_VECTNIL+1
         1 000354   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 000355   000000 237000 2                  LDAQ    0
         1 000356   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 000357   200010 236100                    LDQ     STA$,,AUTO
         1 000360   200027 756100                    STQ     COD+2,,AUTO
         1 000361   002214 701000 1                  TSX1    SENDAU
         1 000362   000000 011000                    NOP     0
         1 000363   000376 710000 1                  TRA     FETCHERR

      288     8141    5                     ELSE
      289     8142    5                      CALL SENDAU(STA$->KQ$STA,%CG_TCON#,AUEVPRIH);

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:57   
   8142  1 000364   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000365   200034 756100                    STQ     @DDA+1,,AUTO
         1 000366   000001 235000 xsym               LDA     B_VECTNIL+1
         1 000367   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 000370   000002 237000 2                  LDAQ    2
         1 000371   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 000372   200010 236100                    LDQ     STA$,,AUTO
         1 000373   200027 756100                    STQ     COD+2,,AUTO
         1 000374   002214 701000 1                  TSX1    SENDAU
         1 000375   000000 011000                    NOP     0

   8139  1 000376                       FETCHERR     null
      290     8143    5   FETCHERR:         ;
      291     8144    5                     END;

      292     8145    4                   CALL SLOCK;

   8145  1 000376   002120 701000 1                  TSX1    SLOCK
         1 000377   000000 011000                    NOP     0

      293     8146    4                   CALL STALOCK;

   8146  1 000400   002144 701000 1                  TSX1    STALOCK
         1 000401   000000 011000                    NOP     0

      294     8147    4                   IF STA$->KQ$STA.EVNT THEN

   8147  1 000402   200010 470500                    LDP0    STA$,,AUTO
         1 000403   000020 236100                    LDQ     16,,PR0
         1 000404   002000 316003                    CANQ    1024,DU
         1 000405   000410 600000 1                  TZE     s:8149

      295     8148    4                    CALL TBRK; /* Send remembered event */

   8148  1 000406   002046 701000 1                  TSX1    TBRK
         1 000407   000000 011000                    NOP     0

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:58   
      296     8149    4                   IF NOT STA$->KQ$STA.IDSC THEN

   8149  1 000410   200010 470500                    LDP0    STA$,,AUTO
         1 000411   000020 234100                    SZN     16,,PR0
         1 000412   000417 604000 1                  TMI     s:8153

      297     8150    4                    STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;

   8150  1 000413   000020 236100                    LDQ     16,,PR0
         1 000414   000777 036007                    ADLQ    511,DL
         1 000415   000020 552104                    STBQ    16,'04'O,PR0
         1 000416   000430 710000 1                  TRA     s:8159

      298     8151    4                   ELSE
      299     8152    5                     DO;

      300     8153    5                     CALL STAUNLOCK;

   8153  1 000417   002156 701000 1                  TSX1    STAUNLOCK
         1 000420   000000 011000                    NOP     0

      301     8154    5                     CALL SUNLOCK;

   8154  1 000421   002132 701000 1                  TSX1    SUNLOCK
         1 000422   000000 011000                    NOP     0

      302     8155    5                     CALL KQP$UNLOCK (STA$->KQ$STA);

   8155  1 000423   200010 630500                    EPPR0   STA$,,AUTO
         1 000424   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000425   000000 701000 xent               TSX1    KQP$UNLOCK
         1 000426   000000 011000                    NOP     0

      303     8156    5                     GOTO AUCON0;

   8156  1 000427   000163 710000 1                  TRA     AUCON0

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:59   
      304     8157    5                     END;
      305     8158    4                   END;
      306     8159    3                 CALL STAUNLOCK;

   8159  1 000430   002156 701000 1                  TSX1    STAUNLOCK
         1 000431   000000 011000                    NOP     0

      307     8160    3                 STA$=STA$->KQ$STA.BTN.FLINK$;

   8160  1 000432   200010 470500                    LDP0    STA$,,AUTO
         1 000433   000004 236100                    LDQ     4,,PR0
         1 000434   200010 756100                    STQ     STA$,,AUTO

      308     8161    3                 END;

   8161  1 000435   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000436   000171 601000 1                  TNZ     s:8106

      309     8162    2               CALL SUNLOCK;

   8162  1 000437   002132 701000 1                  TSX1    SUNLOCK
         1 000440   000000 011000                    NOP     0
         1 000441   001700 710000 1                  TRA     RET

      310     8163        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:60   
      311     8164        /*D*
      312     8165                           %CG_AUDCON# - AU disconnect.  This occurs when
      313     8166                           the AU disconnects from the comgroup and there
      314     8167                           is at least one other DCB still open.
      315     8168                           First the AU's DCB is deactivated.  Then the
      316     8169                           list of connected stations is searched.  For
      317     8170                           each station, the action described by
      318     8171                           AUDCONDCB or AUDCONTERM is taken.
      319     8172                           FPRG terminals will at least be caused to
      320     8173                           deactivate. Note that this will cause pure
      321     8174                           FPRG terminals to disconnect as well.
      322     8175        */
      323     8176    2             CASE(%CG_AUDCON#);

   8157  1 000442                       AUDCON0      null
      324     8177
      325     8178    2   AUDCON0:    ;
      326     8179    2               CALL SLOCK;

   8179  1 000442   002120 701000 1                  TSX1    SLOCK
         1 000443   000000 011000                    NOP     0

      327     8180    2               STA$=KQ$CG.STREE.HEAD$;  /* Head of linear list */

   8180  1 000444   200007 470500                    LDP0    CG$,,AUTO
         1 000445   000101 236100                    LDQ     65,,PR0
         1 000446   200010 756100                    STQ     STA$,,AUTO

      328     8181    3                 DO WHILE(STA$~=ADDR(NIL));

   8181  1 000447   000701 710000 1                  TRA     s:8254

      329     8182    3                 CALL STALOCK;

   8182  1 000450   002144 701000 1                  TSX1    STALOCK
         1 000451   000000 011000                    NOP     0

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:61   
      330     8183    3                 NXT$=STA$->KQ$STA.BTN.FLINK$;

   8183  1 000452   200010 470500                    LDP0    STA$,,AUTO
         1 000453   000004 236100                    LDQ     4,,PR0
         1 000454   200020 756100                    STQ     NXT$,,AUTO

      331     8184    3                 IF  STA$->KQ$STA.DSCREQW

   8184  1 000455   000023 236100                    LDQ     19,,PR0
         1 000456   020000 316007                    CANQ    8192,DL
         1 000457   000500 600000 1                  TZE     s:8194
         1 000460   000020 236100                    LDQ     16,,PR0
         1 000461   040000 316003                    CANQ    16384,DU
         1 000462   000500 600000 1                  TZE     s:8194

      332     8185    3                 AND STA$->KQ$STA.TERM THEN
      333     8186    4                   DO;

      334     8187    4                   STA$->KQ$STA.DSCREQW='0'B;

   8187  1 000463   000004 236000 2                  LDQ     4
         1 000464   000023 356100                    ANSQ    19,,PR0

      335     8188    4                   CALL STAUNLOCK;

   8188  1 000465   002156 701000 1                  TSX1    STAUNLOCK
         1 000466   000000 011000                    NOP     0

      336     8189    4                   CALL SUNLOCK;

   8189  1 000467   002132 701000 1                  TSX1    SUNLOCK
         1 000470   000000 011000                    NOP     0

      337     8190    4                   CALL KCO$DSCTRMGO (STA$->KQ$STA);

   8190  1 000471   200010 630500                    EPPR0   STA$,,AUTO
         1 000472   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:62   
         1 000473   000000 701000 xent               TSX1    KCO$DSCTRMGO
         1 000474   000000 011000                    NOP     0

      338     8191    4                   CALL SLOCK;

   8191  1 000475   002120 701000 1                  TSX1    SLOCK
         1 000476   000000 011000                    NOP     0

      339     8192    4                   GOTO NXTSTA;

   8192  1 000477   000677 710000 1                  TRA     NXTSTA

      340     8193    4                   END;
      341     8194    3                 IF STA$->KQ$STA.LDCT$~=ADDR(NIL) THEN

   8194  1 000500   000010 236100                    LDQ     8,,PR0
         1 000501   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000502   000675 600000 1                  TZE     s:8251

      342     8195    3                  IF NOT STA$->KQ$STA.IDSC

   8195  1 000503   000020 234100                    SZN     16,,PR0
         1 000504   000675 604000 1                  TMI     s:8251
         1 000505   000010 471500                    LDP1    8,,PR0
         1 000506   100006 236100                    LDQ     6,,PR1
         1 000507   000017 376007                    ANQ     15,DL
         1 000510   000011 116007                    CMPQ    9,DL
         1 000511   000517 600000 1                  TZE     s:8200
         1 000512   000020 236100                    LDQ     16,,PR0
         1 000513   040000 316003                    CANQ    16384,DU
         1 000514   000517 600000 1                  TZE     s:8200
         1 000515   100015 720100                    LXL0    13,,PR1
         1 000516   000675 600000 1                  TZE     s:8251

      343     8196    3                  AND (STA$->KQ$STA.LDCT$->NK$LDCT.RESCOD=NK_CGFPRG
      344     8197    3                  OR (NOT(STA$->KQ$STA.TERM='1'B
      345     8198    3                  AND STA$->KQ$STA.LDCT$->NK$LDCT.RLCID.LDCTX=0)))
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:63   
      346     8199    4                  THEN DO;

      347     8200    4                    STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

   8200  1 000517   000020 236100                    LDQ     16,,PR0
         1 000520   000001 036007                    ADLQ    1,DL
         1 000521   000020 552104                    STBQ    16,'04'O,PR0

      348     8201    4                    TYP=STA$->KQ$STA.LDCT$->NK$LDCT.RESCOD;

   8201  1 000522   100006 236100                    LDQ     6,,PR1
         1 000523   000017 376007                    ANQ     15,DL
         1 000524   200012 756100                    STQ     TYP,,AUTO

      349     8202    4                    STA$->KQ$STA.TOLDAU='0'B;

   8202  1 000525   000005 236000 2                  LDQ     5
         1 000526   000020 356100                    ANSQ    16,,PR0

      350     8203    4                    IF TYP=NK_CGDCB THEN

   8203  1 000527   200012 235100                    LDA     TYP,,AUTO
         1 000530   000004 115007                    CMPA    4,DL
         1 000531   000540 601000 1                  TNZ     s:8206

      351     8204    4                     ACTION=KQ$CG.AUCTL.AUDCONDCB;

   8204  1 000532   200007 471500                    LDP1    CG$,,AUTO
         1 000533   100133 236100                    LDQ     91,,PR1
         1 000534   000005 772000                    QRL     5
         1 000535   000003 376007                    ANQ     3,DL
         1 000536   200011 756100                    STQ     ACTION,,AUTO
         1 000537   000555 710000 1                  TRA     s:8211

      352     8205    5                    ELSE DO;

      353     8206    5                      ACTION=KQ$CG.AUCTL.AUDCONTERM;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:64   

   8206  1 000540   200007 471500                    LDP1    CG$,,AUTO
         1 000541   100133 236100                    LDQ     91,,PR1
         1 000542   000007 772000                    QRL     7
         1 000543   000003 376007                    ANQ     3,DL
         1 000544   200011 756100                    STQ     ACTION,,AUTO

      354     8207    5                      IF TYP=NK_CGFPRG AND ACTION~=%DEACTIVATE# AND ACTION~=%
              8207                               DISCONNECT#

   8207  1 000545   000011 115007                    CMPA    9,DL
         1 000546   000555 601000 1                  TNZ     s:8211
         1 000547   000002 116007                    CMPQ    2,DL
         1 000550   000555 600000 1                  TZE     s:8211
         1 000551   000003 116007                    CMPQ    3,DL
         1 000552   000555 600000 1                  TZE     s:8211

      355     8208    5                      THEN ACTION=%DEACTIVATE#;

   8208  1 000553   000002 235007                    LDA     2,DL
         1 000554   200011 755100                    STA     ACTION,,AUTO

      356     8209                                               /* A least deactivate FPRGs when no AU */
      357     8210    5                      END;

      358     8211    5                      DO CASE(ACTION);

   8211  1 000555   200011 235100                    LDA     ACTION,,AUTO
         1 000556   000004 115007                    CMPA    4,DL
         1 000557   000561 602005 1                  TNC     s:8211+4,AL
         1 000560   000620 710000 1                  TRA     s:8225
         1 000561   000620 710000 1                  TRA     s:8225
         1 000562   000565 710000 1                  TRA     s:8213
         1 000563   000576 710000 1                  TRA     s:8217
         1 000564   000607 710000 1                  TRA     s:8221

      359     8212    5                        CASE(%ACTIVATE#);
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:65   

      360     8213    5                          CALL STAUNLOCK;

   8213  1 000565   002156 701000 1                  TSX1    STAUNLOCK
         1 000566   000000 011000                    NOP     0

      361     8214    5                          CALL SUNLOCK;

   8214  1 000567   002132 701000 1                  TSX1    SUNLOCK
         1 000570   000000 011000                    NOP     0

      362     8215    5                          CALL KQC$ACTSTA (STA$->KQ$STA);

   8215  1 000571   200010 630500                    EPPR0   STA$,,AUTO
         1 000572   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000573   000000 701000 xent               TSX1    KQC$ACTSTA
         1 000574   000000 011000                    NOP     0
         1 000575   000651 710000 1                  TRA     s:8239

      363     8216    5                        CASE(%DEACTIVATE#);

      364     8217    5                          CALL STAUNLOCK;

   8217  1 000576   002156 701000 1                  TSX1    STAUNLOCK
         1 000577   000000 011000                    NOP     0

      365     8218    5                          CALL SUNLOCK;

   8218  1 000600   002132 701000 1                  TSX1    SUNLOCK
         1 000601   000000 011000                    NOP     0

      366     8219    5                          CALL KQC$DACTSTA (STA$->KQ$STA);

   8219  1 000602   200010 630500                    EPPR0   STA$,,AUTO
         1 000603   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000604   000000 701000 xent               TSX1    KQC$DACTSTA
         1 000605   000000 011000                    NOP     0
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:66   
         1 000606   000651 710000 1                  TRA     s:8239

      367     8220    5                        CASE(%DISCONNECT#);

      368     8221    5                          CALL STAUNLOCK;

   8221  1 000607   002156 701000 1                  TSX1    STAUNLOCK
         1 000610   000000 011000                    NOP     0

      369     8222    5                          CALL SUNLOCK;

   8222  1 000611   002132 701000 1                  TSX1    SUNLOCK
         1 000612   000000 011000                    NOP     0

      370     8223    5                          CALL KQC$DISCSTA (STA$->KQ$STA);

   8223  1 000613   200010 630500                    EPPR0   STA$,,AUTO
         1 000614   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000615   000000 701000 xent               TSX1    KQC$DISCSTA
         1 000616   000000 011000                    NOP     0
         1 000617   000651 710000 1                  TRA     s:8239

      371     8224    5                        CASE (ELSE);

      372     8225    5                          IF  NOT STA$->KQ$STA.TERM

   8225  1 000620   000020 236100                    LDQ     16,,PR0
         1 000621   040000 316003                    CANQ    16384,DU
         1 000622   000645 601000 1                  TNZ     s:8235
         1 000623   000023 236100                    LDQ     19,,PR0
         1 000624   020000 316007                    CANQ    8192,DL
         1 000625   000645 600000 1                  TZE     s:8235

      373     8226    5                          AND STA$->KQ$STA.OPNBLKED THEN
      374     8227    6                            DO;

      375     8228    6                            STA$->KQ$STA.OPNBLKED='0'B;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:67   

   8228  1 000626   000004 236000 2                  LDQ     4
         1 000627   000023 356100                    ANSQ    19,,PR0

      376     8229    6                            CALL STAUNLOCK;

   8229  1 000630   002156 701000 1                  TSX1    STAUNLOCK
         1 000631   000000 011000                    NOP     0

      377     8230    6                            CALL SUNLOCK;

   8230  1 000632   002132 701000 1                  TSX1    SUNLOCK
         1 000633   000000 011000                    NOP     0

      378     8231    6                            CALL SSR$RUE (%SS_UQA,STA$->KQ$STA.USR#);

   8231  1 000634   200010 236100                    LDQ     STA$,,AUTO
         1 000635   000007 036000 2                  ADLQ    7
         1 000636   000010 235000 2                  LDA     8
         1 000637   200042 757100                    STAQ    DBLK$+2,,AUTO
         1 000640   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 000641   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000642   000000 701000 xent               TSX1    SSR$RUE
         1 000643   000000 011000                    NOP     0

      379     8232    6                            END;

   8232  1 000644   000651 710000 1                  TRA     s:8239

      380     8233    5                          ELSE
      381     8234    6                            DO;

      382     8235    6                            CALL STAUNLOCK;

   8235  1 000645   002156 701000 1                  TSX1    STAUNLOCK
         1 000646   000000 011000                    NOP     0

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:68   
      383     8236    6                            CALL SUNLOCK;

   8236  1 000647   002132 701000 1                  TSX1    SUNLOCK
         1 000650   000000 011000                    NOP     0

      384     8237    6                            END;

      385     8238    5                      END;

      386     8239    4                    CALL SLOCK;

   8239  1 000651   002120 701000 1                  TSX1    SLOCK
         1 000652   000000 011000                    NOP     0

      387     8240    4                    CALL STALOCK;

   8240  1 000653   002144 701000 1                  TSX1    STALOCK
         1 000654   000000 011000                    NOP     0

      388     8241    4                    IF NOT STA$->KQ$STA.IDSC THEN

   8241  1 000655   200010 470500                    LDP0    STA$,,AUTO
         1 000656   000020 234100                    SZN     16,,PR0
         1 000657   000664 604000 1                  TMI     s:8245

      389     8242    4                     STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;

   8242  1 000660   000020 236100                    LDQ     16,,PR0
         1 000661   000777 036007                    ADLQ    511,DL
         1 000662   000020 552104                    STBQ    16,'04'O,PR0
         1 000663   000675 710000 1                  TRA     s:8251

      390     8243    4                    ELSE
      391     8244    5                      DO;

      392     8245    5                      CALL STAUNLOCK;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:69   
   8245  1 000664   002156 701000 1                  TSX1    STAUNLOCK
         1 000665   000000 011000                    NOP     0

      393     8246    5                      CALL SUNLOCK;

   8246  1 000666   002132 701000 1                  TSX1    SUNLOCK
         1 000667   000000 011000                    NOP     0

      394     8247    5                      CALL KQP$UNLOCK (STA$->KQ$STA);

   8247  1 000670   200010 630500                    EPPR0   STA$,,AUTO
         1 000671   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000672   000000 701000 xent               TSX1    KQP$UNLOCK
         1 000673   000000 011000                    NOP     0

      395     8248    5                      GOTO AUDCON0;

   8248  1 000674   000442 710000 1                  TRA     AUDCON0

      396     8249    5                      END;
      397     8250    4                    END;
      398     8251    3                 CALL STAUNLOCK;

   8251  1 000675   002156 701000 1                  TSX1    STAUNLOCK
         1 000676   000000 011000                    NOP     0

   8247  1 000677                       NXTSTA       null
      399     8252    3   NXTSTA:       ;
      400     8253    3                 STA$=NXT$;

   8253  1 000677   200020 236100                    LDQ     NXT$,,AUTO
         1 000700   200010 756100                    STQ     STA$,,AUTO

      401     8254    3                 END;

   8254  1 000701   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000702   000450 601000 1                  TNZ     s:8182
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:70   

      402     8255    2               CALL SUNLOCK;

   8255  1 000703   002132 701000 1                  TSX1    SUNLOCK
         1 000704   000000 011000                    NOP     0
         1 000705   001700 710000 1                  TRA     RET

      403     8256        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:71   
      404     8257
      405     8258
      406     8259        /*D*
      407     8260                           %CG_DOPN# - DCB open (other than AU).
      408     8261                           Depending on DCBCONAU and DCBCONNAU and whether
      409     8262                           or not the AU is connected, the station is
      410     8263                           activated.
      411     8264                           If the AU is present and wants connect messages,
      412     8265                           one is sent.
      413     8266        */
      414     8267    2             CASE(%CG_DOPN#);

      415     8268
      416     8269        /**/
      417     8270    2               IF KQ$CG.AUCTL.CONMSG AND KQ$CG.AUSTA$~=ADDR(NIL) THEN

   8270  1 000706   200007 473500                    LDP3    CG$,,AUTO
         1 000707   300133 236100                    LDQ     91,,PR3
         1 000710   400000 316007                    CANQ    -131072,DL
         1 000711   001700 600000 1                  TZE     RET
         1 000712   300121 236100                    LDQ     81,,PR3
         1 000713   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000714   001700 600000 1                  TZE     RET

      418     8271    3                 DO;

      419     8272    3                 CALL MSTALOCK;

   8272  1 000715   002170 701000 1                  TSX1    MSTALOCK
         1 000716   000000 011000                    NOP     0

      420     8273    3                 IF NOT MYSTA$->KQ$STA.TOLDAU THEN

   8273  1 000717   200006 470500                    LDP0    MYSTA$,,AUTO
         1 000720   000020 236100                    LDQ     16,,PR0
         1 000721   004000 316003                    CANQ    2048,DU
         1 000722   000742 601000 1                  TNZ     s:8280
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:72   

      421     8274    4                   DO;

      422     8275    4                   MYSTA$->KQ$STA.TOLDAU='1'B;

   8275  1 000723   004000 236003                    LDQ     2048,DU
         1 000724   000020 256100                    ORSQ    16,,PR0

      423     8276    4                   CALL MSTAUNLOCK;

   8276  1 000725   002202 701000 1                  TSX1    MSTAUNLOCK
         1 000726   000000 011000                    NOP     0

      424     8277    4                   CALL SENDAU (MYSTA$->KQ$STA,%CG_DOPN#,AUEVPRIL);

   8277  1 000727   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000730   200034 756100                    STQ     @DDA+1,,AUTO
         1 000731   000001 235000 xsym               LDA     B_VECTNIL+1
         1 000732   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 000733   000012 237000 2                  LDAQ    10
         1 000734   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 000735   200006 236100                    LDQ     MYSTA$,,AUTO
         1 000736   200027 756100                    STQ     COD+2,,AUTO
         1 000737   002214 701000 1                  TSX1    SENDAU
         1 000740   000000 011000                    NOP     0

      425     8278    4                   END;

   8278  1 000741   001700 710000 1                  TRA     RET

      426     8279    3                 ELSE
      427     8280    3                  CALL MSTAUNLOCK;

   8280  1 000742   002202 701000 1                  TSX1    MSTAUNLOCK
         1 000743   000000 011000                    NOP     0

      428     8281    3                 END;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:73   

   8281  1 000744   001700 710000 1                  TRA     RET

      429     8282        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:74   
      430     8283
      431     8284
      432     8285        /*D*
      433     8286                           %CG_DCLS# - close a DCB.
      434     8287                           The station is deactivated.  If the AU wants
      435     8288                           disconnect messages, one is sent.
      436     8289        */
      437     8290
      438     8291
      439     8292    2             CASE(%CG_DCLS#);

      440     8293
      441     8294    2               IF KQ$CG.AUCTL.CONMSG AND KQ$CG.AUSTA$~=ADDR(NIL) THEN

   8294  1 000745   200007 473500                    LDP3    CG$,,AUTO
         1 000746   300133 236100                    LDQ     91,,PR3
         1 000747   400000 316007                    CANQ    -131072,DL
         1 000750   001700 600000 1                  TZE     RET
         1 000751   300121 236100                    LDQ     81,,PR3
         1 000752   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000753   001700 600000 1                  TZE     RET

      442     8295    2                CALL SENDAU(MYSTA$->KQ$STA,%CG_DCLS#,AUEVPRIL);

   8295  1 000754   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000755   200034 756100                    STQ     @DDA+1,,AUTO
         1 000756   000001 235000 xsym               LDA     B_VECTNIL+1
         1 000757   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 000760   000014 237000 2                  LDAQ    12
         1 000761   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 000762   200006 236100                    LDQ     MYSTA$,,AUTO
         1 000763   200027 756100                    STQ     COD+2,,AUTO
         1 000764   002214 701000 1                  TSX1    SENDAU
         1 000765   000000 011000                    NOP     0
         1 000766   001700 710000 1                  TRA     RET

      443     8296        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:75   
      444     8297
      445     8298
      446     8299        /*D*
      447     8300                           %CG_TCON# - terminal connect.
      448     8301                           The station is activated if requested, and the
      449     8302                           AU is sent a message.
      450     8303        */
      451     8304
      452     8305
      453     8306    2             CASE(%CG_TCON#);

      454     8307
      455     8308    2               IF KQ$CG.AUCTL.CONMSG THEN

   8308  1 000767   200007 473500                    LDP3    CG$,,AUTO
         1 000770   300133 236100                    LDQ     91,,PR3
         1 000771   400000 316007                    CANQ    -131072,DL
         1 000772   001027 600000 1                  TZE     s:8322

      456     8309    2                IF KQ$CG.AUSTA$~=ADDR(NIL) THEN

   8309  1 000773   300121 236100                    LDQ     81,,PR3
         1 000774   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000775   001027 600000 1                  TZE     s:8322

      457     8310    3                  DO;

      458     8311    3                  CALL MSTALOCK;

   8311  1 000776   002170 701000 1                  TSX1    MSTALOCK
         1 000777   000000 011000                    NOP     0

      459     8312    3                  IF NOT MYSTA$->KQ$STA.TOLDAU AND NOT MYSTA$->KQ$STA.IDSC THEN

   8312  1 001000   200006 470500                    LDP0    MYSTA$,,AUTO
         1 001001   000020 236100                    LDQ     16,,PR0
         1 001002   004000 316003                    CANQ    2048,DU
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:76   
         1 001003   001025 601000 1                  TNZ     s:8319
         1 001004   000020 234100                    SZN     16,,PR0
         1 001005   001025 604000 1                  TMI     s:8319

      460     8313    4                    DO;

      461     8314    4                    MYSTA$->KQ$STA.TOLDAU='1'B;

   8314  1 001006   004000 236003                    LDQ     2048,DU
         1 001007   000020 256100                    ORSQ    16,,PR0

      462     8315    4                    CALL MSTAUNLOCK;

   8315  1 001010   002202 701000 1                  TSX1    MSTAUNLOCK
         1 001011   000000 011000                    NOP     0

      463     8316    4                    CALL SENDAU(MYSTA$->KQ$STA,%CG_TCON#,AUEVPRIL);

   8316  1 001012   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001013   200034 756100                    STQ     @DDA+1,,AUTO
         1 001014   000001 235000 xsym               LDA     B_VECTNIL+1
         1 001015   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 001016   000016 237000 2                  LDAQ    14
         1 001017   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001020   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001021   200027 756100                    STQ     COD+2,,AUTO
         1 001022   002214 701000 1                  TSX1    SENDAU
         1 001023   000000 011000                    NOP     0

      464     8317    4                    END;

   8317  1 001024   001027 710000 1                  TRA     s:8322

      465     8318    3                  ELSE
      466     8319    3                   CALL MSTAUNLOCK;

   8319  1 001025   002202 701000 1                  TSX1    MSTAUNLOCK
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:77   
         1 001026   000000 011000                    NOP     0

      467     8320    3                  END;

      468     8321        /**/
      469     8322    2               GOTO RET;

   8322  1 001027   001700 710000 1                  TRA     RET

      470     8323        /**/
      471     8324        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:78   
      472     8325
      473     8326
      474     8327        /*D*
      475     8328                           %CG_TDSC# - terminal disconnect
      476     8329        */
      477     8330
      478     8331
      479     8332    2             CASE(%CG_TDSC#);

      480     8333
      481     8334    2               IF KQ$CG.AUCTL.CONMSG THEN

   8334  1 001030   200007 473500                    LDP3    CG$,,AUTO
         1 001031   300133 236100                    LDQ     91,,PR3
         1 001032   400000 316007                    CANQ    -131072,DL
         1 001033   001700 600000 1                  TZE     RET

      482     8335    2                CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL);

   8335  1 001034   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001035   200034 756100                    STQ     @DDA+1,,AUTO
         1 001036   000001 235000 xsym               LDA     B_VECTNIL+1
         1 001037   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 001040   000013 236000 2                  LDQ     11
         1 001041   200004 235100                    LDA     @CODE,,AUTO
         1 001042   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001043   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001044   200027 756100                    STQ     COD+2,,AUTO
         1 001045   002214 701000 1                  TSX1    SENDAU
         1 001046   000000 011000                    NOP     0
         1 001047   001700 710000 1                  TRA     RET

      483     8336
      484     8337
      485     8338         /*D*
      486     8339
      487     8340                           %CG_TDRQ# - terminal disconnect request
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:79   
      488     8341        */
      489     8342
      490     8343
      491     8344    2             CASE (%CG_TDRQ#);

      492     8345
      493     8346    2               CALL SENDAU (MYSTA$->KQ$STA,CODE,AUEVPRIL);

   8346  1 001050   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001051   200034 756100                    STQ     @DDA+1,,AUTO
         1 001052   000001 235000 xsym               LDA     B_VECTNIL+1
         1 001053   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 001054   000013 236000 2                  LDQ     11
         1 001055   200004 235100                    LDA     @CODE,,AUTO
         1 001056   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001057   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001060   200027 756100                    STQ     COD+2,,AUTO
         1 001061   002214 701000 1                  TSX1    SENDAU
         1 001062   000000 011000                    NOP     0
         1 001063   001700 710000 1                  TRA     RET

      494     8347        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:80   
      495     8348
      496     8349
      497     8350        /*D*
      498     8351                           %CG_TBRK# - break events
      499     8352        */
      500     8353
      501     8354    2             CASE(%CG_TBRK#);

      502     8355
      503     8356    2               CALL MSTALOCK;

   8356  1 001064   002170 701000 1                  TSX1    MSTALOCK
         1 001065   000000 011000                    NOP     0

      504     8357    2               IF MYSTA$->KQ$STA.EVNT

   8357  1 001066   200006 470500                    LDP0    MYSTA$,,AUTO
         1 001067   000020 236100                    LDQ     16,,PR0
         1 001070   002000 316003                    CANQ    1024,DU
         1 001071   001076 601000 1                  TNZ     s:8360
         1 001072   000023 236100                    LDQ     19,,PR0
         1 001073   777000 376003                    ANQ     -512,DU
         1 001074   012000 116003                    CMPQ    5120,DU
         1 001075   001101 604400 1                  TMOZ    s:8363

      505     8358    2               OR MYSTA$->KQ$STA.EVCNT > 10 THEN
      506     8359    3                 DO;

      507     8360    3                 CALL MSTAUNLOCK;

   8360  1 001076   002202 701000 1                  TSX1    MSTAUNLOCK
         1 001077   000000 011000                    NOP     0

      508     8361    3                 GOTO RET;

   8361  1 001100   001700 710000 1                  TRA     RET

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:81   
      509     8362    3                 END;
      510     8363    2               MYSTA$->KQ$STA.EVCNT=MYSTA$->KQ$STA.EVCNT+1;

   8363  1 001101   001000 236003                    LDQ     512,DU
         1 001102   000023 056100                    ASQ     19,,PR0

      511     8364    2               CALL MSTAUNLOCK;

   8364  1 001103   002202 701000 1                  TSX1    MSTAUNLOCK
         1 001104   000000 011000                    NOP     0

      512     8365    2               CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,INFO) ALTRET(NSTBRK);

   8365  1 001105   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001106   200034 756100                    STQ     @DDA+1,,AUTO
         1 001107   200005 235100                    LDA     @INFO,,AUTO
         1 001110   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 001111   000013 236000 2                  LDQ     11
         1 001112   200004 235100                    LDA     @CODE,,AUTO
         1 001113   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001114   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001115   200027 756100                    STQ     COD+2,,AUTO
         1 001116   002214 701000 1                  TSX1    SENDAU
         1 001117   001121 702000 1                  TSX2    NSTBRK

      513     8366
      514     8367    2               GOTO RET;

   8367  1 001120   001700 710000 1                  TRA     RET

      515     8368        /**/
      516     8369    2   NSTBRK:     CALL SLOCK;

   8369  1 001121   002120 701000 1     NSTBRK       TSX1    SLOCK
         1 001122   000000 011000                    NOP     0

      517     8370    2               CALL MSTALOCK;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:82   

   8370  1 001123   002170 701000 1                  TSX1    MSTALOCK
         1 001124   000000 011000                    NOP     0

      518     8371    2               MYSTA$->KQ$STA.EVSC=INFO;

   8371  1 001125   200005 470500                    LDP0    @INFO,,AUTO
         1 001126   200006 471500                    LDP1    MYSTA$,,AUTO
         1 001127   000000 235100                    LDA     0,,PR0
         1 001130   100013 755100                    STA     11,,PR1

      519     8372    2               MYSTA$->KQ$STA.EVNT='1'B;

   8372  1 001131   002000 236003                    LDQ     1024,DU
         1 001132   100020 256100                    ORSQ    16,,PR1

      520     8373    2   NSEVNT:     CALL MSTAUNLOCK;

   8373  1 001133   002202 701000 1     NSEVNT       TSX1    MSTAUNLOCK
         1 001134   000000 011000                    NOP     0

      521     8374    2               CALL SUNLOCK;

   8374  1 001135   002132 701000 1                  TSX1    SUNLOCK
         1 001136   000000 011000                    NOP     0

      522     8375    2               IF KQ$CG.AUSTA$ ~= ADDR(NIL) THEN

   8375  1 001137   200007 470500                    LDP0    CG$,,AUTO
         1 001140   000121 236100                    LDQ     81,,PR0
         1 001141   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001142   001164 600000 1                  TZE     s:8385

      523     8376    3                 DO;

      524     8377                      %LOCK (G=KQ$CG.GATE.CG);

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:83   
   8378  1 001143   200007 236100                    LDQ     CG$,,AUTO
         1 001144   000107 036003                    ADLQ    71,DU
         1 001145   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001146   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001147   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001150   000000 701000 xent               TSX1    HFC$LOCK
         1 001151   000000 011000                    NOP     0

      525     8380    3                 KQ$CG.DELAY.AU='1'B;

   8380  1 001152   200007 470500                    LDP0    CG$,,AUTO
         1 001153   400000 236003                    LDQ     -131072,DU
         1 001154   000020 256100                    ORSQ    16,,PR0

      526     8381                      %UNLOCK (G=KQ$CG.GATE.CG);

   8382  1 001155   200007 236100                    LDQ     CG$,,AUTO
         1 001156   000107 036003                    ADLQ    71,DU
         1 001157   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001160   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001161   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001162   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001163   000000 011000                    NOP     0

      527     8384    3                 END;

      528     8385    2               GOTO RET;

   8385  1 001164   001700 710000 1                  TRA     RET

      529     8386        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:84   
      530     8387
      531     8388
      532     8389        /*D*
      533     8390                           %CG_STDSC - symbiont terminal disconnect
      534     8391                           %CG_STHLD - symbiont terminal held
      535     8392                           %CG_SFERR - symbiont file error
      536     8393                           %CG_STERR - symbiont terminal error
      537     8394                           %CG_SFEXT - symbiont finished extent
      538     8395                           %CG_SFSPA - symbiont finished spacing
      539     8396                           %CG_STOKN - symbiont token
      540     8397                           %CG_STACK - symbiont granule acknowlege
      541     8398                           %CG_WARN  - comgroup low on space warning
      542     8399                           %CG_FPEXIT -FPRG issued an M$EXIT
      543     8400                           %CG_FPABORT-FPRG aborted
      544     8401        */
      545     8402
      546     8403    2             CASE(%CG_STDSC#,%CG_STHLD#,%CG_SFERR#,%CG_STERR#,%CG_SFEXT#,

      547     8404    2               %CG_SFSPA#,%CG_STOKN#,%CG_STACK#,%CG_WARN#,
      548     8405    2               %CG_FPEXIT#,%CG_FPABORT#);
      549     8406
      550     8407    2               CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,INFO);

   8407  1 001165   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001166   200034 756100                    STQ     @DDA+1,,AUTO
         1 001167   200005 235100                    LDA     @INFO,,AUTO
         1 001170   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 001171   000013 236000 2                  LDQ     11
         1 001172   200004 235100                    LDA     @CODE,,AUTO
         1 001173   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001174   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001175   200027 756100                    STQ     COD+2,,AUTO
         1 001176   002214 701000 1                  TSX1    SENDAU
         1 001177   000000 011000                    NOP     0
         1 001200   001700 710000 1                  TRA     RET

      551     8408        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:85   
      552     8409        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:86   
      553     8410        /*D*
      554     8411                           %CG_FPLDTRC# - FPRG issued an M$LDTRC
      555     8412        */
      556     8413
      557     8414    2             CASE(%CG_FPLDTRC#);

      558     8415    2               IF MBLK$=ADDR(NIL) THEN CALL KQM$GETMBLK(KQ$CG,MBLK$,TYP)

   8415  1 001201   200015 236100                    LDQ     MBLK$,,AUTO
         1 001202   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001203   001237 601000 1                  TNZ     s:8422

   8415  1 001204   200012 633500                    EPPR3   TYP,,AUTO
         1 001205   200044 453500                    STP3    DBLK$+4,,AUTO
         1 001206   200015 634500                    EPPR4   MBLK$,,AUTO
         1 001207   200043 454500                    STP4    DBLK$+3,,AUTO
         1 001210   200007 236100                    LDQ     CG$,,AUTO
         1 001211   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001212   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001213   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001214   000000 701000 xent               TSX1    KQM$GETMBLK
         1 001215   001217 702000 1                  TSX2    s:8417
         1 001216   001237 710000 1                  TRA     s:8422

      559     8416    3                WHENALTRETURN DO;

      560     8417    3                  IF REGFLG=0 THEN GOTO ALT;

   8417  1 001217   200014 235100                    LDA     REGFLG,,AUTO
         1 001220   001714 600000 1                  TZE     ALT

      561     8418    3                  TYP=KQMR_MBLK#;

   8418  1 001221   000001 236007                    LDQ     1,DL
         1 001222   200012 756100                    STQ     TYP,,AUTO

      562     8419    3                  MBLK$=MYSTA$;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:87   

   8419  1 001223   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001224   200015 756100                    STQ     MBLK$,,AUTO

      563     8420    3                  CALL KQM$GETBR(KQ$CG,MBLK$,TYP) ALTRET(ALT);

   8420  1 001225   200012 630500                    EPPR0   TYP,,AUTO
         1 001226   200044 450500                    STP0    DBLK$+4,,AUTO
         1 001227   200015 631500                    EPPR1   MBLK$,,AUTO
         1 001230   200043 451500                    STP1    DBLK$+3,,AUTO
         1 001231   200007 236100                    LDQ     CG$,,AUTO
         1 001232   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001233   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001234   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001235   000000 701000 xent               TSX1    KQM$GETBR
         1 001236   001714 702000 1                  TSX2    ALT

      564     8421    3                  END;

      565     8422    2               TYP=SIZEC(VLP$FPRG);

   8422  1 001237   000110 235007                    LDA     72,DL
         1 001240   200012 755100                    STA     TYP,,AUTO

      566     8423    2               IF REGFLG~=0

   8423  1 001241   200014 236100                    LDQ     REGFLG,,AUTO
         1 001242   001256 600000 1                  TZE     s:8425

      567     8424    2               THEN CALL KQD$GETR(KQ$CG,DBLK$,TYP) ALTRET(ALT);

   8424  1 001243   200012 630500                    EPPR0   TYP,,AUTO
         1 001244   200044 450500                    STP0    DBLK$+4,,AUTO
         1 001245   200013 631500                    EPPR1   DBLK$,,AUTO
         1 001246   200043 451500                    STP1    DBLK$+3,,AUTO
         1 001247   200007 236100                    LDQ     CG$,,AUTO
         1 001250   200042 756100                    STQ     DBLK$+2,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:88   
         1 001251   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001252   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001253   000000 701000 xent               TSX1    KQD$GETR
         1 001254   001714 702000 1                  TSX2    ALT
         1 001255   001270 710000 1                  TRA     s:8426

      568     8425    2               ELSE CALL KQD$GET (KQ$CG,DBLK$,TYP) ALTRET(ALT);

   8425  1 001256   200012 630500                    EPPR0   TYP,,AUTO
         1 001257   200044 450500                    STP0    DBLK$+4,,AUTO
         1 001260   200013 631500                    EPPR1   DBLK$,,AUTO
         1 001261   200043 451500                    STP1    DBLK$+3,,AUTO
         1 001262   200007 236100                    LDQ     CG$,,AUTO
         1 001263   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001264   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001265   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001266   000000 701000 xent               TSX1    KQD$GET
         1 001267   001714 702000 1                  TSX2    ALT

      569     8426    2               FPRG$=PINCRW(DBLK$,SIZEW(KQ$DBLK));

   8426  1 001270   200013 236100                    LDQ     DBLK$,,AUTO
         1 001271   000006 036003                    ADLQ    6,DU
         1 001272   200010 756100                    STQ     STA$,,AUTO

      570     8427    2               FPRG$->VLP$FPRG=ADDR(INFO)->VLP$FPRG;

   8427  1 001273   200005 470500                    LDP0    @INFO,,AUTO
         1 001274   200010 471500                    LDP1    STA$,,AUTO
         1 001275   000100 100500                    MLR     fill='000'O
         1 001276   000000 000104                    ADSC9   0,,PR0                   cn=0,n=68
         1 001277   100000 000104                    ADSC9   0,,PR1                   cn=0,n=68

      571     8428    2               DBLK$->KQ$DBLK.STAMP=KQ$MBLK.STAMP;

   8428  1 001300   200015 473500                    LDP3    MBLK$,,AUTO
         1 001301   300001 720100                    LXL0    1,,PR3
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:89   
         1 001302   200013 474500                    LDP4    DBLK$,,AUTO
         1 001303   400000 740100                    STX0    0,,PR4

      572     8429    2               CALL KQD$UNLOCK(KQ$CG,DBLK$);

   8429  1 001304   200013 633500                    EPPR3   DBLK$,,AUTO
         1 001305   200043 453500                    STP3    DBLK$+3,,AUTO
         1 001306   200007 236100                    LDQ     CG$,,AUTO
         1 001307   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001310   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001311   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001312   000000 701000 xent               TSX1    KQD$UNLOCK
         1 001313   000000 011000                    NOP     0

      573     8430    2               CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,0,TYP,SIZEC(VLP$FPRG));

   8430  1 001314   000021 236000 2                  LDQ     17
         1 001315   200034 756100                    STQ     @DDA+1,,AUTO
         1 001316   200012 630500                    EPPR0   TYP,,AUTO
         1 001317   200033 450500                    STP0    @INFO+1,,AUTO
         1 001320   000000 236000 2                  LDQ     0
         1 001321   200032 756100                    STQ     @PRIO+1,,AUTO
         1 001322   000013 236000 2                  LDQ     11
         1 001323   200004 235100                    LDA     @CODE,,AUTO
         1 001324   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001325   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001326   200027 756100                    STQ     COD+2,,AUTO
         1 001327   002214 701000 1                  TSX1    SENDAU
         1 001330   000000 011000                    NOP     0
         1 001331   001700 710000 1                  TRA     RET

      574     8431
      575     8432        /*D*
      576     8433                           %CG_JNLD  - JOURNAL delete message
      577     8434
      578     8435                           Called from the comgroup message delete logic
      579     8436                           when a message is being deleted after being
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:90   
      580     8437                           journaled.
      581     8438
      582     8439                           The third parameter is an MBLK which contains
      583     8440                           the MSGID of the message being deleted.  This
      584     8441                           passed MBLK is used and deleted, since it is
      585     8442                           utilized to create a data-less message which
      586     8443                           is send to the journal station.
      587     8444        */
      588     8445    2             CASE (%CG_JNLD#);

      589     8446    2               MBLK$=ADDR(INFO);

   8446  1 001332   200005 236100                    LDQ     @INFO,,AUTO
         1 001333   200015 756100                    STQ     MBLK$,,AUTO

      590     8447    2               IF KQ$CG.QISS THEN

   8447  1 001334   200007 473500                    LDP3    CG$,,AUTO
         1 001335   300106 235100                    LDA     70,,PR3
         1 001336   001346 600000 1                  TZE     s:8454

      591     8448    3                 DO;

      592     8449    3                 ADDR(MBLK$->KQ$MBLK.KEY1)->B$$BIT72=MBLK$->KQ$MBLK.MID;

   8449  1 001337   200015 474500                    LDP4    MBLK$,,AUTO
         1 001340   400014 237100                    LDAQ    12,,PR4
         1 001341   400002 757100                    STAQ    2,,PR4

      593     8450    3                 MBLK$->KQ$MBLK.KEY2=AUEVKEY;

   8450  1 001342   000000 237000 0                  LDAQ    AUEVKEY
         1 001343   200015 474500                    LDP4    MBLK$,,AUTO
         1 001344   400004 757100                    STAQ    4,,PR4

      594     8451    3                 END;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:91   
   8451  1 001345   001354 710000 1                  TRA     s:8457

      595     8452    2               ELSE
      596     8453    3                 DO;

      597     8454    3                 MBLK$->KQ$MBLK.KEY1=AUEVKEY;

   8454  1 001346   000000 237000 0                  LDAQ    AUEVKEY
         1 001347   200015 474500                    LDP4    MBLK$,,AUTO
         1 001350   400002 757100                    STAQ    2,,PR4

      598     8455    3                 ADDR(MBLK$->KQ$MBLK.KEY2)->B$$BIT72=MBLK$->KQ$MBLK.MID;

   8455  1 001351   200015 474500                    LDP4    MBLK$,,AUTO
         1 001352   400014 237100                    LDAQ    12,,PR4
         1 001353   400004 757100                    STAQ    4,,PR4

      599     8456    3                 END;

      600     8457    2               MBLK$->KQ$MBLK.DVE='0'B;

   8457  1 001354   200015 474500                    LDP4    MBLK$,,AUTO
         1 001355   000000 236003                    LDQ     0,DU
         1 001356   400010 552130                    STBQ    8,'30'O,PR4

      601     8458    2               MBLK$->KQ$MBLK.JRNLD='0'B;

   8458  1 001357   200015 474500                    LDP4    MBLK$,,AUTO
         1 001360   000022 236000 2                  LDQ     18
         1 001361   400010 356100                    ANSQ    8,,PR4

      602     8459    2               MBLK$->KQ$MBLK.JOURNAL='0'B;

   8459  1 001362   200015 474500                    LDP4    MBLK$,,AUTO
         1 001363   000023 236000 2                  LDQ     19
         1 001364   400010 356100                    ANSQ    8,,PR4

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:92   
      603     8460    2               MBLK$->KQ$MBLK.FORCECONT='0'B;

   8460  1 001365   200015 474500                    LDP4    MBLK$,,AUTO
         1 001366   000024 236000 2                  LDQ     20
         1 001367   400010 356100                    ANSQ    8,,PR4

      604     8461    2               MBLK$->KQ$MBLK.MSGSIZE=0;

   8461  1 001370   200015 474500                    LDP4    MBLK$,,AUTO
         1 001371   400016 450100                    STZ     14,,PR4

      605     8462    2               MBLK$->KQ$MBLK.PRIO=AUEVPRIL;

   8462  1 001372   000003 720000 0                  LXL0    AUEVPRIL
         1 001373   400001 740100                    STX0    1,,PR4

      606     8463    2               MBLK$->KQ$MBLK.DDA=0;

   8463  1 001374   200015 474500                    LDP4    MBLK$,,AUTO
         1 001375   400006 450100                    STZ     6,,PR4

      607     8464    2               MBLK$->KQ$MBLK.FC=%CG_JNLD#;

   8464  1 001376   200015 474500                    LDP4    MBLK$,,AUTO
         1 001377   400010 236100                    LDQ     8,,PR4
         1 001400   000025 376000 2                  ANQ     21
         1 001401   025000 276003                    ORQ     10752,DU
         1 001402   400010 756100                    STQ     8,,PR4

      608     8465                    %LOCK (G=KQ$CG.TTREE.GATE);

   8466  1 001403   200007 236100                    LDQ     CG$,,AUTO
         1 001404   000067 036003                    ADLQ    55,DU
         1 001405   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001406   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001407   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001410   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:93   
         1 001411   000000 011000                    NOP     0

      609     8468    2               MBLK$->KQ$MBLK.MID.PRIMARY=KQ$CG.MSGID;

   8468  1 001412   200007 470500                    LDP0    CG$,,AUTO
         1 001413   200015 471500                    LDP1    MBLK$,,AUTO
         1 001414   000113 235100                    LDA     75,,PR0
         1 001415   100014 755100                    STA     12,,PR1

      610     8469    2               KQ$CG.MSGID=KQ$CG.MSGID+1;

   8469  1 001416   000113 235100                    LDA     75,,PR0
         1 001417   000001 035007                    ADLA    1,DL
         1 001420   000113 755100                    STA     75,,PR0

      611     8470    2               MBLK$->KQ$MBLK.MID.XT=0;

   8470  1 001421   200015 471500                    LDP1    MBLK$,,AUTO
         1 001422   100015 450100                    STZ     13,,PR1

      612     8471                    %UNLOCK (G=KQ$CG.TTREE.GATE);

   8472  1 001423   200007 236100                    LDQ     CG$,,AUTO
         1 001424   000067 036003                    ADLQ    55,DU
         1 001425   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001426   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001427   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001430   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001431   000000 011000                    NOP     0

      613     8474                    /* MYSTA$ = KQ$CG.GORGOSTA$ here, so gate needs to be locked */
      614     8475                    %LOCK (G=MYSTA$->KQ$STA.GATE);

   8476  1 001432   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001433   000016 036003                    ADLQ    14,DU
         1 001434   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001435   200042 630500                    EPPR0   DBLK$+2,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:94   
         1 001436   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001437   000000 701000 xent               TSX1    HFC$LOCK
         1 001440   000000 011000                    NOP     0

      615     8478    2               MYSTA$->KQ$STA.MBLK$=MBLK$;

   8478  1 001441   200015 236100                    LDQ     MBLK$,,AUTO
         1 001442   200006 470500                    LDP0    MYSTA$,,AUTO
         1 001443   000012 756100                    STQ     10,,PR0

      616     8479    2               CALL KQW$JNLD (MYSTA$->KQ$STA);

   8479  1 001444   200006 630500                    EPPR0   MYSTA$,,AUTO
         1 001445   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001446   000000 701000 xent               TSX1    KQW$JNLD
         1 001447   000000 011000                    NOP     0

      617     8480    2               MBLK$=ADDR(NIL);

   8480  1 001450   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001451   200015 756100                    STQ     MBLK$,,AUTO
         1 001452   001700 710000 1                  TRA     RET

      618     8481        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:95   
      619     8482
      620     8483
      621     8484        /*D*
      622     8485                           %CG_UNLH# - HOLD event.  This record is sent
      623     8486                           to the AU whenever a latched transaction is put
      624     8487                           into HOLD status.
      625     8488
      626     8489
      627     8490                           %CG_UNLR# - RERUN event.  This record is sent
      628     8491                           to the AU whenever a latched transaction is put
      629     8492                           into RERUN status.
      630     8493
      631     8494                           %CG_UNLD# - DELETE event.  This record is sent
      632     8495                           to the AU whenever a latched transaction is
      633     8496                           deleted.
      634     8497        */
      635     8498
      636     8499    2             CASE(%CG_UNLH#,%CG_UNLR#,%CG_UNLD#);

      637     8500
      638     8501    2               IF NOT KQ$CG.AUCTL.UNLAMSG THEN GOTO RET;

   8501  1 001453   200007 473500                    LDP3    CG$,,AUTO
         1 001454   300136 236100                    LDQ     94,,PR3
         1 001455   200000 316003                    CANQ    65536,DU
         1 001456   001700 600000 1                  TZE     RET

      639     8502    2               IF MBLK$=ADDR(NIL) THEN

   8502  1 001457   200015 236100                    LDQ     MBLK$,,AUTO
         1 001460   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001461   001474 601000 1                  TNZ     GETM5

      640     8503    2                CALL KQM$GETMBLK(KQ$CG,MBLK$,TYP) ALTRET(NOMBLK);

   8503  1 001462   200012 634500                    EPPR4   TYP,,AUTO
         1 001463   200044 454500                    STP4    DBLK$+4,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:96   
         1 001464   200015 635500                    EPPR5   MBLK$,,AUTO
         1 001465   200043 455500                    STP5    DBLK$+3,,AUTO
         1 001466   200007 236100                    LDQ     CG$,,AUTO
         1 001467   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001470   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001471   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001472   000000 701000 xent               TSX1    KQM$GETMBLK
         1 001473   001635 702000 1                  TSX2    NOMBLK

   8502  1 001474                       GETM5        null
      641     8504    2   GETM5:      ;
      642     8505    2               TYP=SIZEC(VLP$STATION);

   8505  1 001474   000040 235007                    LDA     32,DL
         1 001475   200012 755100                    STA     TYP,,AUTO

      643     8506    2               IF REGFLG~=0 THEN

   8506  1 001476   200014 236100                    LDQ     REGFLG,,AUTO
         1 001477   001513 600000 1                  TZE     s:8509

      644     8507    2                CALL KQD$GETR(KQ$CG,DBLK$,TYP) ALTRET(ALT);

   8507  1 001500   200012 630500                    EPPR0   TYP,,AUTO
         1 001501   200044 450500                    STP0    DBLK$+4,,AUTO
         1 001502   200013 631500                    EPPR1   DBLK$,,AUTO
         1 001503   200043 451500                    STP1    DBLK$+3,,AUTO
         1 001504   200007 236100                    LDQ     CG$,,AUTO
         1 001505   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001506   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001507   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001510   000000 701000 xent               TSX1    KQD$GETR
         1 001511   001714 702000 1                  TSX2    ALT
         1 001512   001525 710000 1                  TRA     s:8510

      645     8508    2               ELSE
      646     8509    2                CALL KQD$GET(KQ$CG,DBLK$,TYP) ALTRET(ALT);
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:97   

   8509  1 001513   200012 630500                    EPPR0   TYP,,AUTO
         1 001514   200044 450500                    STP0    DBLK$+4,,AUTO
         1 001515   200013 631500                    EPPR1   DBLK$,,AUTO
         1 001516   200043 451500                    STP1    DBLK$+3,,AUTO
         1 001517   200007 236100                    LDQ     CG$,,AUTO
         1 001520   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001521   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001522   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001523   000000 701000 xent               TSX1    KQD$GET
         1 001524   001714 702000 1                  TSX2    ALT

      647     8510    2               STA$=PINCRW(DBLK$,SIZEW(KQ$DBLK));

   8510  1 001525   200013 236100                    LDQ     DBLK$,,AUTO
         1 001526   000006 036003                    ADLQ    6,DU
         1 001527   200010 756100                    STQ     STA$,,AUTO

      648     8511    2               STA$->VLP$STATION=VLP_STATION;

   8511  1 001530   200010 470500                    LDP0    STA$,,AUTO
         1 001531   000100 100400                    MLR     fill='000'O
         1 001532   000004 000040 0                  ADSC9   VLP_STATION              cn=0,n=32
         1 001533   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32

      649     8512    2               STA$->VLP$STATION.MSGID#=ADDR(INFO)->KQ$MBLK.MID.PRIMARY;

   8512  1 001534   200005 471500                    LDP1    @INFO,,AUTO
         1 001535   100014 235100                    LDA     12,,PR1
         1 001536   000005 755100                    STA     5,,PR0

      650     8513    2               STA$->VLP$STATION.MSGIDXT=BINBIT(ADDR(INFO)->KQ$MBLK.MID.XT,36);

   8513  1 001537   100015 236100                    LDQ     13,,PR1
         1 001540   000006 756100                    STQ     6,,PR0

      651     8514    2               IF KQ$CG.QISS THEN
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:98   

   8514  1 001541   200007 473500                    LDP3    CG$,,AUTO
         1 001542   300106 235100                    LDA     70,,PR3
         1 001543   001553 600000 1                  TZE     s:8521

      652     8515    3                 DO;

      653     8516    3                 STA$->VLP$STATION.STATION#=ADDR(INFO)->KQ$MBLK.KEY1;

   8516  1 001544   100002 237100                    LDAQ    2,,PR1
         1 001545   000000 755100                    STA     0,,PR0
         1 001546   000001 756100                    STQ     1,,PR0

      654     8517    3                 STA$->VLP$STATION.MSGTYP#=ADDR(INFO)->KQ$MBLK.KEY2;

   8517  1 001547   100004 237100                    LDAQ    4,,PR1
         1 001550   000002 755100                    STA     2,,PR0
         1 001551   000003 756100                    STQ     3,,PR0

      655     8518    3                 END;

   8518  1 001552   001561 710000 1                  TRA     s:8524

      656     8519    2               ELSE
      657     8520    3                 DO;

      658     8521    3                 STA$->VLP$STATION.STATION#=ADDR(INFO)->KQ$MBLK.KEY2;

   8521  1 001553   100004 237100                    LDAQ    4,,PR1
         1 001554   000000 755100                    STA     0,,PR0
         1 001555   000001 756100                    STQ     1,,PR0

      659     8522    3                 STA$->VLP$STATION.MSGTYP#=ADDR(INFO)->KQ$MBLK.KEY1;

   8522  1 001556   100002 237100                    LDAQ    2,,PR1
         1 001557   000002 755100                    STA     2,,PR0
         1 001560   000003 756100                    STQ     3,,PR0
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:99   

      660     8523    3                 END;

      661     8524    2               DBLK$->KQ$DBLK.STAMP=KQ$MBLK.STAMP;

   8524  1 001561   200015 474500                    LDP4    MBLK$,,AUTO
         1 001562   400001 720100                    LXL0    1,,PR4
         1 001563   200013 475500                    LDP5    DBLK$,,AUTO
         1 001564   500000 740100                    STX0    0,,PR5

      662     8525    2               CALL KQD$UNLOCK(KQ$CG,DBLK$);

   8525  1 001565   200013 634500                    EPPR4   DBLK$,,AUTO
         1 001566   200043 454500                    STP4    DBLK$+3,,AUTO
         1 001567   200007 236100                    LDQ     CG$,,AUTO
         1 001570   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001571   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001572   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001573   000000 701000 xent               TSX1    KQD$UNLOCK
         1 001574   000000 011000                    NOP     0

      663     8526    2               IF NOT KQ$CG.RCVR THEN

   8526  1 001575   200007 470500                    LDP0    CG$,,AUTO
         1 001576   000105 236100                    LDQ     69,,PR0
         1 001577   000010 316007                    CANQ    8,DL
         1 001600   001617 601000 1                  TNZ     s:8529

      664     8527    2                CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,%CG_UNL_USER#,TYP,SIZEC(
              8527                         VLP$STATION));

   8527  1 001601   000027 236000 2                  LDQ     23
         1 001602   200034 756100                    STQ     @DDA+1,,AUTO
         1 001603   200012 631500                    EPPR1   TYP,,AUTO
         1 001604   200033 451500                    STP1    @INFO+1,,AUTO
         1 001605   000000 236000 2                  LDQ     0
         1 001606   200032 756100                    STQ     @PRIO+1,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:100  
         1 001607   000013 236000 2                  LDQ     11
         1 001610   200004 235100                    LDA     @CODE,,AUTO
         1 001611   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001612   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001613   200027 756100                    STQ     COD+2,,AUTO
         1 001614   002214 701000 1                  TSX1    SENDAU
         1 001615   000000 011000                    NOP     0
         1 001616   001634 710000 1                  TRA     s:8530

      665     8528    2               ELSE
      666     8529    2                CALL SENDAU(MYSTA$->KQ$STA,CODE,AUEVPRIL,%CG_UNL_RCVR#,TYP,SIZEC(
              8529                         VLP$STATION));

   8529  1 001617   000027 236000 2                  LDQ     23
         1 001620   200034 756100                    STQ     @DDA+1,,AUTO
         1 001621   200012 631500                    EPPR1   TYP,,AUTO
         1 001622   200033 451500                    STP1    @INFO+1,,AUTO
         1 001623   000014 236000 2                  LDQ     12
         1 001624   200032 756100                    STQ     @PRIO+1,,AUTO
         1 001625   000013 236000 2                  LDQ     11
         1 001626   200004 235100                    LDA     @CODE,,AUTO
         1 001627   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001630   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001631   200027 756100                    STQ     COD+2,,AUTO
         1 001632   002214 701000 1                  TSX1    SENDAU
         1 001633   000000 011000                    NOP     0

      667     8530    2               GOTO RET;

   8530  1 001634   001700 710000 1                  TRA     RET

      668     8531        /**/
      669     8532    2   NOMBLK:     ;

   8532  1 001635                       NOMBLK       null
      670     8533    2               IF REGFLG=0 THEN

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:101  
   8533  1 001635   200014 235100                    LDA     REGFLG,,AUTO
         1 001636   001714 600000 1                  TZE     ALT

      671     8534    2                GOTO ALT;
      672     8535    2               TYP=KQMR_MBLK#;

   8535  1 001637   000001 236007                    LDQ     1,DL
         1 001640   200012 756100                    STQ     TYP,,AUTO

      673     8536    2               MBLK$=MYSTA$;

   8536  1 001641   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001642   200015 756100                    STQ     MBLK$,,AUTO

      674     8537    2               CALL KQM$GETBR(KQ$CG,MBLK$,TYP) ALTRET(ALT);

   8537  1 001643   200012 630500                    EPPR0   TYP,,AUTO
         1 001644   200044 450500                    STP0    DBLK$+4,,AUTO
         1 001645   200015 631500                    EPPR1   MBLK$,,AUTO
         1 001646   200043 451500                    STP1    DBLK$+3,,AUTO
         1 001647   200007 236100                    LDQ     CG$,,AUTO
         1 001650   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001651   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001652   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001653   000000 701000 xent               TSX1    KQM$GETBR
         1 001654   001714 702000 1                  TSX2    ALT

      675     8538    2               GOTO GETM5;

   8538  1 001655   001474 710000 1                  TRA     GETM5

      676     8539        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:102  
      677     8540
      678     8541        /*D*
      679     8542                      %CG_FWCG - FWCG-complete event.  This event doesn't
      680     8543                      actually go to the AU; it goes to the current station.
      681     8544                      KCA$TELLAUM is the only way to report this event,
      682     8545                      since the passed MBLK already contains DDA and MSGSIZE.
      683     8546                      We simply set up the rest of the MBLK correctly and
      684     8547                      send the message to ourselves.
      685     8548
      686     8549                      A MSGID is obtained and returned in the 3rd param
      687     8550                      of KCA$TELLAUM.
      688     8551        */
      689     8552
      690     8553    2             CASE (%CG_FWCG#);

      691     8554
      692     8555    2               IF MBLK$ = ADDR(NIL) THEN CALL SC_CGAUERR;

   8555  1 001656   200015 236100                    LDQ     MBLK$,,AUTO
         1 001657   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001660   001663 601000 1                  TNZ     s:8556

   8555  1 001661   000000 713400 xsym               CLIMB   SC_CGAUERR
         1 001662   000000 600000 xsid               climb   nvectors=         0

      693     8556    2               CALL SENDAU (MYSTA$->KQ$STA,%CG_FWCG#,AUEVPRIL,INFO);

   8556  1 001663   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001664   200034 756100                    STQ     @DDA+1,,AUTO
         1 001665   200005 235100                    LDA     @INFO,,AUTO
         1 001666   200032 757100                    STAQ    @PRIO+1,,AUTO
         1 001667   000032 237000 2                  LDAQ    26
         1 001670   200030 757100                    STAQ    @KQ$STA+1,,AUTO
         1 001671   200006 236100                    LDQ     MYSTA$,,AUTO
         1 001672   200027 756100                    STQ     COD+2,,AUTO
         1 001673   002214 701000 1                  TSX1    SENDAU
         1 001674   000000 011000                    NOP     0
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:103  
         1 001675   001700 710000 1                  TRA     RET

      694     8557        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:104  
      695     8558
      696     8559
      697     8560    2             CASE(ELSE);

      698     8561
      699     8562    2               CALL SC_CGAUERR;

   8562  1 001676   000000 713400 xsym               CLIMB   SC_CGAUERR
         1 001677   000000 600000 xsid               climb   nvectors=         0

      700     8563        /*S*  SCREECH_CODE: KCA-S$CGAUERR
      701     8564              TYPE: SCREECH
      702     8565              MESSAGE: Error reporting an event to the AU of a comgroup
      703     8566        */
      704     8567    2           END;

   8560  1 001700                       RET          null
      705     8568
      706     8569
      707     8570    1   RET:  ;
      708     8571    1         IF MBLK$ ~= ADDR(NIL) THEN

   8571  1 001700   200015 236100                    LDQ     MBLK$,,AUTO
         1 001701   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001702   001713 600000 1                  TZE     s:8573

      709     8572    1          CALL KQM$RELMBLK (KQ$CG,MBLK$);

   8572  1 001703   200015 630500                    EPPR0   MBLK$,,AUTO
         1 001704   200043 450500                    STP0    DBLK$+3,,AUTO
         1 001705   200007 236100                    LDQ     CG$,,AUTO
         1 001706   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001707   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001710   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001711   000000 701000 xent               TSX1    KQM$RELMBLK
         1 001712   000000 011000                    NOP     0

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:105  
      710     8573    1         RETURN;

   8573  1 001713   000000 702200 xent               TSX2  ! X66_ARET

   8571  1 001714                       ALT          null
      711     8574        /**/
      712     8575    1   ALT:  ;
      713     8576    2         IF MBLK$~=ADDR(NIL) THEN DO;

   8576  1 001714   200015 236100                    LDQ     MBLK$,,AUTO
         1 001715   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001716   001744 600000 1                  TZE     s:8582

      714     8577    2           IF MBLK$->KQ$MBLK.DDA~=0

   8577  1 001717   200015 470500                    LDP0    MBLK$,,AUTO
         1 001720   000006 235100                    LDA     6,,PR0
         1 001721   001734 600000 1                  TZE     s:8580

      715     8578    2           THEN CALL KQD$DELDDA(KQ$CG,MBLK$->KQ$MBLK.STAMP,

   8578  1 001722   000006 036003                    ADLQ    6,DU
         1 001723   200044 756100                    STQ     DBLK$+4,,AUTO
         1 001724   200015 236100                    LDQ     MBLK$,,AUTO
         1 001725   000031 036000 2                  ADLQ    25
         1 001726   200007 235100                    LDA     CG$,,AUTO
         1 001727   200042 757100                    STAQ    DBLK$+2,,AUTO
         1 001730   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001731   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001732   000000 701000 xent               TSX1    KQD$DELDDA
         1 001733   000000 011000                    NOP     0

      716     8579    2            MBLK$->KQ$MBLK.DDA);
      717     8580    2           CALL KQM$RELMBLK(KQ$CG,MBLK$);

   8580  1 001734   200015 630500                    EPPR0   MBLK$,,AUTO
         1 001735   200043 450500                    STP0    DBLK$+3,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:106  
         1 001736   200007 236100                    LDQ     CG$,,AUTO
         1 001737   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001740   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001741   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001742   000000 701000 xent               TSX1    KQM$RELMBLK
         1 001743   000000 011000                    NOP     0

      718     8581    2           END;

      719     8582    1         ALTRETURN;

   8582  1 001744   000000 702200 xent               TSX2  ! X66_AALT

      720     8583        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:107  
      721     8584        /**/
      722     8585        /*F* NAME:         KCA$CLOCK
      723     8586             PURPOSE:      To process deferred AU-related items
      724     8587             CALL:         KCA$CLOCK (KQ$CG)
      725     8588             DESCRIPTION:  Called from KCC$CLOCK when KQ$CG.DELAY.AU is
      726     8589                           found set.
      727     8590        */
      728     8591    1   KCA$CLOCK: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */

   8591  1 001745   000000 700200 xent  KCA$CLOCK    TSX0  ! X66_AUTO_3
         1 001746   000046 000003                    ZERO    38,3

      729     8592        /**/
      730     8593    1         CG$=ADDR(PARM);

   8593  1 001747   200003 236100                    LDQ     @PARM,,AUTO
         1 001750   200007 756100                    STQ     CG$,,AUTO

      731     8594    1         REGFLG=0;

   8594  1 001751   200014 450100                    STZ     REGFLG,,AUTO

      732     8595              %LOCK (G=KQ$CG.GATE.CG);

   8596  1 001752   000107 036003                    ADLQ    71,DU
         1 001753   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001754   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001755   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001756   000000 701000 xent               TSX1    HFC$LOCK
         1 001757   000000 011000                    NOP     0

      733     8598    1         KQ$CG.DELAY.AU='0'B;

   8598  1 001760   200007 470500                    LDP0    CG$,,AUTO
         1 001761   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 001762   000020 356100                    ANSQ    16,,PR0

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:108  
      734     8599              %UNLOCK (G=KQ$CG.GATE.CG);

   8600  1 001763   200007 236100                    LDQ     CG$,,AUTO
         1 001764   000107 036003                    ADLQ    71,DU
         1 001765   200042 756100                    STQ     DBLK$+2,,AUTO
         1 001766   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 001767   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001770   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001771   000000 011000                    NOP     0

   8598  1 001772                       CLOCK0       null
      735     8602    1   CLOCK0:;
      736     8603    1         CALL SLOCK;

   8603  1 001772   002120 701000 1                  TSX1    SLOCK
         1 001773   000000 011000                    NOP     0

      737     8604    1         STA$=KQ$CG.STREE.HEAD$;

   8604  1 001774   200007 470500                    LDP0    CG$,,AUTO
         1 001775   000101 236100                    LDQ     65,,PR0
         1 001776   200010 756100                    STQ     STA$,,AUTO

      738     8605    2           DO WHILE (STA$ ~= ADDR(NIL));

   8605  1 001777   002041 710000 1                  TRA     s:8624

      739     8606    2           CALL STALOCK;

   8606  1 002000   002144 701000 1                  TSX1    STALOCK
         1 002001   000000 011000                    NOP     0

      740     8607    2           IF STA$->KQ$STA.TERM THEN

   8607  1 002002   200010 470500                    LDP0    STA$,,AUTO
         1 002003   000020 236100                    LDQ     16,,PR0
         1 002004   040000 316003                    CANQ    16384,DU
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:109  
         1 002005   002034 600000 1                  TZE     s:8622

      741     8608    2            IF STA$->KQ$STA.EVNT THEN

   8608  1 002006   002000 316003                    CANQ    1024,DU
         1 002007   002034 600000 1                  TZE     s:8622

      742     8609    3              DO;

      743     8610    3              STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

   8610  1 002010   000001 036007                    ADLQ    1,DL
         1 002011   000020 552104                    STBQ    16,'04'O,PR0

      744     8611    3              CALL TBRK;

   8611  1 002012   002046 701000 1                  TSX1    TBRK
         1 002013   000000 011000                    NOP     0

      745     8612    3   CLOCK1:    IF NOT STA$->KQ$STA.IDSC THEN

   8612  1 002014   200010 470500       CLOCK1       LDP0    STA$,,AUTO
         1 002015   000020 234100                    SZN     16,,PR0
         1 002016   002023 604000 1                  TMI     s:8616

      746     8613    3               STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT-1;

   8613  1 002017   000020 236100                    LDQ     16,,PR0
         1 002020   000777 036007                    ADLQ    511,DL
         1 002021   000020 552104                    STBQ    16,'04'O,PR0
         1 002022   002034 710000 1                  TRA     s:8622

      747     8614    3              ELSE
      748     8615    4                DO;

      749     8616    4                CALL STAUNLOCK;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:110  
   8616  1 002023   002156 701000 1                  TSX1    STAUNLOCK
         1 002024   000000 011000                    NOP     0

      750     8617    4                CALL SUNLOCK;

   8617  1 002025   002132 701000 1                  TSX1    SUNLOCK
         1 002026   000000 011000                    NOP     0

      751     8618    4                CALL KQP$UNLOCK (STA$->KQ$STA);

   8618  1 002027   200010 630500                    EPPR0   STA$,,AUTO
         1 002030   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002031   000000 701000 xent               TSX1    KQP$UNLOCK
         1 002032   000000 011000                    NOP     0

      752     8619    4                GOTO CLOCK0;

   8619  1 002033   001772 710000 1                  TRA     CLOCK0

      753     8620    4                END;
      754     8621    3              END;
      755     8622    2           CALL STAUNLOCK;

   8622  1 002034   002156 701000 1                  TSX1    STAUNLOCK
         1 002035   000000 011000                    NOP     0

      756     8623    2           STA$=STA$->KQ$STA.BTN.FLINK$;

   8623  1 002036   200010 470500                    LDP0    STA$,,AUTO
         1 002037   000004 236100                    LDQ     4,,PR0
         1 002040   200010 756100                    STQ     STA$,,AUTO

      757     8624    2           END;

   8624  1 002041   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002042   002000 601000 1                  TNZ     s:8606

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:111  
      758     8625    1         CALL SUNLOCK;

   8625  1 002043   002132 701000 1                  TSX1    SUNLOCK
         1 002044   000000 011000                    NOP     0

      759     8626    1         RETURN;

   8626  1 002045   000000 702200 xent               TSX2  ! X66_ARET

      760     8627        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:112  
      761     8628        /****************************************************************
      762     8629        *****************************************************************/
      763     8630        /*D* NAME:         TBRK
      764     8631             PURPOSE:      To perform functions for handling
      765     8632                           terminal breaks */
      766     8633        /**/
      767     8634    1   TBRK: PROC;

   8634  1 002046   200022 741300       TBRK         STX1  ! NXT$+2,,AUTO

      768     8635        /**/
      769     8636    2   DCL T$ PTR;
      770     8637    2   DCL SENT UBIN;
      771     8638    2   DCL COD UBIN;
      772     8639        /**/
      773     8640    2         COD=%CG_TBRK#;

   8640  1 002047   000004 235007                    LDA     4,DL
         1 002050   200025 755100                    STA     COD,,AUTO

      774     8641    2         TYP=STA$->KQ$STA.EVSC;

   8641  1 002051   200010 470500                    LDP0    STA$,,AUTO
         1 002052   000013 235100                    LDA     11,,PR0
         1 002053   200012 755100                    STA     TYP,,AUTO

      775     8642    2   EVNT: SENT=0;

   8642  1 002054   200024 450100       EVNT         STZ     SENT,,AUTO

      776     8643    2         CALL STAUNLOCK;

   8643  1 002055   002156 701000 1                  TSX1    STAUNLOCK
         1 002056   000000 011000                    NOP     0

      777     8644    2         CALL SUNLOCK;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:113  
   8644  1 002057   002132 701000 1                  TSX1    SUNLOCK
         1 002060   000000 011000                    NOP     0

      778     8645    2         T$=MBLK$;

   8645  1 002061   200015 236100                    LDQ     MBLK$,,AUTO
         1 002062   200023 756100                    STQ     T$,,AUTO

      779     8646    2         MBLK$=ADDR(NIL);

   8646  1 002063   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002064   200015 756100                    STQ     MBLK$,,AUTO

      780     8647    2         CALL SENDAU (STA$->KQ$STA,COD,AUEVPRIL,TYP) ALTRET(NOSENT);

   8647  1 002065   200034 756100                    STQ     @DDA+1,,AUTO
         1 002066   200033 756100                    STQ     @INFO+1,,AUTO
         1 002067   200012 630500                    EPPR0   TYP,,AUTO
         1 002070   200032 450500                    STP0    @PRIO+1,,AUTO
         1 002071   000013 236000 2                  LDQ     11
         1 002072   200031 756100                    STQ     @CODE+1,,AUTO
         1 002073   200025 631500                    EPPR1   COD,,AUTO
         1 002074   200030 451500                    STP1    @KQ$STA+1,,AUTO
         1 002075   200010 236100                    LDQ     STA$,,AUTO
         1 002076   200027 756100                    STQ     COD+2,,AUTO
         1 002077   002214 701000 1                  TSX1    SENDAU
         1 002100   002103 702000 1                  TSX2    NOSENT

      781     8648    2         SENT=1;

   8648  1 002101   000001 235007                    LDA     1,DL
         1 002102   200024 755100                    STA     SENT,,AUTO

   8648  1 002103                       NOSENT       null
      782     8649    2   NOSENT:;
      783     8650    2         MBLK$=T$;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:114  
   8650  1 002103   200023 236100                    LDQ     T$,,AUTO
         1 002104   200015 756100                    STQ     MBLK$,,AUTO

      784     8651    2         CALL SLOCK;

   8651  1 002105   002120 701000 1                  TSX1    SLOCK
         1 002106   000000 011000                    NOP     0

      785     8652    2         CALL STALOCK;

   8652  1 002107   002144 701000 1                  TSX1    STALOCK
         1 002110   000000 011000                    NOP     0

      786     8653    2         IF SENT ~= 0 THEN STA$->KQ$STA.EVNT='0'B;

   8653  1 002111   200024 235100                    LDA     SENT,,AUTO
         1 002112   002116 600000 1                  TZE     s:8654

   8653  1 002113   200010 470500                    LDP0    STA$,,AUTO
         1 002114   000034 236000 2                  LDQ     28
         1 002115   000020 356100                    ANSQ    16,,PR0

      787     8654    2         RETURN;

   8654  1 002116   200022 221300                    LDX1  ! NXT$+2,,AUTO
         1 002117   000001 702211                    TSX2  ! 1,X1

      788     8655    2   END TBRK;
      789     8656        /****************************************************************
      790     8657        *****************************************************************/
      791     8658        /*D* NAME:         SLOCK SUNLOCK STALOCK STAUNLOCK MSTALOCK MSTAUNLOCK
      792     8659             PURPOSE:      Routines to lock/unlock gates */
      793     8660        /**/
      794     8661    1   SLOCK: PROC;

   8661  1 002120   200026 741300       SLOCK        STX1  ! COD+1,,AUTO

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:115  
      795     8662        /**/
      796     8663        %LOCK (G=KQ$CG.STREE.GATE);

   8664  1 002121   200007 236100                    LDQ     CG$,,AUTO
         1 002122   000075 036003                    ADLQ    61,DU
         1 002123   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002124   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002125   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002126   000000 701000 xent               TSX1    HFC$LOCK
         1 002127   000000 011000                    NOP     0

      797     8666    2         RETURN;

   8666  1 002130   200026 221300                    LDX1  ! COD+1,,AUTO
         1 002131   000001 702211                    TSX2  ! 1,X1

      798     8667    2   SUNLOCK: ENTRY;

   8667  1 002132   200026 741300       SUNLOCK      STX1  ! COD+1,,AUTO

      799     8668        /**/
      800     8669              %UNLOCK (G=KQ$CG.STREE.GATE);

   8670  1 002133   200007 236100                    LDQ     CG$,,AUTO
         1 002134   000075 036003                    ADLQ    61,DU
         1 002135   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002136   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002137   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002140   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002141   000000 011000                    NOP     0

      801     8672    2         RETURN;

   8672  1 002142   200026 221300                    LDX1  ! COD+1,,AUTO
         1 002143   000001 702211                    TSX2  ! 1,X1

      802     8673    2   STALOCK: ENTRY;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:116  

   8673  1 002144   200026 741300       STALOCK      STX1  ! COD+1,,AUTO

      803     8674        /**/
      804     8675              %LOCK (G=STA$->KQ$STA.GATE);

   8676  1 002145   200010 236100                    LDQ     STA$,,AUTO
         1 002146   000016 036003                    ADLQ    14,DU
         1 002147   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002150   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002151   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002152   000000 701000 xent               TSX1    HFC$LOCK
         1 002153   000000 011000                    NOP     0

      805     8678    2         RETURN;

   8678  1 002154   200026 221300                    LDX1  ! COD+1,,AUTO
         1 002155   000001 702211                    TSX2  ! 1,X1

      806     8679    2   STAUNLOCK: ENTRY;

   8679  1 002156   200026 741300       STAUNLOCK    STX1  ! COD+1,,AUTO

      807     8680        /**/
      808     8681              %UNLOCK (G=STA$->KQ$STA.GATE);

   8682  1 002157   200010 236100                    LDQ     STA$,,AUTO
         1 002160   000016 036003                    ADLQ    14,DU
         1 002161   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002162   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002163   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002164   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002165   000000 011000                    NOP     0

      809     8684    2         RETURN;

   8684  1 002166   200026 221300                    LDX1  ! COD+1,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:117  
         1 002167   000001 702211                    TSX2  ! 1,X1

      810     8685    2   MSTALOCK: ENTRY;

   8685  1 002170   200026 741300       MSTALOCK     STX1  ! COD+1,,AUTO

      811     8686        /**/
      812     8687              %LOCK (G=MYSTA$->KQ$STA.GATE);

   8688  1 002171   200006 236100                    LDQ     MYSTA$,,AUTO
         1 002172   000016 036003                    ADLQ    14,DU
         1 002173   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002174   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002175   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002176   000000 701000 xent               TSX1    HFC$LOCK
         1 002177   000000 011000                    NOP     0

      813     8690    2         RETURN;

   8690  1 002200   200026 221300                    LDX1  ! COD+1,,AUTO
         1 002201   000001 702211                    TSX2  ! 1,X1

      814     8691    2   MSTAUNLOCK: ENTRY;

   8691  1 002202   200026 741300       MSTAUNLOCK   STX1  ! COD+1,,AUTO

      815     8692        /**/
      816     8693              %UNLOCK (G=MYSTA$->KQ$STA.GATE);

   8694  1 002203   200006 236100                    LDQ     MYSTA$,,AUTO
         1 002204   000016 036003                    ADLQ    14,DU
         1 002205   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002206   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002207   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002210   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002211   000000 011000                    NOP     0

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:118  
      817     8696    2         RETURN;

   8696  1 002212   200026 221300                    LDX1  ! COD+1,,AUTO
         1 002213   000001 702211                    TSX2  ! 1,X1

      818     8697    2   END SLOCK;
      819     8698        /**/
      820     8699        %EJECT;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:119  
      821     8700        /****************************************************************
      822     8701        *****************************************************************/
      823     8702        /*D* NAME:         SENDAU
      824     8703             PURPOSE:      To send an event to the AU
      825     8704             CALL:         SENDAU (KQ$STA,CODE,PRIO,INFO[,DDA,DDASIZ) ALTRET(LOC)
      826     8705             INPUT:        KQ$STA     is the sending station
      827     8706                           CODE       is the %CG_XXXX# event code
      828     8707                           PRIO       is the prio that the message is to have
      829     8708                           INFO       one word of info to be received by the
      830     8709                                      AU in B$CGAURD.INFO
      831     8710                           DDA        the DDA for connect events
      832     8711                           DDASIZ     the info size for connect events
      833     8712             DESCRIPTION:  An MBLK is obtained if we don't have one already
      834     8713                           (MBLK$ ~= ADDR(NIL)), and initialized as appropriate
      835     8714                           to the event being passed.  The event is sent to
      836     8715                           the AU via KQW$WRITE.
      837     8716
      838     8717                           In order to avoid making a data block to carry
      839     8718                           the contents of B$CGAURD, we kluge things so that
      840     8719                           this info is carried in the MBLK itself.  This
      841     8720                           requires magic code in KQR$READ when the message
      842     8721                           is being read.  In particular:
      843     8722
      844     8723                              EVENT     - is stored in KQ$MBLK.FC
      845     8724                              INFO      - is stored as the MSGID extension
      846     8725        */
      847     8726    1   SENDAU: PROC(KQ$STA,CODE,PRIO,INFO,DDA,DDASIZ) ALTRET;

   8726  1 002214   200026 741300       SENDAU       STX1  ! COD+1,,AUTO

      848     8727
      849     8728        /**/
      850     8729        /* PARAMETERS */
      851     8730        /**/
      852     8731        %KQ_STA (FPTN=KQ$STA,STCLASS=);
      853     9070    2   DCL CODE UBIN;
      854     9071    2   DCL PRIO UBIN;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:120  
      855     9072    2   DCL INFO UBIN;
      856     9073    2   DCL DDA UBIN;
      857     9074    2   DCL DDASIZ UBIN;
      858     9075
      859     9076
      860     9077        /**/
      861     9078        /* AUTO */
      862     9079        /**/
      863     9080    2   DCL I UBIN;
      864     9081    2   DCL DSTA CHAR(8);
      865     9082    2   DCL DBLK$ PTR;
      866     9083
      867     9084
      868     9085        /**/
      869     9086        /* BASED */
      870     9087        /**/
      871     9088        %KQ_STA (FPTN=KQ$STA1,STCLASS=BASED);
      872     9427    2   DCL MOVEI CHAR(I) BASED ALIGNED;
      873     9428
      874     9429
      875     9430
      876     9431            %LOCK (G=KQ$CG.GATE.CG);

   9432  1 002215   200007 236100                    LDQ     CG$,,AUTO
         1 002216   000107 036003                    ADLQ    71,DU
         1 002217   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002220   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002221   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002222   000000 701000 xent               TSX1    HFC$LOCK
         1 002223   000000 011000                    NOP     0

      877     9434    2         IF CODE = %CG_FWCG# THEN

   9434  1 002224   200030 470500                    LDP0    @CODE,,AUTO
         1 002225   000000 235100                    LDA     0,,PR0
         1 002226   000024 115007                    CMPA    20,DL
         1 002227   002235 601000 1                  TNZ     s:9438
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:121  

      878     9435    2          DSTA=KQ$STA.BTN.KEY;

   9435  1 002230   200027 471500                    LDP1    @KQ$STA,,AUTO
         1 002231   040100 100500                    MLR     fill='040'O
         1 002232   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 002233   200036 000010                    ADSC9   DSTA,,AUTO               cn=0,n=8
         1 002234   002270 710000 1                  TRA     SENDIT

      879     9436    2         ELSE
      880     9437    3           DO;

      881     9438    3           IF KQ$CG.AUSTA$=ADDR(NIL) THEN

   9438  1 002235   200007 471500                    LDP1    CG$,,AUTO
         1 002236   100121 236100                    LDQ     81,,PR1
         1 002237   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002240   002264 601000 1                  TNZ     s:9450

      882     9439    4             DO;

      883     9440    4             IF CODE=%CG_UNLH# OR CODE=%CG_UNLR# OR CODE=%CG_UNLD# THEN

   9440  1 002241   000007 115007                    CMPA    7,DL
         1 002242   002247 600000 1                  TZE     s:9442
         1 002243   000006 115007                    CMPA    6,DL
         1 002244   002247 600000 1                  TZE     s:9442
         1 002245   000010 115007                    CMPA    8,DL
         1 002246   002253 601000 1                  TNZ     s:9446

      884     9441    5               DO;

      885     9442    5               DSTA='*GORGO';

   9442  1 002247   040100 100400                    MLR     fill='040'O
         1 002250   000014 000006 0                  ADSC9   VLP_STATION+8            cn=0,n=6
         1 002251   200036 000010                    ADSC9   DSTA,,AUTO               cn=0,n=8
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:122  

      886     9443    5               GOTO SENDIT;

   9443  1 002252   002270 710000 1                  TRA     SENDIT

      887     9444    5               END;
      888     9445                  %UNLOCK (G=KQ$CG.GATE.CG);

   9446  1 002253   200007 236100                    LDQ     CG$,,AUTO
         1 002254   000107 036003                    ADLQ    71,DU
         1 002255   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002256   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002257   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002260   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002261   000000 011000                    NOP     0

      889     9448    4             ALTRETURN;

   9448  1 002262   200026 221300                    LDX1  ! COD+1,,AUTO
         1 002263   000000 702211                    TSX2  ! 0,X1

      890     9449    4             END;
      891     9450    3           DSTA=KQ$CG.AUSTA$->KQ$STA1.BTN.KEY;

   9450  1 002264   100121 473500                    LDP3    81,,PR1
         1 002265   040100 100500                    MLR     fill='040'O
         1 002266   300005 000010                    ADSC9   5,,PR3                   cn=0,n=8
         1 002267   200036 000010                    ADSC9   DSTA,,AUTO               cn=0,n=8

      892     9451    3           END;

   9446  1 002270                       SENDIT       null
      893     9452    2   SENDIT: ;
      894     9453    2         KQ$CG.AUSENDCNT=KQ$CG.AUSENDCNT+1;

   9453  1 002270   200007 471500                    LDP1    CG$,,AUTO
         1 002271   100122 236100                    LDQ     82,,PR1
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:123  
         1 002272   000001 036003                    ADLQ    1,DU
         1 002273   100122 552120                    STBQ    82,'20'O,PR1

      895     9454              %UNLOCK (G=KQ$CG.GATE.CG);

   9455  1 002274   200007 236100                    LDQ     CG$,,AUTO
         1 002275   000107 036003                    ADLQ    71,DU
         1 002276   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002277   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002300   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002301   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002302   000000 011000                    NOP     0

      896     9457    2         IF MBLK$=ADDR(NIL) THEN

   9457  1 002303   200015 236100                    LDQ     MBLK$,,AUTO
         1 002304   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002305   002320 601000 1                  TNZ     GOTMBLK

      897     9458    2          CALL KQM$GETMBLK(KQ$CG,MBLK$,I) ALTRET(NOMBLK);

   9458  1 002306   200035 630500                    EPPR0   I,,AUTO
         1 002307   200044 450500                    STP0    DBLK$+4,,AUTO
         1 002310   200015 631500                    EPPR1   MBLK$,,AUTO
         1 002311   200043 451500                    STP1    DBLK$+3,,AUTO
         1 002312   200007 236100                    LDQ     CG$,,AUTO
         1 002313   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002314   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002315   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002316   000000 701000 xent               TSX1    KQM$GETMBLK
         1 002317   002614 702000 1                  TSX2    NOMBLK

   9457  1 002320                       GOTMBLK      null
      898     9459    2   GOTMBLK: ;
      899     9460    2         IF NOT KQ$CG.QISS THEN

   9460  1 002320   200007 470500                    LDP0    CG$,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:124  
         1 002321   000106 235100                    LDA     70,,PR0
         1 002322   002334 601000 1                  TNZ     s:9467

      900     9461    3           DO;

      901     9462    3           KQ$MBLK.KEY1=AUEVKEY;

   9462  1 002323   000000 237000 0                  LDAQ    AUEVKEY
         1 002324   200015 471500                    LDP1    MBLK$,,AUTO
         1 002325   100002 757100                    STAQ    2,,PR1

      902     9463    3           KQ$MBLK.KEY2=KQ$STA.BTN.KEY;

   9463  1 002326   200027 471500                    LDP1    @KQ$STA,,AUTO
         1 002327   200015 473500                    LDP3    MBLK$,,AUTO
         1 002330   040100 100500                    MLR     fill='040'O
         1 002331   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 002332   300004 000010                    ADSC9   4,,PR3                   cn=0,n=8

      903     9464    3           END;

   9464  1 002333   002344 710000 1                  TRA     s:9470

      904     9465    2         ELSE
      905     9466    3           DO;

      906     9467    3           KQ$MBLK.KEY1=KQ$STA.BTN.KEY;

   9467  1 002334   200027 471500                    LDP1    @KQ$STA,,AUTO
         1 002335   200015 473500                    LDP3    MBLK$,,AUTO
         1 002336   040100 100500                    MLR     fill='040'O
         1 002337   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         1 002340   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8

      907     9468    3           KQ$MBLK.KEY2=AUEVKEY;

   9468  1 002341   000000 237000 0                  LDAQ    AUEVKEY
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:125  
         1 002342   200015 473500                    LDP3    MBLK$,,AUTO
         1 002343   300004 757100                    STAQ    4,,PR3

      908     9469    3           END;

      909     9470    2         KQ$MBLK.STAR='1'B;

   9470  1 002344   200015 473500                    LDP3    MBLK$,,AUTO
         1 002345   100000 236003                    LDQ     32768,DU
         1 002346   300010 256100                    ORSQ    8,,PR3

      910     9471              %LOCK (G=KQ$CG.TTREE.GATE);

   9472  1 002347   200007 236100                    LDQ     CG$,,AUTO
         1 002350   000067 036003                    ADLQ    55,DU
         1 002351   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002352   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002353   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002354   000000 701000 xent               TSX1    HFC$LOCK
         1 002355   000000 011000                    NOP     0

      911     9474    2         KQ$MBLK.MID.PRIMARY=KQ$CG.MSGID;

   9474  1 002356   200007 470500                    LDP0    CG$,,AUTO
         1 002357   200015 471500                    LDP1    MBLK$,,AUTO
         1 002360   000113 235100                    LDA     75,,PR0
         1 002361   100014 755100                    STA     12,,PR1

      912     9475    2         KQ$CG.MSGID=KQ$CG.MSGID+1;

   9475  1 002362   000113 235100                    LDA     75,,PR0
         1 002363   000001 035007                    ADLA    1,DL
         1 002364   000113 755100                    STA     75,,PR0

      913     9476              %UNLOCK (G=KQ$CG.TTREE.GATE);

   9477  1 002365   200007 236100                    LDQ     CG$,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:126  
         1 002366   000067 036003                    ADLQ    55,DU
         1 002367   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002370   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002372   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002373   000000 011000                    NOP     0

      914     9479    2         IF CODE = %CG_FWCG# THEN INFO=KQ$MBLK.MID.PRIMARY;

   9479  1 002374   200030 470500                    LDP0    @CODE,,AUTO
         1 002375   000000 235100                    LDA     0,,PR0
         1 002376   000024 115007                    CMPA    20,DL
         1 002377   002405 601000 1                  TNZ     s:9481

   9479  1 002400   200015 471500                    LDP1    MBLK$,,AUTO
         1 002401   200032 473500                    LDP3    @INFO,,AUTO
         1 002402   100014 235100                    LDA     12,,PR1
         1 002403   300000 755100                    STA     0,,PR3
         1 002404   002417 710000 1                  TRA     s:9485

      915     9480    2         ELSE
      916     9481    2          IF ADDR(INFO)~=ADDR(NIL) THEN

   9481  1 002405   200032 236100                    LDQ     @INFO,,AUTO
         1 002406   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002407   002415 600000 1                  TZE     s:9484

      917     9482    2           KQ$MBLK.MID.XT=INFO;

   9482  1 002410   200032 471500                    LDP1    @INFO,,AUTO
         1 002411   200015 473500                    LDP3    MBLK$,,AUTO
         1 002412   100000 235100                    LDA     0,,PR1
         1 002413   300015 755100                    STA     13,,PR3
         1 002414   002417 710000 1                  TRA     s:9485

      918     9483    2          ELSE
      919     9484    2           KQ$MBLK.MID.XT=0;
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:127  

   9484  1 002415   200015 471500                    LDP1    MBLK$,,AUTO
         1 002416   100015 450100                    STZ     13,,PR1

      920     9485    2         KQ$MBLK.PRIO=PRIO;

   9485  1 002417   200031 471500                    LDP1    @PRIO,,AUTO
         1 002420   100000 720100                    LXL0    0,,PR1
         1 002421   200015 473500                    LDP3    MBLK$,,AUTO
         1 002422   300001 740100                    STX0    1,,PR3

      921     9486    2         KQ$MBLK.FC=CODE;

   9486  1 002423   200015 473500                    LDP3    MBLK$,,AUTO
         1 002424   000000 236100                    LDQ     0,,PR0
         1 002425   000033 736000                    QLS     27
         1 002426   300010 676100                    ERQ     8,,PR3
         1 002427   037000 376003                    ANQ     15872,DU
         1 002430   300010 656100                    ERSQ    8,,PR3

      922     9487    2         KQ$MBLK.DSTA=DSTA;

   9487  1 002431   200015 473500                    LDP3    MBLK$,,AUTO
         1 002432   200036 237100                    LDAQ    DSTA,,AUTO
         1 002433   300011 755100                    STA     9,,PR3
         1 002434   300012 756100                    STQ     10,,PR3

      923     9488    2         IF (CODE=%CG_TCON# OR CODE=%CG_DOPN#)

   9488  1 002435   000000 235100                    LDA     0,,PR0
         1 002436   000002 115007                    CMPA    2,DL
         1 002437   002442 600000 1                  TZE     s:9488+5
         1 002440   000000 115003                    CMPA    0,DU
         1 002441   002531 601000 1                  TNZ     s:9505
         1 002442   200015 473500                    LDP3    MBLK$,,AUTO
         1 002443   300006 235100                    LDA     6,,PR3
         1 002444   002531 601000 1                  TNZ     s:9505
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:128  

      924     9489    2         AND KQ$MBLK.DDA=0
      925     9490    3         THEN DO;  /* Note that connecting terminal stations already have     */

      926     9491                          /* their MBLK.DDA filled in so there is no need to do this */
      927     9492                          /* again.                                                  */
      928     9493    3           KQ$MBLK.MSGSIZE=KQ$STA.CNNCTSIZE;

   9493  1 002445   200027 474500                    LDP4    @KQ$STA,,AUTO
         1 002446   400015 236100                    LDQ     13,,PR4
         1 002447   777777 376007                    ANQ     -1,DL
         1 002450   300016 756100                    STQ     14,,PR3

      929     9494    3           I=KQ$STA.CNNCTSIZE;

   9494  1 002451   400015 236100                    LDQ     13,,PR4
         1 002452   777777 376007                    ANQ     -1,DL
         1 002453   200035 756100                    STQ     I,,AUTO

      930     9495    3           CALL KQD$GETR(KQ$CG,DBLK$,I) ALTRET(NODBLK);

   9495  1 002454   200035 635500                    EPPR5   I,,AUTO
         1 002455   200044 455500                    STP5    DBLK$+4,,AUTO
         1 002456   200040 636500                    EPPR6   DBLK$,,AUTO
         1 002457   200043 456500                    STP6    DBLK$+3,,AUTO
         1 002460   200007 236100                    LDQ     CG$,,AUTO
         1 002461   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002462   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002463   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002464   000000 701000 xent               TSX1    KQD$GETR
         1 002465   002635 702000 1                  TSX2    NOMBLK5

      931     9496    3           KQ$MBLK.DDA=I;

   9496  1 002466   200015 470500                    LDP0    MBLK$,,AUTO
         1 002467   200035 235100                    LDA     I,,AUTO
         1 002470   000006 755100                    STA     6,,PR0
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:129  

      932     9497    3           I=KQ$STA.CNNCTSIZE;

   9497  1 002471   200027 470500                    LDP0    @KQ$STA,,AUTO
         1 002472   000015 236100                    LDQ     13,,PR0
         1 002473   777777 376007                    ANQ     -1,DL
         1 002474   200035 756100                    STQ     I,,AUTO

      933     9498    3           IF ADDR(CNNCT$)~=ADDR(NIL) THEN
              9498                    /* don't screech if we didn't pass this parm */

   9498  1 002475   200005 236100                    LDQ     @INFO,,AUTO
         1 002476   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002477   002510 600000 1                  TZE     s:9501

      934     9499    3            PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=CNNCT$->MOVEI;

   9499  1 002500   200005 471500                    LDP1    @INFO,,AUTO
         1 002501   100000 473500                    LDP3    0,,PR1
         1 002502   200035 720100                    LXL0    I,,AUTO
         1 002503   200040 474500                    LDP4    DBLK$,,AUTO
         1 002504   040140 100540                    MLR     fill='040'O
         1 002505   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         1 002506   400006 000010                    ADSC9   6,,PR4                   cn=0,n=*X0
         1 002507   002515 710000 1                  TRA     s:9502

      935     9500    3           ELSE
      936     9501    3            PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=' ';

   9501  1 002510   200040 471500                    LDP1    DBLK$,,AUTO
         1 002511   200035 720100                    LXL0    I,,AUTO
         1 002512   040140 100400                    MLR     fill='040'O
         1 002513   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 002514   100006 000010                    ADSC9   6,,PR1                   cn=0,n=*X0

      937     9502    3           DBLK$->KQ$DBLK.STAMP=KQ$MBLK.STAMP;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:130  
   9502  1 002515   200015 471500                    LDP1    MBLK$,,AUTO
         1 002516   100001 720100                    LXL0    1,,PR1
         1 002517   200040 473500                    LDP3    DBLK$,,AUTO
         1 002520   300000 740100                    STX0    0,,PR3

      938     9503    3           CALL KQD$UNLOCK(KQ$CG,DBLK$);

   9503  1 002521   200040 631500                    EPPR1   DBLK$,,AUTO
         1 002522   200043 451500                    STP1    DBLK$+3,,AUTO
         1 002523   200007 236100                    LDQ     CG$,,AUTO
         1 002524   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002525   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002526   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002527   000000 701000 xent               TSX1    KQD$UNLOCK
         1 002530   000000 011000                    NOP     0

      939     9504    3           END;

      940     9505    2         IF ADDR(DDA)~=ADDR(NIL) THEN

   9505  1 002531   200033 236100                    LDQ     @DDA,,AUTO
         1 002532   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002533   002544 600000 1                  TZE     s:9511

      941     9506    3           DO;

      942     9507    3           KQ$MBLK.DDA=DDA;

   9507  1 002534   200033 470500                    LDP0    @DDA,,AUTO
         1 002535   200015 471500                    LDP1    MBLK$,,AUTO
         1 002536   000000 235100                    LDA     0,,PR0
         1 002537   100006 755100                    STA     6,,PR1

      943     9508    3           KQ$MBLK.MSGSIZE=DDASIZ;

   9508  1 002540   200034 471500                    LDP1    @DDASIZ,,AUTO
         1 002541   200015 473500                    LDP3    MBLK$,,AUTO
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:131  
         1 002542   100000 235100                    LDA     0,,PR1
         1 002543   300016 755100                    STA     14,,PR3

      944     9509    3           END;

      945     9510              %LOCK (G=KQ$CG.GORGOSTA$->KQ$STA1.GATE);

   9511  1 002544   200007 470500                    LDP0    CG$,,AUTO
         1 002545   000207 471500                    LDP1    135,,PR0
         1 002546   100016 633500                    EPPR3   14,,PR1
         1 002547   200042 453500                    STP3    DBLK$+2,,AUTO
         1 002550   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002551   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002552   000000 701000 xent               TSX1    HFC$LOCK
         1 002553   000000 011000                    NOP     0

      946     9513    2         KQ$CG.GORGOSTA$->KQ$STA1.MBLK$=MBLK$;

   9513  1 002554   200007 470500                    LDP0    CG$,,AUTO
         1 002555   000207 471500                    LDP1    135,,PR0
         1 002556   200015 236100                    LDQ     MBLK$,,AUTO
         1 002557   100012 756100                    STQ     10,,PR1

      947     9514    2         CALL KQW$TELLAU (KQ$CG.GORGOSTA$->KQ$STA1);

   9514  1 002560   000207 471500                    LDP1    135,,PR0
         1 002561   200042 451500                    STP1    DBLK$+2,,AUTO
         1 002562   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002563   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002564   000000 701000 xent               TSX1    KQW$TELLAU
         1 002565   000000 011000                    NOP     0

      948     9515    2         MBLK$=ADDR(NIL);

   9515  1 002566   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002567   200015 756100                    STQ     MBLK$,,AUTO

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:132  
      949     9516              %LOCK (G=KQ$CG.GATE.CG);

   9517  1 002570   200007 236100                    LDQ     CG$,,AUTO
         1 002571   000107 036003                    ADLQ    71,DU
         1 002572   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002573   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002574   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002575   000000 701000 xent               TSX1    HFC$LOCK
         1 002576   000000 011000                    NOP     0

      950     9519    2         KQ$CG.AUSENDCNT=KQ$CG.AUSENDCNT-1;

   9519  1 002577   200007 470500                    LDP0    CG$,,AUTO
         1 002600   000122 236100                    LDQ     82,,PR0
         1 002601   000777 036003                    ADLQ    511,DU
         1 002602   000122 552120                    STBQ    82,'20'O,PR0

      951     9520              %UNLOCK (G=KQ$CG.GATE.CG);

   9521  1 002603   200007 236100                    LDQ     CG$,,AUTO
         1 002604   000107 036003                    ADLQ    71,DU
         1 002605   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002606   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002607   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002610   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002611   000000 011000                    NOP     0

      952     9523    2         RETURN;

   9523  1 002612   200026 221300                    LDX1  ! COD+1,,AUTO
         1 002613   000001 702211                    TSX2  ! 1,X1

   9519  1 002614                       NOMBLK       null
      953     9524        /**/
      954     9525        /**/
      955     9526        /**/
      956     9527        /**/
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:133  
      957     9528    2   NOMBLK:;
      958     9529    2         IF REGFLG=0 THEN

   9529  1 002614   200014 235100                    LDA     REGFLG,,AUTO
         1 002615   002635 600000 1                  TZE     NOMBLK5

      959     9530    2          GOTO NOMBLK5;
      960     9531    2         I=KQMR_MBLK#;

   9531  1 002616   000001 236007                    LDQ     1,DL
         1 002617   200035 756100                    STQ     I,,AUTO

      961     9532    2         MBLK$=ADDR(KQ$STA);

   9532  1 002620   200027 236100                    LDQ     @KQ$STA,,AUTO
         1 002621   200015 756100                    STQ     MBLK$,,AUTO

      962     9533    2         CALL KQM$GETBR(KQ$CG,MBLK$,I) ALTRET(NOMBLK5);

   9533  1 002622   200035 630500                    EPPR0   I,,AUTO
         1 002623   200044 450500                    STP0    DBLK$+4,,AUTO
         1 002624   200015 631500                    EPPR1   MBLK$,,AUTO
         1 002625   200043 451500                    STP1    DBLK$+3,,AUTO
         1 002626   200007 236100                    LDQ     CG$,,AUTO
         1 002627   200042 756100                    STQ     DBLK$+2,,AUTO
         1 002630   200042 630500                    EPPR0   DBLK$+2,,AUTO
         1 002631   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002632   000000 701000 xent               TSX1    KQM$GETBR
         1 002633   002635 702000 1                  TSX2    NOMBLK5

      963     9534    2         GOTO GOTMBLK;

   9534  1 002634   002320 710000 1                  TRA     GOTMBLK

   9532  1 002635                       NOMBLK5      null
   9532  1 002635                       NODBLK       null
      964     9535        /**/
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:134  
      965     9536    2   NOMBLK5: ;
      966     9537    2   NODBLK: ;
      967     9538    2         ALTRETURN;

   9538  1 002635   200026 221300                    LDX1  ! COD+1,,AUTO
         1 002636   000000 702211                    TSX2  ! 0,X1

AUEVKEY
 Sect OctLoc
   0     000   052101 125105   126040 040040                                    *AUEV

AUEVPRIH
 Sect OctLoc
   0     002   000000 765001                                                    ....

AUEVPRIL
 Sect OctLoc
   0     003   000000 765000                                                    ....

VLP_STATION
 Sect OctLoc
   0     004   040040 040040   040040 040040   040040 040040   040040 040040
   0     010   001000 000000   000000 000000   000000 000000   000000 000000    ................

(unnamed)
 Sect OctLoc
   0     014   052107 117122   107117 040040                                    *GORGO

(unnamed)
 Sect OctLoc
   2     000   000002 006000   000002 006000   000004 006000   000002 006000    ................
   2     004   777777 757777   773777 777777   000000 000034   000020 400000    ................
   2     010   000006 006000   000000 000000   000002 006000   000003 006000    ................
   2     014   000003 006000   000003 006000   000004 006000   000003 006000    ................
   2     020   000000 000110   000020 006000   737777 777777   777777 777377    ...H............
   2     024   777777 777577   740777 777777   000000 000040   000026 006000    ........... ....
   2     030   000000 000024   000001 400000   000030 006000   000003 006000    ................
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:135  
   2     034   775777 777777                                                    ....
      968     9539        /**/
      969     9540    2   END SENDAU;
      970     9541        /**/
      971     9542    1   END KCA$TELLAU;

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:136  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F_CP6.:E05TOU  is referenced.
      No diagnostics issued in procedure KCA$TELLAU.
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:137  

 **** Variables and constants ****

  ****  Section 000 RoData KCA$TELLAU

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(8)     r     1 AUEVKEY                    2-0-0/w UBIN        r     1 AUEVPRIH
     3-0-0/w UBIN        r     1 AUEVPRIL                   4-0-0/w STRC(288)   r     1 VLP_STATION

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CODE                     30-0-0/w PTR         r     1 @CODE
    33-0-0/w PTR         r     1 @DDA                      34-0-0/w PTR         r     1 @DDASIZ
     5-0-0/w PTR         r     1 @INFO                     32-0-0/w PTR         r     1 @INFO
    27-0-0/w PTR         r     1 @KQ$STA                    3-0-0/w PTR         r     1 @PARM
    31-0-0/w PTR         r     1 @PRIO                     11-0-0/w UBIN        r     1 ACTION
     7-0-0/w PTR         r     1 CG$                       *0-0-0/w PTR         r     1 CNNCT$
    25-0-0/w UBIN        r     1 COD                       *0-0-0/w UBIN        r     1 CODE
    *0-0-0/w UBIN        r     1 CODE                      13-0-0/w PTR         r     1 DBLK$
    40-0-0/w PTR         r     1 DBLK$                     17-0-0/w UBIN        r     1 DDA
    *0-0-0/w UBIN        r     1 DDA                       *0-0-0/w UBIN        r     1 DDASIZ
    36-0-0/c CHAR(8)     r     1 DSTA                      10-0-0/w PTR         r     1 FPRG$
    16-0-0/w UBIN        r     1 I                         35-0-0/w UBIN        r     1 I
    *0-0-0/w UBIN        r     1 INFO                      *0-0-0/w UBIN        r     1 INFO
    *0-0-0/d STRC(1296)  r     1 KQ$STA                    15-0-0/w PTR         r     1 MBLK$
     6-0-0/w PTR         r     1 MYSTA$                    20-0-0/w PTR         r     1 NXT$
    *0-0-0/w UBIN        r     1 PARM                      *0-0-0/w UBIN        r     1 PRIO
    14-0-0/w UBIN        r     1 REGFLG                    24-0-0/w UBIN        r     1 SENT
    10-0-0/w PTR         r     1 STA$                      13-0-0/w UBIN        r     1 STMP
    23-0-0/w PTR         r     1 T$                        12-0-0/w UBIN        r     1 TYP

  ****  BASED and DCB variables  ****

PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:138  
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w BIT (72)    r     1 B$$BIT72                   0-0-0/d STRC(6516)  r     1 KQ$CG
     0-0-0/d STRC(216)   r     1 KQ$DBLK                    0-0-0/d STRC(576)   r     1 KQ$MBLK
     0-0-0/d STRC(1296)  r     1 KQ$STA                     0-0-0/d STRC(1296)  r     1 KQ$STA1
     0-0-0/w ACHR        r     1 MOVEI                      0-0-0/w ACHR        r     1 MOVEI
     0-0-0/d STRC(864)   r     1 NK$LDCT                    0-0-0/w UBIN(18)    r     1 UBINHALF
     0-0-0/d STRC(612)   r     1 VLP$FPRG                   0-0-0/w STRC(288)   r     1 VLP$STATION


   Procedure KCA$TELLAU requires 1439 words for executable code.
   Procedure KCA$TELLAU requires 38 words of local(AUTO) storage.

    No errors detected in file KCA$AU.:E05TSI    .
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:139  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:140  
          MINI XREF LISTING

ACTION
      7574**DCL      7575--REDEF    8119<<ASSIGN   8121<<ASSIGN   8122>>DOCASE   8204<<ASSIGN   8206<<ASSIGN
      8207>>IF       8207>>IF       8208<<ASSIGN   8211>>DOCASE
ALT
      8571**LABEL    8417--GOTO     8420--CALLALT  8424--CALLALT  8425--CALLALT  8507--CALLALT  8509--CALLALT
      8534--GOTO     8537--CALLALT
AUCON0
      8100**LABEL    8156--GOTO
AUDCON0
      8157**LABEL    8248--GOTO
AUEVKEY
      7670**DCL      8450>>ASSIGN   8454>>ASSIGN   9462>>ASSIGN   9468>>ASSIGN
AUEVPRIH
      7671**DCL      8140<>CALL     8142<>CALL
AUEVPRIL
      7672**DCL      8277<>CALL     8295<>CALL     8316<>CALL     8335<>CALL     8346<>CALL     8365<>CALL
      8407<>CALL     8430<>CALL     8462>>ASSIGN   8527<>CALL     8529<>CALL     8556<>CALL     8647<>CALL
B$$BIT72
      7553**DCL      8449<<ASSIGN   8455<<ASSIGN
CG$
      7571**DCL      6071--IMP-PTR  8064<<ASSIGN   8093>>CALL     8095>>CALL     8098>>CALL     8104>>ASSIGN
      8119>>ASSIGN   8121>>ASSIGN   8130>>IF       8135>>CALL     8138>>CALL     8180>>ASSIGN   8204>>ASSIGN
      8206>>ASSIGN   8270>>IF       8270>>IF       8294>>IF       8294>>IF       8308>>IF       8309>>IF
      8334>>IF       8375>>IF       8378>>CALL     8380>>ASSIGN   8382>>CALL     8415>>CALL     8420>>CALL
      8424>>CALL     8425>>CALL     8429>>CALL     8447>>IF       8466>>CALL     8468>>ASSIGN   8469>>ASSIGN
      8469>>ASSIGN   8472>>CALL     8501>>IF       8503>>CALL     8507>>CALL     8509>>CALL     8514>>IF
      8525>>CALL     8526>>IF       8537>>CALL     8572>>CALL     8578>>CALL     8580>>CALL     8593<<ASSIGN
      8596>>CALL     8598>>ASSIGN   8600>>CALL     8604>>ASSIGN   8664>>CALL     8670>>CALL     9432>>CALL
      9438>>IF       9446>>CALL     9450>>ASSIGN   9453>>ASSIGN   9453>>ASSIGN   9455>>CALL     9458>>CALL
      9460>>IF       9472>>CALL     9474>>ASSIGN   9475>>ASSIGN   9475>>ASSIGN   9477>>CALL     9495>>CALL
      9503>>CALL     9511>>CALL     9513>>ASSIGN   9514>>CALL     9517>>CALL     9519>>ASSIGN   9519>>ASSIGN
      9521>>CALL     9533>>CALL
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:141  
CLOCK0
      8598**LABEL    8619--GOTO
CNNCT$
      7563**DCL      8137>>ASSIGN   9498--IF       9499>>ASSIGN
COD IN PROCEDURE TBRK
      8638**DCL      8640<<ASSIGN   8647<>CALL
CODE
      7561**DCL        19--PROC     8018--ENTRY    8040--ENTRY    8067>>DOCASE   8335<>CALL     8346<>CALL
      8365<>CALL     8407<>CALL     8430<>CALL     8527<>CALL     8529<>CALL
CODE IN PROCEDURE SENDAU
      9070**DCL      8726--PROC     9434>>IF       9440>>IF       9440>>IF       9440>>IF       9479>>IF
      9486>>ASSIGN   9488>>IF       9488>>IF
COM
      8052**LABEL    8004--GOTO     8022--GOTO
DBLK$
      7577**DCL      7578--REDEF    8137>>ASSIGN   8138<>CALL     8424<>CALL     8425<>CALL     8426>>ASSIGN
      8428>>ASSIGN   8429<>CALL     8507<>CALL     8509<>CALL     8510>>ASSIGN   8524>>ASSIGN   8525<>CALL
DBLK$ IN PROCEDURE SENDAU
      9082**DCL      9495<>CALL     9499>>ASSIGN   9501>>ASSIGN   9502>>ASSIGN   9503<>CALL
DDA
      7582**DCL      8134<<ASSIGN   8135<>CALL
DDA IN PROCEDURE SENDAU
      9073**DCL      8726--PROC     9505--IF       9507>>ASSIGN
DDASIZ IN PROCEDURE SENDAU
      9074**DCL      8726--PROC     9508>>ASSIGN
DSTA IN PROCEDURE SENDAU
      9081**DCL      9435<<ASSIGN   9442<<ASSIGN   9450<<ASSIGN   9487>>ASSIGN
FETCHERR
      8139**LABEL    8135--CALLALT
FPRG$
      7573**DCL      8426<<ASSIGN   8427>>ASSIGN
GETM5
      8502**LABEL    8538--GOTO
GOTMBLK IN PROCEDURE SENDAU
      9457**LABEL    9534--GOTO
HFC$LOCK
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:142  
      1064**DCL-ENT  8045--CALL     8093--CALL     8378--CALL     8466--CALL     8476--CALL     8596--CALL
      8664--CALL     8676--CALL     8688--CALL     9432--CALL     9472--CALL     9511--CALL     9517--CALL
HFC$UNLOCK
      1064**DCL-ENT  8050--CALL     8098--CALL     8382--CALL     8472--CALL     8600--CALL     8670--CALL
      8682--CALL     8694--CALL     9446--CALL     9455--CALL     9477--CALL     9521--CALL
I
      7581**DCL      7552--IMP-SIZ  8136<<ASSIGN   8137>>ASSIGN   8137>>ASSIGN
I IN PROCEDURE SENDAU
      9080**DCL      9427--IMP-SIZ  9458<>CALL     9494<<ASSIGN   9495<>CALL     9496>>ASSIGN   9497<<ASSIGN
      9499>>ASSIGN   9499>>ASSIGN   9501>>ASSIGN   9531<<ASSIGN   9533<>CALL
INFO
      7562**DCL        19--PROC     7563--REDEF    8018--ENTRY    8040--ENTRY    8365<>CALL     8371>>ASSIGN
      8407<>CALL     8427--ASSIGN   8446--ASSIGN   8512--ASSIGN   8513--ASSIGN   8516--ASSIGN   8517--ASSIGN
      8521--ASSIGN   8522--ASSIGN   8556<>CALL
INFO IN PROCEDURE SENDAU
      9072**DCL      8726--PROC     9479<<ASSIGN   9481--IF       9482>>ASSIGN
KCO$DSCTRMGO
      7644**DCL-ENT  8190--CALL
KQ$CG
      6071**DCL      8135<>CALL     8138<>CALL     8415<>CALL     8420<>CALL     8424<>CALL     8425<>CALL
      8429<>CALL     8503<>CALL     8507<>CALL     8509<>CALL     8525<>CALL     8537<>CALL     8572<>CALL
      8578<>CALL     8580<>CALL     9458<>CALL     9495<>CALL     9503<>CALL     9533<>CALL
KQ$CG.AUCTL.AUCONDCB
      6512**DCL      8119>>ASSIGN
KQ$CG.AUCTL.AUCONTERM
      6512**DCL      8121>>ASSIGN
KQ$CG.AUCTL.AUDCONDCB
      6513**DCL      8204>>ASSIGN
KQ$CG.AUCTL.AUDCONTERM
      6512**DCL      8206>>ASSIGN
KQ$CG.AUCTL.CONMSG
      6511**DCL      8130>>IF       8270>>IF       8294>>IF       8308>>IF       8334>>IF
KQ$CG.AUCTL.DVBYTE.REREAD
      6514**DCL      6515--REDEF
KQ$CG.AUCTL.UNLAMSG
      6516**DCL      8501>>IF
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:143  
KQ$CG.AUSENDCNT
      6486**DCL      9453<<ASSIGN   9453>>ASSIGN   9519<<ASSIGN   9519>>ASSIGN
KQ$CG.AUSTA$
      6481**DCL      8270>>IF       8294>>IF       8309>>IF       8375>>IF       9438>>IF       9450>>ASSIGN
KQ$CG.DELAY.AU
      6138**DCL      8380<<ASSIGN   8598<<ASSIGN
KQ$CG.GATE.CG
      6461**DCL      8378<>CALL     8382<>CALL     8596<>CALL     8600<>CALL     9432<>CALL     9446<>CALL
      9455<>CALL     9517<>CALL     9521<>CALL
KQ$CG.GORGOSTA$
      6570**DCL      8093>>CALL     8095>>CALL     8098>>CALL     9511>>CALL     9513>>ASSIGN   9514>>CALL
KQ$CG.MSGID
      6465**DCL      8468>>ASSIGN   8469<<ASSIGN   8469>>ASSIGN   9474>>ASSIGN   9475<<ASSIGN   9475>>ASSIGN
KQ$CG.QISS
      6457**DCL      8447>>IF       8514>>IF       9460>>IF
KQ$CG.RCVR
      6445**DCL      8526>>IF
KQ$CG.STREE.GATE
      6405**DCL      8664<>CALL     8670<>CALL
KQ$CG.STREE.HEAD$
      6413**DCL      8104>>ASSIGN   8180>>ASSIGN   8604>>ASSIGN
KQ$CG.TTREE.GATE
      6366**DCL      8466<>CALL     8472<>CALL     9472<>CALL     9477<>CALL
KQ$DBLK
      6808**DCL      8137--ASSIGN   8426--ASSIGN   8510--ASSIGN   9499--ASSIGN   9501--ASSIGN
KQ$DBLK.STAMP
      6809**DCL      8428<<ASSIGN   8524<<ASSIGN   9502<<ASSIGN
KQ$MBLK.DDA
      6926**DCL      8463<<ASSIGN   8577>>IF       8578<>CALL     9488>>IF       9496<<ASSIGN   9507<<ASSIGN
KQ$MBLK.DSTA
      7010**DCL      9487<<ASSIGN
KQ$MBLK.DVE
      6959**DCL      8457<<ASSIGN
KQ$MBLK.DVE.EOMCHAR
      6963**DCL      6965--REDEF
KQ$MBLK.FC
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:144  
      6956**DCL      8464<<ASSIGN   9486<<ASSIGN
KQ$MBLK.FORCECONT
      6998**DCL      8460<<ASSIGN
KQ$MBLK.JOURNAL
      6996**DCL      8459<<ASSIGN
KQ$MBLK.JRNLD
      6953**DCL      8458<<ASSIGN
KQ$MBLK.KEY1
      6889**DCL      6891--REDEF    8449--ASSIGN   8454<<ASSIGN   8516>>ASSIGN   8522>>ASSIGN   9462<<ASSIGN
      9467<<ASSIGN
KQ$MBLK.KEY2
      6898**DCL      6916--REDEF    8450<<ASSIGN   8455--ASSIGN   8517>>ASSIGN   8521>>ASSIGN   9463<<ASSIGN
      9468<<ASSIGN
KQ$MBLK.LNK$
      6863**DCL      6865--REDEF    6871--REDEF    6875--REDEF
KQ$MBLK.MID
      7020**DCL      8449>>ASSIGN   8455>>ASSIGN
KQ$MBLK.MID.PRIMARY
      7022**DCL      8468<<ASSIGN   8512>>ASSIGN   9474<<ASSIGN   9479>>ASSIGN
KQ$MBLK.MID.XT
      7023**DCL      8470<<ASSIGN   8513>>ASSIGN   9482<<ASSIGN   9484<<ASSIGN
KQ$MBLK.MSGSIZE
      7024**DCL      8461<<ASSIGN   9493<<ASSIGN   9508<<ASSIGN
KQ$MBLK.PRIO
      6879**DCL      8462<<ASSIGN   9485<<ASSIGN
KQ$MBLK.STAMP
      6883**DCL      8428>>ASSIGN   8524>>ASSIGN   8578<>CALL     9502>>ASSIGN
KQ$MBLK.STAR
      6951**DCL      9470<<ASSIGN
KQ$MBLK.TYC
      7012**DCL      7014--REDEF
KQ$MBLK.XSP.MREQ$
      6918**DCL      6922--REDEF
KQ$STA
      7132**DCL      8089<>CALL     8124<>CALL     8126<>CALL     8128<>CALL     8140<>CALL     8142<>CALL
      8155<>CALL     8190<>CALL     8215<>CALL     8219<>CALL     8223<>CALL     8247<>CALL     8277<>CALL
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:145  
      8295<>CALL     8316<>CALL     8335<>CALL     8346<>CALL     8365<>CALL     8407<>CALL     8430<>CALL
      8479<>CALL     8527<>CALL     8529<>CALL     8556<>CALL     8618<>CALL     8647<>CALL
KQ$STA.ACTTYC
      7184**DCL      7188--REDEF
KQ$STA.BTN.FLINK$
      7166**DCL      8160>>ASSIGN   8183>>ASSIGN   8623>>ASSIGN
KQ$STA.BTN.KEY
      7168**DCL      8133--ASSIGN
KQ$STA.CG$
      7171**DCL      8064>>ASSIGN
KQ$STA.CNNCTDDA
      7269**DCL      8134>>ASSIGN
KQ$STA.CNNCTSIZE
      7208**DCL      8136>>ASSIGN
KQ$STA.DCBLNK$
      7191**DCL      7194--REDEF    7198--REDEF
KQ$STA.DSCREQW
      7307**DCL      8184>>IF       8187<<ASSIGN
KQ$STA.EVCNT
      7277**DCL      7280--REDEF    8357>>IF       8363<<ASSIGN   8363>>ASSIGN
KQ$STA.EVNT
      7243**DCL      7247--REDEF    7250--REDEF    8147>>IF       8357>>IF       8372<<ASSIGN   8608>>IF
      8653<<ASSIGN
KQ$STA.EVSC
      7188**DCL      8371<<ASSIGN   8641>>ASSIGN
KQ$STA.GATE
      7210**DCL      8045<>CALL     8050<>CALL     8093<>CALL     8098<>CALL     8476<>CALL     8676<>CALL
      8682<>CALL     8688<>CALL     8694<>CALL
KQ$STA.IDSC
      7212**DCL      8107>>IF       8130>>IF       8149>>IF       8195>>IF       8241>>IF       8312>>IF
      8612>>IF
KQ$STA.LDCT$
      7173**DCL      8107>>IF       8107>>IF       8114>>ASSIGN   8130>>IF       8194>>IF       8195>>IF
      8195>>IF       8201>>ASSIGN
KQ$STA.LOCKCNT
      7266**DCL      8113<<ASSIGN   8113>>ASSIGN   8150<<ASSIGN   8150>>ASSIGN   8200<<ASSIGN   8200>>ASSIGN
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:146  
      8242<<ASSIGN   8242>>ASSIGN   8610<<ASSIGN   8610>>ASSIGN   8613<<ASSIGN   8613>>ASSIGN
KQ$STA.MBLK$
      7177**DCL      8047>>ASSIGN   8048<<ASSIGN   8478<<ASSIGN
KQ$STA.MLH
      7400**DCL      8095<>CALL     8095--CALL
KQ$STA.OPNBLKED
      7304**DCL      7307--REDEF    8225>>IF       8228<<ASSIGN
KQ$STA.OPNREJ
      7310**DCL      7312--REDEF
KQ$STA.SUCCREAD
      7233**DCL      7237--REDEF
KQ$STA.TCOUNT
      7362**DCL      7368--REDEF
KQ$STA.TERM
      7228**DCL      8107>>IF       8184>>IF       8195>>IF       8225>>IF       8607>>IF
KQ$STA.TOLDAU
      7240**DCL      8107>>IF       8115<<ASSIGN   8202<<ASSIGN   8273>>IF       8275<<ASSIGN   8312>>IF
      8314<<ASSIGN
KQ$STA.USR#
      7263**DCL      8231<>CALL
KQ$STA.VGOT$
      7347**DCL      7351--REDEF    7355--REDEF
KQ$STA IN PROCEDURE SENDAU
      8745**DCL      8726--PROC     9532--ASSIGN
KQ$STA.ACTTYC IN PROCEDURE SENDAU
      8797**DCL      8801--REDEF
KQ$STA.BTN.KEY IN PROCEDURE SENDAU
      8781**DCL      9435>>ASSIGN   9463>>ASSIGN   9467>>ASSIGN
KQ$STA.CNNCTSIZE IN PROCEDURE SENDAU
      8821**DCL      9493>>ASSIGN   9494>>ASSIGN   9497>>ASSIGN
KQ$STA.DCBLNK$ IN PROCEDURE SENDAU
      8804**DCL      8807--REDEF    8811--REDEF
KQ$STA.EVCNT IN PROCEDURE SENDAU
      8890**DCL      8893--REDEF
KQ$STA.EVNT IN PROCEDURE SENDAU
      8856**DCL      8860--REDEF    8863--REDEF
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:147  
KQ$STA.OPNBLKED IN PROCEDURE SENDAU
      8917**DCL      8920--REDEF
KQ$STA.OPNREJ IN PROCEDURE SENDAU
      8923**DCL      8925--REDEF
KQ$STA.SUCCREAD IN PROCEDURE SENDAU
      8846**DCL      8850--REDEF
KQ$STA.TCOUNT IN PROCEDURE SENDAU
      8975**DCL      8981--REDEF
KQ$STA.VGOT$ IN PROCEDURE SENDAU
      8960**DCL      8964--REDEF    8968--REDEF
KQ$STA1 IN PROCEDURE SENDAU
      9102**DCL      9514<>CALL
KQ$STA1.ACTTYC IN PROCEDURE SENDAU
      9154**DCL      9158--REDEF
KQ$STA1.BTN.KEY IN PROCEDURE SENDAU
      9138**DCL      9450>>ASSIGN
KQ$STA1.DCBLNK$ IN PROCEDURE SENDAU
      9161**DCL      9164--REDEF    9168--REDEF
KQ$STA1.EVCNT IN PROCEDURE SENDAU
      9247**DCL      9250--REDEF
KQ$STA1.EVNT IN PROCEDURE SENDAU
      9213**DCL      9217--REDEF    9220--REDEF
KQ$STA1.GATE IN PROCEDURE SENDAU
      9180**DCL      9511<>CALL
KQ$STA1.MBLK$ IN PROCEDURE SENDAU
      9147**DCL      9513<<ASSIGN
KQ$STA1.OPNBLKED IN PROCEDURE SENDAU
      9274**DCL      9277--REDEF
KQ$STA1.OPNREJ IN PROCEDURE SENDAU
      9280**DCL      9282--REDEF
KQ$STA1.SUCCREAD IN PROCEDURE SENDAU
      9203**DCL      9207--REDEF
KQ$STA1.TCOUNT IN PROCEDURE SENDAU
      9332**DCL      9338--REDEF
KQ$STA1.VGOT$ IN PROCEDURE SENDAU
      9317**DCL      9321--REDEF    9325--REDEF
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:148  
KQC$ACTSTA
      7645**DCL-ENT  8089--CALL     8124--CALL     8215--CALL
KQC$DACTSTA
      7646**DCL-ENT  8126--CALL     8219--CALL
KQC$DISCSTA
      7647**DCL-ENT  8128--CALL     8223--CALL
KQD$DELDDA
      7648**DCL-ENT  8578--CALL
KQD$FETCHR
      7649**DCL-ENT  8135--CALL
KQD$GET
      7650**DCL-ENT  8425--CALL     8509--CALL
KQD$GETR
      7651**DCL-ENT  8424--CALL     8507--CALL     9495--CALL
KQD$UNLOCK
      7652**DCL-ENT  8138--CALL     8429--CALL     8525--CALL     9503--CALL
KQL$MERGEMLH
      7653**DCL-ENT  8095--CALL
KQM$GETBR
      7654**DCL-ENT  8420--CALL     8537--CALL     9533--CALL
KQM$GETMBLK
      7655**DCL-ENT  8415--CALL     8503--CALL     9458--CALL
KQM$RELMBLK
      7656**DCL-ENT  8572--CALL     8580--CALL
KQP$UNLOCK
      7657**DCL-ENT  8155--CALL     8247--CALL     8618--CALL
KQW$JNLD
      7659**DCL-ENT  8479--CALL
KQW$TELLAU
      7660**DCL-ENT  9514--CALL
KQ_IMBLK.DVE.EOMCHAR
      7788**DCL      7790--REDEF
KQ_IMBLK.KEY1
      7714**DCL      7716--REDEF
KQ_IMBLK.KEY2
      7723**DCL      7741--REDEF
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:149  
KQ_IMBLK.LNK$
      7688**DCL      7690--REDEF    7696--REDEF    7700--REDEF
KQ_IMBLK.TYC
      7837**DCL      7839--REDEF
KQ_IMBLK.XSP.MREQ$
      7743**DCL      7747--REDEF
MBLK$
      7580**DCL      6861--IMP-PTR  8003<<ASSIGN   8021<<ASSIGN   8047<<ASSIGN   8052>>IF       8415>>IF
      8415<>CALL     8419<<ASSIGN   8420<>CALL     8428>>ASSIGN   8446<<ASSIGN   8449>>ASSIGN   8449>>ASSIGN
      8450>>ASSIGN   8454>>ASSIGN   8455>>ASSIGN   8455>>ASSIGN   8457>>ASSIGN   8458>>ASSIGN   8459>>ASSIGN
      8460>>ASSIGN   8461>>ASSIGN   8462>>ASSIGN   8463>>ASSIGN   8464>>ASSIGN   8468>>ASSIGN   8470>>ASSIGN
      8478>>ASSIGN   8480<<ASSIGN   8502>>IF       8503<>CALL     8524>>ASSIGN   8536<<ASSIGN   8537<>CALL
      8555>>IF       8571>>IF       8572<>CALL     8576>>IF       8577>>IF       8578>>CALL     8578>>CALL
      8580<>CALL     8645>>ASSIGN   8646<<ASSIGN   8650<<ASSIGN   9457>>IF       9458<>CALL     9462>>ASSIGN
      9463>>ASSIGN   9467>>ASSIGN   9468>>ASSIGN   9470>>ASSIGN   9474>>ASSIGN   9479>>ASSIGN   9482>>ASSIGN
      9484>>ASSIGN   9485>>ASSIGN   9486>>ASSIGN   9487>>ASSIGN   9488>>IF       9493>>ASSIGN   9496>>ASSIGN
      9502>>ASSIGN   9507>>ASSIGN   9508>>ASSIGN   9513>>ASSIGN   9515<<ASSIGN   9532<<ASSIGN   9533<>CALL
MOVEI
      7552**DCL      8137<<ASSIGN   8137>>ASSIGN
MOVEI IN PROCEDURE SENDAU
      9427**DCL      9499<<ASSIGN   9499>>ASSIGN   9501<<ASSIGN
MSTALOCK IN PROCEDURE SLOCK
      8685**ENTRY    8091--CALL     8272--CALL     8311--CALL     8356--CALL     8370--CALL
MSTAUNLOCK IN PROCEDURE SLOCK
      8691**ENTRY    8100--CALL     8276--CALL     8280--CALL     8315--CALL     8319--CALL     8360--CALL
      8364--CALL     8373--CALL
MYSTA$
      7570**DCL      8042<<ASSIGN   8045>>CALL     8047>>ASSIGN   8048>>ASSIGN   8050>>CALL     8063<<ASSIGN
      8064>>ASSIGN   8089>>CALL     8095>>CALL     8273>>IF       8275>>ASSIGN   8277>>CALL     8295>>CALL
      8312>>IF       8312>>IF       8314>>ASSIGN   8316>>CALL     8335>>CALL     8346>>CALL     8357>>IF
      8357>>IF       8363>>ASSIGN   8363>>ASSIGN   8365>>CALL     8371>>ASSIGN   8372>>ASSIGN   8407>>CALL
      8419>>ASSIGN   8430>>CALL     8476>>CALL     8478>>ASSIGN   8479>>CALL     8527>>CALL     8529>>CALL
      8536>>ASSIGN   8556>>CALL     8688>>CALL     8694>>CALL
NK$LDCT.DDT$
      7472**DCL      7472--REDEF
NK$LDCT.IOQ$
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:150  
      7471**DCL      7472--REDEF
NK$LDCT.LDCTX
      7473**DCL      7473--REDEF
NK$LDCT.LKFLG.ABORTED
      7485**DCL      7486--REDEF
NK$LDCT.RESCOD
      7478**DCL      8114>>ASSIGN   8195>>IF       8201>>ASSIGN
NK$LDCT.RLCID.LDCTX
      7495**DCL      7495--REDEF    8107>>IF       8195>>IF
NK$LDCT.STA$
      7491**DCL      7492--REDEF
NK$LDCT.SYMB$
      7470**DCL      7470--REDEF    7470--REDEF    7471--REDEF
NODBLK IN PROCEDURE SENDAU
      9532**LABEL    9495--CALLALT
NOMBLK
      8532**LABEL    8503--CALLALT
NOMBLK IN PROCEDURE SENDAU
      9519**LABEL    9458--CALLALT
NOMBLK5 IN PROCEDURE SENDAU
      9532**LABEL    9530--GOTO     9533--CALLALT
NOSENT IN PROCEDURE TBRK
      8648**LABEL    8647--CALLALT
NSTBRK
      8369**LABEL    8365--CALLALT
NXT$
      7583**DCL      8183<<ASSIGN   8253>>ASSIGN
NXTSTA
      8247**LABEL    8192--GOTO
PARM
      7560**DCL        19--PROC     8018--ENTRY    8040--ENTRY    8042--ASSIGN   8063--ASSIGN   8591--ENTRY
      8593--ASSIGN
PRIO IN PROCEDURE SENDAU
      9071**DCL      8726--PROC     9485>>ASSIGN
REGFLG
      7579**DCL      8002<<ASSIGN   8020<<ASSIGN   8043<<ASSIGN   8417>>IF       8423>>IF       8506>>IF
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:151  
      8533>>IF       8594<<ASSIGN   9529>>IF
RET
      8560**LABEL    8322--GOTO     8361--GOTO     8367--GOTO     8385--GOTO     8501--GOTO     8530--GOTO
SC_CGAUERR
      7661**DCL-ENT  8555--CALL     8562--CALL
SC_CGNOMBLK
      7662**DCL-ENT  8052--CALL
SENDAU
      8726**PROC     8140--CALL     8142--CALL     8277--CALL     8295--CALL     8316--CALL     8335--CALL
      8346--CALL     8365--CALL     8407--CALL     8430--CALL     8527--CALL     8529--CALL     8556--CALL
      8647--CALL
SENDIT IN PROCEDURE SENDAU
      9446**LABEL    9443--GOTO
SENT IN PROCEDURE TBRK
      8637**DCL      8642<<ASSIGN   8648<<ASSIGN   8653>>IF
SLOCK
      8661**PROC     8103--CALL     8145--CALL     8179--CALL     8191--CALL     8239--CALL     8369--CALL
      8603--CALL     8651--CALL
SSR$RUE
      7663**DCL-ENT  8231--CALL
STA$
      7572**DCL      7573--REDEF    8104<<ASSIGN   8105>>DOWHILE  8107>>IF       8107>>IF       8107>>IF
      8107>>IF       8107>>IF       8113>>ASSIGN   8113>>ASSIGN   8114>>ASSIGN   8115>>ASSIGN   8124>>CALL
      8126>>CALL     8128>>CALL     8130>>IF       8130>>IF       8133>>ASSIGN   8134>>ASSIGN   8136>>ASSIGN
      8140>>CALL     8142>>CALL     8147>>IF       8149>>IF       8150>>ASSIGN   8150>>ASSIGN   8155>>CALL
      8160<<ASSIGN   8160>>ASSIGN   8180<<ASSIGN   8181>>DOWHILE  8183>>ASSIGN   8184>>IF       8184>>IF
      8187>>ASSIGN   8190>>CALL     8194>>IF       8195>>IF       8195>>IF       8195>>IF       8195>>IF
      8200>>ASSIGN   8200>>ASSIGN   8201>>ASSIGN   8202>>ASSIGN   8215>>CALL     8219>>CALL     8223>>CALL
      8225>>IF       8225>>IF       8228>>ASSIGN   8231>>CALL     8241>>IF       8242>>ASSIGN   8242>>ASSIGN
      8247>>CALL     8253<<ASSIGN   8510<<ASSIGN   8511>>ASSIGN   8512>>ASSIGN   8513>>ASSIGN   8516>>ASSIGN
      8517>>ASSIGN   8521>>ASSIGN   8522>>ASSIGN   8604<<ASSIGN   8605>>DOWHILE  8607>>IF       8608>>IF
      8610>>ASSIGN   8610>>ASSIGN   8612>>IF       8613>>ASSIGN   8613>>ASSIGN   8618>>CALL     8623<<ASSIGN
      8623>>ASSIGN   8641>>ASSIGN   8647>>CALL     8653>>ASSIGN   8676>>CALL     8682>>CALL
STALOCK IN PROCEDURE SLOCK
      8673**ENTRY    8106--CALL     8146--CALL     8182--CALL     8240--CALL     8606--CALL     8652--CALL
STAUNLOCK IN PROCEDURE SLOCK
PL6.E3A0      #001=KCA$TELLAU File=KCA$AU.:E05TSI                                WED 07/30/97 00:08 Page:152  
      8679**ENTRY    8116--CALL     8153--CALL     8159--CALL     8188--CALL     8213--CALL     8217--CALL
      8221--CALL     8229--CALL     8235--CALL     8245--CALL     8251--CALL     8616--CALL     8622--CALL
      8643--CALL
STMP
      7578**DCL      8133<<ASSIGN   8135<>CALL
SUNLOCK IN PROCEDURE SLOCK
      8667**ENTRY    8117--CALL     8154--CALL     8162--CALL     8189--CALL     8214--CALL     8218--CALL
      8222--CALL     8230--CALL     8236--CALL     8246--CALL     8255--CALL     8374--CALL     8617--CALL
      8625--CALL     8644--CALL
T$ IN PROCEDURE TBRK
      8636**DCL      8645<<ASSIGN   8650>>ASSIGN
TBRK
      8634**PROC     8148--CALL     8611--CALL
TYP
      7576**DCL      8114<<ASSIGN   8118>>IF       8139>>IF       8201<<ASSIGN   8203>>IF       8207>>IF
      8415<>CALL     8418<<ASSIGN   8420<>CALL     8422<<ASSIGN   8424<>CALL     8425<>CALL     8430<>CALL
      8503<>CALL     8505<<ASSIGN   8507<>CALL     8509<>CALL     8527<>CALL     8529<>CALL     8535<<ASSIGN
      8537<>CALL     8641<<ASSIGN   8647<>CALL
UBINHALF
      7551**DCL      8133>>ASSIGN
VLP$FPRG
      7514**DCL      8422--ASSIGN   8427<<ASSIGN   8427>>ASSIGN   8430--CALL
VLP$STATION
      7536**DCL      8505--ASSIGN   8511<<ASSIGN   8527--CALL     8529--CALL
VLP$STATION.MSGID#
      7546**DCL      8512<<ASSIGN
VLP$STATION.MSGIDXT
      7546**DCL      7549--REDEF    8513<<ASSIGN
VLP$STATION.MSGTYP#
      7540**DCL      8517<<ASSIGN   8522<<ASSIGN
VLP$STATION.STATION#
      7540**DCL      8516<<ASSIGN   8521<<ASSIGN
VLP_STATION
      7955**DCL      8511>>ASSIGN
VLP_STATION.MSGIDXT
      7965**DCL      7968--REDEF
