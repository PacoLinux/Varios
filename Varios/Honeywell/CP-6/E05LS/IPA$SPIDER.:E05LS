VERSION E05

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:1    
        1        1        /*M* IPA$SPIDER - Driver moduler for SPIDER.                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=8,IND=2,THI=2,ENU=2,CSU=2,DTI=4,DCI=4,ECU=4,AND */
        8        8        IPA$SPIDER: PROC MAIN;
        9        9        %INCLUDE B_ERRORS_C;
       10     1136        %INCLUDE B_SEGIDS_C;
       11     1675        %INCLUDE B$OBJECT_C;
       12     5105        %INCLUDE B$P;
       13     5189        %INCLUDE B$USER;
       14     5405        %INCLUDE SS_SCHED_C;
       15     5638        %INCLUDE CP_6;
       16     5719        %INCLUDE CP_6_SUBS;
       17     6259        %INCLUDE FM$FIT;
       18     6480        %INCLUDE IP_PERR_C;
       19     6508        %INCLUDE IPS_SUBS_C;
       20     6545        %INCLUDE MM_DATA_R;
       21     7065        %INCLUDE B$JIT;
       22     7355        %INCLUDE XU_MACRO_C;
       23    10461        %INCLUDE XU_SUBS_C;
       24    10553        /**/
       25    10554        /* STATIC DATA */
       26    10555    1   DCL 1 FITBUF STATIC DALIGNED,
       27    10556    1         2 WORK(0:1023) UBIN WORD;
       28    10557    1   DCL INBUF(0:79) CHAR(1) STATIC UNAL;
       29    10558    1   DCL 1 HEADBUF STATIC DALIGNED,
       30    10559    1         2 * CHAR(160);
       31    10560    1   DCL PARSE_WORK(0:WORK_SIZE) UBIN STATIC;
       32    10561    1   DCL 1 STLVEC STATIC DALIGNED,
       33    10562    1         2 * UBIN WORD,
       34    10563    1         2 PNO UBIN WORD;
       35    10564    1   DCL 1 PCNTRL_INIT STATIC,
       36    10565    1         2 CMD# UBIN WORD INIT(0),
       37    10566    1         2 PNAME$ PTR INIT(ADDR(NIL)),
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:2    
       38    10567    1         2 PACCT$ PTR INIT(ADDR(IPA_SYSACCT)),
       39    10568    1         2 PTYPE UBIN HALF UNAL INIT(0),
       40    10569    1         2 PERM BIT(1) UNAL INIT('0'B),
       41    10570    1         2 LIST_SYS BIT(1) UNAL INIT('0'B),
       42    10571    1         2 LIST_AUTO BIT(1) UNAL INIT('0'B),
       43    10572    1         2 * UBIN(6) UNAL INIT(0),
       44    10573    1         2 * UBIN BYTE UNAL INIT(0),
       45    10574    1         2 FID$ PTR INIT(ADDR(NIL)),
       46    10575    1         2 MODTIME UBIN WORD INIT(0),
       47    10576    1         2 PNUM UBIN HALF UNAL INIT(0),
       48    10577    1         2 * UBIN(18) UNAL INIT(0),
       49    10578    1         2 PFLGS BIT(36) UNAL INIT('0'B);
       50    10579    1   DCL 1 HEAD_KEY STATIC,
       51    10580    1         2 S UBIN(9) UNAL INIT(4),
       52    10581    1         2 T CHAR(4) UNAL INIT('HEAD');
       53    10582    1   DCL T_CRLF(0:1) CHAR(1) STATIC UNAL INIT(BITASC('015'O),BITASC('012'O));
       54    10583    1   DCL T_PROMPT CHAR(1) STATIC UNAL INIT('>');
       55    10584    1   DCL 1 JITERR STATIC,
       56    10585    1         2 FCG BIT(12) UNAL,
       57    10586    1         2 MID BIT(6) UNAL,
       58    10587    1         2 M BIT(1) UNAL,
       59    10588    1         2 CODE UBIN(14) UNAL,
       60    10589    1         2 SEV UBIN(3) UNAL;
       61    10590    1   DCL 1 JITERR_INIT CONSTANT,
       62    10591    1         2 FCG BIT(12) UNAL INIT('1120'O),
       63    10592    1         2 MID BIT(6) UNAL INIT('01'O),
       64    10593    1         2 M BIT(1) UNAL INIT('0'B),
       65    10594    1         2 CODE UBIN(14) UNAL INIT(0),
       66    10595    1         2 SEV UBIN(3) UNAL INIT(0);
       67    10596    1   DCL 1 ERRPOS STATIC,
       68    10597    1         2 COUNT UBIN(9) UNAL INIT(2),
       69    10598    1         2 TEXT CHAR(2) UNAL INIT(' '),
       70    10599    1         2 TX(0:1) REDEF TEXT CHAR(1) UNAL;
       71    10600    1   DCL PCL_CMD CHAR(120) STATIC DALIGNED;
       72    10601    1   DCL 1 TXTC_CMD REDEF PCL_CMD,
       73    10602    1         2 COUNT UBIN BYTE UNAL,
       74    10603    1         2 TEXT CHAR(119) UNAL;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:3    
       75    10604    1   DCL FID_ASN UBIN(9) STATIC;
       76    10605    1   DCL FIT$ PTR STATIC INIT(ADDR(FITBUF));
       77    10606    1   DCL SI$ PTR STATIC;
       78    10607        /* GLOBAL (SYMDEF) DATA */
       79    10608    1   DCL IPA_RESTART REMEMBER STATIC SYMDEF;
       80    10609    1   DCL ERRMSGBUF CHAR(120) STATIC SYMDEF DALIGNED;
       81    10610    1   DCL BUF$ PTR STATIC SYMDEF;
       82    10611    1   DCL WSPTD$ PTR STATIC SYMDEF;
       83    10612    1   DCL ROSEG$ PTR STATIC SYMDEF;
       84    10613    1   DCL PGTBL$ PTR STATIC SYMDEF;
       85    10614    1   DCL EI$ PTR STATIC SYMDEF;
       86    10615    1   DCL HEAD$ PTR STATIC SYMDEF INIT(ADDR(HEADBUF));
       87    10616    1   DCL P$ PTR STATIC SYMDEF;
       88    10617    1   DCL LOOKUP$ PTR STATIC SYMDEF;
       89    10618    1   DCL USRT$ PTR STATIC SYMDEF;
       90    10619    1   DCL NPROCS SBIN STATIC SYMDEF;
       91    10620    1   DCL MAXPROCS SBIN STATIC SYMDEF;
       92    10621    1   DCL AUTO_START SBIN STATIC SYMDEF;
       93    10622    1   DCL LAST_AUTO SBIN STATIC SYMDEF;
       94    10623    1   DCL USED_AUTO SBIN STATIC SYMDEF;
       95    10624    1   DCL MAX_LOOKUP SBIN STATIC SYMDEF;
       96    10625    1   DCL MUAIS SBIN STATIC SYMDEF;
       97    10626    1   DCL NSCPU SBIN STATIC SYMDEF;
       98    10627    1   DCL SCPUWSPTD(0:7) SBIN STATIC SYMDEF;
       99    10628    1   DCL IPA_SYSACCT CHAR(8) STATIC SYMDEF INIT(':SYS');
      100    10629    1   DCL TPTR$$ PTR CONSTANT INIT(ADDR(TPTR$));
      101    10630    1   DCL TPTR$ PTR STATIC;
      102    10631    1   DCL PPUT_DESC DSCR STATIC SYMDEF;
      103    10632    1   DCL PPUT$ PTR STATIC SYMDEF INIT(ADDR(NIL));
      104    10633    1   DCL 1 PPUT_REDEF REDEF PPUT$,
      105    10634    1         2 *      BIT(24),
      106    10635    1         2 SID    BIT(12);
      107    10636        /* AUTO */
      108    10637    1   DCL I SBIN;
      109    10638    1   DCL J SBIN;
      110    10639    1   DCL PP SBIN;
      111    10640    1   DCL VP SBIN;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:4    
      112    10641    1   DCL PPUT_OFFSET SBIN;                   /* Offset from begining of WSQ        */
      113    10642    1   DCL INPUT_SIZE SBIN;
      114    10643    1   DCL NODE_TYPE SBIN;
      115    10644    1   DCL PNUM SBIN WORD;
      116    10645    1   DCL PTYPE SBIN WORD;
      117    10646    1   DCL PFLGS BIT(36);
      118    10647    1   DCL PROC_SLOT SBIN;
      119    10648    1   DCL PACCT CHAR(8);
      120    10649    1   DCL BLK$ PTR;
      121    10650    1   DCL BLK2$ PTR;
      122    10651    1   DCL TEXT$ PTR;
      123    10652    1   DCL U$ PTR;
      124    10653    1   DCL ATNUM CHAR(2) UNAL;
      125    10654    1   DCL CH_NUM(0:1) REDEF ATNUM CHAR(1) UNAL;
      126    10655    1   DCL FROM_FID CHAR(40);
      127    10656    1   DCL TO_FID CHAR(40);
      128    10657    1   DCL 1 PCNTRL,
      129    10658    1         2 CMD# UBIN WORD,
      130    10659    1         2 PNAME$ PTR,
      131    10660    1         2 PACCT$ PTR,
      132    10661    1         2 PTYPE UBIN HALF UNAL,
      133    10662    1         2 PERM BIT(1) UNAL,
      134    10663    1         2 LIST_SYS BIT(1) UNAL,
      135    10664    1         2 LIST_AUTO BIT(1) UNAL,
      136    10665    1         2 * UBIN(6) UNAL,
      137    10666    1         2 * UBIN BYTE UNAL,
      138    10667    1         2 FID$ PTR,
      139    10668    1         2 MODTIME UBIN WORD,
      140    10669    1         2 PNUM UBIN HALF UNAL,
      141    10670    1         2 * UBIN(18) UNAL,
      142    10671    1         2 PFLGS BIT(36) UNAL;
      143    10672        /* BASED */
      144    10673    1   DCL 1 B$TEXTC BASED ALIGNED,
      145    10674    1         2 COUNT UBIN(9) UNAL,
      146    10675    1         2 TEXT CHAR(B$TEXTC.COUNT) UNAL;
      147    10676    1   DCL B$CHAR8 CHAR(8) UNAL BASED;
      148    10677    1   DCL B$BIT BIT(1) BASED ALIGNED;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:5    
      149    10678    1   DCL 1 B$PTR BASED ALIGNED,
      150    10679    1         2 * BIT(24),
      151    10680    1         2 SID BIT(12);
      152    10681        /* SYMREF */
      153    10682    1   DCL B$JIT$ PTR SYMREF;
      154    10683    1   DCL B$IS$ PTR SYMREF;
      155    10684    1   DCL B$SPCL3$ PTR SYMREF;
      156    10685    1   DCL B$USRT$ PTR SYMREF;
      157    10686    1   DCL B_MUAIS SBIN SYMREF;
      158    10687    1   DCL 1 B_VERSION SYMREF,
      159    10688    1         2  L#    UBIN(9) UNAL,
      160    10689    1         2  TXT   CHAR(B_VERSION.L#);
      161    10690    1   DCL IP_WSQ0PT BIT(1) ALIGNED STATIC SYMDEF;
      162    10691    1   DCL HW_WSQ0PT BIT(1) ALIGNED SYMREF;
      163    10692    1   DCL IP_PTB_UNITS SBIN WORD ALIGNED STATIC SYMDEF;/* SBIN makes better code    */
      164    10693    1   DCL HW_PTB_UNITS SBIN WORD ALIGNED SYMREF;
      165    10694    1   DCL S_NSCPU SBIN SYMREF;
      166    10695    1   DCL IT_SCPUWSPTD(0:3) SBIN SYMREF;
      167    10696    1   DCL SPIDER_CMD SBIN SYMREF;
      168    10697        /* DCB */
      169    10698    1   DCL M$SI DCB;
      170    10699    1   DCL M$LO DCB;
      171    10700    1   DCL M$EI DCB;
      172    10701        /* EXTERNAL ROUTINES */
      173    10702    1   DCL IPC$ADD_SPCL ENTRY(3) ALTRET;
      174    10703    1   DCL IPC$DEL_SPCL ENTRY(3) ALTRET;
      175    10704    1   DCL IPC$ADD_LIB ENTRY(3) ALTRET;
      176    10705    1   DCL IPD$MON_VALUE ENTRY(2);
      177    10706    1   DCL IPD$MON_STORE ENTRY(2);
      178    10707    1   DCL IPD$SETSEG ENTRY(2);
      179    10708    1   DCL IPD$FREE_PROC ENTRY(2) ALTRET;
      180    10709    1   DCL IPD$GET_SLOT ENTRY(1) ALTRET;
      181    10710    1   DCL IPD$BREAK ENTRY ASYNC;
      182    10711    1   DCL IPE$LIST1_HDR ENTRY;
      183    10712    1   DCL IPE$LIST1_INFO ENTRY(1);
      184    10713    1   DCL IPE$LIST2_HDR ENTRY;
      185    10714    1   DCL IPE$LIST2_INFO ENTRY(1);
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:6    
      186    10715    1   DCL IPE$HELP ENTRY;
      187    10716    1   DCL XUR$INIT ENTRY(3) ALTRET;
      188    10717    1   DCL XUR$GETCMD ENTRY(6) ALTRET;
      189    10718    1   DCL XUR$ERRMSG ENTRY (7) ALTRET;
      190    10719        /**/
      191    10720        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:7    
      192    10721        /**/
      193    10722        /* MACROS */
      194    10723        /**/
      195    10724        %MACRO TXTSTR(NAME=TXTSTR,TEXT=' ');
      196    10725        DCL NAME CHAR(0) STATIC INIT(TEXT);
      197    10726        %MEND;
      198    10727        /**/
      199    10728        %MACRO TEXTC(NAME=TEXTC,STRING=' ');
      200    10729        DCL 1 NAME STATIC SYMDEF,
      201    10730              2 COUNT UBIN(9) UNAL INIT(SIZEC(STRING)),
      202    10731              2 TEXT CHAR(0) UNAL INIT(STRING);
      203    10732        %MEND;
      204    10733        /**/
      205    10734        %MACRO PRINT(STR=NIL);
      206    10735                WRITE_LO.BUF_ = VECTOR(STR);
      207    10736                CALL M$WRITE(WRITE_LO);
      208    10737        %MEND;
      209    10738        /**/
      210    10739        /* MACRO INVOCATIONS */
      211    10740                %B$HEAD;
      212    10940                %RU_FLAVORS;
      213    10946                %CODE04;
      214    10954                %F$DCB;
      215    11011                %FM$FIT;
      216    11014                %PARSE$OUT;
      217    11059                %PARSE$SYM;
      218    11097                %XUR_INIT (SYNTAX=YES, GOODCMD=YES, COMMANDS=YES);
      219    11196        /**/
      220    11197        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:8    
      221    11198        /**/
      222    11199        /* %SUBs */
      223    11200                %SUB B$HEAD=HEAD$->B$HEAD;
      224    11201                %SUB B$P=P$->B$P;
      225    11202                %SUB B$LOOKUP=LOOKUP$->B$LOOKUP;
      226    11203                %SUB FM$FIT=FIT$->FM$FIT;
      227    11204                %SUB MM$PPUT = PPUT$->MM$PPUT;
      228    11205        /* TEXT STRINGS */
      229    11206                %TEXTC(NAME=TC_FREE,STRING=':FREE');
      230    11211    1   DCL 1 T_HELLO STATIC SYMDEF,
      231    11212    1         2 COUNT UBIN(9) UNAL,
      232    11213    1         2 TEXT  CHAR(13) UNAL;
      233    11214                %TXTSTR(NAME=T_COPY,
      234    11215                TEXT='COPY ');
      235    11218                %TXTSTR(NAME=T_OVER,
      236    11219                TEXT='OVER ');
      237    11222                %TXTSTR(NAME=T_SYSPROCS,
      238    11223                TEXT='System Processors:');
      239    11226                %TXTSTR(NAME=T_AUTOPROCS,
      240    11227                TEXT='Automatically Shared Run Units:');
      241    11230        /**/
      242    11231        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:9    
      243    11232        /**/
      244    11233                %FPT_READ(FPTN=READ_SI,
      245    11234                DCB=M$SI,
      246    11235                BUF=INBUF);
      247    11274                %FPT_WRITE(FPTN=WRITE_LO,
      248    11275                DCB=M$LO);
      249    11306                %FPT_ERRMSG(CODE=JITERR,
      250    11307                INCLCODE=NO,
      251    11308                OUTDCB1=M$LO,
      252    11309                FIELD1=ERRPOS,
      253    11310                DCB=M$EI,
      254    11311                SUBMESS=YES,
      255    11312                BUF=ERRMSGBUF);
      256    11339                %FPT_OPEN(FPTN=OPEN_EI,
      257    11340                NAME=RU_NAME,
      258    11341                ACCT=RU_ACCT,
      259    11342                PASS=RU_PASS,
      260    11343                SN=RU_SN,
      261    11344                DCB=M$EI,
      262    11345                ASN=FILE,
      263    11346                FUN=IN,
      264    11347                ACS=DIRECT,
      265    11348                ORG=KEYED,
      266    11349                FPARAM=FITBUF,
      267    11350                SCRUB=YES);
      268    11459                %VLP_NAME(FPTN=RU_NAME);
      269    11486                %VLP_ACCT(FPTN=RU_ACCT);
      270    11499                %VLP_PASS(FPTN=RU_PASS);
      271    11512                %VLP_SN(FPTN=RU_SN);
      272    11525                %FPT_FID(NAME=RU_NAME,
      273    11526                ACCT=RU_ACCT,
      274    11527                PASS=RU_PASS,
      275    11528                RES=OPEN_EI.V.RES#,
      276    11529                SN=RU_SN,
      277    11530                ASN=FID_ASN,
      278    11531                RESULTS=VLR_FID,
      279    11532                SNAME=YES,
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:10   
      280    11533                SACCT=YES,
      281    11534                SPASS=YES,
      282    11535                SSN=YES);
      283    11558                %VLR_FID;
      284    11577                %FPT_UNFID(NAME=RU_NAME,
      285    11578                ACCT=RU_ACCT,
      286    11579                PASS=RU_PASS,
      287    11580                SN=RU_SN,
      288    11581                ASN=FID_ASN);
      289    11599                %FPT_LINK(NAME=PCL_NAME,
      290    11600                ACCT=SYSACCT,
      291    11601                CMD=PCL_CMD);
      292    11619                %VLP_NAME(FPTN=PCL_NAME,
      293    11620                NAME='PCL');
      294    11647                %VLP_ACCT(FPTN=SYSACCT,
      295    11648                ACCT=':SYS');
      296    11661        %VLP_SN (FPTN=SYSSN,
      297    11662                 SN='SYS');
      298    11675                %FPT_READ(FPTN=READ_HEAD,
      299    11676                KEY=HEAD_KEY,
      300    11677                DCB=M$EI,
      301    11678                KEYS=YES,
      302    11679                BUF=HEADBUF);
      303    11718                %FPT_CLOSE(FPTN=CLOSE_EI,
      304    11719                DCB=M$EI,
      305    11720                DISP=SAVE);
      306    11762                %FPT_CLOSE(FPTN=CLOSE_DEL,
      307    11763                DCB=M$EI,
      308    11764                DISP=RELEASE);
      309    11806                %FPT_SAD(FPTN=SEE_MONITOR,
      310    11807                MONSID=%ISSID,
      311    11808                USERSID=%SPCL1SID);
      312    11823                %FPT_SAD(FPTN=SEE_TIGRDATA,
      313    11824                MONSID=%TIGRSID,
      314    11825                USERSID=%SPCL2SID);
      315    11840                %FPT_SAD(FPTN=SEE_PPUT,
      316    11841                MONSID=%PPUTSID,
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:11   
      317    11842                USERSID=%SPCL3SID);
      318    11857                %FPT_STLPP(RESULTS=STLVEC);
      319    11870                %FPT_PRIV(FPTN=PPRIV_LOOK,
      320    11871                PPRIV=YES,
      321    11872                PRIV=%PPR_SPIDERD#);
      322    11887                %FPT_PRIV(FPTN=PPRIV_CHNG,
      323    11888                PPRIV=YES,
      324    11889                PRIV=%PPR_SPIDERC#);
      325    11904                %FPT_INT(UENTRY=IPD$BREAK);
      326    11918        /**/
      327    11919        %FPT_CVM (FPTN=PPUT_CVM);
      328    11935        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:12   
      329    11936        /*******************************************************************/
      330    11937        /*                                                                 */
      331    11938        /*                      S P I D E R                                */
      332    11939        /*                                                                 */
      333    11940        /*******************************************************************/
      334    11941        /**/
      335    11942    1           JITERR = JITERR_INIT;
      336    11943    1           T_HELLO.COUNT =              13;/* Max number of chars in greeting    */
      337    11944    1           CALL CONCAT(T_HELLO.TEXT,'SPIDER ',SUBSTR(B_VERSION.TXT,0,B_VERSION.L#));
      338    11945                %PRINT(STR=T_HELLO.TEXT);
      339    11949        /* Get visibility for various pieces of the monitor */
      340    11950    1           CALL M$SAD(SEE_MONITOR) ALTRET(TARANTULA);
      341    11951    1           CALL M$SAD(SEE_TIGRDATA) ALTRET(TARANTULA);
      342    11952    1           CALL M$SAD(SEE_PPUT) ALTRET(TARANTULA);
      343    11953        /* Make CVM PPUT into the IS, then point PPUT$ there */
      344    11954    1           PPUT_REDEF.SID = %SPCL3SID;     /* Init pointer to PPUT window        */
      345    11955    1           PPUT_DESC = PTRDSCR(PPUT$);     /* Put (real) PPUT desc in PPUT_DESC  */
      346    11956    1           PPUT_OFFSET = B$JIT.DDLL;
      347    11957    1           VP = PPUT_OFFSET - %ISEGLO;
      348    11958    2           DO I = DBASE(PPUT_DESC) TO DBASE(PPUT_DESC) + DBOUND(PPUT_DESC) BY 4096;
      349    11959    2             PP = I/4096;
      350    11960    2             PPUT_CVM.V.PPNO# = PP;
      351    11961    2             PPUT_CVM.V.VPNO# = VP;
      352    11962    2             PPUT_CVM.V.PHYSICAL#='0'B;    /* PPNO is WSQ0 relative              */
      353    11963    2             CALL M$CVM (PPUT_CVM);
      354    11964    2             VP = VP + 1;
      355    11965    2           END;
      356    11966    1           PPUT$ = PINCRW (B$IS$, (PPUT_OFFSET-%ISEGLO)*1024);
      357    11967        /* Pick up some monitor values */
      358    11968    1           CALL IPD$MON_VALUE(HW_WSQ0PT, IP_WSQ0PT);
      359    11969    1           CALL IPD$MON_VALUE(HW_PTB_UNITS, IP_PTB_UNITS);
      360    11970    1           CALL IPD$MON_VALUE(P_NPROCS,NPROCS);
      361    11971    1           CALL IPD$MON_VALUE(P_MAXPROCS,MAXPROCS);
      362    11972    1           CALL IPD$MON_VALUE(P_AUTO_START,AUTO_START);
      363    11973    1           CALL IPD$MON_VALUE(P_LAST_AUTO,LAST_AUTO);
      364    11974    1           CALL IPD$MON_VALUE(P_USED_AUTO,USED_AUTO);
      365    11975    1           CALL IPD$MON_VALUE(S_NSCPU,NSCPU);
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:13   
      366    11976    1           CALL IPD$MON_VALUE(P_MAX_LOOKUP,MAX_LOOKUP);
      367    11977    1           CALL IPD$MON_VALUE(B_MUAIS,MUAIS);
      368    11978    2           DO I = 0 TO NSCPU;
      369    11979    2             CALL IPD$MON_VALUE(IT_SCPUWSPTD(I),SCPUWSPTD(I));
      370    11980    2           END;
      371    11981    1           CALL IPD$MON_VALUE(B$P$,P$);
      372    11982    1           CALL IPD$SETSEG(P$,%SPCL2SID);
      373    11983    1           CALL IPD$MON_VALUE(B$LOOKUP$,LOOKUP$);
      374    11984    1           CALL IPD$SETSEG(LOOKUP$,%SPCL2SID);
      375    11985    1           CALL IPD$MON_VALUE(B$USRT$,USRT$);
      376    11986    1           CALL IPD$SETSEG(USRT$,%SPCL2SID);
      377    11987        /* Initialize some SPIDER global pointers */
      378    11988    1           BUF$ = PINCRW(B$IS$,VP_BUF*1024);
      379    11989    1           WSPTD$ = PINCRW(B$IS$,VP_WSPTD*1024);
      380    11990    1           ROSEG$ = PINCRW(B$IS$,VP_ROSEG*1024);
      381    11991    1           PGTBL$ = PINCRW(B$IS$,VP_PGTBL*1024);
      382    11992    1           EI$ = DCBADDR(DCBNUM(M$EI));
      383    11993    1           SI$ = DCBADDR(DCBNUM(M$SI));
      384    11994    1           REMEMBER READ_CMD IN IPA_RESTART;
      385    11995    1           CALL M$INT(FPT_INT) ALTRET(TARANTULA);
      386    11996    1           CALL XUR$INIT (XUR_INIT);
      387    11997        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:14   
      388    11998        /**/
      389    11999        /* Enter the command-reading loop */
      390    12000        /**/
      391    12001    1   READ_CMD:
      392    12002    2           DO WHILE (%TRUE);
      393    12003    2             JITERR = JITERR_INIT;
      394    12004    2             CALL XUR$GETCMD (SPIDER_CMD, BLK$, VECTOR(T_PROMPT)) ALTRET (PARSE_ERR);
      395    12005    2             CALL BUILD_PCNTRL;
      396    12006        /* See if the user is authorized for this command */
      397    12007    2             IF PCNTRL.CMD# <= I_ICMD
      398    12008    2               THEN CALL M$SPRIV(PPRIV_CHNG) ALTRET(NEED_PRIV);
      399    12009    2               ELSE IF PCNTRL.CMD# = I_LCMD
      400    12010    3                 THEN DO;                  /* #31.24                             */
      401    12011    3                     CALL M$SPRIV(PPRIV_LOOK) ALTRET(TRY_CHNG); /* #31.24        */
      402    12012    3                     GOTO OK_2_LOOK;
      403    12013    3   TRY_CHNG:         CALL M$SPRIV(PPRIV_CHNG) ALTRET(NEED_PRIV); /* #31.24       */
      404    12014    3   OK_2_LOOK:      END;
      405    12015        /* Find the processor number for PNAME if there is one, and if     */
      406    12016        /* a FID was specified in this command, open M$EI to it, get the   */
      407    12017        /* run unit's modification date, and read its HEAD record.         */
      408    12018    2             IF PCNTRL.PNAME$ ~= ADDR(NIL) THEN
      409    12019    3                 DO;
      410    12020    3                   CALL FIND_PROC(PCNTRL.PNAME$,PCNTRL.PACCT$,PNUM,PTYPE)
      411    12021    3                     ALTRET(NOT_THERE);
      412    12022    3                   PCNTRL.PNUM = PNUM;
      413    12023    3                   IF (PCNTRL.PTYPE = 0) OR (PCNTRL.CMD# = I_RCMD)
      414    12024    3                     THEN PCNTRL.PTYPE = PTYPE;
      415    12025    3                 END;
      416    12026    2   NOT_THERE:
      417    12027    2             CALL GET_PFLGS(PCNTRL.PTYPE,PFLGS);
      418    12028    2             PCNTRL.PFLGS = PFLGS;
      419    12029    2             IF PCNTRL.FID$ ~= ADDR(NIL) THEN
      420    12030    3                 DO;
      421    12031    3                   CALL OPEN_FID(PCNTRL.FID$) ALTRET(BLACK_WIDOW);
      422    12032    3                   IF DCBADDR(DCBNUM(M$EI))->F$DCB.ORG# ~= %KEYED#
      423    12033    3                     THEN
      424    12034    3                     GOTO NO_HEAD;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:15   
      425    12035    3                   CALL GET_MODTIME(PCNTRL.MODTIME) ALTRET(ABORT);
      426    12036    3                   CALL M$READ(READ_HEAD) ALTRET(NO_HEAD);
      427    12037    3                   IF (DCBADDR(DCBNUM(M$EI))->F$DCB.ARS# < SIZEC(B$HEAD))
      428    12038    4                     THEN DO;
      429    12039        /*E*    ERROR: IPA-E$IP_OLDRU-2
      430    12040               MESSAGE: The head record size is invald for this version.
      431    12041                MESSAGE1: The head record size for this run unit does not
      432    12042                            match the head record size for the current running
      433    12043                            system.
      434    12044              */
      435    12045    4                         JITERR.CODE = E$IP_OLDRU;
      436    12046    4                         GOTO BLACK_WIDOW;
      437    12047    4                       END;
      438    12048
      439    12049    3                   IF B$HEAD.FLAVOR ~= %HOST_RU
      440    12050    4                     THEN DO;
      441    12051        /*E*    ERROR: IPA-E$IP_BADFLAVOR-2
      442    12052                MESSAGE: This run unit is not a host run unit.
      443    12053        */
      444    12054    4                         JITERR.CODE = E$IP_BADFLAVOR;
      445    12055    4                         GOTO BLACK_WIDOW;
      446    12056    4                       END;
      447    12057
      448    12058    3                   IF ((PCNTRL.PTYPE >= I_CP) AND (PCNTRL.PTYPE <= I_ASL)) AND
      449    12059    3                     ((B$HEAD.RDATA > 0) OR (B$HEAD.ROSIZE > 0) OR B$HEAD.OVRL)
      450    12060    4                     THEN DO;
      451    12061        /*E*    ERROR:  IPA-E$IP_BADSSP-2
      452    12062                MESSAGE: %FN - Invalid run unit for special shared processor.
      453    12063                MESSAGE1: Special shared processors may not have data or
      454    12064                        a read-only segment. Change your LINK parameters.  */
      455    12065    4                         JITERR.CODE = E$IP_BADSSP;
      456    12066    4                         GOTO BLACK_WIDOW;
      457    12067    4                       END;
      458    12068    3                   IF ((PCNTRL.PTYPE = I_ASL) AND NOT B$HEAD.ASL) OR
      459    12069    3                     ((PCNTRL.PTYPE = I_LIB) AND NOT B$HEAD.LIB)
      460    12070    4                     THEN DO;
      461    12071        /*E*    ERROR:  IPA-E$IP_MISMATCH-2
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:16   
      462    12072                MESSAGE: %FN - Run unit type does not match intended processor type.
      463    12073        */
      464    12074    4                         JITERR.CODE = E$IP_MISMATCH;
      465    12075    4                         GOTO BLACK_WIDOW;
      466    12076    4                       END;
      467    12077    3                 END;
      468    12078        /* Finally, process the command... */
      469    12079    2             PNUM = PCNTRL.PNUM;
      470    12080    3             DO CASE(PCNTRL.CMD#);
      471    12081    3               CASE(I_DCMD);
      472    12082    3                 CALL DEL_CMD('1'B) ALTRET(BLACK_WIDOW); /* DELETE               */
      473    12083    3               CASE(I_RCMD);
      474    12084    3                 CALL REPL_CMD ALTRET(BLACK_WIDOW); /* REPLACE                   */
      475    12085    3               CASE(I_ICMD);
      476    12086    3                 CALL INSRT_CMD(PROC_SLOT) ALTRET(BLACK_WIDOW); /* INSERT        */
      477    12087    3               CASE(I_LCMD);
      478    12088    3                 CALL LIST_CMD ALTRET(BLACK_WIDOW); /* LIST                      */
      479    12089    3               CASE (I_NULL);              /* NULL COMMAND                       */
      480    12090
      481    12091    3               CASE(ELSE);
      482    12092    3                 CALL M$ERR;
      483    12093    3             END;
      484    12094    2   BLACK_WIDOW:
      485    12095    2             IF JITERR.CODE ~= 0 THEN
      486    12096    3                 DO;
      487    12097    3                   IF PCNTRL.PNAME$ ~= ADDR(NIL)
      488    12098    3                     THEN FPT_ERRMSG.FIELD2_ = VECTOR(PCNTRL.PNAME$->B$TEXTC);
      489    12099    3                     ELSE FPT_ERRMSG.FIELD2_ = VECTOR(NIL);
      490    12100    3                   CALL M$ERRMSG(FPT_ERRMSG) ALTRET(LOOP_END);
      491    12101    3                 END;
      492    12102    2             GOTO LOOP_END;
      493    12103        /**/
      494    12104    2   NO_HEAD:  ;
      495    12105        /*E*    ERROR:  IPA-E$IP_BADRU-2
      496    12106                MESSAGE: %FN - Bad run unit.
      497    12107                MESSAGE1: The file you specified was not a run unit.       */
      498    12108    2             JITERR.CODE = E$IP_BADRU;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:17   
      499    12109    2             GOTO BLACK_WIDOW;
      500    12110        /**/
      501    12111    2   NEED_PRIV:
      502    12112        /*E*    ERROR:  IPA-E$IP_NOTAUTH-2
      503    12113                MESSAGE: You are not authorized to use that SPIDER command. */
      504    12114    2             JITERR.CODE = E$IP_NOTAUTH;
      505    12115    2             GOTO BLACK_WIDOW;
      506    12116        /**/
      507    12117    2   PARSE_ERR:
      508    12118    2             CALL XUR$ERRMSG (BLK$);
      509    12119    2             CALL M$EXIT;
      510    12120    2   LOOP_END:
      511    12121    2             CALL M$CLOSE(CLOSE_EI) ALTRET(CONT);
      512    12122    2   CONT:
      513    12123    2           END;                  /* End of the (infinite) command reading loop   */
      514    12124        /**/
      515    12125        /**/
      516    12126    1   TARANTULA:
      517    12127    1           JITERR = B$JIT.ERR;
      518    12128    1   RECLUSE:
      519    12129    1           CALL M$ERRMSG(FPT_ERRMSG) ALTRET(ABORT);
      520    12130    1   ABORT:  CALL M$XXX;
      521    12131        /**/
      522    12132        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:18   
      523    12133        /***************************************************************/
      524    12134        /*                COMMAND INTERPRETERS                         */
      525    12135        /***************************************************************/
      526    12136        /**/
      527    12137        /**/
      528    12138        /************************************/
      529    12139        /*           DELETE                 */
      530    12140        /************************************/
      531    12141    1   DEL_CMD: PROC(DFLG) ALTRET;
      532    12142    2   DCL DFLG BIT(1) ALIGNED;
      533    12143        /**/
      534    12144    2           IF PNUM = 0 OR PNUM >= AUTO_START THEN
      535    12145    3               DO;
      536    12146        /*E*    ERROR:  IPA-E$IP_NOPROC-2
      537    12147                MESSAGE: %U2 Processor does not exist.
      538    12148                  MESSAGE1: The processor is not in the shared processor area
      539    12149                            of the processor tables.
      540    12150         */
      541    12151    3                 JITERR.CODE = E$IP_NOPROC;
      542    12152    3                 ALTRETURN;
      543    12153    3               END;
      544    12154        /* Set oldproc flag so this will no be used */
      545    12155    2           B$P.FLGS(PNUM) = B$P.FLGS(PNUM) | %P_OLDPROC;
      546    12156    3           DO I = 1 TO MUAIS - 1;
      547    12157    3             U$ = ADDR (USRT$->B$USER(I));
      548    12158    3             IF U$ -> B$U.US ~= %SS_SNULL
      549    12159    3               THEN IF U$ -> B$U.ASP = PNUM
      550    12160    3                 OR U$ -> B$U.ACP = PNUM
      551    12161    3                 OR U$ -> B$U.ASL = PNUM
      552    12162    3                 OR U$ -> B$U.DB  = PNUM
      553    12163    3                 THEN GOTO CANT_DEL;
      554    12164    3           END;
      555    12165    3           DO I = 1 TO NPROCS;
      556    12166    4             IF B$P.LIB_LNK(I) = PNUM THEN DO;
      557    12167    5                   IF (B$P.FLGS(I) & %P_OLDPROC) THEN DO;
      558    12168    5                         IF B$P.UC(I) ~= 0 THEN
      559    12169    5                           GOTO CANT_DEL;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:19   
      560    12170    5                       END;
      561    12171    4                     ELSE
      562    12172    4                     GOTO CANT_DEL;
      563    12173    4                 END;
      564    12174    3           END;
      565    12175    2           CALL IPD$FREE_PROC (PNUM);
      566    12176    2           CALL IPC$DEL_SPCL(PCNTRL,PNUM,JITERR);
      567    12177    2           IF (DFLG) THEN
      568    12178    3               DO;
      569    12179    3                 B$P.FRQ(PNUM) = 0;
      570    12180    3                 IF (PCNTRL.PERM) AND (PNUM < AUTO_START) THEN
      571    12181    4                     DO;
      572    12182        /* Finally, delete the file from :SYS */
      573    12183    4                       RU_NAME = PCNTRL.PNAME$->B$TEXTC;
      574    12184    4                       RU_ACCT = SYSACCT;
      575    12185    4                       RU_PASS.PASS# = ' ';
      576    12186    4                       CALL M$OPEN(OPEN_EI) ALTRET(DEL_ERR);
      577    12187    4                       CALL M$CLOSE(CLOSE_DEL) ALTRET(DEL_ERR);
      578    12188    4                     END;
      579    12189    3               END;
      580    12190    2           RETURN;
      581    12191        /**/
      582    12192    2   DEL_ERR:
      583    12193    2           JITERR = B$JIT.ERR;
      584    12194    2           ALTRETURN;
      585    12195        /**/
      586    12196    2   CANT_DEL:
      587    12197    2           JITERR.CODE = E$IP_INTERR;
      588    12198    2           ALTRETURN;
      589    12199        /*E*    ERROR:  IPA-E$IP_INTERR-2
      590    12200                MESSAGE: %U2 Processor is in use, marked for deletion. */
      591    12201    2   END DEL_CMD;
      592    12202        /**/
      593    12203        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:20   
      594    12204        /************************************/
      595    12205        /*           INSERT                 */
      596    12206        /************************************/
      597    12207    1   INSRT_CMD: PROC(SLOT) ALTRET;
      598    12208    2   DCL SLOT SBIN;           /* This parameter is not used for this entry point   */
      599    12209    2           IF PNUM ~= 0 AND PNUM < AUTO_START AND NOT (B$P.FLGS(PNUM)&%P_OLDPROC) THEN
      600    12210    3               DO;
      601    12211        /*E*    ERROR:  IPA-E$IP_EXISTS-2
      602    12212                MESSAGE: The %U2 processor already exists.
      603    12213                MESSAGE1: The %U2 processor already exists - either DELETE or
      604    12214                          REPLACE it.                                      */
      605    12215    3                 JITERR.CODE = E$IP_EXISTS;
      606    12216    3                 ALTRETURN;
      607    12217    3               END;
      608    12218    2           CALL IPD$GET_SLOT(SLOT) ALTRET(NO_SLOTS);
      609    12219    2           B$P.FRQ(SLOT) = 0;
      610    12220    2           PCNTRL.PERM = '1'B;             /* Always copy file on INSERT         */
      611    12221        /**/
      612    12222    2   REPL_THIS: ENTRY(SLOT) ALTRET;
      613    12223        /**/
      614    12224    2           IF (PCNTRL.PTYPE >= I_CP) AND (PCNTRL.PTYPE <= I_ASL)
      615    12225    2             THEN CALL IPC$ADD_SPCL(PCNTRL,SLOT,JITERR) ALTRET(INSRT_ERR);
      616    12226    2             ELSE IF PCNTRL.PTYPE = I_LIB
      617    12227    2               THEN CALL IPC$ADD_LIB(PCNTRL,SLOT,JITERR) ALTRET(INSRT_ERR);
      618    12228    3               ELSE DO;
      619    12229        /*E*    ERROR:  IPA-E$IP_NOTYPE-2
      620    12230                MESSAGE: Processor type must be specified for %U2.         */
      621    12231    3                   JITERR.CODE = E$IP_NOTYPE;
      622    12232    3                   ALTRETURN;
      623    12233    3                 END;
      624    12234        /* Move the run unit into :SYS */
      625    12235    2           IF PCNTRL.PERM THEN
      626    12236    2             CALL MOVE_PROC(JITERR) ALTRET(INSRT_ERR);
      627    12237    2           RETURN;
      628    12238        /**/
      629    12239    2   NO_SLOTS:;
      630    12240        /*E*    ERROR:  IPA-E$IP_NOSLOTS-2
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:21   
      631    12241                MESSAGE: There are currently no free processor slots.
      632    12242                MESSAGE1: There are no free processor slots at the moment. Wait
      633    12243                          a while and/or try 'REPLACE'.                        */
      634    12244    2           JITERR.CODE = E$IP_NOSLOTS;
      635    12245    2   INSRT_ERR:
      636    12246    2           ALTRETURN;
      637    12247    2   END INSRT_CMD;
      638    12248        /**/
      639    12249        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:22   
      640    12250        /************************************/
      641    12251        /*           REPLACE                */
      642    12252        /************************************/
      643    12253    1   REPL_CMD: PROC ALTRET;
      644    12254    2           CALL DEL_CMD('0'B)
      645    12255    3             WHENALTRETURN DO;
      646    12256    3                 IF JITERR.CODE ~= E$IP_INTERR
      647    12257    3                   THEN
      648    12258    3                   GOTO REPL_ERR;
      649    12259    3               END;
      650    12260    2           IF B$P.NAME.TEXT(PNUM) = TC_FREE.TEXT
      651    12261    2             THEN PROC_SLOT = PNUM;
      652    12262    2             ELSE CALL IPD$GET_SLOT(PROC_SLOT) ALTRET(NO_SLOTS2);
      653    12263    2           CALL REPL_THIS(PROC_SLOT) ALTRET(REPL_ERR);
      654    12264    2           RETURN;
      655    12265        /**/
      656    12266    2   NO_SLOTS2:;
      657    12267    2           JITERR.CODE = E$IP_NOSLOTS;
      658    12268    2   REPL_ERR:
      659    12269    2           ALTRETURN;
      660    12270    2   END REPL_CMD;
      661    12271        /**/
      662    12272        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:23   
      663    12273        /************************************/
      664    12274        /*           LIST                   */
      665    12275        /************************************/
      666    12276    1   LIST_CMD: PROC ALTRET;
      667    12277    2           IF (PCNTRL.PNAME$ ~= ADDR(NIL)) AND (PNUM = 0) THEN
      668    12278    3               DO;
      669    12279    3                 JITERR.CODE = E$IP_NOPROC;
      670    12280    3                 ALTRETURN;
      671    12281    3               END;
      672    12282    2           IF PNUM ~= 0
      673    12283        /* Print the list information for a single named program. */
      674    12284    3             THEN DO;
      675    12285    3                 CALL IPE$LIST1_HDR;
      676    12286    3                 CALL IPE$LIST1_INFO(PNUM);
      677    12287                      %PRINT(STR=T_CRLF);
      678    12291    3                 CALL IPE$LIST2_HDR;
      679    12292    3                 CALL IPE$LIST2_INFO(PNUM);
      680    12293    3               END;
      681    12294        /* Print the list information for system and/or auto-shared programs */
      682    12295    3             ELSE DO;
      683    12296        /* Do the system processors first...   */
      684    12297    3                 IF NOT PCNTRL.LIST_AUTO THEN
      685    12298    4                     DO;
      686    12299                            %PRINT(STR=T_SYSPROCS);
      687    12303    4                       CALL IPE$LIST1_HDR;
      688    12304    5                       DO I = 1 TO NPROCS;
      689    12305    5                         CALL IPE$LIST1_INFO(I);
      690    12306    5                       END;
      691    12307                            %PRINT(STR=T_CRLF);
      692    12311    4                       CALL IPE$LIST2_HDR;
      693    12312    5                       DO I = 1 TO NPROCS;
      694    12313    5                         CALL IPE$LIST2_INFO(I);
      695    12314    5                       END;
      696    12315                            %PRINT(STR=T_CRLF);
      697    12319    4                     END;
      698    12320        /* Now print the list information for the auto_shared programs. */
      699    12321    3                 IF (MAX_LOOKUP > 0) AND NOT PCNTRL.LIST_SYS THEN
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:24   
      700    12322    4                     DO;
      701    12323                            %PRINT(STR=T_AUTOPROCS);
      702    12327    4                       CALL IPE$LIST1_HDR;
      703    12328    5                       DO I = AUTO_START TO AUTO_START + MAX_LOOKUP - 1;
      704    12329    5                         PNUM = B$LOOKUP(I);
      705    12330    5                         CALL IPE$LIST1_INFO(PNUM);
      706    12331    5                       END;
      707    12332                            %PRINT(STR=T_CRLF);
      708    12336    4                       CALL IPE$LIST2_HDR;
      709    12337    5                       DO I = AUTO_START TO AUTO_START + MAX_LOOKUP - 1;
      710    12338    5                         PNUM = B$LOOKUP(I);
      711    12339    5                         CALL IPE$LIST2_INFO(PNUM);
      712    12340    5                       END;
      713    12341    4                     END;
      714    12342    3               END;
      715    12343    2           RETURN;
      716    12344    2   END LIST_CMD;
      717    12345        /**/
      718    12346        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:25   
      719    12347        /***************************************************************/
      720    12348        /*                 INTERNAL PROCEDURES                         */
      721    12349        /***************************************************************/
      722    12350        /**/
      723    12351        /* This procedure builds the control block used to drive the       */
      724    12352        /* command interpreters, based on the parse tree output by         */
      725    12353        /* M$PARSE.                                                        */
      726    12354    1   BUILD_PCNTRL: PROC;
      727    12355    2   DCL VAL SBIN;
      728    12356    2           PCNTRL = PCNTRL_INIT;
      729    12357    2           PCNTRL.CMD# = BLK$->OUT$BLK.CODE;
      730    12358    3           DO I = 0 TO BLK$->OUT$BLK.NSUBLKS - 1;
      731    12359    3             BLK2$ = OUT$BLK.SUBLK$(I);
      732    12360    3             NODE_TYPE = BLK2$->OUT$BLK.CODE;
      733    12361    3             IF NODE_TYPE = I_PNAME
      734    12362    3               THEN PCNTRL.PNAME$ = BLK2$->OUT$SYM.TEXTC$;
      735    12363    3             IF NODE_TYPE = I_PACCT
      736    12364    4               THEN DO;
      737    12365        /* Make our own 2-word copy of the ACCT string with trailing blanks. */
      738    12366    4                   PACCT = BLK2$->OUT$SYM.TEXTC$->B$TEXTC.TEXT;
      739    12367    4                   PCNTRL.PACCT$ = ADDR(PACCT);
      740    12368    4                 END;
      741    12369    3             IF NODE_TYPE = I_SYS
      742    12370    3               THEN PCNTRL.LIST_SYS = '1'B;
      743    12371    3             IF NODE_TYPE = I_AUTO
      744    12372    3               THEN PCNTRL.LIST_AUTO = '1'B;
      745    12373    3             IF (NODE_TYPE >= I_CP) AND (NODE_TYPE <= I_LIB) THEN
      746    12374    4                 DO;
      747    12375    4                   PCNTRL.PTYPE = NODE_TYPE;
      748    12376    4                 END;
      749    12377    3             IF NODE_TYPE = I_FID
      750    12378    3               THEN PCNTRL.FID$ = BLK2$->OUT$SYM.TEXTC$;
      751    12379    3             IF NODE_TYPE = I_PERM
      752    12380    3               THEN PCNTRL.PERM = '1'B;
      753    12381    3           END;
      754    12382    2           RETURN;
      755    12383    2   END BUILD_PCNTRL;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:26   
      756    12384        /**/
      757    12385        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:27   
      758    12386        /**/
      759    12387        /* This routine searches the processor tables for a particular     */
      760    12388        /* processor name and returns its number and type, if it exists.   */
      761    12389        /* If its name isn't there, the ALTRETURN is taken.                */
      762    12390    1   FIND_PROC: PROC(PNAME$,PACCT$,PNUM,PTYPE) ALTRET;
      763    12391    2   DCL PNAME$ PTR;
      764    12392    2   DCL PACCT$ PTR;
      765    12393    2   DCL PNUM SBIN;
      766    12394    2   DCL PTYPE SBIN;
      767    12395    2   DCL PN SBIN;
      768    12396        /**/
      769    12397        /* First, search the system (or fixed) portion of the shared pro-
      770    12398           cessor tables for the given procesor name.                      */
      771    12399    2           IF PACCT$->B$CHAR8 = IPA_SYSACCT
      772    12400    3             THEN DO PN = 1 TO NPROCS;
      773    12401    3                 IF  NOT (B$P.FLGS(PN) & %P_OLDPROC)
      774    12402    3                   AND (PNAME$->B$TEXTC.TEXT = B$P.NAME.TEXT(PN))
      775    12403    3                   THEN GOTO GOTPROC;
      776    12404    3               END;
      777    12405        /* Now, search the automatic sharing (user, generally) portion of the
      778    12406           tables for the given program name, assuming the account is :SYS */
      779    12407    3           DO PN = AUTO_START TO USED_AUTO;
      780    12408    3             IF  NOT (B$P.FLGS(PN) & %P_OLDPROC)
      781    12409    3               AND (PNAME$->B$TEXTC.TEXT = B$P.NAME.TEXT(PN))
      782    12410    3               AND (B$P.ACCT(PN) = PACCT$->B$CHAR8)
      783    12411    3               THEN GOTO GOTPROC;
      784    12412    3           END;
      785    12413    2           ALTRETURN;
      786    12414    2   GOTPROC:
      787    12415        /* Program overlays don't count as named processors, so altreturn. */
      788    12416    2           IF B$P.FLGS(PN) & %P_OVRLY THEN ALTRETURN;
      789    12417        /* Convert processor type flags to our internal types */
      790    12418    2           IF B$P.FLGS(PN) & %P_CP THEN PTYPE = I_CP;
      791    12419    2           IF B$P.FLGS(PN) & %P_DB THEN PTYPE = I_DB;
      792    12420    2           IF B$P.FLGS(PN) & %P_ASL THEN PTYPE = I_ASL;
      793    12421    2           IF B$P.FLGS(PN) & %P_LIB THEN PTYPE = I_LIB;
      794    12422    2           IF B$P.FLGS(PN) & %P_SP THEN PTYPE = I_SP;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:28   
      795    12423    2           PNUM = PN;
      796    12424    2           RETURN;
      797    12425    2   END FIND_PROC;
      798    12426        /**/
      799    12427        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:29   
      800    12428        /**/
      801    12429        /* This procedure returns a processor table - type bit pattern     */
      802    12430        /* corresponding to the internal shared processor type.            */
      803    12431    1   GET_PFLGS: PROC(PTYPE,PROCFLAGS);
      804    12432    2   DCL PTYPE SBIN(18);
      805    12433    2   DCL PROCFLAGS BIT(36) ALIGNED;
      806    12434    2           IF PTYPE = 0 THEN PROCFLAGS = '0'B;
      807    12435    2           IF PTYPE = I_CP THEN PROCFLAGS = %P_CP;
      808    12436    2           IF PTYPE = I_DB THEN PROCFLAGS = %P_DB;
      809    12437    2           IF PTYPE = I_ASL THEN PROCFLAGS = %P_ASL;
      810    12438    2           IF PTYPE = I_LIB THEN PROCFLAGS = %P_LIB;
      811    12439    2           RETURN;
      812    12440    2   END GET_PFLGS;
      813    12441        /**/
      814    12442        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:30   
      815    12443        /**/
      816    12444        /* Procedure for parsing the specified FID and opening M$EI to it. */
      817    12445    1   OPEN_FID: PROC(FID$) ALTRET;
      818    12446    2   DCL FID$ PTR;
      819    12447        /**/
      820    12448    2           FPT_FID.TEXTFID_ = VECTOR(FID$->B$TEXTC.TEXT);
      821    12449    2           CALL M$FID(FPT_FID) ALTRET(BAD_FID);
      822    12450    2           IF FID_ASN = %FILE#
      823    12451    3             THEN DO;
      824    12452    3                 CALL M$OPEN(OPEN_EI) ALTRET(NOW_WHAT);
      825    12453    3                 RETURN;
      826    12454    3               END;
      827    12455    3             ELSE DO;
      828    12456        /*E*    ERROR:  IPA-E$IP_NOTFILE-2
      829    12457                MESSAGE: Your FID does not specify a file.
      830    12458                MESSAGE1: The FID in this command must specify a valid run
      831    12459                          unit file.                                       */
      832    12460    3   BAD_FID:      JITERR.CODE = E$IP_NOTFILE;
      833    12461    3                 ALTRETURN;
      834    12462    3               END;
      835    12463    2   NOW_WHAT:
      836    12464    2           JITERR = B$JIT.ERR;
      837    12465    2           ALTRETURN;
      838    12466    2   END OPEN_FID;
      839    12467        /**/
      840    12468        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:31   
      841    12469        /* Routine to M$LINK to PCL to copy new run unit into :SYS */
      842    12470    1   MOVE_PROC: PROC(ERR) ALTRET;
      843    12471    2   DCL ERR BIT(36) ALIGNED;
      844    12472        /**/
      845    12473    2           FROM_FID = ' ';
      846    12474    2           FPT_UNFID.TEXTFID_ = VECTOR(FROM_FID);
      847    12475    2           IF (RU_ACCT.ACCT# = ' ') THEN
      848    12476    2             RU_ACCT.ACCT# = B$JIT.FACCN;
      849    12477    2           FPT_UNFID.ACCT_ = VECTOR(RU_ACCT);
      850    12478    2           FID_ASN = %FILE#;
      851    12479    2           IF RU_SN.SN#(0) = ' ' THEN
      852    12480    2             IF (RU_ACCT.ACCT# = SYSACCT.ACCT#) THEN
      853    12481    2               RETURN;                /* DON'T COPY RU IF IT IS ALREADY IN :SYS  */
      854    12482    2               ELSE
      855    12483    2               RU_SN.SN#(0) = B$JIT.FPSN;
      856    12484    2           FPT_UNFID.SN_ = VECTOR(RU_SN);
      857    12485    2           CALL M$UNFID(FPT_UNFID) ALTRET(ERR_MOVE);
      858    12486    2           TO_FID = ' ';
      859    12487    2           FPT_UNFID.TEXTFID_ = VECTOR(TO_FID);
      860    12488    2           FPT_UNFID.ACCT_ = VECTOR(SYSACCT);
      861    12489    2           FPT_UNFID.SN_ = VECTOR(SYSSN);
      862    12490    2           RU_NAME = PCNTRL.PNAME$->B$TEXTC;
      863    12491    2           CALL M$UNFID(FPT_UNFID) ALTRET(ERR_MOVE);
      864    12492    2           IF (TO_FID = FROM_FID) THEN RETURN;
      865    12493    2           TXTC_CMD.COUNT = SIZEC(T_COPY) + SIZEC(FROM_FID) +
      866    12494    2             SIZEC(T_OVER) + SIZEC(TO_FID);
      867    12495    2           CALL CONCAT(TXTC_CMD.TEXT,T_COPY,FROM_FID,T_OVER,TO_FID);
      868    12496    2           CALL M$LINK(FPT_LINK) ALTRET(ERR_MOVE);
      869    12497    2           RETURN;
      870    12498        /**/
      871    12499    2   ERR_MOVE:
      872    12500    2           ERR = B$JIT.ERR;
      873    12501    2           ALTRETURN;
      874    12502    2   END MOVE_PROC;
      875    12503        /**/
      876    12504        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:32   
      877    12505        /* Routine to get the processor's modification date from the FIT. */
      878    12506    1   GET_MODTIME: PROC(DATE) ALTRET;
      879    12507    2   DCL DATE UBIN;
      880    12508    2   DCL J SBIN;
      881    12509    2   DCL CODE4$ PTR;
      882    12510        /**/
      883    12511    3           DO J = 1 TO FM$FIT.CODES.CODE(0);
      884    12512    3             IF FM$FIT.CODES.CODE(J) = 4 THEN
      885    12513    4                 DO;
      886    12514    4                   CODE4$ = PINCRW(FIT$,FM$FIT.CODES.ITEMX(J));
      887    12515    4                   DATE = CODE4$->CODE04.MODIFY.TIME;
      888    12516    4                   RETURN;
      889    12517    4                 END;
      890    12518    3           END;
      891    12519    2           DATE = FITBUF.WORK (0);         /*anything for a * file*/
      892    12520    2           RETURN;
      893    12521    2   END GET_MODTIME;
      894    12522        /**/
      895    12523        /**/
      896    12524    1   END IPA$SPIDER;

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:33   
--  Include file information  --

   XU_SUBS_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   MM_MACRO_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   MM$SYSGEN.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   MM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   IPS_SUBS_C.:E05TOU  is referenced.
   IP_PERR_C.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure IPA$SPIDER.

   Procedure IPA$SPIDER requires 1176 words for executable code.
   Procedure IPA$SPIDER requires 60 words of local(AUTO) storage.

    No errors detected in file IPA$SPIDER.:E05TSI    .

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:34   

 Object Unit name= IPA$SPIDER                                 File name= IPA$SPIDER.:E05TOU
 UTS= JUL 29 '97 22:39:13.60 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none  1698   3242  IPA$SPIDER
    2  RoData even  UTS      4      4  IPA$SPIDER
    3   DCB   even  none     0      0  M$SI
    4   DCB   even  none     0      0  M$LO
    5   DCB   even  none     0      0  M$EI
    6   Proc  even  none  1176   2230  IPA$SPIDER
    7  RoData even  none    68    104  IPA$SPIDER

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     6      0   yes            yes      Main       0  IPA$SPIDER
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:35   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1   2350  IPA_RESTART                        1   2352  ERRMSGBUF
    1   2410  BUF$                               1   2411  WSPTD$
    1   2412  ROSEG$                             1   2413  PGTBL$
    1   2414  EI$                                1   2415  HEAD$
    1   2416  P$                                 1   2417  LOOKUP$
    1   2420  USRT$                              1   2421  NPROCS
    1   2422  MAXPROCS                           1   2423  AUTO_START
    1   2424  LAST_AUTO                          1   2425  USED_AUTO
    1   2426  MAX_LOOKUP                         1   2427  MUAIS
    1   2430  NSCPU                              1   2431  SCPUWSPTD
    1   2441  IPA_SYSACCT                        1   2444  PPUT_DESC
    1   2446  PPUT$                              1   2447  IP_WSQ0PT
    1   2450  IP_PTB_UNITS                       1   2522  TC_FREE
    1   2524  T_HELLO

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 XTX$ADAPT
         yes          Async      0 IPD$BREAK
         yes           Std       2 IPD$SETSEG
 yes     yes           Std       6 XUR$GETCMD
         yes           Std       2 IPD$MON_VALUE
 yes     yes           Std       3 XUR$INIT
 yes     yes           Std       7 XUR$ERRMSG
 yes     yes           Std       2 IPD$FREE_PROC
 yes     yes           Std       3 IPC$DEL_SPCL
 yes     yes           Std       1 IPD$GET_SLOT
 yes     yes           Std       3 IPC$ADD_SPCL
 yes     yes           Std       3 IPC$ADD_LIB
         yes           Std       0 IPE$LIST1_HDR
         yes           Std       1 IPE$LIST1_INFO
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:36   
         yes           Std       0 IPE$LIST2_HDR
         yes           Std       1 IPE$LIST2_INFO
                       nStd      0 X66_MAUTO
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_MARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     P_NPROCS                              P_MAXPROCS                            P_AUTO_START
     P_LAST_AUTO                           P_USED_AUTO                           P_MAX_LOOKUP
     B$P$                                  B$LOOKUP$                             M$UC
r    MM_BYP$                               B$JIT$                                B$IS$
     B$USRT$                               B_MUAIS                               B_VERSION
     HW_WSQ0PT                             HW_PTB_UNITS                          S_NSCPU
     IT_SCPUWSPTD                          SPIDER_CMD                            M$SI
     M$LO                                  M$EI                                  B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:37   


        1        1        /*M* IPA$SPIDER - Driver moduler for SPIDER.                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=8,IND=2,THI=2,ENU=2,CSU=2,DTI=4,DCI=4,ECU=4,AND */
        8        8        IPA$SPIDER: PROC MAIN;

      8  6 000000   000000 700200 xent  IPA$SPIDER   TSX0  ! X66_MAUTO
         6 000001   000074 000000                    ZERO    60,0

        9        9        %INCLUDE B_ERRORS_C;
       10     1136        %INCLUDE B_SEGIDS_C;
       11     1675        %INCLUDE B$OBJECT_C;
       12     5105        %INCLUDE B$P;
       13     5189        %INCLUDE B$USER;
       14     5405        %INCLUDE SS_SCHED_C;
       15     5638        %INCLUDE CP_6;
       16     5719        %INCLUDE CP_6_SUBS;
       17     6259        %INCLUDE FM$FIT;
       18     6480        %INCLUDE IP_PERR_C;
       19     6508        %INCLUDE IPS_SUBS_C;
       20     6545        %INCLUDE MM_DATA_R;
       21     7065        %INCLUDE B$JIT;
       22     7355        %INCLUDE XU_MACRO_C;
       23    10461        %INCLUDE XU_SUBS_C;
       24    10553        /**/
       25    10554        /* STATIC DATA */
       26    10555    1   DCL 1 FITBUF STATIC DALIGNED,
       27    10556    1         2 WORK(0:1023) UBIN WORD;
       28    10557    1   DCL INBUF(0:79) CHAR(1) STATIC UNAL;
       29    10558    1   DCL 1 HEADBUF STATIC DALIGNED,
       30    10559    1         2 * CHAR(160);
       31    10560    1   DCL PARSE_WORK(0:WORK_SIZE) UBIN STATIC;
       32    10561    1   DCL 1 STLVEC STATIC DALIGNED,
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:38   
       33    10562    1         2 * UBIN WORD,
       34    10563    1         2 PNO UBIN WORD;
       35    10564    1   DCL 1 PCNTRL_INIT STATIC,
       36    10565    1         2 CMD# UBIN WORD INIT(0),
       37    10566    1         2 PNAME$ PTR INIT(ADDR(NIL)),
       38    10567    1         2 PACCT$ PTR INIT(ADDR(IPA_SYSACCT)),
       39    10568    1         2 PTYPE UBIN HALF UNAL INIT(0),
       40    10569    1         2 PERM BIT(1) UNAL INIT('0'B),
       41    10570    1         2 LIST_SYS BIT(1) UNAL INIT('0'B),
       42    10571    1         2 LIST_AUTO BIT(1) UNAL INIT('0'B),
       43    10572    1         2 * UBIN(6) UNAL INIT(0),
       44    10573    1         2 * UBIN BYTE UNAL INIT(0),
       45    10574    1         2 FID$ PTR INIT(ADDR(NIL)),
       46    10575    1         2 MODTIME UBIN WORD INIT(0),
       47    10576    1         2 PNUM UBIN HALF UNAL INIT(0),
       48    10577    1         2 * UBIN(18) UNAL INIT(0),
       49    10578    1         2 PFLGS BIT(36) UNAL INIT('0'B);
       50    10579    1   DCL 1 HEAD_KEY STATIC,
       51    10580    1         2 S UBIN(9) UNAL INIT(4),
       52    10581    1         2 T CHAR(4) UNAL INIT('HEAD');
       53    10582    1   DCL T_CRLF(0:1) CHAR(1) STATIC UNAL INIT(BITASC('015'O),BITASC('012'O));
       54    10583    1   DCL T_PROMPT CHAR(1) STATIC UNAL INIT('>');
       55    10584    1   DCL 1 JITERR STATIC,
       56    10585    1         2 FCG BIT(12) UNAL,
       57    10586    1         2 MID BIT(6) UNAL,
       58    10587    1         2 M BIT(1) UNAL,
       59    10588    1         2 CODE UBIN(14) UNAL,
       60    10589    1         2 SEV UBIN(3) UNAL;
       61    10590    1   DCL 1 JITERR_INIT CONSTANT,
       62    10591    1         2 FCG BIT(12) UNAL INIT('1120'O),
       63    10592    1         2 MID BIT(6) UNAL INIT('01'O),
       64    10593    1         2 M BIT(1) UNAL INIT('0'B),
       65    10594    1         2 CODE UBIN(14) UNAL INIT(0),
       66    10595    1         2 SEV UBIN(3) UNAL INIT(0);
       67    10596    1   DCL 1 ERRPOS STATIC,
       68    10597    1         2 COUNT UBIN(9) UNAL INIT(2),
       69    10598    1         2 TEXT CHAR(2) UNAL INIT(' '),
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:39   
       70    10599    1         2 TX(0:1) REDEF TEXT CHAR(1) UNAL;
       71    10600    1   DCL PCL_CMD CHAR(120) STATIC DALIGNED;
       72    10601    1   DCL 1 TXTC_CMD REDEF PCL_CMD,
       73    10602    1         2 COUNT UBIN BYTE UNAL,
       74    10603    1         2 TEXT CHAR(119) UNAL;
       75    10604    1   DCL FID_ASN UBIN(9) STATIC;
       76    10605    1   DCL FIT$ PTR STATIC INIT(ADDR(FITBUF));
       77    10606    1   DCL SI$ PTR STATIC;
       78    10607        /* GLOBAL (SYMDEF) DATA */
       79    10608    1   DCL IPA_RESTART REMEMBER STATIC SYMDEF;
       80    10609    1   DCL ERRMSGBUF CHAR(120) STATIC SYMDEF DALIGNED;
       81    10610    1   DCL BUF$ PTR STATIC SYMDEF;
       82    10611    1   DCL WSPTD$ PTR STATIC SYMDEF;
       83    10612    1   DCL ROSEG$ PTR STATIC SYMDEF;
       84    10613    1   DCL PGTBL$ PTR STATIC SYMDEF;
       85    10614    1   DCL EI$ PTR STATIC SYMDEF;
       86    10615    1   DCL HEAD$ PTR STATIC SYMDEF INIT(ADDR(HEADBUF));
       87    10616    1   DCL P$ PTR STATIC SYMDEF;
       88    10617    1   DCL LOOKUP$ PTR STATIC SYMDEF;
       89    10618    1   DCL USRT$ PTR STATIC SYMDEF;
       90    10619    1   DCL NPROCS SBIN STATIC SYMDEF;
       91    10620    1   DCL MAXPROCS SBIN STATIC SYMDEF;
       92    10621    1   DCL AUTO_START SBIN STATIC SYMDEF;
       93    10622    1   DCL LAST_AUTO SBIN STATIC SYMDEF;
       94    10623    1   DCL USED_AUTO SBIN STATIC SYMDEF;
       95    10624    1   DCL MAX_LOOKUP SBIN STATIC SYMDEF;
       96    10625    1   DCL MUAIS SBIN STATIC SYMDEF;
       97    10626    1   DCL NSCPU SBIN STATIC SYMDEF;
       98    10627    1   DCL SCPUWSPTD(0:7) SBIN STATIC SYMDEF;
       99    10628    1   DCL IPA_SYSACCT CHAR(8) STATIC SYMDEF INIT(':SYS');
      100    10629    1   DCL TPTR$$ PTR CONSTANT INIT(ADDR(TPTR$));
      101    10630    1   DCL TPTR$ PTR STATIC;
      102    10631    1   DCL PPUT_DESC DSCR STATIC SYMDEF;
      103    10632    1   DCL PPUT$ PTR STATIC SYMDEF INIT(ADDR(NIL));
      104    10633    1   DCL 1 PPUT_REDEF REDEF PPUT$,
      105    10634    1         2 *      BIT(24),
      106    10635    1         2 SID    BIT(12);
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:40   
      107    10636        /* AUTO */
      108    10637    1   DCL I SBIN;
      109    10638    1   DCL J SBIN;
      110    10639    1   DCL PP SBIN;
      111    10640    1   DCL VP SBIN;
      112    10641    1   DCL PPUT_OFFSET SBIN;                   /* Offset from begining of WSQ        */
      113    10642    1   DCL INPUT_SIZE SBIN;
      114    10643    1   DCL NODE_TYPE SBIN;
      115    10644    1   DCL PNUM SBIN WORD;
      116    10645    1   DCL PTYPE SBIN WORD;
      117    10646    1   DCL PFLGS BIT(36);
      118    10647    1   DCL PROC_SLOT SBIN;
      119    10648    1   DCL PACCT CHAR(8);
      120    10649    1   DCL BLK$ PTR;
      121    10650    1   DCL BLK2$ PTR;
      122    10651    1   DCL TEXT$ PTR;
      123    10652    1   DCL U$ PTR;
      124    10653    1   DCL ATNUM CHAR(2) UNAL;
      125    10654    1   DCL CH_NUM(0:1) REDEF ATNUM CHAR(1) UNAL;
      126    10655    1   DCL FROM_FID CHAR(40);
      127    10656    1   DCL TO_FID CHAR(40);
      128    10657    1   DCL 1 PCNTRL,
      129    10658    1         2 CMD# UBIN WORD,
      130    10659    1         2 PNAME$ PTR,
      131    10660    1         2 PACCT$ PTR,
      132    10661    1         2 PTYPE UBIN HALF UNAL,
      133    10662    1         2 PERM BIT(1) UNAL,
      134    10663    1         2 LIST_SYS BIT(1) UNAL,
      135    10664    1         2 LIST_AUTO BIT(1) UNAL,
      136    10665    1         2 * UBIN(6) UNAL,
      137    10666    1         2 * UBIN BYTE UNAL,
      138    10667    1         2 FID$ PTR,
      139    10668    1         2 MODTIME UBIN WORD,
      140    10669    1         2 PNUM UBIN HALF UNAL,
      141    10670    1         2 * UBIN(18) UNAL,
      142    10671    1         2 PFLGS BIT(36) UNAL;
      143    10672        /* BASED */
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:41   
      144    10673    1   DCL 1 B$TEXTC BASED ALIGNED,
      145    10674    1         2 COUNT UBIN(9) UNAL,
      146    10675    1         2 TEXT CHAR(B$TEXTC.COUNT) UNAL;
      147    10676    1   DCL B$CHAR8 CHAR(8) UNAL BASED;
      148    10677    1   DCL B$BIT BIT(1) BASED ALIGNED;
      149    10678    1   DCL 1 B$PTR BASED ALIGNED,
      150    10679    1         2 * BIT(24),
      151    10680    1         2 SID BIT(12);
      152    10681        /* SYMREF */
      153    10682    1   DCL B$JIT$ PTR SYMREF;
      154    10683    1   DCL B$IS$ PTR SYMREF;
      155    10684    1   DCL B$SPCL3$ PTR SYMREF;
      156    10685    1   DCL B$USRT$ PTR SYMREF;
      157    10686    1   DCL B_MUAIS SBIN SYMREF;
      158    10687    1   DCL 1 B_VERSION SYMREF,
      159    10688    1         2  L#    UBIN(9) UNAL,
      160    10689    1         2  TXT   CHAR(B_VERSION.L#);
      161    10690    1   DCL IP_WSQ0PT BIT(1) ALIGNED STATIC SYMDEF;
      162    10691    1   DCL HW_WSQ0PT BIT(1) ALIGNED SYMREF;
      163    10692    1   DCL IP_PTB_UNITS SBIN WORD ALIGNED STATIC SYMDEF;/* SBIN makes better code    */
      164    10693    1   DCL HW_PTB_UNITS SBIN WORD ALIGNED SYMREF;
      165    10694    1   DCL S_NSCPU SBIN SYMREF;
      166    10695    1   DCL IT_SCPUWSPTD(0:3) SBIN SYMREF;
      167    10696    1   DCL SPIDER_CMD SBIN SYMREF;
      168    10697        /* DCB */
      169    10698    1   DCL M$SI DCB;
      170    10699    1   DCL M$LO DCB;
      171    10700    1   DCL M$EI DCB;
      172    10701        /* EXTERNAL ROUTINES */
      173    10702    1   DCL IPC$ADD_SPCL ENTRY(3) ALTRET;
      174    10703    1   DCL IPC$DEL_SPCL ENTRY(3) ALTRET;
      175    10704    1   DCL IPC$ADD_LIB ENTRY(3) ALTRET;
      176    10705    1   DCL IPD$MON_VALUE ENTRY(2);
      177    10706    1   DCL IPD$MON_STORE ENTRY(2);
      178    10707    1   DCL IPD$SETSEG ENTRY(2);
      179    10708    1   DCL IPD$FREE_PROC ENTRY(2) ALTRET;
      180    10709    1   DCL IPD$GET_SLOT ENTRY(1) ALTRET;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:42   
      181    10710    1   DCL IPD$BREAK ENTRY ASYNC;
      182    10711    1   DCL IPE$LIST1_HDR ENTRY;
      183    10712    1   DCL IPE$LIST1_INFO ENTRY(1);
      184    10713    1   DCL IPE$LIST2_HDR ENTRY;
      185    10714    1   DCL IPE$LIST2_INFO ENTRY(1);
      186    10715    1   DCL IPE$HELP ENTRY;
      187    10716    1   DCL XUR$INIT ENTRY(3) ALTRET;
      188    10717    1   DCL XUR$GETCMD ENTRY(6) ALTRET;
      189    10718    1   DCL XUR$ERRMSG ENTRY (7) ALTRET;
      190    10719        /**/
      191    10720        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:43   
      192    10721        /**/
      193    10722        /* MACROS */
      194    10723        /**/
      195    10724        %MACRO TXTSTR(NAME=TXTSTR,TEXT=' ');
      196    10725        DCL NAME CHAR(0) STATIC INIT(TEXT);
      197    10726        %MEND;
      198    10727        /**/
      199    10728        %MACRO TEXTC(NAME=TEXTC,STRING=' ');
      200    10729        DCL 1 NAME STATIC SYMDEF,
      201    10730              2 COUNT UBIN(9) UNAL INIT(SIZEC(STRING)),
      202    10731              2 TEXT CHAR(0) UNAL INIT(STRING);
      203    10732        %MEND;
      204    10733        /**/
      205    10734        %MACRO PRINT(STR=NIL);
      206    10735                WRITE_LO.BUF_ = VECTOR(STR);
      207    10736                CALL M$WRITE(WRITE_LO);
      208    10737        %MEND;
      209    10738        /**/
      210    10739        /* MACRO INVOCATIONS */
      211    10740                %B$HEAD;
      212    10940                %RU_FLAVORS;
      213    10946                %CODE04;
      214    10954                %F$DCB;
      215    11011                %FM$FIT;
      216    11014                %PARSE$OUT;
      217    11059                %PARSE$SYM;
      218    11097                %XUR_INIT (SYNTAX=YES, GOODCMD=YES, COMMANDS=YES);
      219    11196        /**/
      220    11197        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:44   
      221    11198        /**/
      222    11199        /* %SUBs */
      223    11200                %SUB B$HEAD=HEAD$->B$HEAD;
      224    11201                %SUB B$P=P$->B$P;
      225    11202                %SUB B$LOOKUP=LOOKUP$->B$LOOKUP;
      226    11203                %SUB FM$FIT=FIT$->FM$FIT;
      227    11204                %SUB MM$PPUT = PPUT$->MM$PPUT;
      228    11205        /* TEXT STRINGS */
      229    11206                %TEXTC(NAME=TC_FREE,STRING=':FREE');
      230    11211    1   DCL 1 T_HELLO STATIC SYMDEF,
      231    11212    1         2 COUNT UBIN(9) UNAL,
      232    11213    1         2 TEXT  CHAR(13) UNAL;
      233    11214                %TXTSTR(NAME=T_COPY,
      234    11215                TEXT='COPY ');
      235    11218                %TXTSTR(NAME=T_OVER,
      236    11219                TEXT='OVER ');
      237    11222                %TXTSTR(NAME=T_SYSPROCS,
      238    11223                TEXT='System Processors:');
      239    11226                %TXTSTR(NAME=T_AUTOPROCS,
      240    11227                TEXT='Automatically Shared Run Units:');
      241    11230        /**/
      242    11231        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:45   
      243    11232        /**/
      244    11233                %FPT_READ(FPTN=READ_SI,
      245    11234                DCB=M$SI,
      246    11235                BUF=INBUF);
      247    11274                %FPT_WRITE(FPTN=WRITE_LO,
      248    11275                DCB=M$LO);
      249    11306                %FPT_ERRMSG(CODE=JITERR,
      250    11307                INCLCODE=NO,
      251    11308                OUTDCB1=M$LO,
      252    11309                FIELD1=ERRPOS,
      253    11310                DCB=M$EI,
      254    11311                SUBMESS=YES,
      255    11312                BUF=ERRMSGBUF);
      256    11339                %FPT_OPEN(FPTN=OPEN_EI,
      257    11340                NAME=RU_NAME,
      258    11341                ACCT=RU_ACCT,
      259    11342                PASS=RU_PASS,
      260    11343                SN=RU_SN,
      261    11344                DCB=M$EI,
      262    11345                ASN=FILE,
      263    11346                FUN=IN,
      264    11347                ACS=DIRECT,
      265    11348                ORG=KEYED,
      266    11349                FPARAM=FITBUF,
      267    11350                SCRUB=YES);
      268    11459                %VLP_NAME(FPTN=RU_NAME);
      269    11486                %VLP_ACCT(FPTN=RU_ACCT);
      270    11499                %VLP_PASS(FPTN=RU_PASS);
      271    11512                %VLP_SN(FPTN=RU_SN);
      272    11525                %FPT_FID(NAME=RU_NAME,
      273    11526                ACCT=RU_ACCT,
      274    11527                PASS=RU_PASS,
      275    11528                RES=OPEN_EI.V.RES#,
      276    11529                SN=RU_SN,
      277    11530                ASN=FID_ASN,
      278    11531                RESULTS=VLR_FID,
      279    11532                SNAME=YES,
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:46   
      280    11533                SACCT=YES,
      281    11534                SPASS=YES,
      282    11535                SSN=YES);
      283    11558                %VLR_FID;
      284    11577                %FPT_UNFID(NAME=RU_NAME,
      285    11578                ACCT=RU_ACCT,
      286    11579                PASS=RU_PASS,
      287    11580                SN=RU_SN,
      288    11581                ASN=FID_ASN);
      289    11599                %FPT_LINK(NAME=PCL_NAME,
      290    11600                ACCT=SYSACCT,
      291    11601                CMD=PCL_CMD);
      292    11619                %VLP_NAME(FPTN=PCL_NAME,
      293    11620                NAME='PCL');
      294    11647                %VLP_ACCT(FPTN=SYSACCT,
      295    11648                ACCT=':SYS');
      296    11661        %VLP_SN (FPTN=SYSSN,
      297    11662                 SN='SYS');
      298    11675                %FPT_READ(FPTN=READ_HEAD,
      299    11676                KEY=HEAD_KEY,
      300    11677                DCB=M$EI,
      301    11678                KEYS=YES,
      302    11679                BUF=HEADBUF);
      303    11718                %FPT_CLOSE(FPTN=CLOSE_EI,
      304    11719                DCB=M$EI,
      305    11720                DISP=SAVE);
      306    11762                %FPT_CLOSE(FPTN=CLOSE_DEL,
      307    11763                DCB=M$EI,
      308    11764                DISP=RELEASE);
      309    11806                %FPT_SAD(FPTN=SEE_MONITOR,
      310    11807                MONSID=%ISSID,
      311    11808                USERSID=%SPCL1SID);
      312    11823                %FPT_SAD(FPTN=SEE_TIGRDATA,
      313    11824                MONSID=%TIGRSID,
      314    11825                USERSID=%SPCL2SID);
      315    11840                %FPT_SAD(FPTN=SEE_PPUT,
      316    11841                MONSID=%PPUTSID,
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:47   
      317    11842                USERSID=%SPCL3SID);
      318    11857                %FPT_STLPP(RESULTS=STLVEC);
      319    11870                %FPT_PRIV(FPTN=PPRIV_LOOK,
      320    11871                PPRIV=YES,
      321    11872                PRIV=%PPR_SPIDERD#);
      322    11887                %FPT_PRIV(FPTN=PPRIV_CHNG,
      323    11888                PPRIV=YES,
      324    11889                PRIV=%PPR_SPIDERC#);
      325    11904                %FPT_INT(UENTRY=IPD$BREAK);
      326    11918        /**/
      327    11919        %FPT_CVM (FPTN=PPUT_CVM);
      328    11935        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:48   
      329    11936        /*******************************************************************/
      330    11937        /*                                                                 */
      331    11938        /*                      S P I D E R                                */
      332    11939        /*                                                                 */
      333    11940        /*******************************************************************/
      334    11941        /**/
      335    11942    1           JITERR = JITERR_INIT;

  11942  6 000002   000000 236000 2                  LDQ     JITERR_INIT
         6 000003   002304 756000 1                  STQ     JITERR

      336    11943    1           T_HELLO.COUNT =              13;/* Max number of chars in greeting    */

  11943  6 000004   015000 236003                    LDQ     6656,DU
         6 000005   002524 552040 1                  STBQ    T_HELLO,'40'O

      337    11944    1           CALL CONCAT(T_HELLO.TEXT,'SPIDER ',SUBSTR(B_VERSION.TXT,0,B_VERSION.L#));

  11944  6 000006   000000 236000 xsym               LDQ     B_VERSION
         6 000007   000033 772000                    QRL     27
         6 000010   040000 100400                    MLR     fill='040'O
         6 000011   000002 000007 2                  ADSC9   JITERR_INIT+2            cn=0,n=7
         6 000012   002524 200007 1                  ADSC9   T_HELLO                  cn=1,n=7
         6 000013   000000 620006                    EAX0    0,QL
         6 000014   040000 100440                    MLR     fill='040'O
         6 000015   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
         6 000016   002526 000006 1                  ADSC9   T_HELLO+2                cn=0,n=6

      338    11945                %PRINT(STR=T_HELLO.TEXT);

  11946  6 000017   000000 237000 7                  LDAQ    0
         6 000020   002574 757000 1                  STAQ    WRITE_LO+4

  11947  6 000021   002570 630400 1                  EPPR0   WRITE_LO
         6 000022   040001 713400                    CLIMB   write
         6 000023   401400 401760                    pmme    nvectors=4

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:49   
      339    11949        /* Get visibility for various pieces of the monitor */
      340    11950    1           CALL M$SAD(SEE_MONITOR) ALTRET(TARANTULA);

  11950  6 000024   003202 630400 1                  EPPR0   SEE_MONITOR
         6 000025   430015 713400                    CLIMB   alt,+12301
         6 000026   400000 401760                    pmme    nvectors=1
         6 000027   000617 702000 6                  TSX2    TARANTULA

      341    11951    1           CALL M$SAD(SEE_TIGRDATA) ALTRET(TARANTULA);

  11951  6 000030   003206 630400 1                  EPPR0   SEE_TIGRDATA
         6 000031   430015 713400                    CLIMB   alt,+12301
         6 000032   400000 401760                    pmme    nvectors=1
         6 000033   000617 702000 6                  TSX2    TARANTULA

      342    11952    1           CALL M$SAD(SEE_PPUT) ALTRET(TARANTULA);

  11952  6 000034   003212 630400 1                  EPPR0   SEE_PPUT
         6 000035   430015 713400                    CLIMB   alt,+12301
         6 000036   400000 401760                    pmme    nvectors=1
         6 000037   000617 702000 6                  TSX2    TARANTULA

      343    11953        /* Make CVM PPUT into the IS, then point PPUT$ there */
      344    11954    1           PPUT_REDEF.SID = %SPCL3SID;     /* Init pointer to PPUT window        */

  11954  6 000040   006023 236007                    LDQ     3091,DL
         6 000041   002446 752003 1                  STCQ    PPUT$,'03'O

      345    11955    1           PPUT_DESC = PTRDSCR(PPUT$);     /* Put (real) PPUT desc in PPUT_DESC  */

  11955  6 000042   002446 470400 1                  LDP0    PPUT$
         6 000043   002444 050400 1                  STD0    PPUT_DESC

      346    11956    1           PPUT_OFFSET = B$JIT.DDLL;

  11956  6 000044   000000 470400 xsym               LDP0    B$JIT$
         6 000045   000200 236100                    LDQ     128,,PR0
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:50   
         6 000046   000022 772000                    QRL     18
         6 000047   200007 756100                    STQ     PPUT_OFFSET,,AUTO

      347    11957    1           VP = PPUT_OFFSET - %ISEGLO;

  11957  6 000050   000100 136007                    SBLQ    64,DL
         6 000051   200006 756100                    STQ     VP,,AUTO

      348    11958    2           DO I = DBASE(PPUT_DESC) TO DBASE(PPUT_DESC) + DBOUND(PPUT_DESC) BY 4096;

  11958  6 000052   002445 235000 1                  LDA     PPUT_DESC+1
         6 000053   200003 755100                    STA     I,,AUTO
         6 000054   000073 710000 6                  TRA     s:11965+2

      349    11959    2             PP = I/4096;

  11959  6 000055   200003 236100                    LDQ     I,,AUTO
         6 000056   010000 506007                    DIV     4096,DL
         6 000057   200005 756100                    STQ     PP,,AUTO

      350    11960    2             PPUT_CVM.V.PPNO# = PP;

  11960  6 000060   003237 756000 1                  STQ     PPUT_CVM+3

      351    11961    2             PPUT_CVM.V.VPNO# = VP;

  11961  6 000061   200006 720100                    LXL0    VP,,AUTO
         6 000062   003240 440000 1                  SXL0    PPUT_CVM+4

      352    11962    2             PPUT_CVM.V.PHYSICAL#='0'B;    /* PPNO is WSQ0 relative              */

  11962  6 000063   000002 236000 7                  LDQ     2
         6 000064   003236 356000 1                  ANSQ    PPUT_CVM+2

      353    11963    2             CALL M$CVM (PPUT_CVM);

  11963  6 000065   003234 630400 1                  EPPR0   PPUT_CVM
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:51   
         6 000066   030011 713400                    CLIMB   12297
         6 000067   400000 401760                    pmme    nvectors=1

      354    11964    2             VP = VP + 1;

  11964  6 000070   200006 054100                    AOS     VP,,AUTO

      355    11965    2           END;

  11965  6 000071   010000 236007                    LDQ     4096,DL
         6 000072   200003 056100                    ASQ     I,,AUTO
         6 000073   002444 236000 1                  LDQ     PPUT_DESC
         6 000074   000020 772000                    QRL     16
         6 000075   002445 036000 1                  ADLQ    PPUT_DESC+1
         6 000076   000055 604000 6                  TMI     s:11959
         6 000077   200003 116100                    CMPQ    I,,AUTO
         6 000100   000055 605000 6                  TPL     s:11959

      356    11966    1           PPUT$ = PINCRW (B$IS$, (PPUT_OFFSET-%ISEGLO)*1024);

  11966  6 000101   200007 236100                    LDQ     PPUT_OFFSET,,AUTO
         6 000102   000034 736000                    QLS     28
         6 000103   200000 136003                    SBLQ    65536,DU
         6 000104   000000 036000 xsym               ADLQ    B$IS$
         6 000105   002446 756000 1                  STQ     PPUT$

      357    11967        /* Pick up some monitor values */
      358    11968    1           CALL IPD$MON_VALUE(HW_WSQ0PT, IP_WSQ0PT);

  11968  6 000106   000003 630400 7                  EPPR0   3
         6 000107   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000110   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000111   000000 011000                    NOP     0

      359    11969    1           CALL IPD$MON_VALUE(HW_PTB_UNITS, IP_PTB_UNITS);

  11969  6 000112   000005 630400 7                  EPPR0   5
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:52   
         6 000113   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000114   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000115   000000 011000                    NOP     0

      360    11970    1           CALL IPD$MON_VALUE(P_NPROCS,NPROCS);

  11970  6 000116   000007 630400 7                  EPPR0   7
         6 000117   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000120   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000121   000000 011000                    NOP     0

      361    11971    1           CALL IPD$MON_VALUE(P_MAXPROCS,MAXPROCS);

  11971  6 000122   000011 630400 7                  EPPR0   9
         6 000123   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000124   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000125   000000 011000                    NOP     0

      362    11972    1           CALL IPD$MON_VALUE(P_AUTO_START,AUTO_START);

  11972  6 000126   000013 630400 7                  EPPR0   11
         6 000127   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000130   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000131   000000 011000                    NOP     0

      363    11973    1           CALL IPD$MON_VALUE(P_LAST_AUTO,LAST_AUTO);

  11973  6 000132   000015 630400 7                  EPPR0   13
         6 000133   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000134   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000135   000000 011000                    NOP     0

      364    11974    1           CALL IPD$MON_VALUE(P_USED_AUTO,USED_AUTO);

  11974  6 000136   000017 630400 7                  EPPR0   15
         6 000137   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000140   000000 701000 xent               TSX1    IPD$MON_VALUE
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:53   
         6 000141   000000 011000                    NOP     0

      365    11975    1           CALL IPD$MON_VALUE(S_NSCPU,NSCPU);

  11975  6 000142   000021 630400 7                  EPPR0   17
         6 000143   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000144   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000145   000000 011000                    NOP     0

      366    11976    1           CALL IPD$MON_VALUE(P_MAX_LOOKUP,MAX_LOOKUP);

  11976  6 000146   000023 630400 7                  EPPR0   19
         6 000147   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000150   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000151   000000 011000                    NOP     0

      367    11977    1           CALL IPD$MON_VALUE(B_MUAIS,MUAIS);

  11977  6 000152   000025 630400 7                  EPPR0   21
         6 000153   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000154   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000155   000000 011000                    NOP     0

      368    11978    2           DO I = 0 TO NSCPU;

  11978  6 000156   200003 450100                    STZ     I,,AUTO
         6 000157   000172 710000 6                  TRA     s:11980+1

      369    11979    2             CALL IPD$MON_VALUE(IT_SCPUWSPTD(I),SCPUWSPTD(I));

  11979  6 000160   200003 720100                    LXL0    I,,AUTO
         6 000161   002431 630410 1                  EPPR0   SCPUWSPTD,X0
         6 000162   200071 450500                    STP0    @ERR+2,,AUTO
         6 000163   000000 631410 xsym               EPPR1   IT_SCPUWSPTD,X0
         6 000164   200070 451500                    STP1    @ERR+1,,AUTO
         6 000165   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 000166   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:54   
         6 000167   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000170   000000 011000                    NOP     0

      370    11980    2           END;

  11980  6 000171   200003 054100                    AOS     I,,AUTO
         6 000172   200003 236100                    LDQ     I,,AUTO
         6 000173   002430 116000 1                  CMPQ    NSCPU
         6 000174   000160 604400 6                  TMOZ    s:11979

      371    11981    1           CALL IPD$MON_VALUE(B$P$,P$);

  11981  6 000175   000027 630400 7                  EPPR0   23
         6 000176   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000177   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000200   000000 011000                    NOP     0

      372    11982    1           CALL IPD$SETSEG(P$,%SPCL2SID);

  11982  6 000201   000032 630400 7                  EPPR0   26
         6 000202   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000203   000000 701000 xent               TSX1    IPD$SETSEG
         6 000204   000000 011000                    NOP     0

      373    11983    1           CALL IPD$MON_VALUE(B$LOOKUP$,LOOKUP$);

  11983  6 000205   000034 630400 7                  EPPR0   28
         6 000206   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000207   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000210   000000 011000                    NOP     0

      374    11984    1           CALL IPD$SETSEG(LOOKUP$,%SPCL2SID);

  11984  6 000211   000036 630400 7                  EPPR0   30
         6 000212   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000213   000000 701000 xent               TSX1    IPD$SETSEG
         6 000214   000000 011000                    NOP     0
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:55   

      375    11985    1           CALL IPD$MON_VALUE(B$USRT$,USRT$);

  11985  6 000215   000040 630400 7                  EPPR0   32
         6 000216   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000217   000000 701000 xent               TSX1    IPD$MON_VALUE
         6 000220   000000 011000                    NOP     0

      376    11986    1           CALL IPD$SETSEG(USRT$,%SPCL2SID);

  11986  6 000221   000042 630400 7                  EPPR0   34
         6 000222   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 000223   000000 701000 xent               TSX1    IPD$SETSEG
         6 000224   000000 011000                    NOP     0

      377    11987        /* Initialize some SPIDER global pointers */
      378    11988    1           BUF$ = PINCRW(B$IS$,VP_BUF*1024);

  11988  6 000225   000000 236000 xsym               LDQ     B$IS$
         6 000226   314000 036003                    ADLQ    104448,DU
         6 000227   002410 756000 1                  STQ     BUF$

      379    11989    1           WSPTD$ = PINCRW(B$IS$,VP_WSPTD*1024);

  11989  6 000230   000000 236000 xsym               LDQ     B$IS$
         6 000231   354000 036003                    ADLQ    120832,DU
         6 000232   002411 756000 1                  STQ     WSPTD$

      380    11990    1           ROSEG$ = PINCRW(B$IS$,VP_ROSEG*1024);

  11990  6 000233   000000 236000 xsym               LDQ     B$IS$
         6 000234   356000 036003                    ADLQ    121856,DU
         6 000235   002412 756000 1                  STQ     ROSEG$

      381    11991    1           PGTBL$ = PINCRW(B$IS$,VP_PGTBL*1024);

  11991  6 000236   000000 236000 xsym               LDQ     B$IS$
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:56   
         6 000237   310000 036003                    ADLQ    102400,DU
         6 000240   002413 756000 1                  STQ     PGTBL$

      382    11992    1           EI$ = DCBADDR(DCBNUM(M$EI));

  11992  6 000241   000000 236007 xsym               LDQ     M$EI,DL
         6 000242   000044 470400 7                  LDP0    36
         6 000243   000000 471500                    LDP1    0,,PR0
         6 000244   100000 236106                    LDQ     0,QL,PR1
         6 000245   002414 756000 1                  STQ     EI$

      383    11993    1           SI$ = DCBADDR(DCBNUM(M$SI));

  11993  6 000246   000000 236007 xsym               LDQ     M$SI,DL
         6 000247   100000 236106                    LDQ     0,QL,PR1
         6 000250   002346 756000 1                  STQ     SI$

      384    11994    1           REMEMBER READ_CMD IN IPA_RESTART;

  11994  6 000251   000264 635000 6                  EAA     READ_CMD
         6 000252   002350 452400 1                  STP2    IPA_RESTART
         6 000253   002351 755000 1                  STA     IPA_RESTART+1

      385    11995    1           CALL M$INT(FPT_INT) ALTRET(TARANTULA);

  11995  6 000254   003230 630400 1                  EPPR0   FPT_INT
         6 000255   410002 713400                    CLIMB   alt,+4098
         6 000256   400000 401760                    pmme    nvectors=1
         6 000257   000617 702000 6                  TSX2    TARANTULA

      386    11996    1           CALL XUR$INIT (XUR_INIT);

  11996  6 000260   000045 630400 7                  EPPR0   37
         6 000261   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 000262   000000 701000 xent               TSX1    XUR$INIT
         6 000263   000000 011000                    NOP     0

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:57   
      387    11997        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:58   
      388    11998        /**/
      389    11999        /* Enter the command-reading loop */
      390    12000        /**/
      391    12001    1   READ_CMD:
      392    12002    2           DO WHILE (%TRUE);

  12002  6 000264                       READ_CMD     null
      393    12003    2             JITERR = JITERR_INIT;

  12003  6 000264   000000 236000 2                  LDQ     JITERR_INIT
         6 000265   002304 756000 1                  STQ     JITERR

      394    12004    2             CALL XUR$GETCMD (SPIDER_CMD, BLK$, VECTOR(T_PROMPT)) ALTRET (PARSE_ERR);

  12004  6 000266   000050 236000 7                  LDQ     40
         6 000267   200072 756100                    STQ     @ERR+3,,AUTO
         6 000270   200020 630500                    EPPR0   BLK$,,AUTO
         6 000271   200071 450500                    STP0    @ERR+2,,AUTO
         6 000272   000051 236000 7                  LDQ     41
         6 000273   200070 756100                    STQ     @ERR+1,,AUTO
         6 000274   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 000275   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 000276   000000 701000 xent               TSX1    XUR$GETCMD
         6 000277   000602 702000 6                  TSX2    PARSE_ERR

      395    12005    2             CALL BUILD_PCNTRL;

  12005  6 000300   001451 701000 6                  TSX1    BUILD_PCNTRL
         6 000301   000000 011000                    NOP     0

      396    12006        /* See if the user is authorized for this command */
      397    12007    2             IF PCNTRL.CMD# <= I_ICMD

  12007  6 000302   200051 235100                    LDA     PCNTRL,,AUTO
         6 000303   000004 115007                    CMPA    4,DL
         6 000304   000312 603000 6                  TRC     s:12009

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:59   
      398    12008    2               THEN CALL M$SPRIV(PPRIV_CHNG) ALTRET(NEED_PRIV);

  12008  6 000305   003224 630400 1                  EPPR0   PPRIV_CHNG
         6 000306   420012 713400                    CLIMB   alt,+8202
         6 000307   400000 401760                    pmme    nvectors=1
         6 000310   000575 702000 6                  TSX2    NEED_PRIV
         6 000311   000324 710000 6                  TRA     OK_2_LOOK

      399    12009    2               ELSE IF PCNTRL.CMD# = I_LCMD

  12009  6 000312   000324 601000 6                  TNZ     OK_2_LOOK

      400    12010    3                 THEN DO;                  /* #31.24                             */

      401    12011    3                     CALL M$SPRIV(PPRIV_LOOK) ALTRET(TRY_CHNG); /* #31.24        */

  12011  6 000313   003220 630400 1                  EPPR0   PPRIV_LOOK
         6 000314   420012 713400                    CLIMB   alt,+8202
         6 000315   400000 401760                    pmme    nvectors=1
         6 000316   000320 702000 6                  TSX2    TRY_CHNG

      402    12012    3                     GOTO OK_2_LOOK;

  12012  6 000317   000324 710000 6                  TRA     OK_2_LOOK

      403    12013    3   TRY_CHNG:         CALL M$SPRIV(PPRIV_CHNG) ALTRET(NEED_PRIV); /* #31.24       */

  12013  6 000320   003224 630400 1     TRY_CHNG     EPPR0   PPRIV_CHNG
         6 000321   420012 713400                    CLIMB   alt,+8202
         6 000322   400000 401760                    pmme    nvectors=1
         6 000323   000575 702000 6                  TSX2    NEED_PRIV

      404    12014    3   OK_2_LOOK:      END;

  12014  6 000324                       OK_2_LOOK    null
      405    12015        /* Find the processor number for PNAME if there is one, and if     */
      406    12016        /* a FID was specified in this command, open M$EI to it, get the   */
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:60   
      407    12017        /* run unit's modification date, and read its HEAD record.         */
      408    12018    2             IF PCNTRL.PNAME$ ~= ADDR(NIL) THEN

  12018  6 000324   200052 236100                    LDQ     PCNTRL+1,,AUTO
         6 000325   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 000326   000352 600000 6                  TZE     NOT_THERE

      409    12019    3                 DO;

      410    12020    3                   CALL FIND_PROC(PCNTRL.PNAME$,PCNTRL.PACCT$,PNUM,PTYPE)

  12020  6 000327   200013 630500                    EPPR0   PTYPE,,AUTO
         6 000330   200066 450500                    STP0    CODE4$+1,,AUTO
         6 000331   200012 631500                    EPPR1   PNUM,,AUTO
         6 000332   200065 451500                    STP1    J+1,,AUTO
         6 000333   200053 633500                    EPPR3   PCNTRL+2,,AUTO
         6 000334   200064 453500                    STP3    @DATE+1,,AUTO
         6 000335   200052 634500                    EPPR4   PCNTRL+1,,AUTO
         6 000336   200063 454500                    STP4    PCNTRL+10,,AUTO
         6 000337   001551 701000 6                  TSX1    FIND_PROC
         6 000340   000352 702000 6                  TSX2    NOT_THERE

      411    12021    3                     ALTRET(NOT_THERE);
      412    12022    3                   PCNTRL.PNUM = PNUM;

  12022  6 000341   200012 720100                    LXL0    PNUM,,AUTO
         6 000342   200057 740100                    STX0    PCNTRL+6,,AUTO

      413    12023    3                   IF (PCNTRL.PTYPE = 0) OR (PCNTRL.CMD# = I_RCMD)

  12023  6 000343   200054 221100                    LDX1    PCNTRL+3,,AUTO
         6 000344   000350 600000 6                  TZE     s:12024
         6 000345   200051 235100                    LDA     PCNTRL,,AUTO
         6 000346   000002 115007                    CMPA    2,DL
         6 000347   000352 601000 6                  TNZ     NOT_THERE

      414    12024    3                     THEN PCNTRL.PTYPE = PTYPE;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:61   

  12024  6 000350   200013 722100                    LXL2    PTYPE,,AUTO
         6 000351   200054 742100                    STX2    PCNTRL+3,,AUTO

      415    12025    3                 END;

      416    12026    2   NOT_THERE:
      417    12027    2             CALL GET_PFLGS(PCNTRL.PTYPE,PFLGS);

  12027  6 000352   200014 630500       NOT_THERE    EPPR0   PFLGS,,AUTO
         6 000353   200064 450500                    STP0    @DATE+1,,AUTO
         6 000354   200054 631500                    EPPR1   PCNTRL+3,,AUTO
         6 000355   200063 451500                    STP1    PCNTRL+10,,AUTO
         6 000356   001726 701000 6                  TSX1    GET_PFLGS
         6 000357   000000 011000                    NOP     0

      418    12028    2             PCNTRL.PFLGS = PFLGS;

  12028  6 000360   200014 236100                    LDQ     PFLGS,,AUTO
         6 000361   200060 756100                    STQ     PCNTRL+7,,AUTO

      419    12029    2             IF PCNTRL.FID$ ~= ADDR(NIL) THEN

  12029  6 000362   200055 236100                    LDQ     PCNTRL+4,,AUTO
         6 000363   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 000364   000500 600000 6                  TZE     s:12079

      420    12030    3                 DO;

      421    12031    3                   CALL OPEN_FID(PCNTRL.FID$) ALTRET(BLACK_WIDOW);

  12031  6 000365   200055 630500                    EPPR0   PCNTRL+4,,AUTO
         6 000366   200063 450500                    STP0    PCNTRL+10,,AUTO
         6 000367   001766 701000 6                  TSX1    OPEN_FID
         6 000370   000541 702000 6                  TSX2    BLACK_WIDOW

      422    12032    3                   IF DCBADDR(DCBNUM(M$EI))->F$DCB.ORG# ~= %KEYED#
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:62   

  12032  6 000371   000000 236007 xsym               LDQ     M$EI,DL
         6 000372   000044 470400 7                  LDP0    36
         6 000373   000000 471500                    LDP1    0,,PR0
         6 000374   100000 473506                    LDP3    0,QL,PR1
         6 000375   300032 236100                    LDQ     26,,PR3
         6 000376   777000 376003                    ANQ     -512,DU
         6 000377   002000 116003                    CMPQ    1024,DU
         6 000400   000570 601000 6                  TNZ     NO_HEAD

      423    12033    3                     THEN
      424    12034    3                     GOTO NO_HEAD;
      425    12035    3                   CALL GET_MODTIME(PCNTRL.MODTIME) ALTRET(ABORT);

  12035  6 000401   200056 633500                    EPPR3   PCNTRL+5,,AUTO
         6 000402   200063 453500                    STP3    PCNTRL+10,,AUTO
         6 000403   002167 701000 6                  TSX1    GET_MODTIME
         6 000404   000626 702000 6                  TSX2    ABORT

      426    12036    3                   CALL M$READ(READ_HEAD) ALTRET(NO_HEAD);

  12036  6 000405   003070 630400 1                  EPPR0   READ_HEAD
         6 000406   440000 713400                    CLIMB   alt,read
         6 000407   401400 401760                    pmme    nvectors=4
         6 000410   000570 702000 6                  TSX2    NO_HEAD

      427    12037    3                   IF (DCBADDR(DCBNUM(M$EI))->F$DCB.ARS# < SIZEC(B$HEAD))

  12037  6 000411   000000 236007 xsym               LDQ     M$EI,DL
         6 000412   000044 470400 7                  LDP0    36
         6 000413   000000 471500                    LDP1    0,,PR0
         6 000414   100000 473506                    LDP3    0,QL,PR1
         6 000415   300000 235100                    LDA     0,,PR3
         6 000416   000240 115007                    CMPA    160,DL
         6 000417   000425 605000 6                  TPL     s:12049

      428    12038    4                     THEN DO;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:63   

      429    12039        /*E*    ERROR: IPA-E$IP_OLDRU-2
      430    12040               MESSAGE: The head record size is invald for this version.
      431    12041                MESSAGE1: The head record size for this run unit does not
      432    12042                            match the head record size for the current running
      433    12043                            system.
      434    12044              */
      435    12045    4                         JITERR.CODE = E$IP_OLDRU;

  12045  6 000420   002304 236000 1                  LDQ     JITERR
         6 000421   000052 376000 7                  ANQ     42
         6 000422   001700 276007                    ORQ     960,DL
         6 000423   002304 756000 1                  STQ     JITERR

      436    12046    4                         GOTO BLACK_WIDOW;

  12046  6 000424   000541 710000 6                  TRA     BLACK_WIDOW

      437    12047    4                       END;
      438    12048
      439    12049    3                   IF B$HEAD.FLAVOR ~= %HOST_RU

  12049  6 000425   002415 473400 1                  LDP3    HEAD$
         6 000426   300022 236100                    LDQ     18,,PR3
         6 000427   777000 376003                    ANQ     -512,DU
         6 000430   001000 116003                    CMPQ    512,DU
         6 000431   000437 600000 6                  TZE     s:12058

      440    12050    4                     THEN DO;

      441    12051        /*E*    ERROR: IPA-E$IP_BADFLAVOR-2
      442    12052                MESSAGE: This run unit is not a host run unit.
      443    12053        */
      444    12054    4                         JITERR.CODE = E$IP_BADFLAVOR;

  12054  6 000432   002304 236000 1                  LDQ     JITERR
         6 000433   000052 376000 7                  ANQ     42
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:64   
         6 000434   001710 276007                    ORQ     968,DL
         6 000435   002304 756000 1                  STQ     JITERR

      445    12055    4                         GOTO BLACK_WIDOW;

  12055  6 000436   000541 710000 6                  TRA     BLACK_WIDOW

      446    12056    4                       END;
      447    12057
      448    12058    3                   IF ((PCNTRL.PTYPE >= I_CP) AND (PCNTRL.PTYPE <= I_ASL)) AND

  12058  6 000437   200054 220100                    LDX0    PCNTRL+3,,AUTO
         6 000440   000024 100003                    CMPX0   20,DU
         6 000441   000461 602000 6                  TNC     s:12068
         6 000442   000027 100003                    CMPX0   23,DU
         6 000443   000461 603000 6                  TRC     s:12068
         6 000444   300002 236100                    LDQ     2,,PR3
         6 000445   000053 316000 7                  CANQ    43
         6 000446   000454 601000 6                  TNZ     s:12065
         6 000447   300010 721100                    LXL1    8,,PR3
         6 000450   000454 601000 6                  TNZ     s:12065
         6 000451   300022 236100                    LDQ     18,,PR3
         6 000452   000010 316003                    CANQ    8,DU
         6 000453   000461 600000 6                  TZE     s:12068

      449    12059    3                     ((B$HEAD.RDATA > 0) OR (B$HEAD.ROSIZE > 0) OR B$HEAD.OVRL)
      450    12060    4                     THEN DO;

      451    12061        /*E*    ERROR:  IPA-E$IP_BADSSP-2
      452    12062                MESSAGE: %FN - Invalid run unit for special shared processor.
      453    12063                MESSAGE1: Special shared processors may not have data or
      454    12064                        a read-only segment. Change your LINK parameters.  */
      455    12065    4                         JITERR.CODE = E$IP_BADSSP;

  12065  6 000454   002304 236000 1                  LDQ     JITERR
         6 000455   000052 376000 7                  ANQ     42
         6 000456   001510 276007                    ORQ     840,DL
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:65   
         6 000457   002304 756000 1                  STQ     JITERR

      456    12066    4                         GOTO BLACK_WIDOW;

  12066  6 000460   000541 710000 6                  TRA     BLACK_WIDOW

      457    12067    4                       END;
      458    12068    3                   IF ((PCNTRL.PTYPE = I_ASL) AND NOT B$HEAD.ASL) OR

  12068  6 000461   000026 100003                    CMPX0   22,DU
         6 000462   000466 601000 6                  TNZ     s:12068+5
         6 000463   300022 236100                    LDQ     18,,PR3
         6 000464   000100 316003                    CANQ    64,DU
         6 000465   000473 600000 6                  TZE     s:12074
         6 000466   000027 100003                    CMPX0   23,DU
         6 000467   000500 601000 6                  TNZ     s:12079
         6 000470   300022 236100                    LDQ     18,,PR3
         6 000471   000200 316003                    CANQ    128,DU
         6 000472   000500 601000 6                  TNZ     s:12079

      459    12069    3                     ((PCNTRL.PTYPE = I_LIB) AND NOT B$HEAD.LIB)
      460    12070    4                     THEN DO;

      461    12071        /*E*    ERROR:  IPA-E$IP_MISMATCH-2
      462    12072                MESSAGE: %FN - Run unit type does not match intended processor type.
      463    12073        */
      464    12074    4                         JITERR.CODE = E$IP_MISMATCH;

  12074  6 000473   002304 236000 1                  LDQ     JITERR
         6 000474   000052 376000 7                  ANQ     42
         6 000475   001520 276007                    ORQ     848,DL
         6 000476   002304 756000 1                  STQ     JITERR

      465    12075    4                         GOTO BLACK_WIDOW;

  12075  6 000477   000541 710000 6                  TRA     BLACK_WIDOW

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:66   
      466    12076    4                       END;
      467    12077    3                 END;
      468    12078        /* Finally, process the command... */
      469    12079    2             PNUM = PCNTRL.PNUM;

  12079  6 000500   200057 235100                    LDA     PCNTRL+6,,AUTO
         6 000501   000022 771000                    ARL     18
         6 000502   200012 755100                    STA     PNUM,,AUTO

      470    12080    3             DO CASE(PCNTRL.CMD#);

  12080  6 000503   200051 236100                    LDQ     PCNTRL,,AUTO
         6 000504   000010 116007                    CMPQ    8,DL
         6 000505   000507 602006 6                  TNC     s:12080+4,QL
         6 000506   000537 710000 6                  TRA     s:12092
         6 000507   000537 710000 6                  TRA     s:12092
         6 000510   000517 710000 6                  TRA     s:12082
         6 000511   000524 710000 6                  TRA     s:12084
         6 000512   000527 710000 6                  TRA     s:12086
         6 000513   000534 710000 6                  TRA     s:12088
         6 000514   000537 710000 6                  TRA     s:12092
         6 000515   000537 710000 6                  TRA     s:12092
         6 000516   000541 710000 6                  TRA     BLACK_WIDOW

      471    12081    3               CASE(I_DCMD);

      472    12082    3                 CALL DEL_CMD('1'B) ALTRET(BLACK_WIDOW); /* DELETE               */

  12082  6 000517   000054 236000 7                  LDQ     44
         6 000520   200065 756100                    STQ     J+1,,AUTO
         6 000521   000631 701000 6                  TSX1    DEL_CMD
         6 000522   000541 702000 6                  TSX2    BLACK_WIDOW
         6 000523   000541 710000 6                  TRA     BLACK_WIDOW

      473    12083    3               CASE(I_RCMD);

      474    12084    3                 CALL REPL_CMD ALTRET(BLACK_WIDOW); /* REPLACE                   */
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:67   

  12084  6 000524   001161 701000 6                  TSX1    REPL_CMD
         6 000525   000541 702000 6                  TSX2    BLACK_WIDOW
         6 000526   000541 710000 6                  TRA     BLACK_WIDOW

      475    12085    3               CASE(I_ICMD);

      476    12086    3                 CALL INSRT_CMD(PROC_SLOT) ALTRET(BLACK_WIDOW); /* INSERT        */

  12086  6 000527   200015 630500                    EPPR0   PROC_SLOT,,AUTO
         6 000530   200065 450500                    STP0    J+1,,AUTO
         6 000531   001041 701000 6                  TSX1    INSRT_CMD
         6 000532   000541 702000 6                  TSX2    BLACK_WIDOW
         6 000533   000541 710000 6                  TRA     BLACK_WIDOW

      477    12087    3               CASE(I_LCMD);

      478    12088    3                 CALL LIST_CMD ALTRET(BLACK_WIDOW); /* LIST                      */

  12088  6 000534   001227 701000 6                  TSX1    LIST_CMD
         6 000535   000541 702000 6                  TSX2    BLACK_WIDOW
         6 000536   000541 710000 6                  TRA     BLACK_WIDOW

      479    12089    3               CASE (I_NULL);              /* NULL COMMAND                       */

      480    12090
      481    12091    3               CASE(ELSE);

      482    12092    3                 CALL M$ERR;

  12092  6 000537   000002 713400                    CLIMB   err
         6 000540   000000 401760                    pmme    nvectors=0

      483    12093    3             END;

      484    12094    2   BLACK_WIDOW:
      485    12095    2             IF JITERR.CODE ~= 0 THEN
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:68   

  12095  6 000541   002304 236000 1     BLACK_WIDOW  LDQ     JITERR
         6 000542   377770 316007                    CANQ    131064,DL
         6 000543   000567 600000 6                  TZE     s:12102

      486    12096    3                 DO;

      487    12097    3                   IF PCNTRL.PNAME$ ~= ADDR(NIL)

  12097  6 000544   200052 236100                    LDQ     PCNTRL+1,,AUTO
         6 000545   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 000546   000561 600000 6                  TZE     s:12099

      488    12098    3                     THEN FPT_ERRMSG.FIELD2_ = VECTOR(PCNTRL.PNAME$->B$TEXTC);

  12098  6 000547   200052 470500                    LDP0    PCNTRL+1,,AUTO
         6 000550   000000 236100                    LDQ     0,,PR0
         6 000551   000033 772000                    QRL     27
         6 000552   000001 620006                    EAX0    1,QL
         6 000553   000000 635010                    EAA     0,X0
         6 000554   000002 771000                    ARL     2
         6 000555   000140 135007                    SBLA    96,DL
         6 000556   200052 236100                    LDQ     PCNTRL+1,,AUTO
         6 000557   002622 757000 1                  STAQ    FPT_ERRMSG+14
         6 000560   000563 710000 6                  TRA     s:12100

      489    12099    3                     ELSE FPT_ERRMSG.FIELD2_ = VECTOR(NIL);

  12099  6 000561   000056 237000 7                  LDAQ    46
         6 000562   002622 757000 1                  STAQ    FPT_ERRMSG+14

      490    12100    3                   CALL M$ERRMSG(FPT_ERRMSG) ALTRET(LOOP_END);

  12100  6 000563   002604 630400 1                  EPPR0   FPT_ERRMSG
         6 000564   420000 713400                    CLIMB   alt,+8192
         6 000565   405000 401760                    pmme    nvectors=11
         6 000566   000612 702000 6                  TSX2    LOOP_END
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:69   

      491    12101    3                 END;

      492    12102    2             GOTO LOOP_END;

  12102  6 000567   000612 710000 6                  TRA     LOOP_END

  12101  6 000570                       NO_HEAD      null
      493    12103        /**/
      494    12104    2   NO_HEAD:  ;
      495    12105        /*E*    ERROR:  IPA-E$IP_BADRU-2
      496    12106                MESSAGE: %FN - Bad run unit.
      497    12107                MESSAGE1: The file you specified was not a run unit.       */
      498    12108    2             JITERR.CODE = E$IP_BADRU;

  12108  6 000570   002304 236000 1                  LDQ     JITERR
         6 000571   000052 376000 7                  ANQ     42
         6 000572   001630 276007                    ORQ     920,DL
         6 000573   002304 756000 1                  STQ     JITERR

      499    12109    2             GOTO BLACK_WIDOW;

  12109  6 000574   000541 710000 6                  TRA     BLACK_WIDOW

      500    12110        /**/
      501    12111    2   NEED_PRIV:
      502    12112        /*E*    ERROR:  IPA-E$IP_NOTAUTH-2
      503    12113                MESSAGE: You are not authorized to use that SPIDER command. */
      504    12114    2             JITERR.CODE = E$IP_NOTAUTH;

  12114  6 000575   002304 236000 1     NEED_PRIV    LDQ     JITERR
         6 000576   000052 376000 7                  ANQ     42
         6 000577   001450 276007                    ORQ     808,DL
         6 000600   002304 756000 1                  STQ     JITERR

      505    12115    2             GOTO BLACK_WIDOW;

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:70   
  12115  6 000601   000541 710000 6                  TRA     BLACK_WIDOW

      506    12116        /**/
      507    12117    2   PARSE_ERR:
      508    12118    2             CALL XUR$ERRMSG (BLK$);

  12118  6 000602   200020 630500       PARSE_ERR    EPPR0   BLK$,,AUTO
         6 000603   200070 450500                    STP0    @ERR+1,,AUTO
         6 000604   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 000605   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 000606   000000 701000 xent               TSX1    XUR$ERRMSG
         6 000607   000000 011000                    NOP     0

      509    12119    2             CALL M$EXIT;

  12119  6 000610   000001 713400                    CLIMB   exit
         6 000611   000000 401760                    pmme    nvectors=0

      510    12120    2   LOOP_END:
      511    12121    2             CALL M$CLOSE(CLOSE_EI) ALTRET(CONT);

  12121  6 000612   003106 630400 1     LOOP_END     EPPR0   CLOSE_EI
         6 000613   450001 713400                    CLIMB   alt,close
         6 000614   406000 401760                    pmme    nvectors=13
         6 000615   000616 702000 6                  TSX2    CONT

      512    12122    2   CONT:
      513    12123    2           END;                  /* End of the (infinite) command reading loop   */

  12123  6 000616   000264 710000 6     CONT         TRA     READ_CMD

      514    12124        /**/
      515    12125        /**/
      516    12126    1   TARANTULA:
      517    12127    1           JITERR = B$JIT.ERR;

  12127  6 000617   000000 470400 xsym  TARANTULA    LDP0    B$JIT$
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:71   
         6 000620   000012 236100                    LDQ     10,,PR0
         6 000621   002304 756000 1                  STQ     JITERR

      518    12128    1   RECLUSE:
      519    12129    1           CALL M$ERRMSG(FPT_ERRMSG) ALTRET(ABORT);

  12129  6 000622   002604 630400 1     RECLUSE      EPPR0   FPT_ERRMSG
         6 000623   420000 713400                    CLIMB   alt,+8192
         6 000624   405000 401760                    pmme    nvectors=11
         6 000625   000626 702000 6                  TSX2    ABORT

      520    12130    1   ABORT:  CALL M$XXX;

  12130  6 000626   000003 713400       ABORT        CLIMB   3
         6 000627   000000 401760                    pmme    nvectors=0
         6 000630   002227 710000 6                  TRA     s:12524

      521    12131        /**/
      522    12132        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:72   
      523    12133        /***************************************************************/
      524    12134        /*                COMMAND INTERPRETERS                         */
      525    12135        /***************************************************************/
      526    12136        /**/
      527    12137        /**/
      528    12138        /************************************/
      529    12139        /*           DELETE                 */
      530    12140        /************************************/
      531    12141    1   DEL_CMD: PROC(DFLG) ALTRET;

  12141  6 000631   200064 741300       DEL_CMD      STX1  ! @DATE+1,,AUTO

      532    12142    2   DCL DFLG BIT(1) ALIGNED;
      533    12143        /**/
      534    12144    2           IF PNUM = 0 OR PNUM >= AUTO_START THEN

  12144  6 000632   200012 235100                    LDA     PNUM,,AUTO
         6 000633   000637 600000 6                  TZE     s:12151
         6 000634   200012 236100                    LDQ     PNUM,,AUTO
         6 000635   002423 116000 1                  CMPQ    AUTO_START
         6 000636   000644 604000 6                  TMI     s:12155

      535    12145    3               DO;

      536    12146        /*E*    ERROR:  IPA-E$IP_NOPROC-2
      537    12147                MESSAGE: %U2 Processor does not exist.
      538    12148                  MESSAGE1: The processor is not in the shared processor area
      539    12149                            of the processor tables.
      540    12150         */
      541    12151    3                 JITERR.CODE = E$IP_NOPROC;

  12151  6 000637   002304 236000 1                  LDQ     JITERR
         6 000640   000052 376000 7                  ANQ     42
         6 000641   001530 276007                    ORQ     856,DL
         6 000642   002304 756000 1                  STQ     JITERR

      542    12152    3                 ALTRETURN;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:73   

  12152  6 000643   000000 702211                    TSX2  ! 0,X1

      543    12153    3               END;
      544    12154        /* Set oldproc flag so this will no be used */
      545    12155    2           B$P.FLGS(PNUM) = B$P.FLGS(PNUM) | %P_OLDPROC;

  12155  6 000644   000042 402007                    MPY     34,DL
         6 000645   002416 470400 1                  LDP0    P$
         6 000646   000027 220106                    LDX0    23,QL,PR0
         6 000647   001000 260003                    ORX0    512,DU
         6 000650   000027 740106                    STX0    23,QL,PR0

      546    12156    3           DO I = 1 TO MUAIS - 1;

  12156  6 000651   000001 235007                    LDA     1,DL
         6 000652   200003 755100                    STA     I,,AUTO
         6 000653   000711 710000 6                  TRA     s:12164+1

      547    12157    3             U$ = ADDR (USRT$->B$USER(I));

  12157  6 000654   200003 236100                    LDQ     I,,AUTO
         6 000655   000026 736000                    QLS     22
         6 000656   002420 036000 1                  ADLQ    USRT$
         6 000657   200023 756100                    STQ     U$,,AUTO

      548    12158    3             IF U$ -> B$U.US ~= %SS_SNULL

  12158  6 000660   200023 470500                    LDP0    U$,,AUTO
         6 000661   000011 236100                    LDQ     9,,PR0
         6 000662   770000 376003                    ANQ     -4096,DU
         6 000663   300000 116003                    CMPQ    98304,DU
         6 000664   000710 600000 6                  TZE     s:12164

      549    12159    3               THEN IF U$ -> B$U.ASP = PNUM

  12159  6 000665   000007 236100                    LDQ     7,,PR0
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:74   
         6 000666   000006 772000                    QRL     6
         6 000667   000077 376007                    ANQ     63,DL
         6 000670   200012 116100                    CMPQ    PNUM,,AUTO
         6 000671   001033 600000 6                  TZE     CANT_DEL
         6 000672   000006 236100                    LDQ     6,,PR0
         6 000673   000022 772000                    QRL     18
         6 000674   000777 376007                    ANQ     511,DL
         6 000675   200012 116100                    CMPQ    PNUM,,AUTO
         6 000676   001033 600000 6                  TZE     CANT_DEL
         6 000677   000006 236100                    LDQ     6,,PR0
         6 000700   000777 376007                    ANQ     511,DL
         6 000701   200012 116100                    CMPQ    PNUM,,AUTO
         6 000702   001033 600000 6                  TZE     CANT_DEL
         6 000703   000006 236100                    LDQ     6,,PR0
         6 000704   000011 772000                    QRL     9
         6 000705   000777 376007                    ANQ     511,DL
         6 000706   200012 116100                    CMPQ    PNUM,,AUTO
         6 000707   001033 600000 6                  TZE     CANT_DEL

      550    12160    3                 OR U$ -> B$U.ACP = PNUM
      551    12161    3                 OR U$ -> B$U.ASL = PNUM
      552    12162    3                 OR U$ -> B$U.DB  = PNUM
      553    12163    3                 THEN GOTO CANT_DEL;
      554    12164    3           END;

  12164  6 000710   200003 054100                    AOS     I,,AUTO
         6 000711   200003 236100                    LDQ     I,,AUTO
         6 000712   002427 116000 1                  CMPQ    MUAIS
         6 000713   000654 604000 6                  TMI     s:12157

      555    12165    3           DO I = 1 TO NPROCS;

  12165  6 000714   000001 235007                    LDA     1,DL
         6 000715   200003 755100                    STA     I,,AUTO
         6 000716   000737 710000 6                  TRA     s:12174+1

      556    12166    4             IF B$P.LIB_LNK(I) = PNUM THEN DO;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:75   

  12166  6 000717   200003 236100                    LDQ     I,,AUTO
         6 000720   000042 402007                    MPY     34,DL
         6 000721   002416 470400 1                  LDP0    P$
         6 000722   000022 236106                    LDQ     18,QL,PR0
         6 000723   000022 772000                    QRL     18
         6 000724   200012 116100                    CMPQ    PNUM,,AUTO
         6 000725   000736 601000 6                  TNZ     s:12174

      557    12167    5                   IF (B$P.FLGS(I) & %P_OLDPROC) THEN DO;

  12167  6 000726   200003 236100                    LDQ     I,,AUTO
         6 000727   000042 402007                    MPY     34,DL
         6 000730   000027 220106                    LDX0    23,QL,PR0
         6 000731   001000 360003                    ANX0    512,DU
         6 000732   001033 600000 6                  TZE     CANT_DEL

      558    12168    5                         IF B$P.UC(I) ~= 0 THEN

  12168  6 000733   000000 235106                    LDA     0,QL,PR0
         6 000734   001033 601000 6                  TNZ     CANT_DEL

      559    12169    5                           GOTO CANT_DEL;
      560    12170    5                       END;

  12170  6 000735   000736 710000 6                  TRA     s:12174

      561    12171    4                     ELSE
      562    12172    4                     GOTO CANT_DEL;
      563    12173    4                 END;
      564    12174    3           END;

  12174  6 000736   200003 054100                    AOS     I,,AUTO
         6 000737   200003 236100                    LDQ     I,,AUTO
         6 000740   002421 116000 1                  CMPQ    NPROCS
         6 000741   000717 604400 6                  TMOZ    s:12166

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:76   
      565    12175    2           CALL IPD$FREE_PROC (PNUM);

  12175  6 000742   200012 630500                    EPPR0   PNUM,,AUTO
         6 000743   200070 450500                    STP0    @ERR+1,,AUTO
         6 000744   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 000745   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 000746   000000 701000 xent               TSX1    IPD$FREE_PROC
         6 000747   000000 011000                    NOP     0

      566    12176    2           CALL IPC$DEL_SPCL(PCNTRL,PNUM,JITERR);

  12176  6 000750   000060 236000 7                  LDQ     48
         6 000751   200072 756100                    STQ     @ERR+3,,AUTO
         6 000752   200012 630500                    EPPR0   PNUM,,AUTO
         6 000753   200071 450500                    STP0    @ERR+2,,AUTO
         6 000754   200051 631500                    EPPR1   PCNTRL,,AUTO
         6 000755   200070 451500                    STP1    @ERR+1,,AUTO
         6 000756   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 000757   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 000760   000000 701000 xent               TSX1    IPC$DEL_SPCL
         6 000761   000000 011000                    NOP     0

      567    12177    2           IF (DFLG) THEN

  12177  6 000762   200065 470500                    LDP0    @DFLG,,AUTO
         6 000763   000000 234100                    SZN     0,,PR0
         6 000764   001024 605000 6                  TPL     s:12190

      568    12178    3               DO;

      569    12179    3                 B$P.FRQ(PNUM) = 0;

  12179  6 000765   200012 236100                    LDQ     PNUM,,AUTO
         6 000766   000042 402007                    MPY     34,DL
         6 000767   002416 471400 1                  LDP1    P$
         6 000770   100001 450106                    STZ     1,QL,PR1

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:77   
      570    12180    3                 IF (PCNTRL.PERM) AND (PNUM < AUTO_START) THEN

  12180  6 000771   200054 236100                    LDQ     PCNTRL+3,,AUTO
         6 000772   400000 316007                    CANQ    -131072,DL
         6 000773   001024 600000 6                  TZE     s:12190
         6 000774   200012 236100                    LDQ     PNUM,,AUTO
         6 000775   002423 116000 1                  CMPQ    AUTO_START
         6 000776   001024 605000 6                  TPL     s:12190

      571    12181    4                     DO;

      572    12182        /* Finally, delete the file from :SYS */
      573    12183    4                       RU_NAME = PCNTRL.PNAME$->B$TEXTC;

  12183  6 000777   200052 471500                    LDP1    PCNTRL+1,,AUTO
         6 001000   100000 236100                    LDQ     0,,PR1
         6 001001   000033 772000                    QRL     27
         6 001002   000001 620006                    EAX0    1,QL
         6 001003   000000 100540                    MLR     fill='000'O
         6 001004   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         6 001005   002730 000040 1                  ADSC9   RU_NAME                  cn=0,n=32

      574    12184    4                       RU_ACCT = SYSACCT;

  12184  6 001006   000000 100400                    MLR     fill='000'O
         6 001007   003061 000010 1                  ADSC9   SYSACCT                  cn=0,n=8
         6 001010   002740 000010 1                  ADSC9   RU_ACCT                  cn=0,n=8

      575    12185    4                       RU_PASS.PASS# = ' ';

  12185  6 001011   000035 235000 xsym               LDA     B_VECTNIL+29
         6 001012   000035 236000 xsym               LDQ     B_VECTNIL+29
         6 001013   002742 757000 1                  STAQ    RU_PASS

      576    12186    4                       CALL M$OPEN(OPEN_EI) ALTRET(DEL_ERR);

  12186  6 001014   002636 630400 1                  EPPR0   OPEN_EI
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:78   
         6 001015   450000 713400                    CLIMB   alt,open
         6 001016   410400 401760                    pmme    nvectors=18
         6 001017   001026 702000 6                  TSX2    DEL_ERR

      577    12187    4                       CALL M$CLOSE(CLOSE_DEL) ALTRET(DEL_ERR);

  12187  6 001020   003144 630400 1                  EPPR0   CLOSE_DEL
         6 001021   450001 713400                    CLIMB   alt,close
         6 001022   406000 401760                    pmme    nvectors=13
         6 001023   001026 702000 6                  TSX2    DEL_ERR

      578    12188    4                     END;

      579    12189    3               END;

      580    12190    2           RETURN;

  12190  6 001024   200064 221300                    LDX1  ! @DATE+1,,AUTO
         6 001025   000001 702211                    TSX2  ! 1,X1

      581    12191        /**/
      582    12192    2   DEL_ERR:
      583    12193    2           JITERR = B$JIT.ERR;

  12193  6 001026   000000 470400 xsym  DEL_ERR      LDP0    B$JIT$
         6 001027   000012 236100                    LDQ     10,,PR0
         6 001030   002304 756000 1                  STQ     JITERR

      584    12194    2           ALTRETURN;

  12194  6 001031   200064 221300                    LDX1  ! @DATE+1,,AUTO
         6 001032   000000 702211                    TSX2  ! 0,X1

      585    12195        /**/
      586    12196    2   CANT_DEL:
      587    12197    2           JITERR.CODE = E$IP_INTERR;

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:79   
  12197  6 001033   002304 236000 1     CANT_DEL     LDQ     JITERR
         6 001034   000052 376000 7                  ANQ     42
         6 001035   001550 276007                    ORQ     872,DL
         6 001036   002304 756000 1                  STQ     JITERR

      588    12198    2           ALTRETURN;

  12198  6 001037   200064 221300                    LDX1  ! @DATE+1,,AUTO
         6 001040   000000 702211                    TSX2  ! 0,X1

      589    12199        /*E*    ERROR:  IPA-E$IP_INTERR-2
      590    12200                MESSAGE: %U2 Processor is in use, marked for deletion. */
      591    12201    2   END DEL_CMD;
      592    12202        /**/
      593    12203        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:80   
      594    12204        /************************************/
      595    12205        /*           INSERT                 */
      596    12206        /************************************/
      597    12207    1   INSRT_CMD: PROC(SLOT) ALTRET;

  12207  6 001041   200064 741300       INSRT_CMD    STX1  ! @DATE+1,,AUTO

      598    12208    2   DCL SLOT SBIN;           /* This parameter is not used for this entry point   */
      599    12209    2           IF PNUM ~= 0 AND PNUM < AUTO_START AND NOT (B$P.FLGS(PNUM)&%P_OLDPROC) THEN

  12209  6 001042   200012 235100                    LDA     PNUM,,AUTO
         6 001043   001061 600000 6                  TZE     s:12218
         6 001044   200012 236100                    LDQ     PNUM,,AUTO
         6 001045   002423 116000 1                  CMPQ    AUTO_START
         6 001046   001061 605000 6                  TPL     s:12218
         6 001047   000042 402007                    MPY     34,DL
         6 001050   002416 470400 1                  LDP0    P$
         6 001051   000027 220106                    LDX0    23,QL,PR0
         6 001052   001000 360003                    ANX0    512,DU
         6 001053   001061 601000 6                  TNZ     s:12218

      600    12210    3               DO;

      601    12211        /*E*    ERROR:  IPA-E$IP_EXISTS-2
      602    12212                MESSAGE: The %U2 processor already exists.
      603    12213                MESSAGE1: The %U2 processor already exists - either DELETE or
      604    12214                          REPLACE it.                                      */
      605    12215    3                 JITERR.CODE = E$IP_EXISTS;

  12215  6 001054   002304 236000 1                  LDQ     JITERR
         6 001055   000052 376000 7                  ANQ     42
         6 001056   001540 276007                    ORQ     864,DL
         6 001057   002304 756000 1                  STQ     JITERR

      606    12216    3                 ALTRETURN;

  12216  6 001060   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:81   

      607    12217    3               END;
      608    12218    2           CALL IPD$GET_SLOT(SLOT) ALTRET(NO_SLOTS);

  12218  6 001061   200065 630500                    EPPR0   @SLOT,,AUTO
         6 001062   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 001063   000000 701000 xent               TSX1    IPD$GET_SLOT
         6 001064   001153 702000 6                  TSX2    NO_SLOTS

      609    12219    2           B$P.FRQ(SLOT) = 0;

  12219  6 001065   200065 470500                    LDP0    @SLOT,,AUTO
         6 001066   000000 236100                    LDQ     0,,PR0
         6 001067   000021 402007                    MPY     17,DL
         6 001070   000001 736000                    QLS     1
         6 001071   002416 471400 1                  LDP1    P$
         6 001072   100001 450106                    STZ     1,QL,PR1

      610    12220    2           PCNTRL.PERM = '1'B;             /* Always copy file on INSERT         */

  12220  6 001073   400000 236007                    LDQ     -131072,DL
         6 001074   200054 256100                    ORSQ    PCNTRL+3,,AUTO
         6 001075   001077 710000 6                  TRA     s:12224

      611    12221        /**/
      612    12222    2   REPL_THIS: ENTRY(SLOT) ALTRET;

  12222  6 001076   200064 741300       REPL_THIS    STX1  ! @DATE+1,,AUTO

      613    12223        /**/
      614    12224    2           IF (PCNTRL.PTYPE >= I_CP) AND (PCNTRL.PTYPE <= I_ASL)

  12224  6 001077   200054 220100                    LDX0    PCNTRL+3,,AUTO
         6 001100   000024 100003                    CMPX0   20,DU
         6 001101   001117 602000 6                  TNC     s:12226
         6 001102   000027 100003                    CMPX0   23,DU
         6 001103   001117 603000 6                  TRC     s:12226
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:82   

      615    12225    2             THEN CALL IPC$ADD_SPCL(PCNTRL,SLOT,JITERR) ALTRET(INSRT_ERR);

  12225  6 001104   000060 236000 7                  LDQ     48
         6 001105   200072 756100                    STQ     @ERR+3,,AUTO
         6 001106   200065 236100                    LDQ     @SLOT,,AUTO
         6 001107   200071 756100                    STQ     @ERR+2,,AUTO
         6 001110   200051 630500                    EPPR0   PCNTRL,,AUTO
         6 001111   200070 450500                    STP0    @ERR+1,,AUTO
         6 001112   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001113   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 001114   000000 701000 xent               TSX1    IPC$ADD_SPCL
         6 001115   001157 702000 6                  TSX2    INSRT_ERR
         6 001116   001142 710000 6                  TRA     s:12235

      616    12226    2             ELSE IF PCNTRL.PTYPE = I_LIB

  12226  6 001117   000027 100003                    CMPX0   23,DU
         6 001120   001134 601000 6                  TNZ     s:12231

      617    12227    2               THEN CALL IPC$ADD_LIB(PCNTRL,SLOT,JITERR) ALTRET(INSRT_ERR);

  12227  6 001121   000060 236000 7                  LDQ     48
         6 001122   200072 756100                    STQ     @ERR+3,,AUTO
         6 001123   200065 236100                    LDQ     @SLOT,,AUTO
         6 001124   200071 756100                    STQ     @ERR+2,,AUTO
         6 001125   200051 630500                    EPPR0   PCNTRL,,AUTO
         6 001126   200070 450500                    STP0    @ERR+1,,AUTO
         6 001127   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001130   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 001131   000000 701000 xent               TSX1    IPC$ADD_LIB
         6 001132   001157 702000 6                  TSX2    INSRT_ERR
         6 001133   001142 710000 6                  TRA     s:12235

      618    12228    3               ELSE DO;

      619    12229        /*E*    ERROR:  IPA-E$IP_NOTYPE-2
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:83   
      620    12230                MESSAGE: Processor type must be specified for %U2.         */
      621    12231    3                   JITERR.CODE = E$IP_NOTYPE;

  12231  6 001134   002304 236000 1                  LDQ     JITERR
         6 001135   000052 376000 7                  ANQ     42
         6 001136   001620 276007                    ORQ     912,DL
         6 001137   002304 756000 1                  STQ     JITERR

      622    12232    3                   ALTRETURN;

  12232  6 001140   200064 221300                    LDX1  ! @DATE+1,,AUTO
         6 001141   000000 702211                    TSX2  ! 0,X1

      623    12233    3                 END;
      624    12234        /* Move the run unit into :SYS */
      625    12235    2           IF PCNTRL.PERM THEN

  12235  6 001142   200054 236100                    LDQ     PCNTRL+3,,AUTO
         6 001143   400000 316007                    CANQ    -131072,DL
         6 001144   001151 600000 6                  TZE     s:12237

      626    12236    2             CALL MOVE_PROC(JITERR) ALTRET(INSRT_ERR);

  12236  6 001145   000060 236000 7                  LDQ     48
         6 001146   200067 756100                    STQ     @PTYPE+1,,AUTO
         6 001147   002032 701000 6                  TSX1    MOVE_PROC
         6 001150   001157 702000 6                  TSX2    INSRT_ERR

      627    12237    2           RETURN;

  12237  6 001151   200064 221300                    LDX1  ! @DATE+1,,AUTO
         6 001152   000001 702211                    TSX2  ! 1,X1

  12235  6 001153                       NO_SLOTS     null
      628    12238        /**/
      629    12239    2   NO_SLOTS:;
      630    12240        /*E*    ERROR:  IPA-E$IP_NOSLOTS-2
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:84   
      631    12241                MESSAGE: There are currently no free processor slots.
      632    12242                MESSAGE1: There are no free processor slots at the moment. Wait
      633    12243                          a while and/or try 'REPLACE'.                        */
      634    12244    2           JITERR.CODE = E$IP_NOSLOTS;

  12244  6 001153   002304 236000 1                  LDQ     JITERR
         6 001154   000052 376000 7                  ANQ     42
         6 001155   001560 276007                    ORQ     880,DL
         6 001156   002304 756000 1                  STQ     JITERR

      635    12245    2   INSRT_ERR:
      636    12246    2           ALTRETURN;

  12246  6 001157   200064 221300       INSRT_ERR    LDX1  ! @DATE+1,,AUTO
         6 001160   000000 702211                    TSX2  ! 0,X1

      637    12247    2   END INSRT_CMD;
      638    12248        /**/
      639    12249        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:85   
      640    12250        /************************************/
      641    12251        /*           REPLACE                */
      642    12252        /************************************/
      643    12253    1   REPL_CMD: PROC ALTRET;

  12253  6 001161   200062 741300       REPL_CMD     STX1  ! PCNTRL+9,,AUTO

      644    12254    2           CALL DEL_CMD('0'B)

  12254  6 001162   000061 236000 7                  LDQ     49
         6 001163   200065 756100                    STQ     @SLOT,,AUTO
         6 001164   000631 701000 6                  TSX1    DEL_CMD
         6 001165   001167 702000 6                  TSX2    s:12256
         6 001166   001173 710000 6                  TRA     s:12260

      645    12255    3             WHENALTRETURN DO;

      646    12256    3                 IF JITERR.CODE ~= E$IP_INTERR

  12256  6 001167   002304 236000 1                  LDQ     JITERR
         6 001170   377770 376007                    ANQ     131064,DL
         6 001171   001550 116007                    CMPQ    872,DL
         6 001172   001225 601000 6                  TNZ     REPL_ERR

      647    12257    3                   THEN
      648    12258    3                   GOTO REPL_ERR;
      649    12259    3               END;

      650    12260    2           IF B$P.NAME.TEXT(PNUM) = TC_FREE.TEXT

  12260  6 001173   200012 236100                    LDQ     PNUM,,AUTO
         6 001174   000210 402007                    MPY     136,DL
         6 001175   002416 470400 1                  LDP0    P$
         6 001176   040000 106506                    CMPC    fill='040'O
         6 001177   000032 200037                    ADSC9   26,Q,PR0                 cn=1,n=31
         6 001200   002522 200005 1                  ADSC9   TC_FREE                  cn=1,n=5
         6 001201   001205 601000 6                  TNZ     s:12262
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:86   

      651    12261    2             THEN PROC_SLOT = PNUM;

  12261  6 001202   200012 235100                    LDA     PNUM,,AUTO
         6 001203   200015 755100                    STA     PROC_SLOT,,AUTO
         6 001204   001213 710000 6                  TRA     s:12263

      652    12262    2             ELSE CALL IPD$GET_SLOT(PROC_SLOT) ALTRET(NO_SLOTS2);

  12262  6 001205   200015 631500                    EPPR1   PROC_SLOT,,AUTO
         6 001206   200070 451500                    STP1    @ERR+1,,AUTO
         6 001207   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 001211   000000 701000 xent               TSX1    IPD$GET_SLOT
         6 001212   001221 702000 6                  TSX2    NO_SLOTS2

      653    12263    2           CALL REPL_THIS(PROC_SLOT) ALTRET(REPL_ERR);

  12263  6 001213   200015 630500                    EPPR0   PROC_SLOT,,AUTO
         6 001214   200065 450500                    STP0    @SLOT,,AUTO
         6 001215   001076 701000 6                  TSX1    REPL_THIS
         6 001216   001225 702000 6                  TSX2    REPL_ERR

      654    12264    2           RETURN;

  12264  6 001217   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 001220   000001 702211                    TSX2  ! 1,X1

  12260  6 001221                       NO_SLOTS2    null
      655    12265        /**/
      656    12266    2   NO_SLOTS2:;
      657    12267    2           JITERR.CODE = E$IP_NOSLOTS;

  12267  6 001221   002304 236000 1                  LDQ     JITERR
         6 001222   000052 376000 7                  ANQ     42
         6 001223   001560 276007                    ORQ     880,DL
         6 001224   002304 756000 1                  STQ     JITERR
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:87   

      658    12268    2   REPL_ERR:
      659    12269    2           ALTRETURN;

  12269  6 001225   200062 221300       REPL_ERR     LDX1  ! PCNTRL+9,,AUTO
         6 001226   000000 702211                    TSX2  ! 0,X1

      660    12270    2   END REPL_CMD;
      661    12271        /**/
      662    12272        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:88   
      663    12273        /************************************/
      664    12274        /*           LIST                   */
      665    12275        /************************************/
      666    12276    1   LIST_CMD: PROC ALTRET;

  12276  6 001227   200062 741300       LIST_CMD     STX1  ! PCNTRL+9,,AUTO

      667    12277    2           IF (PCNTRL.PNAME$ ~= ADDR(NIL)) AND (PNUM = 0) THEN

  12277  6 001230   200052 236100                    LDQ     PCNTRL+1,,AUTO
         6 001231   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 001232   001242 600000 6                  TZE     s:12282
         6 001233   200012 235100                    LDA     PNUM,,AUTO
         6 001234   001242 601000 6                  TNZ     s:12282

      668    12278    3               DO;

      669    12279    3                 JITERR.CODE = E$IP_NOPROC;

  12279  6 001235   002304 236000 1                  LDQ     JITERR
         6 001236   000052 376000 7                  ANQ     42
         6 001237   001530 276007                    ORQ     856,DL
         6 001240   002304 756000 1                  STQ     JITERR

      670    12280    3                 ALTRETURN;

  12280  6 001241   000000 702211                    TSX2  ! 0,X1

      671    12281    3               END;
      672    12282    2           IF PNUM ~= 0

  12282  6 001242   200012 235100                    LDA     PNUM,,AUTO
         6 001243   001274 600000 6                  TZE     s:12297

      673    12283        /* Print the list information for a single named program. */
      674    12284    3             THEN DO;

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:89   
      675    12285    3                 CALL IPE$LIST1_HDR;

  12285  6 001244   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001245   000000 701000 xent               TSX1    IPE$LIST1_HDR
         6 001246   000000 011000                    NOP     0

      676    12286    3                 CALL IPE$LIST1_INFO(PNUM);

  12286  6 001247   200012 630500                    EPPR0   PNUM,,AUTO
         6 001250   200070 450500                    STP0    @ERR+1,,AUTO
         6 001251   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001252   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 001253   000000 701000 xent               TSX1    IPE$LIST1_INFO
         6 001254   000000 011000                    NOP     0

      677    12287                      %PRINT(STR=T_CRLF);

  12288  6 001255   000062 237000 7                  LDAQ    50
         6 001256   002574 757000 1                  STAQ    WRITE_LO+4

  12289  6 001257   002570 630400 1                  EPPR0   WRITE_LO
         6 001260   040001 713400                    CLIMB   write
         6 001261   401400 401760                    pmme    nvectors=4

      678    12291    3                 CALL IPE$LIST2_HDR;

  12291  6 001262   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001263   000000 701000 xent               TSX1    IPE$LIST2_HDR
         6 001264   000000 011000                    NOP     0

      679    12292    3                 CALL IPE$LIST2_INFO(PNUM);

  12292  6 001265   200012 630500                    EPPR0   PNUM,,AUTO
         6 001266   200070 450500                    STP0    @ERR+1,,AUTO
         6 001267   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001270   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 001271   000000 701000 xent               TSX1    IPE$LIST2_INFO
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:90   
         6 001272   000000 011000                    NOP     0

      680    12293    3               END;

  12293  6 001273   001447 710000 6                  TRA     s:12343

      681    12294        /* Print the list information for system and/or auto-shared programs */
      682    12295    3             ELSE DO;

      683    12296        /* Do the system processors first...   */
      684    12297    3                 IF NOT PCNTRL.LIST_AUTO THEN

  12297  6 001274   200054 236100                    LDQ     PCNTRL+3,,AUTO
         6 001275   100000 316007                    CANQ    32768,DL
         6 001276   001356 601000 6                  TNZ     s:12321

      685    12298    4                     DO;

      686    12299                            %PRINT(STR=T_SYSPROCS);

  12300  6 001277   000064 237000 7                  LDAQ    52
         6 001300   002574 757000 1                  STAQ    WRITE_LO+4

  12301  6 001301   002570 630400 1                  EPPR0   WRITE_LO
         6 001302   040001 713400                    CLIMB   write
         6 001303   401400 401760                    pmme    nvectors=4

      687    12303    4                       CALL IPE$LIST1_HDR;

  12303  6 001304   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001305   000000 701000 xent               TSX1    IPE$LIST1_HDR
         6 001306   000000 011000                    NOP     0

      688    12304    5                       DO I = 1 TO NPROCS;

  12304  6 001307   000001 235007                    LDA     1,DL
         6 001310   200003 755100                    STA     I,,AUTO
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:91   
         6 001311   001321 710000 6                  TRA     s:12306+1

      689    12305    5                         CALL IPE$LIST1_INFO(I);

  12305  6 001312   200003 630500                    EPPR0   I,,AUTO
         6 001313   200070 450500                    STP0    @ERR+1,,AUTO
         6 001314   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001315   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 001316   000000 701000 xent               TSX1    IPE$LIST1_INFO
         6 001317   000000 011000                    NOP     0

      690    12306    5                       END;

  12306  6 001320   200003 054100                    AOS     I,,AUTO
         6 001321   200003 236100                    LDQ     I,,AUTO
         6 001322   002421 116000 1                  CMPQ    NPROCS
         6 001323   001312 604400 6                  TMOZ    s:12305

      691    12307                            %PRINT(STR=T_CRLF);

  12308  6 001324   000062 237000 7                  LDAQ    50
         6 001325   002574 757000 1                  STAQ    WRITE_LO+4

  12309  6 001326   002570 630400 1                  EPPR0   WRITE_LO
         6 001327   040001 713400                    CLIMB   write
         6 001330   401400 401760                    pmme    nvectors=4

      692    12311    4                       CALL IPE$LIST2_HDR;

  12311  6 001331   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001332   000000 701000 xent               TSX1    IPE$LIST2_HDR
         6 001333   000000 011000                    NOP     0

      693    12312    5                       DO I = 1 TO NPROCS;

  12312  6 001334   000001 235007                    LDA     1,DL
         6 001335   200003 755100                    STA     I,,AUTO
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:92   
         6 001336   001346 710000 6                  TRA     s:12314+1

      694    12313    5                         CALL IPE$LIST2_INFO(I);

  12313  6 001337   200003 630500                    EPPR0   I,,AUTO
         6 001340   200070 450500                    STP0    @ERR+1,,AUTO
         6 001341   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001342   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 001343   000000 701000 xent               TSX1    IPE$LIST2_INFO
         6 001344   000000 011000                    NOP     0

      695    12314    5                       END;

  12314  6 001345   200003 054100                    AOS     I,,AUTO
         6 001346   200003 236100                    LDQ     I,,AUTO
         6 001347   002421 116000 1                  CMPQ    NPROCS
         6 001350   001337 604400 6                  TMOZ    s:12313

      696    12315                            %PRINT(STR=T_CRLF);

  12316  6 001351   000062 237000 7                  LDAQ    50
         6 001352   002574 757000 1                  STAQ    WRITE_LO+4

  12317  6 001353   002570 630400 1                  EPPR0   WRITE_LO
         6 001354   040001 713400                    CLIMB   write
         6 001355   401400 401760                    pmme    nvectors=4

      697    12319    4                     END;

      698    12320        /* Now print the list information for the auto_shared programs. */
      699    12321    3                 IF (MAX_LOOKUP > 0) AND NOT PCNTRL.LIST_SYS THEN

  12321  6 001356   002426 235000 1                  LDA     MAX_LOOKUP
         6 001357   001447 604400 6                  TMOZ    s:12343
         6 001360   200054 236100                    LDQ     PCNTRL+3,,AUTO
         6 001361   200000 316007                    CANQ    65536,DL
         6 001362   001447 601000 6                  TNZ     s:12343
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:93   

      700    12322    4                     DO;

      701    12323                            %PRINT(STR=T_AUTOPROCS);

  12324  6 001363   000066 237000 7                  LDAQ    54
         6 001364   002574 757000 1                  STAQ    WRITE_LO+4

  12325  6 001365   002570 630400 1                  EPPR0   WRITE_LO
         6 001366   040001 713400                    CLIMB   write
         6 001367   401400 401760                    pmme    nvectors=4

      702    12327    4                       CALL IPE$LIST1_HDR;

  12327  6 001370   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001371   000000 701000 xent               TSX1    IPE$LIST1_HDR
         6 001372   000000 011000                    NOP     0

      703    12328    5                       DO I = AUTO_START TO AUTO_START + MAX_LOOKUP - 1;

  12328  6 001373   002423 235000 1                  LDA     AUTO_START
         6 001374   200003 755100                    STA     I,,AUTO
         6 001375   001411 710000 6                  TRA     s:12331+1

      704    12329    5                         PNUM = B$LOOKUP(I);

  12329  6 001376   002417 470400 1                  LDP0    LOOKUP$
         6 001377   200003 720100                    LXL0    I,,AUTO
         6 001400   000000 235110                    LDA     0,X0,PR0
         6 001401   200012 755100                    STA     PNUM,,AUTO

      705    12330    5                         CALL IPE$LIST1_INFO(PNUM);

  12330  6 001402   200012 631500                    EPPR1   PNUM,,AUTO
         6 001403   200070 451500                    STP1    @ERR+1,,AUTO
         6 001404   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001405   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:94   
         6 001406   000000 701000 xent               TSX1    IPE$LIST1_INFO
         6 001407   000000 011000                    NOP     0

      706    12331    5                       END;

  12331  6 001410   200003 054100                    AOS     I,,AUTO
         6 001411   002423 236000 1                  LDQ     AUTO_START
         6 001412   002426 036000 1                  ADLQ    MAX_LOOKUP
         6 001413   200003 116100                    CMPQ    I,,AUTO
         6 001414   001376 605400 6                  TPNZ    s:12329

      707    12332                            %PRINT(STR=T_CRLF);

  12333  6 001415   000062 237000 7                  LDAQ    50
         6 001416   002574 757000 1                  STAQ    WRITE_LO+4

  12334  6 001417   002570 630400 1                  EPPR0   WRITE_LO
         6 001420   040001 713400                    CLIMB   write
         6 001421   401400 401760                    pmme    nvectors=4

      708    12336    4                       CALL IPE$LIST2_HDR;

  12336  6 001422   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001423   000000 701000 xent               TSX1    IPE$LIST2_HDR
         6 001424   000000 011000                    NOP     0

      709    12337    5                       DO I = AUTO_START TO AUTO_START + MAX_LOOKUP - 1;

  12337  6 001425   002423 235000 1                  LDA     AUTO_START
         6 001426   200003 755100                    STA     I,,AUTO
         6 001427   001443 710000 6                  TRA     s:12340+1

      710    12338    5                         PNUM = B$LOOKUP(I);

  12338  6 001430   002417 470400 1                  LDP0    LOOKUP$
         6 001431   200003 720100                    LXL0    I,,AUTO
         6 001432   000000 235110                    LDA     0,X0,PR0
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:95   
         6 001433   200012 755100                    STA     PNUM,,AUTO

      711    12339    5                         CALL IPE$LIST2_INFO(PNUM);

  12339  6 001434   200012 631500                    EPPR1   PNUM,,AUTO
         6 001435   200070 451500                    STP1    @ERR+1,,AUTO
         6 001436   200070 630500                    EPPR0   @ERR+1,,AUTO
         6 001437   000017 631400 xsym               EPPR1   B_VECTNIL+15
         6 001440   000000 701000 xent               TSX1    IPE$LIST2_INFO
         6 001441   000000 011000                    NOP     0

      712    12340    5                       END;

  12340  6 001442   200003 054100                    AOS     I,,AUTO
         6 001443   002423 236000 1                  LDQ     AUTO_START
         6 001444   002426 036000 1                  ADLQ    MAX_LOOKUP
         6 001445   200003 116100                    CMPQ    I,,AUTO
         6 001446   001430 605400 6                  TPNZ    s:12338

      713    12341    4                     END;

      714    12342    3               END;

      715    12343    2           RETURN;

  12343  6 001447   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 001450   000001 702211                    TSX2  ! 1,X1

      716    12344    2   END LIST_CMD;
      717    12345        /**/
      718    12346        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:96   
      719    12347        /***************************************************************/
      720    12348        /*                 INTERNAL PROCEDURES                         */
      721    12349        /***************************************************************/
      722    12350        /**/
      723    12351        /* This procedure builds the control block used to drive the       */
      724    12352        /* command interpreters, based on the parse tree output by         */
      725    12353        /* M$PARSE.                                                        */
      726    12354    1   BUILD_PCNTRL: PROC;

  12354  6 001451   200062 741300       BUILD_PCNTRL STX1  ! PCNTRL+9,,AUTO

      727    12355    2   DCL VAL SBIN;
      728    12356    2           PCNTRL = PCNTRL_INIT;

  12356  6 001452   000100 100400                    MLR     fill='000'O
         6 001453   002270 000040 1                  ADSC9   PCNTRL_INIT              cn=0,n=32
         6 001454   200051 000040                    ADSC9   PCNTRL,,AUTO             cn=0,n=32

      729    12357    2           PCNTRL.CMD# = BLK$->OUT$BLK.CODE;

  12357  6 001455   200020 470500                    LDP0    BLK$,,AUTO
         6 001456   000000 236100                    LDQ     0,,PR0
         6 001457   777777 376007                    ANQ     -1,DL
         6 001460   200051 756100                    STQ     PCNTRL,,AUTO

      730    12358    3           DO I = 0 TO BLK$->OUT$BLK.NSUBLKS - 1;

  12358  6 001461   200003 450100                    STZ     I,,AUTO
         6 001462   001543 710000 6                  TRA     s:12381+1

      731    12359    3             BLK2$ = OUT$BLK.SUBLK$(I);

  12359  6 001463   200020 470500                    LDP0    BLK$,,AUTO
         6 001464   200003 720100                    LXL0    I,,AUTO
         6 001465   000003 236110                    LDQ     3,X0,PR0
         6 001466   200021 756100                    STQ     BLK2$,,AUTO

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:97   
      732    12360    3             NODE_TYPE = BLK2$->OUT$BLK.CODE;

  12360  6 001467   200021 471500                    LDP1    BLK2$,,AUTO
         6 001470   100000 236100                    LDQ     0,,PR1
         6 001471   777777 376007                    ANQ     -1,DL
         6 001472   200011 756100                    STQ     NODE_TYPE,,AUTO

      733    12361    3             IF NODE_TYPE = I_PNAME

  12361  6 001473   000012 116007                    CMPQ    10,DL
         6 001474   001477 601000 6                  TNZ     s:12363

      734    12362    3               THEN PCNTRL.PNAME$ = BLK2$->OUT$SYM.TEXTC$;

  12362  6 001475   100003 236100                    LDQ     3,,PR1
         6 001476   200052 756100                    STQ     PCNTRL+1,,AUTO

      735    12363    3             IF NODE_TYPE = I_PACCT

  12363  6 001477   200011 235100                    LDA     NODE_TYPE,,AUTO
         6 001500   000015 115007                    CMPA    13,DL
         6 001501   001513 601000 6                  TNZ     s:12369

      736    12364    4               THEN DO;

      737    12365        /* Make our own 2-word copy of the ACCT string with trailing blanks. */
      738    12366    4                   PACCT = BLK2$->OUT$SYM.TEXTC$->B$TEXTC.TEXT;

  12366  6 001502   100003 473500                    LDP3    3,,PR1
         6 001503   300000 236100                    LDQ     0,,PR3
         6 001504   000033 772000                    QRL     27
         6 001505   000000 621006                    EAX1    0,QL
         6 001506   040100 100540                    MLR     fill='040'O
         6 001507   300000 200011                    ADSC9   0,,PR3                   cn=1,n=*X1
         6 001510   200016 000010                    ADSC9   PACCT,,AUTO              cn=0,n=8

      739    12367    4                   PCNTRL.PACCT$ = ADDR(PACCT);
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:98   

  12367  6 001511   200016 633500                    EPPR3   PACCT,,AUTO
         6 001512   200053 453500                    STP3    PCNTRL+2,,AUTO

      740    12368    4                 END;

      741    12369    3             IF NODE_TYPE = I_SYS

  12369  6 001513   000016 115007                    CMPA    14,DL
         6 001514   001517 601000 6                  TNZ     s:12371

      742    12370    3               THEN PCNTRL.LIST_SYS = '1'B;

  12370  6 001515   200000 236007                    LDQ     65536,DL
         6 001516   200054 256100                    ORSQ    PCNTRL+3,,AUTO

      743    12371    3             IF NODE_TYPE = I_AUTO

  12371  6 001517   000017 115007                    CMPA    15,DL
         6 001520   001523 601000 6                  TNZ     s:12373

      744    12372    3               THEN PCNTRL.LIST_AUTO = '1'B;

  12372  6 001521   100000 236007                    LDQ     32768,DL
         6 001522   200054 256100                    ORSQ    PCNTRL+3,,AUTO

      745    12373    3             IF (NODE_TYPE >= I_CP) AND (NODE_TYPE <= I_LIB) THEN

  12373  6 001523   000024 115007                    CMPA    20,DL
         6 001524   001531 604000 6                  TMI     s:12377
         6 001525   000027 115007                    CMPA    23,DL
         6 001526   001531 605400 6                  TPNZ    s:12377

      746    12374    4                 DO;

      747    12375    4                   PCNTRL.PTYPE = NODE_TYPE;

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:99   
  12375  6 001527   000000 621005                    EAX1    0,AL
         6 001530   200054 741100                    STX1    PCNTRL+3,,AUTO

      748    12376    4                 END;

      749    12377    3             IF NODE_TYPE = I_FID

  12377  6 001531   200011 235100                    LDA     NODE_TYPE,,AUTO
         6 001532   000013 115007                    CMPA    11,DL
         6 001533   001536 601000 6                  TNZ     s:12379

      750    12378    3               THEN PCNTRL.FID$ = BLK2$->OUT$SYM.TEXTC$;

  12378  6 001534   100003 236100                    LDQ     3,,PR1
         6 001535   200055 756100                    STQ     PCNTRL+4,,AUTO

      751    12379    3             IF NODE_TYPE = I_PERM

  12379  6 001536   000014 115007                    CMPA    12,DL
         6 001537   001542 601000 6                  TNZ     s:12381

      752    12380    3               THEN PCNTRL.PERM = '1'B;

  12380  6 001540   400000 236007                    LDQ     -131072,DL
         6 001541   200054 256100                    ORSQ    PCNTRL+3,,AUTO

      753    12381    3           END;

  12381  6 001542   200003 054100                    AOS     I,,AUTO
         6 001543   000001 236100                    LDQ     1,,PR0
         6 001544   000022 772000                    QRL     18
         6 001545   200003 116100                    CMPQ    I,,AUTO
         6 001546   001463 605400 6                  TPNZ    s:12359

      754    12382    2           RETURN;

  12382  6 001547   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:100  
         6 001550   000001 702211                    TSX2  ! 1,X1

      755    12383    2   END BUILD_PCNTRL;
      756    12384        /**/
      757    12385        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:101  
      758    12386        /**/
      759    12387        /* This routine searches the processor tables for a particular     */
      760    12388        /* processor name and returns its number and type, if it exists.   */
      761    12389        /* If its name isn't there, the ALTRETURN is taken.                */
      762    12390    1   FIND_PROC: PROC(PNAME$,PACCT$,PNUM,PTYPE) ALTRET;

  12390  6 001551   200062 741300       FIND_PROC    STX1  ! PCNTRL+9,,AUTO

      763    12391    2   DCL PNAME$ PTR;
      764    12392    2   DCL PACCT$ PTR;
      765    12393    2   DCL PNUM SBIN;
      766    12394    2   DCL PTYPE SBIN;
      767    12395    2   DCL PN SBIN;
      768    12396        /**/
      769    12397        /* First, search the system (or fixed) portion of the shared pro-
      770    12398           cessor tables for the given procesor name.                      */
      771    12399    2           IF PACCT$->B$CHAR8 = IPA_SYSACCT

  12399  6 001552   200064 470500                    LDP0    @PACCT$,,AUTO
         6 001553   000000 471500                    LDP1    0,,PR0
         6 001554   040000 106500                    CMPC    fill='040'O
         6 001555   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         6 001556   002441 000010 1                  ADSC9   IPA_SYSACCT              cn=0,n=8
         6 001557   001610 601000 6                  TNZ     s:12407

      772    12400    3             THEN DO PN = 1 TO NPROCS;

  12400  6 001560   000001 235007                    LDA     1,DL
         6 001561   200067 755100                    STA     PN,,AUTO
         6 001562   001605 710000 6                  TRA     s:12404+1

      773    12401    3                 IF  NOT (B$P.FLGS(PN) & %P_OLDPROC)

  12401  6 001563   200067 236100                    LDQ     PN,,AUTO
         6 001564   000042 402007                    MPY     34,DL
         6 001565   002416 470400 1                  LDP0    P$
         6 001566   000027 220106                    LDX0    23,QL,PR0
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:102  
         6 001567   001000 360003                    ANX0    512,DU
         6 001570   001604 601000 6                  TNZ     s:12404
         6 001571   200063 471500                    LDP1    @PNAME$,,AUTO
         6 001572   100000 473500                    LDP3    0,,PR1
         6 001573   300000 236100                    LDQ     0,,PR3
         6 001574   000033 772000                    QRL     27
         6 001575   000000 620006                    EAX0    0,QL
         6 001576   200067 236100                    LDQ     PN,,AUTO
         6 001577   000210 402007                    MPY     136,DL
         6 001600   040106 106540                    CMPC    fill='040'O
         6 001601   300000 200010                    ADSC9   0,,PR3                   cn=1,n=*X0
         6 001602   000032 200037                    ADSC9   26,Q,PR0                 cn=1,n=31
         6 001603   001650 600000 6                  TZE     GOTPROC

      774    12402    3                   AND (PNAME$->B$TEXTC.TEXT = B$P.NAME.TEXT(PN))
      775    12403    3                   THEN GOTO GOTPROC;
      776    12404    3               END;

  12404  6 001604   200067 054100                    AOS     PN,,AUTO
         6 001605   200067 236100                    LDQ     PN,,AUTO
         6 001606   002421 116000 1                  CMPQ    NPROCS
         6 001607   001563 604400 6                  TMOZ    s:12401

      777    12405        /* Now, search the automatic sharing (user, generally) portion of the
      778    12406           tables for the given program name, assuming the account is :SYS */
      779    12407    3           DO PN = AUTO_START TO USED_AUTO;

  12407  6 001610   002423 235000 1                  LDA     AUTO_START
         6 001611   200067 755100                    STA     PN,,AUTO
         6 001612   001643 710000 6                  TRA     s:12412+1

      780    12408    3             IF  NOT (B$P.FLGS(PN) & %P_OLDPROC)

  12408  6 001613   200067 236100                    LDQ     PN,,AUTO
         6 001614   000042 402007                    MPY     34,DL
         6 001615   002416 470400 1                  LDP0    P$
         6 001616   000027 220106                    LDX0    23,QL,PR0
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:103  
         6 001617   001000 360003                    ANX0    512,DU
         6 001620   001642 601000 6                  TNZ     s:12412
         6 001621   200063 471500                    LDP1    @PNAME$,,AUTO
         6 001622   100000 473500                    LDP3    0,,PR1
         6 001623   300000 236100                    LDQ     0,,PR3
         6 001624   000033 772000                    QRL     27
         6 001625   000000 620006                    EAX0    0,QL
         6 001626   200067 236100                    LDQ     PN,,AUTO
         6 001627   000210 402007                    MPY     136,DL
         6 001630   040106 106540                    CMPC    fill='040'O
         6 001631   300000 200010                    ADSC9   0,,PR3                   cn=1,n=*X0
         6 001632   000032 200037                    ADSC9   26,Q,PR0                 cn=1,n=31
         6 001633   001642 601000 6                  TNZ     s:12412
         6 001634   200064 474500                    LDP4    @PACCT$,,AUTO
         6 001635   400000 475500                    LDP5    0,,PR4
         6 001636   040100 106506                    CMPC    fill='040'O
         6 001637   000030 000010                    ADSC9   24,Q,PR0                 cn=0,n=8
         6 001640   500000 000010                    ADSC9   0,,PR5                   cn=0,n=8
         6 001641   001650 600000 6                  TZE     GOTPROC

      781    12409    3               AND (PNAME$->B$TEXTC.TEXT = B$P.NAME.TEXT(PN))
      782    12410    3               AND (B$P.ACCT(PN) = PACCT$->B$CHAR8)
      783    12411    3               THEN GOTO GOTPROC;
      784    12412    3           END;

  12412  6 001642   200067 054100                    AOS     PN,,AUTO
         6 001643   200067 236100                    LDQ     PN,,AUTO
         6 001644   002425 116000 1                  CMPQ    USED_AUTO
         6 001645   001613 604400 6                  TMOZ    s:12408

      785    12413    2           ALTRETURN;

  12413  6 001646   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 001647   000000 702211                    TSX2  ! 0,X1

      786    12414    2   GOTPROC:
      787    12415        /* Program overlays don't count as named processors, so altreturn. */
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:104  
      788    12416    2           IF B$P.FLGS(PN) & %P_OVRLY THEN ALTRETURN;

  12416  6 001650   200067 236100       GOTPROC      LDQ     PN,,AUTO
         6 001651   000042 402007                    MPY     34,DL
         6 001652   000027 221106                    LDX1    23,QL,PR0
         6 001653   002000 361003                    ANX1    1024,DU
         6 001654   001657 600000 6                  TZE     s:12418

  12416  6 001655   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 001656   000000 702211                    TSX2  ! 0,X1

      789    12417        /* Convert processor type flags to our internal types */
      790    12418    2           IF B$P.FLGS(PN) & %P_CP THEN PTYPE = I_CP;

  12418  6 001657   000027 221106                    LDX1    23,QL,PR0
         6 001660   400000 361003                    ANX1    -131072,DU
         6 001661   001665 600000 6                  TZE     s:12419

  12418  6 001662   000024 235007                    LDA     20,DL
         6 001663   200066 474500                    LDP4    @PTYPE,,AUTO
         6 001664   400000 755100                    STA     0,,PR4

      791    12419    2           IF B$P.FLGS(PN) & %P_DB THEN PTYPE = I_DB;

  12419  6 001665   002416 470400 1                  LDP0    P$
         6 001666   000027 220106                    LDX0    23,QL,PR0
         6 001667   020000 360003                    ANX0    8192,DU
         6 001670   001674 600000 6                  TZE     s:12420

  12419  6 001671   000025 235007                    LDA     21,DL
         6 001672   200066 473500                    LDP3    @PTYPE,,AUTO
         6 001673   300000 755100                    STA     0,,PR3

      792    12420    2           IF B$P.FLGS(PN) & %P_ASL THEN PTYPE = I_ASL;

  12420  6 001674   002416 470400 1                  LDP0    P$
         6 001675   000027 220106                    LDX0    23,QL,PR0
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:105  
         6 001676   200000 360003                    ANX0    65536,DU
         6 001677   001703 600000 6                  TZE     s:12421

  12420  6 001700   000026 235007                    LDA     22,DL
         6 001701   200066 473500                    LDP3    @PTYPE,,AUTO
         6 001702   300000 755100                    STA     0,,PR3

      793    12421    2           IF B$P.FLGS(PN) & %P_LIB THEN PTYPE = I_LIB;

  12421  6 001703   002416 470400 1                  LDP0    P$
         6 001704   000027 220106                    LDX0    23,QL,PR0
         6 001705   100000 360003                    ANX0    32768,DU
         6 001706   001712 600000 6                  TZE     s:12422

  12421  6 001707   000027 235007                    LDA     23,DL
         6 001710   200066 473500                    LDP3    @PTYPE,,AUTO
         6 001711   300000 755100                    STA     0,,PR3

      794    12422    2           IF B$P.FLGS(PN) & %P_SP THEN PTYPE = I_SP;

  12422  6 001712   002416 470400 1                  LDP0    P$
         6 001713   000027 220106                    LDX0    23,QL,PR0
         6 001714   040000 360003                    ANX0    16384,DU
         6 001715   001721 600000 6                  TZE     s:12423

  12422  6 001716   000030 235007                    LDA     24,DL
         6 001717   200066 473500                    LDP3    @PTYPE,,AUTO
         6 001720   300000 755100                    STA     0,,PR3

      795    12423    2           PNUM = PN;

  12423  6 001721   200065 470500                    LDP0    @PNUM,,AUTO
         6 001722   200067 235100                    LDA     PN,,AUTO
         6 001723   000000 755100                    STA     0,,PR0

      796    12424    2           RETURN;

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:106  
  12424  6 001724   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 001725   000001 702211                    TSX2  ! 1,X1

      797    12425    2   END FIND_PROC;
      798    12426        /**/
      799    12427        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:107  
      800    12428        /**/
      801    12429        /* This procedure returns a processor table - type bit pattern     */
      802    12430        /* corresponding to the internal shared processor type.            */
      803    12431    1   GET_PFLGS: PROC(PTYPE,PROCFLAGS);

  12431  6 001726   200062 741300       GET_PFLGS    STX1  ! PCNTRL+9,,AUTO

      804    12432    2   DCL PTYPE SBIN(18);
      805    12433    2   DCL PROCFLAGS BIT(36) ALIGNED;
      806    12434    2           IF PTYPE = 0 THEN PROCFLAGS = '0'B;

  12434  6 001727   200063 470500                    LDP0    @PTYPE,,AUTO
         6 001730   000000 220100                    LDX0    0,,PR0
         6 001731   001734 601000 6                  TNZ     s:12435

  12434  6 001732   200064 471500                    LDP1    @PROCFLAGS,,AUTO
         6 001733   100000 450100                    STZ     0,,PR1

      807    12435    2           IF PTYPE = I_CP THEN PROCFLAGS = %P_CP;

  12435  6 001734   000000 220100                    LDX0    0,,PR0
         6 001735   000024 100003                    CMPX0   20,DU
         6 001736   001742 601000 6                  TNZ     s:12436

  12435  6 001737   400000 236003                    LDQ     -131072,DU
         6 001740   200064 471500                    LDP1    @PROCFLAGS,,AUTO
         6 001741   100000 756100                    STQ     0,,PR1

      808    12436    2           IF PTYPE = I_DB THEN PROCFLAGS = %P_DB;

  12436  6 001742   000000 220100                    LDX0    0,,PR0
         6 001743   000025 100003                    CMPX0   21,DU
         6 001744   001750 601000 6                  TNZ     s:12437

  12436  6 001745   020000 236003                    LDQ     8192,DU
         6 001746   200064 471500                    LDP1    @PROCFLAGS,,AUTO
         6 001747   100000 756100                    STQ     0,,PR1
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:108  

      809    12437    2           IF PTYPE = I_ASL THEN PROCFLAGS = %P_ASL;

  12437  6 001750   000000 220100                    LDX0    0,,PR0
         6 001751   000026 100003                    CMPX0   22,DU
         6 001752   001756 601000 6                  TNZ     s:12438

  12437  6 001753   200000 236003                    LDQ     65536,DU
         6 001754   200064 471500                    LDP1    @PROCFLAGS,,AUTO
         6 001755   100000 756100                    STQ     0,,PR1

      810    12438    2           IF PTYPE = I_LIB THEN PROCFLAGS = %P_LIB;

  12438  6 001756   000000 220100                    LDX0    0,,PR0
         6 001757   000027 100003                    CMPX0   23,DU
         6 001760   001764 601000 6                  TNZ     s:12439

  12438  6 001761   100000 236003                    LDQ     32768,DU
         6 001762   200064 471500                    LDP1    @PROCFLAGS,,AUTO
         6 001763   100000 756100                    STQ     0,,PR1

      811    12439    2           RETURN;

  12439  6 001764   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 001765   000001 702211                    TSX2  ! 1,X1

      812    12440    2   END GET_PFLGS;
      813    12441        /**/
      814    12442        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:109  
      815    12443        /**/
      816    12444        /* Procedure for parsing the specified FID and opening M$EI to it. */
      817    12445    1   OPEN_FID: PROC(FID$) ALTRET;

  12445  6 001766   200062 741300       OPEN_FID     STX1  ! PCNTRL+9,,AUTO

      818    12446    2   DCL FID$ PTR;
      819    12447        /**/
      820    12448    2           FPT_FID.TEXTFID_ = VECTOR(FID$->B$TEXTC.TEXT);

  12448  6 001767   200063 470500                    LDP0    @FID$,,AUTO
         6 001770   000000 471500                    LDP1    0,,PR0
         6 001771   100000 236100                    LDQ     0,,PR1
         6 001772   000033 772000                    QRL     27
         6 001773   000064 737000                    LLS     52
         6 001774   000140 135007                    SBLA    96,DL
         6 001775   200070 451500                    STP1    @ERR+1,,AUTO
         6 001776   200070 236100                    LDQ     @ERR+1,,AUTO
         6 001777   200000 036007                    ADLQ    65536,DL
         6 002000   002752 757000 1                  STAQ    FPT_FID+2

      821    12449    2           CALL M$FID(FPT_FID) ALTRET(BAD_FID);

  12449  6 002001   002750 630400 1                  EPPR0   FPT_FID
         6 002002   420001 713400                    CLIMB   alt,+8193
         6 002003   404400 401760                    pmme    nvectors=10
         6 002004   002017 702000 6                  TSX2    BAD_FID

      822    12450    2           IF FID_ASN = %FILE#

  12450  6 002005   002344 236000 1                  LDQ     FID_ASN
         6 002006   777000 376003                    ANQ     -512,DU
         6 002007   001000 116003                    CMPQ    512,DU
         6 002010   002017 601000 6                  TNZ     BAD_FID

      823    12451    3             THEN DO;

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:110  
      824    12452    3                 CALL M$OPEN(OPEN_EI) ALTRET(NOW_WHAT);

  12452  6 002011   002636 630400 1                  EPPR0   OPEN_EI
         6 002012   450000 713400                    CLIMB   alt,open
         6 002013   410400 401760                    pmme    nvectors=18
         6 002014   002025 702000 6                  TSX2    NOW_WHAT

      825    12453    3                 RETURN;

  12453  6 002015   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 002016   000001 702211                    TSX2  ! 1,X1

      826    12454    3               END;
      827    12455    3             ELSE DO;

      828    12456        /*E*    ERROR:  IPA-E$IP_NOTFILE-2
      829    12457                MESSAGE: Your FID does not specify a file.
      830    12458                MESSAGE1: The FID in this command must specify a valid run
      831    12459                          unit file.                                       */
      832    12460    3   BAD_FID:      JITERR.CODE = E$IP_NOTFILE;

  12460  6 002017   002304 236000 1     BAD_FID      LDQ     JITERR
         6 002020   000052 376000 7                  ANQ     42
         6 002021   001500 276007                    ORQ     832,DL
         6 002022   002304 756000 1                  STQ     JITERR

      833    12461    3                 ALTRETURN;

  12461  6 002023   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 002024   000000 702211                    TSX2  ! 0,X1

      834    12462    3               END;
      835    12463    2   NOW_WHAT:
      836    12464    2           JITERR = B$JIT.ERR;

  12464  6 002025   000000 470400 xsym  NOW_WHAT     LDP0    B$JIT$
         6 002026   000012 236100                    LDQ     10,,PR0
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:111  
         6 002027   002304 756000 1                  STQ     JITERR

      837    12465    2           ALTRETURN;

  12465  6 002030   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 002031   000000 702211                    TSX2  ! 0,X1

      838    12466    2   END OPEN_FID;
      839    12467        /**/
      840    12468        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:112  
      841    12469        /* Routine to M$LINK to PCL to copy new run unit into :SYS */
      842    12470    1   MOVE_PROC: PROC(ERR) ALTRET;

  12470  6 002032   200066 741300       MOVE_PROC    STX1  ! @PTYPE,,AUTO

      843    12471    2   DCL ERR BIT(36) ALIGNED;
      844    12472        /**/
      845    12473    2           FROM_FID = ' ';

  12473  6 002033   040100 100400                    MLR     fill='040'O
         6 002034   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         6 002035   200025 000050                    ADSC9   FROM_FID,,AUTO           cn=0,n=40

      846    12474    2           FPT_UNFID.TEXTFID_ = VECTOR(FROM_FID);

  12474  6 002036   000070 235000 7                  LDA     56
         6 002037   200070 452500                    STP2    @ERR+1,,AUTO
         6 002040   200070 236100                    LDQ     @ERR+1,,AUTO
         6 002041   000025 036003                    ADLQ    21,DU
         6 002042   003014 757000 1                  STAQ    FPT_UNFID+2

      847    12475    2           IF (RU_ACCT.ACCT# = ' ') THEN

  12475  6 002043   002740 237000 1                  LDAQ    RU_ACCT
         6 002044   000072 117000 7                  CMPAQ   58
         6 002045   002051 601000 6                  TNZ     s:12477

      848    12476    2             RU_ACCT.ACCT# = B$JIT.FACCN;

  12476  6 002046   000000 470400 xsym               LDP0    B$JIT$
         6 002047   000006 237100                    LDAQ    6,,PR0
         6 002050   002740 757000 1                  STAQ    RU_ACCT

      849    12477    2           FPT_UNFID.ACCT_ = VECTOR(RU_ACCT);

  12477  6 002051   000074 237000 7                  LDAQ    60
         6 002052   003020 757000 1                  STAQ    FPT_UNFID+6
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:113  

      850    12478    2           FID_ASN = %FILE#;

  12478  6 002053   001000 236003                    LDQ     512,DU
         6 002054   002344 756000 1                  STQ     FID_ASN

      851    12479    2           IF RU_SN.SN#(0) = ' ' THEN

  12479  6 002055   040000 106400                    CMPC    fill='040'O
         6 002056   002745 000006 1                  ADSC9   RU_SN+1                  cn=0,n=6
         6 002057   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         6 002060   002072 601000 6                  TNZ     s:12484

      852    12480    2             IF (RU_ACCT.ACCT# = SYSACCT.ACCT#) THEN

  12480  6 002061   040000 106400                    CMPC    fill='040'O
         6 002062   002740 000010 1                  ADSC9   RU_ACCT                  cn=0,n=8
         6 002063   003061 000010 1                  ADSC9   SYSACCT                  cn=0,n=8
         6 002064   002066 601000 6                  TNZ     s:12483

      853    12481    2               RETURN;                /* DON'T COPY RU IF IT IS ALREADY IN :SYS  */

  12481  6 002065   000001 702211                    TSX2  ! 1,X1

      854    12482    2               ELSE
      855    12483    2               RU_SN.SN#(0) = B$JIT.FPSN;

  12483  6 002066   000000 470400 xsym               LDP0    B$JIT$
         6 002067   040000 100500                    MLR     fill='040'O
         6 002070   000021 000006                    ADSC9   17,,PR0                  cn=0,n=6
         6 002071   002745 000006 1                  ADSC9   RU_SN+1                  cn=0,n=6

      856    12484    2           FPT_UNFID.SN_ = VECTOR(RU_SN);

  12484  6 002072   000076 237000 7                  LDAQ    62
         6 002073   003024 757000 1                  STAQ    FPT_UNFID+10

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:114  
      857    12485    2           CALL M$UNFID(FPT_UNFID) ALTRET(ERR_MOVE);

  12485  6 002074   003012 630400 1                  EPPR0   FPT_UNFID
         6 002075   420021 713400                    CLIMB   alt,+8209
         6 002076   404400 401760                    pmme    nvectors=10
         6 002077   002161 702000 6                  TSX2    ERR_MOVE

      858    12486    2           TO_FID = ' ';

  12486  6 002100   040100 100400                    MLR     fill='040'O
         6 002101   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         6 002102   200037 000050                    ADSC9   TO_FID,,AUTO             cn=0,n=40

      859    12487    2           FPT_UNFID.TEXTFID_ = VECTOR(TO_FID);

  12487  6 002103   000070 235000 7                  LDA     56
         6 002104   200070 452500                    STP2    @ERR+1,,AUTO
         6 002105   200070 236100                    LDQ     @ERR+1,,AUTO
         6 002106   000037 036003                    ADLQ    31,DU
         6 002107   003014 757000 1                  STAQ    FPT_UNFID+2

      860    12488    2           FPT_UNFID.ACCT_ = VECTOR(SYSACCT);

  12488  6 002110   000100 237000 7                  LDAQ    64
         6 002111   003020 757000 1                  STAQ    FPT_UNFID+6

      861    12489    2           FPT_UNFID.SN_ = VECTOR(SYSSN);

  12489  6 002112   000102 237000 7                  LDAQ    66
         6 002113   003024 757000 1                  STAQ    FPT_UNFID+10

      862    12490    2           RU_NAME = PCNTRL.PNAME$->B$TEXTC;

  12490  6 002114   200052 470500                    LDP0    PCNTRL+1,,AUTO
         6 002115   000000 236100                    LDQ     0,,PR0
         6 002116   000033 772000                    QRL     27
         6 002117   000001 620006                    EAX0    1,QL
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:115  
         6 002120   000000 100540                    MLR     fill='000'O
         6 002121   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         6 002122   002730 000040 1                  ADSC9   RU_NAME                  cn=0,n=32

      863    12491    2           CALL M$UNFID(FPT_UNFID) ALTRET(ERR_MOVE);

  12491  6 002123   003012 630400 1                  EPPR0   FPT_UNFID
         6 002124   420021 713400                    CLIMB   alt,+8209
         6 002125   404400 401760                    pmme    nvectors=10
         6 002126   002161 702000 6                  TSX2    ERR_MOVE

      864    12492    2           IF (TO_FID = FROM_FID) THEN RETURN;

  12492  6 002127   040100 106500                    CMPC    fill='040'O
         6 002130   200037 000050                    ADSC9   TO_FID,,AUTO             cn=0,n=40
         6 002131   200025 000050                    ADSC9   FROM_FID,,AUTO           cn=0,n=40
         6 002132   002135 601000 6                  TNZ     s:12493

  12492  6 002133   200066 221300                    LDX1  ! @PTYPE,,AUTO
         6 002134   000001 702211                    TSX2  ! 1,X1

      865    12493    2           TXTC_CMD.COUNT = SIZEC(T_COPY) + SIZEC(FROM_FID) +

  12493  6 002135   132000 236003                    LDQ     46080,DU
         6 002136   002306 552040 1                  STBQ    PCL_CMD,'40'O

      866    12494    2             SIZEC(T_OVER) + SIZEC(TO_FID);
      867    12495    2           CALL CONCAT(TXTC_CMD.TEXT,T_COPY,FROM_FID,T_OVER,TO_FID);

  12495  6 002137   040000 100400                    MLR     fill='040'O
         6 002140   002530 000005 1                  ADSC9   T_COPY                   cn=0,n=5
         6 002141   002306 200005 1                  ADSC9   PCL_CMD                  cn=1,n=5
         6 002142   040000 100500                    MLR     fill='040'O
         6 002143   200025 000050                    ADSC9   FROM_FID,,AUTO           cn=0,n=40
         6 002144   002307 400050 1                  ADSC9   PCL_CMD+1                cn=2,n=40
         6 002145   040000 100400                    MLR     fill='040'O
         6 002146   002532 000005 1                  ADSC9   T_OVER                   cn=0,n=5
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:116  
         6 002147   002321 400005 1                  ADSC9   PCL_CMD+11               cn=2,n=5
         6 002150   040000 100500                    MLR     fill='040'O
         6 002151   200037 000050                    ADSC9   TO_FID,,AUTO             cn=0,n=40
         6 002152   002322 600105 1                  ADSC9   PCL_CMD+12               cn=3,n=69

      868    12496    2           CALL M$LINK(FPT_LINK) ALTRET(ERR_MOVE);

  12496  6 002153   003040 630400 1                  EPPR0   FPT_LINK
         6 002154   400005 713400                    CLIMB   alt,+5
         6 002155   403000 401760                    pmme    nvectors=7
         6 002156   002161 702000 6                  TSX2    ERR_MOVE

      869    12497    2           RETURN;

  12497  6 002157   200066 221300                    LDX1  ! @PTYPE,,AUTO
         6 002160   000001 702211                    TSX2  ! 1,X1

      870    12498        /**/
      871    12499    2   ERR_MOVE:
      872    12500    2           ERR = B$JIT.ERR;

  12500  6 002161   000000 470400 xsym  ERR_MOVE     LDP0    B$JIT$
         6 002162   000012 236100                    LDQ     10,,PR0
         6 002163   200067 471500                    LDP1    @ERR,,AUTO
         6 002164   100000 756100                    STQ     0,,PR1

      873    12501    2           ALTRETURN;

  12501  6 002165   200066 221300                    LDX1  ! @PTYPE,,AUTO
         6 002166   000000 702211                    TSX2  ! 0,X1

      874    12502    2   END MOVE_PROC;
      875    12503        /**/
      876    12504        %EJECT;
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:117  
      877    12505        /* Routine to get the processor's modification date from the FIT. */
      878    12506    1   GET_MODTIME: PROC(DATE) ALTRET;

  12506  6 002167   200062 741300       GET_MODTIME  STX1  ! PCNTRL+9,,AUTO

      879    12507    2   DCL DATE UBIN;
      880    12508    2   DCL J SBIN;
      881    12509    2   DCL CODE4$ PTR;
      882    12510        /**/
      883    12511    3           DO J = 1 TO FM$FIT.CODES.CODE(0);

  12511  6 002170   000001 235007                    LDA     1,DL
         6 002171   200064 755100                    STA     J,,AUTO
         6 002172   002215 710000 6                  TRA     s:12518+1

      884    12512    3             IF FM$FIT.CODES.CODE(J) = 4 THEN

  12512  6 002173   002345 470400 1                  LDP0    FIT$
         6 002174   200064 720100                    LXL0    J,,AUTO
         6 002175   000000 236110                    LDQ     0,X0,PR0
         6 002176   760000 376003                    ANQ     -8192,DU
         6 002177   100000 116003                    CMPQ    32768,DU
         6 002200   002214 601000 6                  TNZ     s:12518

      885    12513    4                 DO;

      886    12514    4                   CODE4$ = PINCRW(FIT$,FM$FIT.CODES.ITEMX(J));

  12514  6 002201   000000 721110                    LXL1    0,X0,PR0
         6 002202   001777 361003                    ANX1    1023,DU
         6 002203   000000 636011                    EAQ     0,X1
         6 002204   002345 036000 1                  ADLQ    FIT$
         6 002205   200065 756100                    STQ     CODE4$,,AUTO

      887    12515    4                   DATE = CODE4$->CODE04.MODIFY.TIME;

  12515  6 002206   200065 471500                    LDP1    CODE4$,,AUTO
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:118  
         6 002207   200063 473500                    LDP3    @DATE,,AUTO
         6 002210   100001 235100                    LDA     1,,PR1
         6 002211   300000 755100                    STA     0,,PR3

      888    12516    4                   RETURN;

  12516  6 002212   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 002213   000001 702211                    TSX2  ! 1,X1

      889    12517    4                 END;
      890    12518    3           END;

  12518  6 002214   200064 054100                    AOS     J,,AUTO
         6 002215   002345 470400 1                  LDP0    FIT$
         6 002216   000000 236100                    LDQ     0,,PR0
         6 002217   000037 772000                    QRL     31
         6 002220   200064 116100                    CMPQ    J,,AUTO
         6 002221   002173 605000 6                  TPL     s:12512

      891    12519    2           DATE = FITBUF.WORK (0);         /*anything for a * file*/

  12519  6 002222   200063 471500                    LDP1    @DATE,,AUTO
         6 002223   000000 235000 1                  LDA     FITBUF
         6 002224   100000 755100                    STA     0,,PR1

      892    12520    2           RETURN;

  12520  6 002225   200062 221300                    LDX1  ! PCNTRL+9,,AUTO
         6 002226   000001 702211                    TSX2  ! 1,X1

      893    12521    2   END GET_MODTIME;
      894    12522        /**/
      895    12523        /**/
      896    12524    1   END IPA$SPIDER;

  12524  6 002227   000000 702200 xent               TSX2  ! X66_MARET

PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:119  
--  Include file information  --

   XU_SUBS_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   MM_MACRO_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   MM$SYSGEN.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   MM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   IPS_SUBS_C.:E05TOU  is referenced.
   IP_PERR_C.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure IPA$SPIDER.
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:120  

 **** Variables and constants ****

  ****  Section 001  Data  IPA$SPIDER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  2423-0-0/w SBIN        r     1 AUTO_START              2410-0-0/w PTR         r     1 BUF$
  3144-0-0/d STRC(1080)  r     1 CLOSE_DEL               3106-0-0/d STRC(1080)  r     1 CLOSE_EI
  2414-0-0/w PTR         r     1 EI$                     2352-0-0/d CHAR(120)   r     1 ERRMSGBUF
  2305-0-0/c STRC(27)    r     1 ERRPOS                  2344-0-0/w UBIN(9)     r     1 FID_ASN
  2345-0-0/w PTR         r     1 FIT$                       0-0-0/d STRC(36864) r     1 FITBUF
  2604-0-0/d STRC(936)   r     1 FPT_ERRMSG              2750-0-0/d STRC(864)   r     1 FPT_FID
  3230-0-0/d STRC(144)   r     1 FPT_INT                 3040-0-0/d STRC(576)   r     1 FPT_LINK
  3012-0-0/d STRC(792)   r     1 FPT_UNFID               2415-0-0/w PTR         r     1 HEAD$
  2024-0-0/d STRC(1440)  r     1 HEADBUF                 2300-0-0/c STRC(45)    r     1 HEAD_KEY
  2000-0-0/c CHAR        r     1 INBUF(0:79)             2350-0-0/d REMB        r     1 IPA_RESTART
  2441-0-0/c CHAR(8)     r     1 IPA_SYSACCT             2450-0-0/w SBIN        r     1 IP_PTB_UNITS
  2447-0-0/w BIT         r     1 IP_WSQ0PT               2304-0-0/b STRC        r     1 JITERR
  2424-0-0/w SBIN        r     1 LAST_AUTO               2417-0-0/w PTR         r     1 LOOKUP$
  2422-0-0/w SBIN        r     1 MAXPROCS                2426-0-0/w SBIN        r     1 MAX_LOOKUP
  2427-0-0/w SBIN        r     1 MUAIS                   2421-0-0/w SBIN        r     1 NPROCS
  2430-0-0/w SBIN        r     1 NSCPU                   2636-0-0/d STRC(2088)  r     1 OPEN_EI
  2416-0-0/w PTR         r     1 P$                      2306-0-0/d CHAR(120)   r     1 PCL_CMD
  3060-0-0/c STRC        r     1 PCL_NAME                2270-0-0/w STRC(288)   r     1 PCNTRL_INIT
  2413-0-0/w PTR         r     1 PGTBL$                  3224-0-0/d STRC(144)   r     1 PPRIV_CHNG
  3220-0-0/d STRC(144)   r     1 PPRIV_LOOK              2446-0-0/w PTR         r     1 PPUT$
  3234-0-0/d STRC(216)   r     1 PPUT_CVM                2444-0-0/d DSCR        r     1 PPUT_DESC
  2446-0-0/w STRC        r     1 PPUT_REDEF              3070-0-0/d STRC(504)   r     1 READ_HEAD
  2552-0-0/d STRC(504)   r     1 READ_SI                 2412-0-0/w PTR         r     1 ROSEG$
  2740-0-0/c STRC(72)    r     1 RU_ACCT                 2730-0-0/c STRC(288)   r     1 RU_NAME
  2742-0-0/c STRC(72)    r     1 RU_PASS                 2744-0-0/d STRC(90)    r     1 RU_SN
  2431-0-0/w SBIN        r     1 SCPUWSPTD(0:7)
  3202-0-0/d STRC(144)   r     1 SEE_MONITOR             3212-0-0/d STRC(144)   r     1 SEE_PPUT
  3206-0-0/d STRC(144)   r     1 SEE_TIGRDATA            2346-0-0/w PTR         r     1 SI$
  2266-0-0/d STRC(72)    r     1 STLVEC                  3061-0-0/c STRC(72)    r     1 SYSACCT
  3064-0-0/d STRC(90)    r     1 SYSSN                   2522-0-0/c STRC(54)    r     1 TC_FREE
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:121  
  2443-0-0/w PTR         r     1 TPTR$                   2306-0-0/d STRC(1080)  r     1 TXTC_CMD
  2541-0-0/c CHAR(31)    r     1 T_AUTOPROCS             2530-0-0/c CHAR(5)     r     1 T_COPY
  2302-0-0/c CHAR        r     1 T_CRLF(0:1)             2524-0-0/c STRC(126)   r     1 T_HELLO
  2532-0-0/c CHAR(5)     r     1 T_OVER                  2303-0-0/c CHAR        r     1 T_PROMPT
  2534-0-0/c CHAR(18)    r     1 T_SYSPROCS              2425-0-0/w SBIN        r     1 USED_AUTO
  2420-0-0/w PTR         r     1 USRT$                   3000-0-0/d STRC(324)   r     1 VLR_FID
  2570-0-0/d STRC(432)   r     1 WRITE_LO                2411-0-0/w PTR         r     1 WSPTD$
  2452-0-0/d STRC(1404)  r     1 XUR_INIT

  ****  Section 002 RoData IPA$SPIDER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 JITERR_INIT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    63-0-0/w PTR         r     1 @DATE                     65-0-0/w PTR         r     1 @DFLG
    67-0-0/w PTR         r     1 @ERR                      63-0-0/w PTR         r     1 @FID$
    64-0-0/w PTR         r     1 @PACCT$                   63-0-0/w PTR         r     1 @PNAME$
    65-0-0/w PTR         r     1 @PNUM                     64-0-0/w PTR         r     1 @PROCFLAGS
    66-0-0/w PTR         r     1 @PTYPE                    63-0-0/w PTR         r     1 @PTYPE
    65-0-0/w PTR         r     1 @SLOT                     20-0-0/w PTR         r     1 BLK$
    21-0-0/w PTR         r     1 BLK2$                     65-0-0/w PTR         r     1 CODE4$
    *0-0-0/w UBIN        r     1 DATE                      *0-0-0/w BIT         r     1 DFLG
    *0-0-0/w BIT         r     1 ERR                       *0-0-0/w PTR         r     1 FID$
    25-0-0/c CHAR(40)    r     1 FROM_FID                   3-0-0/w SBIN        r     1 I
    64-0-0/w SBIN        r     1 J                         11-0-0/w SBIN        r     1 NODE_TYPE
    16-0-0/c CHAR(8)     r     1 PACCT                     *0-0-0/w PTR         r     1 PACCT$
    51-0-0/w STRC(288)   r     1 PCNTRL                    14-0-0/b BIT         r     1 PFLGS
    67-0-0/w SBIN        r     1 PN                        *0-0-0/w PTR         r     1 PNAME$
    12-0-0/w SBIN        r     1 PNUM                      *0-0-0/w SBIN        r     1 PNUM
     5-0-0/w SBIN        r     1 PP                         7-0-0/w SBIN        r     1 PPUT_OFFSET
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:122  
    *0-0-0/w BIT         r     1 PROCFLAGS                 15-0-0/w SBIN        r     1 PROC_SLOT
    13-0-0/w SBIN        r     1 PTYPE                     *0-0-0/w SBIN        r     1 PTYPE
    *0-0-0/w SBIN(18)    r     1 PTYPE                     *0-0-0/w SBIN        r     1 SLOT
    37-0-0/c CHAR(40)    r     1 TO_FID                    23-0-0/w PTR         r     1 U$
     6-0-0/w SBIN        r     1 VP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$IS$                      0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$LOOKUP$                  0-0-0/w PTR         r     1 B$P$
     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w SBIN        r     1 B_MUAIS
     0-0-0/c ASTR(9)     r     1 B_VERSION                  0-0-0/w SBIN        r     1 HW_PTB_UNITS
     0-0-0/w BIT         r     1 HW_WSQ0PT
     0-0-0/w SBIN        r     1 IT_SCPUWSPTD(0:3)
     0-0-0/w PTR         r     1 MM_BYP$                    0-0-0/w UBIN        r     1 P_AUTO_START
     0-0-0/w UBIN        r     1 P_LAST_AUTO                0-0-0/w UBIN        r     1 P_MAXPROCS
     0-0-0/w UBIN        r     1 P_MAX_LOOKUP               0-0-0/w UBIN        r     1 P_NPROCS
     0-0-0/w UBIN        r     1 P_USED_AUTO                0-0-0/w SBIN        r     1 SPIDER_CMD
     0-0-0/w SBIN        r     1 S_NSCPU

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(8)     r     1 B$CHAR8                    0-0-0/w STRC(1440)  r     1 B$HEAD
     0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w UBIN        r     1 B$LOOKUP(0:0)
     0-0-0/d STRC(1224)  r     1 B$P(0:0)                   0-0-0/w ASTR(9)     r     1 B$TEXTC
     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/w STRC(576)   r     1 B$USER(0:0)
     0-0-0/w STRC(396)   r     1 CODE04                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(1116)  r     1 FM$FIT                     0-0-0N  NULL        r     1 M$EI
     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$SI
     0-0-0/w STRC(144)   r     1 OUT$BLK                    0-0-0/w ASTR(153)   r     1 OUT$SYM
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:123  


   Procedure IPA$SPIDER requires 1176 words for executable code.
   Procedure IPA$SPIDER requires 60 words of local(AUTO) storage.

    No errors detected in file IPA$SPIDER.:E05TSI    .
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:124  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:125  
          MINI XREF LISTING

ABORT
     12130**LABEL   12035--CALLALT 12129--CALLALT
ATNUM
     10653**DCL     10654--REDEF
AUTO_START
     10621**DCL     11972<>CALL    12144>>IF      12180>>IF      12209>>IF      12328>>DOINDEX 12328>>DOINDEX
     12337>>DOINDEX 12337>>DOINDEX 12407>>DOINDEX
B$CHAR8
     10676**DCL     12399>>IF      12408>>IF
B$DO.ECCINFO
      5340**DCL      5341--REDEF
B$HEAD
     10741**DCL     12037--IF
B$HEAD.ASL
     10873**DCL     12068>>IF
B$HEAD.FLAVOR
     10866**DCL     12049>>IF
B$HEAD.LIB
     10871**DCL     12068>>IF
B$HEAD.OVRL
     10880**DCL     12058>>IF
B$HEAD.RDATA
     10760**DCL     12058>>IF
B$HEAD.ROSIZE
     10819**DCL     12058>>IF
B$IS$
     10683**DCL     11966>>ASSIGN  11988>>ASSIGN  11989>>ASSIGN  11990>>ASSIGN  11991>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      7173**DCL      7173--REDEF
B$JIT.DDLL
      7237**DCL     11956>>ASSIGN
B$JIT.ERR
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:126  
      7079**DCL     12127>>ASSIGN  12193>>ASSIGN  12464>>ASSIGN  12500>>ASSIGN
B$JIT.ERR.MID
      7080**DCL      7080--REDEF
B$JIT.FACCN
      7079**DCL     12476>>ASSIGN
B$JIT.FPSN
      7160**DCL     12483>>ASSIGN
B$JIT.JRESPEAK
      7241**DCL      7242--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
      7350**DCL      7350--REDEF    7351--REDEF
B$JIT.PNR
      7254**DCL      7254--REDEF
B$JIT.TSLINE
      7348**DCL      7349--REDEF
B$JIT$
     10682**DCL      7074--IMP-PTR 11956>>ASSIGN  12127>>ASSIGN  12193>>ASSIGN  12464>>ASSIGN  12476>>ASSIGN
     12483>>ASSIGN  12500>>ASSIGN
B$LOOKUP
      5146**DCL     12329>>ASSIGN  12338>>ASSIGN
B$LOOKUP$
      5168**DCL     11983<>CALL
B$P.ACCT
      5136**DCL     12408>>IF
B$P.FLGS
      5134**DCL     12155<<ASSIGN  12155>>ASSIGN  12167>>IF      12209>>IF      12401>>IF      12408>>IF
     12416>>IF      12418>>IF      12419>>IF      12420>>IF      12421>>IF      12422>>IF
B$P.FRQ
      5115**DCL     12179<<ASSIGN  12219<<ASSIGN
B$P.LIB_LNK
      5124**DCL     12166>>IF
B$P.NAME.TEXT
      5139**DCL     12260>>IF      12401>>IF      12408>>IF
B$P.UC
      5114**DCL     12168>>IF
B$P$
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:127  
      5167**DCL     11981<>CALL
B$TEXTC
     10673**DCL     12098--ASSIGN  12183>>ASSIGN  12490>>ASSIGN
B$TEXTC.COUNT
     10674**DCL     10675--IMP-SIZ 12098>>ASSIGN  12183>>ASSIGN  12366>>ASSIGN  12401>>IF      12408>>IF
     12448>>ASSIGN  12490>>ASSIGN
B$TEXTC.TEXT
     10675**DCL     12366>>ASSIGN  12401>>IF      12408>>IF      12448--ASSIGN
B$U.ACP
      5296**DCL     12159>>IF
B$U.ASL
      5298**DCL     12159>>IF
B$U.ASP
      5301**DCL     12159>>IF
B$U.DB
      5297**DCL     12159>>IF
B$U.MISC
      5319**DCL      5320--REDEF
B$U.US
      5306**DCL     12158>>IF
B$USER
      5364**DCL     12157--ASSIGN
B$USER.MISC
      5395**DCL      5396--REDEF
B$USRT$
     10685**DCL     11985<>CALL
BAD_FID IN PROCEDURE OPEN_FID
     12460**LABEL   12449--CALLALT
BLACK_WIDOW
     12095**LABEL   12031--CALLALT 12046--GOTO    12055--GOTO    12066--GOTO    12075--GOTO    12082--CALLALT
     12084--CALLALT 12086--CALLALT 12088--CALLALT 12109--GOTO    12115--GOTO
BLK$
     10649**DCL     11020--IMP-PTR 11066--IMP-PTR 12004<>CALL    12118<>CALL    12357>>ASSIGN  12358>>DOINDEX
     12359>>ASSIGN
BLK2$
     10650**DCL     12359<<ASSIGN  12360>>ASSIGN  12362>>ASSIGN  12366>>ASSIGN  12366>>ASSIGN  12378>>ASSIGN
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:128  
BUF$
     10610**DCL     11988<<ASSIGN
BUILD_PCNTRL
     12354**PROC    12005--CALL
B_MUAIS
     10686**DCL     11977<>CALL
B_VERSION.L#
     10688**DCL     10689--IMP-SIZ 11944>>CALLBLT 11944>>CALLBLT
B_VERSION.TXT
     10689**DCL     11944>>CALLBLT
CANT_DEL IN PROCEDURE DEL_CMD
     12197**LABEL   12163--GOTO    12169--GOTO    12172--GOTO
CLOSE_DEL
     11787**DCL     12187<>CALL
CLOSE_DEL.SN_
     11787**DCL     11787--REDEF
CLOSE_DEL.UTL_
     11788**DCL     11788--REDEF
CLOSE_DEL.V
     11792**DCL     11787--DCLINIT
CLOSE_DEL.V.EXPIRE#
     11802**DCL     11802--REDEF
CLOSE_DEL.V.TYPE#
     11800**DCL     11800--REDEF
CLOSE_DEL.V.XTNSIZE#
     11797**DCL     11797--REDEF   11799--REDEF
CLOSE_EI
     11743**DCL     12121<>CALL
CLOSE_EI.SN_
     11743**DCL     11743--REDEF
CLOSE_EI.UTL_
     11744**DCL     11744--REDEF
CLOSE_EI.V
     11748**DCL     11743--DCLINIT
CLOSE_EI.V.EXPIRE#
     11758**DCL     11758--REDEF
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:129  
CLOSE_EI.V.TYPE#
     11756**DCL     11756--REDEF
CLOSE_EI.V.XTNSIZE#
     11753**DCL     11753--REDEF   11755--REDEF
CODE04.MODIFY.TIME
     10951**DCL     12515>>ASSIGN
CODE4$ IN PROCEDURE GET_MODTIME
     12509**DCL     12514<<ASSIGN  12515>>ASSIGN
CONT
     12123**LABEL   12121--CALLALT
DATE IN PROCEDURE GET_MODTIME
     12507**DCL     12506--PROC    12515<<ASSIGN  12519<<ASSIGN
DEL_CMD
     12141**PROC    12082--CALL    12254--CALL
DEL_ERR IN PROCEDURE DEL_CMD
     12193**LABEL   12186--CALLALT 12187--CALLALT
DFLG IN PROCEDURE DEL_CMD
     12142**DCL     12141--PROC    12177>>IF
EI$
     10614**DCL     11992<<ASSIGN
ERR IN PROCEDURE MOVE_PROC
     12471**DCL     12470--PROC    12500<<ASSIGN
ERRMSGBUF
     10609**DCL     11324--DCLINIT
ERRPOS
     10596**DCL     11325--DCLINIT
ERRPOS.TEXT
     10598**DCL     10599--REDEF
ERR_MOVE IN PROCEDURE MOVE_PROC
     12500**LABEL   12485--CALLALT 12491--CALLALT 12496--CALLALT
F$DCB.ACTPOS
     10987**DCL     10987--REDEF
F$DCB.ARS#
     10961**DCL     10961--REDEF   12037>>IF
F$DCB.ATTR
     10980**DCL     10981--REDEF
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:130  
F$DCB.BORROW
     10995**DCL     10995--REDEF   10995--REDEF   10995--REDEF
F$DCB.DCBNAME.L
     11009**DCL     11009--IMP-SIZ
F$DCB.EOMCHAR#
     10965**DCL     10965--REDEF
F$DCB.FLDID
     10990**DCL     10990--REDEF
F$DCB.FORM$
     10984**DCL     10984--REDEF
F$DCB.FSECT
     11000**DCL     11000--REDEF
F$DCB.FSN#
     10977**DCL     10977--REDEF   10977--REDEF   10978--REDEF
F$DCB.HEADER$
     10983**DCL     10983--REDEF
F$DCB.IXTNSIZE#
     10981**DCL     10981--REDEF
F$DCB.LASTSTA$
     10970**DCL     10970--REDEF
F$DCB.LVL
     10996**DCL     10996--REDEF
F$DCB.NAME#.C
     10971**DCL     10971--REDEF
F$DCB.NOEOF
     10993**DCL     10993--REDEF
F$DCB.NRECS#
     10982**DCL     10982--REDEF
F$DCB.NRECX
     11001**DCL     11001--REDEF
F$DCB.OHDR
     10993**DCL     10993--REDEF
F$DCB.ORG#
     10976**DCL     10976--REDEF   12032>>IF
F$DCB.PRECNO
     10999**DCL     10999--REDEF
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:131  
F$DCB.RCSZ
     11005**DCL     11005--REDEF
F$DCB.RES#
     10972**DCL     10972--REDEF
F$DCB.SETX
     10984**DCL     10984--REDEF
F$DCB.TAB$
     10984**DCL     10984--REDEF
F$DCB.TDA
     10998**DCL     10999--REDEF
F$DCB.WSN#
     10972**DCL     10972--REDEF
FID$ IN PROCEDURE OPEN_FID
     12446**DCL     12445--PROC    12448>>ASSIGN  12448>>ASSIGN
FID_ASN
     10604**DCL     11549--DCLINIT 11595--DCLINIT 12450>>IF      12478<<ASSIGN
FIND_PROC
     12390**PROC    12020--CALL
FIT$
     10605**DCL     12511>>DOINDEX 12512>>IF      12514>>ASSIGN  12514>>ASSIGN
FITBUF
     10555**DCL     10605--DCLINIT 11420--DCLINIT
FITBUF.WORK
     10556**DCL     12519>>ASSIGN
FM$FIT.CODES.CODE
     11012**DCL     12511>>DOINDEX 12512>>IF
FM$FIT.CODES.ITEMX
     11012**DCL     12514>>ASSIGN
FPT_ERRMSG
     11323**DCL     12100<>CALL    12129<>CALL
FPT_ERRMSG.FIELD2_
     11326**DCL     12098<<ASSIGN  12099<<ASSIGN
FPT_ERRMSG.V
     11327**DCL     11323--DCLINIT
FPT_FID
     11546**DCL     12449<>CALL
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:132  
FPT_FID.TEXTFID_
     11546**DCL     12448<<ASSIGN
FPT_FID.V
     11550**DCL     11546--DCLINIT
FPT_INT
     11915**DCL     11995<>CALL
FPT_INT.V
     11915**DCL     11915--DCLINIT
FPT_LINK
     11614**DCL     12496<>CALL
FPT_LINK.V
     11616**DCL     11616--DCLINIT
FPT_UNFID
     11592**DCL     12485<>CALL    12491<>CALL
FPT_UNFID.ACCT_
     11593**DCL     12477<<ASSIGN  12488<<ASSIGN
FPT_UNFID.SN_
     11594**DCL     12484<<ASSIGN  12489<<ASSIGN
FPT_UNFID.TEXTFID_
     11592**DCL     12474<<ASSIGN  12487<<ASSIGN
FPT_UNFID.V
     11596**DCL     11592--DCLINIT
FROM_FID
     10655**DCL     12473<<ASSIGN  12474--ASSIGN  12492>>IF      12493--ASSIGN  12495>>CALLBLT
GET_MODTIME
     12506**PROC    12035--CALL
GET_PFLGS
     12431**PROC    12027--CALL
GOTPROC IN PROCEDURE FIND_PROC
     12416**LABEL   12403--GOTO    12411--GOTO
HEAD$
     10615**DCL     12037>>IF      12049>>IF      12058>>IF      12058>>IF      12058>>IF      12068>>IF
     12068>>IF
HEADBUF
     10558**DCL     10615--DCLINIT 11698--DCLINIT 11699--DCLINIT
HEAD_KEY
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:133  
     10579**DCL     11696--DCLINIT 11697--DCLINIT
HW_PTB_UNITS
     10693**DCL     11969<>CALL
HW_WSQ0PT
     10691**DCL     11968<>CALL
I
     10637**DCL     11958<<DOINDEX 11959>>ASSIGN  11978<<DOINDEX 11979>>CALL    11979>>CALL    12156<<DOINDEX
     12157>>ASSIGN  12165<<DOINDEX 12166>>IF      12167>>IF      12168>>IF      12304<<DOINDEX 12305<>CALL
     12312<<DOINDEX 12313<>CALL    12328<<DOINDEX 12329>>ASSIGN  12337<<DOINDEX 12338>>ASSIGN  12358<<DOINDEX
     12359>>ASSIGN
INBUF
     10557**DCL     11254--DCLINIT 11255--DCLINIT
INSRT_CMD
     12207**PROC    12086--CALL
INSRT_ERR IN PROCEDURE INSRT_CMD
     12246**LABEL   12225--CALLALT 12227--CALLALT 12236--CALLALT
IPA_RESTART
     10608**DCL     11994<<REMEMBR
IPA_SYSACCT
     10628**DCL     10567--DCLINIT 12399>>IF
IPC$ADD_LIB
     10704**DCL-ENT 12227--CALL
IPC$ADD_SPCL
     10702**DCL-ENT 12225--CALL
IPC$DEL_SPCL
     10703**DCL-ENT 12176--CALL
IPD$BREAK
     10710**DCL-ENT 11915--DCLINIT
IPD$FREE_PROC
     10708**DCL-ENT 12175--CALL
IPD$GET_SLOT
     10709**DCL-ENT 12218--CALL    12262--CALL
IPD$MON_VALUE
     10705**DCL-ENT 11968--CALL    11969--CALL    11970--CALL    11971--CALL    11972--CALL    11973--CALL
     11974--CALL    11975--CALL    11976--CALL    11977--CALL    11979--CALL    11981--CALL    11983--CALL
     11985--CALL
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:134  
IPD$SETSEG
     10707**DCL-ENT 11982--CALL    11984--CALL    11986--CALL
IPE$LIST1_HDR
     10711**DCL-ENT 12285--CALL    12303--CALL    12327--CALL
IPE$LIST1_INFO
     10712**DCL-ENT 12286--CALL    12305--CALL    12330--CALL
IPE$LIST2_HDR
     10713**DCL-ENT 12291--CALL    12311--CALL    12336--CALL
IPE$LIST2_INFO
     10714**DCL-ENT 12292--CALL    12313--CALL    12339--CALL
IP_PTB_UNITS
     10692**DCL     11969<>CALL
IP_WSQ0PT
     10690**DCL     11968<>CALL
IT_SCPUWSPTD
     10695**DCL     11979<>CALL
J IN PROCEDURE GET_MODTIME
     12508**DCL     12511<<DOINDEX 12512>>IF      12514>>ASSIGN
JITERR
     10584**DCL     11323--DCLINIT 11942<<ASSIGN  12003<<ASSIGN  12127<<ASSIGN  12176<>CALL    12193<<ASSIGN
     12225<>CALL    12227<>CALL    12236<>CALL    12464<<ASSIGN
JITERR.CODE
     10588**DCL     12045<<ASSIGN  12054<<ASSIGN  12065<<ASSIGN  12074<<ASSIGN  12095>>IF      12108<<ASSIGN
     12114<<ASSIGN  12151<<ASSIGN  12197<<ASSIGN  12215<<ASSIGN  12231<<ASSIGN  12244<<ASSIGN  12256>>IF
     12267<<ASSIGN  12279<<ASSIGN  12460<<ASSIGN
JITERR_INIT
     10590**DCL     11942>>ASSIGN  12003>>ASSIGN
LAST_AUTO
     10622**DCL     11973<>CALL
LIST_CMD
     12276**PROC    12088--CALL
LOOKUP$
     10617**DCL     11983<>CALL    11984<>CALL    12329>>ASSIGN  12338>>ASSIGN
LOOP_END
     12121**LABEL   12100--CALLALT 12102--GOTO
M$CLOSE
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:135  
      5647**DCL-ENT 12121--CALL    12187--CALL
M$CVM
      5685**DCL-ENT 11963--CALL
M$EI
     10700**DCL     11992--ASSIGN  12032--IF      12037--IF
M$ERR
      5659**DCL-ENT 12092--CALL
M$ERRMSG
      5710**DCL-ENT 12100--CALL    12129--CALL
M$EXIT
      5659**DCL-ENT 12119--CALL
M$FID
      5710**DCL-ENT 12449--CALL
M$INT
      5702**DCL-ENT 11995--CALL
M$LINK
      5659**DCL-ENT 12496--CALL
M$OPEN
      5647**DCL-ENT 12186--CALL    12452--CALL
M$READ
      5648**DCL-ENT 12036--CALL
M$SAD
      5686**DCL-ENT 11950--CALL    11951--CALL    11952--CALL
M$SI
     10698**DCL     11993--ASSIGN
M$SPRIV
      5706**DCL-ENT 12008--CALL    12011--CALL    12013--CALL
M$UNFID
      5710**DCL-ENT 12485--CALL    12491--CALL
M$WRITE
      5648**DCL-ENT 11947--CALL    12289--CALL    12301--CALL    12309--CALL    12317--CALL    12325--CALL
     12334--CALL
M$XXX
      5659**DCL-ENT 12130--CALL
MAXPROCS
     10620**DCL     11971<>CALL
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:136  
MAX_LOOKUP
     10624**DCL     11976<>CALL    12321>>IF      12328>>DOINDEX 12337>>DOINDEX
MM$DESC.BOUND
      7016**DCL      7017--REDEF
MM$DESC.FLGS
      7017**DCL      7017--REDEF
MM$PPUT.USER#
      7005**DCL      7005--REDEF
MM_BYP$
      6936**DCL      6936--IMP-PTR
MOVE_PROC
     12470**PROC    12236--CALL
MUAIS
     10625**DCL     11977<>CALL    12156>>DOINDEX
NEED_PRIV
     12114**LABEL   12008--CALLALT 12013--CALLALT
NODE_TYPE
     10643**DCL     12360<<ASSIGN  12361>>IF      12363>>IF      12369>>IF      12371>>IF      12373>>IF
     12373>>IF      12375>>ASSIGN  12377>>IF      12379>>IF
NOT_THERE
     12027**LABEL   12020--CALLALT
NOW_WHAT IN PROCEDURE OPEN_FID
     12464**LABEL   12452--CALLALT
NO_HEAD
     12101**LABEL   12034--GOTO    12036--CALLALT
NO_SLOTS IN PROCEDURE INSRT_CMD
     12235**LABEL   12218--CALLALT
NO_SLOTS2 IN PROCEDURE REPL_CMD
     12260**LABEL   12262--CALLALT
NPROCS
     10619**DCL     11970<>CALL    12165>>DOINDEX 12304>>DOINDEX 12312>>DOINDEX 12400>>DOINDEX
NSCPU
     10626**DCL     11975<>CALL    11978>>DOINDEX
OK_2_LOOK
     12014**LABEL   12012--GOTO
OPEN_EI
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:137  
     11415**DCL     12186<>CALL    12452<>CALL
OPEN_EI.ACSVEH_
     11417**DCL     11418--REDEF
OPEN_EI.ALTKEYS_
     11423**DCL     11424--REDEF   11424--REDEF
OPEN_EI.HDR_
     11422**DCL     11423--REDEF
OPEN_EI.TAB_
     11421**DCL     11422--REDEF
OPEN_EI.UHL_
     11415**DCL     11416--REDEF   11416--REDEF
OPEN_EI.V
     11424**DCL     11415--DCLINIT
OPEN_EI.V.FSN#
     11455**DCL     11455--REDEF   11455--REDEF
OPEN_EI.V.RES#
     11439**DCL     11549--DCLINIT
OPEN_EI.WSN_
     11421**DCL     11421--REDEF
OPEN_FID
     12445**PROC    12031--CALL
OUT$BLK.CODE
     11028**DCL     12357>>ASSIGN  12360>>ASSIGN
OUT$BLK.NSUBLKS
     11032**DCL     12358>>DOINDEX
OUT$BLK.SUBLK$
     11053**DCL     12359>>ASSIGN
OUT$SYM.COUNT
     11089**DCL     11092--IMP-SIZ
OUT$SYM.TEXTC$
     11084**DCL     12362>>ASSIGN  12366>>ASSIGN  12366>>ASSIGN  12378>>ASSIGN
P$
     10616**DCL     11981<>CALL    11982<>CALL    12155>>ASSIGN  12155>>ASSIGN  12166>>IF      12167>>IF
     12168>>IF      12179>>ASSIGN  12209>>IF      12219>>ASSIGN  12260>>IF      12401>>IF      12401>>IF
     12408>>IF      12408>>IF      12408>>IF      12416>>IF      12418>>IF      12419>>IF      12420>>IF
     12421>>IF      12422>>IF
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:138  
PACCT
     10648**DCL     12366<<ASSIGN  12367--ASSIGN
PACCT$ IN PROCEDURE FIND_PROC
     12392**DCL     12390--PROC    12399>>IF      12408>>IF
PARSE_ERR
     12118**LABEL   12004--CALLALT
PCL_CMD
     10600**DCL     10601--REDEF   11615--DCLINIT
PCL_NAME
     11645**DCL     11614--DCLINIT
PCNTRL
     10657**DCL     12176<>CALL    12225<>CALL    12227<>CALL    12356<<ASSIGN
PCNTRL.CMD#
     10658**DCL     12007>>IF      12009>>IF      12023>>IF      12080>>DOCASE  12357<<ASSIGN
PCNTRL.FID$
     10667**DCL     12029>>IF      12031<>CALL    12378<<ASSIGN
PCNTRL.LIST_AUTO
     10664**DCL     12297>>IF      12372<<ASSIGN
PCNTRL.LIST_SYS
     10663**DCL     12321>>IF      12370<<ASSIGN
PCNTRL.MODTIME
     10668**DCL     12035<>CALL
PCNTRL.PACCT$
     10660**DCL     12020<>CALL    12367<<ASSIGN
PCNTRL.PERM
     10662**DCL     12180>>IF      12220<<ASSIGN  12235>>IF      12380<<ASSIGN
PCNTRL.PFLGS
     10671**DCL     12028<<ASSIGN
PCNTRL.PNAME$
     10659**DCL     12018>>IF      12020<>CALL    12097>>IF      12098>>ASSIGN  12098>>ASSIGN  12183>>ASSIGN
     12183>>ASSIGN  12277>>IF      12362<<ASSIGN  12490>>ASSIGN  12490>>ASSIGN
PCNTRL.PNUM
     10669**DCL     12022<<ASSIGN  12079>>ASSIGN
PCNTRL.PTYPE
     10661**DCL     12023>>IF      12024<<ASSIGN  12027<>CALL    12058>>IF      12058>>IF      12068>>IF
     12068>>IF      12224>>IF      12224>>IF      12226>>IF      12375<<ASSIGN
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:139  
PCNTRL_INIT
     10564**DCL     12356>>ASSIGN
PFLGS
     10646**DCL     12027<>CALL    12028>>ASSIGN
PGTBL$
     10613**DCL     11991<<ASSIGN
PN IN PROCEDURE FIND_PROC
     12395**DCL     12400<<DOINDEX 12401>>IF      12401>>IF      12407<<DOINDEX 12408>>IF      12408>>IF
     12408>>IF      12416>>IF      12418>>IF      12419>>IF      12420>>IF      12421>>IF      12422>>IF
     12423>>ASSIGN
PNAME$ IN PROCEDURE FIND_PROC
     12391**DCL     12390--PROC    12401>>IF      12401>>IF      12408>>IF      12408>>IF
PNUM
     10644**DCL     12020<>CALL    12022>>ASSIGN  12079<<ASSIGN  12144>>IF      12144>>IF      12155>>ASSIGN
     12155>>ASSIGN  12159>>IF      12159>>IF      12159>>IF      12159>>IF      12166>>IF      12175<>CALL
     12176<>CALL    12179>>ASSIGN  12180>>IF      12209>>IF      12209>>IF      12209>>IF      12260>>IF
     12261>>ASSIGN  12277>>IF      12282>>IF      12286<>CALL    12292<>CALL    12329<<ASSIGN  12330<>CALL
     12338<<ASSIGN  12339<>CALL
PNUM IN PROCEDURE FIND_PROC
     12393**DCL     12390--PROC    12423<<ASSIGN
PP
     10639**DCL     11959<<ASSIGN  11960>>ASSIGN
PPRIV_CHNG
     11900**DCL     12008<>CALL    12013<>CALL
PPRIV_CHNG.V
     11900**DCL     11900--DCLINIT
PPRIV_LOOK
     11883**DCL     12011<>CALL
PPRIV_LOOK.V
     11883**DCL     11883--DCLINIT
PPUT$
     10632**DCL     10633--REDEF   11955>>ASSIGN  11966<<ASSIGN
PPUT_CVM
     11930**DCL     11963<>CALL
PPUT_CVM.V
     11930**DCL     11930--DCLINIT
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:140  
PPUT_CVM.V.PHYSICAL#
     11930**DCL     11962<<ASSIGN
PPUT_CVM.V.PPNO#
     11931**DCL     11960<<ASSIGN
PPUT_CVM.V.VPNO#
     11932**DCL     11961<<ASSIGN
PPUT_DESC
     10631**DCL     11955<<ASSIGN  11958>>DOINDEX 11958>>DOINDEX 11958>>DOINDEX
PPUT_OFFSET
     10641**DCL     11956<<ASSIGN  11957>>ASSIGN  11966>>ASSIGN
PPUT_REDEF.SID
     10635**DCL     11954<<ASSIGN
PROCFLAGS IN PROCEDURE GET_PFLGS
     12433**DCL     12431--PROC    12434<<ASSIGN  12435<<ASSIGN  12436<<ASSIGN  12437<<ASSIGN  12438<<ASSIGN
PROC_SLOT
     10647**DCL     12086<>CALL    12261<<ASSIGN  12262<>CALL    12263<>CALL
PTYPE
     10645**DCL     12020<>CALL    12024>>ASSIGN
PTYPE IN PROCEDURE FIND_PROC
     12394**DCL     12390--PROC    12418<<ASSIGN  12419<<ASSIGN  12420<<ASSIGN  12421<<ASSIGN  12422<<ASSIGN
PTYPE IN PROCEDURE GET_PFLGS
     12432**DCL     12431--PROC    12434>>IF      12435>>IF      12436>>IF      12437>>IF      12438>>IF
P_AUTO_START
      5162**DCL     11972<>CALL
P_LAST_AUTO
      5163**DCL     11973<>CALL
P_MAXPROCS
      5161**DCL     11971<>CALL
P_MAX_LOOKUP
      5166**DCL     11976<>CALL
P_NPROCS
      5160**DCL     11970<>CALL
P_USED_AUTO
      5165**DCL     11974<>CALL
READ_CMD
     12002**LABEL   11994--REMEMBR
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:141  
READ_HEAD
     11696**DCL     12036<>CALL
READ_HEAD.STATION_
     11699**DCL     11700--REDEF
READ_HEAD.V
     11700**DCL     11696--DCLINIT
READ_HEAD.V.DVBYTE.REREAD#
     11711**DCL     11711--REDEF
READ_HEAD.V.INDX#
     11709**DCL     11709--REDEF
READ_SI.STATION_
     11255**DCL     11256--REDEF
READ_SI.V
     11256**DCL     11252--DCLINIT
READ_SI.V.DVBYTE.REREAD#
     11267**DCL     11267--REDEF
READ_SI.V.INDX#
     11265**DCL     11265--REDEF
REPL_CMD
     12253**PROC    12084--CALL
REPL_ERR IN PROCEDURE REPL_CMD
     12269**LABEL   12258--GOTO    12263--CALLALT
REPL_THIS IN PROCEDURE INSRT_CMD
     12222**ENTRY   12263--CALL
ROSEG$
     10612**DCL     11990<<ASSIGN
RU_ACCT
     11497**DCL     11420--DCLINIT 11547--DCLINIT 11593--DCLINIT 12184<<ASSIGN  12477--ASSIGN
RU_ACCT.ACCT#
     11497**DCL     12475>>IF      12476<<ASSIGN  12480>>IF
RU_NAME
     11484**DCL     11416--DCLINIT 11547--DCLINIT 11593--DCLINIT 12183<<ASSIGN  12490<<ASSIGN
RU_PASS
     11510**DCL     11417--DCLINIT 11548--DCLINIT 11594--DCLINIT
RU_PASS.PASS#
     11510**DCL     12185<<ASSIGN
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:142  
RU_SN
     11523**DCL     11415--DCLINIT 11548--DCLINIT 11594--DCLINIT 12484--ASSIGN
RU_SN.SN#
     11523**DCL     12479>>IF      12483<<ASSIGN
SCPUWSPTD
     10627**DCL     11979<>CALL
SEE_MONITOR
     11819**DCL     11950<>CALL
SEE_MONITOR.V
     11819**DCL     11819--DCLINIT
SEE_PPUT
     11853**DCL     11952<>CALL
SEE_PPUT.V
     11853**DCL     11853--DCLINIT
SEE_TIGRDATA
     11836**DCL     11951<>CALL
SEE_TIGRDATA.V
     11836**DCL     11836--DCLINIT
SI$
     10606**DCL     11993<<ASSIGN
SLOT IN PROCEDURE INSRT_CMD
     12208**DCL     12207--PROC    12218<>CALL    12219>>ASSIGN  12222--ENTRY   12225<>CALL    12227<>CALL
SPIDER_CMD
     10696**DCL     12004<>CALL
STLVEC
     10561**DCL     11868--DCLINIT
SYSACCT
     11659**DCL     11614--DCLINIT 12184>>ASSIGN  12488--ASSIGN
SYSACCT.ACCT#
     11659**DCL     12480>>IF
SYSSN
     11673**DCL     12489--ASSIGN
S_NSCPU
     10694**DCL     11975<>CALL
TARANTULA
     12127**LABEL   11950--CALLALT 11951--CALLALT 11952--CALLALT 11995--CALLALT
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:143  
TC_FREE.TEXT
     11209**DCL     12260>>IF
TO_FID
     10656**DCL     12486<<ASSIGN  12487--ASSIGN  12492>>IF      12493--ASSIGN  12495>>CALLBLT
TPTR$
     10630**DCL     10629--DCLINIT
TRY_CHNG
     12013**LABEL   12011--CALLALT
TXTC_CMD.COUNT
     10602**DCL     12493<<ASSIGN
TXTC_CMD.TEXT
     10603**DCL     12495<<CALLBLT
T_AUTOPROCS
     11228**DCL     12324--ASSIGN
T_COPY
     11216**DCL     12493--ASSIGN  12495>>CALLBLT
T_CRLF
     10582**DCL     12288--ASSIGN  12308--ASSIGN  12316--ASSIGN  12333--ASSIGN
T_HELLO.COUNT
     11212**DCL     11943<<ASSIGN
T_HELLO.TEXT
     11213**DCL     11944<<CALLBLT 11946--ASSIGN
T_OVER
     11220**DCL     12493--ASSIGN  12495>>CALLBLT
T_PROMPT
     10583**DCL     12004--CALL
T_SYSPROCS
     11224**DCL     12300--ASSIGN
U$
     10652**DCL     12157<<ASSIGN  12158>>IF      12159>>IF      12159>>IF      12159>>IF      12159>>IF
USED_AUTO
     10623**DCL     11974<>CALL    12407>>DOINDEX
USRT$
     10618**DCL     11985<>CALL    11986<>CALL    12157>>ASSIGN
VLR_FID
     11569**DCL     11550--DCLINIT
PL6.E3A0      #001=IPA$SPIDER File=IPA$SPIDER.:E05TSI                            TUE 07/29/97 22:39 Page:144  
VP
     10640**DCL     11957<<ASSIGN  11961>>ASSIGN  11964<<ASSIGN  11964>>ASSIGN
WRITE_LO
     11292**DCL     11947<>CALL    12289<>CALL    12301<>CALL    12309<>CALL    12317<>CALL    12325<>CALL
     12334<>CALL
WRITE_LO.BUF_
     11292**DCL     11946<<ASSIGN  12288<<ASSIGN  12300<<ASSIGN  12308<<ASSIGN  12316<<ASSIGN  12324<<ASSIGN
     12333<<ASSIGN
WRITE_LO.STATION_
     11294**DCL     11294--REDEF
WRITE_LO.V
     11295**DCL     11292--DCLINIT
WRITE_LO.V.DVBYTE.VFC#
     11301**DCL     11301--REDEF
WSPTD$
     10611**DCL     11989<<ASSIGN
XTX$ADAPT
     11114**DCL-ENT 11193--DCLINIT
XUR$ERRMSG
     10718**DCL-ENT 12118--CALL
XUR$GETCMD
     10717**DCL-ENT 12004--CALL
XUR$INIT
     10716**DCL-ENT 11996--CALL
XUR_INIT
     11119**DCL     11996<>CALL
XUR_INIT.WORKR_
     11133**DCL     11134--REDEF
