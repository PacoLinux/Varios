VERSION E05

PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:1    
        1        1        /*M* KCO$OPCG - Open routines for COMGROUPS */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 8        ,IAD=0,PRB */
        9        9        /**/
       10       10        /*P* NAME:         KCO$OPCG
       11       11
       12       12             PURPOSE:      To provide open service for COMGROUPS.
       13       13
       14       14        */
       15       15
       16       16
       17       17        /*F* NAME:         KCO$OPCG
       18       18
       19       19             PURPOSE:      Initial routine called to open to COMGROUP
       20       20
       21       21        */
       22       22
       23       23
       24       24        KCO$OPCG: PROC(PN$);
       25       25
       26       26
       27       27        /**/
       28       28        /* INCLUDES */
       29       29        /**/
       30       30        %INCLUDE CP_6_SUBS;
       31      570        %INCLUDE B_STRINGS_C;
       32      699        %INCLUDE F$JIT_C;
       33     1129        %MACRO F$DCB#(BASED=BASED);
       34     1130        %INCLUDE F$DCB;
       35     1179        %MEND;
       36     1180        %INCLUDE FM$MACROS;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:2    
       37     1555        %INCLUDE F_FMTCODE_C;
       38     1589        %INCLUDE KC_ERRORS_C;
       39     1636        %INCLUDE F_ERRORS_C;
       40     1876        %INCLUDE M_INFO_C;
       41     2016        %INCLUDE B$MAP;
       42     2115
       43     2116
       44     2117        /**/
       45     2118        /* PARAMETERS */
       46     2119        /**/
       47     2120    1   DCL PN$ PTR;
       48     2121
       49     2122
       50     2123        /**/
       51     2124        /* BASED STRUCTURES */
       52     2125        /**/
       53     2126        %F$DCB# (BASED="BASED(JDCB$)");
       54     2176        %FM$CFU (BASED="BASED(CFU$)");
       55     2182
       56     2183
       57     2184        /**/
       58     2185        /* AUTO */
       59     2186        /**/
       60     2187    1   DCL JDCB$ PTR;
       61     2188    1   DCL CFU$ PTR;
       62     2189    1   DCL I UBIN;
       63     2190
       64     2191
       65     2192        /**/
       66     2193        /* EXTERNAL DATA */
       67     2194        /**/
       68     2195    1   DCL B$JIT$ PTR SYMREF;
       69     2196
       70     2197
       71     2198        /**/
       72     2199        /* EXTERNAL ROUTINES */
       73     2200        /**/
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:3    
       74     2201    1   DCL FMD$FLSHBUF ENTRY(1);
       75     2202    1   DCL FMN$OPNF ENTRY(1);
       76     2203    1   DCL FMO$GETDOMAIN ENTRY(1);
       77     2204    1   DCL FMP$CLSERR ENTRY;
       78     2205
       79     2206
       80     2207        /**/
       81     2208        /* CONSTANT */
       82     2209        /**/
       83     2210        %SUB FCG#='1303'O;
       84     2211        %SUB MID#='17'O;
       85     2212        %ERRCODE (NAME=ERRCGSHARE,COD#=%E$CGSHARE);
       86     2216        %ERRCODE (NAME=ERRFILECG,COD#=%E$FILECG);
       87     2220        /**/
       88     2221        %EJECT;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:4    
       89     2222
       90     2223
       91     2224        /*D* NAME:         KCO$OPCG
       92     2225
       93     2226             CALL:         CALL KCO$OPCG(PN$) ALTRET;
       94     2227
       95     2228             DESCRIPTION:  This routine is called from FMM$OPN for ASN=COMGROUP
       96     2229                           after the FPT has been merged into the DCB.  It
       97     2230                           sets some values into the DCB and calls FMN$OPNF
       98     2231                           to create a new disk file or to open to an existing
       99     2232                           one.  A normal return from FMN$OPNF indicates that
      100     2233                           the file was opened successfully, and some
      101     2234                           clean-up is done before returning to the caller.
      102     2235                           If FMN$OPNF ALTRETs, it is assumed that all
      103     2236                           necessary clean-up has already been done.
      104     2237
      105     2238        */
      106     2239
      107     2240
      108     2241    1         B$JIT.ERR='0'B;
      109     2242    1         JDCB$=B$JIT.DCB$;
      110     2243    1         F$DCB.IASN=%FILE#;
      111     2244    1         F$DCB.ORG=%CG#;
      112     2245    1         F$DCB.TDA=%TERMINAL#;  /* For FMN$OPNF */
      113     2246    1         IF F$DCB.IXTNSIZE=1 THEN
      114     2247    1          F$DCB.IXTNSIZE=3;
      115     2248    1         ELSE IF F$DCB.IXTNSIZE=2 THEN
      116     2249    1           F$DCB.IXTNSIZE=30;
      117     2250    1         IF F$DCB.SHARE=0 THEN
      118     2251    1          F$DCB.SHARE=%ALL#;
      119     2252    1         IF F$DCB.SHARE~=%ALL# AND NOT F$DCB.AU THEN
      120     2253    2           DO;
      121     2254    2           B$JIT.ERR=ERRCGSHARE;
      122     2255    2           GOTO ERR;
      123     2256    2           END;
      124     2257        /*E*    ERROR: KCO-E$CGSHARE-2
      125     2258                MESSAGE: Only the AU may open a comgroup with other than
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:5    
      126     2259                         SHARE=ALL
      127     2260        */
      128     2261
      129     2262    1         CALL FMN$OPNF(PN$);
      130     2263
      131     2264    1         IF B$JIT.ERR.CODE~=0 THEN
      132     2265    1          GOTO ERR;
      133     2266    1         IF F$DCB.FCD='0'B THEN           /* Test open */
      134     2267    1          IF F$DCB.ORG~=%CG# THEN
      135     2268    2            DO;
      136     2269    2            B$JIT.ERR=ERRFILECG;
      137     2270    2            GOTO ERR;
      138     2271    2            END;
      139     2272    1          ELSE
      140     2273    1           RETURN;
      141     2274    2           DO I=0 TO 4;
      142     2275    2           CALL FMD$FLSHBUF(I);
      143     2276    2           END;
      144     2277    1         IF F$DCB.ORG~=%CG# THEN
      145     2278    2           DO;
      146     2279    2           CALL FMP$CLSERR;
      147     2280    2           B$JIT.ERR=ERRFILECG;
      148     2281    2           GOTO ERR;
      149     2282    2           END;
      150     2283        /*    Attempt to open a non-comgroup file with
      151     2284                            ASN=COMGROUP.  Message text is in KCO$INIT.
      152     2285        */
      153     2286    1         F$DCB.EOMCHAR=%EOM_EOR#;
      154     2287    1         IF F$DCB.DVFC=BINASC(0) THEN
      155     2288    1          F$DCB.DVFC='A';
      156     2289    1         F$DCB.ORG=%TERMINAL#;
      157     2290    1         F$DCB.IFMT=%FMTFPRG#;            /* Not really FPRG but gives us the   */
      158     2291    1         F$DCB.ATTR.BIN = '1'B;
      159     2292                                               /* right handling in FSE$FORMAT       */
      160     2293    1         RETURN;
      161     2294
      162     2295    1   ERR:  ;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:6    
      163     2296    1         IF B$JIT.ERR.CODE=%E$FILEBUSY OR B$JIT.ERR.CODE=%E$NOFILE THEN
      164     2297    2           DO;
      165     2298    2           B$JIT.ERR.FCG=FCG#;
      166     2299    2           B$JIT.ERR.MID=MID#;
      167     2300    2           END;
      168     2301        /*E*  ERROR: KCO-E$FILEBUSY-2
      169     2302              MESSAGE: Comgroup% %UF% is busy
      170     2303        */
      171     2304        /*E*  ERROR: KCO-E$NOFILE-2
      172     2305              MESSAGE: Comgroup% %UF% does not exist
      173     2306              MESSAGE1:Comgroup %UF does not exist in DP#%SN.%AC
      174     2307        */
      175     2308    1         RETURN;
      176     2309
      177     2310    1   END KCO$OPCG;
      178     2311        %EOD;

PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:7    
--  Include file information  --

   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   M_INFO_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KCO$OPCG.

   Procedure KCO$OPCG requires 109 words for executable code.
   Procedure KCO$OPCG requires 10 words of local(AUTO) storage.

PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:8    

 Object Unit name= KCO$OPCG                                   File name= KCO$OPCG.:E05TOU
 UTS= JUL 30 '97 00:16:16.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  KCO$OPCG
    1   Proc  even  none   109    155  KCO$OPCG
    2  RoData even  none     1      1  KCO$OPCG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KCO$OPCG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMN$OPNF
         yes           Std       1 FMD$FLSHBUF
         yes           Std       0 FMP$CLSERR
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                B_VECTNIL
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:9    


        1        1        /*M* KCO$OPCG - Open routines for COMGROUPS */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 8        ,IAD=0,PRB */
        9        9        /**/
       10       10        /*P* NAME:         KCO$OPCG
       11       11
       12       12             PURPOSE:      To provide open service for COMGROUPS.
       13       13
       14       14        */
       15       15
       16       16
       17       17        /*F* NAME:         KCO$OPCG
       18       18
       19       19             PURPOSE:      Initial routine called to open to COMGROUP
       20       20
       21       21        */
       22       22
       23       23
       24       24        KCO$OPCG: PROC(PN$);

     24  1 000000   000000 700200 xent  KCO$OPCG     TSX0  ! X66_AUTO_1
         1 000001   000012 000001                    ZERO    10,1

       25       25
       26       26
       27       27        /**/
       28       28        /* INCLUDES */
       29       29        /**/
       30       30        %INCLUDE CP_6_SUBS;
       31      570        %INCLUDE B_STRINGS_C;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:10   
       32      699        %INCLUDE F$JIT_C;
       33     1129        %MACRO F$DCB#(BASED=BASED);
       34     1130        %INCLUDE F$DCB;
       35     1179        %MEND;
       36     1180        %INCLUDE FM$MACROS;
       37     1555        %INCLUDE F_FMTCODE_C;
       38     1589        %INCLUDE KC_ERRORS_C;
       39     1636        %INCLUDE F_ERRORS_C;
       40     1876        %INCLUDE M_INFO_C;
       41     2016        %INCLUDE B$MAP;
       42     2115
       43     2116
       44     2117        /**/
       45     2118        /* PARAMETERS */
       46     2119        /**/
       47     2120    1   DCL PN$ PTR;
       48     2121
       49     2122
       50     2123        /**/
       51     2124        /* BASED STRUCTURES */
       52     2125        /**/
       53     2126        %F$DCB# (BASED="BASED(JDCB$)");
       54     2176        %FM$CFU (BASED="BASED(CFU$)");
       55     2182
       56     2183
       57     2184        /**/
       58     2185        /* AUTO */
       59     2186        /**/
       60     2187    1   DCL JDCB$ PTR;
       61     2188    1   DCL CFU$ PTR;
       62     2189    1   DCL I UBIN;
       63     2190
       64     2191
       65     2192        /**/
       66     2193        /* EXTERNAL DATA */
       67     2194        /**/
       68     2195    1   DCL B$JIT$ PTR SYMREF;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:11   
       69     2196
       70     2197
       71     2198        /**/
       72     2199        /* EXTERNAL ROUTINES */
       73     2200        /**/
       74     2201    1   DCL FMD$FLSHBUF ENTRY(1);
       75     2202    1   DCL FMN$OPNF ENTRY(1);
       76     2203    1   DCL FMO$GETDOMAIN ENTRY(1);
       77     2204    1   DCL FMP$CLSERR ENTRY;
       78     2205
       79     2206
       80     2207        /**/
       81     2208        /* CONSTANT */
       82     2209        /**/
       83     2210        %SUB FCG#='1303'O;
       84     2211        %SUB MID#='17'O;
       85     2212        %ERRCODE (NAME=ERRCGSHARE,COD#=%E$CGSHARE);
       86     2216        %ERRCODE (NAME=ERRFILECG,COD#=%E$FILECG);
       87     2220        /**/
       88     2221        %EJECT;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:12   
       89     2222
       90     2223
       91     2224        /*D* NAME:         KCO$OPCG
       92     2225
       93     2226             CALL:         CALL KCO$OPCG(PN$) ALTRET;
       94     2227
       95     2228             DESCRIPTION:  This routine is called from FMM$OPN for ASN=COMGROUP
       96     2229                           after the FPT has been merged into the DCB.  It
       97     2230                           sets some values into the DCB and calls FMN$OPNF
       98     2231                           to create a new disk file or to open to an existing
       99     2232                           one.  A normal return from FMN$OPNF indicates that
      100     2233                           the file was opened successfully, and some
      101     2234                           clean-up is done before returning to the caller.
      102     2235                           If FMN$OPNF ALTRETs, it is assumed that all
      103     2236                           necessary clean-up has already been done.
      104     2237
      105     2238        */
      106     2239
      107     2240
      108     2241    1         B$JIT.ERR='0'B;

   2241  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000012 450100                    STZ     10,,PR0

      109     2242    1         JDCB$=B$JIT.DCB$;

   2242  1 000004   000232 236100                    LDQ     154,,PR0
         1 000005   200004 756100                    STQ     JDCB$,,AUTO

      110     2243    1         F$DCB.IASN=%FILE#;

   2243  1 000006   200004 471500                    LDP1    JDCB$,,AUTO
         1 000007   000001 236007                    LDQ     1,DL
         1 000010   100103 552104                    STBQ    67,'04'O,PR1

      111     2244    1         F$DCB.ORG=%CG#;

PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:13   
   2244  1 000011   013000 236003                    LDQ     5632,DU
         1 000012   100032 552140                    STBQ    26,'40'O,PR1

      112     2245    1         F$DCB.TDA=%TERMINAL#;  /* For FMN$OPNF */

   2245  1 000013   000010 236007                    LDQ     8,DL
         1 000014   100070 552134                    STBQ    56,'34'O,PR1

      113     2246    1         IF F$DCB.IXTNSIZE=1 THEN

   2246  1 000015   100041 235100                    LDA     33,,PR1
         1 000016   000001 115007                    CMPA    1,DL
         1 000017   000023 601000 1                  TNZ     s:2248

      114     2247    1          F$DCB.IXTNSIZE=3;

   2247  1 000020   000003 235007                    LDA     3,DL
         1 000021   100041 755100                    STA     33,,PR1
         1 000022   000027 710000 1                  TRA     s:2250

      115     2248    1         ELSE IF F$DCB.IXTNSIZE=2 THEN

   2248  1 000023   000002 115007                    CMPA    2,DL
         1 000024   000027 601000 1                  TNZ     s:2250

      116     2249    1           F$DCB.IXTNSIZE=30;

   2249  1 000025   000036 235007                    LDA     30,DL
         1 000026   100041 755100                    STA     33,,PR1

      117     2250    1         IF F$DCB.SHARE=0 THEN

   2250  1 000027   100031 236100                    LDQ     25,,PR1
         1 000030   000600 316007                    CANQ    384,DL
         1 000031   000035 601000 1                  TNZ     s:2252

      118     2251    1          F$DCB.SHARE=%ALL#;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:14   

   2251  1 000032   000000 376000 2                  ANQ     0
         1 000033   000200 276007                    ORQ     128,DL
         1 000034   100031 756100                    STQ     25,,PR1

      119     2252    1         IF F$DCB.SHARE~=%ALL# AND NOT F$DCB.AU THEN

   2252  1 000035   100031 236100                    LDQ     25,,PR1
         1 000036   000600 376007                    ANQ     384,DL
         1 000037   000200 116007                    CMPQ    128,DL
         1 000040   000047 600000 1                  TZE     s:2262
         1 000041   100031 236100                    LDQ     25,,PR1
         1 000042   200000 316003                    CANQ    65536,DU
         1 000043   000047 601000 1                  TNZ     s:2262

      120     2253    2           DO;

      121     2254    2           B$JIT.ERR=ERRCGSHARE;

   2254  1 000044   000000 236000 0                  LDQ     ERRCGSHARE
         1 000045   000012 756100                    STQ     10,,PR0

      122     2255    2           GOTO ERR;

   2255  1 000046   000142 710000 1                  TRA     ERR

      123     2256    2           END;
      124     2257        /*E*    ERROR: KCO-E$CGSHARE-2
      125     2258                MESSAGE: Only the AU may open a comgroup with other than
      126     2259                         SHARE=ALL
      127     2260        */
      128     2261
      129     2262    1         CALL FMN$OPNF(PN$);

   2262  1 000047   200003 630500                    EPPR0   @PN$,,AUTO
         1 000050   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000051   000000 701000 xent               TSX1    FMN$OPNF
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:15   
         1 000052   000000 011000                    NOP     0

      130     2263
      131     2264    1         IF B$JIT.ERR.CODE~=0 THEN

   2264  1 000053   000000 470400 xsym               LDP0    B$JIT$
         1 000054   000012 236100                    LDQ     10,,PR0
         1 000055   377770 316007                    CANQ    131064,DL
         1 000056   000142 601000 1                  TNZ     ERR

      132     2265    1          GOTO ERR;
      133     2266    1         IF F$DCB.FCD='0'B THEN           /* Test open */

   2266  1 000057   200004 471500                    LDP1    JDCB$,,AUTO
         1 000060   100031 236100                    LDQ     25,,PR1
         1 000061   020000 316007                    CANQ    8192,DL
         1 000062   000073 601000 1                  TNZ     s:2274

      134     2267    1          IF F$DCB.ORG~=%CG# THEN

   2267  1 000063   100032 236100                    LDQ     26,,PR1
         1 000064   777000 376003                    ANQ     -512,DU
         1 000065   013000 116003                    CMPQ    5632,DU
         1 000066   000072 600000 1                  TZE     s:2273

      135     2268    2            DO;

      136     2269    2            B$JIT.ERR=ERRFILECG;

   2269  1 000067   000001 236000 0                  LDQ     ERRFILECG
         1 000070   000012 756100                    STQ     10,,PR0

      137     2270    2            GOTO ERR;

   2270  1 000071   000142 710000 1                  TRA     ERR

      138     2271    2            END;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:16   
      139     2272    1          ELSE
      140     2273    1           RETURN;

   2273  1 000072   000000 702200 xent               TSX2  ! X66_ARET

      141     2274    2           DO I=0 TO 4;

   2274  1 000073   200006 450100                    STZ     I,,AUTO

      142     2275    2           CALL FMD$FLSHBUF(I);

   2275  1 000074   200006 630500                    EPPR0   I,,AUTO
         1 000075   200010 450500                    STP0    I+2,,AUTO
         1 000076   200010 630500                    EPPR0   I+2,,AUTO
         1 000077   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000100   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000101   000000 011000                    NOP     0

      143     2276    2           END;

   2276  1 000102   200006 235100                    LDA     I,,AUTO
         1 000103   000001 035007                    ADLA    1,DL
         1 000104   200006 755100                    STA     I,,AUTO
         1 000105   000005 115007                    CMPA    5,DL
         1 000106   000074 602000 1                  TNC     s:2275

      144     2277    1         IF F$DCB.ORG~=%CG# THEN

   2277  1 000107   200004 470500                    LDP0    JDCB$,,AUTO
         1 000110   000032 236100                    LDQ     26,,PR0
         1 000111   777000 376003                    ANQ     -512,DU
         1 000112   013000 116003                    CMPQ    5632,DU
         1 000113   000123 600000 1                  TZE     s:2286

      145     2278    2           DO;

      146     2279    2           CALL FMP$CLSERR;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:17   

   2279  1 000114   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000115   000000 701000 xent               TSX1    FMP$CLSERR
         1 000116   000000 011000                    NOP     0

      147     2280    2           B$JIT.ERR=ERRFILECG;

   2280  1 000117   000001 236000 0                  LDQ     ERRFILECG
         1 000120   000000 470400 xsym               LDP0    B$JIT$
         1 000121   000012 756100                    STQ     10,,PR0

      148     2281    2           GOTO ERR;

   2281  1 000122   000142 710000 1                  TRA     ERR

      149     2282    2           END;
      150     2283        /*    Attempt to open a non-comgroup file with
      151     2284                            ASN=COMGROUP.  Message text is in KCO$INIT.
      152     2285        */
      153     2286    1         F$DCB.EOMCHAR=%EOM_EOR#;

   2286  1 000123   000501 236007                    LDQ     321,DL
         1 000124   000003 552104                    STBQ    3,'04'O,PR0

      154     2287    1         IF F$DCB.DVFC=BINASC(0) THEN

   2287  1 000125   000044 236100                    LDQ     36,,PR0
         1 000126   777000 376007                    ANQ     -512,DL
         1 000127   000000 116003                    CMPQ    0,DU
         1 000130   000133 601000 1                  TNZ     s:2289

      155     2288    1          F$DCB.DVFC='A';

   2288  1 000131   101000 236007                    LDQ     33280,DL
         1 000132   000044 552110                    STBQ    36,'10'O,PR0

      156     2289    1         F$DCB.ORG=%TERMINAL#;
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:18   

   2289  1 000133   010000 236003                    LDQ     4096,DU
         1 000134   000032 552140                    STBQ    26,'40'O,PR0

      157     2290    1         F$DCB.IFMT=%FMTFPRG#;            /* Not really FPRG but gives us the   */

   2290  1 000135   023000 236003                    LDQ     9728,DU
         1 000136   000103 552140                    STBQ    67,'40'O,PR0

      158     2291    1         F$DCB.ATTR.BIN = '1'B;

   2291  1 000137   000002 236007                    LDQ     2,DL
         1 000140   000040 256100                    ORSQ    32,,PR0

      159     2292                                               /* right handling in FSE$FORMAT       */
      160     2293    1         RETURN;

   2293  1 000141   000000 702200 xent               TSX2  ! X66_ARET

   2291  1 000142                       ERR          null
      161     2294
      162     2295    1   ERR:  ;
      163     2296    1         IF B$JIT.ERR.CODE=%E$FILEBUSY OR B$JIT.ERR.CODE=%E$NOFILE THEN

   2296  1 000142   000012 236100                    LDQ     10,,PR0
         1 000143   377770 376007                    ANQ     131064,DL
         1 000144   001550 116007                    CMPQ    872,DL
         1 000145   000150 600000 1                  TZE     s:2298
         1 000146   001610 116007                    CMPQ    904,DL
         1 000147   000154 601000 1                  TNZ     s:2308

      164     2297    2           DO;

      165     2298    2           B$JIT.ERR.FCG=FCG#;

   2298  1 000150   130300 236003                    LDQ     45248,DU
         1 000151   000012 752160                    STCQ    10,'60'O,PR0
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:19   

      166     2299    2           B$JIT.ERR.MID=MID#;

   2299  1 000152   000017 236003                    LDQ     15,DU
         1 000153   000012 752110                    STCQ    10,'10'O,PR0

      167     2300    2           END;

      168     2301        /*E*  ERROR: KCO-E$FILEBUSY-2
      169     2302              MESSAGE: Comgroup% %UF% is busy
      170     2303        */
      171     2304        /*E*  ERROR: KCO-E$NOFILE-2
      172     2305              MESSAGE: Comgroup% %UF% does not exist
      173     2306              MESSAGE1:Comgroup %UF does not exist in DP#%SN.%AC
      174     2307        */
      175     2308    1         RETURN;

   2308  1 000154   000000 702200 xent               TSX2  ! X66_ARET

ERRCGSHARE
 Sect OctLoc
   0     000   130317 015652                                                    X...

ERRFILECG
 Sect OctLoc
   0     001   130317 002012                                                    X...

(unnamed)
 Sect OctLoc
   2     000   777777 777177                                                    ....
      176     2309
      177     2310    1   END KCO$OPCG;
      178     2311        %EOD;

PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:20   
--  Include file information  --

   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   M_INFO_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KCO$OPCG.
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:21   

 **** Variables and constants ****

  ****  Section 000 RoData KCO$OPCG

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 ERRCGSHARE                 1-0-0/b STRC        r     1 ERRFILECG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @PN$                       5-0-0/w PTR         r     1 CFU$
     6-0-0/w UBIN        r     1 I                          4-0-0/w PTR         r     1 JDCB$
    *0-0-0/w PTR         r     1 PN$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB


   Procedure KCO$OPCG requires 109 words for executable code.
   Procedure KCO$OPCG requires 10 words of local(AUTO) storage.
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:22   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:23   
          MINI XREF LISTING

B$JIT.DCB$
      1116**DCL      2242>>ASSIGN
B$JIT.ERR
      1026**DCL      2241<<ASSIGN   2254<<ASSIGN   2269<<ASSIGN   2280<<ASSIGN
B$JIT.ERR.CODE
      1027**DCL      2264>>IF       2296>>IF       2296>>IF
B$JIT.ERR.FCG
      1026**DCL      2298<<ASSIGN
B$JIT.ERR.MID
      1027**DCL      1027--REDEF    2299<<ASSIGN
B$JIT$
      2195**DCL      1021--IMP-PTR  2241>>ASSIGN   2242>>ASSIGN   2254>>ASSIGN   2264>>IF       2269>>ASSIGN
      2280>>ASSIGN   2296>>IF       2296>>IF       2298>>ASSIGN   2299>>ASSIGN
B$MAP.SCTRL
      2059**DCL      2060--REDEF
CFU$
      2188**DCL      2177--IMP-PTR
ERR
      2291**LABEL    2255--GOTO     2265--GOTO     2270--GOTO     2281--GOTO
ERRCGSHARE
      2213**DCL      2254>>ASSIGN
ERRFILECG
      2217**DCL      2269>>ASSIGN   2280>>ASSIGN
F$DCB.ACTPOS
      2152**DCL      2152--REDEF
F$DCB.ARS
      2127**DCL      2127--REDEF
F$DCB.ATTR
      2145**DCL      2146--REDEF
F$DCB.ATTR.BIN
      2146**DCL      2291<<ASSIGN
F$DCB.AU
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:24   
      2138**DCL      2252>>IF
F$DCB.BORROW
      2160**DCL      2160--REDEF    2160--REDEF    2160--REDEF
F$DCB.DCBNAME.L
      2174**DCL      2174--IMP-SIZ
F$DCB.DVFC
      2148**DCL      2287>>IF       2288<<ASSIGN
F$DCB.EOMCHAR
      2131**DCL      2131--REDEF    2286<<ASSIGN
F$DCB.FCD
      2140**DCL      2266>>IF
F$DCB.FLDID
      2155**DCL      2155--REDEF
F$DCB.FORM$
      2149**DCL      2149--REDEF
F$DCB.FSECT
      2165**DCL      2165--REDEF
F$DCB.FSN
      2142**DCL      2142--REDEF    2142--REDEF    2143--REDEF
F$DCB.HEADER$
      2148**DCL      2148--REDEF
F$DCB.IASN
      2168**DCL      2243<<ASSIGN
F$DCB.IFMT
      2167**DCL      2290<<ASSIGN
F$DCB.IXTNSIZE
      2146**DCL      2146--REDEF    2246>>IF       2247<<ASSIGN   2248>>IF       2249<<ASSIGN
F$DCB.LASTSTA$
      2136**DCL      2136--REDEF
F$DCB.LVL
      2161**DCL      2161--REDEF
F$DCB.NAME.C
      2136**DCL      2136--REDEF
F$DCB.NOEOF
      2157**DCL      2157--REDEF
F$DCB.NRECS
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:25   
      2147**DCL      2147--REDEF
F$DCB.NRECX
      2166**DCL      2166--REDEF
F$DCB.OHDR
      2158**DCL      2158--REDEF
F$DCB.ORG
      2141**DCL      2141--REDEF    2244<<ASSIGN   2267>>IF       2277>>IF       2289<<ASSIGN
F$DCB.PRECNO
      2164**DCL      2164--REDEF
F$DCB.RCSZ
      2169**DCL      2169--REDEF
F$DCB.RES
      2137**DCL      2137--REDEF
F$DCB.SETX
      2149**DCL      2149--REDEF
F$DCB.SHARE
      2140**DCL      2250>>IF       2251<<ASSIGN   2252>>IF
F$DCB.TAB$
      2148**DCL      2149--REDEF
F$DCB.TDA
      2163**DCL      2163--REDEF    2245<<ASSIGN
F$DCB.WSN
      2138**DCL      2138--REDEF
FM$CFU.ACCTX
      2178**DCL      2178--REDEF
FMD$FLSHBUF
      2201**DCL-ENT  2275--CALL
FMN$OPNF
      2202**DCL-ENT  2262--CALL
FMP$CLSERR
      2204**DCL-ENT  2279--CALL
I
      2189**DCL      2274<<DOINDEX  2275<>CALL
JDCB$
      2187**DCL      2127--IMP-PTR  2242<<ASSIGN   2243>>ASSIGN   2244>>ASSIGN   2245>>ASSIGN   2246>>IF
      2247>>ASSIGN   2248>>IF       2249>>ASSIGN   2250>>IF       2251>>ASSIGN   2252>>IF       2252>>IF
PL6.E3A0      #001=KCO$OPCG File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:26   
      2266>>IF       2267>>IF       2277>>IF       2286>>ASSIGN   2287>>IF       2288>>ASSIGN   2289>>ASSIGN
      2290>>ASSIGN   2291>>ASSIGN
PN$
      2120**DCL        24--PROC     2262<>CALL

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:27   
      179        1        /*T***********************************************************/
      180        2        /*T*                                                         */
      181        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      182        4        /*T*                                                         */
      183        5        /*T***********************************************************/
      184        6
      185        7
      186        8        /**/
      187        9        /**/
      188       10
      189       11
      190       12        /*F* NAME:         KCO$INIT
      191       13             PURPOSE:      Provide the special functions needed when opening
      192       14                           a DCB to a COMGROUP.
      193       15
      194       16        */
      195       17
      196       18
      197       19        KCO$INIT: PROC(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;
      198       20        /**/
      199       21
      200       22
      201       23        /**/
      202       24        /* INCLUDES */
      203       25        /**/
      204       26        %INCLUDE AZ_MACRO_C;
      205     2613        %INCLUDE AZ_SUBS_C;
      206     2682        %INCLUDE B_STRINGS_C;
      207     2811        %INCLUDE CP_6;
      208     8370        %INCLUDE CP_6_SUBS;
      209     8910        %INCLUDE EL_SUBS_C;
      210     8994        %MACRO F$DCB#(BASED=BASED);
      211     8995        %INCLUDE F$DCB;
      212     9044        %MEND;
      213     9045        %INCLUDE F$JIT_C;
      214     9475        %INCLUDE FM$MACROS;
      215     9850        %INCLUDE F_ERRORS_C;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:28   
      216    10090        %INCLUDE F_FMTCODE_C;
      217    10124        %INCLUDE F$CP6V_C;
      218    10350        %FPT$OPEN_V (BASED=BASED);
      219    10365        %INCLUDE HF_LOCK_C;
      220    10379        %INCLUDE KC$CGBLK;
      221    10427        %INCLUDE KC$CP6V_C;
      222    10547        %INCLUDE KC_DATA_R;
      223    10560        %INCLUDE KC_ERRORS_C;
      224    10607        %INCLUDE KC_SUBS_C;
      225    10623        %INCLUDE KQM_MAC_C;
      226    10996        %INCLUDE KQ_MAC_C;
      227    13546        %INCLUDE KQ_DATA_R;
      228    14378        %INCLUDE KQ_ERRORS_C;
      229    14426        %INCLUDE KQ_SUBS_C;
      230    14726        %INCLUDE K_DATA_R;
      231    15437        %INCLUDE M_INFO_C;
      232    15577        %INCLUDE NK$LDCT;
      233    15679        %INCLUDE NK_SUBS;
      234    15704        %INCLUDE SS_SCHED_C;
      235    15937        %INCLUDE JG_GHOSTS_C;
      236    16027
      237    16028
      238    16029        /**/
      239    16030        /* BASED STRUCTURES */
      240    16031        /**/
      241    16032        %KQ_BAP (FPTN=KQ$BAP,STCLASS="BASED(DGRAN$)");
      242    16121        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CTX$)");
      243    16860        %KQ_CTLGRAN (FPTN=KQ$CTLGRAN,STCLASS="BASED(CTL$)");
      244    16946        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED(DBLK$)");
      245    16999        %KQ_DGRAN (FPTN=KQ$DGRAN,STCLASS="BASED(DGRAN$)");
      246    17146        %KQ_DSB (FPTN=KQ$DSB,STCLASS=BASED);
      247    17189        %KQ_FP (FPTN=KQ$FP,STCLASS=BASED);
      248    17262        %KQ_GRAN (FPTN=KQ$GRAN,STCLASS="BASED(DGRAN$)");
      249    17317        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS=BASED);
      250    17587        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS=BASED);
      251    18060        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS=BASED);
      252    18246        %KQ_STA (FPTN=KQ$STA,STCLASS="BASED(STA$)");
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:29   
      253    18585        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
      254    18623        %KQ_MMSD (FPTN=KQ$MMSD,STCLASS="BASED(KQ_MMSD$)");
      255    18660        %F$DCB# (BASED="BASED(JDCB$)");
      256    18710        %FM$CFU (BASED="BASED(CFU$)");
      257    18716        %FM$CFUN (BASED="BASED(NAME$)");
      258    18719        %FM$CFUA (BASED="BASED(ACCT$)");
      259    18725        %FM$CFUX;
      260    18730        %FM$CFUF (BASED="BASED(CFU$)");
      261    18733        %FM$SET (BASED="BASED(F$CFU$)");
      262    18738        %NK$LDCT (STCLASS="BASED(LDCT$)");
      263    18784        %VLP_SETSTA (FPTN=VLP$SETSTA,STCLASS=BASED);
      264    18812        %VLP_STATION(FPTN=VLP$STATION,STCLASS=BASED);
      265    18839    1   DCL NAMEI CHAR(I) BASED;
      266    18840    1   DCL CHARINDX CHAR(INDX) BASED;
      267    18841    1   DCL CHAR8 CHAR(8) BASED;
      268    18842    1   DCL MOVEI CHAR(I) BASED;
      269    18843    1   DCL UBINHALF UBIN(18) BASED ALIGNED;
      270    18844    1   DCL PG(0:1023) UBIN BASED ALIGNED;
      271    18845    1   DCL PN$(0:0) PTR BASED;
      272    18846
      273    18847
      274    18848        /**/
      275    18849        /* PARAMETERS */
      276    18850        /**/
      277    18851    1   DCL PLDCT$ PTR;
      278    18852    1   DCL PLDCT REDEF PLDCT$ UBIN;
      279    18853        %KC$CGID (STCLASS=);
      280    18879        %B$CGAUCI (STCLASS=);
      281    18901    1   DCL ERROR UBIN;
      282    18902
      283    18903
      284    18904        /**/
      285    18905        /* AUTO */
      286    18906        /**/
      287    18907    1   DCL JDCB$ PTR;
      288    18908    1   DCL TIMCHK BIT(72) DALIGNED;
      289    18909    1   DCL CFU$ PTR;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:30   
      290    18910    1   DCL CTX$ PTR;
      291    18911    1   DCL 1 CTX REDEF CTX$,
      292    18912    1         2 DISP UBIN(24) UNAL,
      293    18913    1         2 SID UBIN(12) UNAL;
      294    18914    1   DCL STR6 CHAR(6);
      295    18915    1   DCL LDCT$ PTR;
      296    18916    1   DCL STA$ PTR;
      297    18917    1   DCL ENTFLG SBIN;
      298    18918    1   DCL I SBIN;
      299    18919    1   DCL KEY CHAR(8);
      300    18920    1   DCL NAME$ PTR;
      301    18921    1   DCL ACCT$ PTR;
      302    18922    1   DCL TRMFLG UBIN;
      303    18923    1   DCL WAFLG REDEF TRMFLG UBIN;
      304    18924    1   DCL INDX UBIN;
      305    18925    1   DCL INDXR$ REDEF INDX PTR;
      306    18926    1   DCL DBLK$ PTR;
      307    18927    1   DCL CTL$ PTR;
      308    18928    1   DCL OPNTYP UBIN;
      309    18929    1   DCL DGRAN$ PTR;
      310    18930    1   DCL 1 DGRAN REDEF DGRAN$,
      311    18931    1         2 DISP UBIN(18) UNAL,
      312    18932    1         2 * BIT(8),
      313    18933    1         2 DESC UBIN(10) UNAL;
      314    18934    1   DCL 1 CNNCT ALIGNED,
      315    18935    1         2 DDA UBIN,
      316    18936    1         2 MBLK$ PTR,
      317    18937    1         2 MBLK$R REDEF MBLK$ UBIN;
      318    18938    1   DCL TRYCNT UBIN;
      319    18939    1   DCL DESC# UBIN;
      320    18940    1   DCL PG# UBIN;
      321    18941        %B$CGAUCI (FPTN=B$CGAUCIDCB,STCLASS=);
      322    18963        %COMGRP (STCLASS=);
      323    19074    1   DCL SCRATCH$ PTR;
      324    19075
      325    19076
      326    19077        /**/
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:31   
      327    19078        /* EXTERNAL DATA */
      328    19079        /**/
      329    19080    1   DCL S_PNO UBIN WORD SYMREF;
      330    19081    1   DCL KQ_MMSD$ PTR SYMREF READONLY;
      331    19082    1   DCL B$M$UC$ PTR SYMREF READONLY;
      332    19083    1   DCL B$JIT$ PTR SYMREF;
      333    19084    1   DCL FM_FRZERO UBIN SYMREF;
      334    19085    1   DCL FM_WSQ UBIN SYMREF;
      335    19086    1   DCL F$CFU$ PTR SYMREF READONLY;
      336    19087    1   DCL FM$BUF$(0:0) PTR SYMREF;
      337    19088        %KQ_CG (FPTN=KQ_ICG,STCLASS=SYMREF);
      338    19827        %KQ_DGRAN (FPTN=KQ_IDGRAN,STCLASS=SYMREF);
      339    19974    1   DCL S_CUN UBIN SYMREF;
      340    19975        %VLP_SETSTA (FPTN=KC_VLPSETSTA,STCLASS=SYMREF);
      341    20003        %VLP_STATION (FPTN=KC_VLPSTATION,STCLASS=SYMREF);
      342    20030
      343    20031
      344    20032        /**/
      345    20033        /* EXTERNAL ROUTINES */
      346    20034        /**/
      347    20035    1   DCL SC_CGREOPEN   ENTRY CONV(2,0);
      348    20036    1   DCL ELA$SYSLOG    ENTRY(6) ALTRET;
      349    20037    1   DCL FAG$GEXT      ENTRY    ALTRET;
      350    20038    1   DCL FGH$UPDBUCKET ENTRY(4);
      351    20039    1   DCL FMD$FLSHBUF   ENTRY(1);
      352    20040    1   DCL FMD$GBUF      ENTRY(1);
      353    20041    1   DCL FMD$GETBUF    ENTRY(3);
      354    20042    1   DCL FMD$RBUF      ENTRY(1);
      355    20043    1   DCL FMD$REDBUF    ENTRY(6) ALTRET;
      356    20044    1   DCL FMD$REDBUFBC  ENTRY(6) ALTRET;
      357    20045    1   DCL FMD$RELBUF    ENTRY(1);
      358    20046    1   DCL FMD$WRTBUF    ENTRY(1);
      359    20047    1   DCL FMN$OPNF      ENTRY(1) ALTRET;
      360    20048    1   DCL FSA$GSP       ENTRY(2) ALTRET;
      361    20049    1   DCL HFF$DSIZ      ENTRY(2);
      362    20050    1   DCL KCA$TELLAUM   ENTRY(3) ALTRET;
      363    20051    1   DCL KCA$TELLAUR   ENTRY(3) ALTRET;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:32   
      364    20052    1   DCL KCC$RECOVER   ENTRY(1);
      365    20053    1   DCL KCI$VALSTA1   ENTRY(2) ALTRET;
      366    20054    1   DCL KCO$CLCGERR   ENTRY;
      367    20055    1   DCL KCO$RCNNCT    ENTRY(1);
      368    20056    1   DCL KCO$TRMGONE   ENTRY(1);
      369    20057    1   DCL KQB$INSERTNL  ENTRY(3) ALTRET;
      370    20058    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      371    20059    1   DCL KQC$ACTSTA    ENTRY(2) ALTRET;
      372    20060    1   DCL KQC$CXTSET    ENTRY(1) ALTRET;
      373    20061    1   DCL KQC$CXTSET1   ENTRY(1) ALTRET;
      374    20062    1   DCL KQM$RECON     ENTRY(3) ALTRET;
      375    20063    1   DCL KQC$TRMCK     ENTRY(1) ALTRET;
      376    20064    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
      377    20065    1   DCL KQD$GETR      ENTRY(3) ALTRET;
      378    20066    1   DCL KQD$RECOVER   ENTRY(1) ALTRET;
      379    20067    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      380    20068    1   DCL KQL$DELMLH    ENTRY(2) ALTRET;
      381    20069    1   DCL KQM$GETB      ENTRY(3) ALTRET;
      382    20070    1   DCL KQM$GETBK     ENTRY(3) ALTRET;
      383    20071    1   DCL KQM$GETMBLK   ENTRY(3) ALTRET;
      384    20072    1   DCL KQM$GETP      ENTRY(3) ALTRET;
      385    20073    1   DCL KQM$RELB      ENTRY(3) ALTRET;
      386    20074    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      387    20075    1   DCL KQM$INIT      ENTRY(2) ALTRET;
      388    20076    1   DCL KQM$SHUTDOWN  ENTRY(1) ALTRET;
      389    20077    1   DCL KQP$DISC      ENTRY(1) ALTRET;
      390    20078    1   DCL KQP$RECOVER   ENTRY(1) ALTRET;
      391    20079    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      392    20080    1   DCL KQQ$RECOVER   ENTRY(1) ALTRET;
      393    20081    1   DCL KQQ$RECOVER2  ENTRY(1) ALTRET;
      394    20082    1   DCL KQR$RECOVER   ENTRY(1) ALTRET;
      395    20083    1   DCL KQS$RECOVER   ENTRY(1) ALTRET;
      396    20084    1   DCL KQS$RECOVER2  ENTRY(1) ALTRET;
      397    20085    1   DCL KQT$DELSTA    ENTRY(2) ALTRET;
      398    20086    1   DCL KQT$GETSTA    ENTRY(3) ALTRET;
      399    20087    1   DCL KQT$MAKESTA   ENTRY(3) ALTRET;
      400    20088    1   DCL KQT$RECOVER   ENTRY(1) ALTRET;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:33   
      401    20089    1   DCL KQX$CHKTIME   ENTRY(1) ALTRET;
      402    20090    1   DCL KQX$LDASR     ENTRY(1);
      403    20091    1   DCL KQX$SETTIME   ENTRY(1);
      404    20092    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      405    20093    1   DCL MMJ$MAPIOP    ENTRY(2);
      406    20094    1   DCL MMJ$UNMAPIOP  ENTRY(1);
      407    20095    1   DCL NKL$GETDCT    ENTRY(1) ALTRET;
      408    20096    1   DCL NKL$RELDCT    ENTRY(1) ALTRET;
      409    20097    1   DCL SSR$REG       ENTRY(3) ALTRET;
      410    20098    1   DCL SSS$BLOCK     ENTRY;
      411    20099    1   DCL SSS$SYSTIME   ENTRY(1);
      412    20100    1   DCL UQB$MDEQ      ENTRY(1) ALTRET;
      413    20101
      414    20102
      415    20103        /**/
      416    20104        /* CONSTANT */
      417    20105        /**/
      418    20106        %B$CGAUCI (STCLASS=CONSTANT,FPTN=B_CGAUCI,INFOSZ=0);
      419    20128        %KQ_CTLGRAN (STCLASS=CONSTANT);
      420    20214        %KQ_THDR    (STCLASS=CONSTANT);
      421    20252    1   DCL ZEROS BIT(72) CONSTANT INIT('0'B);
      422    20253    1   DCL CHARZEROS REDEF ZEROS CHAR(8);
      423    20254        /**/
      424    20255        %SUB FCG#='1303'O;
      425    20256        %SUB MID#='17'O;
      426    20257        %ERRCODE (NAME=ERRDMY     ,COD#=0);
      427    20261        %ERRCODE (NAME=ERRTWOAU   ,COD#=%E$TWOAU);
      428    20265        %ERRCODE (NAME=ERRNOCGLDCT,COD#=%E$NOCGLDCT);
      429    20269        %ERRCODE (NAME=ERRDUPNM   ,COD#=%E$DUPNM);
      430    20273        %ERRCODE (NAME=ERRFILECG  ,COD#=%E$FILECG);
      431    20277        %ERRCODE (NAME=ERRCGCXT   ,COD#=%E$CGCXT);
      432    20281        %ERRCODE (NAME=ERRUNIMP   ,COD#=%E$UNIMP);
      433    20285        %ERRCODE (NAME=ERRSTABAD  ,COD#=%E$STABAD);
      434    20289        %ERRCODE (NAME=ERRSTAILLGL,COD#=%E$STAILLGL);
      435    20293        %ERRCODE (NAME=ERRNDCBCG  ,COD#=%E$NDCBCG);
      436    20297        %ERRCODE (NAME=ERRRCVRBAD ,COD#=%E$RCVRBAD);
      437    20301        %ERRCODE (NAME=ERRCGCTLBAD,COD#=%E$CGCTLBAD);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:34   
      438    20305        %ERRCODE (NAME=ERRCGGRANS ,COD#=%E$CGGRANS);
      439    20309        %ERRCODE (NAME=ERRCGNOCLS ,COD#=%E$CGNOCLS);
      440    20313        %ERRCODE (NAME=ERRCGCROP  ,COD#=%E$CGCROP);
      441    20317        %ERRCODE (NAME=ERRNCGAU   ,COD#=%E$NCGAU);
      442    20321        %ERRCODE (NAME=ERRPRIVSTA ,COD#=%E$PRIVSTA);
      443    20325        %ERRCODE (NAME=ERRCGSTAR  ,COD#=%E$CGSTAR);
      444    20329        %ERRCODE (NAME=ERROLDCG   ,COD#=%E$OLDCG);
      445    20333        %ERRCODE (NAME=ERRCGORAU  ,COD#=%E$CGORAU);
      446    20337        %ERRCODE (NAME=ERRNOSTA   ,COD#=%E$NOSTA);
      447    20341
      448    20342
      449    20343        /**/
      450    20344        /* EQUS */
      451    20345        /**/
      452    20346        %EQU_CG;
      453    20394        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:35   
      454    20395
      455    20396
      456    20397        /*D* NAME:         KCO$INIT
      457    20398
      458    20399             CALL:         CALL KCO$INIT ALTRET;
      459    20400
      460    20401             DESCRIPTION:  Called from FMN$OPNF at the end of the open
      461    20402                           process to perform the specific COMGROUP
      462    20403                           functions.
      463    20404
      464    20405                           It is assumed that an ENQ is in effect that
      465    20406                           prevents other users from opening or closing
      466    20407                           DCBs while code in this routine is being
      467    20408                           executed.  Note that there is no such lock
      468    20409                           for terminal connects.
      469    20410
      470    20411        */
      471    20412
      472    20413
      473    20414    1         CTX$=ADDR(NIL);
      474    20415    1         LDCT$=ADDR(NIL);
      475    20416    1         STA$=ADDR(NIL);
      476    20417    1         JDCB$=B$JIT.DCB$;
      477    20418    1         CFU$=F$DCB.CFU$;
      478    20419    1         F$DCB.LDCTX=0;
      479    20420    1         OPNTYP=0;
      480    20421    1         ENTFLG=0;
      481    20422    1         CALL FMD$FLSHBUF(2);
      482    20423        /**/
      483    20424    1         IF F$DCB.ORG~=%CG# THEN
      484    20425    2           DO;
      485    20426    2           B$JIT.ERR=ERRFILECG; /* Not comgroup file */
      486    20427    2           ALTRETURN;
      487    20428    2           END;
      488    20429        /*E*  ERROR:  KCO-E$FILECG-2
      489    20430              MESSAGE: File% %FN% is not a comgroup
      490    20431              MESSAGE1: You have attempted to open a non-comgroup file as
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:36   
      491    20432                        a comgroup
      492    20433        */
      493    20434        /**/
      494    20435    1         IF F$DCB.AU AND NOT F$DCB.FFLG.AU THEN
      495    20436    2           DO;
      496    20437    2           B$JIT.ERR=ERRNCGAU;
      497    20438    2           ALTRETURN;
      498    20439    2           END;
      499    20440        /*E*  ERROR: KCO-E$NCGAU-2
      500    20441              MESSAGE: You are not allowed to be the administrative user for comgroup %UF
      501    20442        */
      502    20443        /**/
      503    20444    1         B$CGAUCIDCB=B_CGAUCI;
      504    20445    1         B$CGAUCIDCB.WHO.ACCT=B$JIT.ACCN;
      505    20446    1         B$CGAUCIDCB.WHO.NAME=B$JIT.UNAME;
      506    20447    1         B$CGAUCIDCB.SYSID   =B$JIT.SYSID;
      507    20448    1         B$CGAUCIDCB.FLG.INPUT='1'B;
      508    20449    1         B$CGAUCIDCB.FLG.OUTPUT='1'B;
      509    20450    1         CNNCT='0'B;
      510    20451        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:37   
      511    20452
      512    20453    1         IF F$DCB.FUN = %CREATE# AND NOT F$DCB.FEXT THEN
      513    20454    2           DO;               /* Creating new file */
      514    20455                   /******************************************************
      515    20456                    *                                                    *
      516    20457                    *            CREATE   NEW    COMGROUP                *
      517    20458                    *                                                    *
      518    20459                    ******************************************************/
      519    20460
      520    20461    2           OPNTYP=%CREATE#;
      521    20462    2           IF FM$CFU.ACCTX=0 OR FM$CFU.STARX.F~=0 THEN
      522    20463    3             DO;
      523    20464    3             B$JIT.ERR=ERRCGSTAR;
      524    20465    3             ALTRETURN;
      525    20466    3             END;
      526    20467        /*E*    ERROR: KCO-E$CGSTAR-2
      527    20468                MESSAGE: COMGROUPs may not be star or scratch files
      528    20469        */
      529    20470    2           CALL KQM$INIT(KQ_ICG,SCRATCH$) ALTRET(ERR);
      530    20471    2           CTX$=SCRATCH$;
      531    20472    2           KQ$CG.STATS.NUMDCBS=1; /* Count this user */
      532    20473    2           KQ$CG.CFU$=CFU$;
      533    20474    2           KQ$CG.SETX=F$DCB.SETX;
      534    20475    2           KQ$CG.XTX$=PINCRW(F$CFU$,FM$CFU.XTX);
      535    20476    2           KQ$CG.GRAN.ORG=F$DCB.ORG;
      536    20477    2           KQ$CG.GRAN.STAMP.HASH=F$DCB.HASH;
      537    20478    2           FM$CFU.GDA=CTX.SID; /* Put CTX$ in CFU */
      538    20479    2           FM$CFU.LDA=CTX.DISP;
      539    20480    2           KQ$CG.NGAVAL=FM$CFU.UGRANS-1;
      540    20481    2           KQ$CG.UGRANS=1;
      541    20482    2           KQ$CG.HIGRANS=1;
      542    20483    2           KQ$CG.QISS=F$DCB.QISS;
      543    20484    2           CALL FMD$GETBUF(0,1,CTL$);
      544    20485    2           CTL$->PG='0'B;
      545    20486    2           KQ$CTLGRAN=KQ_CTLGRAN;
      546    20487    2           KQ$CTLGRAN.HDR.STAMP.HASH=F$DCB.HASH;
      547    20488    2           KQ$CTLGRAN.HDR.PTYP=%KQ_PTYP_CTL;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:38   
      548    20489    2           KQ$CTLGRAN.HDR.GTYP=%KQ_PTYP_CTL;
      549    20490    2           KQ$CTLGRAN.HDR.ORG=F$DCB.ORG;
      550    20491    2           KQ$CTLGRAN.HDR.AVAIL=1024-SIZEW(KQ$CTLGRAN);
      551    20492    2           DBLK$=PINCRW(CTL$,SIZEW(KQ$CTLGRAN));
      552    20493    2           DBLK$->KQ$CG=KQ$CG;
      553    20494    2           KQ$CTLGRAN.CTXX=POFFW(DBLK$,CTL$);
      554    20495    2           KQ$CTLGRAN.CTXSIZ=SIZEW(KQ$CG)+50;
      555    20496    2           KQ$CTLGRAN.HDR.AVAIL=KQ$CTLGRAN.HDR.AVAIL-KQ$CTLGRAN.CTXSIZ;
      556    20497    2           F$DCB.BFR.DA(0)=FM_FRZERO;
      557    20498    2           CALL FMD$WRTBUF(0);
      558    20499    2           SCRATCH$=CTX$;
      559    20500    2           CALL KQC$CXTSET (SCRATCH$);
      560    20501    2           CALL SSS$SYSTIME(KQ$CG.PGTIME);
      561    20502    2           KQ$CG.CLOCK='1'B;
      562    20503    2           IF KQ$CG.NGAVAL<KQ$CG.AUCTL.MAXPG THEN
      563    20504    3             DO;
      564    20505    3             B$JIT.ERR=ERRCGGRANS;
      565    20506    3             GOTO ERR;
      566    20507    3             END;
      567    20508        /*E*    ERROR: KCO-E$CGGRANS-2
      568    20509                MESSAGE: IXTNSIZE for comgroup% %UF% is not large enough
      569    20510                MESSAGE1: IXTNSIZE for a comgroup must be at least as large
      570    20511                          as MAXPG+1
      571    20512        */
      572    20513        /**/
      573    20514    2   ENDSETUP: ;
      574    20515                %LOCK (G=KQ$CG.DTREE.GATE);
      575    20518    3             DO WHILE(KQ$CG.CURDATAPGS<KQ$CG.MINDATAPGS);
      576    20519    3             CALL KQM$GETP(KQ$CG,DGRAN$,I) ALTRET(MEMERRUD);
      577    20520    3             KQ$DGRAN=KQ_IDGRAN;
      578    20521    3             KQ$GRAN=KQ$CG.GRAN;
      579    20522    3             KQ$DGRAN.HDR.PTYP=%KQ_PTYP_DATA;
      580    20523    3             KQ$DGRAN.HDR.GTYP=%KQ_PTYP_DATA;
      581    20524    3             KQ$DGRAN.HDR.SELF$=DGRAN$;
      582    20525    3             KQ$DGRAN.FLINK$=KQ$CG.DATAFREE$;
      583    20526    3             KQ$CG.DATAFREE$=DGRAN$;
      584    20527    3             KQ$CG.CURDATAPGS=KQ$CG.CURDATAPGS+1;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:39   
      585    20528    3             END;
      586    20529        /*N*
      587    20530                KQ$CG.AUCTL.DCBCONLGL = ADDR(PLDCT$)->PN$(0)->FPT$OPEN_V.DCBCONLGL ;
      588    20531                KQ$CG.AUCTL.TERMCONLGL = ADDR(PLDCT$)->PN$(0)->FPT$OPEN_V.TERMCONLGL ;
      589    20532         */
      590    20533                %UNLOCK (G=KQ$CG.DTREE.GATE);
      591    20536    2           CALL GETGORGO ALTRET(MEMERR);
      592    20537    2           IF OPNTYP =%CREATE# THEN
      593    20538    2            CALL KQC$CXTSET1 (KQ$CG.GORGOSTA$) ALTRET(ERR);
      594    20539    2           END;  /* Create new comgroup */
      595    20540        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:40   
      596    20541
      597    20542    1         ELSE
      598    20543    1          IF FM$CFU.GDA~=0 THEN   /* Hooking into already-open CG */
      599    20544    2            DO;
      600    20545                   /******************************************************
      601    20546                    *                                                    *
      602    20547                    *        JOIN AN ALREADY-OPEN COMGROUP               *
      603    20548                    *                                                    *
      604    20549                    ******************************************************/
      605    20550
      606    20551    2            CTX.SID=FM$CFU.GDA;
      607    20552    2            CTX.DISP=FM$CFU.LDA;
      608    20553    2            CALL KQX$LDASR(KQ$CG); /* Map onto comgroup */
      609    20554    2            CALL GLOCK;
      610    20555    2            KQ$CG.STATS.NUMDCBS=KQ$CG.STATS.NUMDCBS+1;
      611    20556    2            CALL GUNLOCK;
      612    20557    2            IF F$DCB.AU AND KQ$CG.AUSTA$~=ADDR(NIL) THEN
      613    20558    3              DO;
      614    20559    3              B$JIT.ERR=ERRTWOAU;
      615    20560    3              GOTO ERR;
      616    20561    3              END;
      617    20562        /*E*    ERROR: KCO-E$TWOAU-2
      618    20563                MESSAGE: This comgroup already has an administrative user
      619    20564                MESSAGE1: Each comgroup may have only one administrative
      620    20565                          user at a time, and this one already has one.
      621    20566        */
      622    20567    2            END; /* Join an already-open comgroup */
      623    20568        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:41   
      624    20569
      625    20570    1          ELSE   /* Opening old CG that has no users */
      626    20571    2            DO;
      627    20572                   /******************************************************
      628    20573                    *                                                    *
      629    20574                    *        RE-OPEN A CLOSED (INACTIVE) COMGROUP        *
      630    20575                    *                                                    *
      631    20576                    ******************************************************/
      632    20577
      633    20578    2            OPNTYP=%UPDATE#;
      634    20579    2            F$DCB.GTYP=FMGTFILE;
      635    20580    2            F$DCB.LVL=%KQ_PTYP_CTL;
      636    20581    2            CALL FMD$REDBUF(CTL$,0,FM_FRZERO) ALTRET(ERR);
      637    20582    2            IF KQ$CTLGRAN.CTXX=0 OR KQ$CTLGRAN.CTXSIZ=0 THEN
      638    20583    3              DO;
      639    20584    3              B$JIT.ERR=ERRCGCTLBAD;
      640    20585    3              GOTO ERR;
      641    20586    3              END;
      642    20587        /*E*    ERROR: KCO-E$CGCTLBAD-2
      643    20588                MESSAGE: Unable to open comgroup% %UF%, saved context information
      644    20589                         is bad
      645    20590        */
      646    20591    2            NAME$=PINCRW(CTL$,KQ$CTLGRAN.CTXX); /* Point to old ctx blk */
      647    20592    2            IF (KQ$CTLGRAN.VERSION < 'B01X') AND (NAME$->KQ$CG.HIGRANS = BITBIN('6014'O
             20592                     )) THEN
      648    20593    3              DO;
      649    20594    3              B$JIT.ERR=ERROLDCG;
      650    20595        /*E* ERROR:        KCO-E$OLDCG-2
      651    20596             MESSAGE:      Unable to open comgroup% %UF% - old version
      652    20597             MESSAGE1:     The comgroup you tried to open was created
      653    20598                           by a previous version of CP-6, and cannot
      654    20599                           be used. */
      655    20600    3              GOTO ERR;
      656    20601    3              END;
      657    20602    2            IF (KQ$CTLGRAN.VERSION < 'E03G') THEN /* CORRECTION */
      658    20603    3              DO;
      659    20604    3              NAME$->KQ$CG.HIGRANS=NAME$->KQ$CG.HIGRANS+1;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:42   
      660    20605    3              KQ$CTLGRAN.VERSION='E03G';
      661    20606    3              END;
      662    20607    2            IF KQ$CTLGRAN.RCVRTIME~=0 THEN
      663    20608    3              DO;
      664    20609    3              COMGRP='0'B;
      665    20610    3              COMGRP.CODE=%AZ$CG;
      666    20611    3              COMGRP.ACCT=F$DCB.ACCT;
      667    20612    3              COMGRP.NAM=F$DCB.NAME;
      668    20613    3              COMGRP.SN=FM$SET.PSN(F$DCB.SETX);
      669    20614    3              COMGRP.RCVR='1'B;
      670    20615    3              COMGRP.STATS=NAME$->KQ$CG.STATS;
      671    20616    3              INDX=KQ$CTLGRAN.RCVRTIME-NAME$->KQ$CG.PGTIME;
      672    20617    3              CALL FGH$UPDBUCKET(COMGRP.STATS.PGSI,NAME$->KQ$CG.STATS.PGSI,INDX,
      673    20618    3              NAME$->KQ$CG.MMD.CURPG);
      674    20619    3              CALL ELA$SYSLOG(EL_ACCTLG,COMGRP,SIZEW(COMGRP),0,2,INDX);
      675    20620    3              END;
      676    20621    2            NAME$->KQ$CG.STATS='0'B;
      677    20622    2            KQ$CTLGRAN.RCVRTIME=0;
      678    20623    2            CALL SSS$SYSTIME(NAME$->KQ$CG.PGTIME);
      679    20624    2            NAME$->KQ$CG.DTREE=KQ_THDR;
      680    20625    2            NAME$->KQ$CG.AU=0;
      681    20626    2            NAME$->KQ$CG.LASTUSER=0;
      682    20627    2            NAME$->KQ$CG.AUSTA$=ADDR(NIL);
      683    20628    2            NAME$->KQ$CG.EOFTIMEHD$=ADDR(NIL);
      684    20629    2            NAME$->KQ$CG.EOFTIME=0;
      685    20630    2            NAME$->KQ$CG.FWUSR#=0;
      686    20631    2            NAME$->KQ$CG.FWHD$=ADDR(NIL);
      687    20632    2            NAME$->KQ$CG.STATS.NUMTERMS=0;
      688    20633    2            NAME$->KQ$CG.OPEN='0'B;
      689    20634    2            NAME$->KQ$CG.CLOCK='0'B; /* Disable clock */
      690    20635    2            NAME$->KQ$CG.IOCNT=0;
      691    20636    2            NAME$->KQ$CG.GATE.CG='1'B;
      692    20637    2            NAME$->KQ$CG.GATE.MISC='1'B;
      693    20638    2            NAME$->KQ$CG.DTREE.GATE='1'B;
      694    20639    2            NAME$->KQ$CG.STREE.GATE='1'B;
      695    20640    2            NAME$->KQ$CG.TTREE.GATE='1'B;
      696    20641    2            NAME$->KQ$CG.MMD.CURPG=0;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:43   
      697    20642    2            NAME$->KQ$CG.MMD.CURBPG=0;
      698    20643    2            NAME$->KQ$CG.MMD.BAPLOCK=0;
      699    20644    2            NAME$->KQ$CG.MMD.GATE='1'B;
      700    20645    2            NAME$->KQ$CG.CURDATAPGS=0;
      701    20646    2            NAME$->KQ$CG.MMD.FREECNT = 0;
      702    20647    2            NAME$->KQ$CG.MMD.FREE$ = ADDR(NIL);
      703    20648    2            NAME$->KQ$CG.AVAIL.HD$=ADDR(NIL);
      704    20649    2            NAME$->KQ$CG.AVAIL.TL$=ADDR(NIL);
      705    20650    2            NAME$->KQ$CG.DCBHD$=ADDR(NIL);
      706    20651    2            NAME$->KQ$CG.DATAFREE$=ADDR(NIL);
      707    20652    2            NAME$->KQ$CG.ADDFREE=0;
      708    20653    2            NAME$->KQ$CG.GETFLG=0;
      709    20654    2            NAME$->KQ$CG.RCVR='1'B;
      710    20655    2            CALL KQM$INIT(NAME$->KQ$CG,SCRATCH$) ALTRET(ERR);
      711    20656    2            CTX$=SCRATCH$;
      712    20657    2            KQ$CG.STATS.NUMDCBS=1;
      713    20658    2            KQ$CG.CFU$=CFU$;
      714    20659    2            KQ$CG.SETX=F$DCB.SETX;
      715    20660    2            KQ$CG.XTX$=PINCRW(F$CFU$,FM$CFU.XTX);
      716    20661    2            KQ$CG.GRAN.STAMP.HASH=F$DCB.HASH;
      717    20662    2            FM$CFU.GDA=CTX.SID;
      718    20663    2            FM$CFU.LDA=CTX.DISP;
      719    20664    2            F$DCB.GTYP=FMGTFILE;
      720    20665    2            F$DCB.LVL=%KQ_PTYP_RCVR;
      721    20666    2            DESC#=0;
      722    20667    2            PG#=0;
      723    20668    2            IF KQ$CTLGRAN.RCVRDA~=0 AND KQ$CTLGRAN.RCVRSIZ~=0 THEN
      724    20669    3              DO;
      725    20670    4                DO WHILE('1'B);
      726    20671    4                IF KQ$CTLGRAN.PGTBL((DESC#*%CGQ_CHUNK_SIZE)+PG#+1) THEN
      727    20672    5                  DO;
      728    20673    5                  IF KQ$CTLGRAN.RCVRSIZ=0 THEN
      729    20674    5                   GOTO RCVR_BAD;
      730    20675    5                  DGRAN='000000004000'O;
      731    20676    5                  DGRAN.DISP=PG#*1024;
      732    20677    5                  DGRAN.DESC=DESC#;
      733    20678    5                  CALL KQM$RECON (KQ$CG,DGRAN$,INDX) ALTRET(MMERR);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:44   
      734    20679    5                  I=INDX;
      735    20680    5                  CALL MMJ$MAPIOP (INDX , I);
      736    20681    5                  F$DCB.BFR.BUFX (2) = INDX;
      737    20682    5                  NAME$ = FM$BUF$ (INDX);
      738    20683    5                  F$DCB.BFR.CVM(2)='1'B;
      739    20684    5                  NAME$->KQ$DGRAN=KQ$CG.GRAN; /* Make ORG~=0 */
      740    20685    5                  CALL FMD$REDBUFBC(NAME$,2,KQ$CTLGRAN.RCVRDA) ALTRET(ERR);
      741    20686    5                  IF DGRAN$~=NAME$->KQ$DGRAN.HDR.SELF$ THEN
      742    20687    6                    DO;
      743    20688    6   RCVR_BAD:
      744    20689    6                    B$JIT.ERR=ERRRCVRBAD;
      745    20690    6                    GOTO ERR;
      746    20691    6                    END;
      747    20692        /*E*  ERROR: KCO-E$RCVRBAD-2
      748    20693              MESSAGE: Cannot reopen comgroup - recovery area is bad
      749    20694        */
      750    20695    5                  CALL MMJ$UNMAPIOP (INDX);
      751    20696    5                  F$DCB.BFR(2)='0'B;
      752    20697    5                  F$DCB.BFR1(2)='0'B;
      753    20698    5                  KQ$CTLGRAN.RCVRSIZ=KQ$CTLGRAN.RCVRSIZ-1;
      754    20699    5                  KQ$CTLGRAN.RCVRDA=KQ$CTLGRAN.RCVRDA+1;
      755    20700    5                  IF KQ$DGRAN.HDR.PTYP=%KQ_PTYP_BAP THEN
      756    20701    6                    DO;
      757    20702    6                    KQ$BAP.CG$=CTX$;
      758    20703    6                    KQ$CG.MMD.CURBPG=KQ$CG.MMD.CURBPG+1;
      759    20704    6                    END;
      760    20705    5                  ELSE IF KQ$DGRAN.HDR.PTYP=%KQ_PTYP_DATA THEN
      761    20706    6                     DO;
      762    20707    6                     KQ$DGRAN.USECNT=0;
      763    20708    6                     KQ$DGRAN.ACTCNT=0;
      764    20709    6                     KQ$DGRAN.BYPASSCNT=0;
      765    20710    6                     KEY=KQ$DGRAN.BTN.KEY;
      766    20711    6                     DBLK$=ADDR(KQ$DGRAN.BTN);
      767    20712    6                     CALL KQB$INSERTNL(KQ$CG.DTREE,KEY,DBLK$) ALTRET(CGBAD);
      768    20713    6                     KQ$DGRAN.HDR.CHAIN='1'B;
      769    20714    6                     KQ$DGRAN.HDR.WRITE='0'B;
      770    20715    6                     KQ$DGRAN.HDR.ADDFREE='0'B;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:45   
      771    20716    6                     KQ$DGRAN.HDR.FORCEOUT='0'B;
      772    20717    6                     KQ$DGRAN.HDR.STAMP.GMOD=ADDR(KEY)->PG(0);
      773    20718    6                     KQ$DGRAN.FLINK$=ADDR(NIL);
      774    20719    6                     KQ$DGRAN.BLINK$=KQ$CG.AVAIL.TL$;
      775    20720    6                     CALL SSS$SYSTIME(KQ$DGRAN.TIME);
      776    20721    6                     IF KQ$CG.AVAIL.HD$=ADDR(NIL) THEN
      777    20722    6                      KQ$CG.AVAIL.HD$=DGRAN$;
      778    20723    6                     ELSE
      779    20724    6                      KQ$CG.AVAIL.TL$->KQ$DGRAN.FLINK$=DGRAN$;
      780    20725    6                     KQ$CG.AVAIL.TL$=DGRAN$;
      781    20726    6                     KQ$CG.CURDATAPGS=KQ$CG.CURDATAPGS+1;
      782    20727    6                     END;
      783    20728    5                   ELSE IF KQ$DGRAN.HDR.PTYP=%KQ_PTYP_SPARE THEN
      784    20729    6                      DO;
      785    20730    6                      DGRAN$->KQ$FP.LNK$ = KQ$CG.MMD.FREE$;
      786    20731    6                      KQ$CG.MMD.FREE$ = DGRAN$;
      787    20732    6                      KQ$CG.MMD.FREECNT = KQ$CG.MMD.FREECNT+1;
      788    20733    6                      END;
      789    20734    5                    ELSE CALL SC_CGREOPEN;
      790    20735        /*S* SCREECH_CODE: KCO-S$CGREOPEN
      791    20736             TYPE:         SNAP
      792    20737             MESSAGE:      Error in re-opening a COMGROUP
      793    20738             DESCRIPTION:  A COMGROUP being re-opened was found to contain
      794    20739                           a recovery page of PTYP not equal to one of the
      795    20740                           following: KQ_PTYP_BAP, KQ_PTYP_DATA, KQ_PTYP_SPARE.
      796    20741        */
      797    20742    5                  END;
      798    20743    4                PG#=PG#+1;
      799    20744    4                IF PG#>=%CGQ_CHUNK_SIZE THEN
      800    20745    5                  DO;
      801    20746    5                  PG#=0;
      802    20747    5                  DESC#=DESC#+1;
      803    20748    5                  IF DESC#>%KQM_MDPC# THEN
      804    20749    5                   IF KQ$CTLGRAN.RCVRSIZ=0 THEN
      805    20750    5                    GOTO RCVR_DONE;
      806    20751    5                   ELSE
      807    20752    5                    GOTO RCVR_BAD;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:46   
      808    20753    5                  END;
      809    20754    4                END;
      810    20755    3   RCVR_DONE:
      811    20756    3              KQ$CTLGRAN.RCVRDA=0;
      812    20757    3              KQ$CTLGRAN.RCVRSIZ=0;
      813    20758        /**/
      814    20759    3              CALL KQD$RECOVER (KQ$CG) ALTRET(CGBAD);
      815    20760    3              CALL KQT$RECOVER (KQ$CG) ALTRET(CGBAD);
      816    20761    3              STA$=KQ$CG.STREE.HEAD$;
      817    20762    4                DO WHILE (STA$ ~= ADDR(NIL));
      818    20763    4                KQ$STA.LDCT$=ADDR(NIL);
      819    20764    4                KQ$STA.SAVLDCT$=ADDR(NIL);
      820    20765    4                KQ$STA.LOCKCNT=0;
      821    20766    4                KQ$STA.CG$=CTX$;
      822    20767    4                KQ$STA.GATE='1'B;
      823    20768    4                KQ$STA.SUCCREAD='0'B;
      824    20769    4                KQ$STA.TERR='0'B;
      825    20770    4                KQ$STA.EVNT='0'B;
      826    20771    4                KQ$STA.EVCNT=0;
      827    20772    4                KQ$STA.PVGSENSE='0'B;
      828    20773    4                KQ$STA.DSCREQW='0'B;
      829    20774    4                KQ$STA.DSCREQS='0'B;
      830    20775    4                KQ$STA.OPNBLKED='0'B;
      831    20776    4                KQ$STA.JRNLW='0'B;
      832    20777    4                KQ$STA.DDISC=0;
      833    20778    4                KQ$STA.IDSC='0'B;
      834    20779    4                KQ$STA.SAVIDSC='0'B;
      835    20780    4                IF KQ$STA.RBLK$ ~= ADDR(NIL) THEN
      836    20781    4                 IF KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_PEND# THEN
      837    20782                                /* Make pending reads some harmless state
      838    20783                                   so that we don't try to satisfy them
      839    20784                                   during the cleanup KQR$RECOVER phase */
      840    20785    4                  KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_RSIP#;
      841    20786    4                STA$=KQ$STA.BTN.FLINK$;
      842    20787                        /* DO NOT zap RQLNK$ else messages may
      843    20788                         * be lost (if station is on a DELAY$ chain).
      844    20789                         */
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:47   
      845    20790    4                END;
      846    20791    3              CALL GETGORGO ALTRET(MEMERR);
      847    20792    3              CALL KCC$RECOVER(KQ$CG);
      848    20793    3              CALL KQQ$RECOVER(KQ$CG);
      849    20794    3              CALL KQS$RECOVER (KQ$CG) ALTRET(CGBAD);
      850    20795        /**/
      851    20796        /*       ***************************************************
      852    20797                 *                                                 *
      853    20798                 *                                                 *
      854    20799                 *            TURN ON THE CLOCK!!!!                *
      855    20800                 *                                                 *
      856    20801                 ***************************************************
      857    20802
      858    20803                 This is a critical juncture.  Before CLOCK gets set,
      859    20804                 we get no service from KCC$CLOCK and KCC$BASE.  After
      860    20805                 it is set, they will provide service.  This means
      861    20806                 two things:
      862    20807
      863    20808                  o   ALL code before this point must be such that
      864    20809                      it does not require the clock services in
      865    20810                      order to complete.  A good example of how
      866    20811                      to commit suicide by violating this rule
      867    20812                      is given in star #9107, where the call to
      868    20813                      KCO$RCNNCT for each station was in the
      869    20814                      first station loop with the clock turned
      870    20815                      off.  This is a potential deadly embrace
      871    20816                      since KCO$RCNNCT calls KQD$DELDDA and loops
      872    20817                      (SSR$REG %SS_SL for one second) until KQD
      873    20818                      can get a defer block to process the request.
      874    20819                      Well, that's suicide with CLOCK off because
      875    20820                      KCC$BASE is required in order to COMP defer
      876    20821                      blocks, so without it you can run out of
      877    20822                      defer blocks forever.
      878    20823
      879    20824                  o   Before turning the clock on, we must clean
      880    20825                      up the comgroup sufficiently to avoid screwing
      881    20826                      up by doing clock processing.  This means
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:48   
      882    20827                      at minimum a call to KCC$RECOVER to clean up
      883    20828                      this stuff
      884    20829
      885    20830
      886    20831                 There is another reason that setting CLOCK is critical.
      887    20832                 In general, we have the problem when doing comgroup
      888    20833                 reopen of ensuring that once we have done our first
      889    20834                 write from the data cache to disk we then close the
      890    20835                 file properly if there is a crash.  This has a couple
      891    20836                 of implications.  First, we can't do any disk I/O until
      892    20837                 we set a flag to tell recovery to close the CG properly.
      893    20838                 Second, after starting to do disk I/O but before finishing
      894    20839                 the recovery completely, we must act in such a way that
      895    20840                 we can redo the entire recovery after a crash which writes
      896    20841                 out the comgroup.  For various reasons, the flag that
      897    20842                 tells recovery to write the comgroup is CLOCK.  What
      898    20843                 we do, therefore, is write the control granule (thus
      899    20844                 marking the comgroup as 'open' - so that if we crash
      900    20845                 without going thru recovery we'll know upon reopen that
      901    20846                 the comgroup wasn't closed properly).  Then we turn
      902    20847                 on the CLOCK bit.  Thus all recovery phases preceeding
      903    20848                 this are required to not do any disk I/O; all phases
      904    20849                 after this must realize that a crash while they are
      905    20850                 running will write the comgroup as is.
      906    20851
      907    20852        */
      908    20853    3              CALL FMD$WRTBUF (0);  /* Write out the control granule */
      909    20854    3              KQ$CG.CLOCK='1'B; /* Enable clock */
      910    20855        /**/
      911    20856    3              CALL KQS$RECOVER2 (KQ$CG); /* Finish KQS recovery */
      912    20857        /**/
      913    20858    3              CALL KQX$SETTIME (TIMCHK);
      914    20859    3              STA$=KQ$CG.STREE.HEAD$;
      915    20860    4                DO WHILE(STA$~=ADDR(NIL));
      916    20861    4                CALL KCO$RCNNCT (KQ$STA);
      917    20862    4                CALL KQX$CHKTIME (TIMCHK) ALTRET(RCVR_SLOOP);
      918    20863    4                CALL SSR$REG (%SS_QE);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:49   
      919    20864    4                CALL KQX$SETTIME (TIMCHK);
      920    20865    4   RCVR_SLOOP:  ;
      921    20866    4                IF NOT KQ$STA.TERM THEN
      922    20867    4                 CALL KQR$RECOVER(KQ$STA);
      923    20868    4                ELSE
      924    20869    4                 CALL KQP$RECOVER(KQ$STA);
      925    20870    4                ACCT$=KQ$STA.BTN.FLINK$;
      926    20871    4                IF SUBSTR (KQ$STA.BTN.KEY,0,1) ~= '*' THEN
      927    20872    5                  DO;
      928    20873    5                  IF STA$ ~= KQ$CG.JRNLSTA$ THEN
      929    20874    5                   IF NOT KQ$CG.AUCTL.SMD THEN
      930    20875    5                    CALL KQL$DELMLH (KQ$CG,ADDR(KQ$STA.MLH));
      931    20876    5                  SCRATCH$=STA$;
      932    20877    5                  CALL KQT$DELSTA (KQ$CG,SCRATCH$);
      933    20878    5                  END;
      934    20879    4                STA$=ACCT$;
      935    20880    4                END;
      936    20881        /**/
      937    20882    3              CALL KQQ$RECOVER2(KQ$CG);
      938    20883        /**/
      939    20884    3              KQ$CG.RCVR='0'B;
      940    20885        /**/
      941    20886    3              GOTO ENDSETUP; /* Finish setting up */
      942    20887        /**/
      943    20888    3              END;
      944    20889        /**/
      945    20890    2            ELSE
      946    20891    3              DO;
      947    20892    3              CALL FMD$WRTBUF(0); /* Get rid of CTLGRAN */
      948    20893    3              B$JIT.ERR=ERRCGNOCLS;
      949    20894    3              GOTO ERR;
      950    20895    3              END;
      951    20896        /*E*    ERROR: KCO-E$CGNOCLS-2
      952    20897                MESSAGE: Comgroup% %UF% was never closed properly
      953    20898                MESSAGE1: It is not possible to open a comgroup that was
      954    20899                          never properly closed.  The only way this should
      955    20900                          ever occur is if the system crashes and recovery fails.
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:50   
      956    20901        */
      957    20902    2            END; /* Re-open a closed comgroup */
      958    20903        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:51   
      959    20904                   /******************************************************
      960    20905                    *                                                    *
      961    20906                    *          RESUME COMMON CODE FOR ALL OPENS          *
      962    20907                    *                                                    *
      963    20908                    ******************************************************/
      964    20909
      965    20910    1         IF NOT KQ$CG.AUCTL.DCBCONLGL AND NOT F$DCB.AU AND OPNTYP~=%CREATE# THEN
      966    20911    2           DO;
      967    20912    2           B$JIT.ERR=ERRNDCBCG;
      968    20913    2           GOTO ERR;
      969    20914    2           END;
      970    20915        /*E*     ERROR: KCO-E$NDCBCG-2
      971    20916                 MESSAGE: DCBs are not allowed to connect to this comgroup
      972    20917        */
      973    20918        /**/
      974    20919    1         IF JDCB$=B$M$UC$ THEN
      975    20920    2           DO;
      976    20921    2           IF B$JIT.MODE=%M_TP# THEN
      977    20922    3             DO;
      978    20923    3             F$DCB.MEDIA=FMTCG#;
      979    20924    3             F$DCB.DDEV.IC='0'B;
      980    20925    3             END;
      981    20926    3           ELSE DO;
      982    20927    3             F$DCB.MEDIA=FMTOCCG#;
      983    20928    3             F$DCB.DDEV.IC='1'B;
      984    20929    3             END;
      985    20930    2           F$DCB.DDEV.UCOUT='1'B;
      986    20931    2           F$DCB.WIDTH=F$DCB.RECL;
      987    20932    2           F$DCB.RECL=0;
      988    20933    2           F$DCB.UCOUT='1'B;
      989    20934    2           F$DCB.LSTAOR='1'B;
      990    20935    2           END;
      991    20936    1         ELSE
      992    20937    2           DO;
      993    20938    2           IF F$DCB.ASN~=%DEVICE# THEN
      994    20939    3             DO;  /* Not TP - TP checks are in FSN$OPNDEV */
      995    20940    3             IF F$DCB.LASTSTA$=ADDR(NIL) THEN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:52   
      996    20941    4               DO;
      997    20942    4               CALL FSA$GSP(SIZEW(VLP$STATION)+SIZEW(VLP$SETSTA),
      998    20943    4               F$DCB.LASTSTA$) ALTRET(ERR);
      999    20944    4               F$DCB.SETSTA$=PINCRW(F$DCB.LASTSTA$,SIZEW(VLP$STATION));
     1000    20945    4               F$DCB.SETSTA$->VLP$SETSTA=KC_VLPSETSTA;
     1001    20946    4               F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#=' ';
     1002    20947    4               END;
     1003    20948        /**/
     1004    20949    3             CALL KCI$VALSTA1 (F$DCB.SETSTA$->VLP$SETSTA.ISTA,KQ$CG.SETSTA.ISTA) ALTRET
             20949                      (ERR);
     1005    20950    3             CALL KCI$VALSTA1 (F$DCB.SETSTA$->VLP$SETSTA.OSTA,KQ$CG.SETSTA.OSTA) ALTRET
             20950                      (ERR);
     1006    20951        /**/
     1007    20952    3             CALL VALIDATE(F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#) ALTRET(BADSTA);
     1008    20953    3             IF SUBSTR(F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#,0,1)='&' THEN
     1009    20954    3              GOTO BADSTA;
     1010    20955    3             END;
     1011    20956        /**/
     1012    20957    2           F$DCB.MEDIA=FMTCG#;
     1013    20958    2           F$DCB.IWL='77'O;
     1014    20959    2           END;
     1015    20960        /**/
     1016    20961    1         F$DCB.LASTSTA$->VLP$STATION=KC_VLPSTATION;
     1017    20962        /**/
     1018    20963    1         IF F$DCB.ASN~=%DEVICE# THEN
     1019    20964    2           DO;
     1020    20965    2           CALL NKL$GETDCT(SCRATCH$) ALTRET(NOLDCT);
     1021    20966    2           LDCT$=SCRATCH$;
     1022    20967    2           IF F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#=' ' THEN
     1023    20968    3             DO;
     1024    20969    3             CALL BINCHAR(STR6,NK$LDCT.LDCTX);
     1025    20970    3             CALL INSERT(F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#,0,2,'&&');
     1026    20971    3             CALL INSERT(F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#,2,6,STR6);
     1027    20972    3             END;
     1028    20973    2           NK$LDCT.DFLG.LOCAL = '1'B;
     1029    20974    2           NK$LDCT.RESCOD=NK_CGDCB;
     1030    20975    2           NK$LDCT.DEVNM=F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:53   
     1031    20976    2           NK$LDCT.CG$=CTX$;
     1032    20977    2           NK$LDCT.DCBNO=B$JIT.DCBNO;
     1033    20978    2           NK$LDCT.USER=B$JIT.USER;
     1034    20979    2           NK$LDCT.DFLG.INPUT='1'B;
     1035    20980    2           IF F$DCB.FUN~=%IN# THEN
     1036    20981    2            NK$LDCT.DFLG.OUTPUT='1'B;
     1037    20982    2           END;
     1038    20983    1         KEY=F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#;
     1039    20984    1         IF KQ_LOG.DSIO THEN
     1040    20985    1          CALL KQZ$LOG (KQ$CG,%KQLOG_DORQ,S_CUN,0,JDCB$,SUBSTR(KEY,0,4),SUBSTR(KEY,4,4)
             20985                   );
     1041    20986        /**/
     1042    20987    1         IF NOT F$DCB.AU AND F$DCB.ASN~=%DEVICE# THEN
     1043    20988    1          CALL CNNCTINFO ALTRET(MEMERR);
     1044    20989        /**/
     1045    20990    1         CALL SLOCK;
     1046    20991    1         IF  S_CUN = JG_JAYS#
     1047    20992    1         AND KEY = 'JRNLSTA' THEN
     1048    20993    1          IF KQ$CG.JRNLSTA$ = ADDR(NIL) THEN GOTO STANOTALLWD;
     1049    20994    1          ELSE IF KQ$CG.JRNLSTA$->KQ$STA.BTN.KEY ~= 'JRNLSTA' THEN
     1050    20995    1            GOTO STANOTALLWD;
     1051    20996    1         CALL KQB$SRCH(KQ$CG.STREE,KEY,SCRATCH$) ALTRET(GETSTA);
     1052    20997    1         STA$=SCRATCH$;
     1053    20998    1         GOTO STAFND;
     1054    20999    1   GETSTA: ;
     1055    21000    1         IF NOT KQ$CG.AUCTL.XSTALGL THEN
     1056    21001    1          GOTO STANOTALLWD;
     1057    21002    1         STA$=KQ$CG.GORGOSTA$;
     1058    21003    1         CALL STALOCK;
     1059    21004    1         STA$->KQ$STA.USR#=S_CUN;
     1060    21005    1         CALL STAUNLOCK;
     1061    21006    1         SCRATCH$=STA$;
     1062    21007    1         CALL KQT$GETSTA (KQ$CG,SCRATCH$,KEY) ALTRET(MEMERR);
     1063    21008    1         STA$=SCRATCH$;
     1064    21009        /**/
     1065    21010    1   STAFND:;
     1066    21011    1         CALL STALOCK;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:54   
     1067    21012    1         IF KQ$STA.LDCT$~=ADDR(NIL) OR KQ$STA.IDSC THEN
     1068    21013    1          IF F$DCB.ASN~=%DEVICE# THEN
     1069    21014    1           GOTO DUPNM;
     1070    21015    1          ELSE
     1071    21016    2            DO;  /* Non-streamed comgroup */
     1072    21017    2            KQ$STA.DCBCNT=KQ$STA.DCBCNT+1;
     1073    21018    2            CALL STAUNLOCK;
     1074    21019    2            CALL SUNLOCK;
     1075    21020    2            F$DCB.LDCTX=KQ$STA.LDCT$->NK$LDCT.LDCTX;
     1076    21021    2            RETURN;
     1077    21022    2            END;
     1078    21023    1         IF NOT KQ$CG.AUCTL.XSTALGL AND NOT KQ$STA.PERM THEN
     1079    21024    2           DO;
     1080    21025    2           CALL STAUNLOCK;
     1081    21026    2           GOTO STANOTALLWD;
     1082    21027    2           END;
     1083    21028    1         IF KQ$STA.AUP THEN  /* This station may only be opened by the AU */
     1084    21029    1          IF KQ$CG.AU ~= S_CUN AND NOT F$DCB.AU THEN
     1085    21030    1           GOTO PRIVSTA;
     1086    21031        /**/
     1087    21032        /**/
     1088    21033        /**/
     1089    21034                     /*    Now connect the DCB to the
     1090    21035                      *    comgroup.
     1091    21036                      */
     1092    21037    1         KQ$STA.LDCT$=LDCT$;
     1093    21038    1         KQ$STA.TERM='0'B;
     1094    21039    1         KQ$STA.USR#=S_CUN;
     1095    21040    1         CALL STAINIT;
     1096    21041    1         KQ$STA.DCBCNT=1;
     1097    21042    1         NK$LDCT.STA$=STA$;
     1098    21043    1         IF NOT F$DCB.AU THEN
     1099    21044    2           DO;
     1100    21045    2           KQ$STA.CNNCTDDA=CNNCT.DDA;
     1101    21046    2           CNNCT.DDA=0;
     1102    21047    2           KQ$STA.CNNCTSIZE=SIZEC(B$CGAUCIDCB);
     1103    21048    2           END;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:55   
     1104    21049    1         KQ$STA.DCBLNK$=KQ$CG.DCBHD$;
     1105    21050    1         KQ$CG.DCBHD$=STA$;
     1106    21051    1         KQ$STA.AU=F$DCB.AU;
     1107    21052    1         CALL STAUNLOCK;
     1108    21053    1         CALL SUNLOCK;
     1109    21054    1         F$DCB.LDCTX=NK$LDCT.LDCTX;
     1110    21055    1         IF KQ_LOG.DSIO THEN
     1111    21056    2           DO;
     1112    21057    2           INDXR$=STA$;
     1113    21058    2           CALL KQZ$LOG (KQ$CG,%KQLOG_DODN,S_CUN,
     1114    21059    2           INDXR$,
     1115    21060    2           ADDR(INDXR$)->UBINHALF,
     1116    21061    2           SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
     1117    21062    2           SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
     1118    21063    2           END;
     1119    21064        /**/
     1120    21065        /**/
     1121    21066        /**/
     1122    21067                     /*    WARNING!! WARNING!! WARNING!! WARNING!!
     1123    21068                      *
     1124    21069                      *    After this point the DCB is in
     1125    21070                      *    fact connected to the comgroup.
     1126    21071                      *    'Connected' means his DCB, the
     1127    21072                      *    KQ$STA, and the LDCT all point
     1128    21073                      *    to each other.  After this, if
     1129    21074                      *    anything goes wrong (i.e. if we
     1130    21075                      *    want to give him an error), we
     1131    21076                      *    MUST exit via ERRCONNECTED, NOT!! ERR.
     1132    21077                      */
     1133    21078    1         IF FM$CFU.SHARE~=%NONE# THEN
     1134    21079    2           DO; /* File is shareable - let terminals on */
     1135    21080    2           CALL GLOCK;
     1136    21081    2           KQ$CG.OPEN='1'B;
     1137    21082    2           CALL GUNLOCK;
     1138    21083    2           END;
     1139    21084        /**/
     1140    21085    1         IF  NOT KQ$STA.AU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:56   
     1141    21086    1         AND S_CUN ~= KQ$CG.AU
     1142    21087    1         AND KQ$CG.AUSTA$ ~= ADDR(NIL)
     1143    21088    1         AND NOT KQ$CG.AUCTL.DCBCONAU
     1144    21089    1         AND KQ$CG.AUCTL.DCBCONWA THEN
     1145    21090    2           DO;
     1146    21091    2           IF S_CUN = JG_JAYS# AND STA$ = KQ$CG.JRNLSTA$ THEN
     1147    21092    3             DO;
     1148    21093    3             WAFLG=0;
     1149    21094    3             CALL KQC$ACTSTA (KQ$STA);
     1150    21095    3             END;
     1151    21096    2           ELSE
     1152    21097    3             DO;
     1153    21098    3             WAFLG=1;
     1154    21099    3             CALL STALOCK;
     1155    21100    3             KQ$STA.OPNBLKED='1'B;
     1156    21101    3             KQ$STA.OPNREJ='0'B;
     1157    21102    3             CALL STAUNLOCK;
     1158    21103    3             END;
     1159    21104    2           END;
     1160    21105    1         ELSE
     1161    21106    2           DO;
     1162    21107    2           WAFLG=0;
     1163    21108    2           IF (KQ$CG.AUSTA$=ADDR(NIL) AND KQ$CG.AUCTL.DCBCONNAU)
     1164    21109    2           OR (KQ$CG.AUSTA$~=ADDR(NIL) AND KQ$CG.AUCTL.DCBCONAU)
     1165    21110    2           OR (S_CUN=JG_JAYS# AND STA$=KQ$CG.JRNLSTA$)
     1166    21111    2           OR KQ$STA.AU THEN
     1167    21112    2            CALL KQC$ACTSTA (KQ$STA);
     1168    21113    2           END;
     1169    21114        /**/
     1170    21115    1         IF KQ$STA.AU THEN
     1171    21116    2           DO;
     1172    21117    2           CALL STALOCK;
     1173    21118    2           KQ$STA.TOLDAU='1'B; /* Don't tell AU about himself */
     1174    21119    2           CALL STAUNLOCK;
     1175    21120    2           CALL GLOCK;
     1176    21121    2           KQ$CG.AUSTA$=STA$;
     1177    21122    2           KQ$CG.AU=S_CUN;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:57   
     1178    21123    2           CALL GUNLOCK;
     1179    21124    2           CALL FMD$GBUF(DGRAN$); /* Get buffer to read in connect info */
     1180    21125    2           CALL KCA$TELLAUR(KQ$STA,%CG_AUCON#,DGRAN$);
     1181    21126    2           CALL FMD$RBUF(DGRAN$);
     1182    21127    2           END;
     1183    21128    1         ELSE
     1184    21129    2           DO;
     1185    21130    2           KQ$STA.MBLK$=CNNCT.MBLK$;
     1186    21131    2           CNNCT='0'B;
     1187    21132    2           CALL KCA$TELLAUM(KQ$STA,%CG_DOPN#,ADDR(B$CGAUCIDCB));
     1188    21133    2           END;
     1189    21134        /**/
     1190    21135    1         IF OPNTYP~=0 AND KQ$CG.AUCTL.TERMCONLGL THEN
     1191    21136    2           DO;
     1192    21137    2           SCRATCH$=CTX$;
     1193    21138    2           CALL KQC$TRMCK (SCRATCH$);
     1194    21139    2           END;
     1195    21140        /**/
     1196    21141    1         IF WAFLG ~= 0 THEN
     1197    21142    2           DO;
     1198    21143    2           IF F$DCB.ENQF THEN
     1199    21144    3             DO;
     1200    21145    3             CALL UQB$MDEQ (KQ$CG.CFU$);
     1201    21146    3             F$DCB.ENQF='0'B;
     1202    21147    3             END;
     1203    21148    2           CALL SSR$REG (%SS_QA);
     1204    21149    2           IF KQ$STA.OPNREJ THEN GOTO OPNREJ;
     1205    21150    2           END;
     1206    21151        /**/
     1207    21152    1         RETURN;
     1208    21153        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:58   
     1209    21154
     1210    21155                   /******************************************************
     1211    21156                    *                                                    *
     1212    21157                    *                     ERRORS                         *
     1213    21158                    *                                                    *
     1214    21159                    ******************************************************/
     1215    21160
     1216    21161        /**/
     1217    21162    1   OPNREJ:;
     1218    21163    1         B$JIT.ERR=ERRCGORAU;
     1219    21164        /*E* ERROR:        KCO-E$CGORAU-E
     1220    21165             MESSAGE:      Your M$OPEN was rejected by the comgroup administrator
     1221    21166             DESCRIPTION:  The comgroup has DWBCONWA = YES and the AU
     1222    21167                           M$DEACTIVATEd this user after getting the DCB OPEN
     1223    21168                           event. */
     1224    21169    1         GOTO ERRCONNECTED;
     1225    21170        /**/
     1226    21171    1   NOLDCT:;
     1227    21172    1         B$JIT.ERR=ERRNOCGLDCT;  /* NO LDCT */
     1228    21173    1         GOTO ERR;
     1229    21174        /*E*    ERROR: KCO-E$NOCGLDCT-2
     1230    21175                MESSAGE: Insufficient system LDCT space to connect you
     1231    21176                DESCRIPTION: Unable to get an LDCT for this DCB
     1232    21177        */
     1233    21178        /**/
     1234    21179    1   DUPNM:;
     1235    21180    1         CALL STAUNLOCK;
     1236    21181    1         CALL SUNLOCK;
     1237    21182    1         B$JIT.ERR=ERRDUPNM;  /* ILLEGAL STATION NAME */
     1238    21183    1         GOTO ERR;
     1239    21184        /*E*    ERROR: KCO-E$DUPNM-2
     1240    21185                MESSAGE: That station name is already in use
     1241    21186                MESSAGE1: The station name specified on an open to a
     1242    21187                          comgroup must be unique on that comgroup.
     1243    21188                          The name specified on your open is currently
     1244    21189                          in use by another user or terminal.
     1245    21190        */
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:59   
     1246    21191    1   MEMERRUD:;
     1247    21192              %UNLOCK (G=KQ$CG.DTREE.GATE);
     1248    21195        /**/
     1249    21196    1   MEMERR: ;
     1250    21197    1         B$JIT.ERR=ERRCGCXT;
     1251    21198    1         GOTO ERR;
     1252    21199        /*E*    ERROR: KCO-E$CGCXT-2
     1253    21200                MESSAGE: Insufficient space in comgroup to connect you
     1254    21201                MESSAGE1: There is not enough space available in the comgroup
     1255    21202                         for the context necessary to connect you
     1256    21203        */
     1257    21204        /**/
     1258    21205    1   STANOTALLWD:;
     1259    21206    1         CALL SUNLOCK;
     1260    21207    1         B$JIT.ERR=ERRSTAILLGL;
     1261    21208    1         GOTO ERR;
     1262    21209        /*E*    ERROR: KCO-E$STAILLGL-2
     1263    21210                MESSAGE: The station name you specified is not allowed on this comgroup
     1264    21211                MESSAGE1: The comgroup you are attempting to connect to has
     1265    21212                          a restricted list of legal stations, and the
     1266    21213                          station name you used is not in that list
     1267    21214        */
     1268    21215        /**/
     1269    21216        /**/
     1270    21217    1   PRIVSTA: ;
     1271    21218    1         CALL STAUNLOCK;
     1272    21219    1         CALL SUNLOCK;
     1273    21220    1         B$JIT.ERR=ERRPRIVSTA;
     1274    21221    1         GOTO ERR;
     1275    21222        /*E*    ERROR: KCO-E$PRIVSTA-2
     1276    21223                MESSAGE: The station name you used is restricted.
     1277    21224                MESSAGE1: Only the AU may use the station name that you specified.
     1278    21225        */
     1279    21226        /**/
     1280    21227    1   BADSTA:;
     1281    21228    1         B$JIT.ERR=ERRSTABAD;
     1282    21229    1         GOTO ERR;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:60   
     1283    21230        /*E*    ERROR: KCO-E$STABAD-2
     1284    21231                MESSAGE: Illegal character(s) in station name
     1285    21232                MESSAGE1: Your VLP_SETSTA.MYSTATION# has an illegal
     1286    21233                          first character, or begins with the character '&'.
     1287    21234        */
     1288    21235    1   CGBAD:;
     1289    21236    1         CALL FMD$RELBUF(0);  /* Get rid of context info */
     1290    21237    1         B$JIT.ERR=ERRCGCROP;
     1291    21238    1         GOTO ERR;
     1292    21239        /*E*    ERROR: KCO-E$CGCROP-2
     1293    21240                MESSAGE: Unable to reopen your comgroup
     1294    21241                MESSAGE1: Your comgroup was previously closed, but
     1295    21242                          is so badly broken that it cannot be reopened.
     1296    21243        */
     1297    21244        /**/
     1298    21245                     /*    Come here for errors which occur
     1299    21246                      *    BEFORE we 'connect' the DCB to
     1300    21247                      *    the comgroup.  The LDCT we obtained
     1301    21248                      *    (if any) is released.  The connect
     1302    21249                      *    info space we obtained is released.
     1303    21250                      *    The DCB is set to indicate there's
     1304    21251                      *    no LDCT.  Then we release FM buffers,
     1305    21252                      *    and call KCO$CLCGERR.  The purpose
     1306    21253                      *    of this last call is to shut down
     1307    21254                      *    the comgroup if it needs to be shut
     1308    21255                      *    down, and decrement NUMDCBS in the
     1309    21256                      *    context block, which was set/incremented
     1310    21257                      *    way back at the top of KCO$INIT.
     1311    21258                      */
     1312    21259    1   ERR:  ;
     1313    21260    1         IF CNNCT ~= '0'B THEN CALL RELCNNCT;
     1314    21261    1         IF LDCT$~=ADDR(NIL) THEN
     1315    21262    2           DO;
     1316    21263    2           SCRATCH$=LDCT$;
     1317    21264    2           CALL NKL$RELDCT (SCRATCH$);
     1318    21265    2           END;
     1319    21266    1         F$DCB.LDCTX=0;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:61   
     1320    21267                     /*    Come here for errors which occur
     1321    21268                      *    AFTER we 'connect' the DCB to
     1322    21269                      *    the comgroup.  We just release
     1323    21270                      *    some FM buffers, and call KCO$CLCGERR
     1324    21271                      *    to disconnect the DCB from the
     1325    21272                      *    comgroup.
     1326    21273                      */
     1327    21274    1   ERRCONNECTED:;
     1328    21275    1         CALL FMD$RELBUF(0);
     1329    21276    1         CALL FMD$RELBUF(2);
     1330    21277    1         IF CTX$~=ADDR(NIL) THEN
     1331    21278    1          CALL KCO$CLCGERR;
     1332    21279    1         ALTRETURN;
     1333    21280        /**/
     1334    21281    1   MMERR: ;
     1335    21282    1         B$JIT.ERR=ERRDMY;
     1336    21283    1         B$JIT.ERR.CODE=INDX;
     1337    21284    1         GOTO ERR;
     1338    21285        /**/
     1339    21286        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:62   
     1340    21287        /**/
     1341    21288        /*F* NAME:         KCO$TRMCON
     1342    21289
     1343    21290             PURPOSE:      Connect a terminal to a comgroup
     1344    21291
     1345    21292        */
     1346    21293        /**/
     1347    21294        /*D* NAME:         KCO$TRMCON
     1348    21295             CALL:         CALL KCO$TRMCON(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET(LOC);
     1349    21296             ENVIRONMENT:  Must be called on behalf of a user.
     1350    21297             INPUT:        PLDCT$    - The initialized LDCT for the terminal
     1351    21298                           KC$CGID   - Block identifying the comgroup.
     1352    21299                           B$CGAUCI  - Connect info for the AU
     1353    21300             OUTPUT:       ERROR     - Error code
     1354    21301             DESCRIPTION:  The chain of active comgroups is searched to
     1355    21302                           find the one matching KC$CGID.  If it is not
     1356    21303                           being shut down, then it is searched to find
     1357    21304                           the name in DEVNM of the passed LDCT.  If such
     1358    21305                           a station is found, then it must be neither
     1359    21306                           connected nor illegal for terminals; if it
     1360    21307                           passes these tests all is OK.  If no such
     1361    21308                           station is found then a new one is created
     1362    21309                           unless the comgroup forbids creation of new
     1363    21310                           stations.  In either case, once we have a
     1364    21311                           station block, the KQ$STA and LDCT are pointed
     1365    21312                           at one another and we return.  Note that
     1366    21313                           the RESCOD in the LDCT is not changed; the
     1367    21314                           caller is expected to do this himself.
     1368    21315
     1369    21316                           Errors are returned in ERROR, not B$JIT.ERR.
     1370    21317                           The errors are:
     1371    21318
     1372    21319                           E$NOCG        - The CG doesn't exist.
     1373    21320                           E$DUPNM       - Station name already in CG
     1374    21321                           E$STAILLGL    - Illegal station name
     1375    21322                           E$CGCXT       - No room in CG to do connection
     1376    21323                           E$NTRMSTA     - That name can't be used by terms.
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:63   
     1377    21324                           E$STABAD      - Illegal character(s) in station name
     1378    21325        */
     1379    21326    1   KCO$TRMCONGOTCG: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;
     1380    21327
     1381    21328    1         ENTFLG=3;
     1382    21329    1         GOTO TRM20;
     1383    21330    1   KCO$TRMCON: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;
     1384    21331        /**/
     1385    21332    1         ENTFLG=1;
     1386    21333    1   TRM20: ;
     1387    21334                        /* Block to master CPU for DO INHIBIT
     1388    21335                           to work - see the OLDSC check below */
     1389    21336    1         IF S_PNO ~= 0 THEN CALL SSS$BLOCK;
     1390    21337    1         LDCT$=PLDCT$;
     1391    21338    1         KEY=NK$LDCT.DEVNM;
     1392    21339    1         INDX=8;
     1393    21340    1         GOTO TRMCOM;
     1394    21341        /**/
     1395    21342        /*F* NAME:         KCO$MONCON
     1396    21343             PURPOSE:      To connect monitor DCBs to comgroups. */
     1397    21344        /**/
     1398    21345        /*D* NAME:         KCO$MONCON
     1399    21346             CALL:         As KCO$TRMCON
     1400    21347             ENVIRONMENT:  As KCO$TRMCON
     1401    21348             INPUT:        As KCO$TRMCON
     1402    21349             OUTPUT:       As KCO$TRMCON
     1403    21350             DESCRIPTION:  Monitor DCB stations are set up to act like
     1404    21351                           normal DCB stations, with certain restrictions
     1405    21352                           on what they may do.  The primary example of
     1406    21353                           such a special station is MONKEY, the
     1407    21354                           monitor part of KEYIN.  The name is rather
     1408    21355                           historical; in fact MONKEY is the monitor's
     1409    21356                           station on the CSCG, and handles lots of
     1410    21357                           things other than KEYIN work.
     1411    21358
     1412    21359                           KCO$MONCON travels much the same path as
     1413    21360                           KCO$TRMCON, except that the station block
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:64   
     1414    21361                           is set up to look like a DCB station instead
     1415    21362                           of a terminal. */
     1416    21363        /**/
     1417    21364    1   KCO$MONCON: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;
     1418    21365        /**/
     1419    21366    1         ENTFLG=-1;
     1420    21367    1         GOTO TRM20;
     1421    21368        /**/
     1422    21369        /*F* NAME:         KCO$FINDSTAD
     1423    21370             PURPOSE:      To find a station on a comgroup */
     1424    21371        /**/
     1425    21372        /*D* NAME:         KCO$FINDSTAD
     1426    21373             CALL:         KCO$FINDSTAD (PLDCT$,KC$CGID,DEVNAME,ERROR)
     1427    21374             ENVIRONMENT:  Any.
     1428    21375             INPUT:        KC$CGID   - Unused.
     1429    21376                           B$JIT.DCB$- Points to a DCB open to the desired
     1430    21377                                       comgroup.
     1431    21378                           DEVNAME   - 8-char station name
     1432    21379             OUTPUT:       PLDCT$    - pointer to LDCT
     1433    21380                           ERROR     - error code
     1434    21381             DESCRIPTION:  Finds the desired station name (need NOT be
     1435    21382                           a terminal station) on the given comgroup.
     1436    21383                           ALTRETs if not found.  The answer given is
     1437    21384                           the LDCT pointer.
     1438    21385                           Note that the caller of this routine need not
     1439    21386                           worry about the comgroup going away, since he
     1440    21387                           himself has it open.  However, the found station
     1441    21388                           itself may disconnect after we return to the
     1442    21389                           caller.  Thus if the station is to be used in
     1443    21390                           any way, it must be such that disconnection causes
     1444    21391                           no harm (for example, some callers of this
     1445    21392                           routine are just performing legality checks prior
     1446    21393                           to calling KCI$RWCG, which is safe 'cause it is
     1447    21394                           a media layer).
     1448    21395        */
     1449    21396    1   KCO$FINDSTAD: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;
     1450    21397        /**/
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:65   
     1451    21398    1         ENTFLG=2;
     1452    21399    1         INDX=8;
     1453    21400    1         KEY=ADDR(B$CGAUCI)->CHAR8;
     1454    21401    1         ERROR=0;
     1455    21402    1         TRMFLG=0;
     1456    21403    1         JDCB$=B$JIT.DCB$;
     1457    21404    1         CFU$=F$DCB.CFU$;
     1458    21405    1         CTX.SID=FM$CFU.GDA;
     1459    21406    1         CTX.DISP=FM$CFU.LDA;
     1460    21407              %LOCK (G=KQ_CGLGATE);
     1461    21410    1         GOTO GOTCG;
     1462    21411        /**/
     1463    21412        /*F* NAME:         KCO$FINDSTA
     1464    21413             PURPOSE:      To find a station on a comgroup. */
     1465    21414        /**/
     1466    21415        /*D* NAME:         KCO$FINDSTA
     1467    21416             CALL:         KCO$FINDSTA (PLDCT$,KC$CGID,DEVNAME,ERROR)
     1468    21417             ENVIRONMENT:  Any.
     1469    21418             INPUT:        KC$CGID   - As KCO$TRMCON.
     1470    21419                           ERROR     - Integer number of significant characters
     1471    21420                                       in DEVNAME.
     1472    21421                           DEVNAME   - 8-char station name.
     1473    21422             OUTPUT:       PLDCT$    - pointer to LDCT
     1474    21423                           ERROR     - error code
     1475    21424             DESCRIPTION:  Finds the comgroup as in KCO$TRMCON.  The station
     1476    21425                           to be found is any whose name matches DEVNAME in
     1477    21426                           the first ERROR characters.  Otherwise is the
     1478    21427                           same as KCO$FINDSTAD.
     1479    21428                           Note that upon return from this routine, the
     1480    21429                           comgroup and/or the target station may go away
     1481    21430                           at any time.
     1482    21431        */
     1483    21432    1   KCO$FINDSTA: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;
     1484    21433        /**/
     1485    21434    1         ENTFLG=2;
     1486    21435    1         INDX=ERROR;
     1487    21436    1         KEY=ADDR(B$CGAUCI)->CHAR8;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:66   
     1488    21437    1         CALL INSERT(KEY,INDX,,CHARZEROS);
     1489    21438    1   TRMCOM:;
     1490    21439    1         ERROR=0;
     1491    21440    1         TRMFLG=0;
     1492    21441    1         CNNCT='0'B;
     1493    21442    1         TRYCNT=0;
     1494    21443    1         IF ENTFLG = 3
     1495    21444    2         THEN DO;
     1496    21445    2           CTX$ = ADDR(KC$CGID);
     1497    21446    2           ENTFLG = 1;
     1498    21447    2           END;
     1499    21448    1         ELSE
     1500    21449    1          CALL FINDCG ALTRET(NOCG);
     1501    21450        /**/
     1502    21451    1   GOTCG:;
     1503    21452    1         CALL GLOCK;
     1504    21453    1         IF NOT KQ$CG.OPEN
     1505    21454    1         OR KQ$CG.CLOSING
     1506    21455    1         OR (ENTFLG=1 AND NOT KQ$CG.AUCTL.TERMCONLGL) THEN
     1507    21456    2           DO; /* Comgroup is being closed */
     1508    21457    2           CALL GUNLOCK;
     1509    21458                %UNLOCK (G=KQ_CGLGATE);
     1510    21461    2           GOTO NOCG;
     1511    21462    2           END;
     1512    21463                           /* Bump NUMTERMS to keep the comgroup from
     1513    21464                              shutting down while we're looking */
     1514    21465        /**/
     1515    21466    1         KQ$CG.STATS.NUMTERMS=KQ$CG.STATS.NUMTERMS+1;
     1516    21467    1         TRMFLG=1;
     1517    21468    1         CALL GUNLOCK;
     1518    21469              %UNLOCK (G=KQ_CGLGATE);
     1519    21472        /**/
     1520    21473    1         CALL KQX$LDASR(KQ$CG);
     1521    21474        /**/
     1522    21475    1         IF ENTFLG < 2 THEN
     1523    21476    2           DO;
     1524    21477    2           IF KQ_LOG.TSIO THEN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:67   
     1525    21478    2            CALL KQZ$LOG (KQ$CG,%KQLOG_TCRQ,S_CUN,0,
     1526    21479    2            ADDR(PLDCT$)->UBINHALF,
     1527    21480    2            SUBSTR(NK$LDCT.DEVNM,0,4),
     1528    21481    2            SUBSTR(NK$LDCT.DEVNM,4,4));
     1529    21482    2           NK$LDCT.CG$=CTX$;
     1530    21483    2           CALL CNNCTINFO ALTRET(TERMNOMEM);
     1531    21484    2           END;
     1532    21485        /**/
     1533    21486
     1534    21487
     1535    21488                     /*    Find the
     1536    21489                      *    station in the
     1537    21490                      *    tree.  If not there
     1538    21491                      *    and this isn't FINDSTA,
     1539    21492                      *    then make a
     1540    21493                      *    new one.
     1541    21494                      */
     1542    21495    1   FINDSTA2:;
     1543    21496    1         CALL SLOCK;
     1544    21497    1         IF KQ$CG.CLOSING OR NOT KQ$CG.OPEN THEN
     1545    21498    2           DO;
     1546    21499    2           CALL SUNLOCK;
     1547    21500    2           GOTO NOCG;
     1548    21501    2           END;
     1549    21502    1         CALL KQB$SRCH (KQ$CG.STREE,KEY,SCRATCH$) ALTRET(GETTRM);
     1550    21503    1         STA$=SCRATCH$;
     1551    21504    1         GOTO GOTTERM;
     1552    21505    1   GETTRM:;
     1553    21506    1         STA$=SCRATCH$;
     1554    21507    1         IF ENTFLG >= 2 THEN
     1555    21508    2           DO;
     1556    21509                     /*    FINDSTA: play around
     1557    21510                      *    a bit in the tree
     1558    21511                      *    to find the right
     1559    21512                      *    match for the
     1560    21513                      *    wild-carded name.
     1561    21514                      */
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:68   
     1562    21515    2           IF STA$ = ADDR(NIL)
     1563    21516    2           OR INDX = SIZEC(KEY) THEN GOTO FINDSTA8;
     1564    21517    2           IF ADDR(KQ$STA.BTN.KEY)->CHARINDX ~= ADDR(KEY)->CHARINDX THEN
     1565    21518    3             DO;
     1566    21519    3             IF ADDR(KQ$STA.BTN.KEY)->CHARINDX > ADDR(KEY)->CHARINDX THEN
     1567    21520    3              GOTO FINDSTA8;
     1568    21521    3             STA$=KQ$STA.BTN.FLINK$;
     1569    21522    3             IF STA$ = ADDR(NIL) THEN GOTO FINDSTA8;
     1570    21523    3             IF ADDR(KQ$STA.BTN.KEY)->CHARINDX ~= ADDR(KEY)->CHARINDX THEN
     1571    21524    4               DO;
     1572    21525    4   FINDSTA8:   ;
     1573    21526    4               ERROR=99;
     1574    21527    4               CALL SUNLOCK;
     1575    21528    4               PLDCT$=ADDR(NIL);
     1576    21529    4               GOTO TRMXIT;
     1577    21530    4               END;
     1578    21531    3             END;
     1579    21532    2   FINDSTA5:;
     1580    21533    2           CALL STALOCK;
     1581    21534    2           IF KQ$STA.LDCT$ = ADDR(NIL)
     1582    21535    2           OR KQ$STA.IDSC THEN
     1583    21536    3             DO;
     1584    21537    3             CALL STAUNLOCK;
     1585    21538    3             GOTO FINDSTA8;
     1586    21539    3             END;
     1587    21540    2           IF ENTFLG = 3 THEN
     1588    21541    2            KQ$STA.LOCKCNT=KQ$STA.LOCKCNT+1;
     1589    21542    2           CALL STAUNLOCK;
     1590    21543    2           PLDCT$=KQ$STA.LDCT$;
     1591    21544    2           CALL SUNLOCK;
     1592    21545    2           GOTO TRMXIT;
     1593    21546    2           END;
     1594    21547        /**/
     1595    21548    1         IF NOT KQ$CG.AUCTL.XSTALGL THEN
     1596    21549    2           DO;
     1597    21550    2   FINDSTA20:;
     1598    21551    2           CALL SUNLOCK;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:69   
     1599    21552    2           ERROR=%E$STAILLGL;
     1600    21553    2           GOTO TRMXIT;
     1601    21554    2           END;
     1602    21555        /**/
     1603    21556    1         CALL VALIDATE (KEY) ALTRET(STABAD);
     1604    21557                     /*    Get a new station
     1605    21558                      *    block
     1606    21559                      */
     1607    21560    1         CALL KQT$MAKESTA (KQ$CG,SCRATCH$,KEY) ALTRET(FINDSTA21);
     1608    21561    1         STA$=SCRATCH$;
     1609    21562    1         CALL STALOCK;
     1610    21563    1         GOTO FINDSTA25;
     1611    21564    1   FINDSTA21:;
     1612    21565    1         IF TRYCNT ~= 0 THEN GOTO TERMNOMEM;
     1613    21566    1         TRYCNT=1;
     1614    21567    1         CALL GTRM ALTRET(TERMNOMEM);
     1615    21568    1         GOTO FINDSTA2;
     1616    21569    1   GOTTERM:;
     1617    21570    1         IF ENTFLG >= 2 THEN GOTO FINDSTA5;
     1618    21571
     1619    21572
     1620    21573
     1621    21574                     /*    TRMCON: Now try
     1622    21575                      *    to perform the
     1623    21576                      *    connection.
     1624    21577                      *    First make various
     1625    21578                      *    legality checks,
     1626    21579                      *    then set LDCT$
     1627    21580                      *    in the station block
     1628    21581                      *    to keep anyone else
     1629    21582                      *    from connecting onto
     1630    21583                      *    it, and finish the
     1631    21584                      *    connection.
     1632    21585                      */
     1633    21586
     1634    21587    1         CALL STALOCK;
     1635    21588    1         IF NOT KQ$CG.AUCTL.XSTALGL AND NOT KQ$STA.PERM THEN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:70   
     1636    21589    2           DO;
     1637    21590    2           CALL STAUNLOCK;
     1638    21591    2           GOTO FINDSTA20;
     1639    21592    2           END;
     1640    21593    1         IF KQ$STA.LDCT$ ~= ADDR(NIL)
     1641    21594    1         OR KQ$STA.IDSC THEN
     1642    21595    2           DO;
     1643    21596    2           CALL STAUNLOCK;
     1644    21597    2           CALL SUNLOCK;
     1645    21598    2           ERROR=%E$DUPNM;
     1646    21599    2           GOTO TRMXIT;
     1647    21600    2           END;
     1648    21601    1         IF KQ$STA.SPECIAL
     1649    21602    1         OR KQ$STA.AUP THEN
     1650    21603    2           DO;
     1651    21604    2           CALL STAUNLOCK;
     1652    21605    2           CALL SUNLOCK;
     1653    21606    2           ERROR=%E$NTRMSTA;
     1654    21607    2           GOTO TRMXIT;
     1655    21608    2           END;
     1656    21609        /**/
     1657    21610        /**/
     1658    21611        /**/
     1659    21612                     /*    Now connect the terminal to
     1660    21613                      *    the comgroup.  From here on
     1661    21614                      *    in, nothing can go wrong
     1662    21615                      *    go wrong go wrong go wrong....
     1663    21616                      *    I.e. the terminal connect
     1664    21617                      *    cannot be aborted...legality
     1665    21618                      *    checks cannot be added after
     1666    21619                      *    this point.  Hence all the
     1667    21620                      *    complex magic to obtain the
     1668    21621                      *    connect info DBLK before even
     1669    21622                      *    looking in the station tree,
     1670    21623                      *    etc.  The terminal will be
     1671    21624                      *    connected to the comgroup now,
     1672    21625                      *    BUT the LDCT is not set to
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:71   
     1673    21626                      *    point at the KQ$STA till
     1674    21627                      *    a bit later.  At that point
     1675    21628                      *    we check to see if the
     1676    21629                      *    terminal is trying to
     1677    21630                      *    disconnect, and if so
     1678    21631                      *    call KQP$DISC.
     1679    21632                      */
     1680    21633    1   FINDSTA25:;
     1681    21634    1         IF KQ_LOG.TSIO THEN
     1682    21635    2           DO;
     1683    21636    2           INDXR$=STA$;
     1684    21637    2           CALL KQZ$LOG (KQ$CG,%KQLOG_TCDN,S_CUN,
     1685    21638    2           INDXR$,
     1686    21639    2           ADDR(INDXR$)->UBINHALF,
     1687    21640    2           SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
     1688    21641    2           SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
     1689    21642    2           END;
     1690    21643    1         KQ$STA.LDCT$=LDCT$;
     1691    21644    1         KQ$STA.TERM='1'B;
     1692    21645    1         KQ$STA.USR#=0;
     1693    21646    1         CALL STAINIT;
     1694    21647    1         KQ$STA.SGHD$=ADDR(NIL);
     1695    21648    1         KQ$STA.MBLK$=CNNCT.MBLK$;
     1696    21649    1         CNNCT.MBLK$=ADDR(NIL);
     1697    21650    1         IF ENTFLG < 0 THEN
     1698    21651    2           DO;
     1699    21652
     1700    21653                     /*    KCO$MONCON: Do
     1701    21654                      *    the special
     1702    21655                      *    DCB-like magic
     1703    21656                      *    to connect
     1704    21657                      *    MONKEY.
     1705    21658                      */
     1706    21659
     1707    21660    2           NK$LDCT.STA$=STA$;
     1708    21661    2           KQ$STA.TOLDAU='0'B;
     1709    21662    2           KQ$STA.CNNCTDDA=CNNCT.DDA;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:72   
     1710    21663    2           CNNCT.DDA=0;
     1711    21664    2           KQ$STA.CNNCTSIZE=SIZEC(B$CGAUCIDCB);
     1712    21665    2           KQ$STA.DCBLNK$=KQ$CG.DCBHD$;
     1713    21666    2           KQ$CG.DCBHD$=STA$;
     1714    21667    2           KQ$STA.MONDCB='1'B;
     1715    21668    2           KQ$STA.TERM='0'B;
     1716    21669    2           CALL STAUNLOCK;
     1717    21670    2           CALL SUNLOCK;
     1718    21671    2           CALL GLOCK;
     1719    21672    2           KQ$CG.STATS.NUMTERMS=KQ$CG.STATS.NUMTERMS-1;
     1720    21673    2           KQ$CG.STATS.NUMDCBS=KQ$CG.STATS.NUMDCBS+1;
     1721    21674    2           CALL GUNLOCK;
     1722    21675    2           CALL KQC$ACTSTA (KQ$STA);
     1723    21676    2           CALL KCA$TELLAUM(KQ$STA,%CG_DOPN#,ADDR(B$CGAUCIDCB));
     1724    21677    2           RETURN;
     1725    21678    2           END;
     1726    21679        /**/
     1727    21680
     1728    21681                     /*    Continue with
     1729    21682                      *    the cleanup of
     1730    21683                      *    a vanilla
     1731    21684                      *    TRMCON.
     1732    21685                      */
     1733    21686
     1734    21687    2           DO INHIBIT;
     1735    21688    2           NK$LDCT.DFLG.INPUT=B$CGAUCI.FLG.INPUT;
     1736    21689    2           NK$LDCT.DFLG.OUTPUT=B$CGAUCI.FLG.OUTPUT;
     1737    21690    2           END;
     1738    21691    1         KQ$STA.DVBYTE=KQ$CG.AUCTL.DVBYTE;
     1739    21692    1         KQ$STA.LOCKCNT=KQ$STA.LOCKCNT+1;
     1740    21693    1         KQ$STA.CNNCTDDA=CNNCT.DDA;
     1741    21694    1         CNNCT.DDA=0;
     1742    21695    1         KQ$STA.CNNCTSIZE=SIZEC(B$CGAUCI)+(B$CGAUCI.NWINFO*4);
     1743    21696    1         CALL STAUNLOCK;
     1744    21697    1         CALL SUNLOCK;
     1745    21698    2           DO INHIBIT;
     1746    21699                     /*    A bit of magic here.  Prior to this point
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:73   
     1747    21700                      *    the LDCT RESCOD is NK_CGTRM, thus KCD$DSCTRM
     1748    21701                      *    will be called if a DISCONNECT request is
     1749    21702                      *    received from the FEP.  KCD$DSCTRM calls
     1750    21703                      *    KQP$DISC who will do nothing since either
     1751    21704                      *    or both LDCT.CG$ and LDCT.STA$ are NIL.
     1752    21705                      *    (Both will be NIL if we get interrupted
     1753    21706                      *    in KLM$EXHUME after switching RESCOD to
     1754    21707                      *    CGTRM from NOCG but before calling here;
     1755    21708                      *    STA$ will be NIL if the DISC message
     1756    21709                      *    arrives after setting CG$ (above) but
     1757    21710                      *    before we get here).
     1758    21711                      *
     1759    21712                      *    What we do is set STA$, then check for
     1760    21713                      *    LDCT.OLDSC.  If it's set, we know KQP$DISC
     1761    21714                      *    was called & did nothing (long ago), so we
     1762    21715                      *    call him now.  We do this inhibited to prevent
     1763    21716                      *    the DISC from arriving via interrupt after
     1764    21717                      *    we set STA$ but before we chk OLDSC.  This
     1765    21718                      *    code MUST run on the master CPU.
     1766    21719                      */
     1767    21720    2           NK$LDCT.STA$=STA$;
     1768    21721    2           IF NK$LDCT.DFLG.OLDSC      /* Term has disconnected */
     1769    21722    2           THEN CALL KQP$DISC(NK$LDCT);
     1770    21723    2           CALL KQP$UNLOCK (STA$->KQ$STA);
     1771    21724    2           END;
     1772    21725    1         RETURN;
     1773    21726        /**/
     1774    21727        /**/
     1775    21728    1   TERMNOMEM:;
     1776    21729    1         ERROR=%E$CGCXT;
     1777    21730    1         GOTO TRMXIT;
     1778    21731    1   STABAD:;
     1779    21732    1         CALL SUNLOCK;
     1780    21733    1         ERROR=%E$STABAD;
     1781    21734    1         GOTO TRMXIT;
     1782    21735    1   NOCG: ;
     1783    21736    1         ERROR=%E$NOCG;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:74   
     1784    21737    1   TRMXIT:;
     1785    21738    1         IF TRMFLG~=0 THEN
     1786    21739    1          CALL KCO$TRMGONE (KQ$CG);
     1787    21740    1         IF ERROR=0 THEN
     1788    21741    1          RETURN;
     1789    21742    1         IF ENTFLG < 2 THEN CALL RELCNNCT;
     1790    21743    1         ALTRETURN;
     1791    21744        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:75   
     1792    21745        /**/
     1793    21746        /******************************************************************************
     1794    21747        *                                                                             *
     1795    21748        *  SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS  *
     1796    21749        * S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S *
     1797    21750        * S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S     *
     1798    21751        *  SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS  *
     1799    21752        *     S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S *
     1800    21753        * S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S *
     1801    21754        *  SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS  *
     1802    21755        *                                                                             *
     1803    21756        ******************************************************************************/
     1804    21757
     1805    21758        /****************************************************************
     1806    21759        *****************************************************************/
     1807    21760        /*D* NAME:         STAINIT
     1808    21761             PURPOSE:      To initialize a station block
     1809    21762             DESCRIPTION:  Sets up stuff common to DCBs and terminals */
     1810    21763    1   STAINIT: PROC;
     1811    21764        /**/
     1812    21765    2         KQ$STA.TOLDAU='0'B;
     1813    21766    2         KQ$STA.OPNBLKED='0'B;
     1814    21767    2         KQ$STA.DSCREQW='0'B;
     1815    21768    2         KQ$STA.OPNREJ='0'B;
     1816    21769    2         KQ$STA.DSCREQS='0'B;
     1817    21770    2         KQ$STA.STARSDUN='0'B;
     1818    21771    2         KQ$STA.PVGSENSE='0'B;
     1819    21772    2         KQ$STA.SUCCREAD='0'B;
     1820    21773    2         KQ$STA.TERR='0'B;
     1821    21774    2         KQ$STA.IDSC='0'B;
     1822    21775    2         KQ$STA.SAVIDSC='0'B;
     1823    21776    2         KQ$STA.AU='0'B;
     1824    21777    2         KQ$STA.EVNT='0'B;
     1825    21778    2         KQ$STA.EVCNT=0;
     1826    21779    2         KQ$STA.DSID=KQ$CG.MSGID;
     1827    21780    2         KQ$STA.WRITES=0;
     1828    21781    2         KQ$STA.READS=0;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:76   
     1829    21782    2         RETURN;
     1830    21783    2   END STAINIT;
     1831    21784        /****************************************************************
     1832    21785        *****************************************************************/
     1833    21786        /*D* NAME:         CNNCTINFO
     1834    21787             PURPOSE:      To set up the connect info for a station
     1835    21788             DESCRIPTION:  Gets a data block, stuffs it with the
     1836    21789                           connect info, and puts the DDA in CNNCT.DDA.
     1837    21790                           Unlocks the DBLK.  Gets an MBLK and puts its
     1838    21791                           address in CNNCT.MBLK$.
     1839    21792                           If this is a terminal connecting, gets another
     1840    21793                           data block, stuffs it with the same stuff as the
     1841    21794                           first data block, and puts the DDA into MBLK.DDA.
     1842    21795                           ALTRETs if any of this fails after giving back
     1843    21796                           all that it had gotten.
     1844    21797        */
     1845    21798    1   CNNCTINFO: PROC ALTRET;
     1846    21799        /**/
     1847    21800    2   DCL SIZ UBIN;
     1848    21801    2         IF ENTFLG <= 0 THEN
     1849    21802    2          SIZ=SIZEC(B$CGAUCIDCB);
     1850    21803    2         ELSE SIZ=SIZEC(B$CGAUCI)+(B$CGAUCI.NWINFO*4);
     1851    21804    2         I=SIZ;
     1852    21805    2         CALL KQD$GETR(KQ$CG,DBLK$,I) ALTRET(ALTRT);
     1853    21806    2         KQ$DBLK.STAMP=ADDR(NK$LDCT.DEVNM)->UBINHALF;
     1854    21807    2         CNNCT.DDA=I;
     1855    21808    2         I=SIZ;
     1856    21809    2         IF ENTFLG <= 0
     1857    21810    2         THEN PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=ADDR(B$CGAUCIDCB)->MOVEI;
     1858    21811    3         ELSE DO;
     1859    21812    3           B$CGAUCI.FLG.INPUT=B$CGAUCI.FLG.INPUT&KQ$CG.AUCTL.INPUT;
     1860    21813    3           B$CGAUCI.FLG.OUTPUT=B$CGAUCI.FLG.OUTPUT&KQ$CG.AUCTL.OUTPUT;
     1861    21814    3           PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=ADDR(B$CGAUCI)->MOVEI;
     1862    21815    3           END;
     1863    21816    2         CALL KQD$UNLOCK(KQ$CG,DBLK$);
     1864    21817    2         I=SIZEW(KQ$MBLK);
     1865    21818    2         CALL KQM$GETBK (KQ$CG,CNNCT.MBLK$,I) ALTRET(NMB);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:77   
     1866    21819    2         CALL KQM$RELMBLK (KQ$CG,CNNCT.MBLK$);
     1867    21820    2         CNNCT.MBLK$=ADDR(NIL);
     1868    21821    2         GOTO GMB;
     1869    21822    2   NMB:  CALL SSR$REG (%SS_SL,,1); /* Wait for garbage collector */
     1870    21823    2   GMB:  CALL KQM$GETMBLK (KQ$CG,CNNCT.MBLK$,I) ALTRET(ALTRT);
     1871    21824    2         CNNCT.MBLK$->KQ$MBLK.PUTSTATE=KQPS_GDN#;
     1872    21825                             /* To keep from screeching in KQP$DSCGO if the LDCT     */
     1873    21826                             /* goes through disconnect before we use this MBLK      */
     1874    21827    3         IF ENTFLG>0 THEN DO;             /* Connecting terminal...             */
     1875    21828    3           I=SIZ;
     1876    21829    3           CALL KQD$GETR(KQ$CG,DBLK$,I) ALTRET(ALTRT);
     1877    21830    3           CNNCT.MBLK$->KQ$MBLK.DDA=I;
     1878    21831    3           CNNCT.MBLK$->KQ$MBLK.MSGSIZE=SIZ;
     1879    21832    3           I=SIZ;
     1880    21833    3           KQ$DBLK.STAMP=CNNCT.MBLK$->KQ$MBLK.STAMP;
     1881    21834    3           PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=ADDR(B$CGAUCI)->MOVEI;
     1882    21835    3           CALL KQD$UNLOCK(KQ$CG,DBLK$);
     1883    21836    3           END;
     1884    21837    2         RETURN;
     1885    21838    2   ALTRT: CALL RELCNNCT;
     1886    21839    2         ALTRETURN;
     1887    21840    2   END CNNCTINFO;
     1888    21841        /****************************************************************
     1889    21842        *****************************************************************/
     1890    21843        /*D* NAME:         RELCNNCT
     1891    21844             PURPOSE:      To release stuff allocated for connect info
     1892    21845        */
     1893    21846    1   RELCNNCT: PROC;
     1894    21847        /**/
     1895    21848    2   DCL DA UBIN;
     1896    21849        /**/
     1897    21850    2         CALL RELDDA(CNNCT.DDA,ADDR(NK$LDCT.DEVNM)->UBINHALF);
     1898    21851    2         IF  CNNCT.MBLK$  ~= ADDR(NIL)
     1899    21852    3         AND CNNCT.MBLK$R ~= 0 THEN DO;
     1900    21853    3           CALL RELDDA(CNNCT.MBLK$->KQ$MBLK.DDA,
     1901    21854    3           CNNCT.MBLK$->KQ$MBLK.STAMP);
     1902    21855    3           CALL KQM$RELMBLK (KQ$CG,CNNCT.MBLK$);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:78   
     1903    21856    3           CNNCT.MBLK$=ADDR(NIL);
     1904    21857    3           END;
     1905    21858    2         RETURN;
     1906    21859
     1907    21860    2   RELDDA: PROC(DDA,STAMP);
     1908    21861
     1909    21862    3   DCL DDA UBIN;
     1910    21863    3   DCL STAMP UBIN HALF HALIGNED;
     1911    21864    3   DCL DA UBIN;
     1912    21865    4         IF DDA~=0 THEN DO;
     1913    21866    4           I=STAMP;
     1914    21867    4   TRY:    DA=DDA;
     1915    21868    5           CALL KQD$DELDDA(KQ$CG,I,DA) WHENALTRETURN DO;
     1916    21869    6             IF DA=%KQDE_NDFRBLK THEN DO;
     1917    21870    6               CALL SSR$REG(%SS_SL,,1);
     1918    21871    6               GOTO TRY;
     1919    21872    6               END;
     1920    21873    5             END;
     1921    21874    4           DDA=0;
     1922    21875    4           END;
     1923    21876    3         RETURN;
     1924    21877    3   END RELDDA;
     1925    21878    2   END RELCNNCT;
     1926    21879        /****************************************************************
     1927    21880        *****************************************************************/
     1928    21881        /*D* NAME:         GTRM
     1929    21882             PURPOSE:      To get a station block for a terminal
     1930    21883             DESCRIPTION:  Called when the initial attempt to get
     1931    21884                           a station block fails.  The station
     1932    21885                           tree has been unlocked.
     1933    21886
     1934    21887                           The idea here would be to queue ourselves
     1935    21888                           for the garbage collector (which is what
     1936    21889                           KQT$GETSTA does), except that we have no
     1937    21890                           station block on behalf of which to do that.
     1938    21891                           Hence we call KQM$GETBK which will kick the
     1939    21892                           garbage collector, and then wait 1 second
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:79   
     1940    21893                           and try again.  If we get a block, then
     1941    21894                           we release it and go back to try again
     1942    21895                           because of course we must look again in
     1943    21896                           the tree.  If we can't get a block, we
     1944    21897                           ALTRET.
     1945    21898        */
     1946    21899    1   GTRM: PROC ALTRET;
     1947    21900        /**/
     1948    21901    2         I=SIZEW(KQ$QTN);
     1949    21902    2         CALL KQM$GETBK (KQ$CG,SCRATCH$,I) ALTRET(GT1);
     1950    21903    2         GOTO GT2;
     1951    21904    2   GT1:  CALL SSR$REG (%SS_SL,,1);
     1952    21905    2         I=SIZEW(KQ$QTN);
     1953    21906    2         CALL KQM$GETB (KQ$CG,SCRATCH$,I) ALTRET(ALTRT);
     1954    21907    2   GT2:  I=SIZEW(KQ$QTN);
     1955    21908    2         CALL KQM$RELB (KQ$CG,SCRATCH$,I);
     1956    21909    2         STA$=ADDR(NIL);
     1957    21910    2         RETURN;
     1958    21911    2   ALTRT: STA$=ADDR(NIL);
     1959    21912    2         ALTRETURN;
     1960    21913    2   END GTRM;
     1961    21914        /****************************************************************
     1962    21915        *****************************************************************/
     1963    21916        /*D* NAME:         VALIDATE
     1964    21917             PURPOSE:      To perform character-set checks
     1965    21918             DESCRIPTION:  If the passed item is non-blank, its first
     1966    21919                           char must be in the KC legal set, else
     1967    21920                           ALTRET. */
     1968    21921    1   VALIDATE: PROC(ITEM) ALTRET;
     1969    21922        /**/
     1970    21923    2   DCL ITEM CHAR(8);
     1971    21924    2   DCL I UBIN;
     1972    21925        /**/
     1973    21926    2         IF ITEM~=' ' THEN
     1974    21927    2          CALL INDEX(I,SUBSTR(ITEM,0,1),KC_LGL1ST) ALTRET(ERR);
     1975    21928    2         RETURN;
     1976    21929    2   ERR:  ALTRETURN;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:80   
     1977    21930    2   END VALIDATE;
     1978    21931        /****************************************************************
     1979    21932        *****************************************************************/
     1980    21933        /*D* NAME:         SLOCK, SUNLOCK, STALOCK, STAUNLOCK, GLOCK, GUNLOCK
     1981    21934             PURPOSE:      To lock/unlock various gates. */
     1982    21935    1   SLOCK: PROC;
     1983    21936        /**/
     1984    21937        %LOCK (G=KQ$CG.STREE.GATE);
     1985    21940    2         RETURN;
     1986    21941    2   SUNLOCK: ENTRY;
     1987    21942        /**/
     1988    21943              %UNLOCK (G=KQ$CG.STREE.GATE);
     1989    21946    2         RETURN;
     1990    21947    2   STALOCK: ENTRY;
     1991    21948        /**/
     1992    21949              %LOCK (G=KQ$STA.GATE);
     1993    21952    2         RETURN;
     1994    21953    2   STAUNLOCK: ENTRY;
     1995    21954        /**/
     1996    21955              %UNLOCK (G=KQ$STA.GATE);
     1997    21958    2         RETURN;
     1998    21959    2   GLOCK: ENTRY;
     1999    21960        /**/
     2000    21961              %LOCK (G=KQ$CG.GATE.CG);
     2001    21964    2         RETURN;
     2002    21965    2   GUNLOCK: ENTRY;
     2003    21966        /**/
     2004    21967              %UNLOCK (G=KQ$CG.GATE.CG);
     2005    21970    2         RETURN;
     2006    21971    2   END SLOCK;
     2007    21972        /****************************************************************
     2008    21973        *****************************************************************/
     2009    21974        /*D* NAME:         FINDCG
     2010    21975             PURPOSE:      To find the desired comgroup for TRMCON
     2011    21976             DESCRIPTION:  Searches the comgroup chain for one
     2012    21977                           which matches the given KC$CGID.  If
     2013    21978                           found, returns CTX$ pointing to the
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:81   
     2014    21979                           comgroup context block, with the comgroup
     2015    21980                           list gate locked.  Else ALTRETs with
     2016    21981                           the gate unlocked.
     2017    21982        */
     2018    21983    1   FINDCG: PROC ALTRET;
     2019    21984        /**/
     2020    21985              %LOCK (G=KQ_CGLGATE);
     2021    21988    2         CTX$=KQ$MMSD.CGHEAD$;
     2022    21989    3           DO WHILE(CTX$~=ADDR(NIL));
     2023    21990    3           CFU$=KQ$CG.CFU$;
     2024    21991    3           IF  FM$CFUF.ACCNAM ~= 0
     2025    21992    3           AND FM$CFU.STARX.F = 0 THEN
     2026    21993    4             DO;
     2027    21994    4             CTL$=CFU$;
     2028    21995    5               DO WHILE(CTL$->FM$CFU.NAMEX<FM$CFUX.CFUT);
     2029    21996    5               CTL$=PINCRW(F$CFU$,CTL$->FM$CFU.NAMEX);
     2030    21997    5               END;
     2031    21998    4             NAME$=PINCRC(F$CFU$,CTL$->FM$CFU.NAMEX);
     2032    21999    4             ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);
     2033    22000    4             I=FM$CFUN.L+1;
     2034    22001    4             IF ADDR(KC$CGID.NAME#)->NAMEI~=ADDR(FM$CFUN.L)->NAMEI THEN
     2035    22002    4              GOTO NXTCG;
     2036    22003    4             IF KC$CGID.ACCT#~=FM$CFUA.ACCT THEN
     2037    22004    4              GOTO NXTCG;
     2038    22005    4             IF KC$CGID.PSN#~=FM$SET.PSN(FM$CFUA.SETX) THEN
     2039    22006    4              IF KC$CGID.PSN#~=' ' OR FM$CFUA.PRIV THEN
     2040    22007    4               GOTO NXTCG;
     2041    22008    4             RETURN;
     2042    22009    4   NXTCG:    ;
     2043    22010    4             END;
     2044    22011    3           CTX$=KQ$CG.LNK$;
     2045    22012    3           END;
     2046    22013        /**/
     2047    22014              %UNLOCK (G=KQ_CGLGATE);
     2048    22017    2         ALTRETURN;
     2049    22018    2   END FINDCG;
     2050    22019        /****************************************************************
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:82   
     2051    22020        *****************************************************************/
     2052    22021        /*D* NAME:         GETGORGO
     2053    22022             PURPOSE:      To allocate the *GORGO station
     2054    22023             DESCRIPTION:  If one is not present already, allocates it and
     2055    22024                           ALTRETs if insufficient memory.  Else, or if
     2056    22025                           already there, sets it up.
     2057    22026        */
     2058    22027    1   GETGORGO: PROC ALTRET;
     2059    22028        /**/
     2060    22029    2         KEY='*GORGO';
     2061    22030    2         CALL SLOCK;
     2062    22031    2         CALL KQB$SRCH(KQ$CG.STREE,KEY,SCRATCH$) ALTRET(NOGORGOSTA);
     2063    22032    2         GOTO GOTGORGOSTA;
     2064    22033    2   NOGORGOSTA: ;
     2065    22034    2         CALL KQT$MAKESTA (KQ$CG,SCRATCH$,KEY) ALTRET(ALTRT);
     2066    22035    2   GOTGORGOSTA: ;
     2067    22036    2         STA$=SCRATCH$;
     2068    22037    2         CALL SUNLOCK;
     2069    22038    2         KQ$CG.GORGOSTA$=STA$;
     2070    22039    2         CALL STALOCK;
     2071    22040    2         KQ$STA.SPECIAL='1'B;
     2072    22041    2         CALL STAUNLOCK;
     2073    22042    2         RETURN;
     2074    22043    2   ALTRT:;
     2075    22044    2         ALTRETURN;
     2076    22045    2   END GETGORGO;
     2077    22046        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:83   
     2078    22047
     2079    22048
     2080    22049        /*F* NAME:         KCO$TRMGO
     2081    22050
     2082    22051             PURPOSE:      Do connection completion for terminals
     2083    22052
     2084    22053             LOCATION:     Contained in KCO$CLCG because this routine is called
     2085    22054                           at interrupt and KCO$OPCG resides in an overlay.
     2086    22055        */
     2087    22056
     2088    22057        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:84   
     2089    22058
     2090    22059
     2091    22060        /*F* NAME:         KCO$EXTEND
     2092    22061
     2093    22062             PURPOSE:      Increase the number of granules allocated to
     2094    22063                           a comgroup.
     2095    22064
     2096    22065        */
     2097    22066
     2098    22067
     2099    22068        /*D* NAME:         KCO$EXTEND
     2100    22069
     2101    22070             CALL:         CALL KCO$EXTEND
     2102    22071
     2103    22072             INPUT:        F$DCB.XTNSIZE - # grans to extend by
     2104    22073
     2105    22074             DESCRIPTION:  The comgroup is extended by the amount requested.
     2106    22075
     2107    22076        */
     2108    22077
     2109    22078
     2110    22079    1   KCO$EXTEND: ENTRY ALTRET;
     2111    22080
     2112    22081    1         JDCB$=B$JIT.DCB$;
     2113    22082    1         CFU$=F$DCB.CFU$;
     2114    22083    1         CTX.DISP=FM$CFU.LDA;
     2115    22084    1         CTX.SID=FM$CFU.GDA;
     2116    22085    1         CALL KQX$LDASR(KQ$CG);
     2117    22086    1         CALL FAG$GEXT ALTRET(ALTRT);
     2118    22087              %LOCK (G=KQ$CG.DTREE.GATE);
     2119    22090    1         KQ$CG.NGAVAL=KQ$CG.NGAVAL+F$DCB.XTNSIZE;
     2120    22091           /* If this EXTEND was prompted by a Diskwarn turn TRIGGERED off */
     2121    22092    1         IF (NOT KQ$CG.DELAY.DISKWARN)
     2122    22093    1         THEN KQ$CG.TRIGGERED = '0'B;
     2123    22094              %UNLOCK (G=KQ$CG.DTREE.GATE);
     2124    22097    1         RETURN;
     2125    22098        /**/
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:85   
     2126    22099    1   ALTRT: ;
     2127    22100    1         ALTRETURN;
     2128    22101        /**/
     2129    22102    1   END KCO$INIT;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:86   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   HF_DATA_R.:E05TOU  is referenced.
   KQM_MAC_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   AZ_SUBS_C.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   AZ_MACRO_C.:E05TOU  is referenced.
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:87   
      No diagnostics issued in procedure KCO$INIT.

   Procedure KCO$INIT requires 2701 words for executable code.
   Procedure KCO$INIT requires 96 words of local(AUTO) storage.

    No errors detected in file KCO$OPCG.:E05TSI    .

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:88   

 Object Unit name= KCO$INIT                                   File name= KCO$OPCG.:E05TOU
 UTS= JUL 30 '97 00:16:36.88 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     73    111  KCO$INIT
    2   Proc  even  none  2701   5215  KCO$INIT
    3  RoData even  none    61     75  KCO$INIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        4  KCO$INIT
     2   3124          yes     yes      Std        4  KCO$TRMCONGOTCG
     2   3131          yes     yes      Std        4  KCO$TRMCON
     2   3153          yes     yes      Std        4  KCO$MONCON
     2   3160          yes     yes      Std        4  KCO$FINDSTAD
     2   3221          yes     yes      Std        4  KCO$FINDSTA
     2   5133          yes     yes      Std        0  KCO$EXTEND
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:89   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMD$FLSHBUF
         yes           Std       1 SSS$SYSTIME
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 SSR$REG
 yes     yes           Std       8 KQZ$LOG
 yes     yes           Std       1 KQP$UNLOCK
         yes           Std       1 KQX$LDASR
         yes           Std       2 MMJ$MAPIOP
         yes           Std       1 FMD$RELBUF
 yes     yes           Std       3 KQM$RECON
 yes     yes           Std       2 KQT$DELSTA
 yes     yes           Std       3 KCA$TELLAUM
         yes           Std       1 MMJ$UNMAPIOP
 yes     yes           Std       1 KQS$RECOVER2
 yes     yes           Std       1 KQQ$RECOVER2
 yes     yes           Std       1 NKL$GETDCT
 yes     yes           Std       2 KQL$DELMLH
 yes     yes           Std       2 KQM$INIT
         yes           Std       3 FMD$GETBUF
         yes           Std       1 FMD$WRTBUF
 yes     yes           Std       1 KQC$CXTSET
         yes           Std       1 KCO$RCNNCT
 yes     yes           Std       3 KQT$GETSTA
 yes     yes           Std       1 KQC$CXTSET1
 yes     yes           Std       1 KQQ$RECOVER
 yes     yes           Std       1 KQS$RECOVER
 yes     yes           Std       2 FSA$GSP
         yes           Std       1 HFC$LOCK
 yes     yes           Std       6 ELA$SYSLOG
 yes     yes           Std       3 KQB$INSERTNL
 yes     yes           Std       3 KQB$SRCH
 yes     yes           Std       2 KQC$ACTSTA
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:90   
 yes     yes           Std       1 UQB$MDEQ
         yes           Std       4 FGH$UPDBUCKET
 yes     yes           Std       1 KQT$RECOVER
         yes           Std       1 KQX$SETTIME
 yes     yes           Std       1 KQX$CHKTIME
 yes     yes           Std       3 KCA$TELLAUR
         yes           Std       1 KCO$TRMGONE
         yes           Std       1 FMD$RBUF
 yes     yes           Std       1 KQP$DISC
 yes     yes           Std       1 KQC$TRMCK
         yes           Std       1 KCC$RECOVER
         yes           Std       1 FMD$GBUF
         yes           Std       0 KCO$CLCGERR
 yes     yes           Std       3 KQT$MAKESTA
 yes     yes           Std       3 KQM$GETP
 yes     yes           Std       6 FMD$REDBUF
 yes     yes           Std       1 KQP$RECOVER
 yes     yes           Std       2 KCI$VALSTA1
 yes     yes           Std       1 KQD$RECOVER
 yes     yes           Std       1 KQR$RECOVER
         yes           Std       0 SSS$BLOCK
 yes     yes           Std       0 FAG$GEXT
 yes     yes           Std       6 FMD$REDBUFBC
 yes     yes           Std       1 NKL$RELDCT
 yes     yes           Std       3 KQD$GETR
 yes     yes           Std       2 KQD$UNLOCK
 yes     yes           Std       3 KQM$GETBK
 yes     yes           Std       3 KQM$GETMBLK
 yes     yes           Std       2 KQM$RELMBLK
 yes     yes           Std       3 KQD$DELDDA
 yes     yes           Std       3 KQM$GETB
 yes     yes           Std       3 KQM$RELB
                       nStd      0 X66_AUTO_4
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:91   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_CGREOPEN                           M$UC                                  KC_LGL1ST
     KQ_CGLGATE                            KQ_LOG                                S_PNO
r    KQ_MMSD$                         r    B$M$UC$                               B$JIT$
     FM_FRZERO                        r    F$CFU$                                FM$BUF$
     KQ_ICG                                KQ_IDGRAN                             S_CUN
     KC_VLPSETSTA                          KC_VLPSTATION                         B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ASLENTSID                             ISSID
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:92   


      179        1        /*T***********************************************************/
      180        2        /*T*                                                         */
      181        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      182        4        /*T*                                                         */
      183        5        /*T***********************************************************/
      184        6
      185        7
      186        8        /**/
      187        9        /**/
      188       10
      189       11
      190       12        /*F* NAME:         KCO$INIT
      191       13             PURPOSE:      Provide the special functions needed when opening
      192       14                           a DCB to a COMGROUP.
      193       15
      194       16        */
      195       17
      196       18
      197       19        KCO$INIT: PROC(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;

     19  2 000000   000000 700200 xent  KCO$INIT     TSX0  ! X66_AUTO_4
         2 000001   000140 000004                    ZERO    96,4

      198       20        /**/
      199       21
      200       22
      201       23        /**/
      202       24        /* INCLUDES */
      203       25        /**/
      204       26        %INCLUDE AZ_MACRO_C;
      205     2613        %INCLUDE AZ_SUBS_C;
      206     2682        %INCLUDE B_STRINGS_C;
      207     2811        %INCLUDE CP_6;
      208     8370        %INCLUDE CP_6_SUBS;
      209     8910        %INCLUDE EL_SUBS_C;
      210     8994        %MACRO F$DCB#(BASED=BASED);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:93   
      211     8995        %INCLUDE F$DCB;
      212     9044        %MEND;
      213     9045        %INCLUDE F$JIT_C;
      214     9475        %INCLUDE FM$MACROS;
      215     9850        %INCLUDE F_ERRORS_C;
      216    10090        %INCLUDE F_FMTCODE_C;
      217    10124        %INCLUDE F$CP6V_C;
      218    10350        %FPT$OPEN_V (BASED=BASED);
      219    10365        %INCLUDE HF_LOCK_C;
      220    10379        %INCLUDE KC$CGBLK;
      221    10427        %INCLUDE KC$CP6V_C;
      222    10547        %INCLUDE KC_DATA_R;
      223    10560        %INCLUDE KC_ERRORS_C;
      224    10607        %INCLUDE KC_SUBS_C;
      225    10623        %INCLUDE KQM_MAC_C;
      226    10996        %INCLUDE KQ_MAC_C;
      227    13546        %INCLUDE KQ_DATA_R;
      228    14378        %INCLUDE KQ_ERRORS_C;
      229    14426        %INCLUDE KQ_SUBS_C;
      230    14726        %INCLUDE K_DATA_R;
      231    15437        %INCLUDE M_INFO_C;
      232    15577        %INCLUDE NK$LDCT;
      233    15679        %INCLUDE NK_SUBS;
      234    15704        %INCLUDE SS_SCHED_C;
      235    15937        %INCLUDE JG_GHOSTS_C;
      236    16027
      237    16028
      238    16029        /**/
      239    16030        /* BASED STRUCTURES */
      240    16031        /**/
      241    16032        %KQ_BAP (FPTN=KQ$BAP,STCLASS="BASED(DGRAN$)");
      242    16121        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CTX$)");
      243    16860        %KQ_CTLGRAN (FPTN=KQ$CTLGRAN,STCLASS="BASED(CTL$)");
      244    16946        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED(DBLK$)");
      245    16999        %KQ_DGRAN (FPTN=KQ$DGRAN,STCLASS="BASED(DGRAN$)");
      246    17146        %KQ_DSB (FPTN=KQ$DSB,STCLASS=BASED);
      247    17189        %KQ_FP (FPTN=KQ$FP,STCLASS=BASED);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:94   
      248    17262        %KQ_GRAN (FPTN=KQ$GRAN,STCLASS="BASED(DGRAN$)");
      249    17317        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS=BASED);
      250    17587        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS=BASED);
      251    18060        %KQ_RBLK (FPTN=KQ$RBLK,STCLASS=BASED);
      252    18246        %KQ_STA (FPTN=KQ$STA,STCLASS="BASED(STA$)");
      253    18585        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
      254    18623        %KQ_MMSD (FPTN=KQ$MMSD,STCLASS="BASED(KQ_MMSD$)");
      255    18660        %F$DCB# (BASED="BASED(JDCB$)");
      256    18710        %FM$CFU (BASED="BASED(CFU$)");
      257    18716        %FM$CFUN (BASED="BASED(NAME$)");
      258    18719        %FM$CFUA (BASED="BASED(ACCT$)");
      259    18725        %FM$CFUX;
      260    18730        %FM$CFUF (BASED="BASED(CFU$)");
      261    18733        %FM$SET (BASED="BASED(F$CFU$)");
      262    18738        %NK$LDCT (STCLASS="BASED(LDCT$)");
      263    18784        %VLP_SETSTA (FPTN=VLP$SETSTA,STCLASS=BASED);
      264    18812        %VLP_STATION(FPTN=VLP$STATION,STCLASS=BASED);
      265    18839    1   DCL NAMEI CHAR(I) BASED;
      266    18840    1   DCL CHARINDX CHAR(INDX) BASED;
      267    18841    1   DCL CHAR8 CHAR(8) BASED;
      268    18842    1   DCL MOVEI CHAR(I) BASED;
      269    18843    1   DCL UBINHALF UBIN(18) BASED ALIGNED;
      270    18844    1   DCL PG(0:1023) UBIN BASED ALIGNED;
      271    18845    1   DCL PN$(0:0) PTR BASED;
      272    18846
      273    18847
      274    18848        /**/
      275    18849        /* PARAMETERS */
      276    18850        /**/
      277    18851    1   DCL PLDCT$ PTR;
      278    18852    1   DCL PLDCT REDEF PLDCT$ UBIN;
      279    18853        %KC$CGID (STCLASS=);
      280    18879        %B$CGAUCI (STCLASS=);
      281    18901    1   DCL ERROR UBIN;
      282    18902
      283    18903
      284    18904        /**/
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:95   
      285    18905        /* AUTO */
      286    18906        /**/
      287    18907    1   DCL JDCB$ PTR;
      288    18908    1   DCL TIMCHK BIT(72) DALIGNED;
      289    18909    1   DCL CFU$ PTR;
      290    18910    1   DCL CTX$ PTR;
      291    18911    1   DCL 1 CTX REDEF CTX$,
      292    18912    1         2 DISP UBIN(24) UNAL,
      293    18913    1         2 SID UBIN(12) UNAL;
      294    18914    1   DCL STR6 CHAR(6);
      295    18915    1   DCL LDCT$ PTR;
      296    18916    1   DCL STA$ PTR;
      297    18917    1   DCL ENTFLG SBIN;
      298    18918    1   DCL I SBIN;
      299    18919    1   DCL KEY CHAR(8);
      300    18920    1   DCL NAME$ PTR;
      301    18921    1   DCL ACCT$ PTR;
      302    18922    1   DCL TRMFLG UBIN;
      303    18923    1   DCL WAFLG REDEF TRMFLG UBIN;
      304    18924    1   DCL INDX UBIN;
      305    18925    1   DCL INDXR$ REDEF INDX PTR;
      306    18926    1   DCL DBLK$ PTR;
      307    18927    1   DCL CTL$ PTR;
      308    18928    1   DCL OPNTYP UBIN;
      309    18929    1   DCL DGRAN$ PTR;
      310    18930    1   DCL 1 DGRAN REDEF DGRAN$,
      311    18931    1         2 DISP UBIN(18) UNAL,
      312    18932    1         2 * BIT(8),
      313    18933    1         2 DESC UBIN(10) UNAL;
      314    18934    1   DCL 1 CNNCT ALIGNED,
      315    18935    1         2 DDA UBIN,
      316    18936    1         2 MBLK$ PTR,
      317    18937    1         2 MBLK$R REDEF MBLK$ UBIN;
      318    18938    1   DCL TRYCNT UBIN;
      319    18939    1   DCL DESC# UBIN;
      320    18940    1   DCL PG# UBIN;
      321    18941        %B$CGAUCI (FPTN=B$CGAUCIDCB,STCLASS=);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:96   
      322    18963        %COMGRP (STCLASS=);
      323    19074    1   DCL SCRATCH$ PTR;
      324    19075
      325    19076
      326    19077        /**/
      327    19078        /* EXTERNAL DATA */
      328    19079        /**/
      329    19080    1   DCL S_PNO UBIN WORD SYMREF;
      330    19081    1   DCL KQ_MMSD$ PTR SYMREF READONLY;
      331    19082    1   DCL B$M$UC$ PTR SYMREF READONLY;
      332    19083    1   DCL B$JIT$ PTR SYMREF;
      333    19084    1   DCL FM_FRZERO UBIN SYMREF;
      334    19085    1   DCL FM_WSQ UBIN SYMREF;
      335    19086    1   DCL F$CFU$ PTR SYMREF READONLY;
      336    19087    1   DCL FM$BUF$(0:0) PTR SYMREF;
      337    19088        %KQ_CG (FPTN=KQ_ICG,STCLASS=SYMREF);
      338    19827        %KQ_DGRAN (FPTN=KQ_IDGRAN,STCLASS=SYMREF);
      339    19974    1   DCL S_CUN UBIN SYMREF;
      340    19975        %VLP_SETSTA (FPTN=KC_VLPSETSTA,STCLASS=SYMREF);
      341    20003        %VLP_STATION (FPTN=KC_VLPSTATION,STCLASS=SYMREF);
      342    20030
      343    20031
      344    20032        /**/
      345    20033        /* EXTERNAL ROUTINES */
      346    20034        /**/
      347    20035    1   DCL SC_CGREOPEN   ENTRY CONV(2,0);
      348    20036    1   DCL ELA$SYSLOG    ENTRY(6) ALTRET;
      349    20037    1   DCL FAG$GEXT      ENTRY    ALTRET;
      350    20038    1   DCL FGH$UPDBUCKET ENTRY(4);
      351    20039    1   DCL FMD$FLSHBUF   ENTRY(1);
      352    20040    1   DCL FMD$GBUF      ENTRY(1);
      353    20041    1   DCL FMD$GETBUF    ENTRY(3);
      354    20042    1   DCL FMD$RBUF      ENTRY(1);
      355    20043    1   DCL FMD$REDBUF    ENTRY(6) ALTRET;
      356    20044    1   DCL FMD$REDBUFBC  ENTRY(6) ALTRET;
      357    20045    1   DCL FMD$RELBUF    ENTRY(1);
      358    20046    1   DCL FMD$WRTBUF    ENTRY(1);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:97   
      359    20047    1   DCL FMN$OPNF      ENTRY(1) ALTRET;
      360    20048    1   DCL FSA$GSP       ENTRY(2) ALTRET;
      361    20049    1   DCL HFF$DSIZ      ENTRY(2);
      362    20050    1   DCL KCA$TELLAUM   ENTRY(3) ALTRET;
      363    20051    1   DCL KCA$TELLAUR   ENTRY(3) ALTRET;
      364    20052    1   DCL KCC$RECOVER   ENTRY(1);
      365    20053    1   DCL KCI$VALSTA1   ENTRY(2) ALTRET;
      366    20054    1   DCL KCO$CLCGERR   ENTRY;
      367    20055    1   DCL KCO$RCNNCT    ENTRY(1);
      368    20056    1   DCL KCO$TRMGONE   ENTRY(1);
      369    20057    1   DCL KQB$INSERTNL  ENTRY(3) ALTRET;
      370    20058    1   DCL KQB$SRCH      ENTRY(3) ALTRET;
      371    20059    1   DCL KQC$ACTSTA    ENTRY(2) ALTRET;
      372    20060    1   DCL KQC$CXTSET    ENTRY(1) ALTRET;
      373    20061    1   DCL KQC$CXTSET1   ENTRY(1) ALTRET;
      374    20062    1   DCL KQM$RECON     ENTRY(3) ALTRET;
      375    20063    1   DCL KQC$TRMCK     ENTRY(1) ALTRET;
      376    20064    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
      377    20065    1   DCL KQD$GETR      ENTRY(3) ALTRET;
      378    20066    1   DCL KQD$RECOVER   ENTRY(1) ALTRET;
      379    20067    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      380    20068    1   DCL KQL$DELMLH    ENTRY(2) ALTRET;
      381    20069    1   DCL KQM$GETB      ENTRY(3) ALTRET;
      382    20070    1   DCL KQM$GETBK     ENTRY(3) ALTRET;
      383    20071    1   DCL KQM$GETMBLK   ENTRY(3) ALTRET;
      384    20072    1   DCL KQM$GETP      ENTRY(3) ALTRET;
      385    20073    1   DCL KQM$RELB      ENTRY(3) ALTRET;
      386    20074    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      387    20075    1   DCL KQM$INIT      ENTRY(2) ALTRET;
      388    20076    1   DCL KQM$SHUTDOWN  ENTRY(1) ALTRET;
      389    20077    1   DCL KQP$DISC      ENTRY(1) ALTRET;
      390    20078    1   DCL KQP$RECOVER   ENTRY(1) ALTRET;
      391    20079    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      392    20080    1   DCL KQQ$RECOVER   ENTRY(1) ALTRET;
      393    20081    1   DCL KQQ$RECOVER2  ENTRY(1) ALTRET;
      394    20082    1   DCL KQR$RECOVER   ENTRY(1) ALTRET;
      395    20083    1   DCL KQS$RECOVER   ENTRY(1) ALTRET;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:98   
      396    20084    1   DCL KQS$RECOVER2  ENTRY(1) ALTRET;
      397    20085    1   DCL KQT$DELSTA    ENTRY(2) ALTRET;
      398    20086    1   DCL KQT$GETSTA    ENTRY(3) ALTRET;
      399    20087    1   DCL KQT$MAKESTA   ENTRY(3) ALTRET;
      400    20088    1   DCL KQT$RECOVER   ENTRY(1) ALTRET;
      401    20089    1   DCL KQX$CHKTIME   ENTRY(1) ALTRET;
      402    20090    1   DCL KQX$LDASR     ENTRY(1);
      403    20091    1   DCL KQX$SETTIME   ENTRY(1);
      404    20092    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      405    20093    1   DCL MMJ$MAPIOP    ENTRY(2);
      406    20094    1   DCL MMJ$UNMAPIOP  ENTRY(1);
      407    20095    1   DCL NKL$GETDCT    ENTRY(1) ALTRET;
      408    20096    1   DCL NKL$RELDCT    ENTRY(1) ALTRET;
      409    20097    1   DCL SSR$REG       ENTRY(3) ALTRET;
      410    20098    1   DCL SSS$BLOCK     ENTRY;
      411    20099    1   DCL SSS$SYSTIME   ENTRY(1);
      412    20100    1   DCL UQB$MDEQ      ENTRY(1) ALTRET;
      413    20101
      414    20102
      415    20103        /**/
      416    20104        /* CONSTANT */
      417    20105        /**/
      418    20106        %B$CGAUCI (STCLASS=CONSTANT,FPTN=B_CGAUCI,INFOSZ=0);
      419    20128        %KQ_CTLGRAN (STCLASS=CONSTANT);
      420    20214        %KQ_THDR    (STCLASS=CONSTANT);
      421    20252    1   DCL ZEROS BIT(72) CONSTANT INIT('0'B);
      422    20253    1   DCL CHARZEROS REDEF ZEROS CHAR(8);
      423    20254        /**/
      424    20255        %SUB FCG#='1303'O;
      425    20256        %SUB MID#='17'O;
      426    20257        %ERRCODE (NAME=ERRDMY     ,COD#=0);
      427    20261        %ERRCODE (NAME=ERRTWOAU   ,COD#=%E$TWOAU);
      428    20265        %ERRCODE (NAME=ERRNOCGLDCT,COD#=%E$NOCGLDCT);
      429    20269        %ERRCODE (NAME=ERRDUPNM   ,COD#=%E$DUPNM);
      430    20273        %ERRCODE (NAME=ERRFILECG  ,COD#=%E$FILECG);
      431    20277        %ERRCODE (NAME=ERRCGCXT   ,COD#=%E$CGCXT);
      432    20281        %ERRCODE (NAME=ERRUNIMP   ,COD#=%E$UNIMP);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:99   
      433    20285        %ERRCODE (NAME=ERRSTABAD  ,COD#=%E$STABAD);
      434    20289        %ERRCODE (NAME=ERRSTAILLGL,COD#=%E$STAILLGL);
      435    20293        %ERRCODE (NAME=ERRNDCBCG  ,COD#=%E$NDCBCG);
      436    20297        %ERRCODE (NAME=ERRRCVRBAD ,COD#=%E$RCVRBAD);
      437    20301        %ERRCODE (NAME=ERRCGCTLBAD,COD#=%E$CGCTLBAD);
      438    20305        %ERRCODE (NAME=ERRCGGRANS ,COD#=%E$CGGRANS);
      439    20309        %ERRCODE (NAME=ERRCGNOCLS ,COD#=%E$CGNOCLS);
      440    20313        %ERRCODE (NAME=ERRCGCROP  ,COD#=%E$CGCROP);
      441    20317        %ERRCODE (NAME=ERRNCGAU   ,COD#=%E$NCGAU);
      442    20321        %ERRCODE (NAME=ERRPRIVSTA ,COD#=%E$PRIVSTA);
      443    20325        %ERRCODE (NAME=ERRCGSTAR  ,COD#=%E$CGSTAR);
      444    20329        %ERRCODE (NAME=ERROLDCG   ,COD#=%E$OLDCG);
      445    20333        %ERRCODE (NAME=ERRCGORAU  ,COD#=%E$CGORAU);
      446    20337        %ERRCODE (NAME=ERRNOSTA   ,COD#=%E$NOSTA);
      447    20341
      448    20342
      449    20343        /**/
      450    20344        /* EQUS */
      451    20345        /**/
      452    20346        %EQU_CG;
      453    20394        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:100  
      454    20395
      455    20396
      456    20397        /*D* NAME:         KCO$INIT
      457    20398
      458    20399             CALL:         CALL KCO$INIT ALTRET;
      459    20400
      460    20401             DESCRIPTION:  Called from FMN$OPNF at the end of the open
      461    20402                           process to perform the specific COMGROUP
      462    20403                           functions.
      463    20404
      464    20405                           It is assumed that an ENQ is in effect that
      465    20406                           prevents other users from opening or closing
      466    20407                           DCBs while code in this routine is being
      467    20408                           executed.  Note that there is no such lock
      468    20409                           for terminal connects.
      469    20410
      470    20411        */
      471    20412
      472    20413
      473    20414    1         CTX$=ADDR(NIL);

  20414  2 000002   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000003   200013 756100                    STQ     CTX$,,AUTO

      474    20415    1         LDCT$=ADDR(NIL);

  20415  2 000004   200016 756100                    STQ     LDCT$,,AUTO

      475    20416    1         STA$=ADDR(NIL);

  20416  2 000005   200017 756100                    STQ     STA$,,AUTO

      476    20417    1         JDCB$=B$JIT.DCB$;

  20417  2 000006   000000 470400 xsym               LDP0    B$JIT$
         2 000007   000232 236100                    LDQ     154,,PR0
         2 000010   200007 756100                    STQ     JDCB$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:101  

      477    20418    1         CFU$=F$DCB.CFU$;

  20418  2 000011   200007 471500                    LDP1    JDCB$,,AUTO
         2 000012   100066 236100                    LDQ     54,,PR1
         2 000013   200012 756100                    STQ     CFU$,,AUTO

      478    20419    1         F$DCB.LDCTX=0;

  20419  2 000014   000000 220003                    LDX0    0,DU
         2 000015   100051 740100                    STX0    41,,PR1

      479    20420    1         OPNTYP=0;

  20420  2 000016   200032 450100                    STZ     OPNTYP,,AUTO

      480    20421    1         ENTFLG=0;

  20421  2 000017   200020 450100                    STZ     ENTFLG,,AUTO

      481    20422    1         CALL FMD$FLSHBUF(2);

  20422  2 000020   000000 630400 3                  EPPR0   0
         2 000021   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000022   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000023   000000 011000                    NOP     0

      482    20423        /**/
      483    20424    1         IF F$DCB.ORG~=%CG# THEN

  20424  2 000024   200007 470500                    LDP0    JDCB$,,AUTO
         2 000025   000032 236100                    LDQ     26,,PR0
         2 000026   777000 376003                    ANQ     -512,DU
         2 000027   013000 116003                    CMPQ    5632,DU
         2 000030   000035 600000 2                  TZE     s:20435

      484    20425    2           DO;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:102  

      485    20426    2           B$JIT.ERR=ERRFILECG; /* Not comgroup file */

  20426  2 000031   000060 236000 1                  LDQ     ERRFILECG
         2 000032   000000 471400 xsym               LDP1    B$JIT$
         2 000033   100012 756100                    STQ     10,,PR1

      486    20427    2           ALTRETURN;

  20427  2 000034   000000 702200 xent               TSX2  ! X66_AALT

      487    20428    2           END;
      488    20429        /*E*  ERROR:  KCO-E$FILECG-2
      489    20430              MESSAGE: File% %FN% is not a comgroup
      490    20431              MESSAGE1: You have attempted to open a non-comgroup file as
      491    20432                        a comgroup
      492    20433        */
      493    20434        /**/
      494    20435    1         IF F$DCB.AU AND NOT F$DCB.FFLG.AU THEN

  20435  2 000035   000031 236100                    LDQ     25,,PR0
         2 000036   200000 316003                    CANQ    65536,DU
         2 000037   000047 600000 2                  TZE     s:20444
         2 000040   000004 236100                    LDQ     4,,PR0
         2 000041   000400 316003                    CANQ    256,DU
         2 000042   000047 601000 2                  TNZ     s:20444

      495    20436    2           DO;

      496    20437    2           B$JIT.ERR=ERRNCGAU;

  20437  2 000043   000073 236000 1                  LDQ     ERRNCGAU
         2 000044   000000 471400 xsym               LDP1    B$JIT$
         2 000045   100012 756100                    STQ     10,,PR1

      497    20438    2           ALTRETURN;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:103  
  20438  2 000046   000000 702200 xent               TSX2  ! X66_AALT

      498    20439    2           END;
      499    20440        /*E*  ERROR: KCO-E$NCGAU-2
      500    20441              MESSAGE: You are not allowed to be the administrative user for comgroup %UF
      501    20442        */
      502    20443        /**/
      503    20444    1         B$CGAUCIDCB=B_CGAUCI;

  20444  2 000047   000100 100400                    MLR     fill='000'O
         2 000050   000000 000044 1                  ADSC9   B_CGAUCI                 cn=0,n=36
         2 000051   200041 000044                    ADSC9   B$CGAUCIDCB,,AUTO        cn=0,n=36

      504    20445    1         B$CGAUCIDCB.WHO.ACCT=B$JIT.ACCN;

  20445  2 000052   000000 471400 xsym               LDP1    B$JIT$
         2 000053   040100 100500                    MLR     fill='040'O
         2 000054   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         2 000055   200044 000010                    ADSC9   B$CGAUCIDCB+3,,AUTO      cn=0,n=8

      505    20446    1         B$CGAUCIDCB.WHO.NAME=B$JIT.UNAME;

  20446  2 000056   040100 100500                    MLR     fill='040'O
         2 000057   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
         2 000060   200046 000014                    ADSC9   B$CGAUCIDCB+5,,AUTO      cn=0,n=12

      506    20447    1         B$CGAUCIDCB.SYSID   =B$JIT.SYSID;

  20447  2 000061   100000 236100                    LDQ     0,,PR1
         2 000062   000011 736000                    QLS     9
         2 000063   200051 552130                    STBQ    B$CGAUCIDCB+8,'30'O,AUTO

      507    20448    1         B$CGAUCIDCB.FLG.INPUT='1'B;

  20448  2 000064   400000 236003                    LDQ     -131072,DU
         2 000065   200051 256100                    ORSQ    B$CGAUCIDCB+8,,AUTO

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:104  
      508    20449    1         B$CGAUCIDCB.FLG.OUTPUT='1'B;

  20449  2 000066   200000 236003                    LDQ     65536,DU
         2 000067   200051 256100                    ORSQ    B$CGAUCIDCB+8,,AUTO

      509    20450    1         CNNCT='0'B;

  20450  2 000070   000000 235003                    LDA     0,DU
         2 000071   000000 236003                    LDQ     0,DU
         2 000072   200034 757100                    STAQ    CNNCT,,AUTO

      510    20451        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:105  
      511    20452
      512    20453    1         IF F$DCB.FUN = %CREATE# AND NOT F$DCB.FEXT THEN

  20453  2 000073   000032 236100                    LDQ     26,,PR0
         2 000074   000777 376003                    ANQ     511,DU
         2 000075   000003 116003                    CMPQ    3,DU
         2 000076   000453 601000 2                  TNZ     s:20543
         2 000077   000064 234100                    SZN     52,,PR0
         2 000100   000453 604000 2                  TMI     s:20543

      513    20454    2           DO;               /* Creating new file */

      514    20455                   /******************************************************
      515    20456                    *                                                    *
      516    20457                    *            CREATE   NEW    COMGROUP                *
      517    20458                    *                                                    *
      518    20459                    ******************************************************/
      519    20460
      520    20461    2           OPNTYP=%CREATE#;

  20461  2 000101   000003 235007                    LDA     3,DL
         2 000102   200032 755100                    STA     OPNTYP,,AUTO

      521    20462    2           IF FM$CFU.ACCTX=0 OR FM$CFU.STARX.F~=0 THEN

  20462  2 000103   200012 473500                    LDP3    CFU$,,AUTO
         2 000104   300002 220100                    LDX0    2,,PR3
         2 000105   000111 600000 2                  TZE     s:20464
         2 000106   300002 236100                    LDQ     2,,PR3
         2 000107   400000 316003                    CANQ    -131072,DU
         2 000110   000114 600000 2                  TZE     s:20470

      522    20463    3             DO;

      523    20464    3             B$JIT.ERR=ERRCGSTAR;

  20464  2 000111   000075 236000 1                  LDQ     ERRCGSTAR
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:106  
         2 000112   100012 756100                    STQ     10,,PR1

      524    20465    3             ALTRETURN;

  20465  2 000113   000000 702200 xent               TSX2  ! X66_AALT

      525    20466    3             END;
      526    20467        /*E*    ERROR: KCO-E$CGSTAR-2
      527    20468                MESSAGE: COMGROUPs may not be star or scratch files
      528    20469        */
      529    20470    2           CALL KQM$INIT(KQ_ICG,SCRATCH$) ALTRET(ERR);

  20470  2 000114   200116 634500                    EPPR4   SCRATCH$,,AUTO
         2 000115   200131 454500                    STP4    DA+2,,AUTO
         2 000116   000001 236000 3                  LDQ     1
         2 000117   200130 756100                    STQ     DA+1,,AUTO
         2 000120   200130 630500                    EPPR0   DA+1,,AUTO
         2 000121   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000122   000000 701000 xent               TSX1    KQM$INIT
         2 000123   003052 702000 2                  TSX2    ERR

      530    20471    2           CTX$=SCRATCH$;

  20471  2 000124   200116 236100                    LDQ     SCRATCH$,,AUTO
         2 000125   200013 756100                    STQ     CTX$,,AUTO

      531    20472    2           KQ$CG.STATS.NUMDCBS=1; /* Count this user */

  20472  2 000126   000001 235007                    LDA     1,DL
         2 000127   200013 470500                    LDP0    CTX$,,AUTO
         2 000130   000173 755100                    STA     123,,PR0

      532    20473    2           KQ$CG.CFU$=CFU$;

  20473  2 000131   200012 236100                    LDQ     CFU$,,AUTO
         2 000132   000214 756100                    STQ     140,,PR0

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:107  
      533    20474    2           KQ$CG.SETX=F$DCB.SETX;

  20474  2 000133   200007 471500                    LDP1    JDCB$,,AUTO
         2 000134   100051 720100                    LXL0    41,,PR1
         2 000135   000216 740100                    STX0    142,,PR0

      534    20475    2           KQ$CG.XTX$=PINCRW(F$CFU$,FM$CFU.XTX);

  20475  2 000136   200012 473500                    LDP3    CFU$,,AUTO
         2 000137   300003 221100                    LDX1    3,,PR3
         2 000140   000000 636011                    EAQ     0,X1
         2 000141   000000 036000 xsym               ADLQ    F$CFU$
         2 000142   000215 756100                    STQ     141,,PR0

      535    20476    2           KQ$CG.GRAN.ORG=F$DCB.ORG;

  20476  2 000143   100032 236100                    LDQ     26,,PR1
         2 000144   000021 772000                    QRL     17
         2 000145   000254 676100                    ERQ     172,,PR0
         2 000146   036000 376007                    ANQ     15360,DL
         2 000147   000254 656100                    ERSQ    172,,PR0

      536    20477    2           KQ$CG.GRAN.STAMP.HASH=F$DCB.HASH;

  20477  2 000150   100073 236100                    LDQ     59,,PR1
         2 000151   000253 552170                    STBQ    171,'70'O,PR0

      537    20478    2           FM$CFU.GDA=CTX.SID; /* Put CTX$ in CFU */

  20478  2 000152   200013 236100                    LDQ     CTX$,,AUTO
         2 000153   007777 376007                    ANQ     4095,DL
         2 000154   300005 552134                    STBQ    5,'34'O,PR3

      538    20479    2           FM$CFU.LDA=CTX.DISP;

  20479  2 000155   003100 061500                    CSR     bolr='003'O
         2 000156   200013 000030                    BDSC    CTX$,,AUTO               by=0,bit=0,n=24
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:108  
         2 000157   300006 400033                    BDSC    6,,PR3                   by=2,bit=0,n=27

      539    20480    2           KQ$CG.NGAVAL=FM$CFU.UGRANS-1;

  20480  2 000160   300004 236100                    LDQ     4,,PR3
         2 000161   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000162   000001 136007                    SBLQ    1,DL
         2 000163   000217 756100                    STQ     143,,PR0

      540    20481    2           KQ$CG.UGRANS=1;

  20481  2 000164   000220 755100                    STA     144,,PR0

      541    20482    2           KQ$CG.HIGRANS=1;

  20482  2 000165   000222 755100                    STA     146,,PR0

      542    20483    2           KQ$CG.QISS=F$DCB.QISS;

  20483  2 000166   200007 471500                    LDP1    JDCB$,,AUTO
         2 000167   100031 236100                    LDQ     25,,PR1
         2 000170   000002 736000                    QLS     2
         2 000171   400000 376003                    ANQ     -131072,DU
         2 000172   000106 756100                    STQ     70,,PR0

      543    20484    2           CALL FMD$GETBUF(0,1,CTL$);

  20484  2 000173   200031 634500                    EPPR4   CTL$,,AUTO
         2 000174   200132 454500                    STP4    DA+3,,AUTO
         2 000175   000002 237000 3                  LDAQ    2
         2 000176   200130 757100                    STAQ    DA+1,,AUTO
         2 000177   200130 630500                    EPPR0   DA+1,,AUTO
         2 000200   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000201   000000 701000 xent               TSX1    FMD$GETBUF
         2 000202   000000 011000                    NOP     0

      544    20485    2           CTL$->PG='0'B;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:109  

  20485  2 000203   200031 470500                    LDP0    CTL$,,AUTO
         2 000204   010000 220003                    LDX0    4096,DU
         2 000205   000140 100400                    MLR     fill='000'O
         2 000206   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000207   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0

      545    20486    2           KQ$CTLGRAN=KQ_CTLGRAN;

  20486  2 000210   200031 470500                    LDP0    CTL$,,AUTO
         2 000211   000100 100400                    MLR     fill='000'O
         2 000212   000012 000144 1                  ADSC9   KQ_CTLGRAN               cn=0,n=100
         2 000213   000000 000144                    ADSC9   0,,PR0                   cn=0,n=100

      546    20487    2           KQ$CTLGRAN.HDR.STAMP.HASH=F$DCB.HASH;

  20487  2 000214   200007 470500                    LDP0    JDCB$,,AUTO
         2 000215   200031 471500                    LDP1    CTL$,,AUTO
         2 000216   000073 236100                    LDQ     59,,PR0
         2 000217   100000 552170                    STBQ    0,'70'O,PR1

      547    20488    2           KQ$CTLGRAN.HDR.PTYP=%KQ_PTYP_CTL;

  20488  2 000220   200031 470500                    LDP0    CTL$,,AUTO
         2 000221   000001 236100                    LDQ     1,,PR0
         2 000222   000004 376000 3                  ANQ     4
         2 000223   000003 276003                    ORQ     3,DU
         2 000224   000001 756100                    STQ     1,,PR0

      548    20489    2           KQ$CTLGRAN.HDR.GTYP=%KQ_PTYP_CTL;

  20489  2 000225   200031 470500                    LDP0    CTL$,,AUTO
         2 000226   000001 236100                    LDQ     1,,PR0
         2 000227   000005 376000 3                  ANQ     5
         2 000230   140000 276007                    ORQ     49152,DL
         2 000231   000001 756100                    STQ     1,,PR0

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:110  
      549    20490    2           KQ$CTLGRAN.HDR.ORG=F$DCB.ORG;

  20490  2 000232   200007 470500                    LDP0    JDCB$,,AUTO
         2 000233   200031 471500                    LDP1    CTL$,,AUTO
         2 000234   000032 236100                    LDQ     26,,PR0
         2 000235   000021 772000                    QRL     17
         2 000236   100001 676100                    ERQ     1,,PR1
         2 000237   036000 376007                    ANQ     15360,DL
         2 000240   100001 656100                    ERSQ    1,,PR1

      550    20491    2           KQ$CTLGRAN.HDR.AVAIL=1024-SIZEW(KQ$CTLGRAN);

  20491  2 000241   200031 470500                    LDP0    CTL$,,AUTO
         2 000242   000001 236100                    LDQ     1,,PR0
         2 000243   000006 376000 3                  ANQ     6
         2 000244   001746 276007                    ORQ     998,DL
         2 000245   000001 756100                    STQ     1,,PR0

      551    20492    2           DBLK$=PINCRW(CTL$,SIZEW(KQ$CTLGRAN));

  20492  2 000246   200031 236100                    LDQ     CTL$,,AUTO
         2 000247   000032 036003                    ADLQ    26,DU
         2 000250   200030 756100                    STQ     DBLK$,,AUTO

      552    20493    2           DBLK$->KQ$CG=KQ$CG;

  20493  2 000251   200013 470500                    LDP0    CTX$,,AUTO
         2 000252   200030 471500                    LDP1    DBLK$,,AUTO
         2 000253   000100 100500                    MLR     fill='000'O
         2 000254   000000 001324                    ADSC9   0,,PR0                   cn=0,n=724
         2 000255   100000 001324                    ADSC9   0,,PR1                   cn=0,n=724

      553    20494    2           KQ$CTLGRAN.CTXX=POFFW(DBLK$,CTL$);

  20494  2 000256   200031 235100                    LDA     CTL$,,AUTO
         2 000257   000022 771000                    ARL     18
         2 000260   200130 755100                    STA     DA+1,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:111  
         2 000261   200030 236100                    LDQ     DBLK$,,AUTO
         2 000262   000022 772000                    QRL     18
         2 000263   200130 136100                    SBLQ    DA+1,,AUTO
         2 000264   200031 471500                    LDP1    CTL$,,AUTO
         2 000265   100004 756100                    STQ     4,,PR1

      554    20495    2           KQ$CTLGRAN.CTXSIZ=SIZEW(KQ$CG)+50;

  20495  2 000266   000350 235007                    LDA     232,DL
         2 000267   200031 471500                    LDP1    CTL$,,AUTO
         2 000270   100005 755100                    STA     5,,PR1

      555    20496    2           KQ$CTLGRAN.HDR.AVAIL=KQ$CTLGRAN.HDR.AVAIL-KQ$CTLGRAN.CTXSIZ;

  20496  2 000271   200031 471500                    LDP1    CTL$,,AUTO
         2 000272   100001 236100                    LDQ     1,,PR1
         2 000273   001777 376007                    ANQ     1023,DL
         2 000274   100005 136100                    SBLQ    5,,PR1
         2 000275   100001 676100                    ERQ     1,,PR1
         2 000276   001777 376007                    ANQ     1023,DL
         2 000277   100001 656100                    ERSQ    1,,PR1

      556    20497    2           F$DCB.BFR.DA(0)=FM_FRZERO;

  20497  2 000300   200007 471500                    LDP1    JDCB$,,AUTO
         2 000301   000000 236000 xsym               LDQ     FM_FRZERO
         2 000302   100115 552134                    STBQ    77,'34'O,PR1

      557    20498    2           CALL FMD$WRTBUF(0);

  20498  2 000303   000002 630400 3                  EPPR0   2
         2 000304   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000305   000000 701000 xent               TSX1    FMD$WRTBUF
         2 000306   000000 011000                    NOP     0

      558    20499    2           SCRATCH$=CTX$;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:112  
  20499  2 000307   200013 236100                    LDQ     CTX$,,AUTO
         2 000310   200116 756100                    STQ     SCRATCH$,,AUTO

      559    20500    2           CALL KQC$CXTSET (SCRATCH$);

  20500  2 000311   200116 630500                    EPPR0   SCRATCH$,,AUTO
         2 000312   200130 450500                    STP0    DA+1,,AUTO
         2 000313   200130 630500                    EPPR0   DA+1,,AUTO
         2 000314   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000315   000000 701000 xent               TSX1    KQC$CXTSET
         2 000316   000000 011000                    NOP     0

      560    20501    2           CALL SSS$SYSTIME(KQ$CG.PGTIME);

  20501  2 000317   200013 236100                    LDQ     CTX$,,AUTO
         2 000320   000115 036003                    ADLQ    77,DU
         2 000321   200130 756100                    STQ     DA+1,,AUTO
         2 000322   200130 630500                    EPPR0   DA+1,,AUTO
         2 000323   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000324   000000 701000 xent               TSX1    SSS$SYSTIME
         2 000325   000000 011000                    NOP     0

      561    20502    2           KQ$CG.CLOCK='1'B;

  20502  2 000326   200013 470500                    LDP0    CTX$,,AUTO
         2 000327   000004 236007                    LDQ     4,DL
         2 000330   000105 256100                    ORSQ    69,,PR0

      562    20503    2           IF KQ$CG.NGAVAL<KQ$CG.AUCTL.MAXPG THEN

  20503  2 000331   000133 236100                    LDQ     91,,PR0
         2 000332   000022 772000                    QRL     18
         2 000333   000217 116100                    CMPQ    143,,PR0
         2 000334   000342 602000 2                  TNC     ENDSETUP
         2 000335   000342 600000 2                  TZE     ENDSETUP

      563    20504    3             DO;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:113  

      564    20505    3             B$JIT.ERR=ERRCGGRANS;

  20505  2 000336   000070 236000 1                  LDQ     ERRCGGRANS
         2 000337   000000 471400 xsym               LDP1    B$JIT$
         2 000340   100012 756100                    STQ     10,,PR1

      565    20506    3             GOTO ERR;

  20506  2 000341   003052 710000 2                  TRA     ERR

  20503  2 000342                       ENDSETUP     null
      566    20507    3             END;
      567    20508        /*E*    ERROR: KCO-E$CGGRANS-2
      568    20509                MESSAGE: IXTNSIZE for comgroup% %UF% is not large enough
      569    20510                MESSAGE1: IXTNSIZE for a comgroup must be at least as large
      570    20511                          as MAXPG+1
      571    20512        */
      572    20513        /**/
      573    20514    2   ENDSETUP: ;
      574    20515                %LOCK (G=KQ$CG.DTREE.GATE);

  20516  2 000342   200013 236100                    LDQ     CTX$,,AUTO
         2 000343   000231 036003                    ADLQ    153,DU
         2 000344   200130 756100                    STQ     DA+1,,AUTO
         2 000345   200130 630500                    EPPR0   DA+1,,AUTO
         2 000346   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000347   000000 701000 xent               TSX1    HFC$LOCK
         2 000350   000000 011000                    NOP     0

      575    20518    3             DO WHILE(KQ$CG.CURDATAPGS<KQ$CG.MINDATAPGS);

  20518  2 000351   200013 470500                    LDP0    CTX$,,AUTO
         2 000352   000241 720100                    LXL0    161,,PR0
         2 000353   000242 100100                    CMPX0   162,,PR0
         2 000354   000427 603000 2                  TRC     s:20534

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:114  
      576    20519    3             CALL KQM$GETP(KQ$CG,DGRAN$,I) ALTRET(MEMERRUD);

  20519  2 000355   200021 630500                    EPPR0   I,,AUTO
         2 000356   200132 450500                    STP0    DA+3,,AUTO
         2 000357   200033 631500                    EPPR1   DGRAN$,,AUTO
         2 000360   200131 451500                    STP1    DA+2,,AUTO
         2 000361   200013 236100                    LDQ     CTX$,,AUTO
         2 000362   200130 756100                    STQ     DA+1,,AUTO
         2 000363   200130 630500                    EPPR0   DA+1,,AUTO
         2 000364   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000365   000000 701000 xent               TSX1    KQM$GETP
         2 000366   003005 702000 2                  TSX2    MEMERRUD

      577    20520    3             KQ$DGRAN=KQ_IDGRAN;

  20520  2 000367   200033 470500                    LDP0    DGRAN$,,AUTO
         2 000370   000100 100400                    MLR     fill='000'O
         2 000371   000000 000200 xsym               ADSC9   KQ_IDGRAN                cn=0,n=128
         2 000372   000000 000200                    ADSC9   0,,PR0                   cn=0,n=128

      578    20521    3             KQ$GRAN=KQ$CG.GRAN;

  20521  2 000373   200013 470500                    LDP0    CTX$,,AUTO
         2 000374   200033 471500                    LDP1    DGRAN$,,AUTO
         2 000375   000100 100500                    MLR     fill='000'O
         2 000376   000253 000020                    ADSC9   171,,PR0                 cn=0,n=16
         2 000377   100000 000020                    ADSC9   0,,PR1                   cn=0,n=16

      579    20522    3             KQ$DGRAN.HDR.PTYP=%KQ_PTYP_DATA;

  20522  2 000400   200033 471500                    LDP1    DGRAN$,,AUTO
         2 000401   100001 236100                    LDQ     1,,PR1
         2 000402   000004 376000 3                  ANQ     4
         2 000403   000001 276003                    ORQ     1,DU
         2 000404   100001 756100                    STQ     1,,PR1

      580    20523    3             KQ$DGRAN.HDR.GTYP=%KQ_PTYP_DATA;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:115  

  20523  2 000405   200033 471500                    LDP1    DGRAN$,,AUTO
         2 000406   100001 236100                    LDQ     1,,PR1
         2 000407   000005 376000 3                  ANQ     5
         2 000410   040000 276007                    ORQ     16384,DL
         2 000411   100001 756100                    STQ     1,,PR1

      581    20524    3             KQ$DGRAN.HDR.SELF$=DGRAN$;

  20524  2 000412   200033 236100                    LDQ     DGRAN$,,AUTO
         2 000413   200033 471500                    LDP1    DGRAN$,,AUTO
         2 000414   100002 756100                    STQ     2,,PR1

      582    20525    3             KQ$DGRAN.FLINK$=KQ$CG.DATAFREE$;

  20525  2 000415   000243 236100                    LDQ     163,,PR0
         2 000416   200033 471500                    LDP1    DGRAN$,,AUTO
         2 000417   100017 756100                    STQ     15,,PR1

      583    20526    3             KQ$CG.DATAFREE$=DGRAN$;

  20526  2 000420   200033 236100                    LDQ     DGRAN$,,AUTO
         2 000421   000243 756100                    STQ     163,,PR0

      584    20527    3             KQ$CG.CURDATAPGS=KQ$CG.CURDATAPGS+1;

  20527  2 000422   000241 720100                    LXL0    161,,PR0
         2 000423   000001 621010                    EAX1    1,X0
         2 000424   000241 441100                    SXL1    161,,PR0

      585    20528    3             END;

  20528  2 000425   000242 101100                    CMPX1   162,,PR0
         2 000426   000355 602000 2                  TNC     s:20519

      586    20529        /*N*
      587    20530                KQ$CG.AUCTL.DCBCONLGL = ADDR(PLDCT$)->PN$(0)->FPT$OPEN_V.DCBCONLGL ;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:116  
      588    20531                KQ$CG.AUCTL.TERMCONLGL = ADDR(PLDCT$)->PN$(0)->FPT$OPEN_V.TERMCONLGL ;
      589    20532         */
      590    20533                %UNLOCK (G=KQ$CG.DTREE.GATE);

  20534  2 000427   200013 236100                    LDQ     CTX$,,AUTO
         2 000430   000231 036003                    ADLQ    153,DU
         2 000431   200130 756100                    STQ     DA+1,,AUTO
         2 000432   200130 630500                    EPPR0   DA+1,,AUTO
         2 000433   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000434   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000435   000000 011000                    NOP     0

      591    20536    2           CALL GETGORGO ALTRET(MEMERR);

  20536  2 000436   005055 701000 2                  TSX1    GETGORGO
         2 000437   003014 702000 2                  TSX2    MEMERR

      592    20537    2           IF OPNTYP =%CREATE# THEN

  20537  2 000440   200032 235100                    LDA     OPNTYP,,AUTO
         2 000441   000003 115007                    CMPA    3,DL
         2 000442   001675 601000 2                  TNZ     s:20910

      593    20538    2            CALL KQC$CXTSET1 (KQ$CG.GORGOSTA$) ALTRET(ERR);

  20538  2 000443   200013 236100                    LDQ     CTX$,,AUTO
         2 000444   000207 036003                    ADLQ    135,DU
         2 000445   200130 756100                    STQ     DA+1,,AUTO
         2 000446   200130 630500                    EPPR0   DA+1,,AUTO
         2 000447   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000450   000000 701000 xent               TSX1    KQC$CXTSET1
         2 000451   003052 702000 2                  TSX2    ERR

      594    20539    2           END;  /* Create new comgroup */

  20539  2 000452   001675 710000 2                  TRA     s:20910

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:117  
      595    20540        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:118  
      596    20541
      597    20542    1         ELSE
      598    20543    1          IF FM$CFU.GDA~=0 THEN   /* Hooking into already-open CG */

  20543  2 000453   200012 473500                    LDP3    CFU$,,AUTO
         2 000454   300005 236100                    LDQ     5,,PR3
         2 000455   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 000456   000514 600000 2                  TZE     s:20578

      599    20544    2            DO;

      600    20545                   /******************************************************
      601    20546                    *                                                    *
      602    20547                    *        JOIN AN ALREADY-OPEN COMGROUP               *
      603    20548                    *                                                    *
      604    20549                    ******************************************************/
      605    20550
      606    20551    2            CTX.SID=FM$CFU.GDA;

  20551  2 000457   200013 752103                    STCQ    CTX$,'03'O,AUTO

      607    20552    2            CTX.DISP=FM$CFU.LDA;

  20552  2 000460   300006 235100                    LDA     6,,PR3
         2 000461   300007 236100                    LDQ     7,,PR3
         2 000462   000033 773000                    LRL     27
         2 000463   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000464   000014 736000                    QLS     12
         2 000465   200013 752174                    STCQ    CTX$,'74'O,AUTO

      608    20553    2            CALL KQX$LDASR(KQ$CG); /* Map onto comgroup */

  20553  2 000466   200013 630500                    EPPR0   CTX$,,AUTO
         2 000467   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000470   000000 701000 xent               TSX1    KQX$LDASR
         2 000471   000000 011000                    NOP     0

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:119  
      609    20554    2            CALL GLOCK;

  20554  2 000472   004673 701000 2                  TSX1    GLOCK
         2 000473   000000 011000                    NOP     0

      610    20555    2            KQ$CG.STATS.NUMDCBS=KQ$CG.STATS.NUMDCBS+1;

  20555  2 000474   200013 470500                    LDP0    CTX$,,AUTO
         2 000475   000173 054100                    AOS     123,,PR0

      611    20556    2            CALL GUNLOCK;

  20556  2 000476   004705 701000 2                  TSX1    GUNLOCK
         2 000477   000000 011000                    NOP     0

      612    20557    2            IF F$DCB.AU AND KQ$CG.AUSTA$~=ADDR(NIL) THEN

  20557  2 000500   200007 470500                    LDP0    JDCB$,,AUTO
         2 000501   000031 236100                    LDQ     25,,PR0
         2 000502   200000 316003                    CANQ    65536,DU
         2 000503   001675 600000 2                  TZE     s:20910
         2 000504   200013 471500                    LDP1    CTX$,,AUTO
         2 000505   100121 236100                    LDQ     81,,PR1
         2 000506   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000507   001675 600000 2                  TZE     s:20910

      613    20558    3              DO;

      614    20559    3              B$JIT.ERR=ERRTWOAU;

  20559  2 000510   000055 236000 1                  LDQ     ERRTWOAU
         2 000511   000000 473400 xsym               LDP3    B$JIT$
         2 000512   300012 756100                    STQ     10,,PR3

      615    20560    3              GOTO ERR;

  20560  2 000513   003052 710000 2                  TRA     ERR
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:120  

      616    20561    3              END;
      617    20562        /*E*    ERROR: KCO-E$TWOAU-2
      618    20563                MESSAGE: This comgroup already has an administrative user
      619    20564                MESSAGE1: Each comgroup may have only one administrative
      620    20565                          user at a time, and this one already has one.
      621    20566        */
      622    20567    2            END; /* Join an already-open comgroup */
      623    20568        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:121  
      624    20569
      625    20570    1          ELSE   /* Opening old CG that has no users */
      626    20571    2            DO;

      627    20572                   /******************************************************
      628    20573                    *                                                    *
      629    20574                    *        RE-OPEN A CLOSED (INACTIVE) COMGROUP        *
      630    20575                    *                                                    *
      631    20576                    ******************************************************/
      632    20577
      633    20578    2            OPNTYP=%UPDATE#;

  20578  2 000514   000001 235007                    LDA     1,DL
         2 000515   200032 755100                    STA     OPNTYP,,AUTO

      634    20579    2            F$DCB.GTYP=FMGTFILE;

  20579  2 000516   000064 236100                    LDQ     52,,PR0
         2 000517   000007 376000 3                  ANQ     7
         2 000520   030000 276003                    ORQ     12288,DU
         2 000521   000064 756100                    STQ     52,,PR0

      635    20580    2            F$DCB.LVL=%KQ_PTYP_CTL;

  20580  2 000522   000067 236100                    LDQ     55,,PR0
         2 000523   000010 376000 3                  ANQ     8
         2 000524   030000 276003                    ORQ     12288,DU
         2 000525   000067 756100                    STQ     55,,PR0

      636    20581    2            CALL FMD$REDBUF(CTL$,0,FM_FRZERO) ALTRET(ERR);

  20581  2 000526   000011 236000 3                  LDQ     9
         2 000527   200132 756100                    STQ     DA+3,,AUTO
         2 000530   000002 236000 3                  LDQ     2
         2 000531   200131 756100                    STQ     DA+2,,AUTO
         2 000532   200031 634500                    EPPR4   CTL$,,AUTO
         2 000533   200130 454500                    STP4    DA+1,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:122  
         2 000534   200130 630500                    EPPR0   DA+1,,AUTO
         2 000535   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000536   000000 701000 xent               TSX1    FMD$REDBUF
         2 000537   003052 702000 2                  TSX2    ERR

      637    20582    2            IF KQ$CTLGRAN.CTXX=0 OR KQ$CTLGRAN.CTXSIZ=0 THEN

  20582  2 000540   200031 470500                    LDP0    CTL$,,AUTO
         2 000541   000004 235100                    LDA     4,,PR0
         2 000542   000545 600000 2                  TZE     s:20584
         2 000543   000005 235100                    LDA     5,,PR0
         2 000544   000551 601000 2                  TNZ     s:20591

      638    20583    3              DO;

      639    20584    3              B$JIT.ERR=ERRCGCTLBAD;

  20584  2 000545   000067 236000 1                  LDQ     ERRCGCTLBAD
         2 000546   000000 471400 xsym               LDP1    B$JIT$
         2 000547   100012 756100                    STQ     10,,PR1

      640    20585    3              GOTO ERR;

  20585  2 000550   003052 710000 2                  TRA     ERR

      641    20586    3              END;
      642    20587        /*E*    ERROR: KCO-E$CGCTLBAD-2
      643    20588                MESSAGE: Unable to open comgroup% %UF%, saved context information
      644    20589                         is bad
      645    20590        */
      646    20591    2            NAME$=PINCRW(CTL$,KQ$CTLGRAN.CTXX); /* Point to old ctx blk */

  20591  2 000551   000004 720100                    LXL0    4,,PR0
         2 000552   000000 636010                    EAQ     0,X0
         2 000553   200031 036100                    ADLQ    CTL$,,AUTO
         2 000554   200024 756100                    STQ     NAME$,,AUTO

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:123  
      647    20592    2           IF (KQ$CTLGRAN.VERSION < 'B01X') AND (NAME$->KQ$CG.HIGRANS = BITBIN('6014'O
             20592                     )) THEN

  20592  2 000555   000011 236100                    LDQ     9,,PR0
         2 000556   000101 116000 1                  CMPQ    ERRCGORAU+2
         2 000557   000570 603000 2                  TRC     s:20602
         2 000560   200024 471500                    LDP1    NAME$,,AUTO
         2 000561   100222 235100                    LDA     146,,PR1
         2 000562   006014 115007                    CMPA    3084,DL
         2 000563   000570 601000 2                  TNZ     s:20602

      648    20593    3              DO;

      649    20594    3              B$JIT.ERR=ERROLDCG;

  20594  2 000564   000076 236000 1                  LDQ     ERROLDCG
         2 000565   000000 473400 xsym               LDP3    B$JIT$
         2 000566   300012 756100                    STQ     10,,PR3

      650    20595        /*E* ERROR:        KCO-E$OLDCG-2
      651    20596             MESSAGE:      Unable to open comgroup% %UF% - old version
      652    20597             MESSAGE1:     The comgroup you tried to open was created
      653    20598                           by a previous version of CP-6, and cannot
      654    20599                           be used. */
      655    20600    3              GOTO ERR;

  20600  2 000567   003052 710000 2                  TRA     ERR

      656    20601    3              END;
      657    20602    2            IF (KQ$CTLGRAN.VERSION < 'E03G') THEN /* CORRECTION */

  20602  2 000570   000102 116000 1                  CMPQ    ERRCGORAU+3
         2 000571   000600 603000 2                  TRC     s:20607

      658    20603    3              DO;

      659    20604    3              NAME$->KQ$CG.HIGRANS=NAME$->KQ$CG.HIGRANS+1;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:124  

  20604  2 000572   200024 471500                    LDP1    NAME$,,AUTO
         2 000573   100222 235100                    LDA     146,,PR1
         2 000574   000001 035007                    ADLA    1,DL
         2 000575   100222 755100                    STA     146,,PR1

      660    20605    3              KQ$CTLGRAN.VERSION='E03G';

  20605  2 000576   000102 236000 1                  LDQ     ERRCGORAU+3
         2 000577   000011 756100                    STQ     9,,PR0

      661    20606    3              END;

      662    20607    2            IF KQ$CTLGRAN.RCVRTIME~=0 THEN

  20607  2 000600   200031 470500                    LDP0    CTL$,,AUTO
         2 000601   000010 235100                    LDA     8,,PR0
         2 000602   000673 600000 2                  TZE     s:20621

      663    20608    3              DO;

      664    20609    3              COMGRP='0'B;

  20609  2 000603   000100 100400                    MLR     fill='000'O
         2 000604   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000605   200052 000220                    ADSC9   COMGRP,,AUTO             cn=0,n=144

      665    20610    3              COMGRP.CODE=%AZ$CG;

  20610  2 000606   005000 236003                    LDQ     2560,DU
         2 000607   200052 552140                    STBQ    COMGRP,'40'O,AUTO

      666    20611    3              COMGRP.ACCT=F$DCB.ACCT;

  20611  2 000610   200007 471500                    LDP1    JDCB$,,AUTO
         2 000611   100020 237100                    LDAQ    16,,PR1
         2 000612   200054 757100                    STAQ    COMGRP+2,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:125  

      667    20612    3              COMGRP.NAM=F$DCB.NAME;

  20612  2 000613   000100 100500                    MLR     fill='000'O
         2 000614   100010 000040                    ADSC9   8,,PR1                   cn=0,n=32
         2 000615   200056 000040                    ADSC9   COMGRP+4,,AUTO           cn=0,n=32

      668    20613    3              COMGRP.SN=FM$SET.PSN(F$DCB.SETX);

  20613  2 000616   100051 236100                    LDQ     41,,PR1
         2 000617   000003 736000                    QLS     3
         2 000620   000012 376000 3                  ANQ     10
         2 000621   000002 736000                    QLS     2
         2 000622   000000 473400 xsym               LDP3    F$CFU$
         2 000623   040100 100506                    MLR     fill='040'O
         2 000624   300000 400006                    ADSC9   0,Q,PR3                  cn=2,n=6
         2 000625   200052 400006                    ADSC9   COMGRP,,AUTO             cn=2,n=6

      669    20614    3              COMGRP.RCVR='1'B;

  20614  2 000626   000400 236003                    LDQ     256,DU
         2 000627   200052 256100                    ORSQ    COMGRP,,AUTO

      670    20615    3              COMGRP.STATS=NAME$->KQ$CG.STATS;

  20615  2 000630   200024 474500                    LDP4    NAME$,,AUTO
         2 000631   000100 100500                    MLR     fill='000'O
         2 000632   400165 000110                    ADSC9   117,,PR4                 cn=0,n=72
         2 000633   200066 000110                    ADSC9   COMGRP+12,,AUTO          cn=0,n=72

      671    20616    3              INDX=KQ$CTLGRAN.RCVRTIME-NAME$->KQ$CG.PGTIME;

  20616  2 000634   000010 236100                    LDQ     8,,PR0
         2 000635   400115 136100                    SBLQ    77,,PR4
         2 000636   200027 756100                    STQ     INDX,,AUTO

      672    20617    3              CALL FGH$UPDBUCKET(COMGRP.STATS.PGSI,NAME$->KQ$CG.STATS.PGSI,INDX,
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:126  

  20617  2 000637   200024 236100                    LDQ     NAME$,,AUTO
         2 000640   000006 036003                    ADLQ    6,DU
         2 000641   200133 756100                    STQ     DA+4,,AUTO
         2 000642   200027 635500                    EPPR5   INDX,,AUTO
         2 000643   200132 455500                    STP5    DA+3,,AUTO
         2 000644   200024 236100                    LDQ     NAME$,,AUTO
         2 000645   000177 036003                    ADLQ    127,DU
         2 000646   200131 756100                    STQ     DA+2,,AUTO
         2 000647   200100 636500                    EPPR6   COMGRP+22,,AUTO
         2 000650   200130 456500                    STP6    DA+1,,AUTO
         2 000651   200130 630500                    EPPR0   DA+1,,AUTO
         2 000652   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000653   000000 701000 xent               TSX1    FGH$UPDBUCKET
         2 000654   000000 011000                    NOP     0

      673    20618    3              NAME$->KQ$CG.MMD.CURPG);
      674    20619    3              CALL ELA$SYSLOG(EL_ACCTLG,COMGRP,SIZEW(COMGRP),0,2,INDX);

  20619  2 000655   200027 630500                    EPPR0   INDX,,AUTO
         2 000656   200135 450500                    STP0    DA+6,,AUTO
         2 000657   000000 236000 3                  LDQ     0
         2 000660   200134 756100                    STQ     DA+5,,AUTO
         2 000661   000014 237000 3                  LDAQ    12
         2 000662   200132 757100                    STAQ    DA+3,,AUTO
         2 000663   200052 631500                    EPPR1   COMGRP,,AUTO
         2 000664   200131 451500                    STP1    DA+2,,AUTO
         2 000665   000016 236000 3                  LDQ     14
         2 000666   200130 756100                    STQ     DA+1,,AUTO
         2 000667   200130 630500                    EPPR0   DA+1,,AUTO
         2 000670   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 000671   000000 701000 xent               TSX1    ELA$SYSLOG
         2 000672   000000 011000                    NOP     0

      675    20620    3              END;

      676    20621    2            NAME$->KQ$CG.STATS='0'B;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:127  

  20621  2 000673   200024 470500                    LDP0    NAME$,,AUTO
         2 000674   000100 100400                    MLR     fill='000'O
         2 000675   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000676   000165 000110                    ADSC9   117,,PR0                 cn=0,n=72

      677    20622    2            KQ$CTLGRAN.RCVRTIME=0;

  20622  2 000677   200031 471500                    LDP1    CTL$,,AUTO
         2 000700   100010 450100                    STZ     8,,PR1

      678    20623    2            CALL SSS$SYSTIME(NAME$->KQ$CG.PGTIME);

  20623  2 000701   200024 236100                    LDQ     NAME$,,AUTO
         2 000702   000115 036003                    ADLQ    77,DU
         2 000703   200130 756100                    STQ     DA+1,,AUTO
         2 000704   200130 630500                    EPPR0   DA+1,,AUTO
         2 000705   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000706   000000 701000 xent               TSX1    SSS$SYSTIME
         2 000707   000000 011000                    NOP     0

      679    20624    2            NAME$->KQ$CG.DTREE=KQ_THDR;

  20624  2 000710   200024 470500                    LDP0    NAME$,,AUTO
         2 000711   000100 100400                    MLR     fill='000'O
         2 000712   000044 000030 1                  ADSC9   KQ_THDR                  cn=0,n=24
         2 000713   000231 000030                    ADSC9   153,,PR0                 cn=0,n=24

      680    20625    2            NAME$->KQ$CG.AU=0;

  20625  2 000714   000000 236003                    LDQ     0,DU
         2 000715   000122 552140                    STBQ    82,'40'O,PR0

      681    20626    2            NAME$->KQ$CG.LASTUSER=0;

  20626  2 000716   000216 552110                    STBQ    142,'10'O,PR0

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:128  
      682    20627    2            NAME$->KQ$CG.AUSTA$=ADDR(NIL);

  20627  2 000717   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000720   000121 756100                    STQ     81,,PR0

      683    20628    2            NAME$->KQ$CG.EOFTIMEHD$=ADDR(NIL);

  20628  2 000721   000027 756100                    STQ     23,,PR0

      684    20629    2            NAME$->KQ$CG.EOFTIME=0;

  20629  2 000722   000000 220003                    LDX0    0,DU
         2 000723   000030 740100                    STX0    24,,PR0

      685    20630    2            NAME$->KQ$CG.FWUSR#=0;

  20630  2 000724   000000 236003                    LDQ     0,DU
         2 000725   000122 552110                    STBQ    82,'10'O,PR0

      686    20631    2            NAME$->KQ$CG.FWHD$=ADDR(NIL);

  20631  2 000726   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000727   000123 756100                    STQ     83,,PR0

      687    20632    2            NAME$->KQ$CG.STATS.NUMTERMS=0;

  20632  2 000730   000174 450100                    STZ     124,,PR0

      688    20633    2            NAME$->KQ$CG.OPEN='0'B;

  20633  2 000731   000017 236000 3                  LDQ     15
         2 000732   000105 356100                    ANSQ    69,,PR0

      689    20634    2            NAME$->KQ$CG.CLOCK='0'B; /* Disable clock */

  20634  2 000733   000020 236000 3                  LDQ     16
         2 000734   000105 356100                    ANSQ    69,,PR0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:129  

      690    20635    2            NAME$->KQ$CG.IOCNT=0;

  20635  2 000735   000225 440100                    SXL0    149,,PR0

      691    20636    2            NAME$->KQ$CG.GATE.CG='1'B;

  20636  2 000736   400000 235003                    LDA     -131072,DU
         2 000737   000000 236003                    LDQ     0,DU
         2 000740   000107 755100                    STA     71,,PR0
         2 000741   000110 756100                    STQ     72,,PR0

      692    20637    2            NAME$->KQ$CG.GATE.MISC='1'B;

  20637  2 000742   400000 235003                    LDA     -131072,DU
         2 000743   000000 236003                    LDQ     0,DU
         2 000744   000111 755100                    STA     73,,PR0
         2 000745   000112 756100                    STQ     74,,PR0

      693    20638    2            NAME$->KQ$CG.DTREE.GATE='1'B;

  20638  2 000746   400000 235003                    LDA     -131072,DU
         2 000747   000000 236003                    LDQ     0,DU
         2 000750   000231 755100                    STA     153,,PR0
         2 000751   000232 756100                    STQ     154,,PR0

      694    20639    2            NAME$->KQ$CG.STREE.GATE='1'B;

  20639  2 000752   400000 235003                    LDA     -131072,DU
         2 000753   000000 236003                    LDQ     0,DU
         2 000754   000075 755100                    STA     61,,PR0
         2 000755   000076 756100                    STQ     62,,PR0

      695    20640    2            NAME$->KQ$CG.TTREE.GATE='1'B;

  20640  2 000756   400000 235003                    LDA     -131072,DU
         2 000757   000000 236003                    LDQ     0,DU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:130  
         2 000760   000067 755100                    STA     55,,PR0
         2 000761   000070 756100                    STQ     56,,PR0

      696    20641    2            NAME$->KQ$CG.MMD.CURPG=0;

  20641  2 000762   000006 450100                    STZ     6,,PR0

      697    20642    2            NAME$->KQ$CG.MMD.CURBPG=0;

  20642  2 000763   200024 470500                    LDP0    NAME$,,AUTO
         2 000764   000010 740100                    STX0    8,,PR0

      698    20643    2            NAME$->KQ$CG.MMD.BAPLOCK=0;

  20643  2 000765   200024 470500                    LDP0    NAME$,,AUTO
         2 000766   000000 236003                    LDQ     0,DU
         2 000767   000011 552120                    STBQ    9,'20'O,PR0

      699    20644    2            NAME$->KQ$CG.MMD.GATE='1'B;

  20644  2 000770   200024 470500                    LDP0    NAME$,,AUTO
         2 000771   400000 235003                    LDA     -131072,DU
         2 000772   000000 236003                    LDQ     0,DU
         2 000773   000001 755100                    STA     1,,PR0
         2 000774   000002 756100                    STQ     2,,PR0

      700    20645    2            NAME$->KQ$CG.CURDATAPGS=0;

  20645  2 000775   200024 470500                    LDP0    NAME$,,AUTO
         2 000776   000241 440100                    SXL0    161,,PR0

      701    20646    2            NAME$->KQ$CG.MMD.FREECNT = 0;

  20646  2 000777   000007 450100                    STZ     7,,PR0

      702    20647    2            NAME$->KQ$CG.MMD.FREE$ = ADDR(NIL);

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:131  
  20647  2 001000   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001001   200024 470500                    LDP0    NAME$,,AUTO
         2 001002   000005 756100                    STQ     5,,PR0

      703    20648    2            NAME$->KQ$CG.AVAIL.HD$=ADDR(NIL);

  20648  2 001003   200024 470500                    LDP0    NAME$,,AUTO
         2 001004   000244 756100                    STQ     164,,PR0

      704    20649    2            NAME$->KQ$CG.AVAIL.TL$=ADDR(NIL);

  20649  2 001005   000245 756100                    STQ     165,,PR0

      705    20650    2            NAME$->KQ$CG.DCBHD$=ADDR(NIL);

  20650  2 001006   000103 756100                    STQ     67,,PR0

      706    20651    2            NAME$->KQ$CG.DATAFREE$=ADDR(NIL);

  20651  2 001007   000243 756100                    STQ     163,,PR0

      707    20652    2            NAME$->KQ$CG.ADDFREE=0;

  20652  2 001010   000227 450100                    STZ     151,,PR0

      708    20653    2            NAME$->KQ$CG.GETFLG=0;

  20653  2 001011   000000 236003                    LDQ     0,DU
         2 001012   000226 552140                    STBQ    150,'40'O,PR0

      709    20654    2            NAME$->KQ$CG.RCVR='1'B;

  20654  2 001013   000010 236007                    LDQ     8,DL
         2 001014   000105 256100                    ORSQ    69,,PR0

      710    20655    2            CALL KQM$INIT(NAME$->KQ$CG,SCRATCH$) ALTRET(ERR);

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:132  
  20655  2 001015   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 001016   200131 451500                    STP1    DA+2,,AUTO
         2 001017   200024 236100                    LDQ     NAME$,,AUTO
         2 001020   200130 756100                    STQ     DA+1,,AUTO
         2 001021   200130 630500                    EPPR0   DA+1,,AUTO
         2 001022   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001023   000000 701000 xent               TSX1    KQM$INIT
         2 001024   003052 702000 2                  TSX2    ERR

      711    20656    2            CTX$=SCRATCH$;

  20656  2 001025   200116 236100                    LDQ     SCRATCH$,,AUTO
         2 001026   200013 756100                    STQ     CTX$,,AUTO

      712    20657    2            KQ$CG.STATS.NUMDCBS=1;

  20657  2 001027   000001 235007                    LDA     1,DL
         2 001030   200013 470500                    LDP0    CTX$,,AUTO
         2 001031   000173 755100                    STA     123,,PR0

      713    20658    2            KQ$CG.CFU$=CFU$;

  20658  2 001032   200012 236100                    LDQ     CFU$,,AUTO
         2 001033   000214 756100                    STQ     140,,PR0

      714    20659    2            KQ$CG.SETX=F$DCB.SETX;

  20659  2 001034   200007 471500                    LDP1    JDCB$,,AUTO
         2 001035   100051 720100                    LXL0    41,,PR1
         2 001036   000216 740100                    STX0    142,,PR0

      715    20660    2            KQ$CG.XTX$=PINCRW(F$CFU$,FM$CFU.XTX);

  20660  2 001037   200012 473500                    LDP3    CFU$,,AUTO
         2 001040   300003 221100                    LDX1    3,,PR3
         2 001041   000000 636011                    EAQ     0,X1
         2 001042   000000 036000 xsym               ADLQ    F$CFU$
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:133  
         2 001043   000215 756100                    STQ     141,,PR0

      716    20661    2            KQ$CG.GRAN.STAMP.HASH=F$DCB.HASH;

  20661  2 001044   100073 236100                    LDQ     59,,PR1
         2 001045   000253 552170                    STBQ    171,'70'O,PR0

      717    20662    2            FM$CFU.GDA=CTX.SID;

  20662  2 001046   200013 236100                    LDQ     CTX$,,AUTO
         2 001047   007777 376007                    ANQ     4095,DL
         2 001050   300005 552134                    STBQ    5,'34'O,PR3

      718    20663    2            FM$CFU.LDA=CTX.DISP;

  20663  2 001051   003100 061500                    CSR     bolr='003'O
         2 001052   200013 000030                    BDSC    CTX$,,AUTO               by=0,bit=0,n=24
         2 001053   300006 400033                    BDSC    6,,PR3                   by=2,bit=0,n=27

      719    20664    2            F$DCB.GTYP=FMGTFILE;

  20664  2 001054   200007 471500                    LDP1    JDCB$,,AUTO
         2 001055   100064 236100                    LDQ     52,,PR1
         2 001056   000007 376000 3                  ANQ     7
         2 001057   030000 276003                    ORQ     12288,DU
         2 001060   100064 756100                    STQ     52,,PR1

      720    20665    2            F$DCB.LVL=%KQ_PTYP_RCVR;

  20665  2 001061   100067 236100                    LDQ     55,,PR1
         2 001062   000010 376000 3                  ANQ     8
         2 001063   020000 276003                    ORQ     8192,DU
         2 001064   100067 756100                    STQ     55,,PR1

      721    20666    2            DESC#=0;

  20666  2 001065   200037 450100                    STZ     DESC#,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:134  

      722    20667    2            PG#=0;

  20667  2 001066   200040 450100                    STZ     PG#,,AUTO

      723    20668    2            IF KQ$CTLGRAN.RCVRDA~=0 AND KQ$CTLGRAN.RCVRSIZ~=0 THEN

  20668  2 001067   200031 474500                    LDP4    CTL$,,AUTO
         2 001070   400006 235100                    LDA     6,,PR4
         2 001071   001665 600000 2                  TZE     s:20892
         2 001072   400007 235100                    LDA     7,,PR4
         2 001073   001665 600000 2                  TZE     s:20892

      724    20669    3              DO;

      725    20670    4                DO WHILE('1'B);

      726    20671    4                IF KQ$CTLGRAN.PGTBL((DESC#*%CGQ_CHUNK_SIZE)+PG#+1) THEN

  20671  2 001074   200037 236100                    LDQ     DESC#,,AUTO
         2 001075   000012 402007                    MPY     10,DL
         2 001076   200040 036100                    ADLQ    PG#,,AUTO
         2 001077   200031 470500                    LDP0    CTL$,,AUTO
         2 001100   000000 066506                    CMPB    filb='0'B
         2 001101   000012 010001                    BDSC    10,Q,PR0                 by=0,bit=1,n=1
         2 001102   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         2 001103   001365 600000 2                  TZE     s:20743

      727    20672    5                  DO;

      728    20673    5                  IF KQ$CTLGRAN.RCVRSIZ=0 THEN

  20673  2 001104   000007 235100                    LDA     7,,PR0
         2 001105   001203 600000 2                  TZE     RCVR_BAD

      729    20674    5                   GOTO RCVR_BAD;
      730    20675    5                  DGRAN='000000004000'O;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:135  

  20675  2 001106   000103 236000 1                  LDQ     ERRCGORAU+4
         2 001107   200033 756100                    STQ     DGRAN$,,AUTO

      731    20676    5                  DGRAN.DISP=PG#*1024;

  20676  2 001110   200040 235100                    LDA     PG#,,AUTO
         2 001111   000012 735000                    ALS     10
         2 001112   000000 620005                    EAX0    0,AL
         2 001113   200033 740100                    STX0    DGRAN$,,AUTO

      732    20677    5                  DGRAN.DESC=DESC#;

  20677  2 001114   200037 236100                    LDQ     DESC#,,AUTO
         2 001115   200033 676100                    ERQ     DGRAN$,,AUTO
         2 001116   001777 376007                    ANQ     1023,DL
         2 001117   200033 656100                    ERSQ    DGRAN$,,AUTO

      733    20678    5                  CALL KQM$RECON (KQ$CG,DGRAN$,INDX) ALTRET(MMERR);

  20678  2 001120   200027 631500                    EPPR1   INDX,,AUTO
         2 001121   200132 451500                    STP1    DA+3,,AUTO
         2 001122   200033 633500                    EPPR3   DGRAN$,,AUTO
         2 001123   200131 453500                    STP3    DA+2,,AUTO
         2 001124   200013 236100                    LDQ     CTX$,,AUTO
         2 001125   200130 756100                    STQ     DA+1,,AUTO
         2 001126   200130 630500                    EPPR0   DA+1,,AUTO
         2 001127   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001130   000000 701000 xent               TSX1    KQM$RECON
         2 001131   003113 702000 2                  TSX2    MMERR

      734    20679    5                  I=INDX;

  20679  2 001132   200027 235100                    LDA     INDX,,AUTO
         2 001133   200021 755100                    STA     I,,AUTO

      735    20680    5                  CALL MMJ$MAPIOP (INDX , I);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:136  

  20680  2 001134   200021 630500                    EPPR0   I,,AUTO
         2 001135   200131 450500                    STP0    DA+2,,AUTO
         2 001136   200027 631500                    EPPR1   INDX,,AUTO
         2 001137   200130 451500                    STP1    DA+1,,AUTO
         2 001140   200130 630500                    EPPR0   DA+1,,AUTO
         2 001141   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001142   000000 701000 xent               TSX1    MMJ$MAPIOP
         2 001143   000000 011000                    NOP     0

      736    20681    5                  F$DCB.BFR.BUFX (2) = INDX;

  20681  2 001144   200007 470500                    LDP0    JDCB$,,AUTO
         2 001145   200027 236100                    LDQ     INDX,,AUTO
         2 001146   000033 736000                    QLS     27
         2 001147   000117 676100                    ERQ     79,,PR0
         2 001150   037000 376003                    ANQ     15872,DU
         2 001151   000117 656100                    ERSQ    79,,PR0

      737    20682    5                  NAME$ = FM$BUF$ (INDX);

  20682  2 001152   200027 720100                    LXL0    INDX,,AUTO
         2 001153   000000 236010 xsym               LDQ     FM$BUF$,X0
         2 001154   200024 756100                    STQ     NAME$,,AUTO

      738    20683    5                  F$DCB.BFR.CVM(2)='1'B;

  20683  2 001155   040000 236003                    LDQ     16384,DU
         2 001156   000117 256100                    ORSQ    79,,PR0

      739    20684    5                  NAME$->KQ$DGRAN=KQ$CG.GRAN; /* Make ORG~=0 */

  20684  2 001157   200013 471500                    LDP1    CTX$,,AUTO
         2 001160   200024 473500                    LDP3    NAME$,,AUTO
         2 001161   000100 100500                    MLR     fill='000'O
         2 001162   100253 000020                    ADSC9   171,,PR1                 cn=0,n=16
         2 001163   300000 000200                    ADSC9   0,,PR3                   cn=0,n=128
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:137  

      740    20685    5                  CALL FMD$REDBUFBC(NAME$,2,KQ$CTLGRAN.RCVRDA) ALTRET(ERR);

  20685  2 001164   200031 236100                    LDQ     CTL$,,AUTO
         2 001165   000006 036003                    ADLQ    6,DU
         2 001166   200132 756100                    STQ     DA+3,,AUTO
         2 001167   000000 236000 3                  LDQ     0
         2 001170   200131 756100                    STQ     DA+2,,AUTO
         2 001171   200024 630500                    EPPR0   NAME$,,AUTO
         2 001172   200130 450500                    STP0    DA+1,,AUTO
         2 001173   200130 630500                    EPPR0   DA+1,,AUTO
         2 001174   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001175   000000 701000 xent               TSX1    FMD$REDBUFBC
         2 001176   003052 702000 2                  TSX2    ERR

      741    20686    5                  IF DGRAN$~=NAME$->KQ$DGRAN.HDR.SELF$ THEN

  20686  2 001177   200024 470500                    LDP0    NAME$,,AUTO
         2 001200   200033 236100                    LDQ     DGRAN$,,AUTO
         2 001201   000002 116100                    CMPQ    2,,PR0
         2 001202   001207 600000 2                  TZE     s:20695

      742    20687    6                    DO;

      743    20688    6   RCVR_BAD:
      744    20689    6                    B$JIT.ERR=ERRRCVRBAD;

  20689  2 001203   000066 236000 1     RCVR_BAD     LDQ     ERRRCVRBAD
         2 001204   000000 470400 xsym               LDP0    B$JIT$
         2 001205   000012 756100                    STQ     10,,PR0

      745    20690    6                    GOTO ERR;

  20690  2 001206   003052 710000 2                  TRA     ERR

      746    20691    6                    END;
      747    20692        /*E*  ERROR: KCO-E$RCVRBAD-2
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:138  
      748    20693              MESSAGE: Cannot reopen comgroup - recovery area is bad
      749    20694        */
      750    20695    5                  CALL MMJ$UNMAPIOP (INDX);

  20695  2 001207   200027 631500                    EPPR1   INDX,,AUTO
         2 001210   200130 451500                    STP1    DA+1,,AUTO
         2 001211   200130 630500                    EPPR0   DA+1,,AUTO
         2 001212   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001213   000000 701000 xent               TSX1    MMJ$UNMAPIOP
         2 001214   000000 011000                    NOP     0

      751    20696    5                  F$DCB.BFR(2)='0'B;

  20696  2 001215   200007 470500                    LDP0    JDCB$,,AUTO
         2 001216   000117 450100                    STZ     79,,PR0

      752    20697    5                  F$DCB.BFR1(2)='0'B;

  20697  2 001217   000124 450100                    STZ     84,,PR0

      753    20698    5                  KQ$CTLGRAN.RCVRSIZ=KQ$CTLGRAN.RCVRSIZ-1;

  20698  2 001220   200031 471500                    LDP1    CTL$,,AUTO
         2 001221   100007 235100                    LDA     7,,PR1
         2 001222   000001 135007                    SBLA    1,DL
         2 001223   100007 755100                    STA     7,,PR1

      754    20699    5                  KQ$CTLGRAN.RCVRDA=KQ$CTLGRAN.RCVRDA+1;

  20699  2 001224   200031 470500                    LDP0    CTL$,,AUTO
         2 001225   000006 235100                    LDA     6,,PR0
         2 001226   000001 035007                    ADLA    1,DL
         2 001227   000006 755100                    STA     6,,PR0

      755    20700    5                  IF KQ$DGRAN.HDR.PTYP=%KQ_PTYP_BAP THEN

  20700  2 001230   200033 470500                    LDP0    DGRAN$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:139  
         2 001231   000001 236100                    LDQ     1,,PR0
         2 001232   000007 376003                    ANQ     7,DU
         2 001233   000004 116003                    CMPQ    4,DU
         2 001234   001244 601000 2                  TNZ     s:20705

      756    20701    6                    DO;

      757    20702    6                    KQ$BAP.CG$=CTX$;

  20702  2 001235   200013 236100                    LDQ     CTX$,,AUTO
         2 001236   000013 756100                    STQ     11,,PR0

      758    20703    6                    KQ$CG.MMD.CURBPG=KQ$CG.MMD.CURBPG+1;

  20703  2 001237   200013 470500                    LDP0    CTX$,,AUTO
         2 001240   000010 220100                    LDX0    8,,PR0
         2 001241   000001 621010                    EAX1    1,X0
         2 001242   000010 741100                    STX1    8,,PR0

      759    20704    6                    END;

  20704  2 001243   001365 710000 2                  TRA     s:20743

      760    20705    5                  ELSE IF KQ$DGRAN.HDR.PTYP=%KQ_PTYP_DATA THEN

  20705  2 001244   000001 116003                    CMPQ    1,DU
         2 001245   001352 601000 2                  TNZ     s:20728

      761    20706    6                     DO;

      762    20707    6                     KQ$DGRAN.USECNT=0;

  20707  2 001246   000013 450100                    STZ     11,,PR0

      763    20708    6                     KQ$DGRAN.ACTCNT=0;

  20708  2 001247   200033 470500                    LDP0    DGRAN$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:140  
         2 001250   000022 450100                    STZ     18,,PR0

      764    20709    6                     KQ$DGRAN.BYPASSCNT=0;

  20709  2 001251   200033 470500                    LDP0    DGRAN$,,AUTO
         2 001252   000020 450100                    STZ     16,,PR0

      765    20710    6                     KEY=KQ$DGRAN.BTN.KEY;

  20710  2 001253   200033 470500                    LDP0    DGRAN$,,AUTO
         2 001254   040100 100500                    MLR     fill='040'O
         2 001255   000011 000010                    ADSC9   9,,PR0                   cn=0,n=8
         2 001256   200022 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

      766    20711    6                     DBLK$=ADDR(KQ$DGRAN.BTN);

  20711  2 001257   200033 236100                    LDQ     DGRAN$,,AUTO
         2 001260   000004 036003                    ADLQ    4,DU
         2 001261   200030 756100                    STQ     DBLK$,,AUTO

      767    20712    6                     CALL KQB$INSERTNL(KQ$CG.DTREE,KEY,DBLK$) ALTRET(CGBAD);

  20712  2 001262   200030 631500                    EPPR1   DBLK$,,AUTO
         2 001263   200132 451500                    STP1    DA+3,,AUTO
         2 001264   200022 633500                    EPPR3   KEY,,AUTO
         2 001265   200131 453500                    STP3    DA+2,,AUTO
         2 001266   200013 236100                    LDQ     CTX$,,AUTO
         2 001267   000231 036003                    ADLQ    153,DU
         2 001270   200130 756100                    STQ     DA+1,,AUTO
         2 001271   200130 630500                    EPPR0   DA+1,,AUTO
         2 001272   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001273   000000 701000 xent               TSX1    KQB$INSERTNL
         2 001274   003042 702000 2                  TSX2    CGBAD

      768    20713    6                     KQ$DGRAN.HDR.CHAIN='1'B;

  20713  2 001275   200033 470500                    LDP0    DGRAN$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:141  
         2 001276   000020 236003                    LDQ     16,DU
         2 001277   000001 256100                    ORSQ    1,,PR0

      769    20714    6                     KQ$DGRAN.HDR.WRITE='0'B;

  20714  2 001300   200033 470500                    LDP0    DGRAN$,,AUTO
         2 001301   000021 236000 3                  LDQ     17
         2 001302   000001 356100                    ANSQ    1,,PR0

      770    20715    6                     KQ$DGRAN.HDR.ADDFREE='0'B;

  20715  2 001303   200033 470500                    LDP0    DGRAN$,,AUTO
         2 001304   000022 236000 3                  LDQ     18
         2 001305   000001 356100                    ANSQ    1,,PR0

      771    20716    6                     KQ$DGRAN.HDR.FORCEOUT='0'B;

  20716  2 001306   200033 470500                    LDP0    DGRAN$,,AUTO
         2 001307   000023 236000 3                  LDQ     19
         2 001310   000001 356100                    ANSQ    1,,PR0

      772    20717    6                     KQ$DGRAN.HDR.STAMP.GMOD=ADDR(KEY)->PG(0);

  20717  2 001311   200033 470500                    LDP0    DGRAN$,,AUTO
         2 001312   200022 236100                    LDQ     KEY,,AUTO
         2 001313   000000 552104                    STBQ    0,'04'O,PR0

      773    20718    6                     KQ$DGRAN.FLINK$=ADDR(NIL);

  20718  2 001314   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001315   200033 470500                    LDP0    DGRAN$,,AUTO
         2 001316   000017 756100                    STQ     15,,PR0

      774    20719    6                     KQ$DGRAN.BLINK$=KQ$CG.AVAIL.TL$;

  20719  2 001317   200013 470500                    LDP0    CTX$,,AUTO
         2 001320   000245 236100                    LDQ     165,,PR0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:142  
         2 001321   200033 471500                    LDP1    DGRAN$,,AUTO
         2 001322   100016 756100                    STQ     14,,PR1

      775    20720    6                     CALL SSS$SYSTIME(KQ$DGRAN.TIME);

  20720  2 001323   200033 236100                    LDQ     DGRAN$,,AUTO
         2 001324   000024 036003                    ADLQ    20,DU
         2 001325   200130 756100                    STQ     DA+1,,AUTO
         2 001326   200130 630500                    EPPR0   DA+1,,AUTO
         2 001327   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001330   000000 701000 xent               TSX1    SSS$SYSTIME
         2 001331   000000 011000                    NOP     0

      776    20721    6                     IF KQ$CG.AVAIL.HD$=ADDR(NIL) THEN

  20721  2 001332   200013 470500                    LDP0    CTX$,,AUTO
         2 001333   000244 236100                    LDQ     164,,PR0
         2 001334   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001335   001341 601000 2                  TNZ     s:20724

      777    20722    6                      KQ$CG.AVAIL.HD$=DGRAN$;

  20722  2 001336   200033 236100                    LDQ     DGRAN$,,AUTO
         2 001337   000244 756100                    STQ     164,,PR0
         2 001340   001344 710000 2                  TRA     s:20725

      778    20723    6                     ELSE
      779    20724    6                      KQ$CG.AVAIL.TL$->KQ$DGRAN.FLINK$=DGRAN$;

  20724  2 001341   000245 471500                    LDP1    165,,PR0
         2 001342   200033 236100                    LDQ     DGRAN$,,AUTO
         2 001343   100017 756100                    STQ     15,,PR1

      780    20725    6                     KQ$CG.AVAIL.TL$=DGRAN$;

  20725  2 001344   200033 236100                    LDQ     DGRAN$,,AUTO
         2 001345   000245 756100                    STQ     165,,PR0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:143  

      781    20726    6                     KQ$CG.CURDATAPGS=KQ$CG.CURDATAPGS+1;

  20726  2 001346   000241 720100                    LXL0    161,,PR0
         2 001347   000001 621010                    EAX1    1,X0
         2 001350   000241 441100                    SXL1    161,,PR0

      782    20727    6                     END;

  20727  2 001351   001365 710000 2                  TRA     s:20743

      783    20728    5                   ELSE IF KQ$DGRAN.HDR.PTYP=%KQ_PTYP_SPARE THEN

  20728  2 001352   000005 116003                    CMPQ    5,DU
         2 001353   001363 601000 2                  TNZ     s:20734

      784    20729    6                      DO;

      785    20730    6                      DGRAN$->KQ$FP.LNK$ = KQ$CG.MMD.FREE$;

  20730  2 001354   200013 471500                    LDP1    CTX$,,AUTO
         2 001355   100005 236100                    LDQ     5,,PR1
         2 001356   000004 756100                    STQ     4,,PR0

      786    20731    6                      KQ$CG.MMD.FREE$ = DGRAN$;

  20731  2 001357   200033 236100                    LDQ     DGRAN$,,AUTO
         2 001360   100005 756100                    STQ     5,,PR1

      787    20732    6                      KQ$CG.MMD.FREECNT = KQ$CG.MMD.FREECNT+1;

  20732  2 001361   100007 054100                    AOS     7,,PR1

      788    20733    6                      END;

  20733  2 001362   001365 710000 2                  TRA     s:20743

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:144  
      789    20734    5                    ELSE CALL SC_CGREOPEN;

  20734  2 001363   000000 713400 xsym               CLIMB   SC_CGREOPEN
         2 001364   000000 600000 xsid               climb   nvectors=         0

      790    20735        /*S* SCREECH_CODE: KCO-S$CGREOPEN
      791    20736             TYPE:         SNAP
      792    20737             MESSAGE:      Error in re-opening a COMGROUP
      793    20738             DESCRIPTION:  A COMGROUP being re-opened was found to contain
      794    20739                           a recovery page of PTYP not equal to one of the
      795    20740                           following: KQ_PTYP_BAP, KQ_PTYP_DATA, KQ_PTYP_SPARE.
      796    20741        */
      797    20742    5                  END;

      798    20743    4                PG#=PG#+1;

  20743  2 001365   200040 235100                    LDA     PG#,,AUTO
         2 001366   000001 035007                    ADLA    1,DL
         2 001367   200040 755100                    STA     PG#,,AUTO

      799    20744    4                IF PG#>=%CGQ_CHUNK_SIZE THEN

  20744  2 001370   000012 115007                    CMPA    10,DL
         2 001371   001074 602000 2                  TNC     s:20671

      800    20745    5                  DO;

      801    20746    5                  PG#=0;

  20746  2 001372   200040 450100                    STZ     PG#,,AUTO

      802    20747    5                  DESC#=DESC#+1;

  20747  2 001373   200037 235100                    LDA     DESC#,,AUTO
         2 001374   000001 035007                    ADLA    1,DL
         2 001375   200037 755100                    STA     DESC#,,AUTO

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:145  
      803    20748    5                  IF DESC#>%KQM_MDPC# THEN

  20748  2 001376   000032 115007                    CMPA    26,DL
         2 001377   001074 602000 2                  TNC     s:20671

      804    20749    5                   IF KQ$CTLGRAN.RCVRSIZ=0 THEN

  20749  2 001400   200031 470500                    LDP0    CTL$,,AUTO
         2 001401   000007 235100                    LDA     7,,PR0
         2 001402   001404 600000 2                  TZE     RCVR_DONE

      805    20750    5                    GOTO RCVR_DONE;
      806    20751    5                   ELSE
      807    20752    5                    GOTO RCVR_BAD;

  20752  2 001403   001203 710000 2                  TRA     RCVR_BAD

      808    20753    5                  END;
      809    20754    4                END;

      810    20755    3   RCVR_DONE:
      811    20756    3              KQ$CTLGRAN.RCVRDA=0;

  20756  2 001404   000006 450100       RCVR_DONE    STZ     6,,PR0

      812    20757    3              KQ$CTLGRAN.RCVRSIZ=0;

  20757  2 001405   200031 470500                    LDP0    CTL$,,AUTO
         2 001406   000007 450100                    STZ     7,,PR0

      813    20758        /**/
      814    20759    3              CALL KQD$RECOVER (KQ$CG) ALTRET(CGBAD);

  20759  2 001407   200013 630500                    EPPR0   CTX$,,AUTO
         2 001410   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001411   000000 701000 xent               TSX1    KQD$RECOVER
         2 001412   003042 702000 2                  TSX2    CGBAD
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:146  

      815    20760    3              CALL KQT$RECOVER (KQ$CG) ALTRET(CGBAD);

  20760  2 001413   200013 630500                    EPPR0   CTX$,,AUTO
         2 001414   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001415   000000 701000 xent               TSX1    KQT$RECOVER
         2 001416   003042 702000 2                  TSX2    CGBAD

      816    20761    3              STA$=KQ$CG.STREE.HEAD$;

  20761  2 001417   200013 470500                    LDP0    CTX$,,AUTO
         2 001420   000101 236100                    LDQ     65,,PR0
         2 001421   200017 756100                    STQ     STA$,,AUTO

      817    20762    4                DO WHILE (STA$ ~= ADDR(NIL));

  20762  2 001422   001500 710000 2                  TRA     s:20790

      818    20763    4                KQ$STA.LDCT$=ADDR(NIL);

  20763  2 001423   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001424   200017 470500                    LDP0    STA$,,AUTO
         2 001425   000010 756100                    STQ     8,,PR0

      819    20764    4                KQ$STA.SAVLDCT$=ADDR(NIL);

  20764  2 001426   000031 756100                    STQ     25,,PR0

      820    20765    4                KQ$STA.LOCKCNT=0;

  20765  2 001427   000000 236003                    LDQ     0,DU
         2 001430   000020 552104                    STBQ    16,'04'O,PR0

      821    20766    4                KQ$STA.CG$=CTX$;

  20766  2 001431   200013 236100                    LDQ     CTX$,,AUTO
         2 001432   000007 756100                    STQ     7,,PR0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:147  

      822    20767    4                KQ$STA.GATE='1'B;

  20767  2 001433   400000 235003                    LDA     -131072,DU
         2 001434   000000 236003                    LDQ     0,DU
         2 001435   000016 757100                    STAQ    14,,PR0

      823    20768    4                KQ$STA.SUCCREAD='0'B;

  20768  2 001436   000024 236000 3                  LDQ     20
         2 001437   000020 356100                    ANSQ    16,,PR0

      824    20769    4                KQ$STA.TERR='0'B;

  20769  2 001440   000020 356100                    ANSQ    16,,PR0

      825    20770    4                KQ$STA.EVNT='0'B;

  20770  2 001441   000025 236000 3                  LDQ     21
         2 001442   000020 356100                    ANSQ    16,,PR0

      826    20771    4                KQ$STA.EVCNT=0;

  20771  2 001443   000000 236003                    LDQ     0,DU
         2 001444   000023 552140                    STBQ    19,'40'O,PR0

      827    20772    4                KQ$STA.PVGSENSE='0'B;

  20772  2 001445   000026 236000 3                  LDQ     22
         2 001446   000023 356100                    ANSQ    19,,PR0

      828    20773    4                KQ$STA.DSCREQW='0'B;

  20773  2 001447   000027 236000 3                  LDQ     23
         2 001450   000023 356100                    ANSQ    19,,PR0

      829    20774    4                KQ$STA.DSCREQS='0'B;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:148  

  20774  2 001451   000030 236000 3                  LDQ     24
         2 001452   000023 356100                    ANSQ    19,,PR0

      830    20775    4                KQ$STA.OPNBLKED='0'B;

  20775  2 001453   000027 236000 3                  LDQ     23
         2 001454   000023 356100                    ANSQ    19,,PR0

      831    20776    4                KQ$STA.JRNLW='0'B;

  20776  2 001455   000031 236000 3                  LDQ     25
         2 001456   000023 356100                    ANSQ    19,,PR0

      832    20777    4                KQ$STA.DDISC=0;

  20777  2 001457   000032 236000 3                  LDQ     26
         2 001460   000023 356100                    ANSQ    19,,PR0

      833    20778    4                KQ$STA.IDSC='0'B;

  20778  2 001461   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 001462   000020 356100                    ANSQ    16,,PR0

      834    20779    4                KQ$STA.SAVIDSC='0'B;

  20779  2 001463   000033 236000 3                  LDQ     27
         2 001464   000023 356100                    ANSQ    19,,PR0

      835    20780    4                IF KQ$STA.RBLK$ ~= ADDR(NIL) THEN

  20780  2 001465   000011 236100                    LDQ     9,,PR0
         2 001466   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001467   001476 600000 2                  TZE     s:20786

      836    20781    4                 IF KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_PEND# THEN

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:149  
  20781  2 001470   000011 471500                    LDP1    9,,PR0
         2 001471   100001 220100                    LDX0    1,,PR1
         2 001472   000002 100003                    CMPX0   2,DU
         2 001473   001476 601000 2                  TNZ     s:20786

      837    20782                                /* Make pending reads some harmless state
      838    20783                                   so that we don't try to satisfy them
      839    20784                                   during the cleanup KQR$RECOVER phase */
      840    20785    4                  KQ$STA.RBLK$->KQ$RBLK.STATE = KQRS_RSIP#;

  20785  2 001474   000000 221003                    LDX1    0,DU
         2 001475   100001 741100                    STX1    1,,PR1

      841    20786    4                STA$=KQ$STA.BTN.FLINK$;

  20786  2 001476   000004 236100                    LDQ     4,,PR0
         2 001477   200017 756100                    STQ     STA$,,AUTO

      842    20787                        /* DO NOT zap RQLNK$ else messages may
      843    20788                         * be lost (if station is on a DELAY$ chain).
      844    20789                         */
      845    20790    4                END;

  20790  2 001500   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001501   001423 601000 2                  TNZ     s:20763

      846    20791    3              CALL GETGORGO ALTRET(MEMERR);

  20791  2 001502   005055 701000 2                  TSX1    GETGORGO
         2 001503   003014 702000 2                  TSX2    MEMERR

      847    20792    3              CALL KCC$RECOVER(KQ$CG);

  20792  2 001504   200013 630500                    EPPR0   CTX$,,AUTO
         2 001505   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001506   000000 701000 xent               TSX1    KCC$RECOVER
         2 001507   000000 011000                    NOP     0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:150  

      848    20793    3              CALL KQQ$RECOVER(KQ$CG);

  20793  2 001510   200013 630500                    EPPR0   CTX$,,AUTO
         2 001511   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001512   000000 701000 xent               TSX1    KQQ$RECOVER
         2 001513   000000 011000                    NOP     0

      849    20794    3              CALL KQS$RECOVER (KQ$CG) ALTRET(CGBAD);

  20794  2 001514   200013 630500                    EPPR0   CTX$,,AUTO
         2 001515   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001516   000000 701000 xent               TSX1    KQS$RECOVER
         2 001517   003042 702000 2                  TSX2    CGBAD

      850    20795        /**/
      851    20796        /*       ***************************************************
      852    20797                 *                                                 *
      853    20798                 *                                                 *
      854    20799                 *            TURN ON THE CLOCK!!!!                *
      855    20800                 *                                                 *
      856    20801                 ***************************************************
      857    20802
      858    20803                 This is a critical juncture.  Before CLOCK gets set,
      859    20804                 we get no service from KCC$CLOCK and KCC$BASE.  After
      860    20805                 it is set, they will provide service.  This means
      861    20806                 two things:
      862    20807
      863    20808                  o   ALL code before this point must be such that
      864    20809                      it does not require the clock services in
      865    20810                      order to complete.  A good example of how
      866    20811                      to commit suicide by violating this rule
      867    20812                      is given in star #9107, where the call to
      868    20813                      KCO$RCNNCT for each station was in the
      869    20814                      first station loop with the clock turned
      870    20815                      off.  This is a potential deadly embrace
      871    20816                      since KCO$RCNNCT calls KQD$DELDDA and loops
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:151  
      872    20817                      (SSR$REG %SS_SL for one second) until KQD
      873    20818                      can get a defer block to process the request.
      874    20819                      Well, that's suicide with CLOCK off because
      875    20820                      KCC$BASE is required in order to COMP defer
      876    20821                      blocks, so without it you can run out of
      877    20822                      defer blocks forever.
      878    20823
      879    20824                  o   Before turning the clock on, we must clean
      880    20825                      up the comgroup sufficiently to avoid screwing
      881    20826                      up by doing clock processing.  This means
      882    20827                      at minimum a call to KCC$RECOVER to clean up
      883    20828                      this stuff
      884    20829
      885    20830
      886    20831                 There is another reason that setting CLOCK is critical.
      887    20832                 In general, we have the problem when doing comgroup
      888    20833                 reopen of ensuring that once we have done our first
      889    20834                 write from the data cache to disk we then close the
      890    20835                 file properly if there is a crash.  This has a couple
      891    20836                 of implications.  First, we can't do any disk I/O until
      892    20837                 we set a flag to tell recovery to close the CG properly.
      893    20838                 Second, after starting to do disk I/O but before finishing
      894    20839                 the recovery completely, we must act in such a way that
      895    20840                 we can redo the entire recovery after a crash which writes
      896    20841                 out the comgroup.  For various reasons, the flag that
      897    20842                 tells recovery to write the comgroup is CLOCK.  What
      898    20843                 we do, therefore, is write the control granule (thus
      899    20844                 marking the comgroup as 'open' - so that if we crash
      900    20845                 without going thru recovery we'll know upon reopen that
      901    20846                 the comgroup wasn't closed properly).  Then we turn
      902    20847                 on the CLOCK bit.  Thus all recovery phases preceeding
      903    20848                 this are required to not do any disk I/O; all phases
      904    20849                 after this must realize that a crash while they are
      905    20850                 running will write the comgroup as is.
      906    20851
      907    20852        */
      908    20853    3              CALL FMD$WRTBUF (0);  /* Write out the control granule */
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:152  

  20853  2 001520   000002 630400 3                  EPPR0   2
         2 001521   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001522   000000 701000 xent               TSX1    FMD$WRTBUF
         2 001523   000000 011000                    NOP     0

      909    20854    3              KQ$CG.CLOCK='1'B; /* Enable clock */

  20854  2 001524   200013 470500                    LDP0    CTX$,,AUTO
         2 001525   000004 236007                    LDQ     4,DL
         2 001526   000105 256100                    ORSQ    69,,PR0

      910    20855        /**/
      911    20856    3              CALL KQS$RECOVER2 (KQ$CG); /* Finish KQS recovery */

  20856  2 001527   200013 630500                    EPPR0   CTX$,,AUTO
         2 001530   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001531   000000 701000 xent               TSX1    KQS$RECOVER2
         2 001532   000000 011000                    NOP     0

      912    20857        /**/
      913    20858    3              CALL KQX$SETTIME (TIMCHK);

  20858  2 001533   200010 630500                    EPPR0   TIMCHK,,AUTO
         2 001534   200130 450500                    STP0    DA+1,,AUTO
         2 001535   200130 630500                    EPPR0   DA+1,,AUTO
         2 001536   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001537   000000 701000 xent               TSX1    KQX$SETTIME
         2 001540   000000 011000                    NOP     0

      914    20859    3              STA$=KQ$CG.STREE.HEAD$;

  20859  2 001541   200013 470500                    LDP0    CTX$,,AUTO
         2 001542   000101 236100                    LDQ     65,,PR0
         2 001543   200017 756100                    STQ     STA$,,AUTO

      915    20860    4                DO WHILE(STA$~=ADDR(NIL));
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:153  

  20860  2 001544   001653 710000 2                  TRA     s:20880

      916    20861    4                CALL KCO$RCNNCT (KQ$STA);

  20861  2 001545   200017 630500                    EPPR0   STA$,,AUTO
         2 001546   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001547   000000 701000 xent               TSX1    KCO$RCNNCT
         2 001550   000000 011000                    NOP     0

      917    20862    4                CALL KQX$CHKTIME (TIMCHK) ALTRET(RCVR_SLOOP);

  20862  2 001551   200010 630500                    EPPR0   TIMCHK,,AUTO
         2 001552   200130 450500                    STP0    DA+1,,AUTO
         2 001553   200130 630500                    EPPR0   DA+1,,AUTO
         2 001554   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001555   000000 701000 xent               TSX1    KQX$CHKTIME
         2 001556   001571 702000 2                  TSX2    RCVR_SLOOP

      918    20863    4                CALL SSR$REG (%SS_QE);

  20863  2 001557   000035 630400 3                  EPPR0   29
         2 001560   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001561   000000 701000 xent               TSX1    SSR$REG
         2 001562   000000 011000                    NOP     0

      919    20864    4                CALL KQX$SETTIME (TIMCHK);

  20864  2 001563   200010 630500                    EPPR0   TIMCHK,,AUTO
         2 001564   200130 450500                    STP0    DA+1,,AUTO
         2 001565   200130 630500                    EPPR0   DA+1,,AUTO
         2 001566   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001567   000000 701000 xent               TSX1    KQX$SETTIME
         2 001570   000000 011000                    NOP     0

  20861  2 001571                       RCVR_SLOOP   null
      920    20865    4   RCVR_SLOOP:  ;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:154  
      921    20866    4                IF NOT KQ$STA.TERM THEN

  20866  2 001571   200017 470500                    LDP0    STA$,,AUTO
         2 001572   000020 236100                    LDQ     16,,PR0
         2 001573   040000 316003                    CANQ    16384,DU
         2 001574   001602 601000 2                  TNZ     s:20869

      922    20867    4                 CALL KQR$RECOVER(KQ$STA);

  20867  2 001575   200017 630500                    EPPR0   STA$,,AUTO
         2 001576   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001577   000000 701000 xent               TSX1    KQR$RECOVER
         2 001600   000000 011000                    NOP     0
         2 001601   001606 710000 2                  TRA     s:20870

      923    20868    4                ELSE
      924    20869    4                 CALL KQP$RECOVER(KQ$STA);

  20869  2 001602   200017 630500                    EPPR0   STA$,,AUTO
         2 001603   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001604   000000 701000 xent               TSX1    KQP$RECOVER
         2 001605   000000 011000                    NOP     0

      925    20870    4                ACCT$=KQ$STA.BTN.FLINK$;

  20870  2 001606   200017 470500                    LDP0    STA$,,AUTO
         2 001607   000004 236100                    LDQ     4,,PR0
         2 001610   200025 756100                    STQ     ACCT$,,AUTO

      926    20871    4                IF SUBSTR (KQ$STA.BTN.KEY,0,1) ~= '*' THEN

  20871  2 001611   000005 236100                    LDQ     5,,PR0
         2 001612   777000 376003                    ANQ     -512,DU
         2 001613   052000 116003                    CMPQ    21504,DU
         2 001614   001651 600000 2                  TZE     s:20879

      927    20872    5                  DO;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:155  

      928    20873    5                  IF STA$ ~= KQ$CG.JRNLSTA$ THEN

  20873  2 001615   200013 471500                    LDP1    CTX$,,AUTO
         2 001616   200017 236100                    LDQ     STA$,,AUTO
         2 001617   100210 116100                    CMPQ    136,,PR1
         2 001620   001637 600000 2                  TZE     s:20876

      929    20874    5                   IF NOT KQ$CG.AUCTL.SMD THEN

  20874  2 001621   100133 236100                    LDQ     91,,PR1
         2 001622   000002 316007                    CANQ    2,DL
         2 001623   001637 601000 2                  TNZ     s:20876

      930    20875    5                    CALL KQL$DELMLH (KQ$CG,ADDR(KQ$STA.MLH));

  20875  2 001624   200017 236100                    LDQ     STA$,,AUTO
         2 001625   000034 036003                    ADLQ    28,DU
         2 001626   200130 756100                    STQ     DA+1,,AUTO
         2 001627   200130 633500                    EPPR3   DA+1,,AUTO
         2 001630   200133 453500                    STP3    DA+4,,AUTO
         2 001631   200013 236100                    LDQ     CTX$,,AUTO
         2 001632   200132 756100                    STQ     DA+3,,AUTO
         2 001633   200132 630500                    EPPR0   DA+3,,AUTO
         2 001634   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001635   000000 701000 xent               TSX1    KQL$DELMLH
         2 001636   000000 011000                    NOP     0

      931    20876    5                  SCRATCH$=STA$;

  20876  2 001637   200017 236100                    LDQ     STA$,,AUTO
         2 001640   200116 756100                    STQ     SCRATCH$,,AUTO

      932    20877    5                  CALL KQT$DELSTA (KQ$CG,SCRATCH$);

  20877  2 001641   200116 630500                    EPPR0   SCRATCH$,,AUTO
         2 001642   200131 450500                    STP0    DA+2,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:156  
         2 001643   200013 236100                    LDQ     CTX$,,AUTO
         2 001644   200130 756100                    STQ     DA+1,,AUTO
         2 001645   200130 630500                    EPPR0   DA+1,,AUTO
         2 001646   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001647   000000 701000 xent               TSX1    KQT$DELSTA
         2 001650   000000 011000                    NOP     0

      933    20878    5                  END;

      934    20879    4                STA$=ACCT$;

  20879  2 001651   200025 236100                    LDQ     ACCT$,,AUTO
         2 001652   200017 756100                    STQ     STA$,,AUTO

      935    20880    4                END;

  20880  2 001653   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001654   001545 601000 2                  TNZ     s:20861

      936    20881        /**/
      937    20882    3              CALL KQQ$RECOVER2(KQ$CG);

  20882  2 001655   200013 630500                    EPPR0   CTX$,,AUTO
         2 001656   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001657   000000 701000 xent               TSX1    KQQ$RECOVER2
         2 001660   000000 011000                    NOP     0

      938    20883        /**/
      939    20884    3              KQ$CG.RCVR='0'B;

  20884  2 001661   200013 470500                    LDP0    CTX$,,AUTO
         2 001662   000036 236000 3                  LDQ     30
         2 001663   000105 356100                    ANSQ    69,,PR0

      940    20885        /**/
      941    20886    3              GOTO ENDSETUP; /* Finish setting up */

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:157  
  20886  2 001664   000342 710000 2                  TRA     ENDSETUP

      942    20887        /**/
      943    20888    3              END;
      944    20889        /**/
      945    20890    2            ELSE
      946    20891    3              DO;

      947    20892    3              CALL FMD$WRTBUF(0); /* Get rid of CTLGRAN */

  20892  2 001665   000002 630400 3                  EPPR0   2
         2 001666   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001667   000000 701000 xent               TSX1    FMD$WRTBUF
         2 001670   000000 011000                    NOP     0

      948    20893    3              B$JIT.ERR=ERRCGNOCLS;

  20893  2 001671   000071 236000 1                  LDQ     ERRCGNOCLS
         2 001672   000000 470400 xsym               LDP0    B$JIT$
         2 001673   000012 756100                    STQ     10,,PR0

      949    20894    3              GOTO ERR;

  20894  2 001674   003052 710000 2                  TRA     ERR

      950    20895    3              END;
      951    20896        /*E*    ERROR: KCO-E$CGNOCLS-2
      952    20897                MESSAGE: Comgroup% %UF% was never closed properly
      953    20898                MESSAGE1: It is not possible to open a comgroup that was
      954    20899                          never properly closed.  The only way this should
      955    20900                          ever occur is if the system crashes and recovery fails.
      956    20901        */
      957    20902    2            END; /* Re-open a closed comgroup */
      958    20903        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:158  
      959    20904                   /******************************************************
      960    20905                    *                                                    *
      961    20906                    *          RESUME COMMON CODE FOR ALL OPENS          *
      962    20907                    *                                                    *
      963    20908                    ******************************************************/
      964    20909
      965    20910    1         IF NOT KQ$CG.AUCTL.DCBCONLGL AND NOT F$DCB.AU AND OPNTYP~=%CREATE# THEN

  20910  2 001675   200013 470500                    LDP0    CTX$,,AUTO
         2 001676   000136 236100                    LDQ     94,,PR0
         2 001677   000020 316003                    CANQ    16,DU
         2 001700   001714 601000 2                  TNZ     s:20919
         2 001701   200007 471500                    LDP1    JDCB$,,AUTO
         2 001702   100031 236100                    LDQ     25,,PR1
         2 001703   200000 316003                    CANQ    65536,DU
         2 001704   001714 601000 2                  TNZ     s:20919
         2 001705   200032 235100                    LDA     OPNTYP,,AUTO
         2 001706   000003 115007                    CMPA    3,DL
         2 001707   001714 600000 2                  TZE     s:20919

      966    20911    2           DO;

      967    20912    2           B$JIT.ERR=ERRNDCBCG;

  20912  2 001710   000065 236000 1                  LDQ     ERRNDCBCG
         2 001711   000000 473400 xsym               LDP3    B$JIT$
         2 001712   300012 756100                    STQ     10,,PR3

      968    20913    2           GOTO ERR;

  20913  2 001713   003052 710000 2                  TRA     ERR

      969    20914    2           END;
      970    20915        /*E*     ERROR: KCO-E$NDCBCG-2
      971    20916                 MESSAGE: DCBs are not allowed to connect to this comgroup
      972    20917        */
      973    20918        /**/
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:159  
      974    20919    1         IF JDCB$=B$M$UC$ THEN

  20919  2 001714   200007 236100                    LDQ     JDCB$,,AUTO
         2 001715   000000 116000 xsym               CMPQ    B$M$UC$
         2 001716   001755 601000 2                  TNZ     s:20938

      975    20920    2           DO;

      976    20921    2           IF B$JIT.MODE=%M_TP# THEN

  20921  2 001717   000000 471400 xsym               LDP1    B$JIT$
         2 001720   100000 236100                    LDQ     0,,PR1
         2 001721   740000 376003                    ANQ     -16384,DU
         2 001722   200000 116003                    CMPQ    65536,DU
         2 001723   001732 601000 2                  TNZ     s:20927

      977    20922    3             DO;

      978    20923    3             F$DCB.MEDIA=FMTCG#;

  20923  2 001724   200007 473500                    LDP3    JDCB$,,AUTO
         2 001725   000010 236003                    LDQ     8,DU
         2 001726   300103 552120                    STBQ    67,'20'O,PR3

      979    20924    3             F$DCB.DDEV.IC='0'B;

  20924  2 001727   000037 236000 3                  LDQ     31
         2 001730   300004 356100                    ANSQ    4,,PR3

      980    20925    3             END;

  20925  2 001731   001737 710000 2                  TRA     s:20930

      981    20926    3           ELSE DO;

      982    20927    3             F$DCB.MEDIA=FMTOCCG#;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:160  
  20927  2 001732   200007 473500                    LDP3    JDCB$,,AUTO
         2 001733   000015 236003                    LDQ     13,DU
         2 001734   300103 552120                    STBQ    67,'20'O,PR3

      983    20928    3             F$DCB.DDEV.IC='1'B;

  20928  2 001735   100000 236007                    LDQ     32768,DL
         2 001736   300004 256100                    ORSQ    4,,PR3

      984    20929    3             END;

      985    20930    2           F$DCB.DDEV.UCOUT='1'B;

  20930  2 001737   200007 473500                    LDP3    JDCB$,,AUTO
         2 001740   020000 236007                    LDQ     8192,DL
         2 001741   300004 256100                    ORSQ    4,,PR3

      986    20931    2           F$DCB.WIDTH=F$DCB.RECL;

  20931  2 001742   200007 473500                    LDP3    JDCB$,,AUTO
         2 001743   300033 236100                    LDQ     27,,PR3
         2 001744   300004 552104                    STBQ    4,'04'O,PR3

      987    20932    2           F$DCB.RECL=0;

  20932  2 001745   000000 220003                    LDX0    0,DU
         2 001746   200007 473500                    LDP3    JDCB$,,AUTO
         2 001747   300033 440100                    SXL0    27,,PR3

      988    20933    2           F$DCB.UCOUT='1'B;

  20933  2 001750   001000 236003                    LDQ     512,DU
         2 001751   300067 256100                    ORSQ    55,,PR3

      989    20934    2           F$DCB.LSTAOR='1'B;

  20934  2 001752   004000 236003                    LDQ     2048,DU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:161  
         2 001753   300031 256100                    ORSQ    25,,PR3

      990    20935    2           END;

  20935  2 001754   002062 710000 2                  TRA     s:20961

      991    20936    1         ELSE
      992    20937    2           DO;

      993    20938    2           IF F$DCB.ASN~=%DEVICE# THEN

  20938  2 001755   200007 471500                    LDP1    JDCB$,,AUTO
         2 001756   100032 236100                    LDQ     26,,PR1
         2 001757   777000 376007                    ANQ     -512,DL
         2 001760   003000 116007                    CMPQ    1536,DL
         2 001761   002055 600000 2                  TZE     s:20957

      994    20939    3             DO;  /* Not TP - TP checks are in FSN$OPNDEV */

      995    20940    3             IF F$DCB.LASTSTA$=ADDR(NIL) THEN

  20940  2 001762   100007 236100                    LDQ     7,,PR1
         2 001763   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001764   002014 601000 2                  TNZ     s:20949

      996    20941    4               DO;

      997    20942    4               CALL FSA$GSP(SIZEW(VLP$STATION)+SIZEW(VLP$SETSTA),

  20942  2 001765   200007 236100                    LDQ     JDCB$,,AUTO
         2 001766   000007 036003                    ADLQ    7,DU
         2 001767   000041 235000 3                  LDA     33
         2 001770   200130 757100                    STAQ    DA+1,,AUTO
         2 001771   200130 630500                    EPPR0   DA+1,,AUTO
         2 001772   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001773   000000 701000 xent               TSX1    FSA$GSP
         2 001774   003052 702000 2                  TSX2    ERR
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:162  

      998    20943    4               F$DCB.LASTSTA$) ALTRET(ERR);
      999    20944    4               F$DCB.SETSTA$=PINCRW(F$DCB.LASTSTA$,SIZEW(VLP$STATION));

  20944  2 001775   200007 470500                    LDP0    JDCB$,,AUTO
         2 001776   000007 236100                    LDQ     7,,PR0
         2 001777   000010 036003                    ADLQ    8,DU
         2 002000   000006 756100                    STQ     6,,PR0

     1000    20945    4               F$DCB.SETSTA$->VLP$SETSTA=KC_VLPSETSTA;

  20945  2 002001   200007 470500                    LDP0    JDCB$,,AUTO
         2 002002   000006 471500                    LDP1    6,,PR0
         2 002003   000100 100400                    MLR     fill='000'O
         2 002004   000000 000060 xsym               ADSC9   KC_VLPSETSTA             cn=0,n=48
         2 002005   100000 000060                    ADSC9   0,,PR1                   cn=0,n=48

     1001    20946    4               F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#=' ';

  20946  2 002006   200007 470500                    LDP0    JDCB$,,AUTO
         2 002007   000006 471500                    LDP1    6,,PR0
         2 002010   000035 235000 xsym               LDA     B_VECTNIL+29
         2 002011   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 002012   100000 755100                    STA     0,,PR1
         2 002013   100001 756100                    STQ     1,,PR1

     1002    20947    4               END;

     1003    20948        /**/
     1004    20949    3            CALL KCI$VALSTA1 (F$DCB.SETSTA$->VLP$SETSTA.ISTA,KQ$CG.SETSTA.ISTA) ALTRET
             20949                      (ERR);

  20949  2 002014   200007 470500                    LDP0    JDCB$,,AUTO
         2 002015   000006 471500                    LDP1    6,,PR0
         2 002016   200013 236100                    LDQ     CTX$,,AUTO
         2 002017   000153 036003                    ADLQ    107,DU
         2 002020   200131 756100                    STQ     DA+2,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:163  
         2 002021   100002 633500                    EPPR3   2,,PR1
         2 002022   200130 453500                    STP3    DA+1,,AUTO
         2 002023   200130 630500                    EPPR0   DA+1,,AUTO
         2 002024   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002025   000000 701000 xent               TSX1    KCI$VALSTA1
         2 002026   003052 702000 2                  TSX2    ERR

     1005    20950    3            CALL KCI$VALSTA1 (F$DCB.SETSTA$->VLP$SETSTA.OSTA,KQ$CG.SETSTA.OSTA) ALTRET
             20950                      (ERR);

  20950  2 002027   200007 470500                    LDP0    JDCB$,,AUTO
         2 002030   000006 471500                    LDP1    6,,PR0
         2 002031   200013 236100                    LDQ     CTX$,,AUTO
         2 002032   000160 036003                    ADLQ    112,DU
         2 002033   200131 756100                    STQ     DA+2,,AUTO
         2 002034   100007 633500                    EPPR3   7,,PR1
         2 002035   200130 453500                    STP3    DA+1,,AUTO
         2 002036   200130 630500                    EPPR0   DA+1,,AUTO
         2 002037   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002040   000000 701000 xent               TSX1    KCI$VALSTA1
         2 002041   003052 702000 2                  TSX2    ERR

     1006    20951        /**/
     1007    20952    3             CALL VALIDATE(F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#) ALTRET(BADSTA);

  20952  2 002042   200007 470500                    LDP0    JDCB$,,AUTO
         2 002043   000006 471500                    LDP1    6,,PR0
         2 002044   200121 451500                    STP1    SCRATCH$+3,,AUTO
         2 002045   004605 701000 2                  TSX1    VALIDATE
         2 002046   003036 702000 2                  TSX2    BADSTA

     1008    20953    3             IF SUBSTR(F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#,0,1)='&' THEN

  20953  2 002047   200007 470500                    LDP0    JDCB$,,AUTO
         2 002050   000006 471500                    LDP1    6,,PR0
         2 002051   100000 236100                    LDQ     0,,PR1
         2 002052   777000 376003                    ANQ     -512,DU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:164  
         2 002053   046000 116003                    CMPQ    19456,DU
         2 002054   003036 600000 2                  TZE     BADSTA

     1009    20954    3              GOTO BADSTA;
     1010    20955    3             END;

     1011    20956        /**/
     1012    20957    2           F$DCB.MEDIA=FMTCG#;

  20957  2 002055   200007 470500                    LDP0    JDCB$,,AUTO
         2 002056   000010 236003                    LDQ     8,DU
         2 002057   000103 552120                    STBQ    67,'20'O,PR0

     1013    20958    2           F$DCB.IWL='77'O;

  20958  2 002060   770000 236007                    LDQ     -4096,DL
         2 002061   000103 752104                    STCQ    67,'04'O,PR0

     1014    20959    2           END;

     1015    20960        /**/
     1016    20961    1         F$DCB.LASTSTA$->VLP$STATION=KC_VLPSTATION;

  20961  2 002062   200007 470500                    LDP0    JDCB$,,AUTO
         2 002063   000007 471500                    LDP1    7,,PR0
         2 002064   000100 100400                    MLR     fill='000'O
         2 002065   000000 000040 xsym               ADSC9   KC_VLPSTATION            cn=0,n=32
         2 002066   100000 000040                    ADSC9   0,,PR1                   cn=0,n=32

     1017    20962        /**/
     1018    20963    1         IF F$DCB.ASN~=%DEVICE# THEN

  20963  2 002067   200007 470500                    LDP0    JDCB$,,AUTO
         2 002070   000032 236100                    LDQ     26,,PR0
         2 002071   777000 376007                    ANQ     -512,DL
         2 002072   003000 116007                    CMPQ    1536,DL
         2 002073   002166 600000 2                  TZE     s:20983
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:165  

     1019    20964    2           DO;

     1020    20965    2           CALL NKL$GETDCT(SCRATCH$) ALTRET(NOLDCT);

  20965  2 002074   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 002075   200130 451500                    STP1    DA+1,,AUTO
         2 002076   200130 630500                    EPPR0   DA+1,,AUTO
         2 002077   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002100   000000 701000 xent               TSX1    NKL$GETDCT
         2 002101   002771 702000 2                  TSX2    NOLDCT

     1021    20966    2           LDCT$=SCRATCH$;

  20966  2 002102   200116 236100                    LDQ     SCRATCH$,,AUTO
         2 002103   200016 756100                    STQ     LDCT$,,AUTO

     1022    20967    2           IF F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#=' ' THEN

  20967  2 002104   200007 470500                    LDP0    JDCB$,,AUTO
         2 002105   000006 471500                    LDP1    6,,PR0
         2 002106   040000 106500                    CMPC    fill='040'O
         2 002107   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         2 002110   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 002111   002132 601000 2                  TNZ     s:20973

     1023    20968    3             DO;

     1024    20969    3             CALL BINCHAR(STR6,NK$LDCT.LDCTX);

  20969  2 002112   200016 473500                    LDP3    LDCT$,,AUTO
         2 002113   300006 236100                    LDQ     6,,PR3
         2 002114   000022 772000                    QRL     18
         2 002115   000000 235003                    LDA     0,DU
         2 002116   200130 757100                    STAQ    DA+1,,AUTO
         2 002117   000100 301500                    BTD
         2 002120   200130 000010                    NDSC9   DA+1,,AUTO               cn=0,s=lsgnf,sf=0,n=8
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:166  
         2 002121   200014 030006                    NDSC9   STR6,,AUTO               cn=0,s=nosgn,sf=0,n=6

     1025    20970    3             CALL INSERT(F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#,0,2,'&&');

  20970  2 002122   000006 471500                    LDP1    6,,PR0
         2 002123   000104 220000 1                  LDX0    ERRCGORAU+5
         2 002124   100000 740100                    STX0    0,,PR1

     1026    20971    3             CALL INSERT(F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#,2,6,STR6);

  20971  2 002125   200007 470500                    LDP0    JDCB$,,AUTO
         2 002126   000006 471500                    LDP1    6,,PR0
         2 002127   040100 100500                    MLR     fill='040'O
         2 002130   200014 000006                    ADSC9   STR6,,AUTO               cn=0,n=6
         2 002131   100000 400006                    ADSC9   0,,PR1                   cn=2,n=6

     1027    20972    3             END;

     1028    20973    2           NK$LDCT.DFLG.LOCAL = '1'B;

  20973  2 002132   200016 470500                    LDP0    LDCT$,,AUTO
         2 002133   002000 236007                    LDQ     1024,DL
         2 002134   000006 256100                    ORSQ    6,,PR0

     1029    20974    2           NK$LDCT.RESCOD=NK_CGDCB;

  20974  2 002135   000006 236100                    LDQ     6,,PR0
         2 002136   000042 376000 3                  ANQ     34
         2 002137   000004 276007                    ORQ     4,DL
         2 002140   000006 756100                    STQ     6,,PR0

     1030    20975    2           NK$LDCT.DEVNM=F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#;

  20975  2 002141   200007 471500                    LDP1    JDCB$,,AUTO
         2 002142   100006 473500                    LDP3    6,,PR1
         2 002143   040100 100500                    MLR     fill='040'O
         2 002144   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:167  
         2 002145   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8

     1031    20976    2           NK$LDCT.CG$=CTX$;

  20976  2 002146   200013 236100                    LDQ     CTX$,,AUTO
         2 002147   000027 756100                    STQ     23,,PR0

     1032    20977    2           NK$LDCT.DCBNO=B$JIT.DCBNO;

  20977  2 002150   000000 471400 xsym               LDP1    B$JIT$
         2 002151   100022 236100                    LDQ     18,,PR1
         2 002152   000014 552104                    STBQ    12,'04'O,PR0

     1033    20978    2           NK$LDCT.USER=B$JIT.USER;

  20978  2 002153   100000 236100                    LDQ     0,,PR1
         2 002154   000007 552120                    STBQ    7,'20'O,PR0

     1034    20979    2           NK$LDCT.DFLG.INPUT='1'B;

  20979  2 002155   400000 236007                    LDQ     -131072,DL
         2 002156   000006 256100                    ORSQ    6,,PR0

     1035    20980    2           IF F$DCB.FUN~=%IN# THEN

  20980  2 002157   200007 473500                    LDP3    JDCB$,,AUTO
         2 002160   300032 236100                    LDQ     26,,PR3
         2 002161   000777 376003                    ANQ     511,DU
         2 002162   000002 116003                    CMPQ    2,DU
         2 002163   002166 600000 2                  TZE     s:20983

     1036    20981    2            NK$LDCT.DFLG.OUTPUT='1'B;

  20981  2 002164   200000 236007                    LDQ     65536,DL
         2 002165   000006 256100                    ORSQ    6,,PR0

     1037    20982    2           END;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:168  

     1038    20983    1         KEY=F$DCB.SETSTA$->VLP$SETSTA.MYSTATION#;

  20983  2 002166   200007 470500                    LDP0    JDCB$,,AUTO
         2 002167   000006 471500                    LDP1    6,,PR0
         2 002170   040100 100500                    MLR     fill='040'O
         2 002171   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         2 002172   200022 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

     1039    20984    1         IF KQ_LOG.DSIO THEN

  20984  2 002173   000000 236000 xsym               LDQ     KQ_LOG
         2 002174   002000 316003                    CANQ    1024,DU
         2 002175   002215 600000 2                  TZE     s:20987

     1040    20985    1         CALL KQZ$LOG (KQ$CG,%KQLOG_DORQ,S_CUN,0,JDCB$,SUBSTR(KEY,0,4),SUBSTR(KEY,4,4)
             20985                   );

  20985  2 002176   200023 631500                    EPPR1   KEY+1,,AUTO
         2 002177   200136 451500                    STP1    DA+7,,AUTO
         2 002200   200022 633500                    EPPR3   KEY,,AUTO
         2 002201   200135 453500                    STP3    DA+6,,AUTO
         2 002202   200007 634500                    EPPR4   JDCB$,,AUTO
         2 002203   200134 454500                    STP4    DA+5,,AUTO
         2 002204   000044 237000 3                  LDAQ    36
         2 002205   200132 757100                    STAQ    DA+3,,AUTO
         2 002206   000046 236000 3                  LDQ     38
         2 002207   200013 235100                    LDA     CTX$,,AUTO
         2 002210   200130 757100                    STAQ    DA+1,,AUTO
         2 002211   200130 630500                    EPPR0   DA+1,,AUTO
         2 002212   000025 631400 xsym               EPPR1   B_VECTNIL+21
         2 002213   000000 701000 xent               TSX1    KQZ$LOG
         2 002214   000000 011000                    NOP     0

     1041    20986        /**/
     1042    20987    1         IF NOT F$DCB.AU AND F$DCB.ASN~=%DEVICE# THEN

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:169  
  20987  2 002215   200007 470500                    LDP0    JDCB$,,AUTO
         2 002216   000031 236100                    LDQ     25,,PR0
         2 002217   200000 316003                    CANQ    65536,DU
         2 002220   002227 601000 2                  TNZ     s:20990
         2 002221   000032 236100                    LDQ     26,,PR0
         2 002222   777000 376007                    ANQ     -512,DL
         2 002223   003000 116007                    CMPQ    1536,DL
         2 002224   002227 600000 2                  TZE     s:20990

     1043    20988    1          CALL CNNCTINFO ALTRET(MEMERR);

  20988  2 002225   004136 701000 2                  TSX1    CNNCTINFO
         2 002226   003014 702000 2                  TSX2    MEMERR

     1044    20989        /**/
     1045    20990    1         CALL SLOCK;

  20990  2 002227   004623 701000 2                  TSX1    SLOCK
         2 002230   000000 011000                    NOP     0

     1046    20991    1         IF  S_CUN = JG_JAYS#

  20991  2 002231   000000 235000 xsym               LDA     S_CUN
         2 002232   000015 115007                    CMPA    13,DL
         2 002233   002251 601000 2                  TNZ     s:20996
         2 002234   040000 106500                    CMPC    fill='040'O
         2 002235   200022 000010                    ADSC9   KEY,,AUTO                cn=0,n=8
         2 002236   000105 000007 1                  ADSC9   ERRCGORAU+6              cn=0,n=7
         2 002237   002251 601000 2                  TNZ     s:20996

     1047    20992    1         AND KEY = 'JRNLSTA' THEN
     1048    20993    1          IF KQ$CG.JRNLSTA$ = ADDR(NIL) THEN GOTO STANOTALLWD;

  20993  2 002240   200013 470500                    LDP0    CTX$,,AUTO
         2 002241   000210 236100                    LDQ     136,,PR0
         2 002242   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002243   003020 600000 2                  TZE     STANOTALLWD
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:170  

     1049    20994    1          ELSE IF KQ$CG.JRNLSTA$->KQ$STA.BTN.KEY ~= 'JRNLSTA' THEN

  20994  2 002244   000210 471500                    LDP1    136,,PR0
         2 002245   040000 106500                    CMPC    fill='040'O
         2 002246   100005 000010                    ADSC9   5,,PR1                   cn=0,n=8
         2 002247   000105 000007 1                  ADSC9   ERRCGORAU+6              cn=0,n=7
         2 002250   003020 601000 2                  TNZ     STANOTALLWD

     1050    20995    1            GOTO STANOTALLWD;
     1051    20996    1         CALL KQB$SRCH(KQ$CG.STREE,KEY,SCRATCH$) ALTRET(GETSTA);

  20996  2 002251   200116 630500                    EPPR0   SCRATCH$,,AUTO
         2 002252   200132 450500                    STP0    DA+3,,AUTO
         2 002253   200022 631500                    EPPR1   KEY,,AUTO
         2 002254   200131 451500                    STP1    DA+2,,AUTO
         2 002255   200013 236100                    LDQ     CTX$,,AUTO
         2 002256   000075 036003                    ADLQ    61,DU
         2 002257   200130 756100                    STQ     DA+1,,AUTO
         2 002260   200130 630500                    EPPR0   DA+1,,AUTO
         2 002261   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002262   000000 701000 xent               TSX1    KQB$SRCH
         2 002263   002267 702000 2                  TSX2    GETSTA

     1052    20997    1         STA$=SCRATCH$;

  20997  2 002264   200116 236100                    LDQ     SCRATCH$,,AUTO
         2 002265   200017 756100                    STQ     STA$,,AUTO

     1053    20998    1         GOTO STAFND;

  20998  2 002266   002323 710000 2                  TRA     STAFND

  20997  2 002267                       GETSTA       null
     1054    20999    1   GETSTA: ;
     1055    21000    1         IF NOT KQ$CG.AUCTL.XSTALGL THEN

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:171  
  21000  2 002267   200013 470500                    LDP0    CTX$,,AUTO
         2 002270   000133 236100                    LDQ     91,,PR0
         2 002271   000020 316007                    CANQ    16,DL
         2 002272   003020 600000 2                  TZE     STANOTALLWD

     1056    21001    1          GOTO STANOTALLWD;
     1057    21002    1         STA$=KQ$CG.GORGOSTA$;

  21002  2 002273   000207 236100                    LDQ     135,,PR0
         2 002274   200017 756100                    STQ     STA$,,AUTO

     1058    21003    1         CALL STALOCK;

  21003  2 002275   004647 701000 2                  TSX1    STALOCK
         2 002276   000000 011000                    NOP     0

     1059    21004    1         STA$->KQ$STA.USR#=S_CUN;

  21004  2 002277   200017 470500                    LDP0    STA$,,AUTO
         2 002300   000000 236000 xsym               LDQ     S_CUN
         2 002301   000011 736000                    QLS     9
         2 002302   000020 552110                    STBQ    16,'10'O,PR0

     1060    21005    1         CALL STAUNLOCK;

  21005  2 002303   004661 701000 2                  TSX1    STAUNLOCK
         2 002304   000000 011000                    NOP     0

     1061    21006    1         SCRATCH$=STA$;

  21006  2 002305   200017 236100                    LDQ     STA$,,AUTO
         2 002306   200116 756100                    STQ     SCRATCH$,,AUTO

     1062    21007    1         CALL KQT$GETSTA (KQ$CG,SCRATCH$,KEY) ALTRET(MEMERR);

  21007  2 002307   200022 630500                    EPPR0   KEY,,AUTO
         2 002310   200132 450500                    STP0    DA+3,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:172  
         2 002311   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 002312   200131 451500                    STP1    DA+2,,AUTO
         2 002313   200013 236100                    LDQ     CTX$,,AUTO
         2 002314   200130 756100                    STQ     DA+1,,AUTO
         2 002315   200130 630500                    EPPR0   DA+1,,AUTO
         2 002316   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002317   000000 701000 xent               TSX1    KQT$GETSTA
         2 002320   003014 702000 2                  TSX2    MEMERR

     1063    21008    1         STA$=SCRATCH$;

  21008  2 002321   200116 236100                    LDQ     SCRATCH$,,AUTO
         2 002322   200017 756100                    STQ     STA$,,AUTO

  21008  2 002323                       STAFND       null
     1064    21009        /**/
     1065    21010    1   STAFND:;
     1066    21011    1         CALL STALOCK;

  21011  2 002323   004647 701000 2                  TSX1    STALOCK
         2 002324   000000 011000                    NOP     0

     1067    21012    1         IF KQ$STA.LDCT$~=ADDR(NIL) OR KQ$STA.IDSC THEN

  21012  2 002325   200017 470500                    LDP0    STA$,,AUTO
         2 002326   000010 236100                    LDQ     8,,PR0
         2 002327   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002330   002333 601000 2                  TNZ     s:21013
         2 002331   000020 234100                    SZN     16,,PR0
         2 002332   002354 605000 2                  TPL     s:21023

     1068    21013    1          IF F$DCB.ASN~=%DEVICE# THEN

  21013  2 002333   200007 471500                    LDP1    JDCB$,,AUTO
         2 002334   100032 236100                    LDQ     26,,PR1
         2 002335   777000 376007                    ANQ     -512,DL
         2 002336   003000 116007                    CMPQ    1536,DL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:173  
         2 002337   002775 601000 2                  TNZ     DUPNM

     1069    21014    1           GOTO DUPNM;
     1070    21015    1          ELSE
     1071    21016    2            DO;  /* Non-streamed comgroup */

     1072    21017    2            KQ$STA.DCBCNT=KQ$STA.DCBCNT+1;

  21017  2 002340   001000 236003                    LDQ     512,DU
         2 002341   000023 056100                    ASQ     19,,PR0

     1073    21018    2            CALL STAUNLOCK;

  21018  2 002342   004661 701000 2                  TSX1    STAUNLOCK
         2 002343   000000 011000                    NOP     0

     1074    21019    2            CALL SUNLOCK;

  21019  2 002344   004635 701000 2                  TSX1    SUNLOCK
         2 002345   000000 011000                    NOP     0

     1075    21020    2            F$DCB.LDCTX=KQ$STA.LDCT$->NK$LDCT.LDCTX;

  21020  2 002346   200017 470500                    LDP0    STA$,,AUTO
         2 002347   000010 471500                    LDP1    8,,PR0
         2 002350   100006 220100                    LDX0    6,,PR1
         2 002351   200007 473500                    LDP3    JDCB$,,AUTO
         2 002352   300051 740100                    STX0    41,,PR3

     1076    21021    2            RETURN;

  21021  2 002353   000000 702200 xent               TSX2  ! X66_ARET

     1077    21022    2            END;
     1078    21023    1         IF NOT KQ$CG.AUCTL.XSTALGL AND NOT KQ$STA.PERM THEN

  21023  2 002354   200013 471500                    LDP1    CTX$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:174  
         2 002355   100133 236100                    LDQ     91,,PR1
         2 002356   000020 316007                    CANQ    16,DL
         2 002357   002366 601000 2                  TNZ     s:21028
         2 002360   000020 236100                    LDQ     16,,PR0
         2 002361   020000 316003                    CANQ    8192,DU
         2 002362   002366 601000 2                  TNZ     s:21028

     1079    21024    2           DO;

     1080    21025    2           CALL STAUNLOCK;

  21025  2 002363   004661 701000 2                  TSX1    STAUNLOCK
         2 002364   000000 011000                    NOP     0

     1081    21026    2           GOTO STANOTALLWD;

  21026  2 002365   003020 710000 2                  TRA     STANOTALLWD

     1082    21027    2           END;
     1083    21028    1         IF KQ$STA.AUP THEN  /* This station may only be opened by the AU */

  21028  2 002366   000023 236100                    LDQ     19,,PR0
         2 002367   400000 316007                    CANQ    -131072,DL
         2 002370   002401 600000 2                  TZE     s:21037

     1084    21029    1          IF KQ$CG.AU ~= S_CUN AND NOT F$DCB.AU THEN

  21029  2 002371   100122 236100                    LDQ     82,,PR1
         2 002372   000033 772000                    QRL     27
         2 002373   000000 116000 xsym               CMPQ    S_CUN
         2 002374   002401 600000 2                  TZE     s:21037
         2 002375   200007 473500                    LDP3    JDCB$,,AUTO
         2 002376   300031 236100                    LDQ     25,,PR3
         2 002377   200000 316003                    CANQ    65536,DU
         2 002400   003026 600000 2                  TZE     PRIVSTA

     1085    21030    1           GOTO PRIVSTA;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:175  
     1086    21031        /**/
     1087    21032        /**/
     1088    21033        /**/
     1089    21034                     /*    Now connect the DCB to the
     1090    21035                      *    comgroup.
     1091    21036                      */
     1092    21037    1         KQ$STA.LDCT$=LDCT$;

  21037  2 002401   200016 236100                    LDQ     LDCT$,,AUTO
         2 002402   000010 756100                    STQ     8,,PR0

     1093    21038    1         KQ$STA.TERM='0'B;

  21038  2 002403   000047 236000 3                  LDQ     39
         2 002404   000020 356100                    ANSQ    16,,PR0

     1094    21039    1         KQ$STA.USR#=S_CUN;

  21039  2 002405   000000 236000 xsym               LDQ     S_CUN
         2 002406   000011 736000                    QLS     9
         2 002407   000020 552110                    STBQ    16,'10'O,PR0

     1095    21040    1         CALL STAINIT;

  21040  2 002410   004074 701000 2                  TSX1    STAINIT
         2 002411   000000 011000                    NOP     0

     1096    21041    1         KQ$STA.DCBCNT=1;

  21041  2 002412   200017 470500                    LDP0    STA$,,AUTO
         2 002413   001000 236003                    LDQ     512,DU
         2 002414   000023 552140                    STBQ    19,'40'O,PR0

     1097    21042    1         NK$LDCT.STA$=STA$;

  21042  2 002415   200017 236100                    LDQ     STA$,,AUTO
         2 002416   200016 471500                    LDP1    LDCT$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:176  
         2 002417   100012 756100                    STQ     10,,PR1

     1098    21043    1         IF NOT F$DCB.AU THEN

  21043  2 002420   200007 473500                    LDP3    JDCB$,,AUTO
         2 002421   300031 236100                    LDQ     25,,PR3
         2 002422   200000 316003                    CANQ    65536,DU
         2 002423   002431 601000 2                  TNZ     s:21049

     1099    21044    2           DO;

     1100    21045    2           KQ$STA.CNNCTDDA=CNNCT.DDA;

  21045  2 002424   200034 235100                    LDA     CNNCT,,AUTO
         2 002425   000021 755100                    STA     17,,PR0

     1101    21046    2           CNNCT.DDA=0;

  21046  2 002426   200034 450100                    STZ     CNNCT,,AUTO

     1102    21047    2           KQ$STA.CNNCTSIZE=SIZEC(B$CGAUCIDCB);

  21047  2 002427   000044 220003                    LDX0    36,DU
         2 002430   000015 440100                    SXL0    13,,PR0

     1103    21048    2           END;

     1104    21049    1         KQ$STA.DCBLNK$=KQ$CG.DCBHD$;

  21049  2 002431   200013 474500                    LDP4    CTX$,,AUTO
         2 002432   400103 236100                    LDQ     67,,PR4
         2 002433   000014 756100                    STQ     12,,PR0

     1105    21050    1         KQ$CG.DCBHD$=STA$;

  21050  2 002434   200017 236100                    LDQ     STA$,,AUTO
         2 002435   400103 756100                    STQ     67,,PR4
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:177  

     1106    21051    1         KQ$STA.AU=F$DCB.AU;

  21051  2 002436   300031 236100                    LDQ     25,,PR3
         2 002437   000020 676100                    ERQ     16,,PR0
         2 002440   200000 376003                    ANQ     65536,DU
         2 002441   000020 656100                    ERSQ    16,,PR0

     1107    21052    1         CALL STAUNLOCK;

  21052  2 002442   004661 701000 2                  TSX1    STAUNLOCK
         2 002443   000000 011000                    NOP     0

     1108    21053    1         CALL SUNLOCK;

  21053  2 002444   004635 701000 2                  TSX1    SUNLOCK
         2 002445   000000 011000                    NOP     0

     1109    21054    1         F$DCB.LDCTX=NK$LDCT.LDCTX;

  21054  2 002446   200016 470500                    LDP0    LDCT$,,AUTO
         2 002447   000006 220100                    LDX0    6,,PR0
         2 002450   200007 471500                    LDP1    JDCB$,,AUTO
         2 002451   100051 740100                    STX0    41,,PR1

     1110    21055    1         IF KQ_LOG.DSIO THEN

  21055  2 002452   000000 236000 xsym               LDQ     KQ_LOG
         2 002453   002000 316003                    CANQ    1024,DU
         2 002454   002501 600000 2                  TZE     s:21078

     1111    21056    2           DO;

     1112    21057    2           INDXR$=STA$;

  21057  2 002455   200017 236100                    LDQ     STA$,,AUTO
         2 002456   200027 756100                    STQ     INDX,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:178  

     1113    21058    2           CALL KQZ$LOG (KQ$CG,%KQLOG_DODN,S_CUN,

  21058  2 002457   000006 036003                    ADLQ    6,DU
         2 002460   200136 756100                    STQ     DA+7,,AUTO
         2 002461   200017 236100                    LDQ     STA$,,AUTO
         2 002462   000005 036003                    ADLQ    5,DU
         2 002463   200135 756100                    STQ     DA+6,,AUTO
         2 002464   200027 633500                    EPPR3   INDX,,AUTO
         2 002465   200134 453500                    STP3    DA+5,,AUTO
         2 002466   200027 634500                    EPPR4   INDX,,AUTO
         2 002467   200133 454500                    STP4    DA+4,,AUTO
         2 002470   000044 236000 3                  LDQ     36
         2 002471   200132 756100                    STQ     DA+3,,AUTO
         2 002472   000051 236000 3                  LDQ     41
         2 002473   200013 235100                    LDA     CTX$,,AUTO
         2 002474   200130 757100                    STAQ    DA+1,,AUTO
         2 002475   200130 630500                    EPPR0   DA+1,,AUTO
         2 002476   000025 631400 xsym               EPPR1   B_VECTNIL+21
         2 002477   000000 701000 xent               TSX1    KQZ$LOG
         2 002500   000000 011000                    NOP     0

     1114    21059    2           INDXR$,
     1115    21060    2           ADDR(INDXR$)->UBINHALF,
     1116    21061    2           SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
     1117    21062    2           SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
     1118    21063    2           END;

     1119    21064        /**/
     1120    21065        /**/
     1121    21066        /**/
     1122    21067                     /*    WARNING!! WARNING!! WARNING!! WARNING!!
     1123    21068                      *
     1124    21069                      *    After this point the DCB is in
     1125    21070                      *    fact connected to the comgroup.
     1126    21071                      *    'Connected' means his DCB, the
     1127    21072                      *    KQ$STA, and the LDCT all point
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:179  
     1128    21073                      *    to each other.  After this, if
     1129    21074                      *    anything goes wrong (i.e. if we
     1130    21075                      *    want to give him an error), we
     1131    21076                      *    MUST exit via ERRCONNECTED, NOT!! ERR.
     1132    21077                      */
     1133    21078    1         IF FM$CFU.SHARE~=%NONE# THEN

  21078  2 002501   200012 470500                    LDP0    CFU$,,AUTO
         2 002502   000000 236100                    LDQ     0,,PR0
         2 002503   060000 376003                    ANQ     24576,DU
         2 002504   060000 116003                    CMPQ    24576,DU
         2 002505   002515 600000 2                  TZE     s:21085

     1134    21079    2           DO; /* File is shareable - let terminals on */

     1135    21080    2           CALL GLOCK;

  21080  2 002506   004673 701000 2                  TSX1    GLOCK
         2 002507   000000 011000                    NOP     0

     1136    21081    2           KQ$CG.OPEN='1'B;

  21081  2 002510   200013 470500                    LDP0    CTX$,,AUTO
         2 002511   000020 236007                    LDQ     16,DL
         2 002512   000105 256100                    ORSQ    69,,PR0

     1137    21082    2           CALL GUNLOCK;

  21082  2 002513   004705 701000 2                  TSX1    GUNLOCK
         2 002514   000000 011000                    NOP     0

     1138    21083    2           END;

     1139    21084        /**/
     1140    21085    1         IF  NOT KQ$STA.AU

  21085  2 002515   200017 470500                    LDP0    STA$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:180  
         2 002516   000020 236100                    LDQ     16,,PR0
         2 002517   200000 316003                    CANQ    65536,DU
         2 002520   002567 601000 2                  TNZ     s:21107
         2 002521   200013 471500                    LDP1    CTX$,,AUTO
         2 002522   100122 236100                    LDQ     82,,PR1
         2 002523   000033 772000                    QRL     27
         2 002524   000000 116000 xsym               CMPQ    S_CUN
         2 002525   002567 600000 2                  TZE     s:21107
         2 002526   100121 236100                    LDQ     81,,PR1
         2 002527   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002530   002567 600000 2                  TZE     s:21107
         2 002531   100133 236100                    LDQ     91,,PR1
         2 002532   100000 316007                    CANQ    32768,DL
         2 002533   002567 601000 2                  TNZ     s:21107
         2 002534   100136 236100                    LDQ     94,,PR1
         2 002535   004000 316003                    CANQ    2048,DU
         2 002536   002567 600000 2                  TZE     s:21107

     1141    21086    1         AND S_CUN ~= KQ$CG.AU
     1142    21087    1         AND KQ$CG.AUSTA$ ~= ADDR(NIL)
     1143    21088    1         AND NOT KQ$CG.AUCTL.DCBCONAU
     1144    21089    1         AND KQ$CG.AUCTL.DCBCONWA THEN
     1145    21090    2           DO;

     1146    21091    2           IF S_CUN = JG_JAYS# AND STA$ = KQ$CG.JRNLSTA$ THEN

  21091  2 002537   000000 235000 xsym               LDA     S_CUN
         2 002540   000015 115007                    CMPA    13,DL
         2 002541   002553 601000 2                  TNZ     s:21098
         2 002542   200017 236100                    LDQ     STA$,,AUTO
         2 002543   100210 116100                    CMPQ    136,,PR1
         2 002544   002553 601000 2                  TNZ     s:21098

     1147    21092    3             DO;

     1148    21093    3             WAFLG=0;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:181  
  21093  2 002545   200026 450100                    STZ     TRMFLG,,AUTO

     1149    21094    3             CALL KQC$ACTSTA (KQ$STA);

  21094  2 002546   200017 630500                    EPPR0   STA$,,AUTO
         2 002547   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002550   000000 701000 xent               TSX1    KQC$ACTSTA
         2 002551   000000 011000                    NOP     0

     1150    21095    3             END;

  21095  2 002552   002622 710000 2                  TRA     s:21115

     1151    21096    2           ELSE
     1152    21097    3             DO;

     1153    21098    3             WAFLG=1;

  21098  2 002553   000001 236007                    LDQ     1,DL
         2 002554   200026 756100                    STQ     TRMFLG,,AUTO

     1154    21099    3             CALL STALOCK;

  21099  2 002555   004647 701000 2                  TSX1    STALOCK
         2 002556   000000 011000                    NOP     0

     1155    21100    3             KQ$STA.OPNBLKED='1'B;

  21100  2 002557   200017 470500                    LDP0    STA$,,AUTO
         2 002560   020000 236007                    LDQ     8192,DL
         2 002561   000023 256100                    ORSQ    19,,PR0

     1156    21101    3             KQ$STA.OPNREJ='0'B;

  21101  2 002562   000030 236000 3                  LDQ     24
         2 002563   000023 356100                    ANSQ    19,,PR0

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:182  
     1157    21102    3             CALL STAUNLOCK;

  21102  2 002564   004661 701000 2                  TSX1    STAUNLOCK
         2 002565   000000 011000                    NOP     0

     1158    21103    3             END;

     1159    21104    2           END;

  21104  2 002566   002622 710000 2                  TRA     s:21115

     1160    21105    1         ELSE
     1161    21106    2           DO;

     1162    21107    2           WAFLG=0;

  21107  2 002567   200026 450100                    STZ     TRMFLG,,AUTO

     1163    21108    2           IF (KQ$CG.AUSTA$=ADDR(NIL) AND KQ$CG.AUCTL.DCBCONNAU)

  21108  2 002570   200013 471500                    LDP1    CTX$,,AUTO
         2 002571   100121 236100                    LDQ     81,,PR1
         2 002572   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002573   002577 601000 2                  TNZ     s:21108+7
         2 002574   100133 236100                    LDQ     91,,PR1
         2 002575   020000 316007                    CANQ    8192,DL
         2 002576   002616 601000 2                  TNZ     s:21112
         2 002577   100121 236100                    LDQ     81,,PR1
         2 002600   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002601   002605 600000 2                  TZE     s:21108+13
         2 002602   100133 236100                    LDQ     91,,PR1
         2 002603   100000 316007                    CANQ    32768,DL
         2 002604   002616 601000 2                  TNZ     s:21112
         2 002605   000000 235000 xsym               LDA     S_CUN
         2 002606   000015 115007                    CMPA    13,DL
         2 002607   002613 601000 2                  TNZ     s:21108+19
         2 002610   200017 236100                    LDQ     STA$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:183  
         2 002611   100210 116100                    CMPQ    136,,PR1
         2 002612   002616 600000 2                  TZE     s:21112
         2 002613   000020 236100                    LDQ     16,,PR0
         2 002614   200000 316003                    CANQ    65536,DU
         2 002615   002622 600000 2                  TZE     s:21115

     1164    21109    2           OR (KQ$CG.AUSTA$~=ADDR(NIL) AND KQ$CG.AUCTL.DCBCONAU)
     1165    21110    2           OR (S_CUN=JG_JAYS# AND STA$=KQ$CG.JRNLSTA$)
     1166    21111    2           OR KQ$STA.AU THEN
     1167    21112    2            CALL KQC$ACTSTA (KQ$STA);

  21112  2 002616   200017 630500                    EPPR0   STA$,,AUTO
         2 002617   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002620   000000 701000 xent               TSX1    KQC$ACTSTA
         2 002621   000000 011000                    NOP     0

     1168    21113    2           END;

     1169    21114        /**/
     1170    21115    1         IF KQ$STA.AU THEN

  21115  2 002622   200017 470500                    LDP0    STA$,,AUTO
         2 002623   000020 236100                    LDQ     16,,PR0
         2 002624   200000 316003                    CANQ    65536,DU
         2 002625   002675 600000 2                  TZE     s:21130

     1171    21116    2           DO;

     1172    21117    2           CALL STALOCK;

  21117  2 002626   004647 701000 2                  TSX1    STALOCK
         2 002627   000000 011000                    NOP     0

     1173    21118    2           KQ$STA.TOLDAU='1'B; /* Don't tell AU about himself */

  21118  2 002630   200017 470500                    LDP0    STA$,,AUTO
         2 002631   004000 236003                    LDQ     2048,DU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:184  
         2 002632   000020 256100                    ORSQ    16,,PR0

     1174    21119    2           CALL STAUNLOCK;

  21119  2 002633   004661 701000 2                  TSX1    STAUNLOCK
         2 002634   000000 011000                    NOP     0

     1175    21120    2           CALL GLOCK;

  21120  2 002635   004673 701000 2                  TSX1    GLOCK
         2 002636   000000 011000                    NOP     0

     1176    21121    2           KQ$CG.AUSTA$=STA$;

  21121  2 002637   200017 236100                    LDQ     STA$,,AUTO
         2 002640   200013 470500                    LDP0    CTX$,,AUTO
         2 002641   000121 756100                    STQ     81,,PR0

     1177    21122    2           KQ$CG.AU=S_CUN;

  21122  2 002642   000000 236000 xsym               LDQ     S_CUN
         2 002643   000033 736000                    QLS     27
         2 002644   000122 552140                    STBQ    82,'40'O,PR0

     1178    21123    2           CALL GUNLOCK;

  21123  2 002645   004705 701000 2                  TSX1    GUNLOCK
         2 002646   000000 011000                    NOP     0

     1179    21124    2           CALL FMD$GBUF(DGRAN$); /* Get buffer to read in connect info */

  21124  2 002647   200033 630500                    EPPR0   DGRAN$,,AUTO
         2 002650   200130 450500                    STP0    DA+1,,AUTO
         2 002651   200130 630500                    EPPR0   DA+1,,AUTO
         2 002652   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002653   000000 701000 xent               TSX1    FMD$GBUF
         2 002654   000000 011000                    NOP     0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:185  

     1180    21125    2           CALL KCA$TELLAUR(KQ$STA,%CG_AUCON#,DGRAN$);

  21125  2 002655   200033 630500                    EPPR0   DGRAN$,,AUTO
         2 002656   200132 450500                    STP0    DA+3,,AUTO
         2 002657   000053 236000 3                  LDQ     43
         2 002660   200017 235100                    LDA     STA$,,AUTO
         2 002661   200130 757100                    STAQ    DA+1,,AUTO
         2 002662   200130 630500                    EPPR0   DA+1,,AUTO
         2 002663   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002664   000000 701000 xent               TSX1    KCA$TELLAUR
         2 002665   000000 011000                    NOP     0

     1181    21126    2           CALL FMD$RBUF(DGRAN$);

  21126  2 002666   200033 630500                    EPPR0   DGRAN$,,AUTO
         2 002667   200130 450500                    STP0    DA+1,,AUTO
         2 002670   200130 630500                    EPPR0   DA+1,,AUTO
         2 002671   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002672   000000 701000 xent               TSX1    FMD$RBUF
         2 002673   000000 011000                    NOP     0

     1182    21127    2           END;

  21127  2 002674   002716 710000 2                  TRA     s:21135

     1183    21128    1         ELSE
     1184    21129    2           DO;

     1185    21130    2           KQ$STA.MBLK$=CNNCT.MBLK$;

  21130  2 002675   200035 236100                    LDQ     CNNCT+1,,AUTO
         2 002676   000012 756100                    STQ     10,,PR0

     1186    21131    2           CNNCT='0'B;

  21131  2 002677   000000 235003                    LDA     0,DU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:186  
         2 002700   000000 236003                    LDQ     0,DU
         2 002701   200034 757100                    STAQ    CNNCT,,AUTO

     1187    21132    2           CALL KCA$TELLAUM(KQ$STA,%CG_DOPN#,ADDR(B$CGAUCIDCB));

  21132  2 002702   200041 631500                    EPPR1   B$CGAUCIDCB,,AUTO
         2 002703   200130 451500                    STP1    DA+1,,AUTO
         2 002704   200130 633500                    EPPR3   DA+1,,AUTO
         2 002705   200133 453500                    STP3    DA+4,,AUTO
         2 002706   000002 236000 3                  LDQ     2
         2 002707   200132 756100                    STQ     DA+3,,AUTO
         2 002710   200017 236100                    LDQ     STA$,,AUTO
         2 002711   200131 756100                    STQ     DA+2,,AUTO
         2 002712   200131 630500                    EPPR0   DA+2,,AUTO
         2 002713   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002714   000000 701000 xent               TSX1    KCA$TELLAUM
         2 002715   000000 011000                    NOP     0

     1188    21133    2           END;

     1189    21134        /**/
     1190    21135    1         IF OPNTYP~=0 AND KQ$CG.AUCTL.TERMCONLGL THEN

  21135  2 002716   200032 235100                    LDA     OPNTYP,,AUTO
         2 002717   002734 600000 2                  TZE     s:21141
         2 002720   200013 470500                    LDP0    CTX$,,AUTO
         2 002721   000136 236100                    LDQ     94,,PR0
         2 002722   000010 316003                    CANQ    8,DU
         2 002723   002734 600000 2                  TZE     s:21141

     1191    21136    2           DO;

     1192    21137    2           SCRATCH$=CTX$;

  21137  2 002724   200013 236100                    LDQ     CTX$,,AUTO
         2 002725   200116 756100                    STQ     SCRATCH$,,AUTO

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:187  
     1193    21138    2           CALL KQC$TRMCK (SCRATCH$);

  21138  2 002726   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 002727   200130 451500                    STP1    DA+1,,AUTO
         2 002730   200130 630500                    EPPR0   DA+1,,AUTO
         2 002731   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002732   000000 701000 xent               TSX1    KQC$TRMCK
         2 002733   000000 011000                    NOP     0

     1194    21139    2           END;

     1195    21140        /**/
     1196    21141    1         IF WAFLG ~= 0 THEN

  21141  2 002734   200026 235100                    LDA     TRMFLG,,AUTO
         2 002735   002764 600000 2                  TZE     s:21152

     1197    21142    2           DO;

     1198    21143    2           IF F$DCB.ENQF THEN

  21143  2 002736   200007 470500                    LDP0    JDCB$,,AUTO
         2 002737   000064 236100                    LDQ     52,,PR0
         2 002740   000200 316007                    CANQ    128,DL
         2 002741   002754 600000 2                  TZE     s:21148

     1199    21144    3             DO;

     1200    21145    3             CALL UQB$MDEQ (KQ$CG.CFU$);

  21145  2 002742   200013 236100                    LDQ     CTX$,,AUTO
         2 002743   000214 036003                    ADLQ    140,DU
         2 002744   200130 756100                    STQ     DA+1,,AUTO
         2 002745   200130 630500                    EPPR0   DA+1,,AUTO
         2 002746   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002747   000000 701000 xent               TSX1    UQB$MDEQ
         2 002750   000000 011000                    NOP     0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:188  

     1201    21146    3             F$DCB.ENQF='0'B;

  21146  2 002751   200007 470500                    LDP0    JDCB$,,AUTO
         2 002752   000054 236000 3                  LDQ     44
         2 002753   000064 356100                    ANSQ    52,,PR0

     1202    21147    3             END;

     1203    21148    2           CALL SSR$REG (%SS_QA);

  21148  2 002754   000056 630400 3                  EPPR0   46
         2 002755   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002756   000000 701000 xent               TSX1    SSR$REG
         2 002757   000000 011000                    NOP     0

     1204    21149    2           IF KQ$STA.OPNREJ THEN GOTO OPNREJ;

  21149  2 002760   200017 470500                    LDP0    STA$,,AUTO
         2 002761   000023 236100                    LDQ     19,,PR0
         2 002762   010000 316007                    CANQ    4096,DL
         2 002763   002765 601000 2                  TNZ     OPNREJ

     1205    21150    2           END;

     1206    21151        /**/
     1207    21152    1         RETURN;

  21152  2 002764   000000 702200 xent               TSX2  ! X66_ARET

  21141  2 002765                       OPNREJ       null
     1208    21153        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:189  
     1209    21154
     1210    21155                   /******************************************************
     1211    21156                    *                                                    *
     1212    21157                    *                     ERRORS                         *
     1213    21158                    *                                                    *
     1214    21159                    ******************************************************/
     1215    21160
     1216    21161        /**/
     1217    21162    1   OPNREJ:;
     1218    21163    1         B$JIT.ERR=ERRCGORAU;

  21163  2 002765   000077 236000 1                  LDQ     ERRCGORAU
         2 002766   000000 471400 xsym               LDP1    B$JIT$
         2 002767   100012 756100                    STQ     10,,PR1

     1219    21164        /*E* ERROR:        KCO-E$CGORAU-E
     1220    21165             MESSAGE:      Your M$OPEN was rejected by the comgroup administrator
     1221    21166             DESCRIPTION:  The comgroup has DWBCONWA = YES and the AU
     1222    21167                           M$DEACTIVATEd this user after getting the DCB OPEN
     1223    21168                           event. */
     1224    21169    1         GOTO ERRCONNECTED;

  21169  2 002770   003074 710000 2                  TRA     ERRCONNECTED

  21163  2 002771                       NOLDCT       null
     1225    21170        /**/
     1226    21171    1   NOLDCT:;
     1227    21172    1         B$JIT.ERR=ERRNOCGLDCT;  /* NO LDCT */

  21172  2 002771   000056 236000 1                  LDQ     ERRNOCGLDCT
         2 002772   000000 470400 xsym               LDP0    B$JIT$
         2 002773   000012 756100                    STQ     10,,PR0

     1228    21173    1         GOTO ERR;

  21173  2 002774   003052 710000 2                  TRA     ERR

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:190  
  21172  2 002775                       DUPNM        null
     1229    21174        /*E*    ERROR: KCO-E$NOCGLDCT-2
     1230    21175                MESSAGE: Insufficient system LDCT space to connect you
     1231    21176                DESCRIPTION: Unable to get an LDCT for this DCB
     1232    21177        */
     1233    21178        /**/
     1234    21179    1   DUPNM:;
     1235    21180    1         CALL STAUNLOCK;

  21180  2 002775   004661 701000 2                  TSX1    STAUNLOCK
         2 002776   000000 011000                    NOP     0

     1236    21181    1         CALL SUNLOCK;

  21181  2 002777   004635 701000 2                  TSX1    SUNLOCK
         2 003000   000000 011000                    NOP     0

     1237    21182    1         B$JIT.ERR=ERRDUPNM;  /* ILLEGAL STATION NAME */

  21182  2 003001   000057 236000 1                  LDQ     ERRDUPNM
         2 003002   000000 470400 xsym               LDP0    B$JIT$
         2 003003   000012 756100                    STQ     10,,PR0

     1238    21183    1         GOTO ERR;

  21183  2 003004   003052 710000 2                  TRA     ERR

  21182  2 003005                       MEMERRUD     null
     1239    21184        /*E*    ERROR: KCO-E$DUPNM-2
     1240    21185                MESSAGE: That station name is already in use
     1241    21186                MESSAGE1: The station name specified on an open to a
     1242    21187                          comgroup must be unique on that comgroup.
     1243    21188                          The name specified on your open is currently
     1244    21189                          in use by another user or terminal.
     1245    21190        */
     1246    21191    1   MEMERRUD:;
     1247    21192              %UNLOCK (G=KQ$CG.DTREE.GATE);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:191  

  21193  2 003005   200013 236100                    LDQ     CTX$,,AUTO
         2 003006   000231 036003                    ADLQ    153,DU
         2 003007   200130 756100                    STQ     DA+1,,AUTO
         2 003010   200130 630500                    EPPR0   DA+1,,AUTO
         2 003011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003012   000000 701000 xent               TSX1    HFC$UNLOCK
         2 003013   000000 011000                    NOP     0

  21182  2 003014                       MEMERR       null
     1248    21195        /**/
     1249    21196    1   MEMERR: ;
     1250    21197    1         B$JIT.ERR=ERRCGCXT;

  21197  2 003014   000061 236000 1                  LDQ     ERRCGCXT
         2 003015   000000 470400 xsym               LDP0    B$JIT$
         2 003016   000012 756100                    STQ     10,,PR0

     1251    21198    1         GOTO ERR;

  21198  2 003017   003052 710000 2                  TRA     ERR

  21197  2 003020                       STANOTALLWD  null
     1252    21199        /*E*    ERROR: KCO-E$CGCXT-2
     1253    21200                MESSAGE: Insufficient space in comgroup to connect you
     1254    21201                MESSAGE1: There is not enough space available in the comgroup
     1255    21202                         for the context necessary to connect you
     1256    21203        */
     1257    21204        /**/
     1258    21205    1   STANOTALLWD:;
     1259    21206    1         CALL SUNLOCK;

  21206  2 003020   004635 701000 2                  TSX1    SUNLOCK
         2 003021   000000 011000                    NOP     0

     1260    21207    1         B$JIT.ERR=ERRSTAILLGL;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:192  
  21207  2 003022   000064 236000 1                  LDQ     ERRSTAILLGL
         2 003023   000000 470400 xsym               LDP0    B$JIT$
         2 003024   000012 756100                    STQ     10,,PR0

     1261    21208    1         GOTO ERR;

  21208  2 003025   003052 710000 2                  TRA     ERR

  21207  2 003026                       PRIVSTA      null
     1262    21209        /*E*    ERROR: KCO-E$STAILLGL-2
     1263    21210                MESSAGE: The station name you specified is not allowed on this comgroup
     1264    21211                MESSAGE1: The comgroup you are attempting to connect to has
     1265    21212                          a restricted list of legal stations, and the
     1266    21213                          station name you used is not in that list
     1267    21214        */
     1268    21215        /**/
     1269    21216        /**/
     1270    21217    1   PRIVSTA: ;
     1271    21218    1         CALL STAUNLOCK;

  21218  2 003026   004661 701000 2                  TSX1    STAUNLOCK
         2 003027   000000 011000                    NOP     0

     1272    21219    1         CALL SUNLOCK;

  21219  2 003030   004635 701000 2                  TSX1    SUNLOCK
         2 003031   000000 011000                    NOP     0

     1273    21220    1         B$JIT.ERR=ERRPRIVSTA;

  21220  2 003032   000074 236000 1                  LDQ     ERRPRIVSTA
         2 003033   000000 470400 xsym               LDP0    B$JIT$
         2 003034   000012 756100                    STQ     10,,PR0

     1274    21221    1         GOTO ERR;

  21221  2 003035   003052 710000 2                  TRA     ERR
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:193  

  21220  2 003036                       BADSTA       null
     1275    21222        /*E*    ERROR: KCO-E$PRIVSTA-2
     1276    21223                MESSAGE: The station name you used is restricted.
     1277    21224                MESSAGE1: Only the AU may use the station name that you specified.
     1278    21225        */
     1279    21226        /**/
     1280    21227    1   BADSTA:;
     1281    21228    1         B$JIT.ERR=ERRSTABAD;

  21228  2 003036   000063 236000 1                  LDQ     ERRSTABAD
         2 003037   000000 470400 xsym               LDP0    B$JIT$
         2 003040   000012 756100                    STQ     10,,PR0

     1282    21229    1         GOTO ERR;

  21229  2 003041   003052 710000 2                  TRA     ERR

  21228  2 003042                       CGBAD        null
     1283    21230        /*E*    ERROR: KCO-E$STABAD-2
     1284    21231                MESSAGE: Illegal character(s) in station name
     1285    21232                MESSAGE1: Your VLP_SETSTA.MYSTATION# has an illegal
     1286    21233                          first character, or begins with the character '&'.
     1287    21234        */
     1288    21235    1   CGBAD:;
     1289    21236    1         CALL FMD$RELBUF(0);  /* Get rid of context info */

  21236  2 003042   000002 630400 3                  EPPR0   2
         2 003043   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003044   000000 701000 xent               TSX1    FMD$RELBUF
         2 003045   000000 011000                    NOP     0

     1290    21237    1         B$JIT.ERR=ERRCGCROP;

  21237  2 003046   000072 236000 1                  LDQ     ERRCGCROP
         2 003047   000000 470400 xsym               LDP0    B$JIT$
         2 003050   000012 756100                    STQ     10,,PR0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:194  

     1291    21238    1         GOTO ERR;

  21238  2 003051   003052 710000 2                  TRA     ERR

  21237  2 003052                       ERR          null
     1292    21239        /*E*    ERROR: KCO-E$CGCROP-2
     1293    21240                MESSAGE: Unable to reopen your comgroup
     1294    21241                MESSAGE1: Your comgroup was previously closed, but
     1295    21242                          is so badly broken that it cannot be reopened.
     1296    21243        */
     1297    21244        /**/
     1298    21245                     /*    Come here for errors which occur
     1299    21246                      *    BEFORE we 'connect' the DCB to
     1300    21247                      *    the comgroup.  The LDCT we obtained
     1301    21248                      *    (if any) is released.  The connect
     1302    21249                      *    info space we obtained is released.
     1303    21250                      *    The DCB is set to indicate there's
     1304    21251                      *    no LDCT.  Then we release FM buffers,
     1305    21252                      *    and call KCO$CLCGERR.  The purpose
     1306    21253                      *    of this last call is to shut down
     1307    21254                      *    the comgroup if it needs to be shut
     1308    21255                      *    down, and decrement NUMDCBS in the
     1309    21256                      *    context block, which was set/incremented
     1310    21257                      *    way back at the top of KCO$INIT.
     1311    21258                      */
     1312    21259    1   ERR:  ;
     1313    21260    1         IF CNNCT ~= '0'B THEN CALL RELCNNCT;

  21260  2 003052   200034 237100                    LDAQ    CNNCT,,AUTO
         2 003053   000060 117000 3                  CMPAQ   48
         2 003054   003057 600000 2                  TZE     s:21261

  21260  2 003055   004407 701000 2                  TSX1    RELCNNCT
         2 003056   000000 011000                    NOP     0

     1314    21261    1         IF LDCT$~=ADDR(NIL) THEN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:195  

  21261  2 003057   200016 236100                    LDQ     LDCT$,,AUTO
         2 003060   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003061   003071 600000 2                  TZE     s:21266

     1315    21262    2           DO;

     1316    21263    2           SCRATCH$=LDCT$;

  21263  2 003062   200116 756100                    STQ     SCRATCH$,,AUTO

     1317    21264    2           CALL NKL$RELDCT (SCRATCH$);

  21264  2 003063   200116 630500                    EPPR0   SCRATCH$,,AUTO
         2 003064   200130 450500                    STP0    DA+1,,AUTO
         2 003065   200130 630500                    EPPR0   DA+1,,AUTO
         2 003066   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003067   000000 701000 xent               TSX1    NKL$RELDCT
         2 003070   000000 011000                    NOP     0

     1318    21265    2           END;

     1319    21266    1         F$DCB.LDCTX=0;

  21266  2 003071   000000 220003                    LDX0    0,DU
         2 003072   200007 470500                    LDP0    JDCB$,,AUTO
         2 003073   000051 740100                    STX0    41,,PR0

  21266  2 003074                       ERRCONNECTED null
     1320    21267                     /*    Come here for errors which occur
     1321    21268                      *    AFTER we 'connect' the DCB to
     1322    21269                      *    the comgroup.  We just release
     1323    21270                      *    some FM buffers, and call KCO$CLCGERR
     1324    21271                      *    to disconnect the DCB from the
     1325    21272                      *    comgroup.
     1326    21273                      */
     1327    21274    1   ERRCONNECTED:;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:196  
     1328    21275    1         CALL FMD$RELBUF(0);

  21275  2 003074   000002 630400 3                  EPPR0   2
         2 003075   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003076   000000 701000 xent               TSX1    FMD$RELBUF
         2 003077   000000 011000                    NOP     0

     1329    21276    1         CALL FMD$RELBUF(2);

  21276  2 003100   000000 630400 3                  EPPR0   0
         2 003101   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003102   000000 701000 xent               TSX1    FMD$RELBUF
         2 003103   000000 011000                    NOP     0

     1330    21277    1         IF CTX$~=ADDR(NIL) THEN

  21277  2 003104   200013 236100                    LDQ     CTX$,,AUTO
         2 003105   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003106   003112 600000 2                  TZE     s:21279

     1331    21278    1          CALL KCO$CLCGERR;

  21278  2 003107   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003110   000000 701000 xent               TSX1    KCO$CLCGERR
         2 003111   000000 011000                    NOP     0

     1332    21279    1         ALTRETURN;

  21279  2 003112   000000 702200 xent               TSX2  ! X66_AALT

  21277  2 003113                       MMERR        null
     1333    21280        /**/
     1334    21281    1   MMERR: ;
     1335    21282    1         B$JIT.ERR=ERRDMY;

  21282  2 003113   000054 236000 1                  LDQ     ERRDMY
         2 003114   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:197  
         2 003115   000012 756100                    STQ     10,,PR0

     1336    21283    1         B$JIT.ERR.CODE=INDX;

  21283  2 003116   200027 236100                    LDQ     INDX,,AUTO
         2 003117   000003 736000                    QLS     3
         2 003120   000012 676100                    ERQ     10,,PR0
         2 003121   377770 376007                    ANQ     131064,DL
         2 003122   000012 656100                    ERSQ    10,,PR0

     1337    21284    1         GOTO ERR;

  21284  2 003123   003052 710000 2                  TRA     ERR

     1338    21285        /**/
     1339    21286        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:198  
     1340    21287        /**/
     1341    21288        /*F* NAME:         KCO$TRMCON
     1342    21289
     1343    21290             PURPOSE:      Connect a terminal to a comgroup
     1344    21291
     1345    21292        */
     1346    21293        /**/
     1347    21294        /*D* NAME:         KCO$TRMCON
     1348    21295             CALL:         CALL KCO$TRMCON(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET(LOC);
     1349    21296             ENVIRONMENT:  Must be called on behalf of a user.
     1350    21297             INPUT:        PLDCT$    - The initialized LDCT for the terminal
     1351    21298                           KC$CGID   - Block identifying the comgroup.
     1352    21299                           B$CGAUCI  - Connect info for the AU
     1353    21300             OUTPUT:       ERROR     - Error code
     1354    21301             DESCRIPTION:  The chain of active comgroups is searched to
     1355    21302                           find the one matching KC$CGID.  If it is not
     1356    21303                           being shut down, then it is searched to find
     1357    21304                           the name in DEVNM of the passed LDCT.  If such
     1358    21305                           a station is found, then it must be neither
     1359    21306                           connected nor illegal for terminals; if it
     1360    21307                           passes these tests all is OK.  If no such
     1361    21308                           station is found then a new one is created
     1362    21309                           unless the comgroup forbids creation of new
     1363    21310                           stations.  In either case, once we have a
     1364    21311                           station block, the KQ$STA and LDCT are pointed
     1365    21312                           at one another and we return.  Note that
     1366    21313                           the RESCOD in the LDCT is not changed; the
     1367    21314                           caller is expected to do this himself.
     1368    21315
     1369    21316                           Errors are returned in ERROR, not B$JIT.ERR.
     1370    21317                           The errors are:
     1371    21318
     1372    21319                           E$NOCG        - The CG doesn't exist.
     1373    21320                           E$DUPNM       - Station name already in CG
     1374    21321                           E$STAILLGL    - Illegal station name
     1375    21322                           E$CGCXT       - No room in CG to do connection
     1376    21323                           E$NTRMSTA     - That name can't be used by terms.
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:199  
     1377    21324                           E$STABAD      - Illegal character(s) in station name
     1378    21325        */
     1379    21326    1   KCO$TRMCONGOTCG: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;

  21326  2 003124   000000 700200 xent  KCO$TRMCONG* TSX0  ! X66_AUTO_4
         2 003125   000140 000004                    ZERO    96,4

     1380    21327
     1381    21328    1         ENTFLG=3;

  21328  2 003126   000003 235007                    LDA     3,DL
         2 003127   200020 755100                    STA     ENTFLG,,AUTO

     1382    21329    1         GOTO TRM20;

  21329  2 003130   003135 710000 2                  TRA     TRM20

     1383    21330    1   KCO$TRMCON: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;

  21330  2 003131   000000 700200 xent  KCO$TRMCON   TSX0  ! X66_AUTO_4
         2 003132   000140 000004                    ZERO    96,4

     1384    21331        /**/
     1385    21332    1         ENTFLG=1;

  21332  2 003133   000001 235007                    LDA     1,DL
         2 003134   200020 755100                    STA     ENTFLG,,AUTO

  21332  2 003135                       TRM20        null
     1386    21333    1   TRM20: ;
     1387    21334                        /* Block to master CPU for DO INHIBIT
     1388    21335                           to work - see the OLDSC check below */
     1389    21336    1         IF S_PNO ~= 0 THEN CALL SSS$BLOCK;

  21336  2 003135   000000 235000 xsym               LDA     S_PNO
         2 003136   003142 600000 2                  TZE     s:21337

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:200  
  21336  2 003137   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003140   000000 701000 xent               TSX1    SSS$BLOCK
         2 003141   000000 011000                    NOP     0

     1390    21337    1         LDCT$=PLDCT$;

  21337  2 003142   200003 470500                    LDP0    @PLDCT$,,AUTO
         2 003143   000000 236100                    LDQ     0,,PR0
         2 003144   200016 756100                    STQ     LDCT$,,AUTO

     1391    21338    1         KEY=NK$LDCT.DEVNM;

  21338  2 003145   200016 471500                    LDP1    LDCT$,,AUTO
         2 003146   100002 237100                    LDAQ    2,,PR1
         2 003147   200022 757100                    STAQ    KEY,,AUTO

     1392    21339    1         INDX=8;

  21339  2 003150   000010 235007                    LDA     8,DL
         2 003151   200027 755100                    STA     INDX,,AUTO

     1393    21340    1         GOTO TRMCOM;

  21340  2 003152   003241 710000 2                  TRA     TRMCOM

     1394    21341        /**/
     1395    21342        /*F* NAME:         KCO$MONCON
     1396    21343             PURPOSE:      To connect monitor DCBs to comgroups. */
     1397    21344        /**/
     1398    21345        /*D* NAME:         KCO$MONCON
     1399    21346             CALL:         As KCO$TRMCON
     1400    21347             ENVIRONMENT:  As KCO$TRMCON
     1401    21348             INPUT:        As KCO$TRMCON
     1402    21349             OUTPUT:       As KCO$TRMCON
     1403    21350             DESCRIPTION:  Monitor DCB stations are set up to act like
     1404    21351                           normal DCB stations, with certain restrictions
     1405    21352                           on what they may do.  The primary example of
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:201  
     1406    21353                           such a special station is MONKEY, the
     1407    21354                           monitor part of KEYIN.  The name is rather
     1408    21355                           historical; in fact MONKEY is the monitor's
     1409    21356                           station on the CSCG, and handles lots of
     1410    21357                           things other than KEYIN work.
     1411    21358
     1412    21359                           KCO$MONCON travels much the same path as
     1413    21360                           KCO$TRMCON, except that the station block
     1414    21361                           is set up to look like a DCB station instead
     1415    21362                           of a terminal. */
     1416    21363        /**/
     1417    21364    1   KCO$MONCON: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;

  21364  2 003153   000000 700200 xent  KCO$MONCON   TSX0  ! X66_AUTO_4
         2 003154   000140 000004                    ZERO    96,4

     1418    21365        /**/
     1419    21366    1         ENTFLG=-1;

  21366  2 003155   000001 335007                    LCA     1,DL
         2 003156   200020 755100                    STA     ENTFLG,,AUTO

     1420    21367    1         GOTO TRM20;

  21367  2 003157   003135 710000 2                  TRA     TRM20

     1421    21368        /**/
     1422    21369        /*F* NAME:         KCO$FINDSTAD
     1423    21370             PURPOSE:      To find a station on a comgroup */
     1424    21371        /**/
     1425    21372        /*D* NAME:         KCO$FINDSTAD
     1426    21373             CALL:         KCO$FINDSTAD (PLDCT$,KC$CGID,DEVNAME,ERROR)
     1427    21374             ENVIRONMENT:  Any.
     1428    21375             INPUT:        KC$CGID   - Unused.
     1429    21376                           B$JIT.DCB$- Points to a DCB open to the desired
     1430    21377                                       comgroup.
     1431    21378                           DEVNAME   - 8-char station name
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:202  
     1432    21379             OUTPUT:       PLDCT$    - pointer to LDCT
     1433    21380                           ERROR     - error code
     1434    21381             DESCRIPTION:  Finds the desired station name (need NOT be
     1435    21382                           a terminal station) on the given comgroup.
     1436    21383                           ALTRETs if not found.  The answer given is
     1437    21384                           the LDCT pointer.
     1438    21385                           Note that the caller of this routine need not
     1439    21386                           worry about the comgroup going away, since he
     1440    21387                           himself has it open.  However, the found station
     1441    21388                           itself may disconnect after we return to the
     1442    21389                           caller.  Thus if the station is to be used in
     1443    21390                           any way, it must be such that disconnection causes
     1444    21391                           no harm (for example, some callers of this
     1445    21392                           routine are just performing legality checks prior
     1446    21393                           to calling KCI$RWCG, which is safe 'cause it is
     1447    21394                           a media layer).
     1448    21395        */
     1449    21396    1   KCO$FINDSTAD: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;

  21396  2 003160   000000 700200 xent  KCO$FINDSTAD TSX0  ! X66_AUTO_4
         2 003161   000140 000004                    ZERO    96,4

     1450    21397        /**/
     1451    21398    1         ENTFLG=2;

  21398  2 003162   000002 235007                    LDA     2,DL
         2 003163   200020 755100                    STA     ENTFLG,,AUTO

     1452    21399    1         INDX=8;

  21399  2 003164   000010 236007                    LDQ     8,DL
         2 003165   200027 756100                    STQ     INDX,,AUTO

     1453    21400    1         KEY=ADDR(B$CGAUCI)->CHAR8;

  21400  2 003166   200005 470500                    LDP0    @B$CGAUCI,,AUTO
         2 003167   040100 100500                    MLR     fill='040'O
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:203  
         2 003170   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         2 003171   200022 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

     1454    21401    1         ERROR=0;

  21401  2 003172   200006 471500                    LDP1    @ERROR,,AUTO
         2 003173   100000 450100                    STZ     0,,PR1

     1455    21402    1         TRMFLG=0;

  21402  2 003174   200026 450100                    STZ     TRMFLG,,AUTO

     1456    21403    1         JDCB$=B$JIT.DCB$;

  21403  2 003175   000000 473400 xsym               LDP3    B$JIT$
         2 003176   300232 236100                    LDQ     154,,PR3
         2 003177   200007 756100                    STQ     JDCB$,,AUTO

     1457    21404    1         CFU$=F$DCB.CFU$;

  21404  2 003200   200007 474500                    LDP4    JDCB$,,AUTO
         2 003201   400066 236100                    LDQ     54,,PR4
         2 003202   200012 756100                    STQ     CFU$,,AUTO

     1458    21405    1         CTX.SID=FM$CFU.GDA;

  21405  2 003203   200012 475500                    LDP5    CFU$,,AUTO
         2 003204   500005 236100                    LDQ     5,,PR5
         2 003205   200013 752103                    STCQ    CTX$,'03'O,AUTO

     1459    21406    1         CTX.DISP=FM$CFU.LDA;

  21406  2 003206   500006 235100                    LDA     6,,PR5
         2 003207   500007 236100                    LDQ     7,,PR5
         2 003210   000033 773000                    LRL     27
         2 003211   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003212   000014 736000                    QLS     12
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:204  
         2 003213   200013 752174                    STCQ    CTX$,'74'O,AUTO

     1460    21407              %LOCK (G=KQ_CGLGATE);

  21408  2 003214   000062 630400 3                  EPPR0   50
         2 003215   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003216   000000 701000 xent               TSX1    HFC$LOCK
         2 003217   000000 011000                    NOP     0

     1461    21410    1         GOTO GOTCG;

  21410  2 003220   003262 710000 2                  TRA     GOTCG

     1462    21411        /**/
     1463    21412        /*F* NAME:         KCO$FINDSTA
     1464    21413             PURPOSE:      To find a station on a comgroup. */
     1465    21414        /**/
     1466    21415        /*D* NAME:         KCO$FINDSTA
     1467    21416             CALL:         KCO$FINDSTA (PLDCT$,KC$CGID,DEVNAME,ERROR)
     1468    21417             ENVIRONMENT:  Any.
     1469    21418             INPUT:        KC$CGID   - As KCO$TRMCON.
     1470    21419                           ERROR     - Integer number of significant characters
     1471    21420                                       in DEVNAME.
     1472    21421                           DEVNAME   - 8-char station name.
     1473    21422             OUTPUT:       PLDCT$    - pointer to LDCT
     1474    21423                           ERROR     - error code
     1475    21424             DESCRIPTION:  Finds the comgroup as in KCO$TRMCON.  The station
     1476    21425                           to be found is any whose name matches DEVNAME in
     1477    21426                           the first ERROR characters.  Otherwise is the
     1478    21427                           same as KCO$FINDSTAD.
     1479    21428                           Note that upon return from this routine, the
     1480    21429                           comgroup and/or the target station may go away
     1481    21430                           at any time.
     1482    21431        */
     1483    21432    1   KCO$FINDSTA: ENTRY(PLDCT$,KC$CGID,B$CGAUCI,ERROR) ALTRET;

  21432  2 003221   000000 700200 xent  KCO$FINDSTA  TSX0  ! X66_AUTO_4
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:205  
         2 003222   000140 000004                    ZERO    96,4

     1484    21433        /**/
     1485    21434    1         ENTFLG=2;

  21434  2 003223   000002 235007                    LDA     2,DL
         2 003224   200020 755100                    STA     ENTFLG,,AUTO

     1486    21435    1         INDX=ERROR;

  21435  2 003225   200006 470500                    LDP0    @ERROR,,AUTO
         2 003226   000000 235100                    LDA     0,,PR0
         2 003227   200027 755100                    STA     INDX,,AUTO

     1487    21436    1         KEY=ADDR(B$CGAUCI)->CHAR8;

  21436  2 003230   200005 471500                    LDP1    @B$CGAUCI,,AUTO
         2 003231   040100 100500                    MLR     fill='040'O
         2 003232   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         2 003233   200022 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

     1488    21437    1         CALL INSERT(KEY,INDX,,CHARZEROS);

  21437  2 003234   777767 620005                    EAX0    -9,AL
         2 003235   777777 660003                    ERX0    -1,DU
         2 003236   040145 100400                    MLR     fill='040'O
         2 003237   000052 000010 1                  ADSC9   ZEROS                    cn=0,n=8
         2 003240   200022 000010                    ADSC9   KEY,A,AUTO               cn=0,n=*X0

  21437  2 003241                       TRMCOM       null
     1489    21438    1   TRMCOM:;
     1490    21439    1         ERROR=0;

  21439  2 003241   200006 470500                    LDP0    @ERROR,,AUTO
         2 003242   000000 450100                    STZ     0,,PR0

     1491    21440    1         TRMFLG=0;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:206  

  21440  2 003243   200026 450100                    STZ     TRMFLG,,AUTO

     1492    21441    1         CNNCT='0'B;

  21441  2 003244   000000 235003                    LDA     0,DU
         2 003245   000000 236003                    LDQ     0,DU
         2 003246   200034 757100                    STAQ    CNNCT,,AUTO

     1493    21442    1         TRYCNT=0;

  21442  2 003247   200036 450100                    STZ     TRYCNT,,AUTO

     1494    21443    1         IF ENTFLG = 3

  21443  2 003250   200020 235100                    LDA     ENTFLG,,AUTO
         2 003251   000003 115007                    CMPA    3,DL
         2 003252   003260 601000 2                  TNZ     s:21449

     1495    21444    2         THEN DO;

     1496    21445    2           CTX$ = ADDR(KC$CGID);

  21445  2 003253   200004 236100                    LDQ     @KC$CGID,,AUTO
         2 003254   200013 756100                    STQ     CTX$,,AUTO

     1497    21446    2           ENTFLG = 1;

  21446  2 003255   000001 235007                    LDA     1,DL
         2 003256   200020 755100                    STA     ENTFLG,,AUTO

     1498    21447    2           END;

  21447  2 003257   003262 710000 2                  TRA     GOTCG

     1499    21448    1         ELSE
     1500    21449    1          CALL FINDCG ALTRET(NOCG);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:207  

  21449  2 003260   004717 701000 2                  TSX1    FINDCG
         2 003261   004051 702000 2                  TSX2    NOCG

  21443  2 003262                       GOTCG        null
     1501    21450        /**/
     1502    21451    1   GOTCG:;
     1503    21452    1         CALL GLOCK;

  21452  2 003262   004673 701000 2                  TSX1    GLOCK
         2 003263   000000 011000                    NOP     0

     1504    21453    1         IF NOT KQ$CG.OPEN

  21453  2 003264   200013 470500                    LDP0    CTX$,,AUTO
         2 003265   000105 236100                    LDQ     69,,PR0
         2 003266   000020 316007                    CANQ    16,DL
         2 003267   003300 600000 2                  TZE     s:21457
         2 003270   000040 316007                    CANQ    32,DL
         2 003271   003300 601000 2                  TNZ     s:21457
         2 003272   200020 235100                    LDA     ENTFLG,,AUTO
         2 003273   000001 115007                    CMPA    1,DL
         2 003274   003307 601000 2                  TNZ     s:21466
         2 003275   000136 236100                    LDQ     94,,PR0
         2 003276   000010 316003                    CANQ    8,DU
         2 003277   003307 601000 2                  TNZ     s:21466

     1505    21454    1         OR KQ$CG.CLOSING
     1506    21455    1         OR (ENTFLG=1 AND NOT KQ$CG.AUCTL.TERMCONLGL) THEN
     1507    21456    2           DO; /* Comgroup is being closed */

     1508    21457    2           CALL GUNLOCK;

  21457  2 003300   004705 701000 2                  TSX1    GUNLOCK
         2 003301   000000 011000                    NOP     0

     1509    21458                %UNLOCK (G=KQ_CGLGATE);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:208  

  21459  2 003302   000062 630400 3                  EPPR0   50
         2 003303   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003304   000000 701000 xent               TSX1    HFC$UNLOCK
         2 003305   000000 011000                    NOP     0

     1510    21461    2           GOTO NOCG;

  21461  2 003306   004051 710000 2                  TRA     NOCG

     1511    21462    2           END;
     1512    21463                           /* Bump NUMTERMS to keep the comgroup from
     1513    21464                              shutting down while we're looking */
     1514    21465        /**/
     1515    21466    1         KQ$CG.STATS.NUMTERMS=KQ$CG.STATS.NUMTERMS+1;

  21466  2 003307   000174 054100                    AOS     124,,PR0

     1516    21467    1         TRMFLG=1;

  21467  2 003310   000001 236007                    LDQ     1,DL
         2 003311   200026 756100                    STQ     TRMFLG,,AUTO

     1517    21468    1         CALL GUNLOCK;

  21468  2 003312   004705 701000 2                  TSX1    GUNLOCK
         2 003313   000000 011000                    NOP     0

     1518    21469              %UNLOCK (G=KQ_CGLGATE);

  21470  2 003314   000062 630400 3                  EPPR0   50
         2 003315   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003316   000000 701000 xent               TSX1    HFC$UNLOCK
         2 003317   000000 011000                    NOP     0

     1519    21472        /**/
     1520    21473    1         CALL KQX$LDASR(KQ$CG);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:209  

  21473  2 003320   200013 630500                    EPPR0   CTX$,,AUTO
         2 003321   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003322   000000 701000 xent               TSX1    KQX$LDASR
         2 003323   000000 011000                    NOP     0

     1521    21474        /**/
     1522    21475    1         IF ENTFLG < 2 THEN

  21475  2 003324   200020 235100                    LDA     ENTFLG,,AUTO
         2 003325   000002 115007                    CMPA    2,DL
         2 003326   003357 605000 2                  TPL     FINDSTA2

     1523    21476    2           DO;

     1524    21477    2           IF KQ_LOG.TSIO THEN

  21477  2 003327   000000 236000 xsym               LDQ     KQ_LOG
         2 003330   004000 316003                    CANQ    2048,DU
         2 003331   003352 600000 2                  TZE     s:21482

     1525    21478    2            CALL KQZ$LOG (KQ$CG,%KQLOG_TCRQ,S_CUN,0,

  21478  2 003332   200016 236100                    LDQ     LDCT$,,AUTO
         2 003333   000003 036003                    ADLQ    3,DU
         2 003334   200136 756100                    STQ     DA+7,,AUTO
         2 003335   200016 236100                    LDQ     LDCT$,,AUTO
         2 003336   000002 036003                    ADLQ    2,DU
         2 003337   200003 235100                    LDA     @PLDCT$,,AUTO
         2 003340   200134 757100                    STAQ    DA+5,,AUTO
         2 003341   000044 237000 3                  LDAQ    36
         2 003342   200132 757100                    STAQ    DA+3,,AUTO
         2 003343   000064 236000 3                  LDQ     52
         2 003344   200013 235100                    LDA     CTX$,,AUTO
         2 003345   200130 757100                    STAQ    DA+1,,AUTO
         2 003346   200130 630500                    EPPR0   DA+1,,AUTO
         2 003347   000025 631400 xsym               EPPR1   B_VECTNIL+21
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:210  
         2 003350   000000 701000 xent               TSX1    KQZ$LOG
         2 003351   000000 011000                    NOP     0

     1526    21479    2            ADDR(PLDCT$)->UBINHALF,
     1527    21480    2            SUBSTR(NK$LDCT.DEVNM,0,4),
     1528    21481    2            SUBSTR(NK$LDCT.DEVNM,4,4));
     1529    21482    2           NK$LDCT.CG$=CTX$;

  21482  2 003352   200013 236100                    LDQ     CTX$,,AUTO
         2 003353   200016 470500                    LDP0    LDCT$,,AUTO
         2 003354   000027 756100                    STQ     23,,PR0

     1530    21483    2           CALL CNNCTINFO ALTRET(TERMNOMEM);

  21483  2 003355   004136 701000 2                  TSX1    CNNCTINFO
         2 003356   004037 702000 2                  TSX2    TERMNOMEM

     1531    21484    2           END;

  21481  2 003357                       FINDSTA2     null
     1532    21485        /**/
     1533    21486
     1534    21487
     1535    21488                     /*    Find the
     1536    21489                      *    station in the
     1537    21490                      *    tree.  If not there
     1538    21491                      *    and this isn't FINDSTA,
     1539    21492                      *    then make a
     1540    21493                      *    new one.
     1541    21494                      */
     1542    21495    1   FINDSTA2:;
     1543    21496    1         CALL SLOCK;

  21496  2 003357   004623 701000 2                  TSX1    SLOCK
         2 003360   000000 011000                    NOP     0

     1544    21497    1         IF KQ$CG.CLOSING OR NOT KQ$CG.OPEN THEN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:211  

  21497  2 003361   200013 470500                    LDP0    CTX$,,AUTO
         2 003362   000105 236100                    LDQ     69,,PR0
         2 003363   000040 316007                    CANQ    32,DL
         2 003364   003367 601000 2                  TNZ     s:21499
         2 003365   000020 316007                    CANQ    16,DL
         2 003366   003372 601000 2                  TNZ     s:21502

     1545    21498    2           DO;

     1546    21499    2           CALL SUNLOCK;

  21499  2 003367   004635 701000 2                  TSX1    SUNLOCK
         2 003370   000000 011000                    NOP     0

     1547    21500    2           GOTO NOCG;

  21500  2 003371   004051 710000 2                  TRA     NOCG

     1548    21501    2           END;
     1549    21502    1         CALL KQB$SRCH (KQ$CG.STREE,KEY,SCRATCH$) ALTRET(GETTRM);

  21502  2 003372   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 003373   200132 451500                    STP1    DA+3,,AUTO
         2 003374   200022 633500                    EPPR3   KEY,,AUTO
         2 003375   200131 453500                    STP3    DA+2,,AUTO
         2 003376   200013 236100                    LDQ     CTX$,,AUTO
         2 003377   000075 036003                    ADLQ    61,DU
         2 003400   200130 756100                    STQ     DA+1,,AUTO
         2 003401   200130 630500                    EPPR0   DA+1,,AUTO
         2 003402   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 003403   000000 701000 xent               TSX1    KQB$SRCH
         2 003404   003410 702000 2                  TSX2    GETTRM

     1550    21503    1         STA$=SCRATCH$;

  21503  2 003405   200116 236100                    LDQ     SCRATCH$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:212  
         2 003406   200017 756100                    STQ     STA$,,AUTO

     1551    21504    1         GOTO GOTTERM;

  21504  2 003407   003555 710000 2                  TRA     GOTTERM

  21503  2 003410                       GETTRM       null
     1552    21505    1   GETTRM:;
     1553    21506    1         STA$=SCRATCH$;

  21506  2 003410   200116 236100                    LDQ     SCRATCH$,,AUTO
         2 003411   200017 756100                    STQ     STA$,,AUTO

     1554    21507    1         IF ENTFLG >= 2 THEN

  21507  2 003412   200020 235100                    LDA     ENTFLG,,AUTO
         2 003413   000002 115007                    CMPA    2,DL
         2 003414   003511 604000 2                  TMI     s:21548

     1555    21508    2           DO;

     1556    21509                     /*    FINDSTA: play around
     1557    21510                      *    a bit in the tree
     1558    21511                      *    to find the right
     1559    21512                      *    match for the
     1560    21513                      *    wild-carded name.
     1561    21514                      */
     1562    21515    2           IF STA$ = ADDR(NIL)

  21515  2 003415   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003416   003446 600000 2                  TZE     FINDSTA8
         2 003417   200027 235100                    LDA     INDX,,AUTO
         2 003420   000010 115007                    CMPA    8,DL
         2 003421   003446 600000 2                  TZE     FINDSTA8

     1563    21516    2           OR INDX = SIZEC(KEY) THEN GOTO FINDSTA8;
     1564    21517    2           IF ADDR(KQ$STA.BTN.KEY)->CHARINDX ~= ADDR(KEY)->CHARINDX THEN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:213  

  21517  2 003422   200017 470500                    LDP0    STA$,,AUTO
         2 003423   000000 620005                    EAX0    0,AL
         2 003424   200027 721100                    LXL1    INDX,,AUTO
         2 003425   040140 106540                    CMPC    fill='040'O
         2 003426   000005 000010                    ADSC9   5,,PR0                   cn=0,n=*X0
         2 003427   200022 000011                    ADSC9   KEY,,AUTO                cn=0,n=*X1
         2 003430   003457 600000 2                  TZE     FINDSTA5

     1565    21518    3             DO;

     1566    21519    3             IF ADDR(KQ$STA.BTN.KEY)->CHARINDX > ADDR(KEY)->CHARINDX THEN

  21519  2 003431   040140 106540                    CMPC    fill='040'O
         2 003432   200022 000011                    ADSC9   KEY,,AUTO                cn=0,n=*X1
         2 003433   000005 000011                    ADSC9   5,,PR0                   cn=0,n=*X1
         2 003434   003446 602000 2                  TNC     FINDSTA8

     1567    21520    3              GOTO FINDSTA8;
     1568    21521    3             STA$=KQ$STA.BTN.FLINK$;

  21521  2 003435   000004 236100                    LDQ     4,,PR0
         2 003436   200017 756100                    STQ     STA$,,AUTO

     1569    21522    3             IF STA$ = ADDR(NIL) THEN GOTO FINDSTA8;

  21522  2 003437   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003440   003446 600000 2                  TZE     FINDSTA8

     1570    21523    3             IF ADDR(KQ$STA.BTN.KEY)->CHARINDX ~= ADDR(KEY)->CHARINDX THEN

  21523  2 003441   200017 470500                    LDP0    STA$,,AUTO
         2 003442   040140 106540                    CMPC    fill='040'O
         2 003443   000005 000011                    ADSC9   5,,PR0                   cn=0,n=*X1
         2 003444   200022 000011                    ADSC9   KEY,,AUTO                cn=0,n=*X1
         2 003445   003457 600000 2                  TZE     FINDSTA5

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:214  
     1571    21524    4               DO;

  21522  2 003446                       FINDSTA8     null
     1572    21525    4   FINDSTA8:   ;
     1573    21526    4               ERROR=99;

  21526  2 003446   000143 235007                    LDA     99,DL
         2 003447   200006 470500                    LDP0    @ERROR,,AUTO
         2 003450   000000 755100                    STA     0,,PR0

     1574    21527    4               CALL SUNLOCK;

  21527  2 003451   004635 701000 2                  TSX1    SUNLOCK
         2 003452   000000 011000                    NOP     0

     1575    21528    4               PLDCT$=ADDR(NIL);

  21528  2 003453   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 003454   200003 470500                    LDP0    @PLDCT$,,AUTO
         2 003455   000000 756100                    STQ     0,,PR0

     1576    21529    4               GOTO TRMXIT;

  21529  2 003456   004054 710000 2                  TRA     TRMXIT

     1577    21530    4               END;

  21530  2 003457                       FINDSTA5     null
     1578    21531    3             END;
     1579    21532    2   FINDSTA5:;
     1580    21533    2           CALL STALOCK;

  21533  2 003457   004647 701000 2                  TSX1    STALOCK
         2 003460   000000 011000                    NOP     0

     1581    21534    2           IF KQ$STA.LDCT$ = ADDR(NIL)

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:215  
  21534  2 003461   200017 470500                    LDP0    STA$,,AUTO
         2 003462   000010 236100                    LDQ     8,,PR0
         2 003463   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003464   003467 600000 2                  TZE     s:21537
         2 003465   000020 234100                    SZN     16,,PR0
         2 003466   003472 605000 2                  TPL     s:21540

     1582    21535    2           OR KQ$STA.IDSC THEN
     1583    21536    3             DO;

     1584    21537    3             CALL STAUNLOCK;

  21537  2 003467   004661 701000 2                  TSX1    STAUNLOCK
         2 003470   000000 011000                    NOP     0

     1585    21538    3             GOTO FINDSTA8;

  21538  2 003471   003446 710000 2                  TRA     FINDSTA8

     1586    21539    3             END;
     1587    21540    2           IF ENTFLG = 3 THEN

  21540  2 003472   200020 235100                    LDA     ENTFLG,,AUTO
         2 003473   000003 115007                    CMPA    3,DL
         2 003474   003500 601000 2                  TNZ     s:21542

     1588    21541    2            KQ$STA.LOCKCNT=KQ$STA.LOCKCNT+1;

  21541  2 003475   000020 236100                    LDQ     16,,PR0
         2 003476   000001 036007                    ADLQ    1,DL
         2 003477   000020 552104                    STBQ    16,'04'O,PR0

     1589    21542    2           CALL STAUNLOCK;

  21542  2 003500   004661 701000 2                  TSX1    STAUNLOCK
         2 003501   000000 011000                    NOP     0

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:216  
     1590    21543    2           PLDCT$=KQ$STA.LDCT$;

  21543  2 003502   200017 470500                    LDP0    STA$,,AUTO
         2 003503   000010 236100                    LDQ     8,,PR0
         2 003504   200003 471500                    LDP1    @PLDCT$,,AUTO
         2 003505   100000 756100                    STQ     0,,PR1

     1591    21544    2           CALL SUNLOCK;

  21544  2 003506   004635 701000 2                  TSX1    SUNLOCK
         2 003507   000000 011000                    NOP     0

     1592    21545    2           GOTO TRMXIT;

  21545  2 003510   004054 710000 2                  TRA     TRMXIT

     1593    21546    2           END;
     1594    21547        /**/
     1595    21548    1         IF NOT KQ$CG.AUCTL.XSTALGL THEN

  21548  2 003511   200013 470500                    LDP0    CTX$,,AUTO
         2 003512   000133 236100                    LDQ     91,,PR0
         2 003513   000020 316007                    CANQ    16,DL
         2 003514   003523 601000 2                  TNZ     s:21556

     1596    21549    2           DO;

  21545  2 003515                       FINDSTA20    null
     1597    21550    2   FINDSTA20:;
     1598    21551    2           CALL SUNLOCK;

  21551  2 003515   004635 701000 2                  TSX1    SUNLOCK
         2 003516   000000 011000                    NOP     0

     1599    21552    2           ERROR=%E$STAILLGL;

  21552  2 003517   001542 235007                    LDA     866,DL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:217  
         2 003520   200006 470500                    LDP0    @ERROR,,AUTO
         2 003521   000000 755100                    STA     0,,PR0

     1600    21553    2           GOTO TRMXIT;

  21553  2 003522   004054 710000 2                  TRA     TRMXIT

     1601    21554    2           END;
     1602    21555        /**/
     1603    21556    1         CALL VALIDATE (KEY) ALTRET(STABAD);

  21556  2 003523   200022 631500                    EPPR1   KEY,,AUTO
         2 003524   200121 451500                    STP1    SCRATCH$+3,,AUTO
         2 003525   004605 701000 2                  TSX1    VALIDATE
         2 003526   004043 702000 2                  TSX2    STABAD

     1604    21557                     /*    Get a new station
     1605    21558                      *    block
     1606    21559                      */
     1607    21560    1         CALL KQT$MAKESTA (KQ$CG,SCRATCH$,KEY) ALTRET(FINDSTA21);

  21560  2 003527   200022 630500                    EPPR0   KEY,,AUTO
         2 003530   200132 450500                    STP0    DA+3,,AUTO
         2 003531   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 003532   200131 451500                    STP1    DA+2,,AUTO
         2 003533   200013 236100                    LDQ     CTX$,,AUTO
         2 003534   200130 756100                    STQ     DA+1,,AUTO
         2 003535   200130 630500                    EPPR0   DA+1,,AUTO
         2 003536   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 003537   000000 701000 xent               TSX1    KQT$MAKESTA
         2 003540   003546 702000 2                  TSX2    FINDSTA21

     1608    21561    1         STA$=SCRATCH$;

  21561  2 003541   200116 236100                    LDQ     SCRATCH$,,AUTO
         2 003542   200017 756100                    STQ     STA$,,AUTO

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:218  
     1609    21562    1         CALL STALOCK;

  21562  2 003543   004647 701000 2                  TSX1    STALOCK
         2 003544   000000 011000                    NOP     0

     1610    21563    1         GOTO FINDSTA25;

  21563  2 003545   003630 710000 2                  TRA     FINDSTA25

  21561  2 003546                       FINDSTA21    null
     1611    21564    1   FINDSTA21:;
     1612    21565    1         IF TRYCNT ~= 0 THEN GOTO TERMNOMEM;

  21565  2 003546   200036 235100                    LDA     TRYCNT,,AUTO
         2 003547   004037 601000 2                  TNZ     TERMNOMEM

     1613    21566    1         TRYCNT=1;

  21566  2 003550   000001 236007                    LDQ     1,DL
         2 003551   200036 756100                    STQ     TRYCNT,,AUTO

     1614    21567    1         CALL GTRM ALTRET(TERMNOMEM);

  21567  2 003552   004516 701000 2                  TSX1    GTRM
         2 003553   004037 702000 2                  TSX2    TERMNOMEM

     1615    21568    1         GOTO FINDSTA2;

  21568  2 003554   003357 710000 2                  TRA     FINDSTA2

  21566  2 003555                       GOTTERM      null
     1616    21569    1   GOTTERM:;
     1617    21570    1         IF ENTFLG >= 2 THEN GOTO FINDSTA5;

  21570  2 003555   200020 235100                    LDA     ENTFLG,,AUTO
         2 003556   000002 115007                    CMPA    2,DL
         2 003557   003457 605000 2                  TPL     FINDSTA5
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:219  

     1618    21571
     1619    21572
     1620    21573
     1621    21574                     /*    TRMCON: Now try
     1622    21575                      *    to perform the
     1623    21576                      *    connection.
     1624    21577                      *    First make various
     1625    21578                      *    legality checks,
     1626    21579                      *    then set LDCT$
     1627    21580                      *    in the station block
     1628    21581                      *    to keep anyone else
     1629    21582                      *    from connecting onto
     1630    21583                      *    it, and finish the
     1631    21584                      *    connection.
     1632    21585                      */
     1633    21586
     1634    21587    1         CALL STALOCK;

  21587  2 003560   004647 701000 2                  TSX1    STALOCK
         2 003561   000000 011000                    NOP     0

     1635    21588    1         IF NOT KQ$CG.AUCTL.XSTALGL AND NOT KQ$STA.PERM THEN

  21588  2 003562   200013 470500                    LDP0    CTX$,,AUTO
         2 003563   000133 236100                    LDQ     91,,PR0
         2 003564   000020 316007                    CANQ    16,DL
         2 003565   003575 601000 2                  TNZ     s:21593
         2 003566   200017 471500                    LDP1    STA$,,AUTO
         2 003567   100020 236100                    LDQ     16,,PR1
         2 003570   020000 316003                    CANQ    8192,DU
         2 003571   003575 601000 2                  TNZ     s:21593

     1636    21589    2           DO;

     1637    21590    2           CALL STAUNLOCK;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:220  
  21590  2 003572   004661 701000 2                  TSX1    STAUNLOCK
         2 003573   000000 011000                    NOP     0

     1638    21591    2           GOTO FINDSTA20;

  21591  2 003574   003515 710000 2                  TRA     FINDSTA20

     1639    21592    2           END;
     1640    21593    1         IF KQ$STA.LDCT$ ~= ADDR(NIL)

  21593  2 003575   200017 471500                    LDP1    STA$,,AUTO
         2 003576   100010 236100                    LDQ     8,,PR1
         2 003577   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003600   003603 601000 2                  TNZ     s:21596
         2 003601   100020 234100                    SZN     16,,PR1
         2 003602   003613 605000 2                  TPL     s:21601

     1641    21594    1         OR KQ$STA.IDSC THEN
     1642    21595    2           DO;

     1643    21596    2           CALL STAUNLOCK;

  21596  2 003603   004661 701000 2                  TSX1    STAUNLOCK
         2 003604   000000 011000                    NOP     0

     1644    21597    2           CALL SUNLOCK;

  21597  2 003605   004635 701000 2                  TSX1    SUNLOCK
         2 003606   000000 011000                    NOP     0

     1645    21598    2           ERROR=%E$DUPNM;

  21598  2 003607   001543 235007                    LDA     867,DL
         2 003610   200006 470500                    LDP0    @ERROR,,AUTO
         2 003611   000000 755100                    STA     0,,PR0

     1646    21599    2           GOTO TRMXIT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:221  

  21599  2 003612   004054 710000 2                  TRA     TRMXIT

     1647    21600    2           END;
     1648    21601    1         IF KQ$STA.SPECIAL

  21601  2 003613   100023 236100                    LDQ     19,,PR1
         2 003614   200000 316007                    CANQ    65536,DL
         2 003615   003620 601000 2                  TNZ     s:21604
         2 003616   400000 316007                    CANQ    -131072,DL
         2 003617   003630 600000 2                  TZE     FINDSTA25

     1649    21602    1         OR KQ$STA.AUP THEN
     1650    21603    2           DO;

     1651    21604    2           CALL STAUNLOCK;

  21604  2 003620   004661 701000 2                  TSX1    STAUNLOCK
         2 003621   000000 011000                    NOP     0

     1652    21605    2           CALL SUNLOCK;

  21605  2 003622   004635 701000 2                  TSX1    SUNLOCK
         2 003623   000000 011000                    NOP     0

     1653    21606    2           ERROR=%E$NTRMSTA;

  21606  2 003624   001572 235007                    LDA     890,DL
         2 003625   200006 470500                    LDP0    @ERROR,,AUTO
         2 003626   000000 755100                    STA     0,,PR0

     1654    21607    2           GOTO TRMXIT;

  21607  2 003627   004054 710000 2                  TRA     TRMXIT

  21601  2 003630                       FINDSTA25    null
     1655    21608    2           END;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:222  
     1656    21609        /**/
     1657    21610        /**/
     1658    21611        /**/
     1659    21612                     /*    Now connect the terminal to
     1660    21613                      *    the comgroup.  From here on
     1661    21614                      *    in, nothing can go wrong
     1662    21615                      *    go wrong go wrong go wrong....
     1663    21616                      *    I.e. the terminal connect
     1664    21617                      *    cannot be aborted...legality
     1665    21618                      *    checks cannot be added after
     1666    21619                      *    this point.  Hence all the
     1667    21620                      *    complex magic to obtain the
     1668    21621                      *    connect info DBLK before even
     1669    21622                      *    looking in the station tree,
     1670    21623                      *    etc.  The terminal will be
     1671    21624                      *    connected to the comgroup now,
     1672    21625                      *    BUT the LDCT is not set to
     1673    21626                      *    point at the KQ$STA till
     1674    21627                      *    a bit later.  At that point
     1675    21628                      *    we check to see if the
     1676    21629                      *    terminal is trying to
     1677    21630                      *    disconnect, and if so
     1678    21631                      *    call KQP$DISC.
     1679    21632                      */
     1680    21633    1   FINDSTA25:;
     1681    21634    1         IF KQ_LOG.TSIO THEN

  21634  2 003630   000000 236000 xsym               LDQ     KQ_LOG
         2 003631   004000 316003                    CANQ    2048,DU
         2 003632   003657 600000 2                  TZE     s:21643

     1682    21635    2           DO;

     1683    21636    2           INDXR$=STA$;

  21636  2 003633   200017 236100                    LDQ     STA$,,AUTO
         2 003634   200027 756100                    STQ     INDX,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:223  

     1684    21637    2           CALL KQZ$LOG (KQ$CG,%KQLOG_TCDN,S_CUN,

  21637  2 003635   000006 036003                    ADLQ    6,DU
         2 003636   200136 756100                    STQ     DA+7,,AUTO
         2 003637   200017 236100                    LDQ     STA$,,AUTO
         2 003640   000005 036003                    ADLQ    5,DU
         2 003641   200135 756100                    STQ     DA+6,,AUTO
         2 003642   200027 630500                    EPPR0   INDX,,AUTO
         2 003643   200134 450500                    STP0    DA+5,,AUTO
         2 003644   200027 631500                    EPPR1   INDX,,AUTO
         2 003645   200133 451500                    STP1    DA+4,,AUTO
         2 003646   000044 236000 3                  LDQ     36
         2 003647   200132 756100                    STQ     DA+3,,AUTO
         2 003650   000066 236000 3                  LDQ     54
         2 003651   200013 235100                    LDA     CTX$,,AUTO
         2 003652   200130 757100                    STAQ    DA+1,,AUTO
         2 003653   200130 630500                    EPPR0   DA+1,,AUTO
         2 003654   000025 631400 xsym               EPPR1   B_VECTNIL+21
         2 003655   000000 701000 xent               TSX1    KQZ$LOG
         2 003656   000000 011000                    NOP     0

     1685    21638    2           INDXR$,
     1686    21639    2           ADDR(INDXR$)->UBINHALF,
     1687    21640    2           SUBSTR(STA$->KQ$STA.BTN.KEY,0,4),
     1688    21641    2           SUBSTR(STA$->KQ$STA.BTN.KEY,4,4));
     1689    21642    2           END;

     1690    21643    1         KQ$STA.LDCT$=LDCT$;

  21643  2 003657   200016 236100                    LDQ     LDCT$,,AUTO
         2 003660   200017 470500                    LDP0    STA$,,AUTO
         2 003661   000010 756100                    STQ     8,,PR0

     1691    21644    1         KQ$STA.TERM='1'B;

  21644  2 003662   040000 236003                    LDQ     16384,DU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:224  
         2 003663   000020 256100                    ORSQ    16,,PR0

     1692    21645    1         KQ$STA.USR#=0;

  21645  2 003664   000000 236003                    LDQ     0,DU
         2 003665   000020 552110                    STBQ    16,'10'O,PR0

     1693    21646    1         CALL STAINIT;

  21646  2 003666   004074 701000 2                  TSX1    STAINIT
         2 003667   000000 011000                    NOP     0

     1694    21647    1         KQ$STA.SGHD$=ADDR(NIL);

  21647  2 003670   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 003671   200017 470500                    LDP0    STA$,,AUTO
         2 003672   000014 756100                    STQ     12,,PR0

     1695    21648    1         KQ$STA.MBLK$=CNNCT.MBLK$;

  21648  2 003673   200035 236100                    LDQ     CNNCT+1,,AUTO
         2 003674   000012 756100                    STQ     10,,PR0

     1696    21649    1         CNNCT.MBLK$=ADDR(NIL);

  21649  2 003675   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 003676   200035 756100                    STQ     CNNCT+1,,AUTO

     1697    21650    1         IF ENTFLG < 0 THEN

  21650  2 003677   200020 235100                    LDA     ENTFLG,,AUTO
         2 003700   003761 605000 2                  TPL     s:21688

     1698    21651    2           DO;

     1699    21652
     1700    21653                     /*    KCO$MONCON: Do
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:225  
     1701    21654                      *    the special
     1702    21655                      *    DCB-like magic
     1703    21656                      *    to connect
     1704    21657                      *    MONKEY.
     1705    21658                      */
     1706    21659
     1707    21660    2           NK$LDCT.STA$=STA$;

  21660  2 003701   200017 236100                    LDQ     STA$,,AUTO
         2 003702   200016 471500                    LDP1    LDCT$,,AUTO
         2 003703   100012 756100                    STQ     10,,PR1

     1708    21661    2           KQ$STA.TOLDAU='0'B;

  21661  2 003704   000067 236000 3                  LDQ     55
         2 003705   000020 356100                    ANSQ    16,,PR0

     1709    21662    2           KQ$STA.CNNCTDDA=CNNCT.DDA;

  21662  2 003706   200034 235100                    LDA     CNNCT,,AUTO
         2 003707   000021 755100                    STA     17,,PR0

     1710    21663    2           CNNCT.DDA=0;

  21663  2 003710   200034 450100                    STZ     CNNCT,,AUTO

     1711    21664    2           KQ$STA.CNNCTSIZE=SIZEC(B$CGAUCIDCB);

  21664  2 003711   000044 220003                    LDX0    36,DU
         2 003712   000015 440100                    SXL0    13,,PR0

     1712    21665    2           KQ$STA.DCBLNK$=KQ$CG.DCBHD$;

  21665  2 003713   200013 473500                    LDP3    CTX$,,AUTO
         2 003714   300103 236100                    LDQ     67,,PR3
         2 003715   000014 756100                    STQ     12,,PR0

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:226  
     1713    21666    2           KQ$CG.DCBHD$=STA$;

  21666  2 003716   200017 236100                    LDQ     STA$,,AUTO
         2 003717   300103 756100                    STQ     67,,PR3

     1714    21667    2           KQ$STA.MONDCB='1'B;

  21667  2 003720   100000 236003                    LDQ     32768,DU
         2 003721   000020 256100                    ORSQ    16,,PR0

     1715    21668    2           KQ$STA.TERM='0'B;

  21668  2 003722   000047 236000 3                  LDQ     39
         2 003723   000020 356100                    ANSQ    16,,PR0

     1716    21669    2           CALL STAUNLOCK;

  21669  2 003724   004661 701000 2                  TSX1    STAUNLOCK
         2 003725   000000 011000                    NOP     0

     1717    21670    2           CALL SUNLOCK;

  21670  2 003726   004635 701000 2                  TSX1    SUNLOCK
         2 003727   000000 011000                    NOP     0

     1718    21671    2           CALL GLOCK;

  21671  2 003730   004673 701000 2                  TSX1    GLOCK
         2 003731   000000 011000                    NOP     0

     1719    21672    2           KQ$CG.STATS.NUMTERMS=KQ$CG.STATS.NUMTERMS-1;

  21672  2 003732   200013 470500                    LDP0    CTX$,,AUTO
         2 003733   000001 336007                    LCQ     1,DL
         2 003734   000174 056100                    ASQ     124,,PR0

     1720    21673    2           KQ$CG.STATS.NUMDCBS=KQ$CG.STATS.NUMDCBS+1;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:227  

  21673  2 003735   000173 054100                    AOS     123,,PR0

     1721    21674    2           CALL GUNLOCK;

  21674  2 003736   004705 701000 2                  TSX1    GUNLOCK
         2 003737   000000 011000                    NOP     0

     1722    21675    2           CALL KQC$ACTSTA (KQ$STA);

  21675  2 003740   200017 630500                    EPPR0   STA$,,AUTO
         2 003741   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003742   000000 701000 xent               TSX1    KQC$ACTSTA
         2 003743   000000 011000                    NOP     0

     1723    21676    2           CALL KCA$TELLAUM(KQ$STA,%CG_DOPN#,ADDR(B$CGAUCIDCB));

  21676  2 003744   200041 630500                    EPPR0   B$CGAUCIDCB,,AUTO
         2 003745   200130 450500                    STP0    DA+1,,AUTO
         2 003746   200130 631500                    EPPR1   DA+1,,AUTO
         2 003747   200133 451500                    STP1    DA+4,,AUTO
         2 003750   000002 236000 3                  LDQ     2
         2 003751   200132 756100                    STQ     DA+3,,AUTO
         2 003752   200017 236100                    LDQ     STA$,,AUTO
         2 003753   200131 756100                    STQ     DA+2,,AUTO
         2 003754   200131 630500                    EPPR0   DA+2,,AUTO
         2 003755   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 003756   000000 701000 xent               TSX1    KCA$TELLAUM
         2 003757   000000 011000                    NOP     0

     1724    21677    2           RETURN;

  21677  2 003760   000000 702200 xent               TSX2  ! X66_ARET

     1725    21678    2           END;
     1726    21679        /**/
     1727    21680
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:228  
     1728    21681                     /*    Continue with
     1729    21682                      *    the cleanup of
     1730    21683                      *    a vanilla
     1731    21684                      *    TRMCON.
     1732    21685                      */
     1733    21686
     1734    21687    2           DO INHIBIT;

     1735    21688    2           NK$LDCT.DFLG.INPUT=B$CGAUCI.FLG.INPUT;

  21688  2 003761   200016 471700                    LDP1  ! LDCT$,,AUTO
         2 003762   200005 473700                    LDP3  ! @B$CGAUCI,,AUTO
         2 003763   300010 236300                    LDQ   ! 8,,PR3
         2 003764   000022 772200                    QRL   ! 18
         2 003765   100006 676300                    ERQ   ! 6,,PR1
         2 003766   400000 376207                    ANQ   ! -131072,DL
         2 003767   100006 656300                    ERSQ  ! 6,,PR1

     1736    21689    2           NK$LDCT.DFLG.OUTPUT=B$CGAUCI.FLG.OUTPUT;

  21689  2 003770   300010 236300                    LDQ   ! 8,,PR3
         2 003771   000022 772200                    QRL   ! 18
         2 003772   100006 676300                    ERQ   ! 6,,PR1
         2 003773   200000 376207                    ANQ   ! 65536,DL
         2 003774   100006 656300                    ERSQ  ! 6,,PR1

     1737    21690    2           END;

     1738    21691    1         KQ$STA.DVBYTE=KQ$CG.AUCTL.DVBYTE;

  21691  2 003775   200013 474500                    LDP4    CTX$,,AUTO
         2 003776   400135 236100                    LDQ     93,,PR4
         2 003777   000011 772000                    QRL     9
         2 004000   000023 552120                    STBQ    19,'20'O,PR0

     1739    21692    1         KQ$STA.LOCKCNT=KQ$STA.LOCKCNT+1;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:229  
  21692  2 004001   000020 236100                    LDQ     16,,PR0
         2 004002   000001 036007                    ADLQ    1,DL
         2 004003   000020 552104                    STBQ    16,'04'O,PR0

     1740    21693    1         KQ$STA.CNNCTDDA=CNNCT.DDA;

  21693  2 004004   200034 236100                    LDQ     CNNCT,,AUTO
         2 004005   000021 756100                    STQ     17,,PR0

     1741    21694    1         CNNCT.DDA=0;

  21694  2 004006   200034 450100                    STZ     CNNCT,,AUTO

     1742    21695    1         KQ$STA.CNNCTSIZE=SIZEC(B$CGAUCI)+(B$CGAUCI.NWINFO*4);

  21695  2 004007   300010 236100                    LDQ     8,,PR3
         2 004010   000002 736000                    QLS     2
         2 004011   003774 376007                    ANQ     2044,DL
         2 004012   000044 620006                    EAX0    36,QL
         2 004013   000015 440100                    SXL0    13,,PR0

     1743    21696    1         CALL STAUNLOCK;

  21696  2 004014   004661 701000 2                  TSX1    STAUNLOCK
         2 004015   000000 011000                    NOP     0

     1744    21697    1         CALL SUNLOCK;

  21697  2 004016   004635 701000 2                  TSX1    SUNLOCK
         2 004017   000000 011000                    NOP     0

     1745    21698    2           DO INHIBIT;

     1746    21699                     /*    A bit of magic here.  Prior to this point
     1747    21700                      *    the LDCT RESCOD is NK_CGTRM, thus KCD$DSCTRM
     1748    21701                      *    will be called if a DISCONNECT request is
     1749    21702                      *    received from the FEP.  KCD$DSCTRM calls
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:230  
     1750    21703                      *    KQP$DISC who will do nothing since either
     1751    21704                      *    or both LDCT.CG$ and LDCT.STA$ are NIL.
     1752    21705                      *    (Both will be NIL if we get interrupted
     1753    21706                      *    in KLM$EXHUME after switching RESCOD to
     1754    21707                      *    CGTRM from NOCG but before calling here;
     1755    21708                      *    STA$ will be NIL if the DISC message
     1756    21709                      *    arrives after setting CG$ (above) but
     1757    21710                      *    before we get here).
     1758    21711                      *
     1759    21712                      *    What we do is set STA$, then check for
     1760    21713                      *    LDCT.OLDSC.  If it's set, we know KQP$DISC
     1761    21714                      *    was called & did nothing (long ago), so we
     1762    21715                      *    call him now.  We do this inhibited to prevent
     1763    21716                      *    the DISC from arriving via interrupt after
     1764    21717                      *    we set STA$ but before we chk OLDSC.  This
     1765    21718                      *    code MUST run on the master CPU.
     1766    21719                      */
     1767    21720    2           NK$LDCT.STA$=STA$;

  21720  2 004020   200017 236300                    LDQ   ! STA$,,AUTO
         2 004021   200016 470700                    LDP0  ! LDCT$,,AUTO
         2 004022   000012 756300                    STQ   ! 10,,PR0

     1768    21721    2           IF NK$LDCT.DFLG.OLDSC      /* Term has disconnected */

  21721  2 004023   000006 236300                    LDQ   ! 6,,PR0
         2 004024   010000 316207                    CANQ  ! 4096,DL
         2 004025   004032 600200 2                  TZE   ! s:21723

     1769    21722    2           THEN CALL KQP$DISC(NK$LDCT);

  21722  2 004026   200016 630700                    EPPR0 ! LDCT$,,AUTO
         2 004027   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         2 004030   000000 701200 xent               TSX1  ! KQP$DISC
         2 004031   000000 011200                    NOP   ! 0

     1770    21723    2           CALL KQP$UNLOCK (STA$->KQ$STA);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:231  

  21723  2 004032   200017 630700                    EPPR0 ! STA$,,AUTO
         2 004033   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         2 004034   000000 701200 xent               TSX1  ! KQP$UNLOCK
         2 004035   000000 011200                    NOP   ! 0

     1771    21724    2           END;

     1772    21725    1         RETURN;

  21725  2 004036   000000 702200 xent               TSX2  ! X66_ARET

  21720  2 004037                       TERMNOMEM    null
     1773    21726        /**/
     1774    21727        /**/
     1775    21728    1   TERMNOMEM:;
     1776    21729    1         ERROR=%E$CGCXT;

  21729  2 004037   002160 235007                    LDA     1136,DL
         2 004040   200006 470500                    LDP0    @ERROR,,AUTO
         2 004041   000000 755100                    STA     0,,PR0

     1777    21730    1         GOTO TRMXIT;

  21730  2 004042   004054 710000 2                  TRA     TRMXIT

  21729  2 004043                       STABAD       null
     1778    21731    1   STABAD:;
     1779    21732    1         CALL SUNLOCK;

  21732  2 004043   004635 701000 2                  TSX1    SUNLOCK
         2 004044   000000 011000                    NOP     0

     1780    21733    1         ERROR=%E$STABAD;

  21733  2 004045   001561 235007                    LDA     881,DL
         2 004046   200006 470500                    LDP0    @ERROR,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:232  
         2 004047   000000 755100                    STA     0,,PR0

     1781    21734    1         GOTO TRMXIT;

  21734  2 004050   004054 710000 2                  TRA     TRMXIT

  21733  2 004051                       NOCG         null
     1782    21735    1   NOCG: ;
     1783    21736    1         ERROR=%E$NOCG;

  21736  2 004051   001540 235007                    LDA     864,DL
         2 004052   200006 470500                    LDP0    @ERROR,,AUTO
         2 004053   000000 755100                    STA     0,,PR0

  21736  2 004054                       TRMXIT       null
     1784    21737    1   TRMXIT:;
     1785    21738    1         IF TRMFLG~=0 THEN

  21738  2 004054   200026 235100                    LDA     TRMFLG,,AUTO
         2 004055   004062 600000 2                  TZE     s:21740

     1786    21739    1          CALL KCO$TRMGONE (KQ$CG);

  21739  2 004056   200013 630500                    EPPR0   CTX$,,AUTO
         2 004057   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004060   000000 701000 xent               TSX1    KCO$TRMGONE
         2 004061   000000 011000                    NOP     0

     1787    21740    1         IF ERROR=0 THEN

  21740  2 004062   200006 470500                    LDP0    @ERROR,,AUTO
         2 004063   000000 235100                    LDA     0,,PR0
         2 004064   004066 601000 2                  TNZ     s:21742

     1788    21741    1          RETURN;

  21741  2 004065   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:233  

     1789    21742    1         IF ENTFLG < 2 THEN CALL RELCNNCT;

  21742  2 004066   200020 236100                    LDQ     ENTFLG,,AUTO
         2 004067   000002 116007                    CMPQ    2,DL
         2 004070   004073 605000 2                  TPL     s:21743

  21742  2 004071   004407 701000 2                  TSX1    RELCNNCT
         2 004072   000000 011000                    NOP     0

     1790    21743    1         ALTRETURN;

  21743  2 004073   000000 702200 xent               TSX2  ! X66_AALT

     1791    21744        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:234  
     1792    21745        /**/
     1793    21746        /******************************************************************************
     1794    21747        *                                                                             *
     1795    21748        *  SSS   U   U  BBBB   RRRR    OOO   U   U  TTTTT   III   N   N  EEEEE   SSS  *
     1796    21749        * S   S  U   U  B   B  R   R  O O O  U   U    T      I    N   N  E      S   S *
     1797    21750        * S      U   U  B   B  R   R  O O O  U   U    T      I    NN  N  E      S     *
     1798    21751        *  SSS   U   U  BBBB   RRRR   O  OO  U   U    T      I    N N N  EEEE    SSS  *
     1799    21752        *     S  U   U  B   B  R R    O   O  U   U    T      I    N  NN  E          S *
     1800    21753        * S   S  U   U  B   B  R  R   O   O  U   U    T      I    N   N  E      S   S *
     1801    21754        *  SSS    UUU   BBBB   R   R   OOO    UUU     T     III   N   N  EEEEE   SSS  *
     1802    21755        *                                                                             *
     1803    21756        ******************************************************************************/
     1804    21757
     1805    21758        /****************************************************************
     1806    21759        *****************************************************************/
     1807    21760        /*D* NAME:         STAINIT
     1808    21761             PURPOSE:      To initialize a station block
     1809    21762             DESCRIPTION:  Sets up stuff common to DCBs and terminals */
     1810    21763    1   STAINIT: PROC;

  21763  2 004074   200120 741300       STAINIT      STX1  ! SCRATCH$+2,,AUTO

     1811    21764        /**/
     1812    21765    2         KQ$STA.TOLDAU='0'B;

  21765  2 004075   200017 470500                    LDP0    STA$,,AUTO
         2 004076   000067 236000 3                  LDQ     55
         2 004077   000020 356100                    ANSQ    16,,PR0

     1813    21766    2         KQ$STA.OPNBLKED='0'B;

  21766  2 004100   000027 236000 3                  LDQ     23
         2 004101   000023 356100                    ANSQ    19,,PR0

     1814    21767    2         KQ$STA.DSCREQW='0'B;

  21767  2 004102   000023 356100                    ANSQ    19,,PR0
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:235  

     1815    21768    2         KQ$STA.OPNREJ='0'B;

  21768  2 004103   000030 236000 3                  LDQ     24
         2 004104   000023 356100                    ANSQ    19,,PR0

     1816    21769    2         KQ$STA.DSCREQS='0'B;

  21769  2 004105   000023 356100                    ANSQ    19,,PR0

     1817    21770    2         KQ$STA.STARSDUN='0'B;

  21770  2 004106   000070 236000 3                  LDQ     56
         2 004107   000023 356100                    ANSQ    19,,PR0

     1818    21771    2         KQ$STA.PVGSENSE='0'B;

  21771  2 004110   000026 236000 3                  LDQ     22
         2 004111   000023 356100                    ANSQ    19,,PR0

     1819    21772    2         KQ$STA.SUCCREAD='0'B;

  21772  2 004112   000024 236000 3                  LDQ     20
         2 004113   000020 356100                    ANSQ    16,,PR0

     1820    21773    2         KQ$STA.TERR='0'B;

  21773  2 004114   000020 356100                    ANSQ    16,,PR0

     1821    21774    2         KQ$STA.IDSC='0'B;

  21774  2 004115   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 004116   000020 356100                    ANSQ    16,,PR0

     1822    21775    2         KQ$STA.SAVIDSC='0'B;

  21775  2 004117   000033 236000 3                  LDQ     27
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:236  
         2 004120   000023 356100                    ANSQ    19,,PR0

     1823    21776    2         KQ$STA.AU='0'B;

  21776  2 004121   000071 236000 3                  LDQ     57
         2 004122   000020 356100                    ANSQ    16,,PR0

     1824    21777    2         KQ$STA.EVNT='0'B;

  21777  2 004123   000025 236000 3                  LDQ     21
         2 004124   000020 356100                    ANSQ    16,,PR0

     1825    21778    2         KQ$STA.EVCNT=0;

  21778  2 004125   000000 236003                    LDQ     0,DU
         2 004126   000023 552140                    STBQ    19,'40'O,PR0

     1826    21779    2         KQ$STA.DSID=KQ$CG.MSGID;

  21779  2 004127   200013 471500                    LDP1    CTX$,,AUTO
         2 004130   100113 235100                    LDA     75,,PR1
         2 004131   000022 755100                    STA     18,,PR0

     1827    21780    2         KQ$STA.WRITES=0;

  21780  2 004132   000027 450100                    STZ     23,,PR0

     1828    21781    2         KQ$STA.READS=0;

  21781  2 004133   000026 450100                    STZ     22,,PR0

     1829    21782    2         RETURN;

  21782  2 004134   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
         2 004135   000001 702211                    TSX2  ! 1,X1

     1830    21783    2   END STAINIT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:237  
     1831    21784        /****************************************************************
     1832    21785        *****************************************************************/
     1833    21786        /*D* NAME:         CNNCTINFO
     1834    21787             PURPOSE:      To set up the connect info for a station
     1835    21788             DESCRIPTION:  Gets a data block, stuffs it with the
     1836    21789                           connect info, and puts the DDA in CNNCT.DDA.
     1837    21790                           Unlocks the DBLK.  Gets an MBLK and puts its
     1838    21791                           address in CNNCT.MBLK$.
     1839    21792                           If this is a terminal connecting, gets another
     1840    21793                           data block, stuffs it with the same stuff as the
     1841    21794                           first data block, and puts the DDA into MBLK.DDA.
     1842    21795                           ALTRETs if any of this fails after giving back
     1843    21796                           all that it had gotten.
     1844    21797        */
     1845    21798    1   CNNCTINFO: PROC ALTRET;

  21798  2 004136   200120 741300       CNNCTINFO    STX1  ! SCRATCH$+2,,AUTO

     1846    21799        /**/
     1847    21800    2   DCL SIZ UBIN;
     1848    21801    2         IF ENTFLG <= 0 THEN

  21801  2 004137   200020 235100                    LDA     ENTFLG,,AUTO
         2 004140   004144 605400 2                  TPNZ    s:21803

     1849    21802    2          SIZ=SIZEC(B$CGAUCIDCB);

  21802  2 004141   000044 236007                    LDQ     36,DL
         2 004142   200121 756100                    STQ     SIZ,,AUTO
         2 004143   004152 710000 2                  TRA     s:21804

     1850    21803    2         ELSE SIZ=SIZEC(B$CGAUCI)+(B$CGAUCI.NWINFO*4);

  21803  2 004144   200005 470500                    LDP0    @B$CGAUCI,,AUTO
         2 004145   000010 236100                    LDQ     8,,PR0
         2 004146   000002 736000                    QLS     2
         2 004147   003774 376007                    ANQ     2044,DL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:238  
         2 004150   000044 036007                    ADLQ    36,DL
         2 004151   200121 756100                    STQ     SIZ,,AUTO

     1851    21804    2         I=SIZ;

  21804  2 004152   200021 756100                    STQ     I,,AUTO

     1852    21805    2         CALL KQD$GETR(KQ$CG,DBLK$,I) ALTRET(ALTRT);

  21805  2 004153   200021 630500                    EPPR0   I,,AUTO
         2 004154   200132 450500                    STP0    DA+3,,AUTO
         2 004155   200030 631500                    EPPR1   DBLK$,,AUTO
         2 004156   200131 451500                    STP1    DA+2,,AUTO
         2 004157   200013 236100                    LDQ     CTX$,,AUTO
         2 004160   200130 756100                    STQ     DA+1,,AUTO
         2 004161   200130 630500                    EPPR0   DA+1,,AUTO
         2 004162   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004163   000000 701000 xent               TSX1    KQD$GETR
         2 004164   004403 702000 2                  TSX2    ALTRT

     1853    21806    2         KQ$DBLK.STAMP=ADDR(NK$LDCT.DEVNM)->UBINHALF;

  21806  2 004165   200016 470500                    LDP0    LDCT$,,AUTO
         2 004166   000002 220100                    LDX0    2,,PR0
         2 004167   200030 471500                    LDP1    DBLK$,,AUTO
         2 004170   100000 740100                    STX0    0,,PR1

     1854    21807    2         CNNCT.DDA=I;

  21807  2 004171   200021 235100                    LDA     I,,AUTO
         2 004172   200034 755100                    STA     CNNCT,,AUTO

     1855    21808    2         I=SIZ;

  21808  2 004173   200121 236100                    LDQ     SIZ,,AUTO
         2 004174   200021 756100                    STQ     I,,AUTO

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:239  
     1856    21809    2         IF ENTFLG <= 0

  21809  2 004175   200020 235100                    LDA     ENTFLG,,AUTO
         2 004176   004206 605400 2                  TPNZ    s:21812

     1857    21810    2         THEN PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=ADDR(B$CGAUCIDCB)->MOVEI;

  21810  2 004177   000000 620006                    EAX0    0,QL
         2 004200   200030 471500                    LDP1    DBLK$,,AUTO
         2 004201   200021 721100                    LXL1    I,,AUTO
         2 004202   040140 100540                    MLR     fill='040'O
         2 004203   200041 000010                    ADSC9   B$CGAUCIDCB,,AUTO        cn=0,n=*X0
         2 004204   100006 000011                    ADSC9   6,,PR1                   cn=0,n=*X1
         2 004205   004243 710000 2                  TRA     s:21816

     1858    21811    3         ELSE DO;

     1859    21812    3           B$CGAUCI.FLG.INPUT=B$CGAUCI.FLG.INPUT&KQ$CG.AUCTL.INPUT;

  21812  2 004206   200013 471500                    LDP1    CTX$,,AUTO
         2 004207   100136 236100                    LDQ     94,,PR1
         2 004210   000017 736000                    QLS     15
         2 004211   400000 376003                    ANQ     -131072,DU
         2 004212   200130 756100                    STQ     DA+1,,AUTO
         2 004213   200005 473500                    LDP3    @B$CGAUCI,,AUTO
         2 004214   300010 236100                    LDQ     8,,PR3
         2 004215   400000 376003                    ANQ     -131072,DU
         2 004216   200130 376100                    ANQ     DA+1,,AUTO
         2 004217   300010 676100                    ERQ     8,,PR3
         2 004220   400000 376003                    ANQ     -131072,DU
         2 004221   300010 656100                    ERSQ    8,,PR3

     1860    21813    3           B$CGAUCI.FLG.OUTPUT=B$CGAUCI.FLG.OUTPUT&KQ$CG.AUCTL.OUTPUT;

  21813  2 004222   100136 236100                    LDQ     94,,PR1
         2 004223   000020 736000                    QLS     16
         2 004224   400000 376003                    ANQ     -131072,DU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:240  
         2 004225   200130 756100                    STQ     DA+1,,AUTO
         2 004226   300010 236100                    LDQ     8,,PR3
         2 004227   000001 736000                    QLS     1
         2 004230   400000 376003                    ANQ     -131072,DU
         2 004231   200130 376100                    ANQ     DA+1,,AUTO
         2 004232   000001 772000                    QRL     1
         2 004233   300010 676100                    ERQ     8,,PR3
         2 004234   200000 376003                    ANQ     65536,DU
         2 004235   300010 656100                    ERSQ    8,,PR3

     1861    21814    3           PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=ADDR(B$CGAUCI)->MOVEI;

  21814  2 004236   200021 720100                    LXL0    I,,AUTO
         2 004237   200030 474500                    LDP4    DBLK$,,AUTO
         2 004240   040140 100540                    MLR     fill='040'O
         2 004241   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         2 004242   400006 000010                    ADSC9   6,,PR4                   cn=0,n=*X0

     1862    21815    3           END;

     1863    21816    2         CALL KQD$UNLOCK(KQ$CG,DBLK$);

  21816  2 004243   200030 631500                    EPPR1   DBLK$,,AUTO
         2 004244   200131 451500                    STP1    DA+2,,AUTO
         2 004245   200013 236100                    LDQ     CTX$,,AUTO
         2 004246   200130 756100                    STQ     DA+1,,AUTO
         2 004247   200130 630500                    EPPR0   DA+1,,AUTO
         2 004250   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004251   000000 701000 xent               TSX1    KQD$UNLOCK
         2 004252   000000 011000                    NOP     0

     1864    21817    2         I=SIZEW(KQ$MBLK);

  21817  2 004253   000020 235007                    LDA     16,DL
         2 004254   200021 755100                    STA     I,,AUTO

     1865    21818    2         CALL KQM$GETBK (KQ$CG,CNNCT.MBLK$,I) ALTRET(NMB);
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:241  

  21818  2 004255   200021 630500                    EPPR0   I,,AUTO
         2 004256   200132 450500                    STP0    DA+3,,AUTO
         2 004257   200035 631500                    EPPR1   CNNCT+1,,AUTO
         2 004260   200131 451500                    STP1    DA+2,,AUTO
         2 004261   200013 236100                    LDQ     CTX$,,AUTO
         2 004262   200130 756100                    STQ     DA+1,,AUTO
         2 004263   200130 630500                    EPPR0   DA+1,,AUTO
         2 004264   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004265   000000 701000 xent               TSX1    KQM$GETBK
         2 004266   004302 702000 2                  TSX2    NMB

     1866    21819    2         CALL KQM$RELMBLK (KQ$CG,CNNCT.MBLK$);

  21819  2 004267   200035 630500                    EPPR0   CNNCT+1,,AUTO
         2 004270   200131 450500                    STP0    DA+2,,AUTO
         2 004271   200013 236100                    LDQ     CTX$,,AUTO
         2 004272   200130 756100                    STQ     DA+1,,AUTO
         2 004273   200130 630500                    EPPR0   DA+1,,AUTO
         2 004274   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004275   000000 701000 xent               TSX1    KQM$RELMBLK
         2 004276   000000 011000                    NOP     0

     1867    21820    2         CNNCT.MBLK$=ADDR(NIL);

  21820  2 004277   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 004300   200035 756100                    STQ     CNNCT+1,,AUTO

     1868    21821    2         GOTO GMB;

  21821  2 004301   004313 710000 2                  TRA     GMB

     1869    21822    2   NMB:  CALL SSR$REG (%SS_SL,,1); /* Wait for garbage collector */

  21822  2 004302   000003 236000 3     NMB          LDQ     3
         2 004303   200132 756100                    STQ     DA+3,,AUTO
         2 004304   000001 236000 xsym               LDQ     B_VECTNIL+1
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:242  
         2 004305   000073 235000 3                  LDA     59
         2 004306   200130 757100                    STAQ    DA+1,,AUTO
         2 004307   200130 630500                    EPPR0   DA+1,,AUTO
         2 004310   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004311   000000 701000 xent               TSX1    SSR$REG
         2 004312   000000 011000                    NOP     0

     1870    21823    2   GMB:  CALL KQM$GETMBLK (KQ$CG,CNNCT.MBLK$,I) ALTRET(ALTRT);

  21823  2 004313   200021 630500       GMB          EPPR0   I,,AUTO
         2 004314   200132 450500                    STP0    DA+3,,AUTO
         2 004315   200035 631500                    EPPR1   CNNCT+1,,AUTO
         2 004316   200131 451500                    STP1    DA+2,,AUTO
         2 004317   200013 236100                    LDQ     CTX$,,AUTO
         2 004320   200130 756100                    STQ     DA+1,,AUTO
         2 004321   200130 630500                    EPPR0   DA+1,,AUTO
         2 004322   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004323   000000 701000 xent               TSX1    KQM$GETMBLK
         2 004324   004403 702000 2                  TSX2    ALTRT

     1871    21824    2         CNNCT.MBLK$->KQ$MBLK.PUTSTATE=KQPS_GDN#;

  21824  2 004325   200035 470500                    LDP0    CNNCT+1,,AUTO
         2 004326   000010 236100                    LDQ     8,,PR0
         2 004327   000042 376000 3                  ANQ     34
         2 004330   000003 276007                    ORQ     3,DL
         2 004331   000010 756100                    STQ     8,,PR0

     1872    21825                             /* To keep from screeching in KQP$DSCGO if the LDCT     */
     1873    21826                             /* goes through disconnect before we use this MBLK      */
     1874    21827    3         IF ENTFLG>0 THEN DO;             /* Connecting terminal...             */

  21827  2 004332   200020 235100                    LDA     ENTFLG,,AUTO
         2 004333   004401 604400 2                  TMOZ    s:21837

     1875    21828    3           I=SIZ;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:243  
  21828  2 004334   200121 236100                    LDQ     SIZ,,AUTO
         2 004335   200021 756100                    STQ     I,,AUTO

     1876    21829    3           CALL KQD$GETR(KQ$CG,DBLK$,I) ALTRET(ALTRT);

  21829  2 004336   200021 630500                    EPPR0   I,,AUTO
         2 004337   200132 450500                    STP0    DA+3,,AUTO
         2 004340   200030 631500                    EPPR1   DBLK$,,AUTO
         2 004341   200131 451500                    STP1    DA+2,,AUTO
         2 004342   200013 236100                    LDQ     CTX$,,AUTO
         2 004343   200130 756100                    STQ     DA+1,,AUTO
         2 004344   200130 630500                    EPPR0   DA+1,,AUTO
         2 004345   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004346   000000 701000 xent               TSX1    KQD$GETR
         2 004347   004403 702000 2                  TSX2    ALTRT

     1877    21830    3           CNNCT.MBLK$->KQ$MBLK.DDA=I;

  21830  2 004350   200021 235100                    LDA     I,,AUTO
         2 004351   200035 470500                    LDP0    CNNCT+1,,AUTO
         2 004352   000006 755100                    STA     6,,PR0

     1878    21831    3           CNNCT.MBLK$->KQ$MBLK.MSGSIZE=SIZ;

  21831  2 004353   200035 470500                    LDP0    CNNCT+1,,AUTO
         2 004354   200121 235100                    LDA     SIZ,,AUTO
         2 004355   000016 755100                    STA     14,,PR0

     1879    21832    3           I=SIZ;

  21832  2 004356   200021 755100                    STA     I,,AUTO

     1880    21833    3           KQ$DBLK.STAMP=CNNCT.MBLK$->KQ$MBLK.STAMP;

  21833  2 004357   200035 470500                    LDP0    CNNCT+1,,AUTO
         2 004360   000001 720100                    LXL0    1,,PR0
         2 004361   200030 471500                    LDP1    DBLK$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:244  
         2 004362   100000 740100                    STX0    0,,PR1

     1881    21834    3           PINCRW(DBLK$,SIZEW(KQ$DBLK))->MOVEI=ADDR(B$CGAUCI)->MOVEI;

  21834  2 004363   200005 470500                    LDP0    @B$CGAUCI,,AUTO
         2 004364   200021 720100                    LXL0    I,,AUTO
         2 004365   200030 471500                    LDP1    DBLK$,,AUTO
         2 004366   040140 100540                    MLR     fill='040'O
         2 004367   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 004370   100006 000010                    ADSC9   6,,PR1                   cn=0,n=*X0

     1882    21835    3           CALL KQD$UNLOCK(KQ$CG,DBLK$);

  21835  2 004371   200030 631500                    EPPR1   DBLK$,,AUTO
         2 004372   200131 451500                    STP1    DA+2,,AUTO
         2 004373   200013 236100                    LDQ     CTX$,,AUTO
         2 004374   200130 756100                    STQ     DA+1,,AUTO
         2 004375   200130 630500                    EPPR0   DA+1,,AUTO
         2 004376   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004377   000000 701000 xent               TSX1    KQD$UNLOCK
         2 004400   000000 011000                    NOP     0

     1883    21836    3           END;

     1884    21837    2         RETURN;

  21837  2 004401   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
         2 004402   000001 702211                    TSX2  ! 1,X1

     1885    21838    2   ALTRT: CALL RELCNNCT;

  21838  2 004403   004407 701000 2     ALTRT        TSX1    RELCNNCT
         2 004404   000000 011000                    NOP     0

     1886    21839    2         ALTRETURN;

  21839  2 004405   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:245  
         2 004406   000000 702211                    TSX2  ! 0,X1

     1887    21840    2   END CNNCTINFO;
     1888    21841        /****************************************************************
     1889    21842        *****************************************************************/
     1890    21843        /*D* NAME:         RELCNNCT
     1891    21844             PURPOSE:      To release stuff allocated for connect info
     1892    21845        */
     1893    21846    1   RELCNNCT: PROC;

  21846  2 004407   200122 741300       RELCNNCT     STX1  ! @ITEM+1,,AUTO

     1894    21847        /**/
     1895    21848    2   DCL DA UBIN;
     1896    21849        /**/
     1897    21850    2         CALL RELDDA(CNNCT.DDA,ADDR(NK$LDCT.DEVNM)->UBINHALF);

  21850  2 004410   200016 236100                    LDQ     LDCT$,,AUTO
         2 004411   000002 036003                    ADLQ    2,DU
         2 004412   200126 756100                    STQ     @DDA+1,,AUTO
         2 004413   200034 630500                    EPPR0   CNNCT,,AUTO
         2 004414   200125 450500                    STP0    I+3,,AUTO
         2 004415   004447 701000 2                  TSX1    RELDDA
         2 004416   000000 011000                    NOP     0

     1898    21851    2         IF  CNNCT.MBLK$  ~= ADDR(NIL)

  21851  2 004417   200035 236100                    LDQ     CNNCT+1,,AUTO
         2 004420   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 004421   004445 600000 2                  TZE     s:21858
         2 004422   200035 235100                    LDA     CNNCT+1,,AUTO
         2 004423   004445 600000 2                  TZE     s:21858

     1899    21852    3         AND CNNCT.MBLK$R ~= 0 THEN DO;

     1900    21853    3           CALL RELDDA(CNNCT.MBLK$->KQ$MBLK.DDA,

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:246  
  21853  2 004424   000074 036000 3                  ADLQ    60
         2 004425   200126 756100                    STQ     @DDA+1,,AUTO
         2 004426   200035 236100                    LDQ     CNNCT+1,,AUTO
         2 004427   000006 036003                    ADLQ    6,DU
         2 004430   200125 756100                    STQ     I+3,,AUTO
         2 004431   004447 701000 2                  TSX1    RELDDA
         2 004432   000000 011000                    NOP     0

     1901    21854    3           CNNCT.MBLK$->KQ$MBLK.STAMP);
     1902    21855    3           CALL KQM$RELMBLK (KQ$CG,CNNCT.MBLK$);

  21855  2 004433   200035 630500                    EPPR0   CNNCT+1,,AUTO
         2 004434   200131 450500                    STP0    DA+2,,AUTO
         2 004435   200013 236100                    LDQ     CTX$,,AUTO
         2 004436   200130 756100                    STQ     DA+1,,AUTO
         2 004437   200130 630500                    EPPR0   DA+1,,AUTO
         2 004440   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004441   000000 701000 xent               TSX1    KQM$RELMBLK
         2 004442   000000 011000                    NOP     0

     1903    21856    3           CNNCT.MBLK$=ADDR(NIL);

  21856  2 004443   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 004444   200035 756100                    STQ     CNNCT+1,,AUTO

     1904    21857    3           END;

     1905    21858    2         RETURN;

  21858  2 004445   200122 221300                    LDX1  ! @ITEM+1,,AUTO
         2 004446   000001 702211                    TSX2  ! 1,X1

     1906    21859
     1907    21860    2   RELDDA: PROC(DDA,STAMP);

  21860  2 004447   200124 741300       RELDDA       STX1  ! I+2,,AUTO

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:247  
     1908    21861
     1909    21862    3   DCL DDA UBIN;
     1910    21863    3   DCL STAMP UBIN HALF HALIGNED;
     1911    21864    3   DCL DA UBIN;
     1912    21865    4         IF DDA~=0 THEN DO;

  21865  2 004450   200125 470500                    LDP0    @DDA,,AUTO
         2 004451   000000 235100                    LDA     0,,PR0
         2 004452   004514 600000 2                  TZE     s:21876

     1913    21866    4           I=STAMP;

  21866  2 004453   200126 471500                    LDP1    @STAMP,,AUTO
         2 004454   000100 101500                    MRL     fill='000'O
         2 004455   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         2 004456   200021 000004                    ADSC9   I,,AUTO                  cn=0,n=4

     1914    21867    4   TRY:    DA=DDA;

  21867  2 004457   200125 470500       TRY          LDP0    @DDA,,AUTO
         2 004460   000000 235100                    LDA     0,,PR0
         2 004461   200127 755100                    STA     DA,,AUTO

     1915    21868    5           CALL KQD$DELDDA(KQ$CG,I,DA) WHENALTRETURN DO;

  21868  2 004462   200127 631500                    EPPR1   DA,,AUTO
         2 004463   200132 451500                    STP1    DA+3,,AUTO
         2 004464   200021 633500                    EPPR3   I,,AUTO
         2 004465   200131 453500                    STP3    DA+2,,AUTO
         2 004466   200013 236100                    LDQ     CTX$,,AUTO
         2 004467   200130 756100                    STQ     DA+1,,AUTO
         2 004470   200130 630500                    EPPR0   DA+1,,AUTO
         2 004471   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004472   000000 701000 xent               TSX1    KQD$DELDDA
         2 004473   004475 702000 2                  TSX2    s:21869
         2 004474   004512 710000 2                  TRA     s:21874

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:248  
     1916    21869    6             IF DA=%KQDE_NDFRBLK THEN DO;

  21869  2 004475   200127 235100                    LDA     DA,,AUTO
         2 004476   000012 115007                    CMPA    10,DL
         2 004477   004512 601000 2                  TNZ     s:21874

     1917    21870    6               CALL SSR$REG(%SS_SL,,1);

  21870  2 004500   000003 236000 3                  LDQ     3
         2 004501   200132 756100                    STQ     DA+3,,AUTO
         2 004502   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 004503   000073 235000 3                  LDA     59
         2 004504   200130 757100                    STAQ    DA+1,,AUTO
         2 004505   200130 630500                    EPPR0   DA+1,,AUTO
         2 004506   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004507   000000 701000 xent               TSX1    SSR$REG
         2 004510   000000 011000                    NOP     0

     1918    21871    6               GOTO TRY;

  21871  2 004511   004457 710000 2                  TRA     TRY

     1919    21872    6               END;
     1920    21873    5             END;
     1921    21874    4           DDA=0;

  21874  2 004512   200125 470500                    LDP0    @DDA,,AUTO
         2 004513   000000 450100                    STZ     0,,PR0

     1922    21875    4           END;

     1923    21876    3         RETURN;

  21876  2 004514   200124 221300                    LDX1  ! I+2,,AUTO
         2 004515   000001 702211                    TSX2  ! 1,X1

     1924    21877    3   END RELDDA;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:249  
     1925    21878    2   END RELCNNCT;
     1926    21879        /****************************************************************
     1927    21880        *****************************************************************/
     1928    21881        /*D* NAME:         GTRM
     1929    21882             PURPOSE:      To get a station block for a terminal
     1930    21883             DESCRIPTION:  Called when the initial attempt to get
     1931    21884                           a station block fails.  The station
     1932    21885                           tree has been unlocked.
     1933    21886
     1934    21887                           The idea here would be to queue ourselves
     1935    21888                           for the garbage collector (which is what
     1936    21889                           KQT$GETSTA does), except that we have no
     1937    21890                           station block on behalf of which to do that.
     1938    21891                           Hence we call KQM$GETBK which will kick the
     1939    21892                           garbage collector, and then wait 1 second
     1940    21893                           and try again.  If we get a block, then
     1941    21894                           we release it and go back to try again
     1942    21895                           because of course we must look again in
     1943    21896                           the tree.  If we can't get a block, we
     1944    21897                           ALTRET.
     1945    21898        */
     1946    21899    1   GTRM: PROC ALTRET;

  21899  2 004516   200120 741300       GTRM         STX1  ! SCRATCH$+2,,AUTO

     1947    21900        /**/
     1948    21901    2         I=SIZEW(KQ$QTN);

  21901  2 004517   000066 235007                    LDA     54,DL
         2 004520   200021 755100                    STA     I,,AUTO

     1949    21902    2         CALL KQM$GETBK (KQ$CG,SCRATCH$,I) ALTRET(GT1);

  21902  2 004521   200021 630500                    EPPR0   I,,AUTO
         2 004522   200132 450500                    STP0    DA+3,,AUTO
         2 004523   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 004524   200131 451500                    STP1    DA+2,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:250  
         2 004525   200013 236100                    LDQ     CTX$,,AUTO
         2 004526   200130 756100                    STQ     DA+1,,AUTO
         2 004527   200130 630500                    EPPR0   DA+1,,AUTO
         2 004530   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004531   000000 701000 xent               TSX1    KQM$GETBK
         2 004532   004534 702000 2                  TSX2    GT1

     1950    21903    2         GOTO GT2;

  21903  2 004533   004561 710000 2                  TRA     GT2

     1951    21904    2   GT1:  CALL SSR$REG (%SS_SL,,1);

  21904  2 004534   000003 236000 3     GT1          LDQ     3
         2 004535   200132 756100                    STQ     DA+3,,AUTO
         2 004536   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 004537   000073 235000 3                  LDA     59
         2 004540   200130 757100                    STAQ    DA+1,,AUTO
         2 004541   200130 630500                    EPPR0   DA+1,,AUTO
         2 004542   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004543   000000 701000 xent               TSX1    SSR$REG
         2 004544   000000 011000                    NOP     0

     1952    21905    2         I=SIZEW(KQ$QTN);

  21905  2 004545   000066 235007                    LDA     54,DL
         2 004546   200021 755100                    STA     I,,AUTO

     1953    21906    2         CALL KQM$GETB (KQ$CG,SCRATCH$,I) ALTRET(ALTRT);

  21906  2 004547   200021 630500                    EPPR0   I,,AUTO
         2 004550   200132 450500                    STP0    DA+3,,AUTO
         2 004551   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 004552   200131 451500                    STP1    DA+2,,AUTO
         2 004553   200013 236100                    LDQ     CTX$,,AUTO
         2 004554   200130 756100                    STQ     DA+1,,AUTO
         2 004555   200130 630500                    EPPR0   DA+1,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:251  
         2 004556   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004557   000000 701000 xent               TSX1    KQM$GETB
         2 004560   004601 702000 2                  TSX2    ALTRT

     1954    21907    2   GT2:  I=SIZEW(KQ$QTN);

  21907  2 004561   000066 235007       GT2          LDA     54,DL
         2 004562   200021 755100                    STA     I,,AUTO

     1955    21908    2         CALL KQM$RELB (KQ$CG,SCRATCH$,I);

  21908  2 004563   200021 630500                    EPPR0   I,,AUTO
         2 004564   200132 450500                    STP0    DA+3,,AUTO
         2 004565   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 004566   200131 451500                    STP1    DA+2,,AUTO
         2 004567   200013 236100                    LDQ     CTX$,,AUTO
         2 004570   200130 756100                    STQ     DA+1,,AUTO
         2 004571   200130 630500                    EPPR0   DA+1,,AUTO
         2 004572   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004573   000000 701000 xent               TSX1    KQM$RELB
         2 004574   000000 011000                    NOP     0

     1956    21909    2         STA$=ADDR(NIL);

  21909  2 004575   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 004576   200017 756100                    STQ     STA$,,AUTO

     1957    21910    2         RETURN;

  21910  2 004577   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
         2 004600   000001 702211                    TSX2  ! 1,X1

     1958    21911    2   ALTRT: STA$=ADDR(NIL);

  21911  2 004601   000001 236000 xsym  ALTRT        LDQ     B_VECTNIL+1
         2 004602   200017 756100                    STQ     STA$,,AUTO

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:252  
     1959    21912    2         ALTRETURN;

  21912  2 004603   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
         2 004604   000000 702211                    TSX2  ! 0,X1

     1960    21913    2   END GTRM;
     1961    21914        /****************************************************************
     1962    21915        *****************************************************************/
     1963    21916        /*D* NAME:         VALIDATE
     1964    21917             PURPOSE:      To perform character-set checks
     1965    21918             DESCRIPTION:  If the passed item is non-blank, its first
     1966    21919                           char must be in the KC legal set, else
     1967    21920                           ALTRET. */
     1968    21921    1   VALIDATE: PROC(ITEM) ALTRET;

  21921  2 004605   200120 741300       VALIDATE     STX1  ! SCRATCH$+2,,AUTO

     1969    21922        /**/
     1970    21923    2   DCL ITEM CHAR(8);
     1971    21924    2   DCL I UBIN;
     1972    21925        /**/
     1973    21926    2         IF ITEM~=' ' THEN

  21926  2 004606   200121 470500                    LDP0    @ITEM,,AUTO
         2 004607   040000 106500                    CMPC    fill='040'O
         2 004610   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         2 004611   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 004612   004620 600000 2                  TZE     s:21928

     1974    21927    2          CALL INDEX(I,SUBSTR(ITEM,0,1),KC_LGL1ST) ALTRET(ERR);

  21927  2 004613   000100 124400                    SCM     mask='000'O
         2 004614   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         2 004615   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         2 004616   200122 000100                    ARG     I,,AUTO
         2 004617   004621 606400 2                  TTN     ERR

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:253  
     1975    21928    2         RETURN;

  21928  2 004620   000001 702211                    TSX2  ! 1,X1

     1976    21929    2   ERR:  ALTRETURN;

  21929  2 004621   200120 221300       ERR          LDX1  ! SCRATCH$+2,,AUTO
         2 004622   000000 702211                    TSX2  ! 0,X1

     1977    21930    2   END VALIDATE;
     1978    21931        /****************************************************************
     1979    21932        *****************************************************************/
     1980    21933        /*D* NAME:         SLOCK, SUNLOCK, STALOCK, STAUNLOCK, GLOCK, GUNLOCK
     1981    21934             PURPOSE:      To lock/unlock various gates. */
     1982    21935    1   SLOCK: PROC;

  21935  2 004623   200122 741300       SLOCK        STX1  ! I,,AUTO

     1983    21936        /**/
     1984    21937        %LOCK (G=KQ$CG.STREE.GATE);

  21938  2 004624   200013 236100                    LDQ     CTX$,,AUTO
         2 004625   000075 036003                    ADLQ    61,DU
         2 004626   200130 756100                    STQ     DA+1,,AUTO
         2 004627   200130 630500                    EPPR0   DA+1,,AUTO
         2 004630   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004631   000000 701000 xent               TSX1    HFC$LOCK
         2 004632   000000 011000                    NOP     0

     1985    21940    2         RETURN;

  21940  2 004633   200122 221300                    LDX1  ! I,,AUTO
         2 004634   000001 702211                    TSX2  ! 1,X1

     1986    21941    2   SUNLOCK: ENTRY;

  21941  2 004635   200122 741300       SUNLOCK      STX1  ! I,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:254  

     1987    21942        /**/
     1988    21943              %UNLOCK (G=KQ$CG.STREE.GATE);

  21944  2 004636   200013 236100                    LDQ     CTX$,,AUTO
         2 004637   000075 036003                    ADLQ    61,DU
         2 004640   200130 756100                    STQ     DA+1,,AUTO
         2 004641   200130 630500                    EPPR0   DA+1,,AUTO
         2 004642   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004643   000000 701000 xent               TSX1    HFC$UNLOCK
         2 004644   000000 011000                    NOP     0

     1989    21946    2         RETURN;

  21946  2 004645   200122 221300                    LDX1  ! I,,AUTO
         2 004646   000001 702211                    TSX2  ! 1,X1

     1990    21947    2   STALOCK: ENTRY;

  21947  2 004647   200122 741300       STALOCK      STX1  ! I,,AUTO

     1991    21948        /**/
     1992    21949              %LOCK (G=KQ$STA.GATE);

  21950  2 004650   200017 236100                    LDQ     STA$,,AUTO
         2 004651   000016 036003                    ADLQ    14,DU
         2 004652   200130 756100                    STQ     DA+1,,AUTO
         2 004653   200130 630500                    EPPR0   DA+1,,AUTO
         2 004654   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004655   000000 701000 xent               TSX1    HFC$LOCK
         2 004656   000000 011000                    NOP     0

     1993    21952    2         RETURN;

  21952  2 004657   200122 221300                    LDX1  ! I,,AUTO
         2 004660   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:255  
     1994    21953    2   STAUNLOCK: ENTRY;

  21953  2 004661   200122 741300       STAUNLOCK    STX1  ! I,,AUTO

     1995    21954        /**/
     1996    21955              %UNLOCK (G=KQ$STA.GATE);

  21956  2 004662   200017 236100                    LDQ     STA$,,AUTO
         2 004663   000016 036003                    ADLQ    14,DU
         2 004664   200130 756100                    STQ     DA+1,,AUTO
         2 004665   200130 630500                    EPPR0   DA+1,,AUTO
         2 004666   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004667   000000 701000 xent               TSX1    HFC$UNLOCK
         2 004670   000000 011000                    NOP     0

     1997    21958    2         RETURN;

  21958  2 004671   200122 221300                    LDX1  ! I,,AUTO
         2 004672   000001 702211                    TSX2  ! 1,X1

     1998    21959    2   GLOCK: ENTRY;

  21959  2 004673   200122 741300       GLOCK        STX1  ! I,,AUTO

     1999    21960        /**/
     2000    21961              %LOCK (G=KQ$CG.GATE.CG);

  21962  2 004674   200013 236100                    LDQ     CTX$,,AUTO
         2 004675   000107 036003                    ADLQ    71,DU
         2 004676   200130 756100                    STQ     DA+1,,AUTO
         2 004677   200130 630500                    EPPR0   DA+1,,AUTO
         2 004700   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004701   000000 701000 xent               TSX1    HFC$LOCK
         2 004702   000000 011000                    NOP     0

     2001    21964    2         RETURN;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:256  
  21964  2 004703   200122 221300                    LDX1  ! I,,AUTO
         2 004704   000001 702211                    TSX2  ! 1,X1

     2002    21965    2   GUNLOCK: ENTRY;

  21965  2 004705   200122 741300       GUNLOCK      STX1  ! I,,AUTO

     2003    21966        /**/
     2004    21967              %UNLOCK (G=KQ$CG.GATE.CG);

  21968  2 004706   200013 236100                    LDQ     CTX$,,AUTO
         2 004707   000107 036003                    ADLQ    71,DU
         2 004710   200130 756100                    STQ     DA+1,,AUTO
         2 004711   200130 630500                    EPPR0   DA+1,,AUTO
         2 004712   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004713   000000 701000 xent               TSX1    HFC$UNLOCK
         2 004714   000000 011000                    NOP     0

     2005    21970    2         RETURN;

  21970  2 004715   200122 221300                    LDX1  ! I,,AUTO
         2 004716   000001 702211                    TSX2  ! 1,X1

     2006    21971    2   END SLOCK;
     2007    21972        /****************************************************************
     2008    21973        *****************************************************************/
     2009    21974        /*D* NAME:         FINDCG
     2010    21975             PURPOSE:      To find the desired comgroup for TRMCON
     2011    21976             DESCRIPTION:  Searches the comgroup chain for one
     2012    21977                           which matches the given KC$CGID.  If
     2013    21978                           found, returns CTX$ pointing to the
     2014    21979                           comgroup context block, with the comgroup
     2015    21980                           list gate locked.  Else ALTRETs with
     2016    21981                           the gate unlocked.
     2017    21982        */
     2018    21983    1   FINDCG: PROC ALTRET;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:257  
  21983  2 004717   200120 741300       FINDCG       STX1  ! SCRATCH$+2,,AUTO

     2019    21984        /**/
     2020    21985              %LOCK (G=KQ_CGLGATE);

  21986  2 004720   000062 630400 3                  EPPR0   50
         2 004721   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004722   000000 701000 xent               TSX1    HFC$LOCK
         2 004723   000000 011000                    NOP     0

     2021    21988    2         CTX$=KQ$MMSD.CGHEAD$;

  21988  2 004724   000000 470400 xsym               LDP0    KQ_MMSD$
         2 004725   000001 236100                    LDQ     1,,PR0
         2 004726   200013 756100                    STQ     CTX$,,AUTO

     2022    21989    3           DO WHILE(CTX$~=ADDR(NIL));

  21989  2 004727   005045 710000 2                  TRA     s:22012

     2023    21990    3           CFU$=KQ$CG.CFU$;

  21990  2 004730   200013 470500                    LDP0    CTX$,,AUTO
         2 004731   000214 236100                    LDQ     140,,PR0
         2 004732   200012 756100                    STQ     CFU$,,AUTO

     2024    21991    3           IF  FM$CFUF.ACCNAM ~= 0

  21991  2 004733   200012 471500                    LDP1    CFU$,,AUTO
         2 004734   100002 235100                    LDA     2,,PR1
         2 004735   005042 600000 2                  TZE     NXTCG
         2 004736   100002 236100                    LDQ     2,,PR1
         2 004737   400000 316003                    CANQ    -131072,DU
         2 004740   005042 601000 2                  TNZ     NXTCG

     2025    21992    3           AND FM$CFU.STARX.F = 0 THEN
     2026    21993    4             DO;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:258  

     2027    21994    4             CTL$=CFU$;

  21994  2 004741   200012 236100                    LDQ     CFU$,,AUTO
         2 004742   200031 756100                    STQ     CTL$,,AUTO

     2028    21995    5               DO WHILE(CTL$->FM$CFU.NAMEX<FM$CFUX.CFUT);

  21995  2 004743   200031 473500                    LDP3    CTL$,,AUTO
         2 004744   300002 720100                    LXL0    2,,PR3
         2 004745   000000 474400 xsym               LDP4    F$CFU$
         2 004746   400002 100100                    CMPX0   2,,PR4
         2 004747   004762 603000 2                  TRC     s:21998

     2029    21996    5               CTL$=PINCRW(F$CFU$,CTL$->FM$CFU.NAMEX);

  21996  2 004750   200031 470500                    LDP0    CTL$,,AUTO
         2 004751   000002 720100                    LXL0    2,,PR0
         2 004752   000000 636010                    EAQ     0,X0
         2 004753   000000 036000 xsym               ADLQ    F$CFU$
         2 004754   200031 756100                    STQ     CTL$,,AUTO

     2030    21997    5               END;

  21997  2 004755   200031 470500                    LDP0    CTL$,,AUTO
         2 004756   000002 720100                    LXL0    2,,PR0
         2 004757   000000 471400 xsym               LDP1    F$CFU$
         2 004760   100002 100100                    CMPX0   2,,PR1
         2 004761   004750 602000 2                  TNC     s:21996

     2031    21998    4             NAME$=PINCRC(F$CFU$,CTL$->FM$CFU.NAMEX);

  21998  2 004762   200031 470500                    LDP0    CTL$,,AUTO
         2 004763   000002 236100                    LDQ     2,,PR0
         2 004764   777777 376007                    ANQ     -1,DL
         2 004765   000020 736000                    QLS     16
         2 004766   000000 036000 xsym               ADLQ    F$CFU$
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:259  
         2 004767   200024 756100                    STQ     NAME$,,AUTO

     2032    21999    4             ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);

  21999  2 004770   200012 471500                    LDP1    CFU$,,AUTO
         2 004771   100002 220100                    LDX0    2,,PR1
         2 004772   000000 636010                    EAQ     0,X0
         2 004773   000000 036000 xsym               ADLQ    F$CFU$
         2 004774   200025 756100                    STQ     ACCT$,,AUTO

     2033    22000    4             I=FM$CFUN.L+1;

  22000  2 004775   200024 473500                    LDP3    NAME$,,AUTO
         2 004776   000100 101500                    MRL     fill='000'O
         2 004777   300000 400001                    ADSC9   0,,PR3                   cn=2,n=1
         2 005000   200130 000004                    ADSC9   DA+1,,AUTO               cn=0,n=4
         2 005001   200130 236100                    LDQ     DA+1,,AUTO
         2 005002   000001 036007                    ADLQ    1,DL
         2 005003   200021 756100                    STQ     I,,AUTO

     2034    22001    4             IF ADDR(KC$CGID.NAME#)->NAMEI~=ADDR(FM$CFUN.L)->NAMEI THEN

  22001  2 005004   200004 474500                    LDP4    @KC$CGID,,AUTO
         2 005005   000000 620006                    EAX0    0,QL
         2 005006   200021 721100                    LXL1    I,,AUTO
         2 005007   040140 106540                    CMPC    fill='040'O
         2 005010   400004 000010                    ADSC9   4,,PR4                   cn=0,n=*X0
         2 005011   300000 400011                    ADSC9   0,,PR3                   cn=2,n=*X1
         2 005012   005042 601000 2                  TNZ     NXTCG

     2035    22002    4              GOTO NXTCG;
     2036    22003    4             IF KC$CGID.ACCT#~=FM$CFUA.ACCT THEN

  22003  2 005013   200025 475500                    LDP5    ACCT$,,AUTO
         2 005014   040100 106500                    CMPC    fill='040'O
         2 005015   400000 000010                    ADSC9   0,,PR4                   cn=0,n=8
         2 005016   500001 000010                    ADSC9   1,,PR5                   cn=0,n=8
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:260  
         2 005017   005042 601000 2                  TNZ     NXTCG

     2037    22004    4              GOTO NXTCG;
     2038    22005    4             IF KC$CGID.PSN#~=FM$SET.PSN(FM$CFUA.SETX) THEN

  22005  2 005020   500000 236100                    LDQ     0,,PR5
         2 005021   000017 772000                    QRL     15
         2 005022   000012 376000 3                  ANQ     10
         2 005023   000002 736000                    QLS     2
         2 005024   000000 476400 xsym               LDP6    F$CFU$
         2 005025   040106 106500                    CMPC    fill='040'O
         2 005026   400002 000006                    ADSC9   2,,PR4                   cn=0,n=6
         2 005027   600000 400006                    ADSC9   0,Q,PR6                  cn=2,n=6
         2 005030   005040 600000 2                  TZE     s:22008

     2039    22006    4              IF KC$CGID.PSN#~=' ' OR FM$CFUA.PRIV THEN

  22006  2 005031   040000 106500                    CMPC    fill='040'O
         2 005032   400002 000006                    ADSC9   2,,PR4                   cn=0,n=6
         2 005033   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 005034   005042 601000 2                  TNZ     NXTCG
         2 005035   500005 236100                    LDQ     5,,PR5
         2 005036   040000 316003                    CANQ    16384,DU
         2 005037   005042 601000 2                  TNZ     NXTCG

     2040    22007    4               GOTO NXTCG;
     2041    22008    4             RETURN;

  22008  2 005040   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
         2 005041   000001 702211                    TSX2  ! 1,X1

  22005  2 005042                       NXTCG        null
     2042    22009    4   NXTCG:    ;
     2043    22010    4             END;

     2044    22011    3           CTX$=KQ$CG.LNK$;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:261  
  22011  2 005042   200013 470500                    LDP0    CTX$,,AUTO
         2 005043   000104 236100                    LDQ     68,,PR0
         2 005044   200013 756100                    STQ     CTX$,,AUTO

     2045    22012    3           END;

  22012  2 005045   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 005046   004730 601000 2                  TNZ     s:21990

     2046    22013        /**/
     2047    22014              %UNLOCK (G=KQ_CGLGATE);

  22015  2 005047   000062 630400 3                  EPPR0   50
         2 005050   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005051   000000 701000 xent               TSX1    HFC$UNLOCK
         2 005052   000000 011000                    NOP     0

     2048    22017    2         ALTRETURN;

  22017  2 005053   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
         2 005054   000000 702211                    TSX2  ! 0,X1

     2049    22018    2   END FINDCG;
     2050    22019        /****************************************************************
     2051    22020        *****************************************************************/
     2052    22021        /*D* NAME:         GETGORGO
     2053    22022             PURPOSE:      To allocate the *GORGO station
     2054    22023             DESCRIPTION:  If one is not present already, allocates it and
     2055    22024                           ALTRETs if insufficient memory.  Else, or if
     2056    22025                           already there, sets it up.
     2057    22026        */
     2058    22027    1   GETGORGO: PROC ALTRET;

  22027  2 005055   200120 741300       GETGORGO     STX1  ! SCRATCH$+2,,AUTO

     2059    22028        /**/
     2060    22029    2         KEY='*GORGO';
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:262  

  22029  2 005056   040100 100400                    MLR     fill='040'O
         2 005057   000107 000006 1                  ADSC9   ERRCGORAU+8              cn=0,n=6
         2 005060   200022 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

     2061    22030    2         CALL SLOCK;

  22030  2 005061   004623 701000 2                  TSX1    SLOCK
         2 005062   000000 011000                    NOP     0

     2062    22031    2         CALL KQB$SRCH(KQ$CG.STREE,KEY,SCRATCH$) ALTRET(NOGORGOSTA);

  22031  2 005063   200116 630500                    EPPR0   SCRATCH$,,AUTO
         2 005064   200132 450500                    STP0    DA+3,,AUTO
         2 005065   200022 631500                    EPPR1   KEY,,AUTO
         2 005066   200131 451500                    STP1    DA+2,,AUTO
         2 005067   200013 236100                    LDQ     CTX$,,AUTO
         2 005070   000075 036003                    ADLQ    61,DU
         2 005071   200130 756100                    STQ     DA+1,,AUTO
         2 005072   200130 630500                    EPPR0   DA+1,,AUTO
         2 005073   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 005074   000000 701000 xent               TSX1    KQB$SRCH
         2 005075   005077 702000 2                  TSX2    NOGORGOSTA

     2063    22032    2         GOTO GOTGORGOSTA;

  22032  2 005076   005111 710000 2                  TRA     GOTGORGOSTA

  22029  2 005077                       NOGORGOSTA   null
     2064    22033    2   NOGORGOSTA: ;
     2065    22034    2         CALL KQT$MAKESTA (KQ$CG,SCRATCH$,KEY) ALTRET(ALTRT);

  22034  2 005077   200022 630500                    EPPR0   KEY,,AUTO
         2 005100   200132 450500                    STP0    DA+3,,AUTO
         2 005101   200116 631500                    EPPR1   SCRATCH$,,AUTO
         2 005102   200131 451500                    STP1    DA+2,,AUTO
         2 005103   200013 236100                    LDQ     CTX$,,AUTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:263  
         2 005104   200130 756100                    STQ     DA+1,,AUTO
         2 005105   200130 630500                    EPPR0   DA+1,,AUTO
         2 005106   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 005107   000000 701000 xent               TSX1    KQT$MAKESTA
         2 005110   005131 702000 2                  TSX2    ALTRT

  22029  2 005111                       GOTGORGOSTA  null
     2066    22035    2   GOTGORGOSTA: ;
     2067    22036    2         STA$=SCRATCH$;

  22036  2 005111   200116 236100                    LDQ     SCRATCH$,,AUTO
         2 005112   200017 756100                    STQ     STA$,,AUTO

     2068    22037    2         CALL SUNLOCK;

  22037  2 005113   004635 701000 2                  TSX1    SUNLOCK
         2 005114   000000 011000                    NOP     0

     2069    22038    2         KQ$CG.GORGOSTA$=STA$;

  22038  2 005115   200017 236100                    LDQ     STA$,,AUTO
         2 005116   200013 470500                    LDP0    CTX$,,AUTO
         2 005117   000207 756100                    STQ     135,,PR0

     2070    22039    2         CALL STALOCK;

  22039  2 005120   004647 701000 2                  TSX1    STALOCK
         2 005121   000000 011000                    NOP     0

     2071    22040    2         KQ$STA.SPECIAL='1'B;

  22040  2 005122   200017 470500                    LDP0    STA$,,AUTO
         2 005123   200000 236007                    LDQ     65536,DL
         2 005124   000023 256100                    ORSQ    19,,PR0

     2072    22041    2         CALL STAUNLOCK;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:264  
  22041  2 005125   004661 701000 2                  TSX1    STAUNLOCK
         2 005126   000000 011000                    NOP     0

     2073    22042    2         RETURN;

  22042  2 005127   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
         2 005130   000001 702211                    TSX2  ! 1,X1

  22040  2 005131                       ALTRT        null
     2074    22043    2   ALTRT:;
     2075    22044    2         ALTRETURN;

  22044  2 005131   200120 221300                    LDX1  ! SCRATCH$+2,,AUTO
         2 005132   000000 702211                    TSX2  ! 0,X1

     2076    22045    2   END GETGORGO;
     2077    22046        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:265  
     2078    22047
     2079    22048
     2080    22049        /*F* NAME:         KCO$TRMGO
     2081    22050
     2082    22051             PURPOSE:      Do connection completion for terminals
     2083    22052
     2084    22053             LOCATION:     Contained in KCO$CLCG because this routine is called
     2085    22054                           at interrupt and KCO$OPCG resides in an overlay.
     2086    22055        */
     2087    22056
     2088    22057        %EJECT;
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:266  
     2089    22058
     2090    22059
     2091    22060        /*F* NAME:         KCO$EXTEND
     2092    22061
     2093    22062             PURPOSE:      Increase the number of granules allocated to
     2094    22063                           a comgroup.
     2095    22064
     2096    22065        */
     2097    22066
     2098    22067
     2099    22068        /*D* NAME:         KCO$EXTEND
     2100    22069
     2101    22070             CALL:         CALL KCO$EXTEND
     2102    22071
     2103    22072             INPUT:        F$DCB.XTNSIZE - # grans to extend by
     2104    22073
     2105    22074             DESCRIPTION:  The comgroup is extended by the amount requested.
     2106    22075
     2107    22076        */
     2108    22077
     2109    22078
     2110    22079    1   KCO$EXTEND: ENTRY ALTRET;

  22079  2 005133   000000 700200 xent  KCO$EXTEND   TSX0  ! X66_AUTO_4
         2 005134   000140 000004                    ZERO    96,4

     2111    22080
     2112    22081    1         JDCB$=B$JIT.DCB$;

  22081  2 005135   000000 470400 xsym               LDP0    B$JIT$
         2 005136   000232 236100                    LDQ     154,,PR0
         2 005137   200007 756100                    STQ     JDCB$,,AUTO

     2113    22082    1         CFU$=F$DCB.CFU$;

  22082  2 005140   200007 471500                    LDP1    JDCB$,,AUTO
         2 005141   100066 236100                    LDQ     54,,PR1
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:267  
         2 005142   200012 756100                    STQ     CFU$,,AUTO

     2114    22083    1         CTX.DISP=FM$CFU.LDA;

  22083  2 005143   200012 473500                    LDP3    CFU$,,AUTO
         2 005144   300006 235100                    LDA     6,,PR3
         2 005145   300007 236100                    LDQ     7,,PR3
         2 005146   000033 773000                    LRL     27
         2 005147   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 005150   000014 736000                    QLS     12
         2 005151   200013 752174                    STCQ    CTX$,'74'O,AUTO

     2115    22084    1         CTX.SID=FM$CFU.GDA;

  22084  2 005152   300005 236100                    LDQ     5,,PR3
         2 005153   200013 752103                    STCQ    CTX$,'03'O,AUTO

     2116    22085    1         CALL KQX$LDASR(KQ$CG);

  22085  2 005154   200013 630500                    EPPR0   CTX$,,AUTO
         2 005155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005156   000000 701000 xent               TSX1    KQX$LDASR
         2 005157   000000 011000                    NOP     0

     2117    22086    1         CALL FAG$GEXT ALTRET(ALTRT);

  22086  2 005160   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005161   000000 701000 xent               TSX1    FAG$GEXT
         2 005162   005214 702000 2                  TSX2    ALTRT

     2118    22087              %LOCK (G=KQ$CG.DTREE.GATE);

  22088  2 005163   200013 236100                    LDQ     CTX$,,AUTO
         2 005164   000231 036003                    ADLQ    153,DU
         2 005165   200130 756100                    STQ     DA+1,,AUTO
         2 005166   200130 630500                    EPPR0   DA+1,,AUTO
         2 005167   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:268  
         2 005170   000000 701000 xent               TSX1    HFC$LOCK
         2 005171   000000 011000                    NOP     0

     2119    22090    1         KQ$CG.NGAVAL=KQ$CG.NGAVAL+F$DCB.XTNSIZE;

  22090  2 005172   200013 470500                    LDP0    CTX$,,AUTO
         2 005173   200007 471500                    LDP1    JDCB$,,AUTO
         2 005174   100037 236100                    LDQ     31,,PR1
         2 005175   000022 772000                    QRL     18
         2 005176   000217 036100                    ADLQ    143,,PR0
         2 005177   000217 756100                    STQ     143,,PR0

     2120    22091           /* If this EXTEND was prompted by a Diskwarn turn TRIGGERED off */
     2121    22092    1         IF (NOT KQ$CG.DELAY.DISKWARN)

  22092  2 005200   000020 430100                    FSZN    16,,PR0
         2 005201   005204 604000 2                  TMI     s:22095

     2122    22093    1         THEN KQ$CG.TRIGGERED = '0'B;

  22093  2 005202   000033 236000 3                  LDQ     27
         2 005203   000216 356100                    ANSQ    142,,PR0

     2123    22094              %UNLOCK (G=KQ$CG.DTREE.GATE);

  22095  2 005204   200013 236100                    LDQ     CTX$,,AUTO
         2 005205   000231 036003                    ADLQ    153,DU
         2 005206   200130 756100                    STQ     DA+1,,AUTO
         2 005207   200130 630500                    EPPR0   DA+1,,AUTO
         2 005210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005211   000000 701000 xent               TSX1    HFC$UNLOCK
         2 005212   000000 011000                    NOP     0

     2124    22097    1         RETURN;

  22097  2 005213   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:269  
  22092  2 005214                       ALTRT        null
     2125    22098        /**/
     2126    22099    1   ALTRT: ;
     2127    22100    1         ALTRETURN;

  22100  2 005214   000000 702200 xent               TSX2  ! X66_AALT

B_CGAUCI
 Sect OctLoc
   1     000   000000 000000   000000 000000   000000 000000   040040 040040    ............
   1     004   040040 040040   040040 040040   040040 040040   040040 040040
   1     010   000000 000000                                                    ....

KQ_CTLGRAN
 Sect OctLoc
   1     012   000000 000000   000000 000000   000000 006014   000000 000000    ................
   1     016   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     022   000000 000000   105060 063107   000000 000000   000000 000000    ....E03G........
   1     026   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     032   000000 000000   0000** ******   000000 000000   000000 000000    ................
   1     036   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     042   000000 000000                                                    ....

KQ_THDR
 Sect OctLoc
   1     044   400000 000000   000000 000000   000000 006014   000000 000001    ................
   1     050   000000 006014   000000 000000                                    ........

ZEROS
 Sect OctLoc
   1     052   000000 000000   000000 000000                                    ........

ERRDMY
 Sect OctLoc
   1     054   130317 000002                                                    X...

ERRTWOAU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:270  
 Sect OctLoc
   1     055   130317 015412                                                    X...

ERRNOCGLDCT
 Sect OctLoc
   1     056   130317 015632                                                    X...

ERRDUPNM
 Sect OctLoc
   1     057   130317 015432                                                    X...

ERRFILECG
 Sect OctLoc
   1     060   130317 002012                                                    X...

ERRCGCXT
 Sect OctLoc
   1     061   130317 021602                                                    X...

(unnamed)
 Sect OctLoc
   1     062   130317 003072                                                    X..:

ERRSTABAD
 Sect OctLoc
   1     063   130317 015612                                                    X...

ERRSTAILLGL
 Sect OctLoc
   1     064   130317 015422                                                    X...

ERRNDCBCG
 Sect OctLoc
   1     065   130317 015542                                                    X...

ERRRCVRBAD
 Sect OctLoc
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:271  
   1     066   130317 015752                                                    X...

ERRCGCTLBAD
 Sect OctLoc
   1     067   130317 015452                                                    X...

ERRCGGRANS
 Sect OctLoc
   1     070   130317 015642                                                    X...

ERRCGNOCLS
 Sect OctLoc
   1     071   130317 015662                                                    X...

ERRCGCROP
 Sect OctLoc
   1     072   130317 022052                                                    X..*

ERRNCGAU
 Sect OctLoc
   1     073   130317 015532                                                    X...

ERRPRIVSTA
 Sect OctLoc
   1     074   130317 015702                                                    X...

ERRCGSTAR
 Sect OctLoc
   1     075   130317 015712                                                    X...

ERROLDCG
 Sect OctLoc
   1     076   130317 015732                                                    X...

ERRCGORAU
 Sect OctLoc
   1     077   130317 015742                                                    X...
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:272  

(unnamed)
 Sect OctLoc
   1     100   130317 015342   102060 061130   105060 063107   000000 004000    X...B01XE03G....
   1     104   046046 040040   112122 116114   123124 101040   052107 117122    &&  JRNLSTA *GOR
   1     110   107117 040040                                                    GO

(unnamed)
 Sect OctLoc
   3     000   000004 006000   000000 006000   000002 006000   000003 006000    ................
   3     004   777770 777777   777777 437777   777777 776000   743777 777777    ................
   3     010   707777 777777   000000 006000   000007 777770   000000 000044    ...............$
   3     014   000013 006000   000002 006000   000007 006000   777777 777757    ................
   3     020   777777 777773   777677 777777   777577 777777   777377 777777    ................
   3     024   767777 777777   775777 777777   777777 776777   777777 757777    ................
   3     030   777777 767777   777777 773777   777777 637777   777777 777377    ................
   3     034   000000 000035   000034 006000   777777 777767   777777 677777    ................
   3     040   000000 000024   000040 006000   777777 777760   000000 000037    ..... ..........
   3     044   000000 006000   000002 006000   000043 006000   737777 777777    .........#......
   3     050   000000 000040   000050 006000   000000 000022   000052 006000    ... .(.......*..
   3     054   777777 777577   000000 000033   000055 006000   000000 000000    .........-......
   3     060   000000 000000   000000 000000   000000 006000   000000 000042    ..............."
   3     064   000063 006000   000000 000043   000065 006000   773777 777777    .3.....#.5......
   3     070   777777 775777   577777 777777   000000 000031   000072 006000    .............:..
   3     074   000001 400000                                                    ....
     2128    22101        /**/
     2129    22102    1   END KCO$INIT;

PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:273  
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_ERRORS_C.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   HF_DATA_R.:E05TOU  is referenced.
   KQM_MAC_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   AZ_SUBS_C.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   AZ_MACRO_C.:E05TOU  is referenced.
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:274  
      No diagnostics issued in procedure KCO$INIT.
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:275  

 **** Variables and constants ****

  ****  Section 001 RoData KCO$INIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(324)   r     1 B_CGAUCI                  52-0-0/c CHAR(8)     r     1 CHARZEROS
    72-0-0/b STRC        r     1 ERRCGCROP                 67-0-0/b STRC        r     1 ERRCGCTLBAD
    61-0-0/b STRC        r     1 ERRCGCXT                  70-0-0/b STRC        r     1 ERRCGGRANS
    71-0-0/b STRC        r     1 ERRCGNOCLS                77-0-0/b STRC        r     1 ERRCGORAU
    75-0-0/b STRC        r     1 ERRCGSTAR                 54-0-0/b STRC        r     1 ERRDMY
    57-0-0/b STRC        r     1 ERRDUPNM                  60-0-0/b STRC        r     1 ERRFILECG
    73-0-0/b STRC        r     1 ERRNCGAU                  65-0-0/b STRC        r     1 ERRNDCBCG
    56-0-0/b STRC        r     1 ERRNOCGLDCT               76-0-0/b STRC        r     1 ERROLDCG
    74-0-0/b STRC        r     1 ERRPRIVSTA                66-0-0/b STRC        r     1 ERRRCVRBAD
    63-0-0/b STRC        r     1 ERRSTABAD                 64-0-0/b STRC        r     1 ERRSTAILLGL
    55-0-0/b STRC        r     1 ERRTWOAU                  12-0-0/d STRC(900)   r     1 KQ_CTLGRAN
    44-0-0/w STRC(216)   r     1 KQ_THDR                   52-0-0/b BIT (72)    r     1 ZEROS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @B$CGAUCI                125-0-0/w PTR         r     1 @DDA
     6-0-0/w PTR         r     1 @ERROR                   121-0-0/w PTR         r     1 @ITEM
     4-0-0/w PTR         r     1 @KC$CGID                   3-0-0/w PTR         r     1 @PLDCT$
   126-0-0/w PTR         r     1 @STAMP                    25-0-0/w PTR         r     1 ACCT$
    *0-0-0/w STRC(324)   r     1 B$CGAUCI                  41-0-0/w STRC(324)   r     1 B$CGAUCIDCB
    12-0-0/w PTR         r     1 CFU$                      34-0-0/w STRC(72)    r     1 CNNCT
    52-0-0/w STRC(1296)  r     1 COMGRP                    31-0-0/w PTR         r     1 CTL$
    13-0-0/w STRC        r     1 CTX                       13-0-0/w PTR         r     1 CTX$
   127-0-0/w UBIN        r     1 DA                        30-0-0/w PTR         r     1 DBLK$
    *0-0-0/w UBIN        r     1 DDA                       37-0-0/w UBIN        r     1 DESC#
    33-0-0/w STRC        r     1 DGRAN                     33-0-0/w PTR         r     1 DGRAN$
    20-0-0/w SBIN        r     1 ENTFLG                    *0-0-0/w UBIN        r     1 ERROR
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:276  
    21-0-0/w SBIN        r     1 I                        122-0-0/w UBIN        r     1 I
    27-0-0/w UBIN        r     1 INDX                      27-0-0/w PTR         r     1 INDXR$
    *0-0-0/c CHAR(8)     r     1 ITEM                       7-0-0/w PTR         r     1 JDCB$
    *0-0-0/w STRC(432)   r     1 KC$CGID                   22-0-0/c CHAR(8)     r     1 KEY
    16-0-0/w PTR         r     1 LDCT$                     24-0-0/w PTR         r     1 NAME$
    32-0-0/w UBIN        r     1 OPNTYP                    40-0-0/w UBIN        r     1 PG#
    *0-0-0/w PTR         r     1 PLDCT$                   116-0-0/w PTR         r     1 SCRATCH$
   121-0-0/w UBIN        r     1 SIZ                       17-0-0/w PTR         r     1 STA$
    *0-0-0/h UBIN(18)    r     1 STAMP                     14-0-0/c CHAR(6)     r     1 STR6
    10-0-0/d BIT (72)    r     1 TIMCHK                    26-0-0/w UBIN        r     1 TRMFLG
    36-0-0/w UBIN        r     1 TRYCNT                    26-0-0/w UBIN        r     1 WAFLG

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$UC$
     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$BUF$(0:0)
     0-0-0/w UBIN        r     1 FM_FRZERO                  0-0-0/c CHAR(68)    r     1 KC_LGL1ST
     0-0-0/w STRC(432)   r     1 KC_VLPSETSTA               0-0-0/w STRC(288)   r     1 KC_VLPSTATION
     0-0-0/w BIT (72)    r     1 KQ_CGLGATE                 0-0-0/d STRC(6516)  r     1 KQ_ICG
     0-0-0/d STRC(1152)  r     1 KQ_IDGRAN                  0-0-0/b STRC        r     1 KQ_LOG
     0-0-0/w PTR         r     1 KQ_MMSD$                   0-0-0/w UBIN        r     1 S_CUN
     0-0-0/w UBIN        r     1 S_PNO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/c CHAR(8)     r     1 CHAR8
     0-0-0/c ACHR        r     1 CHARINDX                   0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$CFUA
     0-0-0/w STRC(288)   r     1 FM$CFUF                    0-0-0/c ASTR(27)    r     1 FM$CFUN
     0-0-0/w STRC(288)   r     1 FM$CFUX                    0-0-0/w STRC(288)   r     1 FM$SET(0:0)
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:277  
     0-0-0/d STRC(432)   r     1 KQ$BAP                     0-0-0/d STRC(6516)  r     1 KQ$CG
     0-0-0/d STRC(900)   r     1 KQ$CTLGRAN                 0-0-0/d STRC(216)   r     1 KQ$DBLK
     0-0-0/d STRC(1152)  r     1 KQ$DGRAN                   0-0-0/d STRC(180)   r     1 KQ$FP
     0-0-0/w STRC(144)   r     1 KQ$GRAN                    0-0-0/d STRC(576)   r     1 KQ$MBLK
     0-0-0/d STRC(288)   r     1 KQ$MMSD                    0-0-0/d STRC(1908)  r     1 KQ$QTN
     0-0-0/d STRC(648)   r     1 KQ$RBLK                    0-0-0/d STRC(1296)  r     1 KQ$STA
     0-0-0/c ACHR        r     1 MOVEI                      0-0-0/c ACHR        r     1 NAMEI
     0-0-0/d STRC(864)   r     1 NK$LDCT                    0-0-0/w UBIN        r     1 PG(0:1023)
     0-0-0/w UBIN(18)    r     1 UBINHALF                   0-0-0/w STRC(432)   r     1 VLP$SETSTA
     0-0-0/w STRC(288)   r     1 VLP$STATION


   Procedure KCO$INIT requires 2701 words for executable code.
   Procedure KCO$INIT requires 96 words of local(AUTO) storage.

    No errors detected in file KCO$OPCG.:E05TSI    .
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:278  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:279  
          MINI XREF LISTING

ACCT$
     18921**DCL     18720--IMP-PTR 20870<<ASSIGN  20879>>ASSIGN  21999<<ASSIGN  22003>>IF      22005>>IF
     22006>>IF
ALTRT
     22092**LABEL   22086--CALLALT
ALTRT IN PROCEDURE CNNCTINFO
     21838**LABEL   21805--CALLALT 21823--CALLALT 21829--CALLALT
ALTRT IN PROCEDURE GETGORGO
     22040**LABEL   22034--CALLALT
ALTRT IN PROCEDURE GTRM
     21911**LABEL   21906--CALLALT
B$CGAUCI
     18891**DCL        19--PROC    21326--ENTRY   21330--ENTRY   21364--ENTRY   21396--ENTRY   21400--ASSIGN
     21432--ENTRY   21436--ASSIGN  21695--ASSIGN  21803--ASSIGN  21814--ASSIGN  21834--ASSIGN
B$CGAUCI.ATTR
     18898**DCL     18898--REDEF
B$CGAUCI.FLG.INPUT
     18897**DCL     21688>>ASSIGN  21812<<ASSIGN  21812>>ASSIGN
B$CGAUCI.FLG.OUTPUT
     18897**DCL     21689>>ASSIGN  21813<<ASSIGN  21813>>ASSIGN
B$CGAUCI.NWINFO
     18899**DCL     21695>>ASSIGN  21803>>ASSIGN
B$CGAUCIDCB
     18953**DCL     20444<<ASSIGN  21047--ASSIGN  21132--CALL    21664--ASSIGN  21676--CALL    21802--ASSIGN
     21810--ASSIGN
B$CGAUCIDCB.ATTR
     18960**DCL     18960--REDEF
B$CGAUCIDCB.FLG.INPUT
     18959**DCL     20448<<ASSIGN
B$CGAUCIDCB.FLG.OUTPUT
     18959**DCL     20449<<ASSIGN
B$CGAUCIDCB.SYSID
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:280  
     18960**DCL     20447<<ASSIGN
B$CGAUCIDCB.WHO.ACCT
     18958**DCL     20445<<ASSIGN
B$CGAUCIDCB.WHO.NAME
     18958**DCL     20446<<ASSIGN
B$JIT.ACCN
      9372**DCL     20445>>ASSIGN
B$JIT.DCB$
      9462**DCL     20417>>ASSIGN  21403>>ASSIGN  22081>>ASSIGN
B$JIT.DCBNO
      9453**DCL     20977>>ASSIGN
B$JIT.ERR
      9372**DCL     20426<<ASSIGN  20437<<ASSIGN  20464<<ASSIGN  20505<<ASSIGN  20559<<ASSIGN  20584<<ASSIGN
     20594<<ASSIGN  20689<<ASSIGN  20893<<ASSIGN  20912<<ASSIGN  21163<<ASSIGN  21172<<ASSIGN  21182<<ASSIGN
     21197<<ASSIGN  21207<<ASSIGN  21220<<ASSIGN  21228<<ASSIGN  21237<<ASSIGN  21282<<ASSIGN
B$JIT.ERR.CODE
      9373**DCL     21283<<ASSIGN
B$JIT.ERR.MID
      9373**DCL      9373--REDEF
B$JIT.MODE
      9367**DCL     20921>>IF
B$JIT.SYSID
      9372**DCL     20447>>ASSIGN
B$JIT.UNAME
      9372**DCL     20446>>ASSIGN
B$JIT.USER
      9372**DCL     20978>>ASSIGN
B$JIT$
     19083**DCL      9367--IMP-PTR 20417>>ASSIGN  20426>>ASSIGN  20437>>ASSIGN  20445>>ASSIGN  20446>>ASSIGN
     20447>>ASSIGN  20464>>ASSIGN  20505>>ASSIGN  20559>>ASSIGN  20584>>ASSIGN  20594>>ASSIGN  20689>>ASSIGN
     20893>>ASSIGN  20912>>ASSIGN  20921>>IF      20977>>ASSIGN  20978>>ASSIGN  21163>>ASSIGN  21172>>ASSIGN
     21182>>ASSIGN  21197>>ASSIGN  21207>>ASSIGN  21220>>ASSIGN  21228>>ASSIGN  21237>>ASSIGN  21282>>ASSIGN
     21283>>ASSIGN  21403>>ASSIGN  22081>>ASSIGN
B$M$UC$
     19082**DCL     20919>>IF
BADSTA
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:281  
     21220**LABEL   20952--CALLALT 20954--GOTO
B_CGAUCI
     20118**DCL     20444>>ASSIGN
B_CGAUCI.ATTR
     20125**DCL     20125--REDEF
CFU$
     18909**DCL     18711--IMP-PTR 18731--IMP-PTR 20418<<ASSIGN  20462>>IF      20462>>IF      20473>>ASSIGN
     20475>>ASSIGN  20478>>ASSIGN  20479>>ASSIGN  20480>>ASSIGN  20543>>IF      20551>>ASSIGN  20552>>ASSIGN
     20658>>ASSIGN  20660>>ASSIGN  20662>>ASSIGN  20663>>ASSIGN  21078>>IF      21404<<ASSIGN  21405>>ASSIGN
     21406>>ASSIGN  21990<<ASSIGN  21991>>IF      21991>>IF      21994>>ASSIGN  21999>>ASSIGN  22082<<ASSIGN
     22083>>ASSIGN  22084>>ASSIGN
CGBAD
     21228**LABEL   20712--CALLALT 20759--CALLALT 20760--CALLALT 20794--CALLALT
CHAR8
     18841**DCL     21400>>ASSIGN  21436>>ASSIGN
CHARINDX
     18840**DCL     21517>>IF      21517>>IF      21519>>IF      21519>>IF      21523>>IF      21523>>IF
CHARZEROS
     20253**DCL     21437>>CALLBLT
CNNCT
     18934**DCL     20450<<ASSIGN  21131<<ASSIGN  21260>>IF      21441<<ASSIGN
CNNCT.DDA
     18935**DCL     21045>>ASSIGN  21046<<ASSIGN  21662>>ASSIGN  21663<<ASSIGN  21693>>ASSIGN  21694<<ASSIGN
     21807<<ASSIGN  21850<>CALL
CNNCT.MBLK$
     18936**DCL     18937--REDEF   21130>>ASSIGN  21648>>ASSIGN  21649<<ASSIGN  21818<>CALL    21819<>CALL
     21820<<ASSIGN  21823<>CALL    21824>>ASSIGN  21830>>ASSIGN  21831>>ASSIGN  21833>>ASSIGN  21851>>IF
     21853>>CALL    21853>>CALL    21855<>CALL    21856<<ASSIGN
CNNCT.MBLK$R
     18937**DCL     21851>>IF
CNNCTINFO
     21798**PROC    20988--CALL    21483--CALL
COMGRP
     18969**DCL     20609<<ASSIGN  20619<>CALL    20619--CALL
COMGRP.ACCT
     18991**DCL     20611<<ASSIGN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:282  
COMGRP.CODE
     18970**DCL     20610<<ASSIGN
COMGRP.NAM
     18995**DCL     20612<<ASSIGN
COMGRP.RCVR
     18975**DCL     20614<<ASSIGN
COMGRP.SN
     18987**DCL     20613<<ASSIGN
COMGRP.STATS
     19018**DCL     20615<<ASSIGN
COMGRP.STATS.PGSI
     19023**DCL     20617<>CALL
CTL$
     18927**DCL     16873--IMP-PTR 20484<>CALL    20485>>ASSIGN  20486>>ASSIGN  20487>>ASSIGN  20488>>ASSIGN
     20489>>ASSIGN  20490>>ASSIGN  20491>>ASSIGN  20492>>ASSIGN  20494>>ASSIGN  20494>>ASSIGN  20495>>ASSIGN
     20496>>ASSIGN  20496>>ASSIGN  20496>>ASSIGN  20581<>CALL    20582>>IF      20582>>IF      20591>>ASSIGN
     20591>>ASSIGN  20592>>IF      20602>>IF      20605>>ASSIGN  20607>>IF      20616>>ASSIGN  20622>>ASSIGN
     20668>>IF      20668>>IF      20671>>IF      20673>>IF      20685>>CALL    20698>>ASSIGN  20698>>ASSIGN
     20699>>ASSIGN  20699>>ASSIGN  20749>>IF      20756>>ASSIGN  20757>>ASSIGN  21994<<ASSIGN  21995>>DOWHILE
     21996<<ASSIGN  21996>>ASSIGN  21998>>ASSIGN
CTX.DISP
     18912**DCL     20479>>ASSIGN  20552<<ASSIGN  20663>>ASSIGN  21406<<ASSIGN  22083<<ASSIGN
CTX.SID
     18913**DCL     20478>>ASSIGN  20551<<ASSIGN  20662>>ASSIGN  21405<<ASSIGN  22084<<ASSIGN
CTX$
     18910**DCL     16136--IMP-PTR 18911--REDEF   20414<<ASSIGN  20471<<ASSIGN  20472>>ASSIGN  20473>>ASSIGN
     20474>>ASSIGN  20475>>ASSIGN  20476>>ASSIGN  20477>>ASSIGN  20480>>ASSIGN  20481>>ASSIGN  20482>>ASSIGN
     20483>>ASSIGN  20493>>ASSIGN  20499>>ASSIGN  20501>>CALL    20502>>ASSIGN  20503>>IF      20503>>IF
     20516>>CALL    20518>>DOWHILE 20518>>DOWHILE 20519>>CALL    20521>>ASSIGN  20525>>ASSIGN  20526>>ASSIGN
     20527>>ASSIGN  20527>>ASSIGN  20534>>CALL    20538>>CALL    20553>>CALL    20555>>ASSIGN  20555>>ASSIGN
     20557>>IF      20656<<ASSIGN  20657>>ASSIGN  20658>>ASSIGN  20659>>ASSIGN  20660>>ASSIGN  20661>>ASSIGN
     20678>>CALL    20684>>ASSIGN  20702>>ASSIGN  20703>>ASSIGN  20703>>ASSIGN  20712>>CALL    20719>>ASSIGN
     20721>>IF      20722>>ASSIGN  20724>>ASSIGN  20725>>ASSIGN  20726>>ASSIGN  20726>>ASSIGN  20730>>ASSIGN
     20731>>ASSIGN  20732>>ASSIGN  20732>>ASSIGN  20759>>CALL    20760>>CALL    20761>>ASSIGN  20766>>ASSIGN
     20792>>CALL    20793>>CALL    20794>>CALL    20854>>ASSIGN  20856>>CALL    20859>>ASSIGN  20873>>IF
     20874>>IF      20875>>CALL    20877>>CALL    20882>>CALL    20884>>ASSIGN  20910>>IF      20949>>CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:283  
     20950>>CALL    20976>>ASSIGN  20985>>CALL    20993>>IF      20994>>IF      20996>>CALL    21000>>IF
     21002>>ASSIGN  21007>>CALL    21023>>IF      21029>>IF      21049>>ASSIGN  21050>>ASSIGN  21058>>CALL
     21081>>ASSIGN  21085>>IF      21085>>IF      21085>>IF      21085>>IF      21091>>IF      21108>>IF
     21108>>IF      21108>>IF      21108>>IF      21108>>IF      21121>>ASSIGN  21122>>ASSIGN  21135>>IF
     21137>>ASSIGN  21145>>CALL    21193>>CALL    21277>>IF      21445<<ASSIGN  21453>>IF      21453>>IF
     21453>>IF      21466>>ASSIGN  21466>>ASSIGN  21473>>CALL    21478>>CALL    21482>>ASSIGN  21497>>IF
     21497>>IF      21502>>CALL    21548>>IF      21560>>CALL    21588>>IF      21637>>CALL    21665>>ASSIGN
     21666>>ASSIGN  21672>>ASSIGN  21672>>ASSIGN  21673>>ASSIGN  21673>>ASSIGN  21691>>ASSIGN  21739>>CALL
     21779>>ASSIGN  21805>>CALL    21812>>ASSIGN  21813>>ASSIGN  21816>>CALL    21818>>CALL    21819>>CALL
     21823>>CALL    21829>>CALL    21835>>CALL    21855>>CALL    21868>>CALL    21902>>CALL    21906>>CALL
     21908>>CALL    21938>>CALL    21944>>CALL    21962>>CALL    21968>>CALL    21988<<ASSIGN  21989>>DOWHILE
     21990>>ASSIGN  22011<<ASSIGN  22011>>ASSIGN  22031>>CALL    22034>>CALL    22038>>ASSIGN  22085>>CALL
     22088>>CALL    22090>>ASSIGN  22090>>ASSIGN  22092>>IF      22093>>ASSIGN  22095>>CALL
DA IN PROCEDURE RELDDA
     21864**DCL     21867<<ASSIGN  21868<>CALL    21869>>IF
DBLK$
     18926**DCL     16959--IMP-PTR 20492<<ASSIGN  20493>>ASSIGN  20494>>ASSIGN  20711<<ASSIGN  20712<>CALL
     21805<>CALL    21806>>ASSIGN  21810>>ASSIGN  21814>>ASSIGN  21816<>CALL    21829<>CALL    21833>>ASSIGN
     21834>>ASSIGN  21835<>CALL
DDA IN PROCEDURE RELDDA
     21862**DCL     21860--PROC    21865>>IF      21867>>ASSIGN  21874<<ASSIGN
DESC#
     18939**DCL     20666<<ASSIGN  20671>>IF      20677>>ASSIGN  20747<<ASSIGN  20747>>ASSIGN  20748>>IF
DGRAN
     18930**DCL     20675<<ASSIGN
DGRAN.DESC
     18933**DCL     20677<<ASSIGN
DGRAN.DISP
     18931**DCL     20676<<ASSIGN
DGRAN$
     18929**DCL     16045--IMP-PTR 17012--IMP-PTR 17276--IMP-PTR 18930--REDEF   20519<>CALL    20520>>ASSIGN
     20521>>ASSIGN  20522>>ASSIGN  20523>>ASSIGN  20524>>ASSIGN  20524>>ASSIGN  20525>>ASSIGN  20526>>ASSIGN
     20678<>CALL    20686>>IF      20700>>IF      20702>>ASSIGN  20705>>IF      20707>>ASSIGN  20708>>ASSIGN
     20709>>ASSIGN  20710>>ASSIGN  20711>>ASSIGN  20713>>ASSIGN  20714>>ASSIGN  20715>>ASSIGN  20716>>ASSIGN
     20717>>ASSIGN  20718>>ASSIGN  20719>>ASSIGN  20720>>CALL    20722>>ASSIGN  20724>>ASSIGN  20725>>ASSIGN
     20728>>IF      20730>>ASSIGN  20731>>ASSIGN  21124<>CALL    21125<>CALL    21126<>CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:284  
DUPNM
     21172**LABEL   21014--GOTO
ELA$SYSLOG
     20036**DCL-ENT 20619--CALL
ENDSETUP
     20503**LABEL   20886--GOTO
ENTFLG
     18917**DCL     20421<<ASSIGN  21328<<ASSIGN  21332<<ASSIGN  21366<<ASSIGN  21398<<ASSIGN  21434<<ASSIGN
     21443>>IF      21446<<ASSIGN  21453>>IF      21475>>IF      21507>>IF      21540>>IF      21570>>IF
     21650>>IF      21742>>IF      21801>>IF      21809>>IF      21827>>IF
ERR
     21237**LABEL   20470--CALLALT 20506--GOTO    20538--CALLALT 20560--GOTO    20581--CALLALT 20585--GOTO
     20600--GOTO    20655--CALLALT 20685--CALLALT 20690--GOTO    20894--GOTO    20913--GOTO    20942--CALLALT
     20949--CALLALT 20950--CALLALT 21173--GOTO    21183--GOTO    21198--GOTO    21208--GOTO    21221--GOTO
     21229--GOTO    21238--GOTO    21284--GOTO
ERR IN PROCEDURE VALIDATE
     21929**LABEL   21927--CALLALT
ERRCGCROP
     20314**DCL     21237>>ASSIGN
ERRCGCTLBAD
     20302**DCL     20584>>ASSIGN
ERRCGCXT
     20278**DCL     21197>>ASSIGN
ERRCGGRANS
     20306**DCL     20505>>ASSIGN
ERRCGNOCLS
     20310**DCL     20893>>ASSIGN
ERRCGORAU
     20334**DCL     21163>>ASSIGN
ERRCGSTAR
     20326**DCL     20464>>ASSIGN
ERRCONNECTED
     21266**LABEL   21169--GOTO
ERRDMY
     20258**DCL     21282>>ASSIGN
ERRDUPNM
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:285  
     20270**DCL     21182>>ASSIGN
ERRFILECG
     20274**DCL     20426>>ASSIGN
ERRNCGAU
     20318**DCL     20437>>ASSIGN
ERRNDCBCG
     20294**DCL     20912>>ASSIGN
ERRNOCGLDCT
     20266**DCL     21172>>ASSIGN
ERROLDCG
     20330**DCL     20594>>ASSIGN
ERROR
     18901**DCL        19--PROC    21326--ENTRY   21330--ENTRY   21364--ENTRY   21396--ENTRY   21401<<ASSIGN
     21432--ENTRY   21435>>ASSIGN  21439<<ASSIGN  21526<<ASSIGN  21552<<ASSIGN  21598<<ASSIGN  21606<<ASSIGN
     21729<<ASSIGN  21733<<ASSIGN  21736<<ASSIGN  21740>>IF
ERRPRIVSTA
     20322**DCL     21220>>ASSIGN
ERRRCVRBAD
     20298**DCL     20689>>ASSIGN
ERRSTABAD
     20286**DCL     21228>>ASSIGN
ERRSTAILLGL
     20290**DCL     21207>>ASSIGN
ERRTWOAU
     20262**DCL     20559>>ASSIGN
F$CFU$
     19086**DCL     18726--IMP-PTR 18734--IMP-PTR 20475>>ASSIGN  20613>>ASSIGN  20660>>ASSIGN  21995>>DOWHILE
     21996>>ASSIGN  21998>>ASSIGN  21999>>ASSIGN  22005>>IF
F$DCB.ACCT
     18671**DCL     20611>>ASSIGN
F$DCB.ACTPOS
     18686**DCL     18686--REDEF
F$DCB.ARS
     18661**DCL     18661--REDEF
F$DCB.ASN
     18676**DCL     20938>>IF      20963>>IF      20987>>IF      21013>>IF
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:286  
F$DCB.ATTR
     18679**DCL     18680--REDEF
F$DCB.AU
     18672**DCL     20435>>IF      20557>>IF      20910>>IF      20987>>IF      21029>>IF      21043>>IF
     21051>>ASSIGN
F$DCB.BFR
     18705**DCL     20696<<ASSIGN
F$DCB.BFR.BUFX
     18706**DCL     20681<<ASSIGN
F$DCB.BFR.CVM
     18706**DCL     20683<<ASSIGN
F$DCB.BFR.DA
     18706**DCL     20497<<ASSIGN
F$DCB.BFR1
     18706**DCL     20697<<ASSIGN
F$DCB.BORROW
     18694**DCL     18694--REDEF   18694--REDEF   18694--REDEF
F$DCB.CFU$
     18695**DCL     20418>>ASSIGN  21404>>ASSIGN  22082>>ASSIGN
F$DCB.DCBNAME.L
     18708**DCL     18708--IMP-SIZ
F$DCB.DDEV.IC
     18667**DCL     20924<<ASSIGN  20928<<ASSIGN
F$DCB.DDEV.UCOUT
     18667**DCL     20930<<ASSIGN
F$DCB.ENQF
     18693**DCL     21143>>IF      21146<<ASSIGN
F$DCB.EOMCHAR
     18665**DCL     18665--REDEF
F$DCB.FEXT
     18689**DCL     20453>>IF
F$DCB.FFLG.AU
     18667**DCL     20435>>IF
F$DCB.FLDID
     18689**DCL     18689--REDEF
F$DCB.FORM$
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:287  
     18683**DCL     18683--REDEF
F$DCB.FSECT
     18699**DCL     18699--REDEF
F$DCB.FSN
     18676**DCL     18676--REDEF   18676--REDEF   18677--REDEF
F$DCB.FUN
     18675**DCL     20453>>IF      20980>>IF
F$DCB.GTYP
     18690**DCL     20579<<ASSIGN  20664<<ASSIGN
F$DCB.HASH
     18698**DCL     20477>>ASSIGN  20487>>ASSIGN  20661>>ASSIGN
F$DCB.HEADER$
     18682**DCL     18682--REDEF
F$DCB.IWL
     18702**DCL     20958<<ASSIGN
F$DCB.IXTNSIZE
     18680**DCL     18680--REDEF
F$DCB.LASTSTA$
     18670**DCL     18670--REDEF   20940>>IF      20942<>CALL    20944>>ASSIGN  20961>>ASSIGN
F$DCB.LDCTX
     18683**DCL     20419<<ASSIGN  21020<<ASSIGN  21054<<ASSIGN  21266<<ASSIGN
F$DCB.LSTAOR
     18673**DCL     20934<<ASSIGN
F$DCB.LVL
     18695**DCL     18695--REDEF   20580<<ASSIGN  20665<<ASSIGN
F$DCB.MEDIA
     18701**DCL     20923<<ASSIGN  20927<<ASSIGN  20957<<ASSIGN
F$DCB.NAME
     18670**DCL     20612>>ASSIGN
F$DCB.NAME.C
     18670**DCL     18670--REDEF
F$DCB.NOEOF
     18691**DCL     18691--REDEF
F$DCB.NRECS
     18681**DCL     18681--REDEF
F$DCB.NRECX
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:288  
     18700**DCL     18700--REDEF
F$DCB.OHDR
     18692**DCL     18692--REDEF
F$DCB.ORG
     18675**DCL     18675--REDEF   20424>>IF      20476>>ASSIGN  20490>>ASSIGN
F$DCB.PRECNO
     18698**DCL     18698--REDEF
F$DCB.QISS
     18672**DCL     20483>>ASSIGN
F$DCB.RCSZ
     18703**DCL     18703--REDEF
F$DCB.RECL
     18676**DCL     20931>>ASSIGN  20932<<ASSIGN
F$DCB.RES
     18671**DCL     18671--REDEF
F$DCB.SETSTA$
     18670**DCL     20944<<ASSIGN  20945>>ASSIGN  20946>>ASSIGN  20949>>CALL    20950>>CALL    20952>>CALL
     20953>>IF      20967>>IF      20970>>CALLBLT 20971>>CALLBLT 20975>>ASSIGN  20983>>ASSIGN
F$DCB.SETX
     18683**DCL     18683--REDEF   20474>>ASSIGN  20613>>ASSIGN  20659>>ASSIGN
F$DCB.TAB$
     18682**DCL     18683--REDEF
F$DCB.TDA
     18697**DCL     18697--REDEF
F$DCB.UCOUT
     18696**DCL     20933<<ASSIGN
F$DCB.WIDTH
     18668**DCL     20931<<ASSIGN
F$DCB.WSN
     18672**DCL     18672--REDEF
F$DCB.XTNSIZE
     18678**DCL     22090>>ASSIGN
FAG$GEXT
     20037**DCL-ENT 22086--CALL
FGH$UPDBUCKET
     20038**DCL-ENT 20617--CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:289  
FINDCG
     21983**PROC    21449--CALL
FINDSTA2
     21481**LABEL   21568--GOTO
FINDSTA20
     21545**LABEL   21591--GOTO
FINDSTA21
     21561**LABEL   21560--CALLALT
FINDSTA25
     21601**LABEL   21563--GOTO
FINDSTA5
     21530**LABEL   21570--GOTO
FINDSTA8
     21522**LABEL   21516--GOTO    21520--GOTO    21522--GOTO    21538--GOTO
FM$BUF$
     19087**DCL     20682>>ASSIGN
FM$CFU.ACCTX
     18712**DCL     18712--REDEF   20462>>IF      21999>>ASSIGN
FM$CFU.GDA
     18713**DCL     20478<<ASSIGN  20543>>IF      20551>>ASSIGN  20662<<ASSIGN  21405>>ASSIGN  22084>>ASSIGN
FM$CFU.LDA
     18714**DCL     20479<<ASSIGN  20552>>ASSIGN  20663<<ASSIGN  21406>>ASSIGN  22083>>ASSIGN
FM$CFU.NAMEX
     18712**DCL     21995>>DOWHILE 21996>>ASSIGN  21998>>ASSIGN
FM$CFU.SHARE
     18711**DCL     21078>>IF
FM$CFU.STARX.F
     18712**DCL     20462>>IF      21991>>IF
FM$CFU.UGRANS
     18713**DCL     20480>>ASSIGN
FM$CFU.XTX
     18713**DCL     20475>>ASSIGN  20660>>ASSIGN
FM$CFUA.ACCT
     18720**DCL     22003>>IF
FM$CFUA.PRIV
     18721**DCL     22006>>IF
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:290  
FM$CFUA.SETX
     18720**DCL     22005>>IF
FM$CFUF.ACCNAM
     18731**DCL     21991>>IF
FM$CFUN.L
     18717**DCL     18717--IMP-SIZ 22000>>ASSIGN  22001--IF
FM$CFUX.CFUT
     18726**DCL     21995>>DOWHILE
FM$SET.PSN
     18734**DCL     20613>>ASSIGN  22005>>IF
FM$SET.USERLIST
     18735**DCL     18735--REDEF
FMD$FLSHBUF
     20039**DCL-ENT 20422--CALL
FMD$GBUF
     20040**DCL-ENT 21124--CALL
FMD$GETBUF
     20041**DCL-ENT 20484--CALL
FMD$RBUF
     20042**DCL-ENT 21126--CALL
FMD$REDBUF
     20043**DCL-ENT 20581--CALL
FMD$REDBUFBC
     20044**DCL-ENT 20685--CALL
FMD$RELBUF
     20045**DCL-ENT 21236--CALL    21275--CALL    21276--CALL
FMD$WRTBUF
     20046**DCL-ENT 20498--CALL    20853--CALL    20892--CALL
FM_FRZERO
     19084**DCL     20497>>ASSIGN  20581<>CALL
FPT$OPEN_V.FSN
     10361**DCL     10361--REDEF   10362--REDEF
FSA$GSP
     20048**DCL-ENT 20942--CALL
GETGORGO
     22027**PROC    20536--CALL    20791--CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:291  
GETSTA
     20997**LABEL   20996--CALLALT
GETTRM
     21503**LABEL   21502--CALLALT
GLOCK IN PROCEDURE SLOCK
     21959**ENTRY   20554--CALL    21080--CALL    21120--CALL    21452--CALL    21671--CALL
GMB IN PROCEDURE CNNCTINFO
     21823**LABEL   21821--GOTO
GOTCG
     21443**LABEL   21410--GOTO
GOTGORGOSTA IN PROCEDURE GETGORGO
     22029**LABEL   22032--GOTO
GOTTERM
     21566**LABEL   21504--GOTO
GT1 IN PROCEDURE GTRM
     21904**LABEL   21902--CALLALT
GT2 IN PROCEDURE GTRM
     21907**LABEL   21903--GOTO
GTRM
     21899**PROC    21567--CALL
GUNLOCK IN PROCEDURE SLOCK
     21965**ENTRY   20556--CALL    21082--CALL    21123--CALL    21457--CALL    21468--CALL    21674--CALL
HFC$LOCK
     10378**DCL-ENT 20516--CALL    21408--CALL    21938--CALL    21950--CALL    21962--CALL    21986--CALL
     22088--CALL
HFC$UNLOCK
     10378**DCL-ENT 20534--CALL    21193--CALL    21459--CALL    21470--CALL    21944--CALL    21956--CALL
     21968--CALL    22015--CALL    22095--CALL
I
     18918**DCL     18839--IMP-SIZ 18842--IMP-SIZ 20519<>CALL    20679<<ASSIGN  20680<>CALL    21804<<ASSIGN
     21805<>CALL    21807>>ASSIGN  21808<<ASSIGN  21810>>ASSIGN  21810>>ASSIGN  21814>>ASSIGN  21814>>ASSIGN
     21817<<ASSIGN  21818<>CALL    21823<>CALL    21828<<ASSIGN  21829<>CALL    21830>>ASSIGN  21832<<ASSIGN
     21834>>ASSIGN  21834>>ASSIGN  21866<<ASSIGN  21868<>CALL    21901<<ASSIGN  21902<>CALL    21905<<ASSIGN
     21906<>CALL    21907<<ASSIGN  21908<>CALL    22000<<ASSIGN  22001>>IF      22001>>IF
I IN PROCEDURE VALIDATE
     21924**DCL     21927<<CALLBLT
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:292  
INDX
     18924**DCL     18840--IMP-SIZ 18925--REDEF   20616<<ASSIGN  20617<>CALL    20619<>CALL    20678<>CALL
     20679>>ASSIGN  20680<>CALL    20681>>ASSIGN  20682>>ASSIGN  20695<>CALL    21283>>ASSIGN  21339<<ASSIGN
     21399<<ASSIGN  21435<<ASSIGN  21437>>CALLBLT 21515>>IF      21517>>IF      21517>>IF      21519>>IF
     21519>>IF      21523>>IF      21523>>IF
INDXR$
     18925**DCL     21057<<ASSIGN  21058<>CALL    21058--CALL    21636<<ASSIGN  21637<>CALL    21637--CALL
ITEM IN PROCEDURE VALIDATE
     21923**DCL     21921--PROC    21926>>IF      21927>>CALLBLT
JDCB$
     18907**DCL     18661--IMP-PTR 20417<<ASSIGN  20418>>ASSIGN  20419>>ASSIGN  20424>>IF      20435>>IF
     20435>>IF      20453>>IF      20453>>IF      20474>>ASSIGN  20476>>ASSIGN  20477>>ASSIGN  20483>>ASSIGN
     20487>>ASSIGN  20490>>ASSIGN  20497>>ASSIGN  20557>>IF      20579>>ASSIGN  20580>>ASSIGN  20611>>ASSIGN
     20612>>ASSIGN  20613>>ASSIGN  20659>>ASSIGN  20661>>ASSIGN  20664>>ASSIGN  20665>>ASSIGN  20681>>ASSIGN
     20683>>ASSIGN  20696>>ASSIGN  20697>>ASSIGN  20910>>IF      20919>>IF      20923>>ASSIGN  20924>>ASSIGN
     20927>>ASSIGN  20928>>ASSIGN  20930>>ASSIGN  20931>>ASSIGN  20931>>ASSIGN  20932>>ASSIGN  20933>>ASSIGN
     20934>>ASSIGN  20938>>IF      20940>>IF      20942>>CALL    20944>>ASSIGN  20944>>ASSIGN  20945>>ASSIGN
     20946>>ASSIGN  20949>>CALL    20950>>CALL    20952>>CALL    20953>>IF      20957>>ASSIGN  20958>>ASSIGN
     20961>>ASSIGN  20963>>IF      20967>>IF      20970>>CALLBLT 20971>>CALLBLT 20975>>ASSIGN  20980>>IF
     20983>>ASSIGN  20985<>CALL    20987>>IF      20987>>IF      21013>>IF      21020>>ASSIGN  21029>>IF
     21043>>IF      21051>>ASSIGN  21054>>ASSIGN  21143>>IF      21146>>ASSIGN  21266>>ASSIGN  21403<<ASSIGN
     21404>>ASSIGN  22081<<ASSIGN  22082>>ASSIGN  22090>>ASSIGN
KC$CGID
     18868**DCL        19--PROC    21326--ENTRY   21330--ENTRY   21364--ENTRY   21396--ENTRY   21432--ENTRY
     21445--ASSIGN
KC$CGID.ACCT#
     18872**DCL     22003>>IF
KC$CGID.NAME#
     18875**DCL     22001--IF
KC$CGID.PSN#
     18873**DCL     22005>>IF      22006>>IF
KCA$TELLAUM
     20050**DCL-ENT 21132--CALL    21676--CALL
KCA$TELLAUR
     20051**DCL-ENT 21125--CALL
KCC$RECOVER
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:293  
     20052**DCL-ENT 20792--CALL
KCI$VALSTA1
     20053**DCL-ENT 20949--CALL    20950--CALL
KCO$CLCGERR
     20054**DCL-ENT 21278--CALL
KCO$RCNNCT
     20055**DCL-ENT 20861--CALL
KCO$TRMGONE
     20056**DCL-ENT 21739--CALL
KC_LGL1ST
     10557**DCL     21927>>CALLBLT
KC_VLPSETSTA
     19987**DCL     20945>>ASSIGN
KC_VLPSTATION
     20015**DCL     20961>>ASSIGN
KC_VLPSTATION.MSGIDXT
     20025**DCL     20028--REDEF
KEY
     18919**DCL     20710<<ASSIGN  20712<>CALL    20717--ASSIGN  20983<<ASSIGN  20985<>CALL    20985<>CALL
     20991>>IF      20996<>CALL    21007<>CALL    21338<<ASSIGN  21400<<ASSIGN  21436<<ASSIGN  21437<<CALLBLT
     21502<>CALL    21515--IF      21517--IF      21519--IF      21523--IF      21556<>CALL    21560<>CALL
     22029<<ASSIGN  22031<>CALL    22034<>CALL
KQ$BAP.CG$
     16117**DCL     20702<<ASSIGN
KQ$CG
     16136**DCL     20493<<ASSIGN  20493>>ASSIGN  20495--ASSIGN  20519<>CALL    20553<>CALL    20655<>CALL
     20678<>CALL    20759<>CALL    20760<>CALL    20792<>CALL    20793<>CALL    20794<>CALL    20856<>CALL
     20875<>CALL    20877<>CALL    20882<>CALL    20985<>CALL    21007<>CALL    21058<>CALL    21473<>CALL
     21478<>CALL    21560<>CALL    21637<>CALL    21739<>CALL    21805<>CALL    21816<>CALL    21818<>CALL
     21819<>CALL    21823<>CALL    21829<>CALL    21835<>CALL    21855<>CALL    21868<>CALL    21902<>CALL
     21906<>CALL    21908<>CALL    22034<>CALL    22085<>CALL
KQ$CG.ADDFREE
     16697**DCL     20652<<ASSIGN
KQ$CG.AU
     16549**DCL     20625<<ASSIGN  21029>>IF      21085>>IF      21122<<ASSIGN
KQ$CG.AUCTL.DCBCONAU
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:294  
     16576**DCL     21085>>IF      21108>>IF
KQ$CG.AUCTL.DCBCONLGL
     16583**DCL     20910>>IF
KQ$CG.AUCTL.DCBCONNAU
     16577**DCL     21108>>IF
KQ$CG.AUCTL.DCBCONWA
     16582**DCL     21085>>IF
KQ$CG.AUCTL.DVBYTE
     16579**DCL     21691>>ASSIGN
KQ$CG.AUCTL.DVBYTE.REREAD
     16579**DCL     16580--REDEF
KQ$CG.AUCTL.INPUT
     16584**DCL     21812>>ASSIGN
KQ$CG.AUCTL.MAXPG
     16576**DCL     20503>>IF
KQ$CG.AUCTL.OUTPUT
     16584**DCL     21813>>ASSIGN
KQ$CG.AUCTL.SMD
     16578**DCL     20874>>IF
KQ$CG.AUCTL.TERMCONLGL
     16584**DCL     21135>>IF      21453>>IF
KQ$CG.AUCTL.XSTALGL
     16578**DCL     21000>>IF      21023>>IF      21548>>IF      21588>>IF
KQ$CG.AUSTA$
     16546**DCL     20557>>IF      20627<<ASSIGN  21085>>IF      21108>>IF      21108>>IF      21121<<ASSIGN
KQ$CG.AVAIL.HD$
     16767**DCL     20648<<ASSIGN  20721>>IF      20722<<ASSIGN
KQ$CG.AVAIL.TL$
     16769**DCL     20649<<ASSIGN  20719>>ASSIGN  20724>>ASSIGN  20725<<ASSIGN
KQ$CG.CFU$
     16647**DCL     20473<<ASSIGN  20658<<ASSIGN  21145<>CALL    21990>>ASSIGN
KQ$CG.CLOCK
     16512**DCL     20502<<ASSIGN  20634<<ASSIGN  20854<<ASSIGN
KQ$CG.CLOSING
     16503**DCL     21453>>IF      21497>>IF
KQ$CG.CURDATAPGS
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:295  
     16756**DCL     20518>>DOWHILE 20527<<ASSIGN  20527>>ASSIGN  20645<<ASSIGN  20726<<ASSIGN  20726>>ASSIGN
KQ$CG.DATAFREE$
     16762**DCL     20525>>ASSIGN  20526<<ASSIGN  20651<<ASSIGN
KQ$CG.DCBHD$
     16491**DCL     20650<<ASSIGN  21049>>ASSIGN  21050<<ASSIGN  21665>>ASSIGN  21666<<ASSIGN
KQ$CG.DELAY.DISKWARN
     16223**DCL     22092>>IF
KQ$CG.DTREE
     16719**DCL     20624<<ASSIGN  20712<>CALL
KQ$CG.DTREE.GATE
     16721**DCL     20516<>CALL    20534<>CALL    20638<<ASSIGN  21193<>CALL    22088<>CALL    22095<>CALL
KQ$CG.EOFTIME
     16257**DCL     20629<<ASSIGN
KQ$CG.EOFTIMEHD$
     16253**DCL     20628<<ASSIGN
KQ$CG.FWHD$
     16562**DCL     20631<<ASSIGN
KQ$CG.FWUSR#
     16558**DCL     20630<<ASSIGN
KQ$CG.GATE.CG
     16526**DCL     20636<<ASSIGN  21962<>CALL    21968<>CALL
KQ$CG.GATE.MISC
     16528**DCL     20637<<ASSIGN
KQ$CG.GETFLG
     16691**DCL     20653<<ASSIGN
KQ$CG.GORGOSTA$
     16635**DCL     20538<>CALL    21002>>ASSIGN  22038<<ASSIGN
KQ$CG.GRAN
     16806**DCL     20521>>ASSIGN  20684>>ASSIGN
KQ$CG.GRAN.ORG
     16836**DCL     20476<<ASSIGN
KQ$CG.GRAN.STAMP.HASH
     16810**DCL     20477<<ASSIGN  20661<<ASSIGN
KQ$CG.HIGRANS
     16667**DCL     20482<<ASSIGN  20592>>IF      20604<<ASSIGN  20604>>ASSIGN
KQ$CG.IOCNT
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:296  
     16688**DCL     20635<<ASSIGN
KQ$CG.JRNLSTA$
     16639**DCL     20873>>IF      20993>>IF      20994>>IF      21091>>IF      21108>>IF
KQ$CG.LASTUSER
     16653**DCL     20626<<ASSIGN
KQ$CG.LNK$
     16500**DCL     22011>>ASSIGN
KQ$CG.MINDATAPGS
     16758**DCL     20518>>DOWHILE
KQ$CG.MMD.BAPLOCK
     16173**DCL     20643<<ASSIGN
KQ$CG.MMD.CURBPG
     16162**DCL     20642<<ASSIGN  20703<<ASSIGN  20703>>ASSIGN
KQ$CG.MMD.CURPG
     16158**DCL     20617<>CALL    20641<<ASSIGN
KQ$CG.MMD.FREE$
     16154**DCL     20647<<ASSIGN  20730>>ASSIGN  20731<<ASSIGN
KQ$CG.MMD.FREECNT
     16160**DCL     20646<<ASSIGN  20732<<ASSIGN  20732>>ASSIGN
KQ$CG.MMD.GATE
     16147**DCL     20644<<ASSIGN
KQ$CG.MSGID
     16530**DCL     21779>>ASSIGN
KQ$CG.NGAVAL
     16661**DCL     20480<<ASSIGN  20503>>IF      22090<<ASSIGN  22090>>ASSIGN
KQ$CG.OPEN
     16506**DCL     20633<<ASSIGN  21081<<ASSIGN  21453>>IF      21497>>IF
KQ$CG.PGTIME
     16535**DCL     20501<>CALL    20616>>ASSIGN  20623<>CALL
KQ$CG.QISS
     16522**DCL     20483<<ASSIGN
KQ$CG.RCVR
     16510**DCL     20654<<ASSIGN  20884<<ASSIGN
KQ$CG.SETSTA.ISTA
     16608**DCL     20949<>CALL
KQ$CG.SETSTA.OSTA
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:297  
     16613**DCL     20950<>CALL
KQ$CG.SETX
     16651**DCL     20474<<ASSIGN  20659<<ASSIGN
KQ$CG.STATS
     16626**DCL     20615>>ASSIGN  20621<<ASSIGN
KQ$CG.STATS.NUMDCBS
     16629**DCL     20472<<ASSIGN  20555<<ASSIGN  20555>>ASSIGN  20657<<ASSIGN  21673<<ASSIGN  21673>>ASSIGN
KQ$CG.STATS.NUMTERMS
     16629**DCL     20632<<ASSIGN  21466<<ASSIGN  21466>>ASSIGN  21672<<ASSIGN  21672>>ASSIGN
KQ$CG.STATS.PGSI
     16629**DCL     20617<>CALL
KQ$CG.STREE
     16468**DCL     20996<>CALL    21502<>CALL    22031<>CALL
KQ$CG.STREE.GATE
     16470**DCL     20639<<ASSIGN  21938<>CALL    21944<>CALL
KQ$CG.STREE.HEAD$
     16478**DCL     20761>>ASSIGN  20859>>ASSIGN
KQ$CG.TRIGGERED
     16655**DCL     22093<<ASSIGN
KQ$CG.TTREE.GATE
     16431**DCL     20640<<ASSIGN
KQ$CG.UGRANS
     16663**DCL     20481<<ASSIGN
KQ$CG.XTX$
     16649**DCL     20475<<ASSIGN  20660<<ASSIGN
KQ$CTLGRAN
     16873**DCL     20486<<ASSIGN  20491--ASSIGN  20492--ASSIGN
KQ$CTLGRAN.CTXSIZ
     16932**DCL     20495<<ASSIGN  20496>>ASSIGN  20582>>IF
KQ$CTLGRAN.CTXX
     16930**DCL     20494<<ASSIGN  20582>>IF      20591>>ASSIGN
KQ$CTLGRAN.HDR.AVAIL
     16922**DCL     20491<<ASSIGN  20496<<ASSIGN  20496>>ASSIGN
KQ$CTLGRAN.HDR.GTYP
     16917**DCL     20489<<ASSIGN
KQ$CTLGRAN.HDR.ORG
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:298  
     16920**DCL     20490<<ASSIGN
KQ$CTLGRAN.HDR.PTYP
     16912**DCL     20488<<ASSIGN
KQ$CTLGRAN.HDR.STAMP.HASH
     16894**DCL     20487<<ASSIGN
KQ$CTLGRAN.PGTBL
     16943**DCL     20671>>IF
KQ$CTLGRAN.RCVRDA
     16934**DCL     20668>>IF      20685<>CALL    20699<<ASSIGN  20699>>ASSIGN  20756<<ASSIGN
KQ$CTLGRAN.RCVRSIZ
     16936**DCL     20668>>IF      20673>>IF      20698<<ASSIGN  20698>>ASSIGN  20749>>IF      20757<<ASSIGN
KQ$CTLGRAN.RCVRTIME
     16938**DCL     20607>>IF      20616>>ASSIGN  20622<<ASSIGN
KQ$CTLGRAN.VERSION
     16940**DCL     20592>>IF      20602>>IF      20605<<ASSIGN
KQ$DBLK
     16959**DCL     21810--ASSIGN  21814--ASSIGN  21834--ASSIGN
KQ$DBLK.STAMP
     16960**DCL     21806<<ASSIGN  21833<<ASSIGN
KQ$DGRAN
     17012**DCL     20520<<ASSIGN  20684<<ASSIGN
KQ$DGRAN.ACTCNT
     17123**DCL     20708<<ASSIGN
KQ$DGRAN.BLINK$
     17110**DCL     20719<<ASSIGN
KQ$DGRAN.BTN
     17085**DCL     20711--ASSIGN
KQ$DGRAN.BTN.KEY
     17098**DCL     20710>>ASSIGN
KQ$DGRAN.BYPASSCNT
     17114**DCL     20709<<ASSIGN
KQ$DGRAN.FLINK$
     17112**DCL     20525<<ASSIGN  20718<<ASSIGN  20724<<ASSIGN
KQ$DGRAN.HDR.ADDFREE
     17041**DCL     20715<<ASSIGN
KQ$DGRAN.HDR.CHAIN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:299  
     17047**DCL     20713<<ASSIGN
KQ$DGRAN.HDR.FORCEOUT
     17039**DCL     20716<<ASSIGN
KQ$DGRAN.HDR.GTYP
     17056**DCL     20523<<ASSIGN
KQ$DGRAN.HDR.PTYP
     17051**DCL     20522<<ASSIGN  20700>>IF      20705>>IF      20728>>IF
KQ$DGRAN.HDR.SELF$
     17063**DCL     20524<<ASSIGN  20686>>IF
KQ$DGRAN.HDR.STAMP.GMOD
     17035**DCL     20717<<ASSIGN
KQ$DGRAN.HDR.WRITE
     17043**DCL     20714<<ASSIGN
KQ$DGRAN.TIME
     17127**DCL     20720<>CALL
KQ$DGRAN.USECNT
     17102**DCL     20707<<ASSIGN
KQ$DSB.ASR
     17161**DCL     17170--REDEF
KQ$DSB.DESC.FLG
     17181**DCL     17182--REDEF
KQ$FP.LNK$
     17259**DCL     20730<<ASSIGN
KQ$GRAN
     17276**DCL     20521<<ASSIGN
KQ$MBLK
     17330**DCL     21817--ASSIGN
KQ$MBLK.DDA
     17395**DCL     21830<<ASSIGN  21853<>CALL
KQ$MBLK.DVE.EOMCHAR
     17432**DCL     17434--REDEF
KQ$MBLK.KEY1
     17358**DCL     17360--REDEF
KQ$MBLK.KEY2
     17367**DCL     17385--REDEF
KQ$MBLK.LNK$
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:300  
     17332**DCL     17334--REDEF   17340--REDEF   17344--REDEF
KQ$MBLK.MSGSIZE
     17493**DCL     21831<<ASSIGN
KQ$MBLK.PUTSTATE
     17476**DCL     21824<<ASSIGN
KQ$MBLK.STAMP
     17352**DCL     21833>>ASSIGN  21853<>CALL
KQ$MBLK.TYC
     17481**DCL     17483--REDEF
KQ$MBLK.XSP.MREQ$
     17387**DCL     17391--REDEF
KQ$MMSD.CGHEAD$
     18641**DCL     21988>>ASSIGN
KQ$QTN
     17600**DCL     21901--ASSIGN  21905--ASSIGN  21907--ASSIGN
KQ$QTN.MXACT
     17946**DCL     17948--REDEF
KQ$QTN.STA.ACTTYC
     17668**DCL     17672--REDEF
KQ$QTN.STA.DCBLNK$
     17675**DCL     17678--REDEF   17682--REDEF
KQ$QTN.STA.EVCNT
     17761**DCL     17764--REDEF
KQ$QTN.STA.EVNT
     17727**DCL     17731--REDEF   17734--REDEF
KQ$QTN.STA.OPNBLKED
     17788**DCL     17791--REDEF
KQ$QTN.STA.OPNREJ
     17794**DCL     17796--REDEF
KQ$QTN.STA.SUCCREAD
     17717**DCL     17721--REDEF
KQ$QTN.STA.TCOUNT
     17846**DCL     17852--REDEF
KQ$QTN.STA.VGOT$
     17831**DCL     17835--REDEF   17839--REDEF
KQ$RBLK.BUF$
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:301  
     18195**DCL     18197--REDEF
KQ$RBLK.CNACTD
     18109**DCL     18118--REDEF
KQ$RBLK.DBLKX
     18215**DCL     18219--REDEF
KQ$RBLK.EOFNONE
     18087**DCL     18090--REDEF
KQ$RBLK.FROMQ
     18093**DCL     18096--REDEF
KQ$RBLK.KEY1R
     18134**DCL     18135--REDEF
KQ$RBLK.KEY2R
     18139**DCL     18140--REDEF
KQ$RBLK.LATCH
     18082**DCL     18084--REDEF
KQ$RBLK.LWRITES$
     18226**DCL     18230--REDEF
KQ$RBLK.STATE
     18079**DCL     20781>>IF      20785<<ASSIGN
KQ$STA
     18260**DCL     20861<>CALL    20867<>CALL    20869<>CALL    21094<>CALL    21112<>CALL    21125<>CALL
     21132<>CALL    21675<>CALL    21676<>CALL    21723<>CALL
KQ$STA.ACTTYC
     18312**DCL     18316--REDEF
KQ$STA.AU
     18342**DCL     21051<<ASSIGN  21085>>IF      21108>>IF      21115>>IF      21776<<ASSIGN
KQ$STA.AUP
     18414**DCL     21028>>IF      21601>>IF
KQ$STA.BTN.FLINK$
     18294**DCL     20786>>ASSIGN  20870>>ASSIGN  21521>>ASSIGN
KQ$STA.BTN.KEY
     18296**DCL     20871>>IF      20994>>IF      21058<>CALL    21058<>CALL    21517--IF      21519--IF
     21523--IF      21637<>CALL    21637<>CALL
KQ$STA.CG$
     18299**DCL     20766<<ASSIGN
KQ$STA.CNNCTDDA
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:302  
     18397**DCL     21045<<ASSIGN  21662<<ASSIGN  21693<<ASSIGN
KQ$STA.CNNCTSIZE
     18336**DCL     21047<<ASSIGN  21664<<ASSIGN  21695<<ASSIGN
KQ$STA.DCBCNT
     18408**DCL     21017<<ASSIGN  21017>>ASSIGN  21041<<ASSIGN
KQ$STA.DCBLNK$
     18319**DCL     18322--REDEF   18326--REDEF   21049<<ASSIGN  21665<<ASSIGN
KQ$STA.DDISC
     18424**DCL     20777<<ASSIGN
KQ$STA.DSCREQS
     18440**DCL     20774<<ASSIGN  21769<<ASSIGN
KQ$STA.DSCREQW
     18435**DCL     20773<<ASSIGN  21767<<ASSIGN
KQ$STA.DSID
     18399**DCL     21779<<ASSIGN
KQ$STA.DVBYTE
     18411**DCL     21691<<ASSIGN
KQ$STA.EVCNT
     18405**DCL     18408--REDEF   20771<<ASSIGN  21778<<ASSIGN
KQ$STA.EVNT
     18371**DCL     18375--REDEF   18378--REDEF   20770<<ASSIGN  21777<<ASSIGN
KQ$STA.GATE
     18338**DCL     20767<<ASSIGN  21950<>CALL    21956<>CALL
KQ$STA.IDSC
     18340**DCL     20778<<ASSIGN  21012>>IF      21534>>IF      21593>>IF      21774<<ASSIGN
KQ$STA.JRNLW
     18443**DCL     20776<<ASSIGN
KQ$STA.LDCT$
     18301**DCL     20763<<ASSIGN  21012>>IF      21020>>ASSIGN  21037<<ASSIGN  21534>>IF      21543>>ASSIGN
     21593>>IF      21643<<ASSIGN
KQ$STA.LOCKCNT
     18394**DCL     20765<<ASSIGN  21541<<ASSIGN  21541>>ASSIGN  21692<<ASSIGN  21692>>ASSIGN
KQ$STA.MBLK$
     18305**DCL     21130<<ASSIGN  21648<<ASSIGN
KQ$STA.MLH
     18528**DCL     20875--CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:303  
KQ$STA.MONDCB
     18344**DCL     21667<<ASSIGN
KQ$STA.OPNBLKED
     18432**DCL     18435--REDEF   20775<<ASSIGN  21100<<ASSIGN  21766<<ASSIGN
KQ$STA.OPNREJ
     18438**DCL     18440--REDEF   21101<<ASSIGN  21149>>IF      21768<<ASSIGN
KQ$STA.PERM
     18358**DCL     21023>>IF      21588>>IF
KQ$STA.PVGSENSE
     18455**DCL     20772<<ASSIGN  21771<<ASSIGN
KQ$STA.RBLK$
     18303**DCL     20780>>IF      20781>>IF      20785>>ASSIGN
KQ$STA.READS
     18486**DCL     21781<<ASSIGN
KQ$STA.SAVIDSC
     18459**DCL     20779<<ASSIGN  21775<<ASSIGN
KQ$STA.SAVLDCT$
     18499**DCL     20764<<ASSIGN
KQ$STA.SGHD$
     18326**DCL     21647<<ASSIGN
KQ$STA.SPECIAL
     18419**DCL     21601>>IF      22040<<ASSIGN
KQ$STA.STARSDUN
     18448**DCL     21770<<ASSIGN
KQ$STA.SUCCREAD
     18361**DCL     18365--REDEF   20768<<ASSIGN  21772<<ASSIGN
KQ$STA.TCOUNT
     18490**DCL     18496--REDEF
KQ$STA.TERM
     18356**DCL     20866>>IF      21038<<ASSIGN  21644<<ASSIGN  21668<<ASSIGN
KQ$STA.TERR
     18365**DCL     20769<<ASSIGN  21773<<ASSIGN
KQ$STA.TOLDAU
     18368**DCL     21118<<ASSIGN  21661<<ASSIGN  21765<<ASSIGN
KQ$STA.USR#
     18391**DCL     21004<<ASSIGN  21039<<ASSIGN  21645<<ASSIGN
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:304  
KQ$STA.VGOT$
     18475**DCL     18479--REDEF   18483--REDEF
KQ$STA.WRITES
     18488**DCL     21780<<ASSIGN
KQB$INSERTNL
     20057**DCL-ENT 20712--CALL
KQB$SRCH
     20058**DCL-ENT 20996--CALL    21502--CALL    22031--CALL
KQC$ACTSTA
     20059**DCL-ENT 21094--CALL    21112--CALL    21675--CALL
KQC$CXTSET
     20060**DCL-ENT 20500--CALL
KQC$CXTSET1
     20061**DCL-ENT 20538--CALL
KQC$TRMCK
     20063**DCL-ENT 21138--CALL
KQD$DELDDA
     20064**DCL-ENT 21868--CALL
KQD$GETR
     20065**DCL-ENT 21805--CALL    21829--CALL
KQD$RECOVER
     20066**DCL-ENT 20759--CALL
KQD$UNLOCK
     20067**DCL-ENT 21816--CALL    21835--CALL
KQL$DELMLH
     20068**DCL-ENT 20875--CALL
KQM$GETB
     20069**DCL-ENT 21906--CALL
KQM$GETBK
     20070**DCL-ENT 21818--CALL    21902--CALL
KQM$GETMBLK
     20071**DCL-ENT 21823--CALL
KQM$GETP
     20072**DCL-ENT 20519--CALL
KQM$INIT
     20075**DCL-ENT 20470--CALL    20655--CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:305  
KQM$RECON
     20062**DCL-ENT 20678--CALL
KQM$RELB
     20073**DCL-ENT 21908--CALL
KQM$RELMBLK
     20074**DCL-ENT 21819--CALL    21855--CALL
KQP$DISC
     20077**DCL-ENT 21722--CALL
KQP$RECOVER
     20078**DCL-ENT 20869--CALL
KQP$UNLOCK
     20079**DCL-ENT 21723--CALL
KQQ$RECOVER
     20080**DCL-ENT 20793--CALL
KQQ$RECOVER2
     20081**DCL-ENT 20882--CALL
KQR$RECOVER
     20082**DCL-ENT 20867--CALL
KQS$RECOVER
     20083**DCL-ENT 20794--CALL
KQS$RECOVER2
     20084**DCL-ENT 20856--CALL
KQT$DELSTA
     20085**DCL-ENT 20877--CALL
KQT$GETSTA
     20086**DCL-ENT 21007--CALL
KQT$MAKESTA
     20087**DCL-ENT 21560--CALL    22034--CALL
KQT$RECOVER
     20088**DCL-ENT 20760--CALL
KQX$CHKTIME
     20089**DCL-ENT 20862--CALL
KQX$LDASR
     20090**DCL-ENT 20553--CALL    21473--CALL    22085--CALL
KQX$SETTIME
     20091**DCL-ENT 20858--CALL    20864--CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:306  
KQZ$LOG
     20092**DCL-ENT 20985--CALL    21058--CALL    21478--CALL    21637--CALL
KQ_CGLGATE
     13557**DCL     21408<>CALL    21459<>CALL    21470<>CALL    21986<>CALL    22015<>CALL
KQ_CTLGRAN
     20141**DCL     20486>>ASSIGN
KQ_ICG
     19103**DCL     20470<>CALL
KQ_ICG.AUCTL.DVBYTE.REREAD
     19546**DCL     19547--REDEF
KQ_IDGRAN
     19840**DCL     20520>>ASSIGN
KQ_IMBLK.DVE.EOMCHAR
     14220**DCL     14222--REDEF
KQ_IMBLK.KEY1
     14146**DCL     14148--REDEF
KQ_IMBLK.KEY2
     14155**DCL     14173--REDEF
KQ_IMBLK.LNK$
     14120**DCL     14122--REDEF   14128--REDEF   14132--REDEF
KQ_IMBLK.TYC
     14269**DCL     14271--REDEF
KQ_IMBLK.XSP.MREQ$
     14175**DCL     14179--REDEF
KQ_IRBLK.BUF$
     13724**DCL     13726--REDEF
KQ_IRBLK.CNACTD
     13638**DCL     13647--REDEF
KQ_IRBLK.DBLKX
     13744**DCL     13748--REDEF
KQ_IRBLK.EOFNONE
     13616**DCL     13619--REDEF
KQ_IRBLK.FROMQ
     13622**DCL     13625--REDEF
KQ_IRBLK.KEY1R
     13663**DCL     13664--REDEF
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:307  
KQ_IRBLK.KEY2R
     13668**DCL     13669--REDEF
KQ_IRBLK.LATCH
     13611**DCL     13613--REDEF
KQ_IRBLK.LWRITES$
     13755**DCL     13759--REDEF
KQ_IRBLKT.CNACTD
     13824**DCL     13833--REDEF
KQ_IRBLKT.DBLK$
     13887**DCL     13891--REDEF   13894--REDEF
KQ_IRBLKT.EOFNONE
     13802**DCL     13805--REDEF
KQ_IRBLKT.FROMQ
     13808**DCL     13811--REDEF
KQ_IRBLKT.KEY1R
     13849**DCL     13850--REDEF
KQ_IRBLKT.KEY2R
     13854**DCL     13855--REDEF
KQ_IRBLKT.LATCH
     13797**DCL     13799--REDEF
KQ_LOG.DSIO
     13579**DCL     20984>>IF      21055>>IF
KQ_LOG.TSIO
     13578**DCL     21477>>IF      21634>>IF
KQ_MMSD$
     19081**DCL     18636--IMP-PTR 21988>>ASSIGN
KQ_THDR
     20228**DCL     20624>>ASSIGN
K_RWPARM_CON.BLKREC
     15167**DCL     15192--REDEF
K_RWPARM_CON.BLKREC.BLKU#
     15168**DCL     15170--REDEF
K_RWPARM_CON.BLKREC.RECU#
     15180**DCL     15182--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
     15207**DCL     15208--REDEF
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:308  
K_RWPARM_CON.DVE.EOMCHAR
     15215**DCL     15219--REDEF
K_RWPARM_CON.ERR
     15279**DCL     15284--REDEF
K_RWPARM_CON.FC
     15243**DCL     15244--REDEF
K_RWPARM_CON.FLDID
     15425**DCL     15426--REDEF
K_RWPARM_CON.FPT$
     15306**DCL     15313--REDEF
K_RWPARM_CON.KEYTYPE
     15432**DCL     15433--REDEF
K_RWPARM_CON.MSG$
     15142**DCL     15148--REDEF
K_RWPARM_CON.MSGID
     15254**DCL     15259--REDEF
K_RWPARM_CON.MSGIDXT
     15267**DCL     15271--REDEF
K_RWPARM_CON.ORG
     15403**DCL     15404--REDEF
K_RWPARM_CON.THDRSZ
     15347**DCL     15351--REDEF
K_RWPARM_CON.VDOFLGS
     15405**DCL     15416--REDEF
LDCT$
     18915**DCL     18751--IMP-PTR 20415<<ASSIGN  20966<<ASSIGN  20969>>CALLBLT 20973>>ASSIGN  20974>>ASSIGN
     20975>>ASSIGN  20976>>ASSIGN  20977>>ASSIGN  20978>>ASSIGN  20979>>ASSIGN  20981>>ASSIGN  21037>>ASSIGN
     21042>>ASSIGN  21054>>ASSIGN  21261>>IF      21263>>ASSIGN  21337<<ASSIGN  21338>>ASSIGN  21478>>CALL
     21478>>CALL    21482>>ASSIGN  21643>>ASSIGN  21660>>ASSIGN  21688>>ASSIGN  21689>>ASSIGN  21720>>ASSIGN
     21721>>IF      21722>>CALL    21806>>ASSIGN  21850>>CALL
MEMERR
     21182**LABEL   20536--CALLALT 20791--CALLALT 20988--CALLALT 21007--CALLALT
MEMERRUD
     21182**LABEL   20519--CALLALT
MMERR
     21277**LABEL   20678--CALLALT
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:309  
MMJ$MAPIOP
     20093**DCL-ENT 20680--CALL
MMJ$UNMAPIOP
     20094**DCL-ENT 20695--CALL
MOVEI
     18842**DCL     21810<<ASSIGN  21810>>ASSIGN  21814<<ASSIGN  21814>>ASSIGN  21834<<ASSIGN  21834>>ASSIGN
NAME$
     18920**DCL     18717--IMP-PTR 20591<<ASSIGN  20592>>IF      20604>>ASSIGN  20604>>ASSIGN  20615>>ASSIGN
     20616>>ASSIGN  20617>>CALL    20617>>CALL    20621>>ASSIGN  20623>>CALL    20624>>ASSIGN  20625>>ASSIGN
     20626>>ASSIGN  20627>>ASSIGN  20628>>ASSIGN  20629>>ASSIGN  20630>>ASSIGN  20631>>ASSIGN  20632>>ASSIGN
     20633>>ASSIGN  20634>>ASSIGN  20635>>ASSIGN  20636>>ASSIGN  20637>>ASSIGN  20638>>ASSIGN  20639>>ASSIGN
     20640>>ASSIGN  20641>>ASSIGN  20642>>ASSIGN  20643>>ASSIGN  20644>>ASSIGN  20645>>ASSIGN  20646>>ASSIGN
     20647>>ASSIGN  20648>>ASSIGN  20649>>ASSIGN  20650>>ASSIGN  20651>>ASSIGN  20652>>ASSIGN  20653>>ASSIGN
     20654>>ASSIGN  20655>>CALL    20682<<ASSIGN  20684>>ASSIGN  20685<>CALL    20686>>IF      21998<<ASSIGN
     22000>>ASSIGN  22001>>IF
NAMEI
     18839**DCL     22001>>IF      22001>>IF
NK$LDCT
     18751**DCL     21722<>CALL
NK$LDCT.CG$
     18782**DCL     20976<<ASSIGN  21482<<ASSIGN
NK$LDCT.DCBNO
     18775**DCL     20977<<ASSIGN
NK$LDCT.DDT$
     18753**DCL     18753--REDEF
NK$LDCT.DEVNM
     18753**DCL     20975<<ASSIGN  21338>>ASSIGN  21478<>CALL    21478<>CALL    21806--ASSIGN  21850--CALL
NK$LDCT.DFLG.INPUT
     18755**DCL     20979<<ASSIGN  21688<<ASSIGN
NK$LDCT.DFLG.LOCAL
     18757**DCL     20973<<ASSIGN
NK$LDCT.DFLG.OLDSC
     18756**DCL     21721>>IF
NK$LDCT.DFLG.OUTPUT
     18755**DCL     20981<<ASSIGN  21689<<ASSIGN
NK$LDCT.IOQ$
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:310  
     18752**DCL     18753--REDEF
NK$LDCT.LDCTX
     18754**DCL     18754--REDEF   20969>>CALLBLT 21020>>ASSIGN  21054>>ASSIGN
NK$LDCT.LKFLG.ABORTED
     18766**DCL     18767--REDEF
NK$LDCT.RESCOD
     18759**DCL     20974<<ASSIGN
NK$LDCT.RLCID.LDCTX
     18776**DCL     18776--REDEF
NK$LDCT.STA$
     18772**DCL     18773--REDEF   21042<<ASSIGN  21660<<ASSIGN  21720<<ASSIGN
NK$LDCT.SYMB$
     18751**DCL     18751--REDEF   18751--REDEF   18752--REDEF
NK$LDCT.USER
     18761**DCL     20978<<ASSIGN
NKL$GETDCT
     20095**DCL-ENT 20965--CALL
NKL$RELDCT
     20096**DCL-ENT 21264--CALL
NMB IN PROCEDURE CNNCTINFO
     21822**LABEL   21818--CALLALT
NOCG
     21733**LABEL   21449--CALLALT 21461--GOTO    21500--GOTO
NOGORGOSTA IN PROCEDURE GETGORGO
     22029**LABEL   22031--CALLALT
NOLDCT
     21163**LABEL   20965--CALLALT
NXTCG IN PROCEDURE FINDCG
     22005**LABEL   22002--GOTO    22004--GOTO    22007--GOTO
OPNREJ
     21141**LABEL   21149--GOTO
OPNTYP
     18928**DCL     20420<<ASSIGN  20461<<ASSIGN  20537>>IF      20578<<ASSIGN  20910>>IF      21135>>IF
PG
     18844**DCL     20485<<ASSIGN  20717>>ASSIGN
PG#
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:311  
     18940**DCL     20667<<ASSIGN  20671>>IF      20676>>ASSIGN  20743<<ASSIGN  20743>>ASSIGN  20744>>IF
     20746<<ASSIGN
PLDCT$
     18851**DCL        19--PROC    18852--REDEF   21326--ENTRY   21330--ENTRY   21337>>ASSIGN  21364--ENTRY
     21396--ENTRY   21432--ENTRY   21478--CALL    21528<<ASSIGN  21543<<ASSIGN
PRIVSTA
     21207**LABEL   21030--GOTO
RCVR_BAD
     20689**LABEL   20674--GOTO    20752--GOTO
RCVR_DONE
     20756**LABEL   20750--GOTO
RCVR_SLOOP
     20861**LABEL   20862--CALLALT
RELCNNCT
     21846**PROC    21260--CALL    21742--CALL    21838--CALL
RELDDA IN PROCEDURE RELCNNCT
     21860**PROC    21850--CALL    21853--CALL
SCRATCH$
     19074**DCL     20470<>CALL    20471>>ASSIGN  20499<<ASSIGN  20500<>CALL    20655<>CALL    20656>>ASSIGN
     20876<<ASSIGN  20877<>CALL    20965<>CALL    20966>>ASSIGN  20996<>CALL    20997>>ASSIGN  21006<<ASSIGN
     21007<>CALL    21008>>ASSIGN  21137<<ASSIGN  21138<>CALL    21263<<ASSIGN  21264<>CALL    21502<>CALL
     21503>>ASSIGN  21506>>ASSIGN  21560<>CALL    21561>>ASSIGN  21902<>CALL    21906<>CALL    21908<>CALL
     22031<>CALL    22034<>CALL    22036>>ASSIGN
SC_CGREOPEN
     20035**DCL-ENT 20734--CALL
SIZ IN PROCEDURE CNNCTINFO
     21800**DCL     21802<<ASSIGN  21803<<ASSIGN  21804>>ASSIGN  21808>>ASSIGN  21828>>ASSIGN  21831>>ASSIGN
     21832>>ASSIGN
SLOCK
     21935**PROC    20990--CALL    21496--CALL    22030--CALL
SSR$REG
     20097**DCL-ENT 20863--CALL    21148--CALL    21822--CALL    21870--CALL    21904--CALL
SSS$BLOCK
     20098**DCL-ENT 21336--CALL
SSS$SYSTIME
     20099**DCL-ENT 20501--CALL    20623--CALL    20720--CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:312  
STA$
     18916**DCL     18260--IMP-PTR 20416<<ASSIGN  20761<<ASSIGN  20762>>DOWHILE 20763>>ASSIGN  20764>>ASSIGN
     20765>>ASSIGN  20766>>ASSIGN  20767>>ASSIGN  20768>>ASSIGN  20769>>ASSIGN  20770>>ASSIGN  20771>>ASSIGN
     20772>>ASSIGN  20773>>ASSIGN  20774>>ASSIGN  20775>>ASSIGN  20776>>ASSIGN  20777>>ASSIGN  20778>>ASSIGN
     20779>>ASSIGN  20780>>IF      20781>>IF      20785>>ASSIGN  20786<<ASSIGN  20786>>ASSIGN  20859<<ASSIGN
     20860>>DOWHILE 20861>>CALL    20866>>IF      20867>>CALL    20869>>CALL    20870>>ASSIGN  20871>>IF
     20873>>IF      20875>>CALL    20876>>ASSIGN  20879<<ASSIGN  20997<<ASSIGN  21002<<ASSIGN  21004>>ASSIGN
     21006>>ASSIGN  21008<<ASSIGN  21012>>IF      21012>>IF      21017>>ASSIGN  21017>>ASSIGN  21020>>ASSIGN
     21023>>IF      21028>>IF      21037>>ASSIGN  21038>>ASSIGN  21039>>ASSIGN  21041>>ASSIGN  21042>>ASSIGN
     21045>>ASSIGN  21047>>ASSIGN  21049>>ASSIGN  21050>>ASSIGN  21051>>ASSIGN  21057>>ASSIGN  21058>>CALL
     21058>>CALL    21085>>IF      21091>>IF      21094>>CALL    21100>>ASSIGN  21101>>ASSIGN  21108>>IF
     21108>>IF      21112>>CALL    21115>>IF      21118>>ASSIGN  21121>>ASSIGN  21125>>CALL    21130>>ASSIGN
     21132>>CALL    21149>>IF      21503<<ASSIGN  21506<<ASSIGN  21515>>IF      21517>>IF      21519>>IF
     21521<<ASSIGN  21521>>ASSIGN  21522>>IF      21523>>IF      21534>>IF      21534>>IF      21541>>ASSIGN
     21541>>ASSIGN  21543>>ASSIGN  21561<<ASSIGN  21588>>IF      21593>>IF      21593>>IF      21601>>IF
     21601>>IF      21636>>ASSIGN  21637>>CALL    21637>>CALL    21643>>ASSIGN  21644>>ASSIGN  21645>>ASSIGN
     21647>>ASSIGN  21648>>ASSIGN  21660>>ASSIGN  21661>>ASSIGN  21662>>ASSIGN  21664>>ASSIGN  21665>>ASSIGN
     21666>>ASSIGN  21667>>ASSIGN  21668>>ASSIGN  21675>>CALL    21676>>CALL    21691>>ASSIGN  21692>>ASSIGN
     21692>>ASSIGN  21693>>ASSIGN  21695>>ASSIGN  21720>>ASSIGN  21723>>CALL    21765>>ASSIGN  21766>>ASSIGN
     21767>>ASSIGN  21768>>ASSIGN  21769>>ASSIGN  21770>>ASSIGN  21771>>ASSIGN  21772>>ASSIGN  21773>>ASSIGN
     21774>>ASSIGN  21775>>ASSIGN  21776>>ASSIGN  21777>>ASSIGN  21778>>ASSIGN  21779>>ASSIGN  21780>>ASSIGN
     21781>>ASSIGN  21909<<ASSIGN  21911<<ASSIGN  21950>>CALL    21956>>CALL    22036<<ASSIGN  22038>>ASSIGN
     22040>>ASSIGN
STABAD
     21729**LABEL   21556--CALLALT
STAFND
     21008**LABEL   20998--GOTO
STAINIT
     21763**PROC    21040--CALL    21646--CALL
STALOCK IN PROCEDURE SLOCK
     21947**ENTRY   21003--CALL    21011--CALL    21099--CALL    21117--CALL    21533--CALL    21562--CALL
     21587--CALL    22039--CALL
STAMP IN PROCEDURE RELDDA
     21863**DCL     21860--PROC    21866>>ASSIGN
STANOTALLWD
     21197**LABEL   20993--GOTO    20995--GOTO    21001--GOTO    21026--GOTO
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:313  
STAUNLOCK IN PROCEDURE SLOCK
     21953**ENTRY   21005--CALL    21018--CALL    21025--CALL    21052--CALL    21102--CALL    21119--CALL
     21180--CALL    21218--CALL    21537--CALL    21542--CALL    21590--CALL    21596--CALL    21604--CALL
     21669--CALL    21696--CALL    22041--CALL
STR6
     18914**DCL     20969<<CALLBLT 20971>>CALLBLT
SUNLOCK IN PROCEDURE SLOCK
     21941**ENTRY   21019--CALL    21053--CALL    21181--CALL    21206--CALL    21219--CALL    21499--CALL
     21527--CALL    21544--CALL    21551--CALL    21597--CALL    21605--CALL    21670--CALL    21697--CALL
     21732--CALL    22037--CALL
S_CUN
     19974**DCL     20985<>CALL    20991>>IF      21004>>ASSIGN  21029>>IF      21039>>ASSIGN  21058<>CALL
     21085>>IF      21091>>IF      21108>>IF      21122>>ASSIGN  21478<>CALL    21637<>CALL
S_PNO
     19080**DCL     21336>>IF
TERMNOMEM
     21720**LABEL   21483--CALLALT 21565--GOTO    21567--CALLALT
TIMCHK
     18908**DCL     20858<>CALL    20862<>CALL    20864<>CALL
TRM20
     21332**LABEL   21329--GOTO    21367--GOTO
TRMCOM
     21437**LABEL   21340--GOTO
TRMFLG
     18922**DCL     18923--REDEF   21402<<ASSIGN  21440<<ASSIGN  21467<<ASSIGN  21738>>IF
TRMXIT
     21736**LABEL   21529--GOTO    21545--GOTO    21553--GOTO    21599--GOTO    21607--GOTO    21730--GOTO
     21734--GOTO
TRY IN PROCEDURE RELDDA
     21867**LABEL   21871--GOTO
TRYCNT
     18938**DCL     21442<<ASSIGN  21565>>IF      21566<<ASSIGN
UBINHALF
     18843**DCL     21058<>CALL    21478<>CALL    21637<>CALL    21806>>ASSIGN  21850<>CALL
UQB$MDEQ
     20100**DCL-ENT 21145--CALL
PL6.E3A0      #002=KCO$INIT File=KCO$OPCG.:E05TSI                                WED 07/30/97 00:16 Page:314  
VALIDATE
     21921**PROC    20952--CALL    21556--CALL
VLP$SETSTA
     18796**DCL     20942--CALL    20945<<ASSIGN
VLP$SETSTA.ISTA
     18800**DCL     20949<>CALL
VLP$SETSTA.MYSTATION#
     18800**DCL     20946<<ASSIGN  20952<>CALL    20953>>IF      20967>>IF      20970<<CALLBLT 20971<<CALLBLT
     20975>>ASSIGN  20983>>ASSIGN
VLP$SETSTA.OSTA
     18805**DCL     20950<>CALL
VLP$STATION
     18824**DCL     20942--CALL    20944--ASSIGN  20961<<ASSIGN
VLP$STATION.MSGIDXT
     18834**DCL     18837--REDEF
WAFLG
     18923**DCL     21093<<ASSIGN  21098<<ASSIGN  21107<<ASSIGN  21141>>IF
ZEROS
     20252**DCL     20253--REDEF
